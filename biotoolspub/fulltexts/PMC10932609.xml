<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinform Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinform Adv</journal-id>
    <journal-id journal-id-type="publisher-id">bioadv</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2635-0041</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10932609</article-id>
    <article-id pub-id-type="doi">10.1093/bioadv/vbae030</article-id>
    <article-id pub-id-type="publisher-id">vbae030</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Article</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genetics and Population Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MetaQuad: shared informative variants discovery in metagenomic samples</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0009-0004-0771-8995</contrib-id>
        <name>
          <surname>Xu</surname>
          <given-names>Sheng</given-names>
        </name>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="https://credit.niso.org/contributor-roles/conceptualization" degree-contribution="equal">Conceptualization</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Data curation" vocab-term-identifier="https://credit.niso.org/contributor-roles/data-curation" degree-contribution="lead">Data curation</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Formal analysis" vocab-term-identifier="https://credit.niso.org/contributor-roles/formal-analysis" degree-contribution="lead">Formal analysis</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Investigation" vocab-term-identifier="https://credit.niso.org/contributor-roles/investigation" degree-contribution="lead">Investigation</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="https://credit.niso.org/contributor-roles/methodology" degree-contribution="lead">Methodology</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Project administration" vocab-term-identifier="https://credit.niso.org/contributor-roles/project-administration" degree-contribution="equal">Project administration</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Software" vocab-term-identifier="https://credit.niso.org/contributor-roles/software" degree-contribution="lead">Software</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Writing - original draft" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-original-draft" degree-contribution="lead">Writing - original draft</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Writing - review &amp; editing" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-review-editing" degree-contribution="lead">Writing - review &amp; editing</role>
        <aff><institution>School of Biomedical Sciences, Li Ka Shing Faculty of Medicine, The University of Hong Kong</institution>, Pokfulam, Hong Kong SAR, <country country="CN">China</country></aff>
        <aff><institution>Laboratory of Data Discovery for Health Limited (D24H), Hong Kong Science Park</institution>, Hong Kong SAR, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8326-6178</contrib-id>
        <name>
          <surname>Morgan</surname>
          <given-names>Daniel C</given-names>
        </name>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="https://credit.niso.org/contributor-roles/methodology" degree-contribution="supporting">Methodology</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Supervision" vocab-term-identifier="https://credit.niso.org/contributor-roles/supervision" degree-contribution="supporting">Supervision</role>
        <aff><institution>School of Biomedical Sciences, Li Ka Shing Faculty of Medicine, The University of Hong Kong</institution>, Pokfulam, Hong Kong SAR, <country country="CN">China</country></aff>
        <aff><institution>Laboratory of Data Discovery for Health Limited (D24H), Hong Kong Science Park</institution>, Hong Kong SAR, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Qian</surname>
          <given-names>Gordon</given-names>
        </name>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="https://credit.niso.org/contributor-roles/conceptualization" degree-contribution="supporting">Conceptualization</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Investigation" vocab-term-identifier="https://credit.niso.org/contributor-roles/investigation" degree-contribution="supporting">Investigation</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="https://credit.niso.org/contributor-roles/methodology" degree-contribution="supporting">Methodology</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Writing - review &amp; editing" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-review-editing" degree-contribution="supporting">Writing - review &amp; editing</role>
        <aff><institution>School of Biomedical Sciences, Li Ka Shing Faculty of Medicine, The University of Hong Kong</institution>, Pokfulam, Hong Kong SAR, <country country="CN">China</country></aff>
        <aff><institution>Laboratory of Data Discovery for Health Limited (D24H), Hong Kong Science Park</institution>, Hong Kong SAR, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Huang</surname>
          <given-names>Yuanhua</given-names>
        </name>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="https://credit.niso.org/contributor-roles/methodology" degree-contribution="equal">Methodology</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Supervision" vocab-term-identifier="https://credit.niso.org/contributor-roles/supervision" degree-contribution="equal">Supervision</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Writing - review &amp; editing" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-review-editing" degree-contribution="equal">Writing - review &amp; editing</role>
        <aff><institution>School of Biomedical Sciences, Li Ka Shing Faculty of Medicine, The University of Hong Kong</institution>, Pokfulam, Hong Kong SAR, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-2331-7011</contrib-id>
        <name>
          <surname>Ho</surname>
          <given-names>Joshua W K</given-names>
        </name>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Conceptualization" vocab-term-identifier="https://credit.niso.org/contributor-roles/conceptualization" degree-contribution="lead">Conceptualization</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Formal analysis" vocab-term-identifier="https://credit.niso.org/contributor-roles/formal-analysis" degree-contribution="supporting">Formal analysis</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Funding acquisition" vocab-term-identifier="https://credit.niso.org/contributor-roles/funding-acquisition" degree-contribution="lead">Funding acquisition</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Investigation" vocab-term-identifier="https://credit.niso.org/contributor-roles/investigation" degree-contribution="lead">Investigation</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Methodology" vocab-term-identifier="https://credit.niso.org/contributor-roles/methodology" degree-contribution="equal">Methodology</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Project administration" vocab-term-identifier="https://credit.niso.org/contributor-roles/project-administration" degree-contribution="lead">Project administration</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Resources" vocab-term-identifier="https://credit.niso.org/contributor-roles/resources" degree-contribution="lead">Resources</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Supervision" vocab-term-identifier="https://credit.niso.org/contributor-roles/supervision" degree-contribution="lead">Supervision</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Writing - original draft" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-original-draft" degree-contribution="equal">Writing - original draft</role>
        <role vocab="credit" vocab-identifier="https://credit.niso.org" vocab-term="Writing - review &amp; editing" vocab-term-identifier="https://credit.niso.org/contributor-roles/writing-review-editing" degree-contribution="lead">Writing - review &amp; editing</role>
        <aff><institution>School of Biomedical Sciences, Li Ka Shing Faculty of Medicine, The University of Hong Kong</institution>, Pokfulam, Hong Kong SAR, <country country="CN">China</country></aff>
        <aff><institution>Laboratory of Data Discovery for Health Limited (D24H), Hong Kong Science Park</institution>, Hong Kong SAR, <country country="CN">China</country></aff>
        <xref rid="vbae030-cor1" ref-type="corresp"/>
        <!--jwkho@hku.hk-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Forslund</surname>
          <given-names>Sofia</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="vbae030-cor1">Corresponding author. School of Biomedical Sciences, Li Ka Shing Faculty of Medicine, The University of Hong Kong, 21 Sassoon Road, Pokfulam, Hong Kong SAR, China. E-mail: <email>jwkho@hku.hk</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-02-24">
      <day>24</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>24</day>
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <volume>4</volume>
    <issue>1</issue>
    <elocation-id>vbae030</elocation-id>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>10</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>08</day>
        <month>2</month>
        <year>2024</year>
      </date>
      <date date-type="editorial-decision">
        <day>22</day>
        <month>2</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>23</day>
        <month>2</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>12</day>
        <month>3</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="vbae030.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Strain-level analysis of metagenomic data has garnered significant interest in recent years. Microbial single nucleotide polymorphisms (SNPs) are genomic variants that can reflect strain-level differences within a microbial species. The diversity and emergence of SNPs in microbial genomes may reveal evolutionary history and environmental adaptation in microbial populations. However, efficient discovery of shared polymorphic variants in a large collection metagenomic samples remains a computational challenge.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>MetaQuad utilizes a density-based clustering technique to effectively distinguish between shared variants and non-polymorphic sites using shotgun metagenomic data. Empirical comparisons with other state-of-the-art methods show that MetaQuad significantly reduces the number of false positive SNPs without greatly affecting the true positive rate. We used MetaQuad to identify antibiotic-associated variants in patients who underwent <italic toggle="yes">Helicobacter pylori</italic> eradication therapy. MetaQuad detected 7591 variants across 529 antibiotic resistance genes. The nucleotide diversity of some genes is increased 6 weeks after antibiotic treatment, potentially indicating the role of these genes in specific antibiotic treatments.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>MetaQuad is an open-source Python package available via <ext-link xlink:href="https://github.com/holab-hku/MetaQuad" ext-link-type="uri">https://github.com/holab-hku/MetaQuad</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Innovation and Technology Commission of Hong Kong</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Strain-level identification is a popular modern metagenomics technique (<xref rid="vbae030-B19" ref-type="bibr">Marx 2016</xref>). A bacterial strain is a genetic variant or a subtype within a bacterial species, playing a crucial role in bacterial adaptation and survival. These variants enable natural selection to take place, facilitating the bacteria’s ability to thrive in different environments. For example, within the gut microbiome community, the administration of antibiotics can exert a significant influence, necessitating species to adapt in order to ensure their survival (<xref rid="vbae030-B14" ref-type="bibr">Koo <italic toggle="yes">et al.</italic> 2019</xref>). Understanding bacterial strains and their adaptations is a critical aspect of microbiota investigation (<xref rid="vbae030-B28" ref-type="bibr">Yan <italic toggle="yes">et al.</italic> 2020</xref>). Microbes can exhibit an array of phenotypic properties with minor changes in their DNA code. Contradiction may arise in some microbiome literature, when different labs detect opposing associations with certain diseases (<xref rid="vbae030-B19" ref-type="bibr">Marx 2016</xref>). Strain-level analysis of the microbiome composition may provide an additional layer of information that may lead to more robust and reproducible results.</p>
    <p>Strain-level analysis is feasible with sequencing reads due to the ability to detect single nucleotide polymorphism (SNP) substitutions, which serve as reliable indicators of strain-level variations. Shotgun metagenomic sequencing possesses superior capability compared to 16S rRNA gene sequencing when it comes to identifying and detecting bacterial species that are present in lower abundance (<xref rid="vbae030-B10" ref-type="bibr">Durazzi <italic toggle="yes">et al.</italic> 2021</xref>). This enables the detection of a larger number of SNPs. However, successfully identifying strain-level difference has long been a problem, especially for short-read sequencing data. Misalignment of short sequence reads may lead to false positive SNP calls. It can produce high-confidence SNPs, which are hard to filter out by variant calling algorithms, as they are likely to be supported by multiple reads together with high mapping quality (<xref rid="vbae030-B9" ref-type="bibr">Day-Williams and Zeggini 2011</xref>). Sequencing error furthermore confounds detection of low-frequency SNPs. Excessive false positive SNPs may mask the effect of true SNPs, which in turn may lead to issues in downstream analyses (<xref rid="vbae030-B17" ref-type="bibr">Ma <italic toggle="yes">et al.</italic> 2019</xref>).</p>
    <p>SNPs with consistent allele frequency (AF) changes within a population are of key interest, as they offer insights into evolution by natural selection (<xref rid="vbae030-B27" ref-type="bibr">Wiberg <italic toggle="yes">et al.</italic> 2017</xref>). To emphasize the impact of natural selection, we identify SNPs with noticeably distinct allele frequencies within a population and classify them as shared informative variants. Many tools have been developed to study strain-level differences, some of which are constructed especially for the shotgun metagenomic sequencing, such as metaSNV (<xref rid="vbae030-B7" ref-type="bibr">Costea <italic toggle="yes">et al.</italic> 2017</xref>) and inStrain (<xref rid="vbae030-B21" ref-type="bibr">Olm <italic toggle="yes">et al.</italic> 2021</xref>). However, to our knowledge, no tools have been developed to detect informative variants from a population of samples, due in part to the challenges of distinguishing shared informative variants from background noise. To address these limitations, we present a new computational tool called MetaQuad. MetaQuad can efficiently detect the shared informative variants, with high accuracy and precision.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <sec>
      <title>2.1 Variant calling of shotgun metagenomic data</title>
      <p>The variant calling pipeline consists of three main steps. First, following initial processing steps (e.g. removal of contaminations, low-quality reads, and duplicates), shotgun metagenomic sequencing reads are aligned to a database of microbial reference genomes using BWA-MEM (<xref rid="vbae030-B15" ref-type="bibr">Li 2013</xref>) and subsequently filtered to remove low-quality reads. Next, the aligned reads from BAM files are piled up using cellsnp-lite (v1.2.0) (<xref rid="vbae030-B12" ref-type="bibr">Huang and Huang 2021</xref>) to identify SNPs with minimum minor allele frequency (minMAF) of 0.02 within a population. The output data from cellsnp-lite usually contain a large number of microbial SNPs, including shared variants, sample-specific variants, and sequencing errors. Finally, MetaQuad utilizes a density-based clustering technique to identify shared informative variants, ensuring that each cluster includes a minimum number of samples. The shared informative variants can be further analyzed to calculate nucleotide diversity of genes or genomes.</p>
    </sec>
    <sec>
      <title>2.2 MetaQuad model</title>
      <p>MetaQuad is a computational method to detect shared informative variants from a population of samples. MetaQuad processes allele counts of each sample output from cellsnp-lite (<xref rid="vbae030-B12" ref-type="bibr">Huang and Huang 2021</xref>) (<xref rid="vbae030-F1" ref-type="fig">Fig. 1a</xref>). The pipeline prior to MetaQuad involves cellsnp-lite calculating pileup and allele counts from bulk DNA sequencing data for each variant. MetaQuad evaluates metagenomic variants using a density-based clustering technique called OPTICS (Ordering Points To Identify Cluster Structure) (<xref rid="vbae030-B2" ref-type="bibr">Ankerst <italic toggle="yes">et al.</italic> 1999</xref>). For each variant identified by cellsnp-lite, one-dimensional OPTICS is applied based on the AF of each sample. The AF for each variant in each sample is considered as a data point, and OPTICS clustering is employed to group similar data points. A minimal number of samples is required to form a cluster for each group.</p>
      <fig position="float" id="vbae030-F1">
        <label>Figure 1.</label>
        <caption>
          <p>Overview of analysis pipeline and example of shared variants. (a) Recommended analysis pipeline for MetaQuad. The Shotgun metagenomic sequencing files are collected after removing contaminations (e.g. host contaminants), low-quality and duplicated reads. Filtered reads are aligned to a reference database using alignment tools, and low mapping quality reads are further filtered out. Cellsnp-lite is used to count the alleles of each sample, and the output data are processed by MetaQuad. All variants are listed in a CSV file with number of clusters, which distinguishes informative variants. Informative variants can be utilized to study the nucleotide diversity of each gene or genome. (b) Example of informative variants. Informative variants can be found in multiple samples with consistent changes in allele frequencies across populations. The allele frequencies of informative variants are similar within each population. (c) Example of random variants (background noise). Random variants can be found in one or more samples, but their allele frequencies do not have a consistent change, and the frequencies can vary greatly between samples. In the figure, different colors represent different allele frequencies.</p>
        </caption>
        <graphic xlink:href="vbae030f1" position="float"/>
      </fig>
      <p>The OPTICS algorithm consists of four main steps:</p>
      <list list-type="order">
        <list-item>
          <p>Reachability distance calculation: compute the reachability distance between each point and its neighboring points. The reachability distance is computed for points that are not considered core points and is utilized to determine the distance of a given point (which is not a core point) from a core point.</p>
        </list-item>
        <list-item>
          <p>Core distance calculation: determine the core distance of each point with its nearest neighbor, based on the minimal number of samples.</p>
        </list-item>
        <list-item>
          <p>Cluster extraction: extract clusters from regions of points that are in close proximity to each other and exhibit similar reachability distances.</p>
        </list-item>
        <list-item>
          <p>Cluster identification: analyze the reachability distances of the points within each cluster to identify distinct groups.</p>
        </list-item>
      </list>
      <p>MetaQuad outputs a table containing information on all detected variants from cellsnp-lite. Importantly, it calculates the estimated number of clusters for each variant. Shared informative variants can only be confirmed if there are at least two clusters present because SNPs with only one cluster may result from limitations in the reference database or sequencing errors and are therefore removed from the study. The output table also includes additional parameters, such as read depths (DPs) and allele depths (ADs), which can be helpful in filtering out false positive SNPs. The examples of informative variant and random variants (background noise) are shown in <xref rid="vbae030-F1" ref-type="fig">Fig. 1b and c</xref>.</p>
      <p>There is an important parameter in MetaQuad called minSample, which refers to the minimum number of samples required in each cluster. This parameter plays a crucial role in the model as having an insufficient sample size can result in noise being incorrectly assigned to multiple clusters. In our simulation experiments, we investigated the impact of different minSample values and observed that increasing this value may decrease both the true positive and false positive rates. To strike a balance between minimizing false positives and maintaining a reasonable true positive rate, we suggest setting the minSample value to 5% of the total sample size.</p>
    </sec>
    <sec>
      <title>2.3 Validity assessment of MetaQuad assumptions</title>
      <p>MetaQuad operates under the assumption that the allele frequencies of shared informative variants are similar within a population of the human gut microbiome. In order to test the assumption, we analyzed differences across individuals using a dataset from the Broad Institute-OpenBiome Microbiome Library (BIO-ML) (<xref rid="vbae030-B24" ref-type="bibr">Poyet <italic toggle="yes">et al.</italic> 2019</xref>), under BioProject PRJNA544527. We selected 30 shotgun metagenomic samples from three healthy individuals with different time points (10 samples each, with individuals coded as “am,” “an,” and “ao”). As certain strains should be shared between samples from the same person, so too should the variants.</p>
      <p>We processed the data by first trimming adaptors and removing phix contamination with BBMap/bbduk.sh. To remove human contamination, we used BBMap/bbmap.sh with a minimum alignment identity parameter of 0.95, and we removed duplicated reads with PRINSEQ++ (<xref rid="vbae030-B6" ref-type="bibr">Cantu <italic toggle="yes">et al.</italic> 2019</xref>). After these steps, we aligned the filtered reads to a reference database with BWA-MEM. Specifically, we used the coding sequences of the integrated gene catalog (IGC) (<xref rid="vbae030-B16" ref-type="bibr">Li <italic toggle="yes">et al.</italic> 2014</xref>) database from the Human Microbiome Project as our reference. We further filtered the resulting BAM files with Samtools (<xref rid="vbae030-B8" ref-type="bibr">Danecek <italic toggle="yes">et al.</italic> 2021</xref>), removing alternative and supplemental alignments, as well as reads with mapping quality scores ≤30 to ensure accuracy.</p>
      <p>Given the large number of genes in the reference database, we selected only the genes with genus annotations and sample occurrence frequencies larger than 0.95 according to the IGC annotation table. After this filtering step, we identified 5160 genes and used them to study shared variants both within and across individuals.</p>
    </sec>
    <sec>
      <title>2.4 Evaluating the model performance with simulated data</title>
      <p>Paired-end reads with a length of 151 bp were generated using InSilicoSeq (<xref rid="vbae030-B11" ref-type="bibr">Gourlé <italic toggle="yes">et al.</italic> 2019</xref>) to simulate shotgun metagenomic sequencing with sequencing errors (error model: NovaSeq). The simulation process involved several steps. Initially, a small gut microbiome consisting of five species from the genus Fusobacterium was established. This microbiome was used as the reference genome for the simulation. The genus Fusobacterium is known to be present in the human gut, with some members promoting the development of colorectal cancer (<xref rid="vbae030-B3" ref-type="bibr">Bi <italic toggle="yes">et al.</italic> 2022</xref>). To generate the reference genome, five Fusobacterium genomes were downloaded from NCBI (<ext-link xlink:href="https://www.ncbi.nlm.nih.gov" ext-link-type="uri">https://www.ncbi.nlm.nih.gov</ext-link>) with the NCBI Reference Sequence: NZ_LN831027.1 <italic toggle="yes">Fusobacterium nucleatum</italic>, NZ_JADRGD010000001.1 <italic toggle="yes">Fusobacterium necrophorum</italic>, NZ_CAEUHP010000001.1 <italic toggle="yes">Fusobacterium mortiferum</italic>, NZ_CP028103.1 <italic toggle="yes">Fusobacterium varium</italic>, and NZ_CP028105.1 <italic toggle="yes">Fusobacterium ulcerans</italic>. Four strains were generated based on the original genome, with different substitution rates (<xref rid="vbae030-F2" ref-type="fig">Fig. 2d</xref>). The genome variants were performed using mutate.sh from BBmap (<xref rid="vbae030-B5" ref-type="bibr">Bushnell 2014</xref>).</p>
      <fig position="float" id="vbae030-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Shared informative variants in real and simulated datasets. (a) Allele frequencies of informative variants detected by MetaQuad within each individual. Colors indicate varying allele frequencies. (b) Allele frequencies of uninformative variants within each individual. Colors denote distinct allele frequencies. (c) PCoA plot of informative variants detected by MetaQuad for each individual. (d) Schematic representation of the strain simulation pipeline for the simulated dataset. (e) Allele frequencies of simulated informative variants.</p>
        </caption>
        <graphic xlink:href="vbae030f2" position="float"/>
      </fig>
      <p>Using the genomes, the simulation was performed on datasets consisting of 100 samples divided into three groups with different percentages of strains (<xref rid="vbae030-F2" ref-type="fig">Fig. 2d</xref>). The number of simulated informative variants was 7638, and each dataset contained 100 samples divided into three groups (Groups 1, 2, and 3). The detailed simulation process is described in <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>. In order to better detect the performance of MetaQuad, multiple datasets were simulated with different mean depths of the variants. The mean depths varied from 3 to 35.5, and the detailed information of each dataset is shown in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>.</p>
      <p>The simulated reads were trimmed using BBMap/bbduk.sh to remove bases with quality scores below 10. The reads were then aligned back to the reference genome using BWA-MEM. Variant calling was performed using different tools with their default parameters, and their performances were compared later. These tools included BCFtools (<xref rid="vbae030-B8" ref-type="bibr">Danecek <italic toggle="yes">et al.</italic> 2021</xref>), GATK’s HaplotypeCaller (<xref rid="vbae030-B23" ref-type="bibr">Poplin <italic toggle="yes">et al.</italic> 2017</xref>), VarScan2 (<xref rid="vbae030-B13" ref-type="bibr">Koboldt <italic toggle="yes">et al.</italic> 2012</xref>), MetaSNV (<xref rid="vbae030-B7" ref-type="bibr">Costea <italic toggle="yes">et al.</italic> 2017</xref>), and InStrain (<xref rid="vbae030-B21" ref-type="bibr">Olm <italic toggle="yes">et al.</italic> 2021</xref>). The performance of these tools was evaluated using <italic toggle="yes">F</italic>1 score, true positive rate, and false positive.</p>
    </sec>
    <sec>
      <title>2.5 Identification of shared variants after antibiotic treatment</title>
      <p>Data from a study on <italic toggle="yes">Helicobacter pylori</italic> infected patients with antibiotic therapy (<xref rid="vbae030-B26" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> 2022</xref>) were used as a biological benchmark [antibiotic resistance gene (ARG) dataset]. A total of 121 stool samples were collected and subjected to metagenomic shotgun sequencing. These samples were obtained from 44 patients at three specific time points: before antibiotic treatment, 6 weeks after antibiotic treatment, and 6 months after antibiotic treatment. The data were processed the same way as before (30 samples from 3 individuals).</p>
      <p>To identify genes relevant to antibiotic resistance, we aligned the protein sequences of the IGC database to the Comprehensive Antibiotic Resistance Database (<xref rid="vbae030-B1" ref-type="bibr">Alcock <italic toggle="yes">et al.</italic> 2019</xref>) using DIAMOND (<xref rid="vbae030-B4" ref-type="bibr">Buchfink <italic toggle="yes">et al.</italic> 2021</xref>). We selected genes that aligned to the CARD database with an <italic toggle="yes">e</italic>-value &lt;e-50, resulting in 4948 ARGs. We then filtered the bam files to include only reads from these ARGs, resulting in final ARG bam files that were used for further analysis, including variant calling with different methods.</p>
      <p>We used cellsnp-lite with a minMAF of 0.02 and minCOUNT of 100, and MetaQuad with a minSample of 6, mean AD of 0.1, and mean DP of 0.5 for variant calling. All other variant calling tools were applied with their default parameters. Additional details of the data processing can be found in <xref rid="vbae030-F4" ref-type="fig">Fig. 4a</xref>.</p>
    </sec>
    <sec>
      <title>2.6 Runtime analysis of variant calling tools</title>
      <p>We compared the computational efficiency of vancan2, MetaSNV, cellsnp-lite, MetaQuad, and inStrain in analyzing all samples simultaneously. For inStrain, its runtime is calculated by its own built-in equation, and the final total time is the sum of the time required for all samples. For the other tools, we recorded the times with the Unix time command (real time), using the same computational resources (ppn = 80 and storage = 500G). The CPU is an Intel(R) Xeon(R) Gold 6130 CPU @ 2.10 GHz.</p>
    </sec>
    <sec>
      <title>2.7 Nucleotide diversity</title>
      <p>Nucleotide diversity was calculated using allele frequencies of shared variants calculated by the output of MetaQuad and cellsnp-lite:</p>
      <p>Nucleotide diversity (gene)=<inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:munderover><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo> – </mml:mo><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">AF</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mn>1</mml:mn><mml:mo> – </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">AF</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfenced><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">gene</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></p>
      <p>Suppose MetaQuad detected n shared variants from a gene or a genomic region. For each shared informative variant, the AF could be calculated as the alternate allele (AD) divided by DP. The nucleotide diversity was further normalized by the length of genes (<italic toggle="yes">L</italic><sub>gene</sub>). The range of nucleotide diversity was between 0 and 1, where the larger value indicated more variant accumulations.</p>
    </sec>
    <sec>
      <title>2.8 Statistical methods</title>
      <p>The OPTICS algorithm was implemented using the Python scikit-learn library (Pedregosa <italic toggle="yes">et al.</italic> 2011). Principal component analysis was performed using the prcomp function in R (version 4.0.2) and plotted using the ggbiplot function (<ext-link xlink:href="https://github.com/vqv/ggbiplot" ext-link-type="uri">https://github.com/vqv/ggbiplot</ext-link>). Multilevel pairwise comparison was performed using the pairwise.adonis function from the “pairwiseAdonis” (<xref rid="vbae030-B18" ref-type="bibr">Martinez Arbizu 2020)</xref> package. The distance matrix was calculated using Bray–Curtis dissimilarity, and the <italic toggle="yes">P</italic>-values were adjusted using the Bonferroni method.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Consistency of shared informative variants within each individual or group</title>
      <p>MetaQuad was initially tested on the BIO-ML dataset, which consisted of 30 samples from 3 individuals. Since the samples were collected from healthy people, the commonalities between samples from different individuals should be much smaller than those from the same individual. When analyzed with cellsnp, 67 241 variants were detected, with a minMAF of 0.02. Out of all the variants, 64 682 had at least two clusters with a minimum sample size of 3, while the remaining variants could only be classified into a single cluster.</p>
      <p>For MetaQuad, variants with a minimum of two clusters are considered informative. Our analysis demonstrated that the shared informative variants were highly consistent within each individual, but not across different individuals (<xref rid="vbae030-F2" ref-type="fig">Fig. 2a and b</xref>). Variants with only one cluster were considered likely to be noise because they were not consistent within each person (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). These results highlight that MetaQuad can effectively identify informative variants that distinguish between individuals (<xref rid="vbae030-F2" ref-type="fig">Fig. 2c</xref>).</p>
    </sec>
    <sec>
      <title>3.2 MetaQuad is a robust statistical method to identify shared informative variants from shotgun metagenomic data</title>
      <p>MetaQuad was initially benchmarked using simulated datasets, where paired-end reads were generated from InSilicoSeq (<xref rid="vbae030-B11" ref-type="bibr">Gourlé <italic toggle="yes">et al.</italic> 2019</xref>) (Section 2). These datasets were organized into three groups, with each group containing samples that had varying percentages of strains from the original genomes (Section 2 and <xref rid="vbae030-F2" ref-type="fig">Fig. 2d</xref>). The allele frequencies of the simulated shared informative variants were highly consistent within each group, making the simulation more reflective of real-world scenarios. To thoroughly assess MetaQuad’s performance, multiple datasets were generated with different mean depths for the informative variants. The mean depths ranged from 3 to 35.5, and the specific details for each dataset can be found in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>.</p>
      <p>To further validate the performance of MetaQuad, we compared it with several variant calling tools (details are provided in Section 2). We evaluated the performance of these tools using <italic toggle="yes">F</italic>1 scores, true positive rates, and false positives. While MetaQuad was developed to detect informative variants in a group of samples, other tools have their own applicable scenarios. To ensure a more representative comparison of the performance of different tools, we applied filters to the data. For the other tools, we considered only minor variants that appeared multiple times as informative variants, as a counterpart to MetaQuad’s minimum number of samples in the clustering. Additionally, only SNPs were considered in the comparison, and indels were removed during the filtering process. The comparative performance is shown in <xref rid="vbae030-F3" ref-type="fig">Fig. 3</xref>.</p>
      <fig position="float" id="vbae030-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Comparison of variant calling tools. (a) <italic toggle="yes">F</italic>1 score and true positive rate of all variant calling tools, with a minimum sample threshold (min_sample) of 2. (b) False positive variants reported by all tools, with a minimum sample threshold (min_sample) of 2. (c) <italic toggle="yes">F</italic>1 score and true positive rate of all variant calling tools, with a minimum sample threshold (min_sample) of 5. (d) False positive variants reported by all tools, with a minimum sample threshold (min_sample) of 5.</p>
        </caption>
        <graphic xlink:href="vbae030f3" position="float"/>
      </fig>
      <p>The combined performance of MetaQuad outperformed all the other competitors, especially with higher min-samples. All tools performed better with higher mean depths, with nearly 1 <italic toggle="yes">F</italic>1 scores and almost 100% true positive rates (<xref rid="vbae030-F3" ref-type="fig">Fig. 3a and c</xref>). In contrast, Varscan2 and MetaSNV could achieve high true positive rates in the case of high mean depth, but at the same time, false positive rates were also significantly increased (<xref rid="vbae030-F3" ref-type="fig">Fig. 3b and d</xref>). Bcftools and GATK performed well even with low mean depths, but they reported some sequencing errors, and they may miss some informative variants with higher min-samples and low mean depths.</p>
      <p>Although MetaQuad may have some false positives in low mean depths, it achieved high true positive rates. However, all the false positive variants can be filtered out if we apply a filter of mean AD and DP of the data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>). In this case, MetaQuad was better than all the other tools. If many sequencing errors and misalignments are anticipated in the study, MetaQuad will be the ideal method to apply.</p>
      <p>In addition to the previous simulation involving a relatively small sample size (<italic toggle="yes">n</italic> = 100), we extended our testing of MetaQuad to a much larger sample size (<italic toggle="yes">n</italic> = 1000). We utilized the same dataset as in the previous simulation, maintaining a mean depth of 11.8, but increased the sample size for each group by 10-fold. Notably, MetaQuad successfully identified 7598/7638 true positive mutations without producing any false positive results, using a minsample threshold of 50 (5% of the total sample size). This robust performance further affirms the applicability of MetaQuad to large-scale datasets.</p>
    </sec>
    <sec>
      <title>3.3 MetaQuad discovers antibiotic-associated variants in human gut microbiome</title>
      <p>MetaQuad was subsequently applied to an ARG dataset after undergoing pre-processing (Section 2 and <xref rid="vbae030-F4" ref-type="fig">Fig. 4a</xref>) (<xref rid="vbae030-B25" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> 2023</xref>). The samples were divided into three groups based on their clinical treatment: CLA, LEVO, and OTHERS. These samples were obtained from individuals who underwent various antibiotic treatment regimens. Detailed clinical information can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref> (ARG_treatment_infor_modified.xlsx). The minSample parameter of MetaQuad was set to 6, representing 5% of the total sample size. To minimize false positive variants, any variants with a mean AD &lt;0.1 and DP &lt;0.5 were removed.</p>
      <fig position="float" id="vbae030-F4">
        <label>Figure 4.</label>
        <caption>
          <p>The impact of antibiotics on the human gut microbiome through antibiotic-associated variants. (a) The pipeline used for detecting shared informative variants in the ARG dataset. (b) Average mean depths of each ARG. (c) The time usage of all variant calling tools in the ARG dataset, presented in log 10 transformation. MetaQuad2: total runtime of MetaQuad and cellsnp. (d) PCoA plot of shared informative variant 6 weeks after antibiotic treatment.</p>
        </caption>
        <graphic xlink:href="vbae030f4" position="float"/>
      </fig>
      <p>To investigate the impact of antibiotic treatment, we focused solely on ARGs. The mean depths of the ARGs were calculated by samtools coverage and were averaged by the total 121 samples (<xref rid="vbae030-F4" ref-type="fig">Fig. 4b</xref>). Most ARGs had a mean depth lower than 3. The MetaQuad pipeline demonstrated high efficiency, striking a balance between predictive performance and runtime costs. MetaQuad accurately identified 7591 informative variants from the ARG dataset, showcasing its exceptional efficiency. Notably, it achieved this feat in a mere 60 min, swiftly detecting informative variants from the ARG bam files (<xref rid="vbae030-F4" ref-type="fig">Fig. 4c</xref>). While vanscan2 emerged as the fastest tool, cellsnp+MetaQuad took slightly longer, with the remaining tools requiring significantly more time to complete the computation. In fact, MetaQuad outperformed vanscan2 in terms of accuracy in our simulated dataset benchmark, further highlighting its superiority.</p>
      <p>We analyzed samples from various groups taken at different times, focusing on the allele frequencies of shared informative variants. To analyze the relationship between antibiotic treatment and the allele frequencies of these variants, we used principal coordinate analysis (PCoA) and multilevel pairwise comparison (<xref rid="vbae030-F4" ref-type="fig">Fig. 4d</xref>). Prior to the analysis, we filtered out variants with NA values and calculated the allele frequencies based on the output of cellsnp-lite (AD/DP). Across all groups, we identified a total of 125, 25, and 40 shared informative variants in the samples before treatment, 6 weeks after treatment (T + 6 W), and 6 months after treatment (T + 6M), respectively. All subsequent analyses were based on these variants. Interestingly, at T + 6 W, the informative variants clearly differentiated the CLA samples and LEVO samples from the others (<xref rid="vbae030-F4" ref-type="fig">Fig. 4d</xref>). However, this performance was not observed in the samples from the other two time points (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3</xref>). Multilevel pairwise comparison revealed that the adjusted <italic toggle="yes">P</italic>-values of LEVO versus OTHER and CLA versus OTHER were significant at T + 6 W, with values of 0.03 and 0.003, respectively. However, none of these comparisons were significant at the other time points. These results may be attributed to natural selection, as the variants emerged following antibiotic treatment.</p>
    </sec>
    <sec>
      <title>3.4 Shift in nucleotide diversity of antibiotic-resistant genes</title>
      <p>We also examined the nucleotide diversity of antibiotic-resistant genes, which typically reflects the accumulation of variants. Informative variants were identified in 529 ARGs, and we filtered out genes with low nucleotide diversity, leaving 15 samples with a nucleotide diversity &gt;0.005. We then focused on the remaining 13 genes to investigate changes in nucleotide diversity before and after antibiotic treatment using the Wilcoxon test. In patients treated with LEVO, the nucleotide diversity of seven genes showed significant differences (<italic toggle="yes">P</italic> &lt; .05) between the 00 and 01 groups (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4</xref>). The changes in nucleotide diversity were consistent across all seven genes, with Group 01 showing significantly higher nucleotide diversity than Group 00. Additionally, we observed a relatively reduced nucleotide diversity in Group 02 when compared to Group 01. These findings may help explain how bacteria adapt to antibiotic drugs, where resistance arises due to the accumulation of variants in specific resistance-determining regions (<xref rid="vbae030-B20" ref-type="bibr">Moon <italic toggle="yes">et al.</italic> 2010</xref>). Variants accumulate under antibiotic pressure, but gradually return to pre-perturbation steady states. The new microbial genomic variants detected under antibiotic exposure are only temporary and disappear once the antibiotic pressure is removed.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>Detecting variants in shotgun metagenomic data has long been a challenging task due to the presence of common background noise. In this study, we propose and demonstrate the effectiveness of a novel analysis pipeline called MetaQuad for discovering shared informative variants utilizing shotgun metagenomic sequence samples processed by cellsnp-lite.</p>
    <p>One of the key strengths of MetaQuad is its unique selection approach in evaluating informative variants, which is more accurate than simply considering the number of samples in which variants were detected. This is particularly important because sequencing depth can vary across samples, making it difficult to consistently detect variants. MetaQuad overcomes this limitation by successfully detecting shared informative variants even with low coverage data.</p>
    <p>To evaluate the performance of MetaQuad, we compared it against other common variant calling tools. The results showed that MetaQuad outperformed all these tools, especially for true positive variants with low mean depths. MetaQuad stands out from other tools with its relatively high performance and fast speed. In contrast, the other tools either perform poorly or require too much time to achieve comparable results. This makes MetaQuad a promising tool for various applications in the field.</p>
    <p>However, there are some limitations to the MetaQuad pipeline that should be considered. Firstly, it is an alignment-based method, meaning the selection of the reference database can significantly affect the results. Furthermore, the alignment process can be time-consuming and require a substantial amount of RAM space. Another limitation is its dependency on cellsnp-lite and the need to specify genomes or species in the usage of cellsnp. This requirement may make it less convenient to use compared to other tools that do not have such dependencies.</p>
    <p>Nevertheless, MetaQuad remains particularly relevant as researchers are increasingly focusing on strain-level differences from high-depth sequencing, making dealing with a large amount of noise inevitable. MetaQuad provides a new way to filter out useless variants and sequencing errors, thus uncovering the untapped potential of information on bacterial variants from sequencing data. Overall, MetaQuad opens up a new paradigm of analysis pipeline for shared informative variant detection in a population of shotgun metagenomic sequencing files. Its ability to detect variants even with low coverage data makes it a valuable tool for researchers working in the field of metagenomics.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>vbae030_Supplementary_Data</label>
      <media xlink:href="vbae030_supplementary_data.docx"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank Xianjie Huang for optimizing cellsnp-lite on bulk DNA-seq data, and Aaron Wing Cheung Kwok for constructive comments on adapting MQuad to MetaQuad.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>Sheng Xu (Conceptualization [equal], Data curation [lead], Formal analysis [lead], Investigation [lead], Methodology [lead], Project administration [equal], Software [lead], Writing—original draft [lead], Writing—review &amp; editing [lead]), Daniel Morgan (Methodology [supporting], Supervision [supporting]), Gordon Qian (Conceptualization [supporting], Investigation [supporting], Methodology [supporting], Writing—review &amp; editing [supporting]), Yuanhua Huang (Methodology [equal], Supervision [equal], Writing—review &amp; editing [equal]), and Joshua W.K. Ho (Conceptualization [lead], Formal analysis [supporting], Funding acquisition [lead], Investigation [lead], Methodology [equal], Project administration [lead], Resources [lead], Supervision [lead], Writing—original draft [equal], Writing—review &amp; editing [lead])</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics Advances</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported in part by AIR@InnoHK administered by Innovation and Technology Commission of Hong Kong.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data and code availability</title>
    <p>All the code for MetaQuad can be found at <ext-link xlink:href="https://github.com/holab-hku/MetaQuad" ext-link-type="uri">https://github.com/holab-hku/MetaQuad</ext-link>.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="vbae030-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Alcock</surname><given-names>BP, Raphenya AR, Lau TTY</given-names></string-name></person-group><etal>et al</etal><article-title>CARD 2020: antibiotic resistome surveillance with the comprehensive antibiotic resistance database</article-title>. <source>Nucleic Acids Res</source><year>2019</year>;<volume>48</volume>:<fpage>D517</fpage>–<lpage>25</lpage>.</mixed-citation>
    </ref>
    <ref id="vbae030-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ankerst</surname><given-names>M</given-names></string-name>, <string-name><surname>Breunig</surname><given-names>MM</given-names></string-name>, <string-name><surname>Kriegel</surname><given-names>H-P</given-names></string-name></person-group><etal>et al</etal><article-title>OPTICS: ordering points to identify the clustering structure</article-title>. <source>SIGMOD Rec</source><year>1999</year>;<volume>28</volume>:<fpage>49</fpage>–<lpage>60</lpage>.</mixed-citation>
    </ref>
    <ref id="vbae030-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bi</surname><given-names>D</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Gao</surname><given-names>Y</given-names></string-name></person-group><etal>et al</etal><article-title>Profiling Fusobacterium infection at high taxonomic resolution reveals lineage-specific correlations in colorectal cancer</article-title>. <source>Nat Commun</source><year>2022</year>;<volume>13</volume>:<fpage>3336</fpage>.<pub-id pub-id-type="pmid">35680952</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Buchfink</surname><given-names>B</given-names></string-name>, <string-name><surname>Reuter</surname><given-names>K</given-names></string-name>, <string-name><surname>Drost</surname><given-names>H-G</given-names></string-name></person-group><etal>et al</etal><article-title>Sensitive protein alignments at tree-of-life scale using DIAMOND</article-title>. <source>Nat Methods</source><year>2021</year>;<volume>18</volume>:<fpage>366</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">33828273</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B5">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Bushnell</surname><given-names>B.</given-names></string-name></person-group><source>BBMap: A Fast, Accurate, Splice-Aware Aligner</source>. <year>2014</year>. <ext-link xlink:href="https://www.osti.gov/servlets/purl/1241166" ext-link-type="uri">https://www.osti.gov/servlets/purl/1241166</ext-link></mixed-citation>
    </ref>
    <ref id="vbae030-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cantu</surname><given-names>VA, Sadural J, Edwards R.</given-names></string-name></person-group><article-title>PRINSEQ++, a multi-threaded tool for fast and efficient quality control and preprocessing of sequencing datasets</article-title>. <source>PeerJ Preprints</source><year>2019</year>;<volume>7</volume>:<fpage>e27553v1</fpage>.</mixed-citation>
    </ref>
    <ref id="vbae030-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Costea</surname><given-names>PI</given-names></string-name>, <string-name><surname>Munch</surname><given-names>R</given-names></string-name>, <string-name><surname>Coelho</surname><given-names>LP</given-names></string-name></person-group><etal>et al</etal><article-title>metaSNV: a tool for metagenomic strain level analysis</article-title>. <source>PLoS One</source><year>2017</year>;<volume>12</volume>:<fpage>e0182392</fpage>.<pub-id pub-id-type="pmid">28753663</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Danecek</surname><given-names>P</given-names></string-name>, <string-name><surname>Bonfield</surname><given-names>JK</given-names></string-name>, <string-name><surname>Liddle</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Twelve years of SAMtools and BCFtools</article-title>. <source>Gigascience</source><year>2021</year>;<volume>10</volume>:<fpage>giab008</fpage>.<pub-id pub-id-type="pmid">33590861</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Day-Williams</surname><given-names>AG</given-names></string-name>, <string-name><surname>Zeggini</surname><given-names>E.</given-names></string-name></person-group><article-title>The effect of next-generation sequencing technology on complex trait research</article-title>. <source>Eur J Clin Invest</source><year>2011</year>;<volume>41</volume>:<fpage>561</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">21155765</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Durazzi</surname><given-names>F</given-names></string-name>, <string-name><surname>Sala</surname><given-names>C</given-names></string-name>, <string-name><surname>Castellani</surname><given-names>G</given-names></string-name></person-group><etal>et al</etal><article-title>Comparison between 16S rRNA and shotgun sequencing data for the taxonomic characterization of the gut microbiota</article-title>. <source>Sci Rep</source><year>2021</year>;<volume>11</volume>:<fpage>3030</fpage>.<pub-id pub-id-type="pmid">33542369</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gourlé</surname><given-names>H</given-names></string-name>, <string-name><surname>Karlsson-Lindsjö</surname><given-names>O</given-names></string-name>, <string-name><surname>Hayer</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Simulating Illumina metagenomic data with InSilicoSeq</article-title>. <source>Bioinformatics</source><year>2019</year>;<volume>35</volume>:<fpage>521</fpage>–<lpage>2</lpage>.<pub-id pub-id-type="pmid">30016412</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huang</surname><given-names>X</given-names></string-name>, <string-name><surname>Huang</surname><given-names>Y.</given-names></string-name></person-group><article-title>Cellsnp-lite: an efficient tool for genotyping single cells</article-title>. <source>Bioinformatics</source><year>2021</year>;<volume>37</volume>:<fpage>4569</fpage>–<lpage>71</lpage>.<pub-id pub-id-type="pmid">33963851</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Koboldt</surname><given-names>DC</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>Q</given-names></string-name>, <string-name><surname>Larson</surname><given-names>DE</given-names></string-name></person-group><etal>et al</etal><article-title>VarScan 2: somatic mutation and copy number alteration discovery in cancer by exome sequencing</article-title>. <source>Genome Res</source><year>2012</year>;<volume>22</volume>:<fpage>568</fpage>–<lpage>76</lpage>.<pub-id pub-id-type="pmid">22300766</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Koo</surname><given-names>H</given-names></string-name>, <string-name><surname>Hakim</surname><given-names>JA</given-names></string-name>, <string-name><surname>Crossman</surname><given-names>DK</given-names></string-name></person-group><etal>et al</etal><article-title>Individualized recovery of gut microbial strains post antibiotics</article-title>. <source>NPJ Biofilms Microbiomes</source><year>2019</year>;<volume>5</volume>:<fpage>30</fpage>.<pub-id pub-id-type="pmid">31632686</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B15">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>H.</given-names></string-name></person-group><italic toggle="yes">Aligning Sequence Reads, Clone Sequences and Assembly Contigs with BWA-MEM</italic>. arXiv:1303.3997v2 <year>2013</year>.</mixed-citation>
    </ref>
    <ref id="vbae030-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Jia</surname><given-names>H</given-names></string-name>, <string-name><surname>Cai</surname><given-names>X</given-names></string-name></person-group><etal>et al</etal>; <collab>MetaHIT Consortium</collab>. <article-title>An integrated catalog of reference genes in the human gut microbiome</article-title>. <source>Nat Biotechnol</source><year>2014</year>;<volume>32</volume>:<fpage>834</fpage>–<lpage>41</lpage>.<pub-id pub-id-type="pmid">24997786</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ma</surname><given-names>X</given-names></string-name>, <string-name><surname>Shao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Tian</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>Analysis of error profiles in deep next-generation sequencing data</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>50</fpage>.<pub-id pub-id-type="pmid">30867008</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B18">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Martinez Arbizu</surname><given-names>P.</given-names></string-name></person-group><italic toggle="yes">pairwiseAdonis: Pairwise Multilevel Comparison Using Adonis</italic>. <year>2020</year>. <ext-link xlink:href="https://github.com/pmartinezarbizu/pairwiseAdonis" ext-link-type="uri">https://github.com/pmartinezarbizu/pairwiseAdonis</ext-link></mixed-citation>
    </ref>
    <ref id="vbae030-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marx</surname><given-names>V.</given-names></string-name></person-group><article-title>Microbiology: the road to strain-level identification</article-title>. <source>Nat Methods</source><year>2016</year>;<volume>13</volume>:<fpage>401</fpage>–<lpage>4</lpage>.<pub-id pub-id-type="pmid">27123815</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moon</surname><given-names>DC</given-names></string-name>, <string-name><surname>Seol</surname><given-names>SY</given-names></string-name>, <string-name><surname>Gurung</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Emergence of a new mutation and its accumulation in the topoisomerase IV gene confers high levels of resistance to fluoroquinolones in <italic toggle="yes">Escherichia coli</italic> isolates</article-title>. <source>Int J Antimicrob Agents</source><year>2010</year>;<volume>35</volume>:<fpage>76</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">19781915</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Olm</surname><given-names>MR</given-names></string-name>, <string-name><surname>Crits-Christoph</surname><given-names>A</given-names></string-name>, <string-name><surname>Bouma-Gregson</surname><given-names>K</given-names></string-name></person-group><etal>et al</etal><article-title>inStrain profiles population microdiversity from metagenomic data and sensitively detects shared microbial strains</article-title>. <source>Nat Biotechnol</source><year>2021</year>;<volume>39</volume>:<fpage>727</fpage>–<lpage>36</lpage>.<pub-id pub-id-type="pmid">33462508</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B22">
      <mixed-citation publication-type="journal"><collab>Pedregosa F, Varoquaux G, Gramfort A</collab><etal>et al</etal><article-title>Scikit-learn: Machine Learning in Python</article-title>. <source>J Mach Learn Res</source><year>2011</year>;<volume>12</volume>:<fpage>2825</fpage>–<lpage>30</lpage>.</mixed-citation>
    </ref>
    <ref id="vbae030-B23">
      <mixed-citation publication-type="other">Poplin R, Ruano-Rubio V, DePristo MA <etal>et al</etal> Scaling accurate genetic variant discovery to tens of thousands of samples. bioRxiv; 2017.</mixed-citation>
    </ref>
    <ref id="vbae030-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Poyet</surname><given-names>M</given-names></string-name>, <string-name><surname>Groussin</surname><given-names>M</given-names></string-name>, <string-name><surname>Gibbons</surname><given-names>SM</given-names></string-name></person-group><etal>et al</etal><article-title>A library of human gut bacterial isolates paired with longitudinal multiomics data enables mechanistic microbiome research</article-title>. <source>Nat Med</source><year>2019</year>;<volume>25</volume>:<fpage>1442</fpage>–<lpage>52</lpage>.<pub-id pub-id-type="pmid">31477907</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>L</given-names></string-name>, <string-name><surname>Yao</surname><given-names>H</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>DC</given-names></string-name></person-group><etal>et al</etal><article-title>Altered human gut virome in patients undergoing antibiotics therapy for <italic toggle="yes">Helicobacter pylori</italic></article-title>. <source>Nat Commun</source><year>2023</year>;<volume>14</volume>:<fpage>2196</fpage>.<pub-id pub-id-type="pmid">37069161</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>L</given-names></string-name>, <string-name><surname>Yao</surname><given-names>H</given-names></string-name>, <string-name><surname>Tong</surname><given-names>T</given-names></string-name></person-group><etal>et al</etal><article-title>Dynamic changes in antibiotic resistance genes and gut microbiota after <italic toggle="yes">Helicobacter pylori</italic> eradication therapies</article-title>. <source>Helicobacter</source><year>2022</year>;<volume>27</volume>:<fpage>e12871</fpage>.<pub-id pub-id-type="pmid">34969161</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wiberg</surname><given-names>RAW</given-names></string-name>, <string-name><surname>Gaggiotti</surname><given-names>OE</given-names></string-name>, <string-name><surname>Morrissey</surname><given-names>MB</given-names></string-name></person-group><etal>et al</etal><article-title>Identifying consistent allele frequency differences in studies of stratified populations</article-title>. <source>Methods Ecol Evol</source><year>2017</year>;<volume>8</volume>:<fpage>1899</fpage>–<lpage>909</lpage>.<pub-id pub-id-type="pmid">29263778</pub-id></mixed-citation>
    </ref>
    <ref id="vbae030-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Nguyen</surname><given-names>LH</given-names></string-name>, <string-name><surname>Franzosa</surname><given-names>EA</given-names></string-name></person-group><etal>et al</etal><article-title>Strain-level epidemiology of microbial communities and the human microbiome</article-title>. <source>Genome Med</source><year>2020</year>;<volume>12</volume>:<fpage>71</fpage>.<pub-id pub-id-type="pmid">32791981</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
