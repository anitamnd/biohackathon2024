<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName nlm2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Front Physiol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Front Physiol</journal-id>
    <journal-id journal-id-type="publisher-id">Front. Physiol.</journal-id>
    <journal-title-group>
      <journal-title>Frontiers in Physiology</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1664-042X</issn>
    <publisher>
      <publisher-name>Frontiers Media S.A.</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9037749</article-id>
    <article-id pub-id-type="publisher-id">850951</article-id>
    <article-id pub-id-type="doi">10.3389/fphys.2022.850951</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Physiology</subject>
        <subj-group>
          <subject>Original Research</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Generalizable Beat-by-Beat Arrhythmia Detection by Using Weakly Supervised Deep Learning</article-title>
      <alt-title alt-title-type="left-running-head">Liu et al.</alt-title>
      <alt-title alt-title-type="right-running-head">Generalizable Arrhythmia Detection</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Yang</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/1497538/overview"/>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Li</surname>
          <given-names>Qince</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
        <xref rid="c001" ref-type="corresp">*</xref>
        <uri xlink:href="https://loop.frontiersin.org/people/1205064/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>He</surname>
          <given-names>Runnan</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/503767/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Kuanquan</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/643170/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Jun</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/1483810/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yuan</surname>
          <given-names>Yongfeng</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Xia</surname>
          <given-names>Yong</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Zhang</surname>
          <given-names>Henggui</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
        <xref rid="aff3" ref-type="aff">
          <sup>3</sup>
        </xref>
        <xref rid="aff4" ref-type="aff">
          <sup>4</sup>
        </xref>
        <xref rid="c001" ref-type="corresp">*</xref>
        <uri xlink:href="https://loop.frontiersin.org/people/27383/overview"/>
      </contrib>
    </contrib-group>
    <aff id="aff1"><sup>1</sup><institution>School of Computer Science and Technology</institution>, <institution>Harbin Institute of Technology (HIT)</institution>, <addr-line>Harbin</addr-line>, <country>China</country></aff>
    <aff id="aff2"><sup>2</sup><institution>Peng Cheng Laboratory</institution>, <addr-line>Shenzhen</addr-line>, <country>China</country></aff>
    <aff id="aff3"><sup>3</sup><institution>School of Physics and Astronomy</institution>, <institution>The University of Manchester</institution>, <addr-line>Manchester</addr-line>, <country>United Kingdom</country></aff>
    <aff id="aff4"><sup>4</sup><institution>Key Laboratory of Medical Electrophysiology of Ministry of Education and Medical Electrophysiological Key Laboratory of Sichuan Province</institution>, <institution>Institute of Cardiovascular Research</institution>, <institution>Southwest Medical University</institution>, <addr-line>Luzhou</addr-line>, <country>China</country></aff>
    <author-notes>
      <fn fn-type="edited-by">
        <p><bold>Edited by:</bold><ext-link xlink:href="https://loop.frontiersin.org/people/436378/overview" ext-link-type="uri">Xin Li</ext-link>, University of Leicester, United Kingdom</p>
      </fn>
      <fn fn-type="edited-by">
        <p><bold>Reviewed by:</bold><ext-link xlink:href="https://loop.frontiersin.org/people/1100004/overview" ext-link-type="uri">Mingfeng Jiang</ext-link>, Zhejiang Sci-Tech University, China</p>
        <p><ext-link xlink:href="https://loop.frontiersin.org/people/1432510/overview" ext-link-type="uri">Mehmet Akif Ozdemir</ext-link>, Izmir Kâtip Çelebi University, Turkey</p>
      </fn>
      <corresp id="c001">*Correspondence: Qince Li, <email>qinceli@hit.edu.cn</email>; Henggui Zhang, <email>henggui.zhang@manchester.ac.uk</email>
</corresp>
      <fn fn-type="other">
        <p>This article was submitted to Cardiac Electrophysiology, a section of the journal Frontiers in Physiology</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>22</day>
      <month>3</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <volume>13</volume>
    <elocation-id>850951</elocation-id>
    <history>
      <date date-type="received">
        <day>08</day>
        <month>1</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>07</day>
        <month>3</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2022 Liu, Li, He, Wang, Liu, Yuan, Xia and Zhang.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>Liu, Li, He, Wang, Liu, Yuan, Xia and Zhang</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License (CC BY). The use, distribution or reproduction in other forums is permitted, provided the original author(s) and the copyright owner(s) are credited and that the original publication in this journal is cited, in accordance with accepted academic practice. No use, distribution or reproduction is permitted which does not comply with these terms.</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Beat-by-beat arrhythmia detection in ambulatory electrocardiogram (ECG) monitoring is critical for the evaluation and prognosis of cardiac arrhythmias, however, it is a highly professional demanding and time-consuming task. Current methods for automatic beat-by-beat arrhythmia detection suffer from poor generalization ability due to the lack of large-sample and finely-annotated (labels are given to each beat) ECG data for model training. In this work, we propose a weakly supervised deep learning framework for arrhythmia detection (WSDL-AD), which permits training a fine-grained (beat-by-beat) arrhythmia detector with the use of large amounts of coarsely annotated ECG data (labels are given to each recording) to improve the generalization ability. In this framework, heartbeat classification and recording classification are integrated into a deep neural network for end-to-end training with only recording labels. Several techniques, including knowledge-based features, masked aggregation, and supervised pre-training, are proposed to improve the accuracy and stability of the heartbeat classification under weak supervision. The developed WSDL-AD model is trained for the detection of ventricular ectopic beats (VEB) and supraventricular ectopic beats (SVEB) on five large-sample and coarsely-annotated datasets and the model performance is evaluated on three independent benchmarks according to the recommendations from the Association for the Advancement of Medical Instrumentation (AAMI). The experimental results show that our method improves the <italic>F</italic>
<sub>1</sub> score of supraventricular ectopic beats detection by 8%–290% and the F1 of ventricular ectopic beats detection by 4%–11% on the benchmarks compared with the state-of-the-art methods of supervised learning. It demonstrates that the WSDL-AD framework can leverage the abundant coarsely-labeled data to achieve a better generalization ability than previous methods while retaining fine detection granularity. Therefore, this framework has a great potential to be used in clinical and telehealth applications. The source code is available at <ext-link xlink:href="https://github.com/sdnjly/WSDL-AD" ext-link-type="uri">https://github.com/sdnjly/WSDL-AD</ext-link>.</p>
    </abstract>
    <kwd-group>
      <kwd>cardiac arrhythmia</kwd>
      <kwd>electrocardiogram</kwd>
      <kwd>heartbeat classification</kwd>
      <kwd>weakly supervised learning</kwd>
      <kwd>generalization ability</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source id="cn001">
          <institution-wrap>
            <institution>National Natural Science Foundation of China
</institution>
            <institution-id institution-id-type="doi">10.13039/501100001809</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source id="cn002">
          <institution-wrap>
            <institution>Natural Science Foundation of Shandong Province
</institution>
            <institution-id institution-id-type="doi">10.13039/501100007129</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
  </article-meta>
</front>
<body>
  <sec id="s1">
    <title>1 Introduction</title>
    <p>Cardiac arrhythmia has become one of the leading causes of morbidity and mortality worldwide (<xref rid="B44" ref-type="bibr">Roger et al., 2012</xref>). Ambulatory electrocardiogram (ECG) monitoring with prolonged duration (several days or weeks) provides critical information for early detection and treatment of arrhythmias, especially for transient and asymptomatic arrhythmias (<xref rid="B46" ref-type="bibr">Sana et al., 2020</xref>). The ambulatory ECG devices have been sufficiently miniaturized, wearable and connected to high-speed mobile networks with the promise to give patients high-quality yet affordable health monitoring services at home. To enable the adoption of remote ECG monitoring services in the general population, reliable automatic ECG analysis and diagnosis technology is necessary as analyzing the vast amount of monitoring data is far beyond the capability of human physicians. Although the technologies for automatic ECG analysis have been developed for decades, current technologies cannot replace human physicians for diagnosis because they have limited generalization ability to cope with the diverse artifacts and inter-patient variations in the ECG signals (<xref rid="B37" ref-type="bibr">Alday et al., 2020</xref>; <xref rid="B48" ref-type="bibr">Siontis et al., 2021</xref>). Therefore, novel technologies for generalizable detection of arrhythmias are in urgent demand.</p>
    <p>Beat-by-beat arrhythmia detection, determining the rhythm type of each heartbeat in an ECG recording, is essential for the analysis of ambulatory ECG. According to the ANSI/AAMI EC57:2012 standard (<xref rid="B1" ref-type="bibr">AAMI, 2012</xref>), a beat-by-beat arrhythmia detection software should discriminate five types of heartbeats: ventricular ectopic beat (VEB or V), supraventricular ectopic beat (SVEB or S), ventricular fusion beat (F), ambiguous beat (Q), and beat of all other types (N). In particular, the detection performances of SVEB and VEB are of major interest to health care practitioners and constitute the evaluation metrics for the detectors as recommended by the ANSI/AAMI standard. An accurate beat-by-beat arrhythmia detector has several important implications for clinical practices. The detected beat-wise rhythm types manifest the occurrence time of each arrhythmia episode which is necessary evidence to correlate the detected arrhythmias with the symptoms recorded by the patients. Besides, the detected types of each heartbeat in the recording can be used to measure the burdens (i.e., the proportions in all heartbeats) of VEB and SVEB which are important indicators in evaluating cardiac function (<xref rid="B2" ref-type="bibr">Baman et al., 2010</xref>), assessing the effectiveness of treatments (<xref rid="B9" ref-type="bibr">Deyell et al., 2012</xref>), and predicting the risk of malignant diseases, such as stroke, heart failure and sudden death (<xref rid="B3" ref-type="bibr">Binici, 2010</xref>; <xref rid="B31" ref-type="bibr">Marcus, 2020</xref>). Furthermore, the fine-grained beat-wise rhythm types can be further used to identify some complex patterns of arrhythmias, such as ventricular/supraventricular tachycardia, bigeminy, and trigeminy.</p>
    <p>The state-of-the-art methods for beat-by-beat arrhythmia detection are generally based on machine learning (ML), a methodology to guide the models to learn detection rules from a training dataset. Typically, the ECG signal is segmented into individual heartbeats, each of which is then fed into a classifier to determine its rhythm type, as shown in <xref rid="F1" ref-type="fig">Figure 1A</xref>. The classifier is usually trained in a supervised learning methodology, where each training beat is annotated with a corresponding rhythm type. According to the split of training and test sets, the classifiers can be further categorized into two types: intra-patient classifier, of which the training and test data are from the same group of patients (<xref rid="B21" ref-type="bibr">Kiranyaz et al., 2016</xref>; <xref rid="B26" ref-type="bibr">Li et al., 2018</xref>; <xref rid="B8" ref-type="bibr">Degirmenci et al., 2021</xref>), and inter-patient classifier, of which the training and test data are from non-overlapping patient populations (<xref rid="B40" ref-type="bibr">Raj and Ray, 2018</xref>; <xref rid="B15" ref-type="bibr">Guo et al., 2019</xref>; <xref rid="B34" ref-type="bibr">Niu et al., 2020</xref>). The intra-patient classifiers are suitable to develop personalized arrhythmia detectors, while the inter-patient classifiers aim to provide diagnostic models for general populations. Intra-patient classifiers usually perform much better than inter-patient classifiers because they have been fine-tuned for the target population. This in turn suggests that it is more challenging to develop models with good generalization abilities to deal with data from unseen patients. In real-world medical settings, the ECGs are obtained from large, diverse populations, which makes the classifier’s generalization ability of critical importance.</p>
    <fig position="float" id="F1">
      <label>FIGURE 1</label>
      <caption>
        <p>Comparison between different methodologies of machine learning for arrhythmia detection. <bold>(A)</bold> The supervised learning (SL) method for heartbeat/segment classification which uses fine-grained annotations for model training and achieves fine-grained predictions. <bold>(B)</bold> The SL method for ECG recording classification which uses coarse-grained labels as supervision and achieves coarse-grained predictions. <bold>(C)</bold> The weakly supervised learning (WSL) method for beat-by-beat classification which uses coarse recording labels for model training but achieves fine-grained predictions. N = normal or bundle branch block beat. SVEB = supraventricular ectopic beat. VEB = ventricular ectopic beat.</p>
      </caption>
      <graphic xlink:href="fphys-13-850951-g001" position="float"/>
    </fig>
    <p>A key reason for the poor generalization ability of current methods is that the training data come from a small population. For example, the MIT-BIH Arrhythmia Database, a dataset used by dozens of studies for classifier training, contains only 48 ECG recordings collected from 47 subjects (<xref rid="B32" ref-type="bibr">Moody and Mark, 2001</xref>). Since the training data only reflect the characteristics of a few people, it is naturally difficult for the model learner to learn the discrimination features applicable to data from general population. For example, it has been demonstrated that patients with COVID-19 exhibit obvious ECG changes, based on which an automatic diagnostic model for COVID-19 has been developed and achieved a quite high accuracy and F1 score (both ≥93.0%) (<xref rid="B35" ref-type="bibr">Ozdemir et al., 2021</xref>). These COVID-19-related ECG changes represent a new class of conditions that may not be considered by previous arrhythmia detectors and may affect the generalization ability of those detectors. Besides, the models tend to over-fit the small amount of training data and thus impair their generalization ability. The small sample sizes of the training datasets are partly because of the high cost of the beat-by-beat annotation work. In order to ensure the correctness of the labels, independent labeling by multiple experts is often required and the disputed samples should resort to an expert committee for adjudication. Another challenge of machine learning for arrhythmia detection is class imbalance, where samples of normal sinus rhythm tend to predominate in the datasets. Some strategies have been proposed to address this problem. For example, Lu <italic>et al.</italic> utilized focal loss to address the class imbalance in ECG classification (<xref rid="B29" ref-type="bibr">Lu et al., 2021</xref>).</p>
    <p>In view of the limitation of annotated training data, some researchers have explored new methods to improve the generalization ability of ECG classifiers, such as unsupervised learning and semi-supervised learning. The unsupervised learning methods have been developed to mine unlabeled ECG data for representative learning (<xref rid="B41" ref-type="bibr">Rajan and Thiagarajan, 2018</xref>), domain adaptation (<xref rid="B25" ref-type="bibr">Li et al., 2021</xref>; <xref rid="B51" ref-type="bibr">Wang et al., 2021</xref>), and data augmentation (<xref rid="B12" ref-type="bibr">Golany and Radinsky, 2019</xref>; <xref rid="B52" ref-type="bibr">Wulan et al., 2020</xref>). Some semi-supervised learning methods that use both labeled and unlabeled data for model training have also been developed to fine-tune the classifier for the target patient without the need for patient-specific labeled data (<xref rid="B53" ref-type="bibr">Zhai et al., 2020</xref>). Although these methods contribute to the improvement of generalization ability, the limited labeled data still plays a very central role in the training of these models and induce a high risk of overfitting.</p>
    <p>This study explores the possibility of another learning approach, i.e., weakly supervised learning (WSL), to improve the generalization ability of beat-by-beat arrhythmia detectors. Unlike previous methods that utilize unlabeled samples or synthesize new samples, the WSL approach tries to train a model with incomplete, inexact, or inaccurate annotations that are usually much easier to obtain (<xref rid="B57" ref-type="bibr">Zhou, 2018</xref>). In the domain of ECG classification, there are a large amount of ECG data annotated with coarse-grained labels, i.e., a recording (typically several to tens of seconds) is labeled as a whole (<xref rid="B27" ref-type="bibr">Liu et al., 2018</xref>; <xref rid="B37" ref-type="bibr">Alday et al., 2020</xref>). Since the rhythm types of individual heartbeats in these datasets are not annotated, these datasets are mainly used to train recording classifiers that determine if certain anomalies are present in an ECG recording, as shown in <xref rid="F1" ref-type="fig">Figure 1B</xref>, in previous studies. Nevertheless, the recording labels indicate the rhythm types of an unknown subset of heartbeats in the recording, which can provide a form of weak supervision for the model training. In addition, as these datasets reflect diverse signal artifacts and inter-patient variations, they may help prevent overfitting and improve the generalization ability of the heartbeat classifiers.</p>
    <p>Several issues need to be addressed for applying WSL to beat-by-beat arrhythmia detection. Firstly, what is the mapping relationship between the target labels of individual heartbeats and the labels of their recording? For this study, the recording labels in datasets such as the PhysioNet/CinC Challenge 2020 datasets clearly reflect the presence of SVEB or VEB in the recordings, which is critical to a successful application of WSL. Secondly, how to construct a beat-by-beat classifier that can be trained under the supervision of recording labels? As the true heartbeat labels are not available, a mechanism is needed to guide the optimization of the heartbeat classifier based on the true recording labels and the mapping relationships between heartbeat labels and recording labels. Finally, how to address the ill-posed problem that the constraints of recording labels can be satisfied by different hypotheses of the heartbeat rhythms? The ill-posed problem usually arises when two types of samples always occur concomitantly (<xref rid="B6" ref-type="bibr">Choe et al., 2020</xref>). For example, SVEBs and sinus beats usually occur alternately and have similar waveforms, which may confuse the classifier in discriminating these two kinds of beats since swapping their categories can also map to the same recording labels. Therefore, the ill-posed problem must be addressed to ensure the stability of the heartbeat classifier.</p>
    <p>In this study, we propose a deep-learning-based WSL framework for beat-by-beat arrhythmia detection (WSDL-AD), as shown in <xref rid="F1" ref-type="fig">Figure 1C</xref>, which can be trained with just coarse record-level labels in an end-to-end manner. In this framework, the model first makes local predictions for each heartbeat, and then maps the heartbeat predictions to the prediction of the recording labels by an aggregation mechanism. The model can be optimized by gradient descent, where the gradients of the recording predictions are back-propagated through the aggregation layer to calculate the gradients of the heartbeat predictions. Thus, the heartbeat classifier can be optimized according to the coarse recording labels. To address the ill-posed problem, we design a two-stage training strategy: a supervised pre-training stage with small amounts of heartbeat labels, and a weakly-supervised training stage with large amounts of recording labels. In addition<bold>,</bold> we introduce some techniques into the WSDL-AD framework to enhance the model performance. 1) To assist the model in utilizing contextual information, two knowledge-based features, namely relative RR interval and RR entropy, are proposed. 2) Considering the heartbeats vary in length and are unevenly distributed over time, we propose a masked aggregation mechanism that can select a representative prediction for each heartbeat for aggregation without the need to split the ECG signal into heartbeat segments.</p>
    <p>The remainder of this paper is organized as follows. In <xref rid="s2" ref-type="sec">section 2</xref>, the proposed WSDL-AD framework and the datasets for model training and evaluation are described in detail. The experimental setup and results are present in <xref rid="s3" ref-type="sec">section 3</xref>. <xref rid="s4" ref-type="sec">Section 4</xref> compares our results with that of other studies and discusses the implications and limitations of this work. Finally, we conclude this work in <xref rid="s5" ref-type="sec">section 5</xref>.</p>
  </sec>
  <sec id="s2">
    <title>2 Materials and Methods</title>
    <sec id="s2-1">
      <title>2.1 Datasets</title>
      <p>We use multiple coarsely annotated and finely-annotated datasets in this study. The coarsely-annotated datasets are from the PhysioNet/CinC challenge 2020/2021 (<xref rid="B37" ref-type="bibr">Alday et al., 2020</xref>; <xref rid="B42" ref-type="bibr">Reyna et al., 2021</xref>), including two China physiological signal challenge datasets (CPSC and CPSC-Extra) (<xref rid="B27" ref-type="bibr">Liu et al., 2018</xref>), the Physikalisch Technische Bundesanstalt extension (PTB-XL) dataset (<xref rid="B50" ref-type="bibr">Wagner et al., 2020</xref>), the Georgia 12-lead ECG challenge dataset (G12EC), and the Chapman University, Shaoxing People’s Hospital and Ningbo First Hospital database (Chapman-Shaoxing-Ningbo) (<xref rid="B55" ref-type="bibr">Zheng et al., 2020</xref>). There are a total of 87,653 12-lead ECG records in these datasets. Each record was annotated as a whole using the SNOMED CT codes (<xref rid="B10" ref-type="bibr">Donnelly, 2006</xref>). The ANSI/AAMI standard recommends five classes for the arrhythmia detector, namely VEB, SVEB, F, Q, and N (<xref rid="B1" ref-type="bibr">AAMI, 2012</xref>). In addition, as recommended by the standard, a detector is neither penalized nor rewarded for its treatment of F and Q. Therefore, in this work, we only deal with the classification of VEB, SVEB, and N. The data of F and Q are excluded from the evaluation. The mapping between the original labels and the ANSI/AAMI classes is available in <xref rid="T1" ref-type="table">Table 1</xref>. Statistics of the datasets are shown in <xref rid="T2" ref-type="table">Table 2</xref>.</p>
      <table-wrap position="float" id="T1">
        <label>TABLE 1</label>
        <caption>
          <p>The mapping between the dataset labels and the classes suggested by the ANSI/AAMI standard. The dataset labels are in the parentheses following their corresponding class names.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead valign="top">
            <tr>
              <th align="left" rowspan="1" colspan="1">ANSI/AAMI</th>
              <th align="center" rowspan="1" colspan="1">SNOMED CT codes</th>
              <th align="center" rowspan="1" colspan="1">PhysioBank labels</th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td rowspan="5" align="left" colspan="1">N</td>
              <td align="left" rowspan="1" colspan="1">All labels except that mapped to SVEB, VEB</td>
              <td align="left" rowspan="1" colspan="1">Normal beat (N)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">Left bundle branch block beat (L)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">Right bundle branch block beat (R)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">Atrial escape beat (e)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">Nodal (junctional) escape beat (j)</td>
            </tr>
            <tr>
              <td rowspan="4" align="left" colspan="1">SVEB</td>
              <td align="left" rowspan="1" colspan="1">Premature atrial contraction (284470004)</td>
              <td align="left" rowspan="1" colspan="1">Atrial premature beat (A)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Supraventricular premature beats (63593006)</td>
              <td align="left" rowspan="1" colspan="1">Aberrated atrial premature beat (a)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">Nodal (junctional) premature beat (J)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1"/>
              <td align="left" rowspan="1" colspan="1">Supraventricular premature or ectopic beat (S)</td>
            </tr>
            <tr>
              <td rowspan="3" align="left" colspan="1">VEB</td>
              <td align="left" rowspan="1" colspan="1">Premature ventricular contractions (427172004)</td>
              <td align="left" rowspan="1" colspan="1">Premature ventricular contraction (V)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Ventricular premature beats (17338001)</td>
              <td align="left" rowspan="1" colspan="1">Ventricular escape beat (E)</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Ventricular ectopic beats (164884008)</td>
              <td align="left" rowspan="1" colspan="1"/>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <table-wrap position="float" id="T2">
        <label>TABLE 2</label>
        <caption>
          <p>The compositions of the datasets.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead valign="top">
            <tr>
              <th rowspan="2" align="left" colspan="1">Datasets</th>
              <th rowspan="2" align="center" colspan="1">Recording numbers</th>
              <th rowspan="2" align="center" colspan="1">Recording lengths</th>
              <th rowspan="2" align="center" colspan="1">Sampling rate (Hz)</th>
              <th colspan="3" align="center" rowspan="1">Annotations</th>
              <th rowspan="2" align="center" colspan="1">Annotation unit</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">N</th>
              <th align="center" rowspan="1" colspan="1">VEB</th>
              <th align="center" rowspan="1" colspan="1">SVEB</th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td align="left" rowspan="1" colspan="1">CPSC</td>
              <td align="center" rowspan="1" colspan="1">6,877</td>
              <td align="center" rowspan="1" colspan="1">6–144 s</td>
              <td align="center" rowspan="1" colspan="1">500</td>
              <td align="center" rowspan="1" colspan="1">5,564</td>
              <td align="center" rowspan="1" colspan="1">700</td>
              <td align="center" rowspan="1" colspan="1">616</td>
              <td align="left" rowspan="1" colspan="1">record</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">CPSC-Extra</td>
              <td align="center" rowspan="1" colspan="1">3,453</td>
              <td align="center" rowspan="1" colspan="1">8–98 s</td>
              <td align="center" rowspan="1" colspan="1">500</td>
              <td align="center" rowspan="1" colspan="1">3,150</td>
              <td align="center" rowspan="1" colspan="1">194</td>
              <td align="center" rowspan="1" colspan="1">124</td>
              <td align="left" rowspan="1" colspan="1">record</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">PTB-XL</td>
              <td align="center" rowspan="1" colspan="1">21,837</td>
              <td align="center" rowspan="1" colspan="1">10 s</td>
              <td align="center" rowspan="1" colspan="1">500</td>
              <td align="center" rowspan="1" colspan="1">20,194</td>
              <td align="center" rowspan="1" colspan="1">1,154</td>
              <td align="center" rowspan="1" colspan="1">555</td>
              <td align="left" rowspan="1" colspan="1">record</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">G12EC</td>
              <td align="center" rowspan="1" colspan="1">10,334</td>
              <td align="center" rowspan="1" colspan="1">5–10 s</td>
              <td align="center" rowspan="1" colspan="1">500</td>
              <td align="center" rowspan="1" colspan="1">9,336</td>
              <td align="center" rowspan="1" colspan="1">395</td>
              <td align="center" rowspan="1" colspan="1">640</td>
              <td align="left" rowspan="1" colspan="1">record</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">Chapman-Shaoxing-Ningbo</td>
              <td align="center" rowspan="1" colspan="1">45,152</td>
              <td align="center" rowspan="1" colspan="1">10 s</td>
              <td align="center" rowspan="1" colspan="1">500</td>
              <td align="center" rowspan="1" colspan="1">42,536</td>
              <td align="center" rowspan="1" colspan="1">1,385</td>
              <td align="center" rowspan="1" colspan="1">1,321</td>
              <td align="left" rowspan="1" colspan="1">record</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MITBIH-AR-DS1</td>
              <td align="center" rowspan="1" colspan="1">22</td>
              <td align="center" rowspan="1" colspan="1">30 min</td>
              <td align="center" rowspan="1" colspan="1">360</td>
              <td align="center" rowspan="1" colspan="1">45,869</td>
              <td align="center" rowspan="1" colspan="1">3,789</td>
              <td align="center" rowspan="1" colspan="1">945</td>
              <td align="left" rowspan="1" colspan="1">beat</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MITBIH-AR-DS2</td>
              <td align="center" rowspan="1" colspan="1">22</td>
              <td align="center" rowspan="1" colspan="1">30 min</td>
              <td align="center" rowspan="1" colspan="1">360</td>
              <td align="center" rowspan="1" colspan="1">44,264</td>
              <td align="center" rowspan="1" colspan="1">3,221</td>
              <td align="center" rowspan="1" colspan="1">1837</td>
              <td align="left" rowspan="1" colspan="1">beat</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">MITBIH-SUP</td>
              <td align="center" rowspan="1" colspan="1">78</td>
              <td align="center" rowspan="1" colspan="1">30 min</td>
              <td align="center" rowspan="1" colspan="1">128</td>
              <td align="center" rowspan="1" colspan="1">162,368</td>
              <td align="center" rowspan="1" colspan="1">9,950</td>
              <td align="center" rowspan="1" colspan="1">12,207</td>
              <td align="left" rowspan="1" colspan="1">beat</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">INCART</td>
              <td align="center" rowspan="1" colspan="1">75</td>
              <td align="center" rowspan="1" colspan="1">30 min</td>
              <td align="center" rowspan="1" colspan="1">257</td>
              <td align="center" rowspan="1" colspan="1">153,673</td>
              <td align="center" rowspan="1" colspan="1">20,012</td>
              <td align="center" rowspan="1" colspan="1">1960</td>
              <td align="left" rowspan="1" colspan="1">beat</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p>CPSC, the China physiological signal challenge; PTB-XL, the Physikalisch Technische Bundesanstalt extension dataset; G12EC, the Georgia 12-lead ECG challenge dataset; MITBIH-AR-DS1, the DS1 of MIT-BIH arrhythmia database; MITBIH-AR-DS2, the DS2 of MIT-BIH arrhythmia database; MITBIH-SUP, the MIT-BIH supraventricular arrhythmia database; INCART, the St. Petersburg INCART arrhythmia database; N, normal or bundle branch block beat; SVEB, supraventricular ectopic beat; VEB, ventricular ectopic beat.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>The finely annotated datasets used in this study include the MIT-BIH arrhythmia database (MITBIH-AR) (<xref rid="B32" ref-type="bibr">Moody and Mark, 2001</xref>), the MIT-BIH supraventricular arrhythmia database (MITBIH-SUP) (<xref rid="B14" ref-type="bibr">Greenwald et al., 1990</xref>), and the St. Petersburg INCART arrhythmia database (INCART) (<xref rid="B13" ref-type="bibr">Goldberger et al., 2000</xref>). The MITBIH-AR dataset is further divided into two subsets as in (<xref rid="B7" ref-type="bibr">De Chazal et al., 2004</xref>), namely MITBIH-AR-DS1<xref rid="fn1" ref-type="fn"><sup>1</sup></xref> (or DS1) and MITBIH-AR-DS2<xref rid="fn2" ref-type="fn"><sup>2</sup></xref> (or DS2), which contain ECG records from non-overlapping patient groups and have similar category distributions. This division is widely used in previous studies (Mar et al., 2011; <xref rid="B40" ref-type="bibr">Raj and Ray, 2018</xref>; <xref rid="B34" ref-type="bibr">Niu et al., 2020</xref>), where the models are trained on DS1, and tested on DS2. For comparison purposes, we also adopt this division in this study. All these datasets contain two-lead ECG signals with physician-reviewed beat-by-beat annotations in the PhysioBank labels, which can be mapped to the AAMI classes as in <xref rid="T1" ref-type="table">Table 1</xref>. The compositions of the datasets are shown in <xref rid="T2" ref-type="table">Table 2</xref>.</p>
      <p>In this study, the signal in the lead II of each recording is used for beat-by-beat arrhythmia detection. For recordings in MITBIH-AR, the modified lead II (MLII) is used instead. If the lead configurations are unavailable, such as in MITBIH-SUP, the signal in the first lead is used.</p>
    </sec>
    <sec id="s2-2">
      <title>2.2 Overview of the WSDL-AD Framework</title>
      <p>We propose the WSDL-AD framework for beat-by-beat arrhythmia detection, as shown in <xref rid="F2" ref-type="fig">Figure 2</xref>. The framework is input with an ECG signal of variable length. The input signal is first preprocessed to unify the signal configurations (such as sampling rate and amplitude) and eliminate noise. Then, feature maps are extracted from the signal by a residual convolutional neural network (ResNet) and domain-knowledge-based methods respectively. Based on the features, the framework makes local predictions in the granularity of a sampling point. Then the predicted rhythm for each heartbeat is obtained by selecting the prediction at its R peak. Finally, the beat-level predictions are aggregated into the global prediction, whereby the loss value for the prediction can be calculated according to the global annotations to enable the model to be trained end-to-end.</p>
      <fig position="float" id="F2">
        <label>FIGURE 2</label>
        <caption>
          <p>The schematic diagram of the weakly supervised deep learning framework for arrhythmia detection (WSDL-AD). CNN = convolutional neural network. N = normal or bundle branch block beat. S = supraventricular ectopic beat. V = ventricular ectopic beat.</p>
        </caption>
        <graphic xlink:href="fphys-13-850951-g002" position="float"/>
      </fig>
    </sec>
    <sec id="s2-3">
      <title>2.3 Preprocessing</title>
      <p>The preprocessing is mainly aimed to eliminate the noise and unify the sampling rate and amplitude of the ECG signals. Each ECG recording is first processed by a moving average filter (the window size is one second) to estimate the baseline wander which mainly originated from the offset and low-frequency noises in the signal. The estimated baseline wander is then removed by subtracting it from the signal. The signal is also processed by a band-pass filter (0.1–30 Hz) to suppress noises in other bands. In addition, we resample the signal to 125 Hz and normalize the signal to have mean zero and variance one. Among these datasets, the MITBIH-SUP has a frequency (128 Hz) very similar to our target frequency, so signals of this dataset are not resampled. But the frequencies of other datasets are all much higher than the target frequency, so signals in these datasets are downsampled to 125 Hz.</p>
      <p>For the coarsely-annotated training data, a tricky situation is that if a recording contains both sinus and arrhythmia episodes, its annotation usually does not include the label for sinus rhythm. To address this problem, we complement the labels based on the rules of co-occurrence of different rhythms. Specifically, if the label set of a recording contains SVEB or VEB, and contains neither supraventricular tachyarrhythmia nor idioventricular rhythm, it is very likely that beats of N are also present in the recording. So, in this case, we add the label N to the label set of the recording for complementing.</p>
    </sec>
    <sec id="s2-4">
      <title>2.4 Knowledge-Based Features</title>
      <p>Contextual information, e.g., the variation of RR intervals, is essential for the detection of many arrhythmias. In order to facilitate the utilization of contextual information in arrhythmia detection, we design two context-relative features based on domain knowledge. The extraction of the two features requires the positions of QRS complexes, which are usually not directly available, and need to be detected by some algorithms. In this study, the QRS complexes are detected by a U-net-based model that has been proposed in a previous study (<xref rid="B18" ref-type="bibr">He et al., 2020</xref>).</p>
      <sec id="s2-4-1">
        <title>2.4.1 Relative RR Interval</title>
        <p>The change of current RR interval relative to the contextual normal sinus RR intervals supplies important information for the detection of many arrhythmias including SVEB and VEB. So, we design a feature, named relative RR interval, to represent this information: <inline-formula id="inf1"><mml:math id="m1" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:math></inline-formula> , where <inline-formula id="inf2"><mml:math id="m2" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the relative RR interval, <inline-formula id="inf3"><mml:math id="m3" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the absolute RR interval, <inline-formula id="inf4"><mml:math id="m4" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the representative normal RR interval in the context, and <italic>s</italic> is a scaling parameter. Here, we use the mean RR interval of the context to approximate <inline-formula id="inf5"><mml:math id="m5" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for simplicity of calculation: <inline-formula id="inf6"><mml:math id="m6" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo>≈</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi mathvariant="double-struck">I</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula id="inf7"><mml:math id="m7" overflow="scroll"><mml:mi mathvariant="double-struck">I</mml:mi></mml:math></inline-formula> is the set of RR intervals in the context. Note that <inline-formula id="inf8"><mml:math id="m8" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is negatively related with <inline-formula id="inf9"><mml:math id="m9" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. <inline-formula id="inf10"><mml:math id="m10" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is positive when <inline-formula id="inf11"><mml:math id="m11" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, while <inline-formula id="inf12"><mml:math id="m12" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is negative when <inline-formula id="inf13"><mml:math id="m13" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Due to the wide adoption of rectified linear unit (ReLU), many DNN models are more sensitive to positive values. Therefore, our design can induce the DNN to be more sensitive to the shortening of RR interval which is an important indicator of ectopic heartbeats. Besides, <inline-formula id="inf14"><mml:math id="m14" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is normalized by <inline-formula id="inf15"><mml:math id="m15" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> in the formula to better reflect the degree of relative changes.</p>
        <p>In selecting the length of the context for estimating <inline-formula id="inf16"><mml:math id="m16" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, a trade-off should be considered between the accuracy and robustness: the longer the context is, the more robust the mean RR interval is to local disturbances, but the less accurately it reflects a temporal fluctuation of the sinus RR interval. In this work, we set the context length to 60 RR intervals with the current RR interval at the middle of the context. And when the number of RR intervals in a recording is less than 60, all the RR intervals are used as the context. The scaling parameter, <italic>s</italic>, is used to increase the feature’s contribution in the prediction since the raw value is usually small and easy to be ignored by the classifier. In our implementation, <italic>s</italic> is set to 10.</p>
        <p>The relative RR intervals of a recording are organized in a feature map, which has the same length as the ECG. In this way, the feature map can be easily combined with the DNN-extracted feature maps, and used in the local predictions. The feature map is organized as follows: the points in the region of a heartbeat are assigned the feature value of the corresponding heartbeat. Here, we define the region of a heartbeat as the portion between the midpoint of its preceding RR interval and the midpoint of its succeeding RR interval.</p>
      </sec>
      <sec id="s2-4-2">
        <title>2.4.2 RR Entropy</title>
        <p>The regularity and stationarity of the RR intervals in the context also provide important diagnostic information. We measure this information by another feature, named RR entropy. The RR entropy is calculated by the sample entropy (SampEn) method (<xref rid="B43" ref-type="bibr">Richman and Moorman, 2000</xref>). SampEn is the negative natural logarithm of the empirical probability that two templates (i.e., segments) of length <italic>m</italic>+1 from the input sequence match each other given that their sub-templates containing the corresponding first <italic>m</italic> sampling points match. In our implementation, <italic>m</italic> is set to 1, and the threshold to determine whether two templates match is set to 0.05. Before the entropy calculation, the RR intervals are divided by their median value for normalization. Since the entropy can fluctuate with time, we calculate its values dynamically in a sliding window. Similar to the selection of the context length for estimating normal RR interval, the selection of window size for entropy calculation should also take into account the balance between accuracy and robustness. The window size is set also to 60 RR intervals in our implementation. And the method for window selection is the same as that for specifying the context in normal RR interval estimation. The calculated RR entropies are also organized in a feature map, where the result of each moving window calculation is mapped to the region of the central heartbeat (typically the 30th heartbeat) of the window. Any sampling point that is not mapped in the above process is assigned the value of its neatest mapped neighbor.</p>
        <p>To assess the discriminative abilities of the features, we randomly sample 2,700 heartbeats from the MITBIH-AR-DS1 (900 for each category), and apply one-way ANOVA test on their feature values grouped by categories. The results show that the values of both features are significantly different (<italic>p</italic> &lt; 0.0001) among these categories. We also perform multiple pairwise comparisons on the feature values, and the results are given in <xref rid="F3" ref-type="fig">Figure 3</xref>. We found that the feature values are significantly different (<italic>p</italic> &lt; 0.0001) between each pair of categories. Therefore, these knowledge-based features have certain discernibility for categories and will contribute to the classification task.</p>
        <fig position="float" id="F3">
          <label>FIGURE 3</label>
          <caption>
            <p>The results of one-way ANOVA with multiple pairwise comparison for the knowledge-based features. <bold>(A)</bold> The results for relative RR interval. <bold>(B)</bold> The results for RR entropy. The symbol “****” indicates that the corresponding two groups are significantly (<italic>p</italic> &lt; 0.0001) different from each other in features values. N = normal or bundle branch block beat. S = supraventricular ectopic beat. V = ventricular ectopic beat.</p>
          </caption>
          <graphic xlink:href="fphys-13-850951-g003" position="float"/>
        </fig>
      </sec>
    </sec>
    <sec id="s2-5">
      <title>2.5 DNN-Based Feature Extraction and Local Prediction</title>
      <p>The ResNet is used to automatically extract features from the ECG. It consists of a stack of residual convolutional blocks (Res blocks) as shown in <xref rid="F4" ref-type="fig">Figure 4</xref>. Each Res block contains two convolutional (Conv) layers and some assistant layers, including batch normalization (BN) (<xref rid="B19" ref-type="bibr">Ioffe and Szegedy, 2015</xref>), rectified linear unit (ReLU) (<xref rid="B33" ref-type="bibr">Nair and Hinton, 2010</xref>), and Dropout (<xref rid="B49" ref-type="bibr">Srivastava et al., 2014</xref>). The output of a block’s last convolutional layer is merged with the block’s input by element-wise addition, as suggested by the original ResNet (<xref rid="B16" ref-type="bibr">He et al., 2016</xref>). A max-pooling layer with a pool size of two then compresses the merged output to half of its original length. The blocks are connected in series, with the output of the previous one serving as the input of the latter. The outputs of the last block are a series of feature maps characterizing each temporal slice of the input recording. To align with the knowledge-based features, these DNN-extracted feature maps are up-sampled along the time dimension to the same length of the input. Then, these feature maps are concatenated with the feature maps of knowledge-based features along the feature dimension, and jointly used for the local prediction. This architecture contains several hyperparameters which may affect the model performance. We optimize the hyperparameters by grid search: different choices of residual blocks number (3, 4, 5, and 6), convolutional kernel number (16, 32, and 64), convolutional kernel length (8, 16, and 32), and dropout rate (0, 0.25, and 0.5) are tested to find the combination that achieves the best performance on the validation set (MITBIH-AR-DS1). After the hyperparameters optimization, the ResNet consists of 4 Res blocks. In each Res block, each convolutional layer contains 32 kernels with a kernel length of 8. The parameters of each convolutional layer are initialized by the method proposed in (<xref rid="B17" ref-type="bibr">He et al., 2015</xref>), which takes the ReLU into account and allows for very deep models. The dropout rate of each dropout layer is 0.25.</p>
      <fig position="float" id="F4">
        <label>FIGURE 4</label>
        <caption>
          <p>The structure of residual convolutional network (ResNet) for feature learning. Res block = residual block. Conv = convolutional layer. Batch Norm = batch normalization. ReLU = rectified linear unit.</p>
        </caption>
        <graphic xlink:href="fphys-13-850951-g004" position="float"/>
      </fig>
      <p>Based on the feature map merged from DNN features and knowledge-based features, the local predictions are made by a time distributed dense (TDD) layer, which leverages a dense layer (i.e., fully-connected layer) to process each temporal element separately. The cell number of the TDD layer is equal to the number of considered rhythm types. The output of the TDD layer at each temporal element is then processed by the softmax function to calculate probability of each considered rhythm occurring at the slice.</p>
    </sec>
    <sec id="s2-6">
      <title>2.6 Aggregation for Global Prediction</title>
      <p>The aggregation mechanism, mapping the local predictions to the global prediction, is a critical part in the WSDL-AD framework. Here, we introduce the method of applying the traditional aggregation mechanisms to this framework, and also propose the masked aggregation mechanism.</p>
      <sec id="s2-6-1">
        <title>2.6.1 Traditional Aggregation Methods</title>
        <p>A series of aggregation methods have been proposed in previous studies for computer vision, including global average pooling (GAP) (<xref rid="B56" ref-type="bibr">Zhou et al., 2016</xref>), global maximum pooling (GMP) (<xref rid="B36" ref-type="bibr">Pathak et al., 2014</xref>), and Log-Sum-Exp (LSE) (<xref rid="B38" ref-type="bibr">Pinheiro and Collobert, 2015</xref>). Here, we formalize these methods for application to the mapping between the local predictions and the global prediction. GAP averages all local predictions to obtain the global prediction: <inline-formula id="inf18"><mml:math id="m18" overflow="scroll"><mml:mrow><mml:mi>G</mml:mi><mml:mi>A</mml:mi><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, where <inline-formula id="inf19"><mml:math id="m19" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> is the collection of local predictions, <inline-formula id="inf20"><mml:math id="m20" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the prediction for rhythm <italic>c</italic> at the <italic>i</italic>th sampling point. We argue that GAP is not suitable for use in the WSDL-AD framework, because some arrhythmias, e.g., ectopic beats, may account for only a very small fraction of a recording, and the predictions for them will be ignored by GAP. In contrast, GMP selects the maximum local prediction for a class as its global prediction: <inline-formula id="inf21"><mml:math id="m21" overflow="scroll"><mml:mrow><mml:mi>G</mml:mi><mml:mi>M</mml:mi><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. By using GMP, a rhythm is considered to be present in a recording as long as it occurs at some time in the recording regardless of the duration. One possible problem of GMP is that it may underestimate the true region of an object (<xref rid="B22" ref-type="bibr">Kolesnikov and Lampert, 2016</xref>), because the gradient of the prediction loss will be saturated (extremely close to 0) as long as the maximum activation for the existing arrhythmia is extremely close to 1. One solution for this problem is to make a compromise between GAP and GMP. For example, LSE is a convex approximation of the max function (<xref rid="B38" ref-type="bibr">Pinheiro and Collobert, 2015</xref>): <inline-formula id="inf22"><mml:math id="m22" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mi>S</mml:mi><mml:mi>E</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mtext>log</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>n</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <italic>b</italic> &gt; 0 is a hyper-parameter that controls the degree of the approximation to GMP. Increasing <italic>b</italic> will push the function closer to GMP, while decreasing <italic>b</italic> will make the function closer to GAP.</p>
        <p>However, there are some problems when directly applying these aggregation methods to the local predictions. Firstly, the local predictions are corresponding to sampling points rather than heartbeats. Although we can divide these local features and predictions into individual heartbeats, the variable length and uneven distribution of heartbeats can make an accurate division difficult and increase the complexity of the model structure. Secondly, due to the significant morphological differences between the subwaves (e.g., P wave, QRS complex, and T wave) of a heartbeat, the local predictions at different parts of a heartbeat may be inconsistent, i.e., different parts of a heartbeat are classified to different classes. These inconsistent predictions are unreasonable and will increase the difficulty of model optimization. To address these problems, we propose a masked aggregation mechanism.</p>
      </sec>
      <sec id="s2-6-2">
        <title>2.6.2 Masked Aggregation</title>
        <p>The inconsistent predictions within a heartbeat are mainly due to the morphological differences between the subwaves (e.g., P, QRS, and T) of a heartbeat. This problem can be circumvented by selecting the prediction at a certain point in a heartbeat (i.e., the reference point) as the representative prediction for the beat. To ensure the representativeness of the selected predictions, we propose to aggregate only the selected predictions to obtain the global prediction. In this way, only the selected predictions are optimized according to the gradient of the global prediction loss, and thus they will be representative of the beats after the training. Since other predictions are masked out in the aggregation, we call this mechanism masked aggregation. In this work, we choose the R peak as the reference point of a heartbeat because it can be usually accurately recognized by certain algorithms (<xref rid="B18" ref-type="bibr">He et al., 2020</xref>). On the selected local predictions, the aggregation methods mentioned above can also be applied. Here, we combine masked aggregation with GMP to get masked global max pooling (MGMP): <inline-formula id="inf23"><mml:math id="m23" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:mi>G</mml:mi><mml:mi>M</mml:mi><mml:mi>P</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, where <italic>R</italic> denotes the set of reference points. By selecting only the local predictions at the reference points, the space of possible solutions for local predictions will be significantly reduced, because the reference points in a recording are a few orders of magnitude less than the sampling points. Furthermore, the masked aggregation induces the model to learn features around the reference points so that the learned features at different reference points are semantically comparable between each other.</p>
      </sec>
    </sec>
    <sec id="s2-7">
      <title>2.7 Loss Calculation</title>
      <p>The global predictions are used for the loss calculation since only record-level labels are available in our WSL setting. The loss function should support multi-label classifications, because multiple rhythms may coexist in a single ECG record. Here, we use the binary cross-entropy as the loss function for the training of our models:<disp-formula id="e1"><mml:math id="m24" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">C</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">C</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:munderover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mo>;</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>c</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mo>;</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>c</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo></mml:mrow></mml:math><label>(1)</label></disp-formula>where <italic>X</italic> is a recording of the training set, <italic>T</italic> is the record-level label set of <italic>X</italic>, <inline-formula id="inf24"><mml:math id="m25" overflow="scroll"><mml:mi>f</mml:mi></mml:math></inline-formula> is the prediction model, and <inline-formula id="inf25"><mml:math id="m26" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">C</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> is the number of considered classes. <inline-formula id="inf26"><mml:math id="m27" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is an indicator of the presence of class <italic>c</italic> in the label set <italic>T</italic>: if <inline-formula id="inf27"><mml:math id="m28" overflow="scroll"><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>; otherwise, <inline-formula id="inf28"><mml:math id="m29" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. Besides, because N is much more common than SVEB and VEB in clinic, there is an extreme imbalance between these classes. For this problem, we assign different weights to the training samples of different classes in the loss calculation:<disp-formula id="e2"><mml:math id="m30" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">L</mml:mi><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>D</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mi>L</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math><label>(2)</label></disp-formula>where <inline-formula id="inf29"><mml:math id="m31" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">L</mml:mi><mml:mi mathvariant="bold-italic">θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>D</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the loss for the training set <italic>D</italic>, <inline-formula id="inf30"><mml:math id="m32" overflow="scroll"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the weight for the sample <inline-formula id="inf31"><mml:math id="m33" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, and <italic>M</italic> is the number of samples in the dataset. In our implementation, after tuning the weight parameters with experiments, the weight for a sample with SVEB or VEB is set to 2, the weight for a sample with both SVEB and VEB is set to 4, while the weight for a sample with neither SVEB nor VEB is set to 0.1.</p>
    </sec>
    <sec id="s2-8">
      <title>2.8 Two-Stage Training Strategy</title>
      <p>To address the ill-posed problem of WSL, we propose a two-stage training strategy. In the first stage, the model is pre-trained in SL with small amounts of samples with heartbeat labels. Then, in the second stage, the pre-trained model is further trained in WSL with large amounts of coarsely-labeled ECG data. The SL-based pre-training is implemented by omitting the aggregation part of the WSDL-AD framework and applying the supervision directly to the local predictions. The loss value is calculated using categorical cross-entropy on the predictions at the R peaks, as in <xref rid="e3" ref-type="disp-formula">(3)</xref>.<disp-formula id="e3"><mml:math id="m34" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mi>Y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>R</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:munder><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">C</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:munderover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mo>;</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math><label>(3)</label></disp-formula>where <inline-formula id="inf32"><mml:math id="m35" overflow="scroll"><mml:mrow><mml:mo> </mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:math></inline-formula> is the local prediction model, <inline-formula id="inf33"><mml:math id="m36" overflow="scroll"><mml:mi>R</mml:mi></mml:math></inline-formula> denotes the set of heartbeat positions, <inline-formula id="inf34"><mml:math id="m37" overflow="scroll"><mml:mi>Y</mml:mi></mml:math></inline-formula> denotes the set of heartbeat labels. <inline-formula id="inf35"><mml:math id="m38" overflow="scroll"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is an element of <inline-formula id="inf36"><mml:math id="m39" overflow="scroll"><mml:mi>Y</mml:mi></mml:math></inline-formula>: if the heartbeat at the <italic>i</italic>th sampling point belongs to category <inline-formula id="inf37"><mml:math id="m40" overflow="scroll"><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>; otherwise, <inline-formula id="inf38"><mml:math id="m41" overflow="scroll"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. The idea behind this strategy is that the SL-based pre-training can initialize the model with proper parameters that may prevent the subsequent WSL-based training from going in the wrong direction.</p>
    </sec>
  </sec>
  <sec id="s3">
    <title>3 Results</title>
    <p>In this section, we describe the experimental setup and results to evaluate the performance of the WSDL-AD framework in beat-by-beat arrhythmia detection. Ablation studies are also conducted to assess the influence of our proposed techniques on the model’s performance.</p>
    <sec id="s3-1">
      <title>3.1 Experimental Setup</title>
      <p>For comparison between different ML methodologies, we conduct the experiments in three settings: 1) SL setting, where the model is trained with full supervision; 2) WSL setting, where the model is trained with only weak supervision; and 3) the SL + WSL setting, where the model is pre-trained with full supervision on a small dataset, and then trained with weak supervision on a large dataset. Details of each setting are shown in the following subsections.</p>
      <p>We implement the models based on the Tensorflow and train the models on a workstation with a CPU running at 3.5 GHz, an NVIDIA Quadro k6000 GPU, and 64 GB of memory. The method used for model optimization is Adaptive Moment Estimation (Adam) (<xref rid="B20" ref-type="bibr">Kingma and Ba, 2014</xref>), where <italic>β</italic>
<sub>1</sub> is 0.9, <italic>β</italic>
<sub>2</sub> is 0.999, and the learning rate is 0.001. The training process is terminated when the mean F1 score for all categories on the validation set doesn’t increase over 10 epochs. The source code is available at <ext-link xlink:href="https://github.com/sdnjly/WSDL-AD" ext-link-type="uri">https://github.com/sdnjly/WSDL-AD</ext-link>.</p>
      <p>By comparing the model predictions with the annotations, we calculate several metrics to evaluate the model performance. These metrics include sensitivity (<italic>Sen</italic>), specificity (<italic>Spe</italic>), positive predictivity (<italic>Ppr</italic>), accuracy (<italic>Acc</italic>), <italic>F</italic>
<sub>1</sub> score, and average precision (<italic>AP</italic>). Formulas for calculating these metrics are as follows:<disp-formula id="e4"><mml:math id="m42" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mi>F</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><label>(4)</label></disp-formula>
<disp-formula id="e5"><mml:math id="m43" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi>T</mml:mi><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>F</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mi>T</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><label>(5)</label></disp-formula>
<disp-formula id="e6"><mml:math id="m44" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mi>F</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><label>(6)</label></disp-formula>
<disp-formula id="e7"><mml:math id="m45" overflow="scroll"><mml:mrow><mml:mi>A</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mi>T</mml:mi><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mi>F</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mi>T</mml:mi><mml:mi>N</mml:mi><mml:mo>+</mml:mo><mml:mi>F</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><label>(7)</label></disp-formula>
<disp-formula id="e8"><mml:math id="m46" overflow="scroll"><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mi>S</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><label>(8)</label></disp-formula>
<disp-formula id="e9"><mml:math id="m47" overflow="scroll"><mml:mrow><mml:mi>A</mml:mi><mml:mi>P</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>n</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>S</mml:mi><mml:mi>e</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mi>S</mml:mi><mml:mi>e</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mi>p</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math><label>(9)</label></disp-formula>where <italic>TP</italic> denotes true positive predictions, <italic>TN</italic> denotes true negative predictions, <italic>FP</italic> denotes false positive predictions, and <italic>FN</italic> denotes false negatives predictions. <inline-formula id="inf39"><mml:math id="m48" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mi>e</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="inf40"><mml:math id="m49" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mi>p</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are the sensitivity and positive predictivity at the <italic>n</italic>th threshold of the precision-recall curve (PRC) (<xref rid="B5" ref-type="bibr">Chen, 2003</xref>).</p>
    </sec>
    <sec id="s3-2">
      <title>3.2 The SL Setting</title>
      <p>For training the SL model, recordings of MITBIH-AR-DS1 are split into segments of 20 s 80% of the segments are randomly selected as the training set, and the remaining 20% are used as the validation set. The validation set is just used for hyperparameters tuning and early stopping of the training process. The trained model is tested on the other three completely independent and finely annotated datasets, including MITBIH-AR-DS2, MITBIH-SUP, and INCART. The metric scores on these test sets are used for the final evaluation of the model performance.</p>
      <p>The test results on each dataset and the total test data are shown in <xref rid="T3" ref-type="table">Table 3</xref>. For the detection of SVEB, the SL model achieves high scores in <italic>Spe</italic> and <italic>Acc</italic>, but has very low scores in <italic>Sen</italic>, <italic>Ppr</italic>, and <italic>F</italic>
<sub>1</sub>. For example, the <italic>Spe</italic> scores of the SL model on MITBIH-AR-DS2, MITBIH-SUP, and INCART are 0.994, 0.981, and 0.993, respectively, whereas its <italic>Sen</italic> scores on these datasets are only 0.066, 0.130, and 0.590, respectively. The high scores of <italic>Spe</italic> and <italic>Acc</italic> can be attributed to the extreme class imbalance of the test sets, where only a tiny minority of the samples belong to SVEB. And the low scores of <italic>Sen</italic>, <italic>Ppr</italic>, and <italic>F</italic>
<sub>1</sub> are a true reflection of the poor ability of the SL model in detecting SVEB. The test scores for VEB detection are much higher than those for SVEB detection. Besides, the model performances are different from dataset to dataset. For example, the scores of <italic>Ppr</italic> and <italic>F</italic>
<sub>1</sub> for VEB detection on the MITBIH-SUP dataset are much lower than that on the other datasets. These differences may result from the diversity of data distribution among these test sets.</p>
      <table-wrap position="float" id="T3">
        <label>TABLE 3</label>
        <caption>
          <p>Experimental results of different training setting on the evaluation datasets.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead valign="top">
            <tr>
              <th rowspan="2" align="left" colspan="1">Test set</th>
              <th rowspan="2" align="center" colspan="1">Experimental setting</th>
              <th colspan="5" align="center" rowspan="1">N</th>
              <th colspan="5" align="center" rowspan="1">S</th>
              <th colspan="5" align="center" rowspan="1">V</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">
                <italic>Sen</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Spe</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Acc</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Sen</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Spe</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Acc</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Sen</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Spe</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Acc</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td rowspan="3" align="left" colspan="1">MITBIH-AR-DS2</td>
              <td align="left" rowspan="1" colspan="1">SL</td>
              <td align="center" rowspan="1" colspan="1">0.985</td>
              <td align="center" rowspan="1" colspan="1">0.959</td>
              <td align="center" rowspan="1" colspan="1">0.634</td>
              <td align="center" rowspan="1" colspan="1">0.949</td>
              <td align="center" rowspan="1" colspan="1">0.972</td>
              <td align="center" rowspan="1" colspan="1">0.066</td>
              <td align="center" rowspan="1" colspan="1">0.286</td>
              <td align="center" rowspan="1" colspan="1">0.994</td>
              <td align="center" rowspan="1" colspan="1">0.959</td>
              <td align="center" rowspan="1" colspan="1">0.108</td>
              <td align="center" rowspan="1" colspan="1">0.935</td>
              <td align="center" rowspan="1" colspan="1">0.873</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.987</td>
              <td align="center" rowspan="1" colspan="1">0.903</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">WSL</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.987</td>
              <td align="center" rowspan="1" colspan="1">0.883</td>
              <td align="center" rowspan="1" colspan="1">0.979</td>
              <td align="center" rowspan="1" colspan="1">0.988</td>
              <td align="center" rowspan="1" colspan="1">0.806</td>
              <td align="center" rowspan="1" colspan="1">0.799</td>
              <td align="center" rowspan="1" colspan="1">0.992</td>
              <td align="center" rowspan="1" colspan="1">0.985</td>
              <td align="center" rowspan="1" colspan="1">0.803</td>
              <td align="center" rowspan="1" colspan="1">0.902</td>
              <td align="center" rowspan="1" colspan="1">0.950</td>
              <td align="center" rowspan="1" colspan="1">0.997</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.925</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">SL + WSL</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.992</td>
              <td align="center" rowspan="1" colspan="1">0.928</td>
              <td align="center" rowspan="1" colspan="1">0.983</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.886</td>
              <td align="center" rowspan="1" colspan="1">0.785</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.987</td>
              <td align="center" rowspan="1" colspan="1">0.832</td>
              <td align="center" rowspan="1" colspan="1">0.916</td>
              <td align="center" rowspan="1" colspan="1">0.956</td>
              <td align="center" rowspan="1" colspan="1">0.997</td>
              <td align="center" rowspan="1" colspan="1">0.992</td>
              <td align="center" rowspan="1" colspan="1">0.936</td>
            </tr>
            <tr>
              <td rowspan="3" align="left" colspan="1">MITBIH-SUP</td>
              <td align="left" rowspan="1" colspan="1">SL</td>
              <td align="center" rowspan="1" colspan="1">0.932</td>
              <td align="center" rowspan="1" colspan="1">0.941</td>
              <td align="center" rowspan="1" colspan="1">0.574</td>
              <td align="center" rowspan="1" colspan="1">0.889</td>
              <td align="center" rowspan="1" colspan="1">0.936</td>
              <td align="center" rowspan="1" colspan="1">0.130</td>
              <td align="center" rowspan="1" colspan="1">0.323</td>
              <td align="center" rowspan="1" colspan="1">0.981</td>
              <td align="center" rowspan="1" colspan="1">0.924</td>
              <td align="center" rowspan="1" colspan="1">0.186</td>
              <td align="center" rowspan="1" colspan="1">0.826</td>
              <td align="center" rowspan="1" colspan="1">0.434</td>
              <td align="center" rowspan="1" colspan="1">0.939</td>
              <td align="center" rowspan="1" colspan="1">0.933</td>
              <td align="center" rowspan="1" colspan="1">0.569</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">WSL</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.951</td>
              <td align="center" rowspan="1" colspan="1">0.629</td>
              <td align="center" rowspan="1" colspan="1">0.947</td>
              <td align="center" rowspan="1" colspan="1">0.971</td>
              <td align="center" rowspan="1" colspan="1">0.325</td>
              <td align="center" rowspan="1" colspan="1">0.776</td>
              <td align="center" rowspan="1" colspan="1">0.993</td>
              <td align="center" rowspan="1" colspan="1">0.949</td>
              <td align="center" rowspan="1" colspan="1">0.458</td>
              <td align="center" rowspan="1" colspan="1">0.803</td>
              <td align="center" rowspan="1" colspan="1">0.774</td>
              <td align="center" rowspan="1" colspan="1">0.987</td>
              <td align="center" rowspan="1" colspan="1">0.977</td>
              <td align="center" rowspan="1" colspan="1">0.788</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">SL + WSL</td>
              <td align="center" rowspan="1" colspan="1">0.986</td>
              <td align="center" rowspan="1" colspan="1">0.962</td>
              <td align="center" rowspan="1" colspan="1">0.717</td>
              <td align="center" rowspan="1" colspan="1">0.954</td>
              <td align="center" rowspan="1" colspan="1">0.974</td>
              <td align="center" rowspan="1" colspan="1">0.452</td>
              <td align="center" rowspan="1" colspan="1">0.705</td>
              <td align="center" rowspan="1" colspan="1">0.987</td>
              <td align="center" rowspan="1" colspan="1">0.951</td>
              <td align="center" rowspan="1" colspan="1">0.551</td>
              <td align="center" rowspan="1" colspan="1">0.795</td>
              <td align="center" rowspan="1" colspan="1">0.768</td>
              <td align="center" rowspan="1" colspan="1">0.986</td>
              <td align="center" rowspan="1" colspan="1">0.976</td>
              <td align="center" rowspan="1" colspan="1">0.782</td>
            </tr>
            <tr>
              <td rowspan="3" align="left" colspan="1">INCART</td>
              <td align="left" rowspan="1" colspan="1">SL</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.978</td>
              <td align="center" rowspan="1" colspan="1">0.844</td>
              <td align="center" rowspan="1" colspan="1">0.973</td>
              <td align="center" rowspan="1" colspan="1">0.985</td>
              <td align="center" rowspan="1" colspan="1">0.590</td>
              <td align="center" rowspan="1" colspan="1">0.487</td>
              <td align="center" rowspan="1" colspan="1">0.993</td>
              <td align="center" rowspan="1" colspan="1">0.989</td>
              <td align="center" rowspan="1" colspan="1">0.534</td>
              <td align="center" rowspan="1" colspan="1">0.826</td>
              <td align="center" rowspan="1" colspan="1">0.945</td>
              <td align="center" rowspan="1" colspan="1">0.994</td>
              <td align="center" rowspan="1" colspan="1">0.975</td>
              <td align="center" rowspan="1" colspan="1">0.882</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">WSL</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.988</td>
              <td align="center" rowspan="1" colspan="1">0.914</td>
              <td align="center" rowspan="1" colspan="1">0.981</td>
              <td align="center" rowspan="1" colspan="1">0.989</td>
              <td align="center" rowspan="1" colspan="1">0.852</td>
              <td align="center" rowspan="1" colspan="1">0.575</td>
              <td align="center" rowspan="1" colspan="1">0.993</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.687</td>
              <td align="center" rowspan="1" colspan="1">0.886</td>
              <td align="center" rowspan="1" colspan="1">0.950</td>
              <td align="center" rowspan="1" colspan="1">0.994</td>
              <td align="center" rowspan="1" colspan="1">0.982</td>
              <td align="center" rowspan="1" colspan="1">0.917</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">SL + WSL</td>
              <td align="center" rowspan="1" colspan="1">0.993</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.933</td>
              <td align="center" rowspan="1" colspan="1">0.986</td>
              <td align="center" rowspan="1" colspan="1">0.992</td>
              <td align="center" rowspan="1" colspan="1">0.927</td>
              <td align="center" rowspan="1" colspan="1">0.519</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.665</td>
              <td align="center" rowspan="1" colspan="1">0.880</td>
              <td align="center" rowspan="1" colspan="1">0.976</td>
              <td align="center" rowspan="1" colspan="1">0.997</td>
              <td align="center" rowspan="1" colspan="1">0.984</td>
              <td align="center" rowspan="1" colspan="1">0.926</td>
            </tr>
            <tr>
              <td rowspan="3" align="left" colspan="1">The Total Test Set</td>
              <td align="left" rowspan="1" colspan="1">SL</td>
              <td align="center" rowspan="1" colspan="1">0.964</td>
              <td align="center" rowspan="1" colspan="1">0.959</td>
              <td align="center" rowspan="1" colspan="1">0.701</td>
              <td align="center" rowspan="1" colspan="1">0.932</td>
              <td align="center" rowspan="1" colspan="1">0.961</td>
              <td align="center" rowspan="1" colspan="1">0.179</td>
              <td align="center" rowspan="1" colspan="1">0.371</td>
              <td align="center" rowspan="1" colspan="1">0.988</td>
              <td align="center" rowspan="1" colspan="1">0.956</td>
              <td align="center" rowspan="1" colspan="1">0.242</td>
              <td align="center" rowspan="1" colspan="1">0.837</td>
              <td align="center" rowspan="1" colspan="1">0.696</td>
              <td align="center" rowspan="1" colspan="1">0.968</td>
              <td align="center" rowspan="1" colspan="1">0.957</td>
              <td align="center" rowspan="1" colspan="1">0.760</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">WSL</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.971</td>
              <td align="center" rowspan="1" colspan="1">0.782</td>
              <td align="center" rowspan="1" colspan="1">0.965</td>
              <td align="center" rowspan="1" colspan="1">0.981</td>
              <td align="center" rowspan="1" colspan="1">0.445</td>
              <td align="center" rowspan="1" colspan="1">0.721</td>
              <td align="center" rowspan="1" colspan="1">0.993</td>
              <td align="center" rowspan="1" colspan="1">0.972</td>
              <td align="center" rowspan="1" colspan="1">0.550</td>
              <td align="center" rowspan="1" colspan="1">0.862</td>
              <td align="center" rowspan="1" colspan="1">0.893</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.980</td>
              <td align="center" rowspan="1" colspan="1">0.878</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">SL + WSL</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.978</td>
              <td align="center" rowspan="1" colspan="1">0.835</td>
              <td align="center" rowspan="1" colspan="1">0.971</td>
              <td align="center" rowspan="1" colspan="1">0.984</td>
              <td align="center" rowspan="1" colspan="1">0.560</td>
              <td align="center" rowspan="1" colspan="1">0.669</td>
              <td align="center" rowspan="1" colspan="1">0.989</td>
              <td align="center" rowspan="1" colspan="1">0.972</td>
              <td align="center" rowspan="1" colspan="1">0.610</td>
              <td align="center" rowspan="1" colspan="1">0.858</td>
              <td align="center" rowspan="1" colspan="1">0.906</td>
              <td align="center" rowspan="1" colspan="1">0.992</td>
              <td align="center" rowspan="1" colspan="1">0.981</td>
              <td align="center" rowspan="1" colspan="1">0.882</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p>N, normal or bundle branch block beat; S, supraventricular ectopic beat; V, ventricular ectopic beat; SL, supervised learning; WSL, weakly supervised learning; Sen, sensitivity; Ppr, positive predictivity; Spe, specificity; Acc, accuracy; F<sub>1</sub>, F<sub>1</sub> score.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec id="s3-3">
      <title>3.3 The WSL Setting</title>
      <p>The WSL model is trained on the five coarsely-annotated datasets from the PhysioNet/CinC challenge. MITBIH-AR-DS1 is used as the validation set, and the other three finely-annotated datasets are used as the test sets. For ease of batch processing during the model training, all recordings in the training set are padded or truncated at the end to 20 s. The recordings in the validation set are also split into segments of 20 s.</p>
      <p>The evaluation results on the test sets are shown in <xref rid="T3" ref-type="table">Table 3</xref>. By comparing the scores with those in the SL setting, we find that the WSL model improves the scores for detecting SVEB, VEB and N on all of the test sets. Especially, the scores for SVEB detection are improved most significantly. For example, on the dataset of MITBIH-AR-DS2, the <italic>Sen</italic>, <italic>Ppr</italic>, and <italic>F</italic>
<sub>1</sub> scores for SVEB detection are improved from 0.066, 0.286, and 0.108 to 0.806, 0.799, and 0.803, respectively. The differences are shown visually by the PRCs in <xref rid="F5" ref-type="fig">Figure 5</xref>. In the detection of both VEB (<xref rid="F5" ref-type="fig">Figure 5A</xref>) and SVEB (<xref rid="F5" ref-type="fig">Figure 5B</xref>), the curves for the WSL model (in orange) cover significantly larger areas than that for the SL model (in blue), especially in the detection of SVEB.</p>
      <fig position="float" id="F5">
        <label>FIGURE 5</label>
        <caption>
          <p>Precision-recall curves (PRCs) of the detection for ventricular ectopic beats (VEB) and supraventricular ectopic beats (SVEB) on the total dataset in different learning settings. <bold>(A)</bold> PRCs of VEB detection. <bold>(B)</bold> PRCs of SVEB detection. SL = supervised learning. WSL = weakly supervised learning. AP = average precision.</p>
        </caption>
        <graphic xlink:href="fphys-13-850951-g005" position="float"/>
      </fig>
    </sec>
    <sec id="s3-4">
      <title>3.4 The SL + WSL Setting</title>
      <p>In this two-stage training setting, the model is pre-trained in SL for 10 epochs on the segments from the first half of each recording in the MITBIH-AR-DS1. Then the model is trained in WSL on the same data in the WSL setting, with the last-half recordings in the MITBIH-AR-DS1 as the validation set. Finally, the model is tested on the three test sets, with the results shown in <xref rid="T3" ref-type="table">Table 3</xref>. These results are very close to that in the WSL setting, which is also shown in <xref rid="F5" ref-type="fig">Figure 5</xref>. The WSL and SL + WSL models have superiority over each other in different datasets and metrics. For example, the WSL model outperforms the SL + WSL model in <italic>Ppr</italic> and <italic>F</italic>
<sub>1</sub> for detecting SVEB on the INCART, whereas the SL + WSL model outperforms the WSL model in <italic>Sen</italic> and <italic>F</italic>
<sub>1</sub> for detecting SVEB on the MITBIH-SUP. On the total test set, the overall performance (indicated by <italic>F</italic>
<sub>1</sub> and <italic>AP</italic>) of the SL + WSL model is superior to that of the WSL model in detecting both SVEB and VEB. Especially, in the detection of SVEB, the SL + WSL model achieves obvious better scores (<italic>F</italic>
<sub>1</sub> of 0.610, <italic>AP</italic> of 0.601) than the WSL model (<italic>F</italic>
<sub>1</sub> of 0.550, <italic>AP</italic> of 0.583) on the total test set.</p>
    </sec>
    <sec id="s3-5">
      <title>3.5 Stability Assessment</title>
      <p>Due to the ill-posed problem of WSL, there is a chance that the rules learned by a WSL model deviate from the ground truth. To assess the stability of the model performance from training to training, we train the model independently 50 times in each of the WSL and SL + WSL settings. In the WSL setting, the <italic>F</italic>
<sub>1</sub> scores for SVEB detection and VEB detection are 0.370 ± 0.260 and 0.740 ± 0.187, respectively, whereas in the SL + WSL setting, the <italic>F</italic>
<sub>1</sub> scores for SVEB detection and VEB detection are 0.582 ± 0.019 and 0.886 ± 0.009, respectively. The distribution of the scores on the total test data are shown by the histograms in <xref rid="F6" ref-type="fig">Figure 6</xref>. The results show that the performance of the WSL model in detecting both arrhythmias fluctuates wildly from training to training. The distribution of the scores for SVEB detection is polarized: some scores are clustered at the top pole, while other scores are located near the bottom pole. This suggests that different hypotheses of the detection model can satisfy the weak constraints of the recording labels and cause the instability of the model performance from training to training. By contrast, the performance of the SL + WSL model is very stable in multiple training sessions. The SL-based pre-training only initializes the model with a few training samples. It indicates that proper initialization can avoid the unstable performance of a WSL model.</p>
      <fig position="float" id="F6">
        <label>FIGURE 6</label>
        <caption>
          <p>Distributions of the <italic>F</italic>
<sub>1</sub> scores on the total test data in multiple independent training sessions. <bold>(A)</bold> The histogram of the results for ventricular ectopic beat (VEB) detection. <bold>(B)</bold> The histogram of the results for supraventricular ectopic beat (SVEB) detection. SL = supervised learning. WSL = weakly supervised learning.</p>
        </caption>
        <graphic xlink:href="fphys-13-850951-g006" position="float"/>
      </fig>
    </sec>
    <sec id="s3-6">
      <title>3.6 Ablation Studies</title>
      <p>Several ablation studies are conducted to evaluate the effects of the proposed knowledge-based features, DNN-based feature extraction and masked aggregation on the performance of the WSDL-AD framework. And all of the ablation studies are in the SL + WSL setting.</p>
      <sec id="s3-6-1">
        <title>3.6.1 Knowledge-Based Features</title>
        <p>Ablation experiments are conducted to evaluate the contributions of knowledge-based features to the prediction. Four configurations are studied in the experiments, including <italic>none</italic> (using only DNN features), <italic>RR entropy</italic> (using DNN features and RR entropy), <italic>relative RR interval</italic> (using DNN features and relative RR interval), <italic>both features</italic> (using DNN features and both of the knowledge-based features). The test results on the total test data are shown by PRCs in <xref rid="F7" ref-type="fig">Figures 7A,B</xref>. The PRCs of VEB detection are very similar among different configurations, so the knowledge-based features have little effect on the VEB detection. In contrast, there are significant differences among the PRCs for the SVEB detection. The model with no knowledge-based features has an AP score of 0.485, while applying the RR entropy and relative RR interval alone improves the score to 0.512 and 0.529 respectively. The joint application of both knowledge-based features further improves the score to 0.607. Therefore, the knowledge-based features have positive effects on the model’s performance in detecting SVEB.</p>
        <fig position="float" id="F7">
          <label>FIGURE 7</label>
          <caption>
            <p>Precision-recall curves (PRCs) of the ablation studies on the total test data. <bold>(A)</bold> and <bold>(B)</bold> show PRCs of models with different knowledge-based features. <bold>(C)</bold> and <bold>(D)</bold> show PRCs of models with different feature extraction networks. <bold>(E)</bold> and <bold>(F)</bold> show PRCs of models with different aggregation mechanisms. GAP = global average pooling. GMP = global max pooling. LSE = Log-Sum-Exp. MGMP = masked global max pooling. AP = average precision. The parameter <italic>b</italic> of LSE is set to 5.</p>
          </caption>
          <graphic xlink:href="fphys-13-850951-g007" position="float"/>
        </fig>
      </sec>
      <sec id="s3-6-2">
        <title>3.6.2 DNN-Based Feature Extraction Methods</title>
        <p>In our framework, the DNN-based features are extracted using the ResNet. But our framework is also compatible with other kinds of networks for feature extraction. To evaluate the impacts of the network structure on the model performance, we conduct ablation experiments with different types of networks for feature extraction. Besides the ResNet, several well-known networks are tested for comparison, including AlexNet (<xref rid="B24" ref-type="bibr">Krizhevsky et al., 2012</xref>), VGG-19 (<xref rid="B47" ref-type="bibr">Simonyan and Zisserman, 2014</xref>) and U-Net (<xref rid="B45" ref-type="bibr">Ronneberger et al., 2015</xref>). Since these networks are all originally designed for processing 2D images, we replace the 2D convolutional and pooling layers with their 1D counterparts to adapt to the processing of 1D ECG signals. The recommended hyperparameters of these networks are adopted in our experiments. Some dimension-related hyperparameters (such as, convolutional kernel size and pool size) are converted to the 1D counterparts. For example, the convolutional kernel size (3 × 3) of the VGG-19 is converted to 3. The test results on the total test set are shown in <xref rid="F7" ref-type="fig">Figures 7C,D</xref>. From the results, we can find that the performances of models with different network structures are obviously different. Among these networks, ResNet achieves the best performance in both SVEB (<italic>AP</italic> = 0.607) and VEB (<italic>AP</italic> = 0.962) detections on the total test data. The performance of VGG-19 is very close to that of ResNet, and the main difference lies in the detection of VEB (<italic>AP</italic> = 0.943). By contrast, the performances of models with AlexNet and U-Net are much lower than that of ResNet. These results indicate that the structure of the feature-extraction network has important impacts on the model performance. To obtain good performance, it is necessary to choose a proper network structure for feature extraction.</p>
      </sec>
      <sec id="s3-6-3">
        <title>3.6.3 Aggregation Mechanisms</title>
        <p>Four aggregation mechanisms are compared in our ablation studies, including GAP, GMP, LSE (<italic>b</italic> = 5), and MGMP. The test results on the total test data are shown in <xref rid="F7" ref-type="fig">Figures 7E,F</xref>. In detecting VEB, GAP achieves the poorest performance (AP = 0.661) among all of the tested mechanisms, which may be attributed to the fact that an arrhythmia epoch may only account for a small portion of a recording. The performance of LSE (AP = 0.793) is better than GAP since it makes a compromise between GAP and GMP. Much better performances are achieved by GMP (AP = 0.938) and MGMP (AP = 0.962). It may be because that these two mechanisms are consistent with the basic principle that an arrhythmia should be included in the global prediction as long as it exists somewhere in the recording. As for the detection of SVEB, the performances of GMP and MGMP are also significantly better than GAP and LSE. Especially, the MGMP, achieving an AP of 0.607, outperforms all other mechanisms by a large margin. This indicates that the masked mechanism is indeed helpful to improve the performance of WSL-based arrhythmia detection, especially for arrhythmias with subtle morphological changes, e.g., SVEB.</p>
      </sec>
    </sec>
    <sec id="s3-7">
      <title>3.7 Analysis of Detection Examples</title>
      <p>The qualitative results of the WSDL-AD model in detecting SVEB and VEB are shown in <xref rid="F8" ref-type="fig">Figure 8</xref>. In this figure, both the ECG signal and the knowledge-based feature maps (including relative RR interval and RR entropy) of each example are present. The local classifications contain the rhythm-wise probability distribution at each sampling point. The beat-by-beat detections are derived from the local predictions by selecting the predictions at the R peaks. The local classifications indicate that the WSL models have learned the ability to detect SVEBs and VEBs in various contextual rhythms, such as normal sinus rhythm, atrial fibrillation (AF), atrial bigeminy (AB), and ventricular bigeminy (VB). And, in most cases, the model has adequate confidence for the classification, where the predicted probability for some class is significantly higher than that for other classes. The value of the relative RR interval exhibits a positive correlation with the occurrence of SVEB and VEB, which is in line with our expectations and thus can serve as an effective indicator. However, a shortened RR interval, manifested by the high value of relative RR interval, doesn’t necessarily indicate an ectopic beat, because it may be caused by other arrhythmias, such as AF. The RR entropy, on the other hand, reflects the variation of RR intervals in the context: when the RR interval changes greatly (e.g., during AF, AB, or VB), the entropy value is at a high level, and vice versa (e.g., during sinus rhythm). Therefore, the joint application of relative RR interval and RR entropy can supply the information about the significance of a local RR-interval change, and help to increase the precision of the detection.</p>
      <fig position="float" id="F8">
        <label>FIGURE 8</label>
        <caption>
          <p>Qualitative results of arrhythmia detection on the MITBIH-AR-DS2 in the SL + WSL setting. <bold>(A)</bold> An example during normal rhythm. <bold>(B)</bold> An example during atrial fibrillation. <bold>(C)</bold> An example during atrial bigeminy. <bold>(D)</bold> An example during ventricular bigeminy. The vertical dashed lines indicate the positions of R peaks. In the ECG waveform charts, the reference category of each heartbeat is labeled above the ECG. In the local classification charts, the predictions for supraventricular ectopic beats (S) are drawn in blue, the predictions for ventricular ectopic beats (V) are drawn in orange, and the detected categories are labeled above the prediction lines. N denotes a normal or bundle branch block beat. Since the probabilities of N, S, and V add up to one at each sampling point, the predictions for N are not plotted in the figure for clarity.</p>
        </caption>
        <graphic xlink:href="fphys-13-850951-g008" position="float"/>
      </fig>
      <p>However, there are also some cases where the model has low confidence in the classification or even makes errors, as shown in <xref rid="F9" ref-type="fig">Figure 9</xref>. In the example of <xref rid="F9" ref-type="fig">Figure 9A</xref>, two SVEBs during supraventricular tachyarrhythmia (SVTA) are misclassified as N. This can be attributed to the successive occurrence of SVEBs during SVTA, where the change of RR intervals from beat to beat is not significant, and especially most SVEBs are followed by noncompensatory pauses. <xref rid="F9" ref-type="fig">Figure 9B</xref> presents an example that a VEB during the left bundle branch block (LBBB) is misclassified as SVEB. At the beat, the predicted probability for VEB is slightly less than that for SVEB, and both probabilities are significantly higher than that for N. It implies that the model has enough confidence to classify the beat as an ectopic beat, but has not enough confidence to distinguish whether it is an SVEB or VEB. One possible reason for this is that the QRS complex of the VEB is not significantly wider than that of the neighboring beats.</p>
      <fig position="float" id="F9">
        <label>FIGURE 9</label>
        <caption>
          <p>Qualitative results of error predictions. <bold>(A)</bold> An example of misclassifying supraventricular ectopic beats (S) as normal or bundle branch block beats (N) during supraventricular tachyarrhythmia. <bold>(B)</bold> An example of misclassifying a ventricular ectopic beat (V) as an S during left bundle branch block (LBBB).</p>
        </caption>
        <graphic xlink:href="fphys-13-850951-g009" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec id="s4">
    <title>4 Discussion</title>
    <p>In this study, we propose a WSL framework (WSDL-AD) for the beat-by-beat detection of arrhythmias, which requires only coarse-grained record-level annotations during the model training. The evaluation on independent datasets shows that a WSDL-AD model is able to learn the ability to detect VEB and SVEB from the coarsely annotated ECGs. In particular, our WSL model outperforms its SL counterpart by a large margin on multiple external test sets, which indicates that the WSL framework can facilitate the generalization ability of arrhythmia detection by exploring the large amount of coarsely-annotated ECG data. The biggest improvement is in the detection of SVEB, which is more difficult to detect because its waveform variation is usually very subtle. In this section, we will compare the results of our method with that of other state-of-the-art studies, and discuss the implications and limitations of this study.</p>
    <sec id="s4-1">
      <title>4.1 Comparison With Other Studies</title>
      <p>We compare our results with that of representative previous studies. The previous studies on the heartbeat classification can be categorized into two types: inductive learning (or induction), which learns general rules from labeled training samples and applies the rules to test samples; and transductive learning (or transduction), which learns the detection rules from both the labeled training samples and the unlabeled test samples, and applies the rules on the same test samples. This study and most previous studies are in inductive learning. Some studies that based on unsupervised domain adaptation are in transductive learning (<xref rid="B25" ref-type="bibr">Li et al., 2021</xref>; <xref rid="B51" ref-type="bibr">Wang et al., 2021</xref>). Although the models of transductive learning usually achieve better performance than inductive learning models, their requirement for the unlabeled target samples during the model training stage is hard to satisfy, since there are always new patients in routine clinical practice.</p>
      <p>The MITBIH-AR-DS2 dataset is mostly used by previous studies for model evaluation, and the results of some representative studies are shown in <xref rid="T4" ref-type="table">Table 4</xref>. On the dataset, the test scores of our WSL models (in both WSL and SL + WSL settings) in detecting SVEB and VEB are significantly superior to that of the state-of-the-art methods of supervised inductive learning (<xref rid="B15" ref-type="bibr">Guo et al., 2019</xref>; <xref rid="B34" ref-type="bibr">Niu et al., 2020</xref>), and comparable to the state-of-the-art results of unsupervised transductive learning (<xref rid="B25" ref-type="bibr">Li et al., 2021</xref>; <xref rid="B51" ref-type="bibr">Wang et al., 2021</xref>). Compared with previous inductive models, the improvements of <italic>F</italic>
<sub>1</sub> scores are &gt;8% (from 0.766 to 0.832) for SVEB and &gt;4% (from 0.898 to 0.936) for VEB. The test results of previous studies on the MITBIH-SUP dataset and the INCART dataset are present in <xref rid="T5" ref-type="table">Tables 5</xref>,<xref rid="T6" ref-type="table">6</xref> respectively. On the MITBIH-SUP dataset, our WSL models substantially outperform previous studies of induction (increasing the <italic>F</italic>
<sub>1</sub> scores by &gt;290% for SVEB and &gt;11% for VEB) and transduction methods (increasing the <italic>F</italic>
<sub>1</sub> scores by &gt;66% for SVEB and &gt;3% for VEB). Similar improvements are also observed for the INCART dataset. In particular, for the detection of SVEB, our WSL models have a big superiority over the transduction methods on these two datasets, although the transduction methods have optimized their models according to the test samples. These improvements indicate that the proposed WSL method can learn robust rules from a large amount of coarsely annotated data and has a better generalization ability.</p>
      <table-wrap position="float" id="T4">
        <label>TABLE 4</label>
        <caption>
          <p>Comparison of our method with other studies on DS2 of the MITBIH-AR dataset.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead valign="top">
            <tr>
              <th rowspan="2" align="left" colspan="1">Studies</th>
              <th rowspan="2" align="center" colspan="1">Learning type</th>
              <th colspan="3" align="center" rowspan="1">N</th>
              <th colspan="3" align="center" rowspan="1">S</th>
              <th colspan="3" align="center" rowspan="1">V</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">
                <italic>Se</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Se</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Se</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B7" ref-type="bibr">De Chazal et al. (2004)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.869</td>
              <td align="center" rowspan="1" colspan="1">0.992</td>
              <td align="center" rowspan="1" colspan="1">0.926</td>
              <td align="center" rowspan="1" colspan="1">0.759</td>
              <td align="center" rowspan="1" colspan="1">0.385</td>
              <td align="center" rowspan="1" colspan="1">0.511</td>
              <td align="center" rowspan="1" colspan="1">0.777</td>
              <td align="center" rowspan="1" colspan="1">0.819</td>
              <td align="center" rowspan="1" colspan="1">0.794</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B28" ref-type="bibr">Llamedo and Martínez. (2010)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.776</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.995</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.872</td>
              <td align="center" rowspan="1" colspan="1">0.765</td>
              <td align="center" rowspan="1" colspan="1">0.413</td>
              <td align="center" rowspan="1" colspan="1">0.536</td>
              <td align="center" rowspan="1" colspan="1">0.829</td>
              <td align="center" rowspan="1" colspan="1">0.880</td>
              <td align="center" rowspan="1" colspan="1">0.854</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B30" ref-type="bibr">Mar et al. (2011)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.896</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.841</td>
              <td align="center" rowspan="1" colspan="1">0.832</td>
              <td align="center" rowspan="1" colspan="1">0.335</td>
              <td align="center" rowspan="1" colspan="1">0.478</td>
              <td align="center" rowspan="1" colspan="1">0.868</td>
              <td align="center" rowspan="1" colspan="1">0.759</td>
              <td align="center" rowspan="1" colspan="1">0.809</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B54" ref-type="bibr">Zhang et al. (2014)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.889</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.937</td>
              <td align="center" rowspan="1" colspan="1">0.791</td>
              <td align="center" rowspan="1" colspan="1">0.360</td>
              <td align="center" rowspan="1" colspan="1">0.495</td>
              <td align="center" rowspan="1" colspan="1">0.855</td>
              <td align="center" rowspan="1" colspan="1">0.928</td>
              <td align="center" rowspan="1" colspan="1">0.890</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B40" ref-type="bibr">Raj and Ray. (2018)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.909</td>
              <td align="center" rowspan="1" colspan="1">0.994</td>
              <td align="center" rowspan="1" colspan="1">0.950</td>
              <td align="center" rowspan="1" colspan="1">0.808</td>
              <td align="center" rowspan="1" colspan="1">0.488</td>
              <td align="center" rowspan="1" colspan="1">0.608</td>
              <td align="center" rowspan="1" colspan="1">0.822</td>
              <td align="center" rowspan="1" colspan="1">0.854</td>
              <td align="center" rowspan="1" colspan="1">0.838</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B11" ref-type="bibr">Garcia et al. (2017)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.940</td>
              <td align="center" rowspan="1" colspan="1">0.980</td>
              <td align="center" rowspan="1" colspan="1">0.959</td>
              <td align="center" rowspan="1" colspan="1">0.620</td>
              <td align="center" rowspan="1" colspan="1">0.530</td>
              <td align="center" rowspan="1" colspan="1">0.571</td>
              <td align="center" rowspan="1" colspan="1">0.873</td>
              <td align="center" rowspan="1" colspan="1">0.594</td>
              <td align="center" rowspan="1" colspan="1">0.707</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B15" ref-type="bibr">Guo et al. (2019)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">—</td>
              <td align="center" rowspan="1" colspan="1">—</td>
              <td align="center" rowspan="1" colspan="1">—</td>
              <td align="center" rowspan="1" colspan="1">0.627</td>
              <td align="center" rowspan="1" colspan="1">0.612</td>
              <td align="center" rowspan="1" colspan="1">0.619</td>
              <td align="center" rowspan="1" colspan="1">0.913</td>
              <td align="center" rowspan="1" colspan="1">0.883</td>
              <td align="center" rowspan="1" colspan="1">0.898</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B34" ref-type="bibr">Niu et al. (2020)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.989</td>
              <td align="center" rowspan="1" colspan="1">0.974</td>
              <td align="center" rowspan="1" colspan="1">0.981</td>
              <td align="center" rowspan="1" colspan="1">0.765</td>
              <td align="center" rowspan="1" colspan="1">0.766</td>
              <td align="center" rowspan="1" colspan="1">0.766</td>
              <td align="center" rowspan="1" colspan="1">0.857</td>
              <td align="center" rowspan="1" colspan="1">0.941</td>
              <td align="center" rowspan="1" colspan="1">0.897</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B51" ref-type="bibr">Wang et al. (2021)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Transduction</td>
              <td align="center" rowspan="1" colspan="1">0.991</td>
              <td align="center" rowspan="1" colspan="1">0.984</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.765</td>
              <td align="center" rowspan="1" colspan="1">0.902</td>
              <td align="center" rowspan="1" colspan="1">0.830</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.940</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.923</td>
              <td align="center" rowspan="1" colspan="1">0.930</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B25" ref-type="bibr">Li et al. (2021)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Transduction</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.994</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.983</td>
              <td align="center" rowspan="1" colspan="1">0.989</td>
              <td align="center" rowspan="1" colspan="1">0.772</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.934</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.845</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.906</td>
              <td align="center" rowspan="1" colspan="1">0.944</td>
              <td align="center" rowspan="1" colspan="1">0.924</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">This work (WSL setting)</td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.987</td>
              <td align="center" rowspan="1" colspan="1">0.988</td>
              <td align="center" rowspan="1" colspan="1">0.806</td>
              <td align="center" rowspan="1" colspan="1">0.799</td>
              <td align="center" rowspan="1" colspan="1">0.803</td>
              <td align="center" rowspan="1" colspan="1">0.902</td>
              <td align="center" rowspan="1" colspan="1">0.950</td>
              <td align="center" rowspan="1" colspan="1">0.925</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">This work (SL + WSL setting)</td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.990</td>
              <td align="center" rowspan="1" colspan="1">0.992</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.991</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.886</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.785</td>
              <td align="center" rowspan="1" colspan="1">0.832</td>
              <td align="center" rowspan="1" colspan="1">0.916</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.956</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.936</bold>
              </td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p>N, normal or bundle branch block beat; S, supraventricular ectopic beat; V, ventricular ectopic beat; Se, sensitivity; Ppr, positive predictivity; F<sub>1</sub>, F<sub>1</sub> score.</p>
          </fn>
          <fn>
            <p>The bold text indicates the maximum of each column.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <table-wrap position="float" id="T5">
        <label>TABLE 5</label>
        <caption>
          <p>Comparison of our method with other studies on the MITBIH-SUP dataset.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead valign="top">
            <tr>
              <th rowspan="2" align="left" colspan="1">Studies</th>
              <th rowspan="2" align="center" colspan="1">Learning type</th>
              <th colspan="3" align="center" rowspan="1">S</th>
              <th colspan="3" align="center" rowspan="1">V</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">
                <italic>Se</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Se</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B39" ref-type="bibr">Al Rahhal et al. (2016)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.088</td>
              <td align="center" rowspan="1" colspan="1">0.143</td>
              <td align="center" rowspan="1" colspan="1">0.109</td>
              <td align="center" rowspan="1" colspan="1">0.652</td>
              <td align="center" rowspan="1" colspan="1">0.093</td>
              <td align="center" rowspan="1" colspan="1">0.163</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B15" ref-type="bibr">Guo et al. (2019)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.079</td>
              <td align="center" rowspan="1" colspan="1">0.645</td>
              <td align="center" rowspan="1" colspan="1">0.141</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.868</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.588</td>
              <td align="center" rowspan="1" colspan="1">0.701</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B51" ref-type="bibr">Wang et al. (2021)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Transduction</td>
              <td align="center" rowspan="1" colspan="1">0.236</td>
              <td align="center" rowspan="1" colspan="1">0.539</td>
              <td align="center" rowspan="1" colspan="1">0.33</td>
              <td align="center" rowspan="1" colspan="1">0.844</td>
              <td align="center" rowspan="1" colspan="1">0.563</td>
              <td align="center" rowspan="1" colspan="1">0.68</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B25" ref-type="bibr">Li et al. (2021)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Transduction</td>
              <td align="center" rowspan="1" colspan="1">0.238</td>
              <td align="center" rowspan="1" colspan="1">0.472</td>
              <td align="center" rowspan="1" colspan="1">0.316</td>
              <td align="center" rowspan="1" colspan="1">0.785</td>
              <td align="center" rowspan="1" colspan="1">0.724</td>
              <td align="center" rowspan="1" colspan="1">0.753</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">This work (WSL setting)</td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.325</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.776</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.458</td>
              <td align="center" rowspan="1" colspan="1">0.803</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.774</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.788</bold>
              </td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">This work (SL + WSL setting)</td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.452</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.705</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.551</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.795</td>
              <td align="center" rowspan="1" colspan="1">0.768</td>
              <td align="center" rowspan="1" colspan="1">0.782</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p>S, supraventricular ectopic beat; V, ventricular ectopic beat; Se, sensitivity; Ppr, positive predictivity; F<sub>1</sub>, F<sub>1</sub> score.</p>
          </fn>
          <fn>
            <p>The bold text indicates the maximum of each column.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <table-wrap position="float" id="T6">
        <label>TABLE 6</label>
        <caption>
          <p>Comparison of our method with other studies on the INCART dataset.</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead valign="top">
            <tr>
              <th rowspan="2" align="left" colspan="1">Studies</th>
              <th rowspan="2" align="center" colspan="1">Learning type</th>
              <th colspan="3" align="center" rowspan="1">S</th>
              <th colspan="3" align="center" rowspan="1">V</th>
            </tr>
            <tr>
              <th align="center" rowspan="1" colspan="1">
                <italic>Se</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Se</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>Ppr</italic>
              </th>
              <th align="center" rowspan="1" colspan="1">
                <italic>F</italic>
                <sub>
                  <italic>1</italic>
                </sub>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B28" ref-type="bibr">Llamedo and Martínez. (2010)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.77</td>
              <td align="center" rowspan="1" colspan="1">0.39</td>
              <td align="center" rowspan="1" colspan="1">0.52</td>
              <td align="center" rowspan="1" colspan="1">0.81</td>
              <td align="center" rowspan="1" colspan="1">0.87</td>
              <td align="center" rowspan="1" colspan="1">0.84</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B39" ref-type="bibr">Al Rahhal et al. (2016)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.156</td>
              <td align="center" rowspan="1" colspan="1">0.025</td>
              <td align="center" rowspan="1" colspan="1">0.04</td>
              <td align="center" rowspan="1" colspan="1">0.751</td>
              <td align="center" rowspan="1" colspan="1">0.376</td>
              <td align="center" rowspan="1" colspan="1">0.501</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">
                <xref rid="B51" ref-type="bibr">Wang et al. (2021)</xref>
              </td>
              <td align="left" rowspan="1" colspan="1">Transduction</td>
              <td align="center" rowspan="1" colspan="1">0.711</td>
              <td align="center" rowspan="1" colspan="1">0.435</td>
              <td align="center" rowspan="1" colspan="1">0.54</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.901</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.903</td>
              <td align="center" rowspan="1" colspan="1">0.90</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">This work (WSL setting)</td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">0.852</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.575</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.687</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.886</td>
              <td align="center" rowspan="1" colspan="1">0.950</td>
              <td align="center" rowspan="1" colspan="1">0.917</td>
            </tr>
            <tr>
              <td align="left" rowspan="1" colspan="1">This work (SL + WSL setting)</td>
              <td align="left" rowspan="1" colspan="1">Induction</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.927</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">0.519</td>
              <td align="center" rowspan="1" colspan="1">0.665</td>
              <td align="center" rowspan="1" colspan="1">0.880</td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.976</bold>
              </td>
              <td align="center" rowspan="1" colspan="1">
                <bold>0.926</bold>
              </td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p>N, normal or bundle branch block beat; S, supraventricular ectopic beat; V, ventricular ectopic beat; Se, sensitivity; Ppr, positive predictivity; F<sub>1</sub>, F<sub>1</sub> score.</p>
          </fn>
          <fn>
            <p>The bold text indicates the maximum of each column.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec id="s4-2">
      <title>4.2 Implications of the Proposed Method</title>
      <p>This study shows that the WSL approach is effective to improve the generalization ability of beat-by-beat arrhythmia detectors by leveraging the large amounts of coarsely-annotated ECG data. An arrhythmia detector with both fine detection granularity and good generalization ability has important implications for clinical practice. The fine granularity is necessary for measuring the burden and pattern (e.g., bigeminy and trigeminy) of arrhythmias, which can be used to assess critical risks (e.g., stroke and heart failure) in clinic (<xref rid="B4" ref-type="bibr">Boriani et al., 2014</xref>; <xref rid="B31" ref-type="bibr">Marcus, 2020</xref>). On the other hand, the generalization ability is a necessary prerequisite for an algorithm to be trusted for clinical use, because ECG is susceptible to environmental and individual differences. The diagnoses made by currently used algorithms still need to be reviewed by doctors. However, with the explosion of ECG data from mobile devices, it is not practical to rely on doctors to review every record. With the improvements in generalization ability, our WSL method can deal with more situations and make more reliable detections independently, which are of significance to prompt the revolution of automatic ECG diagnosis.</p>
      <p>This superiority of the WSL models may source from the fact that their training data are from a much larger patient group than that of the SL models. The coarse-grained annotations usually take much less time and effort than fine-grained annotations. And to ensure the correctness of the annotations, fine annotation needs multiple experts to reach a consensus on the labels of each beat, while coarse annotation only needs a consensus on the global labels. In addition, in many medical institutions, the electronic medical records, containing both physiological signals and diagnostic reports, are inherent coarsely annotated data and could be used to train the WSL models. Therefore, the amount of coarsely annotated data could be accumulated rapidly in the future, which provides essential substrates for continually improving the reliability of automatic arrhythmia detectors.</p>
      <p>As demonstrated by the ablation experiments, the proposed knowledge-based features and masked aggregation mechanism also play an important role in improving the performance of the WSL models. One of the advantages of the knowledge-based features is that they integrate the information in a very wide context, which is usually difficult to learn by the model self, especially under weak supervision. By fusing the knowledge-based features and the DNN-extracted features, the representative ability of the feature vector might be enhanced, thus causing the detection performance to be improved. On the other hand, the masked aggregation mechanism selects the representative prediction for each heartbeat at the specified reference point, which greatly reduces the space of possible local predictions. Besides, because the reference points belong to the same type of ECG subwave, e.g., the R peak, the features aligned to the reference points are also semantic comparable with each other. Consequently, the masked aggregation mechanism helps to improve the performance of ectopic beat detection. Furthermore, the results of multiple independent training sessions reveal the instability of the training process of WSDL-AD. We also demonstrate that SL-based pre-training on a few finely-annotated samples can effectively improve the stability of the training process. It implies that the initialization has a critical effect on the training process of the WSL model. These methods proposed in this study may also be enlightening to further studies in arrhythmia detection and even other fields.</p>
      <p>The computational complexity of our framework can be divided into several parts, which are corresponding to preprocessing, QRS complexes detection, knowledge-based features extraction, DNN-based features extraction, local prediction, and aggregation, respectively. Among these parts, the part of DNN-based features extraction dominates the computational complexity of the framework. The network for feature extraction is a 1D ResNet whose computational complexity mainly comes from the convolutional layers in it. The computational complexity of each convolutional layer is O(<italic>K</italic>×<italic>M</italic>×<italic>N</italic>), where <italic>K</italic> is the kernel number, <italic>M</italic> is the kernel size (kernel length × channels), and <italic>N</italic> is the signal length. By putting the hyperparameters in the formula, we get O(<italic>K</italic>×<italic>M</italic>×<italic>N</italic>) = O (32 × 16×32×<italic>N</italic>) = O(<italic>N</italic>). There are only nine convolutional layers in our 1D ResNet, and the feature maps are gradually down-sampled. Taken together, the computational complexity of the 1D ResNet is O (9 × 32×16 × 32×<italic>N</italic>) = O(<italic>N</italic>). Thus, the computational complexity of the 1D ResNet is linear to the signal length. Besides, the number of layers and the number of convolutional kernels in our network are much smaller than that of other well-known networks, such as VGG-19 (<xref rid="B23" ref-type="bibr">Krittanawong et al., 2019</xref>) and U-Net (<xref rid="B45" ref-type="bibr">Ronneberger et al., 2015</xref>). Therefore, the computational complexity of our framework is moderate, which is critical for scenarios where computing resources are scarce, such as mobile ECG monitoring.</p>
    </sec>
    <sec id="s4-3">
      <title>4.3 Limitations</title>
      <p>This work also has some limitations. First, the WSL models have a high error rate for SVEB detection. The waveform patterns of SVEB are usually subtle and therefore difficult to be recognized by the model. To address this problem, collecting more training data or improving the design of the WSL framework (e.g., extracting features of the P wave) would be helpful. Second, the WSDL-AD framework is not evaluated for detecting other kinds of ECG abnormalities, such as branch bundle blocks and ST segment changes. Future work is required to assess the effectiveness of WSL in detecting more diverse ECG abnormalities.</p>
    </sec>
  </sec>
  <sec id="s5">
    <title>5 Conclusion</title>
    <p>In conclusion, this study develops and evaluates a WSDL framework for beat-by-beat arrhythmia detection, by which we demonstrate the feasibility of training a fine-grained arrhythmia detector on only coarsely-labeled ECG data. The evaluations on multiple external datasets show that the proposed framework has a significant superiority in generalization ability over previous SL-based methods. The knowledge-based features and masked aggregation mechanism also have important contributions to the performance of the model, while the SL-based pre-training helps to improve the stability of the training process. Furthermore, the computational complexity of our framework is moderate, which permits the models to be deployed on hardware with limited computing resources. Our approach would substantially reduce the burden of data annotation and enhance the reliability of beat-by-beat arrhythmia detection, and therefore has a great potential to promote the application of automatic cardiac monitoring both in and out of hospitals.</p>
  </sec>
</body>
<back>
  <fn-group>
    <fn id="fn1">
      <label>1</label>
      <p>MITBIH-AR-DS1 comprises recordings 101, 106, 108, 109, 112, 114, 115, 116, 118, 119, 122, 124, 201, 203, 205, 207, 208, 209, 215, 220, 223, and 230.</p>
    </fn>
    <fn id="fn2">
      <label>2</label>
      <p>MITBIH-AR-DS2 comprises recordings 100, 103, 105, 111, 113, 117, 121, 123, 200, 202, 210, 212, 213, 214, 219, 221, 222, 228, 231, 232, 233, and 234.</p>
    </fn>
  </fn-group>
  <sec sec-type="data-availability" id="s6">
    <title>Data Availability Statement</title>
    <p>The original contributions presented in the study are included in the article/supplementary material, further inquiries can be directed to the corresponding authors.</p>
  </sec>
  <sec id="s7">
    <title>Author Contributions</title>
    <p>YL: Conceptualization, Data curation, Formal analysis, Methodology, Software, Validation, Visualization, Writing—original draft, Writing—review and editing. QL: Conceptualization, Supervision, Validation, Writing—review and editing. RH: Validation, Writing—review and editing. KW: Resources, Project administration, Writing—review and editing. JL: Validation, Writing—review and editing. YY: Supervision, Validation, Writing—review and editing. YX: Funding acquisition, Supervision. HZ: Conceptualization, Funding acquisition, Supervision, Validation, Writing—review and editing.</p>
  </sec>
  <sec id="s8">
    <title>Funding</title>
    <p>This work was supported by the National Natural Science Foundation of China (NSFC) under Grant No. 62133009 (to QL), and by the Collaborative Innovation Center for Prevention and Treatment of Cardiovascular Disease of Sichuan Province (CICPTCDSP) under Grant No. xtcx2019-01 (to HZ), and by Shandong Provincial Natural Science Foundation (SPNSF) under Grant No. ZR2020MF050 (to YX).</p>
  </sec>
  <sec sec-type="COI-statement" id="s9">
    <title>Conflict of Interest</title>
    <p>The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest.</p>
  </sec>
  <sec sec-type="disclaimer" id="s10">
    <title>Publisher’s Note</title>
    <p>All claims expressed in this article are solely those of the authors and do not necessarily represent those of their affiliated organizations, or those of the publisher, the editors and the reviewers. Any product that may be evaluated in this article, or claim that may be made by its manufacturer, is not guaranteed or endorsed by the publisher.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="B1">
      <mixed-citation publication-type="book"><collab>AAMI</collab> (<year>2012</year>). “<article-title>Testing and Reporting Performance Results of Cardiac Rhythm and ST Segment Measurement Algorithms</article-title>,” in <source><italic>ANSI/AAMI EC57.</italic> Association for the Advancement of Medical Instrumentation</source>. </mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baman</surname><given-names>T. S.</given-names></name><name><surname>Lange</surname><given-names>D. C.</given-names></name><name><surname>Ilg</surname><given-names>K. J.</given-names></name><name><surname>Gupta</surname><given-names>S. K.</given-names></name><name><surname>Liu</surname><given-names>T.-Y.</given-names></name><name><surname>Alguire</surname><given-names>C.</given-names></name><etal/></person-group> (<year>2010</year>). <article-title>Relationship between burden of Premature Ventricular Complexes and Left Ventricular Function</article-title>. <source>Heart Rhythm</source>
<volume>7</volume> (<issue>7</issue>), <fpage>865</fpage>–<lpage>869</lpage>. <pub-id pub-id-type="doi">10.1016/j.hrthm.2010.03.036</pub-id>
<pub-id pub-id-type="pmid">20348027</pub-id></mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Binici</surname><given-names>Z.</given-names></name><name><surname>Intzilakis</surname><given-names>T.</given-names></name><name><surname>Nielsen</surname><given-names>O. W.</given-names></name><name><surname>Køber</surname><given-names>L.</given-names></name><name><surname>Sajadieh</surname><given-names>A.</given-names></name></person-group> (<year>2010</year>). <article-title>Excessive Supraventricular Ectopic Activity and Increased Risk of Atrial Fibrillation and Stroke</article-title>. <source>Circulation</source>
<volume>121</volume> (<issue>13</issue>), <fpage>1904</fpage>–<lpage>1911</lpage>. <pub-id pub-id-type="doi">10.1161/CIR.0b013e3181f3321810.1161/CIRCULATIONAHA.109.874982</pub-id>
<pub-id pub-id-type="pmid">20404258</pub-id></mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Boriani</surname><given-names>G.</given-names></name><name><surname>Glotzer</surname><given-names>T. V.</given-names></name><name><surname>Santini</surname><given-names>M.</given-names></name><name><surname>West</surname><given-names>T. M.</given-names></name><name><surname>De Melis</surname><given-names>M.</given-names></name><name><surname>Sepsi</surname><given-names>M.</given-names></name><etal/></person-group> (<year>2014</year>). <article-title>Device-detected Atrial Fibrillation and Risk for Stroke: an Analysis of &gt;10 000 Patients from the SOS AF Project (Stroke preventiOn Strategies Based on Atrial Fibrillation Information from Implanted Devices)</article-title>. <source>Eur. Heart J.</source>
<volume>35</volume> (<issue>8</issue>), <fpage>508</fpage>–<lpage>516</lpage>. <pub-id pub-id-type="doi">10.1093/eurheartj/eht491</pub-id>
<pub-id pub-id-type="pmid">24334432</pub-id></mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Z.</given-names></name></person-group> (<year>2003</year>). <article-title>Assessing Sequence Comparison Methods with the Average Precision Criterion</article-title>. <source>Bioinformatics</source>
<volume>19</volume> (<issue>18</issue>), <fpage>2456</fpage>–<lpage>2460</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btg349</pub-id>
<pub-id pub-id-type="pmid">14668231</pub-id></mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Choe</surname><given-names>J.</given-names></name><name><surname>Oh</surname><given-names>S. J.</given-names></name><name><surname>Lee</surname><given-names>S.</given-names></name><name><surname>Chun</surname><given-names>S.</given-names></name><name><surname>Akata</surname><given-names>Z.</given-names></name><name><surname>Shim</surname><given-names>H.</given-names></name></person-group> (<year>2020</year>). “<article-title>Evaluating Weakly Supervised Object Localization Methods Right</article-title>,” in <conf-name>Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition</conf-name>, <fpage>3133</fpage>–<lpage>3142</lpage>. </mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>deChazal</surname><given-names>P.</given-names></name><name><surname>O'Dwyer</surname><given-names>M.</given-names></name><name><surname>Reilly</surname><given-names>R. B.</given-names></name></person-group> (<year>2004</year>). <article-title>Automatic Classification of Heartbeats Using ECG Morphology and Heartbeat Interval Features</article-title>. <source>IEEE Trans. Biomed. Eng.</source>
<volume>51</volume> (<issue>7</issue>), <fpage>1196</fpage>–<lpage>1206</lpage>. <pub-id pub-id-type="doi">10.1109/tbme.2004.827359</pub-id>
<pub-id pub-id-type="pmid">15248536</pub-id></mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Degirmenci</surname><given-names>M.</given-names></name><name><surname>Ozdemir</surname><given-names>M. A.</given-names></name><name><surname>Izci</surname><given-names>E.</given-names></name><name><surname>Akan</surname><given-names>A.</given-names></name></person-group> (<year>2021</year>). <article-title>Arrhythmic Heartbeat Classification Using 2D Convolutional Neural Networks</article-title>. <source>Irbm</source>. <pub-id pub-id-type="doi">10.1016/j.irbm.2021.04.002</pub-id>
</mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Deyell</surname><given-names>M. W.</given-names></name><name><surname>Park</surname><given-names>K.-M.</given-names></name><name><surname>Han</surname><given-names>Y.</given-names></name><name><surname>Frankel</surname><given-names>D. S.</given-names></name><name><surname>Dixit</surname><given-names>S.</given-names></name><name><surname>Cooper</surname><given-names>J. M.</given-names></name><etal/></person-group> (<year>2012</year>). <article-title>Predictors of Recovery of Left Ventricular Dysfunction after Ablation of Frequent Ventricular Premature Depolarizations</article-title>. <source>Heart Rhythm</source>
<volume>9</volume> (<issue>9</issue>), <fpage>1465</fpage>–<lpage>1472</lpage>. <pub-id pub-id-type="doi">10.1016/j.hrthm.2012.05.019</pub-id>
<pub-id pub-id-type="pmid">22640894</pub-id></mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Donnelly</surname><given-names>K.</given-names></name></person-group> (<year>2006</year>). <article-title>SNOMED-CT: The Advanced Terminology and Coding System for eHealth</article-title>. <source>Stud. Health Technol. Inform.</source>
<volume>121</volume>, <fpage>279</fpage>–<lpage>290</lpage>. <pub-id pub-id-type="pmid">17095826</pub-id></mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Garcia</surname><given-names>G.</given-names></name><name><surname>Moreira</surname><given-names>G.</given-names></name><name><surname>Menotti</surname><given-names>D.</given-names></name><name><surname>Luz</surname><given-names>E.</given-names></name></person-group> (<year>2017</year>). <article-title>Inter-patient ECG Heartbeat Classification with Temporal VCG Optimized by PSO</article-title>. <source>Sci. Rep.</source>
<volume>7</volume> (<issue>1</issue>), <fpage>10543</fpage>–<lpage>10611</lpage>. <pub-id pub-id-type="doi">10.1038/s41598-017-09837-3</pub-id>
<pub-id pub-id-type="pmid">28874683</pub-id></mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Golany</surname><given-names>T.</given-names></name><name><surname>Radinsky</surname><given-names>K.</given-names></name></person-group> (<year>2019</year>). “<article-title>Pgans: Personalized Generative Adversarial Networks for Ecg Synthesis to Improve Patient-specific Deep Ecg Classification</article-title>,” in <conf-name>Proceedings of the AAAI Conference on Artificial Intelligence</conf-name>, <fpage>557</fpage>–<lpage>564</lpage>. </mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goldberger</surname><given-names>A. L.</given-names></name><name><surname>Amaral</surname><given-names>L. A.</given-names></name><name><surname>Glass</surname><given-names>L.</given-names></name><name><surname>Hausdorff</surname><given-names>J. M.</given-names></name><name><surname>Ivanov</surname><given-names>P. C.</given-names></name><name><surname>Mark</surname><given-names>R. G.</given-names></name><etal/></person-group> (<year>2000</year>). <article-title>PhysioBank, PhysioToolkit, and PhysioNet: Components of a New Research Resource for Complex Physiologic Signals</article-title>. <source>Circulation</source>
<volume>101</volume> (<issue>23</issue>), <fpage>e215</fpage>–<lpage>20</lpage>. <pub-id pub-id-type="doi">10.1161/01.cir.101.23.e215</pub-id>
<pub-id pub-id-type="pmid">10851218</pub-id></mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Greenwald</surname><given-names>S. D.</given-names></name><name><surname>Patil</surname><given-names>R. S.</given-names></name><name><surname>Mark</surname><given-names>R. G.</given-names></name></person-group> (<year>1990</year>). “<article-title>Improved Detection and Classification of Arrhythmias in Noise-Corrupted Electrocardiograms Using Contextual Information</article-title>,” in <source>Computers in Cardiology</source> (<publisher-loc>Chicago, IL</publisher-loc>. </mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Guo</surname><given-names>L.</given-names></name><name><surname>Sim</surname><given-names>G.</given-names></name><name><surname>Matuszewski</surname><given-names>B.</given-names></name></person-group> (<year>2019</year>). <article-title>Inter-patient ECG Classification with Convolutional and Recurrent Neural Networks</article-title>. <source>Biocybernetics Biomed. Eng.</source>
<volume>39</volume> (<issue>3</issue>), <fpage>868</fpage>–<lpage>879</lpage>. <pub-id pub-id-type="doi">10.1016/j.bbe.2019.06.001</pub-id>
</mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>He</surname><given-names>K.</given-names></name><name><surname>Zhang</surname><given-names>X.</given-names></name><name><surname>Ren</surname><given-names>S.</given-names></name><name><surname>Sun</surname><given-names>J.</given-names></name></person-group> (<year>2016</year>). “<article-title>Deep Residual Learning for Image Recognition</article-title>,” in <conf-name>IEEE/CVF Conference on Computer Vision and Pattern Recognition</conf-name>, <fpage>770</fpage>–<lpage>778</lpage>. </mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>He</surname><given-names>K.</given-names></name><name><surname>Zhang</surname><given-names>X.</given-names></name><name><surname>Ren</surname><given-names>S.</given-names></name><name><surname>Sun</surname><given-names>J.</given-names></name></person-group> (<year>2015</year>). “<article-title>Delving Deep into Rectifiers: Surpassing Human-Level Performance on Imagenet Classification</article-title>,” in <conf-name>International Conference on Computer Vision</conf-name>, <fpage>1026</fpage>–<lpage>1034</lpage>. </mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>He</surname><given-names>R.</given-names></name><name><surname>Liu</surname><given-names>Y.</given-names></name><name><surname>Wang</surname><given-names>K.</given-names></name><name><surname>Zhao</surname><given-names>N.</given-names></name><name><surname>Yuan</surname><given-names>Y.</given-names></name><name><surname>Li</surname><given-names>Q.</given-names></name><etal/></person-group> (<year>2020</year>). <article-title>Automatic Detection of QRS Complexes Using Dual Channels Based on U-Net and Bidirectional Long Short-Term Memory</article-title>. <source>IEEE J. Biomed. Health Inform.</source>
<volume>PP</volume> (<issue>4</issue>), <fpage>1052</fpage>–<lpage>1061</lpage>. <pub-id pub-id-type="doi">10.1109/JBHI.2020.3018563</pub-id>
</mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Ioffe</surname><given-names>S.</given-names></name><name><surname>Szegedy</surname><given-names>C.</given-names></name></person-group> (<year>2015</year>). “<article-title>Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift</article-title>,” in <conf-name>International conference on machine learning</conf-name>, <fpage>448</fpage>–<lpage>456</lpage>. </mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Kingma</surname><given-names>D. P.</given-names></name><name><surname>Ba</surname><given-names>J.</given-names></name></person-group> (<year>2014</year>). <source>Adam: A Method for Stochastic Optimization</source>. <comment><italic>arXiv preprint</italic></comment>. </mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kiranyaz</surname><given-names>S.</given-names></name><name><surname>Ince</surname><given-names>T.</given-names></name><name><surname>Gabbouj</surname><given-names>M.</given-names></name></person-group> (<year>2016</year>). <article-title>Real-time Patient-specific ECG Classification by 1-D Convolutional Neural Networks</article-title>. <source>IEEE Trans. Biomed. Eng.</source>
<volume>63</volume> (<issue>3</issue>), <fpage>664</fpage>–<lpage>675</lpage>. <pub-id pub-id-type="doi">10.1109/tbme.2015.2468589</pub-id>
<pub-id pub-id-type="pmid">26285054</pub-id></mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Kolesnikov</surname><given-names>A.</given-names></name><name><surname>Lampert</surname><given-names>C. H.</given-names></name></person-group> (<year>2016</year>). “<article-title>Seed, Expand and Constrain: Three Principles for Weakly-Supervised Image Segmentation</article-title>,” in <conf-name>European Conference on Computer Vision</conf-name>, <fpage>695</fpage>–<lpage>711</lpage>. </mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krittanawong</surname><given-names>C.</given-names></name><name><surname>Johnson</surname><given-names>K. W.</given-names></name><name><surname>Rosenson</surname><given-names>R. S.</given-names></name><name><surname>Wang</surname><given-names>Z.</given-names></name><name><surname>Aydar</surname><given-names>M.</given-names></name><name><surname>Baber</surname><given-names>U.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Deep Learning for Cardiovascular Medicine: a Practical Primer</article-title>. <source>Eur. Heart J.</source>
<volume>40</volume> (<issue>25</issue>), <fpage>2058</fpage>–<lpage>2073</lpage>. <pub-id pub-id-type="doi">10.1093/eurheartj/ehz056</pub-id>
<pub-id pub-id-type="pmid">30815669</pub-id></mixed-citation>
    </ref>
    <ref id="B24">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Krizhevsky</surname><given-names>A.</given-names></name><name><surname>Sutskever</surname><given-names>I.</given-names></name><name><surname>Hinton</surname><given-names>G. E.</given-names></name></person-group> (<year>2012</year>). “<article-title>Imagenet Classification with Deep Convolutional Neural Networks</article-title>,” in <conf-name>Adv. Neur. Inf. Process. Syst.</conf-name>, <fpage>1097</fpage>–<lpage>1105</lpage>. </mixed-citation>
    </ref>
    <ref id="B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>J.</given-names></name><name><surname>Wang</surname><given-names>G.</given-names></name><name><surname>Chen</surname><given-names>M.</given-names></name><name><surname>Ding</surname><given-names>Z.</given-names></name><name><surname>Yang</surname><given-names>H.</given-names></name></person-group> (<year>2021</year>). <article-title>Mixup Asymmetric Tri-training for Heartbeat Classification under Domain Shift</article-title>. <source>IEEE Signal. Process. Lett.</source>
<volume>28</volume>, <fpage>718</fpage>–<lpage>722</lpage>. <pub-id pub-id-type="doi">10.1109/lsp.2021.3066068</pub-id>
</mixed-citation>
    </ref>
    <ref id="B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Y.</given-names></name><name><surname>Pang</surname><given-names>Y.</given-names></name><name><surname>Wang</surname><given-names>J.</given-names></name><name><surname>Li</surname><given-names>X.</given-names></name></person-group> (<year>2018</year>). <article-title>Patient-specific ECG Classification by Deeper CNN from Generic to Dedicated</article-title>. <source>Neurocomputing</source>
<volume>314</volume>, <fpage>336</fpage>–<lpage>346</lpage>. <pub-id pub-id-type="doi">10.1016/j.neucom.2018.06.068</pub-id>
</mixed-citation>
    </ref>
    <ref id="B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>F.</given-names></name><name><surname>Liu</surname><given-names>C.</given-names></name><name><surname>Zhao</surname><given-names>L.</given-names></name><name><surname>Zhang</surname><given-names>X.</given-names></name><name><surname>Wu</surname><given-names>X.</given-names></name><name><surname>Xu</surname><given-names>X.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>An Open Access Database for Evaluating the Algorithms of Electrocardiogram Rhythm and Morphology Abnormality Detection</article-title>. <source>J Med. Imaging Hlth Inform.</source>
<volume>8</volume> (<issue>7</issue>), <fpage>1368</fpage>–<lpage>1373</lpage>. <pub-id pub-id-type="doi">10.1166/jmihi.2018.2442</pub-id>
</mixed-citation>
    </ref>
    <ref id="B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Llamedo</surname><given-names>M.</given-names></name><name><surname>Martinez</surname><given-names>J. P.</given-names></name></person-group> (<year>2010</year>). <article-title>Heartbeat Classification Using Feature Selection Driven by Database Generalization Criteria</article-title>. <source>IEEE Trans. Biomed. Eng.</source>
<volume>58</volume> (<issue>3</issue>), <fpage>616</fpage>–<lpage>625</lpage>. <pub-id pub-id-type="doi">10.1109/TBME.2010.2068048</pub-id>
<pub-id pub-id-type="pmid">20729162</pub-id></mixed-citation>
    </ref>
    <ref id="B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lu</surname><given-names>Y.</given-names></name><name><surname>Jiang</surname><given-names>M.</given-names></name><name><surname>Wei</surname><given-names>L.</given-names></name><name><surname>Zhang</surname><given-names>J.</given-names></name><name><surname>Wang</surname><given-names>Z.</given-names></name><name><surname>Wei</surname><given-names>B.</given-names></name><etal/></person-group> (<year>2021</year>). <article-title>Automated Arrhythmia Classification Using Depthwise Separable Convolutional Neural Network with Focal Loss</article-title>. <source>Biomed. Signal Process. Control.</source>
<volume>69</volume>, <fpage>102843</fpage>. <pub-id pub-id-type="doi">10.1016/j.bspc.2021.102843</pub-id>
</mixed-citation>
    </ref>
    <ref id="B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mar</surname><given-names>T.</given-names></name><name><surname>Zaunseder</surname><given-names>S.</given-names></name><name><surname>Martínez</surname><given-names>J. P.</given-names></name><name><surname>Llamedo</surname><given-names>M.</given-names></name><name><surname>Poll</surname><given-names>R.</given-names></name></person-group> (<year>2011</year>). <article-title>Optimization of ECG Classification by Means of Feature Selection</article-title>. <source>IEEE Trans. Biomed. Eng.</source>
<volume>58</volume> (<issue>8</issue>), <fpage>2168</fpage>–<lpage>2177</lpage>. <pub-id pub-id-type="doi">10.1109/tbme.2011.2113395</pub-id>
</mixed-citation>
    </ref>
    <ref id="B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marcus</surname><given-names>G. M.</given-names></name></person-group> (<year>2020</year>). <article-title>Evaluation and Management of Premature Ventricular Complexes</article-title>. <source>Circulation</source>
<volume>141</volume> (<issue>17</issue>), <fpage>1404</fpage>–<lpage>1418</lpage>. <pub-id pub-id-type="doi">10.1161/circulationaha.119.042434</pub-id>
<pub-id pub-id-type="pmid">32339046</pub-id></mixed-citation>
    </ref>
    <ref id="B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moody</surname><given-names>G. B.</given-names></name><name><surname>Mark</surname><given-names>R. G.</given-names></name></person-group> (<year>2001</year>). <article-title>The Impact of the MIT-BIH Arrhythmia Database</article-title>. <source>IEEE Eng. Med. Biol. Mag.</source>
<volume>20</volume> (<issue>3</issue>), <fpage>45</fpage>–<lpage>50</lpage>. <pub-id pub-id-type="doi">10.1109/51.932724</pub-id>
<pub-id pub-id-type="pmid">11446209</pub-id></mixed-citation>
    </ref>
    <ref id="B33">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Nair</surname><given-names>V.</given-names></name><name><surname>Hinton</surname><given-names>G. E.</given-names></name></person-group> (<year>2010</year>). “<article-title>Rectified Linear Units Improve Restricted Boltzmann Machines</article-title>,” in <conf-name>International Conference on Machine Learning</conf-name>, <fpage>807</fpage>–<lpage>814</lpage>. </mixed-citation>
    </ref>
    <ref id="B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Niu</surname><given-names>J.</given-names></name><name><surname>Tang</surname><given-names>Y.</given-names></name><name><surname>Sun</surname><given-names>Z.</given-names></name><name><surname>Zhang</surname><given-names>W.</given-names></name></person-group> (<year>2020</year>). <article-title>Inter-patient ECG Classification with Symbolic Representations and Multi-Perspective Convolutional Neural Networks</article-title>. <source>IEEE J. Biomed. Health Inform.</source>
<volume>24</volume> (<issue>5</issue>), <fpage>1321</fpage>–<lpage>1332</lpage>. <pub-id pub-id-type="doi">10.1109/jbhi.2019.2942938</pub-id>
<pub-id pub-id-type="pmid">31545750</pub-id></mixed-citation>
    </ref>
    <ref id="B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ozdemir</surname><given-names>M. A.</given-names></name><name><surname>Ozdemir</surname><given-names>G. D.</given-names></name><name><surname>Guren</surname><given-names>O.</given-names></name></person-group> (<year>2021</year>). <article-title>Classification of COVID-19 Electrocardiograms by Using Hexaxial Feature Mapping and Deep Learning</article-title>. <source>BMC Med. Inform. Decis. Mak</source>
<volume>21</volume> (<issue>1</issue>), <fpage>170</fpage>. <pub-id pub-id-type="doi">10.1186/s12911-021-01521-x</pub-id>
<pub-id pub-id-type="pmid">34034715</pub-id></mixed-citation>
    </ref>
    <ref id="B36">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Pathak</surname><given-names>D.</given-names></name><name><surname>Shelhamer</surname><given-names>E.</given-names></name><name><surname>Long</surname><given-names>J.</given-names></name><name><surname>Darrell</surname><given-names>T.</given-names></name></person-group> (<year>2014</year>). “<article-title>Fully Convolutional Multi-Class Multiple Instance Learning</article-title>,” in <conf-name>International Conference on Learning Representations</conf-name>. </mixed-citation>
    </ref>
    <ref id="B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Perez Alday</surname><given-names>E. A.</given-names></name><name><surname>Gu</surname><given-names>A.</given-names></name><name><surname>Shah</surname><given-names>A. J.</given-names></name><name><surname>Robichaux</surname><given-names>C.</given-names></name><name><surname>Wong</surname><given-names>A. I.</given-names></name><name><surname>Liu</surname><given-names>C.</given-names></name><etal/></person-group> (<year>2020</year>). <article-title>Classification of 12-lead ECGs: the Physionet/computing in Cardiology challenge 2020</article-title>. <source>Physiol. Meas.</source>
<volume>41</volume> (<issue>12</issue>). <comment>Article 124003</comment>. <pub-id pub-id-type="doi">10.1088/1361-6579/abc960</pub-id>
</mixed-citation>
    </ref>
    <ref id="B38">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Pinheiro</surname><given-names>P. O.</given-names></name><name><surname>Collobert</surname><given-names>R.</given-names></name></person-group> (<year>2015</year>). “<article-title>From Image-Level to Pixel-Level Labeling with Convolutional Networks</article-title>,” in <conf-name>IEEE/CVF Conference on Computer Vision and Pattern Recognition</conf-name>, <fpage>1713</fpage>–<lpage>1721</lpage>. </mixed-citation>
    </ref>
    <ref id="B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rahhal</surname><given-names>M. M. A.</given-names></name><name><surname>Bazi</surname><given-names>Y.</given-names></name><name><surname>AlHichri</surname><given-names>H.</given-names></name><name><surname>Alajlan</surname><given-names>N.</given-names></name><name><surname>Melgani</surname><given-names>F.</given-names></name><name><surname>Yager</surname><given-names>R. R.</given-names></name></person-group> (<year>2016</year>). <article-title>Deep Learning Approach for Active Classification of Electrocardiogram Signals</article-title>. <source>Inf. Sci.</source>
<volume>345</volume>, <fpage>340</fpage>–<lpage>354</lpage>. <pub-id pub-id-type="doi">10.1016/j.ins.2016.01.082</pub-id>
</mixed-citation>
    </ref>
    <ref id="B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Raj</surname><given-names>S.</given-names></name><name><surname>Ray</surname><given-names>K. C.</given-names></name></person-group> (<year>2018</year>). <article-title>Sparse Representation of ECG Signals for Automated Recognition of Cardiac Arrhythmias</article-title>. <source>Expert Syst. Appl.</source>
<volume>105</volume>, <fpage>49</fpage>–<lpage>64</lpage>. <pub-id pub-id-type="doi">10.1016/j.eswa.2018.03.038</pub-id>
</mixed-citation>
    </ref>
    <ref id="B41">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Rajan</surname><given-names>D.</given-names></name><name><surname>Thiagarajan</surname><given-names>J. J.</given-names></name></person-group> (<year>2018</year>). “<article-title>A Generative Modeling Approach to Limited Channel ECG Classification</article-title>,” in <conf-name>Annual International Conference of the IEEE Engineering in Medicine and Biology Society</conf-name>, <fpage>2571</fpage>–<lpage>2574</lpage>. </mixed-citation>
    </ref>
    <ref id="B42">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Reyna</surname><given-names>M. S.</given-names></name><name><surname>NadiGu</surname><given-names>A.</given-names></name><name><surname>Alday</surname><given-names>P.</given-names></name><name><surname>Andres</surname><given-names>E.</given-names></name><name><surname>Liu</surname><given-names>C.</given-names></name><name><surname>Seyedi</surname><given-names>S.</given-names></name><etal/></person-group> (<year>2021</year>). <source>Will Two Do? Varying Dimensions in Electrocardiography: The PhysioNet - Computing in Cardiology Challenge 2021</source>. <comment>Online</comment>. <publisher-name>PhysioNet: PhysioNet</publisher-name>. <comment>AvailableAccessed Feb. 25 2021]</comment>. <pub-id pub-id-type="doi">10.13026/jz9p-0m02</pub-id>
</mixed-citation>
    </ref>
    <ref id="B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Richman</surname><given-names>J. S.</given-names></name><name><surname>Moorman</surname><given-names>J. R.</given-names></name></person-group> (<year>2000</year>). <article-title>Physiological Time-Series Analysis Using Approximate Entropy and Sample Entropy</article-title>. <source>Am. J. Physiology-Heart Circulatory Physiol.</source>
<volume>278</volume> (<issue>6</issue>), <fpage>H2039</fpage>–<lpage>H2049</lpage>. <pub-id pub-id-type="doi">10.1152/ajpheart.2000.278.6.h2039</pub-id>
</mixed-citation>
    </ref>
    <ref id="B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roger</surname><given-names>V. L.</given-names></name><name><surname>Go</surname><given-names>A. S.</given-names></name><name><surname>Lloyd-Jones</surname><given-names>D. M.</given-names></name><name><surname>Benjamin</surname><given-names>E. J.</given-names></name><name><surname>Berry</surname><given-names>J. D.</given-names></name><name><surname>Borden</surname><given-names>W. B.</given-names></name><etal/></person-group> (<year>2012</year>). <article-title>Executive Summary: Heart Disease and Stroke Statistics--2012 Update: a Report from the American Heart Association</article-title>. <source>Circulation</source>
<volume>125</volume> (<issue>22</issue>), <fpage>188</fpage>–<lpage>197</lpage>. <pub-id pub-id-type="doi">10.1161/CIR.0b013e3182456d46</pub-id>
<pub-id pub-id-type="pmid">22215894</pub-id></mixed-citation>
    </ref>
    <ref id="B45">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Ronneberger</surname><given-names>O.</given-names></name><name><surname>Fischer</surname><given-names>P.</given-names></name><name><surname>Brox</surname><given-names>T.</given-names></name></person-group> (<year>2015</year>). “<article-title>U-net: Convolutional Networks for Biomedical Image Segmentation</article-title>,” in <conf-name>18th International Conference on Medical Image Computing and Computer-Assisted Intervention (MICCAI)</conf-name>, <fpage>234</fpage>–<lpage>241</lpage>. </mixed-citation>
    </ref>
    <ref id="B46">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sana</surname><given-names>F.</given-names></name><name><surname>Isselbacher</surname><given-names>E. M.</given-names></name><name><surname>Singh</surname><given-names>J. P.</given-names></name><name><surname>Heist</surname><given-names>E. K.</given-names></name><name><surname>Pathik</surname><given-names>B.</given-names></name><name><surname>Armoundas</surname><given-names>A. A.</given-names></name></person-group> (<year>2020</year>). <article-title>Wearable Devices for Ambulatory Cardiac Monitoring</article-title>. <source>J. Am. Coll. Cardiol.</source>
<volume>75</volume> (<issue>13</issue>), <fpage>1582</fpage>–<lpage>1592</lpage>. <pub-id pub-id-type="doi">10.1016/j.jacc.2020.01.046</pub-id>
<pub-id pub-id-type="pmid">32241375</pub-id></mixed-citation>
    </ref>
    <ref id="B47">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Simonyan</surname><given-names>K.</given-names></name><name><surname>Zisserman</surname><given-names>A.</given-names></name></person-group> (<year>2014</year>). <source>Very Deep Convolutional Networks for Large-Scale Image Recognition</source>. <comment><italic>arXiv preprint</italic>.</comment>
</mixed-citation>
    </ref>
    <ref id="B48">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siontis</surname><given-names>K. C.</given-names></name><name><surname>Noseworthy</surname><given-names>P. A.</given-names></name><name><surname>Attia</surname><given-names>Z. I.</given-names></name><name><surname>Friedman</surname><given-names>P. A.</given-names></name></person-group> (<year>2021</year>). <article-title>Artificial Intelligence-Enhanced Electrocardiography in Cardiovascular Disease Management</article-title>. <source>Nat. Rev. Cardiol.</source>
<volume>18</volume> (<issue>7</issue>), <fpage>465</fpage>–<lpage>478</lpage>. <pub-id pub-id-type="doi">10.1038/s41569-020-00503-2</pub-id>
<pub-id pub-id-type="pmid">33526938</pub-id></mixed-citation>
    </ref>
    <ref id="B49">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Srivastava</surname><given-names>N.</given-names></name><name><surname>Hinton</surname><given-names>G.</given-names></name><name><surname>Krizhevsky</surname><given-names>A.</given-names></name><name><surname>Sutskever</surname><given-names>I.</given-names></name><name><surname>Salakhutdinov</surname><given-names>R.</given-names></name></person-group> (<year>2014</year>). <article-title>Dropout: a Simple Way to Prevent Neural Networks from Overfitting</article-title>. <source>J. Mach. Learn. Res.</source>
<volume>15</volume> (<issue>1</issue>), <fpage>1929</fpage>–<lpage>1958</lpage>. </mixed-citation>
    </ref>
    <ref id="B50">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wagner</surname><given-names>P.</given-names></name><name><surname>Strodthoff</surname><given-names>N.</given-names></name><name><surname>Bousseljot</surname><given-names>R. D.</given-names></name><name><surname>Kreiseler</surname><given-names>D.</given-names></name><name><surname>Lunze</surname><given-names>F. I.</given-names></name><name><surname>Samek</surname><given-names>W.</given-names></name><etal/></person-group> (<year>2020</year>). <article-title>PTB-XL, a Large Publicly Available Electrocardiography Dataset</article-title>. <source>Sci. Data</source>
<volume>7</volume> (<issue>1</issue>), <fpage>154</fpage>–<lpage>215</lpage>. <pub-id pub-id-type="doi">10.1038/s41597-020-0495-6</pub-id>
<pub-id pub-id-type="pmid">32451379</pub-id></mixed-citation>
    </ref>
    <ref id="B51">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>G.</given-names></name><name><surname>Chen</surname><given-names>M.</given-names></name><name><surname>Ding</surname><given-names>Z.</given-names></name><name><surname>Li</surname><given-names>J.</given-names></name><name><surname>Yang</surname><given-names>H.</given-names></name><name><surname>Zhang</surname><given-names>P.</given-names></name></person-group> (<year>2021</year>). <article-title>Inter-patient ECG Arrhythmia Heartbeat Classification Based on Unsupervised Domain Adaptation</article-title>. <source>Neurocomputing</source>
<volume>454</volume>, <fpage>339</fpage>–<lpage>349</lpage>. <pub-id pub-id-type="doi">10.1016/j.neucom.2021.04.104</pub-id>
</mixed-citation>
    </ref>
    <ref id="B52">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wulan</surname><given-names>N.</given-names></name><name><surname>Wang</surname><given-names>W.</given-names></name><name><surname>Sun</surname><given-names>P.</given-names></name><name><surname>Wang</surname><given-names>K.</given-names></name><name><surname>Xia</surname><given-names>Y.</given-names></name><name><surname>Zhang</surname><given-names>H.</given-names></name></person-group> (<year>2020</year>). <article-title>Generating Electrocardiogram Signals by Deep Learning</article-title>. <source>Neurocomputing</source>
<volume>404</volume>, <fpage>122</fpage>–<lpage>136</lpage>. <pub-id pub-id-type="doi">10.1016/j.neucom.2020.04.076</pub-id>
</mixed-citation>
    </ref>
    <ref id="B53">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhai</surname><given-names>X.</given-names></name><name><surname>Zhou</surname><given-names>Z.</given-names></name><name><surname>Tin</surname><given-names>C.</given-names></name></person-group> (<year>2020</year>). <article-title>Semi-supervised Learning for ECG Classification without Patient-specific Labeled Data</article-title>. <source>Expert Syst. Appl.</source>
<volume>158</volume>, <fpage>113411</fpage>. <pub-id pub-id-type="doi">10.1016/j.eswa.2020.113411</pub-id>
</mixed-citation>
    </ref>
    <ref id="B54">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Z.</given-names></name><name><surname>Dong</surname><given-names>J.</given-names></name><name><surname>Luo</surname><given-names>X.</given-names></name><name><surname>Choi</surname><given-names>K.-S.</given-names></name><name><surname>Wu</surname><given-names>X.</given-names></name></person-group> (<year>2014</year>). <article-title>Heartbeat Classification Using Disease-specific Feature Selection</article-title>. <source>Comput. Biol. Med.</source>
<volume>46</volume>, <fpage>79</fpage>–<lpage>89</lpage>. <pub-id pub-id-type="doi">10.1016/j.compbiomed.2013.11.019</pub-id>
<pub-id pub-id-type="pmid">24529208</pub-id></mixed-citation>
    </ref>
    <ref id="B55">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zheng</surname><given-names>J.</given-names></name><name><surname>Zhang</surname><given-names>J.</given-names></name><name><surname>Danioko</surname><given-names>S.</given-names></name><name><surname>Yao</surname><given-names>H.</given-names></name><name><surname>Guo</surname><given-names>H.</given-names></name><name><surname>Rakovski</surname><given-names>C.</given-names></name></person-group> (<year>2020</year>). <article-title>A 12-lead Electrocardiogram Database for Arrhythmia Research Covering More Than 10,000 Patients</article-title>. <source>Sci. Data</source>
<volume>7</volume> (<issue>1</issue>), <fpage>48</fpage>–<lpage>8</lpage>. <pub-id pub-id-type="doi">10.1038/s41597-020-0386-x</pub-id>
<pub-id pub-id-type="pmid">32051412</pub-id></mixed-citation>
    </ref>
    <ref id="B56">
      <mixed-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>B.</given-names></name><name><surname>Khosla</surname><given-names>A.</given-names></name><name><surname>Lapedriza</surname><given-names>A.</given-names></name><name><surname>Oliva</surname><given-names>A.</given-names></name><name><surname>Torralba</surname><given-names>A.</given-names></name></person-group> (<year>2016</year>). “<article-title>Learning Deep Features for Discriminative Localization</article-title>,” in <conf-name>IEEE/CVF Conference on Computer Vision and Pattern Recognition</conf-name>, <fpage>2921</fpage>–<lpage>2929</lpage>. </mixed-citation>
    </ref>
    <ref id="B57">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>Z.-H.</given-names></name></person-group> (<year>2018</year>). <article-title>A Brief Introduction to Weakly Supervised Learning</article-title>. <source>Natl. Sci. Rev.</source>
<volume>5</volume> (<issue>1</issue>), <fpage>44</fpage>–<lpage>53</lpage>. <pub-id pub-id-type="doi">10.1093/nsr/nwx106</pub-id>
</mixed-citation>
    </ref>
  </ref-list>
</back>
