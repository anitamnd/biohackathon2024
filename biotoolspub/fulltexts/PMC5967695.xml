<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS ONE</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5967695</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0197954</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-18-04312</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Approximation Methods</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Software Tools</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Engineering and Technology</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Software Tools</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Theoretical Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Ecology and Environmental Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Theoretical Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Community Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Ecology and Environmental Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Community Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and analysis methods</subject>
        <subj-group>
          <subject>Mathematical and statistical techniques</subject>
          <subj-group>
            <subject>Statistical methods</subject>
            <subj-group>
              <subject>Monte Carlo method</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Statistics (mathematics)</subject>
            <subj-group>
              <subject>Statistical methods</subject>
              <subj-group>
                <subject>Monte Carlo method</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Software Design</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Engineering and Technology</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Software Design</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Mathematical and Statistical Techniques</subject>
          <subj-group>
            <subject>Bayesian Method</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Mathematical and Statistical Techniques</subject>
          <subj-group>
            <subject>Statistical Methods</subject>
            <subj-group>
              <subject>Statistical Inference</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Statistics (Mathematics)</subject>
            <subj-group>
              <subject>Statistical Methods</subject>
              <subj-group>
                <subject>Statistical Inference</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>No-U-turn sampling for fast Bayesian inference in ADMB and TMB: Introducing the <monospace>adnuts</monospace> and <monospace>tmbstan</monospace> R packages</article-title>
      <alt-title alt-title-type="running-head">No-U-turn MCMC sampling for ADMB and TMB models</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-0871-6700</contrib-id>
        <name>
          <surname>Monnahan</surname>
          <given-names>Cole C.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Formal analysis</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Writing – original draft</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kristensen</surname>
          <given-names>Kasper</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>School of Aquatic and Fishery Sciences, University of Washington, Seattle, Washington, United States of America</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Departamento de Oceanografía, Universidad de Concepción, Concepción, Chile</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>National Institute of Aquatic Resources, Technical University of Denmark, Kemitorvet, Denmark</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Deng</surname>
          <given-names>Yong</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Southwest University, CHINA</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>monnahc@uw.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>24</day>
      <month>5</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>13</volume>
    <issue>5</issue>
    <elocation-id>e0197954</elocation-id>
    <history>
      <date date-type="received">
        <day>8</day>
        <month>2</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>13</day>
        <month>5</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2018 Monnahan, Kristensen</copyright-statement>
      <copyright-year>2018</copyright-year>
      <copyright-holder>Monnahan, Kristensen</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pone.0197954.pdf"/>
    <abstract>
      <p>Statistical inference is a widely-used, powerful tool for learning about natural processes in diverse fields. The statistical software platforms AD Model Builder (ADMB) and Template Model Builder (TMB) are particularly popular in the ecological literature, where they are typically used to perform frequentist inference of complex models. However, both lack capabilities for flexible and efficient Markov chain Monte Carlo (MCMC) integration. Recently, the no-U-turn sampler (NUTS) MCMC algorithm has gained popularity for Bayesian inference through the software Stan because it is efficient for high dimensional, complex hierarchical models. Here, we introduce the R packages <monospace>adnuts</monospace> and <monospace>tmbstan</monospace>, which provide NUTS sampling in parallel and interactive diagnostics with ShinyStan. The ADMB source code was modified to provide NUTS, while TMB models are linked directly into Stan. We describe the packages, provide case studies demonstrating their use, and contrast performance against Stan. For TMB models, we show how to test the accuracy of the Laplace approximation using NUTS. For complex models, the performance of ADMB and TMB was typically within +/- 50% the speed of Stan. In one TMB case study we found inaccuracies in the Laplace approximation, potentially leading to biased inference. <monospace>adnuts</monospace> provides a new method for estimating hierarchical ADMB models which previously were infeasible. TMB users can fit the same model in both frequentist and Bayesian paradigms, including using NUTS to test the validity of the Laplace approximation of the marginal likelihood for arbitrary subsets of parameters. These software developments extend the available statistical methods of the ADMB and TMB user base with no additional effort by the user.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100009542</institution-id>
            <institution>Joint Institute for the Study of the Atmosphere and Ocean</institution>
          </institution-wrap>
        </funding-source>
        <award-id>NA15OAR4320063</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-0871-6700</contrib-id>
          <name>
            <surname>Monnahan</surname>
            <given-names>Cole C.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award002">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100005799</institution-id>
            <institution>Washington Sea Grant, University of Washington</institution>
          </institution-wrap>
        </funding-source>
        <award-id>NA14OAR4170078</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-0871-6700</contrib-id>
          <name>
            <surname>Monnahan</surname>
            <given-names>Cole C.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <funding-statement>This publication is partially funded by the Joint Institute for the Study of the Atmosphere and Ocean (JISAO) under NOAA Cooperative Agreement NA15OAR4320063, Contribution No. 2018-0128. This work was partially funded in part by a grant from Washington Sea Grant, University of Washington, pursuant to National Oceanic and Atmospheric Administration Award No. NA14OAR4170078. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="2"/>
      <table-count count="1"/>
      <page-count count="10"/>
    </counts>
    <custom-meta-group>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>adnuts, tmbstan and the required TMB version can be installed from CRAN (at <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=adnuts">https://cran.r-project.org/package=adnuts</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=tmbstan">https://cran.r-project.org/package=tmbstan</ext-link>). ADMB version 12.0 or greater is freely available at <ext-link ext-link-type="uri" xlink:href="http://www.admb-project.org/">http://www.admb-project.org/</ext-link>. We provide code (Stan, TMB, and ADMB) and data for all models at github.com/colemonnahan/hmc_tests, including scripts to compare performance among Stan, TMB and ADMB, test the Laplace approximation, and demonstrate the two packages. These files have been archived at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.1220442">https://doi.org/10.5281/zenodo.1220442</ext-link>. Bug reports for tmbstan and adnuts can submitted on their respective development github.com pages.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>adnuts, tmbstan and the required TMB version can be installed from CRAN (at <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=adnuts">https://cran.r-project.org/package=adnuts</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=tmbstan">https://cran.r-project.org/package=tmbstan</ext-link>). ADMB version 12.0 or greater is freely available at <ext-link ext-link-type="uri" xlink:href="http://www.admb-project.org/">http://www.admb-project.org/</ext-link>. We provide code (Stan, TMB, and ADMB) and data for all models at github.com/colemonnahan/hmc_tests, including scripts to compare performance among Stan, TMB and ADMB, test the Laplace approximation, and demonstrate the two packages. These files have been archived at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.1220442">https://doi.org/10.5281/zenodo.1220442</ext-link>. Bug reports for tmbstan and adnuts can submitted on their respective development github.com pages.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>Frequentist and Bayesian statistical inference are powerful tools for investigating natural processes throughout diverse fields, including ecology [<xref rid="pone.0197954.ref001" ref-type="bibr">1</xref>,<xref rid="pone.0197954.ref002" ref-type="bibr">2</xref>]. The software package AD Model Builder (ADMB; [<xref rid="pone.0197954.ref003" ref-type="bibr">3</xref>]) has a long history, primarily in fisheries science, for complex non-linear fixed effects models, but an extension allowing estimation of mixed effects models, and an accompanying R package, led to broader use in the ecological community [<xref rid="pone.0197954.ref004" ref-type="bibr">4</xref>, <xref rid="pone.0197954.ref005" ref-type="bibr">5</xref>]. However, manual specification of separable functions hindered the popularity of this software for complex mixed effects models. Recently, Template Model Builder (TMB; [<xref rid="pone.0197954.ref006" ref-type="bibr">6</xref>, <xref rid="pone.0197954.ref007" ref-type="bibr">7</xref>]) was developed specifically to efficiently estimate frequentist mixed effects models using the Laplace approximation to the marginal likelihood [<xref rid="pone.0197954.ref004" ref-type="bibr">4</xref>], effectively replacing ADMB for such models. However, these software platforms designed for frequentist inference lack flexible, efficient (i.e., fast) capabilities for working in the Bayesian framework.</p>
    <p>Recently, the software package Stan [<xref rid="pone.0197954.ref008" ref-type="bibr">8</xref>, <xref rid="pone.0197954.ref009" ref-type="bibr">9</xref>] has gained popularity due to its applicability to a broad range of Bayesian models and efficient Markov chain Monte Carlo (MCMC) sampling [<xref rid="pone.0197954.ref010" ref-type="bibr">10</xref>]. For instance, Stan is faster than the popular JAGS software [<xref rid="pone.0197954.ref011" ref-type="bibr">11</xref>] for complex hierarchical ecological models [<xref rid="pone.0197954.ref012" ref-type="bibr">12</xref>]. Stan achieves such efficiency with the no-U-turn sampler (NUTS; [<xref rid="pone.0197954.ref013" ref-type="bibr">13</xref>], a self-tuning variant of Hamiltonian Monte Carlo (HMC [<xref rid="pone.0197954.ref014" ref-type="bibr">14</xref>, <xref rid="pone.0197954.ref015" ref-type="bibr">15</xref>], a family of MCMC algorithms. Thus, ADMB and TMB models rewritten in Stan could use NUTS to gain state-of-the-art MCMC methods.</p>
    <p>However, it is not always feasible nor desirable to rewrite a model in Stan. For instance, some ADMB models can be tens of thousands of lines of code (e.g., [<xref rid="pone.0197954.ref016" ref-type="bibr">16</xref>, <xref rid="pone.0197954.ref017" ref-type="bibr">17</xref>]), or use features unavailable in Stan such as phased optimization. Likewise, TMB users may not want to abandon the marginal Laplace approximation as an option for frequentist inference in hierarchical models, either for philosophical or practical reasons. For instance, maximum marginal likelihood estimation with the Laplace approximation tends to be orders of magnitude faster, and thus useful during model development or for high-dimensional, challenging models. Despite this reluctance, ADMB and TMB users would benefit from fast MCMC sampling for a broad range of hierarchical models. An alternative approach is to add Stan-like capabilities (such as the NUTS algorithm and diagnostic tools) to ADMB and TMB models.</p>
    <p>Here, we introduce new software for running NUTS for ADMB and TMB models. The R package <monospace>adnuts</monospace> [<xref rid="pone.0197954.ref018" ref-type="bibr">18</xref>] provides NUTS sampling for ADMB models, while the package <monospace>tmbstan</monospace> [<xref rid="pone.0197954.ref019" ref-type="bibr">19</xref>] does the same for TMB. We detail their capabilities, demonstrate the methods on ecological examples, and contrast their performance against Stan. Adding state-of-the-art MCMC sampling to ADMB and TMB models allows users of these platforms an expanded toolset to better analyze data and gain deeper insights into natural processes.</p>
  </sec>
  <sec id="sec002">
    <title>Software implementation</title>
    <p>For HMC to be efficient, it needs fast and accurate gradient calculations for arbitrary log-posteriors. Stan accomplishes this with automatic differentiation [<xref rid="pone.0197954.ref020" ref-type="bibr">20</xref>]. Fortunately, both ADMB and TMB also have this capability for models built in their respective “template” languages. HMC also needs optimal trajectory lengths and step sizes, and information about the posterior shape via a ‘mass matrix’ (see section 4.1 of [<xref rid="pone.0197954.ref014" ref-type="bibr">14</xref>]). NUTS automatically produces nearly-optimal trajectory lengths [<xref rid="pone.0197954.ref021" ref-type="bibr">21</xref>], and tunes the optimal step size during warmup, while Stan introduced mass matrix adaptation during warmup (see section 34.2 of [<xref rid="pone.0197954.ref008" ref-type="bibr">8</xref>]).</p>
    <p>ADMB added HMC a decade ago, but it is rarely used due to tuning difficulties. However, it was a convenient starting place to build the basic NUTS framework (i.e., algorithm 6 in [<xref rid="pone.0197954.ref013" ref-type="bibr">13</xref>]). We then added diagonal mass matrix adaptation modeled after Stan’s. As the NUTS code is in the ADMB source, the capability is in the model executable, and can be called directly from the command line (although we discourage it). In contrast, we were able to link TMB directly to Stan using the class 'op_matrix_vari' of the <monospace>rstan</monospace> package [<xref rid="pone.0197954.ref022" ref-type="bibr">22</xref>]. Thus, the model objective (<monospace>fn</monospace>) and gradient (<monospace>gr</monospace>) functions are calculated by TMB but passed to Stan which executes the NUTS algorithm.</p>
    <p>Accompanying Stan is a suite of tools for diagnosing convergence of NUTS chains and performing inference. For instance, the <monospace>rstan</monospace> R package [<xref rid="pone.0197954.ref022" ref-type="bibr">22</xref>] contains functions to estimate effective sample sizes (ESS) and potential scale reduction factor <inline-formula id="pone.0197954.e001"><alternatives><graphic xlink:href="pone.0197954.e001.jpg" id="pone.0197954.e001g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M1"><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> [<xref rid="pone.0197954.ref023" ref-type="bibr">23</xref>], and plotting functions for examining chain behavior. ShinyStan is an interactive tool for visual and numerical summaries of model parameters, and is particularly useful for examining NUTS chains [<xref rid="pone.0197954.ref024" ref-type="bibr">24</xref>]. Since our goal was to provide broad, Stan-like functionality to ADMB and TMB users without converting models to a new language, we developed R packages to facilitate running NUTS and mirror Stan as closely as possible.</p>
    <sec id="sec003">
      <title>Summary of the <monospace>adnuts</monospace> R package</title>
      <p><monospace>adnuts</monospace> streamlines the workflow for ADMB users compared to command line execution, including parallel execution and post-processing in R. The <monospace>sample_admb</monospace> function can run both NUTS and Metropolis-Hastings algorithms, and can optionally evaluate the model in the ‘mceval’ phase on post-warmup samples from merged chains. The returned fits work with Stan diagnostic tools, including ShinyStan (<xref ref-type="table" rid="pone.0197954.t001">Table 1</xref>). In addition to adaptive diagonal mass matrix, the user can specify arbitrary dense mass matrices (or the estimated maximum likelihood covariance), which is a capability not currently available to Stan users. Thus, to use NUTS an ADMB user only needs to define a valid model (including adding priors and a proper posterior) and compilation by the newest ADMB version.</p>
      <table-wrap id="pone.0197954.t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0197954.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Summary of key functions from R packages.</title>
        </caption>
        <alternatives>
          <graphic id="pone.0197954.t001g" xlink:href="pone.0197954.t001"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="left" rowspan="1" colspan="1">Function</th>
                <th align="left" rowspan="1" colspan="1">Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <monospace>sample_admb</monospace>
                </td>
                <td align="left" rowspan="1" colspan="1">Run NUTS or RWM chains. Options include parallel chains, specification of the mass matrix, and fine tuning of the NUTS algorithm parameters. Returns a list containing samples (samples), NUTS meta data for each iteration (sampler_params), and other information.</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <monospace>extract_samples</monospace>
                </td>
                <td align="left" rowspan="1" colspan="1">Extract samples from fitted object, including flags whether to include warmup samples and the log posterior column.</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <monospace>launch_shinyadmb</monospace>
                </td>
                <td align="left" rowspan="1" colspan="1">Launch the interactive diagnostic tool ShinyStan for an ADMB fit for both NUTS and RWM chains.</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <monospace>extract_sampler_params</monospace>
                </td>
                <td align="left" rowspan="1" colspan="1">Extract NUTS trajectory metadata, such as acceptance probabilities, divergences, and tree depths.</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <monospace>pairs_admb</monospace>
                </td>
                <td align="left" rowspan="1" colspan="1">A modified pairs plot that works specifically for ADMB fits. Includes option to add a covariance matrix estimated by inverting the Hessian matrix evaluated at the maximum likelihood point, if it exists.</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <monospace>tmbstan</monospace>
                </td>
                <td align="left" rowspan="1" colspan="1">Wrapper to pass TMB model to function <monospace>stan</monospace> from the <monospace>rstan</monospace> package. The ‘laplace’ argument toggles the use of the Laplace approximation. Other arguments are passed on to <monospace>stan</monospace>.</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="t001fn001">
            <p>NUTS is the no-U-turn sampler and RWM is the random walk Metropolis algorithm (the original ADMB algorithm). All functions are from the <monospace>adnuts</monospace> package, except <monospace>tmbstan</monospace> which is from the <monospace>tmbstan</monospace> package.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec id="sec004">
      <title>Summary of the <monospace>tmbstan</monospace> R package</title>
      <p><monospace>tmbstan</monospace> facilitates linkage with the function <monospace>stan</monospace> while adding a few top-level options. Most importantly, univariate parameter bounds can also be passed to <monospace>tmbstan</monospace> as vectors (including one-sided constraints) which are then applied internally, with Jacobian adjustments, by Stan. Because <monospace>tmbstan</monospace> uses the <monospace>stan</monospace> function to sample, it returns an object of class ‘stanfit’ just like a Stan model and thus works with Stan tools automatically. Thus, getting a TMB model working with Stan only requires adding explicit priors.</p>
      <p>TMB uses the Laplace approximation to integrate random effects, but this is usually unnecessary in a Bayesian analysis because MCMC integrates all parameters. Therefore, by default TMB will ignore the declaration of integrated parameters, but this can be changed with the <monospace>tmbstan</monospace> argument ‘laplace’. When enabled, TMB integrates random effects while Stan integrates fixed effects with NUTS. The posterior distribution of the fixed effects will be the same whether the Laplace approximation is enabled or not, so long as the approximation is accurate. This approach can test the accuracy of the Laplace approximation, and we demonstrate it in our case studies.</p>
    </sec>
  </sec>
  <sec id="sec005">
    <title>Case studies</title>
    <sec id="sec006">
      <title>ADMB model: Swallows</title>
      <p>We demonstrate NUTS sampling in ADMB with the <italic>swallows</italic> model fitted to mark-recapture data from Grüebler and Naef-Daenzer [<xref rid="pone.0197954.ref025" ref-type="bibr">25</xref>] and further analyzed in section 14.5 of Korner-Nievergelt, Roth [<xref rid="pone.0197954.ref026" ref-type="bibr">26</xref>]. This model estimates state-space survival and detection with environmental covariates and three random effect components for a total of 5 fixed effects and 172 random effects.</p>
      <p>ADMB does not support one-sided constraints natively, so we included the variance parameters in log space, and used the exponentiated version in the log-density calculations. We included the necessary Jacobian adjustment for this transformation directly in the model code. We also used non-centered random effects which can perform better for HMC in hierarchical models [<xref rid="pone.0197954.ref012" ref-type="bibr">12</xref>, <xref rid="pone.0197954.ref027" ref-type="bibr">27</xref>, <xref rid="pone.0197954.ref028" ref-type="bibr">28</xref>]. See ‘Data Accessibility’ below for information on how to access the model files, data and reproducible R scripts used herein.</p>
      <p>We recommend placing the model executable and any necessary inputs files into a separate folder, here called ‘admb’. We begin with the default NUTS settings: 3 chains, target acceptance rate of 0.8, 2000 total iterations, 1000 warmup iterations, and adapted step size and adapted diagonal mass matrix. We also include optional arguments to run three chains on parallel cores.</p>
      <p>
        <monospace>fit &lt;- sample_admb(model = 'swallows', path = 'admb', init = inits,</monospace>
      </p>
      <p>
        <monospace>seeds = seeds, parallel = TRUE, cores = 3)</monospace>
      </p>
      <p>This model exhibits 4 divergent transitions (i.e., where the simulated Hamiltonian or total energy goes to infinity), so we rerun with an increased target acceptance rate to reduce step sizes with the argument <monospace>control = list(adapt_delta = 0.9)</monospace>. This is the recommended approach when models exhibit divergences (see section 34.4 of [<xref rid="pone.0197954.ref008" ref-type="bibr">8</xref>]). The model takes longer to run, but the divergences are eliminated. Using helper functions (<xref ref-type="table" rid="pone.0197954.t001">Table 1</xref>) we examine the fit:</p>
      <p>
        <monospace>sum(extract_sampler_params(fit)$divergent__)</monospace>
      </p>
      <p>
        <monospace>mon &lt;- monitor(fit$samples)</monospace>
      </p>
      <p>
        <monospace>launch_shinyadmb(fit)</monospace>
      </p>
      <p>Due to its complex hierarchical structure, this model was extremely difficult to fit using the traditional approach for MCMC in ADMB (results not shown). We also fit this model in Stan and TMB, and found that ADMB was approximately 88% as fast as Stan (via rstan), while TMB (with tmbstan) was 126% as fast (<xref ref-type="supplementary-material" rid="pone.0197954.s004">S1 Table</xref>). Thus, this complex hierarchical model posed no issues and ADMB was able to sample efficiently.</p>
    </sec>
    <sec id="sec007">
      <title>TMB model: Wildflower</title>
      <p>We demonstrate NUTS for TMB with the <monospace>tmbstan</monospace> package using a binomial generalized linear mixed effects model for flowering success of a perennial plant. This <italic>wildflower</italic> model uses a long-term data set (e.g., [<xref rid="pone.0197954.ref029" ref-type="bibr">29</xref>]) and was analyzed in Bolker, Gardner [<xref rid="pone.0197954.ref030" ref-type="bibr">30</xref>]. It includes three sets of random effects, two of which are crossed. As above, we used non-centered random effects and manually transformed the variance parameters. First, we compile and link the model as is normally done:</p>
      <p>
        <monospace>compile('wildflower.cpp')</monospace>
      </p>
      <p>
        <monospace>dyn.load(dynlib('wildflower'))</monospace>
      </p>
      <p>
        <monospace>random &lt;- c('yearInterceptEffect_raw', 'plantInterceptEffect_raw',</monospace>
      </p>
      <p>
        <monospace>'plantSlopeEffect_raw'),</monospace>
      </p>
      <p>
        <monospace>obj &lt;- MakeADFun(data = data, parameters = inits[[1]], random = random)</monospace>
      </p>
      <p>We use the <monospace>tmbstan</monospace> function to sample with Stan defaults, with initial values supplied as a list of lists.</p>
      <p>
        <monospace>options(mc.cores = 3)</monospace>
      </p>
      <p>
        <monospace>fit &lt;- tmbstan(obj = obj, chains = 3, init = inits)</monospace>
      </p>
      <p>
        <monospace>launch_shinystan(fit)</monospace>
      </p>
      <p>Setting the mc.cores option tells Stan to use three cores to sample in parallel. The random parameters declaration was ignored by default and they were integrated with NUTS, the same as the fixed effects. We rerun the analysis with the Laplace approximation turned on, such that Stan integrates the fixed effects with NUTS, and TMB integrates the random effects with the Laplace approximation.</p>
      <p>
        <monospace>fit.la &lt;- tmbstan(obj = obj, chains = 3, init = inits, laplace = TRUE)</monospace>
      </p>
      <p>Here, the Laplace approximation is done at each step of each NUTS trajectory such that Stan is unaware the random effects exist. The Bayesian posteriors for two of the fixed effects differ between these two model runs (<xref ref-type="fig" rid="pone.0197954.g001">Fig 1</xref>), suggesting the Laplace approximation assumptions are not met, to a degree. This could lead to bias in parameter estimates or uncertainties. In contrast, the <italic>swallows</italic> model did not exhibit this property (<xref ref-type="fig" rid="pone.0197954.g002">Fig 2</xref>). Although generally not recommended with NUTS, thinning may be necessary for such tests to ensure equivalent ESS between versions, otherwise comparisons may be misleading due to different mixing rates rather than true differences. Enabling the Laplace was less efficient than full MCMC integration for the two case studies here (<xref ref-type="supplementary-material" rid="pone.0197954.s005">S2 Table</xref>), but it is unclear whether this will typically be true.</p>
      <fig id="pone.0197954.g001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0197954.g001</object-id>
        <label>Fig 1</label>
        <caption>
          <title>Testing the Laplace approximation of the random effects.</title>
          <p>Bayesian integration was performed on the <italic>wildflower</italic> TMB model with random effects integrated using two “versions”: (1) the Laplace approximation and (2) full MCMC integration via NUTS. Bayesian posterior samples of selected fixed effects (estimated with NUTS) are shown. Columns and rows corresponds to a fixed effect parameter, with the diagonal showing a QQ-plot of the two versions of the model for that parameter, including a 1:1 line in gray. Lower diagonal plots contain pairwise parameter posterior points, with color corresponding to integration version, and larger colored circles the pairwise medians. Posterior rows were randomized to prevent consistent overplotting of one version. Differences in versions suggest the Laplace approximation assumptions are not met. Other fixed effects showed no differences and are left off for clarity.</p>
        </caption>
        <graphic xlink:href="pone.0197954.g001"/>
      </fig>
      <fig id="pone.0197954.g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0197954.g002</object-id>
        <label>Fig 2</label>
        <caption>
          <title>Testing the Laplace approximation integration of the random effects.</title>
          <p>Same as for <xref ref-type="fig" rid="pone.0197954.g001">Fig 1</xref> except for three hypervariances and a slope parameter in the <italic>swallows</italic> model.</p>
        </caption>
        <graphic xlink:href="pone.0197954.g002"/>
      </fig>
      <p>We also fit the <italic>wildflower</italic> model in Stan and ADMB, and found that ADMB was about 75% the speed of Stan, and TMB was 102% the speed. Thus, with only trivial changes to the TMB model template file, we obtained efficient Bayesian inference on a complex hierarchical model and tested the accuracy of the Laplace approximation.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec008">
    <title>Discussion</title>
    <p>Here we introduced new software which bring state-of-the-art MCMC integration to ADMB and TMB models with virtually no effort by the user. Efficiencies (i.e., effective samples per time) were relatively similar among platforms, typically within +/- 50% the speed of Stan (<xref ref-type="supplementary-material" rid="pone.0197954.s001">S1 Text</xref>). Despite this, there are some distinct advantages to doing Bayesian modeling in Stan.</p>
    <p>We do not anticipate future developments to the ADMB NUTS code, so future algorithm advances would be unavailable. This is already true, because Stan implements exhaustive HMC [<xref rid="pone.0197954.ref021" ref-type="bibr">21</xref>], but this feature was not included in ADMB. Since TMB uses the Stan algorithms directly, it will not have this problem. However, Stan was developed specifically for Bayesian inference and has features in its template language that TMB users cannot use. For instance, there are more complex parameter transformations with automatic Jacobian adjustments. Thus, purely Bayesian analyses would have clear advantages by using Stan.</p>
    <p>Whether individual models should be converted to Stan will depend. Many important ADMB models would be nearly impossible, due to extremely complex models with a suite of other software tools supporting them (e.g., [<xref rid="pone.0197954.ref016" ref-type="bibr">16</xref>]). For TMB, migrating to Stan means losing the ability to do the Laplace approximation on arbitrary subsets of parameters. Based on our performance tests (<xref ref-type="supplementary-material" rid="pone.0197954.s004">S1 Table</xref>, <xref ref-type="supplementary-material" rid="pone.0197954.s002">S1 Fig</xref>), substantial speed improvements by converting models to the Stan language is not guaranteed. ADMB and TMB users considering converting a model to Stan can now explore NUTS to better gauge the expected advantages.</p>
    <p>Hierarchical modeling is clearly a powerful modeling tool for exploring ecological processes in complex data [<xref rid="pone.0197954.ref001" ref-type="bibr">1</xref>]. Previously, these models were difficult to estimate in ADMB and hypervariances were often fixed arbitrarily, and penalized maximum likelihood employed. Now these models can be estimated efficiently in a Bayesian framework using NUTS. TMB can already fit mixed effects models using marginal maximum likelihood via the Laplace approximation, but now users can do a full Bayesian analysis as well. In addition, the Laplace approximation can be tested by running NUTS with it turned on and off (Figs <xref ref-type="fig" rid="pone.0197954.g001">1</xref> and <xref ref-type="fig" rid="pone.0197954.g002">2</xref>).</p>
  </sec>
  <sec sec-type="conclusions" id="sec009">
    <title>Conclusions</title>
    <p>These packages provide new estimation methods for thousands of existing models, primarily in ecological fields. We expect NUTS to be useful particularly within the fisheries science community, by converting penalized likelihood ADMB models to be fully Bayesian. TMB users now have access to two state-of-the-art forms of integration: the Laplace approximation and NUTS sampling as performed by Stan. We expect many analysts to adopt this framework given its flexibility in inference for a wide range of models. To our knowledge, TMB is the only software platform capable of toggling between integration tools so effortlessly. We believe that by adding powerful Bayesian integration capabilities to these two model building tools, analysts will have new tools to better investigate natural processes.</p>
  </sec>
  <sec sec-type="supplementary-material" id="sec010">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="pone.0197954.s001">
      <label>S1 Text</label>
      <caption>
        <title>Speed comparisons between ADMB, TMB, and Stan.</title>
        <p>Further details of how we compared the efficiency (effective samples per time) for a suite of models across the three software platforms.</p>
        <p>(DOCX)</p>
      </caption>
      <media xlink:href="pone.0197954.s001.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0197954.s002">
      <label>S1 Fig</label>
      <caption>
        <title>Results of simulation examples with increasing dimensionality.</title>
        <p>Rows show different metrics: runtime (in seconds) includes warmup and sampling iterations but not compilation, ESS is the minimum effective sample size, and efficiency is ESS/runtime. Columns show different models: <italic>zdiag</italic> is independent normal but variable variances, <italic>growth</italic> is a non-linear mixed effects model with increasing numbers of animals. Lines denote median across 30 chains intitialized from diffuse points.</p>
        <p>(PNG)</p>
      </caption>
      <media xlink:href="pone.0197954.s002.png">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0197954.s003">
      <label>S2 Fig</label>
      <caption>
        <title>Results of empirical models.</title>
        <p>Median and interquartile range (points and vertical lines) across 30 chains.</p>
        <p>(PNG)</p>
      </caption>
      <media xlink:href="pone.0197954.s003.png">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0197954.s004">
      <label>S1 Table</label>
      <caption>
        <title>Performance on empirical models of NUTS across three platforms using default settings.</title>
        <p>Efficiencies are relative to Stan for each model, across 30 replicates with the same diffuse initial conditions. Stan uses the package rstan, TMB models used package tmbstan and ADMB models package adnuts.</p>
        <p>(DOCX)</p>
      </caption>
      <media xlink:href="pone.0197954.s004.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0197954.s005">
      <label>S2 Table</label>
      <caption>
        <title>Performance of versions of inference for the swallows and wildflower model.</title>
        <p>The TMB models were estimated in three ways: marginal maximum likelihood with the Laplace approximation (MLE), Bayesian integration of all parameters with NUTS using tmbstan (Full Bayesian), and Bayesian integration of fixed effects using tmbstan while using the Laplace approximation for the random effects (Laplace).</p>
        <p>(DOCX)</p>
      </caption>
      <media xlink:href="pone.0197954.s005.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We thank Dave Fournier for help with the ADMB source code, and Johnoel Ancheta for help integrating the new functionality into ADMB. The Stan development community was extremely helpful, and we especially appreciate the openness of the project, without which our software would not be possible. We specifically thank Bob Carpenter and Michael Betancourt for helpful discussion on HMC and Stan in general, and Jonah Gabry for adding ShinyStan compatibility for ADMB models. We also thank Trevor Branch, Hans Skaug, and an anonymous reviewer for suggestions on improving earlier drafts.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0197954.ref001">
      <label>1</label>
      <mixed-citation publication-type="book"><name><surname>Royle</surname><given-names>JA</given-names></name>, <name><surname>Dorazio</surname><given-names>RM</given-names></name>. <source>Hierarchical modeling and inference in ecology: the analysis of data from populations, metapopulations and communities</source>: <publisher-name>Academic Press</publisher-name>; <year>2008</year>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Ellison</surname><given-names>AM</given-names></name>. <article-title>Bayesian inference in ecology</article-title>. <source>Ecol Lett</source>. <year>2004</year>;<volume>7</volume>(<issue>6</issue>):<fpage>509</fpage>–<lpage>20</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/j.1461-0248.2004.00603.x">10.1111/j.1461-0248.2004.00603.x</ext-link></comment></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Fournier</surname><given-names>DA</given-names></name>, <name><surname>Skaug</surname><given-names>HJ</given-names></name>, <name><surname>Ancheta</surname><given-names>J</given-names></name>, <name><surname>Ianelli</surname><given-names>J</given-names></name>, <name><surname>Magnusson</surname><given-names>A</given-names></name>, <name><surname>Maunder</surname><given-names>MN</given-names></name>, <etal>et al</etal><article-title>AD Model Builder: using automatic differentiation for statistical inference of highly parameterized complex nonlinear models</article-title>. <source>Optim Method Softw</source>. <year>2012</year>;<volume>27</volume>(<issue>2</issue>):<fpage>233</fpage>–<lpage>49</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1080/10556788.2011.597854">10.1080/10556788.2011.597854</ext-link></comment></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Skaug</surname><given-names>HJ</given-names></name>, <name><surname>Fournier</surname><given-names>DA</given-names></name>. <article-title>Automatic approximation of the marginal likelihood in non-Gaussian hierarchical models</article-title>. <source>Computational Statistics &amp; Data Analysis</source>. <year>2006</year>;<volume>51</volume>(<issue>2</issue>):<fpage>699</fpage>–<lpage>709</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.csda.2006.03.005">10.1016/j.csda.2006.03.005</ext-link></comment></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref005">
      <label>5</label>
      <mixed-citation publication-type="other">Skaug H, Fournier D, Nielsen A, Magnusson A. Generalized linear mixed models using AD Model Builder. R package version 0.7. 2012.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Kristensen</surname><given-names>K</given-names></name>, <name><surname>Nielsen</surname><given-names>A</given-names></name>, <name><surname>Berg</surname><given-names>CW</given-names></name>, <name><surname>Skaug</surname><given-names>H</given-names></name>, <name><surname>Bell</surname><given-names>BM</given-names></name>. <article-title>TMB: Automatic differentiation and Laplace approximation</article-title>. <source>J Stat Softw</source>. <year>2016</year>;<volume>70</volume>(<issue>5</issue>):<fpage>21</fpage> Epub 2016-04-04. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.18637/jss.v070.i05">10.18637/jss.v070.i05</ext-link></comment></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref007">
      <label>7</label>
      <mixed-citation publication-type="other">Kristensen K. TMB: General random effect model builder tool inspired by ADMB. R package version 1.7.13. 2018.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref008">
      <label>8</label>
      <mixed-citation publication-type="book"><collab>Stan Development Team</collab>. <source>Stan modeling language users guide and reference manual</source>, <edition>version 2.17.0</edition><year>2017</year>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Carpenter</surname><given-names>B</given-names></name>, <name><surname>Gelman</surname><given-names>A</given-names></name>, <name><surname>Hoffman</surname><given-names>MD</given-names></name>, <name><surname>Lee</surname><given-names>D</given-names></name>, <name><surname>Goodrich</surname><given-names>B</given-names></name>, <name><surname>Betancourt</surname><given-names>M</given-names></name>, <etal>et al</etal><article-title>Stan: A Probabilistic Programming Language</article-title>. <source>J Stat Softw</source>. <year>2017</year>;<volume>76</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>29</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.18637/jss.v076.i01">10.18637/jss.v076.i01</ext-link></comment></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref010">
      <label>10</label>
      <mixed-citation publication-type="book"><name><surname>Brooks</surname><given-names>S</given-names></name>, <name><surname>Gelman</surname><given-names>A</given-names></name>, <name><surname>Jones</surname><given-names>G</given-names></name>, <name><surname>Meng</surname><given-names>X-L</given-names></name>. <source>Handbook of Markov chain Monte Carlo</source>: <publisher-name>CRC Press</publisher-name>; <year>2011</year>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Plummer</surname><given-names>M</given-names></name>. <article-title>JAGS: A program for analysis of Bayesian graphical models using Gibbs sampling</article-title>. <source>Proceedings of the 3rd international workshop on distributed statistical computing</source>. <year>2003</year>;<volume>124</volume>:<fpage>125</fpage>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Monnahan</surname><given-names>CC</given-names></name>, <name><surname>Thorson</surname><given-names>JT</given-names></name>, <name><surname>Branch</surname><given-names>TA</given-names></name>. <article-title>Faster estimation of Bayesian models in ecology using Hamiltonian Monte Carlo</article-title>. <source>Methods in Ecology and Evolution</source>. <year>2017</year>;<volume>8</volume>(<issue>3</issue>):<fpage>339</fpage>–<lpage>48</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/2041-210X.12681">10.1111/2041-210X.12681</ext-link></comment></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Hoffman</surname><given-names>MD</given-names></name>, <name><surname>Gelman</surname><given-names>A</given-names></name>. <article-title>The no-U-turn sampler: adaptively setting path lengths in Hamiltonian Monte Carlo</article-title>. <source>J Mach Learn Res</source>. <year>2014</year>;<volume>15</volume>(<issue>1</issue>):<fpage>1593</fpage>–<lpage>623</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Neal</surname><given-names>RM</given-names></name>. <chapter-title>MCMC using Hamiltonian dynamics</chapter-title><source>Handbook of Markov Chain Monte Carlo</source>. <year>2011</year>;<volume>2</volume>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref015">
      <label>15</label>
      <mixed-citation publication-type="other">Betancourt M. A Conceptual Introduction to Hamiltonian Monte Carlo. arXiv preprint arXiv:170102434. 2017.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Methot</surname><given-names>RD</given-names></name>, <name><surname>Wetzel</surname><given-names>CR</given-names></name>. <article-title>Stock Synthesis: A biological and statistical framework for fish stock assessment and fishery management</article-title>. <source>Fish Res</source>. <year>2013</year>;<volume>142</volume>(<issue>0</issue>):<fpage>86</fpage>–<lpage>99</lpage>. <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.fishres.2012.10.012">http://dx.doi.org/10.1016/j.fishres.2012.10.012</ext-link>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Fournier</surname><given-names>DA</given-names></name>, <name><surname>Hampton</surname><given-names>J</given-names></name>, <name><surname>Sibert</surname><given-names>JR</given-names></name>. <article-title>MULTIFAN-CL: a length-based, age-structured model for fisheries stock assessment, with application to South Pacific albacore, <italic>Thunnus alalunga</italic></article-title>. <source>Can J Fish Aquat Sci</source>. <year>1998</year>;<volume>55</volume>(<issue>9</issue>):<fpage>2105</fpage>–<lpage>16</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref018">
      <label>18</label>
      <mixed-citation publication-type="other">Monnahan CC. adnuts: No-U-turn sampling for ADMB and TMB models. R package version 1.0.0. 2018.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref019">
      <label>19</label>
      <mixed-citation publication-type="other">Kristensen K. tmbstan: MCMC sampling for TMB models using Stan. R package version 1.0.0. 2018.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref020">
      <label>20</label>
      <mixed-citation publication-type="book"><name><surname>Griewank</surname><given-names>A</given-names></name>, <name><surname>Walther</surname><given-names>A</given-names></name>. <source>Evaluating derivatives: principles and techniques of algorithmic differentiation</source>: <publisher-name>Siam</publisher-name>; <year>2008</year>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref021">
      <label>21</label>
      <mixed-citation publication-type="other">Betancourt M. Identifying the optimal integration time in Hamiltonian Monte Carlo. arXiv preprint arXiv:160100225. 2016.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref022">
      <label>22</label>
      <mixed-citation publication-type="other">Stan Development Team. rstan: R interface to Stan. R package version 2.17.3. <ext-link ext-link-type="uri" xlink:href="http://mc-stan.org">http://mc-stan.org</ext-link>. 2018.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref023">
      <label>23</label>
      <mixed-citation publication-type="book"><name><surname>Gelman</surname><given-names>A</given-names></name>, <name><surname>Carlin</surname><given-names>JB</given-names></name>, <name><surname>Stern</surname><given-names>HS</given-names></name>, <name><surname>Rubin</surname><given-names>DB</given-names></name>. <source>Bayesian data analysis</source>: <publisher-name>Taylor &amp; Francis</publisher-name>; <year>2014</year>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref024">
      <label>24</label>
      <mixed-citation publication-type="other">Stan Development Team. shinystan: Interactive visual and numerical diagnostics and posterior analysis for Bayesian models. R package version 2.5.0. <ext-link ext-link-type="uri" xlink:href="http://mc-stan.org/">http://mc-stan.org/</ext-link>. 2018.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Grüebler</surname><given-names>MU</given-names></name>, <name><surname>Naef-Daenzer</surname><given-names>B</given-names></name>. <article-title>Survival benefits of post-fledging care: experimental approach to a critical part of avian reproductive strategies</article-title>. <source>Journal of Animal Ecology</source>. <year>2010</year>;<volume>79</volume>(<issue>2</issue>):<fpage>334</fpage>–<lpage>41</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/j.1365-2656.2009.01650.x">10.1111/j.1365-2656.2009.01650.x</ext-link></comment><?supplied-pmid 20059611?><pub-id pub-id-type="pmid">20059611</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref026">
      <label>26</label>
      <mixed-citation publication-type="book"><name><surname>Korner-Nievergelt</surname><given-names>F</given-names></name>, <name><surname>Roth</surname><given-names>T</given-names></name>, <name><surname>von Felten</surname><given-names>S</given-names></name>, <name><surname>Guélat</surname><given-names>J</given-names></name>, <name><surname>Almasi</surname><given-names>B</given-names></name>, <name><surname>Korner-Nievergelt</surname><given-names>P</given-names></name>. <source>Bayesian data analysis in ecology using linear models with R, BUGS, and Stan: including comparisons to frequentist statistics</source>: <publisher-name>Academic Press</publisher-name>; <year>2015</year>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref027">
      <label>27</label>
      <mixed-citation publication-type="journal"><name><surname>Betancourt</surname><given-names>M</given-names></name>, <name><surname>Girolami</surname><given-names>M</given-names></name>. <article-title>Hamiltonian Monte Carlo for hierarchical models</article-title>. <source>Current Trends in Bayesian Methodology with Applications</source>. <year>2015</year>:<volume>79</volume>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref028">
      <label>28</label>
      <mixed-citation publication-type="journal"><name><surname>Papaspiliopoulos</surname><given-names>O</given-names></name>, <name><surname>Roberts</surname><given-names>GO</given-names></name>, <name><surname>Skold</surname><given-names>M</given-names></name>. <article-title>A general framework for the parametrization of hierarchical models</article-title>. <source>Stat Sci</source>. <year>2007</year>;<volume>22</volume>(<issue>1</issue>):<fpage>59</fpage>–<lpage>73</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1214/088342307000000014">10.1214/088342307000000014</ext-link></comment></mixed-citation>
    </ref>
    <ref id="pone.0197954.ref029">
      <label>29</label>
      <mixed-citation publication-type="journal"><name><surname>Crone</surname><given-names>EE</given-names></name>, <name><surname>Lesica</surname><given-names>P</given-names></name>. <article-title>Causes of synchronous flowering in <italic>Astragalus scaphoides</italic>, an iteroparous perennial plant</article-title>. <source>Ecology</source>. <year>2004</year>;<volume>85</volume>(<issue>7</issue>):<fpage>1944</fpage>–<lpage>54</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0197954.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Bolker</surname><given-names>BM</given-names></name>, <name><surname>Gardner</surname><given-names>B</given-names></name>, <name><surname>Maunder</surname><given-names>M</given-names></name>, <name><surname>Berg</surname><given-names>CW</given-names></name>, <name><surname>Brooks</surname><given-names>M</given-names></name>, <name><surname>Comita</surname><given-names>L</given-names></name>, <etal>et al</etal><article-title>Strategies for fitting nonlinear ecological models in R, AD Model Builder, and BUGS</article-title>. <source>Methods in Ecology and Evolution</source>. <year>2013</year>;<volume>4</volume>(<issue>6</issue>):<fpage>501</fpage>–<lpage>12</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/2041-210X.12044">10.1111/2041-210X.12044</ext-link></comment></mixed-citation>
    </ref>
  </ref-list>
</back>
