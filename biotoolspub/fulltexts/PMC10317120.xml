<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.0 20120330//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Res</journal-id>
    <journal-id journal-id-type="hwp">genome</journal-id>
    <journal-id journal-id-type="publisher-id">GENOME</journal-id>
    <journal-title-group>
      <journal-title>Genome Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1088-9051</issn>
    <issn pub-type="epub">1549-5469</issn>
    <publisher>
      <publisher-name>Cold Spring Harbor Laboratory Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10317120</article-id>
    <article-id pub-id-type="pmid">37308294</article-id>
    <article-id pub-id-type="medline">9509184</article-id>
    <article-id pub-id-type="doi">10.1101/gr.277522.122</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methods</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Accurate integration of multiple heterogeneous single-cell RNA-seq data sets by learning contrastive biological variation</article-title>
      <alt-title alt-title-type="left-running">Zhou et al.</alt-title>
      <alt-title alt-title-type="right-running">scRNA-seq data integration and mapping via scInt</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Zhou</surname>
          <given-names>Yang</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sheng</surname>
          <given-names>Qiongyu</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Qi</surname>
          <given-names>Jing</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hua</surname>
          <given-names>Jiao</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yang</surname>
          <given-names>Bo</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Lei</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2318-432X</contrib-id>
        <name>
          <surname>Jin</surname>
          <given-names>Shuilin</given-names>
        </name>
      </contrib>
    </contrib-group>
    <aff>School of Mathematics, Harbin Institute of Technology, Harbin, Heilongjiang Province, China, 150001</aff>
    <author-notes>
      <corresp>Corresponding author: <email>jinsl@hit.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <volume>33</volume>
    <issue>5</issue>
    <fpage>750</fpage>
    <lpage>762</lpage>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>5</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>
        <ext-link xlink:href="http://genome.cshlp.org/site/misc/terms.xhtml" ext-link-type="uri">© 2023 Zhou et al.; Published by Cold Spring Harbor Laboratory Press</ext-link>
      </copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This article is distributed exclusively by Cold Spring Harbor Laboratory Press for the first six months after the full-issue publication date (see <ext-link ext-link-type="uri" xlink:href="https://genome.cshlp.org/site/misc/terms.xhtml">https://genome.cshlp.org/site/misc/terms.xhtml</ext-link>). After six months, it is available under a Creative Commons License (Attribution-NonCommercial 4.0 International), as described at <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="750.pdf"/>
    <abstract>
      <p>For most biological and medical applications of single-cell transcriptomics, an integrative study of multiple heterogeneous single-cell RNA sequencing (scRNA-seq) data sets is crucial. However, present approaches are unable to integrate diverse data sets from various biological conditions effectively because of the confounding effects of biological and technical differences. We introduce single-cell integration (scInt), an integration method based on accurate, robust cell–cell similarity construction and unified contrastive biological variation learning from multiple scRNA-seq data sets. scInt provides a flexible and effective approach to transfer knowledge from the already integrated reference to the query. We show that scInt outperforms 10 other cutting-edge approaches using both simulated and real data sets, particularly in the case of complex experimental designs. Application of scInt to mouse developing tracheal epithelial data shows its ability to integrate development trajectories from different developmental stages. Furthermore, scInt successfully identifies functionally distinct condition-specific cell subpopulations in single-cell heterogeneous samples from a variety of biological conditions.</p>
    </abstract>
    <funding-group>
      <award-group id="funding-1">
        <funding-source>
          <institution-wrap>
            <institution>National Natural Science Foundation of China </institution>
            <institution-id institution-id-type="doi">10.13039/501100001809</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>62271173</award-id>
        <award-id>11971130</award-id>
        <award-id>62172122</award-id>
      </award-group>
      <award-group id="funding-2">
        <funding-source>Interdisciplinary Research Foundation of HIT</funding-source>
        <award-id>IR2021109</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="13"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>In investigating the gene expression heterogeneity in single cells, single-cell RNA sequencing (scRNA-seq) offers enormous advantages over traditional transcriptome sequencing techniques. It also shows huge potential in many biological and medical fields to shed light on the internal behavior of complex organisms, such as developing brain tissue (<xref rid="GR277522ZHOC26" ref-type="bibr">Patel et al. 2014</xref>; <xref rid="GR277522ZHOC36" ref-type="bibr">Wang and Navin 2015</xref>; <xref rid="GR277522ZHOC5" ref-type="bibr">Björklund et al. 2016</xref>; <xref rid="GR277522ZHOC37" ref-type="bibr">Wang et al. 2017</xref>; <xref rid="GR277522ZHOC25" ref-type="bibr">Papalexi and Satija 2018</xref>; <xref rid="GR277522ZHOC30" ref-type="bibr">Rosenberg et al. 2018</xref>). To get thorough interpretations of a specific biological process, integrative analysis of multiple data sets from various biological and technical conditions is a key step. The characterization of biological heterogeneity across different biological conditions is still difficult, nonetheless, as a result of the confusion of biological and technical variation (also known as batch effects).</p>
  <p>To meet the unprecedented computational challenge, several strategies have been developed (<xref rid="GR277522ZHOC11" ref-type="bibr">Haghverdi et al. 2018</xref>; <xref rid="GR277522ZHOC2" ref-type="bibr">Barkas et al. 2019</xref>; <xref rid="GR277522ZHOC13" ref-type="bibr">Hie et al. 2019</xref>; <xref rid="GR277522ZHOC18" ref-type="bibr">Korsunsky et al. 2019</xref>; <xref rid="GR277522ZHOC32" ref-type="bibr">Stuart et al. 2019</xref>; <xref rid="GR277522ZHOC39" ref-type="bibr">Welch et al. 2019</xref>; <xref rid="GR277522ZHOC28" ref-type="bibr">Polański et al. 2020</xref>; <xref rid="GR277522ZHOC8" ref-type="bibr">Gao et al. 2021</xref>; <xref rid="GR277522ZHOC20" ref-type="bibr">Liu et al. 2021</xref>; <xref rid="GR277522ZHOC42" ref-type="bibr">Zhang and Nie 2021</xref>), mostly using two alternative methodologies: removing the difference between identified (i) similar cells and (ii) shared cell types across batches. Mutual nearest neighbor (MNN) (<xref rid="GR277522ZHOC11" ref-type="bibr">Haghverdi et al. 2018</xref>) is a common method that serves as the basis for numerous integration techniques for similar-cells-based methods. It searches MNN pairs across batches and treats these in-pair cells as being in the same cell states so that they can be gathered in the following phase. Scanorama (<xref rid="GR277522ZHOC13" ref-type="bibr">Hie et al. 2019</xref>), Seurat v3 (<xref rid="GR277522ZHOC32" ref-type="bibr">Stuart et al. 2019</xref>), BBKNN (<xref rid="GR277522ZHOC28" ref-type="bibr">Polański et al. 2020</xref>), Conos (<xref rid="GR277522ZHOC2" ref-type="bibr">Barkas et al. 2019</xref>), and the fast version of MNN called fastMNN (<xref rid="GR277522ZHOC11" ref-type="bibr">Haghverdi et al. 2018</xref>) use the same strategy, with searching MNN pairs in dimensionally reduced spaces such as canonical correlation analysis (CCA) or principal component analysis (PCA) space, instead of in the original gene expression space directly. Among these, BBKNN and Conos build global neighborhood graphs across all batches, which are used directly for the downstream analysis. Methods based on the identification of shared cell types include Harmony (<xref rid="GR277522ZHOC18" ref-type="bibr">Korsunsky et al. 2019</xref>), LIGER (<xref rid="GR277522ZHOC39" ref-type="bibr">Welch et al. 2019</xref>), and scMC (<xref rid="GR277522ZHOC42" ref-type="bibr">Zhang and Nie 2021</xref>). Harmony iteratively uses maximum batch diversity clustering and cell-specific linear correction using a mixture model in the PCA embedding. The integrative non-negative matrix factorization (iNMF) method yields a low-dimensional matrix that LIGER uses to perform joint clustering and quantile normalization procedures. scMC assigns the shared cell types across batches and eliminates differences between any two groups of “confident cells” of shared cell types. Incorrect connections between genetically similar cell types, particularly in the integration scenario with imbalanced cell type compositions across batches, could, however, disrupt either strategy. Recent benchmarking studies (<xref rid="GR277522ZHOC34" ref-type="bibr">Tran et al. 2020</xref>; <xref rid="GR277522ZHOC21" ref-type="bibr">Luecken et al. 2022</xref>) also revealed the inferior performance of these approaches on complex integration tasks.</p>
  <p>To address these problems, we present an integration model named <underline>s</underline>ingle-<underline>c</underline>ell <underline>Int</underline>egration based on unified contrastive biological variation learning (scInt). scInt offers several salient features as follows. First, instead of directly calculating the similarities between cells based on Euclidean distance, as most approaches do, scInt uses a similarity measure based on a cluster-specific exponential kernel, capturing both the inter- and intrabatch similarity structures. Second, scInt filters the incorrect connections of the cell similarity relationships using the contrastive principal component analysis (cPCA) method (<xref rid="GR277522ZHOC1" ref-type="bibr">Abid et al. 2018</xref>), a potent tool for identifying the minute differences between two data sets. Third, scInt has developed a unified framework for learning contrastive biological variation that allows for the global integration of multiple scRNA-seq data sets and the knowledge transfer from already integrated reference data to newly arrived query data. We benchmark scInt and other state-of-the-art methods in integration and reference-based mapping tasks using both simulated and real data. We also apply scInt to several integrative analyses on real data sets under various scenarios to show the capability of identifying condition-specific cell subpopulations across multiple heterogeneous data sets.</p>
  <sec sec-type="results" id="s1">
    <title>Results</title>
    <sec id="s1a">
      <title>scInt uniformly learns the contrastive biological variation for data integration</title>
      <p>scInt aims to integrate multiple scRNA-seq data sets that may be generated from different conditions, species, or technologies (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>A,B). Specifically, for each cell, scInt searches the most similar cells in its remaining batches, by computing the similarities based on inter- and intrabatch similarity structures (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>C; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S1</ext-link>; Methods). Then, scInt uses the cPCA technique to distinguish the different genetic states across batches and filter the incorrect cell–cell connections (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>C; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S1</ext-link>; Methods). The difference vectors between all cells and their similar cells are regarded as the invisible data introduced by the technical variation. Thus, the contrastive biological variation can be learned by applying cPCA to the gene expression matrix and the difference matrix. Finally, using this contrastive biological variation, scInt performs global integration for all batches, resulting in a joint embedding served as the input of various downstream analysis tasks (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>D). In addition, under the same contrastive biological variation learning framework, the reference-based data integration is available to scInt (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>E; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S2</ext-link>; Methods), allowing flexible integrative analysis of multiple scRNA-seq data sets in biological and medical applications.</p>
      <fig position="float" id="GR277522ZHOF1">
        <label>Figure 1.</label>
        <caption>
          <p>Overview of the scInt method. (<italic>A</italic>) scInt integrates multiple scRNA-seq batches that may come from different conditions, species, or technologies. (<italic>B</italic>) Three heterogeneous batches. Batches and cell types are represented by different colors and shapes, respectively. The dashed cell groups represent the same cell types with different transcriptomic states. (<italic>C</italic>) Cell–cell similarity construction. Similarities based on a cluster-specific exponential kernel are identified and further filtered in the cPCA space. (<italic>D</italic>,<italic>E</italic>) Integration and reference-based mapping of multiple batches. A unified contrastive biological variation learning framework is used for integration (<italic>D</italic>) and reference-based mapping (<italic>E</italic>).</p>
        </caption>
        <graphic xlink:href="750f01" position="float"/>
      </fig>
    </sec>
    <sec id="s1b">
      <title>Benchmark of scInt and other state-of-the-art methods using simulated and real transcriptome data</title>
      <p>We first benchmarked scInt against 10 state-of-the-art methods using the simulated and real data under different integration scenarios with ground-truth cell type labels (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S3–S5</ext-link>). We applied the uniform manifold approximation and projection (UMAP) algorithm (<xref rid="GR277522ZHOC4" ref-type="bibr">Becht et al. 2019</xref>) to visualize the integrated single-cell data. To evaluate the performance of the overall batch effect removal and biological signals reservation of integration results, we used two scoring metrics: the adjusted Rand index (ARI) (<xref rid="GR277522ZHOC14" ref-type="bibr">Hubert and Arabie 1985</xref>) and the average silhouette width (ASW) (<xref rid="GR277522ZHOC6" ref-type="bibr">Büttner et al. 2019</xref>; Methods). We also used the inverse Simpson's index (LISI) (<xref rid="GR277522ZHOC18" ref-type="bibr">Korsunsky et al. 2019</xref>) to assess the local separation of cell types and the local mixing of batches (i.e., cell type LISI and batch LISI; Methods).</p>
      <fig position="float" id="GR277522ZHOF2">
        <label>Figure 2.</label>
        <caption>
          <p>Benchmarking scInt against other methods using simulated and real data. (<italic>A</italic>) UMAP visualizations of simulation 1 before and after integration by scInt, Seurat, Harmony, RPCI, and online iNMF. Cells are colored by batch labels (<italic>top</italic> row) and cell type labels (<italic>bottom</italic> row). (<italic>B</italic>) UMAP visualizations of the human dendritic data before and after integration by scInt, Seurat, Harmony, RPCI, and online iNMF. (<italic>C</italic>) The comparison of evaluation metrics, including ARI, batch ASW, cell type LISI, and batch LISI, of the integrated results on simulation 1. (<italic>D</italic>) The comparison of evaluation metrics, including ARI, batch ASW, cell type LISI, and batch LISI, of the integrated results on human dendritic data.</p>
        </caption>
        <graphic xlink:href="750f02" position="float"/>
      </fig>
      <p>First, we considered the integration scenario with unbalanced cell subpopulation compositions and rare cell subpopulations across batches. We generated simulation 1 with the Splatter R package (<xref rid="GR277522ZHOC41" ref-type="bibr">Zappia et al. 2017</xref>) (see <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link> for details). It contains six cell subpopulations and three batches, with five subpopulations in batch 1, four in batch 2, and four in batch 3 (the first column of <xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>A). Furthermore, Group5 is the unique cell subpopulation in batch 1, and Group6 is a rare cell subpopulation in batch 3. Cells within the same cell subpopulations across different batches presented distinct clusters in the unintegrated data, suggesting severe batch effects (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>A). Scanorama and scInt succeeded in integrating all these three batches, and preserved the cellular identities of Group5 and Group6, leading to higher batch removal and cell type conservation scores (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>C; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S3A</ext-link>). The other methods, on the other hand, either failed to capture the rare cell subpopulations, such as Seurat, or failed to integrate several cell subpopulations, such as Harmony (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>A). Additionally, we also used two simulated data sets (simulations 2 and 3, see <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link> for details), proposed by a recent benchmark study (<xref rid="GR277522ZHOC21" ref-type="bibr">Luecken et al. 2022</xref>), to further evaluate the performance of scInt against other methods. It showed that scInt outperformed other methods, removing the batch effects correctly, whereas preserving the simulated cell subpopulation heterogeneity (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S4, S5</ext-link>). Especially for simulation 3, which contained complex and nested batch effects, only RPCI, MNN, fastMNN, scMC, and scInt successfully integrated the data (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S5</ext-link>). Among these five methods, scInt well mixed all batches and achieved the highest evaluation metric scores.</p>
      <p>Second, we assessed the integration performance on real data of human dendritic cells (DCs) (<xref rid="GR277522ZHOC35" ref-type="bibr">Villani et al. 2017</xref>). This data consists of unbalanced cell subpopulations: CD141, double negative cells (DoubleNeg), and plasmacytoid DC (pDC) cells in batch 1, CD1C, DoubleNeg, and pDC cells in batch 2, where CD141 and CD1C are biologically similar cell types. Only RPCI, online iNMF, and scInt discriminated CD141 and CD1C cells whereas integrating other shared cell types (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>B). Other methods, such as Seurat, connected CD141 and CD1C cells improperly (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>B). For the integration performance scores, scInt achieved the highest level of batch mixing and cell type separability scores (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>D; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S3B</ext-link>).</p>
    </sec>
    <sec id="s1c">
      <title>scInt efficiently maps new data onto already integrated data</title>
      <p>Next, we evaluated the ability of scInt to map new data onto already integrated data using two reference-based mapping tasks. We compared scInt with three well-known approaches, including Seurat v4 (<xref rid="GR277522ZHOC12" ref-type="bibr">Hao et al. 2021</xref>), Symphony (<xref rid="GR277522ZHOC15" ref-type="bibr">Kang et al. 2021</xref>), and online iNMF, using both simulated and real data. Our proposed “global” mapping differs slightly from the other three approaches. For each reference-based mapping task, scInt incorporates new contrastive biological variations of the query and learns a new variation matrix. Thus, it differs from the other approaches in that the learned projection matrix and resulting joint low-dimensional space are different each time.</p>
      <p>In the first mapping task, we tested if scInt could map multiple query batches onto the reference data whereas successfully mapping the rare cell subpopulation. We selected batches 1–3 of simulation 2 (containing 7450 cells) as the reference data and batches 4–6 of simulation 2 (containing 4647 cells) as the query data. Meanwhile, Group7 is a rare cell subpopulation within batches 2 and 5. Seurat and scInt effectively eliminated the batch effects of the raw data and delivered well-built references (the top row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>A). However, online iNMF mixed a small number of Group3 cells with Group1, and Symphony showed a mixture of cells between Group5 and Group7 in the reference integration. For reference-based mapping, online iNMF and scInt precisely mapped the query onto the reference (the bottom row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>A). In contrast, Seurat and Symphony well mapped all except Group7 of the cell subpopulations. We used a 5-NN classifier to predict the labels of the query cells in the joint low-dimensional embedding of reference and query data and calculated the prediction F1 score and accuracy (ACC) of each label to evaluate the prediction performance of mapping results (Methods). scInt accurately predicted all labels of query cells (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S6A</ext-link>), obtaining a mean cell type F1 score of 1 and an overall accuracy of 1 (<xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>B). In contrast, online iNMF and Symphony showed some incorrect label predictions because of the mixture of different cell subpopulations in the reference integration, and Seurat incorrectly connected Group5 and Group7, leading to lower mean cell type F1 and overall accuracy scores.</p>
      <fig position="float" id="GR277522ZHOF3">
        <label>Figure 3.</label>
        <caption>
          <p>Benchmarking scInt against other methods in the reference-based integration tasks. (<italic>A</italic>) UMAP visualizations of the density of integrated reference cells (<italic>top</italic> row) and the scatters of mapped query cells (<italic>bottom</italic> row) of simulation 2, from scInt, Seurat, Symphony, and online iNMF. Cells are colored by ground-truth cell type labels, with gray shadows representing the reference. (<italic>B</italic>) Heatmap comparing the 5-NN predicted labels (columns) and the original labels (rows) of the query. The color bar indicates the proportion of query cells per original cell type label that was predicted to be for each reference label (rows sum to 1). (<italic>C</italic>) UMAP visualizations of the density of integrated reference cells (<italic>top</italic> row) and the scatters of mapped query cells (<italic>bottom</italic> row) of the human pancreas data, from scInt, Seurat, Symphony, and online iNMF. Cells are colored by ground-truth cell type labels, with gray shadows representing the reference. The mast cells are the unique cell type in the query data and are colored dark purple. (<italic>D</italic>) Heatmap comparing the 5-NN predicted labels (columns) and the original labels (rows) of the query.</p>
        </caption>
        <graphic xlink:href="750f03" position="float"/>
      </fig>
      <p>To further assess the ability of mapping real scRNA-seq data, we applied scInt to the reference-based mapping task of multiple human pancreas data sets. The pancreas batches 1–4 were profiled with four different plate-based sequencing technologies (Fluidigm C1, CEL-Seq, CEL-Seq2, and Smart-seq2, respectively) (<xref rid="GR277522ZHOC9" ref-type="bibr">Grün et al. 2016</xref>; <xref rid="GR277522ZHOC23" ref-type="bibr">Muraro et al. 2016</xref>; <xref rid="GR277522ZHOC31" ref-type="bibr">Segerstolpe et al. 2016</xref>; <xref rid="GR277522ZHOC19" ref-type="bibr">Lawlor et al. 2017</xref>), and batches 5–8 were profiled with inDrop (<xref rid="GR277522ZHOC3" ref-type="bibr">Baron et al. 2016</xref>), which was a droplet-based technology. Thus, we selected pancreas batches 1–4 (containing 5887 cells) as the reference data and the remaining four batches (containing 8569 cells) as the query data to test if scInt could overcome the interplatform effects. In addition, batches 1–4 contained two rare cell types, including epsilon cells (7 cells) and immune cells (27 cells), which made both the reference integration and mapping tasks more challenging. Seurat, Symphony, and scInt successfully removed the batch effects and detected both rare cell types in the reference integration (the top row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>C). However, online iNMF showed a mixture of cells between rare cell types and other cell types. Further, Seurat, Symphony, and scInt succeeded in overcoming the interplatform effects and mapping query cells onto the reference whereas preserving the unique cell identity of mast cells (the bottom row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>C). Among these methods, scInt achieved the best performance in the cell type prediction by the 5-NN classifier in the joint embedding (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S6B</ext-link>), with a mean cell type F1 score of 0.96 and an overall accuracy of 0.95 (<xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>D). We also performed these two reference-based mapping tasks using our alternative mapping models, achieving performance comparable to the default “global” model (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S7</ext-link>).</p>
    </sec>
    <sec id="s1d">
      <title>scInt reveals integrated trajectories of mouse developing tracheal epithelial data</title>
      <p>We further applied scInt to integrate multiple developmental batches coming from different time points and evaluated its ability in developmental trajectory discovery. In such a scenario, continuous transcriptional state evolution would hinder the identification of similar cells or cell types across time points. Additionally, the shared cell types between batches may be quite limited, resulting in unbalanced cell type compositions.</p>
      <p>We analyzed 3508 mouse developing tracheal epithelial cells at six time points from embryonic day E12.5 to E18.5 (<xref rid="GR277522ZHOC17" ref-type="bibr">Kiyokawa et al. 2021</xref>). The raw data showed severe batch effects across time points, with cells separated by time points (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S8</ext-link>). After scInt integration, cells were well mixed across time points (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>A), and the major cell types were revealed by the canonical markers (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>B): basal cells (<italic>Krt5</italic>), ciliated cells (<italic>Foxj1</italic>), club cells (<italic>Scgb1a1</italic>), NE cells (<italic>Ascl1</italic>), KRT17<sup>+</sup> and KRT17<sup>−</sup> progenitors (<italic>Krt17</italic>, <italic>Scgb3a2</italic>), and proliferative cells (<italic>Mki67</italic>). We also tested the other methods on this data. Among these methods, MNN, fastMNN, Harmony, and scMC successfully integrated batches across multiple time points, distinguishing most cell types (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S8</ext-link>). Other methods, however, showed mixtures of several cell types. We also used Monocle 3 (<xref rid="GR277522ZHOC7" ref-type="bibr">Cao et al. 2019</xref>) to infer the trajectories of the integrated data by scInt and other methods (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S9</ext-link>). Compared to other methods, scInt revealed clear developmental trajectories and yielded pseudotime inference results consistent with the actual developmental stages of epithelial cells.</p>
      <fig position="float" id="GR277522ZHOF4">
        <label>Figure 4.</label>
        <caption>
          <p>scInt reveals integrated trajectories of mouse developing tracheal epithelial data. (<italic>A</italic>) UMAP visualizations of the mouse developing tracheal epithelial cells in the scInt-integrated data (from E12.5 to E18.5). Cells are colored by time points (<italic>left</italic>) and cell types (<italic>right</italic>). (<italic>B</italic>) Overlay of the expression patterns of cell type marker genes onto the UMAP space. (<italic>C</italic>) PHATE visualizations for all cells except proliferative cells. Cells are colored by time points (<italic>left</italic>) and cell types (<italic>right</italic>). The arrows indicate the directions of the trajectories. (<italic>D</italic>) Overlay of the expression patterns of <italic>Krt17</italic> and <italic>Scgb3a2</italic> onto the PHATE space.</p>
        </caption>
        <graphic xlink:href="750f04" position="float"/>
      </fig>
      <p>In the original study, Kiyokawa et al. found that <italic>Krt17</italic> can serve as a marker for the intermediate cell population in the basal cell lineage, and KRT17<sup>+</sup> progenitors contribute to the mature epithelial cells, including basal, club, and ciliated cells. To test whether integration methods could reveal this developmental process, we extracted all cells other than proliferative cells and performed the potential of heat diffusion for affinity-based transition embedding (PHATE) algorithm (<xref rid="GR277522ZHOC22" ref-type="bibr">Moon et al. 2019</xref>) to visualize the trajectory structure of the integrated data. scInt-integrated data could generate a global trajectory structure from E14.5 to E18.5 and presented a clear differentiation process from the KRT17<sup>−</sup> progenitors to three kinds of mature epithelial cells (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>C). The expression of the identified marker of intermediate progenitors, <italic>Krt17</italic>, was abundant in the differentiation of basal cells, indicating its important role in the commitment to mature basal cells (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>D). In contrast, <italic>Scgb3a2</italic> showed abundance mainly in the differentiation of the other two kinds of mature epithelial cells (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>D). The expression patterns of <italic>Krt17</italic> and <italic>Scgb3a2</italic> may indicate the binary cell fate decision in the tracheal epithelial maturation. Meanwhile, we performed PHATE visualization on the integrated results of other methods. As shown in <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figure S10</ext-link>, these methods either failed to preserve the clear differentiation trajectory or mixed distinct cell types incorrectly. In general, scInt successfully integrated the developmental trajectories of mouse developing tracheal epithelial cells, revealing insights into cell lineage evolution.</p>
    </sec>
    <sec id="s1e">
      <title>scInt reveals DiHS/DRESS-specific cell subpopulations</title>
      <p>We then tested the capability of scInt for detecting across-condition biological differences. We applied scInt to a scRNA-seq data set containing 20,415 cells from seven human skin samples from a drug-induced hypersensitivity syndrome/drug reaction with eosinophilia and systemic symptoms (DiHS/DRESS) donor and five healthy controls (<xref rid="GR277522ZHOC16" ref-type="bibr">Kim et al. 2020</xref>). Moreover, the samples in this data were assayed with 10x Genomics and prepared using different library construction protocols: 3′ (DiHS/DRESS, HV4, and HV5 samples), 5′ (HV1 replicates 1, 2, HV2, and HV3 samples). The raw data showed discrete populations of most cells across different technologies and conditions (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S11</ext-link>).</p>
      <p>The original study found that the DiHS/DRESS and healthy lymphocytes were enriched with different signature genes and biological processes, indicating the existence of condition-specific cell subpopulations. To test whether integration methods could reveal the differences between condition-specific cell subpopulations, we integrated the human DiHS/DRESS and healthy skin data using scInt and other methods. scInt separated most cell types annotated by the high expression of typical marker genes, including endothelium (<italic>PECAM1</italic>), fibroblast (<italic>DCN</italic>), keratinocyte (<italic>KRT1</italic>, <italic>KRT5</italic>), lymphocyte (<italic>CD3E</italic>), melanocyte (<italic>PMEL</italic>), myeloid (<italic>FCER1G</italic>), and pericyte/SM (pericyte/smooth muscle, <italic>RGS5</italic>), well mixing the cells across technologies and conditions (<xref rid="GR277522ZHOF5" ref-type="fig">Fig. 5</xref>A–C). In addition to lymphocytes, keratinocytes also displayed condition-specific localization in the UMAP space, indicating the transcriptional differences of keratinocytes across disease statuses. scInt successfully differentiated the DiHS/DRESS and healthy lymphocyte and keratinocyte subpopulations (<xref rid="GR277522ZHOF5" ref-type="fig">Fig. 5</xref>B). However, for other methods, only scMC could distinguish all four of these condition-specific cell types while well mixing other cell types (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S11</ext-link>). We evaluated the performance of these integration results using ARI, batch ASW, cell type LISI, and batch LISI scores, as well as the mean label F1 and label silhouette scores of these four condition-specific cell subpopulations. Compared with other methods, scInt obtained the best overall scores (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S12A–C</ext-link>).</p>
      <fig position="float" id="GR277522ZHOF5">
        <label>Figure 5.</label>
        <caption>
          <p>scInt reveals DiHS/DRESS-specific cell subpopulations. (<italic>A</italic>,<italic>B</italic>) UMAP visualizations of the human DiHS/DRESS and healthy skin cells in the scInt-integrated data. Cells are colored by batches, technologies (<italic>A</italic>), and annotated cell labels (<italic>B</italic>) determined in the scInt-integrated data by examining the expression patterns of known markers. (<italic>C</italic>) Overlay of the expression patterns of cell type marker genes onto the UMAP space. (<italic>D</italic>) Heatmap of the top 10 differentially expressed genes of the DiHS/DRESS and healthy lymphocyte subpopulations. (<italic>E</italic>) The top 10 enriched GO biological processes associated with the DiHS/DRESS and healthy lymphocyte subpopulations.</p>
        </caption>
        <graphic xlink:href="750f05" position="float"/>
      </fig>
      <p>We then performed differential expression analysis, as well as functional enrichment analysis, on these two groups of condition-specific cell subpopulations (healthy lymphocyte I and DiHS/DRESS lymphocyte II cells, healthy keratinocyte I and DiHS/DRESS keratinocyte II cells) using the clusterProfiler R package (<xref rid="GR277522ZHOC40" ref-type="bibr">Yu et al. 2012</xref>). We found that different genes and biological processes were enriched in lymphocytes specific to DiHS/DRESS and healthy individuals (<xref rid="GR277522ZHOF5" ref-type="fig">Fig. 5</xref>D,E). The DiHS/DRESS-specific lymphocytes were enriched with genes involved in T cell activation and cell–cell adhesion, indicating the key role of the lymphocyte population in the drug-specific immune response in DiHS/DRESS syndrome, which was consistent with previous observations (<xref rid="GR277522ZHOC24" ref-type="bibr">Nyfeler and Pichler 1997</xref>; <xref rid="GR277522ZHOC27" ref-type="bibr">Pichler and Tilch 2004</xref>; <xref rid="GR277522ZHOC16" ref-type="bibr">Kim et al. 2020</xref>). In addition, neutrophil activation and neutrophil mediated immunity pathways, which play key roles in innate immunity, were enriched in the DiHS/DRESS keratinocytes (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S12D</ext-link>). The aforementioned results together show that scInt can reveal condition-specific cell subpopulations and their biological function differences between biological conditions.</p>
    </sec>
    <sec id="s1f">
      <title>scInt reveals inflammation-related mechanisms in the COVID-19 data</title>
      <p>Lastly, we showed the potential of scInt in integrating complex real scRNA-seq data from distinct biological conditions. We applied scInt to a single-cell RNA-seq data set with 67,362 peripheral blood mononuclear cells (PBMCs) from three conditions (healthy, remission, and severe) and 12 batches (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Table S1</ext-link>; <xref rid="GR277522ZHOC10" ref-type="bibr">Guo et al. 2020</xref>). It showed that there were severe batch effects across batches, especially across COVID-19 and healthy samples in the raw data (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>A).</p>
      <fig position="float" id="GR277522ZHOF6">
        <label>Figure 6.</label>
        <caption>
          <p>scInt reveals inflammatory-related mechanisms in the COVID-19 data. (<italic>A</italic>,<italic>B</italic>) UMAP visualizations of the COVID-19 PBMC data in the raw data (<italic>A</italic>) and scInt-integrated data (<italic>B</italic>). Cells are colored by batches and COVID-19 stage conditions. (<italic>C</italic>) UMAP visualizations of the scInt-integrated data. Cells are colored by identified cell types. (<italic>D</italic>) Stacked violin plot of the top-important marker gene expression for each cell type. (<italic>E</italic>) Overlay of the expression patterns of the cytokine storm-related and inflammation-related chemokine genes in the CD14<sup>+</sup> monocytes. (<italic>F</italic>) The top 10 enriched GO biological processes associated with cluster 9 and other CD14<sup>+</sup> monocytes.</p>
        </caption>
        <graphic xlink:href="750f06" position="float"/>
      </fig>
      <p>After scInt integration, cells were well mixed across batches and conditions (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>B). We performed Leiden graph-based clustering (<xref rid="GR277522ZHOC33" ref-type="bibr">Traag et al. 2019</xref>) onto the scInt-integrated data, identifying 20 clusters (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S13</ext-link>). We manually annotated 14 cell types including B cells, plasma B cells, monocytes (CD14<sup>+</sup> and CD16<sup>+</sup> monocytes), T cells (naive CD4<sup>+</sup>, effector CD4<sup>+</sup>, naive CD8<sup>+</sup>, effector CD8<sup>+</sup>, MKI67<sup>+</sup> CD8<sup>+</sup>, and γδ T cells), natural killer cells (NK), platelets, myeloid dendritic cells (mDC), and plasmacytoid dendritic cells (pDC), using the known markers (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>C,D). To investigate the immune responses during COVID-19 statuses, we then quantified the changes in the cell types and cluster proportions in healthy, remission, and severe samples (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S14, S15</ext-link>). Several immune cell types were observed to be depleted in the COVID-19 samples, including CD14<sup>+</sup> and CD16<sup>+</sup> monocytes, naive CD4<sup>+</sup> T cells, naive CD8<sup>+</sup> T cells, γδ T cells, and DCs (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S14</ext-link>). Among these cell types, monocytes play a crucial role in the inflammatory-related mechanisms in COVID-19 patients (<xref rid="GR277522ZHOC38" ref-type="bibr">Wang et al. 2020</xref>; <xref rid="GR277522ZHOC43" ref-type="bibr">Zhou et al. 2020</xref>). Four clusters were identified as CD14<sup>+</sup> monocytes, including clusters 0, 7, 9, and 12. Compared with the other three clusters, cluster 9 showed an increase in COVID-19 samples, significant in severe-stage samples. We next explored the distribution of cytokine storm-related and inflammation-related chemokine genes, including <italic>CCL3</italic>, <italic>CCL4</italic>, <italic>CXCL2</italic>, and <italic>TNF</italic>, in the CD14<sup>+</sup> monocyte subpopulation. These genes were primarily expressed in cluster 9 (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>E), suggesting that cluster 9 may contribute to the cytokine storm in COVID-19 patients. Additionally, the pathway enrichment analysis showed that genes related to cell chemotaxis, neutrophil chemotaxis, and leukocyte chemotaxis were enriched in cluster 9 (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>F). Thus, cluster 9 was identified as the COVID-19-specific CD14<sup>+</sup> monocyte subpopulation associated with the cytokine storm and dysregulated immune responses in COVID-19 patients.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s2">
    <title>Discussion</title>
    <p>We developed a novel method called scInt for the effective integration and reference-based mapping of scRNA-seq data. In both integration and reference-based mapping tasks of multiple heterogeneous data sets, scInt uses a unified contrastive biological variation learning framework. We showed the outperformance of scInt against 10 cutting-edge integration methods using both simulated and real data under several common integration scenarios.</p>
    <p>scInt uses a cluster-specific kernel similarity measure to identify similar cells for each cell among all remaining batches, enabling robust similarities construction, especially in the case of complex experimental designs. For calculation of the similarity measure, the preclustering of each batch is performed, aiming to capture similar cell states in the individual batch and determine a common batch effect size factor for each identified cell state. The core assumption is that cells with similar transcription states in a batch receive similar technical effects. By this approach, scInt overcomes the nested batch effects and unbalanced cell group composition designs and successfully identifies the same cell identities across all batches. Indeed, we found that scInt also improves the developmental trajectories integration, which is crucial for tissue development studies. cPCA is used to filter the incorrect cell–cell connections, which are prone to occur in the scenario of similar cell subpopulations. cPCA is sensitive to gene expression differences across batches, such as condition-specific cell types in disease versus healthy tissues. Due to the use of cPCA, scInt can differentiate genetically similar cell types across batches, enabling comparison of single-cell samples from different biological conditions.</p>
    <p>With the rapid growth of scRNA-seq data sets, reference-based mapping is turning out to be progressively significant. Recently, several methods have been developed to tackle this problem; however, they generally assumed that the reference could capture all biological variations in the query. Unfortunately, the cell subpopulation composition of the query is always unknown and new biological variations might be introduced. To overcome this obstacle, scInt develops a reference-based mapping method under our unified contrastive biological variation learning framework, enabling the continuous update of new biological variations. scInt learns a new contrastive biological variation matrix in each mapping task, which is the primary distinction from other reference-based mapping methods. To evaluate the capability of reference-based mapping, we have used the simulated and real data to perform the mapping task via scInt and three other current methods.</p>
    <p>In addition to the applications to several common scenarios, we also showed the performance of scInt under less typical integration scenarios. We applied scInt to three pathological cases, each with two variants of simulation data, to show the usability and stability of the method in these challenging scenarios. These cases will also help users prepare their data better when using scInt. First, we considered the case when cell subpopulations were only present in a single batch. We applied scInt to variants 1 and 2 of simulation 1 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>), which contained four and six cell subpopulations only present in a single batch, respectively. It is worth noting that there are no shared cell subpopulations across batches in variant 2, which does not meet the underlying assumption of the vast majority of current data integration methods. scInt successfully integrated variant 1 and kept all cell subpopulations separated on variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S16, S17</ext-link>). We also used other methods to integrate these two variants. Among them, only MNN could integrate two variants successfully, and Harmony preserved all unique cell subpopulation identities on variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S16, S17</ext-link>). Second, we considered the case when batches were dominated by a single cell subpopulation. We applied scInt to variants 1 and 2 of simulation 3 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>), which contained 14 and 16 batches dominated by a single cell subpopulation, respectively. It showed that scInt successfully removed batch effects on variant 1, but failed to integrate variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S18, S19</ext-link>). Other methods were also applied to integrate variants 1 and 2. On variant 1, RPCI succeeded in removing batch effects, whereas other compared methods showed incorrect alignment of multiple cell subpopulations (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S18</ext-link>). Of note, these approaches similarly failed to integrate variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S19</ext-link>), indicating that this extreme case continued to be difficult for existing tools and our method. Third, we considered the case when rare cell subpopulations were only present in a single batch, because the detection of rare cell subpopulations was also an important purpose of single-cell analysis. We generated simulation 4 by Splatter package and used its variants 1 and 2 to test the ability of scInt to deal with this case (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>). Variants 1 and 2 of simulation 4 contained two and four rare cell subpopulations, respectively, with each rare cell subpopulation only present in a single batch. As shown in <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figures S20 and S21</ext-link>, scInt successfully removed batch effects and preserved all rare cell subpopulation identities on both variants. In contrast, the integration results of other methods, except MNN and fastMNN, on these two variants showed mixtures of multiple rare cell subpopulations (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S20, S21</ext-link>).</p>
    <p>In summary, we present a novel method, scInt, for the integration and reference-based mapping of multiple heterogeneous scRNA-seq data sets. scInt is especially suitable for the integrative analysis of multiple heterogeneous data sets coming from different conditions and complex experimental designs, which is illustrated using several published scRNA-seq data sets in this work. Additionally, the contrastive biological variation patterns of other types of single-cell measurements may be easily explored using the proposed framework in the future.</p>
  </sec>
  <sec sec-type="methods" id="s3">
    <title>Methods</title>
    <sec id="s3a">
      <title>The scInt algorithm</title>
      <p>scInt is proposed to integrate multiple heterogeneous scRNA-seq data sets from distinct experiment batches, biological conditions, species, or technology platforms. Given gene expression matrices from multiple experimental designs, scInt learns contrastive biological variation and projects all batches onto a shared low-dimensional subspace. Also, this variation enables further learning as new data becomes available. Specifically, the scInt algorithm consists of the following main steps:
<list list-type="order"><list-item><p>data preprocessing and highly variable features selection;</p></list-item><list-item><p>cross-batch cell–cell similarity construction;</p></list-item><list-item><p>cell similarities filtering on the cPCA space;</p></list-item><list-item><p>global integration by contrastive biological variation learning;</p></list-item><list-item><p>integration of already integrated reference data and new data.</p></list-item></list>Details of each step are described as follows.</p>
    </sec>
    <sec id="s3b">
      <title>Data preprocessing and highly variable features selection</title>
      <p>For each scRNA-seq batch, the standard filtering and normalizing processes are used in the raw gene expression matrix. Genes expressed in less than 3 cells and cells with expressed genes of less than 300 are considered to be low-quality genes or cells, respectively, and are filtered. Then, the filtered expression matrices are normalized as follows: gene expression values are divided by the total gene expression value in each cell, multiplied by a scale factor (10,000 by default), and log1p-transformed. Top 2000 highly variable features are selected by default for each batch and then pooled to determine the feature list across all batches used for data integration.</p>
    </sec>
    <sec id="s3c">
      <title>Cross-batch cell–cell similarity construction</title>
      <p>The preprocessed gene-by-cell expression matrices <italic>X</italic><sub>1</sub>, · · · , <italic>X</italic><sub><italic>N</italic></sub>, where <italic>N</italic> is the total number of batches, are used to identify the cell–cell similarity relationships across batches. First, for each batch, a cell clustering approach is performed to find the cell similarity structure in individual batches. The Leiden algorithm (<xref rid="GR277522ZHOC33" ref-type="bibr">Traag et al. 2019</xref>) based on the shared nearest neighbor (SNN) graph is used by default, but other clustering algorithms are also available. We showed that our method was robust over a wide range of resolution parameter values of Leiden clustering algorithm (scInt parameters). Second, for each batch <italic>i</italic>, we perform PCA on the expression matrix and then project all batches onto this batch <italic>i</italic>-specific low-dimensional space. Specifically, for <italic>X</italic><sub><italic>i</italic></sub>, we compute its gene means μ<sub><italic>i</italic></sub> and standard deviations δ<sub><italic>i</italic></sub> and use these statistics to center and scale all batches:<disp-formula id="GR277522ZHOM1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
Then, we learn the truncated left singular matrix <italic>U</italic><sub><italic>i</italic></sub> of <italic>X</italic><sub><italic>i</italic></sub> using singular value decomposition (SVD) and use it to project <italic>X</italic><sub><italic>j</italic></sub>, <italic>j</italic> = 1, · · · , <italic>N</italic> onto the PCA space specific to batch <italic>i</italic>. Third, for each cell <italic>i</italic><sub><italic>s</italic></sub> of cluster <italic>c</italic> in batch <italic>i</italic>, the minimum cosine distance <inline-formula id="il1"><mml:math id="IL1" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> between <italic>i</italic><sub><italic>s</italic></sub> and cells in all remaining batches is computed in this low-dimensional space specific to batch <italic>i</italic>. The median of all distances <inline-formula id="il2"><mml:math id="IL2" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> in each cell cluster <italic>c</italic> identified in batch <italic>i</italic> is regarded as the unified batch effect size of the cell cluster <italic>c</italic>. Thus, we let <inline-formula id="il3"><mml:math id="IL3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mo fence="false">{</mml:mo><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>c</mml:mi><mml:mo fence="false">}</mml:mo></mml:math></inline-formula> for each <italic>i</italic><sub><italic>s</italic></sub> in <italic>c</italic>. The assumption behind <inline-formula id="il4"><mml:math id="IL4" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is that cells with similar transcription states in a batch are subject to similar technical effects. In this way, the interbatch similarities are related to the intrabatch similarities. Then, the cell similarity between each cell <italic>i</italic><sub><italic>s</italic></sub> in the batch <italic>i</italic> and cell <italic>j</italic><sub><italic>t</italic></sub> in the batch <italic>j</italic> is computed using a cluster-specific exponential kernel:<disp-formula id="GR277522ZHOM2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="normal">exp</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>d</italic>(<italic>i</italic><sub><italic>s</italic></sub>, <italic>j</italic><sub><italic>t</italic></sub>) denotes the cosine distance between cell <italic>i</italic><sub><italic>s</italic></sub> and cell <italic>j</italic><sub><italic>t</italic></sub> in the batch <italic>i</italic>-specific low-dimensional space. To reliably select the most similar cells of <italic>i</italic><sub><italic>s</italic></sub>, the cells with the top <italic>k</italic> = 5 similarities are retained. The cell–cell corresponding relationships set of batch <italic>i</italic> is denoted as <inline-formula id="il5"><mml:math id="IL5" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo fence="false">{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo fence="false">}</mml:mo><mml:mi mathvariant="normal">∖</mml:mi><mml:mo fence="false">{</mml:mo><mml:mi>i</mml:mi><mml:mo fence="false">}</mml:mo><mml:mo fence="false">}</mml:mo></mml:math></inline-formula>, and the cells in <italic>P</italic><sub><italic>i</italic></sub> are divided into two subsets including <italic>C</italic><sub><italic>i</italic></sub> = {<italic>i</italic><sub><italic>s</italic></sub>|<italic>i</italic><sub><italic>s</italic></sub> ∈ <italic>P</italic><sub><italic>i</italic></sub>, <italic>i</italic><sub><italic>s</italic></sub> ∈ <italic>i</italic>} and <inline-formula id="il6"><mml:math id="IL6" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo fence="false">{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo fence="false">}</mml:mo><mml:mi mathvariant="normal">∖</mml:mi><mml:mo fence="false">{</mml:mo><mml:mi>i</mml:mi><mml:mo fence="false">}</mml:mo><mml:mo fence="false">}</mml:mo></mml:math></inline-formula>. Note that these batch <italic>i</italic>-specific sets <italic>P</italic><sub><italic>i</italic></sub>’s are not directly used for downstream analysis such as clustering analysis, but only to infer the integrated data.</p>
    </sec>
    <sec id="s3d">
      <title>Cell similarity filtering on the cPCA space</title>
      <p>This step aims to remove the false similarity connections between different cell populations, which are prone to occur in the integration scenario with different biological conditions. For batch <italic>i</italic>, the identified similar cells are embedded in the cPCA space, to capture subtle transcriptional differences. Specifically, let <inline-formula id="il7"><mml:math id="IL7" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="il8"><mml:math id="IL8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> be the expression submatrices for <italic>C</italic><sub><italic>i</italic></sub> and <italic>R</italic><sub><italic>i</italic></sub>, respectively. Then <inline-formula id="il9"><mml:math id="IL9" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="il10"><mml:math id="IL10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are centered by the mean of <inline-formula id="il11"><mml:math id="IL11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The goal is to find the contrastive direction of the variation difference between target data <inline-formula id="il12"><mml:math id="IL12" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula> and background data <inline-formula id="il13"><mml:math id="IL13" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>:<disp-formula id="GR277522ZHOM3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mtable columnalign="right left" rowspacing=".5em" columnspacing="thickmathspace" displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mrow><mml:mo form="prefix">max</mml:mo></mml:mrow><mml:mi>v</mml:mi></mml:munder><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>v</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo><mml:mi>v</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>s</mml:mi><mml:mo>.</mml:mo><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mspace width="0.4em"/><mml:msubsup><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>v</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
Note this model is slightly different from the original cPCA model in terms of the parameter α, which we illustrate in the <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>. This optimization problem can be solved by eigenvalue decomposition of <inline-formula id="il14"><mml:math id="IL14" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup></mml:math></inline-formula>. The top <italic>l</italic> = 40 contrastive principal components (cPCs) are used to generate the cPCA subspace. When a few similar cells are shared between batch <italic>i</italic> and other batches, there may be less than <italic>l</italic> cPCs identified and used to filter the cell–cell similarities. We applied scInt to variant 2 of simulation 1, which had no cell subpopulations shared across batches (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>). The results showed that scInt was robust under this integration scenario (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S17</ext-link>). Then the cell similarity connections whose cosine similarities are less than <italic>T</italic> (0.6 by default) are filtered. The preserved similarities are used to construct the similarity matrix <italic>S</italic>.</p>
    </sec>
    <sec id="s3e">
      <title>Global integration by contrastive biological variation learning</title>
      <p><inline-formula id="il15"><mml:math id="IL15" display="inline" overflow="scroll"><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> encodes the identified cell–cell similarity relationships, where <italic>n</italic> is the total cell number of all batches. Also, <italic>S</italic> is symmetrized, that is, <italic>S</italic> = (<italic>S</italic> + <italic>S</italic><sup><italic>T</italic></sup>)/2. Using identified similarities, we construct a matrix <italic>Z</italic> to represent an invisible data set introduced by technical effects. The idea behind this is that the differences between the expression vector of each cell <italic>i</italic><sub><italic>s</italic></sub> in batch <italic>i</italic> and its identified similar cells <italic>j</italic><sub><italic>t</italic></sub>’s in batch <italic>j</italic> are regarded as technical effects. To construct this invisible data set, for each cell, we calculate the difference vectors between the expression vectors of itself and the weighted averaged sum of their identified similar cells. We use <italic>S</italic><sup><italic>i</italic>,<italic>j</italic></sup> to denote the submatrix of <italic>S</italic> representing the cell–cell similarities between batch <italic>i</italic> and batch <italic>j</italic>, and column-normalized the non-zero columns of <italic>S</italic><sup><italic>i</italic>,<italic>j</italic></sup>’s using the SoftMax function. We construct the technical mixing matrix <italic>M</italic> ∈ ℝ<sup><italic>n</italic>×<italic>n</italic></sup>:<disp-formula id="GR277522ZHOM4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mo>−</mml:mo><mml:mi>S</mml:mi><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>R</italic> is the diagonal matrix with the diagonal elements representing the column sums of <italic>S</italic>, that is, <inline-formula id="il16"><mml:math id="IL16" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mo>⋅</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. <italic>M</italic> encodes all technical mixing coefficients between each batch <italic>i</italic> and its remaining batches. Then the invisible data set of technical effects can be learned:<disp-formula id="GR277522ZHOM5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mi>X</mml:mi><mml:mi>M</mml:mi><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>X</italic> = [<italic>X</italic><sub>1</sub>, · · · , <italic>X</italic><sub><italic>N</italic></sub>] is the stacked gene expression matrix. Because we next learn the covariance matrix of <italic>Z</italic>, to eliminate the effects of the size of identified similarity relationships specific to each batch and avoid large batches dominating integration, we divide each column <italic>i</italic><sub><italic>s</italic></sub> of <italic>M</italic> by <inline-formula id="il17"><mml:math id="IL17" display="inline" overflow="scroll"><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula> as a scale factor. The cPCA model is used to learn the contrastive biological variation and eliminate the technical effects of <italic>X</italic>:<disp-formula id="GR277522ZHOM6"><label>(6)</label><mml:math id="M6" display="block" overflow="scroll"><mml:mtable columnalign="right left" rowspacing=".5em" columnspacing="thickmathspace" displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mrow><mml:mo form="prefix">max</mml:mo></mml:mrow><mml:mi>u</mml:mi></mml:munder><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>u</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>(</mml:mo><mml:mi>X</mml:mi><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>Z</mml:mi><mml:mrow><mml:msup><mml:mi>Z</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo><mml:mi>u</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>s</mml:mi><mml:mo>.</mml:mo><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mspace width="0.4em"/><mml:msubsup><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>u</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
This optimization problem can be solved by eigenvalue decomposition of the contrastive biological variation <italic>D</italic> = <italic>XX</italic><sup><italic>T</italic></sup> − λ<italic>ZZ</italic><sup><italic>T</italic></sup>. The result <italic>U</italic> is the transformation matrix that projects <italic>X</italic> onto the low-dimensional space that is not affected by cross-batch technical variation, that is, <italic>X</italic><sub><italic>correct</italic></sub> = <italic>U</italic><sup><italic>T</italic></sup><italic>X</italic> is the corrected low-dimensional data.</p>
    </sec>
    <sec id="s3f">
      <title>Integration of already integrated reference data and new data</title>
      <p>Let <italic>X</italic><sub><italic>new</italic></sub> be the gene-by-cell gene expression matrix with <italic>n</italic><sub><italic>new</italic></sub> cells of the new data. scInt maps <italic>X</italic><sub><italic>new</italic></sub> onto already integrated reference data with three optional methods (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S2</ext-link>). Primarily, the projection matrix <italic>U</italic> learned from the previous steps is used to project new data onto the reference data directly, that is, <italic>X</italic><sub><italic>update</italic></sub> = <italic>U</italic><sup><italic>T</italic></sup>[<italic>X</italic>, <italic>X</italic><sub><italic>new</italic></sub>].</p>
      <p>For the second method, the cPCA framework is used to integrate the new data. We use the following objective function:<disp-formula id="GR277522ZHOM7"><label>(7)</label><mml:math id="M7" display="block" overflow="scroll"><mml:mtable columnalign="right left" rowspacing=".5em" columnspacing="thickmathspace" displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mrow><mml:mo form="prefix">max</mml:mo></mml:mrow><mml:mi>w</mml:mi></mml:munder><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>w</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>(</mml:mo><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo><mml:mi>w</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>s</mml:mi><mml:mo>.</mml:mo><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mspace width="0.4em"/><mml:msubsup><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>w</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
The top <italic>l</italic> = 40 cPCs are used to learn projection matrix <italic>W</italic> to generate the integrated low-dimensional space, that is, <italic>X</italic><sub><italic>update</italic></sub> = <italic>W</italic><sup><italic>T</italic></sup>[<italic>X</italic>, <italic>X</italic><sub><italic>new</italic></sub>].</p>
      <p>The last method, named the “global” model, uses the previous steps to identify the cell–cell similarity relationships between reference and query data. It constructs a new <inline-formula id="il18"><mml:math id="IL18" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>S</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>×</mml:mo><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> by the already gained <italic>S</italic> of reference data, the identified cell–cell connections between reference and query data, and the <italic>S</italic><sub><italic>new</italic></sub> of query data if available. Then the new contrastive biological variation <inline-formula id="il19"><mml:math id="IL19" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> and new projection matrix <inline-formula id="il20"><mml:math id="IL20" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>U</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> are learned. <inline-formula id="il21"><mml:math id="IL21" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>U</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> projects <italic>X</italic> and <italic>X</italic><sub><italic>new</italic></sub> onto the same low-dimensional space, that is, <inline-formula id="il22"><mml:math id="IL22" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mover><mml:mi>U</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>[</mml:mo><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula>.</p>
      <p>We note the first two models are suitable for situations where reference data captures all the biological variations of query data, that is, there is no new cell type in the query data. The third model is not subject to this limitation and is more applicable to complex reference-based integration tasks. scInt uses the third model by default.</p>
    </sec>
    <sec id="s3g">
      <title>scInt parameters</title>
      <p>In scInt algorithm, there are two main tuning parameters: λ and <italic>T</italic>. Among them, λ controls the degree of mixing of similar cells across different batches in the integrated low-dimensional space, and <italic>T</italic> controls the reliability of the retained similarities. The default values for these parameters are as follows: λ = 5 and <italic>T</italic> = 0.6. scInt was found to be relatively robust to λ and <italic>T</italic> values within certain ranges (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S22, S23</ext-link>). Additionally, we propose a heuristic method to select optimal tuning parameters λ and <italic>T</italic> from certain sets of candidate values (see <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>). We also tested the scInt algorithm under different Leiden clustering resolutions and <italic>k</italic> (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S24, S25</ext-link>) and found that these parameters were robust to the integration results.</p>
    </sec>
    <sec id="s3h">
      <title>Benchmark integration methods</title>
      <p>We benchmarked our method with 10 other state-of-the-art integration methods, including MNN and its extension version fastMNN, LIGER and its online version online iNMF, Seurat, Harmony, Scanorama, RPCI, Conos, and scMC. We visualized the integration results in a two-dimensional space using the UMAP algorithm. In the benchmark work, the data sets were filtered and normalized uniformly. For selecting highly variable features, we used the standard “FindVariableFeatures” function implemented in the Seurat R package with the same parameters, except for methods using their specific feature selection functions, such as LIGER. Further, we selected reasonable key parameters of each method as their user guides described, to ensure a fair comparison. For Seurat, Harmony, and scMC, as they were robust to their key parameters in certain ranges, we used their default parameters for integration. When integrating the dendritic data set, as the cell number in each batch was small, we set the “k.filter” parameter from 200 to 40 for Seurat. When integrating the DiHS/DRESS skin data set, we set group.by.vars = c(“Batch”, “Condition”, “Technology”) and tau = c(2, 2, 2) for Harmony. When integrating the simulated and dendritic data sets, as the default clustering algorithm used in scMC failed to find clusters and marker genes, we set the “resolution” parameter to 0.8. For other MNN-based methods, including MNN, fastMNN, Scanorama, and Conos, we set k = 20 in the MNN pair selection uniformly. For RPCI, we set the reference batch as the batch that contained the most cell types, and eigens = 12, 15, 8, 8, 12, and 15 for simulation 1, simulation 2, simulation 3, dendritic, developing tracheal epithelial, and DiHS/DRESS skin data sets, respectively. For LIGER and online iNMF, we set λ = 5 for all data sets, and k = 10, 20, 20, 15, 20, and 20 for simulation 1, simulation 2, simulation 3, dendritic, developing tracheal epithelial, and DiHS/DRESS skin data sets, respectively. The details of parameter selection for RPCI, LIGER, and online iNMF are described in the <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Material</ext-link> (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S26, S27</ext-link>). These methods were applied using batchelor (version 1.6.2, for MNN and fastMNN), rliger (version 1.0.0, for LIGER and online iNMF), Seurat (version 4.1.0), harmony (version 0.1.0), Scanorama (version 1.7.1), RISC (version 1.0, for RPCI), Conos (version 1.4.3), and scMC (version 1.0.0). We also benchmarked our method with three other reference-based mapping methods, including Seurat, Symphony, and online iNMF. For Seurat, we used its default parameters to perform the mapping. For Symphony, we set group.by.vars = c(“Batch”, “Donor”) and tau = c(2, 2) for pancreas reference data integration. For online iNMF, we set k = 20 and λ = 5 for reference data integration and mapping for both simulated and real data sets in reference-based mapping tasks. These methods were applied using Seurat (version 4.1.0), symphony (version 0.1.0), and rliger (version 1.0.0), respectively.</p>
    </sec>
    <sec id="s3i">
      <title>Evaluation metrics</title>
      <p>To evaluate the performance of our method and other integration tools, we used four benchmark metrics: ARI, batch ASW, cell type LISI, and batch LISI. Additionally, we used the F1 score and ACC to evaluate the prediction accuracy in the reference-based integration tasks.</p>
      <sec id="s3i1">
        <title>ARI</title>
        <p>ARI evaluates the overlap of the original cell type annotation and the cell clustering results from the integrated data. The ARI value scores range from 0 to 1, where 0 indicates that the two clustering labels are independent of each other, and 1 means that the two clustering labels are the same up to a permutation.</p>
      </sec>
      <sec id="s3i2">
        <title>ASW</title>
        <p>ASW also measures the cluster preservation. We use it to evaluate the batch mixing score. The batch ASW score for each cell label <italic>p</italic> is computed as<disp-formula id="GR277522ZHOM8"><label>(8)</label><mml:math id="M8" display="block" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>s</italic>(<italic>i</italic>) is the silhouette width value of cell <italic>i</italic>, <italic>C</italic><sub><italic>p</italic></sub> is the set of cells with the cell label <italic>p</italic>, and |<italic>C</italic><sub><italic>p</italic></sub>| denotes the number of cells in the <italic>C</italic><sub><italic>p</italic></sub>. The final batch ASW scores are averaged:<disp-formula id="GR277522ZHOM9"><label>(9)</label><mml:math id="M9" display="block" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:mi>W</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mi>M</mml:mi><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>M</italic> is the set of cell labels.</p>
      </sec>
      <sec id="s3i3">
        <title>LISI</title>
        <p>LISI assesses the mixing and separation of a given label in the local distribution. Specifically, LISI computes the inverse Simpson's index of cell type label (cLISI) or batch label (iLISI) in the nearest neighbors of a cell selected with a fixed perplexity. For a single cell <italic>i</italic> with cell label <italic>p</italic>, a good integration always expects the iLISI is closed to the number of batches the cell label <italic>p</italic> appears, and cLISI is closed to 1. We modified LISI to make the LISI value between 0 and 1, and used batch LISI and cell type LISI to measure the integration performance specific to a single batch. For batch <italic>b</italic>, we compute the batch LISI by<disp-formula id="GR277522ZHOM10"><label>(10)</label><mml:math id="M10" display="block" overflow="scroll"><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>C</italic><sub><italic>b</italic></sub> denotes the set of cells in batch <italic>b</italic>, <italic>N</italic><sub><italic>i</italic></sub> is the number of batches that the cell label of cell <italic>i</italic> appears, and |<italic>iLISI</italic>(<italic>i</italic>) − <italic>N</italic><sub><italic>i</italic></sub>|/<italic>N</italic><sub><italic>i</italic></sub> measures the deviation between the batch mixing and the ideal mixing around the cell <italic>i</italic> ∈ <italic>C</italic><sub><italic>b</italic></sub>. Similarly, for batch <italic>b</italic>, we compute the cell type LISI by<disp-formula id="GR277522ZHOM11"><label>(11)</label><mml:math id="M11" display="block" overflow="scroll"><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
The final batch LISI and cell type LISI scores are averaged:<disp-formula id="GR277522ZHOM12"><label>(12)</label><mml:math id="M12" display="block" overflow="scroll"><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mi>B</mml:mi><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
<disp-formula id="GR277522ZHOM13"><label>(13)</label><mml:math id="M13" display="block" overflow="scroll"><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mi>B</mml:mi><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
</p>
      </sec>
      <sec id="s3i4">
        <title>F1 scores</title>
        <p>The F1 score is a weighted mean of precision rate and recall rate given by the equation:<disp-formula id="GR277522ZHOM14"><label>(14)</label><mml:math id="M14" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
It returns a value between 0 and 1, where 1 shows the best prediction.</p>
      </sec>
      <sec id="s3i5">
        <title>ACC</title>
        <p>ACC is calculated by dividing the number of correct predictions by the total number of predictions:<disp-formula id="GR277522ZHOM15"><label>(15)</label><mml:math id="M15" display="block" overflow="scroll"><mml:mi>A</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>n</mml:mi><mml:mi>u</mml:mi><mml:mi>m</mml:mi><mml:mi>b</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mspace width="0.4em"/><mml:mi>o</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.4em"/><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mspace width="0.4em"/><mml:mi>n</mml:mi><mml:mi>u</mml:mi><mml:mi>m</mml:mi><mml:mi>b</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mspace width="0.4em"/><mml:mi>o</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
It shows the prediction performance of the proportion of correct predictions.</p>
      </sec>
    </sec>
    <sec id="s3j">
      <title>Data sets</title>
      <p>The details of the data sets in this study are listed in <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Table S1</ext-link>.</p>
    </sec>
    <sec id="s3k">
      <title>Software availability</title>
      <p>The scInt R package (<xref rid="GR277522ZHOC29" ref-type="bibr">R Core Team 2020</xref>) is available freely at GitHub (<uri xlink:href="https://github.com/Jinsl-lab/scInt">https://github.com/Jinsl-lab/scInt</uri>). Source codes to reproduce the results in this manuscript are available at GitHub (<uri xlink:href="https://github.com/Jinsl-lab/scInt_reproducibility">https://github.com/Jinsl-lab/scInt_reproducibility</uri>). Both the R package and source codes are also available as <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Code</ext-link>.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplemental Material</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_33_5_750__DC1.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="supp_gr.277522.122_Supplemental_Material.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="supp_gr.277522.122_Supplemental_Source_Codes.zip"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="supp_gr.277522.122_Supplemental_scInt_.zip"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>This work was supported by the National Natural Science Foundation of China (Grants No. 62271173, No. 11971130, and No. 62172122), the Key Research and Development Program of Heilongjiang (Grant No. 2022ZX01A19), and the Interdisciplinary Research Foundation of HIT (Grant No. IR2021109).</p>
    <p><italic>Author contributions:</italic> S.J. and Y.Z. designed this project. Y.Z. conceived the idea, developed the model, and designed the analysis. Y.Z., Q.S., J.Q., and J.H. implemented the software and performed the analysis. Y.Z., Q.S., B.Y., and L.W. composed the manuscript. All authors read and approved the final manuscript.</p>
  </ack>
  <fn-group>
    <fn fn-type="supplementary-material">
      <p>[Supplemental material is available for this article.]</p>
    </fn>
    <fn>
      <p>Article published online before print. Article, supplemental material, and publication date are at <ext-link xlink:href="https://www.genome.org/cgi/doi/10.1101/gr.277522.122" ext-link-type="uri">https://www.genome.org/cgi/doi/10.1101/gr.277522.122</ext-link>.</p>
    </fn>
  </fn-group>
  <sec id="s5">
    <title>Competing interest statement</title>
    <p>The authors declare no competing interests.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="GR277522ZHOC1">
      <mixed-citation publication-type="journal"><string-name><surname>Abid</surname><given-names>A</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Bagaria</surname><given-names>VK</given-names></string-name>, <string-name><surname>Zou</surname><given-names>J</given-names></string-name>. <year>2018</year>. <article-title>Exploring patterns enriched in a dataset with contrastive principal component analysis</article-title>. <source>Nat Commun</source><volume>9</volume>: <fpage>2134</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-018-04608-8</pub-id><pub-id pub-id-type="pmid">29849030</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC2">
      <mixed-citation publication-type="journal"><string-name><surname>Barkas</surname><given-names>N</given-names></string-name>, <string-name><surname>Petukhov</surname><given-names>V</given-names></string-name>, <string-name><surname>Nikolaeva</surname><given-names>D</given-names></string-name>, <string-name><surname>Lozinsky</surname><given-names>Y</given-names></string-name>, <string-name><surname>Demharter</surname><given-names>S</given-names></string-name>, <string-name><surname>Khodosevich</surname><given-names>K</given-names></string-name>, <string-name><surname>Kharchenko</surname><given-names>PV</given-names></string-name>. <year>2019</year>. <article-title>Joint analysis of heterogeneous single-cell RNA-seq dataset collections</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>695</fpage>–<lpage>698</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0466-z</pub-id><pub-id pub-id-type="pmid">31308548</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC3">
      <mixed-citation publication-type="journal"><string-name><surname>Baron</surname><given-names>M</given-names></string-name>, <string-name><surname>Veres</surname><given-names>A</given-names></string-name>, <string-name><surname>Wolock</surname><given-names>SL</given-names></string-name>, <string-name><surname>Faust</surname><given-names>AL</given-names></string-name>, <string-name><surname>Gaujoux</surname><given-names>R</given-names></string-name>, <string-name><surname>Vetere</surname><given-names>A</given-names></string-name>, <string-name><surname>Ryu</surname><given-names>JH</given-names></string-name>, <string-name><surname>Wagner</surname><given-names>BK</given-names></string-name>, <string-name><surname>Shen-Orr</surname><given-names>SS</given-names></string-name>, <string-name><surname>Klein</surname><given-names>AM</given-names></string-name>, <etal/><year>2016</year>. <article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title>. <source>Cell Syst</source><volume>3</volume>: <fpage>346</fpage>–<lpage>360.e4</lpage>. <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id><pub-id pub-id-type="pmid">27667365</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC4">
      <mixed-citation publication-type="journal"><string-name><surname>Becht</surname><given-names>E</given-names></string-name>, <string-name><surname>McInnes</surname><given-names>L</given-names></string-name>, <string-name><surname>Healy</surname><given-names>J</given-names></string-name>, <string-name><surname>Dutertre</surname><given-names>CA</given-names></string-name>, <string-name><surname>Kwok</surname><given-names>IWH</given-names></string-name>, <string-name><surname>Ng</surname><given-names>LG</given-names></string-name>, <string-name><surname>Ginhoux</surname><given-names>F</given-names></string-name>, <string-name><surname>Newell</surname><given-names>EW</given-names></string-name>. <year>2019</year>. <article-title>Dimensionality reduction for visualizing single-cell data using UMAP</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>38</fpage>–<lpage>44</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4314</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC5">
      <mixed-citation publication-type="journal"><string-name><surname>Björklund</surname><given-names>AK</given-names></string-name>, <string-name><surname>Forkel</surname><given-names>M</given-names></string-name>, <string-name><surname>Picelli</surname><given-names>S</given-names></string-name>, <string-name><surname>Konya</surname><given-names>V</given-names></string-name>, <string-name><surname>Theorell</surname><given-names>J</given-names></string-name>, <string-name><surname>Friberg</surname><given-names>D</given-names></string-name>, <string-name><surname>Sandberg</surname><given-names>R</given-names></string-name>, <string-name><surname>Mjösberg</surname><given-names>J</given-names></string-name>. <year>2016</year>. <article-title>The heterogeneity of human CD127<sup>+</sup> innate lymphoid cells revealed by single-cell RNA sequencing</article-title>. <source>Nat Immunol</source><volume>17</volume>: <fpage>451</fpage>–<lpage>460</lpage>. <pub-id pub-id-type="doi">10.1038/ni.3368</pub-id><pub-id pub-id-type="pmid">26878113</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC6">
      <mixed-citation publication-type="journal"><string-name><surname>Büttner</surname><given-names>M</given-names></string-name>, <string-name><surname>Miao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Teichmann</surname><given-names>SA</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2019</year>. <article-title>A test metric for assessing single-cell RNA-seq batch correction</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>43</fpage>–<lpage>49</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-018-0254-1</pub-id><pub-id pub-id-type="pmid">30573817</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC7">
      <mixed-citation publication-type="journal"><string-name><surname>Cao</surname><given-names>J</given-names></string-name>, <string-name><surname>Spielmann</surname><given-names>M</given-names></string-name>, <string-name><surname>Qiu</surname><given-names>X</given-names></string-name>, <string-name><surname>Huang</surname><given-names>X</given-names></string-name>, <string-name><surname>Ibrahim</surname><given-names>DM</given-names></string-name>, <string-name><surname>Hill</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>F</given-names></string-name>, <string-name><surname>Mundlos</surname><given-names>S</given-names></string-name>, <string-name><surname>Christiansen</surname><given-names>L</given-names></string-name>, <string-name><surname>Steemers</surname><given-names>FJ</given-names></string-name>, <etal/><year>2019</year>. <article-title>The single-cell transcriptional landscape of mammalian organogenesis</article-title>. <source>Nature</source><volume>566</volume>: <fpage>496</fpage>–<lpage>502</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-019-0969-x</pub-id><pub-id pub-id-type="pmid">30787437</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC8">
      <mixed-citation publication-type="journal"><string-name><surname>Gao</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>, <string-name><surname>Kriebel</surname><given-names>AR</given-names></string-name>, <string-name><surname>Preissl</surname><given-names>S</given-names></string-name>, <string-name><surname>Luo</surname><given-names>C</given-names></string-name>, <string-name><surname>Castanon</surname><given-names>R</given-names></string-name>, <string-name><surname>Sandoval</surname><given-names>J</given-names></string-name>, <string-name><surname>Rivkin</surname><given-names>A</given-names></string-name>, <string-name><surname>Nery</surname><given-names>JR</given-names></string-name>, <string-name><surname>Behrens</surname><given-names>MM</given-names></string-name>, <etal/><year>2021</year>. <article-title>Iterative single-cell multi-omic integration using online learning</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>1000</fpage>–<lpage>1007</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-021-00867-x</pub-id><pub-id pub-id-type="pmid">33875866</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC9">
      <mixed-citation publication-type="journal"><string-name><surname>Grün</surname><given-names>D</given-names></string-name>, <string-name><surname>Muraro</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Boisset</surname><given-names>JC</given-names></string-name>, <string-name><surname>Wiebrands</surname><given-names>K</given-names></string-name>, <string-name><surname>Lyubimova</surname><given-names>A</given-names></string-name>, <string-name><surname>Dharmadhikari</surname><given-names>G</given-names></string-name>, <string-name><surname>van den Born</surname><given-names>M</given-names></string-name>, <string-name><surname>van Es</surname><given-names>J</given-names></string-name>, <string-name><surname>Jansen</surname><given-names>E</given-names></string-name>, <string-name><surname>Clevers</surname><given-names>H</given-names></string-name>, <etal/><year>2016</year>. <article-title>De novo prediction of stem cell identity using single-cell transcriptome data</article-title>. <source>Cell Stem Cell</source><volume>19</volume>: <fpage>266</fpage>–<lpage>277</lpage>. <pub-id pub-id-type="doi">10.1016/j.stem.2016.05.010</pub-id><pub-id pub-id-type="pmid">27345837</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC10">
      <mixed-citation publication-type="journal"><string-name><surname>Guo</surname><given-names>C</given-names></string-name>, <string-name><surname>Li</surname><given-names>B</given-names></string-name>, <string-name><surname>Ma</surname><given-names>H</given-names></string-name>, <string-name><surname>Wang</surname><given-names>X</given-names></string-name>, <string-name><surname>Cai</surname><given-names>P</given-names></string-name>, <string-name><surname>Yu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>L</given-names></string-name>, <string-name><surname>Jin</surname><given-names>L</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>C</given-names></string-name>, <string-name><surname>Fang</surname><given-names>J</given-names></string-name>, <etal/><year>2020</year>. <article-title>Single-cell analysis of two severe COVID-19 patients reveals a monocyte-associated and tocilizumab-responding cytokine storm</article-title>. <source>Nat Commun</source><volume>11</volume>: <fpage>3924</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-020-17834-w</pub-id><pub-id pub-id-type="pmid">32764665</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC11">
      <mixed-citation publication-type="journal"><string-name><surname>Haghverdi</surname><given-names>L</given-names></string-name>, <string-name><surname>Lun</surname><given-names>ATL</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>MD</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>. <year>2018</year>. <article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title>. <source>Nat Biotechnol</source><volume>36</volume>: <fpage>421</fpage>–<lpage>427</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4091</pub-id><pub-id pub-id-type="pmid">29608177</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC12">
      <mixed-citation publication-type="journal"><string-name><surname>Hao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <string-name><surname>Andersen-Nissen</surname><given-names>E</given-names></string-name>, <string-name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></string-name>, <string-name><surname>Zheng</surname><given-names>S</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Wilk</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Darby</surname><given-names>C</given-names></string-name>, <string-name><surname>Zager</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Integrated analysis of multimodal single-cell data</article-title>. <source>Cell</source><volume>184</volume>: <fpage>3573</fpage>–<lpage>3587.e29</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id><pub-id pub-id-type="pmid">34062119</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC13">
      <mixed-citation publication-type="journal"><string-name><surname>Hie</surname><given-names>B</given-names></string-name>, <string-name><surname>Bryson</surname><given-names>B</given-names></string-name>, <string-name><surname>Berger</surname><given-names>B</given-names></string-name>. <year>2019</year>. <article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>685</fpage>–<lpage>691</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id><pub-id pub-id-type="pmid">31061482</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC14">
      <mixed-citation publication-type="journal"><string-name><surname>Hubert</surname><given-names>L</given-names></string-name>, <string-name><surname>Arabie</surname><given-names>P</given-names></string-name>. <year>1985</year>. <article-title>Comparing partitions</article-title>. <source>J Classif</source><volume>2</volume>: <fpage>193</fpage>–<lpage>218</lpage>. <pub-id pub-id-type="doi">10.1007/BF01908075</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC15">
      <mixed-citation publication-type="journal"><string-name><surname>Kang</surname><given-names>JB</given-names></string-name>, <string-name><surname>Nathan</surname><given-names>A</given-names></string-name>, <string-name><surname>Weinand</surname><given-names>K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>F</given-names></string-name>, <string-name><surname>Millard</surname><given-names>N</given-names></string-name>, <string-name><surname>Rumker</surname><given-names>L</given-names></string-name>, <string-name><surname>Moody</surname><given-names>DB</given-names></string-name>, <string-name><surname>Korsunsky</surname><given-names>I</given-names></string-name>, <string-name><surname>Raychaudhuri</surname><given-names>S</given-names></string-name>. <year>2021</year>. <article-title>Efficient and precise single-cell reference atlas mapping with Symphony</article-title>. <source>Nat Commun</source><volume>12</volume>: <fpage>5890</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-021-25957-x</pub-id><pub-id pub-id-type="pmid">34620862</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC16">
      <mixed-citation publication-type="journal"><string-name><surname>Kim</surname><given-names>D</given-names></string-name>, <string-name><surname>Kobayashi</surname><given-names>T</given-names></string-name>, <string-name><surname>Voisin</surname><given-names>B</given-names></string-name>, <string-name><surname>Jo</surname><given-names>JH</given-names></string-name>, <string-name><surname>Sakamoto</surname><given-names>K</given-names></string-name>, <string-name><surname>Jin</surname><given-names>SP</given-names></string-name>, <string-name><surname>Kelly</surname><given-names>M</given-names></string-name>, <string-name><surname>Pasieka</surname><given-names>HB</given-names></string-name>, <string-name><surname>Naff</surname><given-names>JL</given-names></string-name>, <string-name><surname>Meyerle</surname><given-names>JH</given-names></string-name>, <etal/><year>2020</year>. <article-title>Targeted therapy guided by single-cell transcriptomic analysis in drug-induced hypersensitivity syndrome: a case report</article-title>. <source>Nat Med</source><volume>26</volume>: <fpage>236</fpage>–<lpage>243</lpage>. <pub-id pub-id-type="doi">10.1038/s41591-019-0733-7</pub-id><pub-id pub-id-type="pmid">31959990</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC17">
      <mixed-citation publication-type="journal"><string-name><surname>Kiyokawa</surname><given-names>H</given-names></string-name>, <string-name><surname>Yamaoka</surname><given-names>A</given-names></string-name>, <string-name><surname>Matsuoka</surname><given-names>C</given-names></string-name>, <string-name><surname>Tokuhara</surname><given-names>T</given-names></string-name>, <string-name><surname>Abe</surname><given-names>T</given-names></string-name>, <string-name><surname>Morimoto</surname><given-names>M</given-names></string-name>. <year>2021</year>. <article-title>Airway basal stem cells reuse the embryonic proliferation regulator, Tgfβ-Id2 axis, for tissue regeneration</article-title>. <source>Dev Cell</source><volume>56</volume>: <fpage>1917</fpage>–<lpage>1929.e9</lpage>. <pub-id pub-id-type="doi">10.1016/j.devcel.2021.05.016</pub-id><pub-id pub-id-type="pmid">34129836</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC18">
      <mixed-citation publication-type="journal"><string-name><surname>Korsunsky</surname><given-names>I</given-names></string-name>, <string-name><surname>Millard</surname><given-names>N</given-names></string-name>, <string-name><surname>Fan</surname><given-names>J</given-names></string-name>, <string-name><surname>Slowikowski</surname><given-names>K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>F</given-names></string-name>, <string-name><surname>Wei</surname><given-names>K</given-names></string-name>, <string-name><surname>Baglaenko</surname><given-names>Y</given-names></string-name>, <string-name><surname>Brenner</surname><given-names>M</given-names></string-name>, <string-name><surname>Loh</surname><given-names>PR</given-names></string-name>, <string-name><surname>Raychaudhuri</surname><given-names>S</given-names></string-name>. <year>2019</year>. <article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>1289</fpage>–<lpage>1296</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id><pub-id pub-id-type="pmid">31740819</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC19">
      <mixed-citation publication-type="journal"><string-name><surname>Lawlor</surname><given-names>N</given-names></string-name>, <string-name><surname>George</surname><given-names>J</given-names></string-name>, <string-name><surname>Bolisetty</surname><given-names>M</given-names></string-name>, <string-name><surname>Kursawe</surname><given-names>R</given-names></string-name>, <string-name><surname>Sun</surname><given-names>L</given-names></string-name>, <string-name><surname>Sivakamasundari</surname><given-names>V</given-names></string-name>, <string-name><surname>Kycia</surname><given-names>I</given-names></string-name>, <string-name><surname>Robson</surname><given-names>P</given-names></string-name>, <string-name><surname>Stitzel</surname><given-names>ML</given-names></string-name>. <year>2017</year>. <article-title>Single-cell transcriptomes identify human islet cell signatures and reveal cell-type–specific expression changes in type 2 diabetes</article-title>. <source>Genome Res</source><volume>27</volume>: <fpage>208</fpage>–<lpage>222</lpage>. <pub-id pub-id-type="doi">10.1101/gr.212720.116</pub-id><pub-id pub-id-type="pmid">27864352</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC20">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Wang</surname><given-names>T</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>B</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>D</given-names></string-name>. <year>2021</year>. <article-title>Robust integration of multiple single-cell RNA sequencing datasets using a single reference space</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>877</fpage>–<lpage>884</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-021-00859-x</pub-id><pub-id pub-id-type="pmid">33767393</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC21">
      <mixed-citation publication-type="journal"><string-name><surname>Luecken</surname><given-names>MD</given-names></string-name>, <string-name><surname>Büttner</surname><given-names>M</given-names></string-name>, <string-name><surname>Chaichoompu</surname><given-names>K</given-names></string-name>, <string-name><surname>Danese</surname><given-names>A</given-names></string-name>, <string-name><surname>Interlandi</surname><given-names>M</given-names></string-name>, <string-name><surname>Mueller</surname><given-names>MF</given-names></string-name>, <string-name><surname>Strobl</surname><given-names>DC</given-names></string-name>, <string-name><surname>Zappia</surname><given-names>L</given-names></string-name>, <string-name><surname>Dugas</surname><given-names>M</given-names></string-name>, <string-name><surname>Colomé-Tatché</surname><given-names>M</given-names></string-name>, <etal/><year>2022</year>. <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>41</fpage>–<lpage>50</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01336-8</pub-id><pub-id pub-id-type="pmid">34949812</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC22">
      <mixed-citation publication-type="journal"><string-name><surname>Moon</surname><given-names>KR</given-names></string-name>, <string-name><surname>van Dijk</surname><given-names>D</given-names></string-name>, <string-name><surname>Wang</surname><given-names>Z</given-names></string-name>, <string-name><surname>Gigante</surname><given-names>S</given-names></string-name>, <string-name><surname>Burkhardt</surname><given-names>DB</given-names></string-name>, <string-name><surname>Chen</surname><given-names>WS</given-names></string-name>, <string-name><surname>Yim</surname><given-names>K</given-names></string-name>, <string-name><surname>Elzen</surname><given-names>AVD</given-names></string-name>, <string-name><surname>Hirn</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Coifman</surname><given-names>RR</given-names></string-name>, <etal/><year>2019</year>. <article-title>Visualizing structure and transitions in high-dimensional biological data</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>1482</fpage>–<lpage>1492</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0336-3</pub-id><pub-id pub-id-type="pmid">31796933</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC23">
      <mixed-citation publication-type="journal"><string-name><surname>Muraro</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Dharmadhikari</surname><given-names>G</given-names></string-name>, <string-name><surname>Grün</surname><given-names>D</given-names></string-name>, <string-name><surname>Groen</surname><given-names>N</given-names></string-name>, <string-name><surname>Dielen</surname><given-names>T</given-names></string-name>, <string-name><surname>Jansen</surname><given-names>E</given-names></string-name>, <string-name><surname>van Gurp</surname><given-names>L</given-names></string-name>, <string-name><surname>Engelse</surname><given-names>MA</given-names></string-name>, <string-name><surname>Carlotti</surname><given-names>F</given-names></string-name>, <string-name><surname>de Koning</surname><given-names>EJ</given-names></string-name>, <etal/><year>2016</year>. <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>. <source>Cell Syst</source><volume>3</volume>: <fpage>385</fpage>–<lpage>394.e3</lpage>. <pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id><pub-id pub-id-type="pmid">27693023</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC24">
      <mixed-citation publication-type="journal"><string-name><surname>Nyfeler</surname><given-names>B</given-names></string-name>, <string-name><surname>Pichler</surname><given-names>WJ</given-names></string-name>. <year>1997</year>. <article-title>The lymphocyte transformation test for the diagnosis of drug allergy: sensitivity and specificity</article-title>. <source>Clin Exp Allergy</source><volume>27</volume>: <fpage>175</fpage>–<lpage>181</lpage>. <pub-id pub-id-type="doi">10.1111/j.1365-2222.1997.tb00690.x</pub-id><pub-id pub-id-type="pmid">9061217</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC25">
      <mixed-citation publication-type="journal"><string-name><surname>Papalexi</surname><given-names>E</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>. <year>2018</year>. <article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title>. <source>Nat Rev Immunol</source><volume>18</volume>: <fpage>35</fpage>–<lpage>45</lpage>. <pub-id pub-id-type="doi">10.1038/nri.2017.76</pub-id><pub-id pub-id-type="pmid">28787399</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC26">
      <mixed-citation publication-type="journal"><string-name><surname>Patel</surname><given-names>AP</given-names></string-name>, <string-name><surname>Tirosh</surname><given-names>I</given-names></string-name>, <string-name><surname>Trombetta</surname><given-names>JJ</given-names></string-name>, <string-name><surname>Shalek</surname><given-names>AK</given-names></string-name>, <string-name><surname>Gillespie</surname><given-names>SM</given-names></string-name>, <string-name><surname>Wakimoto</surname><given-names>H</given-names></string-name>, <string-name><surname>Cahill</surname><given-names>DP</given-names></string-name>, <string-name><surname>Nahed</surname><given-names>BV</given-names></string-name>, <string-name><surname>Curry</surname><given-names>WT</given-names></string-name>, <string-name><surname>Martuza</surname><given-names>RL</given-names></string-name>, <etal/><year>2014</year>. <article-title>Single-cell RNA-seq highlights intratumoral heterogeneity in primary glioblastoma</article-title>. <source>Science</source><volume>344</volume>: <fpage>1396</fpage>–<lpage>1401</lpage>. <pub-id pub-id-type="doi">10.1126/science.1254257</pub-id><pub-id pub-id-type="pmid">24925914</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC27">
      <mixed-citation publication-type="journal"><string-name><surname>Pichler</surname><given-names>WJ</given-names></string-name>, <string-name><surname>Tilch</surname><given-names>J</given-names></string-name>. <year>2004</year>. <article-title>The lymphocyte transformation test in the diagnosis of drug hypersensitivity</article-title>. <source>Allergy</source><volume>59</volume>: <fpage>809</fpage>–<lpage>820</lpage>. <pub-id pub-id-type="doi">10.1111/j.1398-9995.2004.00547.x</pub-id><pub-id pub-id-type="pmid">15230812</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC28">
      <mixed-citation publication-type="journal"><string-name><surname>Polański</surname><given-names>K</given-names></string-name>, <string-name><surname>Young</surname><given-names>MD</given-names></string-name>, <string-name><surname>Miao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Meyer</surname><given-names>KB</given-names></string-name>, <string-name><surname>Teichmann</surname><given-names>SA</given-names></string-name>, <string-name><surname>Park</surname><given-names>JE</given-names></string-name>. <year>2020</year>. <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>. <source>Bioinformatics</source><volume>36</volume>: <fpage>964</fpage>–<lpage>965</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id><pub-id pub-id-type="pmid">31400197</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC29">
      <mixed-citation publication-type="book"><collab>R Core Team</collab>. <year>2020</year>. <source>R: a language and environment for statistical computing</source>. <publisher-name>R Foundation for Statistical Computing</publisher-name>, <publisher-loc>Vienna</publisher-loc>. <comment><uri xlink:href="https://www.R-project.org/">https://www.R-project.org/</uri></comment>.</mixed-citation>
    </ref>
    <ref id="GR277522ZHOC30">
      <mixed-citation publication-type="journal"><string-name><surname>Rosenberg</surname><given-names>AB</given-names></string-name>, <string-name><surname>Roco</surname><given-names>CM</given-names></string-name>, <string-name><surname>Muscat</surname><given-names>RA</given-names></string-name>, <string-name><surname>Kuchina</surname><given-names>A</given-names></string-name>, <string-name><surname>Sample</surname><given-names>P</given-names></string-name>, <string-name><surname>Yao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Graybuck</surname><given-names>LT</given-names></string-name>, <string-name><surname>Peeler</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Mukherjee</surname><given-names>S</given-names></string-name>, <string-name><surname>Chen</surname><given-names>W</given-names></string-name>, <etal/><year>2018</year>. <article-title>Single-cell profiling of the developing mouse brain and spinal cord with split-pool barcoding</article-title>. <source>Science</source><volume>360</volume>: <fpage>176</fpage>–<lpage>182</lpage>. <pub-id pub-id-type="doi">10.1126/science.aam8999</pub-id><pub-id pub-id-type="pmid">29545511</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC31">
      <mixed-citation publication-type="journal"><string-name><surname>Segerstolpe</surname><given-names>A</given-names></string-name>, <string-name><surname>Palasantza</surname><given-names>A</given-names></string-name>, <string-name><surname>Eliasson</surname><given-names>P</given-names></string-name>, <string-name><surname>Andérsson</surname><given-names>EM</given-names></string-name>, <string-name><surname>Andreasson</surname><given-names>AC</given-names></string-name>, <string-name><surname>Sun</surname><given-names>X</given-names></string-name>, <string-name><surname>Picelli</surname><given-names>S</given-names></string-name>, <string-name><surname>Sabirsh</surname><given-names>A</given-names></string-name>, <string-name><surname>Clausen</surname><given-names>M</given-names></string-name>, <string-name><surname>Bjursell</surname><given-names>MK</given-names></string-name>, <etal/><year>2016</year>. <article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title>. <source>Cell Metab</source><volume>24</volume>: <fpage>593</fpage>–<lpage>607</lpage>. <pub-id pub-id-type="doi">10.1016/j.cmet.2016.08.020</pub-id><pub-id pub-id-type="pmid">27667667</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC32">
      <mixed-citation publication-type="journal"><string-name><surname>Stuart</surname><given-names>T</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>P</given-names></string-name>, <string-name><surname>Hafemeister</surname><given-names>C</given-names></string-name>, <string-name><surname>Papalexi</surname><given-names>E</given-names></string-name>, <string-name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></string-name>, <string-name><surname>Hao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Stoeckius</surname><given-names>M</given-names></string-name>, <string-name><surname>Smibert</surname><given-names>P</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>. <year>2019</year>. <article-title>Comprehensive integration of single-cell data</article-title>. <source>Cell</source><volume>177</volume>: <fpage>1888</fpage>–<lpage>1902.e21</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id><pub-id pub-id-type="pmid">31178118</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC33">
      <mixed-citation publication-type="journal"><string-name><surname>Traag</surname><given-names>VA</given-names></string-name>, <string-name><surname>Waltman</surname><given-names>L</given-names></string-name>, <string-name><surname>van Eck</surname><given-names>NJ</given-names></string-name>. <year>2019</year>. <article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title>. <source>Sci Rep</source><volume>9</volume>: <fpage>5233</fpage>. <pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id><pub-id pub-id-type="pmid">30914743</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC34">
      <mixed-citation publication-type="journal"><string-name><surname>Tran</surname><given-names>HTN</given-names></string-name>, <string-name><surname>Ang</surname><given-names>KS</given-names></string-name>, <string-name><surname>Chevrier</surname><given-names>M</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Lee</surname><given-names>NYS</given-names></string-name>, <string-name><surname>Goh</surname><given-names>M</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>. <year>2020</year>. <article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><volume>21</volume>: <fpage>12</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id><pub-id pub-id-type="pmid">31948481</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC35">
      <mixed-citation publication-type="journal"><string-name><surname>Villani</surname><given-names>AC</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>, <string-name><surname>Reynolds</surname><given-names>G</given-names></string-name>, <string-name><surname>Sarkizova</surname><given-names>S</given-names></string-name>, <string-name><surname>Shekhar</surname><given-names>K</given-names></string-name>, <string-name><surname>Fletcher</surname><given-names>J</given-names></string-name>, <string-name><surname>Griesbeck</surname><given-names>M</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>S</given-names></string-name>, <string-name><surname>Lazo</surname><given-names>S</given-names></string-name>, <etal/><year>2017</year>. <article-title>Single-cell RNA-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title>. <source>Science</source><volume>356</volume>: <fpage>eaah4573</fpage>. <pub-id pub-id-type="doi">10.1126/science.aah4573</pub-id><pub-id pub-id-type="pmid">28428369</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC36">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Navin</surname><given-names>NE</given-names></string-name>. <year>2015</year>. <article-title>Advances and applications of single-cell sequencing technologies</article-title>. <source>Mol Cell</source><volume>58</volume>: <fpage>598</fpage>–<lpage>609</lpage>. <pub-id pub-id-type="doi">10.1016/j.molcel.2015.05.005</pub-id><pub-id pub-id-type="pmid">26000845</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC37">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>J</given-names></string-name>, <string-name><surname>Jenjaroenpun</surname><given-names>P</given-names></string-name>, <string-name><surname>Bhinge</surname><given-names>A</given-names></string-name>, <string-name><surname>Angarica</surname><given-names>VE</given-names></string-name>, <string-name><surname>Del Sol</surname><given-names>A</given-names></string-name>, <string-name><surname>Nookaew</surname><given-names>I</given-names></string-name>, <string-name><surname>Kuznetsov</surname><given-names>VA</given-names></string-name>, <string-name><surname>Stanton</surname><given-names>LW</given-names></string-name>. <year>2017</year>. <article-title>Single-cell gene expression analysis reveals regulators of distinct cell subpopulations among developing human neurons</article-title>. <source>Genome Res</source><volume>27</volume>: <fpage>1783</fpage>–<lpage>1794</lpage>. <pub-id pub-id-type="doi">10.1101/gr.223313.117</pub-id><pub-id pub-id-type="pmid">29030469</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC38">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>C</given-names></string-name>, <string-name><surname>Xie</surname><given-names>J</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>L</given-names></string-name>, <string-name><surname>Fei</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>H</given-names></string-name>, <string-name><surname>Tan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Nie</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>L</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Ren</surname><given-names>Y</given-names></string-name>, <etal/><year>2020</year>. <article-title>Alveolar macrophage dysfunction and cytokine storm in the pathogenesis of two severe COVID-19 patients</article-title>. <source>EBioMedicine</source><volume>57</volume>: <fpage>102833</fpage>. <pub-id pub-id-type="doi">10.1016/j.ebiom.2020.102833</pub-id><pub-id pub-id-type="pmid">32574956</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC39">
      <mixed-citation publication-type="journal"><string-name><surname>Welch</surname><given-names>JD</given-names></string-name>, <string-name><surname>Kozareva</surname><given-names>V</given-names></string-name>, <string-name><surname>Ferreira</surname><given-names>A</given-names></string-name>, <string-name><surname>Vanderburg</surname><given-names>C</given-names></string-name>, <string-name><surname>Martin</surname><given-names>C</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>. <year>2019</year>. <article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>. <source>Cell</source><volume>177</volume>: <fpage>1873</fpage>–<lpage>1887.e17</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id><pub-id pub-id-type="pmid">31178122</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC40">
      <mixed-citation publication-type="journal"><string-name><surname>Yu</surname><given-names>G</given-names></string-name>, <string-name><surname>Wang</surname><given-names>LG</given-names></string-name>, <string-name><surname>Han</surname><given-names>Y</given-names></string-name>, <string-name><surname>He</surname><given-names>QY</given-names></string-name>. <year>2012</year>. <article-title>clusterProfiler: an R package for comparing biological themes among gene clusters</article-title>. <source>OMICS</source><volume>16</volume>: <fpage>284</fpage>–<lpage>287</lpage>. <pub-id pub-id-type="doi">10.1089/omi.2011.0118</pub-id><pub-id pub-id-type="pmid">22455463</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC41">
      <mixed-citation publication-type="journal"><string-name><surname>Zappia</surname><given-names>L</given-names></string-name>, <string-name><surname>Phipson</surname><given-names>B</given-names></string-name>, <string-name><surname>Oshlack</surname><given-names>A</given-names></string-name>. <year>2017</year>. <article-title>Splatter: simulation of single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><volume>18</volume>: <fpage>174</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-017-1305-0</pub-id><pub-id pub-id-type="pmid">28899397</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC42">
      <mixed-citation publication-type="journal"><string-name><surname>Zhang</surname><given-names>L</given-names></string-name>, <string-name><surname>Nie</surname><given-names>Q</given-names></string-name>. <year>2021</year>. <article-title>scMC learns biological variation through the alignment of multiple single-cell genomics datasets</article-title>. <source>Genome Biol</source><volume>22</volume>: <fpage>10</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-020-02238-2</pub-id><pub-id pub-id-type="pmid">33397454</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC43">
      <mixed-citation publication-type="journal"><string-name><surname>Zhou</surname><given-names>Y</given-names></string-name>, <string-name><surname>Fu</surname><given-names>B</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>X</given-names></string-name>, <string-name><surname>Wang</surname><given-names>D</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>C</given-names></string-name>, <string-name><surname>Qi</surname><given-names>Y</given-names></string-name>, <string-name><surname>Sun</surname><given-names>R</given-names></string-name>, <string-name><surname>Tian</surname><given-names>Z</given-names></string-name>, <string-name><surname>Xu</surname><given-names>X</given-names></string-name>, <string-name><surname>Wei</surname><given-names>H</given-names></string-name>. <year>2020</year>. <article-title>Pathogenic T-cells and inflammatory monocytes incite inflammatory storms in severe COVID-19 patients</article-title>. <source>Natl Sci Rev</source><volume>7</volume>: <fpage>998</fpage>–<lpage>1002</lpage>. <pub-id pub-id-type="doi">10.1093/nsr/nwaa041</pub-id><pub-id pub-id-type="pmid">34676125</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.0 20120330//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Res</journal-id>
    <journal-id journal-id-type="hwp">genome</journal-id>
    <journal-id journal-id-type="publisher-id">GENOME</journal-id>
    <journal-title-group>
      <journal-title>Genome Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1088-9051</issn>
    <issn pub-type="epub">1549-5469</issn>
    <publisher>
      <publisher-name>Cold Spring Harbor Laboratory Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10317120</article-id>
    <article-id pub-id-type="pmid">37308294</article-id>
    <article-id pub-id-type="medline">9509184</article-id>
    <article-id pub-id-type="doi">10.1101/gr.277522.122</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methods</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Accurate integration of multiple heterogeneous single-cell RNA-seq data sets by learning contrastive biological variation</article-title>
      <alt-title alt-title-type="left-running">Zhou et al.</alt-title>
      <alt-title alt-title-type="right-running">scRNA-seq data integration and mapping via scInt</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Zhou</surname>
          <given-names>Yang</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sheng</surname>
          <given-names>Qiongyu</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Qi</surname>
          <given-names>Jing</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hua</surname>
          <given-names>Jiao</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yang</surname>
          <given-names>Bo</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Lei</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2318-432X</contrib-id>
        <name>
          <surname>Jin</surname>
          <given-names>Shuilin</given-names>
        </name>
      </contrib>
    </contrib-group>
    <aff>School of Mathematics, Harbin Institute of Technology, Harbin, Heilongjiang Province, China, 150001</aff>
    <author-notes>
      <corresp>Corresponding author: <email>jinsl@hit.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <volume>33</volume>
    <issue>5</issue>
    <fpage>750</fpage>
    <lpage>762</lpage>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>3</day>
        <month>5</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>
        <ext-link xlink:href="http://genome.cshlp.org/site/misc/terms.xhtml" ext-link-type="uri">© 2023 Zhou et al.; Published by Cold Spring Harbor Laboratory Press</ext-link>
      </copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This article is distributed exclusively by Cold Spring Harbor Laboratory Press for the first six months after the full-issue publication date (see <ext-link ext-link-type="uri" xlink:href="https://genome.cshlp.org/site/misc/terms.xhtml">https://genome.cshlp.org/site/misc/terms.xhtml</ext-link>). After six months, it is available under a Creative Commons License (Attribution-NonCommercial 4.0 International), as described at <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="750.pdf"/>
    <abstract>
      <p>For most biological and medical applications of single-cell transcriptomics, an integrative study of multiple heterogeneous single-cell RNA sequencing (scRNA-seq) data sets is crucial. However, present approaches are unable to integrate diverse data sets from various biological conditions effectively because of the confounding effects of biological and technical differences. We introduce single-cell integration (scInt), an integration method based on accurate, robust cell–cell similarity construction and unified contrastive biological variation learning from multiple scRNA-seq data sets. scInt provides a flexible and effective approach to transfer knowledge from the already integrated reference to the query. We show that scInt outperforms 10 other cutting-edge approaches using both simulated and real data sets, particularly in the case of complex experimental designs. Application of scInt to mouse developing tracheal epithelial data shows its ability to integrate development trajectories from different developmental stages. Furthermore, scInt successfully identifies functionally distinct condition-specific cell subpopulations in single-cell heterogeneous samples from a variety of biological conditions.</p>
    </abstract>
    <funding-group>
      <award-group id="funding-1">
        <funding-source>
          <institution-wrap>
            <institution>National Natural Science Foundation of China </institution>
            <institution-id institution-id-type="doi">10.13039/501100001809</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>62271173</award-id>
        <award-id>11971130</award-id>
        <award-id>62172122</award-id>
      </award-group>
      <award-group id="funding-2">
        <funding-source>Interdisciplinary Research Foundation of HIT</funding-source>
        <award-id>IR2021109</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="13"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>In investigating the gene expression heterogeneity in single cells, single-cell RNA sequencing (scRNA-seq) offers enormous advantages over traditional transcriptome sequencing techniques. It also shows huge potential in many biological and medical fields to shed light on the internal behavior of complex organisms, such as developing brain tissue (<xref rid="GR277522ZHOC26" ref-type="bibr">Patel et al. 2014</xref>; <xref rid="GR277522ZHOC36" ref-type="bibr">Wang and Navin 2015</xref>; <xref rid="GR277522ZHOC5" ref-type="bibr">Björklund et al. 2016</xref>; <xref rid="GR277522ZHOC37" ref-type="bibr">Wang et al. 2017</xref>; <xref rid="GR277522ZHOC25" ref-type="bibr">Papalexi and Satija 2018</xref>; <xref rid="GR277522ZHOC30" ref-type="bibr">Rosenberg et al. 2018</xref>). To get thorough interpretations of a specific biological process, integrative analysis of multiple data sets from various biological and technical conditions is a key step. The characterization of biological heterogeneity across different biological conditions is still difficult, nonetheless, as a result of the confusion of biological and technical variation (also known as batch effects).</p>
  <p>To meet the unprecedented computational challenge, several strategies have been developed (<xref rid="GR277522ZHOC11" ref-type="bibr">Haghverdi et al. 2018</xref>; <xref rid="GR277522ZHOC2" ref-type="bibr">Barkas et al. 2019</xref>; <xref rid="GR277522ZHOC13" ref-type="bibr">Hie et al. 2019</xref>; <xref rid="GR277522ZHOC18" ref-type="bibr">Korsunsky et al. 2019</xref>; <xref rid="GR277522ZHOC32" ref-type="bibr">Stuart et al. 2019</xref>; <xref rid="GR277522ZHOC39" ref-type="bibr">Welch et al. 2019</xref>; <xref rid="GR277522ZHOC28" ref-type="bibr">Polański et al. 2020</xref>; <xref rid="GR277522ZHOC8" ref-type="bibr">Gao et al. 2021</xref>; <xref rid="GR277522ZHOC20" ref-type="bibr">Liu et al. 2021</xref>; <xref rid="GR277522ZHOC42" ref-type="bibr">Zhang and Nie 2021</xref>), mostly using two alternative methodologies: removing the difference between identified (i) similar cells and (ii) shared cell types across batches. Mutual nearest neighbor (MNN) (<xref rid="GR277522ZHOC11" ref-type="bibr">Haghverdi et al. 2018</xref>) is a common method that serves as the basis for numerous integration techniques for similar-cells-based methods. It searches MNN pairs across batches and treats these in-pair cells as being in the same cell states so that they can be gathered in the following phase. Scanorama (<xref rid="GR277522ZHOC13" ref-type="bibr">Hie et al. 2019</xref>), Seurat v3 (<xref rid="GR277522ZHOC32" ref-type="bibr">Stuart et al. 2019</xref>), BBKNN (<xref rid="GR277522ZHOC28" ref-type="bibr">Polański et al. 2020</xref>), Conos (<xref rid="GR277522ZHOC2" ref-type="bibr">Barkas et al. 2019</xref>), and the fast version of MNN called fastMNN (<xref rid="GR277522ZHOC11" ref-type="bibr">Haghverdi et al. 2018</xref>) use the same strategy, with searching MNN pairs in dimensionally reduced spaces such as canonical correlation analysis (CCA) or principal component analysis (PCA) space, instead of in the original gene expression space directly. Among these, BBKNN and Conos build global neighborhood graphs across all batches, which are used directly for the downstream analysis. Methods based on the identification of shared cell types include Harmony (<xref rid="GR277522ZHOC18" ref-type="bibr">Korsunsky et al. 2019</xref>), LIGER (<xref rid="GR277522ZHOC39" ref-type="bibr">Welch et al. 2019</xref>), and scMC (<xref rid="GR277522ZHOC42" ref-type="bibr">Zhang and Nie 2021</xref>). Harmony iteratively uses maximum batch diversity clustering and cell-specific linear correction using a mixture model in the PCA embedding. The integrative non-negative matrix factorization (iNMF) method yields a low-dimensional matrix that LIGER uses to perform joint clustering and quantile normalization procedures. scMC assigns the shared cell types across batches and eliminates differences between any two groups of “confident cells” of shared cell types. Incorrect connections between genetically similar cell types, particularly in the integration scenario with imbalanced cell type compositions across batches, could, however, disrupt either strategy. Recent benchmarking studies (<xref rid="GR277522ZHOC34" ref-type="bibr">Tran et al. 2020</xref>; <xref rid="GR277522ZHOC21" ref-type="bibr">Luecken et al. 2022</xref>) also revealed the inferior performance of these approaches on complex integration tasks.</p>
  <p>To address these problems, we present an integration model named <underline>s</underline>ingle-<underline>c</underline>ell <underline>Int</underline>egration based on unified contrastive biological variation learning (scInt). scInt offers several salient features as follows. First, instead of directly calculating the similarities between cells based on Euclidean distance, as most approaches do, scInt uses a similarity measure based on a cluster-specific exponential kernel, capturing both the inter- and intrabatch similarity structures. Second, scInt filters the incorrect connections of the cell similarity relationships using the contrastive principal component analysis (cPCA) method (<xref rid="GR277522ZHOC1" ref-type="bibr">Abid et al. 2018</xref>), a potent tool for identifying the minute differences between two data sets. Third, scInt has developed a unified framework for learning contrastive biological variation that allows for the global integration of multiple scRNA-seq data sets and the knowledge transfer from already integrated reference data to newly arrived query data. We benchmark scInt and other state-of-the-art methods in integration and reference-based mapping tasks using both simulated and real data. We also apply scInt to several integrative analyses on real data sets under various scenarios to show the capability of identifying condition-specific cell subpopulations across multiple heterogeneous data sets.</p>
  <sec sec-type="results" id="s1">
    <title>Results</title>
    <sec id="s1a">
      <title>scInt uniformly learns the contrastive biological variation for data integration</title>
      <p>scInt aims to integrate multiple scRNA-seq data sets that may be generated from different conditions, species, or technologies (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>A,B). Specifically, for each cell, scInt searches the most similar cells in its remaining batches, by computing the similarities based on inter- and intrabatch similarity structures (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>C; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S1</ext-link>; Methods). Then, scInt uses the cPCA technique to distinguish the different genetic states across batches and filter the incorrect cell–cell connections (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>C; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S1</ext-link>; Methods). The difference vectors between all cells and their similar cells are regarded as the invisible data introduced by the technical variation. Thus, the contrastive biological variation can be learned by applying cPCA to the gene expression matrix and the difference matrix. Finally, using this contrastive biological variation, scInt performs global integration for all batches, resulting in a joint embedding served as the input of various downstream analysis tasks (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>D). In addition, under the same contrastive biological variation learning framework, the reference-based data integration is available to scInt (<xref rid="GR277522ZHOF1" ref-type="fig">Fig. 1</xref>E; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S2</ext-link>; Methods), allowing flexible integrative analysis of multiple scRNA-seq data sets in biological and medical applications.</p>
      <fig position="float" id="GR277522ZHOF1">
        <label>Figure 1.</label>
        <caption>
          <p>Overview of the scInt method. (<italic>A</italic>) scInt integrates multiple scRNA-seq batches that may come from different conditions, species, or technologies. (<italic>B</italic>) Three heterogeneous batches. Batches and cell types are represented by different colors and shapes, respectively. The dashed cell groups represent the same cell types with different transcriptomic states. (<italic>C</italic>) Cell–cell similarity construction. Similarities based on a cluster-specific exponential kernel are identified and further filtered in the cPCA space. (<italic>D</italic>,<italic>E</italic>) Integration and reference-based mapping of multiple batches. A unified contrastive biological variation learning framework is used for integration (<italic>D</italic>) and reference-based mapping (<italic>E</italic>).</p>
        </caption>
        <graphic xlink:href="750f01" position="float"/>
      </fig>
    </sec>
    <sec id="s1b">
      <title>Benchmark of scInt and other state-of-the-art methods using simulated and real transcriptome data</title>
      <p>We first benchmarked scInt against 10 state-of-the-art methods using the simulated and real data under different integration scenarios with ground-truth cell type labels (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S3–S5</ext-link>). We applied the uniform manifold approximation and projection (UMAP) algorithm (<xref rid="GR277522ZHOC4" ref-type="bibr">Becht et al. 2019</xref>) to visualize the integrated single-cell data. To evaluate the performance of the overall batch effect removal and biological signals reservation of integration results, we used two scoring metrics: the adjusted Rand index (ARI) (<xref rid="GR277522ZHOC14" ref-type="bibr">Hubert and Arabie 1985</xref>) and the average silhouette width (ASW) (<xref rid="GR277522ZHOC6" ref-type="bibr">Büttner et al. 2019</xref>; Methods). We also used the inverse Simpson's index (LISI) (<xref rid="GR277522ZHOC18" ref-type="bibr">Korsunsky et al. 2019</xref>) to assess the local separation of cell types and the local mixing of batches (i.e., cell type LISI and batch LISI; Methods).</p>
      <fig position="float" id="GR277522ZHOF2">
        <label>Figure 2.</label>
        <caption>
          <p>Benchmarking scInt against other methods using simulated and real data. (<italic>A</italic>) UMAP visualizations of simulation 1 before and after integration by scInt, Seurat, Harmony, RPCI, and online iNMF. Cells are colored by batch labels (<italic>top</italic> row) and cell type labels (<italic>bottom</italic> row). (<italic>B</italic>) UMAP visualizations of the human dendritic data before and after integration by scInt, Seurat, Harmony, RPCI, and online iNMF. (<italic>C</italic>) The comparison of evaluation metrics, including ARI, batch ASW, cell type LISI, and batch LISI, of the integrated results on simulation 1. (<italic>D</italic>) The comparison of evaluation metrics, including ARI, batch ASW, cell type LISI, and batch LISI, of the integrated results on human dendritic data.</p>
        </caption>
        <graphic xlink:href="750f02" position="float"/>
      </fig>
      <p>First, we considered the integration scenario with unbalanced cell subpopulation compositions and rare cell subpopulations across batches. We generated simulation 1 with the Splatter R package (<xref rid="GR277522ZHOC41" ref-type="bibr">Zappia et al. 2017</xref>) (see <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link> for details). It contains six cell subpopulations and three batches, with five subpopulations in batch 1, four in batch 2, and four in batch 3 (the first column of <xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>A). Furthermore, Group5 is the unique cell subpopulation in batch 1, and Group6 is a rare cell subpopulation in batch 3. Cells within the same cell subpopulations across different batches presented distinct clusters in the unintegrated data, suggesting severe batch effects (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>A). Scanorama and scInt succeeded in integrating all these three batches, and preserved the cellular identities of Group5 and Group6, leading to higher batch removal and cell type conservation scores (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>C; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S3A</ext-link>). The other methods, on the other hand, either failed to capture the rare cell subpopulations, such as Seurat, or failed to integrate several cell subpopulations, such as Harmony (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>A). Additionally, we also used two simulated data sets (simulations 2 and 3, see <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link> for details), proposed by a recent benchmark study (<xref rid="GR277522ZHOC21" ref-type="bibr">Luecken et al. 2022</xref>), to further evaluate the performance of scInt against other methods. It showed that scInt outperformed other methods, removing the batch effects correctly, whereas preserving the simulated cell subpopulation heterogeneity (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S4, S5</ext-link>). Especially for simulation 3, which contained complex and nested batch effects, only RPCI, MNN, fastMNN, scMC, and scInt successfully integrated the data (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S5</ext-link>). Among these five methods, scInt well mixed all batches and achieved the highest evaluation metric scores.</p>
      <p>Second, we assessed the integration performance on real data of human dendritic cells (DCs) (<xref rid="GR277522ZHOC35" ref-type="bibr">Villani et al. 2017</xref>). This data consists of unbalanced cell subpopulations: CD141, double negative cells (DoubleNeg), and plasmacytoid DC (pDC) cells in batch 1, CD1C, DoubleNeg, and pDC cells in batch 2, where CD141 and CD1C are biologically similar cell types. Only RPCI, online iNMF, and scInt discriminated CD141 and CD1C cells whereas integrating other shared cell types (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>B). Other methods, such as Seurat, connected CD141 and CD1C cells improperly (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>B). For the integration performance scores, scInt achieved the highest level of batch mixing and cell type separability scores (<xref rid="GR277522ZHOF2" ref-type="fig">Fig. 2</xref>D; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S3B</ext-link>).</p>
    </sec>
    <sec id="s1c">
      <title>scInt efficiently maps new data onto already integrated data</title>
      <p>Next, we evaluated the ability of scInt to map new data onto already integrated data using two reference-based mapping tasks. We compared scInt with three well-known approaches, including Seurat v4 (<xref rid="GR277522ZHOC12" ref-type="bibr">Hao et al. 2021</xref>), Symphony (<xref rid="GR277522ZHOC15" ref-type="bibr">Kang et al. 2021</xref>), and online iNMF, using both simulated and real data. Our proposed “global” mapping differs slightly from the other three approaches. For each reference-based mapping task, scInt incorporates new contrastive biological variations of the query and learns a new variation matrix. Thus, it differs from the other approaches in that the learned projection matrix and resulting joint low-dimensional space are different each time.</p>
      <p>In the first mapping task, we tested if scInt could map multiple query batches onto the reference data whereas successfully mapping the rare cell subpopulation. We selected batches 1–3 of simulation 2 (containing 7450 cells) as the reference data and batches 4–6 of simulation 2 (containing 4647 cells) as the query data. Meanwhile, Group7 is a rare cell subpopulation within batches 2 and 5. Seurat and scInt effectively eliminated the batch effects of the raw data and delivered well-built references (the top row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>A). However, online iNMF mixed a small number of Group3 cells with Group1, and Symphony showed a mixture of cells between Group5 and Group7 in the reference integration. For reference-based mapping, online iNMF and scInt precisely mapped the query onto the reference (the bottom row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>A). In contrast, Seurat and Symphony well mapped all except Group7 of the cell subpopulations. We used a 5-NN classifier to predict the labels of the query cells in the joint low-dimensional embedding of reference and query data and calculated the prediction F1 score and accuracy (ACC) of each label to evaluate the prediction performance of mapping results (Methods). scInt accurately predicted all labels of query cells (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S6A</ext-link>), obtaining a mean cell type F1 score of 1 and an overall accuracy of 1 (<xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>B). In contrast, online iNMF and Symphony showed some incorrect label predictions because of the mixture of different cell subpopulations in the reference integration, and Seurat incorrectly connected Group5 and Group7, leading to lower mean cell type F1 and overall accuracy scores.</p>
      <fig position="float" id="GR277522ZHOF3">
        <label>Figure 3.</label>
        <caption>
          <p>Benchmarking scInt against other methods in the reference-based integration tasks. (<italic>A</italic>) UMAP visualizations of the density of integrated reference cells (<italic>top</italic> row) and the scatters of mapped query cells (<italic>bottom</italic> row) of simulation 2, from scInt, Seurat, Symphony, and online iNMF. Cells are colored by ground-truth cell type labels, with gray shadows representing the reference. (<italic>B</italic>) Heatmap comparing the 5-NN predicted labels (columns) and the original labels (rows) of the query. The color bar indicates the proportion of query cells per original cell type label that was predicted to be for each reference label (rows sum to 1). (<italic>C</italic>) UMAP visualizations of the density of integrated reference cells (<italic>top</italic> row) and the scatters of mapped query cells (<italic>bottom</italic> row) of the human pancreas data, from scInt, Seurat, Symphony, and online iNMF. Cells are colored by ground-truth cell type labels, with gray shadows representing the reference. The mast cells are the unique cell type in the query data and are colored dark purple. (<italic>D</italic>) Heatmap comparing the 5-NN predicted labels (columns) and the original labels (rows) of the query.</p>
        </caption>
        <graphic xlink:href="750f03" position="float"/>
      </fig>
      <p>To further assess the ability of mapping real scRNA-seq data, we applied scInt to the reference-based mapping task of multiple human pancreas data sets. The pancreas batches 1–4 were profiled with four different plate-based sequencing technologies (Fluidigm C1, CEL-Seq, CEL-Seq2, and Smart-seq2, respectively) (<xref rid="GR277522ZHOC9" ref-type="bibr">Grün et al. 2016</xref>; <xref rid="GR277522ZHOC23" ref-type="bibr">Muraro et al. 2016</xref>; <xref rid="GR277522ZHOC31" ref-type="bibr">Segerstolpe et al. 2016</xref>; <xref rid="GR277522ZHOC19" ref-type="bibr">Lawlor et al. 2017</xref>), and batches 5–8 were profiled with inDrop (<xref rid="GR277522ZHOC3" ref-type="bibr">Baron et al. 2016</xref>), which was a droplet-based technology. Thus, we selected pancreas batches 1–4 (containing 5887 cells) as the reference data and the remaining four batches (containing 8569 cells) as the query data to test if scInt could overcome the interplatform effects. In addition, batches 1–4 contained two rare cell types, including epsilon cells (7 cells) and immune cells (27 cells), which made both the reference integration and mapping tasks more challenging. Seurat, Symphony, and scInt successfully removed the batch effects and detected both rare cell types in the reference integration (the top row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>C). However, online iNMF showed a mixture of cells between rare cell types and other cell types. Further, Seurat, Symphony, and scInt succeeded in overcoming the interplatform effects and mapping query cells onto the reference whereas preserving the unique cell identity of mast cells (the bottom row of <xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>C). Among these methods, scInt achieved the best performance in the cell type prediction by the 5-NN classifier in the joint embedding (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S6B</ext-link>), with a mean cell type F1 score of 0.96 and an overall accuracy of 0.95 (<xref rid="GR277522ZHOF3" ref-type="fig">Fig. 3</xref>D). We also performed these two reference-based mapping tasks using our alternative mapping models, achieving performance comparable to the default “global” model (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S7</ext-link>).</p>
    </sec>
    <sec id="s1d">
      <title>scInt reveals integrated trajectories of mouse developing tracheal epithelial data</title>
      <p>We further applied scInt to integrate multiple developmental batches coming from different time points and evaluated its ability in developmental trajectory discovery. In such a scenario, continuous transcriptional state evolution would hinder the identification of similar cells or cell types across time points. Additionally, the shared cell types between batches may be quite limited, resulting in unbalanced cell type compositions.</p>
      <p>We analyzed 3508 mouse developing tracheal epithelial cells at six time points from embryonic day E12.5 to E18.5 (<xref rid="GR277522ZHOC17" ref-type="bibr">Kiyokawa et al. 2021</xref>). The raw data showed severe batch effects across time points, with cells separated by time points (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S8</ext-link>). After scInt integration, cells were well mixed across time points (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>A), and the major cell types were revealed by the canonical markers (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>B): basal cells (<italic>Krt5</italic>), ciliated cells (<italic>Foxj1</italic>), club cells (<italic>Scgb1a1</italic>), NE cells (<italic>Ascl1</italic>), KRT17<sup>+</sup> and KRT17<sup>−</sup> progenitors (<italic>Krt17</italic>, <italic>Scgb3a2</italic>), and proliferative cells (<italic>Mki67</italic>). We also tested the other methods on this data. Among these methods, MNN, fastMNN, Harmony, and scMC successfully integrated batches across multiple time points, distinguishing most cell types (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S8</ext-link>). Other methods, however, showed mixtures of several cell types. We also used Monocle 3 (<xref rid="GR277522ZHOC7" ref-type="bibr">Cao et al. 2019</xref>) to infer the trajectories of the integrated data by scInt and other methods (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S9</ext-link>). Compared to other methods, scInt revealed clear developmental trajectories and yielded pseudotime inference results consistent with the actual developmental stages of epithelial cells.</p>
      <fig position="float" id="GR277522ZHOF4">
        <label>Figure 4.</label>
        <caption>
          <p>scInt reveals integrated trajectories of mouse developing tracheal epithelial data. (<italic>A</italic>) UMAP visualizations of the mouse developing tracheal epithelial cells in the scInt-integrated data (from E12.5 to E18.5). Cells are colored by time points (<italic>left</italic>) and cell types (<italic>right</italic>). (<italic>B</italic>) Overlay of the expression patterns of cell type marker genes onto the UMAP space. (<italic>C</italic>) PHATE visualizations for all cells except proliferative cells. Cells are colored by time points (<italic>left</italic>) and cell types (<italic>right</italic>). The arrows indicate the directions of the trajectories. (<italic>D</italic>) Overlay of the expression patterns of <italic>Krt17</italic> and <italic>Scgb3a2</italic> onto the PHATE space.</p>
        </caption>
        <graphic xlink:href="750f04" position="float"/>
      </fig>
      <p>In the original study, Kiyokawa et al. found that <italic>Krt17</italic> can serve as a marker for the intermediate cell population in the basal cell lineage, and KRT17<sup>+</sup> progenitors contribute to the mature epithelial cells, including basal, club, and ciliated cells. To test whether integration methods could reveal this developmental process, we extracted all cells other than proliferative cells and performed the potential of heat diffusion for affinity-based transition embedding (PHATE) algorithm (<xref rid="GR277522ZHOC22" ref-type="bibr">Moon et al. 2019</xref>) to visualize the trajectory structure of the integrated data. scInt-integrated data could generate a global trajectory structure from E14.5 to E18.5 and presented a clear differentiation process from the KRT17<sup>−</sup> progenitors to three kinds of mature epithelial cells (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>C). The expression of the identified marker of intermediate progenitors, <italic>Krt17</italic>, was abundant in the differentiation of basal cells, indicating its important role in the commitment to mature basal cells (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>D). In contrast, <italic>Scgb3a2</italic> showed abundance mainly in the differentiation of the other two kinds of mature epithelial cells (<xref rid="GR277522ZHOF4" ref-type="fig">Fig. 4</xref>D). The expression patterns of <italic>Krt17</italic> and <italic>Scgb3a2</italic> may indicate the binary cell fate decision in the tracheal epithelial maturation. Meanwhile, we performed PHATE visualization on the integrated results of other methods. As shown in <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figure S10</ext-link>, these methods either failed to preserve the clear differentiation trajectory or mixed distinct cell types incorrectly. In general, scInt successfully integrated the developmental trajectories of mouse developing tracheal epithelial cells, revealing insights into cell lineage evolution.</p>
    </sec>
    <sec id="s1e">
      <title>scInt reveals DiHS/DRESS-specific cell subpopulations</title>
      <p>We then tested the capability of scInt for detecting across-condition biological differences. We applied scInt to a scRNA-seq data set containing 20,415 cells from seven human skin samples from a drug-induced hypersensitivity syndrome/drug reaction with eosinophilia and systemic symptoms (DiHS/DRESS) donor and five healthy controls (<xref rid="GR277522ZHOC16" ref-type="bibr">Kim et al. 2020</xref>). Moreover, the samples in this data were assayed with 10x Genomics and prepared using different library construction protocols: 3′ (DiHS/DRESS, HV4, and HV5 samples), 5′ (HV1 replicates 1, 2, HV2, and HV3 samples). The raw data showed discrete populations of most cells across different technologies and conditions (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S11</ext-link>).</p>
      <p>The original study found that the DiHS/DRESS and healthy lymphocytes were enriched with different signature genes and biological processes, indicating the existence of condition-specific cell subpopulations. To test whether integration methods could reveal the differences between condition-specific cell subpopulations, we integrated the human DiHS/DRESS and healthy skin data using scInt and other methods. scInt separated most cell types annotated by the high expression of typical marker genes, including endothelium (<italic>PECAM1</italic>), fibroblast (<italic>DCN</italic>), keratinocyte (<italic>KRT1</italic>, <italic>KRT5</italic>), lymphocyte (<italic>CD3E</italic>), melanocyte (<italic>PMEL</italic>), myeloid (<italic>FCER1G</italic>), and pericyte/SM (pericyte/smooth muscle, <italic>RGS5</italic>), well mixing the cells across technologies and conditions (<xref rid="GR277522ZHOF5" ref-type="fig">Fig. 5</xref>A–C). In addition to lymphocytes, keratinocytes also displayed condition-specific localization in the UMAP space, indicating the transcriptional differences of keratinocytes across disease statuses. scInt successfully differentiated the DiHS/DRESS and healthy lymphocyte and keratinocyte subpopulations (<xref rid="GR277522ZHOF5" ref-type="fig">Fig. 5</xref>B). However, for other methods, only scMC could distinguish all four of these condition-specific cell types while well mixing other cell types (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S11</ext-link>). We evaluated the performance of these integration results using ARI, batch ASW, cell type LISI, and batch LISI scores, as well as the mean label F1 and label silhouette scores of these four condition-specific cell subpopulations. Compared with other methods, scInt obtained the best overall scores (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S12A–C</ext-link>).</p>
      <fig position="float" id="GR277522ZHOF5">
        <label>Figure 5.</label>
        <caption>
          <p>scInt reveals DiHS/DRESS-specific cell subpopulations. (<italic>A</italic>,<italic>B</italic>) UMAP visualizations of the human DiHS/DRESS and healthy skin cells in the scInt-integrated data. Cells are colored by batches, technologies (<italic>A</italic>), and annotated cell labels (<italic>B</italic>) determined in the scInt-integrated data by examining the expression patterns of known markers. (<italic>C</italic>) Overlay of the expression patterns of cell type marker genes onto the UMAP space. (<italic>D</italic>) Heatmap of the top 10 differentially expressed genes of the DiHS/DRESS and healthy lymphocyte subpopulations. (<italic>E</italic>) The top 10 enriched GO biological processes associated with the DiHS/DRESS and healthy lymphocyte subpopulations.</p>
        </caption>
        <graphic xlink:href="750f05" position="float"/>
      </fig>
      <p>We then performed differential expression analysis, as well as functional enrichment analysis, on these two groups of condition-specific cell subpopulations (healthy lymphocyte I and DiHS/DRESS lymphocyte II cells, healthy keratinocyte I and DiHS/DRESS keratinocyte II cells) using the clusterProfiler R package (<xref rid="GR277522ZHOC40" ref-type="bibr">Yu et al. 2012</xref>). We found that different genes and biological processes were enriched in lymphocytes specific to DiHS/DRESS and healthy individuals (<xref rid="GR277522ZHOF5" ref-type="fig">Fig. 5</xref>D,E). The DiHS/DRESS-specific lymphocytes were enriched with genes involved in T cell activation and cell–cell adhesion, indicating the key role of the lymphocyte population in the drug-specific immune response in DiHS/DRESS syndrome, which was consistent with previous observations (<xref rid="GR277522ZHOC24" ref-type="bibr">Nyfeler and Pichler 1997</xref>; <xref rid="GR277522ZHOC27" ref-type="bibr">Pichler and Tilch 2004</xref>; <xref rid="GR277522ZHOC16" ref-type="bibr">Kim et al. 2020</xref>). In addition, neutrophil activation and neutrophil mediated immunity pathways, which play key roles in innate immunity, were enriched in the DiHS/DRESS keratinocytes (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S12D</ext-link>). The aforementioned results together show that scInt can reveal condition-specific cell subpopulations and their biological function differences between biological conditions.</p>
    </sec>
    <sec id="s1f">
      <title>scInt reveals inflammation-related mechanisms in the COVID-19 data</title>
      <p>Lastly, we showed the potential of scInt in integrating complex real scRNA-seq data from distinct biological conditions. We applied scInt to a single-cell RNA-seq data set with 67,362 peripheral blood mononuclear cells (PBMCs) from three conditions (healthy, remission, and severe) and 12 batches (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Table S1</ext-link>; <xref rid="GR277522ZHOC10" ref-type="bibr">Guo et al. 2020</xref>). It showed that there were severe batch effects across batches, especially across COVID-19 and healthy samples in the raw data (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>A).</p>
      <fig position="float" id="GR277522ZHOF6">
        <label>Figure 6.</label>
        <caption>
          <p>scInt reveals inflammatory-related mechanisms in the COVID-19 data. (<italic>A</italic>,<italic>B</italic>) UMAP visualizations of the COVID-19 PBMC data in the raw data (<italic>A</italic>) and scInt-integrated data (<italic>B</italic>). Cells are colored by batches and COVID-19 stage conditions. (<italic>C</italic>) UMAP visualizations of the scInt-integrated data. Cells are colored by identified cell types. (<italic>D</italic>) Stacked violin plot of the top-important marker gene expression for each cell type. (<italic>E</italic>) Overlay of the expression patterns of the cytokine storm-related and inflammation-related chemokine genes in the CD14<sup>+</sup> monocytes. (<italic>F</italic>) The top 10 enriched GO biological processes associated with cluster 9 and other CD14<sup>+</sup> monocytes.</p>
        </caption>
        <graphic xlink:href="750f06" position="float"/>
      </fig>
      <p>After scInt integration, cells were well mixed across batches and conditions (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>B). We performed Leiden graph-based clustering (<xref rid="GR277522ZHOC33" ref-type="bibr">Traag et al. 2019</xref>) onto the scInt-integrated data, identifying 20 clusters (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S13</ext-link>). We manually annotated 14 cell types including B cells, plasma B cells, monocytes (CD14<sup>+</sup> and CD16<sup>+</sup> monocytes), T cells (naive CD4<sup>+</sup>, effector CD4<sup>+</sup>, naive CD8<sup>+</sup>, effector CD8<sup>+</sup>, MKI67<sup>+</sup> CD8<sup>+</sup>, and γδ T cells), natural killer cells (NK), platelets, myeloid dendritic cells (mDC), and plasmacytoid dendritic cells (pDC), using the known markers (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>C,D). To investigate the immune responses during COVID-19 statuses, we then quantified the changes in the cell types and cluster proportions in healthy, remission, and severe samples (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S14, S15</ext-link>). Several immune cell types were observed to be depleted in the COVID-19 samples, including CD14<sup>+</sup> and CD16<sup>+</sup> monocytes, naive CD4<sup>+</sup> T cells, naive CD8<sup>+</sup> T cells, γδ T cells, and DCs (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S14</ext-link>). Among these cell types, monocytes play a crucial role in the inflammatory-related mechanisms in COVID-19 patients (<xref rid="GR277522ZHOC38" ref-type="bibr">Wang et al. 2020</xref>; <xref rid="GR277522ZHOC43" ref-type="bibr">Zhou et al. 2020</xref>). Four clusters were identified as CD14<sup>+</sup> monocytes, including clusters 0, 7, 9, and 12. Compared with the other three clusters, cluster 9 showed an increase in COVID-19 samples, significant in severe-stage samples. We next explored the distribution of cytokine storm-related and inflammation-related chemokine genes, including <italic>CCL3</italic>, <italic>CCL4</italic>, <italic>CXCL2</italic>, and <italic>TNF</italic>, in the CD14<sup>+</sup> monocyte subpopulation. These genes were primarily expressed in cluster 9 (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>E), suggesting that cluster 9 may contribute to the cytokine storm in COVID-19 patients. Additionally, the pathway enrichment analysis showed that genes related to cell chemotaxis, neutrophil chemotaxis, and leukocyte chemotaxis were enriched in cluster 9 (<xref rid="GR277522ZHOF6" ref-type="fig">Fig. 6</xref>F). Thus, cluster 9 was identified as the COVID-19-specific CD14<sup>+</sup> monocyte subpopulation associated with the cytokine storm and dysregulated immune responses in COVID-19 patients.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s2">
    <title>Discussion</title>
    <p>We developed a novel method called scInt for the effective integration and reference-based mapping of scRNA-seq data. In both integration and reference-based mapping tasks of multiple heterogeneous data sets, scInt uses a unified contrastive biological variation learning framework. We showed the outperformance of scInt against 10 cutting-edge integration methods using both simulated and real data under several common integration scenarios.</p>
    <p>scInt uses a cluster-specific kernel similarity measure to identify similar cells for each cell among all remaining batches, enabling robust similarities construction, especially in the case of complex experimental designs. For calculation of the similarity measure, the preclustering of each batch is performed, aiming to capture similar cell states in the individual batch and determine a common batch effect size factor for each identified cell state. The core assumption is that cells with similar transcription states in a batch receive similar technical effects. By this approach, scInt overcomes the nested batch effects and unbalanced cell group composition designs and successfully identifies the same cell identities across all batches. Indeed, we found that scInt also improves the developmental trajectories integration, which is crucial for tissue development studies. cPCA is used to filter the incorrect cell–cell connections, which are prone to occur in the scenario of similar cell subpopulations. cPCA is sensitive to gene expression differences across batches, such as condition-specific cell types in disease versus healthy tissues. Due to the use of cPCA, scInt can differentiate genetically similar cell types across batches, enabling comparison of single-cell samples from different biological conditions.</p>
    <p>With the rapid growth of scRNA-seq data sets, reference-based mapping is turning out to be progressively significant. Recently, several methods have been developed to tackle this problem; however, they generally assumed that the reference could capture all biological variations in the query. Unfortunately, the cell subpopulation composition of the query is always unknown and new biological variations might be introduced. To overcome this obstacle, scInt develops a reference-based mapping method under our unified contrastive biological variation learning framework, enabling the continuous update of new biological variations. scInt learns a new contrastive biological variation matrix in each mapping task, which is the primary distinction from other reference-based mapping methods. To evaluate the capability of reference-based mapping, we have used the simulated and real data to perform the mapping task via scInt and three other current methods.</p>
    <p>In addition to the applications to several common scenarios, we also showed the performance of scInt under less typical integration scenarios. We applied scInt to three pathological cases, each with two variants of simulation data, to show the usability and stability of the method in these challenging scenarios. These cases will also help users prepare their data better when using scInt. First, we considered the case when cell subpopulations were only present in a single batch. We applied scInt to variants 1 and 2 of simulation 1 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>), which contained four and six cell subpopulations only present in a single batch, respectively. It is worth noting that there are no shared cell subpopulations across batches in variant 2, which does not meet the underlying assumption of the vast majority of current data integration methods. scInt successfully integrated variant 1 and kept all cell subpopulations separated on variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S16, S17</ext-link>). We also used other methods to integrate these two variants. Among them, only MNN could integrate two variants successfully, and Harmony preserved all unique cell subpopulation identities on variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S16, S17</ext-link>). Second, we considered the case when batches were dominated by a single cell subpopulation. We applied scInt to variants 1 and 2 of simulation 3 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>), which contained 14 and 16 batches dominated by a single cell subpopulation, respectively. It showed that scInt successfully removed batch effects on variant 1, but failed to integrate variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S18, S19</ext-link>). Other methods were also applied to integrate variants 1 and 2. On variant 1, RPCI succeeded in removing batch effects, whereas other compared methods showed incorrect alignment of multiple cell subpopulations (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S18</ext-link>). Of note, these approaches similarly failed to integrate variant 2 (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S19</ext-link>), indicating that this extreme case continued to be difficult for existing tools and our method. Third, we considered the case when rare cell subpopulations were only present in a single batch, because the detection of rare cell subpopulations was also an important purpose of single-cell analysis. We generated simulation 4 by Splatter package and used its variants 1 and 2 to test the ability of scInt to deal with this case (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>). Variants 1 and 2 of simulation 4 contained two and four rare cell subpopulations, respectively, with each rare cell subpopulation only present in a single batch. As shown in <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figures S20 and S21</ext-link>, scInt successfully removed batch effects and preserved all rare cell subpopulation identities on both variants. In contrast, the integration results of other methods, except MNN and fastMNN, on these two variants showed mixtures of multiple rare cell subpopulations (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S20, S21</ext-link>).</p>
    <p>In summary, we present a novel method, scInt, for the integration and reference-based mapping of multiple heterogeneous scRNA-seq data sets. scInt is especially suitable for the integrative analysis of multiple heterogeneous data sets coming from different conditions and complex experimental designs, which is illustrated using several published scRNA-seq data sets in this work. Additionally, the contrastive biological variation patterns of other types of single-cell measurements may be easily explored using the proposed framework in the future.</p>
  </sec>
  <sec sec-type="methods" id="s3">
    <title>Methods</title>
    <sec id="s3a">
      <title>The scInt algorithm</title>
      <p>scInt is proposed to integrate multiple heterogeneous scRNA-seq data sets from distinct experiment batches, biological conditions, species, or technology platforms. Given gene expression matrices from multiple experimental designs, scInt learns contrastive biological variation and projects all batches onto a shared low-dimensional subspace. Also, this variation enables further learning as new data becomes available. Specifically, the scInt algorithm consists of the following main steps:
<list list-type="order"><list-item><p>data preprocessing and highly variable features selection;</p></list-item><list-item><p>cross-batch cell–cell similarity construction;</p></list-item><list-item><p>cell similarities filtering on the cPCA space;</p></list-item><list-item><p>global integration by contrastive biological variation learning;</p></list-item><list-item><p>integration of already integrated reference data and new data.</p></list-item></list>Details of each step are described as follows.</p>
    </sec>
    <sec id="s3b">
      <title>Data preprocessing and highly variable features selection</title>
      <p>For each scRNA-seq batch, the standard filtering and normalizing processes are used in the raw gene expression matrix. Genes expressed in less than 3 cells and cells with expressed genes of less than 300 are considered to be low-quality genes or cells, respectively, and are filtered. Then, the filtered expression matrices are normalized as follows: gene expression values are divided by the total gene expression value in each cell, multiplied by a scale factor (10,000 by default), and log1p-transformed. Top 2000 highly variable features are selected by default for each batch and then pooled to determine the feature list across all batches used for data integration.</p>
    </sec>
    <sec id="s3c">
      <title>Cross-batch cell–cell similarity construction</title>
      <p>The preprocessed gene-by-cell expression matrices <italic>X</italic><sub>1</sub>, · · · , <italic>X</italic><sub><italic>N</italic></sub>, where <italic>N</italic> is the total number of batches, are used to identify the cell–cell similarity relationships across batches. First, for each batch, a cell clustering approach is performed to find the cell similarity structure in individual batches. The Leiden algorithm (<xref rid="GR277522ZHOC33" ref-type="bibr">Traag et al. 2019</xref>) based on the shared nearest neighbor (SNN) graph is used by default, but other clustering algorithms are also available. We showed that our method was robust over a wide range of resolution parameter values of Leiden clustering algorithm (scInt parameters). Second, for each batch <italic>i</italic>, we perform PCA on the expression matrix and then project all batches onto this batch <italic>i</italic>-specific low-dimensional space. Specifically, for <italic>X</italic><sub><italic>i</italic></sub>, we compute its gene means μ<sub><italic>i</italic></sub> and standard deviations δ<sub><italic>i</italic></sub> and use these statistics to center and scale all batches:<disp-formula id="GR277522ZHOM1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
Then, we learn the truncated left singular matrix <italic>U</italic><sub><italic>i</italic></sub> of <italic>X</italic><sub><italic>i</italic></sub> using singular value decomposition (SVD) and use it to project <italic>X</italic><sub><italic>j</italic></sub>, <italic>j</italic> = 1, · · · , <italic>N</italic> onto the PCA space specific to batch <italic>i</italic>. Third, for each cell <italic>i</italic><sub><italic>s</italic></sub> of cluster <italic>c</italic> in batch <italic>i</italic>, the minimum cosine distance <inline-formula id="il1"><mml:math id="IL1" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> between <italic>i</italic><sub><italic>s</italic></sub> and cells in all remaining batches is computed in this low-dimensional space specific to batch <italic>i</italic>. The median of all distances <inline-formula id="il2"><mml:math id="IL2" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> in each cell cluster <italic>c</italic> identified in batch <italic>i</italic> is regarded as the unified batch effect size of the cell cluster <italic>c</italic>. Thus, we let <inline-formula id="il3"><mml:math id="IL3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mo fence="false">{</mml:mo><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>c</mml:mi><mml:mo fence="false">}</mml:mo></mml:math></inline-formula> for each <italic>i</italic><sub><italic>s</italic></sub> in <italic>c</italic>. The assumption behind <inline-formula id="il4"><mml:math id="IL4" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is that cells with similar transcription states in a batch are subject to similar technical effects. In this way, the interbatch similarities are related to the intrabatch similarities. Then, the cell similarity between each cell <italic>i</italic><sub><italic>s</italic></sub> in the batch <italic>i</italic> and cell <italic>j</italic><sub><italic>t</italic></sub> in the batch <italic>j</italic> is computed using a cluster-specific exponential kernel:<disp-formula id="GR277522ZHOM2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="normal">exp</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>d</italic>(<italic>i</italic><sub><italic>s</italic></sub>, <italic>j</italic><sub><italic>t</italic></sub>) denotes the cosine distance between cell <italic>i</italic><sub><italic>s</italic></sub> and cell <italic>j</italic><sub><italic>t</italic></sub> in the batch <italic>i</italic>-specific low-dimensional space. To reliably select the most similar cells of <italic>i</italic><sub><italic>s</italic></sub>, the cells with the top <italic>k</italic> = 5 similarities are retained. The cell–cell corresponding relationships set of batch <italic>i</italic> is denoted as <inline-formula id="il5"><mml:math id="IL5" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo fence="false">{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo fence="false">}</mml:mo><mml:mi mathvariant="normal">∖</mml:mi><mml:mo fence="false">{</mml:mo><mml:mi>i</mml:mi><mml:mo fence="false">}</mml:mo><mml:mo fence="false">}</mml:mo></mml:math></inline-formula>, and the cells in <italic>P</italic><sub><italic>i</italic></sub> are divided into two subsets including <italic>C</italic><sub><italic>i</italic></sub> = {<italic>i</italic><sub><italic>s</italic></sub>|<italic>i</italic><sub><italic>s</italic></sub> ∈ <italic>P</italic><sub><italic>i</italic></sub>, <italic>i</italic><sub><italic>s</italic></sub> ∈ <italic>i</italic>} and <inline-formula id="il6"><mml:math id="IL6" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo fence="false">{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo fence="false">}</mml:mo><mml:mi mathvariant="normal">∖</mml:mi><mml:mo fence="false">{</mml:mo><mml:mi>i</mml:mi><mml:mo fence="false">}</mml:mo><mml:mo fence="false">}</mml:mo></mml:math></inline-formula>. Note that these batch <italic>i</italic>-specific sets <italic>P</italic><sub><italic>i</italic></sub>’s are not directly used for downstream analysis such as clustering analysis, but only to infer the integrated data.</p>
    </sec>
    <sec id="s3d">
      <title>Cell similarity filtering on the cPCA space</title>
      <p>This step aims to remove the false similarity connections between different cell populations, which are prone to occur in the integration scenario with different biological conditions. For batch <italic>i</italic>, the identified similar cells are embedded in the cPCA space, to capture subtle transcriptional differences. Specifically, let <inline-formula id="il7"><mml:math id="IL7" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="il8"><mml:math id="IL8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> be the expression submatrices for <italic>C</italic><sub><italic>i</italic></sub> and <italic>R</italic><sub><italic>i</italic></sub>, respectively. Then <inline-formula id="il9"><mml:math id="IL9" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="il10"><mml:math id="IL10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are centered by the mean of <inline-formula id="il11"><mml:math id="IL11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The goal is to find the contrastive direction of the variation difference between target data <inline-formula id="il12"><mml:math id="IL12" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula> and background data <inline-formula id="il13"><mml:math id="IL13" display="inline" overflow="scroll"><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>:<disp-formula id="GR277522ZHOM3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mtable columnalign="right left" rowspacing=".5em" columnspacing="thickmathspace" displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mrow><mml:mo form="prefix">max</mml:mo></mml:mrow><mml:mi>v</mml:mi></mml:munder><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>v</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo><mml:mi>v</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>s</mml:mi><mml:mo>.</mml:mo><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mspace width="0.4em"/><mml:msubsup><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>v</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
Note this model is slightly different from the original cPCA model in terms of the parameter α, which we illustrate in the <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>. This optimization problem can be solved by eigenvalue decomposition of <inline-formula id="il14"><mml:math id="IL14" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msubsup></mml:math></inline-formula>. The top <italic>l</italic> = 40 contrastive principal components (cPCs) are used to generate the cPCA subspace. When a few similar cells are shared between batch <italic>i</italic> and other batches, there may be less than <italic>l</italic> cPCs identified and used to filter the cell–cell similarities. We applied scInt to variant 2 of simulation 1, which had no cell subpopulations shared across batches (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>). The results showed that scInt was robust under this integration scenario (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S17</ext-link>). Then the cell similarity connections whose cosine similarities are less than <italic>T</italic> (0.6 by default) are filtered. The preserved similarities are used to construct the similarity matrix <italic>S</italic>.</p>
    </sec>
    <sec id="s3e">
      <title>Global integration by contrastive biological variation learning</title>
      <p><inline-formula id="il15"><mml:math id="IL15" display="inline" overflow="scroll"><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> encodes the identified cell–cell similarity relationships, where <italic>n</italic> is the total cell number of all batches. Also, <italic>S</italic> is symmetrized, that is, <italic>S</italic> = (<italic>S</italic> + <italic>S</italic><sup><italic>T</italic></sup>)/2. Using identified similarities, we construct a matrix <italic>Z</italic> to represent an invisible data set introduced by technical effects. The idea behind this is that the differences between the expression vector of each cell <italic>i</italic><sub><italic>s</italic></sub> in batch <italic>i</italic> and its identified similar cells <italic>j</italic><sub><italic>t</italic></sub>’s in batch <italic>j</italic> are regarded as technical effects. To construct this invisible data set, for each cell, we calculate the difference vectors between the expression vectors of itself and the weighted averaged sum of their identified similar cells. We use <italic>S</italic><sup><italic>i</italic>,<italic>j</italic></sup> to denote the submatrix of <italic>S</italic> representing the cell–cell similarities between batch <italic>i</italic> and batch <italic>j</italic>, and column-normalized the non-zero columns of <italic>S</italic><sup><italic>i</italic>,<italic>j</italic></sup>’s using the SoftMax function. We construct the technical mixing matrix <italic>M</italic> ∈ ℝ<sup><italic>n</italic>×<italic>n</italic></sup>:<disp-formula id="GR277522ZHOM4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mo>−</mml:mo><mml:mi>S</mml:mi><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>R</italic> is the diagonal matrix with the diagonal elements representing the column sums of <italic>S</italic>, that is, <inline-formula id="il16"><mml:math id="IL16" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mo>⋅</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. <italic>M</italic> encodes all technical mixing coefficients between each batch <italic>i</italic> and its remaining batches. Then the invisible data set of technical effects can be learned:<disp-formula id="GR277522ZHOM5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mi>X</mml:mi><mml:mi>M</mml:mi><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>X</italic> = [<italic>X</italic><sub>1</sub>, · · · , <italic>X</italic><sub><italic>N</italic></sub>] is the stacked gene expression matrix. Because we next learn the covariance matrix of <italic>Z</italic>, to eliminate the effects of the size of identified similarity relationships specific to each batch and avoid large batches dominating integration, we divide each column <italic>i</italic><sub><italic>s</italic></sub> of <italic>M</italic> by <inline-formula id="il17"><mml:math id="IL17" display="inline" overflow="scroll"><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula> as a scale factor. The cPCA model is used to learn the contrastive biological variation and eliminate the technical effects of <italic>X</italic>:<disp-formula id="GR277522ZHOM6"><label>(6)</label><mml:math id="M6" display="block" overflow="scroll"><mml:mtable columnalign="right left" rowspacing=".5em" columnspacing="thickmathspace" displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mrow><mml:mo form="prefix">max</mml:mo></mml:mrow><mml:mi>u</mml:mi></mml:munder><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>u</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>(</mml:mo><mml:mi>X</mml:mi><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>Z</mml:mi><mml:mrow><mml:msup><mml:mi>Z</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo><mml:mi>u</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>s</mml:mi><mml:mo>.</mml:mo><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mspace width="0.4em"/><mml:msubsup><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>u</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
This optimization problem can be solved by eigenvalue decomposition of the contrastive biological variation <italic>D</italic> = <italic>XX</italic><sup><italic>T</italic></sup> − λ<italic>ZZ</italic><sup><italic>T</italic></sup>. The result <italic>U</italic> is the transformation matrix that projects <italic>X</italic> onto the low-dimensional space that is not affected by cross-batch technical variation, that is, <italic>X</italic><sub><italic>correct</italic></sub> = <italic>U</italic><sup><italic>T</italic></sup><italic>X</italic> is the corrected low-dimensional data.</p>
    </sec>
    <sec id="s3f">
      <title>Integration of already integrated reference data and new data</title>
      <p>Let <italic>X</italic><sub><italic>new</italic></sub> be the gene-by-cell gene expression matrix with <italic>n</italic><sub><italic>new</italic></sub> cells of the new data. scInt maps <italic>X</italic><sub><italic>new</italic></sub> onto already integrated reference data with three optional methods (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Fig. S2</ext-link>). Primarily, the projection matrix <italic>U</italic> learned from the previous steps is used to project new data onto the reference data directly, that is, <italic>X</italic><sub><italic>update</italic></sub> = <italic>U</italic><sup><italic>T</italic></sup>[<italic>X</italic>, <italic>X</italic><sub><italic>new</italic></sub>].</p>
      <p>For the second method, the cPCA framework is used to integrate the new data. We use the following objective function:<disp-formula id="GR277522ZHOM7"><label>(7)</label><mml:math id="M7" display="block" overflow="scroll"><mml:mtable columnalign="right left" rowspacing=".5em" columnspacing="thickmathspace" displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:munder><mml:mrow><mml:mo form="prefix">max</mml:mo></mml:mrow><mml:mi>w</mml:mi></mml:munder><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>w</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>(</mml:mo><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo><mml:mi>w</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi>s</mml:mi><mml:mo>.</mml:mo><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mspace width="0.4em"/><mml:msubsup><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>w</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
The top <italic>l</italic> = 40 cPCs are used to learn projection matrix <italic>W</italic> to generate the integrated low-dimensional space, that is, <italic>X</italic><sub><italic>update</italic></sub> = <italic>W</italic><sup><italic>T</italic></sup>[<italic>X</italic>, <italic>X</italic><sub><italic>new</italic></sub>].</p>
      <p>The last method, named the “global” model, uses the previous steps to identify the cell–cell similarity relationships between reference and query data. It constructs a new <inline-formula id="il18"><mml:math id="IL18" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>S</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>×</mml:mo><mml:mo>(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> by the already gained <italic>S</italic> of reference data, the identified cell–cell connections between reference and query data, and the <italic>S</italic><sub><italic>new</italic></sub> of query data if available. Then the new contrastive biological variation <inline-formula id="il19"><mml:math id="IL19" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> and new projection matrix <inline-formula id="il20"><mml:math id="IL20" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>U</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> are learned. <inline-formula id="il21"><mml:math id="IL21" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mi>U</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> projects <italic>X</italic> and <italic>X</italic><sub><italic>new</italic></sub> onto the same low-dimensional space, that is, <inline-formula id="il22"><mml:math id="IL22" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mover><mml:mi>U</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>[</mml:mo><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula>.</p>
      <p>We note the first two models are suitable for situations where reference data captures all the biological variations of query data, that is, there is no new cell type in the query data. The third model is not subject to this limitation and is more applicable to complex reference-based integration tasks. scInt uses the third model by default.</p>
    </sec>
    <sec id="s3g">
      <title>scInt parameters</title>
      <p>In scInt algorithm, there are two main tuning parameters: λ and <italic>T</italic>. Among them, λ controls the degree of mixing of similar cells across different batches in the integrated low-dimensional space, and <italic>T</italic> controls the reliability of the retained similarities. The default values for these parameters are as follows: λ = 5 and <italic>T</italic> = 0.6. scInt was found to be relatively robust to λ and <italic>T</italic> values within certain ranges (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S22, S23</ext-link>). Additionally, we propose a heuristic method to select optimal tuning parameters λ and <italic>T</italic> from certain sets of candidate values (see <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>). We also tested the scInt algorithm under different Leiden clustering resolutions and <italic>k</italic> (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S24, S25</ext-link>) and found that these parameters were robust to the integration results.</p>
    </sec>
    <sec id="s3h">
      <title>Benchmark integration methods</title>
      <p>We benchmarked our method with 10 other state-of-the-art integration methods, including MNN and its extension version fastMNN, LIGER and its online version online iNMF, Seurat, Harmony, Scanorama, RPCI, Conos, and scMC. We visualized the integration results in a two-dimensional space using the UMAP algorithm. In the benchmark work, the data sets were filtered and normalized uniformly. For selecting highly variable features, we used the standard “FindVariableFeatures” function implemented in the Seurat R package with the same parameters, except for methods using their specific feature selection functions, such as LIGER. Further, we selected reasonable key parameters of each method as their user guides described, to ensure a fair comparison. For Seurat, Harmony, and scMC, as they were robust to their key parameters in certain ranges, we used their default parameters for integration. When integrating the dendritic data set, as the cell number in each batch was small, we set the “k.filter” parameter from 200 to 40 for Seurat. When integrating the DiHS/DRESS skin data set, we set group.by.vars = c(“Batch”, “Condition”, “Technology”) and tau = c(2, 2, 2) for Harmony. When integrating the simulated and dendritic data sets, as the default clustering algorithm used in scMC failed to find clusters and marker genes, we set the “resolution” parameter to 0.8. For other MNN-based methods, including MNN, fastMNN, Scanorama, and Conos, we set k = 20 in the MNN pair selection uniformly. For RPCI, we set the reference batch as the batch that contained the most cell types, and eigens = 12, 15, 8, 8, 12, and 15 for simulation 1, simulation 2, simulation 3, dendritic, developing tracheal epithelial, and DiHS/DRESS skin data sets, respectively. For LIGER and online iNMF, we set λ = 5 for all data sets, and k = 10, 20, 20, 15, 20, and 20 for simulation 1, simulation 2, simulation 3, dendritic, developing tracheal epithelial, and DiHS/DRESS skin data sets, respectively. The details of parameter selection for RPCI, LIGER, and online iNMF are described in the <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Material</ext-link> (<ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Methods</ext-link>; <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Figs. S26, S27</ext-link>). These methods were applied using batchelor (version 1.6.2, for MNN and fastMNN), rliger (version 1.0.0, for LIGER and online iNMF), Seurat (version 4.1.0), harmony (version 0.1.0), Scanorama (version 1.7.1), RISC (version 1.0, for RPCI), Conos (version 1.4.3), and scMC (version 1.0.0). We also benchmarked our method with three other reference-based mapping methods, including Seurat, Symphony, and online iNMF. For Seurat, we used its default parameters to perform the mapping. For Symphony, we set group.by.vars = c(“Batch”, “Donor”) and tau = c(2, 2) for pancreas reference data integration. For online iNMF, we set k = 20 and λ = 5 for reference data integration and mapping for both simulated and real data sets in reference-based mapping tasks. These methods were applied using Seurat (version 4.1.0), symphony (version 0.1.0), and rliger (version 1.0.0), respectively.</p>
    </sec>
    <sec id="s3i">
      <title>Evaluation metrics</title>
      <p>To evaluate the performance of our method and other integration tools, we used four benchmark metrics: ARI, batch ASW, cell type LISI, and batch LISI. Additionally, we used the F1 score and ACC to evaluate the prediction accuracy in the reference-based integration tasks.</p>
      <sec id="s3i1">
        <title>ARI</title>
        <p>ARI evaluates the overlap of the original cell type annotation and the cell clustering results from the integrated data. The ARI value scores range from 0 to 1, where 0 indicates that the two clustering labels are independent of each other, and 1 means that the two clustering labels are the same up to a permutation.</p>
      </sec>
      <sec id="s3i2">
        <title>ASW</title>
        <p>ASW also measures the cluster preservation. We use it to evaluate the batch mixing score. The batch ASW score for each cell label <italic>p</italic> is computed as<disp-formula id="GR277522ZHOM8"><label>(8)</label><mml:math id="M8" display="block" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>s</italic>(<italic>i</italic>) is the silhouette width value of cell <italic>i</italic>, <italic>C</italic><sub><italic>p</italic></sub> is the set of cells with the cell label <italic>p</italic>, and |<italic>C</italic><sub><italic>p</italic></sub>| denotes the number of cells in the <italic>C</italic><sub><italic>p</italic></sub>. The final batch ASW scores are averaged:<disp-formula id="GR277522ZHOM9"><label>(9)</label><mml:math id="M9" display="block" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi><mml:mi>W</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mi>M</mml:mi><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi>A</mml:mi><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>M</italic> is the set of cell labels.</p>
      </sec>
      <sec id="s3i3">
        <title>LISI</title>
        <p>LISI assesses the mixing and separation of a given label in the local distribution. Specifically, LISI computes the inverse Simpson's index of cell type label (cLISI) or batch label (iLISI) in the nearest neighbors of a cell selected with a fixed perplexity. For a single cell <italic>i</italic> with cell label <italic>p</italic>, a good integration always expects the iLISI is closed to the number of batches the cell label <italic>p</italic> appears, and cLISI is closed to 1. We modified LISI to make the LISI value between 0 and 1, and used batch LISI and cell type LISI to measure the integration performance specific to a single batch. For batch <italic>b</italic>, we compute the batch LISI by<disp-formula id="GR277522ZHOM10"><label>(10)</label><mml:math id="M10" display="block" overflow="scroll"><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>C</italic><sub><italic>b</italic></sub> denotes the set of cells in batch <italic>b</italic>, <italic>N</italic><sub><italic>i</italic></sub> is the number of batches that the cell label of cell <italic>i</italic> appears, and |<italic>iLISI</italic>(<italic>i</italic>) − <italic>N</italic><sub><italic>i</italic></sub>|/<italic>N</italic><sub><italic>i</italic></sub> measures the deviation between the batch mixing and the ideal mixing around the cell <italic>i</italic> ∈ <italic>C</italic><sub><italic>b</italic></sub>. Similarly, for batch <italic>b</italic>, we compute the cell type LISI by<disp-formula id="GR277522ZHOM11"><label>(11)</label><mml:math id="M11" display="block" overflow="scroll"><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo fence="false">|</mml:mo><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
The final batch LISI and cell type LISI scores are averaged:<disp-formula id="GR277522ZHOM12"><label>(12)</label><mml:math id="M12" display="block" overflow="scroll"><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mi>B</mml:mi><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
<disp-formula id="GR277522ZHOM13"><label>(13)</label><mml:math id="M13" display="block" overflow="scroll"><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mi>B</mml:mi><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.4em"/><mml:mi>L</mml:mi><mml:mi>I</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
</p>
      </sec>
      <sec id="s3i4">
        <title>F1 scores</title>
        <p>The F1 score is a weighted mean of precision rate and recall rate given by the equation:<disp-formula id="GR277522ZHOM14"><label>(14)</label><mml:math id="M14" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
It returns a value between 0 and 1, where 1 shows the best prediction.</p>
      </sec>
      <sec id="s3i5">
        <title>ACC</title>
        <p>ACC is calculated by dividing the number of correct predictions by the total number of predictions:<disp-formula id="GR277522ZHOM15"><label>(15)</label><mml:math id="M15" display="block" overflow="scroll"><mml:mi>A</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>n</mml:mi><mml:mi>u</mml:mi><mml:mi>m</mml:mi><mml:mi>b</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mspace width="0.4em"/><mml:mi>o</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.4em"/><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mspace width="0.4em"/><mml:mi>n</mml:mi><mml:mi>u</mml:mi><mml:mi>m</mml:mi><mml:mi>b</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mspace width="0.4em"/><mml:mi>o</mml:mi><mml:mi>f</mml:mi><mml:mspace width="0.4em"/><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
It shows the prediction performance of the proportion of correct predictions.</p>
      </sec>
    </sec>
    <sec id="s3j">
      <title>Data sets</title>
      <p>The details of the data sets in this study are listed in <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Table S1</ext-link>.</p>
    </sec>
    <sec id="s3k">
      <title>Software availability</title>
      <p>The scInt R package (<xref rid="GR277522ZHOC29" ref-type="bibr">R Core Team 2020</xref>) is available freely at GitHub (<uri xlink:href="https://github.com/Jinsl-lab/scInt">https://github.com/Jinsl-lab/scInt</uri>). Source codes to reproduce the results in this manuscript are available at GitHub (<uri xlink:href="https://github.com/Jinsl-lab/scInt_reproducibility">https://github.com/Jinsl-lab/scInt_reproducibility</uri>). Both the R package and source codes are also available as <ext-link xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.277522.122/-/DC1" ext-link-type="uri">Supplemental Code</ext-link>.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplemental Material</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_33_5_750__DC1.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="supp_gr.277522.122_Supplemental_Material.pdf"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="supp_gr.277522.122_Supplemental_Source_Codes.zip"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="supp_gr.277522.122_Supplemental_scInt_.zip"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>This work was supported by the National Natural Science Foundation of China (Grants No. 62271173, No. 11971130, and No. 62172122), the Key Research and Development Program of Heilongjiang (Grant No. 2022ZX01A19), and the Interdisciplinary Research Foundation of HIT (Grant No. IR2021109).</p>
    <p><italic>Author contributions:</italic> S.J. and Y.Z. designed this project. Y.Z. conceived the idea, developed the model, and designed the analysis. Y.Z., Q.S., J.Q., and J.H. implemented the software and performed the analysis. Y.Z., Q.S., B.Y., and L.W. composed the manuscript. All authors read and approved the final manuscript.</p>
  </ack>
  <fn-group>
    <fn fn-type="supplementary-material">
      <p>[Supplemental material is available for this article.]</p>
    </fn>
    <fn>
      <p>Article published online before print. Article, supplemental material, and publication date are at <ext-link xlink:href="https://www.genome.org/cgi/doi/10.1101/gr.277522.122" ext-link-type="uri">https://www.genome.org/cgi/doi/10.1101/gr.277522.122</ext-link>.</p>
    </fn>
  </fn-group>
  <sec id="s5">
    <title>Competing interest statement</title>
    <p>The authors declare no competing interests.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="GR277522ZHOC1">
      <mixed-citation publication-type="journal"><string-name><surname>Abid</surname><given-names>A</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Bagaria</surname><given-names>VK</given-names></string-name>, <string-name><surname>Zou</surname><given-names>J</given-names></string-name>. <year>2018</year>. <article-title>Exploring patterns enriched in a dataset with contrastive principal component analysis</article-title>. <source>Nat Commun</source><volume>9</volume>: <fpage>2134</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-018-04608-8</pub-id><pub-id pub-id-type="pmid">29849030</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC2">
      <mixed-citation publication-type="journal"><string-name><surname>Barkas</surname><given-names>N</given-names></string-name>, <string-name><surname>Petukhov</surname><given-names>V</given-names></string-name>, <string-name><surname>Nikolaeva</surname><given-names>D</given-names></string-name>, <string-name><surname>Lozinsky</surname><given-names>Y</given-names></string-name>, <string-name><surname>Demharter</surname><given-names>S</given-names></string-name>, <string-name><surname>Khodosevich</surname><given-names>K</given-names></string-name>, <string-name><surname>Kharchenko</surname><given-names>PV</given-names></string-name>. <year>2019</year>. <article-title>Joint analysis of heterogeneous single-cell RNA-seq dataset collections</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>695</fpage>–<lpage>698</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0466-z</pub-id><pub-id pub-id-type="pmid">31308548</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC3">
      <mixed-citation publication-type="journal"><string-name><surname>Baron</surname><given-names>M</given-names></string-name>, <string-name><surname>Veres</surname><given-names>A</given-names></string-name>, <string-name><surname>Wolock</surname><given-names>SL</given-names></string-name>, <string-name><surname>Faust</surname><given-names>AL</given-names></string-name>, <string-name><surname>Gaujoux</surname><given-names>R</given-names></string-name>, <string-name><surname>Vetere</surname><given-names>A</given-names></string-name>, <string-name><surname>Ryu</surname><given-names>JH</given-names></string-name>, <string-name><surname>Wagner</surname><given-names>BK</given-names></string-name>, <string-name><surname>Shen-Orr</surname><given-names>SS</given-names></string-name>, <string-name><surname>Klein</surname><given-names>AM</given-names></string-name>, <etal/><year>2016</year>. <article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title>. <source>Cell Syst</source><volume>3</volume>: <fpage>346</fpage>–<lpage>360.e4</lpage>. <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id><pub-id pub-id-type="pmid">27667365</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC4">
      <mixed-citation publication-type="journal"><string-name><surname>Becht</surname><given-names>E</given-names></string-name>, <string-name><surname>McInnes</surname><given-names>L</given-names></string-name>, <string-name><surname>Healy</surname><given-names>J</given-names></string-name>, <string-name><surname>Dutertre</surname><given-names>CA</given-names></string-name>, <string-name><surname>Kwok</surname><given-names>IWH</given-names></string-name>, <string-name><surname>Ng</surname><given-names>LG</given-names></string-name>, <string-name><surname>Ginhoux</surname><given-names>F</given-names></string-name>, <string-name><surname>Newell</surname><given-names>EW</given-names></string-name>. <year>2019</year>. <article-title>Dimensionality reduction for visualizing single-cell data using UMAP</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>38</fpage>–<lpage>44</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4314</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC5">
      <mixed-citation publication-type="journal"><string-name><surname>Björklund</surname><given-names>AK</given-names></string-name>, <string-name><surname>Forkel</surname><given-names>M</given-names></string-name>, <string-name><surname>Picelli</surname><given-names>S</given-names></string-name>, <string-name><surname>Konya</surname><given-names>V</given-names></string-name>, <string-name><surname>Theorell</surname><given-names>J</given-names></string-name>, <string-name><surname>Friberg</surname><given-names>D</given-names></string-name>, <string-name><surname>Sandberg</surname><given-names>R</given-names></string-name>, <string-name><surname>Mjösberg</surname><given-names>J</given-names></string-name>. <year>2016</year>. <article-title>The heterogeneity of human CD127<sup>+</sup> innate lymphoid cells revealed by single-cell RNA sequencing</article-title>. <source>Nat Immunol</source><volume>17</volume>: <fpage>451</fpage>–<lpage>460</lpage>. <pub-id pub-id-type="doi">10.1038/ni.3368</pub-id><pub-id pub-id-type="pmid">26878113</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC6">
      <mixed-citation publication-type="journal"><string-name><surname>Büttner</surname><given-names>M</given-names></string-name>, <string-name><surname>Miao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Teichmann</surname><given-names>SA</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2019</year>. <article-title>A test metric for assessing single-cell RNA-seq batch correction</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>43</fpage>–<lpage>49</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-018-0254-1</pub-id><pub-id pub-id-type="pmid">30573817</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC7">
      <mixed-citation publication-type="journal"><string-name><surname>Cao</surname><given-names>J</given-names></string-name>, <string-name><surname>Spielmann</surname><given-names>M</given-names></string-name>, <string-name><surname>Qiu</surname><given-names>X</given-names></string-name>, <string-name><surname>Huang</surname><given-names>X</given-names></string-name>, <string-name><surname>Ibrahim</surname><given-names>DM</given-names></string-name>, <string-name><surname>Hill</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>F</given-names></string-name>, <string-name><surname>Mundlos</surname><given-names>S</given-names></string-name>, <string-name><surname>Christiansen</surname><given-names>L</given-names></string-name>, <string-name><surname>Steemers</surname><given-names>FJ</given-names></string-name>, <etal/><year>2019</year>. <article-title>The single-cell transcriptional landscape of mammalian organogenesis</article-title>. <source>Nature</source><volume>566</volume>: <fpage>496</fpage>–<lpage>502</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-019-0969-x</pub-id><pub-id pub-id-type="pmid">30787437</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC8">
      <mixed-citation publication-type="journal"><string-name><surname>Gao</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>, <string-name><surname>Kriebel</surname><given-names>AR</given-names></string-name>, <string-name><surname>Preissl</surname><given-names>S</given-names></string-name>, <string-name><surname>Luo</surname><given-names>C</given-names></string-name>, <string-name><surname>Castanon</surname><given-names>R</given-names></string-name>, <string-name><surname>Sandoval</surname><given-names>J</given-names></string-name>, <string-name><surname>Rivkin</surname><given-names>A</given-names></string-name>, <string-name><surname>Nery</surname><given-names>JR</given-names></string-name>, <string-name><surname>Behrens</surname><given-names>MM</given-names></string-name>, <etal/><year>2021</year>. <article-title>Iterative single-cell multi-omic integration using online learning</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>1000</fpage>–<lpage>1007</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-021-00867-x</pub-id><pub-id pub-id-type="pmid">33875866</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC9">
      <mixed-citation publication-type="journal"><string-name><surname>Grün</surname><given-names>D</given-names></string-name>, <string-name><surname>Muraro</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Boisset</surname><given-names>JC</given-names></string-name>, <string-name><surname>Wiebrands</surname><given-names>K</given-names></string-name>, <string-name><surname>Lyubimova</surname><given-names>A</given-names></string-name>, <string-name><surname>Dharmadhikari</surname><given-names>G</given-names></string-name>, <string-name><surname>van den Born</surname><given-names>M</given-names></string-name>, <string-name><surname>van Es</surname><given-names>J</given-names></string-name>, <string-name><surname>Jansen</surname><given-names>E</given-names></string-name>, <string-name><surname>Clevers</surname><given-names>H</given-names></string-name>, <etal/><year>2016</year>. <article-title>De novo prediction of stem cell identity using single-cell transcriptome data</article-title>. <source>Cell Stem Cell</source><volume>19</volume>: <fpage>266</fpage>–<lpage>277</lpage>. <pub-id pub-id-type="doi">10.1016/j.stem.2016.05.010</pub-id><pub-id pub-id-type="pmid">27345837</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC10">
      <mixed-citation publication-type="journal"><string-name><surname>Guo</surname><given-names>C</given-names></string-name>, <string-name><surname>Li</surname><given-names>B</given-names></string-name>, <string-name><surname>Ma</surname><given-names>H</given-names></string-name>, <string-name><surname>Wang</surname><given-names>X</given-names></string-name>, <string-name><surname>Cai</surname><given-names>P</given-names></string-name>, <string-name><surname>Yu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>L</given-names></string-name>, <string-name><surname>Jin</surname><given-names>L</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>C</given-names></string-name>, <string-name><surname>Fang</surname><given-names>J</given-names></string-name>, <etal/><year>2020</year>. <article-title>Single-cell analysis of two severe COVID-19 patients reveals a monocyte-associated and tocilizumab-responding cytokine storm</article-title>. <source>Nat Commun</source><volume>11</volume>: <fpage>3924</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-020-17834-w</pub-id><pub-id pub-id-type="pmid">32764665</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC11">
      <mixed-citation publication-type="journal"><string-name><surname>Haghverdi</surname><given-names>L</given-names></string-name>, <string-name><surname>Lun</surname><given-names>ATL</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>MD</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>. <year>2018</year>. <article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title>. <source>Nat Biotechnol</source><volume>36</volume>: <fpage>421</fpage>–<lpage>427</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4091</pub-id><pub-id pub-id-type="pmid">29608177</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC12">
      <mixed-citation publication-type="journal"><string-name><surname>Hao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <string-name><surname>Andersen-Nissen</surname><given-names>E</given-names></string-name>, <string-name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></string-name>, <string-name><surname>Zheng</surname><given-names>S</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Wilk</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Darby</surname><given-names>C</given-names></string-name>, <string-name><surname>Zager</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Integrated analysis of multimodal single-cell data</article-title>. <source>Cell</source><volume>184</volume>: <fpage>3573</fpage>–<lpage>3587.e29</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id><pub-id pub-id-type="pmid">34062119</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC13">
      <mixed-citation publication-type="journal"><string-name><surname>Hie</surname><given-names>B</given-names></string-name>, <string-name><surname>Bryson</surname><given-names>B</given-names></string-name>, <string-name><surname>Berger</surname><given-names>B</given-names></string-name>. <year>2019</year>. <article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>685</fpage>–<lpage>691</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id><pub-id pub-id-type="pmid">31061482</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC14">
      <mixed-citation publication-type="journal"><string-name><surname>Hubert</surname><given-names>L</given-names></string-name>, <string-name><surname>Arabie</surname><given-names>P</given-names></string-name>. <year>1985</year>. <article-title>Comparing partitions</article-title>. <source>J Classif</source><volume>2</volume>: <fpage>193</fpage>–<lpage>218</lpage>. <pub-id pub-id-type="doi">10.1007/BF01908075</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC15">
      <mixed-citation publication-type="journal"><string-name><surname>Kang</surname><given-names>JB</given-names></string-name>, <string-name><surname>Nathan</surname><given-names>A</given-names></string-name>, <string-name><surname>Weinand</surname><given-names>K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>F</given-names></string-name>, <string-name><surname>Millard</surname><given-names>N</given-names></string-name>, <string-name><surname>Rumker</surname><given-names>L</given-names></string-name>, <string-name><surname>Moody</surname><given-names>DB</given-names></string-name>, <string-name><surname>Korsunsky</surname><given-names>I</given-names></string-name>, <string-name><surname>Raychaudhuri</surname><given-names>S</given-names></string-name>. <year>2021</year>. <article-title>Efficient and precise single-cell reference atlas mapping with Symphony</article-title>. <source>Nat Commun</source><volume>12</volume>: <fpage>5890</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-021-25957-x</pub-id><pub-id pub-id-type="pmid">34620862</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC16">
      <mixed-citation publication-type="journal"><string-name><surname>Kim</surname><given-names>D</given-names></string-name>, <string-name><surname>Kobayashi</surname><given-names>T</given-names></string-name>, <string-name><surname>Voisin</surname><given-names>B</given-names></string-name>, <string-name><surname>Jo</surname><given-names>JH</given-names></string-name>, <string-name><surname>Sakamoto</surname><given-names>K</given-names></string-name>, <string-name><surname>Jin</surname><given-names>SP</given-names></string-name>, <string-name><surname>Kelly</surname><given-names>M</given-names></string-name>, <string-name><surname>Pasieka</surname><given-names>HB</given-names></string-name>, <string-name><surname>Naff</surname><given-names>JL</given-names></string-name>, <string-name><surname>Meyerle</surname><given-names>JH</given-names></string-name>, <etal/><year>2020</year>. <article-title>Targeted therapy guided by single-cell transcriptomic analysis in drug-induced hypersensitivity syndrome: a case report</article-title>. <source>Nat Med</source><volume>26</volume>: <fpage>236</fpage>–<lpage>243</lpage>. <pub-id pub-id-type="doi">10.1038/s41591-019-0733-7</pub-id><pub-id pub-id-type="pmid">31959990</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC17">
      <mixed-citation publication-type="journal"><string-name><surname>Kiyokawa</surname><given-names>H</given-names></string-name>, <string-name><surname>Yamaoka</surname><given-names>A</given-names></string-name>, <string-name><surname>Matsuoka</surname><given-names>C</given-names></string-name>, <string-name><surname>Tokuhara</surname><given-names>T</given-names></string-name>, <string-name><surname>Abe</surname><given-names>T</given-names></string-name>, <string-name><surname>Morimoto</surname><given-names>M</given-names></string-name>. <year>2021</year>. <article-title>Airway basal stem cells reuse the embryonic proliferation regulator, Tgfβ-Id2 axis, for tissue regeneration</article-title>. <source>Dev Cell</source><volume>56</volume>: <fpage>1917</fpage>–<lpage>1929.e9</lpage>. <pub-id pub-id-type="doi">10.1016/j.devcel.2021.05.016</pub-id><pub-id pub-id-type="pmid">34129836</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC18">
      <mixed-citation publication-type="journal"><string-name><surname>Korsunsky</surname><given-names>I</given-names></string-name>, <string-name><surname>Millard</surname><given-names>N</given-names></string-name>, <string-name><surname>Fan</surname><given-names>J</given-names></string-name>, <string-name><surname>Slowikowski</surname><given-names>K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>F</given-names></string-name>, <string-name><surname>Wei</surname><given-names>K</given-names></string-name>, <string-name><surname>Baglaenko</surname><given-names>Y</given-names></string-name>, <string-name><surname>Brenner</surname><given-names>M</given-names></string-name>, <string-name><surname>Loh</surname><given-names>PR</given-names></string-name>, <string-name><surname>Raychaudhuri</surname><given-names>S</given-names></string-name>. <year>2019</year>. <article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>1289</fpage>–<lpage>1296</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id><pub-id pub-id-type="pmid">31740819</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC19">
      <mixed-citation publication-type="journal"><string-name><surname>Lawlor</surname><given-names>N</given-names></string-name>, <string-name><surname>George</surname><given-names>J</given-names></string-name>, <string-name><surname>Bolisetty</surname><given-names>M</given-names></string-name>, <string-name><surname>Kursawe</surname><given-names>R</given-names></string-name>, <string-name><surname>Sun</surname><given-names>L</given-names></string-name>, <string-name><surname>Sivakamasundari</surname><given-names>V</given-names></string-name>, <string-name><surname>Kycia</surname><given-names>I</given-names></string-name>, <string-name><surname>Robson</surname><given-names>P</given-names></string-name>, <string-name><surname>Stitzel</surname><given-names>ML</given-names></string-name>. <year>2017</year>. <article-title>Single-cell transcriptomes identify human islet cell signatures and reveal cell-type–specific expression changes in type 2 diabetes</article-title>. <source>Genome Res</source><volume>27</volume>: <fpage>208</fpage>–<lpage>222</lpage>. <pub-id pub-id-type="doi">10.1101/gr.212720.116</pub-id><pub-id pub-id-type="pmid">27864352</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC20">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Wang</surname><given-names>T</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>B</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>D</given-names></string-name>. <year>2021</year>. <article-title>Robust integration of multiple single-cell RNA sequencing datasets using a single reference space</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>877</fpage>–<lpage>884</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-021-00859-x</pub-id><pub-id pub-id-type="pmid">33767393</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC21">
      <mixed-citation publication-type="journal"><string-name><surname>Luecken</surname><given-names>MD</given-names></string-name>, <string-name><surname>Büttner</surname><given-names>M</given-names></string-name>, <string-name><surname>Chaichoompu</surname><given-names>K</given-names></string-name>, <string-name><surname>Danese</surname><given-names>A</given-names></string-name>, <string-name><surname>Interlandi</surname><given-names>M</given-names></string-name>, <string-name><surname>Mueller</surname><given-names>MF</given-names></string-name>, <string-name><surname>Strobl</surname><given-names>DC</given-names></string-name>, <string-name><surname>Zappia</surname><given-names>L</given-names></string-name>, <string-name><surname>Dugas</surname><given-names>M</given-names></string-name>, <string-name><surname>Colomé-Tatché</surname><given-names>M</given-names></string-name>, <etal/><year>2022</year>. <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>41</fpage>–<lpage>50</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01336-8</pub-id><pub-id pub-id-type="pmid">34949812</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC22">
      <mixed-citation publication-type="journal"><string-name><surname>Moon</surname><given-names>KR</given-names></string-name>, <string-name><surname>van Dijk</surname><given-names>D</given-names></string-name>, <string-name><surname>Wang</surname><given-names>Z</given-names></string-name>, <string-name><surname>Gigante</surname><given-names>S</given-names></string-name>, <string-name><surname>Burkhardt</surname><given-names>DB</given-names></string-name>, <string-name><surname>Chen</surname><given-names>WS</given-names></string-name>, <string-name><surname>Yim</surname><given-names>K</given-names></string-name>, <string-name><surname>Elzen</surname><given-names>AVD</given-names></string-name>, <string-name><surname>Hirn</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Coifman</surname><given-names>RR</given-names></string-name>, <etal/><year>2019</year>. <article-title>Visualizing structure and transitions in high-dimensional biological data</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>1482</fpage>–<lpage>1492</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0336-3</pub-id><pub-id pub-id-type="pmid">31796933</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC23">
      <mixed-citation publication-type="journal"><string-name><surname>Muraro</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Dharmadhikari</surname><given-names>G</given-names></string-name>, <string-name><surname>Grün</surname><given-names>D</given-names></string-name>, <string-name><surname>Groen</surname><given-names>N</given-names></string-name>, <string-name><surname>Dielen</surname><given-names>T</given-names></string-name>, <string-name><surname>Jansen</surname><given-names>E</given-names></string-name>, <string-name><surname>van Gurp</surname><given-names>L</given-names></string-name>, <string-name><surname>Engelse</surname><given-names>MA</given-names></string-name>, <string-name><surname>Carlotti</surname><given-names>F</given-names></string-name>, <string-name><surname>de Koning</surname><given-names>EJ</given-names></string-name>, <etal/><year>2016</year>. <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>. <source>Cell Syst</source><volume>3</volume>: <fpage>385</fpage>–<lpage>394.e3</lpage>. <pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id><pub-id pub-id-type="pmid">27693023</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC24">
      <mixed-citation publication-type="journal"><string-name><surname>Nyfeler</surname><given-names>B</given-names></string-name>, <string-name><surname>Pichler</surname><given-names>WJ</given-names></string-name>. <year>1997</year>. <article-title>The lymphocyte transformation test for the diagnosis of drug allergy: sensitivity and specificity</article-title>. <source>Clin Exp Allergy</source><volume>27</volume>: <fpage>175</fpage>–<lpage>181</lpage>. <pub-id pub-id-type="doi">10.1111/j.1365-2222.1997.tb00690.x</pub-id><pub-id pub-id-type="pmid">9061217</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC25">
      <mixed-citation publication-type="journal"><string-name><surname>Papalexi</surname><given-names>E</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>. <year>2018</year>. <article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title>. <source>Nat Rev Immunol</source><volume>18</volume>: <fpage>35</fpage>–<lpage>45</lpage>. <pub-id pub-id-type="doi">10.1038/nri.2017.76</pub-id><pub-id pub-id-type="pmid">28787399</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC26">
      <mixed-citation publication-type="journal"><string-name><surname>Patel</surname><given-names>AP</given-names></string-name>, <string-name><surname>Tirosh</surname><given-names>I</given-names></string-name>, <string-name><surname>Trombetta</surname><given-names>JJ</given-names></string-name>, <string-name><surname>Shalek</surname><given-names>AK</given-names></string-name>, <string-name><surname>Gillespie</surname><given-names>SM</given-names></string-name>, <string-name><surname>Wakimoto</surname><given-names>H</given-names></string-name>, <string-name><surname>Cahill</surname><given-names>DP</given-names></string-name>, <string-name><surname>Nahed</surname><given-names>BV</given-names></string-name>, <string-name><surname>Curry</surname><given-names>WT</given-names></string-name>, <string-name><surname>Martuza</surname><given-names>RL</given-names></string-name>, <etal/><year>2014</year>. <article-title>Single-cell RNA-seq highlights intratumoral heterogeneity in primary glioblastoma</article-title>. <source>Science</source><volume>344</volume>: <fpage>1396</fpage>–<lpage>1401</lpage>. <pub-id pub-id-type="doi">10.1126/science.1254257</pub-id><pub-id pub-id-type="pmid">24925914</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC27">
      <mixed-citation publication-type="journal"><string-name><surname>Pichler</surname><given-names>WJ</given-names></string-name>, <string-name><surname>Tilch</surname><given-names>J</given-names></string-name>. <year>2004</year>. <article-title>The lymphocyte transformation test in the diagnosis of drug hypersensitivity</article-title>. <source>Allergy</source><volume>59</volume>: <fpage>809</fpage>–<lpage>820</lpage>. <pub-id pub-id-type="doi">10.1111/j.1398-9995.2004.00547.x</pub-id><pub-id pub-id-type="pmid">15230812</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC28">
      <mixed-citation publication-type="journal"><string-name><surname>Polański</surname><given-names>K</given-names></string-name>, <string-name><surname>Young</surname><given-names>MD</given-names></string-name>, <string-name><surname>Miao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Meyer</surname><given-names>KB</given-names></string-name>, <string-name><surname>Teichmann</surname><given-names>SA</given-names></string-name>, <string-name><surname>Park</surname><given-names>JE</given-names></string-name>. <year>2020</year>. <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>. <source>Bioinformatics</source><volume>36</volume>: <fpage>964</fpage>–<lpage>965</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id><pub-id pub-id-type="pmid">31400197</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC29">
      <mixed-citation publication-type="book"><collab>R Core Team</collab>. <year>2020</year>. <source>R: a language and environment for statistical computing</source>. <publisher-name>R Foundation for Statistical Computing</publisher-name>, <publisher-loc>Vienna</publisher-loc>. <comment><uri xlink:href="https://www.R-project.org/">https://www.R-project.org/</uri></comment>.</mixed-citation>
    </ref>
    <ref id="GR277522ZHOC30">
      <mixed-citation publication-type="journal"><string-name><surname>Rosenberg</surname><given-names>AB</given-names></string-name>, <string-name><surname>Roco</surname><given-names>CM</given-names></string-name>, <string-name><surname>Muscat</surname><given-names>RA</given-names></string-name>, <string-name><surname>Kuchina</surname><given-names>A</given-names></string-name>, <string-name><surname>Sample</surname><given-names>P</given-names></string-name>, <string-name><surname>Yao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Graybuck</surname><given-names>LT</given-names></string-name>, <string-name><surname>Peeler</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Mukherjee</surname><given-names>S</given-names></string-name>, <string-name><surname>Chen</surname><given-names>W</given-names></string-name>, <etal/><year>2018</year>. <article-title>Single-cell profiling of the developing mouse brain and spinal cord with split-pool barcoding</article-title>. <source>Science</source><volume>360</volume>: <fpage>176</fpage>–<lpage>182</lpage>. <pub-id pub-id-type="doi">10.1126/science.aam8999</pub-id><pub-id pub-id-type="pmid">29545511</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC31">
      <mixed-citation publication-type="journal"><string-name><surname>Segerstolpe</surname><given-names>A</given-names></string-name>, <string-name><surname>Palasantza</surname><given-names>A</given-names></string-name>, <string-name><surname>Eliasson</surname><given-names>P</given-names></string-name>, <string-name><surname>Andérsson</surname><given-names>EM</given-names></string-name>, <string-name><surname>Andreasson</surname><given-names>AC</given-names></string-name>, <string-name><surname>Sun</surname><given-names>X</given-names></string-name>, <string-name><surname>Picelli</surname><given-names>S</given-names></string-name>, <string-name><surname>Sabirsh</surname><given-names>A</given-names></string-name>, <string-name><surname>Clausen</surname><given-names>M</given-names></string-name>, <string-name><surname>Bjursell</surname><given-names>MK</given-names></string-name>, <etal/><year>2016</year>. <article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title>. <source>Cell Metab</source><volume>24</volume>: <fpage>593</fpage>–<lpage>607</lpage>. <pub-id pub-id-type="doi">10.1016/j.cmet.2016.08.020</pub-id><pub-id pub-id-type="pmid">27667667</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC32">
      <mixed-citation publication-type="journal"><string-name><surname>Stuart</surname><given-names>T</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>P</given-names></string-name>, <string-name><surname>Hafemeister</surname><given-names>C</given-names></string-name>, <string-name><surname>Papalexi</surname><given-names>E</given-names></string-name>, <string-name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></string-name>, <string-name><surname>Hao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Stoeckius</surname><given-names>M</given-names></string-name>, <string-name><surname>Smibert</surname><given-names>P</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>. <year>2019</year>. <article-title>Comprehensive integration of single-cell data</article-title>. <source>Cell</source><volume>177</volume>: <fpage>1888</fpage>–<lpage>1902.e21</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id><pub-id pub-id-type="pmid">31178118</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC33">
      <mixed-citation publication-type="journal"><string-name><surname>Traag</surname><given-names>VA</given-names></string-name>, <string-name><surname>Waltman</surname><given-names>L</given-names></string-name>, <string-name><surname>van Eck</surname><given-names>NJ</given-names></string-name>. <year>2019</year>. <article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title>. <source>Sci Rep</source><volume>9</volume>: <fpage>5233</fpage>. <pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id><pub-id pub-id-type="pmid">30914743</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC34">
      <mixed-citation publication-type="journal"><string-name><surname>Tran</surname><given-names>HTN</given-names></string-name>, <string-name><surname>Ang</surname><given-names>KS</given-names></string-name>, <string-name><surname>Chevrier</surname><given-names>M</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Lee</surname><given-names>NYS</given-names></string-name>, <string-name><surname>Goh</surname><given-names>M</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>. <year>2020</year>. <article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><volume>21</volume>: <fpage>12</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id><pub-id pub-id-type="pmid">31948481</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC35">
      <mixed-citation publication-type="journal"><string-name><surname>Villani</surname><given-names>AC</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>, <string-name><surname>Reynolds</surname><given-names>G</given-names></string-name>, <string-name><surname>Sarkizova</surname><given-names>S</given-names></string-name>, <string-name><surname>Shekhar</surname><given-names>K</given-names></string-name>, <string-name><surname>Fletcher</surname><given-names>J</given-names></string-name>, <string-name><surname>Griesbeck</surname><given-names>M</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>S</given-names></string-name>, <string-name><surname>Lazo</surname><given-names>S</given-names></string-name>, <etal/><year>2017</year>. <article-title>Single-cell RNA-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title>. <source>Science</source><volume>356</volume>: <fpage>eaah4573</fpage>. <pub-id pub-id-type="doi">10.1126/science.aah4573</pub-id><pub-id pub-id-type="pmid">28428369</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC36">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Navin</surname><given-names>NE</given-names></string-name>. <year>2015</year>. <article-title>Advances and applications of single-cell sequencing technologies</article-title>. <source>Mol Cell</source><volume>58</volume>: <fpage>598</fpage>–<lpage>609</lpage>. <pub-id pub-id-type="doi">10.1016/j.molcel.2015.05.005</pub-id><pub-id pub-id-type="pmid">26000845</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC37">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>J</given-names></string-name>, <string-name><surname>Jenjaroenpun</surname><given-names>P</given-names></string-name>, <string-name><surname>Bhinge</surname><given-names>A</given-names></string-name>, <string-name><surname>Angarica</surname><given-names>VE</given-names></string-name>, <string-name><surname>Del Sol</surname><given-names>A</given-names></string-name>, <string-name><surname>Nookaew</surname><given-names>I</given-names></string-name>, <string-name><surname>Kuznetsov</surname><given-names>VA</given-names></string-name>, <string-name><surname>Stanton</surname><given-names>LW</given-names></string-name>. <year>2017</year>. <article-title>Single-cell gene expression analysis reveals regulators of distinct cell subpopulations among developing human neurons</article-title>. <source>Genome Res</source><volume>27</volume>: <fpage>1783</fpage>–<lpage>1794</lpage>. <pub-id pub-id-type="doi">10.1101/gr.223313.117</pub-id><pub-id pub-id-type="pmid">29030469</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC38">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>C</given-names></string-name>, <string-name><surname>Xie</surname><given-names>J</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>L</given-names></string-name>, <string-name><surname>Fei</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>H</given-names></string-name>, <string-name><surname>Tan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Nie</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>L</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Ren</surname><given-names>Y</given-names></string-name>, <etal/><year>2020</year>. <article-title>Alveolar macrophage dysfunction and cytokine storm in the pathogenesis of two severe COVID-19 patients</article-title>. <source>EBioMedicine</source><volume>57</volume>: <fpage>102833</fpage>. <pub-id pub-id-type="doi">10.1016/j.ebiom.2020.102833</pub-id><pub-id pub-id-type="pmid">32574956</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC39">
      <mixed-citation publication-type="journal"><string-name><surname>Welch</surname><given-names>JD</given-names></string-name>, <string-name><surname>Kozareva</surname><given-names>V</given-names></string-name>, <string-name><surname>Ferreira</surname><given-names>A</given-names></string-name>, <string-name><surname>Vanderburg</surname><given-names>C</given-names></string-name>, <string-name><surname>Martin</surname><given-names>C</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>. <year>2019</year>. <article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>. <source>Cell</source><volume>177</volume>: <fpage>1873</fpage>–<lpage>1887.e17</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id><pub-id pub-id-type="pmid">31178122</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC40">
      <mixed-citation publication-type="journal"><string-name><surname>Yu</surname><given-names>G</given-names></string-name>, <string-name><surname>Wang</surname><given-names>LG</given-names></string-name>, <string-name><surname>Han</surname><given-names>Y</given-names></string-name>, <string-name><surname>He</surname><given-names>QY</given-names></string-name>. <year>2012</year>. <article-title>clusterProfiler: an R package for comparing biological themes among gene clusters</article-title>. <source>OMICS</source><volume>16</volume>: <fpage>284</fpage>–<lpage>287</lpage>. <pub-id pub-id-type="doi">10.1089/omi.2011.0118</pub-id><pub-id pub-id-type="pmid">22455463</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC41">
      <mixed-citation publication-type="journal"><string-name><surname>Zappia</surname><given-names>L</given-names></string-name>, <string-name><surname>Phipson</surname><given-names>B</given-names></string-name>, <string-name><surname>Oshlack</surname><given-names>A</given-names></string-name>. <year>2017</year>. <article-title>Splatter: simulation of single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><volume>18</volume>: <fpage>174</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-017-1305-0</pub-id><pub-id pub-id-type="pmid">28899397</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC42">
      <mixed-citation publication-type="journal"><string-name><surname>Zhang</surname><given-names>L</given-names></string-name>, <string-name><surname>Nie</surname><given-names>Q</given-names></string-name>. <year>2021</year>. <article-title>scMC learns biological variation through the alignment of multiple single-cell genomics datasets</article-title>. <source>Genome Biol</source><volume>22</volume>: <fpage>10</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-020-02238-2</pub-id><pub-id pub-id-type="pmid">33397454</pub-id></mixed-citation>
    </ref>
    <ref id="GR277522ZHOC43">
      <mixed-citation publication-type="journal"><string-name><surname>Zhou</surname><given-names>Y</given-names></string-name>, <string-name><surname>Fu</surname><given-names>B</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>X</given-names></string-name>, <string-name><surname>Wang</surname><given-names>D</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>C</given-names></string-name>, <string-name><surname>Qi</surname><given-names>Y</given-names></string-name>, <string-name><surname>Sun</surname><given-names>R</given-names></string-name>, <string-name><surname>Tian</surname><given-names>Z</given-names></string-name>, <string-name><surname>Xu</surname><given-names>X</given-names></string-name>, <string-name><surname>Wei</surname><given-names>H</given-names></string-name>. <year>2020</year>. <article-title>Pathogenic T-cells and inflammatory monocytes incite inflammatory storms in severe COVID-19 patients</article-title>. <source>Natl Sci Rev</source><volume>7</volume>: <fpage>998</fpage>–<lpage>1002</lpage>. <pub-id pub-id-type="doi">10.1093/nsr/nwaa041</pub-id><pub-id pub-id-type="pmid">34676125</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
