<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8598444</article-id>
    <article-id pub-id-type="pmid">34358288</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btab569</article-id>
    <article-id pub-id-type="publisher-id">btab569</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Assessing heterogeneity in spatial data using the HTA index with applications to spatial transcriptomics and imaging</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-3315-1748</contrib-id>
        <name>
          <surname>Levy-Jurgenson</surname>
          <given-names>Alona</given-names>
        </name>
        <aff><institution>Department of Computer Science, Technion – Israel Institute of Technology</institution>, Haifa 32000, <country country="IL">Israel</country></aff>
        <xref rid="btab569-cor1" ref-type="corresp"/>
        <!--levyalona@gmail.com-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tekpli</surname>
          <given-names>Xavier</given-names>
        </name>
        <aff><institution>Department of Medical Genetics, Institute of Clinical Medicine, University of Oslo and Oslo University Hospital</institution>, Oslo, <country country="NO">Norway</country></aff>
        <aff><institution>Department of Cancer Genetics, Institute for Cancer Research, Oslo University Hospital</institution>, Oslo 0310, <country country="NO">Norway</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Yakhini</surname>
          <given-names>Zohar</given-names>
        </name>
        <aff><institution>Department of Computer Science, Technion – Israel Institute of Technology</institution>, Haifa 32000, <country country="IL">Israel</country></aff>
        <aff><institution>Arazi School of Computer Science, Interdisciplinary Center</institution>, Herzliya 4610101, <country country="IL">Israel</country></aff>
        <xref rid="btab569-cor1" ref-type="corresp"/>
        <!--zohar.yakhini@gmail.com-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Vitek</surname>
          <given-names>Olga</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btab569-cor1">To whom correspondence should be addressed. <email>levyalona@gmail.com</email> or <email>zohar.yakhini@gmail.com</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>11</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2021-08-06">
      <day>06</day>
      <month>8</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>06</day>
      <month>8</month>
      <year>2021</year>
    </pub-date>
    <volume>37</volume>
    <issue>21</issue>
    <fpage>3796</fpage>
    <lpage>3804</lpage>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>1</month>
        <year>2021</year>
      </date>
      <date date-type="rev-recd">
        <day>27</day>
        <month>6</month>
        <year>2021</year>
      </date>
      <date date-type="editorial-decision">
        <day>16</day>
        <month>7</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>8</month>
        <year>2021</year>
      </date>
      <date date-type="corrected-typeset">
        <day>21</day>
        <month>8</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btab569.pdf"/>
    <related-article related-article-type="companion" ext-link-type="doi" id="RA1" xlink:href="10.1093/bioinformatics/btab692"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Tumour heterogeneity is being increasingly recognized as an important characteristic of cancer and as a determinant of prognosis and treatment outcome. Emerging spatial transcriptomics data hold the potential to further our understanding of tumour heterogeneity and its implications. However, existing statistical tools are not sufficiently powerful to capture heterogeneity in the complex setting of spatial molecular biology.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We provide a statistical solution, the HeTerogeneity Average index (HTA), specifically designed to handle the multivariate nature of spatial transcriptomics. We prove that HTA has an approximately normal distribution, therefore lending itself to efficient statistical assessment and inference. We first demonstrate that HTA accurately reflects the level of heterogeneity in simulated data. We then use HTA to analyze heterogeneity in two cancer spatial transcriptomics datasets: spatial RNA sequencing by 10x Genomics and spatial transcriptomics inferred from H&amp;E. Finally, we demonstrate that HTA also applies to 3D spatial data using brain MRI. In spatial RNA sequencing, we use a known combination of molecular traits to assert that HTA aligns with the expected outcome for this combination. We also show that HTA captures immune-cell infiltration at multiple resolutions. In digital pathology, we show how HTA can be used in survival analysis and demonstrate that high levels of heterogeneity may be linked to poor survival. In brain MRI, we show that HTA differentiates between normal ageing, Alzheimer’s disease and two tumours. HTA also extends beyond molecular biology and medical imaging, and can be applied to many domains, including GIS.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Python package and source code are available at: <ext-link xlink:href="https://github.com/alonalj/hta" ext-link-type="uri">https://github.com/alonalj/hta</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Union’s Horizon 2020 Research and Innovation Programme</institution>
          </institution-wrap>
        </funding-source>
        <award-id>847912</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>This study provides a novel solution for characterizing and statistically assessing spatial heterogeneity. Recently, there has been growing evidence that phenotypical and clonal heterogeneity may play a crucial role in tumour biology and in affecting cancer progression and treatment outcome (<xref rid="btab569-B1" ref-type="bibr">AbdulJabbar <italic toggle="yes">et al</italic>., 2020</xref>; <xref rid="btab569-B12" ref-type="bibr">Ma <italic toggle="yes">et al</italic>., 2020</xref>). Cancer cells differ in molecular characteristics such as mutations, gene expression and copy number aberrations. These differences, which define the concept of clonality in tumours, are a potentially detrimental hallmark of cancer. In particular, tumour sub-populations may possess a unique combination of molecular traits that enables them to evade treatment (<xref rid="btab569-B4" ref-type="bibr">Dobson <italic toggle="yes">et al</italic>., 2020</xref>). The heterogeneous environment arising from such sub-populations has been mainly investigated through bulk measurements. However, bulk measurements lack the spatial dimension, which may harbour potentially critical information. For example, the evolutionary dynamics of cancer may result in tumour subclones residing in distinct microhabitats that support the development of therapy-resistant populations (<xref rid="btab569-B6" ref-type="bibr">Gillies <italic toggle="yes">et al</italic>., 2012</xref>). In glioblastoma, differences in copy number alterations and somatic mutations were observed when assessing different tumour microenvironments: EGFR-amplified cancer cells were mainly found in poorly vascularized regions, whereas PDGFRA-amplified cancer cells were observed in close proximity to endothelial cells (<xref rid="btab569-B11" ref-type="bibr">Little <italic toggle="yes">et al</italic>., 2012</xref>). The spatial distribution of immune-cells among tumour cells has a long-standing role in diagnosis (<xref rid="btab569-B8" ref-type="bibr">Hendry <italic toggle="yes">et al</italic>., 2017</xref>), and was proven useful in predicting prognosis and treatment response in multiple cancer types and molecular settings (<xref rid="btab569-B15" ref-type="bibr">Nearchou <italic toggle="yes">et al</italic>., 2020</xref>; <xref rid="btab569-B24" ref-type="bibr">Zheng <italic toggle="yes">et al</italic>., 2020</xref>). Recent advances in spatial transcriptomics, including technology developed for direct measurement [e.g. Visium spatial RNA-sequencing (RNA-seq) by 10x Genomics)], as well as approaches for inferring such information from digital pathology images (<xref rid="btab569-B3" ref-type="bibr">Coudray <italic toggle="yes">et al</italic>., 2018</xref>; <xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>., 2020</xref>), have accentuated the interest in analyzing molecular heterogeneity from a spatial perspective (<xref rid="btab569-B5" ref-type="bibr">Ev Andersson <italic toggle="yes">et al</italic>., 2020</xref>; <xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>., 2020</xref>; <xref rid="btab569-B14" ref-type="bibr">Masuda <italic toggle="yes">et al</italic>., 2019</xref>), with some studies already indicating its potential clinical utility (<xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>., 2020</xref>; <xref rid="btab569-B14" ref-type="bibr">Masuda <italic toggle="yes">et al</italic>., 2019</xref>).</p>
    <p>To support such analyses, we have developed a statistical tool that measures the level of spatial heterogeneity—the HeTerogeneity Average index (HTA). We demonstrate its use using synthetic data, two spatial transcriptomics datasets and four brain MRI scans. We also demonstrate its applicability to other domains.</p>
    <p>Several methods have been recently adopted from other fields, mainly ecology, to assist in the quantitative analysis of the spatial heterogeneity of molecular measurements (<xref rid="btab569-B23" ref-type="bibr">Yuan, 2016</xref>). However, such methods, originating from other fields, do not easily extend to complex biological environments. First, they were mostly designed for univariate and bivariate analyses. For example, Morisita-Horn (<xref rid="btab569-B17" ref-type="bibr">Rempala and Seweryn, 2013</xref>) is a measure of overlap between two types of elements, such as two species. It has been used in <xref rid="btab569-B13" ref-type="bibr">Maley <italic toggle="yes">et al</italic>. (2015)</xref> to measure the colocalisation of immune and cancer cells in breast cancer; Moran’s I, and the more recent <italic toggle="yes">q</italic>-statistic (<xref rid="btab569-B20" ref-type="bibr">Wang <italic toggle="yes">et al</italic>., 2016</xref>), both originating in ecology, measure the spatial auto-correlation and spatial stratified heterogeneity (respectively) of a single attribute with respect to neighbouring locations in space. Another method, Ripley’s K (<xref rid="btab569-B18" ref-type="bibr">Ripley, 1976</xref>), determines whether a single attribute is dispersed, clustered or randomly distributed in the target spatial environment. Since we are interested in analyzing complex biological environments, with many molecular traits, univariate and bivariate methods fall short of providing an adequate solution (as demonstrated in Section 4). Moreover, these methods may also be difficult to interpret or complex to use (e.g. including edge-correction and radius parameters as in Ripley’s K). Importantly, little is known about the distribution of the null hypothesis for the vast majority of these methods. For Morisita-Horn and Ripley’s K, for example, <italic toggle="yes">P</italic>-values are empirically estimated using Monte-Carlo simulations, which are computationally expensive and less accurate compared to methods based on a known null distribution.</p>
    <p>The method we propose in this article, HTA, which is based on Shannon’s entropy, addresses these shortcomings. First, HTA is multivariate, allowing it to capture a richer representation of heterogeneity, even in the bivariate case (see Section 4, <xref rid="btab569-F10" ref-type="fig">Fig. 10</xref>); second, it lends itself to easier interpretation since it is based on the notion of entropy; and third, for a fixed set of traits, it requires only a single input parameter. Importantly, the HTA distribution, under a null model, can be well characterized and it thus facilitates efficient statistical assessment and inference.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>In this section, we introduce HTA—the HeTerogeneity Average Index. We first (Section 2.1) define an index called HTI (HeTerogeneity Index—a variation of Shannon’s entropy) which we will use to measure heterogeneity at a local level. The HTA index (Section 2.2), representing heterogeneity at the whole sample level, will be based on averaging local HTIs. Finally (Section 2.3), we prove that HTA has an approximately normal distribution.</p>
    <sec>
      <title>2.1 HTI</title>
      <p>We first define a heterogeneity index, HTI (<xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>., 2020</xref>), on which HTA is based. HTI is a variation of Shannon’s entropy. Formally:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mtext>HTI</mml:mtext><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>C</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mrow><mml:mi>C</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">C</italic> is the number of non-empty trait combinations that may be observed in the analyzed sample, which typically equals <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mtext>traits</mml:mtext><mml:mo>|</mml:mo></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (the number of subsets excluding the empty set); and <italic toggle="yes">p<sub>c</sub></italic> is the proportion of spatial positions for which exactly all traits in combination <italic toggle="yes">c</italic> manifest. A spatial position, for instance, could be a barcoded spot in spatial transcriptomics data or a tile derived from a pathology whole-slide image as in <xref rid="btab569-B3" ref-type="bibr">Coudray <italic toggle="yes">et al</italic>. (2018)</xref> and <xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>. (2020)</xref>.</p>
      <p>For example, for two traits, e.g. FOXA1 and MKI67, whose gene expression levels were spatially resolved to a whole slide image from a breast cancer sample, we have <italic toggle="yes">C </italic>=<italic toggle="yes"> </italic>3 for 3 possible non-empty trait combinations: FOXA1 (only), MKI67 (only) and Both. If the tissue is homogeneous with nearly all of its sections falling into one of these three options (say Both), then <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Both</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>≅</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">FOXA</mml:mi><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>≅</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">MKI</mml:mi><mml:mn>67</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>≅</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and HTI is 0. If, however the tissue is heterogeneous with 1/3 of the tiles falling into each option then: <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">Both</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">FOXA</mml:mi><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">MKI</mml:mi><mml:mn>67</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> and HTI is 1. The logarithm base <italic toggle="yes">C</italic> guarantees that HTI falls within <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. In this case, a high HTI indicates there may be two or more phenotypically different cell types, whereas a low HTI would reflect single phenotypical dominance.</p>
      <p>While HTI was shown to capture heterogeneity at a global level (<xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>., 2020</xref>), it is agnostic to the within-tissue distribution of the trait combinations. For example, the sample in <xref rid="btab569-F2" ref-type="fig">Figure 2</xref> (left), and the sample in <xref rid="btab569-F2" ref-type="fig">Figure 2</xref> (right) have different spatial distributions of the same elements, but HTI is 1 in both cases. This is expected since HTI is a global measure of heterogeneity. However, there is clearly a difference in heterogeneity at the local level, which may have important clinical implications. Our HTA index, described below, which uses HTI at the local level, is designed to capture this difference. Indeed, as noted in <xref rid="btab569-F2" ref-type="fig">Figure 2</xref>, the corresponding HTA scores are 0 (homogeneous) on the left and 1 (heterogeneous) on the right.</p>
    </sec>
    <sec>
      <title>2.2 HTA</title>
      <sec>
        <title>2.2.1 HTA definition</title>
        <p>HTA is essentially a weighted average of HTIs across a defined set of spatial regions of a sample (<xref rid="btab569-F1" ref-type="fig">Fig. 1</xref> depicts such regions). To formally describe HTA, we first define what regions of a matrix are, and then use these to define HTA.</p>
        <fig position="float" id="btab569-F1">
          <label>Fig. 1.</label>
          <caption>
            <p>HTA applied to synthetic random data of shape (32, 32) across three different region sizes (2, 8, 16 left-to-right). The data (dot location and color) is held constant across all three. <italic toggle="yes">P</italic>-values demonstrate heterogeneity since <italic toggle="yes">H</italic><sub>0</sub> is not rejected (HTA <italic toggle="yes">P</italic>-value &gt; 0.3) for all region sizes</p>
          </caption>
          <graphic xlink:href="btab569f1" position="float"/>
        </fig>
        <fig position="float" id="btab569-F2">
          <label>Fig. 2.</label>
          <caption>
            <p>HTA applied to synthetic data across three different distributions (homogeneous, random heterogeneous, deterministic heterogeneous from left-to-right). Region size and trait proportions are held constant (8 and 0.5 resp.). HTA <italic toggle="yes">P</italic>-values: (left) significant homogeneity (<inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>≅</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>); (middle) not significant (<italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.23); (right) significant heterogeneity (<inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>p</mml:mi><mml:mo>≅</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula>)</p>
          </caption>
          <graphic xlink:href="btab569f2" position="float"/>
        </fig>
        <p>Consider a matrix <italic toggle="yes">M</italic>, where each entry corresponds to a spatial location in the sample [e.g. a barcoded spot from spatial RNA-seq data or a single tile from a pathology image (<xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>., 2020</xref>)] and indicates which of the <italic toggle="yes">C</italic> trait combinations is present therein (or ‘None’ otherwise). Then we consider <italic toggle="yes">M</italic> to be a trait-combination matrix.</p>
      </sec>
      <sec>
        <title>HTA</title>
        <p>Let <inline-formula id="IE7"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mi>M</mml:mi><mml:msub><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mi>G</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> be the set of regions obtained by applying grid <italic toggle="yes">G</italic> to a trait-combination matrix <italic toggle="yes">M</italic>. Let <inline-formula id="IE8"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> be the corresponding number of entries in each region that are not ‘None’. Then we define:
<disp-formula id="E2"><label>(1)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">HTA</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:msub><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mi>G</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mi>n</mml:mi></mml:mfrac></mml:mrow><mml:mi>H</mml:mi><mml:mi>T</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mi>n</mml:mi></mml:mfrac></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>C</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">n<sub>rc</sub></italic> is the number of entries in region <italic toggle="yes">r</italic> that manifest trait combination <inline-formula id="IE9"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, and <italic toggle="yes">n</italic> is the total number of entries, in the entire matrix, that manifest at least one trait.</p>
        <p>Note that since <italic toggle="yes">n<sub>r</sub></italic> is the number of entries in region <italic toggle="yes">r</italic> that are not ‘None’, this means that <inline-formula id="IE10"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>C</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, for all <italic toggle="yes">r</italic>. Empty regions (where all elements in the region are ‘None’) are discarded.</p>
        <p>For example, in spatial RNA-seq, each entry in <italic toggle="yes">M</italic> that is included in <italic toggle="yes">n</italic> represents a barcoded spot that manifests at least one trait (e.g. the coloured dots in <xref rid="btab569-F3" ref-type="fig">Fig. 3D</xref>), and each included region of <italic toggle="yes">M</italic> contains several such barcoded spots (e.g. the non-empty regions bordered by the grid lines in the same figure). In digital pathology, where each whole-slide image is divided into thousands of smaller images (tiles), each entry represents a single tile in which at least one trait is present and each region of <italic toggle="yes">M</italic> contains several such tiles.</p>
        <fig position="float" id="btab569-F3">
          <label>Fig. 3.</label>
          <caption>
            <p>Heterogeneity maps and corresponding HTAs for: (<bold>B–D</bold>) two traits: ESR1 and GATA3; (<bold>F–H</bold>) three traits: ESR1, GATA3 and FOXA1. Each color represents the manifestation of a different trait combination. In B–D, red means that ESR1 and GATA3 are highly expressed (above their respective medians), green—only GATA3 is highly expressed and orange—only ESR1 is highly expressed. In F–H, due to the large number of trait-combinations, we note here the most common trait combinations and provide the full legend in <xref rid="sup1" ref-type="supplementary-material">Supplementary Material S4</xref>: grey—all three traits are highly expressed, pink—GATA3 and FOXA1 are highly expressed, red—ESR1 and GATA3 are highly expressed. HTA is significantly homogeneous at all region sizes (5, 15 and 30) in both settings (HTA <italic toggle="yes">P</italic>-values <inline-formula id="IE11"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mo>&lt;</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>). This aligns with the expected outcome for this cancer type (Luminal B breast cancer, for which the cancer cells highly express these three transcription factors); (<bold>A</bold>) and (<bold>E</bold>): the resulting heterogeneity maps if the respective trait-combinations were randomly distributed (<italic toggle="yes">H</italic><sub>0</sub>). HTA <italic toggle="yes">P</italic>-values are 0.26 and 0.56 (A, E respectively) at region size 5, as expected under <italic toggle="yes">H</italic>0</p>
          </caption>
          <graphic xlink:href="btab569f3" position="float"/>
        </fig>
        <p>We note that HTA monotonically decreases with grid refinement. This is similar to the fact that:
<disp-formula id="E3"><label>(2)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>≤</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>for any random variables <italic toggle="yes">X</italic> and <italic toggle="yes">Y</italic> (for a proof see <xref rid="sup1" ref-type="supplementary-material">Supplementary Material S1</xref>). Indeed, we observe this in <xref rid="btab569-F1" ref-type="fig">Figure 1</xref>, where HTA decreases from right-to-left. We note that since region-based methods are inherently sensitive to region size, HTA’s monotonicity provides an added advantage since it guarantees an ordering one can expect to observe when moving between region sizes. In <xref rid="btab569-F4" ref-type="fig">Figure 4</xref>, for example, we can see that for the largest region size (D), the null hypothesis of heterogeneity is not rejected (HTA <italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.1), whereas at the smaller region sizes (B–C) it is. Knowing that HTA monotonically decreases with grid refinement, a user may be inclined to test finer grids before concluding that the sample is heterogeneous with respect to the mutual spatial distribution of T-cells among HER2 cells.</p>
        <fig position="float" id="btab569-F4">
          <label>Fig. 4.</label>
          <caption>
            <p>(<bold>B–D</bold>) Heterogeneity maps and HTA depicting the mutual distribution of ERBB2 (HER2) and CD8A (T-cells) for the bottom half of <xref rid="btab569-F3" ref-type="fig">Figure 3</xref>, chosen due to indications of high tumour content in that portion (see Section 3.2). (<bold>A</bold>) The resulting heterogeneity map if ERBB2 and CD8A were randomly distributed (<italic toggle="yes">H</italic><sub>0</sub>). HTA is: (B–C) significantly homogeneous <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>&lt;</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>; (D) heterogeneous <italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.1 (<italic toggle="yes">H</italic><sub>0</sub> not rejected); (A) heterogeneous <italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.47</p>
          </caption>
          <graphic xlink:href="btab569f4" position="float"/>
        </fig>
      </sec>
    </sec>
    <sec>
      <title>2.3 HTA <italic toggle="yes">P</italic>-value</title>
      <p>We compute the HTA <italic toggle="yes">P</italic>-value under the null model in which all trait combinations are uniformly distributed across the tissue sample, as in <xref rid="btab569-F3" ref-type="fig">Figures 3A</xref>, <xref rid="btab569-F3" ref-type="fig">E</xref> and <xref rid="btab569-F4" ref-type="fig">4A</xref> (i.e. a random permutation of the exact trait combinations present within the tissue sample, naturally preserving the observed frequencies).</p>
      <p>We use a permutation over trait-combinations, rather than a permutation over individual traits, since only the former preserves the natural trait-combinations present within the sample. To illustrate the difference, consider a sample that exhibits only one type of cell, say one that over-expresses all of: KRAS, BRAF, EGFR and TP53. Under a trait-based permutation, this single trait-combination could turn into <inline-formula id="IE13"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> trait-combinations (all non-empty subsets), changing the true underlying molecular composition. Conversely, under a permutation over trait-combinations, only the original trait-combination would be present, alleviating this problem.</p>
      <p>Note that since the null model depends on the original trait-combination composition, lower HTA values do not necessarily correspond to lower HTA <italic toggle="yes">P</italic>-values (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Material S7</xref>). As such, the interpretation of results should rely on the <italic toggle="yes">P</italic>-value rather than on the statistic, as in many standard statistical tests.</p>
      <sec>
        <title>2.3.1 Equal-weight regions</title>
        <p>If we assume that all regions contain the same number of entries, we obtain that HTA is normally distributed, by the classical central-limit theorem (Lindeberg–Lévy CLT). Formally, we denote <italic toggle="yes">X<sub>r</sub></italic>, <inline-formula id="IE14"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula> to be <inline-formula id="IE15"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">HTI</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Then, under the null hypothesis, the random variables <italic toggle="yes">X<sub>r</sub></italic> are iid. Therefore, by the CLT, their mean (HTA) is normally distributed:
<disp-formula id="E4"><label>(3)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo>σ</mml:mo><mml:mo>/</mml:mo><mml:msqrt><mml:mi>R</mml:mi></mml:msqrt></mml:mrow></mml:mfrac><mml:mfenced><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>r</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mo>μ</mml:mo></mml:mrow></mml:mfenced><mml:munderover><mml:mo>→</mml:mo><mml:mrow/><mml:mi>d</mml:mi></mml:munderover><mml:mi mathvariant="script">N</mml:mi><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:math></disp-formula>where <italic toggle="yes">μ</italic> and <italic toggle="yes">σ</italic> are the mean and standard-deviation of <italic toggle="yes">X<sub>r</sub></italic>, under the null model.</p>
        <p>In our case this means:
<disp-formula id="E5"><label>(4)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo>σ</mml:mo><mml:mo>/</mml:mo><mml:msqrt><mml:mi>R</mml:mi></mml:msqrt></mml:mrow></mml:mfrac><mml:mfenced><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>R</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:msub><mml:mi>X</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mo>μ</mml:mo></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo>σ</mml:mo><mml:mo>/</mml:mo><mml:msqrt><mml:mi>R</mml:mi></mml:msqrt></mml:mrow></mml:mfrac><mml:mfenced><mml:mrow><mml:mi>H</mml:mi><mml:mi>T</mml:mi><mml:mi>A</mml:mi><mml:mo>−</mml:mo><mml:mo>μ</mml:mo></mml:mrow></mml:mfenced><mml:munderover><mml:mo>→</mml:mo><mml:mrow/><mml:mi>d</mml:mi></mml:munderover><mml:mi mathvariant="script">N</mml:mi><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:math></disp-formula></p>
        <p><italic toggle="yes">μ</italic> and <italic toggle="yes">σ</italic> depend on both the region size and the distribution of trait combinations in the matrix <italic toggle="yes">M</italic>. We can estimate these quantities from simulations of <italic toggle="yes">M</italic> under the null model. For a limited region size, we can also compute these quantities precisely by running an exhaustive search across the permutations of trait combinations in a single region to obtain all possible values for <italic toggle="yes">X<sub>r</sub></italic> and its resulting distribution.</p>
        <p>Using this approach for two traits (3 non-empty trait combinations, <italic toggle="yes">C </italic>=<italic toggle="yes"> </italic>3) and region sizes 2 and 3 (yielding square regions with <inline-formula id="IE16"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE17"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>3</mml:mn></mml:mrow><mml:mn>3</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mn>9</mml:mn></mml:mrow></mml:math></inline-formula> elements, respectively) we obtain, for example, that for sufficiently large values of <italic toggle="yes">R</italic> the following holds (respectively):
<disp-formula id="E6"><mml:math id="M6" display="block" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:mi>H</mml:mi><mml:mi>T</mml:mi><mml:mi>A</mml:mi><mml:mo>∼</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0.57</mml:mn><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>0.31</mml:mn></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mi>R</mml:mi></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">region</mml:mi><mml:mo> </mml:mo><mml:mi mathvariant="italic">size</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>H</mml:mi><mml:mi>T</mml:mi><mml:mi>A</mml:mi><mml:mo>∼</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0.83</mml:mn><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>0.17</mml:mn></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mi>R</mml:mi></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="italic">region</mml:mi><mml:mo> </mml:mo><mml:mi mathvariant="italic">size</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p>
      </sec>
      <sec>
        <title>2.3.2 Weighted regions</title>
        <p>For actual data, the number of entries in each region may vary as a function of the positions in which entries of <italic toggle="yes">M</italic> are empty. Their corresponding HTIs are therefore no longer identically distributed under the null hypothesis. Specifically, we have different means and stds for the HTI of each of the regions, indexed by <italic toggle="yes">r</italic>, which we denote by <italic toggle="yes">μ<sub>r</sub></italic> and <italic toggle="yes">σ<sub>r</sub></italic>, respectively. For example, a region with only one entry will always exhibit a single trait combination, leading to HTI <inline-formula id="IE18"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and therefore <inline-formula id="IE19"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, whereas a region with more entries has a positive probability of obtaining a non-zero HTI and therefore <inline-formula id="IE20"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. Since the classical CLT (Lindeberg–Lévy CLT) assumes that the random variables are iid, we turn to a different version of CLT that applies to independent, but not identically distributed, random variables—the Lyapunov CLT:</p>
      </sec>
      <sec>
        <title>Lyapunov CLT</title>
        <p>Let <inline-formula id="IE21"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> be independent random variables with <inline-formula id="IE22"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE23"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Var</mml:mtext><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&lt;</mml:mo><mml:mo>∞</mml:mo></mml:mrow></mml:math></inline-formula>. Denote <inline-formula id="IE24"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
        <p>(Lyapunov Condition) If there exists <inline-formula id="IE25"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mo>δ</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> such that:
<disp-formula id="E7"><label>(5)</label><mml:math id="M7" display="block" overflow="scroll"><mml:mrow><mml:munder><mml:mrow><mml:mi>lim</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>→</mml:mo><mml:mo>∞</mml:mo></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mo>δ</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mo>δ</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></disp-formula>where
<disp-formula id="E8"><label>(6)</label><mml:math id="M8" display="block" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mtext>Var</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mrow></mml:math></disp-formula>then
<disp-formula id="E9"><label>(7)</label><mml:math id="M9" display="block" overflow="scroll"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>m</mml:mi></mml:munderover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:munderover><mml:mo>→</mml:mo><mml:mrow/><mml:mi>d</mml:mi></mml:munderover><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>In our case, we want to use this theorem with <inline-formula id="IE26"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mi>n</mml:mi></mml:mfrac><mml:mi>H</mml:mi><mml:mi>T</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <italic toggle="yes">m </italic>=<italic toggle="yes"> R</italic> and obtain:
<disp-formula id="E10"><label>(8)</label><mml:math id="M10" display="block" overflow="scroll"><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>s</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mfrac><mml:mfenced><mml:mrow><mml:mi>H</mml:mi><mml:mi>T</mml:mi><mml:mi>A</mml:mi><mml:mo>−</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:msub><mml:mo>μ</mml:mo><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:munderover><mml:mo>→</mml:mo><mml:mrow/><mml:mi>d</mml:mi></mml:munderover><mml:mi mathvariant="script">N</mml:mi><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:math></disp-formula></p>
        <p>We observe that the Lyapunov condition is satisfied in our case. For any <inline-formula id="IE27"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mo>δ</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>,
<disp-formula id="E11"><label>(9)</label><mml:math id="M11" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mo>δ</mml:mo></mml:mrow></mml:msup><mml:mo>≤</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:msubsup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>r</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></disp-formula>because <inline-formula id="IE28"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> (since HTI <inline-formula id="IE29"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>).</p>
        <p>Therefore
<disp-formula id="E12"><label>(10)</label><mml:math id="M12" display="block" overflow="scroll"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>R</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mo>δ</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mo>δ</mml:mo></mml:mrow></mml:msup><mml:mo>≤</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>R</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mo>δ</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:mrow><mml:mtext>Var</mml:mtext></mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>R</mml:mi><mml:mo>δ</mml:mo></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where the first inequality follows from <xref rid="E11" ref-type="disp-formula">Equation 9</xref> combined with the fact that <inline-formula id="IE30"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Var</mml:mtext><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:msubsup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mi>r</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and the equality follows immediately from the definition of <inline-formula id="IE31"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> (<xref rid="E8" ref-type="disp-formula">Equation 6</xref>).</p>
        <p>It remains to show that <inline-formula id="IE32"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub><mml:mo>→</mml:mo><mml:mo>∞</mml:mo></mml:mrow></mml:math></inline-formula> as <inline-formula id="IE33"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:mi>R</mml:mi><mml:mo>→</mml:mo><mml:mo>∞</mml:mo></mml:mrow></mml:math></inline-formula>. Indeed, under the null hypothesis, the set of variances <inline-formula id="IE34"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>r</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> is bounded away from zero if we assume that there are no single-sample regions (otherwise we may increase the region size), or that there is a constant number of such regions.</p>
        <p>Given a specific dataset, in order to use Lyapunov CLT, we must estimate <italic toggle="yes">μ<sub>r</sub></italic> and <italic toggle="yes">σ<sub>r</sub></italic> for all relevant (non-empty) regions, <inline-formula id="IE35"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula>. We do so by simulating 1000 random-uniform permutations of the trait combination matrix (while holding constant the original positions of non-empty elements) and for each permutation we compute HTIs for all relevant regions. Then, for each region <inline-formula id="IE36"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:mi>r</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>R</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, we use its 1000 HTIs to estimate <italic toggle="yes">μ<sub>r</sub></italic> and <italic toggle="yes">σ<sub>r</sub></italic>.</p>
        <p>We emphasize that the normal approximation holds only for sufficiently large values of <italic toggle="yes">R</italic>. We also note that for adequate interpretation of the HTA results, one should consider two one-sided <italic toggle="yes">P</italic>-values. Namely <italic toggle="yes">P</italic> and <inline-formula id="IE37"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi></mml:mrow></mml:math></inline-formula>, which represent the alternative hypotheses of homogeneity and heterogeneity, respectively. To determine the overall significance, the smaller <italic toggle="yes">P</italic>-value should be doubled.</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>In this section, we demonstrate the use of HTA in several domains. We begin with synthetic data for both 2-dimensional and 3-dimensional spatial data (Section 3.1). We then apply HTA to two 2-dimensional spatial transcriptomics datasets: Visium spatial RNA-seq by 10x Genomics (Section 3.2) and spatial transcriptomics inferred from pathology whole-slide images (Section 3.3). We also demonstrate a 3-dimensional use case using MRI images (Section 3.4). Finally, we demonstrate that HTA extends to other domains by analyzing US census data (Section 3.5).</p>
    <sec>
      <title>3.1 Synthetic data</title>
      <p>In <xref rid="btab569-F1" ref-type="fig">Figures 1</xref> and <xref rid="btab569-F2" ref-type="fig">2</xref>, we depict results from applying HTA to 2-dimensional heterogeneity maps of shape (32, 32), each of which represents a trait-combination matrix. Regions are the visible square areas that fall between the grid lines. In <xref rid="btab569-F1" ref-type="fig">Figure 1</xref>, we see heterogeneity maps for two traits, each of which has a random uniform distribution with probability 0.5 of occurrence in each position. As one would expect, the null hypothesis that the trait-combinations are randomly distributed is not rejected in all three region sizes (2, 8 and 16) since HTA <italic toggle="yes">P</italic>-values are &gt;0.3.</p>
      <p><xref rid="btab569-F2" ref-type="fig">Figure 2</xref> demonstrates that HTA discerns between homogeneous and heterogeneous distributions. Holding the region size constant, we observe that a perfectly homogeneous distribution within each region (left) is significantly homogeneous (HTA <italic toggle="yes">P</italic>-value <inline-formula id="IE38"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:mo>≅</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), while a perfect heterogeneous distribution (right) is significantly heterogeneous (HTA 1-<italic toggle="yes">P</italic>-value <inline-formula id="IE39"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:mo>≅</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). In comparison, a random heterogeneous distribution from <italic toggle="yes">H</italic><sub>0</sub> (middle) is neither (HTA <italic toggle="yes">P</italic>-value 0.5). This means that both significant homogeneity and significant heterogeneity are identified using HTA.</p>
      <p>In <xref rid="btab569-F5" ref-type="fig">Figure 5</xref> we applied HTA to a 3-dimensional heterogeneity map of shape (32, 32, 3) (for the <italic toggle="yes">x</italic>, <italic toggle="yes">y</italic>, <italic toggle="yes">z</italic> axes, respectively). Since the region size can now also vary across the <italic toggle="yes">z</italic>-axis, we use two region sizes that differ only along this axis: (8, 8, 1) and (8, 8, 3) as illustrated at the bottom of <xref rid="btab569-F5" ref-type="fig">Figure 5</xref>. Using a region size of (8, 8, 1), as in <xref rid="btab569-F5" ref-type="fig">Figure 5</xref> (left), where each region manifests exactly one of the trait combinations, we obtain significant homogeneity (HTA <italic toggle="yes">P</italic>-value <inline-formula id="IE40"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:mo>≅</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>). Conversely, using a region size of (8, 8, 3), illustrated in <xref rid="btab569-F5" ref-type="fig">Figure 5</xref> (right), where each region contains an equal amount of each of the three trait combinations, we obtain significant heterogeneity (HTA <italic toggle="yes">P</italic>-value of <inline-formula id="IE41"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mrow><mml:mo>≅</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>).</p>
      <fig position="float" id="btab569-F5">
        <label>Fig. 5.</label>
        <caption>
          <p>A 3D heterogeneity map and HTA for two region sizes that differ along the <italic toggle="yes">z</italic>-axis. The two illustrations at the bottom illustrate the resulting regions along with the corresponding HTA results: (left) region size (8, 8, 1) each region is perfectly homogeneous, yielding HTA 0 and HTA <italic toggle="yes">P</italic>-value <inline-formula id="IE42"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mo>≅</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>; (right) region size (8, 8, 3)—each region is perfectly heterogeneous, yielding HTA 1 and HTA <italic toggle="yes">P</italic>-value <inline-formula id="IE43"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mo>≅</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. Note that the 3D grid visible at the top does not describe the regions</p>
        </caption>
        <graphic xlink:href="btab569f5" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 Spatial RNA sequencing</title>
      <p>We use 10x Genomics’ Visium breast cancer spatial gene-expression data (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Material S2</xref> for details). The sample is a Stage Group IIA breast cancer of type Luminal B (ER positive, PR negative and HER2 positive). To determine <italic toggle="yes">n<sub>rc</sub></italic>, the number of entries in region <italic toggle="yes">r</italic> manifesting trait-combination <italic toggle="yes">c</italic>, we use the median threshold for each gene. An entry manifests combination <italic toggle="yes">c</italic> if all the genes in this combination are above their respective median expression level. Since this sample is Luminal B, it is expected that ESR1, FOXA1 and GATA3 would be spatially co-expressed (<xref rid="btab569-B9" ref-type="bibr">Jacquemier <italic toggle="yes">et al</italic>., 2009</xref>), leading to a significantly homogeneous HTA index. We tested both two and three traits. Indeed, in <xref rid="btab569-F3" ref-type="fig">Figure 3B</xref>–<xref rid="btab569-F3" ref-type="fig">D</xref>, we observe that the tissue sample is significantly spatially homogeneous at both a local and global resolution (smaller and larger region-sizes, respectively), obtaining HTA <italic toggle="yes">P</italic>-values of <inline-formula id="IE44"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:mo>&lt;</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. This is compared to a random permutation of the observed trait combinations under <italic toggle="yes">H</italic><sub>0</sub> (<xref rid="btab569-F3" ref-type="fig">Fig. 3A</xref>) which obtains an HTA <italic toggle="yes">P</italic>-value of 0.26 even at the smallest region size of 5. For the three traits: ESR1, GATA3 and FOXA1 (<xref rid="btab569-F3" ref-type="fig">Fig. 3F</xref>–<xref rid="btab569-F3" ref-type="fig">H</xref>) we observe similar results, with HTA <italic toggle="yes">P</italic>-value of <inline-formula id="IE45"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:mo>&lt;</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> at all three region sizes. This is in comparison to the random permutation of the observed trait combinations (<xref rid="btab569-F3" ref-type="fig">Fig. 3E</xref>) which obtains an HTA <italic toggle="yes">P</italic>-value of 0.56 at region size 5.</p>
      <p>Previous research has shown that T-cells remaining at the periphery of cancer cells, with low tumour infiltration, may be indicative of poor prognosis compared to tumours with high T-cell infiltration (<xref rid="btab569-B16" ref-type="bibr">Pruneri <italic toggle="yes">et al</italic>., 2018</xref>). HTA can help identify such cases. In <xref rid="btab569-F4" ref-type="fig">Figure 4B</xref>–<xref rid="btab569-F4" ref-type="fig">D</xref> we generated the heterogeneity map for ERBB2 (HER2) and CD8A (T-cells) using the same HER2 positive breast cancer sample. We focused on the area where ESR1 and GATA3 are relatively co-expressed (bottom half of the tissue in <xref rid="btab569-F3" ref-type="fig">Fig. 3</xref>) since, as explained above, these regions are likely to have high tumour content. Using HTA, we observe significant homogeneity in the two smaller region-sizes, 5 and 15, with HTA <italic toggle="yes">P</italic>-values <inline-formula id="IE46"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:mo>&lt;</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. Interestingly, at the larger region size of 30 we no longer observe significant homogeneity, with a <italic toggle="yes">P</italic>-value of 0.1. For context, a random dispersion of these T-cells (<xref rid="btab569-F4" ref-type="fig">Fig. 4A</xref>) is not significantly homogeneous, with an HTA <italic toggle="yes">P</italic>-value of 0.47. The significant homogeneity at the two smaller region sizes mean that the tumour cells are rarely, if at all, infiltrated by T-cells. However, the lack of significant homogeneity at the larger region size indicates that there is at least some infiltration of T-cells (otherwise we would observe significant homogeneity at this level too).</p>
      <p>Since HTA is designed to handle a large number of traits, it is capable of capturing certain characteristics of clonal composition. We demonstrate this using the same breast cancer sample and 7 breast cancer driver genes: MYC, ESR1, ERBB2, GATA3, FOXA1, TP53 and CDK4. In <xref rid="btab569-F6" ref-type="fig">Figure 6A</xref> we can see the resulting heterogeneity map. Using a region size of 15, we obtain a significantly homogeneous HTA (<italic toggle="yes">P</italic>-value: <inline-formula id="IE47"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>). In B we observe a random permutation of the observed trait combinations, which results in a non-significantly homogeneous HTA (<italic toggle="yes">P</italic>-value: 0.43). Since 7 traits give rise to <inline-formula id="IE48"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mn>7</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>=</mml:mo><mml:mn>127</mml:mn></mml:mrow></mml:math></inline-formula> non-empty combinations (provided that all are present), we do not attempt to display the legend. Instead, we produce a ‘region-report’ to identify the most frequent combinations in regions of interest. For example, in the bottom left corner, at <inline-formula id="IE49"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mn>0.5</mml:mn><mml:mo>,</mml:mo><mml:mn>59.5</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, the most frequent combination is all 7 driver genes, accounting for 73% of the elements in that region. The second most frequent combination is the 6 driver genes that remain after removing CDK4. While the region to its right has a similar composition, two regions to the right, at <inline-formula id="IE50"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>29.5</mml:mn><mml:mo>,</mml:mo><mml:mn>59.5</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, already exhibits a different, yet relatively homogeneous composition: the combination of all 7 account for 41% of the elements; a small number of different combinations of 6 of the driver genes account for 26% and; the vast majority of the remaining elements (accounting for 28%) are several combinations of 4 and 5 genes. These observations align with the significantly homogeneous HTA, and may indicate that the significant homogeneity may be due to the gradual formation of a dominant subclone that over-expresses all 7 genes.</p>
      <fig position="float" id="btab569-F6">
        <label>Fig. 6.</label>
        <caption>
          <p>Heterogeneity maps and HTA for seven breast cancer driver genes: MYC, ESR1, ERBB2, GATA3, FOXA1, TP53 and CDK4. (<bold>A</bold>) Actual heterogeneity map, with HTA <italic toggle="yes">P</italic>-value of <inline-formula id="IE51"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> at region size 15; (<bold>B</bold>) heterogeneity map under <italic toggle="yes">H</italic><sub>0</sub> (random permutation of the trait-combinations), with HTA <italic toggle="yes">P</italic>-value of 0.43</p>
        </caption>
        <graphic xlink:href="btab569f6" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.3 Spatial transcriptomics from pathology whole-slide images</title>
      <p>In this section, we use spatial transcriptomics inferred from breast cancer pathology whole-slide images obtained from <xref rid="btab569-B10" ref-type="bibr">Levy-Jurgenson <italic toggle="yes">et al</italic>. (2020)</xref>. This dataset contains 324 subjects for which: (i) MKI67 and miR-17 expression were spatially resolved to their respective pathology whole-slide images, yielding binary maps that indicate where each gene was detected as over-expressed; and (ii) survival data is available. Since not all slides, and therefore inferred maps, have the same size, we first resize them to (90, 90), chosen based on their median shape. To ensure that the maps remain binary, we use nearest neighbour interpolation during resizing. We apply HTA using the three region sizes: 15, 30 and 45. We then split the cohort into two equal sets based on their HTAs: &gt; median HTA and <inline-formula id="IE52"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mo>≤</mml:mo></mml:math></inline-formula> median HTA (relatively heterogeneous and relatively homogeneous, respectively). <xref rid="btab569-F7" ref-type="fig">Figure 7</xref> shows the results for the survival analysis performed using these heterogeneity-based assignments. We observe significant survival differences in the two larger region sizes, with the middle one, region size 30, obtaining the lowest <italic toggle="yes">P</italic>-value of 0.01.</p>
      <fig position="float" id="btab569-F7">
        <label>Fig. 7.</label>
        <caption>
          <p>Survival analysis with respect to HTA derived from two spatially resolved traits in breast cancer pathology whole-slides—MKI67 and miR-17 expression level. Binary spatial transcriptomics maps, inferred from the slides of 324 subjects, were split into high and low HTA with respect to the cohort’s median: &gt; median (blue) and <inline-formula id="IE53"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mo>≤</mml:mo></mml:math></inline-formula> median (orange). The plots differ in the region size used to compute HTA. HTA region sizes and corresponding log-rank <italic toggle="yes">P</italic>-values: (<bold>A</bold>) 15, <italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.15; (<bold>B</bold>) 30, <italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.01; (<bold>C</bold>) 45, <italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.06. All maps were resized to (90, 90), close to the median map size, using nearest neighbour interpolation. Each survival curve is shown with a 95% confidence interval</p>
        </caption>
        <graphic xlink:href="btab569f7" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.4 MRI</title>
      <p>In this section, we demonstrate the use of HTA in the context of 3D data by analyzing brain MRI scans (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Material S3</xref> for further details). We use four axial MRI scans from four different subjects, representing: (i) normal ageing, (ii) Alzheimer’s disease (iii) Metastatic bronchogenic carcinoma and (iv) Glioma. For each subject, we obtained the only two weighted sequences that were available for all four: T2-weighted and Proton density (PD) weighted (these accentuate different properties; for details see, e.g. <xref rid="btab569-B2" ref-type="bibr">Chong <italic toggle="yes">et al</italic>., 2016</xref>). We use these as the traits, where a strong signal (brighter) gets 1 and a low signal (darker) gets 0, depending on whether they are above or below the median grayscale value, correspondingly. Since MRI scans are sequences of images (slices), they represent a 3-dimensional space. We use three different slices per subject taken from similar locations in each (<xref rid="sup1" ref-type="supplementary-material">Supplementary Material S3</xref>). We use three for visualization purposes, but the analysis applies to any number of slices. In <xref rid="btab569-F8" ref-type="fig">Figure 8</xref> we see the resulting 3D heterogeneity maps and HTA for all four subjects. The shape of each map is (256, 256, 3) and the region size is (128, 128, 3). Normal ageing (top) is the only one that is not significantly homogeneous at a 0.01 threshold (<italic toggle="yes">P</italic>-value 0.02). The remaining three, each of which represents a different disease, are significantly homogeneous. The figures are ordered in decreasing <italic toggle="yes">P</italic>-values. Interestingly, the two cancer scans obtain the strongest significance, with <italic toggle="yes">P</italic>-values <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>84</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> (metastatic bronchogenic carcinoma) and <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>149</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> (glioma). Alzheimer’s disease is also significantly homogeneous, with a <italic toggle="yes">P</italic>-value of 0.0002.</p>
      <fig position="float" id="btab569-F8">
        <label>Fig. 8.</label>
        <caption>
          <p>Heterogeneity maps and HTA for four MRI scans taken from different subjects. The shape of each heterogeneity map is (256, 256, 3) and the region size is (128, 128, 3). From top to bottom (highest to lowest HTA <italic toggle="yes">P</italic>-values): (i) normal ageing, (ii) Alzheimer’s disease, (iii) Metastatic bronchogenic carcinoma and (iv) Glioma</p>
        </caption>
        <graphic xlink:href="btab569f8" position="float"/>
      </fig>
      <p>We note that for images, there may be other binarization techniques besides the median that are worth considering (e.g. Li thresholding to detect background versus foreground). Specifically for MRI, it may also be relevant to use actual raw signal measurements, provided such data is available. In such a case, other binarization methods may be better suited than the median value threshold. We have kept the median threshold for simplicity of demonstration.</p>
    </sec>
    <sec>
      <title>3.5 Census data</title>
      <p>To demonstrate the overall utility of HTA we also applied it to recent census data for 3092 counties across the US, excluding those in Alaska, Hawaii and Puerto Rico due to their relatively large distance from the other states (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Material S5</xref>). For each county, the data contains the total population per ethnicity, across multiple ethnicity groups. In <xref rid="btab569-F9" ref-type="fig">Figure 9</xref> we observe the heterogeneity map and corresponding HTA index and <italic toggle="yes">P</italic>-value obtained for the three ethnicity-related traits: ‘Black or African American alone &gt;5% of total population in county’, ‘Asian alone &gt; 5% of total population in county’ and ‘American Indian and Alaska Native alone &gt;5% of total population in county’ for region size 70. We observe significant homogeneity, with HTA <italic toggle="yes">P</italic>-value <inline-formula id="IE56"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>19</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, indicating that people from the same ethnic origin tend to cluster in specific regions. Since all regions included over 5% ‘White alone’ we did not include this category.</p>
      <fig position="float" id="btab569-F9">
        <label>Fig. 9.</label>
        <caption>
          <p>Heterogeneity maps and HTA for US census data for three ethnicity-related traits: ‘Black or African American alone &gt; 5% of total population in county’, ‘Asian alone &gt; 5% of total population in county’ and ‘American Indian and Alaska Native alone &gt; 5% of total population in county’ using region size 70. We observe significant homogeneity with HTA <italic toggle="yes">P</italic>-value <inline-formula id="IE57"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:mo>&lt;</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>19</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula></p>
        </caption>
        <graphic xlink:href="btab569f9" position="float"/>
      </fig>
      <p>Since the size of such maps could potentially be much larger, we also tested whether 100 random-uniform permutations (required to compute Lyapunov CLT parameters, as described in Section 2.3.2), instead of 1000, would be sufficient to obtain similar HTAs and <italic toggle="yes">P</italic>-values. The results for 100 repeats are nearly identical to those of 1000 repeats: we obtain <italic toggle="yes">P</italic>-values <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>19</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> for 1000 and <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>18</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> for 100.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>HTA provides a solution to the growing need for statistical analysis tools that are capable of quantifying spatial heterogeneity in the complex setting of high throughput molecular biology data, including spatial transcriptomics and digital pathology. It is also useful in other domains, including imaging and geographic information systems. HTA accurately reflects spatial heterogeneity at multiple resolutions, can handle a large number of variables (trait-combinations) and lends itself to efficient statistical assessment. In the context of addressing multiple traits, we also note the difference between HTA and the existing literature. For example, <xref rid="btab569-F10" ref-type="fig">Figure 10</xref> demonstrates that Morisita-Horn, which measures the overlap between two traits across all regions of a given space, will declare a perfect overlap for both examples shown in the figure, whereas HTA successfully discerns between the two.</p>
    <fig position="float" id="btab569-F10">
      <label>Fig. 10.</label>
      <caption>
        <p>HTA captures a richer representation of heterogeneity, allowing it to differentiate between types of overlap (a proxy used for heterogeneity), even in the bivariate case</p>
      </caption>
      <graphic xlink:href="btab569f10" position="float"/>
    </fig>
    <p>While HTA is multivariate, it may not easily scale to hundreds or thousands of molecular traits. This can be overcome by using aggregation methods to obtain several meta-traits, each representing a group of individual traits. We demonstrate this in <xref rid="sup1" ref-type="supplementary-material">Supplementary Material S6</xref> using immune pathway enrichment scores [computed using GSVA (<xref rid="btab569-B7" ref-type="bibr">Hänzelmann <italic toggle="yes">et al</italic>., 2013</xref>)], representing a total of 69 genes, and using cluster IDs obtained from 10X’s Loupe Browser, representing 2786 genes. Using such aggregation methods HTA can be applied to data that spans a large number of individual traits.</p>
    <p>We have also shown that HTA can be used at multiple scales, controlled by the region-size parameter. We note that other multi-scale measures, such as 2D multi-scale entropy (e.g. <xref rid="btab569-B19" ref-type="bibr">Silva <italic toggle="yes">et al</italic>., 2018</xref>), as well as fractal-based and wavelet-based methods (e.g. <xref rid="btab569-B21" ref-type="bibr">Watanabe <italic toggle="yes">et al</italic>., 2021</xref>), while multi-scale, do not apply to the trait-combination representation that HTA can analyze. These methods apply either to 2D images, with a strong emphasis on relationships between colours, or to 2D binary matrices. Since the colours in the heterogeneity maps are not ordinal, and since there is more than one trait-combination, neither option is relevant.</p>
    <p>HTA also has other advantages. First, HTA is simple to use since it requires a single input parameter (region size) and easy to interpret since it is directly derived from Shannon’s entropy. This is in contrast to available tools that are limited in at least one of these aspects. HTA also applies to any d-dimensional space. We demonstrated this in 3-dimensions using both synthetic and MRI data. Finally, HTA extends beyond the scope of molecular biology and medical imaging and can be used in many other domains, as was demonstrated with US census data.</p>
    <p>HTA can be further used in down-stream analyses. For example, in the case of ERBB2 (HER2) and CD8A (T-cells) demonstrated in <xref rid="btab569-F4" ref-type="fig">Figure 4</xref>, different HTAs could potentially be associated with different responses to immune therapy treatment. Results of applying HTA in digital pathology show that HTA may be predictive of survival in breast cancer.</p>
    <p>HTA offers many potential extensions worthy of investigation in future work. One option is to combine HTA scores from multiple scales into a new measure that summarizes them. It may also be relevant to extend HTA to apply to continuous measurements. Finally, alternative permutation-based null models may also be investigated. One option is to further investigate the utility of a trait-based permutation (see Section 2.3). Another option is a locality preserving null model (where the region can be determined by some radius), which may be useful in certain cases where retaining local characteristics is important. We note, however, that it may not be appropriate when considering more global phenomenons. One such case is when measuring the level of T-cell infiltration, as demonstrated in <xref rid="btab569-F4" ref-type="fig">Figure 4</xref>; had we performed a locality preserving permutation, we would not have been able to assess the significance of infiltration since such a permutation would cause the null model to assume that there <italic toggle="yes">is</italic> T-cell infiltration to begin with (this sample has immune cells around cancer cells in most locations). Nevertheless, alternative null models may be highly relevant in other cases, and offer interesting opportunities for further investigation.</p>
    <p>As spatial transcriptomics data and digital pathology inference techniques become increasingly available and accurate, we expect methods that address spatial distributions, including HTA and its potential extensions, to become ubiquitous.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btab569_Supplementary_Data</label>
      <media xlink:href="btab569_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgement</title>
    <p>The authors thank the Technion Computer Science Department for generously supporting A.L.-J. The authors thank the Yakhini Research Group and Vessela N. Kristensen for important discussions and input.</p>
    <sec>
      <title>Author contributions</title>
      <p>A.L.-J. and Z.Y. conceived the idea and developed the approach. A.L.-J. developed and wrote the software package. X.T. advised on breast cancer molecular biology.</p>
    </sec>
    <sec>
      <title>Funding</title>
      <p>This project received funding from the European Union’s Horizon 2020 Research and Innovation Programme under Grant Agreement No. 847912. </p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btab569-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>AbdulJabbar</surname><given-names>K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Geospatial immune variability illuminates differential evolution of lung adenocarcinoma</article-title>. <source>Nat. Med</source>., <volume>26</volume>, <fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">31932805</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chong</surname><given-names>A.L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>Proton density MRI increases detection of cervical spinal cord multiple sclerosis lesions compared with T2-weighted fast spin-echo</article-title>. <source>Am. J. Neuroradiol</source>., <volume>37</volume>, <fpage>180</fpage>–<lpage>184</lpage>.<pub-id pub-id-type="pmid">26427838</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Coudray</surname><given-names>N.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Classification and mutation prediction from non-small cell lung cancer histopathology images using deep learning</article-title>. <source>Nat. Med</source>., <volume>24</volume>, <fpage>1559</fpage>–<lpage>1567</lpage>.<pub-id pub-id-type="pmid">30224757</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dobson</surname><given-names>S.M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Relapse-fated latent diagnosis subclones in acute B lineage leukaemia are drug tolerant and possess distinct metabolic programs</article-title>. <source>Cancer Discov</source>., <volume>10</volume>, <fpage>568</fpage>–<lpage>587</lpage>.<pub-id pub-id-type="pmid">32086311</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ev Andersson</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Spatial deconvolution of her2-positive breast tumors reveals novel intercellular relationships</article-title>. <source>bioRxiv</source>.</mixed-citation>
    </ref>
    <ref id="btab569-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gillies</surname><given-names>R.J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>Evolutionary dynamics of carcinogenesis and why targeted therapy does not work</article-title>. <source>Nat. Rev. Cancer</source>, <volume>12</volume>, <fpage>487</fpage>–<lpage>493</lpage>.<pub-id pub-id-type="pmid">22695393</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B7">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Hänzelmann</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) GSVA: the gene set variation analysis package for microarray and RNA-seq data.</mixed-citation>
    </ref>
    <ref id="btab569-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hendry</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Assessing tumor infiltrating lymphocytes in solid tumors: a practical review for pathologists and proposal for a standardized method from the international immuno-oncology biomarkers working group: part 1: assessing the host immune response, TILs in invasive breast carcinoma and ductal carcinoma in situ, metastatic tumor deposits and areas for further research</article-title>. <source>Adv. Anatomic Pathol</source>., <volume>24</volume>, <fpage>235</fpage>.</mixed-citation>
    </ref>
    <ref id="btab569-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jacquemier</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2009</year>) <article-title>Association of gata3, p53, ki67 status and vascular peritumoral invasion are strongly prognostic in luminal breast cancer</article-title>. <source>Breast Cancer Res</source>., <volume>11</volume>, <fpage>R23</fpage>.<pub-id pub-id-type="pmid">19405945</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Levy-Jurgenson</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Spatial transcriptomics inferred from pathology whole-slide images links tumor heterogeneity to survival in breast and lung cancer</article-title>. <source>Sci. Rep</source>., <volume>10</volume>, <fpage>18802</fpage>–<lpage>18811</lpage>.<pub-id pub-id-type="pmid">33139755</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Little</surname><given-names>S.E.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>Receptor tyrosine kinase genes amplified in glioblastoma exhibit a mutual exclusivity in variable proportions reflective of individual tumor heterogeneity</article-title>. <source>Cancer Res</source>., <volume>72</volume>, <fpage>1614</fpage>–<lpage>1620</lpage>.<pub-id pub-id-type="pmid">22311673</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ma</surname><given-names>F.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Assessing tumor heterogeneity using CTDNA to predict and monitor therapeutic response in metastatic breast cancer</article-title>. <source>Int. J. Cancer</source>, <volume>146</volume>, <fpage>1359</fpage>–<lpage>1368</lpage>.<pub-id pub-id-type="pmid">31241775</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maley</surname><given-names>C.C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>An ecological measure of immune-cancer colocalization as a prognostic factor for breast cancer</article-title>. <source>Breast Cancer Res</source>., <volume>17</volume>, <fpage>131</fpage>.<pub-id pub-id-type="pmid">26395345</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Masuda</surname><given-names>T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>Spatial and temporal heterogeneity of mouse and human microglia at single-cell resolution</article-title>. <source>Nature</source>, <volume>566</volume>, <fpage>388</fpage>–<lpage>392</lpage>.<pub-id pub-id-type="pmid">30760929</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nearchou</surname><given-names>I.P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Spatial immune profiling of the colorectal tumor microenvironment predicts good outcome in stage II patients</article-title>. <source>NPJ Digital Med</source>., <volume>3</volume>, <fpage>71</fpage>.</mixed-citation>
    </ref>
    <ref id="btab569-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pruneri</surname><given-names>G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Tumor infiltrating lymphocytes in early breast cancer</article-title>. <source>Breast</source>, <volume>37</volume>, <fpage>207</fpage>–<lpage>214</lpage>.<pub-id pub-id-type="pmid">28363679</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rempala</surname><given-names>G.A.</given-names></string-name>, <string-name><surname>Seweryn</surname><given-names>M.</given-names></string-name></person-group> (<year>2013</year>) <article-title>Methods for diversity and overlap analysis in t-cell receptor populations</article-title>. <source>J. Math. Biol</source>., <volume>67</volume>, <fpage>1339</fpage>–<lpage>1368</lpage>.<pub-id pub-id-type="pmid">23007599</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ripley</surname><given-names>B.D.</given-names></string-name></person-group> (<year>1976</year>) <article-title>The second-order analysis of stationary point processes</article-title>. <source>J. Appl. Probab</source>., <volume>13</volume>, <fpage>255</fpage>–<lpage>266</lpage>.</mixed-citation>
    </ref>
    <ref id="btab569-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Silva</surname><given-names>L.E.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Two-dimensional multiscale entropy analysis: applications to image texture evaluation</article-title>. <source>Signal Process</source>., <volume>147</volume>, <fpage>224</fpage>–<lpage>232</lpage>.</mixed-citation>
    </ref>
    <ref id="btab569-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>J.-F.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>A measure of spatial stratified heterogeneity</article-title>. <source>Ecol. Indicat</source>., <volume>67</volume>, <fpage>250</fpage>–<lpage>256</lpage>.</mixed-citation>
    </ref>
    <ref id="btab569-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Watanabe</surname><given-names>H.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>) <article-title>Quantification of structural heterogeneity using fractal analysis of contrast-enhanced CT image to predict survival in gastric cancer patients</article-title>. <source>Digest. Dis. Sci</source>., <volume>66</volume>, <fpage>2069</fpage>–<lpage>2074</lpage>.<pub-id pub-id-type="pmid">32691383</pub-id></mixed-citation>
    </ref>
    <ref id="btab569-B22">
      <mixed-citation publication-type="other">10x Genomics. Spatial Transcriptomics. <ext-link xlink:href="https://www.10xgenomics.com/spatial-transcriptomics/" ext-link-type="uri">https://www.10xgenomics.com/spatial-transcriptomics/</ext-link> (24 December 2020, date last accessed).</mixed-citation>
    </ref>
    <ref id="btab569-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yuan</surname><given-names>Y.</given-names></string-name></person-group> (<year>2016</year>) <article-title>Spatial heterogeneity in the tumor microenvironment</article-title>. <source>Cold Spring Harbor Perspect. Med</source>., <volume>6</volume>, <fpage>a026583</fpage>.</mixed-citation>
    </ref>
    <ref id="btab569-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zheng</surname><given-names>X.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Spatial density and distribution of tumor-associated macrophages predict survival in non-small cell lung carcinoma</article-title>. <source>Cancer Res</source>., <volume>80</volume>, <fpage>4414</fpage>–<lpage>4425</lpage>.<pub-id pub-id-type="pmid">32699134</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
