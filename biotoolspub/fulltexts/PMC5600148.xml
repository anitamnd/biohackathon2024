<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5600148</article-id>
    <article-id pub-id-type="pmid">28263959</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.4197</article-id>
    <article-id pub-id-type="manuscript">nihpa849351</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>Salmon</italic>: fast and bias-aware quantification of transcript expression using dual-phase inference</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Patro</surname>
          <given-names>Rob</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref rid="FN1" ref-type="author-notes">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Duggal</surname>
          <given-names>Geet</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref rid="FN2" ref-type="author-notes">†</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Love</surname>
          <given-names>Michael I</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref rid="FN3" ref-type="author-notes">‡</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Irizarry</surname>
          <given-names>Rafael A</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref rid="FN4" ref-type="author-notes">§</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kingsford</surname>
          <given-names>Carl</given-names>
        </name>
        <xref rid="FN5" ref-type="author-notes">¶</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Department of Computer Science, Stony Brook University</aff>
    <aff id="A2"><label>2</label>DNAnexus, 1975 W El Camino Real, Suite 101 Mountain View, CA 94040</aff>
    <aff id="A3"><label>3</label>Department of Biostatistics and Computational Biology, Dana-Farber Cancer Institute, Department of Biostatistics, Harvard TH Chan School of Public Health</aff>
    <aff id="A4"><label>4</label>Computational Biology Department, Carnegie Mellon University</aff>
    <author-notes>
      <fn id="FN1">
        <label>*</label>
        <p>
          <email>rob.patro@cs.stonybrook.edu</email>
        </p>
      </fn>
      <fn id="FN2">
        <label>†</label>
        <p><email>gduggal@dnanexus.com</email>, work done while GD was at CMU.</p>
      </fn>
      <fn id="FN3">
        <label>‡</label>
        <p>
          <email>mlove@jimmy.harvard.edu</email>
        </p>
      </fn>
      <fn id="FN4">
        <label>§</label>
        <p>
          <email>rafa@jimmy.harvard.edu</email>
        </p>
      </fn>
      <fn id="FN5">
        <label>¶</label>
        <p>
          <email>carlk@cs.cmu.edu</email>
        </p>
      </fn>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>18</day>
      <month>3</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>06</day>
      <month>3</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>4</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>19</day>
      <month>9</month>
      <year>2017</year>
    </pub-date>
    <volume>14</volume>
    <issue>4</issue>
    <fpage>417</fpage>
    <lpage>419</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.4197-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:
<uri xlink:type="simple" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</uri></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">We introduce <italic>Salmon</italic>, a method for quantifying transcript abundance from RNA-seq reads that is accurate and fast. <italic>Salmon</italic> is the first transcriptome-wide quantifier to correct for fragment GC content bias, which we demonstrate substantially improves the accuracy of abundance estimates and the reliability of subsequent differential expression analysis. <italic>Salmon</italic> combines a new dual-phase parallel inference algorithm and feature-rich bias models with an ultra-fast read mapping procedure.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">Estimating transcript abundance is a fundamental task in genomics. These estimates are used for the classification of diseases and their subtypes [<xref rid="R1" ref-type="bibr">1</xref>], for understanding expression changes during development [<xref rid="R2" ref-type="bibr">2</xref>], and tracking the progression of cancer [<xref rid="R3" ref-type="bibr">3</xref>]. Accurate and efficient quantification of transcript abundance from RNA-seq data is an especially pressing problem due to both the wide range of technical biases that affect the RNA-seq fragmentation, amplification and sequencing process [<xref rid="R4" ref-type="bibr">4</xref>] [<xref rid="R5" ref-type="bibr">5</xref>], the exponentially increasing number of experiments, and the adoption of expression data for medical diagnosis [<xref rid="R6" ref-type="bibr">6</xref>]. Traditional quantification algorithms, that use alignments of the sequencing reads to the genome or transcriptome, require significant computational resources [<xref rid="R7" ref-type="bibr">7</xref>] and do not scale well with the rate at which data is produced [<xref rid="R8" ref-type="bibr">8</xref>]. <italic>Sailfish</italic> [<xref rid="R9" ref-type="bibr">9</xref>] achieved an order of magnitude speed improvement by replacing traditional read alignment with the allocation of exact k-mers to transcripts. <italic>kallisto</italic> [<xref rid="R10" ref-type="bibr">10</xref>] achieves similar speed improvements and further reduces the gap in accuracy with traditional alignment-based methods by replacing the k-mer counting approach with a procedure called pseudoalignment, that is capable of rapidly determining the set of transcripts compatible with a given sequenced fragment.</p>
  <p id="P3">However, existing methods for transcriptome-wide abundance estimation, both alignment-based and alignment-free, lack sample-specific bias models rich enough to capture important effects, like fragment GC content bias. When uncorrected, these biases can lead to, e.g., high false positive rates in differential expression studies [<xref rid="R5" ref-type="bibr">5</xref>].</p>
  <p id="P4">Our novel quantification procedure, called <italic>Salmon</italic>, achieves greater accuracy than tools such as <italic>kallisto</italic> and <italic>eXpress</italic>, employs sample-specific bias models that account for sequence-specific, fragment-GC and positional biases, and simultaneously achieves the same order-of-magnitude speed benefits as <italic>kallisto</italic> and <italic>Sailfish. Salmon</italic> consists of three components: a lightweight-mapping model, an online phase that estimates initial expression levels and model parameters, and an offline phase that refines expression estimates (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 1</xref>). This two-phase inference procedure allows <italic>Salmon</italic> to build a probabilistic model of the sequencing experiment that incorporates information — like terms contributing to the conditional probability of drawing a fragment given a transcript — not considered by <italic>Sailfish</italic> [<xref rid="R9" ref-type="bibr">9</xref>] and <italic>kallisto</italic> [<xref rid="R10" ref-type="bibr">10</xref>]. <italic>Salmon</italic> also provides the ability to estimate abundance uncertainty due to random sampling and the ambiguity introduced by multimapping reads (<bold>Online methods</bold>).</p>
  <p id="P5">Unlike pseudoalignment, <italic>Salmon</italic>’s lightweight mapping procedure tracks, by default, the position and orientation of all mapped fragments. This information is used in conjunction with the abundances from online inference to compute per-fragment conditional probabilities. These probabilities are used to estimate auxiliary models and bias terms, and to update abundance estimates, and are subsequently aggregated into weights for the rich equivalence classes used during offline inference.</p>
  <p id="P6">Using experimental data from the GEUVADIS [<xref rid="R11" ref-type="bibr">11</xref>] and SEQC [<xref rid="R12" ref-type="bibr">12</xref>] studies, and synthetic data from the Polyester [<xref rid="R13" ref-type="bibr">13</xref>] and <italic>RSEM</italic>-sim [<xref rid="R14" ref-type="bibr">14</xref>] simulators, we benchmark <italic>Salmon</italic> against <italic>kallisto</italic> [<xref rid="R10" ref-type="bibr">10</xref>] and <italic>eXpress</italic> [<xref rid="R15" ref-type="bibr">15</xref>] + <italic>Bowtie2</italic> [<xref rid="R16" ref-type="bibr">16</xref>]; both of these methods also implement their own bias models. We also test <italic>Salmon</italic> using traditional alignments (from <italic>Bowtie2</italic>) as input (denoted as “<italic>Salmon</italic>(a)”). We show that <italic>Salmon</italic> typically outperforms both <italic>kallisto</italic> and <italic>eXpress</italic> in terms of accuracy (<xref rid="F1" ref-type="fig">Fig. 1a–d</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 2</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 3</xref>). We note that all these tools address transcript quantification, and do not identify or assemble novel transcripts (<xref rid="SD1" ref-type="supplementary-material">Supplementary Note 1</xref>).</p>
  <p id="P7"><italic>Salmon</italic>’s dual-phase inference algorithm and sample-specific bias models yield improved inter-replicate concordance (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 4</xref>) compared to both <italic>kallisto</italic> and <italic>eXpress</italic>. For example, when used for differential expression (DE) testing, the quantification estimates produced by <italic>Salmon</italic> exhibit markedly higher sensitivity at the same false discovery rate (<bold>Table 1c</bold>) — achieving a sensitivity 53% to 250% higher, at the same FDRs. Likewise, <italic>Salmon</italic> produces fewer false-positive differential expression calls in comparisons that are expected to contain few or no true differences in transcript expression (<bold>Table 1d</bold>). <italic>Salmon</italic>’s benefits persist at the gene level as well, where the use of <italic>Salmon</italic>’s estimates for gene-level DE analysis leads to a decrease by a factor of ~2.6 in the number of genes that are called as DE (<xref rid="SD1" ref-type="supplementary-material">Supplementary Table 1</xref>). <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 5</xref> shows specific examples from the GEUVADIS experiments where dominant isoform switching is observed (p &lt; 1 × 10<sup>−6</sup>) between samples under the quantification estimates produced by <italic>kallisto</italic> or <italic>eXpress</italic>, but this isoform switching is eliminated under the <italic>Salmon</italic>’s GC bias aware abundance estimates. <xref rid="SD1" ref-type="supplementary-material">Supplementary Table 2</xref> provides the rate of isoform switching for the different methods, underscoring that <italic>Salmon</italic> reduces this rate across various thresholds and for various categories of genes. In idealized simulations, like those generated by <italic>RSEM</italic>-sim, where realistic biases are not simulated, the accuracy estimates of different methods tend to be more similar (<xref rid="F1" ref-type="fig">Fig. 1b</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 6</xref>). These idealized simulations, where the fragments are generated without bias and in perfect accordance with the generative model adopted by the quantifiers, serve as a useful measure of the internal consistency of the algorithms [<xref rid="R14" ref-type="bibr">14</xref>] [<xref rid="R10" ref-type="bibr">10</xref>]. However, we expect results on the SEQC [<xref rid="R12" ref-type="bibr">12</xref>], GEUVADIS [<xref rid="R11" ref-type="bibr">11</xref>], and Polyester [<xref rid="R13" ref-type="bibr">13</xref>] (simulated with bias) data sets to be more representative of typical real-world performance. On the <italic>RSEM</italic>-sim data we evaluated all methods without bias correction. On all other data, we enabled bias correction for all methods. Additionally, on the Polyester simulated data, we enabled 
<monospace>--noBiasLengthThreshold</monospace> (to allow correction of even very short transcripts) for <italic>Salmon</italic>, since we are interested in assessing the maximum sensitivity of the model, and the simulator produces fragments that are well-behaved with respect to very short transcripts (see <bold>Online methods</bold> for details).</p>
  <p id="P8"><italic>Salmon</italic>’s rich model accounts for the effects of sample-specific parameters and biases that are typical of RNA-seq data, including positional biases in coverage, sequence-specific biases at the 5′ and 3′ end of sequenced fragments, fragment-level GC bias, strand-specific protocols, and the fragment length distribution. These parameters are automatically learned in the online phase of the algorithm, which also estimates the conditional probability of a fragment being generated from each transcript to which it multimaps, as assessed by a general fragment-transcript agreement model (<bold>Online methods</bold>, <bold>Fragment-transcript agreement model</bold>). This provides considerable information beyond simple fragment-transcript compatibility. <italic>Salmon</italic> incorporates these parameters by learning auxiliary models that describe the relevant distributions and by maintaining “rich equivalence classes” of fragments (<bold>Online methods</bold>, <bold>Equivalence classes</bold>).</p>
  <p id="P9"><italic>Salmon</italic> encompasses both “alignment” and “quantification” in a single tool. When run in quasi-mapping mode, <italic>Salmon</italic> takes as input an index of the transcriptome and a set of raw sequencing reads (i.e., unaligned reads in FASTA/Q format) and performs quantification directly without generating any intermediate alignment files. This saves considerable time and space, since quasi-mapping is faster than traditional alignment.</p>
  <p id="P10"><italic>Salmon</italic> is designed take advantage of multiple CPU cores, and the mapping and inference procedures scale well with the number of reads in an experiment. <italic>Salmon</italic> can quantify abundance either via a built-in, ultra-fast read-mapping procedure (quasi-mapping) [<xref rid="R17" ref-type="bibr">17</xref>], or using pre-computed alignments provided in 
<monospace>SAM</monospace> or 
<monospace>BAM</monospace> format. <italic>Salmon</italic> can quantify an experiment of approximately 600 million reads (75bp, paired-end) in ≈ 23 minutes (1384 seconds) using 30 threads— this roughly matches the speed of the recently-introduced <italic>kallisto</italic>, which takes ≈ 20 minutes (1198 seconds) to complete the same task using the same number of threads on the same machine (a 24 core machine with hyper-threading and 256Gb of RAM; each core is Intel® Xeon® CPU E5-4607 v2 2.60GHz).</p>
  <p id="P11"><italic>Salmon</italic>’s approach is unique in how it combines models of experimental data and bias with an efficient dual-phase inference procedure. <italic>Salmon</italic>’s ability to compute high-quality estimates of transcript abundances at the scale of thousands of samples, while also accounting for the prevalent technical biases affecting transcript quantification [<xref rid="R18" ref-type="bibr">18</xref>], will enable individual expression experiments to be interpreted in the context of many rapidly growing sequence expression databases. This will allow for a more comprehensive comparison of the similarity of experiments across large populations of individuals and across different environmental conditions and cell types. <italic>Salmon</italic> is open-source and freely-licensed (GPLv3). It is written in 
<monospace>C++11</monospace> and is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/COMBINE-lab/Salmon">https://github.com/COMBINE-lab/Salmon</ext-link>.</p>
  <sec id="S1" specific-use="web-only">
    <title>Online methods</title>
    <sec id="S2" sec-type="intro">
      <title>Objectives and models for abundance estimation</title>
      <p id="P12">Our main goal is to quantify, given a known transcriptome 𝒯 and a set of sequenced fragments ℱ, the relative abundance of each transcript in our input sample. This problem is challenging both statistically and computationally. The main statistical challenges derive from need to resolve a complex and often very high-dimensional mixture model (i.e., estimating the relative abundances of the transcripts given the collection of ambiguously mapping sequenced fragments). The main computational challenges derive from the need to process datasets that commonly consist of tens of millions of fragments, in conditions where each fragment might reasonably map to many different transcripts. We lay out below how we tackle these challenges, beginning with a description of our assumed generative model of the sequencing experiment, upon which we will perform inference to estimate transcript abundances.</p>
      <p id="P13">Our approach in <italic>Salmon</italic> consists of three components: a lightweight-mapping model, an online phase that estimates initial expression levels, auxiliary parameters, foreground bias models and constructs equivalence classes over the input fragments, and an offline phase that refines these expression estimates. The online and offline phases together optimize the estimates of the transcript abundances.</p>
      <p id="P14">The online phase uses a variant of stochastic, collapsed variational Bayesian inference [<xref rid="R19" ref-type="bibr">19</xref>]. The offline phase applies either a standard EM algorithm or a variational Bayesian EM algorithm [<xref rid="R20" ref-type="bibr">20</xref>] over a reduced representation of the data represented by the equivalence classes until a data-dependent convergence criterion is satisfied. An overview of our method is given in <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 1</xref>, and we describe each component in more detail below.</p>
      <p id="P15">Here, we use the vertical bar | to indicate that the fixed quantities following are parameters used to calculate the probability. For the Bayesian objective, the notation implies conditioning on these random variables.</p>
      <sec id="S3">
        <title>Generative process</title>
        <p id="P16">Assume that, for a particular sequencing experiment, the underlying true transcriptome is given as 𝒥 = {(<italic>t</italic><sub>1</sub>, … , <italic>t<sub>M</sub></italic>), (<italic>c</italic><sub>1</sub>, … , <italic>c<sub>M</sub></italic>)}, where each <italic>t<sub>i</sub></italic> is the nucleotide sequence of some transcript (an isoform of some gene) and each c<sub>i</sub> is the corresponding number of copies of t in the sample. Further, we denote by ℓ<italic><sub>i</sub></italic> the length of transcript t and by ℓ̃<italic><sub>ι</sub></italic> the effective length of transcript <italic>t<sub>i</sub></italic>, as defined in <xref rid="FD3" ref-type="disp-formula">Equation (1)</xref>.</p>
        <p id="P17">We adopt a generative model of the sequencing experiment that dictates that, in the absence of experimental bias, library fragments are sampled proportional to <italic>c<sub>i</sub></italic> · ℓ̃<italic><sub>ι</sub></italic>. That is, the probability of drawing a sequencing fragment from some position on a particular transcript <italic>t<sub>i</sub></italic> is proportional the total fraction of all nucleotides in the sample that originate from a copy of <italic>t<sub>i</sub></italic>. This quantity is called the nucleotide fraction [<xref rid="R14" ref-type="bibr">14</xref>]: 
<disp-formula id="FD1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>η</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>ℓ</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mi>ι</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>ℓ</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
        <p id="P18">The true nucleotide fractions, <bold><italic>η</italic></bold>, though not directly observable, would provide us with a way to measure the true relative abundance of each transcript in our sample. Specifically, if we normalize the <italic>η<sub>i</sub></italic> by the effective transcript length ℓ̃<italic><sub>ι</sub></italic>, we obtain a quantity</p>
        <p id="P19"><disp-formula id="FD2"><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mfrac><mml:msub><mml:mi>η</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mover accent="true"><mml:mi>ℓ</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mi>ι</mml:mi></mml:msub></mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:mfrac><mml:msub><mml:mi>η</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mover accent="true"><mml:mi>ℓ</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub></mml:mfrac></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> called the transcript fraction [<xref rid="R14" ref-type="bibr">14</xref>]. These <bold><italic>τ</italic></bold> can be used to immediately compute common measures of relative transcript abundance like transcripts per million (TPM). The TPM measure for a particular transcript is the number of copies of this transcript that we would expect to exist in a collection of one million transcripts, assuming this collection had exactly same distribution of abundances as our sample. The TPM for transcript <italic>t<sub>i</sub></italic> t<sub>i</sub>, is given by TPM<sub>i</sub> = τ<italic><sub>i</sub></italic> · 10<sup>6</sup>. Of course, in a real sequencing experiment, there are numerous biases and sampling effects that may alter the above assumptions, and accounting for them is essential for accurate inference. Below we describe how <italic>Salmon</italic> accounts for 5’ and 3’ sequence-specific biases (which are not considered separately by <italic>kallisto</italic>) and fragment GC bias which is modeled by neither <italic>kallisto</italic> nor <italic>eXpress</italic>.</p>
      </sec>
      <sec id="S4">
        <title>Effective length</title>
        <p id="P20">A transcript’s effective length depends on the empirical fragment length distribution of the underlying sample and the length of the transcript. It accounts for the fact that the range of fragment sizes that can be sampled is limited near the ends of a transcript. Here, fragments refer to the (potentially size-selected) cDNA fragments of the underlying library, from the ends of which sequencing reads are generated. In paired-end data, the mapping positions of the reads can be used to infer the empirical distribution of fragment lengths in the underlying library, while the expected mean and standard deviation of this distribution must be provided for single-end libraries. We compute the effective transcript lengths using the approach of <italic>kallisto</italic> [<xref rid="R10" ref-type="bibr">10</xref>], which defines the effective length of a transcript <italic>t<sub>i</sub></italic> as</p>
        <p id="P21"><disp-formula id="FD3"><label>Equation 1</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ℓ</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mi>ι</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>d</mml:mi><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where 
<inline-formula><mml:math id="M4" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mi>ℓ</mml:mi></mml:msubsup><mml:mi>d</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the mean of the truncated empirical fragment length distribution. Specifically, let <italic>d</italic> be the empirical fragment length distribution, and Pr{<italic>X</italic> = <italic>x</italic>} be the probability of drawing a fragment of length <italic>x</italic> under <italic>d</italic>, then 
<inline-formula><mml:math id="M5" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mi>ℓ</mml:mi></mml:msubsup><mml:mi>d</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup><mml:mrow><mml:mi>j</mml:mi><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
        <p id="P63">Given a collection of observations (raw sequenced fragments or alignments thereof), and a model similar to the one described above, there are numerous approaches to inferring the relative abundance of the transcripts in the target transcriptome, 𝒥. Here we describe two basic inference schemes, both available in <italic>Salmon</italic>, which are commonly used to perform inference in such a model. All of the results reported in the manuscript were computed using the maximum likelihood objective (i.e., the EM algorithm) in the offline phase, which is the default in <italic>Salmon</italic>.</p>
      </sec>
      <sec id="S5">
        <title>Maximum likelihood objective</title>
        <p id="P22">The first scheme takes a maximum likelihood approach to solve for the quantities of interest. Specifically, if we assume that all fragments are generated independently, and we are given a vector of known nucleotide fractions <bold><italic>η</italic></bold> a binary matrix of transcript-fragment assignment <bold><italic>Z</italic></bold> where <italic>z<sub>ij</sub></italic> = 1 if fragment <italic>j</italic> is derived from transcript <italic>i</italic>, and the set of transcripts 𝒥, we can write the probability of observing a set of sequenced fragments ℱ as follows: 
<disp-formula id="FD4"><label>Equation 2</label><mml:math id="M6" display="block" overflow="scroll"><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="script">F</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold-italic">η</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">J</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:mo>Pr</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi mathvariant="bold-italic">η</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">J</mml:mi></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi><mml:mo>=</mml:mo><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mi mathvariant="bold-italic">N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi><mml:mo>=</mml:mo><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:munderover><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi mathvariant="bold-italic">η</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula> where |ℱ| = <italic>N</italic> is the number of sequenced fragments, Pr{<italic>t<sub>i</sub></italic> | <bold><italic>η</italic></bold>} is the probability of selecting transcript <italic>t<sub>i</sub></italic> to generate some fragment given the nucleotide fraction <bold><italic>η</italic></bold>, and Pr{<italic>t<sub>i</sub></italic> | <bold><italic>η</italic></bold>} = <italic>η<sub>i</sub></italic></p>
        <p id="P23">We have that Pr{<italic>f<sub>j</sub></italic> | <italic>t<sub>i</sub></italic>, <italic>z<sub>ij</sub></italic> = 1} is the probability of generating fragment <italic>j</italic> given that it came from transcript <italic>i</italic>. We will use Pr{<italic>f<sub>j</sub></italic> | <italic>t<sub>i</sub></italic>} as shorthand for Pr{<italic>f<sub>j</sub></italic> | <italic>t<sub>i</sub></italic>, <italic>z<sub>ij</sub></italic> = 1} since Pr{<italic>f<sub>j</sub></italic> | <italic>t<sub>i</sub></italic>, <italic>z<sub>ij</sub></italic> = 1} is defined to be uniformly 0. The determination of Pr{<italic>f<sub>j</sub></italic> | <italic>t<sub>i</sub></italic>} is defined in further detail in <bold>Fragment-transcript agreement model</bold>. The likelihood associated with this objective can be optimized using the EM algorithm as in [<xref rid="R14" ref-type="bibr">14</xref>].</p>
      </sec>
      <sec id="S6">
        <title>Bayesian objective</title>
        <p id="P24">One can also take a Bayesian approach to transcript abundance inference as done in [<xref rid="R21" ref-type="bibr">21</xref>, <xref rid="R22" ref-type="bibr">22</xref>]. In this approach, rather than directly seeking maximum likelihood estimates of the parameters of interest, we want to infer the posterior distribution of <bold><italic>η</italic></bold>. In the notation of [<xref rid="R21" ref-type="bibr">21</xref>], we wish to infer Pr{<bold><italic>η</italic></bold>| ℱ, 𝒥} — the posterior distribution of nucleotide fractions given the transcriptome 𝒥 and the observed fragments ℱ. This distribution can be written as: 
<disp-formula id="FD5"><label>Equation 3</label><mml:math id="M7" display="block" overflow="scroll"><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="bold-italic">η</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="script">F</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">J</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>∝</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>Z</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">Z</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="script">F</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="script">J</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Z</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="bold-italic">Z</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold-italic">η</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="bold-italic">η</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where</p>
        <p id="P25"><disp-formula id="FD6"><label>Equation 4</label><mml:math id="M8" display="block" overflow="scroll"><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="bold-italic">Z</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold-italic">η</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:msubsup><mml:mi>η</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:msubsup></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> and</p>
        <disp-formula id="FD7">
          <label>Equation 5</label>
          <mml:math id="M9" display="block" overflow="scroll">
            <mml:mrow>
              <mml:mo>Pr</mml:mo>
              <mml:mo stretchy="false">{</mml:mo>
              <mml:mi mathvariant="script">F</mml:mi>
              <mml:mo>∣</mml:mo>
              <mml:mi mathvariant="script">J</mml:mi>
              <mml:mo>,</mml:mo>
              <mml:mi mathvariant="bold-italic">Z</mml:mi>
              <mml:mo stretchy="false">}</mml:mo>
              <mml:mo>=</mml:mo>
              <mml:msubsup>
                <mml:mo>∏</mml:mo>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
                <mml:mi>M</mml:mi>
              </mml:msubsup>
              <mml:mrow>
                <mml:msubsup>
                  <mml:mo>∏</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>N</mml:mi>
                </mml:msubsup>
                <mml:mrow>
                  <mml:mo>Pr</mml:mo>
                  <mml:msup>
                    <mml:mrow>
                      <mml:mo stretchy="false">{</mml:mo>
                      <mml:msub>
                        <mml:mi>f</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:msub>
                      <mml:mo>∣</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo stretchy="false">}</mml:mo>
                    </mml:mrow>
                    <mml:msub>
                      <mml:mi>z</mml:mi>
                      <mml:mrow>
                        <mml:mi>j</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:mrow>
                    </mml:msub>
                  </mml:msup>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
        <p id="P26">Unfortunately, direct inference on the distribution Pr{<bold><italic>η</italic></bold>| ℱ, 𝒥} is intractable because its evaluation requires the summation over the exponentially large latent variable configuration space (i.e., all <bold><italic>Z</italic></bold> ∈ 𝒵). Since the posterior distribution cannot be directly estimated, we must rely on some form of approximate inference. One particularly attractive approach is to apply variational Bayesian (VB) inference in which some tractable approximation to the posterior distribution is assumed.</p>
        <p id="P27">Subsequently, one seeks the parameters for the approximate posterior under which it best matches the true posterior. Essentially, this turns the inference problem into an optimization problem — finding the optimal set of parameters — which can be efficiently solved by several different algorithms. Variational inference seeks to find the parameters for the approximate posterior that minimizes the Kullback-Leibler (KL) divergence between the approximate and true posterior distribution. Though the true posterior may be intractable, this minimization can be achieved by maximizing a lower-bound on the marginal likelihood of the posterior distribution [<xref rid="R21" ref-type="bibr">21</xref>], written in terms of the approximate posterior. When run with the VB objective, <italic>Salmon</italic> optimizes the collapsed variational Bayesian objective [<xref rid="R21" ref-type="bibr">21</xref>] in its online phase and the full variational Bayesian objective [<xref rid="R22" ref-type="bibr">22</xref>] in the variational Bayesian mode of its offline phase (see <bold>Offline phase</bold>).</p>
      </sec>
      <sec id="S7">
        <title>Fragment-transcript agreement model</title>
        <p id="P28">Fragment-transcript assignment scores are defined as proportional to (1) the chance of observing a fragment length given a particular transcript/isoform, (2) the chance that a fragment starts at a particular position on the transcript, (3) the concordance of the fragment aligning with a user-defined (or automatically inferred) sequencing library format (e.g., a paired ended, stranded protocol), and (4) the chance that the fragment came from the transcript based on a score obtained from the alignment procedure (if alignments are being used). We model this agreement as a conditional probability Pr{<italic>f<sub>j</sub></italic> | <italic>t</italic>_<italic>i</italic>} for generating <italic>f<sub>j</sub></italic> given <italic>t<sub>i</sub></italic>. This probability, in turn, depends on auxiliary models whose parameters do not explicitly depend upon the current estimates of transcript abundances. Thus, once the parameters of these models have been learned and are fixed, these terms do not change even when the estimate for Pr{<italic>t<sub>i</sub></italic> | <bold><italic>η</italic></bold>} = <italic>η<sub>i</sub></italic> needs to be updated. <italic>Salmon</italic> uses the following auxiliary terms: 
<disp-formula id="FD8"><label>Equation 6</label><mml:math id="M10" display="block" overflow="scroll"><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>p</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>ℓ</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>o</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>a</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi><mml:mo>,</mml:mo><mml:mi>ℓ</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math></disp-formula> where Pr{ℓ | <italic>t<sub>i</sub></italic>} is the probability of drawing a fragment of the inferred length, ℓ, given <italic>t<sub>i</sub></italic>, and is evaluated based on an observed empirical fragment length distribution. Pr{<italic>p</italic> | <italic>t<sub>i</sub></italic>, ℓ} is the probability of the fragment starting at position <italic>p</italic> on <italic>t<sub>i</sub></italic> and is a function of the transcript’s length. Pr{<italic>o</italic> | <italic>t<sub>i</sub></italic>} is the probability of obtaining a fragment aligning (or mapping) with the given orientation to <italic>t<sub>i</sub></italic>. This is determined by the concordance of the fragment with the user-specified library format. It is 1 if the alignment agrees with the library format and a user-defined prior value otherwise. Finally, Pr{<italic>a</italic> | <italic>f<sub>j</sub></italic>, <italic>t<sub>i</sub></italic>, <italic>p</italic>, <italic>o</italic>, ℓ} is the probability of generating alignment <italic>a</italic> of fragment <italic>f<sub>j</sub></italic>, given that it is drawn from <italic>t<sub>i</sub></italic>, with orientation <italic>o</italic>, and starting at position <italic>p</italic> and is of length ℓ; this term is set to 1 when using quasi-mapping, and is given by <xref rid="FD10" ref-type="disp-formula">equation (7)</xref> for traditional alignments. The parameters for all auxiliary models are learned during the streaming phase of the inference algorithm from the first <italic>N</italic>′ observations (5,000,000 by default). These auxiliary terms can then be applied to all subsequent observations.</p>
      </sec>
      <sec id="S8">
        <title>Sequence-specific bias</title>
        <p id="P29">It has been previously observed that the sequence surrounding the 5′ and 3′ ends of RNA-seq fragments influences the likelihood that these fragments are selected for sequencing [<xref rid="R4" ref-type="bibr">4</xref>]. If not accounted for, these biases can have a substantial effect on abundance estimates and can confound downstream analyses. To learn and correct for such biases, <italic>Salmon</italic> adopts a modification of the model introduced by Roberts et al. [<xref rid="R4" ref-type="bibr">4</xref>]. A (foreground) variable-length Markov model (VLMM) is trained on sequence windows surrounding the 5′ (
<inline-formula><mml:math id="M11" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>+</mml:mo></mml:msup><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup></mml:mrow></mml:math></inline-formula>) and 3′ (
<inline-formula><mml:math id="M12" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>+</mml:mo></mml:msup><mml:msup><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup></mml:mrow></mml:math></inline-formula>) read start positions. Then, a different (background) VLMM is trained on sequence windows drawn uniformly across known transcripts, each weighted by that transcript’s abundance; the 5′ and 3′ background models are denoted as 
<inline-formula><mml:math id="M13" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>-</mml:mo></mml:msup><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup></mml:mrow></mml:math></inline-formula> and 
<inline-formula><mml:math id="M14" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>+</mml:mo></mml:msup><mml:msup><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup></mml:mrow></mml:math></inline-formula> respectively.</p>
      </sec>
      <sec id="S9">
        <title>Fragment GC-bias</title>
        <p id="P30">In addition to the sequence surrounding the 5’ and 3’ ends of a fragment, it has also been observed that the GC-content of the entire fragment can play a substantial role in the likelihood that it will be selected for sequencing [<xref rid="R5" ref-type="bibr">5</xref>]. These biases are largely different than sequence-specific biases, and thus, accounting for both the context surrounding the fragments and the GC-content of the fragments themselves is important when one wishes to learn and correct for some of the most prevalent types of bias <italic>in silico</italic>. To account for fragment GC-bias, <italic>Salmon</italic> learns a foreground and background model of this fragment GC-bias (and defines the bias as the ratio of the score of a fragment under each). Our fragment GC-bias model consists of the observed distribution of sequenced fragments for every possible GC-content value (in practice, we discretize GC-content and maintain a distribution over 25 bins, for fragments with GC content ranging from 0 to 1 in increments of 0.04). The background model is trained on all possible fragments (drawn uniformly and according to the empirical fragment length distribution) across known transcripts, with each fragment weighted by that transcript’s abundance. The foreground and background fragment GC-bias models are denoted as <italic>b</italic><sub><italic>gc</italic><sup>+</sup></sub> and <italic>b</italic><sub><italic>gc</italic><sup>−</sup></sub> respectively. Additionally, we note that sequence-specific and fragment GC biases do seem to display a conditional dependence. To account for this, <italic>Salmon</italic> learns (by default) 3 different bias models, each conditioned on the average GC content of the 5′ and 3′ sequence context of the fragment. A separate model is trained and applied for fragments with average GC content between [0, 0.33), [0.33, 0.66), and [0.66, 1]. The performance of the model appears robust to the number of conditional GC models used (<xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 7</xref>).</p>
      </sec>
      <sec id="S10">
        <title>Incorporating the bias models</title>
        <p id="P31">These bias models are used to re-estimate the effective length of each transcript, such that a transcript’s effective length now also takes into account the likelihood of sampling each possible fragment that transcript can produce — an approach to account for bias first introduced by Roberts et al. [<xref rid="R4" ref-type="bibr">4</xref>]. Before learning the bias-corrected effective lengths, the offline optimization algorithm is run for a small number of rounds (10 by default) to produce estimated abundances that are used when learning the background distributions for the various bias models. For a transcript <italic>t<sub>i</sub></italic>, the effective length becomes: 
<disp-formula id="FD9"><mml:math id="M15" display="block" overflow="scroll"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>ℓ</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mi>ι</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mo>∑</mml:mo><mml:mrow><mml:mo>∑</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:msup><mml:mi>c</mml:mi><mml:mo>+</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:msup><mml:mi>c</mml:mi><mml:mo>-</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>·</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>+</mml:mo></mml:msup><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>-</mml:mo></mml:msup><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>·</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>+</mml:mo></mml:msup><mml:msup><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>-</mml:mo></mml:msup><mml:msup><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>·</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula> where Pr{<italic>X</italic> = <italic>j</italic>} is the probability, under the empirical fragment length distribution, of observing a fragment of length <italic>j</italic>, <italic>L</italic> is the maximum observed fragment length, <italic>f<sub>i</sub></italic>(<italic>j</italic>, <italic>L</italic>) = <sub>min</sub>(ℓ<italic><sub>i</sub></italic> − <italic>j</italic> + 1, <italic>L</italic>), 
<inline-formula><mml:math id="M16" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>+</mml:mo></mml:msup><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the score given to transcript <italic>t<sub>i</sub></italic>’s <italic>j</italic><sup>th</sup> position under the foreground, 5’ sequence-specific bias model (
<inline-formula><mml:math id="M17" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>-</mml:mo></mml:msup><mml:msup><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>+</mml:mo></mml:msup><mml:msup><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>b</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mo>-</mml:mo></mml:msup><mml:msup><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:msup></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> are defined similarly) and <italic>b</italic><sub><italic>gc</italic><sup>+</sup></sub> (<italic>t<sub>i</sub></italic>, <italic>j</italic>, <italic>j</italic> + <italic>k</italic>) is the score given by the foreground fragment GC-content model for the sequence of transcript <italic>t<sub>i</sub></italic> from position <italic>j</italic> to <italic>j</italic> + <italic>k</italic> (and similarly for <italic>b</italic><sub><italic>gc</italic><sup>−</sup></sub> (<italic>t<sub>i</sub></italic>, <italic>j</italic>, <italic>j</italic> + <italic>k</italic>)).</p>
        <p id="P64">Once these bias-corrected lengths have been computed, they are used in all subsequent rounds of the offline inference phase (i.e. until the estimates of <bold><italic>α</italic></bold> — as defined in <bold>Algorithms</bold> — converge). Typically, the extra computational cost required to apply bias correction is rather small, and the learning and application of these bias weights is parallelized in <italic>Salmon</italic> (for example, when processing sample 
<monospace>ERR188021</monospace> of the GEUVADIS dataset using 16 threads, the full fidelity bias modeling added 2 minutes (119 seconds) to the non-bias-corrected quantification time. Moreover, since the bias model works by evaluating the bias along bases of the reference transcriptome, it scales in the number of active (i.e., expressed) transcripts rather than in the number of reads, so the extra cost of bias modeling is almost entirely independent of the number of fragments in an experiment. However, both the memory and time requirements of bias correction can be adjusted by the user to trade-off time and space with model fidelity. To make the computation of GC-fractions efficient for arbitrary fragments from the transcriptome, <italic>Salmon</italic> computes and stores the cumulative GC count for each transcript. To reduce memory consumption, this cumulative count can be sampled using the 
<monospace>--gcSizeSamp</monospace>. This will increase the time required to compute the GC-fraction for each fragment by a constant factor. Similarly, when attempting to determine the effective length of a transcript, <italic>Salmon</italic> will evaluate the contribution of all fragments longer than the shortest 0.5% and shorter than the longest 0.5% of the full empirical fragment length distribution, that could derive from this transcript. The program option 
<monospace>--biasSpeedSamp</monospace> will instead sample fragment lengths at a user-defined factor, speeding up the computation of bias-corrected effective lengths by this factor, but coarsening the model in the process. However, sampling the fragment length distribution tends to produce substantial speed improvements with only a very moderate effect on the model fidelity. For example, setting 
<monospace>--biasSpeedSamp</monospace> to 5 reduces the additional bias correction time on sample ERR188021 mentioned above from 119 to 20 seconds, yet it leads to only a marginal increase in the number of false positive calls on the GEUVADIS data (from 1183 to 1190 total transcripts, 228 to 231 transcripts from two isoform genes, and it actually decreased the number of false positive calls at the gene level slightly from 455 to 451). All results reported in this manuscript where bias correction was included were run without either of these sampling options (i.e. using the full-fidelity model).</p>
      </sec>
      <sec id="S11">
        <title>Alignment model</title>
        <p id="P32">When <italic>Salmon</italic> is given read alignments as input, it can learn and apply a model of read alignments to help assess the probability that a fragment originated from a particular locus. Specifically, <italic>Salmon</italic>’s alignment model is a spatially varying first-order Markov model over the set of 
<monospace>CIGAR</monospace> symbols and nucleotides. To account for the fact that substitution and indel rates can vary spatially over the length of a read, we partition each read into a fixed number of bins and learn a separate model for each of these bins. This allows us to learn spatially varying effects without making the model itself too large (as if, for example, we had attempted to learn a separate model for each position in the read). We choose 4 bins by default since this allows different models for the beginning, middle, and trailing segments of a read, which tend to display distinct error profiles. However, we note that even a single, spatially homogeneous error profile appears to work reasonably well [<xref rid="R22" ref-type="bibr">22</xref>], and that given sufficient training data, it is even possible to learn a separate bin for each position of a read [<xref rid="R15" ref-type="bibr">15</xref>]. Given the 
<monospace>CIGAR</monospace> string <italic>s</italic> = <italic>s</italic><sub>0</sub>, … , <italic>s</italic><sub>|</sub><italic><sub>s</sub></italic><sub>|</sub> for an alignment <italic>a</italic>, we compute the probability of <italic>a</italic> as: 
<disp-formula id="FD10"><label>Equation 7</label><mml:math id="M18" display="block" overflow="scroll"><mml:mrow><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>a</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi><mml:mo>,</mml:mo><mml:mi>ℓ</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>o</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>∣</mml:mo><mml:mi>s</mml:mi><mml:mo>∣</mml:mo></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mo>Pr</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="script">M</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>→</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi><mml:mo>,</mml:mo><mml:mi>ℓ</mml:mi><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> where Pr{<italic>s</italic><sub>0</sub>} is the start probability and Pr<sub>(ℳ<sub><italic>k</italic></sub>}</sub>{·} is the transition probability under the model at the <italic>k</italic><sup>th</sup> position of the read (i.e., in the bin corresponding to position <italic>k</italic>). To compute these probabilities, <italic>Salmon</italic> parses the 
<monospace>CIGAR</monospace> string <italic>s</italic> and moves appropriately along both the fragment <italic>f<sub>i</sub></italic> and the reference transcript <italic>t<sub>i</sub></italic>, and computes the probability of transitioning to the next observed state in the alignment (a tuple consisting of the 
<monospace>CIGAR</monospace> operation, and the nucleotides in the fragment and reference) given the current state of the model. The parameters of this Markov model are learned from sampled alignments in the online phase of the algorithm (see <xref rid="SD1" ref-type="supplementary-material">Supplementary Algorithm 1</xref>). When quasi-mapping is used instead of user-provided alignments, the probability of the “alignment” is not taken into account (i.e. Pr{<italic>a</italic> | <italic>f<sub>j</sub></italic>, <italic>t<sub>i</sub></italic>, <italic>p</italic>, <italic>o</italic>, ℓ} is set to 1 for each mapping).</p>
      </sec>
      <sec id="S12">
        <title>Algorithms</title>
        <p id="P33">We describe the online and offline inference algorithms of <italic>Salmon</italic>, which together optimize the estimates of <bold><italic>α</italic></bold> — a vector of the estimated number of reads originating from each transcript. Given <bold><italic>α</italic></bold> the <bold><italic>η</italic></bold> can be directly computed. An overview of the <italic>Salmon</italic> execution “timeline”, which describes when, during the execution of the algorithm different estimates are made and quantities of interest are computed, is given in <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 1</xref>.</p>
      </sec>
      <sec id="S13">
        <title>Online phase</title>
        <p id="P34">The online phase of <italic>Salmon</italic> attempts to solve the variational Bayesian inference problem described in Objectives and models for abundance estimation, and optimizes a collapsed variational objective function [<xref rid="R21" ref-type="bibr">21</xref>] using a variant of stochastic collapsed variational Bayesian inference [<xref rid="R19" ref-type="bibr">19</xref>]. The inference procedure is a streaming algorithm, similar to [<xref rid="R15" ref-type="bibr">15</xref>], but it updates estimated read counts <bold><italic>α</italic></bold> after every small group <italic>B<sup>τ</sup></italic> (called a mini-batch) of observations, and processing of mini-batches is done asynchronously and in parallel. The pseudo-code for the algorithm is given in <xref rid="SD1" ref-type="supplementary-material">Supplementary Algorithm 1</xref>.</p>
        <p id="P35">The observation weight <italic>v<sup>τ</sup></italic> for mini-batch <italic>B<sup>τ</sup></italic>, in line 15 of <xref rid="SD1" ref-type="supplementary-material">Supplementary Algorithm 1</xref>, is an increasing sequence in <italic>τ</italic>, and is set, as in [<xref rid="R15" ref-type="bibr">15</xref>], to adhere to the Robbins-Monroe conditions. Here, the <bold><italic>α</italic></bold> represent the (weighted) estimated counts of fragments originating from each transcript. Using this method, the expected value of <bold><italic>η</italic></bold> can be computed directly from α using <xref rid="FD19" ref-type="disp-formula">equation (16)</xref>. We employ a weak Dirichlet conjugate-prior with <italic>α</italic><sub>0</sub> = 0.001 · ℓ̃<italic><sub>ι</sub></italic> for all <italic>t<sub>i</sub></italic> ∈ 𝒥. As outlined in [<xref rid="R19" ref-type="bibr">19</xref>], the SCVB0 inference algorithm is essentially equivalent to variants of the online-EM [<xref rid="R23" ref-type="bibr">23</xref>] algorithm with a modified prior. The procedure in <xref rid="SD1" ref-type="supplementary-material">Supplementary Algorithm 1</xref> is run independently by as many worker threads as the user has specified. The threads share a single work-queue upon which a parsing thread places mini-batches of alignment groups. An alignment group is simply the collection of all alignments (i.e. all multi-mapping locations) for a read. The mini-batch itself consists of a collection of some small, fixed number of alignment groups (1,000 by default). Each worker thread processes one alignment group at a time, using the current weights of each transcript and the current auxiliary parameters to estimate the probability that a read came from each potential transcript of origin. The processing of mini-batches occurs in parallel, so that very little synchronization is required, only an atomic compare-and-swap loop to update the global transcript weights at the end of processing of each mini-batch — hence the moniker laissez-faire in the label of <xref rid="SD1" ref-type="supplementary-material">Supplementary Algorithm 1</xref>. This lack of synchronization means that when estimating <italic>x<sub>y</sub></italic>, we cannot be certain that the most up-to-date values of <bold><italic>α</italic></bold> are being used. However, due to the stochastic and additive nature of the updates, this has little-to-no detrimental effect [<xref rid="R24" ref-type="bibr">24</xref>]. The inference procedure itself is generic over the type of alignments being processed; they may be either regular alignments (e.g. coming from a 
<monospace>bam</monospace> file), or quasi-mappings computed from the raw reads (e.g. coming from 
<monospace>FASTA/Q</monospace> files). After the entire mini-batch has been processed, the global weights for each transcript are updated. These updates are <italic>sparse</italic>; i.e., only transcripts that appeared in some alignment in mini-batch <italic>B<sup>τ</sup></italic> will have their global weight updated after <italic>B<sup>τ</sup></italic> has been processed. This ensures, as in [<xref rid="R15" ref-type="bibr">15</xref>], that updates to the parameters <bold><italic>α</italic></bold> can be performed efficiently.</p>
      </sec>
      <sec id="S14">
        <title>Equivalence classes</title>
        <p id="P36">During its online phase, in addition to performing streaming inference of transcript abundances, <italic>Salmon</italic> also constructs a highly-reduced representation of the sequencing experiment. Specifically, <italic>Salmon</italic> constructs “rich” equivalence classes over all the sequenced fragments. Collapsing fragments into equivalence classes is a well-established idea in the transcript quantification literature, and numerous different notions of equivalence classes have been previously introduced, and shown to greatly reduce the time required to perform iterative optimization such as that described in <bold>Offline phase</bold>. For example, Salzman et al. [<xref rid="R25" ref-type="bibr">25</xref>] suggested factorizing the likelihood function to speed up inference by collapsing fragments that align to the same exons or exon junctions (as determined by a provided annotation) into equivalence classes. Similarly, Nicolae et al.[<xref rid="R26" ref-type="bibr">26</xref>] used equivalence classes over fragments to reduce memory usage and speed up inference — they define as equivalent any pair of fragments that align to the same set of transcripts and whose compatibility weights (i.e. conditional probabilities) with respect to those transcripts are proportional. Turro et al. [<xref rid="R27" ref-type="bibr">27</xref>], introduced a notion of equivalence classes that considers as equivalent any pair of fragments (sequenced reads and read pairs) that multimap to the same set of target transcripts. The model of Turro et al. does not have the same restriction as that of Nicolae et al. on the proportional conditional probabilities of the equivalent fragments. Patro et al. [<xref rid="R9" ref-type="bibr">9</xref>] define equivalence classes over k-mers, treating as equivalent any k-mers that appear in the same set of transcripts at the same frequency, and use this factorization of the likelihood function to speed up optimization. Bray et al. [<xref rid="R10" ref-type="bibr">10</xref>] define equivalence classes over fragments, and define as equivalent any fragments that pseudoalign to the same set of transcripts, a definition which, like that of Turro et al., does not consider the conditional probabilities of the equivalent fragments with respect to the transcripts to which they map.</p>
        <p id="P37">To compute equivalence classes, we define an equivalence relation ~ over fragments. Let <italic>A</italic>(𝒥, <italic>f<sub>x</sub></italic>) denote the set of quasi-mappings (or alignments) of <italic>f<sub>x</sub></italic> to the transcriptome 𝒥, and let <italic>M</italic>(<italic>f<sub>x</sub></italic>) = {<italic>t<sub>i</sub></italic> | (<italic>t<sub>i</sub></italic>, <italic>p<sub>i</sub></italic>, <italic>o<sub>i</sub></italic>) ∈ A(𝒥, <italic>f<sub>x</sub></italic>)} be the set of transcripts to which <italic>f<sub>x</sub></italic> maps according to <italic>A</italic>(𝒥, <italic>f<sub>x</sub></italic>). We say <italic>f<sub>x</sub></italic> ~ <italic>f<sub>y</sub></italic> if and only if <italic>M</italic>(<italic>f<sub>x</sub></italic>) = <italic>M</italic>(<italic>f<sub>y</sub></italic>). Fragments which are equivalent are grouped together for inference. <italic>Salmon</italic> builds up a set of fragment-level equivalence classes by maintaining an efficient concurrent cuckoo hash map [<xref rid="R28" ref-type="bibr">28</xref>]. To construct this map, we associate each fragment <italic>f<sub>x</sub></italic> with <bold><italic>t</italic></bold><italic><sup>x</sup></italic> = <italic>M</italic>(<italic>f<sub>x</sub></italic>), which we will call the label of the fragment. Then, we query the hash map for <bold><italic>t</italic></bold><italic><sup>x</sup></italic>. If this key is not in the map, we create a new equivalence class with this label, and set its count to 1. Otherwise, we increment the count of the equivalence class that we find in the map with this label. The efficient, concurrent nature of the data structure means that many threads can simultaneously query and write to the map while encountering very little contention. Each key in the hash map is associated with a value that we call a “rich” equivalence class. For each equivalence class 𝒞<italic><sup>j</sup></italic>, we retain a count <italic>d<sup>j</sup></italic> = |𝒞<italic><sup>j</sup></italic>|, which is the total number of fragments contained within this class. We also maintain, for each class, a weight vector <italic>w<sup>j</sup></italic>. The entries of this vector are in one-to-one correspondence with transcripts <italic>i</italic> in the label of this equivalence class such that</p>
        <disp-formula id="FD11">
          <label>Equation 8</label>
          <mml:math id="M19" display="block" overflow="scroll">
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>w</mml:mi>
                <mml:mi>i</mml:mi>
                <mml:mi>j</mml:mi>
              </mml:msubsup>
              <mml:mo>=</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msub>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>f</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:msup>
                        <mml:mi mathvariant="script">C</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:msup>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:mo>Pr</mml:mo>
                    <mml:mo stretchy="false">{</mml:mo>
                    <mml:mi>f</mml:mi>
                    <mml:mo>∣</mml:mo>
                    <mml:msub>
                      <mml:mi>t</mml:mi>
                      <mml:mi>i</mml:mi>
                    </mml:msub>
                    <mml:mo stretchy="false">}</mml:mo>
                  </mml:mrow>
                </mml:mrow>
                <mml:mrow>
                  <mml:msub>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>k</mml:mi>
                      </mml:msub>
                      <mml:mo>∈</mml:mo>
                      <mml:msup>
                        <mml:mi mathvariant="bold-italic">t</mml:mi>
                        <mml:mi mathvariant="bold-italic">j</mml:mi>
                      </mml:msup>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mo>∑</mml:mo>
                      <mml:mrow>
                        <mml:mi>f</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:msup>
                          <mml:mi mathvariant="script">C</mml:mi>
                          <mml:mi>j</mml:mi>
                        </mml:msup>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mrow>
                      <mml:mo>Pr</mml:mo>
                      <mml:mo stretchy="false">{</mml:mo>
                      <mml:mi>f</mml:mi>
                      <mml:mo>∣</mml:mo>
                      <mml:msub>
                        <mml:mi>t</mml:mi>
                        <mml:mi>i</mml:mi>
                      </mml:msub>
                      <mml:mo stretchy="false">}</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mrow>
              </mml:mfrac>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
        <p id="P38">That is, 
<inline-formula><mml:math id="M20" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> is the average conditional probability of observing a fragment from 𝒞<italic><sup>j</sup></italic> given <italic>t<sub>i</sub></italic> over all fragments in this equivalence class. Though the likelihood function over equivalence classes that considers these weights (<xref rid="FD13" ref-type="disp-formula">Equation (10)</xref>) is no longer exactly equivalent to the likelihood defined over all fragments (<xref rid="FD12" ref-type="disp-formula">Equation (9)</xref>), these weights nonetheless allow us to take into consideration the conditional probabilities specified in the full model, without having to continuously reconsider each of the fragments in ℱ. There is a spectrum of possible representations of “rich” equivalence classes. This spectrum spans from the notion adopted here, which collapses all conditional probabilities into a single aggregate scalar, to an approach that clusters together fragments based not only on the transcripts to which they match, but on the vector of normalized conditional probabilities for each of these transcripts. The former approach represents a more coarse-grained approximate factorization of the likelihood function while the latter represents a more fine-grained approximation. We believe that studying how these different notions of equivalence classes affect the factorization of the likelihood function, and hence its optimization, is an interesting direction for future work.</p>
      </sec>
      <sec id="S15">
        <title>Offline Phase</title>
        <p id="P39">In its offline phase, which follows the online phase, <italic>Salmon</italic> uses the “rich” equivalence classes learned during the online phase to refine the inference. Given the set 𝒞 of rich equivalence classes of fragments, we can use an expectation maximization (EM) algorithm to optimize the likelihood of the parameters given the data. The abundances <bold><italic>η</italic></bold> can be computed directly from <bold><italic>α</italic></bold>, and we compute maximum likelihood estimates of these parameters which represent the estimated counts (i.e., number of fragments) deriving from each transcript, where: 
<disp-formula id="FD12"><label>Equation 9</label><mml:math id="M21" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">L</mml:mi><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="bold-italic">α</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="script">F</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">J</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi>η</mml:mi><mml:mi>ι</mml:mi></mml:msub><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo>Pr</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula> and 
<inline-formula><mml:math id="M22" display="inline" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi>η</mml:mi><mml:mi>ι</mml:mi></mml:msub><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mstyle scriptlevel="1"><mml:mfrac><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi>α</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:math></inline-formula>. If we write this same likelihood in terms of the equivalence classes 𝒞, we have: 
<disp-formula id="FD13"><label>Equation 10</label><mml:math id="M23" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">L</mml:mi><mml:mo stretchy="false">{</mml:mo><mml:mi mathvariant="bold-italic">α</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="script">F</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">J</mml:mi><mml:mo stretchy="false">}</mml:mo><mml:mo>≈</mml:mo><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="script">C</mml:mi><mml:mi>j</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="script">C</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="bold-italic">t</mml:mi><mml:mi>j</mml:mi></mml:msup></mml:mrow></mml:munder><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi>η</mml:mi><mml:mi>ι</mml:mi></mml:msub><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mspace width="0.16667em"/><mml:msubsup><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:msubsup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>d</mml:mi><mml:mi>j</mml:mi></mml:msup></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
        <p id="P40">This likelihood, and hence that represented in <xref rid="FD12" ref-type="disp-formula">equation (9)</xref>, can then be optimized by applying the following update equation iteratively</p>
        <disp-formula id="FD14">
          <label>Equation 11</label>
          <mml:math id="M24" display="block" overflow="scroll">
            <mml:mrow>
              <mml:msubsup>
                <mml:mi>α</mml:mi>
                <mml:mi>i</mml:mi>
                <mml:mrow>
                  <mml:mi>u</mml:mi>
                  <mml:mo>+</mml:mo>
                  <mml:mn>1</mml:mn>
                </mml:mrow>
              </mml:msubsup>
              <mml:mo>=</mml:mo>
              <mml:msub>
                <mml:mo>∑</mml:mo>
                <mml:mrow>
                  <mml:msup>
                    <mml:mi mathvariant="script">C</mml:mi>
                    <mml:mi>j</mml:mi>
                  </mml:msup>
                  <mml:mo>∈</mml:mo>
                  <mml:mi mathvariant="script">C</mml:mi>
                </mml:mrow>
              </mml:msub>
              <mml:mrow>
                <mml:msup>
                  <mml:mi>d</mml:mi>
                  <mml:mi>j</mml:mi>
                </mml:msup>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mfrac>
                    <mml:mrow>
                      <mml:msubsup>
                        <mml:mi>α</mml:mi>
                        <mml:mi>i</mml:mi>
                        <mml:mi>u</mml:mi>
                      </mml:msubsup>
                      <mml:msubsup>
                        <mml:mi>w</mml:mi>
                        <mml:mi>i</mml:mi>
                        <mml:mi>j</mml:mi>
                      </mml:msubsup>
                    </mml:mrow>
                    <mml:mrow>
                      <mml:msub>
                        <mml:mo>∑</mml:mo>
                        <mml:mrow>
                          <mml:msub>
                            <mml:mi>t</mml:mi>
                            <mml:mi>k</mml:mi>
                          </mml:msub>
                          <mml:mo>∈</mml:mo>
                          <mml:msup>
                            <mml:mi mathvariant="bold-italic">t</mml:mi>
                            <mml:mi>j</mml:mi>
                          </mml:msup>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mrow>
                        <mml:msubsup>
                          <mml:mi>a</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mi>u</mml:mi>
                        </mml:msubsup>
                        <mml:msubsup>
                          <mml:mi>w</mml:mi>
                          <mml:mi>k</mml:mi>
                          <mml:mi>j</mml:mi>
                        </mml:msubsup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:mfrac>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
        <p id="P41">We apply this update equation until the maximum relative difference in the <bold><italic>α</italic></bold> parameters satisfies: 
<disp-formula id="FD15"><label>Equation 12</label><mml:math id="M25" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">Δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>α</mml:mi><mml:mi>u</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>α</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>max</mml:mo><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mi>u</mml:mi></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>∣</mml:mo></mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula> for all 
<inline-formula><mml:math id="M26" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. Let <bold><italic>α</italic></bold>′ be the estimates after having achieved convergence. We can then estimate <italic>η<sub>i</sub></italic> by 
<inline-formula><mml:math id="M27" display="inline" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi>η</mml:mi><mml:mi>ι</mml:mi></mml:msub><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>, where: 
<disp-formula id="FD16"><label>Equation 13</label><mml:math id="M28" display="block" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi>η</mml:mi><mml:mi>ι</mml:mi></mml:msub><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:msubsup><mml:mi>α</mml:mi><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      </sec>
      <sec id="S16">
        <title>Variational Bayes optimization</title>
        <p id="P42">Instead of the standard EM updates of <xref rid="FD14" ref-type="disp-formula">equation (11)</xref>, we can, optionally, perform Variational Bayesian optimization by applying VBEM updates as in [<xref rid="R22" ref-type="bibr">22</xref>], but adapted to be with respect to the equivalence classes: 
<disp-formula id="FD17"><label>Equation 14</label><mml:math id="M29" display="block" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="script">C</mml:mi><mml:mi>j</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="bold-script">C</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mi>d</mml:mi><mml:mi>j</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:msubsup><mml:mi>γ</mml:mi><mml:mi>i</mml:mi><mml:mi>u</mml:mi></mml:msubsup></mml:msup><mml:msubsup><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="bold-italic">t</mml:mi><mml:mi>j</mml:mi></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:msubsup><mml:mi>γ</mml:mi><mml:mi>k</mml:mi><mml:mi>u</mml:mi></mml:msubsup></mml:msup><mml:msubsup><mml:mi>w</mml:mi><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msubsup></mml:mrow></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where: 
<disp-formula id="FD18"><label>Equation 15</label><mml:math id="M30" display="block" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>γ</mml:mi><mml:mi>i</mml:mi><mml:mi>u</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Ψ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mi>u</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>-</mml:mo><mml:mi mathvariant="normal">Ψ</mml:mi><mml:mspace width="0.16667em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>∑</mml:mo><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>a</mml:mi><mml:mi>k</mml:mi><mml:mi>u</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
        <p id="P43">Here, Ψ(·) is the digamma function, and, upon convergence of the parameters, we can obtain an estimate of the expected value of the posterior nucleotide fractions as: 
<disp-formula id="FD19"><label>Equation 16</label><mml:math id="M31" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mi>η</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:msubsup><mml:mi>α</mml:mi><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where 
<inline-formula><mml:math id="M32" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>. Variational Bayesian optimization in the offline-phase of <italic>Salmon</italic> is selected by passing the 
<monospace>--useVBOpt</monospace> flag to the <italic>Salmon</italic>
<monospace>quant</monospace> command.</p>
      </sec>
      <sec id="S17">
        <title>Sampling from the posterior</title>
        <p id="P44">After the convergence of the parameter estimates has been achieved in the offline phase, it is possible to draw samples from the posterior distribution using Gibbs sampling to sample, in turn, from the transcript abundances given the fragment assignments, and then to re-assign the fragments within each equivalence class given these abundances. To perform this Gibbs sampling, we adopt the model of Turro et al. [<xref rid="R27" ref-type="bibr">27</xref>] (details in <xref rid="SD1" ref-type="supplementary-material">Supplementary Note 2</xref>).</p>
        <p id="P45">Additionally, inspired by <italic>kallisto</italic> [<xref rid="R10" ref-type="bibr">10</xref>], <italic>Salmon</italic> also provides the ability to draw bootstrap samples, which is an alternative way to assign confidence to the estimates returned by the main inference algorithm. Bootstrap samples can be drawn by passing the 
<monospace>--numBootstraps</monospace> option to <italic>Salmon</italic> with the argument determining the number of bootstraps to perform. The bootstrap sampling process works by sampling (with replacement) counts for each equivalence class, and then re-running the offline inference procedure (either the EM or VBEM algorithm) for each bootstrap sample.</p>
      </sec>
    </sec>
    <sec id="S18">
      <title>Validation</title>
      <sec id="S19">
        <title>Metrics for Accuracy</title>
        <p id="P46">Throughout this paper, we use several different metrics to summarize the agreement of the estimated TPM for each transcript with the TPM computed from simulated counts. While most of these metrics are commonly used and self-explanatory, we here describe the computation of the mean absolute relative difference (MARD), which is less common than some of the other metrics.</p>
        <p id="P47">The MARD is computed using the absolute relative difference ARD<sub>i</sub> for each transcript <italic>i</italic>: 
<disp-formula id="FD20"><label>Equation 17</label><mml:math id="M33" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mtext>ARD</mml:mtext><mml:mi mathvariant="normal">i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="center"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="0.16667em"/><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mtd><mml:mtd columnalign="center"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>x<sub>i</sub></italic> is the true value of the TPM, and <italic>y<sub>i</sub></italic> is the estimated TPM. The relative difference is bounded above by 1, and takes on a value of 0 whenever the prediction perfectly matches the truth. To compute the mean absolute relative difference, we simply take 
<inline-formula><mml:math id="M34" display="inline" overflow="scroll"><mml:mrow><mml:mtext>MARD</mml:mtext><mml:mo>=</mml:mo><mml:mstyle scriptlevel="1"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac></mml:mstyle><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:msub><mml:mtext>ARD</mml:mtext><mml:mi mathvariant="normal">i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. We note that <italic>Salmon</italic> and <italic>kallisto</italic>, by default, truncate very tiny expression values to 0. For example, any transcript estimated to produce &lt; 1 × 10<sup>−8</sup> reads is assigned an estimated read count of 0 (which, likewise, affects the TPM estimates). However, <italic>eXpress</italic> does not perform such a truncation, and very small, non-zero values may have a negative effect on the MARD metric. To mitigate such effects, we first truncate to 0 all TPMs less than 0.01 before computing the MARDs.</p>
      </sec>
      <sec id="S20">
        <title>Ground truth simulated data</title>
        <p id="P48">To assess accuracy in a situation where the true expression levels are known, we generate synthetic data sets using both <italic>Polyester</italic> [<xref rid="R13" ref-type="bibr">13</xref>] and <italic>RSEM-sim</italic> [<xref rid="R14" ref-type="bibr">14</xref>].</p>
        <sec id="S21">
          <title><italic>RSEM</italic>-sim simulations</title>
          <p id="P49">To generate data with <italic>RSEM-sim</italic>, we follow the procedure used in [<xref rid="R10" ref-type="bibr">10</xref>]. <italic>RSEM</italic> was run on sample 
<monospace>NA12716_7</monospace> from the GEUVADIS RNA-seq data to learn model parameters and estimate true expression, and the learned model was then used to generate 20 different simulated datasets, each consisting of 30 million 75 bp paired-end reads.</p>
        </sec>
        <sec id="S22">
          <title>Polyester simulations</title>
          <p id="P50">In addition to the ability to generate reads, <italic>Polyester</italic> allows simulating experiments with differential transcript expression and biological variability. Thus, we can assess not only the accuracy of the resulting estimates, but also how these estimates would perform in a typical downstream analysis task like differential expression testing.</p>
          <p id="P51">The <italic>Polyester</italic> simulation of an RNA-seq experiment with empirically-derived fragment GC bias was created as follows: The transcript abundance quantifications from <italic>RSEM</italic> run on 
<monospace>NA12716_7</monospace> of the GEUVADIS RNA-seq data [<xref rid="R11" ref-type="bibr">11</xref>] were summed to the gene-level using version 75 of the Ensembl gene annotation for GRCh37. Subsequently, whole-transcriptome simulation was carried out using <italic>Polyester</italic>. Abundance (TPMs) was allocated to isoforms within a gene randomly using the following rule: for genes with two isoforms, TPMs were either (i) split according to a flat Dirichlet distribution (<italic>α</italic> = (1,1)) or (ii) attributed to a single isoform. The choice of (i) vs (ii) was decided by a Bernoulli trial with probability 0.5. For genes with three or more isoforms, TPMs were either (i) split among three randomly chosen isoforms according to a flat Dirichlet distribution (<italic>α</italic> = (1,1,1)) or (ii) attributed to a single isoform. Again, (i) vs (ii) was decided by a Bernoulli trial with probability 0.5. The choice of distributing expression among three isoforms was motivated by exploratory data analysis of estimated transcript abundance revealing that for most genes nearly all of expression was concentrated in the first three isoforms for genes with four or more isoforms.</p>
          <p id="P52">Expected counts for each transcript were then generated according to the transcript-level TPMs, multiplied by the transcript lengths. 40 million 100bp paired-end reads were simulated using the <italic>Polyester</italic> software for each of 16 samples, and 10% of transcripts were chosen to be differentially expressed across an 8 vs 8 sample split. The fold change was chosen to be either 
<inline-formula><mml:math id="M35" display="inline" overflow="scroll"><mml:mrow><mml:mstyle scriptlevel="1"><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mstyle></mml:mrow></mml:math></inline-formula> or 2 with probability of 0.5. Fragments were down-sampled with Bernoulli trials according to an empirically-derived fragment GC content dependence estimated with <italic>alpine</italic> [<xref rid="R5" ref-type="bibr">5</xref>] on RNA-seq samples from the GEUVADIS project. The first 8 GEUVADIS samples exhibited weak GC content dependence while the last 8 samples exhibited more severe fragment-level GC bias. Paired-end fragments were then shuffled before being supplied to transcript abundance quantifiers. Estimated expression was compared to true expression calculated on transcript counts (before these counts were down-sampled according to the empirically-derived fragment GC bias curve), divided by effective transcript length and scaled to TPM. Global differences across condition for all methods were removed using a scaling factor per condition. Differences across condition for the different methods’ quantifications were tested using a t-test of log<sub>2</sub> (TPM + 1).</p>
        </sec>
      </sec>
      <sec id="S23">
        <title>Software versions and options</title>
        <p id="P53">All tests were performed with <italic>eXpress</italic> v1.5.1, <italic>kallisto</italic> v0.43.0, <italic>Salmon</italic> v0.8.0 and <italic>Bowtie2</italic> v2.2.4. Reads were aligned with <italic>Bowtie2</italic> using the parameters 
<monospace>--no-discordant -k 200</monospace>, and 
<monospace>-p</monospace> to set the number of threads. On the <italic>RSEM-sim</italic> data, all methods were run without bias correction. On all other datasests, methods were run with bias correction unless otherwise noted. Additionally, on the <italic>Polyester</italic> simulated data, <italic>Salmon</italic> was run with the option 
<monospace>--noBiasLengthThreshold</monospace>, which allows bias correction, even for very short transcripts, since we were most interested in assessing the maximum sensitivity of the model.</p>
      </sec>
      <sec id="S24">
        <title>GEUVADIS data</title>
        <p id="P54">The analyses presented in <xref rid="F1" ref-type="fig">Fig. 1d</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Table 1</xref> and <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 5</xref> were carried out on a subset of 30 samples from the publicly-available GEUVADIS [<xref rid="R11" ref-type="bibr">11</xref>] data. The accessions used and the information about the center at which the libraries were prepared and sequenced is recorded in <xref rid="SD1" ref-type="supplementary-material">Supplementary Table 3</xref>. All methods were run with bias correction enabled, using a transcriptome built with the RefSeq gene annotation file and the genome FASTA contained within the hg19 Illumina iGenome, to allow for comparison with the results in [<xref rid="R5" ref-type="bibr">5</xref>].</p>
        <p id="P55">For each transcript, a t-test was performed, comparing log<sub>2</sub> (TPM + 1) from 15 samples from one sequencing center against 15 samples from another sequencing center. P values were then adjusted using the method of Benjamini-Hochberg, over the transcripts with mean TPM &gt; 0.1. The number of positives for given false discovery rates was then reported for each method, by taking the number of transcripts with adjusted p value less than a given threshold.</p>
        <p id="P56">Because the samples are from the same human population, it is expected that there would be few to no true differences in transcript abundance produced by this comparison. This assumption was confirmed by permuting the samples and performing t-tests as well as making t-test comparisons of random subsets within sequencing center, which consistently produced ≪ 1 DE transcript on average for all methods. Such an analysis comparing samples across sequencing center was specifically chosen to highlight transcripts with false quantification differences arising from technical artifacts.</p>
      </sec>
      <sec id="S25">
        <title>SEQC data</title>
        <p id="P57">The consistency analysis presented in <xref rid="SD2" ref-type="supplementary-material">Supplementary Fig. 4</xref> was carried out on a subset of the publicly-available SEQC [<xref rid="R12" ref-type="bibr">12</xref>] data. Specifically, the accessions used, along with the corresponding information about the center at which they were sequences is recorded in <xref rid="SD1" ref-type="supplementary-material">Supplementary Table 4</xref>. For each sample, “same center” comparisons were made between all unique pairs of replicates labeled as coming from the same sequencing center, while “different center” comparisons were made between all unique pairs of replicates labeled as coming from different centers (“Center” column of <xref rid="SD1" ref-type="supplementary-material">Supplementary Table 4</xref>).</p>
      </sec>
      <sec id="S26" sec-type="results">
        <title>Statistics</title>
        <p id="P58">Comparisons of <italic>RSEM-sim</italic> simulated data mean absolute relative differences (MARD) and Spearman correlations had sample sizes <italic>n</italic><sub>1</sub> = 20, <italic>n</italic><sub>2</sub> = 20. A Mann-Whitney U test (two-sided) was performed. Dominant isoform switching on GEUVADIS data had sample sizes <italic>n</italic><sub>1</sub> = 15, <italic>n</italic><sub>2</sub> = 15. A t-test (two-sided) was performed. <italic>Polyester</italic> simulated data differential expression analysis had sample sizes <italic>n</italic><sub>1</sub> = 8, <italic>n</italic><sub>2</sub> = 8. A t-test (two-sided) was performed. FDR sets were defined using Benjamini-Hochberg multiple test correction.</p>
      </sec>
      <sec id="S27">
        <title><italic>Salmon</italic> development, support and validation</title>
        <p id="P59"><italic>Salmon</italic> is developed openly on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/COMBINE-lab/Salmon">https://github.com/COMBINE-lab/Salmon</ext-link>), which is the primary venue for users to make feature requests and to file bug reports. However, support is also provided via a Google Users Group (<ext-link ext-link-type="uri" xlink:href="https://groups.google.com/forum/#!forum/Sailfish-users">https://groups.google.com/forum/#!forum/Sailfish-users</ext-link>) and a gitter channel (<ext-link ext-link-type="uri" xlink:href="https://gitter.im/COMBINE-lab/Salmon">https://gitter.im/COMBINE-lab/Salmon</ext-link>). This provides multiple venues for users to have questions answered quickly and efficiently. Further, <italic>Salmon</italic> is available through both homebrew-science [<xref rid="R29" ref-type="bibr">29</xref>] and bioconda to ease installation and upgrading of the package.</p>
        <p id="P60">Testing during the <italic>Salmon</italic> development and release process is highly-automated. In addition to any major feature branches, the <italic>Salmon</italic> repository retains both a master and develop branch. The master branch corresponds to the most recent tagged release of the software, while the develop branch is where new feature development takes place before they have been sufficiently well-tested to be included in a tagged release. A publicly-facing continuous integration service (Travis-CI) automatically builds each commit, and runs a small set of functionality tests to ensure that no breaking changes have been committed. However, these tests do not assess or track quantification accuracy. For this task, a parallel, self-hosted continuous integration system has been created. On each commit to the <italic>Salmon</italic> repository, a Drone (Drone-CI) server pulls the latest commit, and builds it in a clean CentOS5 environment using Docker [<xref rid="R30" ref-type="bibr">30</xref>]. In addition to the functionality tests, <italic>Salmon</italic> is run on simulated samples (generated using Polyester [<xref rid="R13" ref-type="bibr">13</xref>]). These test (automated using Next Flow [<xref rid="R31" ref-type="bibr">31</xref>]), build the <italic>Salmon</italic> index, quantify all of the simulated samples, and store the resulting accuracy metrics in a JSON formatted file. These results are copied back from the Docker container to the host, and are placed in a uniquely-named directory that corresponds with the SHA1 hash of the commit that produced them. This allows us to track accuracy over various <italic>Salmon</italic> commits, and to identify the commit corresponding to any performance regressions. We note that this setup overlaps considerably with the setup suggested for “continuous analysis” by Beaulieu-Jones and Greene [<xref rid="R32" ref-type="bibr">32</xref>]. Going forward, we anticipate expanding the test suite to include even more data and performance metrics.</p>
      </sec>
      <sec id="S28">
        <title>Data availability</title>
        <p id="P61">Accession information for experimental data used in this manuscript have been provided in the text and in <xref rid="SD1" ref-type="supplementary-material">Supplementary Tables 3 and 4</xref>. Simulated data has been carried out in accordance with the procedures detailed in <bold>Ground truth simulated data</bold>.</p>
      </sec>
      <sec id="S29">
        <title>Code availability</title>
        <p id="P62">The source code for <italic>Salmon</italic> is freely available, and licensed under the GNU General Public License (GPLv3). The latest version of <italic>Salmon</italic> can be obtained from <ext-link ext-link-type="uri" xlink:href="https://github.com/COMBINE-lab/salmon">https://github.com/COMBINE-lab/salmon</ext-link>.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="S30">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>1</label>
      <media xlink:href="NIHMS849351-supplement-1.doc" orientation="portrait" xlink:type="simple" id="d36e4390" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>2</label>
      <media xlink:href="NIHMS849351-supplement-2.pdf" orientation="portrait" xlink:type="simple" id="d36e4394" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S31">
    <p>This research is funded in part by the Gordon and Betty Moore Foundation’s Data-Driven Discovery Initiative through Grant GBMF4554 to C.K. It is partially funded by the US National Science Foundation (CCF-1256087, CCF-1319998, BBSRC-NSF/BIO-1564917) and the US National Institutes of Health (R21HG006913, R01HG007104). C.K. received support as an Alfred P. Sloan Research Fellow. This work was partially completed while G.D. was a postdoctoral fellow in the Computational Biology Department at Carnegie Mellon University. M.L. was supported by NIH grant 5T32CA009337-35. R.I. was supported by NIH R01 grant HG005220. We wish to thank those who have been using and providing feedback on <italic>Salmon</italic> since early in its (open) development cycle. The software has been greatly improved in many ways based on their feedback.</p>
  </ack>
  <fn-group>
    <fn id="FN6" fn-type="con">
      <p><bold>Author Contributions:</bold> R.P. and C.K. designed the method, which was implemented by R.P. R.P., G.D., M.L., R.I. and C.K. designed the experiments and R.P., G.D. and M.L. conducted the experiments. R.P., G.D., M.L., R.I. and C.K. wrote the manuscript.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoadley</surname>
            <given-names>KA</given-names>
          </name>
          <name>
            <surname>Yau</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>DM</given-names>
          </name>
          <name>
            <surname>Cherniack</surname>
            <given-names>AD</given-names>
          </name>
          <name>
            <surname>Tamborero</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Ng</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Leiserson</surname>
            <given-names>MDM</given-names>
          </name>
          <name>
            <surname>Niu</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>McLellan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Uzunangelov</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplatform analysis of 12 cancer types reveals molecular classification within and across tissues of origin</article-title>
        <source>Cell</source>
        <volume>158</volume>
        <fpage>929</fpage>
        <lpage>944</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">25109877</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Bickel</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>SE</given-names>
          </name>
        </person-group>
        <article-title>Comparison of D. melanogaster and C. elegans developmental stages, tissues, and cells by modENCODE RNA-seq data</article-title>
        <source>Genome Research</source>
        <volume>24</volume>
        <fpage>1086</fpage>
        <lpage>1101</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24985912</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weinstein</surname>
            <given-names>JN</given-names>
          </name>
          <name>
            <surname>Collisson</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Mills</surname>
            <given-names>GB</given-names>
          </name>
          <name>
            <surname>Shaw</surname>
            <given-names>KRM</given-names>
          </name>
          <name>
            <surname>Ozenberger</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Ellrott</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Shmulevich</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Sander</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Stuart</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Network</surname>
            <given-names>CGAR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cancer genome atlas pan-cancer analysis project</article-title>
        <source>Nature Genetics</source>
        <volume>45</volume>
        <fpage>1113</fpage>
        <lpage>1120</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">24071849</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roberts</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Donaghey</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rinn</surname>
            <given-names>JL</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improving RNA-Seq expression estimates by correcting for fragment bias</article-title>
        <source>Genome Biology</source>
        <volume>12</volume>
        <fpage>R22</fpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21410973</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Love</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Hogenesch</surname>
            <given-names>JB</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Modeling of RNA-seq fragment sequence bias reduces systematic errors in transcript abundance estimation</article-title>
        <source>Nature Biotechnology</source>
        <volume>AOP</volume>
        <year>2016</year>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morán</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Akerman</surname>
            <given-names>İ</given-names>
          </name>
          <name>
            <surname>van de Bunt</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Benazra</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Nammo</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Arnes</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Nakić</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Garćıa-Hurtado</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rodríiguez-Seguí</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Human β cell transcriptome analysis uncovers lncRNAs that are tissue-specific, dynamically regulated, and abnormally expressed in type 2 diabetes</article-title>
        <source>Cell Metabolism</source>
        <volume>16</volume>
        <fpage>435</fpage>
        <lpage>448</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">23040067</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Teng</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Love</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Davis</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Djebali</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Dobin</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Graveley</surname>
            <given-names>BR</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Mason</surname>
            <given-names>CE</given-names>
          </name>
          <name>
            <surname>Olson</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Pervouchine</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A benchmark for RNA-seq quantification pipelines</article-title>
        <source>Genome Biology</source>
        <volume>17</volume>
        <fpage>74</fpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27107712</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kodama</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Shumway</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Leinonen</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>The Sequence Read Archive: explosive growth of sequencing data</article-title>
        <source>Nucleic Acids Research</source>
        <volume>40</volume>
        <fpage>D54</fpage>
        <lpage>D56</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">22009675</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Patro</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Mount</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Kingsford</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Sailfish enables alignment-free isoform quantification from RNA-seq reads using lightweight algorithms</article-title>
        <source>Nature Biotechnology</source>
        <volume>32</volume>
        <fpage>462</fpage>
        <lpage>464</lpage>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bray</surname>
            <given-names>NL</given-names>
          </name>
          <name>
            <surname>Pimentel</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Melsted</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Near-optimal probabilistic RNA-seq quantification</article-title>
        <source>Nature Biotechnology</source>
        <volume>34</volume>
        <fpage>525</fpage>
        <lpage>527</lpage>
        <year>2016</year>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lappalainen</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Sammeth</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Friedländer</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>’t Hoen</surname>
            <given-names>PAC</given-names>
          </name>
          <name>
            <surname>Monlong</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rivas</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Gonzàlez-Porta</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kurbatova</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Griebel</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ferreira</surname>
            <given-names>PG</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome and genome sequencing uncovers functional variation in humans</article-title>
        <source>Nature</source>
        <volume>501</volume>
        <fpage>506</fpage>
        <lpage>511</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">24037378</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <collab>SEQC/MAQ-III Consortium et al</collab>
        <article-title>A comprehensive assessment of RNA-seq accuracy, reproducibility and information content by the Sequencing Quality Control Consortium</article-title>
        <source>Nature Biotechnology</source>
        <volume>32</volume>
        <fpage>903</fpage>
        <lpage>914</lpage>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Frazee</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Jaffe</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Leek</surname>
            <given-names>JT</given-names>
          </name>
        </person-group>
        <article-title>Polyester: simulating RNA-seq datasets with differential transcript expression</article-title>
        <source>Bioinformatics</source>
        <volume>31</volume>
        <fpage>2778</fpage>
        <lpage>2784</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">25926345</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Ruotti</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Stewart</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Thomson</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Dewey</surname>
            <given-names>CN</given-names>
          </name>
        </person-group>
        <article-title>RNA-Seq gene expression estimation with read mapping uncertainty</article-title>
        <source>Bioinformatics</source>
        <volume>26</volume>
        <fpage>493</fpage>
        <lpage>500</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20022975</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roberts</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Streaming fragment assignment for real-time analysis of sequencing experiments</article-title>
        <source>Nature Methods</source>
        <volume>10</volume>
        <fpage>71</fpage>
        <lpage>73</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23160280</pub-id>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Fast gapped-read alignment with Bowtie 2</article-title>
        <source>Nature Methods</source>
        <volume>9</volume>
        <fpage>357</fpage>
        <lpage>359</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">22388286</pub-id>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Srivastava</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Sarkar</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Gupta</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Patro</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>RapMap: a rapid, sensitive and accurate tool for mapping RNA-seq reads to transcriptomes</article-title>
        <source>Bioinformatics</source>
        <volume>32</volume>
        <fpage>i192</fpage>
        <lpage>i200</lpage>
        <year>2016</year>
        <pub-id pub-id-type="pmid">27307617</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>’t Hoen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Peter</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Friedländer</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Almlöf</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Sammeth</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pulyakhina</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Anvar</surname>
            <given-names>SY</given-names>
          </name>
          <name>
            <surname>Laros</surname>
            <given-names>JFJ</given-names>
          </name>
          <name>
            <surname>Buermans</surname>
            <given-names>HPJ</given-names>
          </name>
          <name>
            <surname>Karlberg</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Brännvall</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reproducibility of high-throughput mRNA and small RNA sequencing across laboratories</article-title>
        <source>Nature Biotechnology</source>
        <volume>31</volume>
        <fpage>1015</fpage>
        <lpage>1022</lpage>
        <year>2013</year>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Foulds</surname>
            <given-names>James</given-names>
          </name>
          <name>
            <surname>Boyles</surname>
            <given-names>Levi</given-names>
          </name>
          <name>
            <surname>DuBois</surname>
            <given-names>Christopher</given-names>
          </name>
          <name>
            <surname>Smyth</surname>
            <given-names>Padhraic</given-names>
          </name>
          <name>
            <surname>Welling</surname>
            <given-names>Max</given-names>
          </name>
        </person-group>
        <article-title>Stochastic collapsed variational Bayesian inference for latent Dirichlet allocation</article-title>
        <conf-name>Proceedings of the 19th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining</conf-name>
        <fpage>446</fpage>
        <lpage>454</lpage>
        <publisher-name>ACM</publisher-name>
        <year>2013</year>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Bishop</surname>
            <given-names>Christopher M</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Pattern Recognition and Machine Learning</source>
        <volume>4</volume>
        <publisher-name>Springer</publisher-name>
        <publisher-loc>New York</publisher-loc>
        <year>2006</year>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hensman</surname>
            <given-names>James</given-names>
          </name>
          <name>
            <surname>Papastamoulis</surname>
            <given-names>Panagiotis</given-names>
          </name>
          <name>
            <surname>Glaus</surname>
            <given-names>Peter</given-names>
          </name>
          <name>
            <surname>Honkela</surname>
            <given-names>Antti</given-names>
          </name>
          <name>
            <surname>Rattray</surname>
            <given-names>Magnus</given-names>
          </name>
        </person-group>
        <article-title>Fast and accurate approximate inference of transcript expression from RNA-seq data</article-title>
        <source>Bioinformatics</source>
        <volume>31</volume>
        <issue>24</issue>
        <fpage>3881</fpage>
        <lpage>3889</lpage>
        <year>2015</year>
        <pub-id pub-id-type="pmid">26315907</pub-id>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nariai</surname>
            <given-names>Naoki</given-names>
          </name>
          <name>
            <surname>Kojima</surname>
            <given-names>Kaname</given-names>
          </name>
          <name>
            <surname>Mimori</surname>
            <given-names>Takahiro</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>Yukuto</given-names>
          </name>
          <name>
            <surname>Kawai</surname>
            <given-names>Yosuke</given-names>
          </name>
          <name>
            <surname>Yamaguchi-Kabata</surname>
            <given-names>Yumi</given-names>
          </name>
          <name>
            <surname>Nagasaki</surname>
            <given-names>Masao</given-names>
          </name>
        </person-group>
        <article-title>TIGAR2: sensitive and accurate estimation of transcript isoform expression with longer RNA-Seq reads</article-title>
        <source>BMC Genomics</source>
        <volume>15</volume>
        <issue>Suppl 10</issue>
        <fpage>S5</fpage>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cappé</surname>
            <given-names>Olivier</given-names>
          </name>
        </person-group>
        <article-title>Online expectation-maximisation</article-title>
        <source>Mixtures: Estimation and Applications</source>
        <fpage>1</fpage>
        <lpage>53</lpage>
        <year>2011</year>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hsieh</surname>
            <given-names>Cho-Jui</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>Hsiang-Fu</given-names>
          </name>
          <name>
            <surname>Dhillon</surname>
            <given-names>Inderjit S</given-names>
          </name>
        </person-group>
        <article-title>PASSCoDe: Parallel ASynchronous Stochastic dual Co-ordinate Descent</article-title>
        <comment>arXiv preprint arXiv:1504.01365</comment>
        <year>2015</year>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Salzman</surname>
            <given-names>Julia</given-names>
          </name>
          <name>
            <surname>Jiang</surname>
            <given-names>Hui</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>Wing Hung</given-names>
          </name>
        </person-group>
        <article-title>Statistical modeling of RNA-Seq data</article-title>
        <source>Statistical science: a review journal of the Institute of Mathematical Statistics</source>
        <volume>26</volume>
        <issue>1</issue>
        <year>2011</year>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nicolae</surname>
            <given-names>Marius</given-names>
          </name>
          <name>
            <surname>Mangul</surname>
            <given-names>Serghei</given-names>
          </name>
          <name>
            <surname>Mandoiu</surname>
            <given-names>Ion I</given-names>
          </name>
          <name>
            <surname>Zelikovsky</surname>
            <given-names>Alex</given-names>
          </name>
        </person-group>
        <article-title>Estimation of alternative splicing isoform frequencies from RNA-Seq data</article-title>
        <source>Algorithms for Molecular Biology</source>
        <volume>6</volume>
        <issue>1</issue>
        <fpage>9</fpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21504602</pub-id>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Turro</surname>
            <given-names>Ernest</given-names>
          </name>
          <name>
            <surname>Yi-Su</surname>
            <given-names>Shu</given-names>
          </name>
          <name>
            <surname>Gonçalves</surname>
            <given-names>Ângela</given-names>
          </name>
          <name>
            <surname>Coin</surname>
            <given-names>Lachlan JM</given-names>
          </name>
          <name>
            <surname>Richardson</surname>
            <given-names>Sylvia</given-names>
          </name>
          <name>
            <surname>Lewin</surname>
            <given-names>Alex</given-names>
          </name>
        </person-group>
        <article-title>Haplotype and isoform specific expression estimation using multi-mapping RNA-seq reads</article-title>
        <source>Genome Biology</source>
        <volume>12</volume>
        <issue>2</issue>
        <fpage>1</fpage>
        <year>2011</year>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>Xiaozhou</given-names>
          </name>
          <name>
            <surname>Andersen</surname>
            <given-names>David G</given-names>
          </name>
          <name>
            <surname>Kaminsky</surname>
            <given-names>Michael</given-names>
          </name>
          <name>
            <surname>Freedman</surname>
            <given-names>Michael J</given-names>
          </name>
        </person-group>
        <article-title>Algorithmic improvements for fast concurrent cuckoo hashing</article-title>
        <conf-name>Proceedings of the Ninth European Conference on Computer Systems</conf-name>
        <fpage>27</fpage>
        <publisher-name>ACM</publisher-name>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jackman</surname>
            <given-names>Shaun</given-names>
          </name>
          <name>
            <surname>Birol</surname>
            <given-names>Inanc</given-names>
          </name>
        </person-group>
        <article-title>Linuxbrew and homebrew for cross-platform package management</article-title>
        <source>F1000Research</source>
        <year>2016</year>
        <volume>5</volume>
        <comment>(ISCB Comm J)</comment>
        <fpage>1795</fpage>
        <comment>(poster)</comment>
        <pub-id pub-id-type="doi">10.7490/f1000research.1112681.1</pub-id>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Merkel</surname>
            <given-names>Dirk</given-names>
          </name>
        </person-group>
        <article-title>Docker: Lightweight linux containers for consistent development and deployment</article-title>
        <source>Linux Journal</source>
        <volume>2014</volume>
        <issue>239</issue>
        <month>3</month>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="web">
        <person-group person-group-type="author">
          <name>
            <surname>Di Tommaso</surname>
            <given-names>Paolo</given-names>
          </name>
          <name>
            <surname>Chatzou</surname>
            <given-names>Maria</given-names>
          </name>
          <name>
            <surname>Baraja</surname>
            <given-names>Pablo Prieto</given-names>
          </name>
          <name>
            <surname>Notredame</surname>
            <given-names>Cedric</given-names>
          </name>
        </person-group>
        <article-title>A novel tool for highly scalable computational pipelines</article-title>
        <source>figshare</source>
        <comment>
          <ext-link ext-link-type="uri" xlink:href="https://dx.doi.org/10.6084/m9.figshare.1254958.v2">https://dx.doi.org/10.6084/m9.figshare.1254958.v2</ext-link>
        </comment>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Beaulieu-Jones</surname>
            <given-names>Brett K</given-names>
          </name>
          <name>
            <surname>Greene</surname>
            <given-names>Casey S</given-names>
          </name>
        </person-group>
        <article-title>Reproducible computational workflows with continuous analysis</article-title>
        <source>bioRxiv</source>
        <year>2016</year>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>(a) The median of absolute log fold changes (lfc) between the estimated and true abundances under all 16 replicates of the Polyester simulated data. The closer the lfc to 0, the more similar the true and estimated abundances. The left and right panels show the distribution of the log fold changes under samples simulated with different GC-bias curves learned from experimental data (details in <bold>Online methods</bold>, <bold>Ground truth simulated data</bold>). (b) The distribution of mean absolute relative differences (MARDs), as described in <bold>Online methods</bold>, <bold>Metrics for accuracy</bold>, of <italic>Salmon</italic>, <italic>Salmon</italic> using traditional alignments (“<italic>Salmon</italic> (a)”), <italic>kallisto</italic> and <italic>eXpress</italic> under 20 simulated replicates generated by RSEM-sim. Salmon and <italic>kallisto</italic> yield similar MARDs, though Salmon’s distribution of MARDs is significantly smaller (Mann-Whitney U test, p = 0.00017) than those of <italic>kallisto</italic>. Both methods outperform <italic>eXpress</italic> (Mann-Whitney U test, p = 3.39781 × 10<sup>−8</sup>). (c) At typical FDR values, the sensitivity of finding truly DE transcripts using Salmon’s estimates is 53%–450% greater than that using <italic>kallisto</italic>’s estimates and 210%–250% greater than that using <italic>eXpress</italic>’ estimates for the Polyester simulated data. (d) For 30 GEUVADIS samples, the number of transcripts called as DE at an expected FDR of 1% when the contrast between groups is simply a technical confound (i.e. the center at which they were sequenced). <italic>Salmon</italic> produces fewer than half as many DE calls as the other methods. Permuting samples, or testing for DE within sequencing center resulted in ≪ 1 transcript called as DE on average for all methods.</p>
    </caption>
    <graphic xlink:href="nihms849351f1"/>
  </fig>
</floats-group>
