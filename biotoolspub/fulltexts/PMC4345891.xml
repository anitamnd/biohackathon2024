<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Front Neuroeng</journal-id>
    <journal-id journal-id-type="iso-abbrev">Front Neuroeng</journal-id>
    <journal-id journal-id-type="publisher-id">Front. Neuroeng.</journal-id>
    <journal-title-group>
      <journal-title>Frontiers in Neuroengineering</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1662-6443</issn>
    <publisher>
      <publisher-name>Frontiers Media S.A.</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4345891</article-id>
    <article-id pub-id-type="doi">10.3389/fneng.2015.00001</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Neuroscience</subject>
        <subj-group>
          <subject>Methods Article</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>NeuroPG: open source software for optical pattern generation and data acquisition</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Avants</surname>
          <given-names>Benjamin W.</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="author-notes" rid="fn002">
          <sup>†</sup>
        </xref>
        <uri xlink:type="simple" xlink:href="http://community.frontiersin.org/people/u/205156"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Murphy</surname>
          <given-names>Daniel B.</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="author-notes" rid="fn002">
          <sup>†</sup>
        </xref>
        <uri xlink:type="simple" xlink:href="http://community.frontiersin.org/people/u/175175"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dapello</surname>
          <given-names>Joel A.</given-names>
        </name>
        <xref ref-type="aff" rid="aff2">
          <sup>2</sup>
        </xref>
        <uri xlink:type="simple" xlink:href="http://community.frontiersin.org/people/u/213434"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Robinson</surname>
          <given-names>Jacob T.</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff3">
          <sup>3</sup>
        </xref>
        <xref ref-type="aff" rid="aff4">
          <sup>4</sup>
        </xref>
        <xref ref-type="author-notes" rid="fn001">
          <sup>*</sup>
        </xref>
        <uri xlink:type="simple" xlink:href="http://community.frontiersin.org/people/u/49140"/>
      </contrib>
    </contrib-group>
    <aff id="aff1">
      <sup>1</sup>
      <institution>Department of Electrical and Computer Engineering, Rice University</institution>
      <country>Houston, TX, USA</country>
    </aff>
    <aff id="aff2">
      <sup>2</sup>
      <institution>Hampshire College</institution>
      <country>Amherst, MA, USA</country>
    </aff>
    <aff id="aff3">
      <sup>3</sup>
      <institution>Department of Bioengineering, Rice University</institution>
      <country>Houston, TX, USA</country>
    </aff>
    <aff id="aff4">
      <sup>4</sup>
      <institution>Department of Neuroscience, Baylor College of Medicine</institution>
      <country>Houston, TX, USA</country>
    </aff>
    <author-notes>
      <fn fn-type="edited-by">
        <p>Edited by: Randal A. Koene, Boston University, USA</p>
      </fn>
      <fn fn-type="edited-by">
        <p>Reviewed by: Pascal Darbon, Université de Strasbourg, France; Karl Farrow, Neuroelectronics Research Flanders, Belgium</p>
      </fn>
      <corresp id="fn001">*Correspondence: Jacob T. Robinson, Department of Electrical and Computer Engineering, Rice University, Duncan Hall 2041, 6100 Main Street, MS 380 Houston, TX 77005, USA e-mail: <email xlink:type="simple">jtrobinson@rice.edu</email></corresp>
      <fn fn-type="other" id="fn002">
        <p><sup>†</sup>These authors have contributed equally to this work.</p>
      </fn>
      <fn fn-type="other" id="fn003">
        <p>This article was submitted to the journal Frontiers in Neuroengineering.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>02</day>
      <month>3</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2015</year>
    </pub-date>
    <volume>8</volume>
    <elocation-id>1</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>9</month>
        <year>2014</year>
      </date>
      <date date-type="accepted">
        <day>09</day>
        <month>2</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2015 Avants, Murphy, Dapello and Robinson.</copyright-statement>
      <copyright-year>2015</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License (CC BY). The use, distribution and reproduction in other forums is permitted, provided the original author(s) or licensor are credited and that the original publication in this journal is cited, in accordance with accepted academic practice. No use, distribution or reproduction is permitted which does not comply with these terms.</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Patterned illumination using a digital micromirror device (DMD) is a powerful tool for optogenetics. Compared to a scanning laser, DMDs are inexpensive and can easily create complex illumination patterns. Combining these complex spatiotemporal illumination patterns with optogenetics allows DMD-equipped microscopes to probe neural circuits by selectively manipulating the activity of many individual cells or many subcellular regions at the same time. To use DMDs to study neural activity, scientists must develop specialized software to coordinate optical stimulation patterns with the acquisition of electrophysiological and fluorescence data. To meet this growing need we have developed an open source optical pattern generation software for neuroscience—NeuroPG—that combines, DMD control, sample visualization, and data acquisition in one application. Built on a MATLAB platform, NeuroPG can also process, analyze, and visualize data. The software is designed specifically for the Mightex Polygon400; however, as an open source package, NeuroPG can be modified to incorporate any data acquisition, imaging, or illumination equipment that is compatible with MATLAB’s Data Acquisition and Image Acquisition toolboxes.</p>
    </abstract>
    <kwd-group>
      <kwd>optogenetics</kwd>
      <kwd>electrophysiology</kwd>
      <kwd>software</kwd>
      <kwd>pattern stimulation</kwd>
      <kwd>imaging</kwd>
      <kwd>DMD</kwd>
      <kwd>Polygon400</kwd>
    </kwd-group>
    <counts>
      <fig-count count="6"/>
      <table-count count="0"/>
      <equation-count count="0"/>
      <ref-count count="33"/>
      <page-count count="9"/>
      <word-count count="6601"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="introduction" id="s1">
    <title>Introduction</title>
    <p>Optogenetic techniques allow scientists to rapidly manipulate cellular activity by illuminating genetically encoded, light-sensitive proteins (Nagel et al., <xref rid="B18" ref-type="bibr">2003</xref>; Boyden et al., <xref rid="B5" ref-type="bibr">2005</xref>; Zhang et al., <xref rid="B32" ref-type="bibr">2007</xref>; Miesenböck, <xref rid="B16" ref-type="bibr">2009</xref>). Photostimulation of these proteins can affect many cellular behaviors including depolarization or hyperpolarization of the cellular membrane (Boyden et al., <xref rid="B5" ref-type="bibr">2005</xref>; Zhang et al., <xref rid="B32" ref-type="bibr">2007</xref>), gene regulation (Liu et al., <xref rid="B14" ref-type="bibr">2012a</xref>; Motta-Mena et al., <xref rid="B17" ref-type="bibr">2014</xref>), and signaling pathway activity (Airan et al., <xref rid="B1" ref-type="bibr">2009</xref>). One of the main advantages of optogenetics is the ability to modulate the activity of specific subsets of cells. For example, optogenetic techniques can target groups of genetically similar cells using cell-type-specific promoters (Sohal et al., <xref rid="B28" ref-type="bibr">2009</xref>; Cardin et al., <xref rid="B7" ref-type="bibr">2010</xref>; Palmer et al., <xref rid="B21" ref-type="bibr">2011</xref>; Kwan and Dan, <xref rid="B12" ref-type="bibr">2012</xref>), or transgenic animals (Gradinaru et al., <xref rid="B9" ref-type="bibr">2009</xref>; Liu et al., <xref rid="B15" ref-type="bibr">2012b</xref>; Asrican et al., <xref rid="B4" ref-type="bibr">2013</xref>). Even greater specificity is achieved by focusing light to the cell body or sub-cellular structure (Wang et al., <xref rid="B31" ref-type="bibr">2011</xref>; Oron et al., <xref rid="B19" ref-type="bibr">2012</xref>; Smedemark-Margulies and Trapani, <xref rid="B27" ref-type="bibr">2013</xref>; Hochbaum et al., <xref rid="B10" ref-type="bibr">2014</xref>). In this way, scientists can modulate the precise spatiotemporal activity patterns of many individual cells in a localized region with the hope of revealing how information is processed in neural microcircuits (Kwan and Dan, <xref rid="B12" ref-type="bibr">2012</xref>; Hooks et al., <xref rid="B11" ref-type="bibr">2013</xref>; Silasi et al., <xref rid="B26" ref-type="bibr">2013</xref>).</p>
    <p>One of the main challenges for using optogenetics to study the roles of individual neurons in a neural network lies in generating the spatiotemporal pattern of illumination necessary to modulate specific combinations of single cells. The three main approaches to activate neurons with cellular resolution include scanning lasers (Wang et al., <xref rid="B30" ref-type="bibr">2009</xref>; Oron et al., <xref rid="B19" ref-type="bibr">2012</xref>; Paz et al., <xref rid="B22" ref-type="bibr">2013</xref>), spatial phase modulation (SPM; Shoham, <xref rid="B25" ref-type="bibr">2010</xref>; Smedemark-Margulies and Trapani, <xref rid="B27" ref-type="bibr">2013</xref>), and digital micromirror devices (DMDs; Leifer et al., <xref rid="B13" ref-type="bibr">2011</xref>; Packer et al., <xref rid="B20" ref-type="bibr">2013</xref>; Smedemark-Margulies and Trapani, <xref rid="B27" ref-type="bibr">2013</xref>; Hochbaum et al., <xref rid="B10" ref-type="bibr">2014</xref>). Each approach has unique advantages. Scanning lasers deliver the entire source power to a small focal spot, making this approach ideal for multiphoton microscopy. Because the focal spot is typically much smaller than the cell body, to efficiently stimulate neural activity the beam is often scanned rapidly over the cell body (Wang et al., <xref rid="B31" ref-type="bibr">2011</xref>; Smedemark-Margulies and Trapani, <xref rid="B27" ref-type="bibr">2013</xref>). However, since the laser can typically only illuminate one location at a time, it is difficult to activate combinations of individual neurons simultaneously. One approach to illuminate many spots simultaneously employs SPM to form multiple focal points for a single laser (Andrasfalvy et al., <xref rid="B3" ref-type="bibr">2010</xref>; Reutsky-Gefen et al., <xref rid="B24" ref-type="bibr">2013</xref>). The main advantage of the SPM is the ability to focus a laser to arbitrary points in 3D; however, the power at each focal point decreases with the number of focal spots, limiting the total number of neurons that can be simultaneously activated (Peron and Svoboda, <xref rid="B23" ref-type="bibr">2011</xref>). As an alternative to laser-based systems, DMDs can simultaneously illuminate hundreds of thousands of points simultaneously (limited by the pixel count of the DMD). Furthermore, because the power is distributed equally to each mirror, the power delivered to each point is independent of the number of points illuminated. The drawbacks of DMDs compared to scanning lasers and phase modulation include higher black levels of illumination (typically some light reaches the sample when the mirrors are switched to the off state), and lower power at each point since each mirror uses only a fraction of the source power. Regardless of these drawbacks, DMDs can effectively stimulate neurons expressing ChR2 (Farah et al., <xref rid="B8" ref-type="bibr">2007</xref>; Zhu et al., <xref rid="B33" ref-type="bibr">2012</xref>) and cost significantly less than laser-based systems. For example, most microscopes can be upgraded to incorporate DMD illumination for less than $10,000. Considering the many advantages of DMD illumination we developed the NeuroPG software suite to streamline DMD-based optogenetic experiments.</p>
    <p>The NeuroPG software we developed for DMD-based neural circuit studies combines and synchronizes optical pattern generation with image and electrophysiology data acquisition. While similar open source software exists for laser-scanning systems (Suter et al., <xref rid="B29" ref-type="bibr">2010</xref>), we found no open source solution for automating DMD illumination and neural data acquisition. In an effort to reduce the software development time for labs interested in a low cost method for spatiotemporal manipulation of neural circuit activity, we developed our flexible software platform to combine the control and coordination of both the stimulation and acquisition hardware. As a DMD illumination device we chose the Polygon400 DMD from Mightex since it can be configured with up to three different LEDs and easily adapted to most commercial microscopes.</p>
    <p>The NeuroPG software consists of independent software control modules that can be easily modified and expanded. As an example, we have developed several routines to aid with neural circuit mapping and have included these routines in the software package. Specifically we have created tools to define stimulation patterns and to automate simultaneous stimulation and data collection. Once a stimulation protocol is complete, NeuroPG automatically associates the measured responses with the corresponding stimulation region and presents this information graphically, so it may be easily reviewed in real-time. In addition to the graphical output, the raw data and metadata describing the parameters used for the routine are stored in separate files. To aid in subsequent data analysis, NeuroPG includes MatPad, a logging system that records details of the experimental protocols and allows the user to enter and edit notes. Also included is CameraWindow, a MATLAB based camera control suite that can be configured to any camera compatible with MATLAB’s Image Acquisition Toolbox. CameraWindow can run independently or alongside NeuroPG and provides controls and visualization tools useful for cell patching and image acquisition.</p>
  </sec>
  <sec sec-type="methods" id="s2">
    <title>Methods</title>
    <sec id="s2-1">
      <title>Web site</title>
      <p>The nueroPG website can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/RobinsonLab-Rice/NeuroPG">https://github.com/RobinsonLab-Rice/NeuroPG</ext-link>. The site includes downloads and documentation for all related software. Any bugs or technical support issues should be reported through the website. Updates and support information will be posted as available.</p>
    </sec>
    <sec id="s2-2">
      <title>Software development</title>
      <p>NeuroPG was developed and tested on computers running Windows 7 64-bit and Windows 8 64-bit and should work properly on any such system. Running NeuroPG on 32-bit systems is not recommended. NeuroPG has not been tested on computers running Linux or OSX.</p>
    </sec>
    <sec id="s2-3">
      <title>Hardware and software setup</title>
      <sec id="s2-3-1">
        <title>MATLAB</title>
        <p>NeuroPG runs in MATLAB (version 2012b and higher; Mathworks, Natick, MA, USA) as a collection of graphical user interfaces (GUIs), classes, and functions. It requires that the Image Acquisition Toolbox be installed for camera functionality. It also requires the Data Acquisition Toolbox for timing, triggering, and data acquisition.</p>
      </sec>
      <sec id="s2-3-2">
        <title>Workstation</title>
        <p>To run NeuroPG, a computer must have an interface with a data acquisition board (DAQ) either through PCI/PCIe expansion slots or via USB2/3 as required by the DAQ. For imaging, it must also connect to a compatible camera. It is strongly recommended to run a 64-bit version of Windows and have 8 GB or more of high speed RAM. It is also suggested that the workstation have more than one monitor so that image and data acquisition, as well as DMD-control can be viewed simultaneously on the desktop.</p>
      </sec>
      <sec id="s2-3-3">
        <title>Data acquisition hardware</title>
        <p>Currently, only National Instruments (NI; Austin, TX, USA) DAQ hardware supporting session based control (NI-DAQmx drivers) is supported by NeuroPG. At least three analog input channels and one counter/timer output are required but do not need to be on the same device. NeuroPG was tested using the NI USB-6259 and the NI PCIe-63321 X Series.</p>
      </sec>
      <sec id="s2-3-4">
        <title>Amplifier</title>
        <p>NueroPG has been tested using Axon Instruments Multiclamp 700B amplifiers but should be compatible with any electrophysiology amplifier with analog output signals that can interface with an NI DAQ module. Scaling of data signals can be done manually within nueroPG so that signal values match actual data values.</p>
      </sec>
      <sec id="s2-3-5">
        <title>Camera</title>
        <p>NeuroPG, through CameraWindow, supports any camera compatible with the Image Acquisition Toolbox. To control specific camera properties within CameraWindow, the user must generate a configuration file specific to the camera in use. This can be done manually or with the included NeuroPG configuration tool. Example configuration files are available on the website.</p>
      </sec>
      <sec id="s2-3-6">
        <title>Digital micromirror device</title>
        <p>The Mightex Polygon400 (Mightex, Toronto, Ontario, Canada) is currently the only supported DMD; however, the basic pattern generation and triggering routines are not specific to the Polygon400 hardware. Because NeuroPG accesses the Polygon400 through a MATLAB class any device with a MATLAB control class can be adapted for use with NeuroPG. Creating a MATLAB control class requires access to the device’s software development kit (SDK) and serves as a wrapper that enables MATLAB to interact with the device through its drivers. Because of the differences between DMD systems and their SDKs, we cannot guarantee that all the NeuroPG functions will be compatible with other DMD systems. However NeuroPG can in principle be used with any DMD system that has an SDK by writing similar MATLAB control classes. These control classes will be hosted on the NeuroPG GitHub repository as they become available.</p>
      </sec>
      <sec id="s2-3-7">
        <title>Rat hippocampal cell culture</title>
        <p>All animal experiments described were carried out in accordance with the National Institutes of Health Guidelines for the Care and Use of Laboratory Animals. Neurons were cultured on an astrocyte feeder layer as described in various protocols, with minor modifications (Brewer et al., <xref rid="B6" ref-type="bibr">1993</xref>; Albuquerque et al., <xref rid="B2" ref-type="bibr">2009</xref>). Both cell types were derived from hippocampal tissue from E18 Sprague Dawley rats that was purchased from BrainBits, LLC. Astrocyte cultures were established by growing cells from dissociated hippocampal tissue in NbAstro medium (BrainBits). Astrocytes were harvested with Tryple (Life Technologies) and plated on PDL-coated 12 mm coverslips at a density of 5,000 cells/mm<sup>2</sup>. E18 hippocampal neurons (BrainBits, LLC) were plated on astrocyte substrate at a density of 10,000 cells/mm<sup>2</sup> in NbActiv1 medium supplemented with 3% fetal bovine serum. 50% of the medium was replaced with fresh medium every 3–4 days. Experiments described herein were performed at DIV 7–14.</p>
      </sec>
      <sec id="s2-3-8">
        <title>Lentiviral transduction</title>
        <p>Neuron cultures were transduced with Lenti GFP-ChR2 lentivirus purchased from UNC Vector Core (Chapel Hill, NC). Transductions were performed at 0 DIV at 25 MOI, based on concentration of lentivirus stock provided by UNC Vector Core.</p>
      </sec>
    </sec>
  </sec>
  <sec id="s3">
    <title>Results and discussion: description of the software</title>
    <sec id="s3-1">
      <title>Overview</title>
      <p>To demonstrate how NeuroPG can be used for neuroscience experiments that require coordinated DMD stimulation and electrical recording, we mapped the response of cultured rat hippocampal neurons to optical stimulus at different locations. The hardware configuration for this experiment is shown in Figure <xref ref-type="fig" rid="F1">1</xref>. NeuroPG runs on a Dell desktop computer and communicates with a Hamamatsu ORCA-03G camera, an NI USB-6259, two patch clamp headstages, an amplifier, and the Mightex Polygon400 DMD.</p>
      <fig id="F1" position="float">
        <label>Figure 1</label>
        <caption>
          <p><bold>Connection diagram for the example procedures discussed in this paper</bold>. The DMD output trigger and the signal measured by the head stage are recorded as analog signals by the DAQ to facilitate precise temporal alignment between stimulation and response in the experiment. The DAQ signals the DMD using timed TTL pulses as configured by NeuroPG. All connections with NeuroPG are bi-directional, digital signals. The blue beam represents excitation light reflecting off the DMD and the green beam represents light fluorescently emitted from the sample.</p>
        </caption>
        <graphic xlink:href="fneng-08-00001-g0001"/>
      </fig>
      <p>For our example experiment, NeuroPG generated grid patterns with increasing resolution, stimulated an E18 rat primary hippocampal neuron transduced with Lenti GFP-ChR2, and generated heat maps based on the magnitude of the resulting depolarization as measured with whole-cell patch clamp electrophysiology. With minor changes to the code or an imported evaluation function, heat maps could alternatively be generated based on hyperpolarization or firing rate. Instructions for generating custom evaluation functions are posted in the documentation available in the NeuroPG GitHub code repository. The experiment is discussed further in Section Example 2: Dendritic Integration and the final heat maps can be seen in Figure <xref ref-type="fig" rid="F2"/><xref ref-type="fig" rid="F3"/><xref ref-type="fig" rid="F4"/><xref ref-type="fig" rid="F5">5</xref>.</p>
      <fig id="F2" position="float">
        <label>Figure 2</label>
        <caption>
          <p><bold>Manual pattern generation</bold>. ROIs are manually defined as overlays on an image of the field of view that will be stimulated. <bold>(A)</bold> Screenshot of circular, rectangular and spline ROIs, manually defined by drawing on top of the acquired image. <bold>(B)</bold> Screenshot of the main window of NeuroPG, which is updated with the list of ROIs defined in panel <bold>(A)</bold>.</p>
        </caption>
        <graphic xlink:href="fneng-08-00001-g0002"/>
      </fig>
      <fig id="F3" position="float">
        <label>Figure 3</label>
        <caption>
          <p><bold>SmartGrid pattern generation</bold>. A grid of ROIs is generated based on user-defined grid dimensions (number of rows and columns—highlighted in panel <bold>(B)</bold>) and the grid is overlaid on an image of the field of view to be stimulated, as in panel <bold>(A)</bold>. SmartGrid can subdivide any of the selected ROIs into a smaller grid based on user-defined dimensions. Selected regions can be uploaded to the DMD, merged or further subdivided. Selected ROIs appear in green, unselected ROIs appear in red.</p>
        </caption>
        <graphic xlink:href="fneng-08-00001-g0003"/>
      </fig>
      <fig id="F4" position="float">
        <label>Figure 4</label>
        <caption>
          <p><bold>Real-time HeatMap analysis</bold>. The HeatMap tool visualizes the magnitude of the neuron’s depolarization in response to optical stimulation. Patterns that cause a large depolarization within the stimulation window appear as a “hot spots”. <bold>(A)</bold> Screenshot of SmartGrid being used to generate a grid of patterns. Inset: illustration of how the heat value is calculated. Baseline is calculated from the signal preceding the stimulation period and compared to the maximum depolarization within a user-specified time interval, Δt, following stimulation. <bold>(B)</bold> Screenshot of HeatMap GUI; if the user clicks on an ROI in the heat map (highlighted in magenta) a figure, <bold>(C)</bold>, appears with a plot of the waveform of the selected ROI.</p>
        </caption>
        <graphic xlink:href="fneng-08-00001-g0004"/>
      </fig>
      <fig id="F5" position="float">
        <label>Figure 5</label>
        <caption>
          <p><bold>Coarse and fine heat mapping</bold>. To demonstrate how NeuroPG can perform both coarse and fine sampling of neuronal responses we used the built-in HeatMap function of NeuroPG to map the magnitude of the depolarization resulting from patterned optical stimulation of rat hippocampal neuron expressing ChR2-GFP (not shown) and backfilled with AlexaFluor 594 (black). To prevent action potentials from dwarfing subthreshold depolarization any depolarization greater than 30 mV is plotted as a 30 mV maximum response. Heat maps generated using SmartGrid and HeatMap: <bold>(A)</bold> 3 × 3 grid with each ROI having dimensions of 724μm × 551μm, <bold>(B)</bold> 9 × 9 grid with each ROI having dimensions of 241 μm × 184 μm, and <bold>(C)</bold> a 6 × 6 grid with each ROI having dimensions of 80 μm × 61 μm. Scale bars are 100 μm. Color bar units are in mV.</p>
        </caption>
        <graphic xlink:href="fneng-08-00001-g0005"/>
      </fig>
      <sec id="s3-1-1">
        <title>Pattern generation</title>
        <p>NeuroPG offers users two methods to define the regions of interest (ROIs) for illumination. Manual pattern generation allows the user to design ROIs of variable size and shape using simple graphic editing tools. Alternatively, patterns can be designed via the SmartGrid tool segments the entire field of view into user-defined rectangles. ROIs are independent of one another and can be composed of any combination or number of DMD pixels. Currently, SmartGrid only generates non-overlapping ROIs but overlapping ROIs can be easily created with the built-in manual ROI generation tool. It is important to note that with most DMD spatial light modulators the optical stimuli will be in focus in the focal plane of the objective lens. To change the depth of the stimulus one can raise or lower the objective lens.</p>
        <sec id="s3-1-1-1">
          <title>Manual generation</title>
          <p>Manual pattern generation allows the user to define ROIs as rectangular regions, elliptical regions, or vertex specified polygons. Regions are defined graphically in an intuitive click-and-drag style on top of an image specified by the user. In conjunction with CameraWindow or other microscope imaging software, an image of a sample can be captured and used as a reference for manually creating these regions (Figure <xref ref-type="fig" rid="F2">2</xref>). Based on the user-defined ROIs NeuroPG then creates pattern masks and uploads these masks to the DMD onboard memory.</p>
        </sec>
        <sec id="s3-1-1-2">
          <title>SmartGrid generation</title>
          <p>The SmartGrid pattern generator allows the user to quickly divide the visible area of the microscope into regularly shaped rectangular regions. After loading a background image, the entire field of view is designated as a single region. This region can be divided into a user specified grid where each grid element can be subdivided to the pixel limit of the DMD. Any adjacent regions may also be combined to form a larger single region. Any number of regions in the SmartGrid can be selected and exported as patterns for the DMD. The user can also choose to export selected regions as a grouped pattern, allowing for simultaneous stimulation of non-adjacent areas (Figure <xref ref-type="fig" rid="F3">3</xref>).</p>
        </sec>
      </sec>
      <sec id="s3-1-2">
        <title>Pattern projection and real time analysis</title>
        <sec id="s3-1-2-1">
          <title>Manual mode</title>
          <p>NueroPG allows the user to set Polygon400 parameters, load patterns, start or stop pattern sequences, and trigger the next pattern manually all within the GUI. The user can also manually start and stop data recording. Manual control gives the user the most flexibility in controlling the parameters of the experiment. However, because the parameters can be varied throughout an experiment NeuroPG does not currently have any automated routines for analyzing or plotting data recorded during manual control.</p>
        </sec>
        <sec id="s3-1-2-2">
          <title>AutoStim mode</title>
          <p>Once a user has defined at least one stimulation pattern, the AutoStim function can automate the process of stimulating the sample and acquiring data. AutoStim initializes the DMD’s settings and places it into external trigger mode. AutoStim then uploads the stimulation patterns in the list and coordinates triggering and data acquisition. Timing for the routine is controlled by the real-time clock in the DAQ board to ensure accuracy and precision. Once the stimulation routine has finished, AutoStim saves parameters, patterns, and recorded data to a user-specified file. AutoStim automatically associates sections of the electrophysiological data recorded during the stimulation routine with their respective stimulation patterns based on the output trigger of the DMD. The stimulation patterns and associated data can be then passed to the HeatMap visualization tool. In AutoStim mode NeuroPG generates a TTL signal that precedes the illumination of each ROI. This TTL signal triggers the DMD and can be split and routed to other systems such as pClamp or automated stages to trigger other events related to the stimulus. The time between the trigger signal and the beginning of stimulation can be adjusted with the Trig Delay property of the DMD to allow for external systems to prepare for each stimulus.</p>
        </sec>
        <sec id="s3-1-2-3">
          <title>PairedStim mode</title>
          <p>The PairedStim routine facilitates the investigation of time-dependent processes by illuminating two patterns with a specified delay between exposures. To initialize PairedStim, the user specifies two stimulation patterns and the latency between the stimuli. The two patterns can be identical, independent, or partially overlapping. PairedStim then generates the necessary patterns and settings for the stimulation and uploads this data to the DMD. After PairedStim has executed the routine the recorded data is automatically analyzed and plotted.</p>
        </sec>
        <sec id="s3-1-2-4">
          <title>HeatMap</title>
          <p>Included in NeuroPG is a tool that associates collected data with the corresponding stimulation region, evaluates the data, and presents it graphically as a heat map. The default evaluation function plots the maximum depolarization following stimulation. This function identifies the stimulation periods in the data using the DMD output trigger signal and then calculates the difference between the maximum membrane potential within a user-specified time window following stimulation and the average membrane potential prior to stimulation (Figure <xref ref-type="fig" rid="F4">4</xref>). The regions are mapped onto an area corresponding to the field of view and the alpha values (or color intensity values) of each region are set according to the determined “heat” value. Right clicking any region will open a plot of the electrophysiology waveforms used to calculate the “heat” for that particular region. The function used to evaluate the “response magnitude” can easily be changed as described in Customizing Evaluation Functions. Heat maps that are saved as MATLAB figure files will retain all data and functionality when opened by any instance of MATLAB that has access to the HeatMapBDF function.</p>
        </sec>
      </sec>
    </sec>
    <sec id="s3-2">
      <title>Example 1: heat map generation</title>
      <p>One of the advantages of DMD illumination is simple control of the illumination spot size and position. As an example, we used NeuroPG to measure and plot the magnitude of the depolarization as a function of illumination position using a coarse and fine grid size. Adaptive sampling based on the ability to increase the sampling resolution may help to efficiently identify ROIs that have specific influence on neural cells or circuits. To demonstrate our ability to generate heat maps at different resolutions, we used dissociated hippocampal neurons from E18 Sprague Dawley rats, transduced with Lentivirus-ChR2-GFP-CamKII (Boyden et al., <xref rid="B5" ref-type="bibr">2005</xref>) and cultured on hippocampal astrocytes from E18 Sprague Dawley rats. We located a GFP positive neuron using fluorescence microscopy and recorded the transmembrane potential using the whole-cell patch clamp method in current clamp mode. Using SmartGrid, we then divided the field of view into regular rectangular patterns that were exported to the Pattern List and randomized. We then used AutoStim to stimulate each of the ROIs in a randomized order and collect the corresponding electrophysiology data. Once the stimulation was complete, AutoStim divided the recording into sections associated with each ROI and exported the data to HeatMap. To remove any artifacts related to spontaneous activity, we used a simple algorithm in HeatMap to scan for regions that contained spontaneous action potentials that overlapped periods of stimulation and discarded those data. As described in the previous section, HeatMap’s default evaluation function calculated the local baseline membrane potential and determined the “heat” value based on the maximum depolarization relative to this local baseline. The function then generated a figure from this data by coloring each pattern’s area according to the heat value (Figure <xref ref-type="fig" rid="F5">5</xref>). Selecting any ROI in this figure generates a plot of the data used to calculate that region’s heat value. This interactive feature allows the user to easily examine the waveform of specific ROIs. Over the course of this experiment, NeuroPG automatically saved the raw recorded data, the patterns used for the stimulation, the parameters used in all the evaluation functions, an image of the HeatMap figure, and the interactive MATLAB figure itself.</p>
    </sec>
    <sec id="s3-3">
      <title>Example 2: dendritic integration</title>
      <p>Another advantage of DMD illumination is the ability to simultaneously illuminate multiple arbitrarily shaped ROIs. For example, stimulating two regions within the dendritic arbor can reveal how those currents sum at the cell body. To demonstrate how NeuroPG can be used to study dendritic integration we used dissociated E18 rat hippocampal neurons transduced with the Lenti-ChR2-GFP-CaMKII as discussed above. Using manual ROI generation, we targeted two non-overlapping segments of a single dendritic branch. We then stimulated each ROI both individually and together and measured the resulting depolarization at the cell body using whole cell patch-clamp electrophysiology. The results of these measurements are shown in Figure <xref ref-type="fig" rid="F6">6</xref>. In this case, we found that stimulating the two ROIs together resulted in a depolarization that was larger than the summed depolarization resulting from individual ROI stimulation. This ability to simultaneously illuminate complex spatial patterns makes NeuroPG well suited to study the electrical properties of dendrites and dendritic integration.</p>
      <fig id="F6" position="float">
        <label>Figure 6</label>
        <caption>
          <p><bold>(A)</bold> Neuron expressing ChR2-GFP was stimulated by blue light (470 nm) illumination with patterns I (magenta) and II (cyan). <bold>(B)</bold> The depolarization in response to 20 ms (blue bar) stimulation was recorded by whole cell patch-clamp electrophysiology. The depolarization in response to stimulating two ROIs simultaneously (solid black I and II) is greater than the summed depolarization of I and II stimulated individually (dashed black I + II). Data is averaged from three trials; scale bars: <bold>(A)</bold> 25 um, <bold>(B)</bold> 4 mV and 20 ms.</p>
        </caption>
        <graphic xlink:href="fneng-08-00001-g0006"/>
      </fig>
    </sec>
    <sec id="s3-4">
      <title>Customizing evaluation functions</title>
      <p>We have written the NeuroPG data processing and evaluation functions to allow easy modification and support a variety of experiments. In particular the HeatMap tool is designed to allow users to create as many of their own evaluation functions as they would like. These functions must follow a general template but may have variable numbers and types of input parameters. The template specifies the structure of input parameters and the way in which HeatMap queries the function to learn what parameters need to be passed. An example function using the template is included with the NeuroPG package to facilitate customization. In this way, data collected from an experiment may be processed and visualized using multiple, customizable evaluation methods. For example, the heat maps may be based on the maximum depolarization, latency, or rise time. While the default visualization is a heat map, this visualization can be easily modified by the user to best represent their data.</p>
    </sec>
    <sec id="s3-5">
      <title>Peripheral functionality</title>
      <sec id="s3-5-1">
        <title>CameraWindow</title>
        <p>CameraWindow is a microscope camera visualization and control utility designed to control any camera compatible with the Image Acquisition Toolbox. It was designed with cell patching in mind and includes a marker that can be repositioned in the camera window by simply right clicking the desired position. It also has digital 2x and 4x zoom that centers the image wherever the mouse is clicked. CameraWindow provides a histogram of image intensity and allows for auto or manual scaling of image intensity in both grayscale and color modes. The user can easily switch between viewing a sample in bright field and in fluorescence by clicking a radio button. Fluorescence mode changes the exposure and contrast settings to user specified values to enhance low light visualization. Changing back to bright field mode restores the settings to their previous state. The Snapshot functionality allows the user to capture images in one of two ways. In brightfield mode, the raw image data is captured using the current settings of the camera. In fluorescent mode, CameraWindow uses a short exposure time to display the live camera image, but switches to a longer exposure time to capture the raw image data. This allows the user to view their sample at a higher frame rate during focusing and positioning and then capture images with longer exposure times. In either mode, the image data is written to a tif file that is named by appending an incrementing number to the specified file name. The user can also display captured images in one of two ways. New images can be displayed by either creating a new window for each image or stacked on top one another in the same window. Stacked images can be cycled through by mouse click and can be used as time-lapse videos or for comparing bright field and fluorescence images. Stacked images are still saved as individual tif files, not tif stacks. CameraWindow also has a video capture function. When the video button is clicked, video frames are captured from the visualization window and stored in a buffer until system RAM is 90% full or the video button is clicked again. The captured frames are then saved to disk as uncompressed AVI files named with the specified name. CameraWindow tracks the amount of available system RAM and calculates approximately how many seconds of video may be captured at any point in time. Any number of camera properties can be adjusted from the CameraWindow control window. The number of camera properties and order with which they appear is specified in the configuration file. The configuration file can be edited manually or through the included configuration functions. The exposure and contrast properties will always appear at the beginning of the property list if they are defined for the camera.</p>
      </sec>
      <sec id="s3-5-2">
        <title>MatPad</title>
        <p>MatPad is a logging and note utility that NeuroPG uses to log events. MatPad logs changes to NeuroPG settings, as well as the parameters for AutoStim, PairedStim, and all pattern generation methods. MatPad also allows the user to enter their own notes in the log, remove lines from the log, or edit the text of the log directly. The log file name and path are user specified and can be saved in the configuration file or changed manually. If MatPad is directed to use a log file that already exists, it will append new entries into the file without changing any previous data. MatPad is designed to minimizes data loss due to unexpected crashes, shutdowns, or failures by regularly saving the log file to disk. Log files are saved as txt files and can be viewed or edited in any text editor.</p>
      </sec>
    </sec>
    <sec id="s3-6">
      <title>Installation and set up</title>
      <p>The current version of NeuroPG along with download and installation instructions can be found on the NeuroPG website. It is distributed as open-source software under the GNU General Public License version 3.0 (GPL-3.0).</p>
      <p>Software is included with NeuroPG that will automatically generate the configuration file required for each workstation. It is comprised of four configuration utilities that allow the user to specify default settings and parameters. The utilities for configuring DAQ hardware and cameras will auto-detect available hardware and settings for devices present on the workstation and allow the user to customize how these devices are utilized. All NeuroPG settings are stored in a single file that may be edited manually by the user. Settings are stored in MATLAB mat file format to allow for easy access and editing. Detailed instructions for editing the file manually are included in the documentation provided on the website.</p>
    </sec>
  </sec>
  <sec id="s4">
    <title>Software architecture discussion for developers</title>
    <p>The NeuroPG platform is modular and uses an object oriented programming approach. Each interfaced piece of hardware is realized within the software as its own object, allowing it to be accessed and controlled by multiple modules without conflict. This means that MATLAB functions which are not native to the NeuroPG platform can share the system’s resources, allowing for customized expansion of NeuroPG’s functionality. NeuroPG is also designed to be event driven. This allows multiple tasks to run in tandem without blocking thereby enabling the user to run their own functions or operations while NeuroPG is active. The event driven design also allows NeuroPG to adjust camera settings or record video while patterns are being stimulated and data is recorded. The extent to which tasks may be run in parallel is impacted by the hardware capability of the computer and resource intensive operations like saving large amounts of data to disk. Because of this, timing and signaling are handled by the DAQ hardware, ensuring precision for both pattern stimulation and data recording. Memory management is carefully handled within NeuroPG using a combination of shared data structures, persistent variables, and class properties. The approach for memory management is designed to reduce redundant data and prevent unnecessary copying or relocation, and is built around MATLAB’s memory management system. Data processing takes advantage of MATLAB’s optimized vector mathematics algorithms to minimize processing time and memory usage. Data recorded during a stimulation routine is kept in pre-allocated buffers within system memory and written to disk only once the routine is complete. These techniques make NeuroPG robust and reliable, with the primary goal of ensuring the accuracy and reliability of experimental data.</p>
  </sec>
  <sec sec-type="conclusion" id="s5">
    <title>Conclusion</title>
    <p>The flexibility, speed and usability built in to our NeuroPG software package in combination with any DMD-equipped microscope provides a powerful platform to support experiments using any variety of proteins from the optogenetic toolkit (Smedemark-Margulies and Trapani, <xref rid="B27" ref-type="bibr">2013</xref>). Specifically the real-time data analysis and visualization as well as flexible stimulation routines allow NeuroPG to improve experimental efficiency for many optogenetic experiments. NeuroPG is currently configured to record two analog electrical signals but could be modified to accept more input channels. The output from any device that can be encoded as an analog voltage signal (e.g., MultiElectrode Arrays, photodetectors collecting bulk fluorescence) could take the place of patch clamp electrophysiology in our example implementation of NeuroPG. While we have discussed neural circuit studies and dendritic integration as potential applications, because NeuroPG can be easily modified to support a vast array of applications, we see this software toolkit as a key building block for the general optogenetic community.</p>
  </sec>
  <sec id="s6">
    <title>Conflict of interest statement</title>
    <p>The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest.</p>
  </sec>
</body>
<back>
  <fn-group>
    <fn fn-type="financial-disclosure">
      <p>This work was supported in part by <award-id>NSF-1308014</award-id>. We thank Eva Dyer, Caleb Kemere, Xaq Pitkow, and Behnaam Aazhang for useful discussions. We thank Marissa Garcia, Alice Xie, Erin Anderson and Martin Bell for technical assistance with neuron and glial cell culture. We thank Joe Duman and other members of the Kim Tolias group for advice regarding neuron cell culture and lentiviral transduction protocols. We thank Miles Li and his technical support team at Mightex Corporation for providing the Polygon400 digital micromirror device (DMD), the software development kit (SDK) which was incorporated into NeuroPG as well as helpful discussions throughout the development of NeuroPG. Finally, we thank Ken Reese at BrainBits for advising on cell culture protocols and Tal Kafri and his group at the UNC Vector Core for providing the purified lentivirus and for advising on lentiviral transduction protocols.</p>
    </fn>
  </fn-group>
  <ref-list>
    <title>References</title>
    <ref id="B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Airan</surname><given-names>R. D.</given-names></name><name><surname>Thompson</surname><given-names>K. R.</given-names></name><name><surname>Fenno</surname><given-names>L. E.</given-names></name><name><surname>Bernstein</surname><given-names>H.</given-names></name><name><surname>Deisseroth</surname><given-names>K.</given-names></name></person-group> (<year>2009</year>). <article-title>Temporally precise in vivo control of intracellular signalling</article-title>. <source>Nature</source>
<volume>458</volume>, <fpage>1025</fpage>–<lpage>1029</lpage>. <pub-id pub-id-type="doi">10.1038/nature07926</pub-id><?supplied-pmid 19295515?><pub-id pub-id-type="pmid">19295515</pub-id></mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Albuquerque</surname><given-names>C.</given-names></name><name><surname>Joseph</surname><given-names>D. J.</given-names></name><name><surname>Choudhury</surname><given-names>P.</given-names></name><name><surname>MacDermott</surname><given-names>A. B.</given-names></name></person-group> (<year>2009</year>). <article-title>Dissection, plating and maintenance of cortical astrocyte cultures</article-title>. <source>Cold Spring Harb. Protoc.</source>
<volume>2009</volume>:<fpage>pdb.prot5273</fpage>. <pub-id pub-id-type="doi">10.1101/pdb.prot5273</pub-id><?supplied-pmid 20147249?><pub-id pub-id-type="pmid">20147249</pub-id></mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Andrasfalvy</surname><given-names>B. K.</given-names></name><name><surname>Zemelman</surname><given-names>B. V.</given-names></name><name><surname>Tang</surname><given-names>J.</given-names></name><name><surname>Vaziri</surname><given-names>A.</given-names></name></person-group> (<year>2010</year>). <article-title>Two-photon single-cell optogenetic control of neuronal activity by sculpted light</article-title>. <source>Proc. Natl. Acad. Sci. U S A</source>
<volume>107</volume>, <fpage>11981</fpage>–<lpage>11986</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1006620107</pub-id><?supplied-pmid 20543137?><pub-id pub-id-type="pmid">20543137</pub-id></mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Asrican</surname><given-names>B.</given-names></name><name><surname>Augustine</surname><given-names>G. J.</given-names></name><name><surname>Berglund</surname><given-names>K.</given-names></name><name><surname>Chen</surname><given-names>S.</given-names></name><name><surname>Chow</surname><given-names>N.</given-names></name><name><surname>Deisseroth</surname><given-names>K.</given-names></name><etal/></person-group>. (<year>2013</year>). <article-title>Next-generation transgenic mice for optogenetic analysis of neural circuits</article-title>. <source>Front. Neural Circuits</source><volume>7</volume>:<fpage>160</fpage>. <pub-id pub-id-type="doi">10.3389/fncir.2013.00160</pub-id><?supplied-pmid 24324405?><pub-id pub-id-type="pmid">24324405</pub-id></mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Boyden</surname><given-names>E. S.</given-names></name><name><surname>Zhang</surname><given-names>F.</given-names></name><name><surname>Bamberg</surname><given-names>E.</given-names></name><name><surname>Nagel</surname><given-names>G.</given-names></name><name><surname>Deisseroth</surname><given-names>K.</given-names></name></person-group> (<year>2005</year>). <article-title>Millisecond-timescale, genetically targeted optical control of neural activity</article-title>. <source>Nat. Neurosci.</source>
<volume>8</volume>, <fpage>1263</fpage>–<lpage>1268</lpage>. <pub-id pub-id-type="doi">10.1038/nn1525</pub-id><?supplied-pmid 16116447?><pub-id pub-id-type="pmid">16116447</pub-id></mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brewer</surname><given-names>G. J.</given-names></name><name><surname>Torricelli</surname><given-names>J. R.</given-names></name><name><surname>Evege</surname><given-names>E. K.</given-names></name><name><surname>Price</surname><given-names>P. J.</given-names></name></person-group> (<year>1993</year>). <article-title>Optimized survival of hippocampal neurons in B27-supplemented neurobasalm, a new serum-free medium combination</article-title>. <source>J. Neurosci. Res.</source>
<volume>35</volume>, <fpage>567</fpage>–<lpage>576</lpage>. <pub-id pub-id-type="doi">10.1002/jnr.490350513</pub-id><?supplied-pmid 8377226?><pub-id pub-id-type="pmid">8377226</pub-id></mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cardin</surname><given-names>J. A.</given-names></name><name><surname>Carlén</surname><given-names>M.</given-names></name><name><surname>Meletis</surname><given-names>K.</given-names></name><name><surname>Knoblich</surname><given-names>U.</given-names></name><name><surname>Zhang</surname><given-names>F.</given-names></name><name><surname>Deisseroth</surname><given-names>K.</given-names></name><etal/></person-group>. (<year>2010</year>). <article-title>Targeted optogenetic stimulation and recording of neurons in vivo using cell-type-specific expression of channelrhodopsin-2</article-title>. <source>Nat. Protoc.</source><volume>5</volume>, <fpage>247</fpage>–<lpage>254</lpage>. <pub-id pub-id-type="doi">10.1038/nprot.2009.228</pub-id><?supplied-pmid 20134425?><pub-id pub-id-type="pmid">20134425</pub-id></mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Farah</surname><given-names>N.</given-names></name><name><surname>Reutsky</surname><given-names>I.</given-names></name><name><surname>Shoham</surname><given-names>S.</given-names></name></person-group> (<year>2007</year>). <article-title>Patterned optical activation of retinal ganglion cells</article-title>. <source>Conf. Proc. IEEE Eng. Med. Biol. Soc.</source>
<volume>2007</volume>, <fpage>6368</fpage>–<lpage>6370</lpage>. <pub-id pub-id-type="doi">10.1109/iembs.2007.4353812</pub-id><?supplied-pmid 18003478?><pub-id pub-id-type="pmid">18003478</pub-id></mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gradinaru</surname><given-names>V.</given-names></name><name><surname>Mogri</surname><given-names>M.</given-names></name><name><surname>Thompson</surname><given-names>K. R.</given-names></name><name><surname>Henderson</surname><given-names>J. M.</given-names></name><name><surname>Deisseroth</surname><given-names>K.</given-names></name></person-group> (<year>2009</year>). <article-title>Optical deconstruction of Parkinsonian neural circuitry</article-title>. <source>Science</source>
<volume>324</volume>, <fpage>354</fpage>–<lpage>359</lpage>. <pub-id pub-id-type="doi">10.1126/science.1167093</pub-id><?supplied-pmid 19299587?><pub-id pub-id-type="pmid">19299587</pub-id></mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hochbaum</surname><given-names>D. R.</given-names></name><name><surname>Zhao</surname><given-names>Y.</given-names></name><name><surname>Farhi</surname><given-names>S. L.</given-names></name><name><surname>Klapoetke</surname><given-names>N.</given-names></name><name><surname>Werley</surname><given-names>C. A.</given-names></name><name><surname>Kapoor</surname><given-names>V.</given-names></name><etal/></person-group>. (<year>2014</year>). <article-title>All-optical electrophysiology in mammalian neurons using engineered microbial rhodopsins</article-title>. <source>Nat. Methods</source><volume>11</volume>, <fpage>825</fpage>–<lpage>833</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.3000</pub-id><?supplied-pmid 24952910?><pub-id pub-id-type="pmid">24952910</pub-id></mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hooks</surname><given-names>B. M.</given-names></name><name><surname>Mao</surname><given-names>T.</given-names></name><name><surname>Gutnisky</surname><given-names>D. A.</given-names></name><name><surname>Yamawaki</surname><given-names>N.</given-names></name><name><surname>Svoboda</surname><given-names>K.</given-names></name><name><surname>Shepherd</surname><given-names>G. M.</given-names></name></person-group> (<year>2013</year>). <article-title>Organization of cortical and thalamic input to pyramidal neurons in mouse motor cortex</article-title>. <source>J. Neurosci.</source>
<volume>33</volume>, <fpage>748</fpage>–<lpage>760</lpage>. <pub-id pub-id-type="doi">10.1523/JNEUROSCI.4338-12.2013</pub-id><?supplied-pmid 23303952?><pub-id pub-id-type="pmid">23303952</pub-id></mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kwan</surname><given-names>A. C.</given-names></name><name><surname>Dan</surname><given-names>Y.</given-names></name></person-group> (<year>2012</year>). <article-title>Dissection of cortical microcircuits by single-neuron stimulation in vivo</article-title>. <source>Curr. Biol.</source>
<volume>22</volume>, <fpage>1459</fpage>–<lpage>1467</lpage>. <pub-id pub-id-type="doi">10.1016/j.cub.2012.06.007</pub-id><?supplied-pmid 22748320?><pub-id pub-id-type="pmid">22748320</pub-id></mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Leifer</surname><given-names>A. M.</given-names></name><name><surname>Fang-Yen</surname><given-names>C.</given-names></name><name><surname>Gershow</surname><given-names>M.</given-names></name><name><surname>Alkema</surname><given-names>M. J.</given-names></name><name><surname>Samuel</surname><given-names>A. D. T.</given-names></name></person-group> (<year>2011</year>). <article-title>Optogenetic manipulation of neural activity in freely moving Caenorhabditis elegans</article-title>. <source>Nat. Methods</source>
<volume>8</volume>, <fpage>147</fpage>–<lpage>152</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.1554</pub-id><?supplied-pmid 21240279?><pub-id pub-id-type="pmid">21240279</pub-id></mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>H.</given-names></name><name><surname>Gomez</surname><given-names>G.</given-names></name><name><surname>Lin</surname><given-names>S.</given-names></name><name><surname>Lin</surname><given-names>S.</given-names></name><name><surname>Lin</surname><given-names>C.</given-names></name></person-group> (<year>2012a</year>). <article-title>Optogenetic control of transcription in zebrafish</article-title>. <source>PLoS One</source>
<volume>7</volume>:<fpage>e50738</fpage>. <pub-id pub-id-type="doi">10.1371/journal.pone.0050738</pub-id><?supplied-pmid 23226369?><pub-id pub-id-type="pmid">23226369</pub-id></mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>X.</given-names></name><name><surname>Ramirez</surname><given-names>S.</given-names></name><name><surname>Pang</surname><given-names>P. T.</given-names></name><name><surname>Puryear</surname><given-names>C. B.</given-names></name><name><surname>Govindarajan</surname><given-names>A.</given-names></name><name><surname>Deisseroth</surname><given-names>K.</given-names></name><etal/></person-group>. (<year>2012b</year>). <article-title>Optogenetic stimulation of a hippocampal engram activates fear memory recall</article-title>. <source>Nature</source><volume>484</volume>, <fpage>381</fpage>–<lpage>385</lpage>. <pub-id pub-id-type="doi">10.1038/nature11028</pub-id><?supplied-pmid 22441246?><pub-id pub-id-type="pmid">22441246</pub-id></mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Miesenböck</surname><given-names>G.</given-names></name></person-group> (<year>2009</year>). <article-title>The optogenetic catechism</article-title>. <source>Science</source>
<volume>326</volume>, <fpage>395</fpage>–<lpage>399</lpage>. <pub-id pub-id-type="doi">10.1126/science.1174520</pub-id><?supplied-pmid 19833960?><pub-id pub-id-type="pmid">19833960</pub-id></mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Motta-Mena</surname><given-names>L. B.</given-names></name><name><surname>Reade</surname><given-names>A.</given-names></name><name><surname>Mallory</surname><given-names>M. J.</given-names></name><name><surname>Glantz</surname><given-names>S.</given-names></name><name><surname>Weiner</surname><given-names>O. D.</given-names></name><name><surname>Lynch</surname><given-names>K. W.</given-names></name><etal/></person-group>. (<year>2014</year>). <article-title>An optogenetic gene expression system with rapid activation and deactivation kinetics</article-title>. <source>Nat. Chem. Biol.</source><volume>10</volume>, <fpage>196</fpage>–<lpage>202</lpage>. <pub-id pub-id-type="doi">10.1038/nchembio.1430</pub-id><?supplied-pmid 24413462?><pub-id pub-id-type="pmid">24413462</pub-id></mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nagel</surname><given-names>G.</given-names></name><name><surname>Szellas</surname><given-names>T.</given-names></name><name><surname>Huhn</surname><given-names>W.</given-names></name><name><surname>Kateriya</surname><given-names>S.</given-names></name><name><surname>Adeishvili</surname><given-names>N.</given-names></name><name><surname>Berthold</surname><given-names>P.</given-names></name><etal/></person-group>. (<year>2003</year>). <article-title>Channelrhodopsin-2, a directly light-gated cation-selective membrane channel</article-title>. <source>Proc. Natl. Acad. Sci. U S A</source><volume>100</volume>, <fpage>13940</fpage>–<lpage>13945</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1936192100</pub-id><?supplied-pmid 14615590?><pub-id pub-id-type="pmid">14615590</pub-id></mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oron</surname><given-names>D.</given-names></name><name><surname>Papagiakoumou</surname><given-names>E.</given-names></name><name><surname>Anselmi</surname><given-names>F.</given-names></name><name><surname>Emiliani</surname><given-names>V.</given-names></name></person-group> (<year>2012</year>). <article-title>Two-photon optogenetics</article-title>. <source>Prog. Brain Res.</source>
<volume>196</volume>, <fpage>119</fpage>–<lpage>143</lpage>. <pub-id pub-id-type="doi">10.1016/B978-0-444-59426-6.00007-0</pub-id><?supplied-pmid 22341324?><pub-id pub-id-type="pmid">22341324</pub-id></mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Packer</surname><given-names>A. M.</given-names></name><name><surname>Roska</surname><given-names>B.</given-names></name><name><surname>Häusser</surname><given-names>M.</given-names></name></person-group> (<year>2013</year>). <article-title>Targeting neurons and photons for optogenetics</article-title>. <source>Nat. Neurosci.</source>
<volume>16</volume>, <fpage>805</fpage>–<lpage>815</lpage>. <pub-id pub-id-type="doi">10.1038/nn.3427</pub-id><?supplied-pmid 23799473?><pub-id pub-id-type="pmid">23799473</pub-id></mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Palmer</surname><given-names>A. E.</given-names></name><name><surname>Qin</surname><given-names>Y.</given-names></name><name><surname>Park</surname><given-names>J. G.</given-names></name><name><surname>McCombs</surname><given-names>J. E.</given-names></name></person-group> (<year>2011</year>). <article-title>Design and application of genetically encoded biosensors</article-title>. <source>Trends Biotechnol.</source>
<volume>29</volume>, <fpage>144</fpage>–<lpage>152</lpage>. <pub-id pub-id-type="doi">10.1016/j.tibtech.2010.12.004</pub-id><?supplied-pmid 21251723?><pub-id pub-id-type="pmid">21251723</pub-id></mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paz</surname><given-names>J. T.</given-names></name><name><surname>Davidson</surname><given-names>T. J.</given-names></name><name><surname>Frechette</surname><given-names>E. S.</given-names></name><name><surname>Delord</surname><given-names>B.</given-names></name><name><surname>Parada</surname><given-names>I.</given-names></name><name><surname>Peng</surname><given-names>K.</given-names></name><etal/></person-group>. (<year>2013</year>). <article-title>Closed-loop optogenetic control of thalamus as a tool for interrupting seizures after cortical injury</article-title>. <source>Nat. Neurosci.</source><volume>16</volume>, <fpage>64</fpage>–<lpage>70</lpage>. <pub-id pub-id-type="doi">10.1038/nn.3269</pub-id><?supplied-pmid 23143518?><pub-id pub-id-type="pmid">23143518</pub-id></mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peron</surname><given-names>S.</given-names></name><name><surname>Svoboda</surname><given-names>K.</given-names></name></person-group> (<year>2011</year>). <article-title>From cudgel to scalpel: toward precise neural control with optogenetics</article-title>. <source>Nat. Methods</source>
<volume>8</volume>, <fpage>30</fpage>–<lpage>34</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.f.325</pub-id><?supplied-pmid 21191369?><pub-id pub-id-type="pmid">21191369</pub-id></mixed-citation>
    </ref>
    <ref id="B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Reutsky-Gefen</surname><given-names>I.</given-names></name><name><surname>Golan</surname><given-names>L.</given-names></name><name><surname>Farah</surname><given-names>N.</given-names></name><name><surname>Schejter</surname><given-names>A.</given-names></name><name><surname>Tsur</surname><given-names>L.</given-names></name><name><surname>Brosh</surname><given-names>I.</given-names></name><etal/></person-group>. (<year>2013</year>). <article-title>Holographic optogenetic stimulation of patterned neuronal activity for vision restoration</article-title>. <source>Nat. Commun.</source><volume>4</volume>:<fpage>1509</fpage>. <pub-id pub-id-type="doi">10.1038/ncomms2500</pub-id><?supplied-pmid 23443537?><pub-id pub-id-type="pmid">23443537</pub-id></mixed-citation>
    </ref>
    <ref id="B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shoham</surname><given-names>S.</given-names></name></person-group> (<year>2010</year>). <article-title>Optogenetics meets optical wavefront shaping</article-title>. <source>Nat. Methods</source>
<volume>7</volume>, <fpage>798</fpage>–<lpage>799</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth1010-798</pub-id><?supplied-pmid 20885441?><pub-id pub-id-type="pmid">20885441</pub-id></mixed-citation>
    </ref>
    <ref id="B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Silasi</surname><given-names>G.</given-names></name><name><surname>Boyd</surname><given-names>J. D.</given-names></name><name><surname>Ledue</surname><given-names>J.</given-names></name><name><surname>Murphy</surname><given-names>T. H.</given-names></name></person-group> (<year>2013</year>). <article-title>Improved methods for chronic light-based motor mapping in mice: automated movement tracking with accelerometers and chronic EEG recording in a bilateral thin-skull preparation</article-title>. <source>Front. Neural Circuits</source>
<volume>7</volume>:<fpage>123</fpage>. <pub-id pub-id-type="doi">10.3389/fncir.2013.00123</pub-id><?supplied-pmid 23966910?><pub-id pub-id-type="pmid">23966910</pub-id></mixed-citation>
    </ref>
    <ref id="B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smedemark-Margulies</surname><given-names>N.</given-names></name><name><surname>Trapani</surname><given-names>J. G.</given-names></name></person-group> (<year>2013</year>). <article-title>Tools, methods and applications for optophysiology in neuroscience</article-title>. <source>Front. Mol. Neurosci.</source>
<volume>6</volume>:<fpage>18</fpage>. <pub-id pub-id-type="doi">10.3389/fnmol.2013.00018</pub-id><?supplied-pmid 23882179?><pub-id pub-id-type="pmid">23882179</pub-id></mixed-citation>
    </ref>
    <ref id="B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sohal</surname><given-names>V. S.</given-names></name><name><surname>Zhang</surname><given-names>F.</given-names></name><name><surname>Yizhar</surname><given-names>O.</given-names></name><name><surname>Deisseroth</surname><given-names>K.</given-names></name></person-group> (<year>2009</year>). <article-title>Parvalbumin neurons and gamma rhythms enhance cortical circuit performance</article-title>. <source>Nature</source>
<volume>459</volume>, <fpage>698</fpage>–<lpage>702</lpage>. <pub-id pub-id-type="doi">10.1038/nature07991</pub-id><?supplied-pmid 19396159?><pub-id pub-id-type="pmid">19396159</pub-id></mixed-citation>
    </ref>
    <ref id="B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Suter</surname><given-names>B. A.</given-names></name><name><surname>O’Connor</surname><given-names>T.</given-names></name><name><surname>Iyer</surname><given-names>V.</given-names></name><name><surname>Petreanu</surname><given-names>L. T.</given-names></name><name><surname>Hooks</surname><given-names>B. M.</given-names></name><name><surname>Kiritani</surname><given-names>T.</given-names></name><etal/></person-group>. (<year>2010</year>). <article-title>Ephus: multipurpose data acquisition software for neuroscience experiments</article-title>. <source>Front. Neural Circuits</source><volume>4</volume>:<fpage>100</fpage>. <pub-id pub-id-type="doi">10.3389/fncir.2010.00100</pub-id><?supplied-pmid 21960959?><pub-id pub-id-type="pmid">21960959</pub-id></mixed-citation>
    </ref>
    <ref id="B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>J.</given-names></name><name><surname>Hasan</surname><given-names>M. T.</given-names></name><name><surname>Seung</surname><given-names>H. S.</given-names></name></person-group> (<year>2009</year>). <article-title>Laser-evoked synaptic transmission in cultured hippocampal neurons expressing channelrhodopsin-2 delivered by adeno-associated virus</article-title>. <source>J. Neurosci. Methods</source>
<volume>183</volume>, <fpage>165</fpage>–<lpage>175</lpage>. <pub-id pub-id-type="doi">10.1016/j.jneumeth.2009.06.024</pub-id><?supplied-pmid 19560489?><pub-id pub-id-type="pmid">19560489</pub-id></mixed-citation>
    </ref>
    <ref id="B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>K.</given-names></name><name><surname>Liu</surname><given-names>Y.</given-names></name><name><surname>Li</surname><given-names>Y.</given-names></name><name><surname>Guo</surname><given-names>Y.</given-names></name><name><surname>Song</surname><given-names>P.</given-names></name><name><surname>Zhang</surname><given-names>X.</given-names></name><etal/></person-group>. (<year>2011</year>). <article-title>Precise spatiotemporal control of optogenetic activation using an acousto-optic device</article-title>. <source>PLoS One</source><volume>6</volume>:<fpage>e28468</fpage>. <pub-id pub-id-type="doi">10.1371/journal.pone.0028468</pub-id><?supplied-pmid 22174813?><pub-id pub-id-type="pmid">22174813</pub-id></mixed-citation>
    </ref>
    <ref id="B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>F.</given-names></name><name><surname>Wang</surname><given-names>L. P.</given-names></name><name><surname>Brauner</surname><given-names>M.</given-names></name><name><surname>Liewald</surname><given-names>J. F.</given-names></name><name><surname>Kay</surname><given-names>K.</given-names></name><name><surname>Watzke</surname><given-names>N.</given-names></name><etal/></person-group>. (<year>2007</year>). <article-title>Multimodal fast optical interrogation of neural circuitry</article-title>. <source>Nature</source><volume>446</volume>, <fpage>633</fpage>–<lpage>639</lpage>. <pub-id pub-id-type="doi">10.1038/nature05744</pub-id><?supplied-pmid 17410168?><pub-id pub-id-type="pmid">17410168</pub-id></mixed-citation>
    </ref>
    <ref id="B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhu</surname><given-names>P.</given-names></name><name><surname>Fajardo</surname><given-names>O.</given-names></name><name><surname>Shum</surname><given-names>J.</given-names></name><name><surname>Zhang Schärer</surname><given-names>Y. P.</given-names></name><name><surname>Friedrich</surname><given-names>R. W.</given-names></name></person-group> (<year>2012</year>). <article-title>High-resolution optical control of spatiotemporal neuronal activity patterns in zebrafish using a digital micromirror device</article-title>. <source>Nat. Protoc.</source>
<volume>7</volume>, <fpage>1410</fpage>–<lpage>1425</lpage>. <pub-id pub-id-type="doi">10.1038/nprot.2012.072</pub-id><?supplied-pmid 22743832?><pub-id pub-id-type="pmid">22743832</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
