<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Acta Crystallogr B Struct Sci Cryst Eng Mater</journal-id>
    <journal-id journal-id-type="iso-abbrev">Acta Crystallogr B Struct Sci Cryst Eng Mater</journal-id>
    <journal-id journal-id-type="publisher-id">Acta Cryst. B</journal-id>
    <journal-title-group>
      <journal-title>Acta Crystallographica Section B, Structural Science, Crystal Engineering and Materials</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">2052-5192</issn>
    <issn pub-type="epub">2052-5206</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7412753</article-id>
    <article-id pub-id-type="publisher-id">lo5066</article-id>
    <article-id pub-id-type="doi">10.1107/S2052520620007994</article-id>
    <article-id pub-id-type="coden">ACSBDA</article-id>
    <article-id pub-id-type="pii">S2052520620007994</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Papers</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>ChemEnv</italic>: a fast and robust coordination environment identification tool</article-title>
      <alt-title>
        <italic>ChemEnv</italic>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0001-8943-9762</contrib-id>
        <name>
          <surname>Waroquiers</surname>
          <given-names>David</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="author-notes" rid="aunote1">‡</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0001-8907-0336</contrib-id>
        <name>
          <surname>George</surname>
          <given-names>Janine</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0001-7777-8871</contrib-id>
        <name>
          <surname>Horton</surname>
          <given-names>Matthew</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
        <xref ref-type="aff" rid="c">c</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schenk</surname>
          <given-names>Stephan</given-names>
        </name>
        <xref ref-type="aff" rid="d">d</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0003-2495-5509</contrib-id>
        <name>
          <surname>Persson</surname>
          <given-names>Kristin A.</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
        <xref ref-type="aff" rid="c">c</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0002-1422-1205</contrib-id>
        <name>
          <surname>Rignanese</surname>
          <given-names>Gian-Marco</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0002-8377-6829</contrib-id>
        <name>
          <surname>Gonze</surname>
          <given-names>Xavier</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="aff" rid="e">e</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0003-1754-2220</contrib-id>
        <name>
          <surname>Hautier</surname>
          <given-names>Geoffroy</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <aff id="a"><label>a</label>Institute of Condensed Matter and Nanosciences, <institution>Université catholique de Louvain</institution>, Chemin des Étoiles 8, 1348 Louvain-la-Neuve, <country>Belgium</country></aff>
      <aff id="b"><label>b</label>Energy Technologies Area, <institution>Lawrence Berkeley National Laboratory</institution>, Berkeley, CA 94720, <country>USA</country></aff>
      <aff id="c"><label>c</label>Department of Materials Science and Engineering, <institution>University of California</institution>, Berkeley, CA 94720, <country>USA</country></aff>
      <aff id="d"><label>d</label>BASF SE, Digitalization of R&amp;D, Carl-Bosch-Str. 38, 67056 Ludwigshafen, <country>Germany</country></aff>
      <aff id="e"><label>e</label><institution>Skolkovo Institute of Science and Technology</institution>, Skolkovo Innovation Center, Nobel St. 3, Moscow, 143026, <country>Russia</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>geoffroy.hautier@uclouvain.be</email></corresp>
      <fn id="aunote1" fn-type="current-aff">
        <label>‡</label>
        <p>Present address: Matgenix SRL, Rue Armand Bury 185, B-6534 Gozée, Belgium (david.waroquiers@matgenix.com)</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>8</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>21</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>21</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>76</volume>
    <issue>Pt 4</issue>
    <issue-id pub-id-type="publisher-id">b200400</issue-id>
    <fpage>683</fpage>
    <lpage>695</lpage>
    <history>
      <date date-type="received">
        <day>03</day>
        <month>12</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>6</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© David Waroquiers et al. 2020</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0/uk/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution (CC-BY) Licence, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/">http://creativecommons.org/licenses/by/2.0/uk/</ali:license_ref>
      </license>
    </permissions>
    <self-uri xlink:href="https://doi.org/10.1107/S2052520620007994">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p>A new tool called <italic>ChemEnv</italic>, which can identify coordination environments in a fast and robust manner, is presented.</p>
    </abstract>
    <abstract>
      <p>Coordination or local environments have been used to describe, analyze and understand crystal structures for more than a century. Here, a new tool called <italic>ChemEnv</italic>, which can identify coordination environments in a fast and robust manner, is presented. In contrast to previous tools, the assessment of the coordination environments is not biased by small distortions of the crystal structure. Its robust and fast implementation enables the analysis of large databases of structures. The code is available open source within the <italic>pymatgen</italic> package and the software can also be used through a web app available on <ext-link ext-link-type="uri" xlink:href="http://crystaltoolkit.org">http://crystaltoolkit.org</ext-link> through the Materials Project.</p>
    </abstract>
    <kwd-group>
      <kwd>coordination environment</kwd>
      <kwd>continuous symmetry measure</kwd>
      <kwd>Voronoï</kwd>
      <kwd>coordination number</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>European Union’s Horizon 2020, Marie Skłodowska-Curie grant</funding-source>
        <award-id>837910</award-id>
        <principal-award-recipient>Janine George</principal-award-recipient>
      </award-group>
      <award-group>
        <funding-source>U.S. Department of Energy, Office of Science, Office of Basic Energy Sciences, Materials Sciences and Engineering Division</funding-source>
        <award-id>DE-AC02-05CH11231</award-id>
        <principal-award-recipient>Matthew Horton</principal-award-recipient>
        <principal-award-recipient>Kristin A. Persson</principal-award-recipient>
      </award-group>
      <funding-statement>This work was funded by <funding-source>European Union’s Horizon 2020, Marie Skłodowska-Curie grant</funding-source> grant <award-id>837910</award-id> to Janine George. <funding-source>U.S. Department of Energy, Office of Science, Office of Basic Energy Sciences, Materials Sciences and Engineering Division</funding-source> grant <award-id>DE-AC02-05CH11231</award-id> to Matthew Horton and Kristin A. Persson. </funding-statement>
    </funding-group>
    <counts>
      <page-count count="13"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="introduction" id="sec1">
    <label>1.</label>
    <title>Introduction   </title>
    <p>Inorganic crystal structures are typically described by their structure prototype or by a more local concept of ‘coordination environment’ (Müller, 2007<xref ref-type="bibr" rid="bb20"> ▸</xref>; Allmann &amp; Hinek, 2007<xref ref-type="bibr" rid="bb1"> ▸</xref>). Coordination environments or local environments (<italic>e.g.</italic> octahedral, tetrahedral, <italic>etc.</italic>) are often used in structure visualization as they clarify the crystal arrangement. These environments can also be used to understand crystal structures and their properties. P. Pfeiffer was the first to transfer this concept of coordination environments from coordination complexes to crystals to rationalize crystals as large molecules (Pfeiffer, 1915<xref ref-type="bibr" rid="bb25"> ▸</xref>, 1916<xref ref-type="bibr" rid="bb26"> ▸</xref>). Very often these coordination environments are determined in a non-automatic manner by the individual researcher. Local environments play a major role in solid state chemistry and physics as well as materials science. For instance, the famous Pauling rules, which have been used to understand and rationalize crystal structures for 90 years, rely heavily on this concept (Pauling, 1929<xref ref-type="bibr" rid="bb23"> ▸</xref>). In the Pauling rules, the analysis of the coordination environments is used to determine the stability of a material. Electronic, optical, magnetic and other properties of crystals have also been related to and explained by local environments (Hoffmann, 1987<xref ref-type="bibr" rid="bb11"> ▸</xref>, 1988<xref ref-type="bibr" rid="bb12"> ▸</xref>; Lueken, 2013<xref ref-type="bibr" rid="bb18"> ▸</xref>; Peng <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb24"> ▸</xref>). In recent years, coordination environments have been discussed and used as structural descriptors to derive structure–property relationships via machine-learning methods (Jain <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb14"> ▸</xref>; Zimmermann <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb31"> ▸</xref>). Some of us have analyzed the coordination environments present in oxides in a statistical manner (Waroquiers <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb30"> ▸</xref>). Such large-scale analyzes require an easily reproducible, robust and automatic determination of coordination environments. Since the transfer of the concept of coordination environments from coordination complexes to crystals, various approaches to determine coordination numbers, coordination environments, or the distortion of coordination environments have been developed (Frank &amp; Kasper, 1958<xref ref-type="bibr" rid="bb6"> ▸</xref>; Brunner &amp; Schwarzenbach, 1971<xref ref-type="bibr" rid="bb3"> ▸</xref>; Carter, 1978<xref ref-type="bibr" rid="bb4"> ▸</xref>; O’Keeffe, 1979<xref ref-type="bibr" rid="bb21"> ▸</xref>; Hoppe, 1979<xref ref-type="bibr" rid="bb13"> ▸</xref>; Pinsky &amp; Avnir, 1998<xref ref-type="bibr" rid="bb27"> ▸</xref>; Guńka &amp; Zachara, 2019<xref ref-type="bibr" rid="bb9"> ▸</xref>; Stoiber &amp; Niewa, 2019<xref ref-type="bibr" rid="bb28"> ▸</xref>). However, the methods mentioned so far are not well suited for a robust and automatic assessment of coordination environments in very large databases consisting of several thousands of crystal structures such as the Inorganic Crystal Structure Database (Bergerhoff &amp; Brown, 1987<xref ref-type="bibr" rid="bb2"> ▸</xref>, Zagorac <italic>et al.</italic>, 2019<xref ref-type="bibr" rid="bb200"> ▸</xref>), Pearson’s database (Villars &amp; Cenzual, 2018<xref ref-type="bibr" rid="bb29"> ▸</xref>) or the Cambridge Structural Database (Groom <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb8"> ▸</xref>). Indeed, some of these methods can be sensitive to small distortions due to predefined cut-offs while others rely on additional chemical information that is not directly available from the sole consideration of the geometry of the crystal. Moreover, some of these methods only deal with the identification of the coordination number without assigning a specific environment to a given site. To fill this gap we developed <italic>ChemEnv</italic>, a fast and robust tool to identify coordination environments. It has already been applied in the study of coordination environments of oxides (Waroquiers <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb30"> ▸</xref>) and in a rigorous assessment study of the Pauling rules (George <italic>et al.</italic>, 2020<xref ref-type="bibr" rid="bb201"> ▸</xref>). It is embedded in <italic>pymatgen</italic> – a Python library for materials analysis which is part of the Materials Project that aims at the accelerated design of new materials (Ong <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb22"> ▸</xref>; Jain <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb15"> ▸</xref>). Our approach relies on the similarity of such distorted polyhedra present in the crystal structure to ideal reference polyhedra. After a neighbor analysis, we identify potential local environments and compare them through a distance metric to a database of perfect local environments. Different algorithms called strategies are then used to decide on a local environment assignment and the final result can present a unique environment or a mixture of several environments. This approach which is robust to distortion will be described in detail in this paper.</p>
  </sec>
  <sec id="sec2">
    <label>2.</label>
    <title>Method/algorithm   </title>
    <sec id="sec2.1">
      <label>2.1.</label>
      <title>Aspects of coordination environments identification   </title>
      <p>In the process of identifying coordination environments of a given atom, two main questions have to be considered:</p>
      <p>(<italic>a</italic>) What are the neighbors of this atom?</p>
      <p>(<italic>b</italic>) What is the overall arrangement of these neighbors around this atom?</p>
      <p>The first question refers to what is called the coordination number while the second corresponds to the coordination or local environment. The answer to these questions is very clear when the local structure of the atom is close to a perfect environment. However, when relatively large distortions are present, the identification can be much more difficult. In particular, a given local environment can be identified as a <italic>mix</italic> of two or more coordination environments (which can be of the same coordination number or not).</p>
    </sec>
    <sec id="sec2.2">
      <label>2.2.</label>
      <title>Voronoï analysis   </title>
      <p>The neighbors of a given atom in a given structure are determined using a modified Voronoï approach similar to what was proposed by O’Keeffe (1979<xref ref-type="bibr" rid="bb21"> ▸</xref>). The Voronoï analysis allows for the splitting of the space into regions that are closer to one atom than to any other one. In the standard Voronoï approach for determining the neighbors of a given atom <italic>X</italic>, all the atoms {<italic>Y</italic>
<sub>1</sub>,…,<italic>Y</italic>
<sub><italic>n</italic></sub>} whose regions are contiguous to the region of atom <italic>X</italic> are considered as coordinated to atom <italic>X</italic>. The distances between atom <italic>X</italic> and each of its neighbors are written <inline-formula><inline-graphic xlink:href="b-76-00683-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. The common faces <inline-formula><inline-graphic xlink:href="b-76-00683-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> between the region of atom <italic>X</italic> and each of the regions of atoms {<italic>Y</italic>
<sub>1</sub>,…,<italic>Y</italic>
<sub><italic>n</italic></sub>} define solid angles <inline-formula><inline-graphic xlink:href="b-76-00683-efi3.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> subtended by these faces at atom <italic>X</italic>.</p>
      <p>The Voronoï regions are easily understood by drawing the perpendicular area bisectors for each pair of atoms <italic>X</italic> and <italic>Y</italic>. Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref> illustrates the concept in two dimensions (in which area bisectors are thus replaced by line bisectors). The example shown is a slightly distorted square lattice [see Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>(<italic>a</italic>)] where the atoms at the corners (atoms 1, 3, 6 and 8) are displaced towards the central green atom (atom 0). The perfect square lattice is shown by the gray atoms. In Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>(<italic>b</italic>), the perpendicular line bisectors (in red) are drawn for each segment from the central (green) atom and all other (black) atoms around it. The Voronoï region of the central atom corresponds to the region in light green in Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>(<italic>c</italic>). Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>(<italic>d</italic>) shows the faces <inline-formula><inline-graphic xlink:href="b-76-00683-efi4.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> attributed to each pair of atoms <italic>0</italic>–<italic>i</italic> with <italic>i</italic> = 1…8. The solid angle is illustrated for neighbors 1 and 5 by <inline-formula><inline-graphic xlink:href="b-76-00683-efi5.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="b-76-00683-efi6.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, respectively.</p>
      <p>In our modified approach, two additional cut-offs can be added as shown schematically in two dimensions in Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>:</p>
      <p>(<italic>a</italic>) The first cut-off excludes neighbors on the basis of the distance [Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>a</italic>)]. Let <inline-formula><inline-graphic xlink:href="b-76-00683-efi7.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> be the distance to the closest neighbor of atom <italic>X</italic> and κ ≥ 1.0 be the distance cut-off parameter. All atoms lying inside the sphere of radius <inline-formula><inline-graphic xlink:href="b-76-00683-efi8.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> are considered as coordinated neighbors while those lying outside are disregarded. We define the <italic>normalized distance</italic>
<inline-formula><inline-graphic xlink:href="b-76-00683-efi9.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> of each neighbor <italic>Y</italic>
<sub><italic>i</italic></sub> as <inline-formula><inline-graphic xlink:href="b-76-00683-efi10.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
      <p>(<italic>b</italic>) The second cut-off is based on the solid angles <inline-formula><inline-graphic xlink:href="b-76-00683-efi3.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> introduced before [Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>b</italic>)]. Let <inline-formula><inline-graphic xlink:href="b-76-00683-efi12.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> be the biggest solid angle to a neighbor for atom <italic>X</italic> and γ ≤ 1.0 be the angle cut-off parameter. All neighboring atoms with a solid angle smaller than <inline-formula><inline-graphic xlink:href="b-76-00683-efi13.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> are not considered as coordinated to atom <italic>X</italic>. We define the <italic>normalized angle</italic>
<inline-formula><inline-graphic xlink:href="b-76-00683-efi14.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> of each neighbor <italic>Y</italic>
<sub><italic>i</italic></sub> as <inline-formula><inline-graphic xlink:href="b-76-00683-efi15.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
      <p>It is possible to use both cut-offs at the same time in which case a given atom is not considered as a coordinated neighbor if either one of the cut-offs disregards it as a coordinated neighbor.</p>
      <p>The modified Voronoï procedure presented above allows for the determination of the coordinated neighbors of a given atom <italic>X</italic> for a given set of distance/angle parameters. The identification of the coordinated neighbors of atom <italic>X</italic> defines the <italic>local environment</italic> of this atom. The identification of the model environment which this local environment resembles the most is described in the next section.</p>
    </sec>
    <sec id="sec2.3">
      <label>2.3.</label>
      <title>The <italic>shape</italic> recognition problem and the continuous symmetry measure   </title>
      <p>The <italic>shape</italic> recognition problem consists in the identification of the model environment to which a local and possibly distorted environment resembles the most. Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref> illustrates this problem. A distorted octahedron is shown in Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>(<italic>a</italic>). Whether this distorted octahedron is more similar to a perfect octahedron [see Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>(<italic>b</italic>)] than to any other (model) shape is precisely the purpose of the shape recognition. This inherently implies that a list of model polyhedra to be compared to is known <italic>a priori</italic>. We stick to the list of coordination environments recommended by the IUPAC (Hartshorn <italic>et al.</italic>, 2007<xref ref-type="bibr" rid="bb10"> ▸</xref>) and by the IUCr (Lima-de Faria <italic>et al.</italic>, 1990<xref ref-type="bibr" rid="bb5"> ▸</xref>). This list of environments, their symbol, coordinates and additional <italic>meta</italic>-information are given as supplementary information.</p>
      <p>In order to <italic>measure</italic> the closeness of a local environment to each perfect model environment, the <italic>Continuous Symmetry Measure</italic> (CSM) is used, as proposed by Pinsky &amp; Avnir (1998<xref ref-type="bibr" rid="bb27"> ▸</xref>). This CSM can be interpreted as a measure of similarity between shapes. For a given structure <inline-formula><inline-graphic xlink:href="b-76-00683-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> composed of <inline-formula><inline-graphic xlink:href="b-76-00683-efi17.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> atoms (vertices) with coordinates {<bold>q</bold>
<sub><italic>k</italic></sub>, <italic>k</italic> = 1, 2, …, <italic>N</italic>}, the CSM <inline-formula><inline-graphic xlink:href="b-76-00683-efi18.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> with respect to a model polyhedron <inline-formula><inline-graphic xlink:href="b-76-00683-efi19.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> with <inline-formula><inline-graphic xlink:href="b-76-00683-efi20.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> vertices {<bold>p</bold>
<sub><italic>k</italic></sub>, <italic>k</italic> = 1, 2, …, <italic>N</italic>} is defined as: <disp-formula id="fd1"><graphic xlink:href="b-76-00683-efd1.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>with <inline-formula><inline-graphic xlink:href="b-76-00683-efi21.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
      <p>With this definition, the value of the CSM is guaranteed to be in the [0.0, 100.0] interval. A value of 0.0 for the CSM indicates that the two shapes are identical, <italic>i.e.</italic> the structure <inline-formula><inline-graphic xlink:href="b-76-00683-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> corresponds to the perfect structure <inline-formula><inline-graphic xlink:href="b-76-00683-efi19.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. Instead, when the structure is distorted, the value of the CSM gives a degree of distortion of the structure <inline-formula><inline-graphic xlink:href="b-76-00683-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> with respect to the perfect structure <inline-formula><inline-graphic xlink:href="b-76-00683-efi19.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. As such, the CSM can be understood as one definition of a <italic>distance to a shape</italic>.</p>
      <p>In equation (1<xref ref-type="disp-formula" rid="fd1"/>), the minimization has to be performed with respect to four different degrees of freedom:</p>
      <p>(i) <italic>Translation</italic> [see Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>(<italic>a</italic>)]. This minimization is easily addressed by translating the local structures to their center of mass.</p>
      <p>(ii) <italic>Ordering</italic> of the atoms [see Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>(<italic>b</italic>)]. The simplest method is to test all possible permutations of indices. This guarantees a correct value for the CSM but the number of permutations scales as <italic>N</italic>! making it time-consuming for large (<italic>N</italic> &gt; 6) coordination numbers. The symmetry of the model polyhedra is used to reduce the number of independent permutations for <italic>N</italic> ≤ 6. For larger <italic>N</italic>, a different approach is adopted (see Section 2.4<xref ref-type="sec" rid="sec2.4"/>).</p>
      <p>(iii) <italic>Orientation</italic> of the structure [see Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>(<italic>a</italic>)]. The local (distorted) structure is rotated in order to minimize the numerator in equation (1<xref ref-type="disp-formula" rid="fd1"/>) by using an alignment procedure based on the singular value decomposition (Kabsch, 1976<xref ref-type="bibr" rid="bb16"> ▸</xref>; Kabsch, 1978<xref ref-type="bibr" rid="bb17"> ▸</xref>).</p>
      <p>(iv) <italic>Size</italic> of the structure [see Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>(<italic>b</italic>)]. A scaling factor is applied to the local structure to avoid size effects: the local structure is normalized to the root-mean square distance from the center of mass of the structure to all vertices.</p>
      <p>The minimization process presented above is equivalent to the point set registration algorithms used in shape or pattern recognition (Pomerleau <italic>et al</italic>., 2015<xref ref-type="bibr" rid="bb7"> ▸</xref>). The main challenge comes from the fact that the correspondence between points in <inline-formula><inline-graphic xlink:href="b-76-00683-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="b-76-00683-efi19.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> (<italic>i.e.</italic> the ordering problem described above) is unknown. In pattern recognition in which the number of points is usually large, algorithms based on pair correlation functions combined with statistical analysis are widely used [see Maiseli <italic>et al.</italic> (2017<xref ref-type="bibr" rid="bb19"> ▸</xref>) and references therein]. In contrast, for small number of points, a different approach has to be adopted. As briefly outlined above, the simplest solution (which is used for <italic>N</italic> ≤ 6) is to test all possible permutations of indices (ignoring symmetrically identical ones), while for larger <italic>N</italic> the number of permutations is reduced using the <italic>separation-plane algorithm</italic> (see Section 2.4<xref ref-type="sec" rid="sec2.4"/>). In any case, for a given permutation of points, the CSM can be obtained thanks to algorithm 1 (see Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>, points in <inline-formula><inline-graphic xlink:href="b-76-00683-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> have been translated such that their center of mass coincide with that of <inline-formula><inline-graphic xlink:href="b-76-00683-efi19.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>). The exact CSM is then the smallest one of all the CSM computed for each permutation considered.</p>
    </sec>
    <sec id="sec2.4">
      <label>2.4.</label>
      <title>Separation-plane algorithm   </title>
      <p>When the number <italic>N</italic> of coordinated neighbors increases, the number of permutations needed to minimize equation (1<xref ref-type="disp-formula" rid="fd1"/>) scales as <italic>N</italic>!. When the correspondence of vertices between the local distorted structure and the perfect model polyhedron is not known (which is usually the case for the application of the procedure to large databases of structures), this makes the computation of the CSM almost infeasible for <italic>N</italic> &gt; 10 and very time-consuming for 6 &gt; <italic>N</italic> ≥ 10 with the standard procedure (<italic>e.g.</italic> 9! = 362 880, 12! = 479 001 600).</p>
      <p>In order to overcome this difficulty, the separation plane algorithm has been devised to drastically reduce the computational time needed. The basic idea is to identify possible planes in the distorted structure that can be assigned to a plane in the model polyhedron in order to reduce the number of permutations needed to find the right correspondence between points and hence the correct CSM. This idea is illustrated in Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref> for a two-dimensional case. The points of the perfect model shape are separated into three different groups: the set of points supposed to lie within the plane and the two sets of points on either side of the plane. The permutation space is thus reduced because <italic>N</italic>! is always larger than <italic>N</italic>
<sub>1</sub>!<italic>N</italic>
<sub>2</sub>!<italic>N</italic>
<sub>3</sub>! if at least two of <italic>N</italic>
<sub>1</sub>, <italic>N</italic>
<sub>2</sub>, <italic>N</italic>
<sub>3</sub> are larger than or equal to 1. For the example in Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref>, the number of permutations is reduced from 6! = 720 to 2! × 2! × 2! = 8. Additionally, for larger environments in which the separating plane contains more than three points, these can be ordered using clockwise or counterclockwise ordering, hence reducing the number of permutations even further.</p>
      <p>A <italic>separation</italic> is defined by its separation plane <italic>P</italic>
<sub><italic>perf</italic></sub> passing through at least three points of the perfect polyhedron <inline-formula><inline-graphic xlink:href="b-76-00683-efi19.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and by the two separated groups of points <italic>S</italic>
<sub><italic>perf</italic></sub> and <italic>T</italic>
<sub><italic>perf</italic></sub> located on either side of the plane. The set of points in the plane is written as <italic>P</italic> = {<bold>p</bold>
<sub><italic>j</italic></sub>, <italic>j</italic> = 1,…<italic>N</italic>
<sub><italic>P</italic></sub>} while <italic>S</italic> = {<bold>s</bold>
<sub><italic>m</italic></sub>, <italic>m</italic> = 1, …<italic>N</italic>
<sub><italic>S</italic></sub>} and <italic>T</italic> = {<bold>t</bold>
<sub><italic>n</italic></sub>, <italic>n</italic> = 1, …<italic>N</italic>
<sub><italic>T</italic></sub>} stand for the two sets of points on either side of the plane. By construction, {<bold>q</bold>
<sub><italic>k</italic></sub>} = {<bold>p</bold>
<sub><italic>j</italic></sub>} ∪ {<bold>s</bold>
<sub><italic>m</italic></sub>} ∪ {<bold>t</bold>
<sub><italic>n</italic></sub>} and <italic>N</italic> = <italic>N</italic>
<sub><italic>P</italic></sub> + <italic>N</italic>
<sub><italic>S</italic></sub> + <italic>N</italic>
<sub><italic>T</italic></sub>. We use ϒ<sub><italic>perf</italic></sub> = (<italic>N</italic>
<sub><italic>S</italic></sub>, <italic>N</italic>
<sub><italic>P</italic></sub>, <italic>N</italic>
<sub><italic>T</italic></sub>) as an abridged notation for the separation. For the example illustrated in Fig. 7<xref ref-type="fig" rid="fig7"> ▸</xref>, the separation is noted (2, 2, 2). An illustration of two separation planes for the cubic and cuboctahedral environments is provided in Fig. 8<xref ref-type="fig" rid="fig8"> ▸</xref>.</p>
      <p>The procedure for the computation of the CSM of environments with more than six atoms is described in algorithm 2 which is shown in Fig. 9<xref ref-type="fig" rid="fig9"> ▸</xref>. Separation planes have been defined for all the perfect model environments above six atoms. Usually, more than one separation plane can be defined in a given model polyhedron. In practice, the overall algorithm tests all the available separation planes that have been defined for the polyhedron under consideration. The list of separation planes for each coordination environment is available as SI and is also easily viewable with a script provided in the <italic>ChemEnv</italic> subpackage of <italic>pymatgen</italic>.</p>
      <p>The algorithm has been optimized by ordering the points of the separation plane in a clockwise or counterclockwise direction whenever possible. This makes it possible to reduce the number of permutations related to the separation plane. For example, for the separation (3, 6, 3) of the cuboctahedron shown in Fig. 8<xref ref-type="fig" rid="fig8"> ▸</xref>(<italic>b</italic>), the number of permutations of the points in the plane is 6! = 720. Ordering the points in the perfect and local environments makes it possible to reduce the number of trials to six. A similar optimization is also possible for the two separated groups of points for the separations in which these groups contain a sufficient number of points (<italic>e.g.</italic> in the icosahedral environment, the separation plane contains four points and splits the other points into two groups of four points each).</p>
    </sec>
    <sec id="sec2.5">
      <label>2.5.</label>
      <title>Neighbor sets and distance/angle parameters maps   </title>
      <p>The distance and angle parameters defined in Section 2.2<xref ref-type="sec" rid="sec2.2"/> are very sensitive parameters for the determination of the neighbors of a given atom. Indeed, a very slight change in one of the parameters can change the atoms considered as neighbors and hence the coordination. Each neighbor set of atom <italic>A</italic> with coordination <italic>N</italic> is denoted by Ξ<sub><italic>N</italic>, <italic>j</italic></sub>(<italic>A</italic>). The <italic>j</italic> index comes from the fact that two different neighbor sets can have the same coordination <italic>N</italic>. A two-dimensional example of such a case is illustrated in Fig. 10<xref ref-type="fig" rid="fig10"> ▸</xref> in which two sets of distance and angle cut-off parameters result in two different neighbor sets of the same coordination.</p>
      <p>In order to ensure robustness with respect to the distance and angle cut-off parameters, the identification procedure is performed in two steps. First, all sets of neighbors Ξ<sub><italic>N</italic>, <italic>j</italic></sub>(<italic>A</italic>) are obtained for all possible distance/angle parameters in the Voronoï analysis. For each neighbor set, CSMs are computed with respect to each model polyhedron of the same coordination. This can be represented by a <italic>map</italic> of distance/angle parameters with regions defined for each neighbor set (see Fig. 11<xref ref-type="fig" rid="fig11"> ▸</xref> for examples of such maps for Si and O sites in SiO<sub>2</sub> as well as for Cr and Te sites in Cr<sub>2</sub>Te<sub>4</sub>O<sub>11</sub>). The second step allows one to test the sensitivity of the distance/angle parameters by means of <italic>strategies</italic> (see Section 2.6<xref ref-type="sec" rid="sec2.6"/>). While for the three first cases in Fig. 11<xref ref-type="fig" rid="fig11"> ▸</xref>, the ‘correct’ environment is reasonably clear by just looking at the figure (assigning tetrahedral (T:4), angular (A:2) and octahedral (O:6) environments, respectively, to Si in SiO<sub>2</sub>, O in SiO<sub>2</sub> and Cr in Cr<sub>2</sub>Te<sub>4</sub>O<sub>11</sub>), the situation is more complex and the identification is not so evident for Te in Cr<sub>2</sub>Te<sub>4</sub>O<sub>11</sub>. In this case, the environment could be seen as an <italic>intermediate</italic> between two different environments. The use of <italic>strategies</italic> can clarify such ambiguous cases.</p>
      <p>The neighbors in each set, the CSMs for each model polyhedron in each set, and other data related to each neighbor set are stored in a so-called <italic>StructureEnvironments</italic> (see also Section 3<xref ref-type="sec" rid="sec3"/>) or SE (hereafter also symbolized by Φ<sub><italic>A</italic></sub> for atom <italic>A</italic>) object. As exemplified in Fig. 11<xref ref-type="fig" rid="fig11"> ▸</xref>, this SE is not very useful as such as it contains a lot of information that is difficult to interpret directly. In the second step presented below, <italic>strategies</italic> are used to analyze the SE and extract usable and valuable information from the SE.</p>
    </sec>
    <sec id="sec2.6">
      <label>2.6.</label>
      <title>Strategies   </title>
      <p>For the final step of the identification procedure, <italic>strategies</italic> are used to reliably analyze the SE object and extract a usable and meaningful result. Reliability refers to the robustness of our algorithm in which the sensitivity of the identification to the distance/angle parameters is tested and challenged. Hence, the local environments can be interpreted as one unique environment or as an intermediate between two (or more) coordination environments, each of which being attributed a fraction or percentage. Different strategies can be used depending on the goals, needs and constraints required by the user. This flexibility provided by the strategies is one of the strengths of our identification procedure. For visualization purposes, a strategy resulting in the identification of a single coordination environment for each site has to be used while reviewing the most commonly observed environments can be done with a strategy allowing for multiple environments for the same site. One can also favor specific or larger/smaller environments depending on the project. In the following, two strategies are developed further.</p>
      <sec id="sec2.6.1">
        <label>2.6.1.</label>
        <title>Fixed distance/angle cut-offs strategy   </title>
        <p>The simplest way to identify the environment is to use fixed distance and angle cut-off parameters. In this <italic>Simplest­Chemenv­Strategy</italic>, the set of neighbors is thus unique and the environment is identified as the one for which the CSM is the lowest. The advantage of such a simple procedure is that it makes it possible to describe a local environment by its unique corresponding model environment, which is easier to use for visualization purposes. However, some (distorted or very distorted) local environments can be considered to be an intermediate between two or more model coordination polyhedra. In such cases, this strategy will simply ‘choose’ one environment, depending on the distance and angle parameters. As a simple illustration, Fig. 12<xref ref-type="fig" rid="fig12"> ▸</xref> shows the sudden switch from the square-pyramidal environment to the octahedral environment when the distance cut-off is increased. Similarly, for fixed distance and angle cut-offs, when an octahedron is smoothly distorted by moving away one of the atoms, the resulting environment from this simplest strategy changes abruptly from octahedral to square-pyramidal as shown in Fig. 13<xref ref-type="fig" rid="fig13"> ▸</xref> (thin lines correspond to the <italic>SimplestChemenvStrategy</italic>). It is thus very sensitive to small changes in the positions of the atoms. Nevertheless, with decent distance and angle parameters (<italic>e.g.</italic> κ = 1.4 and γ = 0.3), the identified environment is reasonably correct in about 85% of the cases.</p>
        <p>Another illustration of this strategy is shown in Fig. 14<xref ref-type="fig" rid="fig14"> ▸</xref> in which a triangular prism is smoothly distorted towards an octahedron by rotating the upper and lower triangular planes in opposite directions (thin lines correspond to the <italic>SimplestChemenvStrategy</italic>). In this case, the number of neighbors remains the same while the actual identified environment switches abruptly from triangular prismatic to octahedral when the CSM of latter becomes smaller than that of the former. Once again, the sensitivity with respect to small changes in the positions of the atoms is critical in this strategy.</p>
      </sec>
      <sec id="sec2.6.2">
        <label>2.6.2.</label>
        <title>Strategy based on multiple weights   </title>
        <p>A second strategy is developed hereafter, in which special care has been taken to remove the artificial abrupt transitions observed with the <italic>SimplestChemenvStrategy</italic>. The idea is to smooth these transitions using a combination of smooth step functions. A given local environment can thus be identified either as one unique coordination environment if distortions are small, or as a <italic>mix</italic> of two or more environments for larger distortions. In practice, the local environment is described as a list of environments, each being assigned a <italic>fraction</italic> or <italic>percentage</italic>.</p>
        <p>The percentage or fraction <italic>f</italic>
<sub>∊</sub>(<italic>A</italic>) of a given model coordination environment ∊ depends on the results (CSMs, Voronoï parameters, …) for each possible set of neighbors contained in Φ<sub><italic>A</italic></sub>.<disp-formula id="fd2"><graphic xlink:href="b-76-00683-efd2.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>The procedure used to get the fraction of a model polyhedron ∊ for a given local environment is then obtained as the product of two terms. Suppose ∊ occurs in a given neighbor set Ξ. The first term results from the relative weight of the neighbor set (as compared to the other neighbor sets) displaying model environment ∊. The second term comes from the relative weight of the model polyhedron ∊ within that specific neighbor set.<disp-formula id="fd3"><graphic xlink:href="b-76-00683-efd3.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>In the following, the first term is referred to as the <italic>outer weight</italic> (<italic>i.e.</italic> the weight that depends on other so-called <italic>outer</italic> neighbor sets) and the second term is referred to as the <italic>inner weight</italic> (<italic>i.e.</italic> the weight <italic>inside</italic> a specific neighbor set).</p>
        <p><bold>Inner weight</bold>. For a given neighbor set <inline-formula><inline-graphic xlink:href="b-76-00683-efi31.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> of atom <italic>A</italic> in a given coordination <italic>N</italic>, the relative weight (and hence fraction) of each model polyhedron is not straightforward. Let Θ<sup><italic>N</italic></sup> be the set of <italic>K</italic> model environments with coordination <italic>N</italic>: <disp-formula id="fd4"><graphic xlink:href="b-76-00683-efd4.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>For example, the set Θ<sup>6</sup> of six-coordinated model polyhedra [as reported by Hartshorn <italic>et al.</italic> (2007<xref ref-type="bibr" rid="bb10"> ▸</xref>) and Lima-de Faria <italic>et al.</italic> (1990<xref ref-type="bibr" rid="bb5"> ▸</xref>) and implemented in the <italic>ChemEnv</italic> package] is composed of the octahedron (symbolized O:6), the trigonal prism (symbolized T:6) and the pentagonal pyramid (symbolized PP:6).</p>
        <p>For each model polyhedron <inline-formula><inline-graphic xlink:href="b-76-00683-efi32.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, the CSM <inline-formula><inline-graphic xlink:href="b-76-00683-efi33.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> with respect to the local environment <inline-formula><inline-graphic xlink:href="b-76-00683-efi31.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is used to assign a weight to each model polyhedron thanks to the use of an adequately shaped function. Model environments with a lower CSM (<italic>i.e.</italic> more similar to the local environment) are assigned a larger weight. In particular, if one of the model environments has a CSM of 0.0 (<italic>i.e.</italic> the local environment is perfect), its weight should be infinite so that it is the only model environment identified. The function should also allow for the assignment of a zero weight to a model polyhedron for which the CSM is larger than a given maximum value <italic>S</italic>
<sup>max</sup>. One example of such a function is the ‘modified’ inverse function defined in equation (5<xref ref-type="disp-formula" rid="fd5"/>) and shown in Fig. 15<xref ref-type="fig" rid="fig15"> ▸</xref>.<disp-formula id="fd5"><graphic xlink:href="b-76-00683-efd5.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>in which the numerator (<italic>S</italic> − <italic>S</italic>
<sup>max</sup>)<sup>2</sup> ensures the continuity at <italic>S</italic> = <italic>S</italic>
<sup>max</sup> while the prefactor 1/<italic>S</italic>
<sup>max</sup> arises from the normalization of the [0, <italic>S</italic>
<sup>max</sup>] to [0, 1].</p>
        <p>Fractions of each model environment <inline-formula><inline-graphic xlink:href="b-76-00683-efi35.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> are then obtained from these weights using equation (6<xref ref-type="disp-formula" rid="fd6"/>):<disp-formula id="fd6"><graphic xlink:href="b-76-00683-efd6.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>A small example is also given in Fig. 15<xref ref-type="fig" rid="fig15"> ▸</xref> in which CSMs for a fictitious six-coordinated case are provided.</p>
        <p>When the coordination is clearly defined (<italic>i.e.</italic> when only one neighbor set is identified using the procedure outlined in 2.5), the fractions of each model polyhedron are solely determined by this inner weight. On the other hand, when different neighbor sets are identified, an additional complexity arises from the fact that smaller environments usually tend to be more easily recognized as similar (<italic>i.e.</italic> having smaller CSMs). The extreme case is the single neighbor which is always assigned a CSM of zero. For cases in which more than one neighbor set is present, the outer weight is used to determine the relative predominance of each of the neighbor sets (and hence their corresponding model polyhedron).</p>
        <p><bold>Outer weight</bold>. The <italic>outer weight</italic> or <italic>neighbor set weight</italic> refers to the weight of a given neighbor set with respect to the other neighbor sets. This outer weight is defined as a product of several ‘partial weights’ (the definition being general enough to allow for flexibility in the choice of the weights): <disp-formula id="fd7"><graphic xlink:href="b-76-00683-efd7.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>in which <italic>n</italic>
<sub><italic>w</italic></sub> is the number of partial weights used.</p>
        <p>Some of the partial neighbor set weights compare the CSMs of this neighbor set with the ones for the other neighbor sets. The simplest approach is to take the smallest CSM for each of the neighbor sets. In practice, to ensure continuity, an <italic>effective</italic> CSM is defined. The effective CSM of a given neighbor set <inline-formula><inline-graphic xlink:href="b-76-00683-efi31.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, denoted <inline-formula><inline-graphic xlink:href="b-76-00683-efi37.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, is obtained from a weighted average using the ‘modified’ inverse function defined in equation (5<xref ref-type="disp-formula" rid="fd5"/>)<disp-formula id="fd8"><graphic xlink:href="b-76-00683-efd8.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>in which <inline-formula><inline-graphic xlink:href="b-76-00683-efi38.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is a short form for <inline-formula><inline-graphic xlink:href="b-76-00683-efi39.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, <italic>i.e.</italic> the CSM of the neighbor set with respect to the perfect environment <inline-formula><inline-graphic xlink:href="b-76-00683-efi40.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
        <p><bold>Partial weights</bold>. In the following, the partial weights used in the ‘default’ multi-weights strategy [used in a previous publication (Waroquiers <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb30"> ▸</xref>)] are described. The strategy with these default parameters is easily obtained with the following class method (see examples in the tutorials provided in the supplementary material):<disp-formula id="fnu1"><graphic xlink:href="b-76-00683-efd9.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
        <p>Other weights have also been implemented in the <italic>ChemEnv</italic> package in <italic>pymatgen</italic>.</p>
        <p><bold>‘Distance–angle area’ weight</bold>. The idea is to restrict the neighbor sets to those originating from a specific range of values for the distance and angle cutoffs. For example, one might only consider distance cutoffs between 1.2 and 1.8. One might also consider that the Voronoï angle towards a neighbor should always be between 0.3 and 0.8. In practice, a special <italic>area</italic> of distance–angle parameters is defined such as the one shown in Fig. 16<xref ref-type="fig" rid="fig16"> ▸</xref>. Indeed, there is not much sense to allow for neighbors with a small angle parameter and a small distance parameter or with a large angle parameter and a large distance parameter. If the region of a given neighbor set (as defined in Section 2.5<xref ref-type="sec" rid="sec2.5"/>) is crossing the above-mentioned area, the weight of this neighbor set is 1.0 (indicated in white on Fig. 16<xref ref-type="fig" rid="fig16"> ▸</xref>), otherwise it is set to 0.0. An extension of this weight could be to ensure it is continuous.</p>
        <p>
          <bold>‘Self CSM’ weight</bold>
        </p>
        <p>This weight makes use of the effective CSM <italic>S</italic>
<sub>eff</sub> of each neighbor set defined in equation (8<xref ref-type="disp-formula" rid="fd8"/>). Each neighbor set is assigned a weight depending on the value of this effective <italic>S</italic>
<sub>eff</sub>. The idea is to disfavor neighbor sets that are <italic>globally</italic> more distorted than others. One example function used to estimate this weight is defined in equation (9<xref ref-type="disp-formula" rid="fd9"/>) and shown in Fig. 17<xref ref-type="fig" rid="fig17"> ▸</xref>.<disp-formula id="fd9"><graphic xlink:href="b-76-00683-efd10.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>where <inline-formula><inline-graphic xlink:href="b-76-00683-efi41.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is the normalized effective CSM defined as <inline-formula><inline-graphic xlink:href="b-76-00683-efi42.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
        <p><bold>Delta CSM’ weight</bold>. The goal of this neighbor set weight is to reduce the importance of a given neighbor set <inline-formula><inline-graphic xlink:href="b-76-00683-efi43.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> if another neighbor set <inline-formula><inline-graphic xlink:href="b-76-00683-efi44.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> of larger coordination number <italic>N</italic>
<sub>2</sub> &gt; <italic>N</italic>
<sub>1</sub> is present and not too distorted with respect to the first one. In practice, this weight depends on the difference Δ<italic>S</italic>
<sub>eff</sub> between the effective CSMs [as defined in equation (8<xref ref-type="disp-formula" rid="fd8"/>)] of the neighbor sets <inline-formula><inline-graphic xlink:href="b-76-00683-efi44.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="b-76-00683-efi43.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>: <disp-formula id="fd10"><graphic xlink:href="b-76-00683-efd11.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>The Delta CSM weight is defined as: <disp-formula id="fd11"><graphic xlink:href="b-76-00683-efd12.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>in which χ is a sigmoid-like function (<italic>e.g.</italic> a smooth step or smoother step function), <italic>N</italic>(Ξ) is the coordination of neighbor set Ξ and Δ<sub>min</sub>, Δ<sub>max</sub> are the edges used in the χ function.</p>
        <p>An example of a χ function is the smoother step function shown in Fig. 18<xref ref-type="fig" rid="fig18"> ▸</xref> and defined as: <disp-formula id="fd12"><graphic xlink:href="b-76-00683-efd13.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>in which <inline-formula><inline-graphic xlink:href="b-76-00683-efi47.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is the scaled value of <italic>x</italic> mapping the [<italic>a,b</italic>] interval to the [0, 1] interval.</p>
        <p><bold>Choice of partial weights</bold>. The default list of outer weights consists of the three above-mentioned partial weights. As an example and in particular to illustrate the need to use both the Self CSM weight and the Delta CSM weight, Fig. 19<xref ref-type="fig" rid="fig19"> ▸</xref> shows the fractions of environments obtained for different choices of weights in the case of the smooth distortion from octahedral to square-pyramidal environment (see Fig. 13<xref ref-type="fig" rid="fig13"> ▸</xref>).</p>
        <p>The upper left panel shows the CSM of the octahedral (increasing with the distortion) and square-pyramidal (always equal to 0.0). The middle left and lower left panels show the Self CSM and Delta CSM weights for both environments. The Self CSM weight for the square-pyramidal environment is always 1.0 as its CSM is always 0.0. Conversely, the Delta CSM weight for the octahedral environment is always 1.0 as there is no larger neighbor set to be compared to. As shown in the upper right panel, when the sole Self CSM weight is included, the fractions obtained are 50% octahedral and 50% square-pyramidal when no or little distortion is applied (while one would expect to have 100% octahedral and 0% square-pyramidal). Indeed, for both environments, the value of the CSM is 0.0 and hence the Self CSM weight is 1.0. At variance, the middle right panel illustrates the fractions obtained when the sole Delta CSM weight is included. In that case, for large distortions, the fractions obtained are also 50% for each environment. Indeed, when the distortion is large, the Delta CSM weight for the square-pyramidal environment reaches 1.0 as the larger environment is too distorted to disfavor the square-pyramidal environment. The lower right panel illustrates the case when both the Self CSM and Delta CSM weights are included.</p>
      </sec>
    </sec>
  </sec>
  <sec id="sec3">
    <label>3.</label>
    <title>Description of the package   </title>
    <p>The <italic>ChemEnv</italic> module is written in Python and can be found in the <italic>pymatgen</italic> package (Ong <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb22"> ▸</xref>) as part of the <inline-formula><inline-graphic xlink:href="b-76-00683-efi48.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> submodule. The organization of the package is shown diagrammatically in Fig. 20<xref ref-type="fig" rid="fig20"> ▸</xref>. The description of each of the objects referenced as circled numbers in this figure is given hereafter:</p>
    <p>
      <inline-formula>
        <inline-graphic xlink:href="b-76-00683-efi49.jpg" mimetype="image" mime-subtype="gif"/>
      </inline-formula>
      <italic>LocalGeometryFinder</italic>
    </p>
    <p>Main class used to identify the local environments in a structure.</p>
    <p>
      <inline-formula>
        <inline-graphic xlink:href="b-76-00683-efi50.jpg" mimetype="image" mime-subtype="gif"/>
      </inline-formula>
      <italic>AllCoordinationGeometries</italic>
    </p>
    <p>Class containing the list of all the available model coordination geometries (as CoordinationGeometry objects, see <inline-formula><inline-graphic xlink:href="b-76-00683-efi51.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>
</p>
    <p>
      <italic><inline-formula><inline-graphic xlink:href="b-76-00683-efi51.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> CoordinationGeometry</italic>
    </p>
    <p>Generic class for the description of all the model coordination geometries. An instance of this class is created for each model environment (from the json files stored in the <inline-formula><inline-graphic xlink:href="b-76-00683-efi53.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> directory). It contains information about its perfect coordinates as well as its edges and faces, name(s), symbol(s), technical details for the identification procedure, ….</p>
    <p>
      <inline-formula>
        <inline-graphic xlink:href="b-76-00683-efi54.jpg" mimetype="image" mime-subtype="gif"/>
      </inline-formula>
      <italic>StructureEnvironments</italic>
    </p>
    <p>Class containing the information (CSMs, neighbors, …) on all possible neighbor sets for all sites in the structure as introduced in Section 2.5<xref ref-type="sec" rid="sec2.5"/>. This object is meant to be post-processed with a strategy in order to get relevant and usable data about the local environments of the structure.</p>
    <p>
      <inline-formula>
        <inline-graphic xlink:href="b-76-00683-efi55.jpg" mimetype="image" mime-subtype="gif"/>
      </inline-formula>
      <italic>LightStructureEnvironments</italic>
    </p>
    <p>Class containing the processed data from the <italic>StructureEnvironments</italic> class using one strategy. This object lists the environment(s) and their corresponding fractions (in case of a strategy allowing for mixtures of environments) for each site of the structure.</p>
    <p>
      <inline-formula>
        <inline-graphic xlink:href="b-76-00683-efi56.jpg" mimetype="image" mime-subtype="gif"/>
      </inline-formula>
      <italic>DetailedVoronoiContainer</italic>
    </p>
    <p>Class containing the information on the Voronoï analysis (see Section 2.2<xref ref-type="sec" rid="sec2.2"/>) performed at the beginning of the identification procedure in order to define the different possible neighbor sets.</p>
    <p>
      <inline-formula>
        <inline-graphic xlink:href="b-76-00683-efi57.jpg" mimetype="image" mime-subtype="gif"/>
      </inline-formula>
      <italic>SimplestChemenvStrategy</italic>
    </p>
    <p>Class used to apply the fixed distance/angle cutoff strategy introduced in Section 2.6.1<xref ref-type="sec" rid="sec2.6.1"/>.</p>
    <p>
      <inline-formula>
        <inline-graphic xlink:href="b-76-00683-efi58.jpg" mimetype="image" mime-subtype="gif"/>
      </inline-formula>
      <italic>MultiWeightsChemenvStrategy</italic>
    </p>
    <p>Class used to apply the strategy based on multiple weights as introduced in Section 2.6.2<xref ref-type="sec" rid="sec2.6.2"/>.</p>
    <p>The most relevant objects needed for the user of <italic>ChemEnv</italic> package are illustrated in Fig. 21<xref ref-type="fig" rid="fig21"> ▸</xref>.</p>
    <p>The <italic>LocalGeometryFinder</italic> object is the main class used to initialize and set up the structure as well as to compute the <italic>StructureEnvironments</italic> object (containing the raw coordination environments data as introduced in Section 2.5<xref ref-type="sec" rid="sec2.5"/>). Combining this <italic>StructureEnvironments</italic> object with a strategy (<italic>e.g. SimplestChemenvStrategy</italic> or <italic>MultiWeightsChemenv­Strategy</italic>) leads to the <italic>LightStructureEnvironments</italic> object. This latter object contains the usable information about the environments in a structure, <italic>i.e.</italic> the environment or <italic>mix</italic> of environments (with their corresponding fractions) that is identified for each site.</p>
  </sec>
  <sec id="sec4">
    <label>4.</label>
    <title>Interactive web app   </title>
    <p>An interactive web app has been developed to improve accessibility of the <italic>ChemEnv</italic> algorithms as part of the Materials Projects Crystal Toolkit platform. While the Python interface is intuitive and well documented, not all scientists are Python users, and the web app enables use of <italic>ChemEnv</italic> by any user without installing custom software. The web app supports uploading of any file format supported by the <italic>pymatgen</italic> code, including Crystallographic Information Format (CIF). Alternatively, structures can be loaded directly from the Materials Project database containing more than 100 000 inorganic materials.</p>
    <p>The web app is designed to offer one-to-one equivalent functionality to <italic>ChemEnv</italic> by directly calling the corresponding <italic>pymatgen</italic> interface, specifically using the <italic>LightStructureEnvironments</italic> and <italic>SimplestChemenvStrategy</italic>, and allowing the user full interactive control over the distance and angle cut-offs. Each symmetrically distinct chemical environment is shown in 3D using a custom atomic visualizer, along with Wyckoff label, IUPAC symbol, CSM, and human-readable environment label. Oxidation states will be used in the analysis if atoms are appropriately annotated in the uploaded file or, if these are not supplied, oxidation states can be guessed on-the-fly using <italic>pymatgen</italic>’s bond valence analysis algorithms. It will be hosted by the Materials Project, and is available at <ext-link ext-link-type="uri" xlink:href="http://crystaltoolkit.org">http://crystaltoolkit.org</ext-link>.</p>
  </sec>
  <sec id="sec5">
    <label>5.</label>
    <title>Conclusion   </title>
    <p>We have developed a tool that can analyze coordination or local environments of large numbers of crystal structures in a fast and robust manner. The analysis of the neighboring atoms relies on a modified Voronoï approach based on a grid of distance. From this grid of different distance and angle cutoffs, the coordination environments are determined with the help of a similarity metric to the shape of ideal polyhedra. Two different strategies are implemented to arrive at the final assignment of the coordination environments. One of these strategies is especially robust against small distortions of the crystal structures making the algorithm particularly useful for automatic, unsupervised, local environment assignment. This new tool can be used as part of the open-source Python library (<italic>pymatgen</italic>) and within an interactive web app available on <ext-link ext-link-type="uri" xlink:href="http://crystaltoolkit.org">http://crystaltoolkit.org</ext-link> through the Materials Project.</p>
  </sec>
  <sec id="sec6">
    <label>6.</label>
    <title>Supporting information   </title>
    <p>A tutorial for the <italic>ChemEnv</italic> package, in both pdf and jupyter-notebook format, is available in the <ext-link ext-link-type="uri" xlink:href="#suppinfoanchor">supporting information</ext-link>. The list of all environments as well as some details about the implementation are also available in the <ext-link ext-link-type="uri" xlink:href="#suppinfoanchor">supporting information</ext-link>. </p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data">
      <p>List of all environments and some details about the implementation. DOI: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1107/S2052520620007994/lo5066sup3.pdf">10.1107/S2052520620007994/lo5066sup3.pdf</ext-link>
</p>
      <media mimetype="application" mime-subtype="pdf" xlink:href="b-76-00683-sup3.pdf" orientation="portrait" id="d38e225" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data">
      <p>Tutorial for ChemEnv package. DOI: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1107/S2052520620007994/lo5066sup1.pdf">10.1107/S2052520620007994/lo5066sup1.pdf</ext-link>
</p>
      <media mimetype="application" mime-subtype="pdf" xlink:href="b-76-00683-sup1.pdf" orientation="portrait" id="d38e232" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data">
      <p>Tutorial for the ChemEnv in jupyter-notebook format. DOI: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1107/S2052520620007994/lo5066sup2.txt">10.1107/S2052520620007994/lo5066sup2.txt</ext-link>
</p>
      <media mimetype="text" mime-subtype="plain" xlink:href="b-76-00683-sup2.txt" orientation="portrait" id="d38e239" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="bb1">
      <mixed-citation publication-type="other">Allmann, R. &amp; Hinek, R. (2007). <italic>Acta Cryst.</italic>
<bold>63</bold>, 412–417.</mixed-citation>
    </ref>
    <ref id="bb2">
      <mixed-citation publication-type="other">Bergerhoff, G. &amp; Brown, I. D. (1987). <italic>Crystallographic Databases</italic>, <bold>360</bold>, 77–95.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Brunner, G. O. &amp; Schwarzenbach, D. (1971). <italic>Z. Kristallogr.</italic>
<bold>133</bold>, 127–133.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Carter, F. L. (1978). <italic>Acta Cryst.</italic> B<bold>34</bold>, 2962–2966.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Frank, F. C. &amp; Kasper, J. S. (1958). <italic>Acta Cryst.</italic>
<bold>11</bold>, 184–190.</mixed-citation>
    </ref>
    <ref id="bb201">
      <mixed-citation publication-type="other">George, J., Waroquiers, D., Di Stefano, D., Petretto, G., Rignanese, G.-M. &amp; Hautier, G. (2020). <italic>Angew. Chem. Int. Ed.</italic>
<bold>59</bold>, 7569–7575.</mixed-citation>
    </ref>
    <ref id="bb8">
      <mixed-citation publication-type="other">Groom, C. R., Bruno, I. J., Lightfoot, M. P. &amp; Ward, S. C. (2016). <italic>Acta Cryst.</italic> B<bold>72</bold>, 171–179.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Guńka, P. A. &amp; Zachara, J. (2019). <italic>Acta Cryst.</italic> B<bold>75</bold>, 86–96.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Hartshorn, R. M., Hey-Hawkins, E., Kalio, R. &amp; Leigh, G. J. (2007). <italic>Pure Appl. Chem.</italic>
<bold>79</bold>, 1779–1799.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Hoffmann, R. (1987). <italic>Angew. Chem. Int. Ed. Engl.</italic>
<bold>26</bold>, 846–878.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Hoffmann, R. (1988). <italic>Solids and Surfaces: A Chemist’s View of Bonding in Extended Structures.</italic> New York: VCH Publishers.</mixed-citation>
    </ref>
    <ref id="bb13">
      <mixed-citation publication-type="other">Hoppe, R. (1979). <italic>Z. Kristallogr.</italic>
<bold>150</bold>, 23–52.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Jain, A., Hautier, G., Ong, S. P. &amp; Persson, K. (2016). <italic>J. Mater. Res.</italic>
<bold>31</bold>, 977–994.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="other">Jain, A., Ong, S. P., Hautier, G., Chen, W., Richards, W. D., Dacek, S., Cholia, S., Gunter, D., Skinner, D., Ceder, G. &amp; Persson, K. A. (2013). <italic>APL Mater.</italic>
<bold>1</bold>, 011002. </mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">Kabsch, W. (1976). <italic>Acta Cryst.</italic> A<bold>32</bold>, 922–923.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Kabsch, W. (1978). <italic>Acta Cryst.</italic> A<bold>34</bold>, 827–828.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Lima-de-Faria, J., Hellner, E., Liebau, F., Makovicky, E. &amp; Parthé, E. (1990). <italic>Acta Cryst.</italic> A<bold>46</bold>, 1–11.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Lueken, H. (2013). <italic>Magnetochemie: Eine Einführung in Theorie und Anwendung</italic>. Teubner Studienbücher Chemie. Vieweg+Teubner Verlag.</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Maiseli, B., Gu, Y. &amp; Gao, H. (2017). <italic>J. Visual Commun. Image Represent.</italic>
<bold>46</bold>, 95–106.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Müller, U. (2007). <italic>Inorganic Structural Chemistry.</italic> Wiley.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">O’Keeffe, M. (1979). <italic>Acta Cryst.</italic> A<bold>35</bold>, 772–775.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="other">Ong, S. P., Richards, W. D., Jain, A., Hautier, G., Kocher, M., Cholia, S., Gunter, D., Chevrier, V. L., Persson, K. A. &amp; Ceder, G. (2013). <italic>Comput. Mater. Sci.</italic>
<bold>68</bold>, 314–319.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">Pauling, L. (1929). <italic>J. Am. Chem. Soc.</italic>
<bold>51</bold>, 1010–1026.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">Peng, H., Ndione, P. F., Ginley, D. S., Zakutayev, A. &amp; Lany, S. (2015). <italic>Phys. Rev. X</italic>, <bold>5</bold>, 021016.</mixed-citation>
    </ref>
    <ref id="bb25">
      <mixed-citation publication-type="other">Pfeiffer, P. (1915). <italic>Z. Anorg. Allg. Chem.</italic>
<bold>92</bold>, 376–380.</mixed-citation>
    </ref>
    <ref id="bb26">
      <mixed-citation publication-type="other">Pfeiffer, P. (1916). <italic>Z. Anorg. Allg. Chem.</italic>
<bold>97</bold>, 161–174.</mixed-citation>
    </ref>
    <ref id="bb27">
      <mixed-citation publication-type="other">Pinsky, M. &amp; Avnir, D. (1998). <italic>Inorg. Chem.</italic>
<bold>37</bold>, 5575–5582.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Pomerleau, F., Colas, F. &amp; Siegwart, R. (2015). <italic>Found. Trends Robot.</italic>
<bold>1</bold>, 1–104.</mixed-citation>
    </ref>
    <ref id="bb28">
      <mixed-citation publication-type="other">Stoiber, D. &amp; Niewa, R. (2019). <italic>Z. Kristallogr.</italic>
<bold>234</bold>, 201–209.</mixed-citation>
    </ref>
    <ref id="bb29">
      <mixed-citation publication-type="other">Villars, P. &amp; Cenzual, K. (2018). <italic>Pearson’s Crystal Data: Crystal Structure Database for Inorganic Compounds.</italic> Release 2018/19 (on DVD). ASM International, Materials Park, Ohio, USA.</mixed-citation>
    </ref>
    <ref id="bb30">
      <mixed-citation publication-type="other">Waroquiers, D., Gonze, X., Rignanese, G.-M., Welker-Nieuwoudt, C., Rosowski, F., Göbel, M., Schenk, S., Degelmann, P., André, R., Glaum, R. &amp; Hautier, G. (2017). <italic>Chem. Mater.</italic>
<bold>29</bold>, 8346–8360.</mixed-citation>
    </ref>
    <ref id="bb200">
      <mixed-citation publication-type="other">Zagorac, D., Müller, H., Ruehl, S., Zagorac, J. &amp; Rehme, S. (2019). <italic>J. Appl. Cryst.</italic>
<bold>52</bold>, 918–925.</mixed-citation>
    </ref>
    <ref id="bb31">
      <mixed-citation publication-type="other">Zimmermann, N. E. R., Horton, M. K., Jain, A. &amp; Haranczyk, M. (2017). <italic>Front. Mater.</italic>
<bold>4</bold>, 34.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Voronoï construction.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig1"/>
  </fig>
  <fig id="fig2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Schematic representation of the cut-off parameters used in the Voronoï analysis of neighbors: (<italic>a</italic>) distance cut-off and (<italic>b</italic>) angle cut-off. (<italic>a</italic>) Distance cut-off parameter κ. <inline-formula><inline-graphic xlink:href="b-76-00683-efi59.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is the distance to the closest neighbor (one of the dark blue atoms). Any atom that lies outside the sphere of radius <inline-formula><inline-graphic xlink:href="b-76-00683-efi60.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> (in dashed orange) is not considered as a coordinated neighbor. Atoms at the corner (in light blue) are not considered as neighbors. (<italic>b</italic>) Angle cut-off parameter γ. <inline-formula><inline-graphic xlink:href="b-76-00683-efi61.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is the largest solid angle to a neighbor atom. Any atom for which the solid angle is smaller than <inline-formula><inline-graphic xlink:href="b-76-00683-efi13.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> (in orange) is not considered as a coordinated neighbor. Atoms at the corner (in light blue) are not considered as neighbors. [Adapted with permission from D. Waroquiers <italic>et al.</italic> (2017<xref ref-type="bibr" rid="bb1"> ▸</xref>).]</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig2"/>
  </fig>
  <fig id="fig3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <p>The <italic>shape</italic> recognition problem. It consists in identifying whether the distorted octahedron in (<italic>a</italic>) is more similar to the perfect (model) octahedron in (<italic>b</italic>) than to any other model polyhedron. This presupposes that there exists a list of model polyhedra to be compared to.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig3"/>
  </fig>
  <fig id="fig4" orientation="portrait" position="float">
    <label>Figure 4</label>
    <caption>
      <p>Translational and ordering degrees of freedom for the minimization in equation (1<xref ref-type="disp-formula" rid="fd1"/>). (<italic>a</italic>) Translation of the polyhedron and (<italic>b</italic>) ordering of the vertices.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig4"/>
  </fig>
  <fig id="fig5" orientation="portrait" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Rotational and size degrees of freedom for the minimization in equation (1<xref ref-type="disp-formula" rid="fd1"/>). (<italic>a</italic>) Orientation and (<italic>b</italic>) size.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig5"/>
  </fig>
  <fig id="fig6" orientation="portrait" position="float">
    <label>Figure 6</label>
    <caption>
      <p>Algorithm 1. Computation of the CSM for a given permutation.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig6"/>
  </fig>
  <fig id="fig7" orientation="portrait" position="float">
    <label>Figure 7</label>
    <caption>
      <p>Illustration of the separation plane algorithm. (<italic>a</italic>) Model and local (distorted) structure, (<italic>b</italic>) first trial for separation plane algorithm and (<italic>c</italic>) second trial for separation plane algorithm.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig7"/>
  </fig>
  <fig id="fig8" orientation="portrait" position="float">
    <label>Figure 8</label>
    <caption>
      <p>Examples of separation planes. (<italic>a</italic>) Separation (2, 4, 2) in the cubic environment: points A, B, H and E (in red) belong to the plane that separates points D and F (in green) from points C and G (in blue). (<italic>b</italic>) Separation (3, 6, 3) in a cuboctahedron: points A, I, G, D, L and F (in red) belong to the plane that separates points C, E and J (in blue) from points H, K and B (in green).</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig8"/>
  </fig>
  <fig id="fig9" orientation="portrait" position="float">
    <label>Figure 9</label>
    <caption>
      <p>Algorithm 2. The separation plane algorithm.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig9"/>
  </fig>
  <fig id="fig10" orientation="portrait" position="float">
    <label>Figure 10</label>
    <caption>
      <p>Illustration in two dimensions of two sets of neighbors having the same coordination number. (<italic>a</italic>) Local environment of atom 0. Normalized distances to neighbors 1, 2, 3 and 4 are <inline-formula><inline-graphic xlink:href="b-76-00683-efi63.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, <inline-formula><inline-graphic xlink:href="b-76-00683-efi64.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> = 1.15 and <inline-formula><inline-graphic xlink:href="b-76-00683-efi65.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> = 1.35. Normalized angles to neighbors 1, 2, 3 and 4 are <inline-formula><inline-graphic xlink:href="b-76-00683-efi66.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> = 1.0, <inline-formula><inline-graphic xlink:href="b-76-00683-efi67.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="b-76-00683-efi68.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>. (<italic>b</italic>) Set of neighbors (1, 2 and 3) of atom 0 with <italic>N</italic> = 3. This set of neighbors is obtained with <italic>e.g.</italic> κ = 1.25 and γ = 0.3 cut-offs. (<italic>c</italic>) Another set of neighbors (1, 3 and 4) of atom 0 with <italic>N</italic> = 3. This set of neighbors is obtained with <italic>e.g.</italic> κ = 1.4 and γ = 0.5 cut-offs.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig10"/>
  </fig>
  <fig id="fig11" orientation="portrait" position="float">
    <label>Figure 11</label>
    <caption>
      <p>Examples of distance/angle parameters maps for Si and O in α-SiO<sub>2</sub> (Materials Project id: mp-7000) and Cr and Te in Cr<sub>2</sub>Te<sub>4</sub>O<sub>11</sub> (Materials Project id: mp-540537): (<italic>a</italic>) Si site in α-SiO<sub>2</sub>, (<italic>b</italic>) O site in α-SiO<sub>2</sub>, (<italic>c</italic>) Cr site in Cr<sub>2</sub>Te<sub>4</sub>O<sub>11</sub> and (<italic>d</italic>) Te site in Cr<sub>2</sub>Te<sub>4</sub>O<sub>11</sub>. Each neighbor set corresponds to a region in which any distance/angle parameters combination result in the same set. The color level of each region gives an indication of the CSM value of the model polyhedron to which the corresponding neighbor set resembles the most (<italic>i.e.</italic> for which the CSM is the lowest). For the larger regions, this model polyhedron is indicated by its symbol. The square and triangle symbols correspond to fixed distance and angle parameters respectively of 1.3/0.6 and 1.6/0.4, showing a clear ambiguity for the Te site in Cr<sub>2</sub>Te<sub>4</sub>O<sub>11</sub> (see Section 2.6<xref ref-type="sec" rid="sec2.6"/> on how to clarify such cases).</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig11"/>
  </fig>
  <fig id="fig12" orientation="portrait" position="float">
    <label>Figure 12</label>
    <caption>
      <p>Coordination environments for a distorted octahedron in which the bottom atom is at distance 1.45 times larger than the other five neighbors. When the distance cut-off is lower than 1.45, the bottom atom is not considered as a neighbor and the environment is identified as a square pyramid. When the distance cut-off is larger than 1.45, the bottom atom is taken into account and the environment is identified as an octahedron.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig12"/>
  </fig>
  <fig id="fig13" orientation="portrait" position="float">
    <label>Figure 13</label>
    <caption>
      <p>Smooth distortion from octahedral to square-pyramidal environment by moving away the bottom atom. The deformation parameter α = 0 corresponds to the perfect octahedron while for α = 1, the bottom atom has been moved to a distance that is twice that of the distance to the other neighbors. The thin lines gives the fractions of octahedral and square-pyramidal environments obtained with the <italic>SimplestChemenvStrategy</italic> (with a distance cut-off of 1.4) while the thick lines correspond to the fractions obtained with the <italic>MultiWeightsChemenvStrategy</italic>. Octahedral and square-pyramidal are respectively shown as solid and dashed lines.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig13"/>
  </fig>
  <fig id="fig14" orientation="portrait" position="float">
    <label>Figure 14</label>
    <caption>
      <p>Smooth distortion from triangular prismatic to octahedral environment by twisting the triangular prism around the principal axis. The deformation parameter α = 0 corresponds to the perfect trigonal prism while for α = 1, the upper (red → orange) and lower (green → cyan) triangles have been rotated respectively clockwise and counterclockwise by 30°, corresponding to an octahedron. The thin lines gives the fractions of triangular prismatic and octahedral environments obtained with the <italic>SimplestChemenvStrategy</italic> while the thick lines correspond to the fractions obtained with the <italic>MultiWeightsChemenvStrategy</italic>. Octahedral and triangular prismatic are respectively shown as solid and dashed lines.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig14"/>
  </fig>
  <fig id="fig15" orientation="portrait" position="float">
    <label>Figure 15</label>
    <caption>
      <p>Weight function for the <italic>inner</italic> weight of model polyhedra. In this example, <italic>S</italic>
<sub>max</sub> is set to 8.0, so that the weight of any model polyhedron with a CSM larger than 8.0 is zero.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig15"/>
  </fig>
  <fig id="fig16" orientation="portrait" position="float">
    <label>Figure 16</label>
    <caption>
      <p>Schematic of the distance–angle area weight. The shaded area is used to determine which neighbor sets are considered. If the region of a given neighbor set is crossing the shaded area, the set is assigned a ‘distance–angle area’ weight of 1.0. In the opposite case, the set is assigned a weight of 0.0 (white regions).</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig16"/>
  </fig>
  <fig id="fig17" orientation="portrait" position="float">
    <label>Figure 17</label>
    <caption>
      <p>Weight function for the Self-CSM <italic>outer</italic> weight of neighbor sets as defined in equation (9<xref ref-type="disp-formula" rid="fd9"/>). The default parameters for this weight are shown as blue while the green and purple curves illustrate other parameters. Arrows indicate thresholds above which values (<italic>i.e. S</italic>
<sub>max</sub>) of the effective CSM <italic>S</italic>
<sub>eff</sub> each of the weight functions are set to zero.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig17"/>
  </fig>
  <fig id="fig18" orientation="portrait" position="float">
    <label>Figure 18</label>
    <caption>
      <p>Smoother step function used in the Delta CSM weight. The ‘Delta CSM’ weight assigned to the Ξ<sub>1</sub> neighbor set is equal to 0.0 if the difference Δ<italic>S</italic>
<sub>eff</sub>(Ξ<sub>1</sub>, Ξ<sub>2</sub>) between the effective CSM <italic>S</italic>
<sub>eff</sub>(Ξ<sub>2</sub>) of the Ξ<sub>2</sub> neighbor set and its own effective CSM <italic>S</italic>
<sub>eff</sub>(Ξ<sub>1</sub>) is lower than Δ<sub>min</sub>. If the difference Δ<italic>S</italic>
<sub>eff</sub>(Ξ<sub>1</sub>, Ξ<sub>2</sub>) is larger than Δ<sub>max</sub>, the Ξ<sub>1</sub> set is assigned a weight of 1.0. The smoother step function is used between these two extremes. The Δ<sub>min</sub> and Δ<sub>max</sub> values can be changed if needed and examples of smoother step functions for different values are shown.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig18"/>
  </fig>
  <fig id="fig19" orientation="portrait" position="float">
    <label>Figure 19</label>
    <caption>
      <p>Choice of partial weights: comparison and combination of Self CSM and Delta CSM weights in the case of the smooth distortion from octahedral to square-pyramidal environment. Curves in blue (green) correspond to the octahedral (square-pyramidal) environment. See text for details.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig19"/>
  </fig>
  <fig id="fig20" orientation="portrait" position="float">
    <label>Figure 20</label>
    <caption>
      <p>Organization of the <italic>ChemEnv</italic> package. Directories are indicated in black and surrounded by a rectangle. Files are indicated in typewriter (blue for python files, purple for other files). The most important python objects are indicated in italic (green). See text for more information.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig20"/>
  </fig>
  <fig id="fig21" orientation="portrait" position="float">
    <label>Figure 21</label>
    <caption>
      <p>Main objects of the <italic>ChemEnv</italic> package.</p>
    </caption>
    <graphic xlink:href="b-76-00683-fig21"/>
  </fig>
</floats-group>
