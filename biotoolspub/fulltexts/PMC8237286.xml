<?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName art560.dtd?>
<?SourceDTD.Version 5.6.0?>
<?ConverterInfo.XSLTName elsevier2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin publisher?>
<?FILEmeta_ISCI102696 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEfx1 jpg ?>
<?FILEmmc1 pdf ?>
<?FILEsi1 gif ?>
<?FILEsi2 gif ?>
<?FILEsi3 gif ?>
<?FILEsi4 gif ?>
<?FILEsi5 gif ?>
<?FILEsi6 gif ?>
<?FILEsi7 gif ?>
<?FILEsi8 gif ?>
<?FILEsi9 gif ?>
<?FILEsi10 gif ?>
<?FILEsi11 gif ?>
<?FILEsi12 gif ?>
<?FILEsi13 gif ?>
<?FILEsi14 gif ?>
<?properties open_access?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">iScience</journal-id>
    <journal-id journal-id-type="iso-abbrev">iScience</journal-id>
    <journal-title-group>
      <journal-title>iScience</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2589-0042</issn>
    <publisher>
      <publisher-name>Elsevier</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8237286</article-id>
    <article-id pub-id-type="pii">S2589-0042(21)00664-7</article-id>
    <article-id pub-id-type="doi">10.1016/j.isci.2021.102696</article-id>
    <article-id pub-id-type="publisher-id">102696</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Pan-genomic matching statistics for targeted nanopore sequencing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="au1">
        <name>
          <surname>Ahmed</surname>
          <given-names>Omar</given-names>
        </name>
        <email>oahmed6@jhu.edu</email>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="cor1" ref-type="corresp">∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au2">
        <name>
          <surname>Rossi</surname>
          <given-names>Massimiliano</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">2</xref>
      </contrib>
      <contrib contrib-type="author" id="au3">
        <name>
          <surname>Kovaka</surname>
          <given-names>Sam</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" id="au4">
        <name>
          <surname>Schatz</surname>
          <given-names>Michael C.</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" id="au5">
        <name>
          <surname>Gagie</surname>
          <given-names>Travis</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">3</xref>
      </contrib>
      <contrib contrib-type="author" id="au6">
        <name>
          <surname>Boucher</surname>
          <given-names>Christina</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">2</xref>
      </contrib>
      <contrib contrib-type="author" id="au7">
        <name>
          <surname>Langmead</surname>
          <given-names>Ben</given-names>
        </name>
        <email>langmea@cs.jhu.edu</email>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="fn1" ref-type="fn">4</xref>
        <xref rid="cor2" ref-type="corresp">∗∗</xref>
      </contrib>
      <aff id="aff1"><label>1</label>Department of Computer Science, Johns Hopkins University, Baltimore, MD, USA</aff>
      <aff id="aff2"><label>2</label>Department of Computer and Information Science and Engineering, University of Florida, Gainesville, FL, USA</aff>
      <aff id="aff3"><label>3</label>Faculty of Computer Science, Dalhousie University, Halifax, NS, USA</aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>∗</label>Corresponding author <email>oahmed6@jhu.edu</email></corresp>
      <corresp id="cor2"><label>∗∗</label>Corresponding author <email>langmea@cs.jhu.edu</email></corresp>
      <fn id="fn1">
        <label>4</label>
        <p id="ntpara0010">Lead contact</p>
      </fn>
    </author-notes>
    <pub-date pub-type="pmc-release">
      <day>08</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.-->
    <pub-date pub-type="collection">
      <day>25</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>08</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <volume>24</volume>
    <issue>6</issue>
    <elocation-id>102696</elocation-id>
    <history>
      <date date-type="received">
        <day>22</day>
        <month>3</month>
        <year>2021</year>
      </date>
      <date date-type="rev-recd">
        <day>6</day>
        <month>5</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>6</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2021 The Author(s)</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).</license-p>
      </license>
    </permissions>
    <abstract id="abs0010">
      <title>Summary</title>
      <p>Nanopore sequencing is an increasingly powerful tool for genomics. Recently, computational advances have allowed nanopores to sequence in a targeted fashion; as the sequencer emits data, software can analyze the data in real time and signal the sequencer to eject “nontarget” DNA molecules. We present a novel method called SPUMONI, which enables rapid and accurate targeted sequencing using efficient pan-genome indexes. SPUMONI uses a compressed index to rapidly generate exact or approximate matching statistics in a streaming fashion. When used to target a specific strain in a mock community, SPUMONI has similar accuracy as minimap2 when both are run against an index containing many strains per species. However SPUMONI is 12 times faster than minimap2. SPUMONI's index and peak memory footprint are also 16 to 4 times smaller than those of minimap2, respectively. This could enable accurate targeted sequencing even when the targeted strains have not necessarily been sequenced or assembled previously.</p>
    </abstract>
    <abstract abstract-type="graphical" id="abs0015">
      <title>Graphical abstract</title>
      <fig id="undfig1" position="anchor">
        <graphic xlink:href="fx1"/>
      </fig>
    </abstract>
    <abstract abstract-type="author-highlights" id="abs0020">
      <title>Highlights</title>
      <p>
        <list list-type="simple" id="ulist0010">
          <list-item id="u0010">
            <label>•</label>
            <p id="p0010">SPUMONI uses an efficient pan-genome index to eject nontarget reads from the nanopore</p>
          </list-item>
          <list-item id="u0015">
            <label>•</label>
            <p id="p0015">Read classifications are highly accurate for typical nanopore sequencing error rates</p>
          </list-item>
          <list-item id="u0020">
            <label>•</label>
            <p id="p0020">For larger pan-genomes, SPUMONI is faster and uses less memory than minimap2</p>
          </list-item>
          <list-item id="u0025">
            <label>•</label>
            <p id="p0025">Enables analyses for strains that are missing or poorly represented in databases</p>
          </list-item>
        </list>
      </p>
    </abstract>
    <abstract abstract-type="teaser" id="abs0025">
      <p>Genomics; Biotechnology; Bioinformatics; Biocomputational method</p>
    </abstract>
    <kwd-group id="kwrds0010">
      <title>Subject areas</title>
      <kwd>Genomics</kwd>
      <kwd>Biotechnology</kwd>
      <kwd>Bioinformatics</kwd>
      <kwd>Biocomputational Method</kwd>
    </kwd-group>
  </article-meta>
  <notes>
    <p id="misc0010">Published: June 25, 2021</p>
  </notes>
</front>
<body>
  <sec id="sec1">
    <title>Introduction</title>
    <p id="p0030">Nanopore sequencing instruments have steadily improved in usability, speed, and accuracy. While it lags sequencing-by-synthesis instruments on base quality, quality has improved steadily, with recent data sets reaching and exceeding 90% accuracy (<xref rid="bib16" ref-type="bibr">Wick et al. 2019</xref>). Nanopore sequencing is also convenient and flexible; nanopores are readily used outside of laboratories, for example, for analyzing biological species in a human or natural environment with the goal of detecting pathogens or contaminants. They can also be used for several assays, including DNA sequencing, direct RNA sequencing, and the detection of a variety of epigenetic modifications.</p>
    <p id="p0035">Recent computational approaches focus on the problem of allowing nanopores to sequence in a targeted fashion. Oxford Nanopore instruments provide the “Read Until” interface, enabling two-way communication between the sequencer and the control software. The sequencer reports batches of sequencing data, which software can analyze in real time. Importantly, nanopore sequencing has the unique capability where the control software can potentially signal to the sequencer that it should eject the DNA molecule currently in a pore. To eject, the sequencer reverses the voltage across the pore, causing the molecule to reverse direction and exit. The pore is then free to sequence a new molecule. Many such pores – up to 512 per MinION flowcell – are in simultaneous operation; the system can sequence in a targeted manner only as long as the software making ejection decisions can keep up with the aggregate rate of sequencing.</p>
    <p id="p0040">Recently, Payne et al. described the Readfish system (<xref rid="bib14" ref-type="bibr">Payne et al., 2020</xref>) which combines an existing base caller with the minimap2 read aligner (<xref rid="bib9" ref-type="bibr">Li 2018</xref>) to align reads to a reference genome in real time and make decisions on whether to eject. The UNCALLED method (<xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>) is similar but capable of handing the nanopore current signal directly, without first using a base caller. Unlike Readfish, which generally uses a GPU for base calling, UNCALLED is designed to run on a general-purpose CPU. UNCALLED starts by processing the signal to find potential seeds, then maps them to a reference using an FM-index. Finally, it clusters the seeds to identify significant alignments. UNCALLED's performance degrades as the reference is repetitive, for example, if it is a collection of related strains.</p>
    <p id="p0045">Motivated by a need for faster methods which can classify reads against large, repetitive references, we developed SPUMONI. For example, in a typical metagenomics experiment, the exact strain or substrain of a microorganism is unknown before sequencing, and therefore, for optimal targeted sequencing, all strains and substrains need to be incorporated into the reference for identification. SPUMONI takes advantage of the overall repetitiveness of these references by building an <italic>r</italic>-index (<xref rid="bib12" ref-type="bibr">Mun et al., 2020</xref>) and using the MONI algorithm to calculate matching statistics (MSs) (<xref rid="bib15" ref-type="bibr">Rossi et al., 2021</xref>). The <italic>r</italic>-index enables efficient indexing of repetitive collections of reference genomes – for example, all of the strains of a bacterial species or several human genome assemblies – while still supporting efficient queries. Importantly, the space required by an <italic>r</italic>-index is proportional to the number of runs in the Burrows-Wheeler transform (BWT) of the reference genomes (defined as <italic>r</italic>) rather than the total length of the reference genomes. When the collection is highly repetitive, <italic>r</italic> grows sublinearly and far more slowly than the total length (<xref rid="bib12" ref-type="bibr">Mun et al., 2020</xref>).</p>
    <p id="p0050">MONI augmented the <italic>r</italic>-index with an auxiliary data structure enabling more rapid calculation of MSs. An MS at position <italic>i</italic> of a query sequence <italic>P</italic> of length <italic>m</italic> equals the length of the longest prefix of <inline-formula><mml:math id="M1" altimg="si1.gif"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mn>..</mml:mn><mml:mi>m</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> that exactly matches a sequence in the index. MONI efficiently calculates MSs at every position of a query <italic>P</italic>. The first insight of SPUMONI is that these statistics can be used to classify the query sequence; longer MSs indicate a better approximate match to the index.</p>
    <p id="p0055">SPUMONI extends MONI to improve its speed while also making it applicable to the problem of making fast ejection decisions. First, SPUMONI adds a “null index” together with a hypothesis testing framework to make principled ejection choices depending on whether the observed MS lengths are longer than what would be expected by random chance. Second, SPUMONI replaces MONI's “batch” MS-finding algorithm with a faster online algorithm that calculates a different quantity related to the MS, called the “pseudomatching length (PML),” which we denote as PML (defined in Methods). (SPUMONI stands for Streaming PseUdo MONI.) This optimized PML-finding procedure makes SPUMONI about 3 times faster than MONI, while achieving similar (often greater) accuracy and allowing it to operate on streaming data.</p>
    <p id="p0060">Compared with a minimap2-based approach, SPUMONI can make ejection decisions with respect to a pan-genome index more efficiently. When used to eject bacterial strains in a mock community scenario, SPUMONI has similar accuracy as minimap2 but is about 12 times faster. Moreover, its many-strain index is about one-sixteenth the size of minimap2's, and its memory footprint is less than one-fourth the size of minimap2's. When used to eject simulated human reads in a human microbiome scenario, SPUMONI is faster than minimap2 when both use an index consisting of 3 high-quality human reference genomes. In this scenario, SPUMONI's memory footprint and index size are higher, although the sublinear scaling of the <italic>r</italic>-index strategy underlying SPUMONI suggests it will benefit from indexes containing many human genomes.</p>
  </sec>
  <sec id="sec2">
    <title>Results</title>
    <sec id="sec2.1">
      <title>Method overview</title>
      <p id="p0065">SPUMONI's core insight is that a read's MSs with respect to an index can reveal whether it has a “good” (i.e., long, high identity) approximate match to the index, without having to perform a more costly read alignment. To determine whether the MSs are long enough to indicate an approximate match, SPUMONI compares the observed distribution of MSs – calculated with respect to a “positive index” containing the target sequences – with those obtained from a “null index” containing the reverse (not the reverse complement) of the sequences from the positive index. The reverse sequences serve as a random sequence of the same length as the positive index but where nucleotide frequencies and simple repeat structures such as homopolymers are preserved. As soon as SPUMONI can confidently determine the distributions of MSs from the positive and null indexes are different – possibly having seen only a prefix of the read's full sequence – it can conclude that the read is among the targets in the positive index. SPUMONI uses a Kolmogorov-Smirnov statistic (KS-stat) threshold to make this decision.</p>
      <p id="p0070">By default, SPUMONI does not generate true matching statistics but instead generates an approximation thereof called PMLs. These are described in more detail in Methods. SPUMONI can also generate MSs, which it does in its SPUMONI-ms mode.</p>
    </sec>
    <sec id="sec2.2">
      <title>Experimental setup</title>
      <p id="p0075">During nanopore sequencing, electrical current data are transmitted from the sequencing instrument to the control software in “chunks,” representing about 0.4 s of sequencing (the exact duration is user-defined parameter). As DNA translocates through the pore at about 450 bases per s, each chunk represents about 180 bases of data. Our experiments on both simulated and real reads mimic the situation where we are processing the first 4 chunks of data delivered by the Read Until API. We chose this time interval as previous work showed it leads to most reads being mapped using minimap2 (<xref rid="bib14" ref-type="bibr">Payne et al., 2020</xref>; <xref rid="bib9" ref-type="bibr">Li 2018</xref>). We further assume that the data were already base-called, similar to a previous study (<xref rid="bib14" ref-type="bibr">Payne et al., 2020</xref>). In practice, the Read Until API delivers batches of current signal, not bases; we address this further in the Discussion. We did not compare our method with UNCALLED (<xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>) as it is reportedly slower than minimap2 for large genomes and it starts by processing the current signal, where as we have assumed here that we are given base calls.</p>
      <p id="p0080">With each new batch, both SPUMONI and minimap2 (<xref rid="bib9" ref-type="bibr">Li 2018</xref>) attempt to classify whether the read has an approximate match to a sequence in the positive index. Importantly, SPUMONI deals with new batches of data in an “online” fashion. That is, SPUMONI can easily suspend and resume its MS/PML computation as it awaits a new batch. This is in contrast to minimap2, which takes full reads as an input so as to perform full-read alignments. Because of this, our evaluation strategy was to run SPUMONI on each batch separately, allowing SPUMONI to possibly make an ejection decision at the end of each of the four batches. For minimap2, we reran minimap2 on successively longer prefixes of the read as new 180-base batches arrived.</p>
      <p id="p0085">After processing a batch, SPUMONI and minimap2 each apply a threshold to determine if the read matches the positive index with high confidence. In practice, this leads to a decision about whether to eject the read. If the positive index contains depletion targets, a high-confidence match to the positive index indicates the read should be ejected. If the positive index contains enrichment targets, the absence of a high-confidence match after some prescribed period indicates the read should be ejected. For our experiments, the positive index always contains depletion (rather than enrichment) targets. Once a method has decided to eject the read, we cease delivering batches for that read; each method is benchmarked only on the read prefix up to the ejection decision, or up to 1.6 s (720 bases), whichever comes first.</p>
      <p id="p0090">For the minimap2-based approach, we used the standard ONT settings of minimap2 (<xref rid="bib9" ref-type="bibr">Li 2018</xref>) to align the reads, which are the same settings used by Readfish (<xref rid="bib14" ref-type="bibr">Payne et al., 2020</xref>). We used an MAPQ threshold to decide whether a read was confidently mapped or not. For nonrepetitive (“genomic”) references, we used an MAPQ value of 30 or greater to determine if reads were uniquely mapped or not. For repetitive (“pan-genomic”) references, we further checked whether all alignments were to the same species. For further details on the thresholds used, see Matching statistics with r-index.</p>
      <p id="p0095">For evaluation, an instance where a method ejected a read from a genome that was present in the positive index was called a true positive. An instance where a method ejected a read that was not in the positive index was called a false positive. An instance where a method failed to eject a read that was from a positive-index genome was called a false negative.</p>
      <p id="p0100">We performed all the experiments on a computer with a 2.0 GHz Intel Xeon(R) CPU (E7-4830 v4) with 1056 GB of memory. Each tool was run with a single thread, and we recorded the wall clock time and the peak Resident Set Size (RSS) reported by the individual tools. We compared these with the output from GNU time 1.7 program and found no discrepancies.</p>
    </sec>
    <sec id="sec2.3">
      <title>Evaluations with mock community</title>
      <p id="p0105">We considered a real data set consisting of Oxford Nanopore reads from the ZymoBIOMICS High-Molecular-Weight DNA Mock Microbial community (ZymoMC). We also used a simulated data set of Oxford-like reads derived from the same genomes, but with a software-controlled error rate. The ZymoMC consists of seven bacterial species – <italic>Enterococcus faecalis</italic>, <italic>Listeria monocytogenes</italic>, <italic>Bacillus subtilis</italic>, <italic>Salmonella enterica</italic>, <italic>Escherichia coli</italic>, <italic>Staphylococcus aureus,</italic> and <italic>Pseudomonas aeruginosa</italic> – as well as <italic>Saccharomyces cerevisiae</italic> (yeast). As in prior studies (<xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>; <xref rid="bib14" ref-type="bibr">Payne et al., 2020</xref>), we supposed that our goal was to deplete the bacterial reads, leading to proportionally more yeast reads sequenced.</p>
      <sec id="sec2.3.1">
        <title>Assessing genomic versus pan-genomic indexes</title>
        <p id="p0110">We hypothesized that a pan-genome index – consisting of many related strains – would allow us to both (a) target a particular strain for depletion or enrichment when that specific strain is not present in the index and (b) target a species as a whole by including many relevant strains or individuals from that species in the index. More specifically, we used the ZymoMC data and supposed that the seven bacterial strains were depletion targets (as in prior work [<xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>; <xref rid="bib14" ref-type="bibr">Payne et al., 2020</xref>]). We assessed the following four strategies: (a) “One Genome w/o Zymo Mock Refs,” a single random strain from each of the seven bacterial species in ZymoMC, not matching the particular strain targeted for depletion; (b) “One Genome with Zymo Mock Refs,” the exact seven strains targeted for depletion; (c) “Pan-genome w/o Zymo Mock Refs,” all RefSeq strains for each bacterial species in ZymoMC but excluding the depletion targets; and (d) “Pan-genome with Zymo Mock Refs,” all RefSeq strains for each bacterial species in ZymoMC including the depletion targets.</p>
        <p id="p0115"><xref rid="tbl1" ref-type="table">Table 1</xref> shows that using an index containing many strains but excluding the specific depletion target yields a similar F1-score (99.7% for SPUMONI and minimap2) compared with when we use an index consisting only of the depletion target (99.1% for minimap2, 99.8% for SPUMONI). The F1 score remained unchanged when the pan-genome index was used.<table-wrap position="float" id="tbl1"><label>Table 1</label><caption><p>Assessing SPUMONI and minimap2 using both genomic and pan-genomic indexes</p></caption><table frame="hsides" rules="groups"><thead><tr><th colspan="13">Accuracy on simulated mock community reads at 90% accuracy with indices of different size<hr/></th></tr><tr><th>Reference:<hr/></th><th colspan="3">One genome w/o Zymo mock refs.<hr/></th><th colspan="3">One genome with Zymo mocks refs.<hr/></th><th colspan="3">Pan-genome w/o Zymo mock refs.<hr/></th><th colspan="3">Pan-genome with Zymo mock refs.<hr/></th></tr><tr><th>Reference size:<hr/></th><th>58 MB<hr/></th><th>58 MB<hr/></th><th>29 MB<hr/></th><th>56 MB<hr/></th><th>56 MB<hr/></th><th>28 MB<hr/></th><th>31 GB<hr/></th><th>31 GB<hr/></th><th>16 GB<hr/></th><th>31 GB<hr/></th><th>31 GB<hr/></th><th>16 GB<hr/></th></tr><tr><th>Approach:</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th></tr></thead><tbody><tr><td>Accuracy</td><td align="char">78.28</td><td align="char">88.32</td><td align="char">90.76</td><td align="char">96.52</td><td align="char">99.55</td><td align="char">98.31</td><td align="char">94.48</td><td align="char">99.50</td><td align="char">99.50</td><td align="char">94.48</td><td align="char">99.50</td><td align="char">99.50</td></tr><tr><td>Precision</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td></tr><tr><td>Recall</td><td align="char">87.15</td><td align="char">87.97</td><td align="char">90.48</td><td align="char">96.42</td><td align="char">99.54</td><td align="char">98.26</td><td align="char">94.32</td><td align="char">99.49</td><td align="char">99.49</td><td align="char">94.32</td><td align="char">99.49</td><td align="char">99.49</td></tr><tr><td>Specificity</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td><td align="char">100.00</td></tr><tr><td>F1-score</td><td align="char">93.13</td><td align="char">93.13</td><td align="char">95.00</td><td align="char">98.18</td><td align="char">99.77</td><td align="char">99.12</td><td align="char">97.08</td><td align="char">99.74</td><td align="char">99.74</td><td align="char">97.08</td><td align="char">99.74</td><td align="char">99.74</td></tr></tbody></table><table-wrap-foot><fn><p>“SPUMONI” refers to the mode that uses PMLs, while SPUMONI-ms refers to the mode that uses matching statistics instead.</p></fn></table-wrap-foot></table-wrap></p>
        <p id="p0120">We conclude that a pan-genome index is a flexible tool for targeted sequencing, enabling targeting both at higher taxonomic levels and in situations where the particular target strain has not been assembled or is unknown. In subsequent experiments, we continued to assess both a single-strain index (“One Genome w/o Zymo Mock Refs”) and a pan-genomic index (“Pan-Genome w/o Zymo Mock Refs”), focusing only on the indexes that exclude the target strain.</p>
      </sec>
      <sec id="sec2.3.2">
        <title>Simulated mock community: accuracy and efficiency</title>
        <p id="p0125">To assess these methods in the presence of sequencing error, we used PBSIM2 (<xref rid="bib13" ref-type="bibr">Ono et al. 2020</xref>) to simulate Oxford-Nanopore-like reads (R9.4 chemistry) from ZymoMC references at varying levels of mean read accuracy (%): 85, 90, 95, and 98. We again supposed that our goal was to eject reads from the seven bacterial strains so as to obtain proportionally more reads from the yeast. The proportions of reads simulated from each genome were set to mimic those from the UNCALLED study (<xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>) (<xref rid="mmc1" ref-type="supplementary-material">Figure S1</xref>). <xref rid="fig1" ref-type="fig">Figure 1</xref> shows that as the error rate decreases, the distribution of matching statistics from the positive index gains a heavier right tail; that is, the half-maximal exact matches become longer because they are interrupted less often by sequencing errors.<fig id="fig1"><label>Figure 1</label><caption><p>Distribution of matching statistics from positive and null indexes on simulated ZymoMC reads at accuracies of (A) 85%, (B) 90%, (C) 95%, and (D) 98%. Each plot contains the density curves for the first 720 bases (<inline-formula><mml:math id="M2" altimg="si6.gif"><mml:mrow><mml:mo linebreak="goodbreak" linebreakstyle="after">∼</mml:mo></mml:mrow></mml:math></inline-formula> 1.6 s) for three randomly chosen simulated <italic>Escherichia coli</italic> reads.</p></caption><graphic xlink:href="gr1"/></fig></p>
        <p id="p0130">We next compared SPUMONI with a minimap2-based approach, using the reads' true simulated point of origin as the ground truth. As seen in <xref rid="tbl2" ref-type="table">Table 2</xref>, SPUMONI's F1 score – and several related measures – increase as read accuracy increases. For reads at 90% accuracy and greater, SPUMONI's pan-genome index achieved <inline-formula><mml:math id="M3" altimg="si2.gif"><mml:mrow><mml:mo linebreak="goodbreak" linebreakstyle="after">≥</mml:mo></mml:mrow></mml:math></inline-formula> 99.7% F1, which was comparable with and sometimes greater than minimap2's pan-genome F1 scores. For both tools, the pan-genomic index substantially increased the F1 score, which is consistent with our results (Assessing genomic versus pan-genomic indexes).<table-wrap position="float" id="tbl2"><label>Table 2</label><caption><p>Comparing SPUMONI and minimap2 across various metrics on simulated ZymoMC reads of varying levels of accuracy</p></caption><table frame="hsides" rules="groups"><thead><tr><th colspan="13">Accuracy, throughput, and index size on simulated mock community reads at various level of accuracy<hr/></th></tr><tr><th>Read accuracy (%):<hr/></th><th colspan="6">85<hr/></th><th colspan="6">90<hr/></th></tr><tr><th>Reference:<hr/></th><th colspan="3">One genome ref<hr/></th><th colspan="3">Pan-genome ref<hr/></th><th colspan="3">One genome ref<hr/></th><th colspan="3"><bold>Pan-genome ref</bold><hr/></th></tr><tr><th>Reference size:<hr/></th><th>56 MB<hr/></th><th>56 MB<hr/></th><th>28 MB<hr/></th><th>31 GB<hr/></th><th>31 GB<hr/></th><th>16 GB<hr/></th><th>56 MB<hr/></th><th>56 MB<hr/></th><th>28 MB<hr/></th><th>31 GB<hr/></th><th>31 GB<hr/></th><th>16 GB<hr/></th></tr><tr><th>Approach:</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th></tr></thead><tbody><tr><td>Accuracy</td><td>56.21</td><td>83.35</td><td>87.53</td><td>70.08</td><td>95.43</td><td>99.16</td><td>78.28</td><td>88.32</td><td>90.76</td><td>94.48</td><td>99.50</td><td>99.50</td></tr><tr><td>Precision</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td></tr><tr><td>Recall</td><td>54.89</td><td>82.85</td><td>87.15</td><td>69.18</td><td>95.29</td><td>99.13</td><td>87.15</td><td>87.97</td><td>90.48</td><td>94.32</td><td>99.49</td><td>99.49</td></tr><tr><td>Specificity</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td></tr><tr><td>F1-score</td><td>70.88</td><td>90.62</td><td>93.13</td><td>81.78</td><td>97.59</td><td>99.56</td><td>93.13</td><td>93.13</td><td>95.00</td><td>97.08</td><td>99.74</td><td>99.74</td></tr><tr><td>Peak RSS (GB)</td><td>0.63</td><td>0.08</td><td>0.17</td><td>6.24</td><td>1.90</td><td>8.07</td><td>0.63</td><td>0.08</td><td>0.17</td><td>6.24</td><td>1.90</td><td>8.07</td></tr><tr><td>Index size (GB)<xref rid="tblfn1" ref-type="table-fn">a</xref></td><td>0.68</td><td>0.09</td><td>0.10</td><td>6.20</td><td>1.90</td><td>31.00</td><td>0.68</td><td>0.09</td><td>0.10</td><td>6.20</td><td>1.90</td><td>31.00</td></tr><tr><td>Throughput (bp/s)</td><td>134,690</td><td>614,665</td><td>398,415</td><td>28,731</td><td>111,813</td><td>6,441</td><td>177,572</td><td>709,018</td><td>409,104</td><td>33,829</td><td>125,914</td><td>6,617</td></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th>Read accuracy (%):<hr/></th><th colspan="6">95<hr/></th><th colspan="6">99<hr/></th></tr><tr><th>Reference:<hr/></th><th colspan="3">One genome ref<hr/></th><th colspan="3">Pan-genome ref<hr/></th><th colspan="3">One genome ref<hr/></th><th colspan="3">Pan-genome ref<hr/></th></tr><tr><th>Reference size:<hr/></th><th>56 MB<hr/></th><th>56 MB<hr/></th><th>28 MB<hr/></th><th>31 GB<hr/></th><th>31 GB<hr/></th><th>16 GB<hr/></th><th>56 MB<hr/></th><th>56 MB<hr/></th><th>28 MB<hr/></th><th>31 GB<hr/></th><th>31 GB<hr/></th><th>16 GB<hr/></th></tr><tr><th>Approach:</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th></tr></thead><tbody><tr><td>Accuracy</td><td>86.48</td><td>91.00</td><td>90.86</td><td>99.60</td><td>99.65</td><td>99.40</td><td>89.76</td><td>92.20</td><td>91.30</td><td>99.65</td><td>99.60</td><td>99.50</td></tr><tr><td>Precision</td><td>100.00</td><td>99.94</td><td>100.00</td><td>100.00</td><td>99.95</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>99.95</td><td>100.00</td></tr><tr><td>Recall</td><td>86.07</td><td>90.78</td><td>90.58</td><td>99.59</td><td>99.69</td><td>99.39</td><td>89.45</td><td>91.96</td><td>91.04</td><td>99.64</td><td>99.64</td><td>99.49</td></tr><tr><td>Specificity</td><td>100.00</td><td>98.31</td><td>100.00</td><td>100.00</td><td>98.31</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>98.31</td><td>100.00</td></tr><tr><td>F1-score</td><td>92.52</td><td>95.14</td><td>95.06</td><td>99.80</td><td>99.82</td><td>99.69</td><td>94.43</td><td>95.81</td><td>95.31</td><td>99.82</td><td>99.80</td><td>99.74</td></tr><tr><td>Peak RSS (GB)</td><td>0.63</td><td>0.08</td><td>0.17</td><td>6.24</td><td>1.90</td><td>8.07</td><td>0.63</td><td>0.08</td><td>0.17</td><td>6.24</td><td>1.90</td><td>8.07</td></tr><tr><td>Index size (GB)<xref rid="tblfn1" ref-type="table-fn">a</xref></td><td>0.68</td><td>0.09</td><td>0.10</td><td>6.20</td><td>1.90</td><td>31.00</td><td>0.68</td><td>0.09</td><td>0.10</td><td>6.20</td><td>1.90</td><td>31.00</td></tr><tr><td>Throughput (bp/s)</td><td>209,163</td><td>790,409</td><td>425,320</td><td>37,130</td><td>135,463</td><td>6,672</td><td>235,712</td><td>928,459</td><td>479,523</td><td>38,556</td><td>129,574</td><td>6,259</td></tr></tbody></table><table-wrap-foot><fn id="tblfn1"><label>a</label><p id="ntpara0015">The reported index size for SPUMONI-ms and SPUMONI includes only the positive index and not the null index because the null index can be used offline and deleted before the analysis.</p></fn></table-wrap-foot></table-wrap></p>
        <p id="p0135">Considering throughput as measured in base pairs processed per s (bp/sec), SPUMONI is on average about 19.3 times faster than minimap2 when using the pan-genomic index and about 1.8 times faster using the genomic index, and this is visualized in <xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>. Furthermore, SPUMONI's pan-genomic index is about 16 times smaller than minimap2's, and SPUMONI's peak memory footprint is about 4 times lower.</p>
      </sec>
      <sec id="sec2.3.3">
        <title>Real mock community: accuracy and efficiency</title>
        <p id="p0140">Next, we applied our method to real nanopore reads from ZymoMC, obtained from SRA accession SRX7711546 (<xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>). When we plotted the distribution of matching statistics obtained from reads from different species, we observed that the distributions were quite distinct for the bacterial reads, but overlapping for the yeast (<xref rid="mmc1" ref-type="supplementary-material">Figure S3</xref>). This visualization shows how SPUMONI can distinguish between reads that it will try to eject and reads that it will let pass through the pore, and this difference can be statistically shown by differences in the KS-stat between the bacterial reads and the yeast reads (<xref rid="mmc1" ref-type="supplementary-material">Figure S4</xref>).</p>
        <p id="p0145">We compared SPUMONI with minimap2, this time using a separately obtained minimap2 mapping as the gold standard. Specifically, we used minimap2 to map a suffix of the read, omitting the first 720 bases. To ensure the reads were long enough to enable an accurate mapping, we first filtered out reads that were shorter than 4,000 bp. We also trimmed the first 720 bases from each read before performing the gold-standard alignment because these bases are used for classification later. Gold-standard labels were given only to reads that minimap2 could uniquely map to a ZymoMC reference with an MAPQ of <inline-formula><mml:math id="M4" altimg="si2.gif"><mml:mrow><mml:mo linebreak="goodbreak" linebreakstyle="after">≥</mml:mo></mml:mrow></mml:math></inline-formula> 30. For reads that had at least one secondary alignment, we required that the ratio of the secondary alignment's MAPQ to the primary alignment's MAPQ was <inline-formula><mml:math id="M5" altimg="si3.gif"><mml:mrow><mml:mo linebreak="goodbreak" linebreakstyle="after">≤</mml:mo></mml:mrow></mml:math></inline-formula> 0.60.</p>
        <p id="p0150">Results in <xref rid="tbl3" ref-type="table">Table 3</xref> show that SPUMONI achieved similar F1 score as minimap2. For the genomic (“One Genome”) reference, SPUMONI achieved 92.79% F1 score, whereas minimap2 achieved 93.42% F1 score. Both tools achieved 100% precision and specificity in this case. For the pan-genomic (“Pan-genome”) reference, SPUMONI achieved 97.94% F1 score, whereas minimap2 achieved 98.73%. In this case, SPUMONI achieved 100% precision and specificity, whereas minimap2 achieved 99.96% precision and 96.97% specificity.<table-wrap position="float" id="tbl3"><label>Table 3</label><caption><p>Comparing SPUMONI and minimap2 across various metrics on Real ZymoMC Reads</p></caption><table frame="hsides" rules="groups"><thead><tr><th colspan="7">Accuracy, throughput and index size on real mock community reads<hr/></th></tr><tr><th>Reference:<hr/></th><th colspan="3">One genome ref<hr/></th><th colspan="3">Pan-genome ref<hr/></th></tr><tr><th>Reference size:<hr/></th><th>56 MB<hr/></th><th>56 MB<hr/></th><th>28 MB<hr/></th><th>31 GB<hr/></th><th>31 GB<hr/></th><th>16 GB<hr/></th></tr><tr><th>Approach:</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th></tr></thead><tbody><tr><td>Accuracy</td><td>81.64</td><td>86.72</td><td>87.82</td><td>94.62</td><td>96.02</td><td>97.52</td></tr><tr><td>Precision</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>99.96</td></tr><tr><td>Recall</td><td>81.39</td><td>86.54</td><td>87.66</td><td>94.55</td><td>95.97</td><td>97.53</td></tr><tr><td>Specificity</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>100.00</td><td>96.97</td></tr><tr><td>F1-score</td><td>89.74</td><td>92.79</td><td>93.42</td><td>97.20</td><td>97.94</td><td>98.73</td></tr><tr><td>Peak RSS (GB)</td><td>0.63</td><td>0.08</td><td>0.17</td><td>6.24</td><td>1.90</td><td>8.07</td></tr><tr><td>Index size (GB)<xref rid="tblfn2" ref-type="table-fn">a</xref></td><td>0.68</td><td>0.09</td><td>0.10</td><td>6.20</td><td>1.90</td><td>31.00</td></tr><tr><td>Throughput (bp/s)</td><td>252,974</td><td>901,609</td><td>851,869</td><td>64,384</td><td>185,618</td><td>15,570</td></tr></tbody></table><table-wrap-foot><fn id="tblfn2"><label>a</label><p id="ntpara0020">The index sizes for SPUMONI-ms and SPUMONI are only for the positive index because the null index can be used offline and removed.</p></fn></table-wrap-foot></table-wrap></p>
        <p id="p0155">When using the pan-genome reference, SPUMONI achieved a throughput about 11.9 times higher than that of minimap2. While when using the genomic index, SPUMONI achieved slightly higher throughput than minimap2 (902 kbp/s versus 852 kpb/s). When measuring peak RSS, we observed that SPUMONI's memory footprint was about one-fourth that of minimap2 and that its index was about 16 times smaller.</p>
      </sec>
    </sec>
    <sec id="sec2.4">
      <title>Human microbiome</title>
      <p id="p0160">Finally, we assessed our method on a human microbiome sequencing scenario with the goal of ejecting reads from the human host to enrich for any microbial species present. We constructed a data set consisting of a mixture of real reads from a recent human microbiome study that used Oxford Nanopore sequencing (<xref rid="bib11" ref-type="bibr">Moss et al., 2020</xref>), as well as a set of simulated human nanopore-like reads with a mean read accuracy of 90%. Likely human reads were already filtered out of the former data set; therefore, we assumed that the only human reads in the final read set are the simulated ones. Because a human genome assembly is on the order of 3 billion nucleotides, an index containing one or more human assemblies presents a significantly larger but relevant challenge.</p>
      <p id="p0165">When we visualized the distribution of matching statistics for reads from different species (<xref rid="fig2" ref-type="fig">Figure 2</xref>), we saw the simulated human reads appeared to match the positive index (evidenced by the blue densities' thicker right tails), whereas reads from the microbiome study did not (indicated by the similarity of positive and null distributions).<fig id="fig2"><label>Figure 2</label><caption><p>Distribution of matching statistics across three randomly chosen reads from (A) the human simulation and (B) the microbiome study (<xref rid="bib11" ref-type="bibr">Moss et al. 2020</xref>). A single curve represents the first 720 bases (<inline-formula><mml:math id="M6" altimg="si6.gif"><mml:mrow><mml:mo linebreak="goodbreak" linebreakstyle="after">∼</mml:mo></mml:mrow></mml:math></inline-formula> 1.6 Read Until seconds) of a read.</p></caption><graphic xlink:href="gr2"/></fig></p>
      <p id="p0170">We evaluated SPUMONI and minimap2 on this data set using two different indexes: (a) an index consisting only of the telomere-to-telomere consortium (“T2T”) CHM13 (<xref rid="bib10" ref-type="bibr">Miga et al., 2020</xref>) and (b) an index consisting of the T2T assembly together with the Ashkenazi (<xref rid="bib17" ref-type="bibr">Zimin et al., 2020</xref>) and GRCh38 (<xref rid="bib3" ref-type="bibr">Church et al., 2015</xref>) assemblies. Indexing multiple human genomes allows us to achieve similar benefits as we did for the mock-community pan-genomes, that is, coverage of a wider range of genetic variation, particularly structural variation. It also helps to reduce reference bias, which in our case would manifest as a tendency to find shorter matches in genomic regions with nonreference alleles.</p>
      <p id="p0175">When using the single-genome index, SPUMONI achieved somewhat higher F1 score (96.97%) than minimap2 (95.17%), and lower throughput (24.5 versus 35.7 kpb/s). When using the 3-genome index, minimap2 achieved higher F1 score (99.17%) than SPUMONI (97.08%), but SPUMONI had higher throughput (27.0 versus 13.5 kbp/src), which is shown in <xref rid="tbl4" ref-type="table">Table 4</xref>. As the reference became more repetitive – moving from one to 3 genomes – SPUMONI gained an index-size advantage, using 18 GB versus minimap2's 21 GB for the 3-genome index. While this comparison between SPUMONI and minimap2 is close, we expect that as we are able to index and align to more human references simultaneously – for example, as more assemblies from the Human Pangenome Reference Consortium (<xref rid="bib7" ref-type="bibr">Human Pangenome Reference, 2021</xref>) and similar projects emerge — SPUMONI is well positioned for sublinear index growth and a greater throughput advantage. For instance, the <italic>r</italic>-index underlying SPUMONI was previously shown to be able to index up to 10 human genomes with sublinear growth in the index size (<xref rid="bib12" ref-type="bibr">Mun et al., 2020</xref>).<table-wrap position="float" id="tbl4"><label>Table 4</label><caption><p>Comparing SPUMONI and minimap2 on various metrics when processing the human microbiome reads</p></caption><table frame="hsides" rules="groups"><thead><tr><th colspan="7">Accuracy, throughput and index size on human microbiome reads<hr/></th></tr><tr><th>Reference:<hr/></th><th colspan="3">One human genome<hr/></th><th colspan="3">Three human genomes<hr/></th></tr><tr><th>Reference size:<hr/></th><th>5.8 GB<hr/></th><th>5.8 GB<hr/></th><th>2.9 GB<hr/></th><th>18.0 GB<hr/></th><th>18.0 GB<hr/></th><th>9.0 GB<hr/></th></tr><tr><th>Approach:</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th><th>SPUMONI-ms</th><th>SPUMONI</th><th>minimap2</th></tr></thead><tbody><tr><td>Accuracy</td><td>98.66</td><td>99.42</td><td>99.10</td><td align="char">98.64</td><td>99.44</td><td>99.84</td></tr><tr><td>Precision</td><td>95.46</td><td>98.93</td><td>100.00</td><td align="char">95.06</td><td>98.73</td><td>100.00</td></tr><tr><td>Recall</td><td>90.57</td><td>95.08</td><td>90.78</td><td align="char">90.78</td><td>95.49</td><td>98.36</td></tr><tr><td>Specificity</td><td>99.54</td><td>99.89</td><td>100.00</td><td align="char">99.49</td><td>99.87</td><td>100.00</td></tr><tr><td>F1-score</td><td>92.96</td><td>96.97</td><td>95.17</td><td align="char">92.87</td><td>97.08</td><td>99.17</td></tr><tr><td>Peak RSS (GB)</td><td>57.29</td><td>15.23</td><td>7.85</td><td align="char">62.80</td><td>18.06</td><td>9.70</td></tr><tr><td>Index size (GB)<xref rid="tblfn3" ref-type="table-fn">a</xref></td><td>57.90</td><td>15.00</td><td>6.90</td><td align="char">62.60</td><td>18.00</td><td>21.00</td></tr><tr><td>Throughput (bp/s)</td><td>7,518</td><td>24,476</td><td>35,742</td><td align="char">6.860</td><td>27,024</td><td>13,549</td></tr></tbody></table><table-wrap-foot><fn id="tblfn3"><label>a</label><p id="ntpara0025">The index sizes for SPUMONI-ms and SPUMONI are only for the positive index because the null index can be used offline and removed.</p></fn></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="sec3">
    <title>Discussion</title>
    <p id="p0180">SPUMONI is a streaming algorithm for targeted nanopore sequencing that uses matching statistics (and “PMLS”) to classify reads in real time. SPUMONI's data structures – the <italic>r</italic>-index and MONI thresholds – allow it to handle repetitive pan-genome indexes more efficiently than competing approaches. SPUMONI's memory efficiency combines well with the flexibility afforded by nanopore sequencing, allowing SPUMONI to run on more portable hardware, like that associated with MinION and Flongle instruments. The ability to include a wide array of strains in a single index makes SPUMONI attractive for metagenomics applications where targets may not have already been cultured, assembled, and deposited in a resource like Refseq. As nanopore sequencing continues to improve, both base-calling accuracy and per-instruction throughput will likely improve. SPUMONI is well positioned for these trends because it delivers its most advantageous combinations of speed and F1 score at higher base-calling accuracy.</p>
    <p id="p0185">SPUMONI operates on batches of already-called bases. In practice, the Read Until API delivers data in the form of raw current that must be base-called first. Because nanopore base callers have been steadily improving, it is possible that base calling will be integrated into onboard components of nanopore sequencers. Until then, users must run a separate base caller upstream of SPUMONI, as also required by Readfish (<xref rid="bib14" ref-type="bibr">Payne et al., 2020</xref>). That said, the fact that SPUMONI's analysis is at the level of bases allows it to target other classification problems, such as metagenomics classification.</p>
    <p id="p0190">While SPUMONI's null index currently consists of the reverse of the sequences used in the positive index, this notion of “null” might be insufficient in some scenarios. For example, if there is substantial sequence similarity between depletion-target reads and reads that should not be targeted for depletion – for example, owing to conserved genes between species – the positive MSs within those sequences will be longer than what is expected by random chance for depletion-target reads. In these cases, we may need to augment the null model, perhaps by including the conserved sequences (not their reverses) in the null index.</p>
    <p id="p0195">Currently, we use the same KS-stat threshold for all the experiments which was optimized to perform well on real nanopore data sets. However, we expect that the optimal threshold will also be a function of the read accuracy and the reference used. In future work, we will investigate whether a simulation could be used to model the sequencing run to determine a threshold that is more tailored to a particular experiment.</p>
    <p id="p0200">Finally, we observed that SPUMONI can compress reads as it processes them: we can simply output each PML followed by the character in the read that did not match the corresponding character in the <inline-formula><mml:math id="M7" altimg="si4.gif"><mml:mrow><mml:mtext>BWT</mml:mtext></mml:mrow></mml:math></inline-formula>; to decompress the read, we recover the characters that matched (and caused the PML to increment) using <inline-formula><mml:math id="M8" altimg="si5.gif"><mml:mrow><mml:mtext>LF</mml:mtext></mml:mrow></mml:math></inline-formula> steps until we reach the mismatch character, at which point we jump to the previous or next occurrence of that character in the <inline-formula><mml:math id="M9" altimg="si4.gif"><mml:mrow><mml:mtext>BWT</mml:mtext></mml:mrow></mml:math></inline-formula>, as we did while compressing the read. Because the compressing ratio of this scheme improves with larger PMLs, we may be able to use that compression ratio as an aggregate statistic when deciding whether to eject a read. Finally, we note that in some sense, this compression scheme works by predicting the characters in the reads and recording explicitly those characters it predicts incorrectly.</p>
    <sec id="sec3.1">
      <title>Limitations of study</title>
      <p id="p0205">One major limitation of the SPUMONI approach currently is the fact that it operates on sequences of bases opposed to the batches of signal that are delivered by the Read Until API. Future work on SPUMONI will be aimed toward allowing it to accept electrical signal directly and interact with the Read Until API for it to be deployed as control software on a nanopore sequencer.</p>
      <p id="p0210">An additional limitation of our current approach is the limited performance improvement when SPUMONI focuses on human reads (Human microbiome) opposed to microbial reads (Evaluations with mock community). Our experiments show that SPUMONI's peak RSS for three human genomes is about 1.86X larger than the minimap2's peak RSS. SPUMONI's throughput when indexing those same three human genomes is only about 2X faster than minimap2's throughput. However, as the experiments in the Human microbiome section seem to indicate, we expect our throughput advantage to improve as the number of human genomes in the reference increases.</p>
    </sec>
  </sec>
  <sec id="sec4">
    <title>STAR★methods</title>
    <sec id="sec4.1">
      <title>Key resources table</title>
      <p id="p0215">
        <table-wrap position="float" id="undtbl1">
          <table frame="hsides" rules="groups">
            <thead>
              <tr>
                <th>REAGENT or RESOURCE</th>
                <th>SOURCE</th>
                <th>IDENTIFIER</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="3">
                  <bold>Deposited data</bold>
                </td>
              </tr>
              <tr>
                <td colspan="3">
                  <hr/>
                </td>
              </tr>
              <tr>
                <td>ZymoMC sequencing reads</td>
                <td>
                  <xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>
                </td>
                <td>
                  <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/sra/SRX7711546[accn]" id="intref0010">https://www.ncbi.nlm.nih.gov/sra/SRX7711546[accn]</ext-link>
                </td>
              </tr>
              <tr>
                <td>Human Bacterial Microbiome sequencing reads</td>
                <td>
                  <xref rid="bib11" ref-type="bibr">Moss et al., 2020</xref>
                </td>
                <td>
                  <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/sra/SRX6602475[accn]" id="intref0015">https://www.ncbi.nlm.nih.gov/sra/SRX6602475[accn]</ext-link>
                </td>
              </tr>
              <tr>
                <td>Telomere-to-Telemere Consortium CHM13 v1.0 assembly</td>
                <td>
                  <xref rid="bib10" ref-type="bibr">Miga et al., 2020</xref>
                </td>
                <td>
                  <ext-link ext-link-type="uri" xlink:href="https://github.com/marbl/CHM13" id="intref0020">https://github.com/marbl/CHM13</ext-link>
                </td>
              </tr>
              <tr>
                <td>Ashkenazi assembly</td>
                <td>
                  <xref rid="bib17" ref-type="bibr">Zimin et al., 2020</xref>
                </td>
                <td>
                  <ext-link ext-link-type="uri" xlink:href="https://github.com/AshkenaziGenome/Assembly/" id="intref0025">https://github.com/AshkenaziGenome/Assembly/</ext-link>
                </td>
              </tr>
              <tr>
                <td>GRCh38 assembly</td>
                <td>
                  <xref rid="bib3" ref-type="bibr">Church et al., 2015</xref>
                </td>
                <td>
                  <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/assembly/GCF_000001405.26/" id="intref0030">https://www.ncbi.nlm.nih.gov/assembly/GCF_000001405.26/</ext-link>
                </td>
              </tr>
              <tr>
                <td colspan="3">
                  <hr/>
                </td>
              </tr>
              <tr>
                <td colspan="3">
                  <bold>Software and algorithms</bold>
                </td>
              </tr>
              <tr>
                <td colspan="3">
                  <hr/>
                </td>
              </tr>
              <tr>
                <td>SPUMONI software</td>
                <td>This paper</td>
                <td>
                  <ext-link ext-link-type="uri" xlink:href="https://github.com/oma219/spumoni" id="intref0035">https://github.com/oma219/spumoni</ext-link>
                </td>
              </tr>
              <tr>
                <td>PBSIM2</td>
                <td>
                  <xref rid="bib13" ref-type="bibr">Ono et al., 2020</xref>
                </td>
                <td>
                  <ext-link ext-link-type="uri" xlink:href="https://github.com/yukiteruono/pbsim2" id="intref0040">https://github.com/yukiteruono/pbsim2</ext-link>
                </td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
      </p>
    </sec>
    <sec id="sec4.2">
      <title>Resource availability</title>
      <sec id="sec4.2.1">
        <title>Lead contact</title>
        <p id="p0220">Requests for further information and resources should be directed to the Lead Contact, Ben Langmead (<ext-link ext-link-type="uri" xlink:href="mailto:langmea@cs.jhu.edu" id="intref0045">langmea@cs.jhu.edu</ext-link>).</p>
      </sec>
      <sec id="sec4.2.2">
        <title>Materials availability</title>
        <p id="p0225">This study did not generate any new materials.</p>
      </sec>
      <sec sec-type="data-availability" id="sec4.2.3">
        <title>Data and code availability</title>
        <p id="p0230">SPUMONI is an open-source software available at <ext-link ext-link-type="uri" xlink:href="https://github.com/oma219/spumoni" id="intref0050">https://github.com/oma219/spumoni</ext-link>. The SPUMONI indexes used for each experiment can be obtained from: <ext-link ext-link-type="uri" xlink:href="https://benlangmead.github.io/aws-indexes/spumoni" id="intref0055">https://benlangmead.github.io/aws-indexes/spumoni</ext-link>.</p>
        <p id="p0235">For the “Pan-genome Reference” collection in the Assessing genomic versus pan-genomic indexes section, we used all available genomes for each bacterial species of the ZymoMC in the RefSeq Database. Accession numbers for the bacterial genomes can be downloaded at <ext-link ext-link-type="uri" xlink:href="https://benlangmead.github.io/aws-indexes/spumoni" id="intref0060">https://benlangmead.github.io/aws-indexes/spumoni</ext-link>. For the Real mock community: accuracy and efficiency section, we used the reads present in the SRA Project under Accession Number SRX7711546 (<xref rid="bib8" ref-type="bibr">Kovaka et al., 2020</xref>).</p>
        <p id="p0240">For the human assemblies in the Human microbiome section, we used the telomere-to-telomere consortium CHM13 v1.0 assembly (<xref rid="bib10" ref-type="bibr">Miga et al., 2020</xref>), the Ashkenazi assembly (<xref rid="bib17" ref-type="bibr">Zimin et al., 2020</xref>), and GRCh38 (<xref rid="bib3" ref-type="bibr">Church et al., 2015</xref>). For the read sets used in same section, the human reads were simulated from the telomere-to-telemere consortium CHM13 v1.0 assembly (<xref rid="bib10" ref-type="bibr">Miga et al., 2020</xref>) at a mean read accuracy of 90% using PBSIM2 (<xref rid="bib13" ref-type="bibr">Ono et al., 2020</xref>) and its model for the R9.4 chemistry. The bacterial microbiome reads were obtained SRA Accession SRX6602475 (<xref rid="bib11" ref-type="bibr">Moss et al., 2020</xref>).</p>
      </sec>
    </sec>
    <sec id="sec4.3">
      <title>Method details</title>
      <sec id="sec4.3.1">
        <title>Matching statistics with r-index</title>
        <p id="p0245">Given a text <inline-formula><mml:math id="M10" altimg="si7.gif"><mml:mrow><mml:mi>T</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mn>1..</mml:mn><mml:mi>n</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of length <italic>n</italic>, the Burrows-Wheeler transform (BWT) (<xref rid="bib2" ref-type="bibr">Burrows and Wheeler 1994</xref>) is a reversible permutation of the <italic>T</italic> such that the character in position <italic>i</italic> is the character preceding the <italic>i</italic>-th lexicographic-sorted suffix of <italic>T</italic>. We use <italic>r</italic> to denote the number of maximal equal-letter runs of the BWT. The <italic>r</italic>-index <xref rid="bib5" ref-type="bibr">Gagie et al. (2020a)</xref> is a self-index that stores a run-length encoded BWT, that is each run is encoded as a character together with the run length.</p>
        <p id="p0250">Given a text <inline-formula><mml:math id="M11" altimg="si7.gif"><mml:mrow><mml:mi>T</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mn>1..</mml:mn><mml:mi>n</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of length <italic>n</italic> and a pattern <inline-formula><mml:math id="M12" altimg="si8.gif"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mn>1..</mml:mn><mml:mi>m</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of length <italic>m</italic>, the <italic>matching statistics</italic> of <italic>P</italic> against <italic>T</italic> are defined as an array <inline-formula><mml:math id="M13" altimg="si9.gif"><mml:mrow><mml:mi>M</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mn>1..</mml:mn><mml:mi>m</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of length <italic>m</italic>, where each position <inline-formula><mml:math id="M14" altimg="si10.gif"><mml:mrow><mml:mi>M</mml:mi><mml:mi>S</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> stores the length of the longest prefix of <inline-formula><mml:math id="M15" altimg="si1.gif"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mn>..</mml:mn><mml:mi>m</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> that occurs in the study by <italic>T</italic>. Bannai et al. <xref rid="bib1" ref-type="bibr">Bannai et al., 2020</xref> introduced the <italic>thresholds</italic> which are <inline-formula><mml:math id="M16" altimg="si11.gif"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>r</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> positions in the BWT marking a minimum of the longest common prefix array, between two equal-letter runs. They also proposed a two-pass algorithm to compute matching statistics using use these thresholds and the <italic>r</italic>-index. In the first pass, the algorithm steps backward along the pattern <italic>P</italic>. When it can, the algorithm uses the LF mapping to extend the match by one character. Where this is not possible, we “jump” either forward or back in the BWT to a position where the match can be extended. Whether we jump forward or back depends on which direction gives the longer common prefix with the match so far, which in turn is determined by the threshold’s location. In the second pass, the algorithm uses a random-access data structure built over <italic>T</italic> to compute the lengths of the matching statistics.</p>
        <p id="p0255">Rossi et al. (<xref rid="bib15" ref-type="bibr">Rossi et al., 2021</xref>) with MONI showed how to efficiently compute the thresholds for highly repetitive texts, and implemented the matching statistics algorithm. A MONI index consists of four main components, the run-length encoded BWT, suffix-array samples taken at run boundaries, the thresholds, and a grammar (<xref rid="bib4" ref-type="bibr">Gagie et al. 2019</xref>, <xref rid="bib6" ref-type="bibr">2020b</xref>) that provides random access to <italic>T</italic>. These data structures allow computation of matching statistics in <inline-formula><mml:math id="M17" altimg="si12.gif"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mtext>log</mml:mtext><mml:mi>n</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> time and take <inline-formula><mml:math id="M18" altimg="si13.gif"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo linebreak="badbreak">+</mml:mo><mml:mi>g</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> space where <italic>g</italic> is the size of a given straight-line program for <italic>T</italic>.</p>
      </sec>
      <sec id="sec4.3.2">
        <title>Pseudomatching lengths</title>
        <p id="p0260">SPUMONI modifies MONI by removing the second pass. As SPUMONI performs a backward LF-mapping search, it increments a length variable whenever the BWT character encountered matches the next character in <italic>P</italic>. If the character fails to match, the length variable is reset to 0, and we “jump” in the BWT as usual. The value of the length variable at each step gives the sequence of <italic>pseudomatching lengths</italic> (PMLs); these differ from matching statistics because we have ignored the possibility that a BWT jump can correspond to an extension of the current half-maximal match. PMLs will consistently be shorter than the true MSs. But long MSs – long enough to narrow the BWT range to the point where random matches are excluded – will generally yield long PMLs. Because the longest MSs are the ones with the most power to discriminate target from nontarget, we expect, and our results confirm, that PMLs are similarly useful for classification.</p>
        <p id="p0265">This simplification obviates the need to store either the SA samples or the random-access grammar for <italic>T</italic>; those were used only in MONI’s second loop. Hence, a SPUMONI index consists only of the run-length encoded BWT and thresholds. This leads to improvements in the time and space complexity, where PMLs can be computed in <inline-formula><mml:math id="M19" altimg="si14.gif"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mtext>loglog</mml:mtext><mml:mi>n</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> time and take <inline-formula><mml:math id="M20" altimg="si11.gif"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>r</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> space in worst case. Pseudocode highlighting differences between MONI and SPUMONI – and between MSs and PMLs – is given in <xref rid="mmc1" ref-type="supplementary-material">Figure S5</xref>.</p>
      </sec>
      <sec id="sec4.3.3">
        <title>Positive and null indexes</title>
        <p id="p0270">In our approach, we generated matching statistics of the read with respect to both a positive and null index. The positive index consisted of both the forward and reverse complement of the sequence that we wanted to target, whether that be for depletion or enrichment. The null index simply consisted of the reverse of the positive index sequence, and the matching statistics generated with respect to the null index were meant to represent matching statistics you would get against random sequence. This would allow us to compare the distribution of matching statistic lengths with respect to the positive index to a baseline distribution, and if we see a clear difference, it is probably owing to the read matching significantly to sequence in the positive index.</p>
      </sec>
    </sec>
    <sec id="sec4.4">
      <title>Quantification and statistical analysis</title>
      <p id="p0275">To decide whether the positive and null distributions of matching statistics are different, we used the Kolmogorov-Smirnov test (KS-test), which compares the distributions’ cumulative distribution functions (CDFs). We found that a Kolmogorov-Smirnov statistic (KS-stat) of 0.25 and 0.10 for matching statistics and PMLs, respectively, worked well across different nanopore data sets. We applied the KS-test to nonoverlapping regions of 90 bp which allows to us to compute the KS-stat as the Read Until API delivers new batches of data without having to revisit and use earlier batches of data in the computation.</p>
      <p id="p0280">In addition, before feeding in the matching statistics from the nonoverlapping regions into the KS-test, we applied a transformation function to the data. The function consisted of taking each matching statistic length and subtracting the mean of the null distribution, and replacing its value with 1 if it was less than 1. The intuition behind this function is that it compresses all of matching statistic lengths that are near-random length into a matching statistic length of 1. This improves the accuracy using the KS-test because the KS-test is based on distances between CDFs so this transformation will tend to increase the KS-stat when the distributions are truly different.</p>
      <p id="p0285">Finally, to make a decision on the read level for whether the read should be classified as matching sequence in the positive index or not, we will perform the following. We gather all the KS-stats from the nonoverlapping regions and see if a simple majority of them are greater than the threshold.</p>
    </sec>
  </sec>
</body>
<back>
  <ref-list id="cebib0010">
    <title>References</title>
    <ref id="bib1">
      <element-citation publication-type="journal" id="sref1">
        <person-group person-group-type="author">
          <name>
            <surname>Bannai</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Gagie</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Tomohiro</surname>
            <given-names>I.</given-names>
          </name>
        </person-group>
        <article-title>Refining the <italic>r</italic>-index</article-title>
        <source>Theor. Comput. Sci.</source>
        <volume>812</volume>
        <year>2020</year>
        <fpage>96</fpage>
        <lpage>108</lpage>
        <pub-id pub-id-type="doi">10.1016/j.tcs.2019.08.005</pub-id>
      </element-citation>
    </ref>
    <ref id="bib2">
      <element-citation publication-type="journal" id="sref2">
        <person-group person-group-type="author">
          <name>
            <surname>Burrows</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Wheeler</surname>
            <given-names>D.</given-names>
          </name>
        </person-group>
        <article-title>A block-sorting lossless data compression algorithm</article-title>
        <source>Technical Report 124.</source>
        <volume>Digital SRC Research Report</volume>
        <year>1994</year>
      </element-citation>
    </ref>
    <ref id="bib3">
      <element-citation publication-type="journal" id="sref3">
        <person-group person-group-type="author">
          <name>
            <surname>Church</surname>
            <given-names>D.M.</given-names>
          </name>
          <name>
            <surname>Schneider</surname>
            <given-names>V.A.</given-names>
          </name>
          <name>
            <surname>Steinberg</surname>
            <given-names>K.M.</given-names>
          </name>
          <name>
            <surname>Schatz</surname>
            <given-names>M.C.</given-names>
          </name>
          <name>
            <surname>Quinlan</surname>
            <given-names>A.R.</given-names>
          </name>
          <name>
            <surname>Chin</surname>
            <given-names>C.S.</given-names>
          </name>
          <name>
            <surname>Kitts</surname>
            <given-names>P.A.</given-names>
          </name>
          <name>
            <surname>Aken</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Marth</surname>
            <given-names>G.T.</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>M.M.</given-names>
          </name>
        </person-group>
        <article-title>Extending reference assembly models</article-title>
        <source>Genome Biol.</source>
        <volume>16</volume>
        <year>2015</year>
        <fpage>13</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-015-0587-3</pub-id>
        <pub-id pub-id-type="pmid">25651527</pub-id>
      </element-citation>
    </ref>
    <ref id="bib4">
      <element-citation publication-type="journal" id="sref4">
        <person-group person-group-type="author">
          <name>
            <surname>Gagie</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Tomohiro</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Manzini</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Sakamoto</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Takabatake</surname>
            <given-names>Y.</given-names>
          </name>
        </person-group>
        <article-title>Rpair: Rescaling RePair with Rsync</article-title>
        <source>Proc. SPIRE</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1007/978-3-030-32686-9_3</pub-id>
      </element-citation>
    </ref>
    <ref id="bib5">
      <element-citation publication-type="journal" id="sref5">
        <person-group person-group-type="author">
          <name>
            <surname>Gagie</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Prezza</surname>
            <given-names>N.</given-names>
          </name>
        </person-group>
        <article-title>Fully functional suffix trees and optimal text searching in BWT-runs bounded space</article-title>
        <source>J. ACM</source>
        <volume>67</volume>
        <year>2020</year>
        <fpage>2:1</fpage>
        <lpage>2:54</lpage>
        <pub-id pub-id-type="doi">10.1145/3375890</pub-id>
      </element-citation>
    </ref>
    <ref id="bib6">
      <element-citation publication-type="journal" id="sref6">
        <person-group person-group-type="author">
          <name>
            <surname>Gagie</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Tomohiro</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Manzini</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Sakamoto</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Benkner</surname>
            <given-names>L.S.</given-names>
          </name>
          <name>
            <surname>Takabatake</surname>
            <given-names>Y.</given-names>
          </name>
        </person-group>
        <article-title>Practical random access to SLP-compressed texts</article-title>
        <source>Proc. SPIRE</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1007/978-3-030-59212-7_16</pub-id>
      </element-citation>
    </ref>
    <ref id="bib7">
      <element-citation publication-type="journal" id="sref7">
        <person-group person-group-type="author">
          <collab>Human Pangenome Reference</collab>
        </person-group>
        <source>Consortium</source>
        <year>2021</year>
        <ext-link ext-link-type="uri" xlink:href="https://humanpangenome.org/" id="interref0010">https://humanpangenome.org/</ext-link>
      </element-citation>
    </ref>
    <ref id="bib8">
      <element-citation publication-type="journal" id="sref8">
        <person-group person-group-type="author">
          <name>
            <surname>Kovaka</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Fan</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Ni</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Timp</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Schatz</surname>
            <given-names>M.C.</given-names>
          </name>
        </person-group>
        <article-title>Targeted nanopore sequencing by realtime mapping of raw electrical signal with UNCALLED</article-title>
        <source>Nat. Biotech.</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0731-9</pub-id>
      </element-citation>
    </ref>
    <ref id="bib9">
      <element-citation publication-type="journal" id="sref9">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Minimap2: pairwise alignment for nucleotide sequences</article-title>
        <source>Bioinformatics</source>
        <volume>34</volume>
        <year>2018</year>
        <fpage>3094</fpage>
        <lpage>3100</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty191</pub-id>
        <pub-id pub-id-type="pmid">29750242</pub-id>
      </element-citation>
    </ref>
    <ref id="bib10">
      <element-citation publication-type="journal" id="sref10">
        <person-group person-group-type="author">
          <name>
            <surname>Miga</surname>
            <given-names>K.H.</given-names>
          </name>
          <name>
            <surname>Koren</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Rhie</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Vollger</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Gershman</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Bzikadze</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Brooks</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Howe</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Porubsky</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Logsdon</surname>
            <given-names>G.A.</given-names>
          </name>
        </person-group>
        <article-title>Telomere-to-telomere assembly of a complete human X chromosome</article-title>
        <source>Nature</source>
        <volume>585</volume>
        <year>2020</year>
        <fpage>79</fpage>
        <lpage>84</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2547-7</pub-id>
        <pub-id pub-id-type="pmid">32663838</pub-id>
      </element-citation>
    </ref>
    <ref id="bib11">
      <element-citation publication-type="journal" id="sref11">
        <person-group person-group-type="author">
          <name>
            <surname>Moss</surname>
            <given-names>E.L.</given-names>
          </name>
          <name>
            <surname>Maghini</surname>
            <given-names>D.G.</given-names>
          </name>
          <name>
            <surname>Bhatt</surname>
            <given-names>A.S.</given-names>
          </name>
        </person-group>
        <article-title>Complete, closed bacterial genomes from microbiomes using nanopore sequencing</article-title>
        <source>Nat. Biotech.</source>
        <volume>38</volume>
        <year>2020</year>
        <fpage>701</fpage>
        <lpage>707</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0422-6</pub-id>
      </element-citation>
    </ref>
    <ref id="bib12">
      <element-citation publication-type="journal" id="sref12">
        <person-group person-group-type="author">
          <name>
            <surname>Mun</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Kuhnle</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Boucher</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Gagie</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Langmead</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Manzini</surname>
            <given-names>G.</given-names>
          </name>
        </person-group>
        <article-title>Matching reads to many genomes with the r-index</article-title>
        <source>J. Comput. Biol.</source>
        <volume>27</volume>
        <year>2020</year>
        <fpage>514</fpage>
        <lpage>518</lpage>
        <pub-id pub-id-type="doi">10.1089/cmb.2019.0316</pub-id>
        <pub-id pub-id-type="pmid">32181686</pub-id>
      </element-citation>
    </ref>
    <ref id="bib13">
      <element-citation publication-type="journal" id="sref13">
        <person-group person-group-type="author">
          <name>
            <surname>Ono</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Asai</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Hamada</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>PBSIM2: a simulator for long read sequencers with a novel generative model of quality scores</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa835</pub-id>
      </element-citation>
    </ref>
    <ref id="bib14">
      <element-citation publication-type="journal" id="sref14">
        <person-group person-group-type="author">
          <name>
            <surname>Payne</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Clarke</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Munro</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Debebe</surname>
            <given-names>B.J.</given-names>
          </name>
          <name>
            <surname>Loose</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Readfish enables targeted nanopore sequencing of gigabase-sized genomes</article-title>
        <source>Nat. Biotech.</source>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1038/s41587-020-00746-x</pub-id>
      </element-citation>
    </ref>
    <ref id="bib15">
      <element-citation publication-type="journal" id="sref15">
        <person-group person-group-type="author">
          <name>
            <surname>Rossi</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Oliva</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Ben</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Gagie</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Boucher</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>MONI: a pangenomics index for finding MEMs</article-title>
        <source><italic>Proc. RECOMB</italic>.</source>
        <year>2021</year>
      </element-citation>
    </ref>
    <ref id="bib16">
      <element-citation publication-type="journal" id="sref16">
        <person-group person-group-type="author">
          <name>
            <surname>Wick</surname>
            <given-names>R.R.</given-names>
          </name>
          <name>
            <surname>Judd</surname>
            <given-names>L.M.</given-names>
          </name>
          <name>
            <surname>Holt</surname>
            <given-names>K.E.</given-names>
          </name>
        </person-group>
        <article-title>Performance of neural network basecalling tools for Oxford Nanopore sequencing</article-title>
        <source>Genome Biol.</source>
        <volume>20</volume>
        <year>2019</year>
        <fpage>129</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1727-y</pub-id>
        <pub-id pub-id-type="pmid">31234903</pub-id>
      </element-citation>
    </ref>
    <ref id="bib17">
      <element-citation publication-type="journal" id="sref17">
        <person-group person-group-type="author">
          <name>
            <surname>Zimin</surname>
            <given-names>A.V.</given-names>
          </name>
          <name>
            <surname>Shumate</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Sherman</surname>
            <given-names>R.M.</given-names>
          </name>
          <name>
            <surname>Puiu</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Wagner</surname>
            <given-names>J.M.</given-names>
          </name>
          <name>
            <surname>Olson</surname>
            <given-names>N.D.</given-names>
          </name>
          <name>
            <surname>Pertea</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Salit</surname>
            <given-names>M.L.</given-names>
          </name>
          <name>
            <surname>Zook</surname>
            <given-names>J.M.</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>S.L.</given-names>
          </name>
        </person-group>
        <article-title>Assembly and annotation of Ashkenazi reference genome</article-title>
        <source>BMC Bioinformatics</source>
        <volume>21</volume>
        <year>2020</year>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02047-7</pub-id>
      </element-citation>
    </ref>
  </ref-list>
  <sec id="appsec2" sec-type="supplementary-material">
    <title>Supplemental information</title>
    <p id="p0315">
      <supplementary-material content-type="local-data" id="mmc1">
        <caption>
          <title>Document S1. Figures S1–S5 and Table S1</title>
        </caption>
        <media xlink:href="mmc1.pdf"/>
      </supplementary-material>
    </p>
  </sec>
  <ack id="ack0010">
    <title>Acknowledgments</title>
    <p id="p0290">Part of this research project was conducted using computational resources at the Maryland Advanced Research Computing Center (MARCC). SPUMONI indexes are made freely available on Amazon Web Services thanks to the AWS Public Dataset Program.</p>
    <p id="p0295">BL, OA, TG, and CB were supported by NIH/<funding-source id="gs1"><institution-wrap><institution-id institution-id-type="doi">10.13039/100000051</institution-id><institution>NHGRI</institution></institution-wrap></funding-source> grant R01HG011392 to BL. OA, MR, TG, CB, and BL were supported <funding-source id="gs2">NSF</funding-source>/BIO grant DBI-2029552 to CB, TG, and BL. TG was supported by <funding-source id="gs3"><institution-wrap><institution-id institution-id-type="doi">10.13039/501100000038</institution-id><institution>NSERC</institution></institution-wrap></funding-source> grant RGPIN-07185-2020 to TG. SK and MCS are supported by <funding-source id="gs4">NSF</funding-source> award DBI-1350041.</p>
    <sec id="sec5">
      <title>Author contributions</title>
      <p id="p0300">OA and BL conceived the SPUMONI method, MR and OA implemented the SPUMONI method, based on the MONI software. OA, MR, SK, TG, CB, and BL participated in the evaluation and refinement of the method. All authors contributed to the manuscript.</p>
    </sec>
    <sec sec-type="COI-statement" id="sec6">
      <title>Declaration of interests</title>
      <p id="p0305">The authors declare no competing interests.</p>
    </sec>
  </ack>
  <fn-group>
    <fn id="appsec1" fn-type="supplementary-material">
      <p id="p0310">Supplemental information can be found online at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.isci.2021.102696" id="intref0065">https://doi.org/10.1016/j.isci.2021.102696</ext-link>.</p>
    </fn>
  </fn-group>
</back>
