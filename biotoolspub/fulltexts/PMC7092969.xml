<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS ONE</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7092969</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-19-32186</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0230430</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Community Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Ecology and Environmental Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Community Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Ecosystems</subject>
            <subj-group>
              <subject>Microbial Ecosystems</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Ecology and Environmental Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Ecosystems</subject>
            <subj-group>
              <subject>Microbial Ecosystems</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Biochemistry</subject>
          <subj-group>
            <subject>Bioenergetics</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Applied Mathematics</subject>
            <subj-group>
              <subject>Algorithms</subject>
              <subj-group>
                <subject>Machine Learning Algorithms</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Simulation and Modeling</subject>
          <subj-group>
            <subject>Algorithms</subject>
            <subj-group>
              <subject>Machine Learning Algorithms</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Artificial Intelligence</subject>
          <subj-group>
            <subject>Machine Learning</subject>
            <subj-group>
              <subject>Machine Learning Algorithms</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Microbial Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Ecology and Environmental Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Microbial Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Microbiology</subject>
          <subj-group>
            <subject>Microbial Ecology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Community Ecology</subject>
            <subj-group>
              <subject>Community Structure</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Ecology and Environmental Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Community Ecology</subject>
            <subj-group>
              <subject>Community Structure</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Ecosystems</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Ecology and Environmental Sciences</subject>
        <subj-group>
          <subject>Ecology</subject>
          <subj-group>
            <subject>Ecosystems</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Optimization</subject>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>The Community Simulator: A Python package for microbial ecology</article-title>
      <alt-title alt-title-type="running-head">The Community Simulator</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-5007-6877</contrib-id>
        <name>
          <surname>Marsland</surname>
          <given-names>Robert</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Writing – original draft</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cui</surname>
          <given-names>Wenping</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Goldford</surname>
          <given-names>Joshua</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mehta</surname>
          <given-names>Pankaj</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Funding acquisition</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Department of Physics, Boston University, Boston, Massachusetts, United States of America</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Department of Physics, Boston College, Chestnut Hill, Massachusetts, United States of America</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Bioinformatics Program, Boston University, Boston, Massachusetts, United States of America</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Klapper</surname>
          <given-names>Isaac</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Temple University, UNITED STATES</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>marsland@bu.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>24</day>
      <month>3</month>
      <year>2020</year>
    </pub-date>
    <volume>15</volume>
    <issue>3</issue>
    <elocation-id>e0230430</elocation-id>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>11</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>28</day>
        <month>2</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2020 Marsland et al</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>Marsland et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pone.0230430.pdf"/>
    <abstract>
      <p>Natural microbial communities contain hundreds to thousands of interacting species. For this reason, computational simulations are playing an increasingly important role in microbial ecology. In this manuscript, we present a new open-source, freely available Python package called Community Simulator for simulating microbial population dynamics in a reproducible, transparent and scalable way. The Community Simulator includes five major elements: tools for preparing the initial states and environmental conditions for a set of samples, automatic generation of dynamical equations based on a dictionary of modeling assumptions, random parameter sampling with tunable levels of metabolic and taxonomic structure, parallel integration of the dynamical equations, and support for metacommunity dynamics with migration between samples. To significantly speed up simulations using Community Simulator, our Python package implements a new Expectation-Maximization (EM) algorithm for finding equilibrium states of community dynamics that exploits a recently discovered duality between ecological dynamics and convex optimization. We present data showing that this EM algorithm improves performance by between one and two orders compared to direct numerical integration of the corresponding ordinary differential equations. We conclude by listing several recent applications of the Community Simulator to problems in microbial ecology, and discussing possible extensions of the package for directly analyzing microbiome compositional data.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000057</institution-id>
            <institution>National Institute of General Medical Sciences</institution>
          </institution-wrap>
        </funding-source>
        <award-id>1R35GM119461</award-id>
        <principal-award-recipient>
          <name>
            <surname>Mehta</surname>
            <given-names>Pankaj</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award002">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000893</institution-id>
            <institution>Simons Foundation</institution>
          </institution-wrap>
        </funding-source>
        <award-id>Mathematical Modeling in Living Systems</award-id>
        <principal-award-recipient>
          <name>
            <surname>Mehta</surname>
            <given-names>Pankaj</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <funding-statement>This work was supported by NIH NIGMS grant 1R35GM119461 and a Simons Investigator in the Mathematical Modeling of Living Systems (MMLS) award to PM. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="6"/>
      <table-count count="2"/>
      <page-count count="18"/>
    </counts>
    <custom-meta-group>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>All relevant data are within the manuscript.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>All relevant data are within the manuscript.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>Background</title>
    <p>The last decade has seen a renewed interest in the study of microbial communities. Different environments can harbor diverse communities containing from hundreds to thousands of distinct microbes [<xref rid="pone.0230430.ref001" ref-type="bibr">1</xref>, <xref rid="pone.0230430.ref002" ref-type="bibr">2</xref>]. A central goal of community ecology is to understand the ecological processes that shape these diverse ecosystems. The diversity and function of ecosystems are affected by a wide variety of factors including energy and resource availability [<xref rid="pone.0230430.ref003" ref-type="bibr">3</xref>, <xref rid="pone.0230430.ref004" ref-type="bibr">4</xref>], ecological processes such as competition between species [<xref rid="pone.0230430.ref005" ref-type="bibr">5</xref>–<xref rid="pone.0230430.ref008" ref-type="bibr">8</xref>] and stochastic colonization [<xref rid="pone.0230430.ref009" ref-type="bibr">9</xref>–<xref rid="pone.0230430.ref012" ref-type="bibr">12</xref>].</p>
    <p>Microbial ecosystems also present several new challenges specific to microbes that are not usually addressed in the theoretical ecology literature. Classical models of community ecology (especially niche-based theories) have traditionally considered ecosystems with a few species and resources [<xref rid="pone.0230430.ref013" ref-type="bibr">13</xref>, <xref rid="pone.0230430.ref014" ref-type="bibr">14</xref>]. However, microbial ecosystems often have thousands of species and hundreds of small molecules that can be consumed. It is unclear how the intuitions and results from these low-dimensional settings scale to microbiomes. It is known that diverse ecosystems can exhibit distinct emergent features and phase transitions not found in low-dimensional systems [<xref rid="pone.0230430.ref015" ref-type="bibr">15</xref>–<xref rid="pone.0230430.ref018" ref-type="bibr">18</xref>]. Furthermore, classical ecological models usually assume a strict trophic layer separation, ignoring cross-feeding and syntrophy—the consumption of metabolic byproducts of one species by another species. It is now becoming clear that cross-feeding is a central component of microbial ecosystems [<xref rid="pone.0230430.ref019" ref-type="bibr">19</xref>–<xref rid="pone.0230430.ref022" ref-type="bibr">22</xref>] and any ecological model must account for this phenomenon.</p>
    <p>For these reasons, there is a need for new ways of understanding microbial ecosystems. One powerful approach for understanding complex systems is through simulations. However, simulating diverse microbial ecosystems presents some unique challenges. First, most ecosystems are mathematically represented by complicated coupled, non-linear ordinary differential equations. Simulating these systems in ecosystems with hundreds to thousands of species and metabolites becomes computationally difficult and time-consuming. Second, these dynamical models have thousands of parameters. One needs a principled and biologically realistic way of choosing such parameters. Third, explaining real data requires incorporating ecological processes such as stochastic colonization that play an important role in shaping community structure and dynamics. Finally, we need to be able to incorporate spatial and population level structures in an experimentally realistic way.</p>
    <p>Recently, we presented a powerful minimal model of microbial ecosystems that addresses these concerns [<xref rid="pone.0230430.ref020" ref-type="bibr">20</xref>, <xref rid="pone.0230430.ref022" ref-type="bibr">22</xref>]. Furthermore, we have found a mathematical mapping between ecological dynamics and constrained optimization that can be used to accelerate simulations of many large ecosystems [<xref rid="pone.0230430.ref023" ref-type="bibr">23</xref>, <xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>]. In this paper, we present a new open-source Python package for microbial ecology called Community Simulator that implements these theoretical advances, making it easy to simulate complex microbial communities in a variety of experimentally relevant settings.</p>
  </sec>
  <sec id="sec002">
    <title>Implementation</title>
    <p>The architecture of Community Simulator is inspired by the parallel experiments commonly performed with 96-well plates, as illustrated in <xref ref-type="fig" rid="pone.0230430.g001">Fig 1</xref>. The central object of the package is a <monospace>Community</monospace> class, whose instances are initialized by specifying the initial population sizes and resource concentrations for each parallel “well,” along with the functions and parameters that define the population dynamics. The initial state, dynamical equations and parameters can all be generated automatically from a dictionary of modeling assumptions, or custom-built by the user. Each instance of this class represents an <italic>n</italic>-well plate, containing <italic>n</italic> well-mixed, non-interacting communities. Once initialized, the state of the plate can be updated in one of two ways. <monospace>Propagate(T)</monospace> propagates the system for a time <italic>T</italic> by integrating the supplied dynamical equations, and <monospace>Passage(f)</monospace> builds a replacement plate by adding a fraction <italic>f</italic><sub><italic>μν</italic></sub> of the contents of each old well <italic>ν</italic> to each new well <italic>μ</italic>. In the final section below, we will discuss a third method <monospace>SteadyState()</monospace>, which can find the fixed point of the dynamics in some models without numerical integration.</p>
    <fig id="pone.0230430.g001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0230430.g001</object-id>
      <label>Fig 1</label>
      <caption>
        <title>The five elements of the Community Simulator.</title>
        <p>The core object of the Community Simulator is a virtual <italic>n</italic>-well plate, holding <italic>n</italic> independent well-mixed microbial communities. This plate has three properties: its current state, a dynamical law for the population dynamics, and a set of parameters. Once a plate is initialized, two actions can be performed on it: propagation in time using the given dynamical law, and passaging of given fractions of the contents of each well to fresh wells on a replacement plate. For some models, the equilibrium state of the population dynamics can also be found directly using a new algorithm summarized in <xref ref-type="fig" rid="pone.0230430.g005">Fig 5</xref> below.</p>
      </caption>
      <graphic xlink:href="pone.0230430.g001"/>
    </fig>
    <p>The package also includes some functions for analysis of the simulation results, including a variety of measures of alpha diversity, as well as extraction of energy flux networks, effective interaction coefficients, and sensitivities to parameter perturbations.</p>
    <p>In the following sections, we describe the functionality of each element of the package in turn. We particularly focus on the tools for generating the dynamical equations and the parameter sets, explaining how increasing levels of biological realism can be progressively incorporated. Each section has a corresponding segment in the Jupyter notebook <monospace>Tutorial.ipynb</monospace> included with the Community Simulator package. This notebook contains all the code and parameters for generating the figures found in the paper.</p>
    <sec id="sec003">
      <title>Constructing the initial state</title>
      <p>The state of a <monospace>Community</monospace> instance is contained in a pair of Pandas data frames (<ext-link ext-link-type="uri" xlink:href="https://pandas.pydata.org/">https://pandas.pydata.org/</ext-link>, [<xref rid="pone.0230430.ref025" ref-type="bibr">25</xref>]), one of size <italic>S</italic><sub>tot</sub> × <italic>n</italic> for the microbial population sizes <italic>N</italic><sub><italic>i</italic></sub> (<italic>i</italic> = 1, 2, … <italic>S</italic><sub>tot</sub>) and one of size <italic>M</italic> × <italic>n</italic> for the resource abundances <italic>R</italic><sub><italic>α</italic></sub> (<italic>α</italic> = 1, 2, …<italic>M</italic>). Each row of the data frame corresponds to a different species or resource type, while each column corresponds to a different well.</p>
      <p>The function <monospace>MakeInitialState</monospace> automatically creates data frames <monospace>N0,R0</monospace> of initial population sizes and resource abundances corresponding to some common experimental scenarios, specified in a dictionary of assumptions. The initial species abundances are supplied by a stochastic process that is agnostic to species identity. This roughly captures the various dispersal mechanisms including mechanical disturbances and turbulent flow that convey microbial cells to new environments. Specifically, random subsets of <italic>S</italic> species from the regional pool of size <italic>S</italic><sub>tot</sub> are supplied to the <italic>n</italic> wells of the plate. The population sizes of these species are set to 1 by default, and can be rescaled afterwards if desired.</p>
      <p>Initial resource abundances are generated by <monospace>MakeInitialState</monospace> based on a Biolog plate scenario, where each well is supplied with a single carbon source. The assumptions dictionary specifies the identity and quantity of the carbon source for each well. Arbitrarily chosen resource abundances can of course be directly supplied to the <monospace>Community</monospace> instance instead, to simulate more general conditions.</p>
      <p>To capture coarse-grained metabolic structure, the <italic>M</italic> resources can be assigned to <italic>T</italic> classes (e.g. sugars, amino acids, etc.), each with <italic>M</italic><sub><italic>A</italic></sub> resources where <italic>A</italic> = 1, …<italic>T</italic> and ∑<sub><italic>A</italic></sub>
<italic>M</italic><sub><italic>A</italic></sub> = <italic>M</italic>. These class labels become functionally relevant by biasing the sampling of consumption preferences and byproduct stoichiometry, as will be described below. Likewise the <italic>S</italic><sub>tot</sub> species can be assigned to <italic>F</italic> families, with <italic>F</italic> ≤ <italic>T</italic>, and each family preferentially consuming resources from a different resource class. A generalist family can also be included, with <italic>S</italic><sub>gen</sub> species and no preferred resource class, so that <italic>S</italic><sub>gen</sub> + ∑<sub><italic>A</italic></sub>
<italic>S</italic><sub><italic>A</italic></sub> = <italic>S</italic><sub>tot</sub>.</p>
    </sec>
    <sec id="sec004">
      <title>Generating the dynamical equations</title>
      <p>Instances of the <monospace>Community</monospace> class can be initialized with any set of differential equations, which are specified as functions of the system state that return the time derivatives <italic>dN</italic><sub><italic>i</italic></sub>/<italic>dt</italic> and <italic>dR</italic><sub><italic>α</italic></sub>/<italic>dt</italic>. The package includes tools for constructing these functions automatically based on a dictionary of assumptions. These built-in dynamics are based on the recently introduced Microbial Consumer Resource Model (MicroCRM) [<xref rid="pone.0230430.ref020" ref-type="bibr">20</xref>, <xref rid="pone.0230430.ref022" ref-type="bibr">22</xref>] illustrated in <xref ref-type="fig" rid="pone.0230430.g002">Fig 2</xref>, which generalizes the classic consumer resource model of MacArthur and Levins [<xref rid="pone.0230430.ref006" ref-type="bibr">6</xref>] to the microbial context by allowing organisms to release metabolic byproducts. <xref rid="pone.0230430.t001" ref-type="table">Table 1</xref> lists all the parameters of this family of models, along with the corresponding units.</p>
      <fig id="pone.0230430.g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0230430.g002</object-id>
        <label>Fig 2</label>
        <caption>
          <title>Constructing the dynamical law.</title>
          <p>The MicroCRM models the growth and metabolism of <italic>S</italic> microbial species in terms of energy fluxes <inline-formula id="pone.0230430.e001"><alternatives><graphic id="pone.0230430.e001g" xlink:href="pone.0230430.e001"/><mml:math id="M1"><mml:mrow><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mtext>out</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>J</mml:mi><mml:mi>i</mml:mi><mml:mtext>grow</mml:mtext></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, mediated by import, export and chemical transformation of <italic>M</italic> substitutable resources. Specification of the resource dynamics and of the dependence of import rates on the resource concentrations requires three additional modeling choices, represented by the three arrows. First, the intrinsic dynamics of the resources can either be a linear model of a fixed external input flux and dilution rate, or a logistic model of self-renewing resources, which was employed in MacArthur’s original CRM. The left-hand plot shows the supply rate as a function of resource concentration for these two options. Second, the import rates from the different resource types can be independent, or globally regulated in such a way as to preferentially consume the resource that is currently most abundant. The middle plot shows timeseries of consumer and resource abundances in the presence and absence of regulation, with all other parameters held fixed. Third, the dependence of import rates on resource concentration can take a linear (Type-I), Monod (Type-II) or Hill (Type-III) form. The right-hand plot shows the growth rate as a function of resource concentration for these three choices.</p>
        </caption>
        <graphic xlink:href="pone.0230430.g002"/>
      </fig>
      <table-wrap id="pone.0230430.t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0230430.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Parameters and units for the Microbial Consumer Resource Model.</title>
        </caption>
        <alternatives>
          <graphic id="pone.0230430.t001g" xlink:href="pone.0230430.t001"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <tbody>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>N</italic>
                  <sub>
                    <italic>i</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">population density of species <italic>i</italic> (individuals/volume)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>R</italic>
                  <sub>
                    <italic>α</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Concentration of resource <italic>α</italic> (mass/volume)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>c</italic>
                  <sub>
                    <italic>iα</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Uptake rate per unit concentration of resource <italic>α</italic> by species <italic>i</italic> (volume/time)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>D</italic>
                  <sub>
                    <italic>αβ</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Fraction of byproducts from resource <italic>β</italic> converted to <italic>α</italic> (unitless)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>g</italic>
                  <sub>
                    <italic>i</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Conversion factor from energy uptake to growth rate (1/energy)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>w</italic>
                  <sub>
                    <italic>α</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Energy content of resource <italic>α</italic> (energy/mass)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>l</italic>
                  <sub>
                    <italic>α</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Leakage fraction for resource <italic>α</italic> (unitless)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>m</italic>
                  <sub>
                    <italic>i</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Minimal energy uptake for maintenance of species <italic>i</italic> (energy/time)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <inline-formula id="pone.0230430.e002">
                    <alternatives>
                      <graphic id="pone.0230430.e002g" xlink:href="pone.0230430.e002"/>
                      <mml:math id="M2">
                        <mml:msubsup>
                          <mml:mi>R</mml:mi>
                          <mml:mi>α</mml:mi>
                          <mml:mn>0</mml:mn>
                        </mml:msubsup>
                      </mml:math>
                    </alternatives>
                  </inline-formula>
                </td>
                <td align="left" rowspan="1" colspan="1">Intrinsic equilibrium abundance of resource <italic>α</italic> (mass/volume)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>τ</italic>
                  <sub>
                    <italic>α</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Timescale for externally supplied resource turnover (time)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>r</italic>
                  <sub>
                    <italic>α</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Rate of resource self-renewal (volume/mass/time)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>n</italic>
                </td>
                <td align="left" rowspan="1" colspan="1">Hill coefficient for functional response (unitless)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>σ</italic>
                  <sub>max</sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Maximum input flux (mass/time)</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>n</italic>
                  <sub>reg</sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Hill coefficient for metabolic regulation (unitless)</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>In order to provide a general-purpose set of models that produce physically reasonable results, the MicroCRM assumes that all resource types are substitutable, and can all be converted to a common energy currency. This allows us to enforce energy conservation, preventing communities from bootstrapping themselves to large population sizes using metabolic secretions with no external resource supply. It also eliminates the need to specify in detail how each resource type interacts with all the others within the consumer metabolism. If such interactions are important for capturing a given experimental phenomenon, the built-in dynamics cannot be used, and custom functions must be written for <italic>dN</italic><sub><italic>i</italic></sub>/<italic>dt</italic> and <italic>dR</italic><sub><italic>α</italic></sub>/<italic>dt</italic>. The tutorial notebook included with the package contains an example of this kind, using Liebig’s Law of the Minimum to model phytoplankton dynamics.</p>
      <sec id="sec005">
        <title>Energy fluxes and growth rates</title>
        <p>We begin by defining an energy flux into a cell <italic>J</italic><sup>in</sup>, an energy flux that is used for growth <italic>J</italic><sup>growth</sup>, and an outgoing energy flux due to byproduct secretion <italic>J</italic><sup>out</sup>. Energy conservation requires
<disp-formula id="pone.0230430.e003"><alternatives><graphic xlink:href="pone.0230430.e003.jpg" id="pone.0230430.e003g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M3"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>J</mml:mi><mml:mtext>in</mml:mtext></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mi>J</mml:mi><mml:mtext>growth</mml:mtext></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mi>J</mml:mi><mml:mtext>out</mml:mtext></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1)</label></disp-formula>
for any reasonable metabolic model. It is useful to denote the input and output energy fluxes that are consumed/secreted in metabolite <italic>β</italic> by <inline-formula id="pone.0230430.e004"><alternatives><graphic xlink:href="pone.0230430.e004.jpg" id="pone.0230430.e004g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M4"><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0230430.e005"><alternatives><graphic xlink:href="pone.0230430.e005.jpg" id="pone.0230430.e005g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M5"><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>out</mml:mtext></mml:msubsup></mml:math></alternatives></inline-formula> respectively. We can define corresponding mass fluxes by
<disp-formula id="pone.0230430.e006"><alternatives><graphic xlink:href="pone.0230430.e006.jpg" id="pone.0230430.e006g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M6"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>out</mml:mtext></mml:msubsup><mml:mo>≡</mml:mo><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>out</mml:mtext></mml:msubsup><mml:mo>/</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2)</label></disp-formula>
and
<disp-formula id="pone.0230430.e007"><alternatives><graphic xlink:href="pone.0230430.e007.jpg" id="pone.0230430.e007g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M7"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>≡</mml:mo><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>/</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(3)</label></disp-formula>
where the conversion factor <italic>w</italic><sub><italic>β</italic></sub> measures the energy density of metabolite <italic>β</italic>. In general, all these fluxes depend on the consumer species under consideration, and will carry an extra Roman index <italic>i</italic> indicating the species.</p>
        <p>We assume that a fixed quantity <italic>m</italic><sub><italic>i</italic></sub> of power per cell is required for maintenance of species <italic>i</italic>, and that the per-capita growth rate is proportional to the remaining energy flux (<italic>J</italic><sup>growth</sup> − <italic>m</italic><sub><italic>i</italic></sub>), with proportionality constant <italic>g</italic><sub><italic>i</italic></sub>. Under these assumptions, the time-evolution of the population size <italic>N</italic><sub><italic>i</italic></sub> of species <italic>i</italic> can be modeled using the equation
<disp-formula id="pone.0230430.e008"><alternatives><graphic xlink:href="pone.0230430.e008.jpg" id="pone.0230430.e008g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M8"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>J</mml:mi><mml:mi>i</mml:mi><mml:mtext>growth</mml:mtext></mml:msubsup><mml:mo>-</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(4)</label></disp-formula></p>
        <p>We can model the resource dynamics by functions of the form
<disp-formula id="pone.0230430.e009"><alternatives><graphic xlink:href="pone.0230430.e009.jpg" id="pone.0230430.e009g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M9"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>out</mml:mtext></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(5)</label></disp-formula>
where the function <italic>h</italic><sub><italic>α</italic></sub> describes the resource dynamics in the absence of consumers. The Community Simulator has two kinds of default resource dynamics: externally supplied and self-renewing. For externally supplied resources, we take a linearized form of the dynamics:
<disp-formula id="pone.0230430.e010"><alternatives><graphic xlink:href="pone.0230430.e010.jpg" id="pone.0230430.e010g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M10"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>α</mml:mi><mml:mtext>external</mml:mtext></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>α</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>-</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(6)</label></disp-formula>
while for self-renewing we take a logistic form
<disp-formula id="pone.0230430.e011"><alternatives><graphic xlink:href="pone.0230430.e011.jpg" id="pone.0230430.e011g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M11"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>α</mml:mi><mml:mrow><mml:mtext>self</mml:mtext><mml:mo>-</mml:mo><mml:mtext>renewing</mml:mtext></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>-</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(7)</label></disp-formula></p>
        <p>Finally, the intrinsic resource dynamics can also be turned off, with <inline-formula id="pone.0230430.e012"><alternatives><graphic xlink:href="pone.0230430.e012.jpg" id="pone.0230430.e012g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M12"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>α</mml:mi><mml:mtext>off</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, to simulate resource depletion in a closed community with no resupply.</p>
      </sec>
      <sec id="sec006">
        <title>Input fluxes and output partitioning</title>
        <p>We now specify the form of the input fluxes <inline-formula id="pone.0230430.e013"><alternatives><graphic xlink:href="pone.0230430.e013.jpg" id="pone.0230430.e013g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M13"><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup></mml:math></alternatives></inline-formula>, and of the relationships among input, output and growth that define the metabolism. We start by assuming that all resource utilization pathways are independent, resulting in input fluxes of the form
<disp-formula id="pone.0230430.e014"><alternatives><graphic xlink:href="pone.0230430.e014.jpg" id="pone.0230430.e014g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M14"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(8)</label></disp-formula>
where <italic>σ</italic> is a single-valued function encoding the relationship between resource availability and uptake rates. The community simulator implements three kinds of response functions: Type-I, linear response functions where
<disp-formula id="pone.0230430.e015"><alternatives><graphic xlink:href="pone.0230430.e015.jpg" id="pone.0230430.e015g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M15"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(9)</label></disp-formula>
a Type-II saturating Monod function,
<disp-formula id="pone.0230430.e016"><alternatives><graphic xlink:href="pone.0230430.e016.jpg" id="pone.0230430.e016g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mi>x</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mi>x</mml:mi><mml:msub><mml:mi>σ</mml:mi><mml:mtext>max</mml:mtext></mml:msub></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(10)</label></disp-formula>
and a Type-III Hill or sigmoid-like function
<disp-formula id="pone.0230430.e017"><alternatives><graphic xlink:href="pone.0230430.e017.jpg" id="pone.0230430.e017g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M17"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>I</mml:mi><mml:mi>I</mml:mi><mml:mi>I</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mi>x</mml:mi><mml:mi>n</mml:mi></mml:msup><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:msup><mml:mi>x</mml:mi><mml:mi>n</mml:mi></mml:msup><mml:msub><mml:mi>σ</mml:mi><mml:mtext>max</mml:mtext></mml:msub></mml:mfrac></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(11)</label></disp-formula>
where <italic>n</italic> &gt; 1.</p>
        <p>To obtain the output fluxes, we define a leakage fraction <italic>l</italic> such that
<disp-formula id="pone.0230430.e018"><alternatives><graphic xlink:href="pone.0230430.e018.jpg" id="pone.0230430.e018g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M18"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>J</mml:mi><mml:mtext>out</mml:mtext></mml:msup><mml:mo>=</mml:mo><mml:mi>l</mml:mi><mml:msup><mml:mi>J</mml:mi><mml:mtext>in</mml:mtext></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(12)</label></disp-formula></p>
        <p>We allow different resources to have different leakage fractions <italic>l</italic><sub><italic>α</italic></sub>. A direct consequence of energy conservation (<xref ref-type="disp-formula" rid="pone.0230430.e003">Eq (1)</xref>) is that
<disp-formula id="pone.0230430.e019"><alternatives><graphic xlink:href="pone.0230430.e019.jpg" id="pone.0230430.e019g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M19"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>J</mml:mi><mml:mi>i</mml:mi><mml:mtext>growth</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(13)</label></disp-formula></p>
        <p>Finally, we denote by <italic>D</italic><sub><italic>βα</italic></sub> the fraction of the output energy that is contained in metabolite <italic>β</italic> when a cell consumes <italic>α</italic>. Note that by definition ∑<sub><italic>β</italic></sub>
<italic>D</italic><sub><italic>βα</italic></sub> = 1. The total energy output in metabolite <italic>β</italic> is thus
<disp-formula id="pone.0230430.e020"><alternatives><graphic xlink:href="pone.0230430.e020.jpg" id="pone.0230430.e020g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M20"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mtext>out</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:munder><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>β</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:munder><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>β</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(14)</label></disp-formula></p>
        <p>This also yields
<disp-formula id="pone.0230430.e021"><alternatives><graphic xlink:href="pone.0230430.e021.jpg" id="pone.0230430.e021g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M21"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mtext>out</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:munder><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>β</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mfrac><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub></mml:mfrac><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(15)</label></disp-formula></p>
        <p>We are now in position to write down the full dynamics in terms of these quantities:
<disp-formula id="pone.0230430.e022"><alternatives><graphic xlink:href="pone.0230430.e022.jpg" id="pone.0230430.e022g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M22"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>[</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>[</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub></mml:mfrac><mml:msub><mml:mi>l</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(16)</label></disp-formula></p>
        <p>Notice that when <italic>σ</italic> is Type-I (linear) and <italic>l</italic><sub><italic>α</italic></sub> = 0 for all <italic>α</italic> (no leakage or byproducts), this reduces to MacArthur’s original model [<xref rid="pone.0230430.ref006" ref-type="bibr">6</xref>].</p>
      </sec>
      <sec id="sec007">
        <title>Metabolic regulation</title>
        <p>The package can also generate dynamics for active metabolic regulation, which allocates a higher fraction of import capacity to nutrients with higher available energy flux. This regulation is implemented through a series of weight functions for resource <italic>α</italic> that reflect how much of the utilizable energy in the environment is in resource <italic>α</italic>
<disp-formula id="pone.0230430.e023"><alternatives><graphic xlink:href="pone.0230430.e023.jpg" id="pone.0230430.e023g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M23"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mtext>in</mml:mtext><mml:mo>-</mml:mo><mml:mi>w</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>reg</mml:mtext></mml:msub></mml:msup><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>β</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>reg</mml:mtext></mml:msub></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(17)</label></disp-formula>
with <italic>n</italic><sub>reg</sub> a Hill coefficient that tunes steepness. Another option is to regulate based on the fraction of biomass contained in resource <italic>α</italic>,
<disp-formula id="pone.0230430.e024"><alternatives><graphic xlink:href="pone.0230430.e024.jpg" id="pone.0230430.e024g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M24"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mtext>in</mml:mtext><mml:mo>-</mml:mo><mml:mi>ν</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>reg</mml:mtext></mml:msub></mml:msup><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>β</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>reg</mml:mtext></mml:msub></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(18)</label></disp-formula></p>
        <p>For the metabolically regulated model, we define the input fluxes by
<disp-formula id="pone.0230430.e025"><alternatives><graphic xlink:href="pone.0230430.e025.jpg" id="pone.0230430.e025g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M25"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>ν</mml:mi><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(19)</label></disp-formula></p>
        <p>Then, we can follow the exact same procedure as above. This yields the equations
<disp-formula id="pone.0230430.e026"><alternatives><graphic xlink:href="pone.0230430.e026.jpg" id="pone.0230430.e026g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M26"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>[</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mtext>in</mml:mtext></mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>[</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub></mml:mfrac><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(20)</label></disp-formula></p>
        <p>These equations are generated by the functions <monospace>MakeConsumerDynamics</monospace> and <monospace>MakeResourceDyanamics</monospace>, based on the user’s specification of the resource replenishment mode <italic>h</italic>, the response function <italic>σ</italic>, and the regulation mode <italic>u</italic>.</p>
      </sec>
    </sec>
    <sec id="sec008">
      <title>Sampling the parameters</title>
      <p>The MicroCRM contains a large number of parameters: the <italic>S</italic><sub>tot</sub>-dimensional vectors <italic>g</italic><sub><italic>i</italic></sub> and <italic>m</italic><sub><italic>i</italic></sub>, the <italic>M</italic>-dimensional vectors <inline-formula id="pone.0230430.e027"><alternatives><graphic xlink:href="pone.0230430.e027.jpg" id="pone.0230430.e027g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M27"><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <italic>τ</italic><sub><italic>α</italic></sub> or <italic>r</italic><sub><italic>α</italic></sub>, the <italic>S</italic><sub>tot</sub> × <italic>M</italic> consumer preference matrix <italic>c</italic><sub><italic>iα</italic></sub> and the <italic>M</italic> × <italic>M</italic> metabolic matrix <italic>D</italic><sub><italic>αβ</italic></sub>. Some modeling choices require a small number of additional parameters: the maximal uptake rate <italic>σ</italic><sub>max</sub> for Type-II and Type-III growth, and the exponents <italic>n</italic> for Type-III growth and <italic>n</italic><sub>reg</sub> for metabolic regulation. A dictionary containing all these parameters must be supplied to the <monospace>Community</monospace> instance upon initialization. A list of dictionaries may be supplied instead, to allow different wells to have different parameters.</p>
      <p>The package contains a function <monospace>MakeMatrices</monospace> for generating the two matrices, which contain most of the ecological structure, based on a dictionary of modeling assumptions summarized in <xref rid="pone.0230430.t002" ref-type="table">Table 2</xref>. The output of this function is illustrated in <xref ref-type="fig" rid="pone.0230430.g003">Fig 3</xref> and described in detail below.</p>
      <fig id="pone.0230430.g003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0230430.g003</object-id>
        <label>Fig 3</label>
        <caption>
          <title>Sampling parameters and adding metabolic structure.</title>
          <p><italic>(a)</italic> Sampling the consumer preference matrix <italic>c</italic><sub><italic>iα</italic></sub>. Each row corresponds to a different microbial species, and the value of each entry in the row specifies the preference level of that species for a given resource. An example of each of the three sampling choices is shown, with white pixels representing <italic>c</italic><sub><italic>iα</italic></sub> = 0 and darker pixes representing larger values. The examples have <italic>F</italic> = 3 consumer families with specialism level <italic>q</italic> = 0.9, each with <italic>S</italic><sub><italic>A</italic></sub> = 25 species, plus a generalist family with <italic>S</italic><sub>gen</sub> = 25 species. <italic>(b)</italic> Sampling the metabolic matrix <italic>D</italic><sub><italic>αβ</italic></sub>. Each column represents the allocation of output fluxes resulting from metabolism of a given input resource. This example has <italic>T</italic> = 3 resource classes, and an effective sparsity <italic>s</italic> = 0.05. <italic>(c)</italic> Diagram of three-tiered metabolic structure. A fraction <italic>f</italic><sub><italic>s</italic></sub> of the output flux is allocated to resources from the same resource class as the input, while a fraction <italic>f</italic><sub><italic>w</italic></sub> is allocated to the “waste” class (e.g., carboxylic acids). In the example of the previous panel, allocation fractions were <italic>f</italic><sub><italic>s</italic></sub> = <italic>f</italic><sub><italic>w</italic></sub> = 0.49.</p>
        </caption>
        <graphic xlink:href="pone.0230430.g003"/>
      </fig>
      <table-wrap id="pone.0230430.t002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0230430.t002</object-id>
        <label>Table 2</label>
        <caption>
          <title>Definitions of global parameters used for constructing random ecosystems.</title>
          <p>Values of these parameters are supplied as a Python dictionary to the function <monospace>MakeMatrices</monospace>, which generates randomly sampled consumer preference and metabolic matrices.</p>
        </caption>
        <alternatives>
          <graphic id="pone.0230430.t002g" xlink:href="pone.0230430.t002"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <tbody>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>M</italic>
                </td>
                <td align="left" rowspan="1" colspan="1">Number of resources</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>T</italic>
                </td>
                <td align="left" rowspan="1" colspan="1">Number of resource classes</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>S</italic>
                  <sub>tot</sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Number of microbial species in regional pool</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>F</italic>
                </td>
                <td align="left" rowspan="1" colspan="1">Number of specialist families</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>S</italic>
                </td>
                <td align="left" rowspan="1" colspan="1">Number of microbial species initially present in each local community</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>μ</italic>
                  <sub>
                    <italic>c</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Mean sum over a row of the preference matrix <italic>c</italic><sub><italic>iα</italic></sub></td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>σ</italic>
                  <sub>
                    <italic>c</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Standard deviation of sum over a row for Gaussian or Gamma <italic>c</italic><sub><italic>iα</italic></sub></td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>c</italic>
                  <sub>0</sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Low consumption level for Binary <italic>c</italic><sub><italic>iα</italic></sub></td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>c</italic>
                  <sub>1</sub>
                </td>
                <td align="left" rowspan="1" colspan="1">High consumption level for Binary <italic>c</italic><sub><italic>iα</italic></sub></td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>q</italic>
                </td>
                <td align="left" rowspan="1" colspan="1">Fraction of consumption capacity allocated to preferred resource class</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>s</italic>
                </td>
                <td align="left" rowspan="1" colspan="1">Sparsity of metabolic matrix</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>f</italic>
                  <sub>
                    <italic>w</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Fraction of secreted byproducts allocated to “waste” resource class</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>f</italic>
                  <sub>
                    <italic>s</italic>
                  </sub>
                </td>
                <td align="left" rowspan="1" colspan="1">Fraction of secreted byproducts allocated to same resource class</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <sec id="sec009">
        <title>Consumer preferences <italic>c</italic><sub><italic>iα</italic></sub></title>
        <p>We choose consumer preferences <italic>c</italic><sub><italic>iα</italic></sub> as follows. As stated earlier, we assume that each specialist family has a preference for one resource class <italic>A</italic> (where <italic>A</italic> = 1…<italic>F</italic>) with 0 ≤ <italic>F</italic> ≤ <italic>T</italic>, and we denote the consumer coefficients for this family by <inline-formula id="pone.0230430.e028"><alternatives><graphic xlink:href="pone.0230430.e028.jpg" id="pone.0230430.e028g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M28"><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>. We also consider generalists that have no preferences, with consumer coefficients <inline-formula id="pone.0230430.e029"><alternatives><graphic xlink:href="pone.0230430.e029.jpg" id="pone.0230430.e029g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M29"><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>gen</mml:mtext></mml:msubsup></mml:math></alternatives></inline-formula>. The <inline-formula id="pone.0230430.e030"><alternatives><graphic xlink:href="pone.0230430.e030.jpg" id="pone.0230430.e030g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M30"><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> can be drawn from one of three probability distributions: (i) a Normal/Gaussian distribution, (ii) a Gamma distribution (which ensure positivity of the coefficients), and (iii) a Bernoulli distribution with binary preference levels. <xref ref-type="fig" rid="pone.0230430.g003">Fig 3</xref> shows examples of all three models.</p>
        <p>The Gaussian model is parameterized in terms of the mean <italic>μ</italic><sub><italic>c</italic></sub> = 〈∑<sub><italic>α</italic></sub>
<italic>c</italic><sub><italic>iα</italic></sub>〉 and variance <inline-formula id="pone.0230430.e031"><alternatives><graphic xlink:href="pone.0230430.e031.jpg" id="pone.0230430.e031g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M31"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mtext>var</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> of the total consumption capacity, and a parameter <italic>q</italic> that controls how specialized each family is for its preferred resource class. In the generalist family, the mean and variance of <italic>c</italic><sub><italic>iα</italic></sub> are the same for all resources, and are given by
<disp-formula id="pone.0230430.e032"><alternatives><graphic xlink:href="pone.0230430.e032.jpg" id="pone.0230430.e032g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M32"><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>gen</mml:mtext></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>μ</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mi>M</mml:mi></mml:mfrac></mml:mrow></mml:math></alternatives><label>(21)</label></disp-formula>
<disp-formula id="pone.0230430.e033"><alternatives><graphic xlink:href="pone.0230430.e033.jpg" id="pone.0230430.e033g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M33"><mml:mrow><mml:mo>⟨</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>δ</mml:mi><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>gen</mml:mtext></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>⟩</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>M</mml:mi></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></alternatives><label>(22)</label></disp-formula>
where <inline-formula id="pone.0230430.e034"><alternatives><graphic xlink:href="pone.0230430.e034.jpg" id="pone.0230430.e034g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M34"><mml:mrow><mml:mi>δ</mml:mi><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>gen</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>gen</mml:mtext></mml:msubsup><mml:mo>-</mml:mo><mml:mrow><mml:mo>〈</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>gen</mml:mtext></mml:msubsup><mml:mo>〉</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> is the deviation from the mean value. The specialist families sample from a distribution with a larger mean for resources in their preferred class:
<disp-formula id="pone.0230430.e035"><alternatives><graphic xlink:href="pone.0230430.e035.jpg" id="pone.0230430.e035g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M35"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow><mml:mo>⟨</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup><mml:mo>⟩</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msub><mml:mi>μ</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mi>M</mml:mi></mml:mfrac><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>M</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mfrac><mml:mi>q</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mi>α</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold">A</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msub><mml:mi>μ</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mi>M</mml:mi></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>otherwise</mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(23)</label></disp-formula>
where <italic>M</italic><sub><italic>A</italic></sub> is the number of resources in class <italic>A</italic> and <bold>A</bold> is the set of resource indices in class <italic>A</italic>. The variances are likewise larger for the preferred class:
<disp-formula id="pone.0230430.e036"><alternatives><graphic xlink:href="pone.0230430.e036.jpg" id="pone.0230430.e036g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M36"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow><mml:mo>⟨</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>δ</mml:mi><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>⟩</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>M</mml:mi></mml:mfrac><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>M</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mfrac><mml:mi>q</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mi>α</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold">A</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>M</mml:mi></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>otherwise</mml:mtext><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(24)</label></disp-formula></p>
        <p>This makes it possible to construct pure specialist families with no off-target consumption by setting <italic>q</italic> = 1. Note that this is different from the original version of this model in [<xref rid="pone.0230430.ref022" ref-type="bibr">22</xref>], where all the variances were chosen to be identical.</p>
        <p>We also consider the case where consumer preferences are drawn from Gamma distributions, which guarantee that all coefficients are positive. Since the Gamma distribution only has two parameters, it is fully determined once the mean and variance are specified. We parameterize the mean and variance for this model in the same way as for the Gaussian model.</p>
        <p>In the binary model, there are only two possible values for each <italic>c</italic><sub><italic>iα</italic></sub>: a low level <inline-formula id="pone.0230430.e037"><alternatives><graphic xlink:href="pone.0230430.e037.jpg" id="pone.0230430.e037g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M37"><mml:mfrac><mml:msub><mml:mi>c</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mi>M</mml:mi></mml:mfrac></mml:math></alternatives></inline-formula> and a high level <inline-formula id="pone.0230430.e038"><alternatives><graphic xlink:href="pone.0230430.e038.jpg" id="pone.0230430.e038g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M38"><mml:mrow><mml:mfrac><mml:msub><mml:mi>c</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mi>M</mml:mi></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. The elements of <inline-formula id="pone.0230430.e039"><alternatives><graphic xlink:href="pone.0230430.e039.jpg" id="pone.0230430.e039g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M39"><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> are given by
<disp-formula id="pone.0230430.e040"><alternatives><graphic xlink:href="pone.0230430.e040.jpg" id="pone.0230430.e040g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M40"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>c</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mi>M</mml:mi></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(25)</label></disp-formula>
where <italic>X</italic><sub><italic>iα</italic></sub> is a binary random variable that equals 1 with probability
<disp-formula id="pone.0230430.e041"><alternatives><graphic xlink:href="pone.0230430.e041.jpg" id="pone.0230430.e041g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M41"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msub><mml:mi>μ</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mrow><mml:mi>M</mml:mi><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>[</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>M</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mfrac><mml:mi>q</mml:mi><mml:mo>]</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mi>α</mml:mi><mml:mo>∈</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msub><mml:mi>μ</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mrow><mml:mi>M</mml:mi><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(26)</label></disp-formula>
for the specialist families, and
<disp-formula id="pone.0230430.e042"><alternatives><graphic xlink:href="pone.0230430.e042.jpg" id="pone.0230430.e042g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M42"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mtext>gen</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>μ</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mrow><mml:mi>M</mml:mi><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(27)</label></disp-formula>
for the generalists. Note that the variance in each family is <inline-formula id="pone.0230430.e043"><alternatives><graphic xlink:href="pone.0230430.e043.jpg" id="pone.0230430.e043g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M43"><mml:mrow><mml:mrow><mml:mo>〈</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>δ</mml:mi><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>〉</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>∼</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mi>A</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> for large <italic>M</italic>, which depends on <italic>q</italic> in the same way as the variances in the Gaussian case.</p>
      </sec>
      <sec id="sec010">
        <title>Metabolic matrix <italic>D</italic><sub><italic>αβ</italic></sub></title>
        <p>We choose the metabolic matrix <italic>D</italic><sub><italic>αβ</italic></sub> according to a three-tiered secretion model illustrated in <xref ref-type="fig" rid="pone.0230430.g003">Fig 3</xref>. The first tier is a preferred class of ‘waste’ products, such as carboyxlic acids for fermentative and respiro-fermentative bacteria, with <italic>M</italic><sub><italic>w</italic></sub> members. The second tier contains byproducts of the same class as the input resource. For example, this could be attributed to the partial oxidation of sugars into sugar alcohols, or the antiporter behavior of various amino acid transporters. The third tier includes everything else. We encode this structure in <italic>D</italic><sub><italic>αβ</italic></sub> by sampling each column <italic>β</italic> of the matrix from a Dirichlet distribution with concentration parameters <italic>d</italic><sub><italic>αβ</italic></sub> that depend on the byproduct tier, so that on average a fraction <italic>f</italic><sub><italic>w</italic></sub> of the secreted flux goes to the first tier, while a fraction <italic>f</italic><sub><italic>s</italic></sub> goes to the second tier, and the rest goes to the third. The Dirichlet distribution has the property that each sampled vector sums to 1, making it a natural way of randomly allocating a fixed total quantity (such as the total secretion flux from a given input). To write the expressions for these parameters explicitly, we let <italic>A</italic>(<italic>α</italic>) represent the class containing resource <italic>α</italic>, and let <italic>w</italic> represent the ‘waste’ class. We also introduce a parameter <italic>s</italic> that controls the sparsity of the reaction network, ranging from a dense network with all-to-all connection when <italic>s</italic> → 0, to maximal sparsity with each input resource having just one randomly chosen output resource as <italic>s</italic> → 1. With this notation, we have
<disp-formula id="pone.0230430.e044"><alternatives><graphic xlink:href="pone.0230430.e044.jpg" id="pone.0230430.e044g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M44"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:mtext>Dir</mml:mtext><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mn>3</mml:mn><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>α</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(28)</label></disp-formula>
<disp-formula id="pone.0230430.e045"><alternatives><graphic xlink:href="pone.0230430.e045.jpg" id="pone.0230430.e045g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M45"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msub><mml:mi>f</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mrow><mml:mi>s</mml:mi><mml:msub><mml:mi>M</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="0.166667em"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo><mml:mo>≠</mml:mo><mml:mi>w</mml:mi><mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext><mml:mspace width="4.pt"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>w</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:msub><mml:mi>f</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mrow><mml:mi>s</mml:mi><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="0.166667em"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo><mml:mo>≠</mml:mo><mml:mi>w</mml:mi><mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext><mml:mspace width="4.pt"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>(</mml:mo><mml:mi>M</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="0.166667em"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo><mml:mo>≠</mml:mo><mml:mi>w</mml:mi><mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext><mml:mspace width="4.pt"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo><mml:mo>≠</mml:mo><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:msub><mml:mi>M</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="0.166667em"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>w</mml:mi><mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext><mml:mspace width="4.pt"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>w</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>(</mml:mo><mml:mi>M</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="0.166667em"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>w</mml:mi><mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext><mml:mspace width="4.pt"/><mml:mi>A</mml:mi><mml:mo>(</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo><mml:mo>≠</mml:mo><mml:mi>w</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(29)</label></disp-formula></p>
        <p>The final two lines handle the case when the ‘waste’ type is being consumed. For these columns, the first and second tiers are identical. This led to an ambiguity in the expression presented in the Supporting Information of [<xref rid="pone.0230430.ref022" ref-type="bibr">22</xref>], which we have now clarified by treating this case separately.</p>
      </sec>
    </sec>
    <sec id="sec011">
      <title>Propagation in time</title>
      <p>Once an instance of the <monospace>Community</monospace> class is initialized, its state can be propagated forward in time using the <monospace>Propagate</monospace> method, as illustrated in <xref ref-type="fig" rid="pone.0230430.g001">Fig 1</xref>. Since the dynamical equations and parameters were supplied at initialization, the only required argument for this method is the time <italic>T</italic>. When the method is invoked, the state and parameters for each well are sent to different CPU’s (as many as are available) using the <monospace>Pool.map</monospace> function from the <monospace>multiprocessing</monospace> module in the Python standard library. Then the dynamical equations are integrated using the <monospace>odeint</monospace> function from SciPy, which calls the LSODA solver from the FORTRAN library ODEPACK [<xref rid="pone.0230430.ref026" ref-type="bibr">26</xref>, <xref rid="pone.0230430.ref027" ref-type="bibr">27</xref>].</p>
      <p>If the initial population size of a species equals zero, but its per-capita growth rate is positive under current environmental conditions, the limited precision of any numerical solver will enable that species to spontaneously invade the community. To prevent this from happening, the <monospace>Propagate</monospace> method comes with an option <monospace>compress_species</monospace> (set to <monospace>True</monospace> by default), which reduces the dimensionality of the state and parameters before invoking the solver by removing all references to extinct species. Compression requires deciding whether each dimension of each parameter array corresponds to species or resources. This information is built in to the package for the MicroCRM, so <monospace>c</monospace>, <monospace>D</monospace>,<monospace>w</monospace>, <monospace>g</monospace>, <monospace>m</monospace>, <monospace>l</monospace>, <monospace>R0</monospace>, <monospace>tau</monospace> and <monospace>r</monospace> are all automatically handled correctly according to their definitions in that context. If custom dynamics are used, a dictionary of parameter dimensions must be supplied to the optional argument <monospace>dimensions</monospace> of <monospace>Community</monospace> when the instance is initialized, listing which parameters are of length S, length M, or of shape SxM, SxS, or MxM, respectively.</p>
    </sec>
    <sec id="sec012">
      <title>Passaging to fresh plates</title>
      <p>The second method that can be invoked on a <monospace>Community</monospace> instance is <monospace>Passage</monospace>, which simulates pipetting of cultures to fresh wells in a typical 96-well plate experiment. The only required argument for <monospace>Passage</monospace> is a two-dimensional array <monospace>f</monospace>, whose elements <italic>f</italic><sub><italic>μν</italic></sub> specify the fraction of the contents of well <italic>ν</italic> from the old plate that should be transfered to well <italic>μ</italic> on the new plate. The method also contains an option <monospace>refresh_resource</monospace>, set to <monospace>True</monospace> by default, that supplies the new plate with the same initial resource concentrations as the original one. This is the most direct way of simulating actual 96-well plate experiments, where the resources are resupplied in discrete intervals at each passaging step.</p>
      <p>This method facilitates simulation of various kinds of mixing or coalescence experiments, as well as metacommunity dynamics of weakly coupled local communities. <xref ref-type="fig" rid="pone.0230430.g004">Fig 4</xref> illustrates how this feature can capture coarse-grained spatial structure, following an experimental protocol developed for mimicking range expansions in 96-well plates [<xref rid="pone.0230430.ref028" ref-type="bibr">28</xref>].</p>
      <fig id="pone.0230430.g004" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0230430.g004</object-id>
        <label>Fig 4</label>
        <caption>
          <title>Propagating and passaging.</title>
          <p><italic>(a)</italic> System state after successive applications of the method to a plate with <italic>n</italic> = 100 wells, with a single externally supplied resource (blue). Each column of a panel represents a different well, and the height of each colored patch represents the abundance of a different consumer species or resource type. Each panel is normalized so that the sample with the largest total biomass or total resource concentration spans the entire panel. As time passes, the resources become more diverse due to the generation of metabolic byproducts, while the consumers become less diverse through competitive exclusion. <italic>(b)</italic> Modeling spatial structure with a stepping stone model. At each time step, each cell in a given well can migrate to neighboring wells with probability <italic>m</italic>. <italic>(c)</italic> Implementation of stepping stone model in a 96-well plate. Every day, the communities are passaged to fresh wells, with a fraction <italic>f</italic><sub>0</sub>(1 − <italic>m</italic>) transferred to the corresponding position in the new set of wells, and <italic>f</italic><sub>0</sub>
<italic>m</italic> divided equally between the two nearest neighbors, where <italic>f</italic><sub>0</sub> is an overall dilution factor. <italic>(d)</italic> Transfer matrix <italic>f</italic> implementing the stepping stone protocol. <italic>(e)</italic> Simulated range expansion using successive applications of the and methods, with the transfer matrix from the previous panel. See the Jupyter notebook included with the package for all simulation details.</p>
        </caption>
        <graphic xlink:href="pone.0230430.g004"/>
      </fig>
      <p>In addition, passaging helps to stabilize long simulations, and simulate demographic noise, by setting all cell counts to integer values. The species abundances <italic>N</italic><sub><italic>i</italic></sub> are converted to absolute cell counts through a conversion factor <monospace>scale</monospace>, which is by default set to 10<sup>6</sup>. Then the new integer cell counts are generated by multinomial sampling based on the average number of cells ∑<sub><italic>ν</italic></sub>
<italic>f</italic><sub><italic>μν</italic></sub>(<italic>N</italic><sub><italic>i</italic></sub>)<sub><italic>ν</italic></sub> of species <italic>i</italic> transferred to well <italic>μ</italic>. One source of numerical instability in ecological models is the exponentially small values reached by population sizes headed for extinction. The multinomial sampling ensures that these population sizes are fixed at zero when they become significantly smaller than 1 in absolute units. Thus a simple way of avoiding instability in a continuously resupplied chemostat model is to periodically call <monospace>Passage</monospace> with <monospace>f</monospace> set to the identity matrix and <monospace>refresh_resource</monospace> set to <monospace>False</monospace>.</p>
      <p>Since the most common experiments involve many iterations of identical <monospace>Passage</monospace> and <monospace>Propagate</monospace> steps, the package also includes a method <monospace>RunExperiment(f,T,np)</monospace>, which applies a given transfer matrix <monospace>f</monospace> and propagation time <monospace>T</monospace> for <monospace>np</monospace> iterations, saving a snapshot of the plate after each propagation step. If passaging is being used simply to stabilize the integration as discussed above, and not to simulate a batch culture setting, then the value of <italic>T</italic> does not affect the results (as long as it is short enough to successfully eliminate instabilities). In this case, this variable mainly serves to control the time-resolution of the resulting timeseries.</p>
    </sec>
    <sec id="sec013">
      <title>Finding equilibrium points with convex optimization and expectation maximization</title>
      <p>In many experimental contexts, one is interested in the stable community structure reached after a long period of constant environmental conditions. Numerical integration of the dynamical equations is an inefficient way to identify these equilibrium points. When the species diversity and number of resource types are high, the equations typically contain complex transient dynamics spanning a large range of time scales. This transient behavior is often irrelevant to the identification of the final equilibrium point, and wastes significant computation time. For a typical implementation of the MicroCRM with Type-I response and a 1, 280 × 1, 280 binary consumer matrix, integrating to the steady state takes about 37 hours on standard hardware. The computation time appears to scale asymptotically as <italic>M</italic><sup>4</sup> when the number of species <italic>S</italic> and the number of resources <italic>M</italic> are changed simultaneously, as shown in <xref ref-type="fig" rid="pone.0230430.g006">Fig 6</xref>.</p>
      <p>To address this problem, we have developed an algorithm for identifying equilibrium points directly, without integration through the transient. This algorithm is implemented in Community Simulator as the method <monospace>SteadyState</monospace>, and is illustrated in <xref ref-type="fig" rid="pone.0230430.g005">Fig 5</xref>. Under the same test conditions, this algorithm converges between one and two orders of magnitude faster than numerical integration, as shown in <xref ref-type="fig" rid="pone.0230430.g006">Fig 6</xref>, facilitating rapid hypothesis evaluation and iteration in large ecosystems. Note that while all other features of the Community Simulator depend only on packages included with a standard Anaconda installation (<ext-link ext-link-type="uri" xlink:href="https://www.anaconda.com/">https://www.anaconda.com/</ext-link>), <monospace>SteadyState</monospace> additionally requires prior installation of a convex optimization package called CVXPY (<ext-link ext-link-type="uri" xlink:href="https://www.cvxpy.org/">https://www.cvxpy.org/</ext-link>).</p>
      <fig id="pone.0230430.g005" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0230430.g005</object-id>
        <label>Fig 5</label>
        <caption>
          <title>An expectation-maximization algorithm for finding noninvadable stationary states.</title>
          <p><italic>(a)</italic> Noninvadable states by definition can only exist in the region Ω of resource space where the growth rate <italic>dN</italic><sub><italic>i</italic></sub>/<italic>dt</italic> of each species <italic>i</italic> is zero or negative. Here, the blue and orange lines represent the combinations of resource abundances leading to zero growth rate for two different consumer species, so the noninvadable region is the space beneath both of the lines. Within this region, a recently discovered duality implies that the stationary state <bold>R</bold>* locally minimizes the dissimilarity <italic>d</italic>(<bold>R</bold><sup>0</sup>, <bold>R</bold>) with respect to the fixed point <bold>R</bold><sup>0</sup> of the intrinsic environmental dynamics [<xref rid="pone.0230430.ref023" ref-type="bibr">23</xref>, <xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>]. <italic>(b)</italic> Metabolic byproducts move the relevant unperturbed state from <bold>R</bold><sup>0</sup> (gray ‘x’) to <inline-formula id="pone.0230430.e046"><alternatives><graphic id="pone.0230430.e046g" xlink:href="pone.0230430.e046"/><mml:math id="M46"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi mathvariant="bold">R</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> (black ‘x’), which is itself a function of the current environmental conditions. Dotted contour lines represent <inline-formula id="pone.0230430.e047"><alternatives><graphic id="pone.0230430.e047g" xlink:href="pone.0230430.e047"/><mml:math id="M47"><mml:mrow><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="bold">R</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, and arrows are two trajectories of the population dynamics starting from the unperturbed environmental state with two different sets of initial consumer population sizes. See main text and Appendix for model details and parameters. <italic>(c)</italic> Pseudocode for self-consistently computing <bold>R</bold>* and <inline-formula id="pone.0230430.e048"><alternatives><graphic id="pone.0230430.e048g" xlink:href="pone.0230430.e048"/><mml:math id="M48"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, which is identical to standard expectation-maximization algorithms employed for problems with latent variables in machine learning.</p>
        </caption>
        <graphic xlink:href="pone.0230430.g005"/>
      </fig>
      <fig id="pone.0230430.g006" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0230430.g006</object-id>
        <label>Fig 6</label>
        <caption>
          <title>Performance of EM algorithm versus ODE integration.</title>
          <p>The steady state of the MicroCRM was computed by direct ODE integration and with our new EM algorithm for a range of values of the number of resource types <italic>M</italic>. The initial number of species <italic>S</italic> was set equal to <italic>M</italic>, and a single resource type was externally supplied with intrinsic fixed point <inline-formula id="pone.0230430.e049"><alternatives><graphic id="pone.0230430.e049g" xlink:href="pone.0230430.e049"/><mml:math id="M49"><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mn>1</mml:mn><mml:mn>0</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>M</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> (<inline-formula id="pone.0230430.e050"><alternatives><graphic id="pone.0230430.e050g" xlink:href="pone.0230430.e050"/><mml:math id="M50"><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula> for all <italic>i</italic> &gt; 1). The absolute error tolerance of the integrator was set to 10<sup>−4</sup>, and the convergence tolerance for the EM algorithm was set to <italic>δ</italic> = 10<sup>−7</sup>. See ‘scripts’ folder in the ‘EM-algorithm’ branch of the GitHub repository for the rest of the parameters, which were held fixed for all simulations. (a) Total computation time for 10 realizations. <italic>(b)</italic> Final root-mean-square per-capita deviation of the growth rate from zero (‘Error’) over all surviving species in all 10 samples.</p>
        </caption>
        <graphic xlink:href="pone.0230430.g006"/>
      </fig>
      <p>The algorithm exploits a recently discovered duality between consumer resource models and constrained optimization over resource space [<xref rid="pone.0230430.ref023" ref-type="bibr">23</xref>, <xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>], which generalizes a minimization principle originally identified by MacArthur in the context of his original Consumer Resource Model [<xref rid="pone.0230430.ref006" ref-type="bibr">6</xref>]. This duality applies to a wide class of consumer-resource type models, requiring only that the environmentally mediated interactions between pairs of consumer species are symmetric [<xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>].</p>
      <p>For models in this class, it was shown that the vector of resource abundances <bold>R</bold>* in every stable equilibrium state locally minimizes a measure <italic>d</italic>(<bold>R</bold><sup>0</sup>, <bold>R</bold>) of the dissimilarity between the current resource abundances <bold>R</bold> and the supply point <bold>R</bold><sup>0</sup> (defined in general by <inline-formula id="pone.0230430.e051"><alternatives><graphic xlink:href="pone.0230430.e051.jpg" id="pone.0230430.e051g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M51"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>), subject to the constraint that all consumer growth rates are zero or negative (<italic>dN</italic><sub><italic>i</italic></sub>/<italic>dt</italic> ≤ 0 for all <italic>i</italic>). Instances of the MicroCRM with Type I resource consumption, no metabolic regulation and <italic>l</italic><sub><italic>α</italic></sub> = 0 fall into this class. For externally supplied resources, <italic>d</italic> turns out to be a weighted Kullback-Leibler (KL) divergence:
<disp-formula id="pone.0230430.e052"><alternatives><graphic xlink:href="pone.0230430.e052.jpg" id="pone.0230430.e052g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M52"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>d</mml:mi><mml:mtext>external</mml:mtext></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mn>0</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">R</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>β</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>β</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>[</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo form="prefix">ln</mml:mo><mml:mfrac><mml:msubsup><mml:mi>R</mml:mi><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub></mml:mfrac><mml:mo>-</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>-</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(30)</label></disp-formula>
while for self-renewing resources, it is a weighted Euclidean distance [<xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>]:
<disp-formula id="pone.0230430.e053"><alternatives><graphic xlink:href="pone.0230430.e053.jpg" id="pone.0230430.e053g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M53"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>d</mml:mi><mml:mrow><mml:mtext>self</mml:mtext><mml:mo>-</mml:mo><mml:mtext>renewing</mml:mtext></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mn>0</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">R</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>β</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msub><mml:mi>r</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>-</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(31)</label></disp-formula></p>
      <p>The equilibrium consumer populations <inline-formula id="pone.0230430.e054"><alternatives><graphic xlink:href="pone.0230430.e054.jpg" id="pone.0230430.e054g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M54"><mml:msubsup><mml:mi>N</mml:mi><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> are the Lagrange multipliers that enforce the constraints. For models with Type-I response, the non-invadable region is convex, allowing for efficient solution of the optimization problem using the Python package CVXPY [<xref rid="pone.0230430.ref029" ref-type="bibr">29</xref>, <xref rid="pone.0230430.ref030" ref-type="bibr">30</xref>].</p>
      <p>The duality does not strictly apply to other variants of the MicroCRM. In particular, byproduct secretion breaks the symmetry of the effective interactions between consumers whenever <italic>l</italic><sub><italic>α</italic></sub> &gt; 0 for some resource <italic>α</italic>. The duality can be recovered, however, if the equilibrium point <bold>R</bold><sup>0</sup> of the intrinsic resource dynamics is changed to a new value <inline-formula id="pone.0230430.e055"><alternatives><graphic xlink:href="pone.0230430.e055.jpg" id="pone.0230430.e055g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M55"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, which accounts for the extra resources produced by the consumer species when the system is at its equilibrium state <bold>R</bold>* [<xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>]. This accounting can be done in a variety of ways that all successfully recover the duality, with varying degrees of computational efficiency. The currently implemented form is
<disp-formula id="pone.0230430.e056"><alternatives><graphic xlink:href="pone.0230430.e056.jpg" id="pone.0230430.e056g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M56"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>β</mml:mi><mml:mo>≠</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>β</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>β</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(32)</label></disp-formula>
where
<disp-formula id="pone.0230430.e057"><alternatives><graphic xlink:href="pone.0230430.e057.jpg" id="pone.0230430.e057g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M57"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:msub><mml:mi>w</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(33)</label></disp-formula>
and <inline-formula id="pone.0230430.e058"><alternatives><graphic xlink:href="pone.0230430.e058.jpg" id="pone.0230430.e058g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M58"><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula> are the elements of the matrix inverse of <italic>Q</italic><sub><italic>αβ</italic></sub>, satisfying <inline-formula id="pone.0230430.e059"><alternatives><graphic xlink:href="pone.0230430.e059.jpg" id="pone.0230430.e059g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M59"><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mi>β</mml:mi></mml:msub><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>β</mml:mi><mml:mi>γ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>γ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. With these definitions, one can show that the MicroCRM with Type I consumption and no regulation minimizes the objective function
<disp-formula id="pone.0230430.e060"><alternatives><graphic xlink:href="pone.0230430.e060.jpg" id="pone.0230430.e060g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M60"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>d</mml:mi><mml:mtext>byproducts</mml:mtext></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">R</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>β</mml:mi></mml:munder><mml:msub><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>β</mml:mi></mml:msub><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>β</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>[</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo form="prefix">ln</mml:mo><mml:mfrac><mml:msubsup><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub></mml:mfrac><mml:mo>-</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>-</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>β</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(34)</label></disp-formula>
where
<disp-formula id="pone.0230430.e061"><alternatives><graphic xlink:href="pone.0230430.e061.jpg" id="pone.0230430.e061g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M61"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>α</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>α</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mi>w</mml:mi><mml:mi>α</mml:mi></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(35)</label></disp-formula></p>
      <p>To find <bold>R</bold>*, one must now self-consistently solve the following equation:
<disp-formula id="pone.0230430.e062"><alternatives><graphic xlink:href="pone.0230430.e062.jpg" id="pone.0230430.e062g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M62"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:munder><mml:mtext>argmin</mml:mtext><mml:mi mathvariant="bold">R</mml:mi></mml:munder><mml:mspace width="0.166667em"/><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="bold">R</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(36)</label></disp-formula></p>
      <p>The structure of this problem is mathematically equivalent to a standard task in machine learning, where one attempts to infer model parameters from partial data [<xref rid="pone.0230430.ref031" ref-type="bibr">31</xref>]. These parameters <italic>θ</italic> specify a multivariate probability distribution <italic>p</italic>(<bold>y</bold>|<italic>θ</italic>) for a set of measurements <bold>y</bold>. A standard way of estimating the parameters is to compute the values <inline-formula id="pone.0230430.e063"><alternatives><graphic xlink:href="pone.0230430.e063.jpg" id="pone.0230430.e063g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M63"><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> that maximize the likelihood of the data: <inline-formula id="pone.0230430.e064"><alternatives><graphic xlink:href="pone.0230430.e064.jpg" id="pone.0230430.e064g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M64"><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:munder><mml:mtext>argmax</mml:mtext><mml:mi>θ</mml:mi></mml:munder><mml:mspace width="0.166667em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi mathvariant="bold">y</mml:mi><mml:mo>|</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. But if one actually has access to only a subset <bold>x</bold> of the measurement results, then the values <bold>z</bold> of the remaining quantities must also be estimated in order to perform this optimization. Ideally, one would use the statistical model with the optimal parameters <inline-formula id="pone.0230430.e065"><alternatives><graphic xlink:href="pone.0230430.e065.jpg" id="pone.0230430.e065g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M65"><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> for this task. In the simplest case, where the value of <bold>z</bold> can be inferred with certainty given <italic>θ</italic> and <bold>x</bold>, this results in the following self-consistency equation:
<disp-formula id="pone.0230430.e066"><alternatives><graphic xlink:href="pone.0230430.e066.jpg" id="pone.0230430.e066g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M66"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:munder><mml:mtext>argmax</mml:mtext><mml:mi>θ</mml:mi></mml:munder><mml:mspace width="0.166667em"/><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">z</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>|</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(37)</label></disp-formula></p>
      <p>This is identical in form to <xref ref-type="disp-formula" rid="pone.0230430.e062">Eq 36</xref>, where the parameters <italic>θ</italic> become the resource concentrations <bold>R</bold> and the estimated latent variables <bold>z</bold> become the effective unperturbed state <inline-formula id="pone.0230430.e067"><alternatives><graphic xlink:href="pone.0230430.e067.jpg" id="pone.0230430.e067g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M67"><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup></mml:math></alternatives></inline-formula>. The observed data <bold>x</bold> become the model parameters, which are implicitly used in the calculation of <italic>d</italic> and <inline-formula id="pone.0230430.e068"><alternatives><graphic xlink:href="pone.0230430.e068.jpg" id="pone.0230430.e068g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M68"><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula>. We can think of the environmental perturbation <italic>d</italic> as a statistical potential or “free energy” −ln<italic>p</italic>, which is minimized when <italic>p</italic> is maximized.</p>
      <p><xref ref-type="disp-formula" rid="pone.0230430.e066">Eq 37</xref> can be solved by a standard iterative approach called Expectation Maximization [<xref rid="pone.0230430.ref031" ref-type="bibr">31</xref>]. At each iteration <italic>t</italic>, the latent variable <bold>z</bold><sub><italic>t</italic></sub> is computed from the previous estimate <inline-formula id="pone.0230430.e069"><alternatives><graphic xlink:href="pone.0230430.e069.jpg" id="pone.0230430.e069g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M69"><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> of <inline-formula id="pone.0230430.e070"><alternatives><graphic xlink:href="pone.0230430.e070.jpg" id="pone.0230430.e070g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M70"><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula>, and then the new parameter estimate <inline-formula id="pone.0230430.e071"><alternatives><graphic xlink:href="pone.0230430.e071.jpg" id="pone.0230430.e071g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M71"><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:math></alternatives></inline-formula> is found by maximizing <italic>p</italic>(<bold>x</bold>, <bold>z</bold><sub><italic>t</italic></sub>|<italic>θ</italic>). <xref ref-type="fig" rid="pone.0230430.g005">Fig 5(c)</xref> contains pseudocode for this algorithm as applied to our ecological problem, which was also reported previously in [<xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>].</p>
      <p>This algorithm fails to converge at low resource supply levels, because both arguments must be positive when <italic>d</italic> is a weighted KL divergence, but <inline-formula id="pone.0230430.e072"><alternatives><graphic xlink:href="pone.0230430.e072.jpg" id="pone.0230430.e072g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M72"><mml:msubsup><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> can temporarily become negative under these conditions. To solve this issue, we replaced update step for <inline-formula id="pone.0230430.e073"><alternatives><graphic xlink:href="pone.0230430.e073.jpg" id="pone.0230430.e073g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M73"><mml:msubsup><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> by
<disp-formula id="pone.0230430.e074"><alternatives><graphic xlink:href="pone.0230430.e074.jpg" id="pone.0230430.e074g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M74"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>←</mml:mo><mml:mi>α</mml:mi><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">R</mml:mi><mml:mi>t</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>α</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives></disp-formula>
where <italic>α</italic> is a constant rate, equivalent to the “learning rate” in machine learning [<xref rid="pone.0230430.ref031" ref-type="bibr">31</xref>].</p>
      <p>Default values of the tolerance <italic>δ</italic> and learning rate <italic>α</italic> are set to 10<sup>−7</sup> and 0.5, respectively, which give robust convergence for typical simulation scenarios. They can be adjusted as optional arguments of the <monospace>SteadyState</monospace> method.</p>
      <p>This algorithm can be applied to any consumer-resource type model, including models beyond the MicroCRM framework, with non-substitutable resources [<xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>]. But the enhanced efficiency of the new approach requires that the optimization problem be convex. In the Community Simulator package, the algorithm is only implemented for Type-I response with no metabolic regulation, where convexity is guaranteed. For more complex models, the differential equations must be numerically integrated using the <monospace>Propagate</monospace> method discussed above.</p>
      <p>In the tutorial notebook included with the package, we show that the MicroCRM can be bistable if the externally supplied resources are insufficient to directly support growth of any consumer species. In this scenario the state with all consumers extinct is a stable equilibrium of the dynamics, and another stable equilibrium with persisting consumers is also possible that relies on the metabolic byproducts. In this scenario <monospace>SteadyState</monospace> method can find either of the two equilibria, depending on the initial estimate of <inline-formula id="pone.0230430.e075"><alternatives><graphic xlink:href="pone.0230430.e075.jpg" id="pone.0230430.e075g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M75"><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup></mml:math></alternatives></inline-formula>, which can be set by an optional argument. If this initial condition is sufficiently close to the actual equilibrium state <bold>R</bold><sup>0</sup> of the intrinsic resource dynamics, the method ends in the state with the consumers extinct, where <inline-formula id="pone.0230430.e076"><alternatives><graphic xlink:href="pone.0230430.e076.jpg" id="pone.0230430.e076g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M76"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mn>0</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mi mathvariant="bold">R</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>. But if the initial condition is not deliberately tuned to be close to <bold>R</bold><sup>0</sup>, we find that the method typically finds the other state where some consumers survive.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec014">
    <title>Conclusions</title>
    <p>We hope that the Community Simulator will become a valuable resource for the microbial ecology community. It has already played an important role in our own work. The package initially facilitated the systematic evaluation of the robustness of results to different modeling assumptions in a study of the effects of total energy influx on community structure, diversity and function [<xref rid="pone.0230430.ref024" ref-type="bibr">24</xref>]. More recently, the convex optimization approach has made it possible to perform more than 100,000 independent simulations in a reinterpretation and extension of Robert May’s classic work on diversity and stability [<xref rid="pone.0230430.ref032" ref-type="bibr">32</xref>, <xref rid="pone.0230430.ref033" ref-type="bibr">33</xref>]. We have also employed the package to reproduce large-scale patterns in microbial biodiversity from the Human Microbiome Project, Earth Microbiome Project, and similar surveys [<xref rid="pone.0230430.ref034" ref-type="bibr">34</xref>]. Finally, the random matrix approach implemented in this package is amenable to analytic calculation in the limit of large numbers of species and resources, using cavity methods from the physics of disordered systems [<xref rid="pone.0230430.ref035" ref-type="bibr">35</xref>, <xref rid="pone.0230430.ref036" ref-type="bibr">36</xref>]. It is our belief that the Community Simulator will facilitate the further development of these mathematical techniques through efficient testing of new conjectures.</p>
    <p>One interesting future direction to explore is integrating the Community Simulator with methods for directly analyzing Microbiome sequencing data. For example, there has been a renewed interest in statistical techniques such as Approximate Bayesian Computation (ABC) for understanding ecology and evolution [<xref rid="pone.0230430.ref037" ref-type="bibr">37</xref>]. In ABC, the need to exactly calculate complicated likelihood functions—often a prerequisite for many statistical techniques—is replaced with the calculation of summary statistics and numerical simulations. For this reason, the Community Simulator Python package is ideally suited to form the backbone of new inference techniques for trying to related ecological processes to observed abundance patterns in microbial ecosystems.</p>
  </sec>
  <sec id="sec015">
    <title>Availability and requirements</title>
    <list list-type="bullet">
      <list-item>
        <p><bold>Project name</bold>: Community Simulator</p>
      </list-item>
      <list-item>
        <p><bold>Project home page</bold>: <ext-link ext-link-type="uri" xlink:href="https://github.com/Emergent-Behaviors-in-Biology/community-simulator">https://github.com/Emergent-Behaviors-in-Biology/community-simulator</ext-link></p>
      </list-item>
      <list-item>
        <p><bold>Operating system(s)</bold>: Linux or Mac preferred. Parallelization scheme is currently incompatible with Windows, and must be deactivated (set <monospace>parallel = False</monospace> when initializing a plate) for the code to run.</p>
      </list-item>
      <list-item>
        <p><bold>Programming language</bold>: Python 3</p>
      </list-item>
      <list-item>
        <p><bold>Other requirements</bold>: Numpy 1.15+, Pandas 0.23.0+, Matplotlib 2.2.3+, SciPy 1.1.0+. <monospace>SteadyState</monospace> method additionally requires CVXPY 1.0+.</p>
      </list-item>
      <list-item>
        <p><bold>License</bold>: MIT</p>
      </list-item>
      <list-item>
        <p><bold>Any restrictions to use by non-academics</bold>: None</p>
      </list-item>
    </list>
  </sec>
</body>
<back>
  <ack>
    <p>We are grateful to Kirill Korolev, Alvaro Sanchez, and Daniel Segrè for many useful conversations, and to Matti Gralka for testing cross-platform compatibility of the package. The performance evaluation reported in <xref ref-type="fig" rid="pone.0230430.g006">Fig 6</xref> was performed on the Shared Computing Cluster which is administered by Boston University Research Computing Services.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0230430.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Thompson</surname><given-names>LR</given-names></name>, <name><surname>Sanders</surname><given-names>JG</given-names></name>, <name><surname>McDonald</surname><given-names>D</given-names></name>, <name><surname>Amir</surname><given-names>A</given-names></name>, <name><surname>Ladau</surname><given-names>J</given-names></name>, <name><surname>Locey</surname><given-names>KJ</given-names></name>, <etal>et al</etal><article-title>A communal catalogue reveals Earth’s multiscale microbial diversity</article-title>. <source>Nature</source>. <year>2017</year>;<volume>551</volume>:<fpage>457</fpage><pub-id pub-id-type="doi">10.1038/nature24621</pub-id><?supplied-pmid 29088705?><pub-id pub-id-type="pmid">29088705</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Huttenhower</surname><given-names>C</given-names></name>, <name><surname>Gevers</surname><given-names>D</given-names></name>, <name><surname>Knight</surname><given-names>R</given-names></name>, <name><surname>Abubucker</surname><given-names>S</given-names></name>, <name><surname>Badger</surname><given-names>JH</given-names></name>, <name><surname>Chinwalla</surname><given-names>AT</given-names></name>, <etal>et al</etal><article-title>Structure, function and diversity of the healthy human microbiome</article-title>. <source>Nature</source>. <year>2012</year>;<volume>486</volume>:<fpage>207</fpage><pub-id pub-id-type="doi">10.1038/nature11234</pub-id><pub-id pub-id-type="pmid">22699609</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Loreau</surname><given-names>M</given-names></name>. <article-title>Consumers as maximizers of matter and energy flow in ecosystems</article-title>. <source>The American Naturalist</source>. <year>1995</year>;<volume>145</volume>:<fpage>22</fpage><pub-id pub-id-type="doi">10.1086/285726</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Embree</surname><given-names>M</given-names></name>, <name><surname>Liu</surname><given-names>JK</given-names></name>, <name><surname>Al-Bassam</surname><given-names>MM</given-names></name>, <name><surname>Zengler</surname><given-names>K</given-names></name>. <article-title>Networks of energetic and metabolic interactions define dynamics in microbial communities</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2015</year>;<volume>112</volume>:<fpage>15450</fpage><pub-id pub-id-type="doi">10.1073/pnas.1506034112</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Gause</surname><given-names>GF</given-names></name>, <name><surname>Witt</surname><given-names>AA</given-names></name>. <article-title>Behavior of Mixed Populations and the Problem of Natural Selection</article-title>. <source>The American Naturalist</source>. <year>1935</year>;<volume>69</volume>:<fpage>596</fpage><pub-id pub-id-type="doi">10.1086/280628</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>MacArthur</surname><given-names>R</given-names></name>. <article-title>Species Packing and Competitive Equilibrium for Many Species</article-title>. <source>Theoretical Population Biology</source>. <year>1970</year>;<volume>1</volume>:<fpage>1</fpage><pub-id pub-id-type="doi">10.1016/0040-5809(70)90039-0</pub-id><?supplied-pmid 5527624?><pub-id pub-id-type="pmid">5527624</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Levin</surname><given-names>SA</given-names></name>. <article-title>Community equilibria and stability, and an extension of the competitive exclusion principle</article-title>. <source>The American Naturalist</source>. <year>1970</year>;<volume>104</volume>:<fpage>413</fpage><pub-id pub-id-type="doi">10.1086/282676</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Chesson</surname><given-names>P</given-names></name>. <article-title>MacArthur’s consumer-resource model</article-title>. <source>Theoretical Population Biology</source>. <year>1990</year>;<volume>37</volume>:<fpage>26</fpage><pub-id pub-id-type="doi">10.1016/0040-5809(90)90025-Q</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Chase</surname><given-names>JM</given-names></name>. <article-title>Community assembly: when should history matter?</article-title><source>Oecologia</source>. <year>2003</year>;<volume>136</volume>:<fpage>489</fpage><pub-id pub-id-type="doi">10.1007/s00442-003-1311-7</pub-id><?supplied-pmid 12836009?><pub-id pub-id-type="pmid">12836009</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Jeraldo</surname><given-names>P</given-names></name>, <name><surname>Sipos</surname><given-names>M</given-names></name>, <name><surname>Chia</surname><given-names>N</given-names></name>, <name><surname>Brulc</surname><given-names>JM</given-names></name>, <name><surname>Dhillon</surname><given-names>AS</given-names></name>, <name><surname>Konkel</surname><given-names>ME</given-names></name>, <etal>et al</etal><article-title>Quantification of the relative roles of niche and neutral processes in structuring gastrointestinal microbiomes</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2012</year>;<volume>109</volume>:<fpage>9692</fpage><pub-id pub-id-type="doi">10.1073/pnas.1206721109</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Kessler</surname><given-names>DA</given-names></name>, <name><surname>Shnerb</surname><given-names>NM</given-names></name>. <article-title>Generalized model of island biodiversity</article-title>. <source>Physical Review E</source>. <year>2015</year>;<volume>91</volume>:<fpage>042705</fpage><pub-id pub-id-type="doi">10.1103/PhysRevE.91.042705</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Vega</surname><given-names>NM</given-names></name>, <name><surname>Gore</surname><given-names>J</given-names></name>. <article-title>Stochastic assembly produces heterogeneous communities in the <italic>Caenorhabditis elegans</italic> intestine</article-title>. <source>PLoS Biol</source>. <year>2017</year>;<volume>15</volume>:<fpage>e2000633</fpage><pub-id pub-id-type="doi">10.1371/journal.pbio.2000633</pub-id><?supplied-pmid 28257456?><pub-id pub-id-type="pmid">28257456</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref013">
      <label>13</label>
      <mixed-citation publication-type="book"><name><surname>Tilman</surname><given-names>D</given-names></name>. <source>Resource competition and community structure</source>. <publisher-name>Princeton University Press</publisher-name>; <year>1982</year>.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Chesson</surname><given-names>P</given-names></name>. <article-title>Mechanisms of maintenance of species diversity</article-title>. <source>Annual review of Ecology and Systematics</source>. <year>2000</year>;<volume>31</volume>:<fpage>343</fpage><pub-id pub-id-type="doi">10.1146/annurev.ecolsys.31.1.343</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Fisher</surname><given-names>CK</given-names></name>, <name><surname>Mehta</surname><given-names>P</given-names></name>. <article-title>The transition between the niche and neutral regimes in ecology</article-title>. <source>PNAS</source>. <year>2014</year>;<volume>111</volume>:<fpage>13111</fpage><pub-id pub-id-type="doi">10.1073/pnas.1405637111</pub-id><?supplied-pmid 25157131?><pub-id pub-id-type="pmid">25157131</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Dickens</surname><given-names>B</given-names></name>, <name><surname>Fisher</surname><given-names>CK</given-names></name>, <name><surname>Mehta</surname><given-names>P</given-names></name>. <article-title>Analytically tractable model for community ecology with many species</article-title>. <source>Physical Review E</source>. <year>2016</year>;<volume>94</volume>:<fpage>022423</fpage><pub-id pub-id-type="doi">10.1103/PhysRevE.94.022423</pub-id><?supplied-pmid 27627348?><pub-id pub-id-type="pmid">27627348</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Bunin</surname><given-names>G</given-names></name>. <article-title>Ecological communities with Lotka-Volterra dynamics</article-title>. <source>Physical Review E</source>. <year>2017</year>;<volume>95</volume>:<fpage>042414</fpage><pub-id pub-id-type="doi">10.1103/PhysRevE.95.042414</pub-id><?supplied-pmid 28505745?><pub-id pub-id-type="pmid">28505745</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref018">
      <label>18</label>
      <mixed-citation publication-type="journal"><name><surname>Barbier</surname><given-names>M</given-names></name>, <name><surname>Arnoldi</surname><given-names>JF</given-names></name>, <name><surname>Bunin</surname><given-names>G</given-names></name>, <name><surname>Loreau</surname><given-names>M</given-names></name>. <article-title>Generic assembly patterns in complex ecological communities</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2018</year>;<volume>115</volume>:<fpage>2156</fpage><pub-id pub-id-type="doi">10.1073/pnas.1710352115</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref019">
      <label>19</label>
      <mixed-citation publication-type="journal"><name><surname>Pacheco</surname><given-names>AR</given-names></name>, <name><surname>Moel</surname><given-names>M</given-names></name>, <name><surname>Segrè</surname><given-names>D</given-names></name>. <article-title>Costless metabolic secretions as drivers of interspecies interactions in microbial ecosystems</article-title>. <source>Nature Communications</source>. <year>2019</year>;<volume>10</volume>:<fpage>103</fpage><pub-id pub-id-type="doi">10.1038/s41467-018-07946-9</pub-id><?supplied-pmid 30626871?><pub-id pub-id-type="pmid">30626871</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Goldford</surname><given-names>JE</given-names></name>, <name><surname>Lu</surname><given-names>N</given-names></name>, <name><surname>Bajić</surname><given-names>D</given-names></name>, <name><surname>Estrela</surname><given-names>S</given-names></name>, <name><surname>Tikhonov</surname><given-names>M</given-names></name>, <name><surname>Sanchez-Gorostiaga</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>Emergent Simplicity in Microbial Community Assembly</article-title>. <source>Science</source>. <year>2018</year>;<volume>361</volume>:<fpage>469</fpage><pub-id pub-id-type="doi">10.1126/science.aat1168</pub-id><?supplied-pmid 30072533?><pub-id pub-id-type="pmid">30072533</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref021">
      <label>21</label>
      <mixed-citation publication-type="other">Muscarella ME, O’Dwyer JP. Species dynamics and interactions via metabolically informed consumer-resource models. bioRxiv. 2019;518449.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref022">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Marsland</surname><given-names>R</given-names><suffix>III</suffix></name>, <name><surname>Cui</surname><given-names>W</given-names></name>, <name><surname>Goldford</surname><given-names>J</given-names></name>, <name><surname>Sanchez</surname><given-names>A</given-names></name>, <name><surname>Korolev</surname><given-names>K</given-names></name>, <name><surname>Mehta</surname><given-names>P</given-names></name>. <article-title>Available energy fluxes drive a transition in the diversity, stability, and functional structure of microbial communities</article-title>. <source>PLOS Computational Biology</source>. <year>2019</year>;<volume>15</volume>:<fpage>e1006793</fpage><pub-id pub-id-type="doi">10.1371/journal.pcbi.1006793</pub-id><pub-id pub-id-type="pmid">30721227</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Mehta</surname><given-names>P</given-names></name>, <name><surname>Cui</surname><given-names>W</given-names></name>, <name><surname>Wang</surname><given-names>CH</given-names></name>, <name><surname>Marsland</surname><given-names>R</given-names><suffix>III</suffix></name>. <article-title>Constrained optimization as ecological dynamics with applications to random quadratic programming in high dimensions</article-title>. <source>Physical Review E</source>. <year>2018</year>;<volume>99</volume>:<fpage>052111</fpage><pub-id pub-id-type="doi">10.1103/PhysRevE.99.052111</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref024">
      <label>24</label>
      <mixed-citation publication-type="other">Marsland III R, Cui W, Mehta P. The Minimum Environmental Perturbation Principle: A new perspective on niche theory. arXiv. 2019;1901.09673.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref025">
      <label>25</label>
      <mixed-citation publication-type="other">McKinney W. Data Structures for Statistical Computing in Python. In: van der Walt S, Millman J, editors. Proceedings of the 9th Python in Science Conference; 2010. p. 51—56.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref026">
      <label>26</label>
      <mixed-citation publication-type="book"><name><surname>Jones</surname><given-names>E</given-names></name>, <name><surname>Oliphant</surname><given-names>T</given-names></name>, <name><surname>Peterson</surname><given-names>P</given-names></name>, <etal>et al</etal><source>SciPy: Open source scientific tools for Python</source>; <year>2001</year>–. Available from: <ext-link ext-link-type="uri" xlink:href="http://www.scipy.org/">http://www.scipy.org/</ext-link>.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref027">
      <label>27</label>
      <mixed-citation publication-type="book"><name><surname>Hindmarsh</surname><given-names>AC</given-names></name>. <chapter-title>ODEPACK, a systematized collection of ODE solvers</chapter-title><source>Scientific computing</source>. <year>1983</year>; p. <fpage>55</fpage>–<lpage>64</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref028">
      <label>28</label>
      <mixed-citation publication-type="journal"><name><surname>Datta</surname><given-names>MS</given-names></name>, <name><surname>Korolev</surname><given-names>KS</given-names></name>, <name><surname>Cvijovic</surname><given-names>I</given-names></name>, <name><surname>Dudley</surname><given-names>C</given-names></name>, <name><surname>Gore</surname><given-names>J</given-names></name>. <article-title>Range expansion promotes cooperation in an experimental microbial metapopulation</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2013</year>;<volume>110</volume>:<fpage>7354</fpage>–<lpage>7359</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1217517110</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref029">
      <label>29</label>
      <mixed-citation publication-type="journal"><name><surname>Diamond</surname><given-names>S</given-names></name>, <name><surname>Boyd</surname><given-names>S</given-names></name>. <article-title>CVXPY: A Python-Embedded Modeling Language for Convex Optimization</article-title>. <source>Journal of Machine Learning Research</source>. <year>2016</year>;<volume>17</volume>:<fpage>1</fpage>.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Agrawal</surname><given-names>A</given-names></name>, <name><surname>Verschueren</surname><given-names>R</given-names></name>, <name><surname>Diamond</surname><given-names>S</given-names></name>, <name><surname>Boyd</surname><given-names>S</given-names></name>. <article-title>A Rewriting System for Convex Optimization Problems</article-title>. <source>Journal of Control and Decision</source>. <year>2018</year>;<volume>5</volume>:<fpage>42</fpage><pub-id pub-id-type="doi">10.1080/23307706.2017.1397554</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref031">
      <label>31</label>
      <mixed-citation publication-type="journal"><name><surname>Mehta</surname><given-names>P</given-names></name>, <name><surname>Bukov</surname><given-names>M</given-names></name>, <name><surname>Wang</surname><given-names>CH</given-names></name>, <name><surname>Day</surname><given-names>AG</given-names></name>, <name><surname>Richardson</surname><given-names>C</given-names></name>, <name><surname>Fisher</surname><given-names>CK</given-names></name>, <etal>et al</etal><article-title>A high-bias, low-variance introduction to machine learning for physicists</article-title>. <source>Physics Reports</source>. <year>2019</year>;<volume>810</volume>:<fpage>1</fpage><pub-id pub-id-type="doi">10.1016/j.physrep.2019.03.001</pub-id><?supplied-pmid 31404441?><pub-id pub-id-type="pmid">31404441</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref032">
      <label>32</label>
      <mixed-citation publication-type="other">Cui W, Marsland III R, Mehta P. Diverse communities behave like typical random ecosystems. arXiv. 2019;1904.0261.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref033">
      <label>33</label>
      <mixed-citation publication-type="journal"><name><surname>May</surname><given-names>R</given-names></name>. <article-title>Will a Large Complex System be Stable?</article-title><source>Nature</source>. <year>1972</year>;<volume>238</volume>:<fpage>413</fpage><pub-id pub-id-type="doi">10.1038/238413a0</pub-id><?supplied-pmid 4559589?><pub-id pub-id-type="pmid">4559589</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref034">
      <label>34</label>
      <mixed-citation publication-type="journal"><name><surname>Marsland</surname><given-names>R</given-names><suffix>III</suffix></name>, <name><surname>Cui</surname><given-names>W</given-names></name>, <name><surname>Mehta</surname><given-names>P</given-names></name>. <article-title>A minimal model for microbial biodiversity can reproduce experimentally observed ecological patterns</article-title>. <source>Scientific Reports</source>. <year>2020</year>;<volume>10</volume>:<fpage>3308</fpage><pub-id pub-id-type="doi">10.1038/s41598-020-60130-2</pub-id><pub-id pub-id-type="pmid">32094388</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref035">
      <label>35</label>
      <mixed-citation publication-type="journal"><name><surname>Advani</surname><given-names>M</given-names></name>, <name><surname>Bunin</surname><given-names>G</given-names></name>, <name><surname>Mehta</surname><given-names>P</given-names></name>. <article-title>Statistical physics of community ecology: a cavity solution to MacArthur’s consumer resource model</article-title>. <source>Journal of Statistical Mechanics</source>. <year>2018</year>;<fpage>033406</fpage><pub-id pub-id-type="doi">10.1088/1742-5468/aab04e</pub-id><?supplied-pmid 30636966?><pub-id pub-id-type="pmid">30636966</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0230430.ref036">
      <label>36</label>
      <mixed-citation publication-type="other">Cui W, Marsland III R, Mehta P. The effect of resource dynamics on species packing in diverse ecosystems. arXiv. 2019;191102595.</mixed-citation>
    </ref>
    <ref id="pone.0230430.ref037">
      <label>37</label>
      <mixed-citation publication-type="journal"><name><surname>Csilléry</surname><given-names>K</given-names></name>, <name><surname>Blum</surname><given-names>MG</given-names></name>, <name><surname>Gaggiotti</surname><given-names>OE</given-names></name>, <name><surname>François</surname><given-names>O</given-names></name>. <article-title>Approximate Bayesian computation (ABC) in practice</article-title>. <source>Trends in Ecology &amp; Evolution</source>. <year>2010</year>;<volume>25</volume>:<fpage>410</fpage><pub-id pub-id-type="doi">10.1016/j.tree.2010.04.001</pub-id><pub-id pub-id-type="pmid">20488578</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
