<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.0 20120330//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Res</journal-id>
    <journal-id journal-id-type="hwp">genome</journal-id>
    <journal-id journal-id-type="pmc">genome</journal-id>
    <journal-id journal-id-type="publisher-id">GENOME</journal-id>
    <journal-title-group>
      <journal-title>Genome Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1088-9051</issn>
    <issn pub-type="epub">1549-5469</issn>
    <publisher>
      <publisher-name>Cold Spring Harbor Laboratory Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7050522</article-id>
    <article-id pub-id-type="pmid">31992615</article-id>
    <article-id pub-id-type="medline">9509184</article-id>
    <article-id pub-id-type="doi">10.1101/gr.254557.119</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SHARP: hyperfast and accurate processing of single-cell RNA-seq data via ensemble random projection</article-title>
      <alt-title alt-title-type="left-running">Wan et al.</alt-title>
      <alt-title alt-title-type="right-running">SHARP: single-cell RNA-seq clustering</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-0661-2684</contrib-id>
        <name>
          <surname>Wan</surname>
          <given-names>Shibiao</given-names>
        </name>
        <xref ref-type="aff" rid="af1">1</xref>
        <xref ref-type="aff" rid="af2">2</xref>
        <xref ref-type="aff" rid="af3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kim</surname>
          <given-names>Junil</given-names>
        </name>
        <xref ref-type="aff" rid="af1">1</xref>
        <xref ref-type="aff" rid="af2">2</xref>
        <xref ref-type="aff" rid="af4">4</xref>
        <xref ref-type="aff" rid="af5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Won</surname>
          <given-names>Kyoung Jae</given-names>
        </name>
        <xref ref-type="aff" rid="af1">1</xref>
        <xref ref-type="aff" rid="af2">2</xref>
        <xref ref-type="aff" rid="af4">4</xref>
        <xref ref-type="aff" rid="af5">5</xref>
      </contrib>
    </contrib-group>
    <aff id="af1"><label>1</label>Institute for Diabetes, Obesity and Metabolism, Perelman School of Medicine, University of Pennsylvania, Philadelphia, Pennsylvania 19104, USA;</aff>
    <aff id="af2"><label>2</label>Department of Genetics, University of Pennsylvania, Philadelphia, Pennsylvania 19104, USA;</aff>
    <aff id="af3"><label>3</label>Center for Applied Bioinformatics, St. Jude Children's Research Hospital, Memphis, Tennessee 38105, USA;</aff>
    <aff id="af4"><label>4</label>Biotech Research and Innovation Centre (BRIC), University of Copenhagen, 2200 Copenhagen North, Denmark;</aff>
    <aff id="af5"><label>5</label>Novo Nordisk Foundation Center for Stem Cell Biology, DanStem, Faculty of Health and Medical Sciences, University of Copenhagen, 2200 Copenhagen North, Denmark</aff>
    <author-notes>
      <corresp>Corresponding author: <email>kyoung.won@bric.ku.dk</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>2</month>
      <year>2020</year>
    </pub-date>
    <volume>30</volume>
    <issue>2</issue>
    <fpage>205</fpage>
    <lpage>213</lpage>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>7</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>23</day>
        <month>1</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>
        <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/site/misc/terms.xhtml">© 2020 Wan et al.; Published by Cold Spring Harbor Laboratory Press</ext-link>
      </copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This article is distributed exclusively by Cold Spring Harbor Laboratory Press for the first six months after the full-issue publication date (see <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/site/misc/terms.xhtml">http://genome.cshlp.org/site/misc/terms.xhtml</ext-link>). After six months, it is available under a Creative Commons License (Attribution-NonCommercial 4.0 International), as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="205.pdf"/>
    <abstract>
      <p>To process large-scale single-cell RNA-sequencing (scRNA-seq) data effectively without excessive distortion during dimension reduction, we present SHARP, an ensemble random projection-based algorithm that is scalable to clustering 10 million cells. Comprehensive benchmarking tests on 17 public scRNA-seq data sets show that SHARP outperforms existing methods in terms of speed and accuracy. Particularly, for large-size data sets (more than 40,000 cells), SHARP runs faster than other competitors while maintaining high clustering accuracy and robustness. To the best of our knowledge, SHARP is the only R-based tool that is scalable to clustering scRNA-seq data with 10 million cells.</p>
    </abstract>
    <funding-group>
      <award-group id="funding-1">
        <funding-source>
          <institution-wrap>
            <institution>National Institutes of Health </institution>
            <institution-id institution-id-type="open-funder-registry">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group id="funding-2">
        <funding-source>
          <institution-wrap>
            <institution>National Institute of Diabetes and Digestive and Kidney Diseases </institution>
            <institution-id institution-id-type="open-funder-registry">10.13039/100000062</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>R01 DK106027</award-id>
      </award-group>
      <award-group id="funding-3">
        <funding-source>
          <institution-wrap>
            <institution>Novo Nordisk Foundation </institution>
            <institution-id institution-id-type="open-funder-registry">10.13039/501100009708</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>NNF17CC0027852</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>By enabling transcriptomic profiling at the individual-cell level, scRNA-seq has been widely applied in various domains of biology and medicine to characterize novel cell types and detect intra-population heterogeneity (<xref rid="GR254557WANC33" ref-type="bibr">Potter 2018</xref>). The amount of scRNA-seq data in the public domain has increased owing to technological development and the efforts to obtain large-scale transcriptomic profiling of cells (<xref rid="GR254557WANC14" ref-type="bibr">Han et al. 2018</xref>). Computational algorithms to process and analyze large-scale high-dimensional single-cell data are essential. To cluster high-dimensional scRNA-seq data, dimension-reduction algorithms such as principal component analysis (PCA) (<xref rid="GR254557WANC22" ref-type="bibr">Joliffe and Morgan 1992</xref>) or independent component analysis (ICA) (<xref rid="GR254557WANC19" ref-type="bibr">Hyvärinen and Oja 2000</xref>) have been successfully applied to process and to visualize high-dimensional scRNA-seq data. However, it requires considerable time to obtain principal or independent components as the number of cells increases. Dimension reduction decreases processing time at the cost of losing original cell-to-cell distances. For instance, t-distributed stochastic neighbor embedding (t-SNE) (<xref rid="GR254557WANC38" ref-type="bibr">van der Maaten 2014</xref>) effectively visualizes multidimensional data into a reduced-dimensional space. However, t-SNE distorts the distance between cells for its visualization. Besides, t-SNE requires considerable time for large-scale scRNA-seq data visualization and clustering.</p>
  <p>Random projection (RP) (<xref rid="GR254557WANC5" ref-type="bibr">Bingham and Mannila 2001</xref>) has been suggested as a powerful dimension-reduction method. Based on the Johnson–Lindenstrauss lemma (<xref rid="GR254557WANC21" ref-type="bibr">Johnson and Lindenstrauss 1984</xref>), RP reduces the dimension while the distances between the points are approximately preserved (<xref rid="GR254557WANC10" ref-type="bibr">Frankl and Maehara 1988</xref>). Theoretically, RP is very fast because it does not require calculation of pairwise cell-to-cell distances or principle components.</p>
  <p>To effectively handle very large-scale scRNA-seq data without excessive distortion of cell-to-cell distances, we developed SHARP (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Code</ext-link>), a hyperfast clustering algorithm based on ensemble RP (Methods) (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>A). RP (<xref rid="GR254557WANC5" ref-type="bibr">Bingham and Mannila 2001</xref>) projects the original <italic>D</italic>-dimensional data into a <italic>d</italic>-dimensional subspace, using a <italic>d</italic> × <italic>D</italic>-dimensional random matrix, <bold>R,</bold> whose elements conform to a distribution with zero mean and unit variance. RP preserves cell-to-cell distances even in a much lower dimensional space and is robust to missing values, which provides a well-suited condition for clustering high-dimensional scRNA-seq data. SHARP reduced the running cost for clustering, whereas clustering performance is robust especially for large-size scRNA-seq data sets. SHARP requires the time complexity of only <inline-formula><mml:math id="il1"><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> for scRNA-seq data with <italic>N</italic> cells and <italic>D</italic> genes. Compared with it, a simple hierarchical clustering algorithm requires <italic>O</italic>(<italic>N</italic><sup>2</sup><italic>D</italic>) (<xref rid="GR254557WANC31" ref-type="bibr">Murtagh and Legendre 2014</xref>) to calculate the distance between cells. t-SNE combined with the <italic>k</italic>-means algorithm requires <italic>O</italic>(<italic>DN</italic> log(<italic>N</italic>)) (<xref rid="GR254557WANC38" ref-type="bibr">van der Maaten 2014</xref>), and a simple PCA requires <italic>O</italic>(<italic>ND</italic> · min(<italic>N</italic>, <italic>D</italic>)) for data reduction (<xref rid="GR254557WANC5" ref-type="bibr">Bingham and Mannila 2001</xref>).</p>
  <fig id="GR254557WANF1" orientation="portrait" position="float">
    <label>Figure 1.</label>
    <caption>
      <p>The framework of SHARP. (<italic>A</italic>) SHARP has four steps for clustering: divide-and-conquer, random projection (RP), weighted-based metaclustering, and similarity-based metaclustering. (<italic>B</italic>,<italic>C</italic>) Running time (<italic>B</italic>) and clustering performance (<italic>C</italic>) based on ARI (<xref rid="GR254557WANC17" ref-type="bibr">Hubert and Arabie 1985</xref>) of SHARP in 20 single-cell RNA-seq data sets with numbers of single cells ranging from 124 to 10 million (where data sets with 2 million, 5 million, and 10 million cells were generated by randomly oversampling the data set with 1.3 million single cells). For the data sets with more than 1 million cells, only SHARP can run, and only the running time was provided owing to lack of the ground-truth clustering labels. All of the results for SHARP were based on 100 runs of SHARP on each data set. All the tests except for the larger-than-1-million-cell data sets were performed using a single core on an Intel Xeon CPU E5-2699 v4 @ 2.20-GHz system with 500-GB memory. To run data sets with more than 1 million cells, we used 16 cores on the same system. CIDR and PhenoGraph were unable to produce clustering results for those data sets with number of cells larger than 40,000 (i.e., Park, Macosko, and Montoro_large).</p>
    </caption>
    <graphic xlink:href="205f01"/>
  </fig>
  <p>There have been previous ensemble-based approaches for RP (<xref rid="GR254557WANC9" ref-type="bibr">Fern and Brodley 2003</xref>; <xref rid="GR254557WANC4" ref-type="bibr">Bertoni and Valentini 2006</xref>). Compared with them, we developed a strategy specifically for handling scRNA-seq data by using (1) a divide-and-conquer approach for very large-scale scRNA-seq data clustering, (2) a two-layer metaclustering approach for robust clustering, and (3) a very sparse RP embedded into ensemble clustering for hyperfast clustering.</p>
  <p>In this study, we aim to present SHARP, an R-based (<xref rid="GR254557WANC34" ref-type="bibr">R Core Team 2016</xref>) ensemble RP-based algorithm that can be scalable to 10 million cells while maintaining clustering performance. We perform comprehensive benchmarking to assess the performance of SHARP and further investigate the characteristics that contribute to its performance.</p>
  <sec sec-type="results" id="s1">
    <title>Results</title>
    <sec id="s1a">
      <title>SHARP uses RP for ultrafast scRNA-seq clustering</title>
      <p>SHARP uses a divide-and-conquer strategy followed by RP to accommodate effective processing of large-scale scRNA-seq data (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>A and Methods). SHARP processes scRNA-seq data in four interconnected steps: (1) data partition, (2) RP based clustering, (3) weighted ensemble clustering, and (4) similarity-based metaclustering (sMetaC). During data partition, the scRNA-seq data are divided into small blocks (random size). It is noted that currently R lacks 64-bit integers support, and a scRNA-seq data matrix with more than 1 million cells (so that the number of elements is usually significantly larger than 2<sup>31</sup> − 1) cannot be directly loaded into R. The divide-and-conquer strategy enables SHARP to upload and process more than 1 million cells. The divided data blocks are further processed by RP followed by a hierarchical clustering algorithm. Because the performance of an individual RP-based clustering is volatile, the ensemble of several runs of RPs is used. A weighted-ensemble clustering (i.e., wMetaC) algorithm merges individual RP-based clustering results. Finally, a similarity-based ensemble clustering (i.e., sMetaC) approach is to integrate clustering results of each block (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>A and Methods).</p>
    </sec>
    <sec id="s1b">
      <title>SHARP is faster than other predictors and is scalable to 1.3 million cells and even up to 10 million cells</title>
      <p>We performed comprehensive benchmarking of SHARP against existing scRNA-seq clustering algorithms, including SC3 (<xref rid="GR254557WANC23" ref-type="bibr">Kiselev et al. 2017</xref>), SIMLR (<xref rid="GR254557WANC40" ref-type="bibr">Wang et al. 2017</xref>), hierarchical clustering and t-SNE combined with <italic>k</italic>-means, UMAP (<xref rid="GR254557WANC3" ref-type="bibr">Becht et al. 2019</xref>) with <italic>k</italic>-means, Seurat (<xref rid="GR254557WANC6" ref-type="bibr">Butler et al. 2018</xref>), CIDR (<xref rid="GR254557WANC28" ref-type="bibr">Lin et al. 2017</xref>), and PhenoGraph (<xref rid="GR254557WANC26" ref-type="bibr">Levine et al. 2015</xref>) (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B,C; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>) using 17 publicly available scRNA-seq data sets whose cell numbers range from 124 to 1.3 million cells (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Table S1</ext-link>; <xref rid="GR254557WANC7" ref-type="bibr">Darmanis et al. 2015</xref>; <xref rid="GR254557WANC24" ref-type="bibr">Klein et al. 2015</xref>; <xref rid="GR254557WANC25" ref-type="bibr">Kolodziejczyk et al. 2015</xref>; <xref rid="GR254557WANC29" ref-type="bibr">Macosko et al. 2015</xref>; <xref rid="GR254557WANC2" ref-type="bibr">Baron et al. 2016</xref>; <xref rid="GR254557WANC11" ref-type="bibr">Goolam et al. 2016</xref>; <xref rid="GR254557WANC39" ref-type="bibr">Wang et al. 2016</xref>; <xref rid="GR254557WANC1" ref-type="bibr">10x Genomics 2017</xref>; <xref rid="GR254557WANC8" ref-type="bibr">Enge et al. 2017</xref>; <xref rid="GR254557WANC30" ref-type="bibr">Montoro et al. 2018</xref>; <xref rid="GR254557WANC32" ref-type="bibr">Park et al. 2018</xref>).</p>
      <p>The benchmarking tests showed cost reduction by SHARP (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B). Reflecting the theoretical running costs, the two classical algorithms (t-SNE + <italic>k</italic>-means, hierarchical clustering) manifested exponential increase in their processing time as the number of cells increased (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B). SC3 (<xref rid="GR254557WANC23" ref-type="bibr">Kiselev et al. 2017</xref>) and SIMLR (<xref rid="GR254557WANC40" ref-type="bibr">Wang et al. 2017</xref>) showed better performance than the classical clustering approaches, but they still required a considerable amount of time for clustering. The computing cost of SHARP was substantially lower than other clustering algorithms. The required computing cost of SHARP rose roughly linearly even with the very large size of the data sets. For data sets with more than 40,000 single cells, SHARP ran at least 20 times faster than SC3 (<xref rid="GR254557WANC23" ref-type="bibr">Kiselev et al. 2017</xref>) and SIMLR (<xref rid="GR254557WANC40" ref-type="bibr">Wang et al. 2017</xref>). Although CIDR and PhenoGraph were reported to perform very fast and robustly (<xref rid="GR254557WANC26" ref-type="bibr">Levine et al. 2015</xref>; <xref rid="GR254557WANC28" ref-type="bibr">Lin et al. 2017</xref>), they were unable to produce clustering results for those data sets with more than 40,000 single cells, such as the Park (<xref rid="GR254557WANC32" ref-type="bibr">Park et al. 2018</xref>), Macosko (<xref rid="GR254557WANC29" ref-type="bibr">Macosko et al. 2015</xref>), and Montoro_large (<xref rid="GR254557WANC30" ref-type="bibr">Montoro et al. 2018</xref>) data sets (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B).</p>
      <p>SHARP clustered the scRNA-seq with 1.3 million cells in 42 min when using a multicore system (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B). Because of the data loading problem (and potential exhaustive memory use), we could not show the running time of other approaches for 1.3 million cells. When using a multicore system (16 cores) on the Montoro_large data set (<xref rid="GR254557WANC30" ref-type="bibr">Montoro et al. 2018</xref>) with 66,265 cells, SHARP ran more than 40 times faster than SC3 and SIMLR (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S1</ext-link>; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>). The running time of SHARP for 1.3 million cells was two times (42 min vs. 96 min) faster than that of Seurat for 66,255 cells. We expect superior performance of SHARP against its competitors when data loading is feasible.</p>
      <p>To evaluate the performance of SHARP and show its scalability, we performed random oversampling of the mouse brain data set consisting of 1.3 million cells (<xref rid="GR254557WANC1" ref-type="bibr">10x Genomics 2017</xref>) so that we were able to construct even larger scRNA-seq data sets. For this simulation, we tested up to 10 million cells. The running time of SHARP was simply linearly increased with the increasing of cell numbers from 1 million to 10 million. In our system and using 16 cores, SHARP needed ∼8 h (i.e., 482.8 min) to cluster 10 million cells into 1175 clusters (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B).</p>
    </sec>
    <sec id="s1c">
      <title>The clustering performance of SHARP is not highly affected by the number of cells</title>
      <p>In parallel, we compared the clustering performance using the predefined cell types for each data set (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Table S1</ext-link>). To evaluate clustering performance, we used the adjusted Rand index (ARI) (<xref rid="GR254557WANC17" ref-type="bibr">Hubert and Arabie 1985</xref>). ARI (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>) is a similarity metric to measure how accurately a prediction of clustering is made in the unsupervised learning scenarios, which is similar to the accuracy measurement in supervised classification problems. Generally, the larger ARI, the better the predicted clustering is, with +1 indicating that the predicted clustering is perfectly consistent with the reference, whereas 0 (or negative value) indicates that the predicted clustering is as good as (or worse than) a random guess.</p>
      <p>For almost all data sets we tested, SHARP showed better performance (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>C). The performance of other algorithms became generally worse for large data sets (more than 40,000 single cells). In contrast, SHARP showed an ARI larger than 0.7 regardless of the size of the data sets, showing its robustness. The ARI of Seurat was poor, in general, even for the small-sized data sets. Seurat showed relatively faster speed (despite worse clustering performance) even with its implementation of t-SNE compared with other existing methods except SHARP. This is because Seurat only uses genes with high variation in their expression, which could affect the clustering performance (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>C).</p>
      <p>For robust assessment of the clustered results, we also used artificial data sets by mixing cells with known cell types obtained from the Tabula Muris Consortium (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S2</ext-link>; <xref rid="GR254557WANC37" ref-type="bibr">The Tabula Muris Consortium 2018</xref>). SHARP again outperformed other methods in terms of both clustering performance (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S3</ext-link>) and running time (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Table S2</ext-link>).</p>
    </sec>
    <sec id="s1d">
      <title>SHARP preserves cell-to-cell distance</title>
      <p>To explain the robust clustering performance of SHARP, we investigated the degree of distortion caused by dimension reduction and compared the correlation of cell-to-cell distances after reducing dimension using SHARP, PCA, and t-SNE, respectively. For this, we calculated the pairwise Pearson correlation between each pair of cells for the original scRNA-seq data and the dimension-reduced data. Reflecting the property of RP, SHARP showed almost perfect similarities in cell-to-cell distance with a correlation coefficient &gt;0.94 even in a dimensional space that is 74 times lower (from 20,862 to 279) than the original one (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>A; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S4</ext-link>; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>). Cell-to-cell distances were distorted when dimension reduction was performed to the same number of dimensions using PCA (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>A). t-SNE, an algorithm to visualize high-dimensional data into two- or three-dimensional space, showed a lower correlation as expected (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>A).</p>
      <fig id="GR254557WANF2" orientation="portrait" position="float">
        <label>Figure 2.</label>
        <caption>
          <p>The properties of SHARP. (<italic>A</italic>) Cell-to-cell distance preservation in SHARP space compared with that in t-SNE and PCA for the Enge data set (<xref rid="GR254557WANC8" ref-type="bibr">Enge et al. 2017</xref>). The <italic>lower</italic> triangular part shows the scatter plots of the cell-to-cell distances, whereas the <italic>upper</italic> triangular part shows the Pearson's correlation coefficient (PCC) of the corresponding two spaces. (<italic>B</italic>) SHARP is robust to the additional dropout events on the Montoro_small (<xref rid="GR254557WANC30" ref-type="bibr">Montoro et al. 2018</xref>) data set. (<italic>C</italic>) Comparing RP (SHARP uses RP) with random gene selection (RS) in 16 single-cell RNA-seq data sets (<xref rid="GR254557WANC7" ref-type="bibr">Darmanis et al. 2015</xref>; <xref rid="GR254557WANC24" ref-type="bibr">Klein et al. 2015</xref>; <xref rid="GR254557WANC25" ref-type="bibr">Kolodziejczyk et al. 2015</xref>; <xref rid="GR254557WANC29" ref-type="bibr">Macosko et al. 2015</xref>; <xref rid="GR254557WANC2" ref-type="bibr">Baron et al. 2016</xref>; <xref rid="GR254557WANC11" ref-type="bibr">Goolam et al. 2016</xref>; <xref rid="GR254557WANC39" ref-type="bibr">Wang et al. 2016</xref>; <xref rid="GR254557WANC8" ref-type="bibr">Enge et al. 2017</xref>; <xref rid="GR254557WANC30" ref-type="bibr">Montoro et al. 2018</xref>; <xref rid="GR254557WANC32" ref-type="bibr">Park et al. 2018</xref>) with the number of single cells ranging from 124 to 66,265. (<italic>D</italic>) Visualization capabilities of SHARP in the Darmanis (<xref rid="GR254557WANC7" ref-type="bibr">Darmanis et al. 2015</xref>), Kolod (<xref rid="GR254557WANC25" ref-type="bibr">Kolodziejczyk et al. 2015</xref>), Enge (<xref rid="GR254557WANC8" ref-type="bibr">Enge et al. 2017</xref>), and Baron_h2 (<xref rid="GR254557WANC2" ref-type="bibr">Baron et al. 2016</xref>) data sets. (<italic>E</italic>) Cluster-specific marker gene expression of the top four major clusters for 1.3 million single cells (<xref rid="GR254557WANC1" ref-type="bibr">10x Genomics 2017</xref>) by SHARP. The total number of clusters predicted by SHARP is 244. The number in brackets represents the number of single cells in the corresponding cluster.</p>
        </caption>
        <graphic xlink:href="205f02"/>
      </fig>
    </sec>
    <sec id="s1e">
      <title>SHARP is robust to dropouts</title>
      <p>scRNA-seq suffers a high frequency of dropouts where many of the true expressions are not captured. To evaluate the robustness of SHARP against dropouts, we tested SHARP while increasing dropout rates in the Montoro_small (<xref rid="GR254557WANC30" ref-type="bibr">Montoro et al. 2018</xref>) data set (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>B). We also applied additional random dropouts. For instance, originally the Montoro_small data set has the dropout rate of 79.6% for the top 8000 genes in terms of nonzero gene expression. Based on the original high dropout rate, additional artificial dropouts were imposed, which provide more difficult conditions for clustering. Our test results showed that additional 20% of dropout was enough to evaluate the robustness of the clustering algorithms.</p>
      <p>We found that both SHARP and SC3 were robust to the added dropouts (Methods), whereas we observed poorer performance of other methods for the added dropouts in general (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>B). The performance of SIMLR, even though it was better than SC3 when there were no added dropouts, became worse when the added dropout rates were increased &gt; 5%.</p>
    </sec>
    <sec id="s1f">
      <title>Cell-to-cell distance is important for clustering results</title>
      <p>To evaluate the contribution of RP for clustering, we performed clustering after replaying RP with random selection (RS) of genes while other procedures are unchanged. This violates the condition for RP (a matrix with zero mean and unit variance), and therefore, rough preservation of cell-to-cell distance is no longer guaranteed. RS of genes severely undermined the performance (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>C), suggesting that RP is a major component contributing to the performance of SHARP.</p>
      <p>Furthermore, to show the effectiveness of wMetaC, we compared wMetaC with the method of averaging gene expression after multiple runs of RP (“RP_avg”) while other configurations were unchanged. We observed that wMetaC performs better than simply averaging the expression profiles after RP across all data sets (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S5</ext-link>). The superiority of SHARP was more evident for those large-size scRNA-seq data sets when the number of cells is larger than 40,000 (e.g., Park, Macosko, and Montoro_large).</p>
    </sec>
    <sec id="s1g">
      <title>SHARP is equipped with visualization</title>
      <p>SHARP is equipped with t-SNE (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>D; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S6</ext-link>) and heatmaps (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S7</ext-link>) to visualize its clustering results (Methods). For instance, the heat map for the Enge data set (<xref rid="GR254557WANC8" ref-type="bibr">Enge et al. 2017</xref>) clearly showed the cell types in pancreas, including <italic>α</italic> (GCG), <italic>β</italic> (INS), acinar (PRSS1), and <italic>δ</italic> (SST) cells (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S7</ext-link>).</p>
    </sec>
    <sec id="s1h">
      <title>Clustering 1.3-million-cell data using SHARP</title>
      <p>Of note, SHARP provides an opportunity to study the million-cell-level data set. Previous analysis on the scRNA-seq data with 1,306,127 cells from embryonic mouse brains (<xref rid="GR254557WANC1" ref-type="bibr">10x Genomics 2017</xref>) was performed using <italic>k</italic>-means and graph clustering (equivalent to kernel <italic>k</italic>-means) algorithms (<xref rid="GR254557WANC1" ref-type="bibr">10x Genomics 2017</xref>). However, <italic>k</italic>-means cannot identify the optimal number of clusters, and it depends on the initial seeds for clustering. By using SHARP, we identified a total of 244 clusters from this data set (17 clusters with more than 1000 cells) (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Table S3</ext-link>). The top four clusters among them were found to have clear different expression patterns (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>E). Gene Ontology (GO) analysis (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Table S3</ext-link>) shows that cluster 2 is associated with dendrites and cluster 3 is associated with axons. We also identified a cluster (cluster 8) enriched for the genes associated with “nonmotile cilium assembly”, which is important for brain development and function (<xref rid="GR254557WANC12" ref-type="bibr">Guemez-Gamboa et al. 2014</xref>), and immune cells with high IL4 expression (cluster 14).</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s2">
    <title>Discussion</title>
    <p>In this study, we showed that SHARP preserves the cell-to-cell distance during dimension reduction and performs clustering much faster than other competing methods while the clustering performance is robust. We also showed that SHARP is robust to dropouts. By benchmarking various clustering algorithms, we found that SHARP is the only R-based (<xref rid="GR254557WANC34" ref-type="bibr">R Core Team 2016</xref>) algorithm to perform clustering of 1.3 million cells (<xref rid="GR254557WANC1" ref-type="bibr">10x Genomics 2017</xref>) and to handle clustering up to 10 million cells.</p>
    <p>The size of scRNA-seq data sets has been increasing exponentially in recent years. Besides the 1.3-million brain-cell data set we used, we expect larger-sized data sets to be generated. We found the majority of the computational algorithms cannot efficiently handle very large size data sets (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B). Furthermore, the clustering performance became worse as the number of cells increased (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>C). Thus, there is an urgent need for a computational approach to handle large data sets efficiently.</p>
    <p>To address these problems, we developed SHARP based on RP, which, to the best of our knowledge, has not been introduced for scRNA-seq data analysis. RP preserves the distance of the data points, even in a lower dimension. Reflecting this, the cell-to-cell distance was well preserved after running SHARP (<xref ref-type="fig" rid="GR254557WANF2">Fig. 2</xref>A). The performance comparison showed that SHARP outperforms other state-of-the-art methods in terms of computation cost and clustering performance (<xref ref-type="fig" rid="GR254557WANF1">Fig. 1</xref>B,C).</p>
    <p>To further show the scalability of SHARP, we have extended our comparison against some scalable scRNA-seq analysis methods, including bigSCale (<xref rid="GR254557WANC20" ref-type="bibr">Iacono et al. 2018</xref>), geometric sketching (GeoSketch) (<xref rid="GR254557WANC16" ref-type="bibr">Hie et al. 2019b</xref>), and Scanorama (<xref rid="GR254557WANC15" ref-type="bibr">Hie et al. 2019a</xref>). As they were designed for different purposes, we only evaluated their scalability by running them with scRNA-seq data sets with different cell sizes and measured the running costs. Results (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S8</ext-link>) suggested that the computing time for bigSCale and Scanorama increased exponentially, whereas SHARP and GeoSketch exerted more powerful scalability. For data sets with cell numbers larger than 200,000, bigSCale and Scanorama did not work. These results show that SHARP's scalability is comparable with other state-of-the-art algorithms.</p>
    <p>SHARP is composed of many indispensable components. To evaluate the contribution of RP, we replaced RP with RS, so that the Johnson–Lindenstrauss lemma (<xref rid="GR254557WANC21" ref-type="bibr">Johnson and Lindenstrauss 1984</xref>) is no longer valid. We observed that the performance became much worse by RS, suggesting that the theoretical background by RP is a major contributor toward the performance of SHARP. Also, SHARP uses an ensemble clustering method to combine the results of several runs of RP. We found that the ensemble strategy provides robust performance in clustering (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S9</ext-link>; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>). SHARP was robust to the ensemble size when the size is larger than five (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S10, S11</ext-link>; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>). Moreover, SHARP's performance was not highly affected by the size of the block when the size was larger than 1000 cells (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S12</ext-link>; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>). SHARP is also roughly insensitive to the degree of dimension reduction (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S13</ext-link>; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>).</p>
    <p>It should be noted that the superior performance of SHARP is not owing to a single run of RP outperforming traditional dimension-reduction methods, such as PCA. On the contrary, the performance of a single run of RP is volatile (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S9</ext-link>). Instead, the superior performance of SHARP is because of the following reasons: (1) Multiple runs of RP generated diversity, and then they were combined with the weighted-ensemble clustering approach for robust clustering, and (2) RP's dimension reduction with the property of preserving cell-to-cell distance in the lower-dimensional space. Besides, our metaclustering strategies were able to effectively handle tiny clusters generated during the data partition stage (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S14</ext-link>; <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>).</p>
    <p>We noticed that some studies reported better clustering results for the same data sets (e.g., Darmanis and Baron data sets) when comparing some of the same clustering algorithms (<xref rid="GR254557WANC18" ref-type="bibr">Huh et al. 2019</xref>; <xref rid="GR254557WANC42" ref-type="bibr">Yang et al. 2019</xref>). This is because in these studies several preprocessing steps have been manually calibrated by using additional methods to polish different parameters for each of the state-of-the-art methods. For example, SAFE-clustering (<xref rid="GR254557WANC42" ref-type="bibr">Yang et al. 2019</xref>) used a stratified random sampling strategy to determine the best parameter, like the resolution for Seurat for the Darmanis data set. Similarly, SAME-clustering (<xref rid="GR254557WANC18" ref-type="bibr">Huh et al. 2019</xref>) reduced the dimension for Seurat according to the number of principal coordinates determined by CIDR (<xref rid="GR254557WANC28" ref-type="bibr">Lin et al. 2017</xref>). Further, both studies added an intermediate step for t-SNE + <italic>k</italic>-means to detect the cluster number and the cluster centroids to mitigate fluctuations of t-SNE plus <italic>k</italic>-means. For a fair comparison, we used the same criteria (i.e., let the methods themselves automatically determine their hyperparameters) for all of the methods, including SHARP, to test all of the data sets without parameter tuning.</p>
    <p>To assess the robustness of SHARP, we performed various tests: (1) We ran SHARP 100 times and reported the mean ± standard deviation of ARI and computational time for almost all scRNA-seq data sets used here; (2) we tested SHARP on a variety of scRNA-seq data sets with different numbers of cells ranging from several hundred to 10 million; and (3) we used SHARP to process scRNA-seq with various additional dropout rates. In these series of tests, SHARP showed robustness across different cases.</p>
    <p>Randomness has been widely used in multiple different domains, like scalable dimensionality reduction and matrix decomposition approximation (<xref rid="GR254557WANC13" ref-type="bibr">Halko et al. 2011</xref>). The randomized method like the Gaussian random matrix, which also belongs to one kind of RPs, was used for low-rank matrix decomposition approximation (<xref rid="GR254557WANC13" ref-type="bibr">Halko et al. 2011</xref>), whereas we used RP for dimension reduction and clustering in large-scale scRNA-seq data. Further, the random matrix that we used for SHARP was highly sparse, whereas the one used by <xref rid="GR254557WANC13" ref-type="bibr">Halko et al. (2011)</xref> was not.</p>
    <p>Clustering involves extensive use of computational resources in calculating distances and/or dimension reduction. We showed that SHARP is scalable to processing even 10 million cells. Currently, SHARP is not designed to detect rare cell populations, which could be a future application of RP. Besides clustering, the property of RP to preserve cell-to-cell distance in the reduced dimension will be useful for other applications for scRNA-seq data.</p>
  </sec>
  <sec sec-type="methods" id="s3">
    <title>Methods</title>
    <sec id="s3a">
      <title>The framework of SHARP</title>
      <p>SHARP accepts gene expression data arranged in a matrix, <inline-formula><mml:math id="il2"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula>, where each of the <italic>D</italic> rows corresponds to a gene (or transcript), and each of the <italic>N</italic> columns corresponds to a single cell. The type of input data can be either fragments/reads per kilo base per million mapped reads (FPKM/RPKM), counts per million mapped reads (CPM), transcripts per million (TPM), or unique molecule identifiers (UMI). For consistency, FPKM/RPKM values are converted into TPM values, and UMI values are converted into CPM values.</p>
    </sec>
    <sec id="s3b">
      <title>Data partition</title>
      <p>For a large-scale data set, SHARP performs data partition using a divide-and-conquer strategy. SHARP divides scRNA-seq data <inline-formula><mml:math id="il3"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> into <italic>B</italic> blocks, where each block may contain different numbers of cells (i.e., <italic>N</italic><sub>1</sub>, …, <italic>N</italic><sub><italic>B</italic></sub>, where <inline-formula><mml:math id="il4"><mml:msubsup><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula>). To avoid bias during data partition, we randomly permuted the original single-cell data before partitioning. In practice, SHARP roughly equally divides <bold>M</bold> and allows users to assign the base number of single cells in each block (e.g., <italic>n</italic>). In this case, <inline-formula><mml:math id="il5"><mml:mi>B</mml:mi><mml:mo>=</mml:mo><mml:mo fence="false">⌈</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mo fence="false">⌉</mml:mo></mml:math></inline-formula>, where <inline-formula><mml:math id="il6"><mml:mo fence="false">⌈</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo fence="false">⌉</mml:mo></mml:math></inline-formula> is the minimum integer no less than <italic>x</italic>. The numbers of single cells <inline-formula><mml:math id="il7"><mml:msubsup><mml:mrow><mml:mo fence="false">{</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo fence="false">}</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:msubsup></mml:math></inline-formula> in each block are as follows:
<list list-type="order"><list-item><p>If <italic>B</italic> = 1, <italic>N</italic><sub><italic>b</italic></sub> = <italic>N</italic>, where <italic>b</italic> = <italic>B</italic> = 1;</p></list-item><list-item><p>If <italic>B</italic> = 2, <inline-formula><mml:math id="il8"><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌊</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:mrow><mml:mfrac><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:mfrac></mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌋</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">where</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo fence="false">}</mml:mo></mml:mstyle></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌈</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:mrow><mml:mfrac><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:mfrac></mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌉</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">where</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mi>B</mml:mi><mml:mo fence="false">}</mml:mo><mml:mspace width="0.4em"/><mml:mspace width="0.4em"/><mml:mspace width="0.4em"/><mml:mspace width="0.4em"/><mml:mspace width="0.4em"/><mml:mspace width="0.4em"/><mml:mspace width="0.4em"/><mml:mspace width="0.4em"/></mml:mstyle></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow><mml:mo>;</mml:mo></mml:math></inline-formula></p></list-item><list-item><p>If <italic>B</italic> ≥ 3, <inline-formula><mml:math id="il9"><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo></mml:mrow><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:mi mathvariant="normal">where</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌊</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌋</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:mrow><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:mi mathvariant="normal">where</mml:mi><mml:mspace width="0.4em"/></mml:mrow><mml:mspace width="0.4em"/><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌈</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">⌉</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:mrow><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:mi mathvariant="normal">where</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>B</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:math></inline-formula></p></list-item></list></p>
      <p>This enables SHARP to maximize the usage of local computational resources and avoid memory overflow while minimizing the negative impact from imbalanced numbers of data for each block.</p>
    </sec>
    <sec id="s3c">
      <title>Random projection</title>
      <p>RP is a group of simple yet powerful dimension-reduction techniques. It is based on the Johnson–Lindenstrauss lemma (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>; <xref rid="GR254557WANC21" ref-type="bibr">Johnson and Lindenstrauss 1984</xref>). Specifically, the original <italic>D</italic>-dimensional data are projected onto a <italic>d</italic>-dimensional subspace, using a random matrix whose column are unit length; namely,
<disp-formula id="GR254557WANUM1"><mml:math id="UM1"><mml:mrow><mml:mi mathvariant="bold">P</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mstyle><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msqrt><mml:mi>d</mml:mi></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mi mathvariant="bold">R</mml:mi><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mo>×</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula></p>
      <p>As long as the elements of <bold>R</bold> conform to any distributions with zero mean and unit variance, <bold>R</bold> gives a mapping that satisfies the Johnson–Lindenstrauss lemma.</p>
    </sec>
    <sec id="s3d">
      <title>Choice of random matrix R</title>
      <p>To reduce the computational complexity, we adopted a very sparse RP proposed by <xref rid="GR254557WANC27" ref-type="bibr">Li et al. (2006)</xref>, where the elements of <bold>R</bold> (i.e., <italic>r</italic><sub><italic>i</italic>,<italic>j</italic></sub>) are defined as
<disp-formula id="GR254557WANUM2"><mml:math id="UM2"><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mi>s</mml:mi></mml:msqrt><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:mi mathvariant="normal">with</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">probability</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mstyle><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>s</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.4em"/></mml:mstyle></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:mi mathvariant="normal">with</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">probability</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>s</mml:mi></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:mi mathvariant="normal">with</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">probability</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mstyle><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>s</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.4em"/></mml:mstyle></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">where</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo fence="false">}</mml:mo><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mo fence="false">{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo fence="false">}</mml:mo><mml:mo>.</mml:mo></mml:math></disp-formula>
</p>
      <p>As suggested by <xref rid="GR254557WANC27" ref-type="bibr">Li et al. (2006)</xref>, we selected <inline-formula><mml:math id="il10"><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt></mml:math></inline-formula>.</p>
    </sec>
    <sec id="s3e">
      <title>Choice of the subspace dimension <italic>d</italic></title>
      <p>To balance between maintaining robust performance and yielding a solution as parsimonious as possible, we selected <italic>d</italic> = log<sub>2</sub>(<italic>N</italic>)/<italic>ε</italic><sup>2</sup>, where <italic>ε</italic> ∈ (0, 1] as suggested by the Johnson–Lindenstrauss lemma.</p>
    </sec>
    <sec id="s3f">
      <title>Ensemble RP</title>
      <p>After RP, pairwise Pearson correlation coefficients between each pair of single cells were calculated using the dimension-reduced feature matrix. An agglomerative hierarchical clustering (hclust) with the “ward.D” (<xref rid="GR254557WANC41" ref-type="bibr">Ward 1963</xref>) method was used to cluster the correlation-based distance matrix. We first applied RP <italic>K</italic> times to obtain <italic>K</italic> RP-based dimension-reduced feature matrices and then further <italic>K</italic> distance matrices. Each of the K matrices was clustered by a “ward.D”-based hclust. As a result, <italic>K</italic> different clustering results were obtained, each from a RP-based distance matrix, that would be combined by a weighted-based metaclustering (wMetaC) algorithm (<xref rid="GR254557WANC35" ref-type="bibr">Ren et al. 2017</xref>) detailed in the next step.</p>
    </sec>
    <sec id="s3g">
      <title>wMetaC</title>
      <p>Compared with the traditional cluster-based similarity partitioning algorithm (CSPA) (<xref rid="GR254557WANC36" ref-type="bibr">Strehl and Ghosh 2002</xref>) that treats each instance and each cluster equally important, wMetaC assigns different weights to different instances (or instance pairs) and different clusters to improve the clustering performance. wMetaC includes four steps: (1) calculating cell weights, (2) calculating weighted cluster-to-cluster pairwise similarity, (3) clustering on a weighted cluster-based similarity matrix, and (4) determining final results by a voting scheme. Note that wMetaC was applied to each block of single cells. The flowchart of the wMetaC ensemble clustering method is shown in <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Figure S15</ext-link>.</p>
      <p>Specifically, for calculating cell weights, similar to the first several steps in CSPA, we first converted the individual RP-based clustering results into a colocation similarity matrix, <bold>S</bold>, whose element <italic>s</italic><sub><italic>i</italic>,<italic>j</italic></sub> represents the similarity between the <italic>i</italic>th and <italic>j</italic>th single cells. Then, based on the idea that the weight for each pair of single cells is determined by the degree of consistency of the colocation clustering results of these two single cells, we converted the similarity matrix <bold>S</bold> to the weight matrix <bold>W</bold> according to the following equation:
<disp-formula id="GR254557WANUM3"><mml:math id="UM3"><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>w</italic><sub><italic>i</italic>,<italic>j</italic></sub> is the element in the <italic>i</italic>th row and the <italic>j</italic>th column of <bold>W</bold>. It is easy to see that when <italic>s</italic><sub><italic>i</italic>,<italic>j</italic></sub> = 1 (i.e., the <italic>i</italic>th cell and the <italic>j</italic>th cell are with 100% probability in the same cluster) or <italic>s</italic><sub><italic>i</italic>,<italic>j</italic></sub> = 0 (i.e., the <italic>i</italic>th cell and the <italic>j</italic>th cell are with 0% probability in the same cluster), <italic>w</italic><sub><italic>i</italic>,<italic>j</italic></sub> reaches the minimum at zero; when <italic>s</italic><sub><italic>i</italic>,<italic>j</italic></sub> = 0.5 (i.e., the colocation probability of the <italic>i</italic>th cell and the <italic>j</italic>th cell in the same cluster is 0.5, whereas the probability of them in different clusters is also 0.5, which means this is the most difficult-to-cluster case), <italic>w</italic><sub><italic>i</italic>,<italic>j</italic></sub> reaches the maximum at 0.25. In other words, zero weight is assigned to those most “easy-to-cluster” pairs of single cells, and the highest cell-to-cell weight is assigned for the most “difficult-to-cluster” pairs. Then, a weight associated with each cell was calculated as the accumulation of all the cell-to-cell weights related with the corresponding cell. To calculate the weighted cluster-to-cluster similarity, we first noted that the size of the similarity matrix is |<italic>C</italic>| × |<italic>C</italic>|, where <italic>C</italic> is the union set of all the clusters obtained in each individual RP-based clustering results in the previous step, and | · | is the cardinality of a set. Then, for any two clusters, their similarity is determined by the sum of weights of their overlapped elements (i.e., cells) divided by that of their combined ones. Specifically, given two clusters <italic>C</italic><sub><italic>u</italic></sub> and <italic>C</italic><sub><italic>v</italic></sub>, the cluster-to-cluster similarity in wMetaC is defined as
<disp-formula id="GR254557WANUM4"><mml:math id="UM4"><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mi>M</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mstyle><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>u</mml:mi></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>v</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>u</mml:mi></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>v</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>w</italic><sub><italic>t</italic>,<italic>j</italic></sub> is the colocation weight for the <italic>t</italic>th cell and <italic>j</italic>th cell derived above, <italic>N</italic> is the number of cells, and <italic>δ</italic> is a very small positive number (by default, we used <italic>δ</italic> = 0.01) to avoid the denominator being zero. We can treat <inline-formula><mml:math id="il11"><mml:msubsup><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mspace width="0.4em"/></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> as the overall colocation weights for the <italic>t</italic>th cell because it sums up all the possible colocation weights between the <italic>t</italic>th cell and all cells. Thus, in the equation, the numerator represents the sum of the colocation weights of the cells that are found in both Cluster <italic>C</italic><sub><italic>u</italic></sub> and Cluster <italic>C</italic><sub><italic>v</italic></sub>, whereas the denominator represents the sum of the colocation weights of the cells that are found in either Cluster <italic>C</italic><sub><italic>u</italic></sub> or Cluster <italic>C</italic><sub><italic>v</italic></sub>.</p>
      <p>Then, in the third step (i.e., metaclustering), we used a hierarchical clustering with “ward.D” to cluster the obtained similarity matrix. After clustering, we understood which cluster in the first RP-based clustering corresponds to which cluster(s) in the second, third,…, <italic>K</italic>th RP-based clustering. Then, in the final step, we reorganized the <italic>K</italic> RP-based clustering results according to the result in the third step, and then we used a voting scheme (see below) to determine the final clustering results. These procedures were repeated for each of the <italic>B</italic> blocks.</p>
    </sec>
    <sec id="s3h">
      <title>Voting scheme</title>
      <p>Given <italic>K</italic> runs of RPs, we obtained <italic>K</italic> different individual clustering results by using hierarchical clustering on each of the <italic>K</italic> RP-based dimension-reduced feature matrices. Suppose that the <italic>k</italic>th (<italic>k</italic> ∈ {1, …, <italic>K</italic>}) individual clustering results in |<italic>C</italic><sup><italic>k</italic></sup>| clusters, that is, <inline-formula><mml:math id="il12"><mml:mo fence="false">{</mml:mo><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>2</mml:mn><mml:mi>k</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mi>k</mml:mi></mml:msubsup></mml:mrow><mml:mo fence="false">}</mml:mo></mml:math></inline-formula>. Then, by using the first three steps of wMetaC, we obtained a weighted-based cluster-wise similarity matrix, and then we used hierarchical clustering again for this metaclustering problem. After metaclustering, assume that the number of clusters is |<italic>G</italic>|, namely, {<italic>G</italic><sub>1</sub>, …, <italic>G</italic><sub><italic>g</italic></sub>, …, <italic>G</italic><sub>|<italic>G</italic>|</sub>}, where <inline-formula><mml:math id="il13"><mml:mo fence="false">|</mml:mo><mml:mi>G</mml:mi><mml:mo fence="false">|</mml:mo><mml:mo>≤</mml:mo><mml:msubsup><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mi>k</mml:mi></mml:msup></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:math></inline-formula>. Thus, <italic>G</italic><sub><italic>g</italic></sub> corresponds to one or more clusters from the individual clustering set. Finally, a single cell was assigned to the metacluster to which it belongs with the highest ratio. Ties were broken randomly. For example, given <italic>K</italic> = 5, suppose for a single cell, its five RP-based individual clustering results are <inline-formula><mml:math id="il14"><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mn>3</mml:mn><mml:mn>1</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>6</mml:mn><mml:mn>3</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>3</mml:mn><mml:mn>4</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>C</mml:mi><mml:mn>2</mml:mn><mml:mn>5</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>; that is, it belongs to the third cluster in the first RP clustering results, the first cluster in the second RP, the sixth cluster in the third RP, the third cluster in the fourth RP, and the second cluster in the fifth RP (note that the individual clusters are not necessarily consistent with each other and that is why metaclustering method like wMetaC is required). After metaclustering, suppose that <inline-formula><mml:math id="il15"><mml:msubsup><mml:mi>C</mml:mi><mml:mn>3</mml:mn><mml:mn>1</mml:mn></mml:msubsup></mml:math></inline-formula>, <inline-formula><mml:math id="il015"><mml:msubsup><mml:mi>C</mml:mi><mml:mn>6</mml:mn><mml:mn>3</mml:mn></mml:msubsup></mml:math></inline-formula>, and <inline-formula><mml:math id="il16"><mml:msubsup><mml:mi>C</mml:mi><mml:mn>2</mml:mn><mml:mn>5</mml:mn></mml:msubsup></mml:math></inline-formula> belong to the same metacluster <italic>G</italic><sub>3</sub>, while <inline-formula><mml:math id="il17"><mml:msubsup><mml:mi>C</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> and <inline-formula><mml:math id="il18"><mml:msubsup><mml:mi>C</mml:mi><mml:mn>3</mml:mn><mml:mn>4</mml:mn></mml:msubsup></mml:math></inline-formula> belong to <italic>G</italic><sub>1</sub> and <italic>G</italic><sub>2</sub>, respectively. Because this single cell is predicted to belong to Cluster <italic>G</italic><sub>3</sub> with the highest ratio (i.e., 3/5), the final predicted cluster of this cell is Cluster <italic>G</italic><sub>3</sub>.</p>
    </sec>
    <sec id="s3i">
      <title>Similarity-based metaclustering</title>
      <p>To integrate the clustering results of the <italic>B</italic> blocks obtained by wMetaC, we proposed a similarity-based metaclustering (sMetaC) approach, which is similar to wMetaC. The major differences between wMetaC and sMetaC are (1) the cluster-to-cluster pairwise similarity of the former is calculated based on colocation weights of single cells in each cluster, whereas that of the latter is calculated based on the mean of the cell-to-cell correlation coefficients; (2) the individual clustering results of the former actually correspond to the same block of single cells but in different lower-dimensional space, whereas those of the latter correspond to different blocks of single cells; and (3) the former requires a voting scheme to integrate <italic>K</italic> individual clustering results, whereas the latter does not, and it just needs to reorganize the clusters to make clusters consistent across blocks.</p>
      <p>The cluster-to-cluster pairwise similarity of wMetaC is calculated based on colocation weights of single cells in each cluster, whereas that of the sMetaC is calculated based on the Pearson's correlation coefficient of the mean cluster-wise feature vectors after ensemble RP. Specifically, in sMetaC, given two clusters <italic>G</italic><sup><italic>u</italic></sup> and <italic>G</italic><sup><italic>v</italic></sup> that were obtained by wMetaC (note that these two clusters may or may not belong to the same block of single cells), we calculated the similarity between these two clusters in sMetaC as follows
<disp-formula id="GR254557WANUM5"><mml:math id="UM5"><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>M</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>G</mml:mi><mml:mi>u</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:msup><mml:mi>G</mml:mi><mml:mi>v</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold">c</mml:mi><mml:mi mathvariant="bold">o</mml:mi><mml:mi mathvariant="bold">r</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msup><mml:mi>G</mml:mi><mml:mi>u</mml:mi></mml:msup></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:msub><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>G</mml:mi><mml:mi>u</mml:mi></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mi>u</mml:mi></mml:msubsup></mml:mrow><mml:mo>,</mml:mo><mml:mstyle><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:msup><mml:mi>G</mml:mi><mml:mi>v</mml:mi></mml:msup></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:msub><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>G</mml:mi><mml:mi>v</mml:mi></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>v</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <bold>cor</bold>(·, ·) is the Pearson's correlation coefficient of two vectors, <inline-formula><mml:math id="il19"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mi>u</mml:mi></mml:msubsup></mml:math></inline-formula> and <inline-formula><mml:math id="il20"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>v</mml:mi></mml:msubsup></mml:math></inline-formula> are the dimension-reduced feature vectors after ensemble RP for the <italic>i</italic>th cell in Cluster <italic>G</italic><sup><italic>u</italic></sup> and the <italic>j</italic>th cell in Cluster <italic>G</italic><sup><italic>v</italic></sup>, and |<italic>G</italic><sup><italic>u</italic></sup>| and |<italic>G</italic><sup><italic>v</italic></sup>| are the numbers of cells in Cluster <italic>G</italic><sup><italic>u</italic></sup> and Cluster <italic>G</italic><sup><italic>v</italic></sup>, respectively.</p>
    </sec>
    <sec id="s3j">
      <title>Determining the optimal number of clusters</title>
      <p>SHARP determines the optimal number of clusters by using three criteria that are based on internal evaluations of the clustering results (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Methods</ext-link>).</p>
    </sec>
    <sec id="s3k">
      <title>Time complexity analysis</title>
      <p>SHARP includes four steps for clustering: (1) data partition, (2) RP, (3) wMetaC, and (4) sMetaC. For the scRNA-seq data matrix <inline-formula><mml:math id="il21"><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula>, SHARP first divides the data into <italic>B</italic> blocks, the <italic>b</italic>th block with <italic>N</italic><sub><italic>b</italic></sub> single cells. According to the “data partition” section, <italic>N</italic><sub><italic>b</italic></sub> ≤ <italic>n</italic>, where <italic>n</italic> is a fixed user-defined parameter enabling that one application of RP-based clustering runs sufficiently fast. Our analysis (<ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Fig. S12</ext-link>) shows that <inline-formula><mml:math id="il22"><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1500</mml:mn><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">or</mml:mi></mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mn>2000</mml:mn></mml:math></inline-formula> is a good balance between performance and speed in our case. Then, for each block, one run of RP requires time complexity of <inline-formula><mml:math id="il23"><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> (<xref rid="GR254557WANC21" ref-type="bibr">Johnson and Lindenstrauss 1984</xref>), where <inline-formula><mml:math id="il24"><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mo fence="false">⌈</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mi>∈</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo fence="false">⌉</mml:mo><mml:mo>≪</mml:mo><mml:mi>D</mml:mi></mml:math></inline-formula>. Note here, <italic>d</italic> is calculated based on <italic>N</italic> rather than <italic>n</italic> for dimension-reduction consistency across blocks. Practically, in the 13 reported scRNA-seq data sets with numbers of cells smaller than 10,000, the dimension can be reduced by 42 to 238 times (i.e., <italic>D/d</italic>), depending on the number of single cells and the number of genes. SHARP requires several (i.e., <italic>K</italic>) runs of RPs (with complexity of <inline-formula><mml:math id="il25"><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>). Subsequently, SHARP uses a hierarchical clustering (hclust) with “ward.D” for each of the <italic>K</italic> RPs, thus with an overall time complexity of <inline-formula><mml:math id="il26"><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt><mml:mo>+</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> (note that the time complexity of hclust in R package is <italic>O</italic>(<italic>n</italic><sup>2</sup>)) (<xref rid="GR254557WANC31" ref-type="bibr">Murtagh and Legendre 2014</xref>). Later, wMetaC, essentially a hclust for the individual predicted clusters (also without loss of generality, suppose the number of clusters for each RP-based clustering is equally <italic>C</italic><sub>1</sub>, where <italic>C</italic><sub>1</sub> ≪ <italic>n</italic>), was applied to each block (in total, time complexity of <inline-formula><mml:math id="il27"><mml:mi>O</mml:mi><mml:mo>(</mml:mo><mml:mi>K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt><mml:mo>+</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>)</mml:mo></mml:math></inline-formula>). Finally, SHARP integrated the results of all blocks by proposing a method called sMetaC, whose time complexity is similar to wMetaC except the number of instances is different (similarly, we can suppose the number of clusters in each block is equally <italic>C</italic><sub>2</sub>, where <italic>C</italic><sub>2</sub> ≪ <italic>n</italic>). In this case, the total time complexity is <inline-formula><mml:math id="il28"><mml:mi>O</mml:mi><mml:mo>(</mml:mo><mml:mi>B</mml:mi><mml:mo>[</mml:mo><mml:mi>K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt><mml:mo>+</mml:mo><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>]</mml:mo><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>)</mml:mo></mml:math></inline-formula>. Practically, <italic>K</italic>, <italic>B</italic>, <italic>C</italic><sub>1</sub>, and <italic>C</italic><sub>2</sub> are very small; thus, the time complexity of SHARP can be written as <inline-formula><mml:math id="il29"><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt><mml:mo>+</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. Because <italic>n</italic> is fixed across different data sets, <inline-formula><mml:math id="il30"><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mo fence="false">⌈</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mi>∈</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo fence="false">⌉</mml:mo></mml:math></inline-formula> and <italic>D</italic> is usually larger than 10,000; thus <inline-formula><mml:math id="il31"><mml:mi>d</mml:mi><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt><mml:mo>&gt;</mml:mo><mml:mi>n</mml:mi></mml:math></inline-formula>, and therefore, the time complexity of SHARP is essentially <inline-formula><mml:math id="il32"><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mo>)</mml:mo><mml:msqrt><mml:mi>D</mml:mi></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>On the other hand, among the compared state-of-the-art methods, t-SNE plus <italic>k</italic>-means is arguably the fastest. Theoretically, t-SNE requires <italic>O</italic>(<italic>DN</italic> log(<italic>N</italic>)) for dimension reduction to two- or three-dimensional space (<xref rid="GR254557WANC38" ref-type="bibr">van der Maaten 2014</xref>). For t-SNE plus <italic>k</italic>-means for clustering, the time complexity is <italic>O</italic>(<italic>DN</italic> log(<italic>N</italic>) + 2<italic>Nki</italic>), where <italic>k</italic> is the number of clusters, and <italic>i</italic> is the number of iterations. Thus, the total time complexity for t-SNE + <italic>k</italic>-means is <italic>O</italic>(<italic>DN</italic>log(<italic>N</italic>)).</p>
      <p>All the tests except for the 1.3-million-cell data set were performed using a single core on an Intel Xeon CPU E5-2699 v4 @ 2.20-GHz system with 500-GB memory. To run 1.3 million cells, we used 16 cores on the same system.</p>
    </sec>
    <sec id="s3l">
      <title>Visualization</title>
      <p>For visualization, SHARP uses a weighted combination of the dimension-reduced feature matrix and the cell-to-cluster matrix derived from the clustering results. The former matrix is obtained by three steps: (1) applying <italic>K</italic> runs of RPs for each block of the large-scale scRNA-seq data, (2) combining these block-wise matrices to obtain <italic>K</italic> RP-based dimension-reduced matrices, and (3) averaging these <italic>K</italic> matrices into one ensemble matrix. For the latter matrix, we constructed a <italic>N</italic> × <italic>pC</italic> matrix, where <italic>N</italic> is the number of single cells, and <italic>pC</italic> is the predicted number of clusters. If the <italic>i</italic>th single cell is predicted to be in the <italic>j</italic>th cluster, then the element of the <italic>i</italic>th row and <italic>j</italic>th column is one; otherwise, it is zero. Subsequently, these two matrices were combined with different weights to formulate the visualization matrix, which is the input matrix of t-SNE for visualization.</p>
      <p>First, both the dimension-reduced feature matrix <inline-formula><mml:math id="il33"><mml:mrow><mml:mi mathvariant="bold-italic">A</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>d</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> (where <italic>N</italic> is the number of cells, and <italic>d</italic> is the number of dimensions after dimension reduction) and the cell-to-cluster matrix <inline-formula><mml:math id="il34"><mml:mrow><mml:mi mathvariant="bold-italic">B</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> (where <italic>pC</italic> is the predicted number of clusters) are centered and scaled along each dimension across cells, and we notate the results as <inline-formula><mml:math id="il35"><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">A</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="il36"><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">B</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>. Then, these two matrices are combined as follows: <inline-formula><mml:math id="il37"><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">V</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">A</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">B</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula>, where <inline-formula><mml:math id="il38"><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">V</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> is the input matrix to t-SNE for visualization, and <italic>w</italic> &gt; 0 is the weight ratio of the dimension-reduction feature matrix over the cell-to-cluster matrix. If 0 &lt; <italic>w</italic> &lt; 1, more weight will be given to cell-to-cluster matrix, suggesting that the clustering results are believed to be better for visualization; if <italic>w</italic> &gt; 1, more weight will be given to the dimension-reduced feature matrix, which indicates that the data in dimension-reduced space can be more suitable for visualization. Although it is possible to use some algorithms to optimize <italic>w</italic>, we adopted an empirical value (i.e., <italic>w</italic> = 2) by default, which is robust for better visualization across different scRNA-seq data sets. For flexibility, we also provided an extra option to allow users to define their own <italic>w</italic>.</p>
      <p>Based on the clustering results, SHARP can further detect cell-type-associated genes for each cluster. We adopted a method similar to SC3 except for three points: (1) Besides <italic>P</italic>-value and area under receiver operating curve (AUROC), SHARP uses two more criteria to select marker genes, namely, cluster-mean fold change (FC) and expression sparsity (i.e., the percentage of expressions across all cells); (2) SHARP uses an adaptive threshold instead of a hard-threshold (i.e., <italic>P</italic>-value &lt; 0.01 and AUROC &gt; 0.85); and (3) SHARP uses a parallelization way to calculate all of the criteria mentioned above.</p>
    </sec>
    <sec id="s3m">
      <title>Simulated data</title>
      <p>In this study, we have generated three simulated scRNA-seq data from the Tabula Muris Consortium (<xref rid="GR254557WANC37" ref-type="bibr">The Tabula Muris Consortium 2018</xref>). Specifically, we only selected the data from the microfluidic droplet–based method, and three simulated data were generated, namely, mdata3, mdata6, and mdata8. mdata3 was generated by mixing scRNA-seq data from three organs, including heart and aorta, thymus, and liver; mdata6 was generated from six organs, including heart and aorta, thymus, liver, bladder, kidney, and tongue; and mdata8 was generated from eight organs, including heart and aorta, thymus, liver, bladder, kidney, tongue, spleen, and trachea. Note that only those filtered data by the original paper were used. The total numbers of single cells for mdata3, mdata6, and mdata8 are 3898, 16,717, and 37,538, respectively.</p>
    </sec>
    <sec id="s3n">
      <title>Adding dropouts</title>
      <p>To further show the robustness of SHARP against scRNA-seq dropout events, we artificially added dropouts to a benchmarking data set (e.g., Montoro_small). Specifically, we randomly selected a percentage (e.g., 1%, 5%, 10%, 15%, and 20%) of nonzero expressions from the Montoro_small data set and then set them to be zero. In other words, the dropout percentage here refers to the added dropout percentage.</p>
    </sec>
    <sec id="s3n1">
      <title>Public data sets used in this study</title>
      <p>Single-cell RNA-seq data were obtained from the NCBI Gene Expression Omnibus (GEO; <uri xlink:href="https://www.ncbi.nlm.nih.gov/geo/">https://www.ncbi.nlm.nih.gov/geo/</uri>) accession numbers provided by their respective original publications. We downloaded the 1.3-million single-cell data set from the 10x Genomics website: <uri xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/1.3.0/1M_neurons">https://support.10xgenomics.com/single-cell-gene-expression/datasets/1.3.0/1M_neurons</uri>. The scRNA-seq data from the Tabula Muris Consortium was downloaded from figshare: <uri xlink:href="https://figshare.com/projects/Tabula_Muris_Transcriptomic_characterization_of_20_organs_and_tissues_from_Mus_musculus_at_single_cell_resolution/27733">https://figshare.com/projects/Tabula_Muris_Transcriptomic_characterization_of_20_organs_and_tissues_from_Mus_musculus_at_single_cell_resolution/27733</uri>.</p>
    </sec>
    <sec id="s3o">
      <title>Software availability</title>
      <p>The source code for SHARP is available at GitHub (<uri xlink:href="https://github.com/shibiaowan/SHARP">https://github.com/shibiaowan/SHARP</uri>) and as <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/lookup/suppl/doi:10.1101/gr.254557.119/-/DC1">Supplemental Code</ext-link>.</p>
    </sec>
  </sec>
  <sec id="s03o">
    <title>Competing interest statement</title>
    <p>The authors declare no competing interests.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplemental Material</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_30_2_205__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="x-zip-compressed" xlink:href="supp_gr.254557.119_Supplemental_Code.zip"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="supp_gr.254557.119_Supplemental_Files.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>This work is supported by a National Institutes of Health (National Institute of Diabetes and Digestive and Kidney Diseases) grant (R01 DK106027), the Novo Nordisk Foundation grant number NNF17CC0027852, and Lundbeck Foundation grant number R313-2019-421. S.W. also thanks Dr. Yiping Fan and Dr. Gang Wu at St. Jude Children's Research Hospital for insightful discussions.</p>
    <p><italic>Author contributions:</italic> S.W. and K.J.W. conceived and designed the study. S.W. developed the SHARP algorithm, performed the experiments, and analyzed the data. S.W. implemented the SHARP package. S.W., J.K., and K.J.W. participated in writing the paper. The manuscript was approved by all authors.</p>
  </ack>
  <fn-group>
    <fn fn-type="supplementary-material">
      <p>[Supplemental material is available for this article.]</p>
    </fn>
    <fn>
      <p>Article published online before print. Article, supplemental material, and publication date are at <ext-link ext-link-type="uri" xlink:href="http://www.genome.org/cgi/doi/10.1101/gr.254557.119">http://www.genome.org/cgi/doi/10.1101/gr.254557.119</ext-link>.</p>
    </fn>
  </fn-group>
  <ref-list>
    <title>References</title>
    <ref id="GR254557WANC1">
      <mixed-citation publication-type="other"><collab>10x Genomics</collab><year>2017</year><article-title>Transcriptional profiling of 1.3 million brain cells with the chromium single cell 3′ solution. LIT000015 Chromium<sup>TM</sup> Million Brain Cells Application Note</article-title>. <comment><uri xlink:href="https://www.10xgenomics.com/solutions/single-cell/">https://www.10xgenomics.com/solutions/single-cell/</uri></comment></mixed-citation>
    </ref>
    <ref id="GR254557WANC2">
      <mixed-citation publication-type="journal"><string-name><surname>Baron</surname><given-names>M</given-names></string-name>, <string-name><surname>Veres</surname><given-names>A</given-names></string-name>, <string-name><surname>Wolock</surname><given-names>SL</given-names></string-name>, <string-name><surname>Faust</surname><given-names>AL</given-names></string-name>, <string-name><surname>Gaujoux</surname><given-names>R</given-names></string-name>, <string-name><surname>Vetere</surname><given-names>A</given-names></string-name>, <string-name><surname>Ryu</surname><given-names>JH</given-names></string-name>, <string-name><surname>Wagner</surname><given-names>BK</given-names></string-name>, <string-name><surname>Shen-Orr</surname><given-names>SS</given-names></string-name>, <string-name><surname>Klein</surname><given-names>AM</given-names></string-name>, <etal/><year>2016</year><article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title>. <source>Cell Syst</source><volume>3</volume>: <fpage>346</fpage>–<lpage>360.e4</lpage>. <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id><pub-id pub-id-type="pmid">27667365</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC3">
      <mixed-citation publication-type="journal"><string-name><surname>Becht</surname><given-names>E</given-names></string-name>, <string-name><surname>McInnes</surname><given-names>L</given-names></string-name>, <string-name><surname>Healy</surname><given-names>J</given-names></string-name>, <string-name><surname>Dutertre</surname><given-names>CA</given-names></string-name>, <string-name><surname>Kwok</surname><given-names>IWH</given-names></string-name>, <string-name><surname>Ng</surname><given-names>LG</given-names></string-name>, <string-name><surname>Ginhoux</surname><given-names>F</given-names></string-name>, <string-name><surname>Newell</surname><given-names>EW</given-names></string-name>. <year>2019</year><article-title>Dimensionality reduction for visualizing single-cell data using UMAP</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>38</fpage>–<lpage>44</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4314</pub-id>.</mixed-citation>
    </ref>
    <ref id="GR254557WANC4">
      <mixed-citation publication-type="book"><string-name><surname>Bertoni</surname><given-names>A</given-names></string-name>, <string-name><surname>Valentini</surname><given-names>G</given-names></string-name>. <year>2006</year><article-title>Ensembles based on random projections to improve the accuracy of clustering algorithms</article-title>. In <source>Lecture notes in computer science</source> (ed. <string-name><surname>Apolloni</surname><given-names>B</given-names></string-name>, <etal/>), Vol. <volume>3931</volume>, pp. <fpage>31</fpage>–<lpage>37</lpage>. <publisher-name>Springer</publisher-name>, <publisher-loc>Berlin, Heidelberg</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR254557WANC5">
      <mixed-citation publication-type="confproc"><string-name><surname>Bingham</surname><given-names>E</given-names></string-name>, <string-name><surname>Mannila</surname><given-names>H</given-names></string-name>. <year>2001</year><article-title>Random projection in dimensionality reduction: applications to image and text data</article-title>. In <conf-name>Proceedings of the seventh ACM SIGKDD international conference on Knowledge discovery and data mining, San Francisco</conf-name> (ed. <string-name><surname>Provost</surname><given-names>F</given-names></string-name>, <string-name><surname>Srikant</surname><given-names>R</given-names></string-name>), pp. <fpage>245</fpage>–<lpage>250</lpage>. <conf-name>Association for Computing Machinery</conf-name>, <conf-loc>New York</conf-loc>.</mixed-citation>
    </ref>
    <ref id="GR254557WANC6">
      <mixed-citation publication-type="journal"><string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>P</given-names></string-name>, <string-name><surname>Smibert</surname><given-names>P</given-names></string-name>, <string-name><surname>Papalexi</surname><given-names>E</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>. <year>2018</year><article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>. <source>Nat Biotechnol</source><volume>36</volume>: <fpage>411</fpage>–<lpage>420</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id><pub-id pub-id-type="pmid">29608179</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC7">
      <mixed-citation publication-type="journal"><string-name><surname>Darmanis</surname><given-names>S</given-names></string-name>, <string-name><surname>Sloan</surname><given-names>SA</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Enge</surname><given-names>M</given-names></string-name>, <string-name><surname>Caneda</surname><given-names>C</given-names></string-name>, <string-name><surname>Shuer</surname><given-names>LM</given-names></string-name>, <string-name><surname>Hayden Gephart</surname><given-names>MG</given-names></string-name>, <string-name><surname>Barres</surname><given-names>BA</given-names></string-name>, <string-name><surname>Quake</surname><given-names>SR</given-names></string-name>. <year>2015</year><article-title>A survey of human brain transcriptome diversity at the single cell level</article-title>. <source>Proc Natl Acad Sci</source><volume>112</volume>: <fpage>7285</fpage>–<lpage>7290</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1507125112</pub-id><pub-id pub-id-type="pmid">26060301</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC8">
      <mixed-citation publication-type="journal"><string-name><surname>Enge</surname><given-names>M</given-names></string-name>, <string-name><surname>Arda</surname><given-names>E</given-names></string-name>, <string-name><surname>Mignardi</surname><given-names>M</given-names></string-name>, <string-name><surname>Beausang</surname><given-names>J</given-names></string-name>, <string-name><surname>Bottino</surname><given-names>R</given-names></string-name>, <string-name><surname>Kim</surname><given-names>SK</given-names></string-name>, <string-name><surname>Quake</surname><given-names>SR</given-names></string-name>. <year>2017</year><article-title>Single-cell analysis of human pancreas reveals transcriptional signatures of aging and somatic mutation patterns</article-title>. <source>Cell</source><volume>171</volume>: <fpage>321</fpage>–<lpage>330.e14</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2017.09.004</pub-id><pub-id pub-id-type="pmid">28965763</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC9">
      <mixed-citation publication-type="confproc"><string-name><surname>Fern</surname><given-names>XZ</given-names></string-name>, <string-name><surname>Brodley</surname><given-names>CE</given-names></string-name>. <year>2003</year><article-title>Random projection for high dimensional data clustering: a cluster ensemble approach</article-title>. In <conf-name>Proceedings of the 20th international conference on machine learning (ICML-03), Washington, DC</conf-name>, pp. <fpage>186</fpage>–<lpage>193</lpage>. ACM Press, New York.</mixed-citation>
    </ref>
    <ref id="GR254557WANC10">
      <mixed-citation publication-type="journal"><string-name><surname>Frankl</surname><given-names>P</given-names></string-name>, <string-name><surname>Maehara</surname><given-names>H</given-names></string-name>. <year>1988</year><article-title>The Johnson–Lindenstrauss lemma and the sphericity of some graphs</article-title>. <source>J Comb Theory B</source><volume>44</volume>: <fpage>355</fpage>–<lpage>362</lpage>. <pub-id pub-id-type="doi">10.1016/0095-8956(88)90043-3</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC11">
      <mixed-citation publication-type="journal"><string-name><surname>Goolam</surname><given-names>M</given-names></string-name>, <string-name><surname>Scialdone</surname><given-names>A</given-names></string-name>, <string-name><surname>Graham</surname><given-names>SJL</given-names></string-name>, <string-name><surname>Macaulay</surname><given-names>IC</given-names></string-name>, <string-name><surname>Jedrusik</surname><given-names>A</given-names></string-name>, <string-name><surname>Hupalowska</surname><given-names>A</given-names></string-name>, <string-name><surname>Voet</surname><given-names>T</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>, <string-name><surname>Zernicka-Goetz</surname><given-names>M</given-names></string-name>. <year>2016</year><article-title>Heterogeneity in Oct4 and Sox2 targets biases cell fate in 4-cell mouse embryos</article-title>. <source>Cell</source><volume>165</volume>: <fpage>61</fpage>–<lpage>74</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2016.01.047</pub-id><pub-id pub-id-type="pmid">27015307</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC12">
      <mixed-citation publication-type="journal"><string-name><surname>Guemez-Gamboa</surname><given-names>A</given-names></string-name>, <string-name><surname>Coufal</surname><given-names>NG</given-names></string-name>, <string-name><surname>Gleeson</surname><given-names>JG</given-names></string-name>. <year>2014</year><article-title>Primary cilia in the developing and mature brain</article-title>. <source>Neuron</source><volume>82</volume>: <fpage>511</fpage>–<lpage>521</lpage>. <pub-id pub-id-type="doi">10.1016/j.neuron.2014.04.024</pub-id><pub-id pub-id-type="pmid">24811376</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC13">
      <mixed-citation publication-type="journal"><string-name><surname>Halko</surname><given-names>N</given-names></string-name>, <string-name><surname>Martinsson</surname><given-names>PG</given-names></string-name>, <string-name><surname>Tropp</surname><given-names>JA</given-names></string-name>. <year>2011</year><article-title>Finding structure with randomness: probabilistic algorithms for constructing approximate matrix decompositions</article-title>. <source>SIAM Rev</source><volume>53</volume>: <fpage>217</fpage>–<lpage>288</lpage>. <pub-id pub-id-type="doi">10.1137/090771806</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC14">
      <mixed-citation publication-type="journal"><string-name><surname>Han</surname><given-names>X</given-names></string-name>, <string-name><surname>Wang</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Y</given-names></string-name>, <string-name><surname>Fei</surname><given-names>L</given-names></string-name>, <string-name><surname>Sun</surname><given-names>H</given-names></string-name>, <string-name><surname>Lai</surname><given-names>S</given-names></string-name>, <string-name><surname>Saadatpour</surname><given-names>A</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Z</given-names></string-name>, <string-name><surname>Chen</surname><given-names>H</given-names></string-name>, <string-name><surname>Ye</surname><given-names>F</given-names></string-name>, <etal/><year>2018</year><article-title>Mapping the mouse cell atlas by Microwell-seq</article-title>. <source>Cell</source><volume>172</volume>: <fpage>1091</fpage>–<lpage>1107.e17</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2018.02.001</pub-id><pub-id pub-id-type="pmid">29474909</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC15">
      <mixed-citation publication-type="journal"><string-name><surname>Hie</surname><given-names>B</given-names></string-name>, <string-name><surname>Bryson</surname><given-names>B</given-names></string-name>, <string-name><surname>Berger</surname><given-names>B</given-names></string-name>. <year>2019a</year><article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>685</fpage>–<lpage>691</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id><pub-id pub-id-type="pmid">31061482</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC16">
      <mixed-citation publication-type="journal"><string-name><surname>Hie</surname><given-names>B</given-names></string-name>, <string-name><surname>Cho</surname><given-names>H</given-names></string-name>, <string-name><surname>DeMeo</surname><given-names>B</given-names></string-name>, <string-name><surname>Bryson</surname><given-names>B</given-names></string-name>, <string-name><surname>Berger</surname><given-names>B</given-names></string-name>. <year>2019b</year><article-title>Geometric sketching compactly summarizes the single-cell transcriptomic landscape</article-title>. <source>Cell Syst</source><volume>8</volume>: <fpage>483</fpage>–<lpage>493.e7</lpage>. <pub-id pub-id-type="doi">10.1016/j.cels.2019.05.003</pub-id><pub-id pub-id-type="pmid">31176620</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC17">
      <mixed-citation publication-type="journal"><string-name><surname>Hubert</surname><given-names>L</given-names></string-name>, <string-name><surname>Arabie</surname><given-names>P</given-names></string-name>. <year>1985</year><article-title>Comparing partitions</article-title>. <source>J Classif</source><volume>2</volume>: <fpage>193</fpage>–<lpage>218</lpage>. <pub-id pub-id-type="doi">10.1007/BF01908075</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC18">
      <mixed-citation publication-type="journal"><string-name><surname>Huh</surname><given-names>R</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shen</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>. <year>2019</year><article-title>SAME-clustering: <underline>S</underline>ingle-cell <underline>A</underline>ggregated Clustering via <underline>M</underline>ixture model <underline>E</underline>nsemble</article-title>. <source>Nucleic Acids Res</source><volume>48</volume>: <fpage>86</fpage>–<lpage>95</lpage>. <pub-id pub-id-type="doi">10.1093/nar/gkz959</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC19">
      <mixed-citation publication-type="journal"><string-name><surname>Hyvärinen</surname><given-names>A</given-names></string-name>, <string-name><surname>Oja</surname><given-names>E</given-names></string-name>. <year>2000</year><article-title>Independent</article-title><article-title>component analysis: algorithms and applications</article-title>. <source>Neural Netw</source><volume>13</volume>: <fpage>411</fpage>–<lpage>430</lpage>. <pub-id pub-id-type="doi">10.1016/S0893-6080(00)00026-5</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC20">
      <mixed-citation publication-type="journal"><string-name><surname>Iacono</surname><given-names>G</given-names></string-name>, <string-name><surname>Mereu</surname><given-names>E</given-names></string-name>, <string-name><surname>Guillaumet-Adkins</surname><given-names>A</given-names></string-name>, <string-name><surname>Corominas</surname><given-names>R</given-names></string-name>, <string-name><surname>Cuscó</surname><given-names>I</given-names></string-name>, <string-name><surname>Rodríguez-Esteban</surname><given-names>G</given-names></string-name>, <string-name><surname>Gut</surname><given-names>M</given-names></string-name>, <string-name><surname>Pérez-Jurado</surname><given-names>LA</given-names></string-name>, <string-name><surname>Gut</surname><given-names>I</given-names></string-name>, <string-name><surname>Heyn</surname><given-names>H</given-names></string-name>. <year>2018</year><article-title>bigSCale: an analytical framework for big-scale single-cell data</article-title>. <source>Genome Res</source><volume>28</volume>: <fpage>878</fpage>–<lpage>890</lpage>. <pub-id pub-id-type="doi">10.1101/gr.230771.117</pub-id><pub-id pub-id-type="pmid">29724792</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC21">
      <mixed-citation publication-type="journal"><string-name><surname>Johnson</surname><given-names>WB</given-names></string-name>, <string-name><surname>Lindenstrauss</surname><given-names>J</given-names></string-name>. <year>1984</year><article-title>Extensions of Lipschitz mappings into a Hilbert space</article-title>. <source>Contemp Math</source><volume>26</volume>: <fpage>189</fpage>–<lpage>206</lpage>. <pub-id pub-id-type="doi">10.1090/conm/026/737383</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC22">
      <mixed-citation publication-type="journal"><string-name><surname>Joliffe</surname><given-names>IT</given-names></string-name>, <string-name><surname>Morgan</surname><given-names>BJ</given-names></string-name>. <year>1992</year><article-title>Principal component analysis and exploratory factor analysis</article-title>. <source>Stat Methods Med Res</source><volume>1</volume>: <fpage>69</fpage>–<lpage>95</lpage>. <pub-id pub-id-type="doi">10.1177/096228029200100105</pub-id><pub-id pub-id-type="pmid">1341653</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC23">
      <mixed-citation publication-type="journal"><string-name><surname>Kiselev</surname><given-names>VY</given-names></string-name>, <string-name><surname>Kirschner</surname><given-names>K</given-names></string-name>, <string-name><surname>Schaub</surname><given-names>MT</given-names></string-name>, <string-name><surname>Andrews</surname><given-names>T</given-names></string-name>, <string-name><surname>Yiu</surname><given-names>A</given-names></string-name>, <string-name><surname>Chandra</surname><given-names>T</given-names></string-name>, <string-name><surname>Natarajan</surname><given-names>KN</given-names></string-name>, <string-name><surname>Reik</surname><given-names>W</given-names></string-name>, <string-name><surname>Barahona</surname><given-names>M</given-names></string-name>, <string-name><surname>Green</surname><given-names>AR</given-names></string-name>, <etal/><year>2017</year><article-title>SC3: consensus clustering of single-cell RNA-seq data</article-title>. <source>Nat Methods</source><volume>14</volume>: <fpage>483</fpage>–<lpage>486</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.4236</pub-id><pub-id pub-id-type="pmid">28346451</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC24">
      <mixed-citation publication-type="journal"><string-name><surname>Klein</surname><given-names>AM</given-names></string-name>, <string-name><surname>Mazutis</surname><given-names>L</given-names></string-name>, <string-name><surname>Akartuna</surname><given-names>I</given-names></string-name>, <string-name><surname>Tallapragada</surname><given-names>N</given-names></string-name>, <string-name><surname>Veres</surname><given-names>A</given-names></string-name>, <string-name><surname>Li</surname><given-names>V</given-names></string-name>, <string-name><surname>Peshkin</surname><given-names>L</given-names></string-name>, <string-name><surname>Weitz</surname><given-names>DA</given-names></string-name>, <string-name><surname>Kirschner</surname><given-names>MW</given-names></string-name>. <year>2015</year><article-title>Droplet barcoding for single-cell transcriptomics applied to embryonic stem cells</article-title>. <source>Cell</source><volume>161</volume>: <fpage>1187</fpage>–<lpage>1201</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2015.04.044</pub-id><pub-id pub-id-type="pmid">26000487</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC25">
      <mixed-citation publication-type="journal"><string-name><surname>Kolodziejczyk</surname><given-names>AA</given-names></string-name>, <string-name><surname>Kim</surname><given-names>JK</given-names></string-name>, <string-name><surname>Tsang</surname><given-names>JCH</given-names></string-name>, <string-name><surname>Ilicic</surname><given-names>T</given-names></string-name>, <string-name><surname>Henriksson</surname><given-names>J</given-names></string-name>, <string-name><surname>Natarajan</surname><given-names>KN</given-names></string-name>, <string-name><surname>Tuck</surname><given-names>AC</given-names></string-name>, <string-name><surname>Gao</surname><given-names>XF</given-names></string-name>, <string-name><surname>Bühler</surname><given-names>M</given-names></string-name>, <string-name><surname>Liu</surname><given-names>PT</given-names></string-name>, <etal/><year>2015</year><article-title>Single cell RNA-sequencing of pluripotent states unlocks modular transcriptional variation</article-title>. <source>Cell Stem Cell</source><volume>17</volume>: <fpage>471</fpage>–<lpage>485</lpage>. <pub-id pub-id-type="doi">10.1016/j.stem.2015.09.011</pub-id><pub-id pub-id-type="pmid">26431182</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC26">
      <mixed-citation publication-type="journal"><string-name><surname>Levine</surname><given-names>JH</given-names></string-name>, <string-name><surname>Simonds</surname><given-names>EF</given-names></string-name>, <string-name><surname>Bendall</surname><given-names>SC</given-names></string-name>, <string-name><surname>Davis</surname><given-names>KL</given-names></string-name>, <string-name><surname>Amir</surname><given-names>EAD</given-names></string-name>, <string-name><surname>Tadmor</surname><given-names>MD</given-names></string-name>, <string-name><surname>Litvin</surname><given-names>O</given-names></string-name>, <string-name><surname>Fienberg</surname><given-names>HG</given-names></string-name>, <string-name><surname>Jager</surname><given-names>A</given-names></string-name>, <string-name><surname>Zunder</surname><given-names>ER</given-names></string-name>, <etal/><year>2015</year><article-title>Data-driven phenotypic dissection of AML reveals progenitor-like cells that correlate with prognosis</article-title>. <source>Cell</source><volume>162</volume>: <fpage>184</fpage>–<lpage>197</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.047</pub-id><pub-id pub-id-type="pmid">26095251</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC27">
      <mixed-citation publication-type="confproc"><string-name><surname>Li</surname><given-names>P</given-names></string-name>, <string-name><surname>Hastie</surname><given-names>TJ</given-names></string-name>, <string-name><surname>Church</surname><given-names>KW</given-names></string-name>. <year>2006</year><article-title>Very sparse random projections</article-title>. In <conf-name>Proceedings of the 12th ACM SIGKDD international conference on knowledge discovery and data mining, Philadelphia</conf-name>, pp. <fpage>287</fpage>–<lpage>296</lpage>. <conf-loc>ACM Press, New York</conf-loc>.</mixed-citation>
    </ref>
    <ref id="GR254557WANC28">
      <mixed-citation publication-type="journal"><string-name><surname>Lin</surname><given-names>PJ</given-names></string-name>, <string-name><surname>Troup</surname><given-names>M</given-names></string-name>, <string-name><surname>Ho</surname><given-names>JWK</given-names></string-name>. <year>2017</year><article-title>CIDR: ultrafast and accurate clustering through imputation for single-cell RNA-seq data</article-title>. <source>Genome Biol</source><volume>18</volume>: <fpage>59</fpage><pub-id pub-id-type="doi">10.1186/s13059-017-1188-0</pub-id><pub-id pub-id-type="pmid">28351406</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC29">
      <mixed-citation publication-type="journal"><string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>, <string-name><surname>Basu</surname><given-names>A</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R</given-names></string-name>, <string-name><surname>Nemesh</surname><given-names>J</given-names></string-name>, <string-name><surname>Shekhar</surname><given-names>K</given-names></string-name>, <string-name><surname>Goldman</surname><given-names>M</given-names></string-name>, <string-name><surname>Tirosh</surname><given-names>I</given-names></string-name>, <string-name><surname>Bialas</surname><given-names>AR</given-names></string-name>, <string-name><surname>Kamitaki</surname><given-names>N</given-names></string-name>, <string-name><surname>Martersteck</surname><given-names>EM</given-names></string-name>, <etal/><year>2015</year><article-title>Highly parallel genome-wide expression profiling of individual cells using nanoliter droplets</article-title>. <source>Cell</source><volume>161</volume>: <fpage>1202</fpage>–<lpage>1214</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.002</pub-id><pub-id pub-id-type="pmid">26000488</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC30">
      <mixed-citation publication-type="journal"><string-name><surname>Montoro</surname><given-names>DT</given-names></string-name>, <string-name><surname>Haber</surname><given-names>AL</given-names></string-name>, <string-name><surname>Biton</surname><given-names>M</given-names></string-name>, <string-name><surname>Vinarsky</surname><given-names>V</given-names></string-name>, <string-name><surname>Lin</surname><given-names>B</given-names></string-name>, <string-name><surname>Birket</surname><given-names>SE</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>F</given-names></string-name>, <string-name><surname>Chen</surname><given-names>SJ</given-names></string-name>, <string-name><surname>Leung</surname><given-names>HM</given-names></string-name>, <string-name><surname>Villoria</surname><given-names>J</given-names></string-name>, <etal/><year>2018</year><article-title>A revised airway epithelial hierarchy includes CFTR-expressing ionocytes</article-title>. <source>Nature</source><volume>560</volume>: <fpage>319</fpage>–<lpage>324</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-018-0393-7</pub-id><pub-id pub-id-type="pmid">30069044</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC31">
      <mixed-citation publication-type="journal"><string-name><surname>Murtagh</surname><given-names>F</given-names></string-name>, <string-name><surname>Legendre</surname><given-names>P</given-names></string-name>. <year>2014</year><article-title>Ward's hierarchical agglomerative clustering method: Which algorithms implement Ward's criterion?</article-title><source>J Classif</source><volume>31</volume>: <fpage>274</fpage>–<lpage>295</lpage>. <pub-id pub-id-type="doi">10.1007/s00357-014-9161-z</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC32">
      <mixed-citation publication-type="journal"><string-name><surname>Park</surname><given-names>J</given-names></string-name>, <string-name><surname>Shrestha</surname><given-names>R</given-names></string-name>, <string-name><surname>Qiu</surname><given-names>CX</given-names></string-name>, <string-name><surname>Kondo</surname><given-names>A</given-names></string-name>, <string-name><surname>Huang</surname><given-names>SZ</given-names></string-name>, <string-name><surname>Werth</surname><given-names>M</given-names></string-name>, <string-name><surname>Li</surname><given-names>MY</given-names></string-name>, <string-name><surname>Barasch</surname><given-names>J</given-names></string-name>, <string-name><surname>Suszták</surname><given-names>K</given-names></string-name>. <year>2018</year><article-title>Single-cell transcriptomics of the mouse kidney reveals potential cellular targets of kidney disease</article-title>. <source>Science</source><volume>360</volume>: <fpage>758</fpage>–<lpage>763</lpage>. <pub-id pub-id-type="doi">10.1126/science.aar2131</pub-id><pub-id pub-id-type="pmid">29622724</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC33">
      <mixed-citation publication-type="journal"><string-name><surname>Potter</surname><given-names>SS</given-names></string-name>. <year>2018</year><article-title>Single-cell RNA sequencing for the study of development, physiology and disease</article-title>. <source>Nat Rev Nephrol</source><volume>14</volume>: <fpage>479</fpage>–<lpage>492</lpage>. <pub-id pub-id-type="doi">10.1038/s41581-018-0021-7</pub-id><pub-id pub-id-type="pmid">29789704</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC34">
      <mixed-citation publication-type="book"><collab>R Core Team</collab>. <year>2016</year><source>R: a language and environment for statistical computing</source>. <publisher-name>R Foundation for Statistical Computing</publisher-name>, <publisher-loc>Vienna</publisher-loc><comment><uri xlink:href="https://www.R-project.org/">https://www.R-project.org/</uri></comment>.</mixed-citation>
    </ref>
    <ref id="GR254557WANC35">
      <mixed-citation publication-type="journal"><string-name><surname>Ren</surname><given-names>YZ</given-names></string-name>, <string-name><surname>Domeniconi</surname><given-names>C</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>GJ</given-names></string-name>, <string-name><surname>Yu</surname><given-names>GX</given-names></string-name>. <year>2017</year><article-title>Weighted-object ensemble clustering: methods and analysis</article-title>. <source>Knowl Inf Syst</source><volume>51</volume>: <fpage>661</fpage>–<lpage>689</lpage>. <pub-id pub-id-type="doi">10.1007/s10115-016-0988-y</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC36">
      <mixed-citation publication-type="journal"><string-name><surname>Strehl</surname><given-names>A</given-names></string-name>, <string-name><surname>Ghosh</surname><given-names>J</given-names></string-name>. <year>2002</year><article-title>Cluster ensembles: a knowledge reuse framework for combining multiple partitions</article-title>. <source>J Mach Learn Res</source><volume>3</volume>: <fpage>583</fpage>–<lpage>617</lpage>. <pub-id pub-id-type="doi">10.1162/153244303321897735</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC37">
      <mixed-citation publication-type="journal"><collab>The Tabula Muris Consortium</collab>. <year>2018</year><article-title>Single-cell transcriptomics of 20 mouse organs creates a <italic>Tabula Muris</italic></article-title>. <source>Nature</source><volume>562</volume>: <fpage>367</fpage>–<lpage>372</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-018-0590-4</pub-id><pub-id pub-id-type="pmid">30283141</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC38">
      <mixed-citation publication-type="journal"><string-name><surname>van der Maaten</surname><given-names>L</given-names></string-name>. <year>2014</year><article-title>Accelerating t-SNE using tree-based algorithms</article-title>. <source>J Mach Learn Res</source><volume>15</volume>: <fpage>3221</fpage>–<lpage>3245</lpage>.</mixed-citation>
    </ref>
    <ref id="GR254557WANC39">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>YJ</given-names></string-name>, <string-name><surname>Schug</surname><given-names>J</given-names></string-name>, <string-name><surname>Won</surname><given-names>KJ</given-names></string-name>, <string-name><surname>Liu</surname><given-names>CY</given-names></string-name>, <string-name><surname>Naji</surname><given-names>A</given-names></string-name>, <string-name><surname>Avrahami</surname><given-names>D</given-names></string-name>, <string-name><surname>Golson</surname><given-names>ML</given-names></string-name>, <string-name><surname>Kaestner</surname><given-names>KH</given-names></string-name>. <year>2016</year><article-title>Single-cell transcriptomics of the human endocrine pancreas</article-title>. <source>Diabetes</source><volume>65</volume>: <fpage>3028</fpage>–<lpage>3038</lpage>. <pub-id pub-id-type="doi">10.2337/db16-0405</pub-id><pub-id pub-id-type="pmid">27364731</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC40">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>B</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>JJ</given-names></string-name>, <string-name><surname>Pierson</surname><given-names>E</given-names></string-name>, <string-name><surname>Ramazzotti</surname><given-names>D</given-names></string-name>, <string-name><surname>Batzoglou</surname><given-names>S</given-names></string-name>. <year>2017</year><article-title>Visualization and analysis of single-cell RNA-seq data by kernel-based similarity learning</article-title>. <source>Nat Methods</source><volume>14</volume>: <fpage>414</fpage>–<lpage>416</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.4207</pub-id><pub-id pub-id-type="pmid">28263960</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC41">
      <mixed-citation publication-type="journal"><string-name><surname>Ward</surname><given-names>JH</given-names><suffix>Jr</suffix></string-name>. <year>1963</year><article-title>Hierarchical grouping to optimize an objective function</article-title>. <source>J Am Stat Assoc</source><volume>58</volume>: <fpage>236</fpage>–<lpage>244</lpage>. <pub-id pub-id-type="doi">10.1080/01621459.1963.10500845</pub-id></mixed-citation>
    </ref>
    <ref id="GR254557WANC42">
      <mixed-citation publication-type="journal"><string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Huh</surname><given-names>R</given-names></string-name>, <string-name><surname>Culpepper</surname><given-names>HW</given-names></string-name>, <string-name><surname>Lin</surname><given-names>Y</given-names></string-name>, <string-name><surname>Love</surname><given-names>MI</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>. <year>2019</year><article-title>SAFE-clustering: single-cell aggregated (from ensemble) clustering for single-cell RNA-seq data</article-title>. <source>Bioinformatics</source><volume>35</volume>: <fpage>1269</fpage>–<lpage>1277</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/bty793</pub-id><pub-id pub-id-type="pmid">30202935</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
