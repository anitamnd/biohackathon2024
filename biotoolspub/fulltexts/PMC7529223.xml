<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7529223</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0233198</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-20-12417</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Imaging Techniques</subject>
          <subj-group>
            <subject>Fluorescence Imaging</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Anatomy</subject>
          <subj-group>
            <subject>Histology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Anatomy</subject>
          <subj-group>
            <subject>Histology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Imaging Techniques</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Specimen Preparation and Treatment</subject>
          <subj-group>
            <subject>Staining</subject>
            <subj-group>
              <subject>Nuclear Staining</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Specimen Preparation and Treatment</subject>
          <subj-group>
            <subject>Staining</subject>
            <subj-group>
              <subject>Group-Specific Staining</subject>
              <subj-group>
                <subject>Hematoxylin Staining</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Digital Imaging</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Anatomy</subject>
          <subj-group>
            <subject>Exocrine Glands</subject>
            <subj-group>
              <subject>Prostate Gland</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Anatomy</subject>
          <subj-group>
            <subject>Exocrine Glands</subject>
            <subj-group>
              <subject>Prostate Gland</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Physics</subject>
          <subj-group>
            <subject>Electromagnetic Radiation</subject>
            <subj-group>
              <subject>Luminescence</subject>
              <subj-group>
                <subject>Fluorescence</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>FalseColor-Python: A rapid intensity-leveling and digital-staining package for fluorescence-based slide-free digital pathology</article-title>
      <alt-title alt-title-type="running-head">FalseColor-Python: A digital-staining package for slide-free digital pathology</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-6646-353X</contrib-id>
        <name>
          <surname>Serafin</surname>
          <given-names>Robert</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Xie</surname>
          <given-names>Weisi</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Glaser</surname>
          <given-names>Adam K.</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Jonathan T. C.</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Department of Mechanical Engineering, University of Washington, Seattle, Washington, United States of America</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Department of Pathology, University of Washington, Seattle, Washington, United States of America</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Department of Bioengineering, University of Washington, Seattle, Washington, United States of America</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Lin</surname>
          <given-names>Jerry Chun-Wei</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Western Norway University of Applied Sciences, NORWAY</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p><bold>Competing Interests: </bold>A.K.G. and J.T.C.L. are co-founders and shareholders of Lightspeed Microscopy Inc. This does not alter our adherence to PLOS ONE policies on sharing data and materials.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>serrob23@uw.edu</email> (RS); <email>jonliu@uw.edu</email> (JTCL)</corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>1</day>
      <month>10</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>15</volume>
    <issue>10</issue>
    <elocation-id>e0233198</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>4</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>16</day>
        <month>9</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2020 Serafin et al</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>Serafin et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pone.0233198.pdf"/>
    <abstract>
      <p>Slide-free digital pathology techniques, including nondestructive 3D microscopy, are gaining interest as alternatives to traditional slide-based histology. In order to facilitate clinical adoption of these fluorescence-based techniques, software methods have been developed to convert grayscale fluorescence images into color images that mimic the appearance of standard absorptive chromogens such as hematoxylin and eosin (H&amp;E). However, these false-coloring algorithms often require manual and iterative adjustment of parameters, with results that can be inconsistent in the presence of intensity nonuniformities within an image and/or between specimens (intra- and inter-specimen variability). Here, we present an open-source (Python-based) rapid intensity-leveling and digital-staining package that is specifically designed to render two-channel fluorescence images (i.e. a fluorescent analog of H&amp;E) to the traditional H&amp;E color space for 2D and 3D microscopy datasets. However, this method can be easily tailored for other false-coloring needs. Our package offers (1) automated and uniform false coloring in spite of uneven staining within a large thick specimen, (2) consistent color-space representations that are robust to variations in staining and imaging conditions between different specimens, and (3) GPU-accelerated data processing to allow these methods to scale to large datasets. We demonstrate this platform by generating H&amp;E-like images from cleared tissues that are fluorescently imaged in 3D with open-top light-sheet (OTLS) microscopy, and quantitatively characterizing the results in comparison to traditional slide-based H&amp;E histology.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100014039</institution-id>
            <institution>DOD Prostate Cancer Research Program</institution>
          </institution-wrap>
        </funding-source>
        <award-id>W81XWH-18-10358</award-id>
        <principal-award-recipient>
          <name>
            <surname>Liu</surname>
            <given-names>Jonathan T. C.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award002">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000001</institution-id>
            <institution>National Science Foundation</institution>
          </institution-wrap>
        </funding-source>
        <award-id>1934292 HDR: I-DIRSE-FW</award-id>
        <principal-award-recipient>
          <name>
            <surname>Liu</surname>
            <given-names>Jonathan T. C.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award003">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000054</institution-id>
            <institution>National Cancer Institute</institution>
          </institution-wrap>
        </funding-source>
        <award-id>K99CA240681</award-id>
        <principal-award-recipient>
          <name>
            <surname>Glaser</surname>
            <given-names>Adam K.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award004">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000054</institution-id>
            <institution>National Cancer Institute</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01CA175391</award-id>
        <principal-award-recipient>
          <name>
            <surname>Liu</surname>
            <given-names>Jonathan T. C.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <funding-statement>We acknowledge research grants from the Department of Defense (DoD) Prostate Cancer Research Program through W81XWH-18-10358 (JTCL and LDT); the National Science Foundation through 1934292 HDR: I-DIRSE-FW (JTCL and RS); and the NIH / NCI through K99CA240681 (AKG) and R01CA175391 (JTCL). The content is solely the responsibility of the authors and does not represent the official views of the National Institutes of Health, the U.S. Department of Defense, the National Science Foundation, or the United States Government.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="6"/>
      <table-count count="2"/>
      <page-count count="17"/>
    </counts>
    <custom-meta-group>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>The authors have provided a link to their GitHub repository in the paper: <ext-link ext-link-type="uri" xlink:href="https://github.com/serrob23/falsecolor">https://github.com/serrob23/falsecolor</ext-link>.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>The authors have provided a link to their GitHub repository in the paper: <ext-link ext-link-type="uri" xlink:href="https://github.com/serrob23/falsecolor">https://github.com/serrob23/falsecolor</ext-link>.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>Modern microscopy methods enable life scientists and clinicians to visualize complex tissue structures, where recent technological advancements have radically enhanced our understanding of biological processes and disease pathologies. However, clinical diagnostic practices have not taken full advantage of these modern microscopy techniques. In particular, the gold-standard diagnostic method of histology is based on centuries-old technologies, where tissues are preserved in harsh fixatives, destructively sectioned onto glass slides, stained with simple chromogens (most-commonly with hematoxylin and eosin, i.e. H&amp;E), and manually imaged with analog brightfield microscopes. In order to improve throughput, non-destructiveness, sampling extent, and in some cases, to provide 3D information, several slide-free microscopy techniques have recently been explored for use in clinical settings. For example, techniques such as confocal microscopy [<xref rid="pone.0233198.ref001" ref-type="bibr">1</xref>, <xref rid="pone.0233198.ref002" ref-type="bibr">2</xref>], multiphoton microscopy [<xref rid="pone.0233198.ref003" ref-type="bibr">3</xref>–<xref rid="pone.0233198.ref006" ref-type="bibr">6</xref>], microscopy with UV surface excitation (MUSE) [<xref rid="pone.0233198.ref007" ref-type="bibr">7</xref>–<xref rid="pone.0233198.ref009" ref-type="bibr">9</xref>], and structured illumination microscopy (SIM) [<xref rid="pone.0233198.ref010" ref-type="bibr">10</xref>, <xref rid="pone.0233198.ref011" ref-type="bibr">11</xref>] have been explored as slide-free alternatives to frozen-section histology for rapid interoperative guidance. Additionally, light-sheet microscopy technologies, such as open-top light-sheet (OTLS) microscopy [<xref rid="pone.0233198.ref012" ref-type="bibr">12</xref>–<xref rid="pone.0233198.ref014" ref-type="bibr">14</xref>], when used in conjunction with tissue-clearing techniques [<xref rid="pone.0233198.ref015" ref-type="bibr">15</xref>], have been explored for slide-free nondestructive 3D pathology. These techniques generally rely on fluorescence collected with a sensitive monochrome detector. Since pathologists are accustomed to certain color schemes generated by standard chromogens, such as the pink and purple hues associated with H&amp;E staining, the ability to render grayscale fluorescent images with color palettes that mimic standard histology can play a major role on the ability of pathologists to interpret and adopt slide-free pathology methods in the future.</p>
    <p>Several groups have published software methods to convert two-channel fluorescence images into “virtual H&amp;E” images. One such virtual H&amp;E algorithm was published in 2009 by Gareau [<xref rid="pone.0233198.ref016" ref-type="bibr">16</xref>]. Using an additive model, this method rendered the reflectance contrast generated by collagen and cytoplasm, and the fluorescence generated by a hematoxylin analog, to mimic H&amp;E staining. Bini et al. in 2011 further refined this model by analyzing the transmitted spectra of multiple slides that were independently stained with either hematoxylin or eosin [<xref rid="pone.0233198.ref017" ref-type="bibr">17</xref>]. A limitation of the additive approach is that in standard H&amp;E histology, the classic pink and purple hues are the result of spectral mixing of the two dyes present in the specimen, according to a nonlinear absorption process (Beer-Lambert-law attenuation). Additive models rely on the linear superposition of intensities, which is non-physical and does not reliably mimic the appearance of conventional H&amp;E histology.</p>
    <p>To address these limitations, a false-coloring model based on the Beer-Lambert law of absorption was developed by <italic>Giacomelli et al</italic>. in 2016 [<xref rid="pone.0233198.ref018" ref-type="bibr">18</xref>]. The Beer-Lambert model accounts for the spectral mixing of chromogenic (absorption-based) dyes and their wavelength-dependent nonlinear attenuation of light (i.e. exponential decay as a function of concentration). As a result, this model can accommodate multiple fluorescent stains with overlapping spectra without loss of contrast or non-physical results. Note that in addition to H&amp;E, other chromogens can be modeled, such as the DAB stain most-commonly used for immunohistochemistry (IHC) [<xref rid="pone.0233198.ref013" ref-type="bibr">13</xref>].</p>
    <p>The previous approaches described above, for false coloring fluorescent images to mimic conventional chromogenic (absorption-based) stains, have a number of practical shortcomings that prevent them from generating consistent results. In particular, three main points motivate the work described in this article:</p>
    <list list-type="order">
      <list-item>
        <p>Significant variations in the appearance of slide-free digital pathology images can occur due to uneven staining within a specimen (intra-specimen variability). In particular, thick unsectioned tissues exhibit diffusion barriers that often lead to nonuniform staining. This is more pronounced with large agents such as antibodies but also affects smaller agents. Additionally, when imaging optically cleared tissues, samples that are not fully cleared can exhibit a scattering-induced loss of signal as a function of imaging depth.</p>
      </list-item>
      <list-item>
        <p>The appearance of both standard histology and slide-free fluorescence images can vary greatly between institutions, or even within an institution, due to day-to-day variations in sample preparation, staining protocols and imaging parameters (inter-specimen variability) [<xref rid="pone.0233198.ref019" ref-type="bibr">19</xref>]. In the presence of these variabilities, simple false-coloring algorithms can fail unless software parameters are manually tweaked, often by trial-and-error.</p>
      </list-item>
      <list-item>
        <p>Finally, 3D slide-free digital pathology datasets are often hundreds of gigabytes to terabytes in size, which is 3 to 4 orders of magnitude larger than standard 2D whole slide images. To facilitate clinical translation, false-coloring algorithms must be able to process these large 3D datasets in an efficient and scalable manner.</p>
      </list-item>
    </list>
    <p>It bears mentioning that several deep-learning methods have been developed to render H&amp;E-like images from unstained tissue sections imaged with label-free imaging modalities such as brightfield and autofluorescence microscopy [<xref rid="pone.0233198.ref020" ref-type="bibr">20</xref>–<xref rid="pone.0233198.ref022" ref-type="bibr">22</xref>], multi-photon microscopy [<xref rid="pone.0233198.ref023" ref-type="bibr">23</xref>], and quantitative phase-contrast imaging [<xref rid="pone.0233198.ref024" ref-type="bibr">24</xref>]. Similar machine-learning-based approaches could be used to create H&amp;E-like images from tissues labeled with exogenous fluorophores (i.e. fluorescent analogs of H&amp;E). However, these methods not only require large amounts of training data but are also highly sensitive to pre-analytical variations such as staining protocols, imaging parameters, and hardware settings. In contrast, the ability to use an explainable physics-based approach for digital staining is likely attractive for many end users and regulatory agencies, allowing for easier error identification, debugging, and compatibility with different imaging platforms [<xref rid="pone.0233198.ref025" ref-type="bibr">25</xref>].</p>
    <p>In this manuscript we present FalseColor-Python, which enables rapid and robust digital staining of fluorescence images to mimic the appearance of chromogenic stains using the Beer-Lambert model. As a pre-processing step prior to false-coloring, an intensity-leveling routine, analogous to flat fielding, is used to locally and globally normalize image intensities, thereby mitigating the effects of both intra- and inter-sample variability. In particular, the code presented here is specifically optimized to generate H&amp;E-like images of tissues stained with a two-channel fluorescent analog of H&amp;E (i.e. a fluorescent nuclear stain that mimics hematoxylin, along with the stromal stain, eosin, which is naturally fluorescent) and imaged with 3D open-top light-sheet (OTLS) microscopy [<xref rid="pone.0233198.ref012" ref-type="bibr">12</xref>–<xref rid="pone.0233198.ref014" ref-type="bibr">14</xref>]. We show that FalseColor-Python enables accurate and reproducible H&amp;E false-coloring that qualitatively and quantitatively matches the appearance of H&amp;E whole slide images, but with less variability than is seen with standard histology. GPU acceleration is used for efficient and scalable processing of large 3D datasets.</p>
    <p>Note that while H&amp;E false-coloring is demonstrated here, FalseColor-Python can be tailored to accommodate other preferred fluorescent staining combinations and individual color preferences. For example, FalseColor-Python can be adapted to false-color fluorescence images to mimic other chromogens, such as DAB (used in standard immunohistochemistry [<xref rid="pone.0233198.ref013" ref-type="bibr">13</xref>]) or other special stains (e.g. PAS, Masson’s Trichrome, Toluidine Blue). In addition, while FalseColor-Python is optimized for large 3D datasets, it can easily be applied to 2D images as well.</p>
    <sec id="sec002">
      <title>FalseColor-Python workflow</title>
      <p><xref ref-type="fig" rid="pone.0233198.g001">Fig 1</xref> outlines the workflow for processing large two-channel 3D datasets using FalseColor-Python. For our specific implementation of this code, input data is stored on disk in the Hierarchical Data Format (HDF5), which is a common multi-resolution 3D image format (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1A</xref>). The advantage of multi-resolution file formats like HDF5, or similar formats such as N5, is that they contain multiple down-sampled versions of the imaging data. For our 3D microscopy data, we use a 16x down-sampled version of the data (low-resolution) to rapidly calculate an approximate global background level for each channel. The background level is calculated by first ignoring all pixels that are below a threshold value (i.e. black pixels), which we have defined as 4 standard deviations above the detector noise floor. The intensity of the 20<sup>th</sup> percentile of the remaining pixels is defined as the background value, which is due to a combination of tissue autofluorescence and nonspecific staining. We have found that for all of the 3D datasets we have examined, this 20% threshold is effective. However, for tissues that are very densely stained, in which there are few “background” pixels, this threshold may need to be adjusted. Once calculated, this background level is uniformly subtracted from the datasets, whether down-sampled as in <xref ref-type="fig" rid="pone.0233198.g001">Fig 1B</xref> or full-resolution as on the left side (numerator) of <xref ref-type="fig" rid="pone.0233198.g001">Fig 1F</xref>. Next, the down-sampled dataset is partitioned into uniformly sized data cubes. In our case, each data cubes corresponds to a 100 x 100 x 100 μm<sup>3</sup> volume of tissue (where 100 μm corresponds to 256 pixels in our raw datasets) (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1C</xref>). We use this partitioned data to create a low-resolution 3D “intensity-leveling map,” which will subsequently be used to remove global intensity fluctuations from the original dataset (see <xref ref-type="sec" rid="sec001">Introduction</xref>). The 3D intensity-leveling map is generated by calculating the median pixel value for every local data cube (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1D</xref>). Given the size of the full-resolution 3D image data, the subsequent steps are sequentially performed on individual 2D image planes (i.e. different depths) within the full-resolution 3D dataset. Each full-resolution 2D intensity-leveling map (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1E</xref>) is generated from the down-sampled 3D leveling map (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1D</xref>) through linear interpolation. By using linear interpolation, abrupt intensity differences between adjacent data cubes are smoothed out, preventing grid artifacts in the final leveling map. All of the full-resolution 2D intensity-leveling maps are scaled by an empirical weighting factor for each channel, <italic>α</italic>, which is held constant for the entire 3D dataset. This weighting factor is used to control the relative intensity of each fluorescence channel, which can be tuned by users to generate a desired appearance for the final false-colored RGB images (see below). Intensity leveling is achieved by taking a pixel-by-pixel ratio of each full-resolution image plane (background-subtracted) and its corresponding interpolated intensity-leveling map (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1F</xref>). The result is an image in which the median value of every local region (i.e. data cube) is approximately equal (due to the ratioing step), in which many of the large-scale (gradual) intensity irregularities are reduced (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1G</xref>). Finally, the leveled images from both fluorescence channels are passed into the Beer-Lambert false-coloring algorithm, which generates a color (RGB) image (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1H</xref>). The intensity-leveling and virtual H&amp;E routines are accelerated with a GPU using the CUDA framework from Python’s Numba library [<xref rid="pone.0233198.ref026" ref-type="bibr">26</xref>]. A diagram illustrating the full workflow is shown in the methods section.</p>
      <fig id="pone.0233198.g001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.g001</object-id>
        <label>Fig 1</label>
        <caption>
          <title>FalseColor-Python workflow for virtual H&amp;E rendering of a two-channel fluorescent analog of H&amp;E.</title>
          <p>The following operations are performed on both channels, but only one is shown for simplicity. <bold>(A)</bold> 3D data (<italic>I</italic>) is loaded from disk. <bold>(B)</bold> A down-sampled version of the dataset (16x down-sampled here) is extracted, and a background level is calculated for each channel, which is uniformly subtracted from both the down-sampled and full-resolution original datasets. <bold>(C)</bold> The down-sampled data is further subdivided into cubes. <bold>(D)</bold> A preliminary down-sampled 3D leveling map is generated by calculating the median pixel value for each data cube. <bold>(E)</bold> A full-resolution 2D leveling map at each depth, <italic>αM</italic>, is then generated by linear interpolation. Here, <italic>α</italic>, is an empirically determined constant for each channel, applied to the entire 3D dataset, which allows users to tune the appearance of the final false-colored RGB image. <bold>(F)</bold> To achieve intensity leveling, each 2D plane (i.e. different depth) from the full-resolution data, <italic>I</italic>, is divided by its corresponding leveling map, <italic>αM</italic>. This evens out coarse non-uniformities within the image. <bold>(G)</bold> The leveled images, <italic>I</italic><sub><italic>f</italic></sub> for both channels are input into the Beer-Lambert model to generate color (RGB) virtual H&amp;E images, <bold>(H)</bold>.</p>
        </caption>
        <graphic xlink:href="pone.0233198.g001"/>
      </fig>
      <p>Note that the size of the data cubes (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1C</xref>) that are used for generating an intensity-leveling map should be chosen based on the spatial scale of the intensity nonuniformities that one wishes to correct. For images that exhibit very gradual or minimal intensity variations, larger cube sizes can be used. Small cube sizes will remove finer-scale intensity fluctuations but may also remove fluctuations/contrast that are due to real tissue structure rather than staining artifacts.</p>
      <p>To demonstrate the utility of this method, a comparison of virtual H&amp;E staining with and without intensity-leveling is shown in <xref ref-type="fig" rid="pone.0233198.g002">Fig 2</xref>. Here a single plane from a 3D microscopy dataset of an optically cleared lung specimen is shown. The specimen was stained with a fluorescent nuclear stain TOPRO-3 Iodide (Cat: T3605, Thermo-Fisher) and was optically cleared with Ethyl-Cinnamate (Cat: 112372, Sigma-Aldrich) [<xref rid="pone.0233198.ref014" ref-type="bibr">14</xref>]. The cleared tissue volume was then imaged using OTLS microscopy [<xref rid="pone.0233198.ref027" ref-type="bibr">27</xref>]. The Beer-Lambert false-coloring algorithm was applied to a single grayscale image without intensity leveling (<xref ref-type="fig" rid="pone.0233198.g002">Fig 2A</xref>). In this example, the exterior of the tissue was stained more heavily than the interior. In <xref ref-type="fig" rid="pone.0233198.g002">Fig 2B</xref>, the intensity-leveling procedure was incorporated into the false-coloring routine, such that the false-colored nuclei appear much more uniform across the entire image.</p>
      <fig id="pone.0233198.g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.g002</object-id>
        <label>Fig 2</label>
        <caption>
          <title>False-coloring with and without intensity-leveling.</title>
          <p>Only one channel is shown for simplicity. <bold>(A)</bold> Images are shown of a thick tissue specimen that is labeled (nonuniformly) with a fluorescent nuclear stain (TO-PRO-3), optically cleared, and then imaged with 3D microscopy. The image is false colored to mimic hematoxylin without intensity-leveling applied. A line profile within the inset clearly shows that nuclei in the inner region of the tissue (yellow arrow) are dimmer than nuclei on the exterior (blue arrow). When false colored, the nuclei on the exterior appear much darker (bottom panel). <bold>(B)</bold> The same field of view is shown after intensity leveling is applied. Nuclei across the field of view exhibit similar intensities, and when false colored, are much more uniform in appearance. Scale bars: 100 μm.</p>
        </caption>
        <graphic xlink:href="pone.0233198.g002"/>
      </fig>
    </sec>
    <sec id="sec003">
      <title>Colorimetry to mimic standard histology</title>
      <p>For the clinical adoption of slide-free digital pathology, virtual H&amp;E algorithms must consistently render virtual H&amp;E images that qualitatively and quantitatively match the coloration of standard histology. To ensure that FalseColor-Python’s virtual H&amp;E algorithm mimics the color palettes of standard histology, we measured the color properties of 65 publicly available whole slide images (H&amp;E) of prostate adenocarcinoma from the Cancer Digital Slide Archive [<xref rid="pone.0233198.ref028" ref-type="bibr">28</xref>] (<xref ref-type="fig" rid="pone.0233198.g003">Fig 3A</xref>). 10 regions of interest (ROIs) were selected from each whole slide image at a magnification of 200x (20x objective), (<xref ref-type="fig" rid="pone.0233198.g003">Fig 3B</xref>). Hematoxylin and eosin stains were segmented from each region of interest using color deconvolution [<xref rid="pone.0233198.ref029" ref-type="bibr">29</xref>, <xref rid="pone.0233198.ref030" ref-type="bibr">30</xref>]. The color deconvolution algorithm generated a probability map for each dye, where pixel values represent the probability of that pixel belonging to one of the top-two color components of the image (i.e. hematoxylin or eosin), (<xref ref-type="fig" rid="pone.0233198.g003">Fig 3C &amp; 3D</xref>). These probability maps were used to create binary masks for each structure using Otsu’s thresholding method [<xref rid="pone.0233198.ref031" ref-type="bibr">31</xref>]. The binary masks yielded segmented images of the nuclei (hematoxylin stain) and stroma (eosin stain). This process was repeated for all ROIs and the median color properties of each stain were quantified and plotted based on the hue, saturation, value (HSV) color model (<xref ref-type="fig" rid="pone.0233198.g003">Fig 3E &amp; 3F</xref>). We used these measured HSV values as a target for our virtual H&amp;E images. In other words, in FalseColor-Python, we have adjusted the color parameters used in the Beer-Lambert false-coloring algorithm so that the median HSV color properties of the virtual H&amp;E images approximate that of standard whole slide images.</p>
      <fig id="pone.0233198.g003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.g003</object-id>
        <label>Fig 3</label>
        <caption>
          <title>Measuring the color properties of histology images.</title>
          <p><bold>(A)</bold> A whole slide image of prostate adenocarcinoma from the Cancer Digital Slide Archive, <italic>cancer</italic>.<italic>digitalslidearchive</italic>.<italic>org</italic>. Scale bar: 2 mm <bold>(B)</bold> Magnified inset of (A). Scale bar: 75 μm <bold>(C, D)</bold> Process to segment the hematoxylin and eosin components. Using color deconvolution, a probability map is generated for the top two components of each ROI from the whole slide image (right panel). A binary mask is created for each of the two components by applying Otsu’s thresholding to the probability map (middle panel). This yields a segmented image of the nuclei (hematoxylin stain) and cytoplasm (eosin stain) (left panel). Scale bar: 75 μm <bold>(E, F)</bold> After segmentation of all ROIs, the median values of hue, saturation, and value (HSV color model) are quantified and plotted for both the hematoxylin-stained and eosin-stained tissue components.</p>
        </caption>
        <graphic xlink:href="pone.0233198.g003"/>
      </fig>
      <p>For the clinical adoption of slide-free pathology, virtual H&amp;E images not only need to mimic the color palette of standard H&amp;E but must also be consistent and robust in the presence of variations between samples, for example due to differences in staining protocols or imaging parameters. By incorporating intensity-leveling, our virtual H&amp;E algorithm rendered images with similar appearance despite inter-sample intensity differences. As an example, fluorescent images of two prostate tissue samples are shown in <xref ref-type="fig" rid="pone.0233198.g004">Fig 4A</xref>, in which significant differences in fluorescence intensities are seen (when imaged with the same device and settings). The intensity levels for each fluorescence channel (TO-PRO-3 and eosin) are shown in the accompanying histograms. Despite these differences in intensity, the resulting virtual H&amp;E images of each sample are qualitatively and quantitatively similar. On the right-most column of <xref ref-type="fig" rid="pone.0233198.g004">Fig 4A</xref>, a histogram of the value (V) component of each virtual H&amp;E image is plotted and is comparable for both images after the intensity-leveled false-coloring routine is applied.</p>
      <fig id="pone.0233198.g004" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.g004</object-id>
        <label>Fig 4</label>
        <caption>
          <title>Inter-specimen consistency of virtual H&amp;E images.</title>
          <p><bold>(A)</bold> OTLS images of prostate tissue with different staining intensities. Despite significant differences in intensity between example I and II, the virtual H&amp;E images appear qualitatively and quantitatively similar. Histograms are shown of the fluorescence intensities within each image, and the value (V) component of the virtual H&amp;E images. <bold>(B)</bold> Distribution of median color properties for 650 standard H&amp;E and 2100 virtual H&amp;E images of prostate tissue. Whiskers on the box plots indicate the 10<sup>th</sup> and 90<sup>th</sup> percentiles for each distribution. The distributions for standard H&amp;E exhibit the high degree of color variation seen in conventional histology. The virtual H&amp;E images rendered with FalseColor-Python accurately mimic the coloration of standard H&amp;E with significantly less variation in color parameters than conventional H&amp;E. Standard deviations for each distribution are listed below each plot.</p>
        </caption>
        <graphic xlink:href="pone.0233198.g004"/>
      </fig>
      <p>To quantitatively compare the consistency of FalseColor-Python with standard H&amp;E histology, we measured the HSV color model parameters for 2100 virtual H&amp;E images from 14 samples of prostate tissue imaged with 3D OTLS microscopy and then processed with FalseColor-Python. To measure the color properties of the virtual H&amp;E images, we used the same color-deconvolution method that was used to measure the color properties of whole slide images from the Cancer Digital Slide Archive (described previously). It should be noted that while the color parameters were adjusted to allow our virtual H&amp;E images to match the color parameters of standard H&amp;E images, once these values were determined, all virtual H&amp;E images used in this analysis were processed in a fully automated fashion using the exact same parameters for intensity-leveling and coloration. Our results show that the color properties of virtual H&amp;E data processed with FalseColor-Python match the measured values of standard H&amp;E, as expected (<xref ref-type="fig" rid="pone.0233198.g004">Fig 4B</xref>). Furthermore, the color properties of virtual H&amp;E images processed with FalseColor-Python are much more consistent (less standard deviation) than the color properties of standard H&amp;E-stained whole slide images. <xref rid="pone.0233198.t001" ref-type="table">Table 1</xref> lists the median and standard deviation of each color property for both standard and virtual H&amp;E. Finally, an image atlas is shown in <xref ref-type="fig" rid="pone.0233198.g005">Fig 5</xref> to demonstrate that FalseColor-Python renders consistent virtual H&amp;E images across tissue types and to demonstrate that FalseColor-Python is easily adjusted to mimic other color spaces in standard histology (DAB staining).</p>
      <fig id="pone.0233198.g005" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.g005</object-id>
        <label>Fig 5</label>
        <caption>
          <title>False-coloring image atlas.</title>
          <p>Thick tissues were stained with a fluorescent analog of H&amp;E <bold>(A, B, D, E)</bold>, or an antibody targeting the high molecular weight keratin (HMWK), CK-8, along with the nuclear stain, TO-PRO-3 <bold>(C, F)</bold>. All tissues were optically cleared and imaged in 3D with an open-top light-sheet (OTLS) microscope. <bold>(A)</bold> Skin. <bold>(B)</bold> Kidney. <bold>(C)</bold> Prostate. <bold>(D)</bold> Basal layer of the epidermis. <bold>(E)</bold> Kidney tubules. <bold>(F)</bold> Prostate glands (carcinoma). Virtual H&amp;E images were processed with identical code parameters in a fully automated fashion. Virtual IHC images were processed with an identical code, but with coloring parameters changed to mimic the chromogen DAB (brown stain) and hematoxylin (blue stain). These codes and parameters are provided in our GitHub repository (see provided link). Scale bars: 500 μm for A-C, 50 μm for D-F.</p>
        </caption>
        <graphic xlink:href="pone.0233198.g005"/>
      </fig>
      <table-wrap id="pone.0233198.t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Measured median color properties of standard and virtual H&amp;E images in HSV color space.</title>
          <p>Standard H&amp;E properties are measured from 10 ROIs from each of 65 whole slide images (prostate). Virtual H&amp;E properties are measured from 2100 two-dimensional “optical sections” from 14 prostate specimens.</p>
        </caption>
        <alternatives>
          <graphic id="pone.0233198.t001g" xlink:href="pone.0233198.t001"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="center" rowspan="1" colspan="1"/>
                <th align="center" colspan="2" rowspan="1">
                  <italic>Hematoxylin</italic>
                </th>
                <th align="center" colspan="2" rowspan="1">
                  <italic>Eosin</italic>
                </th>
              </tr>
              <tr>
                <th align="right" rowspan="1" colspan="1"/>
                <th align="center" rowspan="1" colspan="1">
                  <italic>Standard</italic>
                </th>
                <th align="center" rowspan="1" colspan="1">
                  <italic>Virtual</italic>
                </th>
                <th align="center" rowspan="1" colspan="1">
                  <italic>Standard</italic>
                </th>
                <th align="center" rowspan="1" colspan="1">
                  <italic>Virtual</italic>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>Hue</italic>
                </td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>811 ± 0</italic>.<italic>043</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>808 ± 0</italic>.<italic>009</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>910 ± 0</italic>.<italic>023</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>901 ± 0</italic>.<italic>010</italic></td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>Saturation</italic>
                </td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>453 ± 0</italic>.<italic>095</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>457 ± 0</italic>.<italic>055</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>381 ± 0</italic>.<italic>119</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>310 ± 0</italic>.<italic>039</italic></td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>Value</italic>
                </td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>494 ± 0</italic>.<italic>111</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>502 ± 0</italic>.<italic>048</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>788 ± 0</italic>.<italic>087</italic></td>
                <td align="left" rowspan="1" colspan="1"><italic>0</italic>.<italic>811 ± 0</italic>.<italic>025</italic></td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec004">
    <title>Discussion</title>
    <p>We have developed FalseColor-Python, a rapid intensity-leveling and digital-staining package for converting grayscale fluorescence images into color images that mimic conventional chromogenic (absorption-based) stains. In particular, we demonstrate the rendering of virtual H&amp;E images from thick tissues stained with a fluorescent analog of H&amp;E and imaged in 3D. To improve the consistency of our false-coloring method in the presence of both inter-sample and intra-sample variations in staining/intensity, we have developed and incorporated a 3D intensity-leveling routine (Figs <xref ref-type="fig" rid="pone.0233198.g001">1</xref> &amp; <xref ref-type="fig" rid="pone.0233198.g002">2</xref>). We analyzed the color properties of standard H&amp;E images (<xref ref-type="fig" rid="pone.0233198.g003">Fig 3</xref>) and used this data to ensure that the virtual H&amp;E images rendered by FalseColor-Python are representative of standard histology. Our results show that the virtual H&amp;E images rendered by FalseColor-Python are qualitatively and quantitatively similar to standard H&amp;E histology regardless of variations in intensity, as for example due to differences in sample preparation, imaging device, and/or imaging parameters (<xref ref-type="fig" rid="pone.0233198.g004">Fig 4</xref>). In particular, we have shown that FalseColor-Python renders virtual H&amp;E images that not only quantitatively match the appearance of standard H&amp;E images, but with less variability in coloration than is seen with standard histology (<xref ref-type="fig" rid="pone.0233198.g004">Fig 4B</xref>).</p>
    <p>The ability to render quantitatively and qualitatively consistent virtual H&amp;E images is of critical importance for the adoption of fluorescence-based imaging methods in anatomic pathology. Staining non-uniformities and depth-dependent intensity variations are common data-quality issues in fluorescence imaging, particularly for nondestructive slide-free 3D imaging modalities. In developing this intensity-leveling technique, we have taken advantage of the multiple down-sampled versions of an imaging dataset that are stored in a multi-resolution image format such as HDF5 (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1A</xref>). However, down-sampling of imaging data is straightforward and intensity-leveling maps can be generated from any 3D imaging data. For our 3D microscopy data, optimal performance has been seen with data cubes of 100 x 100 x 100 μm<sup>3</sup> however, users can make adjustments as needed to best suit their data. This tunability is demonstrated in an example located on our GitHub repository. Finally, for certain images with intensity nonuniformities, enhanced performance is seen using an implementation of contrast-limited adaptive histogram equalization (CLAHE) as a pre-processing step before intensity-leveling is performed. This is included as an optional method within FalseColor-Python but was not used in the examples shown in this study. More specifically, CLAHE is included as an optional method for use in cases where intensity changes within the sample are large over small distances such that intensity leveling alone may be insufficient to yield qualitatively acceptable results. For example, thick tissues stained with large agents that have difficulty diffusing into tissue interiors may see improved results by applying CLAHE before false coloring to enhance relative signal strength between high- and low-signal regions. However, CLAHE should be used judiciously since it can also increase noise in the images.</p>
    <p>In terms of limitations, our intensity-leveling method is best suited for images where staining is present throughout the entirety of the sample, but where the spatial variations in that signal are gradual compared with the high-resolution features of interest (e.g. <xref ref-type="fig" rid="pone.0233198.g002">Fig 2</xref>) In cases in which large-scale (gradual) intensity variations are biologically real and informative to end users (e.g. pathologists), there is the possibility that our intensity-leveling methods will mask (i.e. flatten) such global-intensity variations. However, this could be mitigated by tuning the size of the data-partitioning cubes as outlined in <xref ref-type="fig" rid="pone.0233198.g001">Fig 1</xref>.</p>
    <p>A significant outcome of this study is that virtual H&amp;E images rendered by FalseColor-Python exhibit significantly less variability in color parameters than standard histology. This is not surprising considering the obvious differences in appearance seen in histology images generated by independent labs, and even within individual labs at different times. The measured median color-property values of our virtual H&amp;E images were all well within one standard deviation of the color properties of standard H&amp;E images.</p>
    <p>We recognize that the standard H&amp;E data used in this analysis represents a subset of all possible color presentations found in histology. Further, we acknowledge that there is a high degree of subjectivity and personal preference regarding the optimal coloration for standard H&amp;E images. Therefore, it is possible to tune the appearance of false-colored images if so desired. For simplicity, RGB color parameters, which are easily measured from any image, are included as arguments in FalseColor-Python’s Beer-Lambert false-coloring algorithm so that users can make adjustments as needed. The leveling constant, <italic>α</italic>, is used to control the relative intensity of each channel, which affects the appearance of the final virtual H&amp;E image. For our OTLS datasets, we found that <italic>α</italic> values of 1.5 and 3.7 were appropriate leveling constants for the hematoxylin and eosin channels, respectively. These particular values allowed the color properties of our virtual H&amp;E data to consistently match the measured values derived from standard H&amp;E images (<xref ref-type="fig" rid="pone.0233198.g003">Fig 3</xref>). Lower values of <italic>α</italic> result in a darker/stronger staining appearance. Further discussion of adjusting color settings is provided in an example on the online repository (see GitHub link at the end of this article).</p>
    <p>Note that all methods used for colorimetry analysis of standard and virtual H&amp;E images (e.g. <xref ref-type="fig" rid="pone.0233198.g003">Fig 3</xref>) are included in FalseColor-Python. As mentioned in the introduction, FalseColor-Python is easily adapted for other fluorescence-to-chromogenic staining transformations, for example to render images that mimic chromogenic immunohistochemistry (i.e. DAB stain) (<xref ref-type="fig" rid="pone.0233198.g005">Fig 5C</xref> &amp; 5F).</p>
    <p>FalseColor-Python contains several methods that use GPU acceleration. For example, CUDA-based implementations of the Beer-Lambert false-coloring algorithm are included in FalseColor-Python as well as several preprocessing steps such as intensity-leveling, image sharpening, and background subtraction. For users without access to GPU hardware, equivalent CPU-based processing methods are available as alternatives in FalseColor-Python. In a simple speed comparison, we measured the average time to process 200 two-channel 16-bit images (2048 x 2048 pixels each) with FalseColor-Python, using either GPU- or CPU-based Beer-Lambert false-coloring algorithms and preprocessing steps (i.e background subtraction, intensity-leveling). The GPU-based process was faster by over a factor of 6 (116 +/- 17 ms per image vs. 789 +/- 18 ms per image). There is room for further improvement by developing objects and methods within FalseColor-Python that can process large 3D datasets in parallel. For example, implementing multi-resolution file formats that allow for parallelized read operations (e.g. N5 instead of HDF5) will enable FalseColor-Python to process 3D datasets even more efficiently. Parallelized processing in FalseColor-Python is discussed in an example on the GitHub repository.</p>
    <p>In summary, FalseColor-Python renders virtual H&amp;E images that qualitatively and quantitatively match the coloration of standard H&amp;E images, as well as other chromogenic stains. A key component of FalseColor-Python is the incorporation of an intensity-leveling method that corrects for intensity non-uniformities commonly seen in 3D fluorescent datasets, both within one sample and between different samples (i.e. intra- and inter-specimen variability). The color settings in FalseColor-Python are customizable to suit user preferences, with interpretable parameters that facilitate error identification and troubleshooting. FalseColor-Python is equipped with GPU-accelerated methods that allow it to process large 3D datasets efficiently. Developers who are interested in contributing to FalseColor-Python should submit pull requests via the GitHub repository.</p>
  </sec>
  <sec id="sec005">
    <title>Detailed methods</title>
    <sec id="sec006">
      <title>OTLS imaging</title>
      <p>Tissue samples were stained with a fluorescent nuclear stain, TO-PRO-3 (Cat: T3605, Thermo-Fisher) at a 1:2000 dilution and eosin (Cat: 3801615, Leica Biosystems) at a 1:2000 dilution for 4 hours at room temperature with light shaking. Samples were optically cleared with ethyl-cinnamate (Cat: 112372, Sigma-Aldrich). Stained and cleared samples were imaged on a custom OTLS system [<xref rid="pone.0233198.ref014" ref-type="bibr">14</xref>]. A 660-nm laser was used to excite the nuclear dye, TO-PRO3, and a 561-nm laser was used to excite eosin. Each channel was imaged separately, in succession, with a 16-bit sCMOS camera. For more information on OTLS imaging see our previous publications [<xref rid="pone.0233198.ref012" ref-type="bibr">12</xref>–<xref rid="pone.0233198.ref014" ref-type="bibr">14</xref>].</p>
    </sec>
    <sec id="sec007">
      <title>Image processing</title>
      <p>Two channel OTLS datasets were stored on disk in the HDF5 format with metadata in an XML file structured for analysis using BigStitcher [<xref rid="pone.0233198.ref027" ref-type="bibr">27</xref>]. A custom compression filter (B3D) was used to provide 10x compression. The fine alignment of all OTLS data was performed in BigStitcher and fused to disk as a separate HDF5 file. Before virtual H&amp;E rendering (as described in the manuscript), an optional sharpening routine was used on each image to enhance edges. The full workflow is outlined in the diagram of <xref ref-type="fig" rid="pone.0233198.g006">Fig 6</xref>.</p>
      <fig id="pone.0233198.g006" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.g006</object-id>
        <label>Fig 6</label>
        <caption>
          <title>Diagrammatic flow.</title>
          <p>Processes occur for each channel consecutively. Operations that act on 3D image data are highlighted in green and 2D operations are highlighted in blue. Input arguments such as file path, image planes to process (identified with HDF5 z-index), and desired intensity-leveling constants are parsed for processing. Low-resolution data is read into memory and the initial intensity-leveling map is generated. Background levels are computed from the low-resolution data. Full-resolution images are read into memory for processing. Full-resolution data undergoes background subtraction and image sharpening as preprocessing steps. The full-sized intensity-leveling map is generated via linear interpolation. Intensity leveling is applied to each image. The intensity-leveled images undergo the Beer-Lambert false-coloring process, and the resulting RGB image is saved to disk. Writing to disk occurs in a separate thread for efficiency, indicated by the dashed box.</p>
        </caption>
        <graphic xlink:href="pone.0233198.g006"/>
      </fig>
      <p>Intensity-leveling maps (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1D</xref>) are generated by calculating the median intensity value within a specified 3D image volume (data cube). For an input image <italic>I</italic>, with specified background threshold <italic>b</italic>, the pixel value <italic>M</italic> for the intensity leveling map is given by:
<disp-formula id="pone.0233198.e001"><alternatives><graphic xlink:href="pone.0233198.e001.jpg" id="pone.0233198.e001g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M1"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="20pt"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="4pt"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>&gt;</mml:mo><mml:mi>b</mml:mi></mml:math></alternatives><label>(1)</label></disp-formula>
<disp-formula id="pone.0233198.e002"><alternatives><graphic xlink:href="pone.0233198.e002.jpg" id="pone.0233198.e002g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M2"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mspace width="20pt"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="4pt"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>&lt;</mml:mo><mml:mi>b</mml:mi></mml:math></alternatives><label>(2)</label></disp-formula></p>
      <p>Here <italic>i</italic>, <italic>j</italic>, <italic>k</italic> indicates the index. The pixel value of the intensity leveling map is set to the median value of the data cube above the background threshold, <xref ref-type="disp-formula" rid="pone.0233198.e001">Eq (1)</xref>. If the median value within the data cube falls below the background threshold, the level is set to a constant value, A, which is equal to the 95<sup>th</sup> percentile of <italic>I</italic> by default, <xref ref-type="disp-formula" rid="pone.0233198.e002">Eq (2)</xref>. This ensures that low-signal background regions appear black in the intensity-leveled image (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1G</xref>) and that they appear white in the false-colored (e.g. H&amp;E mimicking) RGB image (<xref ref-type="fig" rid="pone.0233198.g001">Fig 1H</xref>).</p>
      <p>Virtual H&amp;E rendering of two-channel fluorescence images was achieved using the Beer-Lambert false-coloring algorithm [<xref rid="pone.0233198.ref018" ref-type="bibr">18</xref>]. Grayscale intensities are converted into RGB images via:
<disp-formula id="pone.0233198.e003"><alternatives><graphic xlink:href="pone.0233198.e003.jpg" id="pone.0233198.e003g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M3"><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mo>,</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>H</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>H</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mo>·</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives><label>(3)</label></disp-formula>
where <italic>H</italic>, <italic>E</italic> are fluorescent images, <italic>M</italic><sub><italic>H</italic>,<italic>E</italic></sub> is the 2D image leveling map for each channel, <italic>α</italic> is the intensity-leveling constant for each channel, <italic>j</italic><sub><italic>n</italic></sub>, <italic>k</italic><sub><italic>n</italic></sub> are the color settings for hematoxylin and eosin respectively and n = R, G, B. Based on the colorimetry measurements described in the manuscript (<xref ref-type="fig" rid="pone.0233198.g003">Fig 3</xref>), we adjusted FalseColor-Python’s hematoxylin and eosin color parameters until the measured color properties of virtual H&amp;E images consistently matched those of standard H&amp;E. After this calibration no further adjustments were necessary. <xref rid="pone.0233198.t002" ref-type="table">Table 2</xref> lists the RGB color settings used for processing OTLS images. For leveling our OTLS images, <italic>α</italic><sub><italic>H</italic></sub> = 1.5 and <italic>α</italic><sub><italic>E</italic></sub> = 3.7 were chosen as scaling constants for the majority of our datasets.</p>
      <table-wrap id="pone.0233198.t002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0233198.t002</object-id>
        <label>Table 2</label>
        <caption>
          <title>Reference j<sub>n</sub>, k<sub>n</sub> values for virtual H&amp;E coloration in RGB space.</title>
        </caption>
        <alternatives>
          <graphic id="pone.0233198.t002g" xlink:href="pone.0233198.t002"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="center" rowspan="1" colspan="1"/>
                <th align="center" rowspan="1" colspan="1">
                  <italic>Hematoxylin</italic>
                </th>
                <th align="center" rowspan="1" colspan="1">
                  <italic>Eosin</italic>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>R</italic>
                </td>
                <td align="char" char="." rowspan="1" colspan="1">0.17</td>
                <td align="char" char="." rowspan="1" colspan="1">0.05</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>G</italic>
                </td>
                <td align="char" char="." rowspan="1" colspan="1">0.27</td>
                <td align="char" char="." rowspan="1" colspan="1">1.00</td>
              </tr>
              <tr>
                <td align="center" rowspan="1" colspan="1">
                  <italic>B</italic>
                </td>
                <td align="char" char="." rowspan="1" colspan="1">0.105</td>
                <td align="char" char="." rowspan="1" colspan="1">0.54</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>GPU acceleration for image processing was done using the cuda.jit decorator from the Numba library [<xref rid="pone.0233198.ref026" ref-type="bibr">26</xref>]. Implementation of GPU acceleration is done in such a way that the user needs no experience with the CUDA framework to accelerate their code (see examples on the GitHub repository). To achieve GPU acceleration, users only require a virtual environment equipped with the Anaconda’s cudatoolkit [<xref rid="pone.0233198.ref032" ref-type="bibr">32</xref>] and a CUDA capable GPU. GPU processing was done with a Nvidia Quadro P4000. A script containing the workflow as described in <xref ref-type="fig" rid="pone.0233198.g001">Fig 1</xref> can be found on the GitHub repository.</p>
    </sec>
    <sec id="sec008">
      <title>Histology data collection</title>
      <p>To quantify the HSV color space of traditional histopathology, 65 whole slide images of prostate adenocarcinoma biopsies from the Cancer Genome Atlas, <italic>cancer</italic>.<italic>digitalslidearchive</italic>.<italic>org</italic> [<xref rid="pone.0233198.ref028" ref-type="bibr">28</xref>] were examined, 10 equally sized fields of view from each whole slide image were taken at 20x magnification.</p>
    </sec>
    <sec id="sec009">
      <title>Color-Space quantification</title>
      <p>To accurately analyze the color space of histology and OTLS images, the hematoxylin and eosin channels were separated from one another via a binary mask generated by color deconvolution from the <italic>scikit-image</italic>.<italic>color</italic> python package [<xref rid="pone.0233198.ref030" ref-type="bibr">30</xref>]. This color deconvolution-based segmentation was used for both standard and virtual H&amp;E images. A binary mask was generated for each structure by first applying a median filter to the result of the color deconvolution, and then applying Otsu’s thresholding method [<xref rid="pone.0233198.ref031" ref-type="bibr">31</xref>]. Small objects were removed from the initial mask using an area threshold. A binary opening with a structuring element of a disk, r = 3, was applied to the resulting image. The input RGB image was converted to HSV space and then each mask was applied to generate the final segmented image for each structure. This process was repeated across 650 regions of interest taken from publicly available prostate adenocarcinoma whole slide images and 2100 OTLS virtual H&amp;E images from 14 prostate samples. Once each structure was segmented, the median value for each color property (HSV) was recorded from each segmented image. Zero valued areas, which resulted from the application of the binary mask, were ignored.</p>
    </sec>
    <sec id="sec010">
      <title>Code availability</title>
      <p>The full FalseColor-python code, example data, and colorimetry analysis methods, are publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/serrob23/falsecolor">https://github.com/serrob23/falsecolor</ext-link>. The repository includes instructions for installation and annotated examples.</p>
    </sec>
    <sec id="sec011">
      <title>Programming language</title>
      <p>Python 3.6+ is used in FalseColor-Python. Some features may be unavailable on older versions. A full list of dependencies and requirements is available on GitHub.</p>
    </sec>
  </sec>
</body>
<back>
  <ack>
    <p>The authors would like to thank Drs. Suzanne Dintzis, Nicholas P. Reder, and Lawrence D. True for assistance regarding histology coloration as well as Lindsey Barner and Kevin Bishop for helpful technical discussions.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0233198.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Longo</surname><given-names>C</given-names></name>, <name><surname>Ragazzi</surname><given-names>M</given-names></name>, <name><surname>Rajadhyaksha</surname><given-names>M</given-names></name>, <name><surname>Nehal</surname><given-names>K</given-names></name>, <name><surname>Bennassar</surname><given-names>A</given-names></name>, <name><surname>Pellacani</surname><given-names>G</given-names></name>, <etal>et al</etal><article-title>In Vivo and Ex Vivo Confocal Microscopy for Dermatologic and Mohs Surgeons</article-title>. <source>Dermatol Clin</source>. <year>2016</year>;<volume>34</volume>(<issue>4</issue>):<fpage>497</fpage>–<lpage>504</lpage>. <pub-id pub-id-type="doi">10.1016/j.det.2016.05.012</pub-id><?supplied-pmid 27692455?><pub-id pub-id-type="pmid">27692455</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>van Royen</surname><given-names>ME</given-names></name>, <name><surname>Verhoef</surname><given-names>EI</given-names></name>, <name><surname>Kweldam</surname><given-names>CF</given-names></name>, <name><surname>van Cappellen</surname><given-names>WA</given-names></name>, <name><surname>Kremers</surname><given-names>GJ</given-names></name>, <name><surname>Houtsmuller</surname><given-names>AB</given-names></name>, <etal>et al</etal><article-title>Three dimensional microscopic analysis of clinical prostate specimens</article-title>. <source>Histopathology</source>. <year>2016</year>;<volume>69</volume>(<issue>6</issue>):<fpage>985</fpage>–<lpage>92</lpage>. <pub-id pub-id-type="doi">10.1111/his.13022</pub-id><?supplied-pmid 27353346?><pub-id pub-id-type="pmid">27353346</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Cahill</surname><given-names>LC</given-names></name>, <name><surname>Fujimoto</surname><given-names>JG</given-names></name>, <name><surname>Giacomelli</surname><given-names>MG</given-names></name>, <name><surname>Yoshitake</surname><given-names>T</given-names></name>, <name><surname>Wu</surname><given-names>Y</given-names></name>, <name><surname>Lin</surname><given-names>DI</given-names></name>, <etal>et al</etal><article-title>Comparing histologic evaluation of prostate tissue using nonlinear microscopy and paraffin H&amp;E: a pilot study</article-title>. <source>Mod Pathol</source>. <year>2019</year><month>7</month><day>1</day>;<volume>32</volume>(<issue>8</issue>):<fpage>1158</fpage>–<lpage>67</lpage>. <pub-id pub-id-type="doi">10.1038/s41379-019-0250-8</pub-id><?supplied-pmid 30914763?><pub-id pub-id-type="pmid">30914763</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Tao</surname><given-names>YK</given-names></name>, <name><surname>Shen</surname><given-names>D</given-names></name>, <name><surname>Sheikine</surname><given-names>Y</given-names></name>, <name><surname>Ahsen</surname><given-names>OO</given-names></name>, <name><surname>Wang</surname><given-names>HH</given-names></name>, <name><surname>Schmolze</surname><given-names>DB</given-names></name>, <etal>et al</etal><article-title>Assessment of breast pathologies using nonlinear microscopy</article-title>. <source>Proc Natl Acad Sci U S A</source>. <year>2014</year>;<volume>111</volume>(<issue>43</issue>):<fpage>15304</fpage>–<lpage>9</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1416955111</pub-id><?supplied-pmid 25313045?><pub-id pub-id-type="pmid">25313045</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Sun</surname><given-names>CK</given-names></name>, <name><surname>Kao</surname><given-names>CT</given-names></name>, <name><surname>Wei</surname><given-names>ML</given-names></name>, <name><surname>Chia</surname><given-names>SH</given-names></name>, <name><surname>Kärtner</surname><given-names>FX</given-names></name>, <name><surname>Ivanov</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>Slide-free imaging of hematoxylin-eosin stained whole-mount tissues using combined third-harmonic generation and three-photon fluorescence microscopy</article-title>. <source>J Biophotonics</source>. <year>2019</year>;(<issue>September 2018</issue>):<fpage>1</fpage>–<lpage>21</lpage>. <pub-id pub-id-type="doi">10.1002/jbio.201800341</pub-id><?supplied-pmid 30636033?><pub-id pub-id-type="pmid">30636033</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>You</surname><given-names>S</given-names></name>, <name><surname>Tu</surname><given-names>H</given-names></name>, <name><surname>Chaney</surname><given-names>EJ</given-names></name>, <name><surname>Sun</surname><given-names>Y</given-names></name>, <name><surname>Zhao</surname><given-names>Y</given-names></name>, <name><surname>Bower</surname><given-names>AJ</given-names></name>, <etal>et al</etal><article-title>Intravital imaging by simultaneous label-free autofluorescence-multiharmonic microscopy</article-title>. <source>Nat Commun</source> [Internet]. <year>2018</year>;<volume>9</volume>(<issue>1</issue>). Available from: <pub-id pub-id-type="doi">10.1038/s41467-018-04470-8</pub-id>
<?supplied-pmid 29844371?><pub-id pub-id-type="pmid">29844371</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Fereidouni</surname><given-names>F</given-names></name>, <name><surname>Harmany</surname><given-names>ZT</given-names></name>, <name><surname>Tian</surname><given-names>M</given-names></name>, <name><surname>Todd</surname><given-names>A</given-names></name>, <name><surname>Kintner</surname><given-names>JA</given-names></name>, <name><surname>McPherson</surname><given-names>JD</given-names></name>, <etal>et al</etal><article-title>Microscopy with ultraviolet surface excitation for rapid slide-free histology</article-title>. <source>Nat Biomed Eng</source>. <year>2017</year><month>12</month><day>1</day>;<volume>1</volume>(<issue>12</issue>):<fpage>957</fpage>–<lpage>66</lpage>. <pub-id pub-id-type="doi">10.1038/s41551-017-0165-y</pub-id><?supplied-pmid 31015706?><pub-id pub-id-type="pmid">31015706</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Xie</surname><given-names>Weisi</given-names></name>, <name><surname>Chen</surname><given-names>Ye</given-names></name>, <name><surname>Wang</surname><given-names>Yu</given-names></name>, <name><surname>Wei</surname><given-names>Linpeng</given-names></name>, <name><surname>Yin</surname><given-names>Chengbo</given-names></name>, <name><surname>Glaser</surname><given-names>Adam K.</given-names></name>, <etal>et al</etal>, “<article-title>Microscopy with ultraviolet surface excitation for wide-area pathology of breast surgical margins</article-title>,” <source>J. Biomed. Opt</source>. <volume>24</volume>(<issue>2</issue>), <fpage>026501</fpage> (<year>2019</year>), <pub-id pub-id-type="doi">10.1117/1.JBO.24.2.026501</pub-id>
<?supplied-pmid 30737911?><pub-id pub-id-type="pmid">30737911</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Yoshitake</surname><given-names>T</given-names></name>, <name><surname>Giacomelli</surname><given-names>MG</given-names></name>, <name><surname>Quintana</surname><given-names>LM</given-names></name>, <name><surname>Vardeh</surname><given-names>H</given-names></name>, <name><surname>Cahill</surname><given-names>LC</given-names></name>, <name><surname>Faulkner-Jones</surname><given-names>BE</given-names></name>, <etal>et al</etal><article-title>Rapid histopathological imaging of skin and breast cancer surgical specimens using immersion microscopy with ultraviolet surface excitation</article-title>. <source>Sci Rep</source> [Internet]. <year>2018</year>;<volume>8</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>12</lpage>. Available from: <pub-id pub-id-type="doi">10.1038/s41598-018-22264-2</pub-id>
<?supplied-pmid 29311619?><pub-id pub-id-type="pmid">29311619</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Wang</surname><given-names>M</given-names></name>, <name><surname>Tulman</surname><given-names>DB</given-names></name>, <name><surname>Sholl</surname><given-names>AB</given-names></name>, <name><surname>Kimbrell</surname><given-names>HZ</given-names></name>, <name><surname>Mandava</surname><given-names>SH</given-names></name>, <name><surname>Elfer</surname><given-names>KN</given-names></name>, <etal>et al</etal><article-title>Gigapixel surface imaging of radical prostatectomy specimens for comprehensive detection of cancer-positive surgical margins using structured illumination microscopy</article-title>. <source>Sci Rep</source> [Internet]. <year>2016</year>;<volume>6</volume>(<issue>May</issue>):<fpage>1</fpage>–<lpage>16</lpage>. Available from: <pub-id pub-id-type="doi">10.1038/srep27419</pub-id>
<?supplied-pmid 27257084?><pub-id pub-id-type="pmid">28442746</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Wang</surname><given-names>M</given-names></name>, <name><surname>Kimbrell</surname><given-names>HZ</given-names></name>, <name><surname>Sholl</surname><given-names>AB</given-names></name>, <name><surname>Tulman</surname><given-names>DB</given-names></name>, <name><surname>Elfer</surname><given-names>KN</given-names></name>, <name><surname>Schlichenmeyer</surname><given-names>TC</given-names></name>, <etal>et al</etal><article-title>High-resolution rapid diagnostic imaging of whole prostate biopsies using video-rate fluorescence structured illumination microscopy</article-title>. <source>Cancer Res</source>. <year>2015</year>;<volume>75</volume>(<issue>19</issue>):<fpage>4032</fpage>–<lpage>41</lpage>. <pub-id pub-id-type="doi">10.1158/0008-5472.CAN-14-3806</pub-id><?supplied-pmid 26282168?><pub-id pub-id-type="pmid">26282168</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Glaser</surname><given-names>AK</given-names></name>, <name><surname>Reder</surname><given-names>NP</given-names></name>, <name><surname>Chen</surname><given-names>Y</given-names></name>, <name><surname>Mccarty</surname><given-names>EF</given-names></name>, <name><surname>Yin</surname><given-names>C</given-names></name>, <name><surname>Wei</surname><given-names>L</given-names></name>, <etal>et al</etal><article-title>Light-sheet microscopy for slide-free non-destructive pathology of large clinical specimens</article-title>. <source>Nat Biomed Eng</source>. <year>2018</year>;<volume>1</volume>(<issue>7</issue>):<fpage>1</fpage>–<lpage>22</lpage>. <pub-id pub-id-type="doi">10.1038/s41551-017-0084</pub-id><?supplied-pmid 29750130?><pub-id pub-id-type="pmid">29750130</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Reder</surname><given-names>NP</given-names></name>, <name><surname>Glaser</surname><given-names>AK</given-names></name>, <name><surname>McCarty</surname><given-names>EF</given-names></name>, <name><surname>Chen</surname><given-names>Y</given-names></name>, <name><surname>True</surname><given-names>LD</given-names></name>, <name><surname>Liu</surname><given-names>JTC</given-names></name>. <article-title>Open-Top Light-Sheet Microscopy Image Atlas of Prostate Core Needle Biopsies</article-title>. <source>Arch Pathol Lab Med</source>. <year>2019</year>;<volume>143</volume>(<issue>9</issue>):<fpage>1069</fpage>–<lpage>75</lpage>. <pub-id pub-id-type="doi">10.5858/arpa.2018-0466-OA</pub-id><?supplied-pmid 30892067?><pub-id pub-id-type="pmid">30892067</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Glaser</surname><given-names>AK</given-names></name>, <name><surname>Reder</surname><given-names>NP</given-names></name>, <name><surname>Chen</surname><given-names>Y</given-names></name>, <name><surname>Yin</surname><given-names>C</given-names></name>, <name><surname>Wei</surname><given-names>L</given-names></name>, <name><surname>Kang</surname><given-names>S</given-names></name>, <etal>et al</etal><article-title>Multi-immersion open-top light-sheet microscope for high-throughput imaging of cleared tissues</article-title>. <source>Nat Commun</source> [Internet]. <year>2019</year>;<volume>10</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>8</lpage>. Available from: <pub-id pub-id-type="doi">10.1038/s41467-019-10534-0</pub-id>
<?supplied-pmid 30602773?><pub-id pub-id-type="pmid">30602773</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Rocha</surname><given-names>MD</given-names></name>, <name><surname>Düring</surname><given-names>DN</given-names></name>, <name><surname>Bethge</surname><given-names>P</given-names></name>, <name><surname>Voigt</surname><given-names>FF</given-names></name>, <name><surname>Hildebrand</surname><given-names>S</given-names></name>, <name><surname>Helmchen</surname><given-names>F</given-names></name>, <etal>et al</etal><article-title>Tissue clearing and light sheet microscopy: Imaging the unsectioned adult zebra finch brain at cellular resolution</article-title>. <source>Front Neuroanat</source>. <year>2019</year>;<volume>13</volume>(<issue>February</issue>):<fpage>1</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">30760983</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Gareau</surname><given-names>DS</given-names></name>, <name><surname>Li</surname><given-names>Y</given-names></name>, <name><surname>Huang</surname><given-names>B</given-names></name>, <name><surname>Eastman</surname><given-names>Z</given-names></name>, <name><surname>Nehal</surname><given-names>KS</given-names></name>, <name><surname>Rajadhyaksha</surname><given-names>M</given-names></name>. <article-title>Confocal mosaicing microscopy in Mohs skin excisions: feasibility of rapid surgical pathology</article-title>. <source>J Biomed Opt</source>. <year>2008</year>;<volume>13</volume>(<issue>5</issue>):<fpage>054001</fpage><pub-id pub-id-type="doi">10.1117/1.2981828</pub-id><?supplied-pmid 19021381?><pub-id pub-id-type="pmid">19021381</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Bini</surname><given-names>J</given-names></name>, <name><surname>Spain</surname><given-names>J</given-names></name>, <name><surname>Nehal</surname><given-names>K</given-names></name>, <name><surname>Hazelwood</surname><given-names>V</given-names></name>, <name><surname>DiMarzio</surname><given-names>C</given-names></name>, <name><surname>Rajadhyaksha</surname><given-names>M</given-names></name>. <article-title>Confocal mosaicing microscopy of human skin ex vivo: spectral analysis for digital staining to simulate histology-like appearance</article-title>. <source>J Biomed Opt</source>. <year>2011</year>;<volume>16</volume>(<issue>7</issue>):<fpage>076008</fpage><pub-id pub-id-type="doi">10.1117/1.3596742</pub-id><?supplied-pmid 21806269?><pub-id pub-id-type="pmid">21806269</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref018">
      <label>18</label>
      <mixed-citation publication-type="journal"><name><surname>Giacomelli</surname><given-names>MG</given-names></name>, <name><surname>Husvogt</surname><given-names>L</given-names></name>, <name><surname>Vardeh</surname><given-names>H</given-names></name>, <name><surname>Faulkner-Jones</surname><given-names>BE</given-names></name>, <name><surname>Hornegger</surname><given-names>J</given-names></name>, <name><surname>Connolly</surname><given-names>JL</given-names></name>, <etal>et al</etal><article-title>Virtual hematoxylin and eosin transillumination microscopy using epi-fluorescence imaging</article-title>. <source>PLoS One</source>. <year>2016</year>; <pub-id pub-id-type="doi">10.1371/journal.pone.0159337</pub-id><?supplied-pmid 27500636?><pub-id pub-id-type="pmid">27500636</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref019">
      <label>19</label>
      <mixed-citation publication-type="other">Macenko M, Niethammer M, Marron JS, Borland D, Woosley JT, Guan X, et al. A method for normalizing histology slides for quantitative analysis. Proc—2009 IEEE Int Symp Biomed Imaging From Nano to Macro, ISBI 2009. 2009;1107–10.</mixed-citation>
    </ref>
    <ref id="pone.0233198.ref020">
      <label>20</label>
      <mixed-citation publication-type="other">Rana A, Yauney G, Lowe A, Shah P. Computational Histological Staining and Destaining of Prostate Core Biopsy RGB Images with Generative Adversarial Neural Networks. Proc—17th IEEE Int Conf Mach Learn Appl ICMLA 2018. 2019;828–34.</mixed-citation>
    </ref>
    <ref id="pone.0233198.ref021">
      <label>21</label>
      <mixed-citation publication-type="journal"><name><surname>Rivenson</surname><given-names>Y</given-names></name>, <name><surname>Wang</surname><given-names>H</given-names></name>, <name><surname>Wei</surname><given-names>Z</given-names></name>, <name><surname>De Haan</surname><given-names>K</given-names></name>, <name><surname>Zhang</surname><given-names>Y</given-names></name>, <name><surname>Wu</surname><given-names>Y</given-names></name>, <etal>et al</etal><article-title>Virtual histological staining of unlabelled tissue-autofluorescence images via deep learning</article-title>. <source>Nat Biomed Eng</source> [Internet]. <year>2019</year>;<volume>3</volume>(<issue>June</issue>). Available from: <pub-id pub-id-type="doi">10.1038/s41551-019-0362-y</pub-id>
<?supplied-pmid 31142829?><pub-id pub-id-type="pmid">31142829</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref022">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Rizwan</surname><given-names>A</given-names></name>, <name><surname>Bulte</surname><given-names>C</given-names></name>, <name><surname>Kalaichelvan</surname><given-names>A</given-names></name>, <name><surname>Cheng</surname><given-names>M</given-names></name>, <name><surname>Krishnamachary</surname><given-names>B</given-names></name>, <name><surname>Bhujwalla</surname><given-names>ZM</given-names></name>, <etal>et al</etal><article-title>Metastatic breast cancer cells in lymph nodes increase nodal collagen density</article-title>. <source>Sci Rep</source>. <year>2015</year><month>5</month><day>7</day>;<volume>5</volume><pub-id pub-id-type="doi">10.1038/srep10002</pub-id><?supplied-pmid 25950608?><pub-id pub-id-type="pmid">25950608</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Borhani</surname><given-names>N</given-names></name>, <name><surname>Bower</surname><given-names>AJ</given-names></name>, <name><surname>Boppart</surname><given-names>SA</given-names></name>, <name><surname>Psaltis</surname><given-names>D</given-names></name>. <article-title>Digital staining through the application of deep neural networks to multi-modal multi-photon microscopy</article-title>. <source>Biomed Opt Express</source>. <year>2019</year>;<volume>10</volume>(<issue>3</issue>):<fpage>1339</fpage><pub-id pub-id-type="doi">10.1364/BOE.10.001339</pub-id><?supplied-pmid 30891350?><pub-id pub-id-type="pmid">30891350</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref024">
      <label>24</label>
      <mixed-citation publication-type="journal"><name><surname>Rivenson</surname><given-names>Y</given-names></name>, <name><surname>Liu</surname><given-names>T</given-names></name>, <name><surname>Wei</surname><given-names>Z</given-names></name>, <name><surname>Zhang</surname><given-names>Y</given-names></name>, <name><surname>de Haan</surname><given-names>K</given-names></name>, <name><surname>Ozcan</surname><given-names>A</given-names></name>. <article-title>PhaseStain: the digital staining of label-free quantitative phase microscopy images using deep learning</article-title>. <source>Light Sci Appl</source> [Internet]. <year>2019</year>;<volume>8</volume>(<issue>1</issue>). Available from: <pub-id pub-id-type="doi">10.1038/s41377-019-0129-y</pub-id>
<?supplied-pmid 30728961?><pub-id pub-id-type="pmid">30728961</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Rudin</surname><given-names>C</given-names></name>. <article-title>Stop explaining black box machine learning models for high stakes decisions and use interpretable models instead</article-title>. <source>Nat Mach Intell</source> [Internet]. <year>2019</year>;<volume>1</volume>(<issue>5</issue>):<fpage>206</fpage>–<lpage>15</lpage>. Available from: <pub-id pub-id-type="doi">10.1038/s42256-019-0048-x</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref026">
      <label>26</label>
      <mixed-citation publication-type="other">Lam SK, Pitrou A, Seibert S. Numba: A LLVM-based python JIT compiler. Proc Second Work LLVM Compil Infrastruct HPC—LLVM ‘15. 2015;1–6.</mixed-citation>
    </ref>
    <ref id="pone.0233198.ref027">
      <label>27</label>
      <mixed-citation publication-type="journal"><name><surname>Hörl</surname><given-names>D</given-names></name>, <name><surname>Rojas Rusak</surname><given-names>F</given-names></name>, <name><surname>Preusser</surname><given-names>F</given-names></name>, <name><surname>Tillberg</surname><given-names>P</given-names></name>, <name><surname>Randel</surname><given-names>N</given-names></name>, <name><surname>Chhetri</surname><given-names>RK</given-names></name>, <etal>et al</etal><article-title>BigStitcher: reconstructing high-resolution image datasets of cleared and expanded samples</article-title>. <source>Nat Methods</source>. <year>2019</year>;<volume>16</volume>(<issue>9</issue>):<fpage>870</fpage>–<lpage>4</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0501-0</pub-id><?supplied-pmid 31384047?><pub-id pub-id-type="pmid">31384047</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref028">
      <label>28</label>
      <mixed-citation publication-type="journal"><name><surname>Gutman</surname><given-names>DA</given-names></name>, <name><surname>Khalilia</surname><given-names>M</given-names></name>, <name><surname>Lee</surname><given-names>S</given-names></name>, <name><surname>Nalisnik</surname><given-names>M</given-names></name>, <name><surname>Mullen</surname><given-names>Z</given-names></name>, <name><surname>Beezley</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>The digital slide archive: A software platform for management, integration, and analysis of histology for cancer research</article-title>. <source>Cancer Res</source>. <year>2017</year>;<volume>77</volume>(<issue>21</issue>):<fpage>e75</fpage>–<lpage>8</lpage>. <pub-id pub-id-type="doi">10.1158/0008-5472.CAN-17-0629</pub-id><?supplied-pmid 29092945?><pub-id pub-id-type="pmid">29092945</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref029">
      <label>29</label>
      <mixed-citation publication-type="journal"><name><surname>Ruifrok</surname><given-names>A. C.</given-names></name> &amp; <name><surname>Johnston</surname><given-names>D. A.</given-names></name>
<article-title>Quantification of histochemical staining by color deconvolution</article-title>. <source>Anal. Quant. Cytol. Histol</source>. <volume>23</volume>, <fpage>291</fpage>–<lpage>299</lpage> (<year>2001</year>). <?supplied-pmid 11531144?><pub-id pub-id-type="pmid">11531144</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0233198.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Van Der Walt</surname><given-names>S</given-names></name>, <name><surname>Schönberger</surname><given-names>JL</given-names></name>, <name><surname>Nunez-Iglesias</surname><given-names>J</given-names></name>, <name><surname>Boulogne</surname><given-names>F</given-names></name>, <name><surname>Warner</surname><given-names>JD</given-names></name>, <name><surname>Yager</surname><given-names>N</given-names></name>, <etal>et al</etal><article-title>Scikit-image: Image processing in python</article-title>. <source>PeerJ</source>. <year>2014</year>;<volume>2014</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>18</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0233198.ref031">
      <label>31</label>
      <mixed-citation publication-type="other">Otsu N. THRESHOLD SELECTION METHOD FROM GRAY-LEVEL HISTOGRAMS. IEEE Trans Syst Man Cybern. 1979;</mixed-citation>
    </ref>
    <ref id="pone.0233198.ref032">
      <label>32</label>
      <mixed-citation publication-type="other">Anaconda Software Distribution. cudatoolkit version: 10.2.89 anaconda.org/anaconda/cudatoolkit</mixed-citation>
    </ref>
  </ref-list>
</back>
