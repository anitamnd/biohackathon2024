<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d1 20130915//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4824128</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btv730</article-id>
    <article-id pub-id-type="publisher-id">btv730</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="heading">
          <subject>Systems Biology</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BioFVM: an efficient, parallelized diffusive transport solver for 3-D biological simulations</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ghaffarizadeh</surname>
          <given-names>Ahmadreza</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Friedman</surname>
          <given-names>Samuel H.</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Macklin</surname>
          <given-names>Paul</given-names>
        </name>
        <xref ref-type="corresp" rid="btv730-cor1">*</xref>
      </contrib>
      <aff id="btv730-aff1">Center for Applied Molecular Medicine, University of Southern California, Los Angeles, CA 90033, USA</aff>
    </contrib-group>
    <author-notes>
      <corresp>
        <addr-line>
          <named-content content-type="sensitive-text">
            <email>paul.macklin@usc.edu</email>
            <email>paul.macklin@usc.edu</email>
          </named-content>
        </addr-line>
      </corresp>
      <corresp id="btv730-cor1">*To whom correspondence should be addressed.</corresp>
      <fn id="btv730-FN1">
        <p>Associate Editor: Alfonso Valencia</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>4</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>12</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>12</month>
      <year>2015</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>32</volume>
    <issue>8</issue>
    <fpage>1256</fpage>
    <lpage>1258</lpage>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>10</month>
        <year>2015</year>
      </date>
      <date date-type="rev-recd">
        <day>03</day>
        <month>12</month>
        <year>2015</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>12</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2015. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2016</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by-nc/4.0/" license-type="creative-commons">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> Computational models of multicellular systems require solving systems of PDEs for release, uptake, decay and diffusion of multiple substrates in 3D, particularly when incorporating the impact of drugs, growth substrates and signaling factors on cell receptors and subcellular systems biology.</p>
      <p><bold>Results:</bold> We introduce BioFVM, a diffusive transport solver tailored to biological problems. BioFVM can simulate release and uptake of many substrates by cell and bulk sources, diffusion and decay in large 3D domains. It has been parallelized with OpenMP, allowing efficient simulations on desktop workstations or single supercomputer nodes. The code is stable even for large time steps, with linear computational cost scalings. Solutions are first-order accurate in time and second-order accurate in space. The code can be run by itself or as part of a larger simulator.</p>
      <p><bold>Availability and implementation:</bold> BioFVM is written in C ++ with parallelization in OpenMP. It is maintained and available for download at <ext-link ext-link-type="uri" xlink:href="http://BioFVM.MathCancer.org">http://BioFVM.MathCancer.org</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://BioFVM.sf.net">http://BioFVM.sf.net</ext-link> under the Apache License (v2.0).</p>
      <p><bold>Contact:</bold><email>paul.macklin@usc.edu</email>.</p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv730/-/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Mathematical modeling of many biological systems requires solving for secretion, diffusion, uptake and decay of multiple substrates in three dimensions. Cells change phenotype (division rate, metabolism, secretions, etc.) in response to their microenvironment; the spatial distribution of cells (and their uptake and secretion of substrates) alters the substrates’ distribution, affecting later cell behavior (<xref rid="btv730-B2" ref-type="bibr">Lowengrub <italic>et al.</italic>, 2010</xref>). BioFVM solves PDEs driven by such problems, of the form
<disp-formula id="E1"><mml:math id="MM1"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mover><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:msup><mml:mo>∇</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:mrow><mml:mo>︷</mml:mo></mml:mover></mml:mrow><mml:mtext>diffusion</mml:mtext></mml:mover><mml:mo>−</mml:mo><mml:mover><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="true">︷</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext>decay</mml:mtext></mml:mrow></mml:mover><mml:mo>+</mml:mo><mml:mover><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mover accent="true"><mml:mi>S</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo>*</mml:mo></mml:msup><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="true">︷</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext>bulk</mml:mtext><mml:mo> </mml:mo><mml:mtext>source</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mover><mml:mo>−</mml:mo><mml:mover><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="true">︷</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext>bulk</mml:mtext><mml:mo> </mml:mo><mml:mtext>uptake</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mover></mml:mrow></mml:math></disp-formula>
<disp-formula id="E2"><mml:math id="MM2"><mml:mrow><mml:mo>+</mml:mo><mml:mover><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mtext>cells</mml:mtext><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>S</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">︷</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext>sources</mml:mtext><mml:mo> </mml:mo><mml:mtext>and</mml:mtext><mml:mo> </mml:mo><mml:mtext>uptake</mml:mtext><mml:mo> </mml:mo><mml:mtext>by</mml:mtext><mml:mo> </mml:mo><mml:mtext>cells</mml:mtext></mml:mrow></mml:mover><mml:mo> </mml:mo><mml:mtext>in</mml:mtext><mml:mo> </mml:mo><mml:mi>Ω</mml:mi></mml:mrow></mml:math></disp-formula>
with zero flux conditions on <inline-formula id="IE1"><mml:math id="IN1"><mml:mrow><mml:mo>∂</mml:mo><mml:mi>Ω</mml:mi></mml:mrow></mml:math></inline-formula>. Here, Ω is the computational domain with boundary <inline-formula id="IE2"><mml:math id="IN2"><mml:mrow><mml:mo>∂</mml:mo><mml:mi>Ω</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> is the vector of substrate densities, <inline-formula id="IE3"><mml:math id="IN3"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> are the substrate saturation densities, <inline-formula id="IE4"><mml:math id="IN4"><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:math></inline-formula> are the diffusion coefficients, <inline-formula id="IE5"><mml:math id="IN5"><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:math></inline-formula> are the decay rates, <inline-formula id="IE6"><mml:math id="IN6"><mml:mover accent="true"><mml:mi>S</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:math></inline-formula> and <inline-formula id="IE7"><mml:math id="IN7"><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>⃗</mml:mo></mml:mover></mml:math></inline-formula> are the supply and uptake rates (may vary throughout the domain), <inline-formula id="IE8"><mml:math id="IN8"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>S</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>k</mml:mi><mml:mo>≤</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a collection of cells centered at <inline-formula id="IE9"><mml:math id="IN9"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> with volume <italic>W<sub>k</sub></italic>, supply and uptake rates <inline-formula id="IE10"><mml:math id="IN10"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>S</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE11"><mml:math id="IN11"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and saturation densities <inline-formula id="IE12"><mml:math id="IN12"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>ρ</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>. <inline-formula id="IE13"><mml:math id="IN13"><mml:mrow><mml:msub><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is defined by <inline-formula id="IE14"><mml:math id="IN14"><mml:mrow><mml:msub><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> inside cell <italic>k</italic> and <inline-formula id="IE15"><mml:math id="IN15"><mml:mrow><mml:msub><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>⃗</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> otherwise. All products of vectors are element-wise.</p>
    <p>While most multicellular models [e.g. Morpheus (<xref rid="btv730-B5" ref-type="bibr">Starruß <italic>et al.</italic>, 2014</xref>), Chaste (<xref rid="btv730-B4" ref-type="bibr">Mirams <italic>et al.</italic>, 2013</xref>)] include diffusion solvers, they generally are not designed to scale well to large 3D domains with more than a few substrates. Most are not designed for multithreaded parallelization on multicore desktops. The solvers tend to use explicit time steppings (require strict stability restrictions on <inline-formula id="IE16"><mml:math id="IN16"><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>) or implicit time steppings (stable but require inverting large matrix systems). Those that invert large linear systems often have large dependencies that complicate cross-platform use.</p>
    <p>BioFVM implements simple methods that can readily be parallelized by OpenMP. It can efficiently and accurately simulate systems of 5–10 or more diffusing substrates on 1–10 million or more voxels, with desktop workstations or single compute nodes. The code is first-order accurate in time and second-order accurate in space. Its performance scales linearly in the number of substrates (it takes 2.6× longer to increase from 1 to 10 substrates), the number of voxels and the number of cells. The code is stable; it often achieves good accuracy with <inline-formula id="IE17"><mml:math id="IN17"><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> to 0.1 min.</p>
  </sec>
  <sec>
    <title>2 Method and implementation</title>
    <p>We use a first-order, implicit (and stable) operator splitting, allowing us to create separate, optimized solvers for the diffusion-decay, cell-based source/sinks and bulk source/sinks (<xref rid="btv730-B3" ref-type="bibr">Marchuk, 1990</xref>). We solve the diffusion-decay terms using the finite volume method (<xref rid="btv730-B1" ref-type="bibr">Eymard <italic>et al.</italic>, 2000</xref>), further accelerated by an additional first-order splitting into separate solutions in the <italic>x</italic>-, <italic>y</italic>- and <italic>z</italic>-directions via the locally one-dimensional method (LOD) (<xref rid="btv730-B3" ref-type="bibr">Marchuk, 1990</xref>; <xref rid="btv730-B7" ref-type="bibr">Yanenko, 1971</xref>). For each dimension, we solve the resulting tridiagonal linear systems with the Thomas algorithm (<xref rid="btv730-B6" ref-type="bibr">Thomas, 1949</xref>). We use OpenMP where loops can be parallelized (e.g. many instances of the Thomas solver when solving <italic>x</italic>-diffusion across multiple strips of domain). Other optimizations include storing pre-computations and overloading vector operations. The C ++ implementation is described in further detail in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv730/-/DC1">supplementary materials</ext-link>.</p>
  </sec>
  <sec>
    <title>3 Examples</title>
    <sec>
      <title>3.1 Oxygen and VEGF diffusion in a large tissue</title>
      <p>In <xref ref-type="fig" rid="btv730-F1">Figure 1</xref>, we simulated 1 hour of diffusive transport in 125 mm<sup>3</sup> of vascularized tissue (red curves, panel A) with a large irregular tumor (green cells, panel A) at 20 μm resolution (15 625 000 voxels) and <inline-formula id="IE18"><mml:math id="IN18"><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> min. Oxygen is released by the vessels (a series of cell-centered sources), diffuses through the tissue and is consumed by tumor cells. For technical illustration, tumor cells release VEGF where <inline-formula id="IE19"><mml:math id="IN19"><mml:mrow><mml:msub><mml:mrow><mml:mtext>pO</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>15</mml:mn></mml:mrow></mml:math></inline-formula> mmHg, which diffuses through the domain. Further biology, parameter values and references are discussed in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv730/-/DC1">supplementary materials</ext-link>. In panel A, the vasculature is rendered up to the gray clipping plane for clearer illustration. Panel B shows the tumor cells and vessels in the gray clipping plane. Panels C–D shows the concentration of oxygen and VEGF in this plane. The red contour marks the tumor boundary. This simulation—with 2.8 million cell source/sink terms—required <inline-formula id="IE20"><mml:math id="IN20"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>80</mml:mn></mml:mrow></mml:math></inline-formula> minutes on a quad-core desktop computer (Intel i7 4790, 3.60 GHz, 16 GB of memory); similar problems on 1 million voxels require 5–10 min.
<fig id="btv730-F1" orientation="portrait" position="float"><label>Fig. 1</label><caption><p>Simulation of oxygen and VEGF diffusion in a highly vascularized tissue with a multifocal tumor lesion; vasculature is rendered up to the gray clipping plane (<bold>A</bold>). Vessels and tumor cells in the gray clipping plane (<bold>B</bold>). Oxygen distribution in (<bold>C</bold>) shows significant hypoxia (blue areas, pO2 &lt; 15 mmHg) within the tumor (red outline). Hypoxic tumor cells release VEGF to stimulate further vascularization (<bold>D</bold>) (Color version of this figure is available at <italic>Bioinformatics</italic> online.)</p></caption><graphic xlink:href="btv730f1p"/></fig>
</p>
    </sec>
    <sec>
      <title>3.2 Convergence testing</title>
      <p>Tests for several 1D and 3D problems showed first-order accuracy in time, second-order accuracy in space and stability even for large time steps. Using <inline-formula id="IE21"><mml:math id="IN21"><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> min gave reasonable accuracy for most problems. The convergence tests are fully detailed in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv730/-/DC1">supplementary materials</ext-link>.</p>
    </sec>
    <sec>
      <title>3.3 Performance testing</title>
      <p>We tested diffusion of <inline-formula id="IE22"><mml:math id="IN22"><mml:mrow><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> to 128 substrates with <inline-formula id="IE23"><mml:math id="IN23"><mml:mrow><mml:mi>D</mml:mi><mml:mo>∼</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>5</mml:mn></mml:msup><mml:mi>μ</mml:mi><mml:msup><mml:mtext>m</mml:mtext><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:mtext>min</mml:mtext></mml:mrow></mml:math></inline-formula> (typical magnitude for cancer biology) in a 1 mm<sup>3</sup> domain at 10 <inline-formula id="IE24"><mml:math id="IN24"><mml:mrow><mml:mi>μ</mml:mi><mml:mtext>m</mml:mtext></mml:mrow></mml:math></inline-formula> resolution (1 million voxels) with <inline-formula id="IE25"><mml:math id="IN25"><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> min. Computational cost (wall time for 4 min of diffusion) scaled linearly with <italic>N</italic>; increasing from 1 to 10 substrates increased computational cost by <inline-formula id="IE26"><mml:math id="IN26"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>2.6</mml:mn><mml:mo>×</mml:mo></mml:mrow></mml:math></inline-formula>. In other tests, computational cost scaled linearly with the number of voxels (domain size) and the number of cells. Full results are in the <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv730/-/DC1">supplementary materials</ext-link>.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Obtaining software and licensing</title>
    <p>BioFVM is available from <ext-link ext-link-type="uri" xlink:href="http://BioFVM.MathCancer.org">BioFVM.MathCancer.org</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://BioFVM.sf.net">BioFVM.sf.net</ext-link> under the Apache License (v2.0). A tutorial on using the code is included with the BioFVM download, along with several examples.</p>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>BioFVM can efficiently and accurately simulate several diffusing substrates in large 3D domains, with both bulk and cell-based source and uptake terms. While it can run on its own (with minimal software dependencies), it is well-suited for inclusion in larger modeling packages. Beyond simulating the transport of drugs and growth substrates, BioFVM’s ability to simulate dozens of compounds should make 3D simulations of multicellular secretomics and multiscale cell responses feasible. In future releases, we plan to add upwinded advective solvers, more adaptive time stepping for cell-based source/sink terms and support for general Voronoi meshes.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplementary Data</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_32_8_1256__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="supp_btv730_appendix.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank David B. Agus and the USC Center for Applied Molecular Medicine for generous institutional support.</p>
    <sec>
      <title>Funding</title>
      <p><funding-source>Breast Cancer Research Foundation</funding-source> and the <funding-source>National Institutes of Health</funding-source> (<award-id>5U54CA143907</award-id>, <award-id>1R01CA180149</award-id>).</p>
      <p><italic>Conflict of Interest:</italic> none declared.</p>
    </sec>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="btv730-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Eymard</surname><given-names>R.</given-names></name></person-group><etal/> (<year>2000</year>). <chapter-title>Finite volume methods. In <italic>Solution of Equation in R<sup>n</sup> (Part 3), Techniques of Scientific Computing (Part 3)</italic></chapter-title>
<source>Handbook of Numerical Analysis</source>, vol. <volume>7</volume>
<publisher-name>Elsevier</publisher-name>, pp. <fpage>713</fpage>–<lpage>1018</lpage>.</mixed-citation>
    </ref>
    <ref id="btv730-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lowengrub</surname><given-names>J.</given-names></name></person-group><etal/> (<year>2010</year>) <article-title>Nonlinear modeling of cancer: Bridging the gap between cells and tumors</article-title>. <source>Nonlinearity</source>, <volume>23</volume>, <fpage>R1</fpage>–<lpage>R91</lpage>.<pub-id pub-id-type="pmid">20808719</pub-id></mixed-citation>
    </ref>
    <ref id="btv730-B3">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Marchuk</surname><given-names>G.</given-names></name></person-group> (<year>1990</year>). <chapter-title>Splitting and alternating direction methods. volume 1 of</chapter-title>
<source>Handbook of Numerical Analysis</source>, <publisher-name>Elsevier</publisher-name>, pp. <fpage>197</fpage>–<lpage>462</lpage>.</mixed-citation>
    </ref>
    <ref id="btv730-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mirams</surname><given-names>G.R.</given-names></name></person-group><etal/> (<year>2013</year>) <article-title>Chaste: An open source c ++ library for computational physiology and biology</article-title>. <source>PLoS Comput. Biol</source>., <volume>9</volume>, <fpage>e1002970</fpage>.<pub-id pub-id-type="pmid">23516352</pub-id></mixed-citation>
    </ref>
    <ref id="btv730-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Starruß</surname><given-names>J.</given-names></name></person-group><etal/> (<year>2014</year>) <article-title>Morpheus: a user-friendly modeling environment for multiscale and multicellular systems biology</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>1331</fpage>–<lpage>1332</lpage>.<pub-id pub-id-type="pmid">24443380</pub-id></mixed-citation>
    </ref>
    <ref id="btv730-B6">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Thomas</surname><given-names>L.H.</given-names></name></person-group> (<year>1949</year>). <chapter-title>Elliptic problems in linear difference equations over a network</chapter-title> In: <source>Watson Sci. Comput. Lab Report</source>. <publisher-name>Columbia University</publisher-name>, <publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btv730-B7">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Yanenko</surname><given-names>N.</given-names></name></person-group> (<year>1971</year>). <chapter-title>Simple schemes in fractional steps for the integration of parabolic equations</chapter-title> In: <person-group person-group-type="editor"><name><surname>Holt</surname><given-names>M.</given-names></name></person-group> (ed.) <source>The Method of Fractional Steps</source>. <publisher-name>Springer</publisher-name>, <publisher-loc>Berlin Heidelberg</publisher-loc>, pp. <fpage>17</fpage>–<lpage>41</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
