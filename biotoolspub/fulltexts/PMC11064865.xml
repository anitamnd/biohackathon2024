<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PeerJ</journal-id>
    <journal-id journal-id-type="iso-abbrev">PeerJ</journal-id>
    <journal-id journal-id-type="publisher-id">peerj</journal-id>
    <journal-title-group>
      <journal-title>PeerJ</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2167-8359</issn>
    <publisher>
      <publisher-name>PeerJ Inc.</publisher-name>
      <publisher-loc>San Diego, USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">11064865</article-id>
    <article-id pub-id-type="publisher-id">17276</article-id>
    <article-id pub-id-type="doi">10.7717/peerj.17276</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Bioinformatics</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Computational Biology</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Evolutionary Studies</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Mathematical Biology</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Variational Bayesian phylogenies through matrix representation of tree space</article-title>
    </title-group>
    <contrib-group>
      <contrib id="author-1" contrib-type="author" corresp="yes">
        <name>
          <surname>Bouckaert</surname>
          <given-names>Remco R.</given-names>
        </name>
        <email>remco@cs.auckland.ac.nz</email>
        <xref rid="aff-1" ref-type="aff"/>
      </contrib>
      <aff id="aff-1"><institution>School of Computer Science, University of Auckland</institution>, <city>Auckland</city>, <country>New Zealand</country></aff>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Procter</surname>
          <given-names>James</given-names>
        </name>
      </contrib>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>4</month>
      <year iso-8601-date="2024">2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>12</volume>
    <elocation-id>e17276</elocation-id>
    <history>
      <date date-type="received" iso-8601-date="2023-10-28">
        <day>28</day>
        <month>10</month>
        <year iso-8601-date="2023">2023</year>
      </date>
      <date date-type="accepted" iso-8601-date="2024-04-01">
        <day>1</day>
        <month>4</month>
        <year iso-8601-date="2024">2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>©2024 Bouckaert</copyright-statement>
      <copyright-year>2024</copyright-year>
      <copyright-holder>Bouckaert</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, reproduction and adaptation in any medium and for any purpose provided that it is properly attributed. For attribution, the original author(s), title, publication source (PeerJ) and either DOI or URL of the article must be cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="https://peerj.com/articles/17276"/>
    <abstract>
      <p>In this article, we study the distance matrix as a representation of a phylogeny by way of hierarchical clustering. By defining a multivariate normal distribution on (a subset of) the entries in a matrix, this allows us to represent a distribution over rooted time trees. Here, we demonstrate tree distributions can be represented accurately this way for a number of published tree distributions. Though such a representation does not map to unique trees, restriction to a subspace, in particular one we call a “cube”, makes the representation bijective at the cost of not being able to represent all possible trees. We introduce an algorithm “cubeVB” specifically for cubes and show through well calibrated simulation study that it is possible to recover parameters of interest like tree height and length. Although a cube cannot represent all of tree space, it is a great improvement over a single summary tree, and it opens up exciting new opportunities for scaling up Bayesian phylogenetic inference. We also demonstrate how to use a matrix representation of a tree distribution to get better summary trees than commonly used maximum clade credibility trees. An open source implementation of the cubeVB algorithm is available from <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link> as the <monospace>cubevb</monospace> package for BEAST 2.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>Bayesian phylogenetics</kwd>
      <kwd>Variational Bayes</kwd>
      <kwd>BEAST 2</kwd>
      <kwd>Tree space</kwd>
      <kwd>Summary trees</kwd>
    </kwd-group>
    <funding-group>
      <funding-statement>The authors received no funding for this work.</funding-statement>
    </funding-group>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>The workhorse of Bayesian phylogenetics is the Markov chain Monte Carlo (MCMC) algorithm, which is widely used to reconstruct the evolutionary relationships among a set of biological sequences (<xref rid="ref-19" ref-type="bibr">Huelsenbeck &amp; Ronquist, 2001</xref>; <xref rid="ref-18" ref-type="bibr">Höhna et al., 2016</xref>; <xref rid="ref-33" ref-type="bibr">Suchard et al., 2018</xref>; <xref rid="ref-5" ref-type="bibr">Bouckaert et al., 2019</xref>). In practice, MCMC is limited to handling phylogenies of at most a few thousand taxa. With the advent of ever cheaper sequencing techniques, these algorithms are overwhelmed by the amount of available data. Consequently, maximum likelihood methods are employed, which can handle these amounts of data because they are based on optimisation algorithms.</p>
    <p>Variational Bayesian (VB) methods (<xref rid="ref-21" ref-type="bibr">Jordan et al., 1999</xref>) are also based on optimisation, so offer the prospect of being more scalable than MCMC. VB methods usually represent a posterior distribution as a transformation of a multivariate normal distribution on Euclidean space. The form of the transformation is crucial in how accurate the posterior distribution can be represented. Usually, stochastic gradient ascent is used as the optimisation algorithm, which relies on the transformation being a bijection between trees and their transformed representation. This provides a major hurdle for phylogentic inference, since existing tree spaces are either not bijective (like spanning trees between points in hyperbolic space (<xref rid="ref-26" ref-type="bibr">Matsumoto, Mimori &amp; Fukunaga, 2021</xref>; <xref rid="ref-20" ref-type="bibr">Jiang, Tabaghi &amp; Mirarab, 2022</xref>)) or do not allow representation as a Euclidean space (like ultrametric space (<xref rid="ref-15" ref-type="bibr">Gavryushkin &amp; Drummond, 2016</xref>)).</p>
    <p>Prior phylogenetic VB implementations got around these restrictions by being limited to fixed tree topologies (<xref rid="ref-14" ref-type="bibr">Fourment &amp; Darling, 2019</xref>; <xref rid="ref-38" ref-type="bibr">Zhang, 2020</xref>). Others do not handle timed trees (<xref rid="ref-39" ref-type="bibr">Zhang &amp; Matsen IV, 2018</xref>) which are important to many practical and scientific questions. The ones that handle time trees (<xref rid="ref-40" ref-type="bibr">Zhang &amp; Matsen IV, 2022</xref>), have not demonstrated to scale to scale to 1,000 taxa.</p>
    <p>Here, we explore matrix representations of tree space. The basic idea is to use a symmetric matrix with dimension equal to the number of taxa and apply a hierarchical clustering algorithm like the single link clustering algorithm (<xref rid="ref-13" ref-type="bibr">Florek et al., 1951</xref>) to obtain a tree with internal node heights specified by the values of the matrix. The entries in the matrix form a Euclidean space, however there are many ways to represent the same tree, so the transformation is not bijective. A “cube” is a matrix where we restrict ourselves to the 1-off-diagonal entries of the matrix (and leave the rest at infinity) and the transformation becomes a bijection, but cannot represent all possible trees any more. In this article, we demonstrate it is possible to capture the most interesting part of posterior tree space using this approach. We implement an algorithm for basic phylogenetic models, infer the parameters of the multivariate normal distribution and show through a well calibrated simulation study that it captures important parameters of interest. We demonstrate that it scales well.</p>
    <p>Representations similar to the cube representation have been used before in phylogenetic inference. For example, in training neural nets to uncover the epidemiological dynamics of outbreaks (<xref rid="ref-37" ref-type="bibr">Voznica et al., 2022</xref>), where the “compact bijective ladderised vector” orders taxa so that branch support for taxa on the left is maximised. Instead of using the distance between taxa, the distance from internal nodes to the root is used. In MCMC, tree proposals like the “node reheight” operator in *BEAST (<xref rid="ref-17" ref-type="bibr">Heled &amp; Drummond, 2009</xref>), order taxa through a tree traversal. At binary splits, the first or second branch is randomly traversed first, resulting in a random ordering. Then, an internal node is randomly selected, and its height is randomly moved (constrained by gene tree heights). Finally, a tree is reconstructed to maintain consistency with the ordering and node heights of internal nodes between taxa. <xref rid="ref-27" ref-type="bibr">Mau, Newton &amp; Larget (1999)</xref> refers to this as the “canonical representation” and proposes its use an MCMC proposal as well. This is equivalent to selecting a cube with random order consistent with the tree, then perturbing a distance in the matrix and reconstructing the tree.</p>
    <p>Matrix and specifically cube representations offer a few other benefits. Many post-hoc analyses such as ancestral reconstruction, trait inference or phylogeography are performed on a single summary tree, so these analyses do not take phylogenetic uncertainty in account. Though a cube does not represent all of tree space, in many situations it captures most of the uncertainty of a posterior distribution, and allows taking uncertainty in account in post-hoc analyses. Furthermore, our novel way to represent tree space opens up new avenues to implement online algorithms (<xref rid="ref-4" ref-type="bibr">Bouckaert, Collienne &amp; Gavryushkin, 2022</xref>), allowing rapid responses to newly available data. There is also potential for improving summary trees through matrix representation of a given tree set, as we will demonstrate.</p>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Representing trees through a matrix</title>
      <p>The main idea is to represent a posterior tree distribution as a distribution over entries of a matrix, and apply the single links clustering algorithm ( <xref rid="fsrc1" ref-type="other">Algorithm 1</xref> ) to obtain a tree. The matrix can be interpreted as a distance matrix: it must be symmetric, have positive values and the entries on the diagonal are ignored. So, for a tree with <italic toggle="yes">n</italic> taxa there are <italic toggle="yes">n</italic>(<italic toggle="yes">n</italic> − 1)/2 entries that are relevant: the entries above the diagonal. We say a matrix entry is <italic toggle="yes">specified</italic> if it is finite, and <italic toggle="yes">unspecified</italic> if it is positive infinite. We say a matrix is <italic toggle="yes">valid</italic> if the tree associated with it through single link clustering only has finite branch lengths.</p>
      <p>
        <preformat id="fsrc1" xml:space="preserve" position="float"> 
_______________________ 
Algorithm 1 Single link clustering_________________________________________________________ 
  Input: n × n matrix M with entries mij 
    Let x1,...,xn be n taxa 
  ∀1≤i≤n initialise subtree as single taxon {xi} at height 0 
  while There is more than 1 subtree do 
      Let mij be minimum of M, where xi and xj in different subtrees 
       Create node x with height mij 
        Add branch between x and root of subtree containing xi 
        Add branch between x and root of subtree containing xj 
    Return tree with root at last added node_______________________________________________    </preformat>
      </p>
      <p>Some properties of this representation with a short justification:</p>
      <list list-type="simple" id="list-1">
        <list-item>
          <label> 1.</label>
          <p><italic toggle="yes">Note that at least <italic toggle="yes">n</italic> − 1 entries must be specified for a matrix to be valid.</italic> This follows from the fact that there are <italic toggle="yes">n</italic> − 1 internal nodes in a tree, so the single link clustering algorithm requires at least <italic toggle="yes">n</italic> − 1 finite heights to specify a tree.</p>
        </list-item>
        <list-item>
          <label> 2.</label>
          <p>An adjacency graph <italic toggle="yes">G</italic> over <italic toggle="yes">n</italic> nodes <italic toggle="yes">v</italic><sub>1</sub>, …, <italic toggle="yes">v</italic><sub><italic toggle="yes">n</italic></sub> can be associated with a matrix <italic toggle="yes">M</italic> having edges <italic toggle="yes">e</italic><sub><italic toggle="yes">ij</italic></sub> between <italic toggle="yes">v</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">v</italic><sub><italic toggle="yes">j</italic></sub> where ever <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> is specified. <italic toggle="yes">A matrix is valid if and only if the associated adjacency graph is connected.</italic> This follows from the fact the single link clustering algorithm uses entries in the matrix associated with edges in the graph that form a path connecting all nodes. So, it is possible for a matrix to have <italic toggle="yes">n</italic> − 1 entries specified, but still not be valid (<xref rid="fig-1" ref-type="fig">Fig. 1</xref>).</p>
        </list-item>
        <list-item>
          <label> 3.</label>
          <p><italic toggle="yes">To represent a distribution over <italic toggle="yes">all</italic> possible trees, all entries in the matrix must be specified.</italic> This follows from the observation that in the set of all trees, for every pair <italic toggle="yes">i</italic>, <italic toggle="yes">j</italic>, <italic toggle="yes">i</italic> ≠ <italic toggle="yes">j</italic> of taxa <italic toggle="yes">x</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">x</italic><sub><italic toggle="yes">j</italic></sub> there exists a tree somewhere in the set of all trees such that the pair is connected with the lowest internal node (that is parent to both taxa). Since such a <italic toggle="yes">cherry</italic> can only be formed by the distance in the matrix <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> being the smallest, this implies <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> cannot be infinite, so <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> must be specified.</p>
        </list-item>
        <list-item>
          <label> 4.</label>
          <p><italic toggle="yes">A matrix with <italic toggle="yes">n</italic> or more entries specified does not form a bijection to trees.</italic> Since the single link algorithm only uses <italic toggle="yes">n</italic> − 1 entries in the matrix to form the tree, if there are <italic toggle="yes">n</italic> or more values specified in the matrix it is possible to change these values and return the same tree. Therefore, there are multiple ways to represent the same tree with different matrices, hence it cannot be a bijection.</p>
        </list-item>
        <list-item>
          <label> 5.</label>
          <p><italic toggle="yes">A matrix with <italic toggle="yes">n</italic> − 1 entries specified forms a bijection to trees when the associated adjacency graph is connected.</italic> This includes the cube representation that we will have a closer look at later.</p>
        </list-item>
        <list-item>
          <label> 6.</label>
          <p><italic toggle="yes">Transforming a tree to a matrix consists of populating the specified entries <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> with height of the most common recent ancestor of <italic toggle="yes">x</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">x</italic><sub><italic toggle="yes">j</italic></sub> in the tree.</italic> The single link clustering algorithm then retrieves the original tree when applied to the matrix.</p>
        </list-item>
      </list>
      <p>If all entries in the matrix on the first row are specified (<italic toggle="yes">i.e.</italic> entries <italic toggle="yes">m</italic><sub>1<italic toggle="yes">j</italic></sub> for 1 &lt; <italic toggle="yes">j</italic> ≤ <italic toggle="yes">n</italic>) and the remainder are not specified (<xref rid="fig-1" ref-type="fig">Fig. 1</xref>), all possible caterpillar trees with cherry containing <italic toggle="yes">x</italic><sub>1</sub> can be formed. Note that there are (<italic toggle="yes">n</italic> − 1)! topologies that can be formed that way.</p>
      <p>If all entries in the matrix that are 1-off-diagonal are specified, the adjacency graph forms a linked chain and <inline-formula><alternatives><inline-graphic xlink:href="peerj-12-17276-i001.jpg"/><tex-math id="tex-ieqn-34">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
$ \frac{1}{n+1} \left( {2n\atop n} \right) $\end{document}</tex-math><mml:math id="mml-ieqn-34" overflow="scroll"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mfenced separators="" open="(" close=")"><mml:mrow><mml:mfrac linethickness="0"><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math></alternatives></inline-formula> (the Catalan number) number of topologies can be represented. We call this configuration a <italic toggle="yes">cube</italic>. Even though the same number of entries are specified, this is less than for the caterpillar trees, but will turn out to be more useful in practice. Note that by reordering the taxa it is possible to get the same kind of adjacency graph containing all nodes in a chain.</p>
      <fig position="float" id="fig-1">
        <object-id pub-id-type="doi">10.7717/peerj.17276/fig-1</object-id>
        <label>Figure 1</label>
        <caption>
          <title>Various matrices where <italic toggle="yes">x</italic> means the entry is specified, and ∞ the entry is unspecified for <italic toggle="yes">n</italic> = 6, the associated adjacency graphs for <italic toggle="yes">n</italic> = 6 and the number of tree topologies they can represent (in decreasing order).</title>
        </caption>
        <graphic xlink:href="peerj-12-17276-g001" position="float"/>
      </fig>
      <p>We will use a multivariate normal distribution <italic toggle="yes">N</italic>(<italic toggle="yes">μ</italic>, Σ) with mean vector <italic toggle="yes">μ</italic> and covariance matrix Σ of dimension <italic toggle="yes">k</italic>. Here <italic toggle="yes">n</italic> − 1 ≤ <italic toggle="yes">k</italic> ≤ <italic toggle="yes">n</italic>(<italic toggle="yes">n</italic> − 1)/2, where each of the <italic toggle="yes">k</italic> dimensions is associated with an entry in the matrix. To estimate <italic toggle="yes">μ</italic> and Σ for a tree set, simply construct the branch length matrix for each tree in the set and take the average for each entry (that is specified) and covariance for each pairs of specified entries.</p>
      <p>To get a sample of trees, draw a random sample from this distribution, exponentiate each of the values and populate the matrix with its values. Then run single link clustering to obtain the tree. <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> shows this in more detail.</p>
      <preformat id="fsrc2" xml:space="preserve" position="float"> 
_______________________________________________________________________________________________________ 
Algorithm 2 Sample from posterior_______________________________________________________ 
  Input: Multivariate normal distribution N(μ,Σ) of dimension k 
           where μ the vector of mean values and Σ the covariance matrix. 
  Input: list of k matrix entries 
  Let AAT = Σ be the Cholesky decomposition of Σ 
  Draw k independent standard normal values z = {z1,...,zk} 
  Let x = μ + Az 
  Fill the matrix M with the k entries of exp(x) and leave the rest unspecified 
  Return tree by applying single link clustering on M____________________________    </preformat>
    </sec>
    <sec>
      <title>Cube space</title>
      <p>An alternative way to represent a cube configuration in a matrix is to consider an order of the taxa and a vector that represents the height of the internal nodes between two consecutive taxa in the ordering. <xref rid="fig-2" ref-type="fig">Figure 2</xref> illustrates this: the height <italic toggle="yes">h</italic><sub>1</sub> corresponds to a matrix entry for <italic toggle="yes">A</italic> and <italic toggle="yes">B</italic>, the height <italic toggle="yes">h</italic><sub>2</sub> for <italic toggle="yes">B</italic> and <italic toggle="yes">C etc</italic>., this way forming the cube configuration from the previous subsection. But we can consider this an ordering <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>, <italic toggle="yes">D</italic>, <italic toggle="yes">E</italic> and gaps <italic toggle="yes">h</italic><sub>1</sub> to <italic toggle="yes">h</italic><sub>4</sub> between consecutive nodes in the ordering.</p>
      <fig position="float" id="fig-2">
        <object-id pub-id-type="doi">10.7717/peerj.17276/fig-2</object-id>
        <label>Figure 2</label>
        <caption>
          <title>Cube over five taxa consisting of a taxon ordering <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>, <italic toggle="yes">D</italic>, <italic toggle="yes">E</italic> and heights <italic toggle="yes">h</italic><sub>1</sub> for the height between <italic toggle="yes">A</italic> and <italic toggle="yes">B</italic>, height <italic toggle="yes">h</italic><sub>2</sub> for the heights between <italic toggle="yes">B</italic> and <italic toggle="yes">C</italic>, <italic toggle="yes">h</italic><sub>3</sub> for <italic toggle="yes">C</italic> and <italic toggle="yes">D</italic> and height <italic toggle="yes">h</italic><sub>4</sub> for <italic toggle="yes">D</italic> and <italic toggle="yes">E</italic>.</title>
          <p>Dashed lines show how the heights are associated with consecutive pairs of taxa in the taxon ordering.</p>
        </caption>
        <graphic xlink:href="peerj-12-17276-g002" position="float"/>
      </fig>
      <p>One nice property of cube space is that it only contains <italic toggle="yes">n</italic> − 1 heights, and forms a bijection under the single link clustering transformation. However, it is obviously limited in that it cannot represent all of tree space, our expectation is that it can represent a large part of posterior space. Consider three taxa, <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic> ordered alphabetically, then there are three possible topologies: ((<italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>), <italic toggle="yes">C</italic>), (<italic toggle="yes">A</italic>, (<italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>)) and ((<italic toggle="yes">A</italic>, <italic toggle="yes">C</italic>), <italic toggle="yes">B</italic>). The first two are represented in the cube, but the last one is missing, so at least two thirds of the posterior can be represented. In practice, posteriors will be skewed towards a dominant topology, so the first topology may have 60% support, the second 30% and leaving only 10% for the topology that is missed out. In this three taxon example, this means that 90% of the posterior can be captured. This is 30% better than using a summary tree that would only cover the first topology.</p>
      <p>The method for learning a multivariate normal distributions over cube heights is the same as for matrices.</p>
    </sec>
    <sec>
      <title>Variational Bayesian approach</title>
      <p>The application of cube space we are most interested in is Bayesian inference through a variational Bayesian distribution. To this end, we have to infer the mean vector <italic toggle="yes">μ</italic> and covariance matrix Σ from an alignment and phylogenetic model. For each of the parameters of the model, we need a transformation so that the transformed parameter is normally distributed. We employ the following transformations:</p>
      <list list-type="simple" id="list-2">
        <list-item>
          <label> •</label>
          <p>for scale parameters (like <italic toggle="yes">κ</italic> of the HKY model, birth rate of the Yule model) we use a log-transform.</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for location parameters we use no transform.</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for multi dimensional parameters that are constrained to sum to 1, <italic toggle="yes">e.g.</italic> frequencies of substitution models, we use a stick breaking transform (<xref rid="ref-2" ref-type="bibr">Betancourt, 2012</xref>).</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for the tree we use the matrix transform. Note that internal node heights are log-transformed.</p>
        </list-item>
      </list>
      <p>Given a phylogenetic model that specifies a tree prior, site model and branch rate model, the parameters of the model (including the tree) and associated transformations, <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> outlines how we can infer <italic toggle="yes">μ</italic> and Σ. The strategy is to get a reasonably good value for <italic toggle="yes">μ</italic> first, and infer Σ afterwards. To this end the first step is finding a state with high probability, ideally the maximum a posteriori probability (MAP) state, since it corresponds to the mode of the multivariate normal distribution, and thus should get us reasonably close to where <italic toggle="yes">μ</italic> should be.</p>
      <preformat id="fsrc3" xml:space="preserve" position="float"> 
________________________________________________________________________________________ 
Algorithm 3 Cube-VB________________________________________________________________________ 
  Input: posterior distribution over a set of parameters 
  Input: set of parameters (including tree) and their transforms 
  0. Initialise tree by UPGMA 
  1. Find high posterior state of tree and other parameters 
  2. Randomly initialise ordering of taxa that is compatible with tree from step 
   1 
  3. Sample trees restricted to cube space, using MCMC 
  4. Estimate μ and Σ based on transformed MCMC samples______________________    </preformat>
      <p>The tree is initialised using Un weighted Pair Group Method with Arithmetic Mean (UPGMA) <xref rid="ref-31" ref-type="bibr">Sokal&amp; Michener (1958)</xref>, a hierarchical clustering algorithm that produces a rooted time tree. The topology of the tree and timing of the tree can potentially be adjusted in the next step.</p>
      <p>In our implementation, the tree and all other parameters are then optimised using simulated annealing (<xref rid="ref-36" ref-type="bibr">Van Laarhoven et al., 1987</xref>). This is a general purpose optimisation algorithm that, like MCMC, randomly explores the state space, but it differs from MCMC in the acceptance criterion of a proposed state. Higher posterior proposals are always accepted, and lower posterior proposals are accepted with a probability proportional to the change in posterior weighted by a temperature that decreases over time. We found that using a temperature schedule that decreases fairly fast to the end temperature, but repeatedly resets to the start temperature instead of a long monotonically decreasing temperature allowed escape from local minima more efficiently. For the proposals used in simulated annealing we can use standard MCMC operators implemented in BEAST 2.</p>
      <p>To complete the cube-transform for the tree, we need a taxon ordering. Different orderings cover different parts of tree space, so finding a suitable ordering affects the suitability of the representation. This is a research question that we leave open here, but note that in the implementation using a random order compatible with the tree turned out to be sufficiently good to accurately infer parameters of interest such as tree height and tree length.</p>
      <p>In order to estimate the covariance matrix Σ, we will generate a representative sample using MCMC. Instead of using the standard tree operators in BEAST 2, we replace the topology changing operators with a pair of operators that ensure the proposed tree can be represented by the cube restricted by the taxon ordering from Step 2 of <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> . The first operators is a variant of the narrow exchange operator (a nearest neighbour interchange operator that also proposes a new height of the node that is moved) that ensure it remains within the cube. The second operators is a subtree-slide operator (moves internal node up or down, potentially causing topology changes) and ensures that the target location is compatible with the cube ordering.</p>
      <p>Based on the short MCMC run, we can transform the MCMC samples and directly estimate <italic toggle="yes">μ</italic> and Σ from the set of transformed values. There are many tools for visualising and otherwise post-processing a posterior based on an MCMC sample, such as Tracer (<xref rid="ref-29" ref-type="bibr">Rambaut et al., 2018</xref>), DensiTree (<xref rid="ref-6" ref-type="bibr">Bouckaert, 2010</xref>), <italic toggle="yes">etc</italic>etera. Once we obtain <italic toggle="yes">μ</italic> and Σ, <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> can be used to create such a sample.</p>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>Results</title>
    <p>In this section, we validate the matrix and cube representation of tree distributions and show that the method for learning a cube based variational Bayesian distribution passes well calibrated simulation studies and we will get an impression of the algorithm’s performance. Finally, we consider using a method for inferring summary trees.</p>
    <sec>
      <title>Matrices and cubes can accurately represent tree distributions</title>
      <p>To validate whether we can accurately represent a tree posterior obtained from a full MCMC run, we construct the distance matrix for each tree by taking the logarithm of the pairwise taxon path distance, then estimate the mean and covariance matrix for all relevant entries. Next, we sample a new tree distribution using <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> repeatedly to obtain a new tree sample. We compare clade support and clade height distribution with the original tree posterior using the <monospace>CladeSetComparator</monospace> from the Babel package (<ext-link xlink:href="https://github.com/rbouckaert/Babel" ext-link-type="uri">https://github.com/rbouckaert/Babel</ext-link>) in BEAST 2.</p>
      <sec>
        <title>Apes</title>
        <p><xref rid="fig-3" ref-type="fig">Figure 3</xref> shows a small illustrative example of a tree distribution over six apes. There is uncertainty at the root with 83% support for siamang being outgroup (blue trees in panels b &amp; d), 13% orangutan being outgroup (red trees) and 4% siamang and orangutan being outgroup (green trees). A cube can only represent two out of these three cases. By representing the first two, it covers 96% of the posterior distribution, which for many practical cases may be sufficient.</p>
        <fig position="float" id="fig-3">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-3</object-id>
          <label>Figure 3</label>
          <caption>
            <title>Comparing the ape dataset with a cube representation (A &amp; B) and matrix representation (C &amp; D).</title>
            <p>Plates A &amp; C show clade support in red and clade height in blue. Red dots indicate clade support, running from zero probability (bottom left corner) to 1 (top right corner). Blue dots are placed at the mean of the height of a clade. Both x and y axes are scaled so that the largest tree height (from among both data sets) is at the top right corner. Blue crosses indicate 95% highest probability density (HPD) intervals of clade height. For both red and blue dots, bigger dots mean more clade support. The x-axis represent clade values from one set, the y-axis that of another. If both sets are the same, all dots will be on the x = y line (black diagonal line). The two blue lines indicate there is 20% difference: points within these lines have less than 20% difference, points outside have more, and can be considered as evidence there is substantial difference between the two posteriors. Plates B &amp; D show the original tree set on the left. The trees with most prevalent topology are blue, the next prevalent red and least prevalent green. Plate (B) on the left shows the cube representation and plate (D) the matrix representation. A cube accurately represents most clades, but does not cover all clades, where a matrix can represent all clades but is less accurate in clade support (see text for details).</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g003" position="float"/>
        </fig>
        <p>Representing the third case where both siamang and orangutan are ougroup is possible with a matrix representation, as shown <xref rid="fig-3" ref-type="fig">Fig. 3D</xref>.</p>
        <p>What is striking in both panels a and c in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> is that the mean of the clade heights and 95% HPD intervals are very close. However, clade support is slightly distorted: for the cube, the trees with both siamang and orangutan as outgroup is completely missing. Since this only covers 4% of the posterior, this may not be such a big issue in general. The matrix has this clade represented, but instead of the original 83%, 13%, 4% distribution has 59%, 21%, 20% distribution, heavily over representing the siamang and orangutan as outgroup. This is visible in <xref rid="fig-3" ref-type="fig">Fig. 3C</xref> by the red dots being far from the diagonal. It appears the correlation matrix does not accurately capture possible non-linear correlations between the entries in the matrix.</p>
        <p>One source of such non-linearities is the tree topology interfering with distance distributions between pairs of taxa: in a topology ((A,B),C), the distance between A and B and the distance between A and C can be linearly correlated. And likewise in topology ((A,C),B). But if both topologies are in the tree set there is no reason the combined correlation to always behave linearly or even approximately linearly. Use of the minimum function for clade distances in the single link clustering algorithm is another source of non-linearity. A potential remedy is to use normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) to capture such non-linearities and provide a more sophisticated transformation between a multi-variate normal distribution and the associated tree topology.</p>
      </sec>
      <sec>
        <title>AARS</title>
        <p>A tree distribution with more uncertainty is from aminoacyl-tRNA synthetase (AARS) data for 204 Class I protozyme sequences (<xref rid="ref-9" ref-type="bibr">Carter Jr et al., 2022</xref>). A convenient way to characterise the uncertainty of a tree distribution is its entropy <xref rid="ref-24" ref-type="bibr">Lewis et al. (2016)</xref>, which can be calculated efficiently based on the conditional clade distribution (<xref rid="ref-22" ref-type="bibr">Larget, 2013</xref>) of the tree set. The AARS data has an entropy of 124.1, so more than half of the internal nodes are uncertain. The corresponding cube has an entropy of just 96.3, which shows that a cube representation can have a large entropy, thus representing a highly uncertain tree distribution.</p>
        <p><xref rid="fig-4" ref-type="fig">Figure 4A</xref> shows the clade set comparison for the AARS data, which shows that most of the clades that are supported in the cube have reasonably similar support as in the original tree set. Although there is a clade with 38.9% difference in clade support, and there are 5 other clades with more than 25% clade support difference, the average clade support difference is just 4.9% for clades with over 1% support. Note the set of red dots at the x-axis, which represent the set of clades that are not represented by the cube. Furthermore, clade heights also show very close correspondences: the mean height estimate differs just 2.2%. In summary, the clades match remarkably well given the high entropy of the tree set.</p>
        <fig position="float" id="fig-4">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-4</object-id>
          <label>Figure 4</label>
          <caption>
            <title> Comparing the AARS dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Clade support and heights show good correspondence as does the DensiTree.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g004" position="float"/>
        </fig>
        <p><xref rid="fig-4" ref-type="fig">Figure 4B</xref> shows a DensiTree of the original tree distribution on the left hand side and the cube representation on the right hand side. Visually, the images correspond quite well, confirming the information we have from the clade comparison panel. Note that the cube represents a large number of clades judging from the diversity of trees in the DensiTree as well as the large number of points in the clade comparison plot. Even though a considerable number of clades are missing, the majority of well supported clades are represented by the cube.</p>
      </sec>
      <sec>
        <title>Pama-Nynguan languages</title>
        <p><xref rid="fig-5" ref-type="fig">Figure 5</xref> shows another tree distribution, here for 306 Pama-Nynguan languages (<xref rid="ref-8" ref-type="bibr">Bouckaert, Bowern &amp; Atkinson, 2018</xref>) with a large entropy of 91.7 for the original tree distribution and 78.6 for the cube. <xref rid="fig-5" ref-type="fig">Figure 5</xref> shows the clade comparison, showing just three clades having more than 25% clade support, and two of them are two taxon clades. Again, we see good correspondence between original distribution obtained through MCMC and its cube representation.</p>
        <fig position="float" id="fig-5">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-5</object-id>
          <label>Figure 5</label>
          <caption>
            <title> Comparing the Pama-Nyungan dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g005" position="float"/>
        </fig>
      </sec>
      <sec>
        <title>Cichlids</title>
        <p>A more troublesome example is a tree distribution over 121 Cichlid sequences sourced from <xref rid="ref-25" ref-type="bibr">Matschiner et al. (2017)</xref>. The entropy of the original dataset is 38.4 but that of the cube representation is higher at 49.8. Different orderings were tried based on the ordering heuristics in DensiTree, but all of them resulted in a cube representation with significant number of clades having substantially different support.</p>
        <p>Since the cube representation contains fewer trees, there are fewer terms to contribute to the entropy, and since all terms must add to 1, these terms can be expected to be larger than for the original distribution. Therefore, one would expect entropy of a cube representation to decrease from that of the original tree distribution The fact the entropy for the cichlids data increased in the cube representation compared to the original dataset can be interpreted as a hint that the ordering is less than optimal. Optimising orderings is a topic for further research, but this example shows it is crucial for a good tree set representation.</p>
        <p><xref rid="fig-6" ref-type="fig">Figure 6</xref> shows the clade comparison and DensiTree. There are 23 clades that have more than 25% difference in support and the maximum difference in clade support is 80% for a clade in the original set that is missing from the cube representation. The mean height of clades differ only 0.57%, so correspond quite well. In this case, a cube representation appears to be less satisfactory than in the other examples.</p>
        <fig position="float" id="fig-6">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-6</object-id>
          <label>Figure 6</label>
          <caption>
            <title> Comparing the cichlids dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Significant number of clades have large difference in support in the cube representation, though heights of those clades that are captured show good correspondence.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g006" position="float"/>
        </fig>
      </sec>
      <sec>
        <title>Indo-European languages</title>
        <p>To demonstrate the cube representation works well for internal nodes, even though tip dates are sampled, we considered a recently published tree distribution over 161 languages (<xref rid="ref-16" ref-type="bibr">Heggarty et al., 2023</xref>). The tree set has an entropy of 42.3, the cube has 36.6 (<xref rid="fig-7" ref-type="fig">Figure 7</xref>).</p>
        <fig position="float" id="fig-7">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-7</object-id>
          <label>Figure 7</label>
          <caption>
            <title> Comparing the Indo-European dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Even with dated tips the cube representation remains accurate.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g007" position="float"/>
        </fig>
        <p>Maximum difference in clade support is 28.5% but only 2 clades have difference of 25% and on average the clade support difference is 4.1% for clades with more than 1% support. Mean height difference of clades (not counting tip heights) is less than 0.79% on average. So, even though the original distribution has dated tips, and the cube does not, clade support and clade heights remain quite closely represented when compared to the original.</p>
      </sec>
    </sec>
    <sec>
      <title>Cube-VB algorithm passes well calibrated simulation study</title>
      <p>To verify that the cube based variational distribution algorithm works, we performed a well calibrated simulation study (<xref rid="ref-28" ref-type="bibr">Mendes et al., 2023</xref>; <xref rid="ref-35" ref-type="bibr">Talts et al., 2018</xref>) using a tree with 50 taxa sampled from the Yule tree prior with birth rate narrowly distributed as normal (mean = 6, sigma = 0.1). This results in tree heights with mean 0.58 and 95% HPD of 0.34 to 0.79. Sequence data is generated under a HKY model with kappa lognormally distributed (mean = 1, sigma = 1.25), and a strict clock with rate fixed at 1 is used to complete the model. So, the parameter space being sampled consists of the kappa and birth rate parameters and a tree. We use sequence lengths of 100, 250 and 500 resulting in observed entropy in the inferred tree posteriors of 10.6, 6.4 and 3.8 respectively (<xref rid="table-1" ref-type="table">Table 1</xref>). We run 100 instances for each sequence length, and expect the 95%HPD of parameters of interest to contain the true value from 91 to 99 of the cases for the test to pass. <xref rid="table-1" ref-type="table">Table 1</xref> shows the results and the simulation study indeed passes.</p>
      <table-wrap position="float" id="table-1">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-1</object-id>
        <label>Table 1</label>
        <caption>
          <title>Coverage (in %) of 100 runs over 50 taxa with Yule, HKY strict clock for three different sequence lengths.</title>
          <p>Longer sequences result in lower entropy, but coverage of the parameters of interest (last four lines in table) are all in acceptable range.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g008" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Sequence length:</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Mean and 95% HPD</td>
                <td rowspan="1" colspan="1">10.6 (5.9–14.6)</td>
                <td rowspan="1" colspan="1">6.4 (3.2–10.4)</td>
                <td rowspan="1" colspan="1">3.8 (1.3–6.3)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Entropy</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree height</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">93</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree treeLength</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">BirthRate</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Kappa</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">93</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>A slightly more challenging case is where we sample trees from a coalescent tree prior with constant population size sampled from a lognormal (mean = 0.1, sigma = 0.1). The tree heights have a mean of 2.3 with 95% HPD interval of 0.6 to 5.0. We use a site model with gamma rate heterogeneity where the shape parameter is sampled from an exponential with mean 1, and use a GTR model with rate CT fixed to 1 and rate AG sampled from a log normal with mean 1 in real space and sigma = 1. The other four transversions rates are sampled from a log normal with mean in real space of 0.5 and sigma = 1. Stationary frequencies for the GTR model were sampled from a Dirichlet with <italic toggle="yes">α</italic> = 4 for all four dimensions. For this setup, getting accurate estimates of the uncertainty required running the MCMC a bit longer than for the case using HKY. <xref rid="table-2" ref-type="table">Table 2</xref> shows the coverage we get for all paramaters of interest and they are all in an acceptable range,<xref rid="fn-1" ref-type="fn"><sup>1</sup></xref>
<fn id="fn-1"><label>1</label><p>If the 95% HPD estimates are correct estimates, the simulation study is an experiment of flipping a coin with 95% probability of turning heads repeated 100 times. Here, observing a head equates finding the true value of a parameter being inside the 95% HPD interval. This results in a binomial distribution of observing heads on average 95 times and a 95% probability of being within a range of 91 to 99. Observing almost all coverage values in this range with the occasional outlier at 90 or 100 is deemed acceptable.</p></fn>although population size coverages were on the low side.</p>
      <table-wrap position="float" id="table-2">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-2</object-id>
        <label>Table 2</label>
        <caption>
          <title>As <xref rid="table-1" ref-type="table">Table 1</xref> but for coalescent with constant population, GTR with estimated frequencies using gamma rate heterogeneity and strict clock for three different sequence lengths.</title>
          <p>Coverage of the parameters of interest (last thirteen lines in table) are all in acceptable range.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g009" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Sequence length:</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Mean and 95% HPD</td>
                <td rowspan="1" colspan="1">13.1 (5.9–15.7)</td>
                <td rowspan="1" colspan="1">5.7 (3.0–9.1)</td>
                <td rowspan="1" colspan="1">4.7 (1.5–6.5)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Entropy</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree.height</td>
                <td rowspan="1" colspan="1">91</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree.treeLength</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">91</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAC</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">98</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAG</td>
                <td rowspan="1" colspan="1">100</td>
                <td rowspan="1" colspan="1">98</td>
                <td rowspan="1" colspan="1">95</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAT</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateCG</td>
                <td rowspan="1" colspan="1">93</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateGT</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">99</td>
                <td rowspan="1" colspan="1">95</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.1</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.2</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.3</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.4</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">98</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">gammaShape</td>
                <td rowspan="1" colspan="1">93</td>
                <td rowspan="1" colspan="1">100</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">popSize</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">90</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>This demonstrates that the cube based variational distribution algorithm can work well estimating a tree, scale parameters as well as constrained sum parameters (<italic toggle="yes">i.e.</italic> frequencies) for a number of popular phylogenetic models. Many model implementations are available in BEAST 2 that only require these types of parameters, in particular nucleotide and amino acid substitution models.</p>
    </sec>
    <sec>
      <title>Cube based variational distribution algorithm performs well</title>
      <p>To see how well the cube based variational distribution algorithm scales with number of taxa, we ran a simulation study with 50, 100, 250, 500, 750 and 1,000 taxa. For each taxon set size, we ran 25 instances of the Yule/HKY/strict clock model used for the well calibrated simulation study. For each instance, alignments of 250 sites were generated. We checked that coverage of 95% HPD intervals for tree height, tree length, kappa and birth rate parameters was between 22 and 25 to verify that the inferred posterior indeed matches the true distribution. Experiments were performed on a 2021 MacBook Pro laptop in OS X using BEAST v2.7.5 and BEAGLE v4.0.0 (<xref rid="ref-34" ref-type="bibr">Suchard &amp; Rambaut, 2009</xref>).</p>
      <p><xref rid="table-3" ref-type="table">Table 3</xref> shows run times in seconds, demonstrating it is feasible to perform large analyses in a short span of time. Sampling a representative posterior trace and tree log took the least time taking up no more than 2% of total runtime. MCMC for accurately estimating the covariance matrix took most of the time, from 40% for smaller taxon sets to over 90% for the larger tree sets. MAP finding and Cholesky decomposition in comparison took less time and are taking up relatively less time with growing taxon set sizes.</p>
      <table-wrap position="float" id="table-3">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-3</object-id>
        <label>Table 3</label>
        <caption>
          <title>Run times in seconds averaged over 25 instances for various taxon set sizes (in columns).</title>
          <p>Numbers in brackets are standard deviations.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g010" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Number of taxa</th>
                <th rowspan="1" colspan="1">50</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
                <th rowspan="1" colspan="1">750</th>
                <th rowspan="1" colspan="1">1000</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">MAP finding</td>
                <td rowspan="1" colspan="1">1.17 (0.03)</td>
                <td rowspan="1" colspan="1">1.48 (0.03)</td>
                <td rowspan="1" colspan="1">2.36 (0.08)</td>
                <td rowspan="1" colspan="1">3.91 (0.08)</td>
                <td rowspan="1" colspan="1">5.30 (0.19)</td>
                <td rowspan="1" colspan="1">6.43 (0.40)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">MCMC</td>
                <td rowspan="1" colspan="1">1.15 (0.03)</td>
                <td rowspan="1" colspan="1">2.77 (0.05)</td>
                <td rowspan="1" colspan="1">12.08 (0.24)</td>
                <td rowspan="1" colspan="1">41.84 (0.72)</td>
                <td rowspan="1" colspan="1">94.74 (3.29)</td>
                <td rowspan="1" colspan="1">172.25 (8.24)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Decomposition</td>
                <td rowspan="1" colspan="1">0.45 (0.01)</td>
                <td rowspan="1" colspan="1">0.60 (0.02)</td>
                <td rowspan="1" colspan="1">0.93 (0.03)</td>
                <td rowspan="1" colspan="1">1.69 (0.04)</td>
                <td rowspan="1" colspan="1">2.88 (0.20)</td>
                <td rowspan="1" colspan="1">4.47 (0.10)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Sampling output</td>
                <td rowspan="1" colspan="1">0.23 (0.02)</td>
                <td rowspan="1" colspan="1">0.36 (0.02)</td>
                <td rowspan="1" colspan="1">0.68 (0.02)</td>
                <td rowspan="1" colspan="1">1.40 (0.03)</td>
                <td rowspan="1" colspan="1">2.18 (0.05)</td>
                <td rowspan="1" colspan="1">3.27 (0.15)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Total runtime</td>
                <td rowspan="1" colspan="1">3.00 (0.05)</td>
                <td rowspan="1" colspan="1">5.20 (0.08)</td>
                <td rowspan="1" colspan="1">16.05 (0.27)</td>
                <td rowspan="1" colspan="1">48.83 (0.79)</td>
                <td rowspan="1" colspan="1">105.10 (3.33)</td>
                <td rowspan="1" colspan="1">186.42 (8.60)</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>Total calculation time fits a quadratic function (1.70<italic toggle="yes">E</italic> − 4<italic toggle="yes">x</italic><sup>2</sup> + 1.43<italic toggle="yes">E</italic> − 2<italic toggle="yes">x</italic>) with <italic toggle="yes">R</italic><sup>2</sup> = 0.9997, so the algorithm seems to scale quadratically. The chain length used are a linear function of the number of taxa, and tree likelihood calculation time (which dominates posterior calculation time here) both scale linear in the number of taxa. Changing the former could change how the algorithm scales. The most striking feature of the table though is that all times can comfortably be expressed in seconds using just three digits before the decimal point.</p>
    </sec>
    <sec>
      <title>Summary tree</title>
      <p>Observe that by setting <bold>z</bold> = <bold>0</bold> in <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> we can obtain a tree that is at the mode of the distribution. This tree should be representative of the complete distribution so can be used as a summary tree. Note that it can have a topology that differs from all trees in the tree set to be summarised, unlike popular methods like the maximum clade credibility (MCC) tree implemented in TreeAnnotator. <xref rid="table-4" ref-type="table">Table 4</xref> shows some the sum of posterior clade support in the summary tree for MMC and matrix representation based summary trees. This is proportional to the number of internal nodes minus the Robinson-Foulds distance averaged over the tree set. The table shows that matrix based summary tree never produced worse trees and sometimes does considerably better. The log product of clade probability is used in MCC trees to find the best fitting topology. <xref rid="table-4" ref-type="table">Table 4</xref> shows even according to that criterion the matrix approach can do better, which is remarkable since MCC explicitly maximises that criterion. Further evaluation with less crude measures of summary tree quality are required to establish when matrix based summary trees outperform MCC trees.</p>
      <table-wrap position="float" id="table-4">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-4</object-id>
        <label>Table 4</label>
        <caption>
          <title>Sum and log product of posterior clade support over all clades in the summary tree for MCC tree and matrix representation based tree.</title>
          <p>Higher is better. The entries marked with asterisk ignore zero support clades (one clade for cichlids, three for NZ votes). The matrix approach is never worse and sometimes considerably better.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g011" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th align="center" colspan="3" rowspan="1">Sum of clade</th>
                <th align="center" colspan="3" rowspan="1">Log product of clade</th>
              </tr>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th align="center" colspan="3" rowspan="1">probability</th>
                <th align="center" colspan="3" rowspan="1">probability</th>
              </tr>
              <tr>
                <th rowspan="1" colspan="1">Data set</th>
                <th rowspan="1" colspan="1">MCC</th>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Matrix</th>
                <th rowspan="1" colspan="1">MCC</th>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Matrix</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Apes</td>
                <td rowspan="1" colspan="1">4.8</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">4.8</td>
                <td rowspan="1" colspan="1">−0.2</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">−0.2</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">IE</td>
                <td rowspan="1" colspan="1">136.9</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">138.9</td>
                <td rowspan="1" colspan="1">−35.0</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−29.2</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">AARS</td>
                <td rowspan="1" colspan="1">133.6</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">142.9</td>
                <td rowspan="1" colspan="1">−128.4</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−90.8</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Cichlids</td>
                <td rowspan="1" colspan="1">91.7</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">93.7</td>
                <td rowspan="1" colspan="1">−42.3</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−34.7*</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">NZ votes</td>
                <td rowspan="1" colspan="1">26.7</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">34.1</td>
                <td rowspan="1" colspan="1">−297.1</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−217.6*</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Pama-Nyungan</td>
                <td rowspan="1" colspan="1">255.6</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">262.4</td>
                <td rowspan="1" colspan="1">−80.5</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−59.3</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Species</td>
                <td rowspan="1" colspan="1">27.5</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">27.5</td>
                <td rowspan="1" colspan="1">−2.6</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">−2.6</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p><bold>Matrix and cube representations can accurately represent tree distributions:</bold> For tree distributions with low to medium entropy (<xref rid="ref-24" ref-type="bibr">Lewis et al., 2016</xref>) based on its conditional clade distribution (<xref rid="ref-22" ref-type="bibr">Larget, 2013</xref>), we demonstrated that a substantial part of the posterior can be represented using a single cube. For those cases it is possible to do fast inference of rooted time trees using a cube based variational distribution approach outlined in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> . For tree distributions with high entropy, it may not be possible to capture a substantial portion of the posterior by a single cube. An example is a sample over 50 taxa from a Yule prior (<xref rid="supp-1" ref-type="supplementary-material">Fig. S1</xref>), where a cube representation will suggest much older internal node heights with higher clade support than the original distribution. Using more than one cube might elevate this somewhat, but since there can be overlap between the trees represented by the various cubes, and this overlap is hard to characterise (L. Berling, 2023, personal communication) this may not be a fruitful avenue. A more productive way may be to use more entries in the distance matrix. This breaks the bijective property of the transformation, but facilitates a greater coverage of the full tree space. This will result increase the non-linearity of dependencies between the various matrix entries due to correlations changing when topologies change. Normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) allow for greater flexibility in representing such non-linear dependencies, and may provide a way to transform a multi-variate normal distribution into a tree distribution.</p>
    <p>One situation where node height distributions can deviate significantly from being log-normally distributed is when node calibrations are used in the tree that interact with each other. For example, clade <italic toggle="yes">A</italic> may be known to be at least <italic toggle="yes">X</italic> years old, so a uniform prior with lower bound of <italic toggle="yes">X</italic> seems appropriate. When clade <italic toggle="yes">B</italic> (consisting of clade <italic toggle="yes">A</italic> plus 1 node so that the MRCA of <italic toggle="yes">B</italic> is the parent of the MRCA of <italic toggle="yes">A</italic>) is assigned a distribution with a mean not very far above <italic toggle="yes">X</italic> (with large variance), the age distribution of the MRCA of <italic toggle="yes">B</italic> will be lower bounded by <italic toggle="yes">X</italic> as well. In this case, a log-transform may not be appropriate for accurate capturing of this distribution, and a matrix representation may fail to accurately capture such distribution. Again, normalising flows could be employed to address this.</p>
    <p><bold>Optimisation based variational Bayesian:</bold> Variational Bayesian algorithms are usually optimisation based, where the evidence lower bound (ELBO) is maximised. The ELBO is proportional to the posterior plus a term that measures the distance between the true and approximate distribution. The benefit of maximisation over MCMC is that there are no restrictions on optimisation proposals unlike with MCMC where one needs to be careful to use appropriate Hastings ratios in order to ensure there is no bias in sampling from the posterior. One way to optimise the ELBO is by the hugely popular stochastic gradient ascent algorithm, which randomly draws a new state, calculates the gradient of the ELBO with respect to a random subset of parameters and moves parameters in the state in the direction of the gradient. This process is iterated until convergence is reached. However, there are some issues with gradient ascent: a gradient is required, which can be computationally expensive. Furthermore, it has domain specific parameters, such as learning rate, learning rate scheme, and parameter subset size. Also, random subsets may need to be tuned for efficient exploitation of subsets. Finally, the convergence criterion has large impact on the number of iterations. Since points are drawn stochastically, the convergence criterion needs to deal with noise. Instead of dealing with all these issues, here we introduced an MCMC based algorithm to learn a variational distribution that benefits from all MCMC related optimisations implemented in BEAST 2 (such as adaptive operator tuning). It serves as a proof of concept demonstrating that cube spaces are suitable for variational inference. Of course, this still leave opportunities for ELBO maximisation implementations of cube based variational inference.</p>
    <p><bold>Cube-VB algorithm parameters:</bold> Notwithstanding the issues of ELBO optimisation based VB, the MCMC based approach to learning a variational distribution we introduced in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> has a number of parameters that need to be specified, in particular the start and end temperatures and number of repeats for simulated annealing for finding a (close to) MAP state. We chose a start temperature of 0.1 and end temperature of 0.01, which worked quite well for our experiments, so this seems a reasonable option. Putting in more than 25 repeats barely led to improvement of the posterior of the MAP state, but halving it turned out to be detrimental (well calibrated simulation studies did not pass).</p>
    <p>Another parameter to set is the length of MCMC chain for estimating the covariance matrix. The heuristic implemented in the <monospace>cubevb</monospace> package for BEAST 2 is to count the number of parameters and multiply with a user specified value. In our experiments with the HKY model, a multiplier of 1,000 was sufficient. The more samples, the more accurate the matrix estimate but the longer it takes for the algorithm to finish. In that sense, it nicely fits the class of online algorithms (<xref rid="ref-4" ref-type="bibr">Bouckaert, Collienne &amp; Gavryushkin, 2022</xref>) that at any time can provide an answer, but the answer becomes more accurate the longer the algorithm runs. Detecting when longer runs do not increase accuracy of the posterior any more is an open question where automated convergence techniques employed for standard MCMC (<xref rid="ref-1" ref-type="bibr">Berling, Bouckaert &amp; Gavryushkin, 2023</xref>) could be exploited. These are all based on running two analyses in parallel and measuring the difference in the distributions that are obtained.</p>
    <p><bold>Why the Cube-VB algorithm works:</bold> Since plain MCMC is used in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> one may wonder why this is more efficient than just running full MCMC and not being restricted to a cube space. The reason for this stems from the assumption that the true distribution can be represented as a transformation of a multivariate normal distribution. Consider the <italic toggle="yes">κ</italic> parameter for the HKY model and a log-transformation. In practice, we see that <italic toggle="yes">κ</italic> is close to log-normally distributed, so representing the posterior as a normal with log-transform leads to little distortion. Now notice that we only have to estimate the mean and variance of the log-normal under this assumption, instead of estimating a full unparameterised distribution, which is what we would be doing with full MCMC. So, even though a small MCMC sample will not be sufficient to accurately represent the distribution of <italic toggle="yes">κ</italic> and statistics like 95% HPDs, there will be sufficient information to accurately estimate two parameters of a log-normal, from which statistics like 95% HPDs then can accurately be inferred.</p>
    <p><bold>Variational Bayesian for matrix representation:</bold> The Cube-VB algorithm can be adapted to suitable matrix representations by replacing Step 2 by some method of identifying which entries in the matrix need to be specified and which entries can be left unspecified. Step 3 would need adjustment in the operators to ensure all possible tree topologies that can be represented by the matrix are available to be proposed. It is an open problem what the best strategy is for identifying which and how many entries should be specified. Since a cube can capture a substantial part of a posterior, identifying a cube could be a first step followed by filling in entries where clades represented have substantial support.</p>
  </sec>
  <sec>
    <title>Conclusion</title>
    <p>Matrix space is introduced as a representation of all or, in the case of cubes, a significant part of tree space. We demonstrated for simple phylogenetic models it allows fast inference of the most relevant part of the tree posterior using just a cube representation, thus capturing most of the uncertainty in the posterior distribution.</p>
    <p>There are many venues to extend and develop this work, in particular into the area of more sophisticated phylogenetic models. Here we mention just a few of the more commonly used models and potential issues implementing inference for them in matrix representation, in particular cubes:</p>
    <list list-type="simple" id="list-3">
      <list-item>
        <label> •</label>
        <p>In general, finding an appropriate subset of pairwise distances, <italic toggle="yes">i.e.</italic> subset of entries in the matrix, an obvious open problem. Finding the optimal ordering for a cube is an instance of this problem. It is probably related to finding a good ordering for drawing trees in DensiTree (<xref rid="ref-6" ref-type="bibr">Bouckaert, 2010</xref>) for which various heuristics have been developed. It is not clear how to transfer these heuristics to the VB setting and new heuristics may need to be developed.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Flexible nonparametric tree priors take epochs in accounts like the Bayesian skyline plot (<xref rid="ref-12" ref-type="bibr">Drummond et al., 2005</xref>) and birth death skyline plot (<xref rid="ref-32" ref-type="bibr">Stadler et al., 2013</xref>) and are widely used but may be challenging to parameterise in a variational Bayesian setting due to their discrete components. Models that integrate out most parameters and have only a single continuous parameter, like BICEPS and multi Yule (<xref rid="ref-7" ref-type="bibr">Bouckaert, 2022</xref>), can be good alternatives and should be straightforward to implement in our cube VB algorithm.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Relaxed clocks (<xref rid="ref-11" ref-type="bibr">Drummond et al., 2006</xref>; <xref rid="ref-10" ref-type="bibr">Douglas, Zhang &amp; Bouckaert, 2021</xref>) need to be adapted for cube space. Due to discontinuities between different topologies, simply associating a (log)normal branch rate distribution with each taxon and each dimension of the cube may not be sufficient. Normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) may be required to capture relaxed branch rate distributions.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Dated tips put restrictions on the height of internal nodes. When tip dates are uncertain and need te be sampled from a distribution, this adds extra dimensions to the multivariate normal representation of the posterior.</p>
      </list-item>
    </list>
    <p>On the other hand, extensions into empirical models of amino acids, models that integrate out internal states like ancestral reconstruction (<xref rid="ref-23" ref-type="bibr">Lemey et al., 2009</xref>) and phylogeography (<xref rid="ref-3" ref-type="bibr">Bouckaert, 2016</xref>) should be straightforward to adapt.</p>
    <p>In summary, there are many exciting new opportunities waiting to be explored in cube and matrix space for fast phylogenetic inference.</p>
  </sec>
  <sec sec-type="supplementary-material" id="supplemental-information">
    <title>Supplemental Information</title>
    <supplementary-material id="supp-1" position="float" content-type="local-data">
      <object-id pub-id-type="doi">10.7717/peerj.17276/supp-1</object-id>
      <label>Supplemental Information 1</label>
      <caption>
        <title>Tree distribution sampled from Yule prior and its cube representation</title>
        <p>As <xref rid="fig-3" ref-type="fig">Fig. 3</xref>, but with a tree sampled from a Yule prior with 50 taxa, resulting in a tree set sampled uniformly over ranked trees and has high entropy. The cube representation of this tree set has substantially older internal nodes and higher clade support for many clades than the original tree set.</p>
      </caption>
      <media xlink:href="peerj-12-17276-s001.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>This work was greatly helped by stimulating discussions with members of the Center of Computational Evolution at the University of Auckland, in particular with Alexei Drummond. Special thanks to Jordan Douglas for proofreading.</p>
  </ack>
  <sec sec-type="additional-information">
    <title>Additional Information and Declarations</title>
    <fn-group content-type="competing-interests">
      <title>Competing Interests</title>
      <fn id="conflict-1" fn-type="COI-statement">
        <p>The authors declare there are no competing interests.</p>
      </fn>
    </fn-group>
    <fn-group content-type="author-contributions">
      <title>Author Contributions</title>
      <fn id="contribution-1" fn-type="con">
        <p><xref rid="author-1" ref-type="contrib">Remco R. Bouckaert</xref> conceived and designed the experiments, performed the experiments, analyzed the data, prepared figures and/or tables, authored or reviewed drafts of the article, and approved the final draft.</p>
      </fn>
    </fn-group>
    <fn-group content-type="other">
      <title>Data Availability</title>
      <fn id="addinfo-1">
        <p>The following information was supplied regarding data availability:</p>
        <p>The data and code is available at GitHub and Zenodo:</p>
        <p>- <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link>
</p>
        <p>- Remco, B. (2024). CubeVB package for BEAST2: archive of <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link>. In Variational Bayesian Phylogenies through Matrix Representation of Tree Space: Vol. tbd (v1.0.1). Zenodo. <ext-link xlink:href="https://doi.org/10.5281/zenodo.10594658" ext-link-type="uri">https://doi.org/10.5281/zenodo.10594658</ext-link>.</p>
      </fn>
    </fn-group>
  </sec>
  <ref-list content-type="authoryear">
    <title>References</title>
    <ref id="ref-1">
      <label>Berling, Bouckaert &amp; Gavryushkin (2023)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Berling</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>Automated convergence diagnostic for phylogenetic MCMC analyses</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2023.08.10.552869</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-2">
      <label>Betancourt (2012)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Betancourt</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2012">2012</year>
        <article-title>Cruising the simplex: Hamiltonian Monte Carlo and the Dirichlet distribution</article-title>
        <source>AIP conference proceedings 31st</source>
        <volume>1443</volume>
        <issue>1</issue>
        <fpage>157</fpage>
        <lpage>164</lpage>
        <pub-id pub-id-type="doi">10.1063/1.3703631</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-3">
      <label>Bouckaert (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>Phylogeography by diffusion on a sphere: whole world phylogeography</article-title>
        <source>PeerJ</source>
        <volume>4</volume>
        <elocation-id>e2406</elocation-id>
        <pub-id pub-id-type="doi">10.7717/peerj.2406</pub-id>
        <pub-id pub-id-type="pmid">27651992</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-4">
      <label>Bouckaert, Collienne &amp; Gavryushkin (2022)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Collienne</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Online Bayesian analysis with BEAST 2</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2022.05.03.490538</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-5">
      <label>Bouckaert et al. (2019)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Vaughan</surname>
            <given-names>TG</given-names>
          </name>
          <name>
            <surname>Barido-Sottani</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Duchêne</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Fourment</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gavryushkina</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Heled</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>De Maio</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Matschiner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Mendes</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Müller</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Ogilvie</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Plessis</surname>
            <given-names>Ld</given-names>
          </name>
          <name>
            <surname>Popinga</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rasmussen</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Siveroni</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>C-H</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Stadler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2019">2019</year>
        <article-title>BEAST 2.5: an advanced software platform for Bayesian evolutionary analysis</article-title>
        <source>PLOS Computational Biology</source>
        <volume>15</volume>
        <issue>4</issue>
        <elocation-id>e1006650</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1006650</pub-id>
        <pub-id pub-id-type="pmid">30958812</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-6">
      <label>Bouckaert (2010)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2010">2010</year>
        <article-title>DensiTree: making sense of sets of phylogenetic trees</article-title>
        <source>Bioinformatics</source>
        <volume>26</volume>
        <issue>10</issue>
        <fpage>1372</fpage>
        <lpage>1373</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btq110</pub-id>
        <pub-id pub-id-type="pmid">20228129</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-7">
      <label>Bouckaert (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>An efficient coalescent epoch model for Bayesian phylogenetic inference</article-title>
        <source>Systematic Biology</source>
        <volume>71</volume>
        <issue>6</issue>
        <fpage>1549</fpage>
        <lpage>1560</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syac015</pub-id>
        <pub-id pub-id-type="pmid">35212733</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-8">
      <label>Bouckaert, Bowern &amp; Atkinson (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Bowern</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Atkinson</surname>
            <given-names>QD</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>The origin and expansion of Pama–Nyungan languages across Australia</article-title>
        <source>Nature Ecology &amp; Evolution</source>
        <volume>2</volume>
        <issue>4</issue>
        <fpage>741</fpage>
        <lpage>749</lpage>
        <pub-id pub-id-type="doi">10.1038/s41559-018-0489-3</pub-id>
        <pub-id pub-id-type="pmid">29531347</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-9">
      <label>Carter Jr et al. (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Carter Jr</surname>
            <given-names>CW</given-names>
          </name>
          <name>
            <surname>Popinga</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>PR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Multidimensional phylogenetic metrics identify Class I Aminoacyl-tRNA synthetase evolutionary mosaicity and inter-modular coupling</article-title>
        <source>International Journal of Molecular Sciences</source>
        <volume>23</volume>
        <issue>3</issue>
        <fpage>1520</fpage>
        <lpage>1544</lpage>
        <pub-id pub-id-type="doi">10.3390/ijms23031520</pub-id>
        <pub-id pub-id-type="pmid">35163448</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-10">
      <label>Douglas, Zhang &amp; Bouckaert (2021)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Douglas</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2021">2021</year>
        <article-title>Adaptive dating and fast proposals: revisiting the phylogenetic relaxed clock model</article-title>
        <source>PLOS Computational Biology</source>
        <volume>17</volume>
        <issue>2</issue>
        <elocation-id>e1008322</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1008322</pub-id>
        <pub-id pub-id-type="pmid">33529184</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-11">
      <label>Drummond et al. (2006)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Ho</surname>
            <given-names>SYW</given-names>
          </name>
          <name>
            <surname>Phillips</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2006">2006</year>
        <article-title>Relaxed phylogenetics and dating with confidence</article-title>
        <source>PLOS Biology</source>
        <volume>4</volume>
        <issue>5</issue>
        <elocation-id>e88</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.0040088</pub-id>
        <pub-id pub-id-type="pmid">16683862</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-12">
      <label>Drummond et al. (2005)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Shapiro</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Pybus</surname>
            <given-names>OG</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2005">2005</year>
        <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences</article-title>
        <source>Molecular Biology and Evolution</source>
        <volume>22</volume>
        <issue>5</issue>
        <fpage>1185</fpage>
        <lpage>1192</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msi103</pub-id>
        <pub-id pub-id-type="pmid">15703244</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-13">
      <label>Florek et al. (1951)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Florek</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Łukaszewicz</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Perkal</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Steinhaus</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Zubrzycki</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1951">1951</year>
        <article-title>Sur la liaison et la division des points d’un ensemble fini</article-title>
        <volume>2</volume>
        <issue>3–4</issue>
        <source>Colloquium Mathematicum</source>
        <fpage>282</fpage>
        <lpage>285</lpage>
        <pub-id pub-id-type="doi">10.4064/cm-2-3-4-282-285</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-14">
      <label>Fourment &amp; Darling (2019)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fourment</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Darling</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2019">2019</year>
        <article-title>Evaluating probabilistic programming and fast variational Bayesian inference in phylogenetics</article-title>
        <source>PeerJ</source>
        <volume>7</volume>
        <elocation-id>e8272</elocation-id>
        <pub-id pub-id-type="doi">10.7717/peerj.8272</pub-id>
        <pub-id pub-id-type="pmid">31976168</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-15">
      <label>Gavryushkin &amp; Drummond (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>The space of ultrametric phylogenetic trees</article-title>
        <source>Journal of Theoretical Biology</source>
        <volume>403</volume>
        <fpage>197</fpage>
        <lpage>208</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jtbi.2016.05.001</pub-id>
        <pub-id pub-id-type="pmid">27188249</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-16">
      <label>Heggarty et al. (2023)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heggarty</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Anderson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Scarborough</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>King</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jocz</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Kümmel</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Jügel</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Irslinger</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Pooth</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Liljegren</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Strand</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Haig</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Macák</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Anonby</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Pronk</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Belyaev</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Dewey-Findell</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Boutilier</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Freiberg</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Tegethoff</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Serangeli</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Liosis</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Stroński</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Schulte</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Kumar Gupta</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Haak</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Atkinson</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Greenhill</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gray</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>Language trees with sampled ancestors support a hybrid model for the origin of Indo-European languages</article-title>
        <source>Science</source>
        <volume>381</volume>
        <issue>6656</issue>
        <elocation-id>eabg0818</elocation-id>
        <pub-id pub-id-type="doi">10.1126/science.abg0818</pub-id>
        <pub-id pub-id-type="pmid">37499002</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-17">
      <label>Heled &amp; Drummond (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heled</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Bayesian inference of species trees from multilocus data</article-title>
        <source>Molecular Biology and Evolution</source>
        <volume>27</volume>
        <issue>3</issue>
        <fpage>570</fpage>
        <lpage>580</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msp274</pub-id>
        <pub-id pub-id-type="pmid">19906793</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-18">
      <label>Höhna et al. (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Höhna</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Landis</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Heath</surname>
            <given-names>TA</given-names>
          </name>
          <name>
            <surname>Boussau</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lartillot</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Moore</surname>
            <given-names>BR</given-names>
          </name>
          <name>
            <surname>Huelsenbeck</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Ronquist</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>RevBayes: Bayesian phylogenetic inference using graphical models and an interactive model-specification language</article-title>
        <source>Systematic Biology</source>
        <volume>65</volume>
        <issue>4</issue>
        <fpage>726</fpage>
        <lpage>736</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syw021</pub-id>
        <pub-id pub-id-type="pmid">27235697</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-19">
      <label>Huelsenbeck &amp; Ronquist (2001)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huelsenbeck</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Ronquist</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2001">2001</year>
        <article-title>MrBayes: bayesian inference of phylogenetic trees</article-title>
        <source>Bioinformatics</source>
        <volume>17</volume>
        <issue>8</issue>
        <fpage>754</fpage>
        <lpage>755</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/17.8.754</pub-id>
        <pub-id pub-id-type="pmid">11524383</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-20">
      <label>Jiang, Tabaghi &amp; Mirarab (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Tabaghi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Learning hyperbolic embedding for phylogenetic tree placement and updates</article-title>
        <source>Biology</source>
        <volume>11</volume>
        <issue>9</issue>
        <fpage>1256</fpage>
        <pub-id pub-id-type="doi">10.3390/biology11091256</pub-id>
        <pub-id pub-id-type="pmid">36138735</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-21">
      <label>Jordan et al. (1999)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Ghahramani</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Jaakkola</surname>
            <given-names>TS</given-names>
          </name>
          <name>
            <surname>Saul</surname>
            <given-names>LK</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1999">1999</year>
        <article-title>An introduction to variational methods for graphical models</article-title>
        <source>Machine Learning</source>
        <volume>37</volume>
        <issue>2</issue>
        <fpage>183</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1023/A:1007665907178</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-22">
      <label>Larget (2013)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Larget</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2013">2013</year>
        <article-title>The estimation of tree posterior probabilities using conditional clade probability distributions</article-title>
        <source>Systematic Biology</source>
        <volume>62</volume>
        <issue>4</issue>
        <fpage>501</fpage>
        <lpage>511</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syt014</pub-id>
        <pub-id pub-id-type="pmid">23479066</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-23">
      <label>Lemey et al. (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lemey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Bayesian phylogeography finds its roots</article-title>
        <source>PLOS Computational Biology</source>
        <volume>5</volume>
        <issue>9</issue>
        <elocation-id>e1000520</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1000520</pub-id>
        <pub-id pub-id-type="pmid">19779555</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-24">
      <label>Lewis et al. (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lewis</surname>
            <given-names>PO</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>M-H</given-names>
          </name>
          <name>
            <surname>Kuo</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lewis</surname>
            <given-names>LA</given-names>
          </name>
          <name>
            <surname>Fučíková</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Neupane</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Y-B</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>Estimating Bayesian phylogenetic information content</article-title>
        <source>Systematic Biology</source>
        <volume>65</volume>
        <issue>6</issue>
        <fpage>1009</fpage>
        <lpage>1023</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syw042</pub-id>
        <pub-id pub-id-type="pmid">27155008</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-25">
      <label>Matschiner et al. (2017)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matschiner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Musilová</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Barth</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Starostová</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Salzburger</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Steel</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2017">2017</year>
        <article-title>Bayesian phylogenetic estimation of clade ages supports trans-Atlantic dispersal of cichlid fishes</article-title>
        <source>Systematic Biology</source>
        <volume>66</volume>
        <issue>1</issue>
        <fpage>3</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syx025</pub-id>
        <pub-id pub-id-type="pmid">28173588</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-26">
      <label>Matsumoto, Mimori &amp; Fukunaga (2021)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matsumoto</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Mimori</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fukunaga</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2021">2021</year>
        <article-title>Novel metric for hyperbolic phylogenetic tree embeddings</article-title>
        <source>Biology Methods and Protocols</source>
        <volume>6</volume>
        <issue>1</issue>
        <fpage>bpab006</fpage>
        <pub-id pub-id-type="doi">10.1093/biomethods/bpab006</pub-id>
        <pub-id pub-id-type="pmid">33928190</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-27">
      <label>Mau, Newton &amp; Larget (1999)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mau</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Newton</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Larget</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1999">1999</year>
        <article-title>Bayesian phylogenetic inference via Markov chain Monte Carlo methods</article-title>
        <source>Biometrics</source>
        <volume>55</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1111/j.0006-341X.1999.00001.x</pub-id>
        <pub-id pub-id-type="pmid">11318142</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-28">
      <label>Mendes et al. (2023)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Mendes</surname>
            <given-names>FK</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Carvalho</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>How to validate a Bayesian evolutionary model</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2024.02.11.579856</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-29">
      <label>Rambaut et al. (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Baele</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Posterior summarization in Bayesian phylogenetics using Tracer 1.7</article-title>
        <source>Systematic Biology</source>
        <volume>67</volume>
        <issue>5</issue>
        <fpage>901</fpage>
        <lpage>904</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syy032</pub-id>
        <pub-id pub-id-type="pmid">29718447</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-30">
      <label>Rezende &amp; Mohamed (2015)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rezende</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Mohamed</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2015">2015</year>
        <article-title>Variational inference with normalizing flows</article-title>
        <pub-id pub-id-type="arxiv">1505.05770</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-31">
      <label>Sokal &amp; Michener (1958)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sokal</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Michener</surname>
            <given-names>CD</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1958">1958</year>
        <article-title>A statiscal method for evaluating systematic relationships</article-title>
        <source>University of Kansas Science Bulletin</source>
        <volume>38</volume>
        <fpage>1409</fpage>
        <lpage>1438</lpage>
      </element-citation>
    </ref>
    <ref id="ref-32">
      <label>Stadler et al. (2013)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stadler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Bonhoeffer</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2013">2013</year>
        <article-title>Birth–death skyline plot reveals temporal changes of epidemic spread in HIV and hepatitis C virus (HCV)</article-title>
        <source>Proceedings of the National Academy of Sciences of the United States of America</source>
        <volume>110</volume>
        <issue>1</issue>
        <fpage>228</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1207965110</pub-id>
        <pub-id pub-id-type="pmid">23248286</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-33">
      <label>Suchard et al. (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Lemey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Baele</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Ayres</surname>
            <given-names>DL</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Bayesian phylogenetic and phylodynamic data integration using BEAST 1.10</article-title>
        <source>Virus Evolution</source>
        <volume>4</volume>
        <issue>1</issue>
        <fpage>vey016</fpage>
        <pub-id pub-id-type="doi">10.1093/ve/vey016</pub-id>
        <pub-id pub-id-type="pmid">29942656</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-34">
      <label>Suchard &amp; Rambaut (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Many-core algorithms for statistical phylogenetics</article-title>
        <source>Bioinformatics</source>
        <volume>25</volume>
        <issue>11</issue>
        <fpage>1370</fpage>
        <lpage>1376</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp244</pub-id>
        <pub-id pub-id-type="pmid">19369496</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-35">
      <label>Talts et al. (2018)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Talts</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Betancourt</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Simpson</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Vehtari</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Gelman</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Validating Bayesian inference algorithms with simulation-based calibration</article-title>
        <pub-id pub-id-type="arxiv">1804.06788</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-36">
      <label>Van Laarhoven et al. (1987)</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Van Laarhoven</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Aarts</surname>
            <given-names>EH</given-names>
          </name>
          <name>
            <surname>van Laarhoven</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Aarts</surname>
            <given-names>EH</given-names>
          </name>
        </person-group>
        <article-title>Simulated annealing</article-title>
        <source>Simulated Annealing: Theory and Applications. Mathematics and its Applications</source>
        <volume>vol. 37</volume>
        <year iso-8601-date="1987">1987</year>
        <publisher-loc>Dordrecht</publisher-loc>
        <publisher-name>Springer</publisher-name>
        <comment>. <uri xlink:href="https://doi.org/10.1007/978-94-015-7744-1_2">https://doi.org/10.1007/978-94-015-7744-1_2</uri>
</comment>
      </element-citation>
    </ref>
    <ref id="ref-37">
      <label>Voznica et al. (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Voznica</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhukova</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Boskova</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Saulnier</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lemoine</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Moslonka-Lefebvre</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gascuel</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Deep learning from phylogenies to uncover the epidemiological dynamics of outbreaks</article-title>
        <source>Nature Communications</source>
        <volume>13</volume>
        <issue>1</issue>
        <fpage>3896</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-31511-0</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-38">
      <label>Zhang (2020)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2020">2020</year>
        <article-title>Improved variational bayesian phylogenetic inference with normalizing flows</article-title>
        <pub-id pub-id-type="arxiv">2012.00459</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-39">
      <label>Zhang &amp; Matsen IV (2018)</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Matsen IV</surname>
            <given-names>FA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Variational Bayesian phylogenetic inference</article-title>
        <conf-name>International conference on learning representations</conf-name>
        <uri xlink:href="https://openreview.net/pdf?id=SJVmjjR9FX">https://openreview.net/pdf?id=SJVmjjR9FX</uri>
      </element-citation>
    </ref>
    <ref id="ref-40">
      <label>Zhang &amp; Matsen IV (2022)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Matsen IV</surname>
            <given-names>FA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>A variational approach to bayesian phylogenetic inference</article-title>
        <pub-id pub-id-type="arxiv">2204.07747</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PeerJ</journal-id>
    <journal-id journal-id-type="iso-abbrev">PeerJ</journal-id>
    <journal-id journal-id-type="publisher-id">peerj</journal-id>
    <journal-title-group>
      <journal-title>PeerJ</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2167-8359</issn>
    <publisher>
      <publisher-name>PeerJ Inc.</publisher-name>
      <publisher-loc>San Diego, USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">11064865</article-id>
    <article-id pub-id-type="publisher-id">17276</article-id>
    <article-id pub-id-type="doi">10.7717/peerj.17276</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Bioinformatics</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Computational Biology</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Evolutionary Studies</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Mathematical Biology</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Variational Bayesian phylogenies through matrix representation of tree space</article-title>
    </title-group>
    <contrib-group>
      <contrib id="author-1" contrib-type="author" corresp="yes">
        <name>
          <surname>Bouckaert</surname>
          <given-names>Remco R.</given-names>
        </name>
        <email>remco@cs.auckland.ac.nz</email>
        <xref rid="aff-1" ref-type="aff"/>
      </contrib>
      <aff id="aff-1"><institution>School of Computer Science, University of Auckland</institution>, <city>Auckland</city>, <country>New Zealand</country></aff>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Procter</surname>
          <given-names>James</given-names>
        </name>
      </contrib>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>4</month>
      <year iso-8601-date="2024">2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>12</volume>
    <elocation-id>e17276</elocation-id>
    <history>
      <date date-type="received" iso-8601-date="2023-10-28">
        <day>28</day>
        <month>10</month>
        <year iso-8601-date="2023">2023</year>
      </date>
      <date date-type="accepted" iso-8601-date="2024-04-01">
        <day>1</day>
        <month>4</month>
        <year iso-8601-date="2024">2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>©2024 Bouckaert</copyright-statement>
      <copyright-year>2024</copyright-year>
      <copyright-holder>Bouckaert</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, reproduction and adaptation in any medium and for any purpose provided that it is properly attributed. For attribution, the original author(s), title, publication source (PeerJ) and either DOI or URL of the article must be cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="https://peerj.com/articles/17276"/>
    <abstract>
      <p>In this article, we study the distance matrix as a representation of a phylogeny by way of hierarchical clustering. By defining a multivariate normal distribution on (a subset of) the entries in a matrix, this allows us to represent a distribution over rooted time trees. Here, we demonstrate tree distributions can be represented accurately this way for a number of published tree distributions. Though such a representation does not map to unique trees, restriction to a subspace, in particular one we call a “cube”, makes the representation bijective at the cost of not being able to represent all possible trees. We introduce an algorithm “cubeVB” specifically for cubes and show through well calibrated simulation study that it is possible to recover parameters of interest like tree height and length. Although a cube cannot represent all of tree space, it is a great improvement over a single summary tree, and it opens up exciting new opportunities for scaling up Bayesian phylogenetic inference. We also demonstrate how to use a matrix representation of a tree distribution to get better summary trees than commonly used maximum clade credibility trees. An open source implementation of the cubeVB algorithm is available from <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link> as the <monospace>cubevb</monospace> package for BEAST 2.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>Bayesian phylogenetics</kwd>
      <kwd>Variational Bayes</kwd>
      <kwd>BEAST 2</kwd>
      <kwd>Tree space</kwd>
      <kwd>Summary trees</kwd>
    </kwd-group>
    <funding-group>
      <funding-statement>The authors received no funding for this work.</funding-statement>
    </funding-group>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>The workhorse of Bayesian phylogenetics is the Markov chain Monte Carlo (MCMC) algorithm, which is widely used to reconstruct the evolutionary relationships among a set of biological sequences (<xref rid="ref-19" ref-type="bibr">Huelsenbeck &amp; Ronquist, 2001</xref>; <xref rid="ref-18" ref-type="bibr">Höhna et al., 2016</xref>; <xref rid="ref-33" ref-type="bibr">Suchard et al., 2018</xref>; <xref rid="ref-5" ref-type="bibr">Bouckaert et al., 2019</xref>). In practice, MCMC is limited to handling phylogenies of at most a few thousand taxa. With the advent of ever cheaper sequencing techniques, these algorithms are overwhelmed by the amount of available data. Consequently, maximum likelihood methods are employed, which can handle these amounts of data because they are based on optimisation algorithms.</p>
    <p>Variational Bayesian (VB) methods (<xref rid="ref-21" ref-type="bibr">Jordan et al., 1999</xref>) are also based on optimisation, so offer the prospect of being more scalable than MCMC. VB methods usually represent a posterior distribution as a transformation of a multivariate normal distribution on Euclidean space. The form of the transformation is crucial in how accurate the posterior distribution can be represented. Usually, stochastic gradient ascent is used as the optimisation algorithm, which relies on the transformation being a bijection between trees and their transformed representation. This provides a major hurdle for phylogentic inference, since existing tree spaces are either not bijective (like spanning trees between points in hyperbolic space (<xref rid="ref-26" ref-type="bibr">Matsumoto, Mimori &amp; Fukunaga, 2021</xref>; <xref rid="ref-20" ref-type="bibr">Jiang, Tabaghi &amp; Mirarab, 2022</xref>)) or do not allow representation as a Euclidean space (like ultrametric space (<xref rid="ref-15" ref-type="bibr">Gavryushkin &amp; Drummond, 2016</xref>)).</p>
    <p>Prior phylogenetic VB implementations got around these restrictions by being limited to fixed tree topologies (<xref rid="ref-14" ref-type="bibr">Fourment &amp; Darling, 2019</xref>; <xref rid="ref-38" ref-type="bibr">Zhang, 2020</xref>). Others do not handle timed trees (<xref rid="ref-39" ref-type="bibr">Zhang &amp; Matsen IV, 2018</xref>) which are important to many practical and scientific questions. The ones that handle time trees (<xref rid="ref-40" ref-type="bibr">Zhang &amp; Matsen IV, 2022</xref>), have not demonstrated to scale to scale to 1,000 taxa.</p>
    <p>Here, we explore matrix representations of tree space. The basic idea is to use a symmetric matrix with dimension equal to the number of taxa and apply a hierarchical clustering algorithm like the single link clustering algorithm (<xref rid="ref-13" ref-type="bibr">Florek et al., 1951</xref>) to obtain a tree with internal node heights specified by the values of the matrix. The entries in the matrix form a Euclidean space, however there are many ways to represent the same tree, so the transformation is not bijective. A “cube” is a matrix where we restrict ourselves to the 1-off-diagonal entries of the matrix (and leave the rest at infinity) and the transformation becomes a bijection, but cannot represent all possible trees any more. In this article, we demonstrate it is possible to capture the most interesting part of posterior tree space using this approach. We implement an algorithm for basic phylogenetic models, infer the parameters of the multivariate normal distribution and show through a well calibrated simulation study that it captures important parameters of interest. We demonstrate that it scales well.</p>
    <p>Representations similar to the cube representation have been used before in phylogenetic inference. For example, in training neural nets to uncover the epidemiological dynamics of outbreaks (<xref rid="ref-37" ref-type="bibr">Voznica et al., 2022</xref>), where the “compact bijective ladderised vector” orders taxa so that branch support for taxa on the left is maximised. Instead of using the distance between taxa, the distance from internal nodes to the root is used. In MCMC, tree proposals like the “node reheight” operator in *BEAST (<xref rid="ref-17" ref-type="bibr">Heled &amp; Drummond, 2009</xref>), order taxa through a tree traversal. At binary splits, the first or second branch is randomly traversed first, resulting in a random ordering. Then, an internal node is randomly selected, and its height is randomly moved (constrained by gene tree heights). Finally, a tree is reconstructed to maintain consistency with the ordering and node heights of internal nodes between taxa. <xref rid="ref-27" ref-type="bibr">Mau, Newton &amp; Larget (1999)</xref> refers to this as the “canonical representation” and proposes its use an MCMC proposal as well. This is equivalent to selecting a cube with random order consistent with the tree, then perturbing a distance in the matrix and reconstructing the tree.</p>
    <p>Matrix and specifically cube representations offer a few other benefits. Many post-hoc analyses such as ancestral reconstruction, trait inference or phylogeography are performed on a single summary tree, so these analyses do not take phylogenetic uncertainty in account. Though a cube does not represent all of tree space, in many situations it captures most of the uncertainty of a posterior distribution, and allows taking uncertainty in account in post-hoc analyses. Furthermore, our novel way to represent tree space opens up new avenues to implement online algorithms (<xref rid="ref-4" ref-type="bibr">Bouckaert, Collienne &amp; Gavryushkin, 2022</xref>), allowing rapid responses to newly available data. There is also potential for improving summary trees through matrix representation of a given tree set, as we will demonstrate.</p>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Representing trees through a matrix</title>
      <p>The main idea is to represent a posterior tree distribution as a distribution over entries of a matrix, and apply the single links clustering algorithm ( <xref rid="fsrc1" ref-type="other">Algorithm 1</xref> ) to obtain a tree. The matrix can be interpreted as a distance matrix: it must be symmetric, have positive values and the entries on the diagonal are ignored. So, for a tree with <italic toggle="yes">n</italic> taxa there are <italic toggle="yes">n</italic>(<italic toggle="yes">n</italic> − 1)/2 entries that are relevant: the entries above the diagonal. We say a matrix entry is <italic toggle="yes">specified</italic> if it is finite, and <italic toggle="yes">unspecified</italic> if it is positive infinite. We say a matrix is <italic toggle="yes">valid</italic> if the tree associated with it through single link clustering only has finite branch lengths.</p>
      <p>
        <preformat id="fsrc1" xml:space="preserve" position="float"> 
_______________________ 
Algorithm 1 Single link clustering_________________________________________________________ 
  Input: n × n matrix M with entries mij 
    Let x1,...,xn be n taxa 
  ∀1≤i≤n initialise subtree as single taxon {xi} at height 0 
  while There is more than 1 subtree do 
      Let mij be minimum of M, where xi and xj in different subtrees 
       Create node x with height mij 
        Add branch between x and root of subtree containing xi 
        Add branch between x and root of subtree containing xj 
    Return tree with root at last added node_______________________________________________    </preformat>
      </p>
      <p>Some properties of this representation with a short justification:</p>
      <list list-type="simple" id="list-1">
        <list-item>
          <label> 1.</label>
          <p><italic toggle="yes">Note that at least <italic toggle="yes">n</italic> − 1 entries must be specified for a matrix to be valid.</italic> This follows from the fact that there are <italic toggle="yes">n</italic> − 1 internal nodes in a tree, so the single link clustering algorithm requires at least <italic toggle="yes">n</italic> − 1 finite heights to specify a tree.</p>
        </list-item>
        <list-item>
          <label> 2.</label>
          <p>An adjacency graph <italic toggle="yes">G</italic> over <italic toggle="yes">n</italic> nodes <italic toggle="yes">v</italic><sub>1</sub>, …, <italic toggle="yes">v</italic><sub><italic toggle="yes">n</italic></sub> can be associated with a matrix <italic toggle="yes">M</italic> having edges <italic toggle="yes">e</italic><sub><italic toggle="yes">ij</italic></sub> between <italic toggle="yes">v</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">v</italic><sub><italic toggle="yes">j</italic></sub> where ever <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> is specified. <italic toggle="yes">A matrix is valid if and only if the associated adjacency graph is connected.</italic> This follows from the fact the single link clustering algorithm uses entries in the matrix associated with edges in the graph that form a path connecting all nodes. So, it is possible for a matrix to have <italic toggle="yes">n</italic> − 1 entries specified, but still not be valid (<xref rid="fig-1" ref-type="fig">Fig. 1</xref>).</p>
        </list-item>
        <list-item>
          <label> 3.</label>
          <p><italic toggle="yes">To represent a distribution over <italic toggle="yes">all</italic> possible trees, all entries in the matrix must be specified.</italic> This follows from the observation that in the set of all trees, for every pair <italic toggle="yes">i</italic>, <italic toggle="yes">j</italic>, <italic toggle="yes">i</italic> ≠ <italic toggle="yes">j</italic> of taxa <italic toggle="yes">x</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">x</italic><sub><italic toggle="yes">j</italic></sub> there exists a tree somewhere in the set of all trees such that the pair is connected with the lowest internal node (that is parent to both taxa). Since such a <italic toggle="yes">cherry</italic> can only be formed by the distance in the matrix <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> being the smallest, this implies <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> cannot be infinite, so <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> must be specified.</p>
        </list-item>
        <list-item>
          <label> 4.</label>
          <p><italic toggle="yes">A matrix with <italic toggle="yes">n</italic> or more entries specified does not form a bijection to trees.</italic> Since the single link algorithm only uses <italic toggle="yes">n</italic> − 1 entries in the matrix to form the tree, if there are <italic toggle="yes">n</italic> or more values specified in the matrix it is possible to change these values and return the same tree. Therefore, there are multiple ways to represent the same tree with different matrices, hence it cannot be a bijection.</p>
        </list-item>
        <list-item>
          <label> 5.</label>
          <p><italic toggle="yes">A matrix with <italic toggle="yes">n</italic> − 1 entries specified forms a bijection to trees when the associated adjacency graph is connected.</italic> This includes the cube representation that we will have a closer look at later.</p>
        </list-item>
        <list-item>
          <label> 6.</label>
          <p><italic toggle="yes">Transforming a tree to a matrix consists of populating the specified entries <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> with height of the most common recent ancestor of <italic toggle="yes">x</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">x</italic><sub><italic toggle="yes">j</italic></sub> in the tree.</italic> The single link clustering algorithm then retrieves the original tree when applied to the matrix.</p>
        </list-item>
      </list>
      <p>If all entries in the matrix on the first row are specified (<italic toggle="yes">i.e.</italic> entries <italic toggle="yes">m</italic><sub>1<italic toggle="yes">j</italic></sub> for 1 &lt; <italic toggle="yes">j</italic> ≤ <italic toggle="yes">n</italic>) and the remainder are not specified (<xref rid="fig-1" ref-type="fig">Fig. 1</xref>), all possible caterpillar trees with cherry containing <italic toggle="yes">x</italic><sub>1</sub> can be formed. Note that there are (<italic toggle="yes">n</italic> − 1)! topologies that can be formed that way.</p>
      <p>If all entries in the matrix that are 1-off-diagonal are specified, the adjacency graph forms a linked chain and <inline-formula><alternatives><inline-graphic xlink:href="peerj-12-17276-i001.jpg"/><tex-math id="tex-ieqn-34">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
$ \frac{1}{n+1} \left( {2n\atop n} \right) $\end{document}</tex-math><mml:math id="mml-ieqn-34" overflow="scroll"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mfenced separators="" open="(" close=")"><mml:mrow><mml:mfrac linethickness="0"><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math></alternatives></inline-formula> (the Catalan number) number of topologies can be represented. We call this configuration a <italic toggle="yes">cube</italic>. Even though the same number of entries are specified, this is less than for the caterpillar trees, but will turn out to be more useful in practice. Note that by reordering the taxa it is possible to get the same kind of adjacency graph containing all nodes in a chain.</p>
      <fig position="float" id="fig-1">
        <object-id pub-id-type="doi">10.7717/peerj.17276/fig-1</object-id>
        <label>Figure 1</label>
        <caption>
          <title>Various matrices where <italic toggle="yes">x</italic> means the entry is specified, and ∞ the entry is unspecified for <italic toggle="yes">n</italic> = 6, the associated adjacency graphs for <italic toggle="yes">n</italic> = 6 and the number of tree topologies they can represent (in decreasing order).</title>
        </caption>
        <graphic xlink:href="peerj-12-17276-g001" position="float"/>
      </fig>
      <p>We will use a multivariate normal distribution <italic toggle="yes">N</italic>(<italic toggle="yes">μ</italic>, Σ) with mean vector <italic toggle="yes">μ</italic> and covariance matrix Σ of dimension <italic toggle="yes">k</italic>. Here <italic toggle="yes">n</italic> − 1 ≤ <italic toggle="yes">k</italic> ≤ <italic toggle="yes">n</italic>(<italic toggle="yes">n</italic> − 1)/2, where each of the <italic toggle="yes">k</italic> dimensions is associated with an entry in the matrix. To estimate <italic toggle="yes">μ</italic> and Σ for a tree set, simply construct the branch length matrix for each tree in the set and take the average for each entry (that is specified) and covariance for each pairs of specified entries.</p>
      <p>To get a sample of trees, draw a random sample from this distribution, exponentiate each of the values and populate the matrix with its values. Then run single link clustering to obtain the tree. <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> shows this in more detail.</p>
      <preformat id="fsrc2" xml:space="preserve" position="float"> 
_______________________________________________________________________________________________________ 
Algorithm 2 Sample from posterior_______________________________________________________ 
  Input: Multivariate normal distribution N(μ,Σ) of dimension k 
           where μ the vector of mean values and Σ the covariance matrix. 
  Input: list of k matrix entries 
  Let AAT = Σ be the Cholesky decomposition of Σ 
  Draw k independent standard normal values z = {z1,...,zk} 
  Let x = μ + Az 
  Fill the matrix M with the k entries of exp(x) and leave the rest unspecified 
  Return tree by applying single link clustering on M____________________________    </preformat>
    </sec>
    <sec>
      <title>Cube space</title>
      <p>An alternative way to represent a cube configuration in a matrix is to consider an order of the taxa and a vector that represents the height of the internal nodes between two consecutive taxa in the ordering. <xref rid="fig-2" ref-type="fig">Figure 2</xref> illustrates this: the height <italic toggle="yes">h</italic><sub>1</sub> corresponds to a matrix entry for <italic toggle="yes">A</italic> and <italic toggle="yes">B</italic>, the height <italic toggle="yes">h</italic><sub>2</sub> for <italic toggle="yes">B</italic> and <italic toggle="yes">C etc</italic>., this way forming the cube configuration from the previous subsection. But we can consider this an ordering <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>, <italic toggle="yes">D</italic>, <italic toggle="yes">E</italic> and gaps <italic toggle="yes">h</italic><sub>1</sub> to <italic toggle="yes">h</italic><sub>4</sub> between consecutive nodes in the ordering.</p>
      <fig position="float" id="fig-2">
        <object-id pub-id-type="doi">10.7717/peerj.17276/fig-2</object-id>
        <label>Figure 2</label>
        <caption>
          <title>Cube over five taxa consisting of a taxon ordering <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>, <italic toggle="yes">D</italic>, <italic toggle="yes">E</italic> and heights <italic toggle="yes">h</italic><sub>1</sub> for the height between <italic toggle="yes">A</italic> and <italic toggle="yes">B</italic>, height <italic toggle="yes">h</italic><sub>2</sub> for the heights between <italic toggle="yes">B</italic> and <italic toggle="yes">C</italic>, <italic toggle="yes">h</italic><sub>3</sub> for <italic toggle="yes">C</italic> and <italic toggle="yes">D</italic> and height <italic toggle="yes">h</italic><sub>4</sub> for <italic toggle="yes">D</italic> and <italic toggle="yes">E</italic>.</title>
          <p>Dashed lines show how the heights are associated with consecutive pairs of taxa in the taxon ordering.</p>
        </caption>
        <graphic xlink:href="peerj-12-17276-g002" position="float"/>
      </fig>
      <p>One nice property of cube space is that it only contains <italic toggle="yes">n</italic> − 1 heights, and forms a bijection under the single link clustering transformation. However, it is obviously limited in that it cannot represent all of tree space, our expectation is that it can represent a large part of posterior space. Consider three taxa, <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic> ordered alphabetically, then there are three possible topologies: ((<italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>), <italic toggle="yes">C</italic>), (<italic toggle="yes">A</italic>, (<italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>)) and ((<italic toggle="yes">A</italic>, <italic toggle="yes">C</italic>), <italic toggle="yes">B</italic>). The first two are represented in the cube, but the last one is missing, so at least two thirds of the posterior can be represented. In practice, posteriors will be skewed towards a dominant topology, so the first topology may have 60% support, the second 30% and leaving only 10% for the topology that is missed out. In this three taxon example, this means that 90% of the posterior can be captured. This is 30% better than using a summary tree that would only cover the first topology.</p>
      <p>The method for learning a multivariate normal distributions over cube heights is the same as for matrices.</p>
    </sec>
    <sec>
      <title>Variational Bayesian approach</title>
      <p>The application of cube space we are most interested in is Bayesian inference through a variational Bayesian distribution. To this end, we have to infer the mean vector <italic toggle="yes">μ</italic> and covariance matrix Σ from an alignment and phylogenetic model. For each of the parameters of the model, we need a transformation so that the transformed parameter is normally distributed. We employ the following transformations:</p>
      <list list-type="simple" id="list-2">
        <list-item>
          <label> •</label>
          <p>for scale parameters (like <italic toggle="yes">κ</italic> of the HKY model, birth rate of the Yule model) we use a log-transform.</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for location parameters we use no transform.</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for multi dimensional parameters that are constrained to sum to 1, <italic toggle="yes">e.g.</italic> frequencies of substitution models, we use a stick breaking transform (<xref rid="ref-2" ref-type="bibr">Betancourt, 2012</xref>).</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for the tree we use the matrix transform. Note that internal node heights are log-transformed.</p>
        </list-item>
      </list>
      <p>Given a phylogenetic model that specifies a tree prior, site model and branch rate model, the parameters of the model (including the tree) and associated transformations, <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> outlines how we can infer <italic toggle="yes">μ</italic> and Σ. The strategy is to get a reasonably good value for <italic toggle="yes">μ</italic> first, and infer Σ afterwards. To this end the first step is finding a state with high probability, ideally the maximum a posteriori probability (MAP) state, since it corresponds to the mode of the multivariate normal distribution, and thus should get us reasonably close to where <italic toggle="yes">μ</italic> should be.</p>
      <preformat id="fsrc3" xml:space="preserve" position="float"> 
________________________________________________________________________________________ 
Algorithm 3 Cube-VB________________________________________________________________________ 
  Input: posterior distribution over a set of parameters 
  Input: set of parameters (including tree) and their transforms 
  0. Initialise tree by UPGMA 
  1. Find high posterior state of tree and other parameters 
  2. Randomly initialise ordering of taxa that is compatible with tree from step 
   1 
  3. Sample trees restricted to cube space, using MCMC 
  4. Estimate μ and Σ based on transformed MCMC samples______________________    </preformat>
      <p>The tree is initialised using Un weighted Pair Group Method with Arithmetic Mean (UPGMA) <xref rid="ref-31" ref-type="bibr">Sokal&amp; Michener (1958)</xref>, a hierarchical clustering algorithm that produces a rooted time tree. The topology of the tree and timing of the tree can potentially be adjusted in the next step.</p>
      <p>In our implementation, the tree and all other parameters are then optimised using simulated annealing (<xref rid="ref-36" ref-type="bibr">Van Laarhoven et al., 1987</xref>). This is a general purpose optimisation algorithm that, like MCMC, randomly explores the state space, but it differs from MCMC in the acceptance criterion of a proposed state. Higher posterior proposals are always accepted, and lower posterior proposals are accepted with a probability proportional to the change in posterior weighted by a temperature that decreases over time. We found that using a temperature schedule that decreases fairly fast to the end temperature, but repeatedly resets to the start temperature instead of a long monotonically decreasing temperature allowed escape from local minima more efficiently. For the proposals used in simulated annealing we can use standard MCMC operators implemented in BEAST 2.</p>
      <p>To complete the cube-transform for the tree, we need a taxon ordering. Different orderings cover different parts of tree space, so finding a suitable ordering affects the suitability of the representation. This is a research question that we leave open here, but note that in the implementation using a random order compatible with the tree turned out to be sufficiently good to accurately infer parameters of interest such as tree height and tree length.</p>
      <p>In order to estimate the covariance matrix Σ, we will generate a representative sample using MCMC. Instead of using the standard tree operators in BEAST 2, we replace the topology changing operators with a pair of operators that ensure the proposed tree can be represented by the cube restricted by the taxon ordering from Step 2 of <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> . The first operators is a variant of the narrow exchange operator (a nearest neighbour interchange operator that also proposes a new height of the node that is moved) that ensure it remains within the cube. The second operators is a subtree-slide operator (moves internal node up or down, potentially causing topology changes) and ensures that the target location is compatible with the cube ordering.</p>
      <p>Based on the short MCMC run, we can transform the MCMC samples and directly estimate <italic toggle="yes">μ</italic> and Σ from the set of transformed values. There are many tools for visualising and otherwise post-processing a posterior based on an MCMC sample, such as Tracer (<xref rid="ref-29" ref-type="bibr">Rambaut et al., 2018</xref>), DensiTree (<xref rid="ref-6" ref-type="bibr">Bouckaert, 2010</xref>), <italic toggle="yes">etc</italic>etera. Once we obtain <italic toggle="yes">μ</italic> and Σ, <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> can be used to create such a sample.</p>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>Results</title>
    <p>In this section, we validate the matrix and cube representation of tree distributions and show that the method for learning a cube based variational Bayesian distribution passes well calibrated simulation studies and we will get an impression of the algorithm’s performance. Finally, we consider using a method for inferring summary trees.</p>
    <sec>
      <title>Matrices and cubes can accurately represent tree distributions</title>
      <p>To validate whether we can accurately represent a tree posterior obtained from a full MCMC run, we construct the distance matrix for each tree by taking the logarithm of the pairwise taxon path distance, then estimate the mean and covariance matrix for all relevant entries. Next, we sample a new tree distribution using <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> repeatedly to obtain a new tree sample. We compare clade support and clade height distribution with the original tree posterior using the <monospace>CladeSetComparator</monospace> from the Babel package (<ext-link xlink:href="https://github.com/rbouckaert/Babel" ext-link-type="uri">https://github.com/rbouckaert/Babel</ext-link>) in BEAST 2.</p>
      <sec>
        <title>Apes</title>
        <p><xref rid="fig-3" ref-type="fig">Figure 3</xref> shows a small illustrative example of a tree distribution over six apes. There is uncertainty at the root with 83% support for siamang being outgroup (blue trees in panels b &amp; d), 13% orangutan being outgroup (red trees) and 4% siamang and orangutan being outgroup (green trees). A cube can only represent two out of these three cases. By representing the first two, it covers 96% of the posterior distribution, which for many practical cases may be sufficient.</p>
        <fig position="float" id="fig-3">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-3</object-id>
          <label>Figure 3</label>
          <caption>
            <title>Comparing the ape dataset with a cube representation (A &amp; B) and matrix representation (C &amp; D).</title>
            <p>Plates A &amp; C show clade support in red and clade height in blue. Red dots indicate clade support, running from zero probability (bottom left corner) to 1 (top right corner). Blue dots are placed at the mean of the height of a clade. Both x and y axes are scaled so that the largest tree height (from among both data sets) is at the top right corner. Blue crosses indicate 95% highest probability density (HPD) intervals of clade height. For both red and blue dots, bigger dots mean more clade support. The x-axis represent clade values from one set, the y-axis that of another. If both sets are the same, all dots will be on the x = y line (black diagonal line). The two blue lines indicate there is 20% difference: points within these lines have less than 20% difference, points outside have more, and can be considered as evidence there is substantial difference between the two posteriors. Plates B &amp; D show the original tree set on the left. The trees with most prevalent topology are blue, the next prevalent red and least prevalent green. Plate (B) on the left shows the cube representation and plate (D) the matrix representation. A cube accurately represents most clades, but does not cover all clades, where a matrix can represent all clades but is less accurate in clade support (see text for details).</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g003" position="float"/>
        </fig>
        <p>Representing the third case where both siamang and orangutan are ougroup is possible with a matrix representation, as shown <xref rid="fig-3" ref-type="fig">Fig. 3D</xref>.</p>
        <p>What is striking in both panels a and c in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> is that the mean of the clade heights and 95% HPD intervals are very close. However, clade support is slightly distorted: for the cube, the trees with both siamang and orangutan as outgroup is completely missing. Since this only covers 4% of the posterior, this may not be such a big issue in general. The matrix has this clade represented, but instead of the original 83%, 13%, 4% distribution has 59%, 21%, 20% distribution, heavily over representing the siamang and orangutan as outgroup. This is visible in <xref rid="fig-3" ref-type="fig">Fig. 3C</xref> by the red dots being far from the diagonal. It appears the correlation matrix does not accurately capture possible non-linear correlations between the entries in the matrix.</p>
        <p>One source of such non-linearities is the tree topology interfering with distance distributions between pairs of taxa: in a topology ((A,B),C), the distance between A and B and the distance between A and C can be linearly correlated. And likewise in topology ((A,C),B). But if both topologies are in the tree set there is no reason the combined correlation to always behave linearly or even approximately linearly. Use of the minimum function for clade distances in the single link clustering algorithm is another source of non-linearity. A potential remedy is to use normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) to capture such non-linearities and provide a more sophisticated transformation between a multi-variate normal distribution and the associated tree topology.</p>
      </sec>
      <sec>
        <title>AARS</title>
        <p>A tree distribution with more uncertainty is from aminoacyl-tRNA synthetase (AARS) data for 204 Class I protozyme sequences (<xref rid="ref-9" ref-type="bibr">Carter Jr et al., 2022</xref>). A convenient way to characterise the uncertainty of a tree distribution is its entropy <xref rid="ref-24" ref-type="bibr">Lewis et al. (2016)</xref>, which can be calculated efficiently based on the conditional clade distribution (<xref rid="ref-22" ref-type="bibr">Larget, 2013</xref>) of the tree set. The AARS data has an entropy of 124.1, so more than half of the internal nodes are uncertain. The corresponding cube has an entropy of just 96.3, which shows that a cube representation can have a large entropy, thus representing a highly uncertain tree distribution.</p>
        <p><xref rid="fig-4" ref-type="fig">Figure 4A</xref> shows the clade set comparison for the AARS data, which shows that most of the clades that are supported in the cube have reasonably similar support as in the original tree set. Although there is a clade with 38.9% difference in clade support, and there are 5 other clades with more than 25% clade support difference, the average clade support difference is just 4.9% for clades with over 1% support. Note the set of red dots at the x-axis, which represent the set of clades that are not represented by the cube. Furthermore, clade heights also show very close correspondences: the mean height estimate differs just 2.2%. In summary, the clades match remarkably well given the high entropy of the tree set.</p>
        <fig position="float" id="fig-4">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-4</object-id>
          <label>Figure 4</label>
          <caption>
            <title> Comparing the AARS dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Clade support and heights show good correspondence as does the DensiTree.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g004" position="float"/>
        </fig>
        <p><xref rid="fig-4" ref-type="fig">Figure 4B</xref> shows a DensiTree of the original tree distribution on the left hand side and the cube representation on the right hand side. Visually, the images correspond quite well, confirming the information we have from the clade comparison panel. Note that the cube represents a large number of clades judging from the diversity of trees in the DensiTree as well as the large number of points in the clade comparison plot. Even though a considerable number of clades are missing, the majority of well supported clades are represented by the cube.</p>
      </sec>
      <sec>
        <title>Pama-Nynguan languages</title>
        <p><xref rid="fig-5" ref-type="fig">Figure 5</xref> shows another tree distribution, here for 306 Pama-Nynguan languages (<xref rid="ref-8" ref-type="bibr">Bouckaert, Bowern &amp; Atkinson, 2018</xref>) with a large entropy of 91.7 for the original tree distribution and 78.6 for the cube. <xref rid="fig-5" ref-type="fig">Figure 5</xref> shows the clade comparison, showing just three clades having more than 25% clade support, and two of them are two taxon clades. Again, we see good correspondence between original distribution obtained through MCMC and its cube representation.</p>
        <fig position="float" id="fig-5">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-5</object-id>
          <label>Figure 5</label>
          <caption>
            <title> Comparing the Pama-Nyungan dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g005" position="float"/>
        </fig>
      </sec>
      <sec>
        <title>Cichlids</title>
        <p>A more troublesome example is a tree distribution over 121 Cichlid sequences sourced from <xref rid="ref-25" ref-type="bibr">Matschiner et al. (2017)</xref>. The entropy of the original dataset is 38.4 but that of the cube representation is higher at 49.8. Different orderings were tried based on the ordering heuristics in DensiTree, but all of them resulted in a cube representation with significant number of clades having substantially different support.</p>
        <p>Since the cube representation contains fewer trees, there are fewer terms to contribute to the entropy, and since all terms must add to 1, these terms can be expected to be larger than for the original distribution. Therefore, one would expect entropy of a cube representation to decrease from that of the original tree distribution The fact the entropy for the cichlids data increased in the cube representation compared to the original dataset can be interpreted as a hint that the ordering is less than optimal. Optimising orderings is a topic for further research, but this example shows it is crucial for a good tree set representation.</p>
        <p><xref rid="fig-6" ref-type="fig">Figure 6</xref> shows the clade comparison and DensiTree. There are 23 clades that have more than 25% difference in support and the maximum difference in clade support is 80% for a clade in the original set that is missing from the cube representation. The mean height of clades differ only 0.57%, so correspond quite well. In this case, a cube representation appears to be less satisfactory than in the other examples.</p>
        <fig position="float" id="fig-6">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-6</object-id>
          <label>Figure 6</label>
          <caption>
            <title> Comparing the cichlids dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Significant number of clades have large difference in support in the cube representation, though heights of those clades that are captured show good correspondence.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g006" position="float"/>
        </fig>
      </sec>
      <sec>
        <title>Indo-European languages</title>
        <p>To demonstrate the cube representation works well for internal nodes, even though tip dates are sampled, we considered a recently published tree distribution over 161 languages (<xref rid="ref-16" ref-type="bibr">Heggarty et al., 2023</xref>). The tree set has an entropy of 42.3, the cube has 36.6 (<xref rid="fig-7" ref-type="fig">Figure 7</xref>).</p>
        <fig position="float" id="fig-7">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-7</object-id>
          <label>Figure 7</label>
          <caption>
            <title> Comparing the Indo-European dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Even with dated tips the cube representation remains accurate.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g007" position="float"/>
        </fig>
        <p>Maximum difference in clade support is 28.5% but only 2 clades have difference of 25% and on average the clade support difference is 4.1% for clades with more than 1% support. Mean height difference of clades (not counting tip heights) is less than 0.79% on average. So, even though the original distribution has dated tips, and the cube does not, clade support and clade heights remain quite closely represented when compared to the original.</p>
      </sec>
    </sec>
    <sec>
      <title>Cube-VB algorithm passes well calibrated simulation study</title>
      <p>To verify that the cube based variational distribution algorithm works, we performed a well calibrated simulation study (<xref rid="ref-28" ref-type="bibr">Mendes et al., 2023</xref>; <xref rid="ref-35" ref-type="bibr">Talts et al., 2018</xref>) using a tree with 50 taxa sampled from the Yule tree prior with birth rate narrowly distributed as normal (mean = 6, sigma = 0.1). This results in tree heights with mean 0.58 and 95% HPD of 0.34 to 0.79. Sequence data is generated under a HKY model with kappa lognormally distributed (mean = 1, sigma = 1.25), and a strict clock with rate fixed at 1 is used to complete the model. So, the parameter space being sampled consists of the kappa and birth rate parameters and a tree. We use sequence lengths of 100, 250 and 500 resulting in observed entropy in the inferred tree posteriors of 10.6, 6.4 and 3.8 respectively (<xref rid="table-1" ref-type="table">Table 1</xref>). We run 100 instances for each sequence length, and expect the 95%HPD of parameters of interest to contain the true value from 91 to 99 of the cases for the test to pass. <xref rid="table-1" ref-type="table">Table 1</xref> shows the results and the simulation study indeed passes.</p>
      <table-wrap position="float" id="table-1">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-1</object-id>
        <label>Table 1</label>
        <caption>
          <title>Coverage (in %) of 100 runs over 50 taxa with Yule, HKY strict clock for three different sequence lengths.</title>
          <p>Longer sequences result in lower entropy, but coverage of the parameters of interest (last four lines in table) are all in acceptable range.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g008" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Sequence length:</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Mean and 95% HPD</td>
                <td rowspan="1" colspan="1">10.6 (5.9–14.6)</td>
                <td rowspan="1" colspan="1">6.4 (3.2–10.4)</td>
                <td rowspan="1" colspan="1">3.8 (1.3–6.3)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Entropy</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree height</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">93</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree treeLength</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">BirthRate</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Kappa</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">93</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>A slightly more challenging case is where we sample trees from a coalescent tree prior with constant population size sampled from a lognormal (mean = 0.1, sigma = 0.1). The tree heights have a mean of 2.3 with 95% HPD interval of 0.6 to 5.0. We use a site model with gamma rate heterogeneity where the shape parameter is sampled from an exponential with mean 1, and use a GTR model with rate CT fixed to 1 and rate AG sampled from a log normal with mean 1 in real space and sigma = 1. The other four transversions rates are sampled from a log normal with mean in real space of 0.5 and sigma = 1. Stationary frequencies for the GTR model were sampled from a Dirichlet with <italic toggle="yes">α</italic> = 4 for all four dimensions. For this setup, getting accurate estimates of the uncertainty required running the MCMC a bit longer than for the case using HKY. <xref rid="table-2" ref-type="table">Table 2</xref> shows the coverage we get for all paramaters of interest and they are all in an acceptable range,<xref rid="fn-1" ref-type="fn"><sup>1</sup></xref>
<fn id="fn-1"><label>1</label><p>If the 95% HPD estimates are correct estimates, the simulation study is an experiment of flipping a coin with 95% probability of turning heads repeated 100 times. Here, observing a head equates finding the true value of a parameter being inside the 95% HPD interval. This results in a binomial distribution of observing heads on average 95 times and a 95% probability of being within a range of 91 to 99. Observing almost all coverage values in this range with the occasional outlier at 90 or 100 is deemed acceptable.</p></fn>although population size coverages were on the low side.</p>
      <table-wrap position="float" id="table-2">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-2</object-id>
        <label>Table 2</label>
        <caption>
          <title>As <xref rid="table-1" ref-type="table">Table 1</xref> but for coalescent with constant population, GTR with estimated frequencies using gamma rate heterogeneity and strict clock for three different sequence lengths.</title>
          <p>Coverage of the parameters of interest (last thirteen lines in table) are all in acceptable range.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g009" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Sequence length:</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Mean and 95% HPD</td>
                <td rowspan="1" colspan="1">13.1 (5.9–15.7)</td>
                <td rowspan="1" colspan="1">5.7 (3.0–9.1)</td>
                <td rowspan="1" colspan="1">4.7 (1.5–6.5)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Entropy</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree.height</td>
                <td rowspan="1" colspan="1">91</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree.treeLength</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">91</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAC</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">98</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAG</td>
                <td rowspan="1" colspan="1">100</td>
                <td rowspan="1" colspan="1">98</td>
                <td rowspan="1" colspan="1">95</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAT</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateCG</td>
                <td rowspan="1" colspan="1">93</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateGT</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">99</td>
                <td rowspan="1" colspan="1">95</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.1</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.2</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.3</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.4</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">98</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">gammaShape</td>
                <td rowspan="1" colspan="1">93</td>
                <td rowspan="1" colspan="1">100</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">popSize</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">90</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>This demonstrates that the cube based variational distribution algorithm can work well estimating a tree, scale parameters as well as constrained sum parameters (<italic toggle="yes">i.e.</italic> frequencies) for a number of popular phylogenetic models. Many model implementations are available in BEAST 2 that only require these types of parameters, in particular nucleotide and amino acid substitution models.</p>
    </sec>
    <sec>
      <title>Cube based variational distribution algorithm performs well</title>
      <p>To see how well the cube based variational distribution algorithm scales with number of taxa, we ran a simulation study with 50, 100, 250, 500, 750 and 1,000 taxa. For each taxon set size, we ran 25 instances of the Yule/HKY/strict clock model used for the well calibrated simulation study. For each instance, alignments of 250 sites were generated. We checked that coverage of 95% HPD intervals for tree height, tree length, kappa and birth rate parameters was between 22 and 25 to verify that the inferred posterior indeed matches the true distribution. Experiments were performed on a 2021 MacBook Pro laptop in OS X using BEAST v2.7.5 and BEAGLE v4.0.0 (<xref rid="ref-34" ref-type="bibr">Suchard &amp; Rambaut, 2009</xref>).</p>
      <p><xref rid="table-3" ref-type="table">Table 3</xref> shows run times in seconds, demonstrating it is feasible to perform large analyses in a short span of time. Sampling a representative posterior trace and tree log took the least time taking up no more than 2% of total runtime. MCMC for accurately estimating the covariance matrix took most of the time, from 40% for smaller taxon sets to over 90% for the larger tree sets. MAP finding and Cholesky decomposition in comparison took less time and are taking up relatively less time with growing taxon set sizes.</p>
      <table-wrap position="float" id="table-3">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-3</object-id>
        <label>Table 3</label>
        <caption>
          <title>Run times in seconds averaged over 25 instances for various taxon set sizes (in columns).</title>
          <p>Numbers in brackets are standard deviations.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g010" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Number of taxa</th>
                <th rowspan="1" colspan="1">50</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
                <th rowspan="1" colspan="1">750</th>
                <th rowspan="1" colspan="1">1000</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">MAP finding</td>
                <td rowspan="1" colspan="1">1.17 (0.03)</td>
                <td rowspan="1" colspan="1">1.48 (0.03)</td>
                <td rowspan="1" colspan="1">2.36 (0.08)</td>
                <td rowspan="1" colspan="1">3.91 (0.08)</td>
                <td rowspan="1" colspan="1">5.30 (0.19)</td>
                <td rowspan="1" colspan="1">6.43 (0.40)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">MCMC</td>
                <td rowspan="1" colspan="1">1.15 (0.03)</td>
                <td rowspan="1" colspan="1">2.77 (0.05)</td>
                <td rowspan="1" colspan="1">12.08 (0.24)</td>
                <td rowspan="1" colspan="1">41.84 (0.72)</td>
                <td rowspan="1" colspan="1">94.74 (3.29)</td>
                <td rowspan="1" colspan="1">172.25 (8.24)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Decomposition</td>
                <td rowspan="1" colspan="1">0.45 (0.01)</td>
                <td rowspan="1" colspan="1">0.60 (0.02)</td>
                <td rowspan="1" colspan="1">0.93 (0.03)</td>
                <td rowspan="1" colspan="1">1.69 (0.04)</td>
                <td rowspan="1" colspan="1">2.88 (0.20)</td>
                <td rowspan="1" colspan="1">4.47 (0.10)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Sampling output</td>
                <td rowspan="1" colspan="1">0.23 (0.02)</td>
                <td rowspan="1" colspan="1">0.36 (0.02)</td>
                <td rowspan="1" colspan="1">0.68 (0.02)</td>
                <td rowspan="1" colspan="1">1.40 (0.03)</td>
                <td rowspan="1" colspan="1">2.18 (0.05)</td>
                <td rowspan="1" colspan="1">3.27 (0.15)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Total runtime</td>
                <td rowspan="1" colspan="1">3.00 (0.05)</td>
                <td rowspan="1" colspan="1">5.20 (0.08)</td>
                <td rowspan="1" colspan="1">16.05 (0.27)</td>
                <td rowspan="1" colspan="1">48.83 (0.79)</td>
                <td rowspan="1" colspan="1">105.10 (3.33)</td>
                <td rowspan="1" colspan="1">186.42 (8.60)</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>Total calculation time fits a quadratic function (1.70<italic toggle="yes">E</italic> − 4<italic toggle="yes">x</italic><sup>2</sup> + 1.43<italic toggle="yes">E</italic> − 2<italic toggle="yes">x</italic>) with <italic toggle="yes">R</italic><sup>2</sup> = 0.9997, so the algorithm seems to scale quadratically. The chain length used are a linear function of the number of taxa, and tree likelihood calculation time (which dominates posterior calculation time here) both scale linear in the number of taxa. Changing the former could change how the algorithm scales. The most striking feature of the table though is that all times can comfortably be expressed in seconds using just three digits before the decimal point.</p>
    </sec>
    <sec>
      <title>Summary tree</title>
      <p>Observe that by setting <bold>z</bold> = <bold>0</bold> in <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> we can obtain a tree that is at the mode of the distribution. This tree should be representative of the complete distribution so can be used as a summary tree. Note that it can have a topology that differs from all trees in the tree set to be summarised, unlike popular methods like the maximum clade credibility (MCC) tree implemented in TreeAnnotator. <xref rid="table-4" ref-type="table">Table 4</xref> shows some the sum of posterior clade support in the summary tree for MMC and matrix representation based summary trees. This is proportional to the number of internal nodes minus the Robinson-Foulds distance averaged over the tree set. The table shows that matrix based summary tree never produced worse trees and sometimes does considerably better. The log product of clade probability is used in MCC trees to find the best fitting topology. <xref rid="table-4" ref-type="table">Table 4</xref> shows even according to that criterion the matrix approach can do better, which is remarkable since MCC explicitly maximises that criterion. Further evaluation with less crude measures of summary tree quality are required to establish when matrix based summary trees outperform MCC trees.</p>
      <table-wrap position="float" id="table-4">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-4</object-id>
        <label>Table 4</label>
        <caption>
          <title>Sum and log product of posterior clade support over all clades in the summary tree for MCC tree and matrix representation based tree.</title>
          <p>Higher is better. The entries marked with asterisk ignore zero support clades (one clade for cichlids, three for NZ votes). The matrix approach is never worse and sometimes considerably better.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g011" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th align="center" colspan="3" rowspan="1">Sum of clade</th>
                <th align="center" colspan="3" rowspan="1">Log product of clade</th>
              </tr>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th align="center" colspan="3" rowspan="1">probability</th>
                <th align="center" colspan="3" rowspan="1">probability</th>
              </tr>
              <tr>
                <th rowspan="1" colspan="1">Data set</th>
                <th rowspan="1" colspan="1">MCC</th>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Matrix</th>
                <th rowspan="1" colspan="1">MCC</th>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Matrix</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Apes</td>
                <td rowspan="1" colspan="1">4.8</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">4.8</td>
                <td rowspan="1" colspan="1">−0.2</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">−0.2</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">IE</td>
                <td rowspan="1" colspan="1">136.9</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">138.9</td>
                <td rowspan="1" colspan="1">−35.0</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−29.2</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">AARS</td>
                <td rowspan="1" colspan="1">133.6</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">142.9</td>
                <td rowspan="1" colspan="1">−128.4</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−90.8</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Cichlids</td>
                <td rowspan="1" colspan="1">91.7</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">93.7</td>
                <td rowspan="1" colspan="1">−42.3</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−34.7*</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">NZ votes</td>
                <td rowspan="1" colspan="1">26.7</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">34.1</td>
                <td rowspan="1" colspan="1">−297.1</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−217.6*</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Pama-Nyungan</td>
                <td rowspan="1" colspan="1">255.6</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">262.4</td>
                <td rowspan="1" colspan="1">−80.5</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−59.3</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Species</td>
                <td rowspan="1" colspan="1">27.5</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">27.5</td>
                <td rowspan="1" colspan="1">−2.6</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">−2.6</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p><bold>Matrix and cube representations can accurately represent tree distributions:</bold> For tree distributions with low to medium entropy (<xref rid="ref-24" ref-type="bibr">Lewis et al., 2016</xref>) based on its conditional clade distribution (<xref rid="ref-22" ref-type="bibr">Larget, 2013</xref>), we demonstrated that a substantial part of the posterior can be represented using a single cube. For those cases it is possible to do fast inference of rooted time trees using a cube based variational distribution approach outlined in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> . For tree distributions with high entropy, it may not be possible to capture a substantial portion of the posterior by a single cube. An example is a sample over 50 taxa from a Yule prior (<xref rid="supp-1" ref-type="supplementary-material">Fig. S1</xref>), where a cube representation will suggest much older internal node heights with higher clade support than the original distribution. Using more than one cube might elevate this somewhat, but since there can be overlap between the trees represented by the various cubes, and this overlap is hard to characterise (L. Berling, 2023, personal communication) this may not be a fruitful avenue. A more productive way may be to use more entries in the distance matrix. This breaks the bijective property of the transformation, but facilitates a greater coverage of the full tree space. This will result increase the non-linearity of dependencies between the various matrix entries due to correlations changing when topologies change. Normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) allow for greater flexibility in representing such non-linear dependencies, and may provide a way to transform a multi-variate normal distribution into a tree distribution.</p>
    <p>One situation where node height distributions can deviate significantly from being log-normally distributed is when node calibrations are used in the tree that interact with each other. For example, clade <italic toggle="yes">A</italic> may be known to be at least <italic toggle="yes">X</italic> years old, so a uniform prior with lower bound of <italic toggle="yes">X</italic> seems appropriate. When clade <italic toggle="yes">B</italic> (consisting of clade <italic toggle="yes">A</italic> plus 1 node so that the MRCA of <italic toggle="yes">B</italic> is the parent of the MRCA of <italic toggle="yes">A</italic>) is assigned a distribution with a mean not very far above <italic toggle="yes">X</italic> (with large variance), the age distribution of the MRCA of <italic toggle="yes">B</italic> will be lower bounded by <italic toggle="yes">X</italic> as well. In this case, a log-transform may not be appropriate for accurate capturing of this distribution, and a matrix representation may fail to accurately capture such distribution. Again, normalising flows could be employed to address this.</p>
    <p><bold>Optimisation based variational Bayesian:</bold> Variational Bayesian algorithms are usually optimisation based, where the evidence lower bound (ELBO) is maximised. The ELBO is proportional to the posterior plus a term that measures the distance between the true and approximate distribution. The benefit of maximisation over MCMC is that there are no restrictions on optimisation proposals unlike with MCMC where one needs to be careful to use appropriate Hastings ratios in order to ensure there is no bias in sampling from the posterior. One way to optimise the ELBO is by the hugely popular stochastic gradient ascent algorithm, which randomly draws a new state, calculates the gradient of the ELBO with respect to a random subset of parameters and moves parameters in the state in the direction of the gradient. This process is iterated until convergence is reached. However, there are some issues with gradient ascent: a gradient is required, which can be computationally expensive. Furthermore, it has domain specific parameters, such as learning rate, learning rate scheme, and parameter subset size. Also, random subsets may need to be tuned for efficient exploitation of subsets. Finally, the convergence criterion has large impact on the number of iterations. Since points are drawn stochastically, the convergence criterion needs to deal with noise. Instead of dealing with all these issues, here we introduced an MCMC based algorithm to learn a variational distribution that benefits from all MCMC related optimisations implemented in BEAST 2 (such as adaptive operator tuning). It serves as a proof of concept demonstrating that cube spaces are suitable for variational inference. Of course, this still leave opportunities for ELBO maximisation implementations of cube based variational inference.</p>
    <p><bold>Cube-VB algorithm parameters:</bold> Notwithstanding the issues of ELBO optimisation based VB, the MCMC based approach to learning a variational distribution we introduced in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> has a number of parameters that need to be specified, in particular the start and end temperatures and number of repeats for simulated annealing for finding a (close to) MAP state. We chose a start temperature of 0.1 and end temperature of 0.01, which worked quite well for our experiments, so this seems a reasonable option. Putting in more than 25 repeats barely led to improvement of the posterior of the MAP state, but halving it turned out to be detrimental (well calibrated simulation studies did not pass).</p>
    <p>Another parameter to set is the length of MCMC chain for estimating the covariance matrix. The heuristic implemented in the <monospace>cubevb</monospace> package for BEAST 2 is to count the number of parameters and multiply with a user specified value. In our experiments with the HKY model, a multiplier of 1,000 was sufficient. The more samples, the more accurate the matrix estimate but the longer it takes for the algorithm to finish. In that sense, it nicely fits the class of online algorithms (<xref rid="ref-4" ref-type="bibr">Bouckaert, Collienne &amp; Gavryushkin, 2022</xref>) that at any time can provide an answer, but the answer becomes more accurate the longer the algorithm runs. Detecting when longer runs do not increase accuracy of the posterior any more is an open question where automated convergence techniques employed for standard MCMC (<xref rid="ref-1" ref-type="bibr">Berling, Bouckaert &amp; Gavryushkin, 2023</xref>) could be exploited. These are all based on running two analyses in parallel and measuring the difference in the distributions that are obtained.</p>
    <p><bold>Why the Cube-VB algorithm works:</bold> Since plain MCMC is used in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> one may wonder why this is more efficient than just running full MCMC and not being restricted to a cube space. The reason for this stems from the assumption that the true distribution can be represented as a transformation of a multivariate normal distribution. Consider the <italic toggle="yes">κ</italic> parameter for the HKY model and a log-transformation. In practice, we see that <italic toggle="yes">κ</italic> is close to log-normally distributed, so representing the posterior as a normal with log-transform leads to little distortion. Now notice that we only have to estimate the mean and variance of the log-normal under this assumption, instead of estimating a full unparameterised distribution, which is what we would be doing with full MCMC. So, even though a small MCMC sample will not be sufficient to accurately represent the distribution of <italic toggle="yes">κ</italic> and statistics like 95% HPDs, there will be sufficient information to accurately estimate two parameters of a log-normal, from which statistics like 95% HPDs then can accurately be inferred.</p>
    <p><bold>Variational Bayesian for matrix representation:</bold> The Cube-VB algorithm can be adapted to suitable matrix representations by replacing Step 2 by some method of identifying which entries in the matrix need to be specified and which entries can be left unspecified. Step 3 would need adjustment in the operators to ensure all possible tree topologies that can be represented by the matrix are available to be proposed. It is an open problem what the best strategy is for identifying which and how many entries should be specified. Since a cube can capture a substantial part of a posterior, identifying a cube could be a first step followed by filling in entries where clades represented have substantial support.</p>
  </sec>
  <sec>
    <title>Conclusion</title>
    <p>Matrix space is introduced as a representation of all or, in the case of cubes, a significant part of tree space. We demonstrated for simple phylogenetic models it allows fast inference of the most relevant part of the tree posterior using just a cube representation, thus capturing most of the uncertainty in the posterior distribution.</p>
    <p>There are many venues to extend and develop this work, in particular into the area of more sophisticated phylogenetic models. Here we mention just a few of the more commonly used models and potential issues implementing inference for them in matrix representation, in particular cubes:</p>
    <list list-type="simple" id="list-3">
      <list-item>
        <label> •</label>
        <p>In general, finding an appropriate subset of pairwise distances, <italic toggle="yes">i.e.</italic> subset of entries in the matrix, an obvious open problem. Finding the optimal ordering for a cube is an instance of this problem. It is probably related to finding a good ordering for drawing trees in DensiTree (<xref rid="ref-6" ref-type="bibr">Bouckaert, 2010</xref>) for which various heuristics have been developed. It is not clear how to transfer these heuristics to the VB setting and new heuristics may need to be developed.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Flexible nonparametric tree priors take epochs in accounts like the Bayesian skyline plot (<xref rid="ref-12" ref-type="bibr">Drummond et al., 2005</xref>) and birth death skyline plot (<xref rid="ref-32" ref-type="bibr">Stadler et al., 2013</xref>) and are widely used but may be challenging to parameterise in a variational Bayesian setting due to their discrete components. Models that integrate out most parameters and have only a single continuous parameter, like BICEPS and multi Yule (<xref rid="ref-7" ref-type="bibr">Bouckaert, 2022</xref>), can be good alternatives and should be straightforward to implement in our cube VB algorithm.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Relaxed clocks (<xref rid="ref-11" ref-type="bibr">Drummond et al., 2006</xref>; <xref rid="ref-10" ref-type="bibr">Douglas, Zhang &amp; Bouckaert, 2021</xref>) need to be adapted for cube space. Due to discontinuities between different topologies, simply associating a (log)normal branch rate distribution with each taxon and each dimension of the cube may not be sufficient. Normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) may be required to capture relaxed branch rate distributions.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Dated tips put restrictions on the height of internal nodes. When tip dates are uncertain and need te be sampled from a distribution, this adds extra dimensions to the multivariate normal representation of the posterior.</p>
      </list-item>
    </list>
    <p>On the other hand, extensions into empirical models of amino acids, models that integrate out internal states like ancestral reconstruction (<xref rid="ref-23" ref-type="bibr">Lemey et al., 2009</xref>) and phylogeography (<xref rid="ref-3" ref-type="bibr">Bouckaert, 2016</xref>) should be straightforward to adapt.</p>
    <p>In summary, there are many exciting new opportunities waiting to be explored in cube and matrix space for fast phylogenetic inference.</p>
  </sec>
  <sec sec-type="supplementary-material" id="supplemental-information">
    <title>Supplemental Information</title>
    <supplementary-material id="supp-1" position="float" content-type="local-data">
      <object-id pub-id-type="doi">10.7717/peerj.17276/supp-1</object-id>
      <label>Supplemental Information 1</label>
      <caption>
        <title>Tree distribution sampled from Yule prior and its cube representation</title>
        <p>As <xref rid="fig-3" ref-type="fig">Fig. 3</xref>, but with a tree sampled from a Yule prior with 50 taxa, resulting in a tree set sampled uniformly over ranked trees and has high entropy. The cube representation of this tree set has substantially older internal nodes and higher clade support for many clades than the original tree set.</p>
      </caption>
      <media xlink:href="peerj-12-17276-s001.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>This work was greatly helped by stimulating discussions with members of the Center of Computational Evolution at the University of Auckland, in particular with Alexei Drummond. Special thanks to Jordan Douglas for proofreading.</p>
  </ack>
  <sec sec-type="additional-information">
    <title>Additional Information and Declarations</title>
    <fn-group content-type="competing-interests">
      <title>Competing Interests</title>
      <fn id="conflict-1" fn-type="COI-statement">
        <p>The authors declare there are no competing interests.</p>
      </fn>
    </fn-group>
    <fn-group content-type="author-contributions">
      <title>Author Contributions</title>
      <fn id="contribution-1" fn-type="con">
        <p><xref rid="author-1" ref-type="contrib">Remco R. Bouckaert</xref> conceived and designed the experiments, performed the experiments, analyzed the data, prepared figures and/or tables, authored or reviewed drafts of the article, and approved the final draft.</p>
      </fn>
    </fn-group>
    <fn-group content-type="other">
      <title>Data Availability</title>
      <fn id="addinfo-1">
        <p>The following information was supplied regarding data availability:</p>
        <p>The data and code is available at GitHub and Zenodo:</p>
        <p>- <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link>
</p>
        <p>- Remco, B. (2024). CubeVB package for BEAST2: archive of <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link>. In Variational Bayesian Phylogenies through Matrix Representation of Tree Space: Vol. tbd (v1.0.1). Zenodo. <ext-link xlink:href="https://doi.org/10.5281/zenodo.10594658" ext-link-type="uri">https://doi.org/10.5281/zenodo.10594658</ext-link>.</p>
      </fn>
    </fn-group>
  </sec>
  <ref-list content-type="authoryear">
    <title>References</title>
    <ref id="ref-1">
      <label>Berling, Bouckaert &amp; Gavryushkin (2023)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Berling</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>Automated convergence diagnostic for phylogenetic MCMC analyses</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2023.08.10.552869</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-2">
      <label>Betancourt (2012)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Betancourt</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2012">2012</year>
        <article-title>Cruising the simplex: Hamiltonian Monte Carlo and the Dirichlet distribution</article-title>
        <source>AIP conference proceedings 31st</source>
        <volume>1443</volume>
        <issue>1</issue>
        <fpage>157</fpage>
        <lpage>164</lpage>
        <pub-id pub-id-type="doi">10.1063/1.3703631</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-3">
      <label>Bouckaert (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>Phylogeography by diffusion on a sphere: whole world phylogeography</article-title>
        <source>PeerJ</source>
        <volume>4</volume>
        <elocation-id>e2406</elocation-id>
        <pub-id pub-id-type="doi">10.7717/peerj.2406</pub-id>
        <pub-id pub-id-type="pmid">27651992</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-4">
      <label>Bouckaert, Collienne &amp; Gavryushkin (2022)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Collienne</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Online Bayesian analysis with BEAST 2</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2022.05.03.490538</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-5">
      <label>Bouckaert et al. (2019)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Vaughan</surname>
            <given-names>TG</given-names>
          </name>
          <name>
            <surname>Barido-Sottani</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Duchêne</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Fourment</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gavryushkina</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Heled</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>De Maio</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Matschiner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Mendes</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Müller</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Ogilvie</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Plessis</surname>
            <given-names>Ld</given-names>
          </name>
          <name>
            <surname>Popinga</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rasmussen</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Siveroni</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>C-H</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Stadler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2019">2019</year>
        <article-title>BEAST 2.5: an advanced software platform for Bayesian evolutionary analysis</article-title>
        <source>PLOS Computational Biology</source>
        <volume>15</volume>
        <issue>4</issue>
        <elocation-id>e1006650</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1006650</pub-id>
        <pub-id pub-id-type="pmid">30958812</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-6">
      <label>Bouckaert (2010)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2010">2010</year>
        <article-title>DensiTree: making sense of sets of phylogenetic trees</article-title>
        <source>Bioinformatics</source>
        <volume>26</volume>
        <issue>10</issue>
        <fpage>1372</fpage>
        <lpage>1373</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btq110</pub-id>
        <pub-id pub-id-type="pmid">20228129</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-7">
      <label>Bouckaert (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>An efficient coalescent epoch model for Bayesian phylogenetic inference</article-title>
        <source>Systematic Biology</source>
        <volume>71</volume>
        <issue>6</issue>
        <fpage>1549</fpage>
        <lpage>1560</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syac015</pub-id>
        <pub-id pub-id-type="pmid">35212733</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-8">
      <label>Bouckaert, Bowern &amp; Atkinson (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Bowern</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Atkinson</surname>
            <given-names>QD</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>The origin and expansion of Pama–Nyungan languages across Australia</article-title>
        <source>Nature Ecology &amp; Evolution</source>
        <volume>2</volume>
        <issue>4</issue>
        <fpage>741</fpage>
        <lpage>749</lpage>
        <pub-id pub-id-type="doi">10.1038/s41559-018-0489-3</pub-id>
        <pub-id pub-id-type="pmid">29531347</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-9">
      <label>Carter Jr et al. (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Carter Jr</surname>
            <given-names>CW</given-names>
          </name>
          <name>
            <surname>Popinga</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>PR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Multidimensional phylogenetic metrics identify Class I Aminoacyl-tRNA synthetase evolutionary mosaicity and inter-modular coupling</article-title>
        <source>International Journal of Molecular Sciences</source>
        <volume>23</volume>
        <issue>3</issue>
        <fpage>1520</fpage>
        <lpage>1544</lpage>
        <pub-id pub-id-type="doi">10.3390/ijms23031520</pub-id>
        <pub-id pub-id-type="pmid">35163448</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-10">
      <label>Douglas, Zhang &amp; Bouckaert (2021)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Douglas</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2021">2021</year>
        <article-title>Adaptive dating and fast proposals: revisiting the phylogenetic relaxed clock model</article-title>
        <source>PLOS Computational Biology</source>
        <volume>17</volume>
        <issue>2</issue>
        <elocation-id>e1008322</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1008322</pub-id>
        <pub-id pub-id-type="pmid">33529184</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-11">
      <label>Drummond et al. (2006)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Ho</surname>
            <given-names>SYW</given-names>
          </name>
          <name>
            <surname>Phillips</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2006">2006</year>
        <article-title>Relaxed phylogenetics and dating with confidence</article-title>
        <source>PLOS Biology</source>
        <volume>4</volume>
        <issue>5</issue>
        <elocation-id>e88</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.0040088</pub-id>
        <pub-id pub-id-type="pmid">16683862</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-12">
      <label>Drummond et al. (2005)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Shapiro</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Pybus</surname>
            <given-names>OG</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2005">2005</year>
        <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences</article-title>
        <source>Molecular Biology and Evolution</source>
        <volume>22</volume>
        <issue>5</issue>
        <fpage>1185</fpage>
        <lpage>1192</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msi103</pub-id>
        <pub-id pub-id-type="pmid">15703244</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-13">
      <label>Florek et al. (1951)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Florek</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Łukaszewicz</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Perkal</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Steinhaus</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Zubrzycki</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1951">1951</year>
        <article-title>Sur la liaison et la division des points d’un ensemble fini</article-title>
        <volume>2</volume>
        <issue>3–4</issue>
        <source>Colloquium Mathematicum</source>
        <fpage>282</fpage>
        <lpage>285</lpage>
        <pub-id pub-id-type="doi">10.4064/cm-2-3-4-282-285</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-14">
      <label>Fourment &amp; Darling (2019)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fourment</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Darling</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2019">2019</year>
        <article-title>Evaluating probabilistic programming and fast variational Bayesian inference in phylogenetics</article-title>
        <source>PeerJ</source>
        <volume>7</volume>
        <elocation-id>e8272</elocation-id>
        <pub-id pub-id-type="doi">10.7717/peerj.8272</pub-id>
        <pub-id pub-id-type="pmid">31976168</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-15">
      <label>Gavryushkin &amp; Drummond (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>The space of ultrametric phylogenetic trees</article-title>
        <source>Journal of Theoretical Biology</source>
        <volume>403</volume>
        <fpage>197</fpage>
        <lpage>208</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jtbi.2016.05.001</pub-id>
        <pub-id pub-id-type="pmid">27188249</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-16">
      <label>Heggarty et al. (2023)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heggarty</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Anderson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Scarborough</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>King</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jocz</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Kümmel</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Jügel</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Irslinger</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Pooth</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Liljegren</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Strand</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Haig</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Macák</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Anonby</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Pronk</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Belyaev</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Dewey-Findell</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Boutilier</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Freiberg</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Tegethoff</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Serangeli</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Liosis</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Stroński</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Schulte</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Kumar Gupta</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Haak</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Atkinson</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Greenhill</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gray</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>Language trees with sampled ancestors support a hybrid model for the origin of Indo-European languages</article-title>
        <source>Science</source>
        <volume>381</volume>
        <issue>6656</issue>
        <elocation-id>eabg0818</elocation-id>
        <pub-id pub-id-type="doi">10.1126/science.abg0818</pub-id>
        <pub-id pub-id-type="pmid">37499002</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-17">
      <label>Heled &amp; Drummond (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heled</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Bayesian inference of species trees from multilocus data</article-title>
        <source>Molecular Biology and Evolution</source>
        <volume>27</volume>
        <issue>3</issue>
        <fpage>570</fpage>
        <lpage>580</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msp274</pub-id>
        <pub-id pub-id-type="pmid">19906793</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-18">
      <label>Höhna et al. (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Höhna</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Landis</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Heath</surname>
            <given-names>TA</given-names>
          </name>
          <name>
            <surname>Boussau</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lartillot</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Moore</surname>
            <given-names>BR</given-names>
          </name>
          <name>
            <surname>Huelsenbeck</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Ronquist</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>RevBayes: Bayesian phylogenetic inference using graphical models and an interactive model-specification language</article-title>
        <source>Systematic Biology</source>
        <volume>65</volume>
        <issue>4</issue>
        <fpage>726</fpage>
        <lpage>736</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syw021</pub-id>
        <pub-id pub-id-type="pmid">27235697</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-19">
      <label>Huelsenbeck &amp; Ronquist (2001)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huelsenbeck</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Ronquist</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2001">2001</year>
        <article-title>MrBayes: bayesian inference of phylogenetic trees</article-title>
        <source>Bioinformatics</source>
        <volume>17</volume>
        <issue>8</issue>
        <fpage>754</fpage>
        <lpage>755</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/17.8.754</pub-id>
        <pub-id pub-id-type="pmid">11524383</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-20">
      <label>Jiang, Tabaghi &amp; Mirarab (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Tabaghi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Learning hyperbolic embedding for phylogenetic tree placement and updates</article-title>
        <source>Biology</source>
        <volume>11</volume>
        <issue>9</issue>
        <fpage>1256</fpage>
        <pub-id pub-id-type="doi">10.3390/biology11091256</pub-id>
        <pub-id pub-id-type="pmid">36138735</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-21">
      <label>Jordan et al. (1999)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Ghahramani</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Jaakkola</surname>
            <given-names>TS</given-names>
          </name>
          <name>
            <surname>Saul</surname>
            <given-names>LK</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1999">1999</year>
        <article-title>An introduction to variational methods for graphical models</article-title>
        <source>Machine Learning</source>
        <volume>37</volume>
        <issue>2</issue>
        <fpage>183</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1023/A:1007665907178</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-22">
      <label>Larget (2013)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Larget</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2013">2013</year>
        <article-title>The estimation of tree posterior probabilities using conditional clade probability distributions</article-title>
        <source>Systematic Biology</source>
        <volume>62</volume>
        <issue>4</issue>
        <fpage>501</fpage>
        <lpage>511</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syt014</pub-id>
        <pub-id pub-id-type="pmid">23479066</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-23">
      <label>Lemey et al. (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lemey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Bayesian phylogeography finds its roots</article-title>
        <source>PLOS Computational Biology</source>
        <volume>5</volume>
        <issue>9</issue>
        <elocation-id>e1000520</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1000520</pub-id>
        <pub-id pub-id-type="pmid">19779555</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-24">
      <label>Lewis et al. (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lewis</surname>
            <given-names>PO</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>M-H</given-names>
          </name>
          <name>
            <surname>Kuo</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lewis</surname>
            <given-names>LA</given-names>
          </name>
          <name>
            <surname>Fučíková</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Neupane</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Y-B</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>Estimating Bayesian phylogenetic information content</article-title>
        <source>Systematic Biology</source>
        <volume>65</volume>
        <issue>6</issue>
        <fpage>1009</fpage>
        <lpage>1023</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syw042</pub-id>
        <pub-id pub-id-type="pmid">27155008</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-25">
      <label>Matschiner et al. (2017)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matschiner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Musilová</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Barth</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Starostová</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Salzburger</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Steel</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2017">2017</year>
        <article-title>Bayesian phylogenetic estimation of clade ages supports trans-Atlantic dispersal of cichlid fishes</article-title>
        <source>Systematic Biology</source>
        <volume>66</volume>
        <issue>1</issue>
        <fpage>3</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syx025</pub-id>
        <pub-id pub-id-type="pmid">28173588</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-26">
      <label>Matsumoto, Mimori &amp; Fukunaga (2021)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matsumoto</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Mimori</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fukunaga</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2021">2021</year>
        <article-title>Novel metric for hyperbolic phylogenetic tree embeddings</article-title>
        <source>Biology Methods and Protocols</source>
        <volume>6</volume>
        <issue>1</issue>
        <fpage>bpab006</fpage>
        <pub-id pub-id-type="doi">10.1093/biomethods/bpab006</pub-id>
        <pub-id pub-id-type="pmid">33928190</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-27">
      <label>Mau, Newton &amp; Larget (1999)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mau</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Newton</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Larget</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1999">1999</year>
        <article-title>Bayesian phylogenetic inference via Markov chain Monte Carlo methods</article-title>
        <source>Biometrics</source>
        <volume>55</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1111/j.0006-341X.1999.00001.x</pub-id>
        <pub-id pub-id-type="pmid">11318142</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-28">
      <label>Mendes et al. (2023)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Mendes</surname>
            <given-names>FK</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Carvalho</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>How to validate a Bayesian evolutionary model</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2024.02.11.579856</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-29">
      <label>Rambaut et al. (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Baele</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Posterior summarization in Bayesian phylogenetics using Tracer 1.7</article-title>
        <source>Systematic Biology</source>
        <volume>67</volume>
        <issue>5</issue>
        <fpage>901</fpage>
        <lpage>904</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syy032</pub-id>
        <pub-id pub-id-type="pmid">29718447</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-30">
      <label>Rezende &amp; Mohamed (2015)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rezende</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Mohamed</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2015">2015</year>
        <article-title>Variational inference with normalizing flows</article-title>
        <pub-id pub-id-type="arxiv">1505.05770</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-31">
      <label>Sokal &amp; Michener (1958)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sokal</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Michener</surname>
            <given-names>CD</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1958">1958</year>
        <article-title>A statiscal method for evaluating systematic relationships</article-title>
        <source>University of Kansas Science Bulletin</source>
        <volume>38</volume>
        <fpage>1409</fpage>
        <lpage>1438</lpage>
      </element-citation>
    </ref>
    <ref id="ref-32">
      <label>Stadler et al. (2013)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stadler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Bonhoeffer</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2013">2013</year>
        <article-title>Birth–death skyline plot reveals temporal changes of epidemic spread in HIV and hepatitis C virus (HCV)</article-title>
        <source>Proceedings of the National Academy of Sciences of the United States of America</source>
        <volume>110</volume>
        <issue>1</issue>
        <fpage>228</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1207965110</pub-id>
        <pub-id pub-id-type="pmid">23248286</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-33">
      <label>Suchard et al. (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Lemey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Baele</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Ayres</surname>
            <given-names>DL</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Bayesian phylogenetic and phylodynamic data integration using BEAST 1.10</article-title>
        <source>Virus Evolution</source>
        <volume>4</volume>
        <issue>1</issue>
        <fpage>vey016</fpage>
        <pub-id pub-id-type="doi">10.1093/ve/vey016</pub-id>
        <pub-id pub-id-type="pmid">29942656</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-34">
      <label>Suchard &amp; Rambaut (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Many-core algorithms for statistical phylogenetics</article-title>
        <source>Bioinformatics</source>
        <volume>25</volume>
        <issue>11</issue>
        <fpage>1370</fpage>
        <lpage>1376</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp244</pub-id>
        <pub-id pub-id-type="pmid">19369496</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-35">
      <label>Talts et al. (2018)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Talts</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Betancourt</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Simpson</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Vehtari</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Gelman</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Validating Bayesian inference algorithms with simulation-based calibration</article-title>
        <pub-id pub-id-type="arxiv">1804.06788</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-36">
      <label>Van Laarhoven et al. (1987)</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Van Laarhoven</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Aarts</surname>
            <given-names>EH</given-names>
          </name>
          <name>
            <surname>van Laarhoven</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Aarts</surname>
            <given-names>EH</given-names>
          </name>
        </person-group>
        <article-title>Simulated annealing</article-title>
        <source>Simulated Annealing: Theory and Applications. Mathematics and its Applications</source>
        <volume>vol. 37</volume>
        <year iso-8601-date="1987">1987</year>
        <publisher-loc>Dordrecht</publisher-loc>
        <publisher-name>Springer</publisher-name>
        <comment>. <uri xlink:href="https://doi.org/10.1007/978-94-015-7744-1_2">https://doi.org/10.1007/978-94-015-7744-1_2</uri>
</comment>
      </element-citation>
    </ref>
    <ref id="ref-37">
      <label>Voznica et al. (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Voznica</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhukova</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Boskova</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Saulnier</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lemoine</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Moslonka-Lefebvre</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gascuel</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Deep learning from phylogenies to uncover the epidemiological dynamics of outbreaks</article-title>
        <source>Nature Communications</source>
        <volume>13</volume>
        <issue>1</issue>
        <fpage>3896</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-31511-0</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-38">
      <label>Zhang (2020)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2020">2020</year>
        <article-title>Improved variational bayesian phylogenetic inference with normalizing flows</article-title>
        <pub-id pub-id-type="arxiv">2012.00459</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-39">
      <label>Zhang &amp; Matsen IV (2018)</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Matsen IV</surname>
            <given-names>FA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Variational Bayesian phylogenetic inference</article-title>
        <conf-name>International conference on learning representations</conf-name>
        <uri xlink:href="https://openreview.net/pdf?id=SJVmjjR9FX">https://openreview.net/pdf?id=SJVmjjR9FX</uri>
      </element-citation>
    </ref>
    <ref id="ref-40">
      <label>Zhang &amp; Matsen IV (2022)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Matsen IV</surname>
            <given-names>FA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>A variational approach to bayesian phylogenetic inference</article-title>
        <pub-id pub-id-type="arxiv">2204.07747</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PeerJ</journal-id>
    <journal-id journal-id-type="iso-abbrev">PeerJ</journal-id>
    <journal-id journal-id-type="publisher-id">peerj</journal-id>
    <journal-title-group>
      <journal-title>PeerJ</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2167-8359</issn>
    <publisher>
      <publisher-name>PeerJ Inc.</publisher-name>
      <publisher-loc>San Diego, USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">11064865</article-id>
    <article-id pub-id-type="publisher-id">17276</article-id>
    <article-id pub-id-type="doi">10.7717/peerj.17276</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Bioinformatics</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Computational Biology</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Evolutionary Studies</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Mathematical Biology</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Variational Bayesian phylogenies through matrix representation of tree space</article-title>
    </title-group>
    <contrib-group>
      <contrib id="author-1" contrib-type="author" corresp="yes">
        <name>
          <surname>Bouckaert</surname>
          <given-names>Remco R.</given-names>
        </name>
        <email>remco@cs.auckland.ac.nz</email>
        <xref rid="aff-1" ref-type="aff"/>
      </contrib>
      <aff id="aff-1"><institution>School of Computer Science, University of Auckland</institution>, <city>Auckland</city>, <country>New Zealand</country></aff>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Procter</surname>
          <given-names>James</given-names>
        </name>
      </contrib>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>29</day>
      <month>4</month>
      <year iso-8601-date="2024">2024</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2024</year>
    </pub-date>
    <volume>12</volume>
    <elocation-id>e17276</elocation-id>
    <history>
      <date date-type="received" iso-8601-date="2023-10-28">
        <day>28</day>
        <month>10</month>
        <year iso-8601-date="2023">2023</year>
      </date>
      <date date-type="accepted" iso-8601-date="2024-04-01">
        <day>1</day>
        <month>4</month>
        <year iso-8601-date="2024">2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>©2024 Bouckaert</copyright-statement>
      <copyright-year>2024</copyright-year>
      <copyright-holder>Bouckaert</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, reproduction and adaptation in any medium and for any purpose provided that it is properly attributed. For attribution, the original author(s), title, publication source (PeerJ) and either DOI or URL of the article must be cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="https://peerj.com/articles/17276"/>
    <abstract>
      <p>In this article, we study the distance matrix as a representation of a phylogeny by way of hierarchical clustering. By defining a multivariate normal distribution on (a subset of) the entries in a matrix, this allows us to represent a distribution over rooted time trees. Here, we demonstrate tree distributions can be represented accurately this way for a number of published tree distributions. Though such a representation does not map to unique trees, restriction to a subspace, in particular one we call a “cube”, makes the representation bijective at the cost of not being able to represent all possible trees. We introduce an algorithm “cubeVB” specifically for cubes and show through well calibrated simulation study that it is possible to recover parameters of interest like tree height and length. Although a cube cannot represent all of tree space, it is a great improvement over a single summary tree, and it opens up exciting new opportunities for scaling up Bayesian phylogenetic inference. We also demonstrate how to use a matrix representation of a tree distribution to get better summary trees than commonly used maximum clade credibility trees. An open source implementation of the cubeVB algorithm is available from <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link> as the <monospace>cubevb</monospace> package for BEAST 2.</p>
    </abstract>
    <kwd-group kwd-group-type="author">
      <kwd>Bayesian phylogenetics</kwd>
      <kwd>Variational Bayes</kwd>
      <kwd>BEAST 2</kwd>
      <kwd>Tree space</kwd>
      <kwd>Summary trees</kwd>
    </kwd-group>
    <funding-group>
      <funding-statement>The authors received no funding for this work.</funding-statement>
    </funding-group>
  </article-meta>
</front>
<body>
  <sec sec-type="intro">
    <title>Introduction</title>
    <p>The workhorse of Bayesian phylogenetics is the Markov chain Monte Carlo (MCMC) algorithm, which is widely used to reconstruct the evolutionary relationships among a set of biological sequences (<xref rid="ref-19" ref-type="bibr">Huelsenbeck &amp; Ronquist, 2001</xref>; <xref rid="ref-18" ref-type="bibr">Höhna et al., 2016</xref>; <xref rid="ref-33" ref-type="bibr">Suchard et al., 2018</xref>; <xref rid="ref-5" ref-type="bibr">Bouckaert et al., 2019</xref>). In practice, MCMC is limited to handling phylogenies of at most a few thousand taxa. With the advent of ever cheaper sequencing techniques, these algorithms are overwhelmed by the amount of available data. Consequently, maximum likelihood methods are employed, which can handle these amounts of data because they are based on optimisation algorithms.</p>
    <p>Variational Bayesian (VB) methods (<xref rid="ref-21" ref-type="bibr">Jordan et al., 1999</xref>) are also based on optimisation, so offer the prospect of being more scalable than MCMC. VB methods usually represent a posterior distribution as a transformation of a multivariate normal distribution on Euclidean space. The form of the transformation is crucial in how accurate the posterior distribution can be represented. Usually, stochastic gradient ascent is used as the optimisation algorithm, which relies on the transformation being a bijection between trees and their transformed representation. This provides a major hurdle for phylogentic inference, since existing tree spaces are either not bijective (like spanning trees between points in hyperbolic space (<xref rid="ref-26" ref-type="bibr">Matsumoto, Mimori &amp; Fukunaga, 2021</xref>; <xref rid="ref-20" ref-type="bibr">Jiang, Tabaghi &amp; Mirarab, 2022</xref>)) or do not allow representation as a Euclidean space (like ultrametric space (<xref rid="ref-15" ref-type="bibr">Gavryushkin &amp; Drummond, 2016</xref>)).</p>
    <p>Prior phylogenetic VB implementations got around these restrictions by being limited to fixed tree topologies (<xref rid="ref-14" ref-type="bibr">Fourment &amp; Darling, 2019</xref>; <xref rid="ref-38" ref-type="bibr">Zhang, 2020</xref>). Others do not handle timed trees (<xref rid="ref-39" ref-type="bibr">Zhang &amp; Matsen IV, 2018</xref>) which are important to many practical and scientific questions. The ones that handle time trees (<xref rid="ref-40" ref-type="bibr">Zhang &amp; Matsen IV, 2022</xref>), have not demonstrated to scale to scale to 1,000 taxa.</p>
    <p>Here, we explore matrix representations of tree space. The basic idea is to use a symmetric matrix with dimension equal to the number of taxa and apply a hierarchical clustering algorithm like the single link clustering algorithm (<xref rid="ref-13" ref-type="bibr">Florek et al., 1951</xref>) to obtain a tree with internal node heights specified by the values of the matrix. The entries in the matrix form a Euclidean space, however there are many ways to represent the same tree, so the transformation is not bijective. A “cube” is a matrix where we restrict ourselves to the 1-off-diagonal entries of the matrix (and leave the rest at infinity) and the transformation becomes a bijection, but cannot represent all possible trees any more. In this article, we demonstrate it is possible to capture the most interesting part of posterior tree space using this approach. We implement an algorithm for basic phylogenetic models, infer the parameters of the multivariate normal distribution and show through a well calibrated simulation study that it captures important parameters of interest. We demonstrate that it scales well.</p>
    <p>Representations similar to the cube representation have been used before in phylogenetic inference. For example, in training neural nets to uncover the epidemiological dynamics of outbreaks (<xref rid="ref-37" ref-type="bibr">Voznica et al., 2022</xref>), where the “compact bijective ladderised vector” orders taxa so that branch support for taxa on the left is maximised. Instead of using the distance between taxa, the distance from internal nodes to the root is used. In MCMC, tree proposals like the “node reheight” operator in *BEAST (<xref rid="ref-17" ref-type="bibr">Heled &amp; Drummond, 2009</xref>), order taxa through a tree traversal. At binary splits, the first or second branch is randomly traversed first, resulting in a random ordering. Then, an internal node is randomly selected, and its height is randomly moved (constrained by gene tree heights). Finally, a tree is reconstructed to maintain consistency with the ordering and node heights of internal nodes between taxa. <xref rid="ref-27" ref-type="bibr">Mau, Newton &amp; Larget (1999)</xref> refers to this as the “canonical representation” and proposes its use an MCMC proposal as well. This is equivalent to selecting a cube with random order consistent with the tree, then perturbing a distance in the matrix and reconstructing the tree.</p>
    <p>Matrix and specifically cube representations offer a few other benefits. Many post-hoc analyses such as ancestral reconstruction, trait inference or phylogeography are performed on a single summary tree, so these analyses do not take phylogenetic uncertainty in account. Though a cube does not represent all of tree space, in many situations it captures most of the uncertainty of a posterior distribution, and allows taking uncertainty in account in post-hoc analyses. Furthermore, our novel way to represent tree space opens up new avenues to implement online algorithms (<xref rid="ref-4" ref-type="bibr">Bouckaert, Collienne &amp; Gavryushkin, 2022</xref>), allowing rapid responses to newly available data. There is also potential for improving summary trees through matrix representation of a given tree set, as we will demonstrate.</p>
  </sec>
  <sec sec-type="methods">
    <title>Methods</title>
    <sec>
      <title>Representing trees through a matrix</title>
      <p>The main idea is to represent a posterior tree distribution as a distribution over entries of a matrix, and apply the single links clustering algorithm ( <xref rid="fsrc1" ref-type="other">Algorithm 1</xref> ) to obtain a tree. The matrix can be interpreted as a distance matrix: it must be symmetric, have positive values and the entries on the diagonal are ignored. So, for a tree with <italic toggle="yes">n</italic> taxa there are <italic toggle="yes">n</italic>(<italic toggle="yes">n</italic> − 1)/2 entries that are relevant: the entries above the diagonal. We say a matrix entry is <italic toggle="yes">specified</italic> if it is finite, and <italic toggle="yes">unspecified</italic> if it is positive infinite. We say a matrix is <italic toggle="yes">valid</italic> if the tree associated with it through single link clustering only has finite branch lengths.</p>
      <p>
        <preformat id="fsrc1" xml:space="preserve" position="float"> 
_______________________ 
Algorithm 1 Single link clustering_________________________________________________________ 
  Input: n × n matrix M with entries mij 
    Let x1,...,xn be n taxa 
  ∀1≤i≤n initialise subtree as single taxon {xi} at height 0 
  while There is more than 1 subtree do 
      Let mij be minimum of M, where xi and xj in different subtrees 
       Create node x with height mij 
        Add branch between x and root of subtree containing xi 
        Add branch between x and root of subtree containing xj 
    Return tree with root at last added node_______________________________________________    </preformat>
      </p>
      <p>Some properties of this representation with a short justification:</p>
      <list list-type="simple" id="list-1">
        <list-item>
          <label> 1.</label>
          <p><italic toggle="yes">Note that at least <italic toggle="yes">n</italic> − 1 entries must be specified for a matrix to be valid.</italic> This follows from the fact that there are <italic toggle="yes">n</italic> − 1 internal nodes in a tree, so the single link clustering algorithm requires at least <italic toggle="yes">n</italic> − 1 finite heights to specify a tree.</p>
        </list-item>
        <list-item>
          <label> 2.</label>
          <p>An adjacency graph <italic toggle="yes">G</italic> over <italic toggle="yes">n</italic> nodes <italic toggle="yes">v</italic><sub>1</sub>, …, <italic toggle="yes">v</italic><sub><italic toggle="yes">n</italic></sub> can be associated with a matrix <italic toggle="yes">M</italic> having edges <italic toggle="yes">e</italic><sub><italic toggle="yes">ij</italic></sub> between <italic toggle="yes">v</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">v</italic><sub><italic toggle="yes">j</italic></sub> where ever <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> is specified. <italic toggle="yes">A matrix is valid if and only if the associated adjacency graph is connected.</italic> This follows from the fact the single link clustering algorithm uses entries in the matrix associated with edges in the graph that form a path connecting all nodes. So, it is possible for a matrix to have <italic toggle="yes">n</italic> − 1 entries specified, but still not be valid (<xref rid="fig-1" ref-type="fig">Fig. 1</xref>).</p>
        </list-item>
        <list-item>
          <label> 3.</label>
          <p><italic toggle="yes">To represent a distribution over <italic toggle="yes">all</italic> possible trees, all entries in the matrix must be specified.</italic> This follows from the observation that in the set of all trees, for every pair <italic toggle="yes">i</italic>, <italic toggle="yes">j</italic>, <italic toggle="yes">i</italic> ≠ <italic toggle="yes">j</italic> of taxa <italic toggle="yes">x</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">x</italic><sub><italic toggle="yes">j</italic></sub> there exists a tree somewhere in the set of all trees such that the pair is connected with the lowest internal node (that is parent to both taxa). Since such a <italic toggle="yes">cherry</italic> can only be formed by the distance in the matrix <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> being the smallest, this implies <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> cannot be infinite, so <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> must be specified.</p>
        </list-item>
        <list-item>
          <label> 4.</label>
          <p><italic toggle="yes">A matrix with <italic toggle="yes">n</italic> or more entries specified does not form a bijection to trees.</italic> Since the single link algorithm only uses <italic toggle="yes">n</italic> − 1 entries in the matrix to form the tree, if there are <italic toggle="yes">n</italic> or more values specified in the matrix it is possible to change these values and return the same tree. Therefore, there are multiple ways to represent the same tree with different matrices, hence it cannot be a bijection.</p>
        </list-item>
        <list-item>
          <label> 5.</label>
          <p><italic toggle="yes">A matrix with <italic toggle="yes">n</italic> − 1 entries specified forms a bijection to trees when the associated adjacency graph is connected.</italic> This includes the cube representation that we will have a closer look at later.</p>
        </list-item>
        <list-item>
          <label> 6.</label>
          <p><italic toggle="yes">Transforming a tree to a matrix consists of populating the specified entries <italic toggle="yes">m</italic><sub><italic toggle="yes">ij</italic></sub> with height of the most common recent ancestor of <italic toggle="yes">x</italic><sub><italic toggle="yes">i</italic></sub> and <italic toggle="yes">x</italic><sub><italic toggle="yes">j</italic></sub> in the tree.</italic> The single link clustering algorithm then retrieves the original tree when applied to the matrix.</p>
        </list-item>
      </list>
      <p>If all entries in the matrix on the first row are specified (<italic toggle="yes">i.e.</italic> entries <italic toggle="yes">m</italic><sub>1<italic toggle="yes">j</italic></sub> for 1 &lt; <italic toggle="yes">j</italic> ≤ <italic toggle="yes">n</italic>) and the remainder are not specified (<xref rid="fig-1" ref-type="fig">Fig. 1</xref>), all possible caterpillar trees with cherry containing <italic toggle="yes">x</italic><sub>1</sub> can be formed. Note that there are (<italic toggle="yes">n</italic> − 1)! topologies that can be formed that way.</p>
      <p>If all entries in the matrix that are 1-off-diagonal are specified, the adjacency graph forms a linked chain and <inline-formula><alternatives><inline-graphic xlink:href="peerj-12-17276-i001.jpg"/><tex-math id="tex-ieqn-34">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
$ \frac{1}{n+1} \left( {2n\atop n} \right) $\end{document}</tex-math><mml:math id="mml-ieqn-34" overflow="scroll"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mfenced separators="" open="(" close=")"><mml:mrow><mml:mfrac linethickness="0"><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math></alternatives></inline-formula> (the Catalan number) number of topologies can be represented. We call this configuration a <italic toggle="yes">cube</italic>. Even though the same number of entries are specified, this is less than for the caterpillar trees, but will turn out to be more useful in practice. Note that by reordering the taxa it is possible to get the same kind of adjacency graph containing all nodes in a chain.</p>
      <fig position="float" id="fig-1">
        <object-id pub-id-type="doi">10.7717/peerj.17276/fig-1</object-id>
        <label>Figure 1</label>
        <caption>
          <title>Various matrices where <italic toggle="yes">x</italic> means the entry is specified, and ∞ the entry is unspecified for <italic toggle="yes">n</italic> = 6, the associated adjacency graphs for <italic toggle="yes">n</italic> = 6 and the number of tree topologies they can represent (in decreasing order).</title>
        </caption>
        <graphic xlink:href="peerj-12-17276-g001" position="float"/>
      </fig>
      <p>We will use a multivariate normal distribution <italic toggle="yes">N</italic>(<italic toggle="yes">μ</italic>, Σ) with mean vector <italic toggle="yes">μ</italic> and covariance matrix Σ of dimension <italic toggle="yes">k</italic>. Here <italic toggle="yes">n</italic> − 1 ≤ <italic toggle="yes">k</italic> ≤ <italic toggle="yes">n</italic>(<italic toggle="yes">n</italic> − 1)/2, where each of the <italic toggle="yes">k</italic> dimensions is associated with an entry in the matrix. To estimate <italic toggle="yes">μ</italic> and Σ for a tree set, simply construct the branch length matrix for each tree in the set and take the average for each entry (that is specified) and covariance for each pairs of specified entries.</p>
      <p>To get a sample of trees, draw a random sample from this distribution, exponentiate each of the values and populate the matrix with its values. Then run single link clustering to obtain the tree. <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> shows this in more detail.</p>
      <preformat id="fsrc2" xml:space="preserve" position="float"> 
_______________________________________________________________________________________________________ 
Algorithm 2 Sample from posterior_______________________________________________________ 
  Input: Multivariate normal distribution N(μ,Σ) of dimension k 
           where μ the vector of mean values and Σ the covariance matrix. 
  Input: list of k matrix entries 
  Let AAT = Σ be the Cholesky decomposition of Σ 
  Draw k independent standard normal values z = {z1,...,zk} 
  Let x = μ + Az 
  Fill the matrix M with the k entries of exp(x) and leave the rest unspecified 
  Return tree by applying single link clustering on M____________________________    </preformat>
    </sec>
    <sec>
      <title>Cube space</title>
      <p>An alternative way to represent a cube configuration in a matrix is to consider an order of the taxa and a vector that represents the height of the internal nodes between two consecutive taxa in the ordering. <xref rid="fig-2" ref-type="fig">Figure 2</xref> illustrates this: the height <italic toggle="yes">h</italic><sub>1</sub> corresponds to a matrix entry for <italic toggle="yes">A</italic> and <italic toggle="yes">B</italic>, the height <italic toggle="yes">h</italic><sub>2</sub> for <italic toggle="yes">B</italic> and <italic toggle="yes">C etc</italic>., this way forming the cube configuration from the previous subsection. But we can consider this an ordering <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>, <italic toggle="yes">D</italic>, <italic toggle="yes">E</italic> and gaps <italic toggle="yes">h</italic><sub>1</sub> to <italic toggle="yes">h</italic><sub>4</sub> between consecutive nodes in the ordering.</p>
      <fig position="float" id="fig-2">
        <object-id pub-id-type="doi">10.7717/peerj.17276/fig-2</object-id>
        <label>Figure 2</label>
        <caption>
          <title>Cube over five taxa consisting of a taxon ordering <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>, <italic toggle="yes">D</italic>, <italic toggle="yes">E</italic> and heights <italic toggle="yes">h</italic><sub>1</sub> for the height between <italic toggle="yes">A</italic> and <italic toggle="yes">B</italic>, height <italic toggle="yes">h</italic><sub>2</sub> for the heights between <italic toggle="yes">B</italic> and <italic toggle="yes">C</italic>, <italic toggle="yes">h</italic><sub>3</sub> for <italic toggle="yes">C</italic> and <italic toggle="yes">D</italic> and height <italic toggle="yes">h</italic><sub>4</sub> for <italic toggle="yes">D</italic> and <italic toggle="yes">E</italic>.</title>
          <p>Dashed lines show how the heights are associated with consecutive pairs of taxa in the taxon ordering.</p>
        </caption>
        <graphic xlink:href="peerj-12-17276-g002" position="float"/>
      </fig>
      <p>One nice property of cube space is that it only contains <italic toggle="yes">n</italic> − 1 heights, and forms a bijection under the single link clustering transformation. However, it is obviously limited in that it cannot represent all of tree space, our expectation is that it can represent a large part of posterior space. Consider three taxa, <italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>, <italic toggle="yes">C</italic> ordered alphabetically, then there are three possible topologies: ((<italic toggle="yes">A</italic>, <italic toggle="yes">B</italic>), <italic toggle="yes">C</italic>), (<italic toggle="yes">A</italic>, (<italic toggle="yes">B</italic>, <italic toggle="yes">C</italic>)) and ((<italic toggle="yes">A</italic>, <italic toggle="yes">C</italic>), <italic toggle="yes">B</italic>). The first two are represented in the cube, but the last one is missing, so at least two thirds of the posterior can be represented. In practice, posteriors will be skewed towards a dominant topology, so the first topology may have 60% support, the second 30% and leaving only 10% for the topology that is missed out. In this three taxon example, this means that 90% of the posterior can be captured. This is 30% better than using a summary tree that would only cover the first topology.</p>
      <p>The method for learning a multivariate normal distributions over cube heights is the same as for matrices.</p>
    </sec>
    <sec>
      <title>Variational Bayesian approach</title>
      <p>The application of cube space we are most interested in is Bayesian inference through a variational Bayesian distribution. To this end, we have to infer the mean vector <italic toggle="yes">μ</italic> and covariance matrix Σ from an alignment and phylogenetic model. For each of the parameters of the model, we need a transformation so that the transformed parameter is normally distributed. We employ the following transformations:</p>
      <list list-type="simple" id="list-2">
        <list-item>
          <label> •</label>
          <p>for scale parameters (like <italic toggle="yes">κ</italic> of the HKY model, birth rate of the Yule model) we use a log-transform.</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for location parameters we use no transform.</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for multi dimensional parameters that are constrained to sum to 1, <italic toggle="yes">e.g.</italic> frequencies of substitution models, we use a stick breaking transform (<xref rid="ref-2" ref-type="bibr">Betancourt, 2012</xref>).</p>
        </list-item>
        <list-item>
          <label> •</label>
          <p>for the tree we use the matrix transform. Note that internal node heights are log-transformed.</p>
        </list-item>
      </list>
      <p>Given a phylogenetic model that specifies a tree prior, site model and branch rate model, the parameters of the model (including the tree) and associated transformations, <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> outlines how we can infer <italic toggle="yes">μ</italic> and Σ. The strategy is to get a reasonably good value for <italic toggle="yes">μ</italic> first, and infer Σ afterwards. To this end the first step is finding a state with high probability, ideally the maximum a posteriori probability (MAP) state, since it corresponds to the mode of the multivariate normal distribution, and thus should get us reasonably close to where <italic toggle="yes">μ</italic> should be.</p>
      <preformat id="fsrc3" xml:space="preserve" position="float"> 
________________________________________________________________________________________ 
Algorithm 3 Cube-VB________________________________________________________________________ 
  Input: posterior distribution over a set of parameters 
  Input: set of parameters (including tree) and their transforms 
  0. Initialise tree by UPGMA 
  1. Find high posterior state of tree and other parameters 
  2. Randomly initialise ordering of taxa that is compatible with tree from step 
   1 
  3. Sample trees restricted to cube space, using MCMC 
  4. Estimate μ and Σ based on transformed MCMC samples______________________    </preformat>
      <p>The tree is initialised using Un weighted Pair Group Method with Arithmetic Mean (UPGMA) <xref rid="ref-31" ref-type="bibr">Sokal&amp; Michener (1958)</xref>, a hierarchical clustering algorithm that produces a rooted time tree. The topology of the tree and timing of the tree can potentially be adjusted in the next step.</p>
      <p>In our implementation, the tree and all other parameters are then optimised using simulated annealing (<xref rid="ref-36" ref-type="bibr">Van Laarhoven et al., 1987</xref>). This is a general purpose optimisation algorithm that, like MCMC, randomly explores the state space, but it differs from MCMC in the acceptance criterion of a proposed state. Higher posterior proposals are always accepted, and lower posterior proposals are accepted with a probability proportional to the change in posterior weighted by a temperature that decreases over time. We found that using a temperature schedule that decreases fairly fast to the end temperature, but repeatedly resets to the start temperature instead of a long monotonically decreasing temperature allowed escape from local minima more efficiently. For the proposals used in simulated annealing we can use standard MCMC operators implemented in BEAST 2.</p>
      <p>To complete the cube-transform for the tree, we need a taxon ordering. Different orderings cover different parts of tree space, so finding a suitable ordering affects the suitability of the representation. This is a research question that we leave open here, but note that in the implementation using a random order compatible with the tree turned out to be sufficiently good to accurately infer parameters of interest such as tree height and tree length.</p>
      <p>In order to estimate the covariance matrix Σ, we will generate a representative sample using MCMC. Instead of using the standard tree operators in BEAST 2, we replace the topology changing operators with a pair of operators that ensure the proposed tree can be represented by the cube restricted by the taxon ordering from Step 2 of <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> . The first operators is a variant of the narrow exchange operator (a nearest neighbour interchange operator that also proposes a new height of the node that is moved) that ensure it remains within the cube. The second operators is a subtree-slide operator (moves internal node up or down, potentially causing topology changes) and ensures that the target location is compatible with the cube ordering.</p>
      <p>Based on the short MCMC run, we can transform the MCMC samples and directly estimate <italic toggle="yes">μ</italic> and Σ from the set of transformed values. There are many tools for visualising and otherwise post-processing a posterior based on an MCMC sample, such as Tracer (<xref rid="ref-29" ref-type="bibr">Rambaut et al., 2018</xref>), DensiTree (<xref rid="ref-6" ref-type="bibr">Bouckaert, 2010</xref>), <italic toggle="yes">etc</italic>etera. Once we obtain <italic toggle="yes">μ</italic> and Σ, <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> can be used to create such a sample.</p>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>Results</title>
    <p>In this section, we validate the matrix and cube representation of tree distributions and show that the method for learning a cube based variational Bayesian distribution passes well calibrated simulation studies and we will get an impression of the algorithm’s performance. Finally, we consider using a method for inferring summary trees.</p>
    <sec>
      <title>Matrices and cubes can accurately represent tree distributions</title>
      <p>To validate whether we can accurately represent a tree posterior obtained from a full MCMC run, we construct the distance matrix for each tree by taking the logarithm of the pairwise taxon path distance, then estimate the mean and covariance matrix for all relevant entries. Next, we sample a new tree distribution using <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> repeatedly to obtain a new tree sample. We compare clade support and clade height distribution with the original tree posterior using the <monospace>CladeSetComparator</monospace> from the Babel package (<ext-link xlink:href="https://github.com/rbouckaert/Babel" ext-link-type="uri">https://github.com/rbouckaert/Babel</ext-link>) in BEAST 2.</p>
      <sec>
        <title>Apes</title>
        <p><xref rid="fig-3" ref-type="fig">Figure 3</xref> shows a small illustrative example of a tree distribution over six apes. There is uncertainty at the root with 83% support for siamang being outgroup (blue trees in panels b &amp; d), 13% orangutan being outgroup (red trees) and 4% siamang and orangutan being outgroup (green trees). A cube can only represent two out of these three cases. By representing the first two, it covers 96% of the posterior distribution, which for many practical cases may be sufficient.</p>
        <fig position="float" id="fig-3">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-3</object-id>
          <label>Figure 3</label>
          <caption>
            <title>Comparing the ape dataset with a cube representation (A &amp; B) and matrix representation (C &amp; D).</title>
            <p>Plates A &amp; C show clade support in red and clade height in blue. Red dots indicate clade support, running from zero probability (bottom left corner) to 1 (top right corner). Blue dots are placed at the mean of the height of a clade. Both x and y axes are scaled so that the largest tree height (from among both data sets) is at the top right corner. Blue crosses indicate 95% highest probability density (HPD) intervals of clade height. For both red and blue dots, bigger dots mean more clade support. The x-axis represent clade values from one set, the y-axis that of another. If both sets are the same, all dots will be on the x = y line (black diagonal line). The two blue lines indicate there is 20% difference: points within these lines have less than 20% difference, points outside have more, and can be considered as evidence there is substantial difference between the two posteriors. Plates B &amp; D show the original tree set on the left. The trees with most prevalent topology are blue, the next prevalent red and least prevalent green. Plate (B) on the left shows the cube representation and plate (D) the matrix representation. A cube accurately represents most clades, but does not cover all clades, where a matrix can represent all clades but is less accurate in clade support (see text for details).</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g003" position="float"/>
        </fig>
        <p>Representing the third case where both siamang and orangutan are ougroup is possible with a matrix representation, as shown <xref rid="fig-3" ref-type="fig">Fig. 3D</xref>.</p>
        <p>What is striking in both panels a and c in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> is that the mean of the clade heights and 95% HPD intervals are very close. However, clade support is slightly distorted: for the cube, the trees with both siamang and orangutan as outgroup is completely missing. Since this only covers 4% of the posterior, this may not be such a big issue in general. The matrix has this clade represented, but instead of the original 83%, 13%, 4% distribution has 59%, 21%, 20% distribution, heavily over representing the siamang and orangutan as outgroup. This is visible in <xref rid="fig-3" ref-type="fig">Fig. 3C</xref> by the red dots being far from the diagonal. It appears the correlation matrix does not accurately capture possible non-linear correlations between the entries in the matrix.</p>
        <p>One source of such non-linearities is the tree topology interfering with distance distributions between pairs of taxa: in a topology ((A,B),C), the distance between A and B and the distance between A and C can be linearly correlated. And likewise in topology ((A,C),B). But if both topologies are in the tree set there is no reason the combined correlation to always behave linearly or even approximately linearly. Use of the minimum function for clade distances in the single link clustering algorithm is another source of non-linearity. A potential remedy is to use normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) to capture such non-linearities and provide a more sophisticated transformation between a multi-variate normal distribution and the associated tree topology.</p>
      </sec>
      <sec>
        <title>AARS</title>
        <p>A tree distribution with more uncertainty is from aminoacyl-tRNA synthetase (AARS) data for 204 Class I protozyme sequences (<xref rid="ref-9" ref-type="bibr">Carter Jr et al., 2022</xref>). A convenient way to characterise the uncertainty of a tree distribution is its entropy <xref rid="ref-24" ref-type="bibr">Lewis et al. (2016)</xref>, which can be calculated efficiently based on the conditional clade distribution (<xref rid="ref-22" ref-type="bibr">Larget, 2013</xref>) of the tree set. The AARS data has an entropy of 124.1, so more than half of the internal nodes are uncertain. The corresponding cube has an entropy of just 96.3, which shows that a cube representation can have a large entropy, thus representing a highly uncertain tree distribution.</p>
        <p><xref rid="fig-4" ref-type="fig">Figure 4A</xref> shows the clade set comparison for the AARS data, which shows that most of the clades that are supported in the cube have reasonably similar support as in the original tree set. Although there is a clade with 38.9% difference in clade support, and there are 5 other clades with more than 25% clade support difference, the average clade support difference is just 4.9% for clades with over 1% support. Note the set of red dots at the x-axis, which represent the set of clades that are not represented by the cube. Furthermore, clade heights also show very close correspondences: the mean height estimate differs just 2.2%. In summary, the clades match remarkably well given the high entropy of the tree set.</p>
        <fig position="float" id="fig-4">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-4</object-id>
          <label>Figure 4</label>
          <caption>
            <title> Comparing the AARS dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Clade support and heights show good correspondence as does the DensiTree.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g004" position="float"/>
        </fig>
        <p><xref rid="fig-4" ref-type="fig">Figure 4B</xref> shows a DensiTree of the original tree distribution on the left hand side and the cube representation on the right hand side. Visually, the images correspond quite well, confirming the information we have from the clade comparison panel. Note that the cube represents a large number of clades judging from the diversity of trees in the DensiTree as well as the large number of points in the clade comparison plot. Even though a considerable number of clades are missing, the majority of well supported clades are represented by the cube.</p>
      </sec>
      <sec>
        <title>Pama-Nynguan languages</title>
        <p><xref rid="fig-5" ref-type="fig">Figure 5</xref> shows another tree distribution, here for 306 Pama-Nynguan languages (<xref rid="ref-8" ref-type="bibr">Bouckaert, Bowern &amp; Atkinson, 2018</xref>) with a large entropy of 91.7 for the original tree distribution and 78.6 for the cube. <xref rid="fig-5" ref-type="fig">Figure 5</xref> shows the clade comparison, showing just three clades having more than 25% clade support, and two of them are two taxon clades. Again, we see good correspondence between original distribution obtained through MCMC and its cube representation.</p>
        <fig position="float" id="fig-5">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-5</object-id>
          <label>Figure 5</label>
          <caption>
            <title> Comparing the Pama-Nyungan dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g005" position="float"/>
        </fig>
      </sec>
      <sec>
        <title>Cichlids</title>
        <p>A more troublesome example is a tree distribution over 121 Cichlid sequences sourced from <xref rid="ref-25" ref-type="bibr">Matschiner et al. (2017)</xref>. The entropy of the original dataset is 38.4 but that of the cube representation is higher at 49.8. Different orderings were tried based on the ordering heuristics in DensiTree, but all of them resulted in a cube representation with significant number of clades having substantially different support.</p>
        <p>Since the cube representation contains fewer trees, there are fewer terms to contribute to the entropy, and since all terms must add to 1, these terms can be expected to be larger than for the original distribution. Therefore, one would expect entropy of a cube representation to decrease from that of the original tree distribution The fact the entropy for the cichlids data increased in the cube representation compared to the original dataset can be interpreted as a hint that the ordering is less than optimal. Optimising orderings is a topic for further research, but this example shows it is crucial for a good tree set representation.</p>
        <p><xref rid="fig-6" ref-type="fig">Figure 6</xref> shows the clade comparison and DensiTree. There are 23 clades that have more than 25% difference in support and the maximum difference in clade support is 80% for a clade in the original set that is missing from the cube representation. The mean height of clades differ only 0.57%, so correspond quite well. In this case, a cube representation appears to be less satisfactory than in the other examples.</p>
        <fig position="float" id="fig-6">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-6</object-id>
          <label>Figure 6</label>
          <caption>
            <title> Comparing the cichlids dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Significant number of clades have large difference in support in the cube representation, though heights of those clades that are captured show good correspondence.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g006" position="float"/>
        </fig>
      </sec>
      <sec>
        <title>Indo-European languages</title>
        <p>To demonstrate the cube representation works well for internal nodes, even though tip dates are sampled, we considered a recently published tree distribution over 161 languages (<xref rid="ref-16" ref-type="bibr">Heggarty et al., 2023</xref>). The tree set has an entropy of 42.3, the cube has 36.6 (<xref rid="fig-7" ref-type="fig">Figure 7</xref>).</p>
        <fig position="float" id="fig-7">
          <object-id pub-id-type="doi">10.7717/peerj.17276/fig-7</object-id>
          <label>Figure 7</label>
          <caption>
            <title> Comparing the Indo-European dataset with a cube representation.</title>
            <p>(A) Clade support as in <xref rid="fig-3" ref-type="fig">Fig. 3</xref> and (B) DensiTree of original and cube tree distribution. Even with dated tips the cube representation remains accurate.</p>
          </caption>
          <graphic xlink:href="peerj-12-17276-g007" position="float"/>
        </fig>
        <p>Maximum difference in clade support is 28.5% but only 2 clades have difference of 25% and on average the clade support difference is 4.1% for clades with more than 1% support. Mean height difference of clades (not counting tip heights) is less than 0.79% on average. So, even though the original distribution has dated tips, and the cube does not, clade support and clade heights remain quite closely represented when compared to the original.</p>
      </sec>
    </sec>
    <sec>
      <title>Cube-VB algorithm passes well calibrated simulation study</title>
      <p>To verify that the cube based variational distribution algorithm works, we performed a well calibrated simulation study (<xref rid="ref-28" ref-type="bibr">Mendes et al., 2023</xref>; <xref rid="ref-35" ref-type="bibr">Talts et al., 2018</xref>) using a tree with 50 taxa sampled from the Yule tree prior with birth rate narrowly distributed as normal (mean = 6, sigma = 0.1). This results in tree heights with mean 0.58 and 95% HPD of 0.34 to 0.79. Sequence data is generated under a HKY model with kappa lognormally distributed (mean = 1, sigma = 1.25), and a strict clock with rate fixed at 1 is used to complete the model. So, the parameter space being sampled consists of the kappa and birth rate parameters and a tree. We use sequence lengths of 100, 250 and 500 resulting in observed entropy in the inferred tree posteriors of 10.6, 6.4 and 3.8 respectively (<xref rid="table-1" ref-type="table">Table 1</xref>). We run 100 instances for each sequence length, and expect the 95%HPD of parameters of interest to contain the true value from 91 to 99 of the cases for the test to pass. <xref rid="table-1" ref-type="table">Table 1</xref> shows the results and the simulation study indeed passes.</p>
      <table-wrap position="float" id="table-1">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-1</object-id>
        <label>Table 1</label>
        <caption>
          <title>Coverage (in %) of 100 runs over 50 taxa with Yule, HKY strict clock for three different sequence lengths.</title>
          <p>Longer sequences result in lower entropy, but coverage of the parameters of interest (last four lines in table) are all in acceptable range.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g008" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Sequence length:</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Mean and 95% HPD</td>
                <td rowspan="1" colspan="1">10.6 (5.9–14.6)</td>
                <td rowspan="1" colspan="1">6.4 (3.2–10.4)</td>
                <td rowspan="1" colspan="1">3.8 (1.3–6.3)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Entropy</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree height</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">93</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree treeLength</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">BirthRate</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Kappa</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">93</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>A slightly more challenging case is where we sample trees from a coalescent tree prior with constant population size sampled from a lognormal (mean = 0.1, sigma = 0.1). The tree heights have a mean of 2.3 with 95% HPD interval of 0.6 to 5.0. We use a site model with gamma rate heterogeneity where the shape parameter is sampled from an exponential with mean 1, and use a GTR model with rate CT fixed to 1 and rate AG sampled from a log normal with mean 1 in real space and sigma = 1. The other four transversions rates are sampled from a log normal with mean in real space of 0.5 and sigma = 1. Stationary frequencies for the GTR model were sampled from a Dirichlet with <italic toggle="yes">α</italic> = 4 for all four dimensions. For this setup, getting accurate estimates of the uncertainty required running the MCMC a bit longer than for the case using HKY. <xref rid="table-2" ref-type="table">Table 2</xref> shows the coverage we get for all paramaters of interest and they are all in an acceptable range,<xref rid="fn-1" ref-type="fn"><sup>1</sup></xref>
<fn id="fn-1"><label>1</label><p>If the 95% HPD estimates are correct estimates, the simulation study is an experiment of flipping a coin with 95% probability of turning heads repeated 100 times. Here, observing a head equates finding the true value of a parameter being inside the 95% HPD interval. This results in a binomial distribution of observing heads on average 95 times and a 95% probability of being within a range of 91 to 99. Observing almost all coverage values in this range with the occasional outlier at 90 or 100 is deemed acceptable.</p></fn>although population size coverages were on the low side.</p>
      <table-wrap position="float" id="table-2">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-2</object-id>
        <label>Table 2</label>
        <caption>
          <title>As <xref rid="table-1" ref-type="table">Table 1</xref> but for coalescent with constant population, GTR with estimated frequencies using gamma rate heterogeneity and strict clock for three different sequence lengths.</title>
          <p>Coverage of the parameters of interest (last thirteen lines in table) are all in acceptable range.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g009" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Sequence length:</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Mean and 95% HPD</td>
                <td rowspan="1" colspan="1">13.1 (5.9–15.7)</td>
                <td rowspan="1" colspan="1">5.7 (3.0–9.1)</td>
                <td rowspan="1" colspan="1">4.7 (1.5–6.5)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Entropy</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree.height</td>
                <td rowspan="1" colspan="1">91</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Tree.treeLength</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">91</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAC</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">98</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAG</td>
                <td rowspan="1" colspan="1">100</td>
                <td rowspan="1" colspan="1">98</td>
                <td rowspan="1" colspan="1">95</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateAT</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateCG</td>
                <td rowspan="1" colspan="1">93</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">94</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">rateGT</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">99</td>
                <td rowspan="1" colspan="1">95</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.1</td>
                <td rowspan="1" colspan="1">94</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.2</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">92</td>
                <td rowspan="1" colspan="1">96</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.3</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">freqParameter.4</td>
                <td rowspan="1" colspan="1">95</td>
                <td rowspan="1" colspan="1">96</td>
                <td rowspan="1" colspan="1">98</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">gammaShape</td>
                <td rowspan="1" colspan="1">93</td>
                <td rowspan="1" colspan="1">100</td>
                <td rowspan="1" colspan="1">97</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">popSize</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">90</td>
                <td rowspan="1" colspan="1">90</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>This demonstrates that the cube based variational distribution algorithm can work well estimating a tree, scale parameters as well as constrained sum parameters (<italic toggle="yes">i.e.</italic> frequencies) for a number of popular phylogenetic models. Many model implementations are available in BEAST 2 that only require these types of parameters, in particular nucleotide and amino acid substitution models.</p>
    </sec>
    <sec>
      <title>Cube based variational distribution algorithm performs well</title>
      <p>To see how well the cube based variational distribution algorithm scales with number of taxa, we ran a simulation study with 50, 100, 250, 500, 750 and 1,000 taxa. For each taxon set size, we ran 25 instances of the Yule/HKY/strict clock model used for the well calibrated simulation study. For each instance, alignments of 250 sites were generated. We checked that coverage of 95% HPD intervals for tree height, tree length, kappa and birth rate parameters was between 22 and 25 to verify that the inferred posterior indeed matches the true distribution. Experiments were performed on a 2021 MacBook Pro laptop in OS X using BEAST v2.7.5 and BEAGLE v4.0.0 (<xref rid="ref-34" ref-type="bibr">Suchard &amp; Rambaut, 2009</xref>).</p>
      <p><xref rid="table-3" ref-type="table">Table 3</xref> shows run times in seconds, demonstrating it is feasible to perform large analyses in a short span of time. Sampling a representative posterior trace and tree log took the least time taking up no more than 2% of total runtime. MCMC for accurately estimating the covariance matrix took most of the time, from 40% for smaller taxon sets to over 90% for the larger tree sets. MAP finding and Cholesky decomposition in comparison took less time and are taking up relatively less time with growing taxon set sizes.</p>
      <table-wrap position="float" id="table-3">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-3</object-id>
        <label>Table 3</label>
        <caption>
          <title>Run times in seconds averaged over 25 instances for various taxon set sizes (in columns).</title>
          <p>Numbers in brackets are standard deviations.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g010" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1">Number of taxa</th>
                <th rowspan="1" colspan="1">50</th>
                <th rowspan="1" colspan="1">100</th>
                <th rowspan="1" colspan="1">250</th>
                <th rowspan="1" colspan="1">500</th>
                <th rowspan="1" colspan="1">750</th>
                <th rowspan="1" colspan="1">1000</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">MAP finding</td>
                <td rowspan="1" colspan="1">1.17 (0.03)</td>
                <td rowspan="1" colspan="1">1.48 (0.03)</td>
                <td rowspan="1" colspan="1">2.36 (0.08)</td>
                <td rowspan="1" colspan="1">3.91 (0.08)</td>
                <td rowspan="1" colspan="1">5.30 (0.19)</td>
                <td rowspan="1" colspan="1">6.43 (0.40)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">MCMC</td>
                <td rowspan="1" colspan="1">1.15 (0.03)</td>
                <td rowspan="1" colspan="1">2.77 (0.05)</td>
                <td rowspan="1" colspan="1">12.08 (0.24)</td>
                <td rowspan="1" colspan="1">41.84 (0.72)</td>
                <td rowspan="1" colspan="1">94.74 (3.29)</td>
                <td rowspan="1" colspan="1">172.25 (8.24)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Decomposition</td>
                <td rowspan="1" colspan="1">0.45 (0.01)</td>
                <td rowspan="1" colspan="1">0.60 (0.02)</td>
                <td rowspan="1" colspan="1">0.93 (0.03)</td>
                <td rowspan="1" colspan="1">1.69 (0.04)</td>
                <td rowspan="1" colspan="1">2.88 (0.20)</td>
                <td rowspan="1" colspan="1">4.47 (0.10)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Sampling output</td>
                <td rowspan="1" colspan="1">0.23 (0.02)</td>
                <td rowspan="1" colspan="1">0.36 (0.02)</td>
                <td rowspan="1" colspan="1">0.68 (0.02)</td>
                <td rowspan="1" colspan="1">1.40 (0.03)</td>
                <td rowspan="1" colspan="1">2.18 (0.05)</td>
                <td rowspan="1" colspan="1">3.27 (0.15)</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Total runtime</td>
                <td rowspan="1" colspan="1">3.00 (0.05)</td>
                <td rowspan="1" colspan="1">5.20 (0.08)</td>
                <td rowspan="1" colspan="1">16.05 (0.27)</td>
                <td rowspan="1" colspan="1">48.83 (0.79)</td>
                <td rowspan="1" colspan="1">105.10 (3.33)</td>
                <td rowspan="1" colspan="1">186.42 (8.60)</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p>Total calculation time fits a quadratic function (1.70<italic toggle="yes">E</italic> − 4<italic toggle="yes">x</italic><sup>2</sup> + 1.43<italic toggle="yes">E</italic> − 2<italic toggle="yes">x</italic>) with <italic toggle="yes">R</italic><sup>2</sup> = 0.9997, so the algorithm seems to scale quadratically. The chain length used are a linear function of the number of taxa, and tree likelihood calculation time (which dominates posterior calculation time here) both scale linear in the number of taxa. Changing the former could change how the algorithm scales. The most striking feature of the table though is that all times can comfortably be expressed in seconds using just three digits before the decimal point.</p>
    </sec>
    <sec>
      <title>Summary tree</title>
      <p>Observe that by setting <bold>z</bold> = <bold>0</bold> in <xref rid="fsrc2" ref-type="other">Algorithm 2</xref> we can obtain a tree that is at the mode of the distribution. This tree should be representative of the complete distribution so can be used as a summary tree. Note that it can have a topology that differs from all trees in the tree set to be summarised, unlike popular methods like the maximum clade credibility (MCC) tree implemented in TreeAnnotator. <xref rid="table-4" ref-type="table">Table 4</xref> shows some the sum of posterior clade support in the summary tree for MMC and matrix representation based summary trees. This is proportional to the number of internal nodes minus the Robinson-Foulds distance averaged over the tree set. The table shows that matrix based summary tree never produced worse trees and sometimes does considerably better. The log product of clade probability is used in MCC trees to find the best fitting topology. <xref rid="table-4" ref-type="table">Table 4</xref> shows even according to that criterion the matrix approach can do better, which is remarkable since MCC explicitly maximises that criterion. Further evaluation with less crude measures of summary tree quality are required to establish when matrix based summary trees outperform MCC trees.</p>
      <table-wrap position="float" id="table-4">
        <object-id pub-id-type="doi">10.7717/peerj.17276/table-4</object-id>
        <label>Table 4</label>
        <caption>
          <title>Sum and log product of posterior clade support over all clades in the summary tree for MCC tree and matrix representation based tree.</title>
          <p>Higher is better. The entries marked with asterisk ignore zero support clades (one clade for cichlids, three for NZ votes). The matrix approach is never worse and sometimes considerably better.</p>
        </caption>
        <alternatives>
          <graphic xlink:href="peerj-12-17276-g011" position="float"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
              <col span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th align="center" colspan="3" rowspan="1">Sum of clade</th>
                <th align="center" colspan="3" rowspan="1">Log product of clade</th>
              </tr>
              <tr>
                <th rowspan="1" colspan="1"/>
                <th align="center" colspan="3" rowspan="1">probability</th>
                <th align="center" colspan="3" rowspan="1">probability</th>
              </tr>
              <tr>
                <th rowspan="1" colspan="1">Data set</th>
                <th rowspan="1" colspan="1">MCC</th>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Matrix</th>
                <th rowspan="1" colspan="1">MCC</th>
                <th rowspan="1" colspan="1"/>
                <th rowspan="1" colspan="1">Matrix</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="1" colspan="1">Apes</td>
                <td rowspan="1" colspan="1">4.8</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">4.8</td>
                <td rowspan="1" colspan="1">−0.2</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">−0.2</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">IE</td>
                <td rowspan="1" colspan="1">136.9</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">138.9</td>
                <td rowspan="1" colspan="1">−35.0</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−29.2</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">AARS</td>
                <td rowspan="1" colspan="1">133.6</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">142.9</td>
                <td rowspan="1" colspan="1">−128.4</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−90.8</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Cichlids</td>
                <td rowspan="1" colspan="1">91.7</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">93.7</td>
                <td rowspan="1" colspan="1">−42.3</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−34.7*</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">NZ votes</td>
                <td rowspan="1" colspan="1">26.7</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">34.1</td>
                <td rowspan="1" colspan="1">−297.1</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−217.6*</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Pama-Nyungan</td>
                <td rowspan="1" colspan="1">255.6</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">262.4</td>
                <td rowspan="1" colspan="1">−80.5</td>
                <td rowspan="1" colspan="1">&lt;</td>
                <td rowspan="1" colspan="1">−59.3</td>
              </tr>
              <tr>
                <td rowspan="1" colspan="1">Species</td>
                <td rowspan="1" colspan="1">27.5</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">27.5</td>
                <td rowspan="1" colspan="1">−2.6</td>
                <td rowspan="1" colspan="1">=</td>
                <td rowspan="1" colspan="1">−2.6</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p><bold>Matrix and cube representations can accurately represent tree distributions:</bold> For tree distributions with low to medium entropy (<xref rid="ref-24" ref-type="bibr">Lewis et al., 2016</xref>) based on its conditional clade distribution (<xref rid="ref-22" ref-type="bibr">Larget, 2013</xref>), we demonstrated that a substantial part of the posterior can be represented using a single cube. For those cases it is possible to do fast inference of rooted time trees using a cube based variational distribution approach outlined in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> . For tree distributions with high entropy, it may not be possible to capture a substantial portion of the posterior by a single cube. An example is a sample over 50 taxa from a Yule prior (<xref rid="supp-1" ref-type="supplementary-material">Fig. S1</xref>), where a cube representation will suggest much older internal node heights with higher clade support than the original distribution. Using more than one cube might elevate this somewhat, but since there can be overlap between the trees represented by the various cubes, and this overlap is hard to characterise (L. Berling, 2023, personal communication) this may not be a fruitful avenue. A more productive way may be to use more entries in the distance matrix. This breaks the bijective property of the transformation, but facilitates a greater coverage of the full tree space. This will result increase the non-linearity of dependencies between the various matrix entries due to correlations changing when topologies change. Normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) allow for greater flexibility in representing such non-linear dependencies, and may provide a way to transform a multi-variate normal distribution into a tree distribution.</p>
    <p>One situation where node height distributions can deviate significantly from being log-normally distributed is when node calibrations are used in the tree that interact with each other. For example, clade <italic toggle="yes">A</italic> may be known to be at least <italic toggle="yes">X</italic> years old, so a uniform prior with lower bound of <italic toggle="yes">X</italic> seems appropriate. When clade <italic toggle="yes">B</italic> (consisting of clade <italic toggle="yes">A</italic> plus 1 node so that the MRCA of <italic toggle="yes">B</italic> is the parent of the MRCA of <italic toggle="yes">A</italic>) is assigned a distribution with a mean not very far above <italic toggle="yes">X</italic> (with large variance), the age distribution of the MRCA of <italic toggle="yes">B</italic> will be lower bounded by <italic toggle="yes">X</italic> as well. In this case, a log-transform may not be appropriate for accurate capturing of this distribution, and a matrix representation may fail to accurately capture such distribution. Again, normalising flows could be employed to address this.</p>
    <p><bold>Optimisation based variational Bayesian:</bold> Variational Bayesian algorithms are usually optimisation based, where the evidence lower bound (ELBO) is maximised. The ELBO is proportional to the posterior plus a term that measures the distance between the true and approximate distribution. The benefit of maximisation over MCMC is that there are no restrictions on optimisation proposals unlike with MCMC where one needs to be careful to use appropriate Hastings ratios in order to ensure there is no bias in sampling from the posterior. One way to optimise the ELBO is by the hugely popular stochastic gradient ascent algorithm, which randomly draws a new state, calculates the gradient of the ELBO with respect to a random subset of parameters and moves parameters in the state in the direction of the gradient. This process is iterated until convergence is reached. However, there are some issues with gradient ascent: a gradient is required, which can be computationally expensive. Furthermore, it has domain specific parameters, such as learning rate, learning rate scheme, and parameter subset size. Also, random subsets may need to be tuned for efficient exploitation of subsets. Finally, the convergence criterion has large impact on the number of iterations. Since points are drawn stochastically, the convergence criterion needs to deal with noise. Instead of dealing with all these issues, here we introduced an MCMC based algorithm to learn a variational distribution that benefits from all MCMC related optimisations implemented in BEAST 2 (such as adaptive operator tuning). It serves as a proof of concept demonstrating that cube spaces are suitable for variational inference. Of course, this still leave opportunities for ELBO maximisation implementations of cube based variational inference.</p>
    <p><bold>Cube-VB algorithm parameters:</bold> Notwithstanding the issues of ELBO optimisation based VB, the MCMC based approach to learning a variational distribution we introduced in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> has a number of parameters that need to be specified, in particular the start and end temperatures and number of repeats for simulated annealing for finding a (close to) MAP state. We chose a start temperature of 0.1 and end temperature of 0.01, which worked quite well for our experiments, so this seems a reasonable option. Putting in more than 25 repeats barely led to improvement of the posterior of the MAP state, but halving it turned out to be detrimental (well calibrated simulation studies did not pass).</p>
    <p>Another parameter to set is the length of MCMC chain for estimating the covariance matrix. The heuristic implemented in the <monospace>cubevb</monospace> package for BEAST 2 is to count the number of parameters and multiply with a user specified value. In our experiments with the HKY model, a multiplier of 1,000 was sufficient. The more samples, the more accurate the matrix estimate but the longer it takes for the algorithm to finish. In that sense, it nicely fits the class of online algorithms (<xref rid="ref-4" ref-type="bibr">Bouckaert, Collienne &amp; Gavryushkin, 2022</xref>) that at any time can provide an answer, but the answer becomes more accurate the longer the algorithm runs. Detecting when longer runs do not increase accuracy of the posterior any more is an open question where automated convergence techniques employed for standard MCMC (<xref rid="ref-1" ref-type="bibr">Berling, Bouckaert &amp; Gavryushkin, 2023</xref>) could be exploited. These are all based on running two analyses in parallel and measuring the difference in the distributions that are obtained.</p>
    <p><bold>Why the Cube-VB algorithm works:</bold> Since plain MCMC is used in <xref rid="fsrc3" ref-type="other">Algorithm 3</xref> one may wonder why this is more efficient than just running full MCMC and not being restricted to a cube space. The reason for this stems from the assumption that the true distribution can be represented as a transformation of a multivariate normal distribution. Consider the <italic toggle="yes">κ</italic> parameter for the HKY model and a log-transformation. In practice, we see that <italic toggle="yes">κ</italic> is close to log-normally distributed, so representing the posterior as a normal with log-transform leads to little distortion. Now notice that we only have to estimate the mean and variance of the log-normal under this assumption, instead of estimating a full unparameterised distribution, which is what we would be doing with full MCMC. So, even though a small MCMC sample will not be sufficient to accurately represent the distribution of <italic toggle="yes">κ</italic> and statistics like 95% HPDs, there will be sufficient information to accurately estimate two parameters of a log-normal, from which statistics like 95% HPDs then can accurately be inferred.</p>
    <p><bold>Variational Bayesian for matrix representation:</bold> The Cube-VB algorithm can be adapted to suitable matrix representations by replacing Step 2 by some method of identifying which entries in the matrix need to be specified and which entries can be left unspecified. Step 3 would need adjustment in the operators to ensure all possible tree topologies that can be represented by the matrix are available to be proposed. It is an open problem what the best strategy is for identifying which and how many entries should be specified. Since a cube can capture a substantial part of a posterior, identifying a cube could be a first step followed by filling in entries where clades represented have substantial support.</p>
  </sec>
  <sec>
    <title>Conclusion</title>
    <p>Matrix space is introduced as a representation of all or, in the case of cubes, a significant part of tree space. We demonstrated for simple phylogenetic models it allows fast inference of the most relevant part of the tree posterior using just a cube representation, thus capturing most of the uncertainty in the posterior distribution.</p>
    <p>There are many venues to extend and develop this work, in particular into the area of more sophisticated phylogenetic models. Here we mention just a few of the more commonly used models and potential issues implementing inference for them in matrix representation, in particular cubes:</p>
    <list list-type="simple" id="list-3">
      <list-item>
        <label> •</label>
        <p>In general, finding an appropriate subset of pairwise distances, <italic toggle="yes">i.e.</italic> subset of entries in the matrix, an obvious open problem. Finding the optimal ordering for a cube is an instance of this problem. It is probably related to finding a good ordering for drawing trees in DensiTree (<xref rid="ref-6" ref-type="bibr">Bouckaert, 2010</xref>) for which various heuristics have been developed. It is not clear how to transfer these heuristics to the VB setting and new heuristics may need to be developed.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Flexible nonparametric tree priors take epochs in accounts like the Bayesian skyline plot (<xref rid="ref-12" ref-type="bibr">Drummond et al., 2005</xref>) and birth death skyline plot (<xref rid="ref-32" ref-type="bibr">Stadler et al., 2013</xref>) and are widely used but may be challenging to parameterise in a variational Bayesian setting due to their discrete components. Models that integrate out most parameters and have only a single continuous parameter, like BICEPS and multi Yule (<xref rid="ref-7" ref-type="bibr">Bouckaert, 2022</xref>), can be good alternatives and should be straightforward to implement in our cube VB algorithm.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Relaxed clocks (<xref rid="ref-11" ref-type="bibr">Drummond et al., 2006</xref>; <xref rid="ref-10" ref-type="bibr">Douglas, Zhang &amp; Bouckaert, 2021</xref>) need to be adapted for cube space. Due to discontinuities between different topologies, simply associating a (log)normal branch rate distribution with each taxon and each dimension of the cube may not be sufficient. Normalising flows (<xref rid="ref-30" ref-type="bibr">Rezende &amp; Mohamed, 2015</xref>) may be required to capture relaxed branch rate distributions.</p>
      </list-item>
      <list-item>
        <label> •</label>
        <p>Dated tips put restrictions on the height of internal nodes. When tip dates are uncertain and need te be sampled from a distribution, this adds extra dimensions to the multivariate normal representation of the posterior.</p>
      </list-item>
    </list>
    <p>On the other hand, extensions into empirical models of amino acids, models that integrate out internal states like ancestral reconstruction (<xref rid="ref-23" ref-type="bibr">Lemey et al., 2009</xref>) and phylogeography (<xref rid="ref-3" ref-type="bibr">Bouckaert, 2016</xref>) should be straightforward to adapt.</p>
    <p>In summary, there are many exciting new opportunities waiting to be explored in cube and matrix space for fast phylogenetic inference.</p>
  </sec>
  <sec sec-type="supplementary-material" id="supplemental-information">
    <title>Supplemental Information</title>
    <supplementary-material id="supp-1" position="float" content-type="local-data">
      <object-id pub-id-type="doi">10.7717/peerj.17276/supp-1</object-id>
      <label>Supplemental Information 1</label>
      <caption>
        <title>Tree distribution sampled from Yule prior and its cube representation</title>
        <p>As <xref rid="fig-3" ref-type="fig">Fig. 3</xref>, but with a tree sampled from a Yule prior with 50 taxa, resulting in a tree set sampled uniformly over ranked trees and has high entropy. The cube representation of this tree set has substantially older internal nodes and higher clade support for many clades than the original tree set.</p>
      </caption>
      <media xlink:href="peerj-12-17276-s001.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>This work was greatly helped by stimulating discussions with members of the Center of Computational Evolution at the University of Auckland, in particular with Alexei Drummond. Special thanks to Jordan Douglas for proofreading.</p>
  </ack>
  <sec sec-type="additional-information">
    <title>Additional Information and Declarations</title>
    <fn-group content-type="competing-interests">
      <title>Competing Interests</title>
      <fn id="conflict-1" fn-type="COI-statement">
        <p>The authors declare there are no competing interests.</p>
      </fn>
    </fn-group>
    <fn-group content-type="author-contributions">
      <title>Author Contributions</title>
      <fn id="contribution-1" fn-type="con">
        <p><xref rid="author-1" ref-type="contrib">Remco R. Bouckaert</xref> conceived and designed the experiments, performed the experiments, analyzed the data, prepared figures and/or tables, authored or reviewed drafts of the article, and approved the final draft.</p>
      </fn>
    </fn-group>
    <fn-group content-type="other">
      <title>Data Availability</title>
      <fn id="addinfo-1">
        <p>The following information was supplied regarding data availability:</p>
        <p>The data and code is available at GitHub and Zenodo:</p>
        <p>- <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link>
</p>
        <p>- Remco, B. (2024). CubeVB package for BEAST2: archive of <ext-link xlink:href="https://github.com/rbouckaert/cubevb" ext-link-type="uri">https://github.com/rbouckaert/cubevb</ext-link>. In Variational Bayesian Phylogenies through Matrix Representation of Tree Space: Vol. tbd (v1.0.1). Zenodo. <ext-link xlink:href="https://doi.org/10.5281/zenodo.10594658" ext-link-type="uri">https://doi.org/10.5281/zenodo.10594658</ext-link>.</p>
      </fn>
    </fn-group>
  </sec>
  <ref-list content-type="authoryear">
    <title>References</title>
    <ref id="ref-1">
      <label>Berling, Bouckaert &amp; Gavryushkin (2023)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Berling</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>Automated convergence diagnostic for phylogenetic MCMC analyses</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2023.08.10.552869</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-2">
      <label>Betancourt (2012)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Betancourt</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2012">2012</year>
        <article-title>Cruising the simplex: Hamiltonian Monte Carlo and the Dirichlet distribution</article-title>
        <source>AIP conference proceedings 31st</source>
        <volume>1443</volume>
        <issue>1</issue>
        <fpage>157</fpage>
        <lpage>164</lpage>
        <pub-id pub-id-type="doi">10.1063/1.3703631</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-3">
      <label>Bouckaert (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>Phylogeography by diffusion on a sphere: whole world phylogeography</article-title>
        <source>PeerJ</source>
        <volume>4</volume>
        <elocation-id>e2406</elocation-id>
        <pub-id pub-id-type="doi">10.7717/peerj.2406</pub-id>
        <pub-id pub-id-type="pmid">27651992</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-4">
      <label>Bouckaert, Collienne &amp; Gavryushkin (2022)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Collienne</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Online Bayesian analysis with BEAST 2</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2022.05.03.490538</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-5">
      <label>Bouckaert et al. (2019)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Vaughan</surname>
            <given-names>TG</given-names>
          </name>
          <name>
            <surname>Barido-Sottani</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Duchêne</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Fourment</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gavryushkina</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Heled</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>De Maio</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Matschiner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Mendes</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Müller</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Ogilvie</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Plessis</surname>
            <given-names>Ld</given-names>
          </name>
          <name>
            <surname>Popinga</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rasmussen</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Siveroni</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>C-H</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Stadler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2019">2019</year>
        <article-title>BEAST 2.5: an advanced software platform for Bayesian evolutionary analysis</article-title>
        <source>PLOS Computational Biology</source>
        <volume>15</volume>
        <issue>4</issue>
        <elocation-id>e1006650</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1006650</pub-id>
        <pub-id pub-id-type="pmid">30958812</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-6">
      <label>Bouckaert (2010)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2010">2010</year>
        <article-title>DensiTree: making sense of sets of phylogenetic trees</article-title>
        <source>Bioinformatics</source>
        <volume>26</volume>
        <issue>10</issue>
        <fpage>1372</fpage>
        <lpage>1373</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btq110</pub-id>
        <pub-id pub-id-type="pmid">20228129</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-7">
      <label>Bouckaert (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>An efficient coalescent epoch model for Bayesian phylogenetic inference</article-title>
        <source>Systematic Biology</source>
        <volume>71</volume>
        <issue>6</issue>
        <fpage>1549</fpage>
        <lpage>1560</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syac015</pub-id>
        <pub-id pub-id-type="pmid">35212733</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-8">
      <label>Bouckaert, Bowern &amp; Atkinson (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bouckaert</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Bowern</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Atkinson</surname>
            <given-names>QD</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>The origin and expansion of Pama–Nyungan languages across Australia</article-title>
        <source>Nature Ecology &amp; Evolution</source>
        <volume>2</volume>
        <issue>4</issue>
        <fpage>741</fpage>
        <lpage>749</lpage>
        <pub-id pub-id-type="doi">10.1038/s41559-018-0489-3</pub-id>
        <pub-id pub-id-type="pmid">29531347</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-9">
      <label>Carter Jr et al. (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Carter Jr</surname>
            <given-names>CW</given-names>
          </name>
          <name>
            <surname>Popinga</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>PR</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Multidimensional phylogenetic metrics identify Class I Aminoacyl-tRNA synthetase evolutionary mosaicity and inter-modular coupling</article-title>
        <source>International Journal of Molecular Sciences</source>
        <volume>23</volume>
        <issue>3</issue>
        <fpage>1520</fpage>
        <lpage>1544</lpage>
        <pub-id pub-id-type="doi">10.3390/ijms23031520</pub-id>
        <pub-id pub-id-type="pmid">35163448</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-10">
      <label>Douglas, Zhang &amp; Bouckaert (2021)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Douglas</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2021">2021</year>
        <article-title>Adaptive dating and fast proposals: revisiting the phylogenetic relaxed clock model</article-title>
        <source>PLOS Computational Biology</source>
        <volume>17</volume>
        <issue>2</issue>
        <elocation-id>e1008322</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1008322</pub-id>
        <pub-id pub-id-type="pmid">33529184</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-11">
      <label>Drummond et al. (2006)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Ho</surname>
            <given-names>SYW</given-names>
          </name>
          <name>
            <surname>Phillips</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2006">2006</year>
        <article-title>Relaxed phylogenetics and dating with confidence</article-title>
        <source>PLOS Biology</source>
        <volume>4</volume>
        <issue>5</issue>
        <elocation-id>e88</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.0040088</pub-id>
        <pub-id pub-id-type="pmid">16683862</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-12">
      <label>Drummond et al. (2005)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Shapiro</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Pybus</surname>
            <given-names>OG</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2005">2005</year>
        <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences</article-title>
        <source>Molecular Biology and Evolution</source>
        <volume>22</volume>
        <issue>5</issue>
        <fpage>1185</fpage>
        <lpage>1192</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msi103</pub-id>
        <pub-id pub-id-type="pmid">15703244</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-13">
      <label>Florek et al. (1951)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Florek</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Łukaszewicz</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Perkal</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Steinhaus</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Zubrzycki</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1951">1951</year>
        <article-title>Sur la liaison et la division des points d’un ensemble fini</article-title>
        <volume>2</volume>
        <issue>3–4</issue>
        <source>Colloquium Mathematicum</source>
        <fpage>282</fpage>
        <lpage>285</lpage>
        <pub-id pub-id-type="doi">10.4064/cm-2-3-4-282-285</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-14">
      <label>Fourment &amp; Darling (2019)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fourment</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Darling</surname>
            <given-names>AE</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2019">2019</year>
        <article-title>Evaluating probabilistic programming and fast variational Bayesian inference in phylogenetics</article-title>
        <source>PeerJ</source>
        <volume>7</volume>
        <elocation-id>e8272</elocation-id>
        <pub-id pub-id-type="doi">10.7717/peerj.8272</pub-id>
        <pub-id pub-id-type="pmid">31976168</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-15">
      <label>Gavryushkin &amp; Drummond (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gavryushkin</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>The space of ultrametric phylogenetic trees</article-title>
        <source>Journal of Theoretical Biology</source>
        <volume>403</volume>
        <fpage>197</fpage>
        <lpage>208</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jtbi.2016.05.001</pub-id>
        <pub-id pub-id-type="pmid">27188249</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-16">
      <label>Heggarty et al. (2023)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heggarty</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Anderson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Scarborough</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>King</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jocz</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Kümmel</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Jügel</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Irslinger</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Pooth</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Liljegren</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Strand</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Haig</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Macák</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Anonby</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Pronk</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Belyaev</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Dewey-Findell</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Boutilier</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Freiberg</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Tegethoff</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Serangeli</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Liosis</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Stroński</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Schulte</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Kumar Gupta</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Haak</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Krause</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Atkinson</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Greenhill</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gray</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>Language trees with sampled ancestors support a hybrid model for the origin of Indo-European languages</article-title>
        <source>Science</source>
        <volume>381</volume>
        <issue>6656</issue>
        <elocation-id>eabg0818</elocation-id>
        <pub-id pub-id-type="doi">10.1126/science.abg0818</pub-id>
        <pub-id pub-id-type="pmid">37499002</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-17">
      <label>Heled &amp; Drummond (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heled</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Bayesian inference of species trees from multilocus data</article-title>
        <source>Molecular Biology and Evolution</source>
        <volume>27</volume>
        <issue>3</issue>
        <fpage>570</fpage>
        <lpage>580</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msp274</pub-id>
        <pub-id pub-id-type="pmid">19906793</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-18">
      <label>Höhna et al. (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Höhna</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Landis</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Heath</surname>
            <given-names>TA</given-names>
          </name>
          <name>
            <surname>Boussau</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lartillot</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Moore</surname>
            <given-names>BR</given-names>
          </name>
          <name>
            <surname>Huelsenbeck</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Ronquist</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>RevBayes: Bayesian phylogenetic inference using graphical models and an interactive model-specification language</article-title>
        <source>Systematic Biology</source>
        <volume>65</volume>
        <issue>4</issue>
        <fpage>726</fpage>
        <lpage>736</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syw021</pub-id>
        <pub-id pub-id-type="pmid">27235697</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-19">
      <label>Huelsenbeck &amp; Ronquist (2001)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huelsenbeck</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Ronquist</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2001">2001</year>
        <article-title>MrBayes: bayesian inference of phylogenetic trees</article-title>
        <source>Bioinformatics</source>
        <volume>17</volume>
        <issue>8</issue>
        <fpage>754</fpage>
        <lpage>755</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/17.8.754</pub-id>
        <pub-id pub-id-type="pmid">11524383</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-20">
      <label>Jiang, Tabaghi &amp; Mirarab (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Tabaghi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Learning hyperbolic embedding for phylogenetic tree placement and updates</article-title>
        <source>Biology</source>
        <volume>11</volume>
        <issue>9</issue>
        <fpage>1256</fpage>
        <pub-id pub-id-type="doi">10.3390/biology11091256</pub-id>
        <pub-id pub-id-type="pmid">36138735</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-21">
      <label>Jordan et al. (1999)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Ghahramani</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Jaakkola</surname>
            <given-names>TS</given-names>
          </name>
          <name>
            <surname>Saul</surname>
            <given-names>LK</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1999">1999</year>
        <article-title>An introduction to variational methods for graphical models</article-title>
        <source>Machine Learning</source>
        <volume>37</volume>
        <issue>2</issue>
        <fpage>183</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1023/A:1007665907178</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-22">
      <label>Larget (2013)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Larget</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2013">2013</year>
        <article-title>The estimation of tree posterior probabilities using conditional clade probability distributions</article-title>
        <source>Systematic Biology</source>
        <volume>62</volume>
        <issue>4</issue>
        <fpage>501</fpage>
        <lpage>511</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syt014</pub-id>
        <pub-id pub-id-type="pmid">23479066</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-23">
      <label>Lemey et al. (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lemey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Bayesian phylogeography finds its roots</article-title>
        <source>PLOS Computational Biology</source>
        <volume>5</volume>
        <issue>9</issue>
        <elocation-id>e1000520</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1000520</pub-id>
        <pub-id pub-id-type="pmid">19779555</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-24">
      <label>Lewis et al. (2016)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lewis</surname>
            <given-names>PO</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>M-H</given-names>
          </name>
          <name>
            <surname>Kuo</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lewis</surname>
            <given-names>LA</given-names>
          </name>
          <name>
            <surname>Fučíková</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Neupane</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Y-B</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2016">2016</year>
        <article-title>Estimating Bayesian phylogenetic information content</article-title>
        <source>Systematic Biology</source>
        <volume>65</volume>
        <issue>6</issue>
        <fpage>1009</fpage>
        <lpage>1023</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syw042</pub-id>
        <pub-id pub-id-type="pmid">27155008</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-25">
      <label>Matschiner et al. (2017)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matschiner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Musilová</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Barth</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Starostová</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Salzburger</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Steel</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2017">2017</year>
        <article-title>Bayesian phylogenetic estimation of clade ages supports trans-Atlantic dispersal of cichlid fishes</article-title>
        <source>Systematic Biology</source>
        <volume>66</volume>
        <issue>1</issue>
        <fpage>3</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syx025</pub-id>
        <pub-id pub-id-type="pmid">28173588</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-26">
      <label>Matsumoto, Mimori &amp; Fukunaga (2021)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Matsumoto</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Mimori</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fukunaga</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2021">2021</year>
        <article-title>Novel metric for hyperbolic phylogenetic tree embeddings</article-title>
        <source>Biology Methods and Protocols</source>
        <volume>6</volume>
        <issue>1</issue>
        <fpage>bpab006</fpage>
        <pub-id pub-id-type="doi">10.1093/biomethods/bpab006</pub-id>
        <pub-id pub-id-type="pmid">33928190</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-27">
      <label>Mau, Newton &amp; Larget (1999)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mau</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Newton</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Larget</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1999">1999</year>
        <article-title>Bayesian phylogenetic inference via Markov chain Monte Carlo methods</article-title>
        <source>Biometrics</source>
        <volume>55</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1111/j.0006-341X.1999.00001.x</pub-id>
        <pub-id pub-id-type="pmid">11318142</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-28">
      <label>Mendes et al. (2023)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Mendes</surname>
            <given-names>FK</given-names>
          </name>
          <name>
            <surname>Bouckaert</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Carvalho</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2023">2023</year>
        <article-title>How to validate a Bayesian evolutionary model</article-title>
        <source>BioRxiv</source>
        <pub-id pub-id-type="doi">10.1101/2024.02.11.579856</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-29">
      <label>Rambaut et al. (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Baele</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Posterior summarization in Bayesian phylogenetics using Tracer 1.7</article-title>
        <source>Systematic Biology</source>
        <volume>67</volume>
        <issue>5</issue>
        <fpage>901</fpage>
        <lpage>904</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syy032</pub-id>
        <pub-id pub-id-type="pmid">29718447</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-30">
      <label>Rezende &amp; Mohamed (2015)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rezende</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Mohamed</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2015">2015</year>
        <article-title>Variational inference with normalizing flows</article-title>
        <pub-id pub-id-type="arxiv">1505.05770</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-31">
      <label>Sokal &amp; Michener (1958)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sokal</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Michener</surname>
            <given-names>CD</given-names>
          </name>
        </person-group>
        <year iso-8601-date="1958">1958</year>
        <article-title>A statiscal method for evaluating systematic relationships</article-title>
        <source>University of Kansas Science Bulletin</source>
        <volume>38</volume>
        <fpage>1409</fpage>
        <lpage>1438</lpage>
      </element-citation>
    </ref>
    <ref id="ref-32">
      <label>Stadler et al. (2013)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stadler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Kühnert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Bonhoeffer</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2013">2013</year>
        <article-title>Birth–death skyline plot reveals temporal changes of epidemic spread in HIV and hepatitis C virus (HCV)</article-title>
        <source>Proceedings of the National Academy of Sciences of the United States of America</source>
        <volume>110</volume>
        <issue>1</issue>
        <fpage>228</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1207965110</pub-id>
        <pub-id pub-id-type="pmid">23248286</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-33">
      <label>Suchard et al. (2018)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Lemey</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Baele</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Ayres</surname>
            <given-names>DL</given-names>
          </name>
          <name>
            <surname>Drummond</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Bayesian phylogenetic and phylodynamic data integration using BEAST 1.10</article-title>
        <source>Virus Evolution</source>
        <volume>4</volume>
        <issue>1</issue>
        <fpage>vey016</fpage>
        <pub-id pub-id-type="doi">10.1093/ve/vey016</pub-id>
        <pub-id pub-id-type="pmid">29942656</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-34">
      <label>Suchard &amp; Rambaut (2009)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suchard</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Rambaut</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2009">2009</year>
        <article-title>Many-core algorithms for statistical phylogenetics</article-title>
        <source>Bioinformatics</source>
        <volume>25</volume>
        <issue>11</issue>
        <fpage>1370</fpage>
        <lpage>1376</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp244</pub-id>
        <pub-id pub-id-type="pmid">19369496</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-35">
      <label>Talts et al. (2018)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Talts</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Betancourt</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Simpson</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Vehtari</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Gelman</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Validating Bayesian inference algorithms with simulation-based calibration</article-title>
        <pub-id pub-id-type="arxiv">1804.06788</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-36">
      <label>Van Laarhoven et al. (1987)</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Van Laarhoven</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Aarts</surname>
            <given-names>EH</given-names>
          </name>
          <name>
            <surname>van Laarhoven</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Aarts</surname>
            <given-names>EH</given-names>
          </name>
        </person-group>
        <article-title>Simulated annealing</article-title>
        <source>Simulated Annealing: Theory and Applications. Mathematics and its Applications</source>
        <volume>vol. 37</volume>
        <year iso-8601-date="1987">1987</year>
        <publisher-loc>Dordrecht</publisher-loc>
        <publisher-name>Springer</publisher-name>
        <comment>. <uri xlink:href="https://doi.org/10.1007/978-94-015-7744-1_2">https://doi.org/10.1007/978-94-015-7744-1_2</uri>
</comment>
      </element-citation>
    </ref>
    <ref id="ref-37">
      <label>Voznica et al. (2022)</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Voznica</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhukova</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Boskova</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Saulnier</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lemoine</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Moslonka-Lefebvre</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gascuel</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>Deep learning from phylogenies to uncover the epidemiological dynamics of outbreaks</article-title>
        <source>Nature Communications</source>
        <volume>13</volume>
        <issue>1</issue>
        <fpage>3896</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-31511-0</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-38">
      <label>Zhang (2020)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2020">2020</year>
        <article-title>Improved variational bayesian phylogenetic inference with normalizing flows</article-title>
        <pub-id pub-id-type="arxiv">2012.00459</pub-id>
      </element-citation>
    </ref>
    <ref id="ref-39">
      <label>Zhang &amp; Matsen IV (2018)</label>
      <element-citation publication-type="confproc">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Matsen IV</surname>
            <given-names>FA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2018">2018</year>
        <article-title>Variational Bayesian phylogenetic inference</article-title>
        <conf-name>International conference on learning representations</conf-name>
        <uri xlink:href="https://openreview.net/pdf?id=SJVmjjR9FX">https://openreview.net/pdf?id=SJVmjjR9FX</uri>
      </element-citation>
    </ref>
    <ref id="ref-40">
      <label>Zhang &amp; Matsen IV (2022)</label>
      <element-citation publication-type="workingpaper">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Matsen IV</surname>
            <given-names>FA</given-names>
          </name>
        </person-group>
        <year iso-8601-date="2022">2022</year>
        <article-title>A variational approach to bayesian phylogenetic inference</article-title>
        <pub-id pub-id-type="arxiv">2204.07747</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
