<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5773593</article-id>
    <article-id pub-id-type="pmid">29348443</article-id>
    <article-id pub-id-type="publisher-id">2554</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-017-02554-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>A general and flexible method for signal extraction from single-cell RNA-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8508-5012</contrib-id>
        <name>
          <surname>Risso</surname>
          <given-names>Davide</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Perraudeau</surname>
          <given-names>Fanny</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gribkova</surname>
          <given-names>Svetlana</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Dudoit</surname>
          <given-names>Sandrine</given-names>
        </name>
        <address>
          <email>sandrine@stat.berkeley.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9510-8441</contrib-id>
        <name>
          <surname>Vert</surname>
          <given-names>Jean-Philippe</given-names>
        </name>
        <address>
          <email>jean-philippe.vert@ens.fr</email>
        </address>
        <xref ref-type="aff" rid="Aff5">5</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">000000041936877X</institution-id><institution-id institution-id-type="GRID">grid.5386.8</institution-id><institution>Division of Biostatistics and Epidemiology, Department of Healthcare Policy and Research, </institution><institution>Weill Cornell Medicine, </institution></institution-wrap>New York, NY 10065 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2181 7878</institution-id><institution-id institution-id-type="GRID">grid.47840.3f</institution-id><institution>Division of Biostatistics, School of Public Health, </institution><institution>University of California, </institution></institution-wrap>Berkeley, CA 94720 USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2217 0017</institution-id><institution-id institution-id-type="GRID">grid.7452.4</institution-id><institution>Laboratoire de Probabilités et Modèles Aléatoires, </institution><institution>Université Paris Diderot, </institution></institution-wrap>75005 Paris, France </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2181 7878</institution-id><institution-id institution-id-type="GRID">grid.47840.3f</institution-id><institution>Department of Statistics, </institution><institution>University of California, </institution></institution-wrap>Berkeley, CA 94720 USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.440907.e</institution-id><institution>CBIO-Centre for Computational Biology, MINES ParisTech, </institution><institution>PSL Research University, </institution></institution-wrap>75006 Paris, France </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0639 6384</institution-id><institution-id institution-id-type="GRID">grid.418596.7</institution-id><institution>Institut Curie, </institution></institution-wrap>75005 Paris, France </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0639 6384</institution-id><institution-id institution-id-type="GRID">grid.418596.7</institution-id><institution>INSERM U900, </institution></institution-wrap>75005 Paris, France </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="ISNI">0000000121105547</institution-id><institution-id institution-id-type="GRID">grid.5607.4</institution-id><institution>Department of Mathematics and Applications, </institution><institution>Ecole Normale Supérieure, </institution></institution-wrap>75005 Paris, France </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>1</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>18</day>
      <month>1</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2018</year>
    </pub-date>
    <volume>9</volume>
    <elocation-id>284</elocation-id>
    <history>
      <date date-type="received">
        <day>24</day>
        <month>4</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>12</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2018</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Single-cell RNA-sequencing (scRNA-seq) is a powerful high-throughput technique that enables researchers to measure genome-wide transcription levels at the resolution of single cells. Because of the low amount of RNA present in a single cell, some genes may fail to be detected even though they are expressed; these genes are usually referred to as dropouts. Here, we present a general and flexible zero-inflated negative binomial model (ZINB-WaVE), which leads to low-dimensional representations of the data that account for zero inflation (dropouts), over-dispersion, and the count nature of the data. We demonstrate, with simulated and real data, that the model and its associated estimation procedure are able to give a more stable and accurate low-dimensional representation of the data than principal component analysis (PCA) and zero-inflated factor analysis (ZIFA), without the need for a preliminary normalization step.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Single-cell RNA sequencing (scRNA-seq) data provides information on transcriptomic heterogeneity within cell populations. Here, Risso et al develop ZINB-WaVE for low-dimensional representations of scRNA-seq data that account for zero inflation, over-dispersion, and the count nature of the data.</p>
    </abstract>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2018</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Single-cell RNA-sequencing (scRNA-seq) is a powerful and relatively young technique enabling the characterization of the molecular states of individual cells through their transcriptional profiles<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. It represents a major advance with respect to standard “bulk” RNA-sequencing, which is only capable of measuring average gene expression levels within a cell population. Such averaged gene expression profiles may be enough to characterize the global state of a tissue, but completely mask signal coming from individual cells, ignoring tissue heterogeneity. Assessing cell-to-cell variability in expression is crucial for disentangling complex heterogeneous tissues<sup><xref ref-type="bibr" rid="CR2">2</xref>–<xref ref-type="bibr" rid="CR4">4</xref></sup> and for understanding dynamic biological processes, such as embryo development<sup><xref ref-type="bibr" rid="CR5">5</xref></sup> and cancer<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. Despite the early successes of scRNA-seq, to fully exploit the potential of this new technology, it is essential to develop statistical and computational methods specifically designed for the unique challenges of this type of data<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>.</p>
    <p id="Par4">Because of the tiny amount of RNA present in a single cell, the input material needs to go through many rounds of amplification before being sequenced. This results in strong amplification bias, as well as dropouts, i.e., genes that fail to be detected even though they are expressed in the sample<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. The inclusion in the library preparation of unique molecular identifiers (UMIs) reduces amplification bias<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, but does not remove dropout events, nor the need for data normalization<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR11">11</xref></sup>. In addition to the host of unwanted technical effects that affect bulk RNA-seq, scRNA-seq data exhibit much higher variability between technical replicates, even for genes with medium or high levels of expression<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>.</p>
    <p id="Par5">The large majority of published scRNA-seq analyses include a dimensionality reduction step. This achieves a two-fold objective: (i) the data become more tractable, both from a statistical (cf. curse of dimensionality) and computational point of view; (ii) noise can be reduced while preserving the often intrinsically low-dimensional signal of interest. Dimensionality reduction is used in the literature as a preliminary step prior to clustering<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR14">14</xref></sup>, the inference of developmental trajectories<sup><xref ref-type="bibr" rid="CR15">15</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup>, spatio-temporal ordering of the cells<sup><xref ref-type="bibr" rid="CR5">5</xref>,<xref ref-type="bibr" rid="CR19">19</xref></sup>, and, of course, as a visualization tool<sup><xref ref-type="bibr" rid="CR20">20</xref>,<xref ref-type="bibr" rid="CR21">21</xref></sup>. Hence, the choice of dimensionality reduction technique is a critical step in the data analysis process.</p>
    <p id="Par6">A natural choice for dimensionality reduction is principal component analysis (PCA), which projects the observations onto the space defined by linear combinations of the original variables with successively maximal variance. However, several authors have reported on shortcomings of PCA for scRNA-seq data. In particular, for real data sets, the first or second principal components often depend more on the proportion of detected genes per cell (i.e., genes with at least one read) than on an actual biological signal<sup><xref ref-type="bibr" rid="CR22">22</xref>,<xref ref-type="bibr" rid="CR23">23</xref></sup>. In addition to PCA, dimensionality reduction techniques used in the analysis of scRNA-seq data include independent components analysis (ICA)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, Laplacian eigenmaps<sup><xref ref-type="bibr" rid="CR18">18</xref>,<xref ref-type="bibr" rid="CR24">24</xref></sup>, and t-distributed stochastic neighbor embedding (t-SNE)<sup><xref ref-type="bibr" rid="CR2">2</xref>,<xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR25">25</xref></sup>. Note that none of these techniques can account for dropouts, nor for the count nature of the data. Typically, researchers transform the data using the logarithm of the (possibly normalized) read counts, adding an offset to avoid taking the log of zero.</p>
    <p id="Par7">Recently, Pierson &amp; Yau<sup><xref ref-type="bibr" rid="CR26">26</xref></sup> proposed a zero-inflated factor analysis (ZIFA) model to account for the presence of dropouts in the dimensionality reduction step. Although the method accounts for the zero inflation typically observed in scRNA-seq data, the proposed model does not take into account the count nature of the data. In addition, the model makes a strong assumption regarding the dependence of the probability of detection on the mean expression level, modeling it as an exponential decay. The fit on real data sets is not always good and, overall, the model lacks flexibility, with its inability to include covariates and/or normalization factors.</p>
    <p id="Par8">Here, we propose a general and flexible method that uses a zero-inflated negative binomial (ZINB) model to extract low-dimensional signal from the data, accounting for zero inflation (dropouts), over-dispersion, and the count nature of the data. We call this approach Zero-Inflated Negative Binomial-based Wanted Variation Extraction (ZINB-WaVE). The proposed model includes a sample-level intercept, which serves as a global-scaling normalization factor, and gives the user the ability to include both gene-level and sample-level covariates. The inclusion of observed and unobserved sample-level covariates enables normalization for complex, non-linear effects (often referred to as batch effects), whereas gene-level covariates may be used to adjust for sequence composition effects, such as gene length and GC-content effects. ZINB-WaVE is an extension of the RUV model<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup>, which accounts for zero inflation and over-dispersion and for which unobserved sample-level covariates may either capture variation of interest or unwanted variation. We demonstrate, with simulated and real data, that the model and its associated estimation procedure are able to give a more stable and accurate low-dimensional representation of the data than PCA and ZIFA, without the need for a preliminary normalization step. The approach is implemented in the open-source R package <italic>zinbwave</italic>, publicly available through the Bioconductor Project (<ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/zinbwave">https://bioconductor.org/packages/zinbwave</ext-link>).</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>ZINB-WaVE is a general and flexible model for scRNA-seq</title>
      <p id="Par9">ZINB-WaVE is a general and flexible model for the analysis of high-dimensional zero-inflated count data, such as those recorded in single-cell RNA-seq assays. Given <italic>n</italic> samples (typically, <italic>n</italic> single cells) and <italic>J</italic> features (typically, <italic>J</italic> genes) that can be counted for each sample, we denote with <italic>Y</italic><sub><italic>ij</italic></sub> the count of feature <italic>j</italic> (<italic>j</italic> = 1,…, <italic>J</italic>) for sample <italic>i</italic> (<italic>i</italic> = 1, …, <italic>n</italic>). To account for various technical and biological effects, typical of single-cell sequencing technologies, we model <italic>Y</italic><sub><italic>ij</italic></sub> as a random variable following a ZINB distribution (see Methods for details).</p>
      <p id="Par10">Both the mean expression level (<italic>μ</italic>) and the probability of dropouts (<italic>π</italic>) are modeled in terms of observed sample-level and gene-level covariates (<italic>X</italic> and <italic>V</italic>, respectively, Fig. <xref rid="Fig1" ref-type="fig">1</xref>). In addition, we include a set of unobserved sample-level covariates (<italic>W</italic>) that need to be inferred from the data. The matrix <italic>X</italic> can include covariates that induce variation of interest, such as cell types, or covariates that induce unwanted variation, such as batch or quality control (QC) measures. It can also include a constant column of ones for an intercept that accounts for gene-specific differences in mean expression level or dropout rate (cf. scaling in PCA). The matrix <italic>V</italic> can also accommodate an intercept to account for cell-specific global effects, such as size factors representing differences in library sizes (i.e., total number of reads per sample). In addition, <italic>V</italic> can include gene-level covariates, such as gene length or GC-content.<fig id="Fig1"><label>Fig. 1</label><caption><p>Schematic view of the ZINB-WaVE model. Given <italic>n</italic> cells and <italic>J</italic> genes, let <italic>Y</italic><sub><italic>ij</italic></sub> denote the count of gene <italic>j</italic> (<italic>j</italic> = 1,…, <italic>J</italic>) for cell <italic>i</italic> (<italic>i</italic> = 1,…, <italic>n</italic>) and <italic>Z</italic><sub><italic>ij</italic></sub> an unobserved indicator variable, equal to one if gene <italic>j</italic> is a dropout in cell <italic>i</italic> and zero otherwise. Then, <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mu _{ij} = E\,\left[ {Y_{ij}|Z_{ij} = 0,X,V,W} \right]$$\end{document}</tex-math><mml:math id="M2"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mspace width="0.3em"/><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq1.gif"/></alternatives></inline-formula> and <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\pi _{ij} = {\mathrm{Pr}}\,\left( {Z_{ij} = 1|X,V,W} \right)$$\end{document}</tex-math><mml:math id="M4"><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Pr</mml:mi><mml:mspace width="0.3em"/><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>∣</mml:mo><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq2.gif"/></alternatives></inline-formula>. We model ln(<italic>μ</italic>) and logit(<italic>π</italic>) with the regression specified in the figure. Note that the model allows for different covariates to be specified in the two regressions; we have omitted the <italic>μ</italic> and <italic>π</italic> indices for clarity (see Methods for details)</p></caption><graphic xlink:href="41467_2017_2554_Fig1_HTML" id="d29e759"/></fig></p>
      <p id="Par11">The unobserved matrix <italic>W</italic> contains unknown sample-level covariates, which could correspond to unwanted variation as in RUV<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup> or could be of interest as in cluster analysis (e.g., cell type). The model extends the RUV framework to the ZINB distribution (thus far, RUV had only been implemented for linear<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> and log-linear regression<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>). It differs in interpretation from RUV in the <italic>Wα</italic> term, which is not necessarily considered unwanted; this term generally refers to unknown low-dimensional variation, that could be due to unwanted technical effects (as in RUV), such as batch effects, or to biological effects of interest, such as cell cycle or cell differentiation.</p>
      <p id="Par12">It is important to note that although <italic>W</italic> is the same, the matrices <italic>X</italic> and <italic>V</italic> could differ in the modeling of <italic>μ</italic> and <italic>π</italic>, if we assume that some known factors do not affect both. When <italic>X</italic> = <bold>1</bold><sub><italic>n</italic></sub> and <italic>V</italic> = <bold>1</bold><sub><italic>J</italic></sub>, the model is a factor model akin to PCA, where <italic>W</italic> is a factor matrix and <italic>α</italic><sub><italic>μ</italic></sub> and <italic>α</italic><sub><italic>π</italic></sub> are loading matrices. However, the model is more general, allowing the inclusion of additional sample and gene-level covariates that might help to infer the unknown factors.</p>
    </sec>
    <sec id="Sec4">
      <title>ZINB-WaVE leads to biologically meaningful clusters</title>
      <p id="Par13">We applied the ZINB-WaVE procedure to several publicly available real data sets, from microfluidics, plate-based, and droplet-based platforms (see Methods).</p>
      <p id="Par14">As previously shown<sup><xref ref-type="bibr" rid="CR22">22</xref>,<xref ref-type="bibr" rid="CR23">23</xref></sup>, the first few principal components of scRNA-seq data, even after normalization, can be influenced by technical rather than biological features, such as the proportion of genes with at least one read (detection rate) or the total number of reads (sequencing depth) per sample. Figure <xref rid="Fig2" ref-type="fig">2</xref> illustrates this using the V1 data set: although the first two principal components somewhat segregated the data by layer of origin (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>), the clustering was far from perfect. This is at least partly due to unwanted technical effects, such as sequencing depth and amount of starting material. To quantify such technical effects, we computed a set of QC measures, such as detection rate and total number of reads (see Methods). The first two principal components are especially correlated with detection rate (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><p>Low-dimensional representation of the V1 data set. Upper panels provide two-dimensional representations of the data, after selecting the 1000 most variable genes. Lower panels provide barplots of the absolute correlation between the first two components and a set of QC measures (see Methods). <bold>a</bold>, <bold>b</bold> PCA (on TC-normalized counts). <bold>c</bold>, <bold>d</bold> ZIFA (on TC-normalized counts). <bold>e</bold>, <bold>f</bold> ZINB-WaVE (no normalization needed). ZINB-WaVE leads to a low-dimensional representation that is less influenced by technical variation and to tighter, biologically meaningful clusters. The ZINB-WaVE projection was robust to the number of genes selected (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4</xref>)</p></caption><graphic xlink:href="41467_2017_2554_Fig2_HTML" id="d29e888"/></fig></p>
      <p id="Par15">ZIFA suffered from the same problem: the clustering of the samples in two dimensions was not qualitatively different from PCA (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>) and the second component was highly correlated with detection rates (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>).</p>
      <p id="Par16">Conversely, ZINB-WaVE led to tighter clusters, grouping the cells by layer of origin (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>). Furthermore, the two components inferred by ZINB-WaVE showed lower correlation with the QC features (Fig. <xref rid="Fig2" ref-type="fig">2f</xref>), highlighting that the clusters shown in Fig. <xref rid="Fig2" ref-type="fig">2e</xref> are not driven by technical effects.</p>
      <p id="Par17">We repeated these analyses on the S1/CA1 data set (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>), mESC data set (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>), and glioblastoma data set (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>). For all data sets, ZINB-WaVE led to tighter clusters in two dimensions. However, it did not always lead to a decrease in correlation with the QC measures. See also Hicks et al.<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> for additional data sets in which principal components are strongly correlated with detection rate.</p>
      <p id="Par18">As a measure of the goodness of the clustering results, we used the average silhouette width (see Methods), computed using the labels available from the original study: these were either known a priori (e.g., the patient ID in the glioblastoma data set) or inferred from the data (and validated) by the authors of the original publication (e.g., the cell types in the S1/CA1 data set). For all four data sets, ZINB-WaVE led to generally tighter clusters, as shown by an increased per-cluster average silhouette width in the majority of the groups (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>ZINB-WaVE leads to novel biological insights</title>
      <p id="Par19">To demonstrate the ability of ZINB-WaVE to lead to novel biological insights, we focused on two inferential questions typical of scRNA-seq studies: (i) the identification of developmental lineages and (ii) the characterization of rare cell types.</p>
      <p id="Par20">First, we re-analyzed a set of cells from the mouse olfactory epithelium (OE) that were collected to identify the developmental trajectories that generate olfactory neurons (mOSN), sustentacular cells (mSUS), and microvillous cells (MV)<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. In the original publication, the data were normalized by full-quantile normalization, followed by a regression-based adjustment for sample quality. Clustering on the first 50 principal components identified cellular states that were then ordered into developmental lineages by Slingshot<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> using the first five PCs. In the original analysis, Slingshot was able to correctly infer the lineages in its supervised mode, by manually specifying lineage endpoints (i.e., clusters corresponding to the mature cell types). Figure <xref rid="Fig3" ref-type="fig">3a</xref> shows the minimum spanning tree (MST) obtained with the described supervised analysis. When running Slingshot in unsupervised mode, however, the inferred MST only correctly identified the neuronal (mOSN) and microvillous (MV) lineages, while it was unable to identify sustentacular (mSUS) cells as a mature cell type (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). By repeating the clustering and lineage reconstruction with Slingshot on the first 50 factors of ZINB-WaVE, we were able to infer the correct lineages even in unsupervised mode (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). This suggests that the low-dimensional signal revealed by ZINB-WaVE more closely matches the true developmental process. See Perraudeau et al.<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> for a complete workflow that involves ZINB-WaVE for dimensionality reduction and Slingshot for lineage reconstruction.<fig id="Fig3"><label>Fig. 3</label><caption><p>Using ZINB-WaVE to gain novel biological insights. <bold>a</bold>–<bold>c</bold> Lineage inference on the OE data set. Slingshot minimum spanning tree on cell clusters: <bold>a</bold> PCA with endpoint supervision (marked as red nodes in the tree). <bold>b</bold> PCA with no endpoint supervision. <bold>c</bold> ZINB-WaVE with no endpoint supervision. <bold>a</bold>, <bold>b</bold> RSEC clustering (see Methods) on the first 50 PCs of the normalized counts led to 13 clusters; <bold>c</bold> the same procedure on 50 components of W from ZINB-WaVE led to six clusters: horizontal basal cells (HBC); tran- sitional HBC (DHBC1-2); immature sustentacular cells (iSUS); mature sustentacular cells (mSUS); globose basal cells (GBC); microvillous cells (MV); immediate neuronal precursors (INP1-3); immature olfactory neurons (iOSN); mature olfactory neurons (mOSN). mOSN, MV, and mSUS are the mature cell types and should be identified as the three lineage endpoints. <bold>d</bold>, <bold>e</bold> Discovery of rare cell types for the 10× Genomics 68k PBMCs data set. <bold>d</bold> Scatterplot of first two t-SNE dimensions obtained from 10 components of W from ZINB-WaVE; cells are color-coded by cluster. Clustering was performed on the 10 components of W (see Methods). <bold>e</bold> Heatmap of expression measures for marker genes for the 18 clusters found by our procedure: columns correspond to clusters and rows to genes; the value in each cell is the average log expression measure per cluster, centered and scaled so that each row has mean zero and standard deviation one</p></caption><graphic xlink:href="41467_2017_2554_Fig3_HTML" id="d29e1003"/></fig></p>
      <p id="Par21">We next focused on a set of 68,579 peripheral blood mononuclear cells (PBMCs) assayed with the 10× Genomics Chromium system<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. This example allowed us to demonstrate how ZINB-WaVE can be applied to a state-of-the-art data set that comprises tens of thousands of cells, while also illustrating that existing clustering algorithms can be used on the low-rank matrix inferred by ZINB-WaVE. In particular, we applied a popular clustering method, based on the identification of shared nearest neighbors<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>, similar to that of Macosko et al.<sup><xref ref-type="bibr" rid="CR2">2</xref></sup> and implemented in the R package Seurat<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. We modified the clustering procedure to use ZINB-WaVE (with <italic>K</italic> = 10) instead of PCA as the dimensionality reduction step. To visualize the clustering results, we applied t-SNE to the inferred <italic>W</italic> matrix (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>).</p>
      <p id="Par22">Our approach recapitulates the major cell populations found in Zheng et al.<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> (Fig. <xref rid="Fig3" ref-type="fig">3d, e</xref>). In particular, 80% of the cells are T-cells (Clusters 0–1 CD4+ T-cells; Clusters 2–6 CD8+ T-cells). As in Zheng et al.<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, we are able to identify populations of activated cytotoxic T-cells (Cluster 5; 9%), natural killer cells (Cluster 7; 6%), and B-cells (Cluster 8; 5%) (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>). In addition, we are able to identify sub-populations of myeloid cells that were not completely characterized in the original publication. In particular, we identified clusters corresponding to: CD14+ monocytes (Cluster 9; 3%), characterized by the expression of <italic>CD14</italic>, <italic>S100A9</italic>, <italic>LYZ</italic><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; CD16+ monocytes (Cluster 10; 2.5%), which express <italic>FCGR3A/CD16</italic>, <italic>AIF1</italic>, <italic>FTL</italic>, <italic>LST1</italic><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; CD1C+ dendritic cells (DC; Cluster 11; 1%), which express <italic>CD1C</italic>, <italic>LYZ</italic>, <italic>HLA-DR</italic><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; plasmacytoid dentritic cells (pDC; Cluster 13; 0.5%), expressing <italic>GZMB</italic>, <italic>SERPINF1</italic>, <italic>ITM2C</italic><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>; megakaryocyte (Cluster 15; 0.2%), expressing <italic>PF4</italic><sup><xref ref-type="bibr" rid="CR32">32</xref></sup> (Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). We also identified several small clusters (collectively comprising about 1% of the cells) that were either enriched for mitochondrial genes (Cluster 14) or ribosomal genes (Clusters 17 and 18), or for which we could not find any markers (Clusters 12 and 16). We hypothesize that these clusters represent either doublets or lower quality libraries.</p>
      <p id="Par23">The above analysis differs from that of the original publication not only in terms of dimensionality reduction, but also in terms of clustering (Zheng et al.<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> used <italic>k</italic>-means on the first 50 PCs). We hence repeated the clustering using a sequential procedure based on <italic>k</italic>-means (see Methods for details). This led to similar (albeit noisier) results (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6</xref>), highlighting that ZINB-WaVE is able to extract meaningful biological signal from the data, as input to a variety clustering procedures. In fact, extracting a two-dimensional signal from ZINB-WaVE already allowed us to identify most major cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>Impact of normalization</title>
      <p id="Par24">As for any high-throughput genomic technology, an important aspect of scRNA-seq data analysis is normalization. Indeed, there are a variety of steps in scRNA-seq experiments that can introduce bias in the data and whose effects need to be corrected for<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. Some of these effects, e.g., sequencing depth, can be captured by a global-scaling factor (usually referred to as size factor). Other more complex, non-linear effects, such as those collectively known as batch effects, require more sophisticated normalization<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. Accordingly, a typical scRNA-seq pipeline will include a normalization step, i.e., a linear or non-linear transformation of read counts, to make the distributions of expression measures comparable between samples. The normalization step is usually carried out prior to any inferential procedure (e.g., clustering, differential expression analysis, or pseudotime ordering). In this work, we considered three popular between-sample normalization methods: total count (TC), trimmed mean of M values (TMM), and full-quantile (FQ) normalization (see Methods); we also compared the results to unnormalized data (RAW). TC, along with the related methods transcripts per million (TPM) and fragments per kilobase million (FPKM), is by far the most widely used normalization in the scRNA-seq literature; hence, TC-normalized data were used for the results shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref> and in Supplementary Figs. <xref rid="MOESM1" ref-type="media">1</xref>–<xref rid="MOESM1" ref-type="media">3</xref>.</p>
      <p id="Par25">Normalization highly affected the projection of the data in lower dimensions (Supplementary Figs. <xref rid="MOESM1" ref-type="media">8</xref>–<xref rid="MOESM1" ref-type="media">15</xref>) and, consequently, the clustering results varied greatly between normalization methods in all four data sets (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). Strikingly, the choice of normalization method was more critical than the choice between PCA and ZIFA. For instance, for the mESC data set (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>), FQ normalization followed by either PCA or ZIFA led to very high average silhouette width. Critically, the ranking of normalization methods was not consistent across data sets (Fig. <xref rid="Fig4" ref-type="fig">4</xref>), highlighting that the identification of the best normalization method for a given data set is a difficult problem for scRNA-seq<sup><xref ref-type="bibr" rid="CR11">11</xref>,<xref ref-type="bibr" rid="CR36">36</xref></sup>.<fig id="Fig4"><label>Fig. 4</label><caption><p>Average silhouette width in real data sets. <bold>a</bold> V1 data set; <bold>b</bold> S1/CA1 data set; <bold>c</bold> glioblastoma data set; <bold>d</bold> mESC data set. Silhouette widths were computed in the low-dimensional space, using the groupings provided by the authors of the original publications: unsupervised clustering procedure (<bold>a</bold>, <bold>b</bold>), observed characteristics of the samples, such as patient (<bold>c</bold>) and culture condition (<bold>d</bold>). PCA and ZIFA were applied after normalization: unnormalized (RAW), total count (TC), trimmed mean of M values (TMM), and full-quantile (FQ). For the mESC data set (<bold>d</bold>), we fitted the ZINB-WaVE model with batch as a sample-level covariate (ZINB-Batch) in addition to the default model with only a sample-level intercept (see Fig. <xref rid="Fig5" ref-type="fig">5</xref>)</p></caption><graphic xlink:href="41467_2017_2554_Fig4_HTML" id="d29e1215"/></fig></p>
      <p id="Par26">One important feature of the ZINB-WaVE model is that the sample-level intercept <italic>γ</italic> (corresponding to a column of ones in the gene-level covariate matrix <italic>V</italic>, see Methods) acts as a global-scaling normalization factor, making a preliminary global-scaling step unnecessary. As a consequence, ZINB-WaVE can be directly applied to unnormalized read counts, hence preserving the distributional properties of count data. ZINB-WaVE applied to unnormalized counts led to results that were comparable, in terms of average silhouette width, to PCA and ZIFA applied using the best performing normalization (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). In particular, ZINB-WaVE outperformed PCA and ZIFA on the S1/CA1 (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>) and glioblastoma (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>) data sets, while it was slightly worse than PCA (after FQ normalization) on the mESC data set (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>) and than ZIFA (after FQ normalization) on the V1 data set (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). Interestingly, the overall average silhouette width was lower for the S1/CA1 and glioblastoma data sets than it was for the V1 and mESC data sets, suggesting that ZINB-WaVE leads to better clustering in more complex situations (e.g., lower sequencing depth).</p>
      <p id="Par27">Although the overall average silhouette width is a useful metric to rank the different methods in terms of how well they represent known global biological structure, looking only at the average across many different cell types may be misleading. For the V1 data set, for instance, ZINB-WaVE led to a slightly lower overall average silhouette width than ZIFA (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). However, ZINB-WaVE yielded higher cluster-level average silhouette widths for the L6a, L5b, and L5 samples, whereas ZIFA produced higher average silhouette widths for the L4 and L5a samples (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a</xref>). In fact, certain cell types may be easier to cluster than others, leading to silhouette widths that differ greatly between different clusters, as is the case for the S1/CA1 data set: oligodendrocytes are much easier to cluster than the other cell types and all methods were able to identify them (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5b</xref>); on the other hand, only ZINB-WaVE was able to achieve a positive silhouette width for the pyramidal SS and CA1 neurons and it performed much better than PCA and ZIFA in the interneuron cluster; finally, certain groups, such as the endothelial-mural and astrocytes, were simply too hard to distinguish in three dimensions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5b</xref>).</p>
    </sec>
    <sec id="Sec7">
      <title>Accounting for batch effects</title>
      <p id="Par28">Although the sample-level intercept <italic>γ</italic> (corresponding to a column of ones in the gene-level covariate matrix <italic>V</italic>) can act as a global-scaling normalization factor, this may not be sufficient to accurately account for complex, non-linear technical effects that may influence the data (e.g., batch effects). Hence, we explored the possibility of including additional sample-level covariates in <italic>X</italic> to account for such effects (see Methods).</p>
      <p id="Par29">We illustrate this using the mESC data set, which is a subset of the data described in Kolodziejczyk et al.<sup><xref ref-type="bibr" rid="CR37">37</xref></sup> and which comprises two batches of mESCs grown in three different media (see Methods). ZINB-WaVE applied with no additional covariates led to three clusters, corresponding to the three media (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>; Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). However, the clusters corresponding to media 2i and a2i are further segregated by batch (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). Including indicator variables for batch in ZINB-WaVE (as columns of <italic>X</italic>) removed such batch effects, consolidating the clustering by medium (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>). This led to slightly larger average silhouette widths, both overall (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>) and at the cluster level (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). Conversely, the average silhouette width for batch, a measure of how well the cells cluster by batch, was much larger for the model that did not include the batch covariate (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>), indicating that explicitly accounting for batch in the ZINB-WaVE model effectively removed the dependence of the inferred low-dimensional space on batch effects. Similar results were obtained by normalizing the data with the ComBat batch correction method<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, implemented in the Bioconductor R package sva<sup><xref ref-type="bibr" rid="CR39">39</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">16</xref>). The advantage of ZINB-WaVE is the ability of including batch effects in the same model used for dimensionality reduction, without the need for prior data normalization.<fig id="Fig5"><label>Fig. 5</label><caption><p>Accounting for batch effects in ZINB-WaVE. Upper panels provide two-dimensional representations of the mESC data, with cells color-coded by batch and shape reflecting culture conditions: <bold>a</bold> Default ZINB- WaVE with only sample-level intercept; <bold>b</bold> ZINB-WaVE with batch as known sample-level covariate. <bold>c</bold> Average silhouette widths by biological condition for ZINB-WaVE with and without batch covariate; <bold>d</bold> average silhouette widths by batch for ZINB-WaVE with and without batch covariate. Although the cells cluster primarily based on culture condition, batch effects are evident in <bold>a</bold>. Accounting for batch effects in the ZINB-WaVE model (<bold>b</bold>) leads to slightly better clustering by biological condition (<bold>c</bold>) and removes the clustering by batch (<bold>d</bold>). Note the difference in scale between the barplots of <bold>c</bold> and <bold>d</bold>. Lower panels provide two-dimensional representations of the glioblastoma data, with cells color-coded by batch: <bold>e</bold> Default ZINB-WaVE with only sample-level intercept; <bold>f</bold> ZINB-WaVE with total number of expressed genes as sample-level covariate. Despite the confounding between patient and batch, the addition of a covariate that captures the batch difference allows ZINB-WaVE to remove the batch effect without removing the patient effect</p></caption><graphic xlink:href="41467_2017_2554_Fig5_HTML" id="d29e1357"/></fig></p>
      <p id="Par30">The mESC data set is an example of good experimental design, where each batch includes cells from each biological condition (this is known as a factorial design). Hence, it is relatively easy to correct for batch effects and, unsurprisingly, both ComBat and ZINB-WaVE successfully do so. The glioblastoma data set is an example of a more complex situation, in which there is confounding between batch and biology, each patient being processed separately<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. Luckily, the glioblastoma design is not completely confounded, as patient <italic>MGH26</italic> was processed in two batches (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>). We used this feature of the data to test whether ZINB-WaVE was able to adjust for batch effects even in the presence of confounding. ComBat was not able to correctly account for batch, removing the patient effects along with the batch effects (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17a</xref>). Including the batch variable as a covariate in the ZINB-WaVE model led to similar, unsatisfactory results (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17b</xref>). One key observation, recently made by Townes et al.<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>, is that the detection rate is markedly different between the two batches of <italic>MGH26</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">17c</xref>): including the detection rate as a covariate in the ZINB-WaVE model led to the removal of the batch effect, while preserving the biological differences between patients (Fig. <xref rid="Fig5" ref-type="fig">5f</xref>). Note that this is analogous of the inclusion of the “cellular detection rate” in the MAST model<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. Although this helped adjusting for batch effects, the confounding between patient and batch is still present in the data because of the poor experimental design and no normalization will be able to completely account for such confounding.</p>
    </sec>
    <sec id="Sec8">
      <title>Goodness-of-fit of ZINB-WaVE model</title>
      <p id="Par31">We compared the goodness-of-fit of our ZINB-WaVE model to that of a negative binomial (NB) model (as implemented in edgeR<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>) and a hurdle model (as implemented in MAST<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>).</p>
      <p id="Par32">As previously noted in the literature, NB models, which are quite successful for bulk RNA-seq, are not appropriate for single-cell RNA-seq, as they cannot accommodate zero inflation. In particular, NB models poorly fit the data in terms of the overall mean count and zero probability (Supplementary Figs. <xref rid="MOESM1" ref-type="media">18</xref> and <xref rid="MOESM1" ref-type="media">19</xref>) and appears to handle the excess of zeros by over-estimating the dispersion parameter (Supplementary Fig. <xref rid="MOESM1" ref-type="media">20</xref>).</p>
      <p id="Par33">We also examined the goodness-of-fit of the MAST hurdle model, which is specifically designed for scRNA-seq. However, a direct comparison of MAST with NB and ZINB is cumbersome, due to differences in parameterization. In particular, MAST models log2(TPM + 1) rather than counts and does not have a dispersion parameter but only a variance parameter for the Gaussian component (see Methods for details). We found that MAST under-estimated the overall mean log2(TPM + 1) and over-estimated the zero probability, but had stable variance estimates over the observed proportion of zero counts (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21</xref>).</p>
      <p id="Par34">By contrast, our ZINB model lead to better fit in terms of both the overall mean count and zero probability, as well as more stable estimators of the dispersion parameter (Supplementary Figs. <xref rid="MOESM1" ref-type="media">18</xref>–<xref rid="MOESM1" ref-type="media">20</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>ZINB-WaVE estimators are asymptotically unbiased and robust</title>
      <p id="Par35">We next turned to simulations to explore in greater detail the performance of ZINB-WaVE. First, we evaluated the ZINB-WaVE estimation procedure on simulated data from a ZINB distribution, to assess both accuracy under a correctly specified model and robustness to model misspecification. The approach involves computing maximum likelihood estimators (MLE) for the parameters of the model of Fig. <xref rid="Fig1" ref-type="fig">1</xref>, namely, <italic>α</italic>, <italic>β</italic>, <italic>γ</italic>, and <italic>W</italic>, and hence <italic>μ</italic> and <italic>π</italic>. MLE are asymptotically unbiased and efficient estimators. However, because the likelihood function of our ZINB-WaVE model is not convex, our numerical optimization procedure may converge to a local maximum, rather than to the true MLE (see Methods). We observed that our estimators are asymptotically unbiased and have decreasing variance as the number of cells <italic>n</italic> increases (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22</xref>). This suggests that our estimates are not far from the true MLE.</p>
      <p id="Par36">To assess the robustness of the ZINB-WaVE procedure, we examined bias and mean squared error (MSE) for estimators of <italic>μ</italic> and <italic>π</italic>, as well as the log-likelihood function, the Akaike information criterion (AIC), and the Bayesian information criterion (BIC), for models with misspecified number of unobserved covariates <italic>K</italic> (i.e., number of columns of <italic>W</italic>), gene-level covariate matrix <italic>V</italic>, and dispersion parameter <italic>φ</italic> (Fig. <xref rid="Fig6" ref-type="fig">6</xref>; Supplementary Figs. <xref rid="MOESM1" ref-type="media">23</xref>–<xref rid="MOESM1" ref-type="media">25</xref>). In Fig. <xref rid="Fig6" ref-type="fig">6</xref>, the data were simulated with <italic>K</italic> = 2 unknown factors, <italic>X</italic> = <bold>1</bold><sub><italic>n</italic></sub>, <italic>V</italic> = <bold>1</bold><sub><italic>J</italic></sub>, and genewise dispersion. The model parameters were then estimated with <italic>K</italic> = 1, 2, 3, 4, both for a model that included a cell-level intercept (<italic>V</italic> = <bold>1</bold><sub><italic>J</italic></sub>) and one that did not (<italic>V</italic> = 0<sub><italic>J</italic></sub>). When the intercept was correctly included in the model, misspecification of <italic>K</italic> (with <italic>K</italic> &gt; 2) resulted in no or very small bias (Fig. <xref rid="Fig6" ref-type="fig">6a, b</xref>), small MSE (Fig. <xref rid="Fig6" ref-type="fig">6c, d</xref>), and a greater impact on AIC and especially BIC (Supplementary Fig. <xref rid="MOESM1" ref-type="media">23</xref>). When no intercept was included in the fitted model, the sensitivity to <italic>K</italic> became more important. However, although the data were simulated with <italic>K</italic> = 2, specifying <italic>K</italic> ≥ 3 led to small bias and low MSE (Fig. <xref rid="Fig6" ref-type="fig">6</xref>). This is likely because one column of <italic>W</italic> acted as a de facto intercept, overcoming the absence of <italic>V</italic> and explaining why AIC and BIC are minimized at <italic>K</italic> = 4 (Supplementary Fig. <xref rid="MOESM1" ref-type="media">23</xref>). In addition, we observed robustness of the results to the choice of dispersion parameter (genewise or common), even though the data were simulated with genewise dispersion (Fig. <xref rid="Fig6" ref-type="fig">6</xref>). The estimators for ln(<italic>μ</italic>) and <italic>π</italic> were unbiased over the whole range of mean expression and zero inflation probability (Supplementary Fig. <xref rid="MOESM1" ref-type="media">26</xref>).<fig id="Fig6"><label>Fig. 6</label><caption><p>Bias and MSE for ZINB-WaVE estimation procedure. Panels show boxplots of <bold>a</bold> bias ln(<italic>μ</italic>), <bold>b</bold> bias <italic>π</italic>, <bold>c</bold> MSE ln(<italic>μ</italic>), and <bold>d</bold> MSE <italic>π</italic> for ZINB-WaVE estimation procedure, as a function of the number of unknown covariates <italic>K</italic>. ZINB-WaVE was fit with <italic>X</italic> = <bold>1</bold><sub><italic>n</italic></sub>, common/genewise dispersion, and with/without sample-level intercept (i.e., column of ones in gene-level covariate matrix <italic>V</italic>). For each gene and cell, bias and MSE were averaged over <italic>B</italic> = 10 data sets simulated from our ZINB-WaVE model, based on the S1/CA1 data set and with <italic>n</italic> = 1000 cells, <italic>J</italic> = 1000 genes, scaling of one for the ratio of within to between-cluster sums of squares (<italic>b</italic><sup>2</sup> = 1), <italic>K</italic> = 2 unknown factors, zero fraction of about 80%, <italic>X</italic> = <bold>1</bold><sub><italic>n</italic></sub>, cell-level intercept (<italic>V</italic> = <bold>1</bold><sub><italic>J</italic></sub>), and genewise dispersion. The lower and upper hinges of the boxplots correspond to the first and third quartiles (the 25th and 75th percentiles), respectively. The upper/lower whisker extends from the hinge to the largest/smallest value no further than 1.5 × IQR from the hinge (where IQR is the inter-quartile range or difference between the third and first quartiles). Data beyond the whiskers are called outliers and are not plotted here. Supplementary Fig. <xref rid="MOESM1" ref-type="media">24</xref> provides the same boxplots with individually plotted outliers</p></caption><graphic xlink:href="41467_2017_2554_Fig6_HTML" id="d29e1682"/></fig></p>
    </sec>
    <sec id="Sec10">
      <title>ZINB-WaVE is more accurate than state-of-the-art methods</title>
      <p id="Par37">We next compared ZINB-WaVE to PCA and ZIFA, in terms of their ability to recover the true underlying low-dimensional signal and clustering structure. For data sets simulated from a ZINB model, our estimation procedure with correctly specified <italic>K</italic> led to almost perfect correlation between distances in the true and estimated low-dimensional space (Fig. <xref rid="Fig7" ref-type="fig">7a, b</xref>). The correlation remained high even for misspecified <italic>K</italic>, in most cases higher than for PCA and ZIFA. ZINB-WaVE performed consistently well across a range of simulation scenarios, including different numbers of cells <italic>n</italic>, different zero fractions, and varying cluster tightness (Supplementary Fig. <xref rid="MOESM1" ref-type="media">28</xref>). We observed a consistent ranking, although noisier, when the methods were compared in terms of silhouette widths (Fig. <xref rid="Fig7" ref-type="fig">7c, d</xref>).<fig id="Fig7"><label>Fig. 7</label><caption><p>Between-sample distances and silhouette widths on simulated data. <bold>a</bold> Boxplots of correlations between between-sample distances based on true and estimated low-dimensional representations of the data for simulations based on the V1 data set. <bold>b</bold> Same as <bold>a</bold> for simulations based on the S1/CA1 data set. <bold>c</bold> Boxplots of silhouette widths for true clusters for simulations based on the V1 data set. <bold>d</bold> Same as <bold>c</bold> for simulations based on the S1/CA1 data set. For <bold>a</bold>–<bold>d</bold>, all data sets were simulated from our ZINB-WaVE model with <italic>n</italic> = 1000 cells, <italic>J</italic> = 1000 genes, “harder” clustering (<italic>b</italic><sup>2</sup> = 5), <italic>K</italic> = 2 unknown factors, zero fraction of about 80%, <italic>X</italic> = <bold>1</bold><sub><italic>n</italic></sub>, cell-level intercept (<italic>V</italic> = <bold>1</bold><sub><italic>J</italic></sub>), and genewise dispersion. Each boxplot is based on <italic>n</italic> values corresponding to each of the <italic>n</italic> samples and defined as averages of correlations (<bold>a</bold>, <bold>b</bold>) or silhouette widths (<bold>c</bold>, <bold>d</bold>) over <italic>B</italic> = 10 simulations. See Supplementary Fig. <xref rid="MOESM1" ref-type="media">27</xref> for the same scenario but with <italic>n</italic> = 10,000 cells and Supplementary Fig. <xref rid="MOESM1" ref-type="media">28</xref> for additional scenarios. <bold>e</bold>–<bold>g</bold> Average silhouette widths (over <italic>n</italic> samples and <italic>B</italic> = 10 simulations) for true clusters vs. zero fraction, for <italic>n</italic> ∈ {100;1000;10,000} cells, for data sets simulated from the Lun &amp; Marioni<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> model, with <italic>C</italic> = 3 clusters and equal number of cells per cluster. Although ZINB-WaVE was relatively robust to the sample size <italic>n</italic> and zero fraction, the performance of PCA and ZIFA decreased with larger zero fraction. Between-sample distance matrices and silhouette widths were based on <italic>W</italic> for ZINB-WaVE, the first two principal components for PCA, and the first two latent variables for ZIFA. ZINB-WaVE was applied with<italic> X</italic> = <bold>1</bold><sub><italic>n</italic></sub>, <italic>V</italic> = <bold>1</bold><sub><italic>J</italic></sub>, genewise dispersion, and <italic>K</italic> ∈ {1, 2, 3, 4} (only <italic>K</italic> = 2 is shown in <bold>e</bold>–<bold>g</bold>. For PCA and ZIFA, different normalization methods were used. Colors correspond to the different methods</p></caption><graphic xlink:href="41467_2017_2554_Fig7_HTML" id="d29e1867"/></fig></p>
      <p id="Par38">As with the real data sets, the choice of normalization influenced the simulation results. Critically, there was not an overall best normalization method; rather, the performance of the normalization methods depended on the dimensionality reduction method and on intrinsic characteristics of the data, such as the fraction of zero counts and the number and tightness of the clusters (Fig. <xref rid="Fig7" ref-type="fig">7</xref>; Supplementary Fig. <xref rid="MOESM1" ref-type="media">28</xref>). For instance, TC normalization worked best for PCA on data simulated from the V1 data set (Fig. <xref rid="Fig7" ref-type="fig">7a, c</xref>), whereas FQ and TMM normalization worked best for PCA and ZIFA, respectively, on data simulated from the S1/CA1 data set (Fig. <xref rid="Fig7" ref-type="fig">7b, d</xref>).</p>
      <p id="Par39">It is important to note that the previous results were obtained for data simulated from the ZINB-WaVE model underlying our estimation procedure. It is hence not surprising that ZINB-WaVE outperformed its competitors. To provide a fairer comparison, we also assessed the methods on data simulated from the model proposed by Lun &amp; Marioni<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Although this model is also based on a ZINB distribution, the distribution is parameterized differently and, in particular, does not involve regression on gene-level and sample-level covariates (see Methods).</p>
      <p id="Par40">When the data were simulated to have a moderate fraction of zeros (namely, 40%), all methods performed well in terms of average silhouette width (Fig. <xref rid="Fig7" ref-type="fig">7e–g</xref>) and precision and recall (Supplementary Fig. <xref rid="MOESM1" ref-type="media">29</xref>). However, the performance of PCA decreased dramatically with 60% of zeros, independently of the number of cells <italic>n</italic>. Although ZIFA worked well with 60% or fewer zeros, its performance too decreased at 80% of zeros, especially when only 100 cells were simulated (Fig. <xref rid="Fig7" ref-type="fig">7e</xref>). Conversely, the performance of ZINB-WaVE remained good even when simulating data with 80% of zeros, independently of the sample size.</p>
    </sec>
  </sec>
  <sec id="Sec11" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par41">Recent advances in single-cell technologies, such as droplet-based methods<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>, make it easy and inexpensive to collect hundreds of thousands of scRNA-seq profiles, allowing researchers to study very complex biological systems at high resolution. The resulting libraries are often sequenced at extremely low depth (tens of thousands of reads per cell, only), making the corresponding read count data truly sparse. Hence, there is a growing need for developing reliable statistical methods that are scalable and that can account for zero inflation.</p>
    <p id="Par42">ZINB-WaVE is a general and flexible approach to extract low-dimensional signal from noisy, zero-inflated data, such as those from scRNA-seq experiments. We have shown with simulated and real data analyses that ZINB-WaVE leads to robust and unbiased estimators of the underlying biological signals. The better performance of ZINB-WaVE with respect to PCA comes at a computational cost, as we need to numerically optimize a non-convex likelihood function. However, we empirically found that the computing time was approximately linear in both the number of cells and the number of genes, and approximately quadratic in the number of latent factors (Supplementary Fig. <xref rid="MOESM1" ref-type="media">30</xref>). The algorithm benefits from parallelization on multicore machines and takes a few minutes on a modern laptop to converge for thousands of cells.</p>
    <p id="Par43">One major difference between ZINB-WaVE and previously proposed factor analysis models (such as PCA and ZIFA) is the ability to include sample-level and gene-level covariates. In particular, by including a column of ones in the gene-level covariate matrix, the corresponding cell-level intercept acts as a global-scaling normalization factor, allowing the modeling of raw count data, with no need for prior normalization.</p>
    <p id="Par44">However, there is no guarantee that the low-dimensional signal extracted by ZINB-WaVE is biologically relevant: If unwanted technical variation affects the data and is not accounted for in the model (or in prior normalization), the low-rank matrix <italic>W</italic> inferred by ZINB-WaVE will capture such confounding effects. It is therefore important to explore the correlation between the latent factors estimated by our procedure and known measures of quality control that can be computed for scRNA-seq libraries, using, for instance, the Bioconductor R package scater<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> (see Fig. <xref rid="Fig2" ref-type="fig">2f</xref>). If one observes high correlation between one or more latent factors and some QC measures, it may be beneficial to include these QC measures as covariates in the model.</p>
    <p id="Par45">Several authors have recognized that high-dimensional genomic data are affected by a variety of unwanted technical effects (e.g., batch effects) that can be confounded with the biological signal of interest, and have proposed methods to account for such effects in either a supervised<sup><xref ref-type="bibr" rid="CR38">38</xref></sup> or unsupervised way<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR44">44</xref></sup>. Recently, Lin et al.<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> proposed a model that can extend PCA to adjust for confounding factors. This model, however, does not seem to be ideal for zero-inflated count data. In the scRNA-seq literature, MAST<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> uses the inferred cellular detection rate to adjust for the main source of confounding, in a differential expression setting, but is not designed to infer low-dimensional signal.</p>
    <p id="Par46">The removal of batch effects is an important example of how including additional covariates in the ZINB-WaVE model may lead to better low-dimensional representations of the data. However, ZINB-WaVE is not limited to including batch effects, as other sample-level (e.g., QC metrics) and/or gene-level (e.g., GC-content) covariates may be included in the model. Although we did not find any compelling examples in which adding a gene-level covariate leads to improve signal extraction, it is interesting to note the relationship between GC-content and batch effects<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. With large collaborative efforts, such as the Human Cell Atlas<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>, on the horizon, we anticipate that the ability of our model to include gene-level covariates that can potentially help accounting for differences in protocols will prove important.</p>
    <p id="Par47">Although the low-dimensional signal inferred by ZINB-WaVE can be used to visually inspect hidden structure in the data, visualization is not the main point of our proposed method. The low-dimensional factors are intended to be the closest possible approximation to the true signal, which is assumed to be intrinsically low-dimensional. Such a low-dimensional representation can be used in downstream analyses, such as clustering or pseudotime ordering of the cells<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>.</p>
    <p id="Par48">Visualization of high-dimensional data sets is an equally important area of research and many algorithms are available, among which t-SNE<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> has become the most popular for scRNA-seq data. Recently, Wang et al.<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> have proposed a novel visualization algorithm that can account for zero inflation and showed improvement over t-SNE. As t-SNE takes as input a matrix of cell pairwise distances, which may be noisy in high dimensions, a typical pipeline involves computing such distances in PCA space, selecting, for example, the first 50 PCs. An alternative approach is to derive such distances from the low-dimensional space defined by the factors inferred by ZINB-WaVE. This strategy was used effectively in Fig. <xref rid="Fig3" ref-type="fig">3c</xref> to visualize the PBMC data set.</p>
    <p id="Par49">In this article, we have focused on an unsupervised setting, where the goal is to extract a low-dimensional signal from noisy zero-inflated data. However, our proposed ZINB model is more general and can be used, in principle, for supervised differential expression analysis, where the parameters of interest are regression coefficients <italic>β</italic> corresponding to known sample-level covariates in the matrix <italic>X</italic> (e.g., cell type, treatment/control status). Differentially expressed genes may be identified via likelihood ratio tests or Wald tests, with standard errors of estimators of <italic>β</italic> obtained from the Hessian matrix of the likelihood function. In addition, posterior dropout probabilities can be readily derived from the model and used as weights to unlock standard bulk RNA-seq methods<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>, such as edgeR<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. We envision a future version of the zinbwave package with this added capability.</p>
  </sec>
  <sec id="Sec12">
    <title>Methods</title>
    <sec id="Sec13">
      <title>ZINB-WaVE model</title>
      <p id="Par50">For any <italic>μ</italic> ≥ 0 and <italic>θ</italic> &gt; 0, let <italic>f</italic><sub><italic>NB</italic></sub>(⋅; <italic>μ</italic>, <italic>θ</italic>) denote the probability mass function (PMF) of the negative binomial (NB) distribution with mean <italic>μ</italic> and inverse dispersion parameter <italic>θ</italic>, namely:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f_{\mathrm{NB}}(y;\mu ,\theta ) = \frac{{{{\Gamma }}(y + \theta )}}{{{{\Gamma }}(y + 1){{\Gamma }}(\theta )}}\left( {\frac{\theta }{{\theta + \mu }}} \right)^\theta \left( {\frac{\mu }{{\mu + \theta }}} \right)^y,\quad \forall y \in {\Bbb N}.$$\end{document}</tex-math><mml:math id="M6" display="block"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>Γ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mo>∀</mml:mo><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">N</mml:mi><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par51">Note that another parametrization of the NB PMF is in terms of the dispersion parameter <italic>φ</italic> = <italic>θ</italic><sup>−1</sup> (although <italic>θ</italic> is also sometimes called dispersion parameter in the literature). In both cases, the mean of the NB distribution is <italic>μ</italic> and its variance is:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma ^2 = \mu + \frac{{\mu ^2}}{\theta } = \mu + \phi \mu ^2.$$\end{document}</tex-math><mml:math id="M8" display="block"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>ϕ</mml:mi><mml:msup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>In particular, the NB distribution boils down to a Poisson distribution when <italic>φ</italic> = 0 ⇔ <italic>θ</italic> = +∞.</p>
      <p id="Par52">For any <italic>π</italic> ∈ [0, 1], let <italic>f</italic><sub>ZINB</sub>(⋅ ; <italic>μ</italic>, <italic>θ</italic>, <italic>π</italic>) be the PMF of the ZINB distribution given by:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f_{\mathrm{ZINB}}(y;\mu ,\theta ,\pi ) = \pi \delta _0(y) + (1 - \pi )f_{\mathrm{NB}}(y;\mu ,\theta ),\quad \forall y \in {\Bbb N},$$\end{document}</tex-math><mml:math id="M10" display="block"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>π</mml:mi><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mo>∀</mml:mo><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">N</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>where <italic>δ</italic><sub>0</sub>(⋅) is the Dirac function. Here, <italic>π</italic> can be interpreted as the probability that a 0 is observed instead of the actual count, resulting in an inflation of zeros compared to the NB distribution, hence the name ZINB.</p>
      <p id="Par53">Given <italic>n</italic> samples (typically, <italic>n</italic> single cells) and <italic>J</italic> features (typically, <italic>J</italic> genes) that can be counted for each sample, let <italic>Y</italic><sub><italic>ij</italic></sub> denote the count of feature <italic>j</italic> (for <italic>j</italic> = 1,…, <italic>J</italic>) for sample <italic>i</italic> (<italic>i</italic> = 1,…, <italic>n</italic>). To account for various technical and biological effects frequent, in particular, in single-cell sequencing technologies, we model <italic>Y</italic><sub><italic>ij</italic></sub> as a random variable following a ZINB distribution with parameters <italic>μ</italic><sub><italic>ij</italic></sub>, <italic>θ</italic><sub><italic>ij</italic></sub>, and <italic>π</italic><sub><italic>ij</italic></sub>, and consider the following regression models for the parameters:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{l}} {{\mathrm{ln}}\left( {\mu _{ij}} \right)} \hfill &amp; = \hfill &amp; {\left( {X\beta _\mu + (V\gamma _\mu )^ \top + W\alpha _\mu + O_\mu } \right)_{ij},} \hfill \\ {{\mathrm{logit}}\left( {\pi _{ij}} \right)} \hfill &amp; = \hfill &amp; {\left( {X\beta _\pi + (V\gamma _\pi )^ \top + W\alpha _\pi + O_\pi } \right)_{ij},} \hfill \\ {{\mathrm{ln}}\left( {\theta _{ij}} \right)} \hfill &amp; = \hfill &amp; {\zeta _j,} \hfill \end{array}$$\end{document}</tex-math><mml:math id="M12" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">ln</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>W</mml:mi><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">logit</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>W</mml:mi><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">ln</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where<disp-formula id="Equ5"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{logit}}(\pi ) = {\mathrm{ln}}\left( {\frac{\pi }{{1 - \pi }}} \right)$$\end{document}</tex-math><mml:math id="M14" display="block"><mml:mi mathvariant="normal">logit</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>and elements of the regression models are as follows.</p>
      <p id="Par54"><italic>X</italic> is a known <italic>n</italic> × <italic>M</italic> matrix corresponding to <italic>M</italic> cell-level covariates and <italic>β</italic> = (<italic>β</italic><sub><italic>μ</italic></sub>, <italic>β</italic><sub><italic>π</italic></sub>) its associated <italic>M</italic> × <italic>J</italic> matrices of regression parameters. <italic>X</italic> can typically include covariates that induce variation of interest, such as cell types, or covariates that induce unwanted variation, such as batch or quality control measures. It can also include a constant column of ones, <bold>1</bold><sub><italic>n</italic></sub>, to account for gene-specific intercepts.</p>
      <p id="Par55"><italic>V</italic> is a known <italic>J</italic> × <italic>L</italic> matrix corresponding to <italic>J</italic> gene-level covariates, such as gene length or GC-content, and <italic>γ</italic> = (<italic>γ</italic><sub><italic>μ</italic></sub>, <italic>γ</italic><sub><italic>π</italic></sub>) its associated <italic>L</italic> × <italic>n</italic> matrices of regression parameters. <italic>V</italic> can also include a constant column of ones, <bold>1</bold><sub><italic>J</italic></sub>, to account for cell-specific intercepts, such as size factors representing differences in library sizes.</p>
      <p id="Par56"><italic>W</italic> is an unobserved <italic>n</italic> × <italic>K</italic> matrix corresponding to <italic>K</italic> unknown cell-level covariates, which could be of “unwanted variation” as in RUV<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup> or of interest (such as cell type), and <italic>α</italic> = (<italic>α</italic><sub><italic>μ</italic></sub>, <italic>α</italic><sub><italic>π</italic></sub>) its associated <italic>K</italic> × <italic>J</italic> matrices of regression parameters.</p>
      <p id="Par57"><italic>O</italic><sub><italic>μ</italic></sub> and <italic>O</italic><sub><italic>π</italic></sub> are known <italic>n</italic> × <italic>J</italic> matrices of offsets. <inline-formula id="IEq3"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\zeta \in {\Bbb R}^J$$\end{document}</tex-math><mml:math id="M16"><mml:mi>ζ</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq3.gif"/></alternatives></inline-formula> is a vector of gene-specific dispersion parameters on the log scale. This model deserves a few comments.</p>
      <p id="Par58">By default, <italic>X</italic> and <italic>V</italic> contain a constant column of ones, to account, respectively, for gene-specific (e.g., baseline expression level) and cell-specific (e.g., library size) variation. In that case, <italic>X</italic> and <italic>V</italic> are of the form <italic>X</italic> = [<bold>1</bold><sub><italic>n</italic></sub>, <italic>X</italic><sup>0</sup>] and <italic>V</italic> = [<bold>1</bold><sub><italic>J</italic></sub>, <italic>V</italic><sup>0</sup>] and we can similarly decompose the corresponding parameters as <italic>β</italic> = [<italic>β</italic><sup>1</sup>, <italic>β</italic><sup>0</sup>] and <italic>γ</italic> = [<italic>γ</italic><sup>1</sup>, <italic>γ</italic><sup>0</sup>], where <inline-formula id="IEq4"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta ^1 \in {\Bbb R}^{1 \times J}$$\end{document}</tex-math><mml:math id="M18"><mml:msup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq4.gif"/></alternatives></inline-formula> is a vector of gene-specific intercepts and <inline-formula id="IEq5"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\gamma ^1 \in {\Bbb R}^{1 \times n}$$\end{document}</tex-math><mml:math id="M20"><mml:msup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq5.gif"/></alternatives></inline-formula> a vector of cell-specific intercepts. The representation <inline-formula id="IEq6"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bf{1}}_n\beta ^1 + \left( {{\bf{1}}_J\gamma ^1} \right)^ \top$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq6.gif"/></alternatives></inline-formula> is then not unique, but could be made unique by adding a constant and constraining <italic>β</italic><sup>1</sup> and <italic>γ</italic><sup>1</sup> to each have elements summing to zero.</p>
      <p id="Par59">Although <italic>W</italic> is the same, the matrices <italic>X</italic> and <italic>V</italic> could differ in the modeling of <italic>μ</italic> and <italic>π</italic>, if we assume that some known factors do not affect both <italic>μ</italic> and <italic>π</italic>. To keep notation simple and consistent, we use the same matrices, but will implicitly assume that some parameters may be constrained to be 0 if needed.</p>
      <p id="Par60">By allowing the models to differ for <italic>μ</italic> and <italic>π</italic>, we can model and test for differential expression in terms of either the NB mean or the ZI probability.</p>
      <p id="Par61">We limit ourselves to a gene-dependent dispersion parameter. More complicated models for <italic>θ</italic><sub><italic>ij</italic></sub> could be investigated, such as a model similar to <italic>μ</italic><sub><italic>ij</italic></sub> or a functional of the form <italic>θ</italic><sub><italic>ij</italic></sub> = <italic>f</italic>(<italic>μ</italic><sub><italic>ij</italic></sub>), but we restrict ourselves to a simpler model that has been shown to be largely sufficient in bulk RNA-seq analysis.</p>
    </sec>
    <sec id="Sec14">
      <title>ZINB-WaVE estimation procedure</title>
      <p id="Par62">The input to the model are the matrices <italic>X</italic>, <italic>V</italic>, <italic>O</italic><sub><italic>μ</italic></sub>, and <italic>O</italic><sub><italic>π</italic></sub> and the integer <italic>K</italic>; the parameters to be inferred are <italic>β</italic> = (<italic>β</italic><sub><italic>μ</italic></sub>, <italic>β</italic><sub><italic>π</italic></sub>), <italic>γ</italic> = (<italic>γ</italic><sub><italic>μ</italic></sub>, <italic>γ</italic><sub><italic>π</italic></sub>), <italic>W</italic>, <italic>α</italic> = (<italic>α</italic><sub><italic>μ</italic></sub>, <italic>α</italic><sub><italic>π</italic></sub>), and <italic>ζ</italic>. Given an <italic>n</italic> × <italic>J</italic> matrix of counts <italic>Y</italic>, the log-likelihood function is<disp-formula id="Equ6"><label>5</label><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\ell (\beta ,\gamma ,W,\alpha ,\zeta ) = \mathop {\sum }\limits_{i = 1}^n \mathop {\sum }\limits_{j = 1}^J {\mathrm{ln}}\,f_{\mathrm{ZINB}}\left( {Y_{ij};\mu _{ij},\theta _{ij},\pi _{ij}} \right),$$\end{document}</tex-math><mml:math id="M24" display="block"><mml:mi>ℓ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>β</mml:mi><mml:mo>,</mml:mo><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:munderover><mml:mi mathvariant="normal">ln</mml:mi><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula>where <italic>μ</italic><sub><italic>ij</italic></sub>, <italic>θ</italic><sub><italic>ij</italic></sub>, and <italic>π</italic><sub><italic>ij</italic></sub> depend on (<italic>β</italic>, <italic>γ</italic>, <italic>W</italic>, <italic>α</italic>, <italic>ζ</italic>) through Eq. (<xref rid="Equ4" ref-type="">4</xref>).</p>
      <p id="Par63">To infer the parameters, we follow a penalized maximum likelihood approach, by trying to solve<disp-formula id="Equ7"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {{{\mathrm{max}}}}\limits_{\beta ,\gamma ,W,\alpha ,\zeta } \left\{ {\ell (\beta ,\gamma ,W,\alpha ,\zeta ) - {\mathrm{Pen}}(\beta ,\gamma ,W,\alpha ,\zeta )} \right\},$$\end{document}</tex-math><mml:math id="M26" display="block"><mml:munder><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi><mml:mo>,</mml:mo><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>ζ</mml:mi></mml:mrow></mml:munder><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mi>ℓ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>β</mml:mi><mml:mo>,</mml:mo><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mi mathvariant="normal">Pen</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>β</mml:mi><mml:mo>,</mml:mo><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>where Pen(⋅) is a regularization term to reduce overfitting and improve the numerical stability of the optimization problem in the setting of many parameters. For nonnegative regularization parameters <inline-formula id="IEq7"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {{\it{\epsilon }}_\beta ,{\it{\epsilon }}_\gamma ,{\it{\epsilon }}_W,{\it{\epsilon }}_\alpha ,{\it{\epsilon }}_\zeta } \right)$$\end{document}</tex-math><mml:math id="M28"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq7.gif"/></alternatives></inline-formula>, we set<disp-formula id="Equ8"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{Pen}}(\beta ,\gamma ,W,\alpha ,\zeta ) = \frac{{{\it{\epsilon }}_\beta }}{2}\left\| {\beta ^0} \right\|^2 + \frac{{{\it{\epsilon }}_\gamma }}{2}\left\| {\gamma ^0} \right\|^2 + \frac{{{\it{\epsilon }}_W}}{2}\left\| W \right\|^2 + \frac{{{\it{\epsilon }}_\alpha }}{2}\left\| \alpha \right\|^2 + \frac{{{\it{\epsilon }}_\zeta }}{2}{\mathrm{Var}}(\zeta ),$$\end{document}</tex-math><mml:math id="M30" display="block"><mml:mi mathvariant="normal">Pen</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>β</mml:mi><mml:mo>,</mml:mo><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">Var</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>where <italic>β</italic><sup>0</sup> and <italic>γ</italic><sup>0</sup> denote the matrices <italic>β</italic> and <italic>γ</italic> without the rows corresponding to the intercepts if an unpenalized intercept is included in the model, <inline-formula id="IEq8"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| \cdot \right\|$$\end{document}</tex-math><mml:math id="M32"><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mo>⋅</mml:mo></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq8.gif"/></alternatives></inline-formula> is the Frobenius matrix norm (<inline-formula id="IEq9"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| A \right\| = \sqrt {{\mathrm{tr}}\left( {A^ \ast A} \right)}$$\end{document}</tex-math><mml:math id="M34"><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msqrt><mml:mi mathvariant="normal">tr</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mi>A</mml:mi></mml:mrow></mml:mfenced></mml:msqrt></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq9.gif"/></alternatives></inline-formula>, where <italic>A</italic><sup>*</sup> denotes the conjugate transpose of <italic>A</italic>), and <inline-formula id="IEq10"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{Var}}(\zeta ) = 1{\mathrm{/}}(J - 1)\mathop {\sum }\limits_{i = 1}^J \left( {\zeta _i - \left( {\mathop {\sum }\limits_{j = 1}^J \zeta _j} \right){\mathrm{/}}J} \right)^2$$\end{document}</tex-math><mml:math id="M36"><mml:mi mathvariant="normal">Var</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mi mathvariant="normal">∕</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>J</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi mathvariant="normal">∕</mml:mi><mml:mi>J</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq10.gif"/></alternatives></inline-formula> is the variance of the elements of <italic>ζ</italic> (using the unbiased sample variance statistic). The penalty tends to shrink the estimated parameters to 0, except for the cell and gene-specific intercepts which are not penalized and the dispersion parameters which are not shrunk towards 0 but instead towards a constant value across genes. Note also that the likelihood only depends on <italic>W</italic> and <italic>α</italic> through their product <italic>R</italic> = <italic>Wα</italic> and that the penalty ensures that at the optimum <italic>W</italic> and <italic>α</italic> have the structure described in the following result, which generalizes standard results such as Srebro et al.<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> (Lemma 1) and Mazumder et al.<sup><xref ref-type="bibr" rid="CR51">51</xref></sup> (Lemma 6).</p>
      <p><italic>Lemma 1:</italic> For any matrix <italic>R</italic> and positive scalars <italic>s</italic> and <italic>t</italic>, the following holds:<disp-formula id="Equ9"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {{{\mathrm{min}}}}\limits_{S,T:R = ST} \frac{1}{2}\left( {s\left\| S \right\|^2 + t\left\| T \right\|^2} \right) = \sqrt {st} \left\| R \right\|_ \ast ,$$\end{document}</tex-math><mml:math id="M38" display="block"><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>:</mml:mo><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mi>S</mml:mi><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>s</mml:mi><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>t</mml:mi><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msqrt><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msqrt><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq11"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| A \right\|_ \ast = {\mathrm{tr}}\left( {\sqrt {A^ \ast A} } \right)$$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">tr</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msqrt><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mi>A</mml:mi></mml:msqrt></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq11.gif"/></alternatives></inline-formula>. If <italic>R</italic> = <italic>R</italic><sub><italic>L</italic></sub><italic>R</italic><sub>Σ</sub><italic>R</italic><sub><italic>R</italic></sub> is a singular value decomposition (SVD) of <italic>R</italic>, then a solution to this optimization problem is:<disp-formula id="Equ10"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S = \left( {\frac{t}{s}} \right)^{\frac{1}{4}}R_LR_\Sigma ^{\frac{1}{2}},\,T = \left( {\frac{s}{t}} \right)^{\frac{1}{4}}R_\Sigma ^{\frac{1}{2}}R_R.$$\end{document}</tex-math><mml:math id="M42" display="block"><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>Proof: Let <inline-formula id="IEq12"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde S = \sqrt s S$$\end{document}</tex-math><mml:math id="M44"><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msqrt><mml:mi>s</mml:mi></mml:msqrt><mml:mi>S</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq12.gif"/></alternatives></inline-formula>, <inline-formula id="IEq13"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde T = \sqrt t T$$\end{document}</tex-math><mml:math id="M46"><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msqrt><mml:mi>t</mml:mi></mml:msqrt><mml:mi>T</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq13.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq14"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde R = \sqrt {st} R$$\end{document}</tex-math><mml:math id="M48"><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msqrt><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msqrt><mml:mi>R</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq14.gif"/></alternatives></inline-formula>. Then, <inline-formula id="IEq15"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| {\tilde S} \right\|^2 = s\left\| S \right\|^2$$\end{document}</tex-math><mml:math id="M50"><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>s</mml:mi><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq15.gif"/></alternatives></inline-formula>, <inline-formula id="IEq16"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| {\tilde T} \right\|^2 = t\left\| T \right\|^2$$\end{document}</tex-math><mml:math id="M52"><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>t</mml:mi><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq16.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq17"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde S\tilde T = \sqrt {st} ST$$\end{document}</tex-math><mml:math id="M54"><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msqrt><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msqrt><mml:mi>S</mml:mi><mml:mi>T</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq17.gif"/></alternatives></inline-formula>, so that the optimization problem is equivalent to:<disp-formula id="Equ11"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {{{\mathrm{min}}}}\limits_{\tilde S,\tilde T:\tilde S\tilde T = \tilde R} \frac{1}{2}\left( {\left\| {\tilde S} \right\|^2 + \left\| {\tilde T} \right\|^2} \right),$$\end{document}</tex-math><mml:math id="M56" display="block"><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>:</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula>which by Mazumder et al.<sup><xref ref-type="bibr" rid="CR51">51</xref></sup> (Lemma 6) has optimum value <inline-formula id="IEq18"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| {\tilde R} \right\|_ \ast = \sqrt {st} \left\| R \right\|_ \ast$$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msqrt><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq18.gif"/></alternatives></inline-formula> reached at <inline-formula id="IEq19"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde S = \tilde R_L\tilde R_\Sigma ^{\frac{1}{2}}$$\end{document}</tex-math><mml:math id="M60"><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq19.gif"/></alternatives></inline-formula> and <inline-formula id="IEq20"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde T = \tilde R_\Sigma ^{\frac{1}{2}}\widetilde {R_R}$$\end{document}</tex-math><mml:math id="M62"><mml:mover accent="true"><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup><mml:mover accent="false"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo> ~</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq20.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq21"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde R_L\tilde R_\Sigma \tilde R_R$$\end{document}</tex-math><mml:math id="M64"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq21.gif"/></alternatives></inline-formula> is a SVD of <inline-formula id="IEq22"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde R$$\end{document}</tex-math><mml:math id="M66"><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq22.gif"/></alternatives></inline-formula>. Observing that <inline-formula id="IEq23"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde R_L = R_L$$\end{document}</tex-math><mml:math id="M68"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq23.gif"/></alternatives></inline-formula>, <inline-formula id="IEq24"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde R_R = R_R$$\end{document}</tex-math><mml:math id="M70"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq24.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq25"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\tilde R_\Sigma = \sqrt {st} R_\Sigma$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msqrt><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq25.gif"/></alternatives></inline-formula>, gives that a solution of the optimization problem is <inline-formula id="IEq26"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S = s^{ - 1/2}\tilde S = s^{ - 1/2}R_L(st)^{1/4}R_\Sigma ^{1/2} = (t{\mathrm{/}}s)^{1/4}R_LR_\Sigma ^{1/2}$$\end{document}</tex-math><mml:math id="M74"><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>∕</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mover accent="true"><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>∕</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>∕</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>∕</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mi mathvariant="normal">∕</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>∕</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>∕</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq26.gif"/></alternatives></inline-formula>. A similar argument for <italic>T</italic> concludes the proof.</p>
      <p id="Par66">This lemma implies in particular that at any local maximum of the penalized log-likelihood, <italic>W</italic> and <inline-formula id="IEq27"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha ^ \top$$\end{document}</tex-math><mml:math id="M76"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq27.gif"/></alternatives></inline-formula> have orthogonal columns, which is useful for visualization or interpretation of latent factors.</p>
      <p id="Par67">To balance the penalties applied to the different matrices in spite of their different sizes, a natural choice is to fix <inline-formula id="IEq28"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\it{\epsilon }} &gt; 0$$\end{document}</tex-math><mml:math id="M78"><mml:mi>ϵ</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq28.gif"/></alternatives></inline-formula> and set<disp-formula id="Equ12"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\it{\epsilon }}_\beta = \frac{{\it{\epsilon }}}{J},\,{\it{\epsilon }}_\gamma = \frac{{\it{\epsilon }}}{n},\,{\it{\epsilon }}_W = \frac{{\it{\epsilon }}}{n},\,{\it{\epsilon }}_\alpha = \frac{{\it{\epsilon }}}{J},\,{\it{\epsilon }}_\zeta = {\it{\epsilon }}.$$\end{document}</tex-math><mml:math id="M80" display="block"><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par68">In particular, from Lemma 1, we easily deduce the following characterization of the penalty on <italic>W</italic> and <italic>α</italic>, which shows that the entries in the matrices <italic>W</italic> and <italic>α</italic> have similar standard deviation after optimization:</p>
      <p id="Par69">Corollary 1: For any <italic>n</italic> × <italic>J</italic> matrix <italic>R</italic> and positive scalars <inline-formula id="IEq29"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\it{\epsilon }}$$\end{document}</tex-math><mml:math id="M82"><mml:mi>ϵ</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq29.gif"/></alternatives></inline-formula>, the following holds.<disp-formula id="Equ13"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {{{\mathrm{min}}}}\limits_{W,\alpha :R = W\alpha } \frac{{\it{\epsilon }}}{2}\left( {\frac{1}{n}\left\| W \right\|^2 + \frac{1}{J}\left\| \alpha \right\|^2} \right) = \frac{{\it{\epsilon }}}{{\sqrt {nJ} }}\left\| R \right\|_ \ast .$$\end{document}</tex-math><mml:math id="M84" display="block"><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>:</mml:mo><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mi>W</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:msqrt><mml:mi>n</mml:mi><mml:mi>J</mml:mi></mml:msqrt></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula>If <italic>R</italic> = <italic>R</italic><sub><italic>L</italic></sub><italic>R</italic><sub>Σ</sub><italic>R</italic><sub><italic>R</italic></sub> is a SVD decomposition of <italic>R</italic>, then a solution to this optimization problem is:<disp-formula id="Equ14"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$W = \left( {\frac{n}{J}} \right)^{\frac{1}{4}}R_LR_\Sigma ^{\frac{1}{2}},\,T = \left( {\frac{J}{n}} \right)^{\frac{1}{4}}R_\Sigma ^{\frac{1}{2}}R_R.$$\end{document}</tex-math><mml:math id="M86" display="block"><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>J</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula>In particular, for any <italic>i</italic> = 1, …, min(<italic>n</italic>, <italic>J</italic>),<disp-formula id="Equ15"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{n}\mathop {\sum }\limits_{j = 1}^n W_{j,i}^2 = \frac{1}{J}\mathop {\sum }\limits_{j = 1}^J \alpha _{i,j}^2 = \frac{{\left[ {R_\Sigma } \right]_{i,i}}}{{\sqrt {nJ} }}.$$\end{document}</tex-math><mml:math id="M88" display="block"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msqrt><mml:mi>n</mml:mi><mml:mi>J</mml:mi></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par70">The penalized likelihood is however not concave, making its maximization computationally challenging. We instead find a local maximum, starting from a smart initialization and iterating a numerical optimization scheme until local convergence, as described below.</p>
      <p id="Par71">Initialization<bold>:</bold> To initialize the set of parameters we approximate the count distribution by a log-normal distribution and explicitly separate zero and non-zero values, as follows:<list list-type="order"><list-item><p id="Par72">Set <inline-formula id="IEq30"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\cal P} = \left\{ {(i,j):Y_{ij} &gt; 0} \right\}$$\end{document}</tex-math><mml:math id="M90"><mml:mi mathvariant="script">P</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>:</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq30.gif"/></alternatives></inline-formula>.</p></list-item><list-item><p id="Par73">Set <italic>L</italic><sub><italic>ij</italic></sub> = ln(<italic>Y</italic><sub><italic>ij</italic></sub>) − (<italic>O</italic><sub><italic>μ</italic></sub>)<sub><italic>ij</italic></sub> for all <inline-formula id="IEq31"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(i,j) \in {\cal P}$$\end{document}</tex-math><mml:math id="M92"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq31.gif"/></alternatives></inline-formula>.</p></list-item><list-item><p id="Par74">Set <inline-formula id="IEq32"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat Z_{ij} = 0$$\end{document}</tex-math><mml:math id="M94"><mml:msub><mml:mrow><mml:mi>Ẑ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq32.gif"/></alternatives></inline-formula> if <inline-formula id="IEq33"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(i,j) \in {\cal P}$$\end{document}</tex-math><mml:math id="M96"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq33.gif"/></alternatives></inline-formula>, <inline-formula id="IEq34"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat Z_{ij} = 1$$\end{document}</tex-math><mml:math id="M98"><mml:msub><mml:mrow><mml:mi>Ẑ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq34.gif"/></alternatives></inline-formula> otherwise.</p></list-item><list-item><p id="Par75">Estimate <italic>β</italic><sub><italic>μ</italic></sub> and <italic>γ</italic><sub><italic>μ</italic></sub> by solving the convex ridge regression problem:</p></list-item></list><disp-formula id="Equ16"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {{{\mathrm{min}}}}\limits_{\beta _\mu ,\gamma _\mu } \mathop {\sum }\limits_{(i,j) \in {\cal P}} \left( {L_{ij} - \left( {X\beta _\mu } \right)_{ij} - \left( {V\gamma _\mu } \right)_{ji}} \right)^2 + \frac{{{\it{\epsilon }}_\beta }}{2}\left\| {\beta _\mu ^0} \right\|^2 + \frac{{{\it{\epsilon }}_\gamma }}{2}\left\| {\gamma _\mu ^0} \right\|^2.$$\end{document}</tex-math><mml:math id="M100" display="block"><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msubsup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par76">This is a standard ridge regression problem, but with a potentially huge design matrix, with up to <italic>nJ</italic> rows and <italic>MJ</italic> + <italic>nL</italic> columns. To solve it efficiently, we alternate the estimation of <italic>β</italic><sub><italic>μ</italic></sub> and <italic>γ</italic><sub><italic>μ</italic></sub>. Specifically, we initialize parameter values as:<disp-formula id="Equ17"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \beta _\mu \leftarrow 0,\,\hat \gamma _\mu \leftarrow 0$$\end{document}</tex-math><mml:math id="M102" display="block"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mn>0</mml:mn></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula>and repeat the following two steps a few times (or until convergence):<list list-type="alpha-lower"><list-item><p id="Par77">Optimization in <italic>γ</italic><sub><italic>μ</italic></sub>, which can be performed independently and in parallel for each cell:<disp-formula id="Equ18"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \gamma _\mu \in \mathop {{{\mathrm{argmin}}}}\limits_{\gamma _\mu } \mathop {\sum }\limits_{(i,j) \in {\cal P}} \left( {L_{ij} - \left( {X\hat \beta _\mu } \right)_{ij} - \left( {V\gamma _\mu } \right)_{ji}} \right)^2 + \frac{{{\it{\epsilon }}_\gamma }}{2}\left\| {\gamma _\mu ^0} \right\|^2.$$\end{document}</tex-math><mml:math id="M104" display="block"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msubsup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par78">Optimization in <italic>β</italic><sub><italic>μ</italic></sub>, which can be performed independently and in parallel for each gene:<disp-formula id="Equ19"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \beta _\mu \in \mathop {{{\mathrm{argmin}}}}\limits_{\beta _\mu } \mathop {\sum }\limits_{(i,j) \in {\cal P}} \left( {L_{ij} - \left( {V\hat \gamma _\mu } \right)_{ji} - \left( {X\beta _\mu } \right)_{ij}} \right)^2 + \frac{{{\it{\epsilon }}_\beta }}{2}\left\| {\beta _\mu ^0} \right\|^2.$$\end{document}</tex-math><mml:math id="M106" display="block"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par79">Estimate <italic>W</italic> and <italic>α</italic><sub><italic>μ</italic></sub> by solving<disp-formula id="Equ20"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\hat W,\hat \alpha _\mu } \right) \in \mathop {{{\mathrm{argmin}}}}\limits_{W,\alpha _\mu } \mathop {\sum }\limits_{(i,j) \in {\cal P}} \left( {L_{ij} - \left( {X\hat \beta _\mu } \right)_{ij} - \left( {V\hat \gamma _\mu } \right)_{ji} - \left( {W\alpha _\mu } \right)_{ij}} \right)^2 \\ + \frac{{{\it{\epsilon }}_W}}{2}\left\| W \right\|^2 + \frac{{{\it{\epsilon }}_\alpha }}{2}\left\| {\alpha _\mu } \right\|^2.$$\end{document}</tex-math><mml:math id="M108" display="block"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>Ŵ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>W</mml:mi><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula></p><p id="Par80">Denoting by <inline-formula id="IEq35"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D = L - X\hat \beta - (V\hat \gamma )^ \top$$\end{document}</tex-math><mml:math id="M110"><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mi>L</mml:mi><mml:mo>-</mml:mo><mml:mi>X</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq35.gif"/></alternatives></inline-formula>, this problem can be rewritten as:<disp-formula id="Equ21"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {{{\mathrm{min}}}}\limits_{W,\alpha } \left\| {D - W\alpha } \right\|_{\cal P}^2 + \frac{1}{2}\left( {{\it{\epsilon }}_W\left\| W \right\|^2 + {\it{\epsilon }}_\alpha \left\| \alpha \right\|^2} \right),$$\end{document}</tex-math><mml:math id="M112" display="block"><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>D</mml:mi><mml:mo>-</mml:mo><mml:mi>W</mml:mi><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ21.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq36"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\| A \right\|_{\cal P}^2 = \mathop {\sum }\nolimits_{(i,j) \in {\cal P}} A_{ij}^2$$\end{document}</tex-math><mml:math id="M114"><mml:msubsup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq36.gif"/></alternatives></inline-formula>. By Lemma 1, if <italic>K</italic> is large enough, one can first solve the convex optimization problem:<disp-formula id="Equ22"><label>6</label><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat R \in \mathop {{{\mathrm{argmin}}}}\limits_{R:{\mathrm{rank}}(R) \le K} \left\| {D - R} \right\|_{\cal P}^2 + \sqrt {{\it{\epsilon }}_W{\it{\epsilon }}_\alpha } \left\| R \right\|_ \ast$$\end{document}</tex-math><mml:math id="M116" display="block"><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>∈</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="normal">rank</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≤</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>D</mml:mi><mml:mo>-</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msqrt><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:msqrt><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ22.gif" position="anchor"/></alternatives></disp-formula>and set<disp-formula id="Equ23"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$W = \left( {\frac{{{\it{\epsilon }}_\alpha }}{{{\it{\epsilon }}_W}}} \right)^{\frac{1}{4}}R_LR_\Sigma ^{\frac{1}{2}},\quad \alpha = \left( {\frac{{{\it{\epsilon }}_W}}{{{\it{\epsilon }}_\alpha }}} \right)^{\frac{1}{4}}R_\Sigma ^{\frac{1}{2}}R_R,$$\end{document}</tex-math><mml:math id="M118" display="block"><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msubsup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ23.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq37"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat R = R_LR_\Sigma R_R$$\end{document}</tex-math><mml:math id="M120"><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq37.gif"/></alternatives></inline-formula> is the SVD of <inline-formula id="IEq38"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat R$$\end{document}</tex-math><mml:math id="M122"><mml:mover accent="true"><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq38.gif"/></alternatives></inline-formula>. This solution is exact when <italic>K</italic> is at least equal to the rank of the solution of the unconstrained problem (6), which we solve with the softImpute::softImpute() function<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. If <italic>K</italic> is smaller, then (6) becomes a non-convex optimization problem whose global optimum may be challenging to find. In that case we also use the rank-constrained version of softImpute::softImpute() to obtain a good local optimum.</p></list-item><list-item><p id="Par81">Estimate <italic>β</italic><sub><italic>π</italic></sub>, <italic>γ</italic><sub><italic>π</italic></sub>, and <italic>α</italic><sub><italic>π</italic></sub> by solving the regularized logistic regression problem:</p></list-item></list><disp-formula id="Equ24"><label>7</label><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{c}} {\mathop {{{\mathrm{min}}}}\limits_{\left( {\beta _\pi ,\gamma _\pi ,\alpha _\pi } \right)} \mathop {\sum }\limits_{(i,j)} \left[ { - \hat Z_{ij}\left( {X\beta _\pi + \left( {V\gamma _\pi } \right)^ \top + \hat W\alpha _\pi } \right)_{ij}} \right.} \\ {\left. { + {\mathrm{ln}}\left( {1 + e^{\left( {X\beta _\pi + \left( {V\gamma _\pi } \right)^ \top + \hat W\alpha _\pi } \right)_{ij}}} \right)} \right] + \frac{{{\it{\epsilon }}_\beta }}{2}\left\| {\beta _\pi } \right\|^2 + \frac{{{\it{\epsilon }}_\gamma }}{2}\left\| {\gamma _\pi } \right\|^2 + \frac{{{\it{\epsilon }}_\alpha }}{2}\left\| {\alpha _\pi } \right\|^2.} \end{array}$$\end{document}</tex-math><mml:math id="M124" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mfenced close="" open="[" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>Ẑ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>Ŵ</mml:mi><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfenced close="]" open="" separators=""><mml:mrow><mml:mo>+</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>Ŵ</mml:mi><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ24.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par82">This is a standard ridge logistic regression problem, but with a potentially huge design matrix, with up to <italic>nJ</italic> rows and <italic>MJ</italic> + <italic>nL</italic> columns. To solve it efficiently, we alternate the estimation of <italic>β</italic><sub><italic>π</italic></sub>, <italic>γ</italic><sub><italic>π</italic></sub>, and <italic>α</italic><sub><italic>π</italic></sub>. Specifically, we initialize parameter values as:<disp-formula id="Equ25"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \beta _\pi \leftarrow 0,\quad \hat \gamma _\pi \leftarrow 0,\quad \hat \alpha _\pi \leftarrow 0$$\end{document}</tex-math><mml:math id="M126" display="block"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mn>0</mml:mn></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ25.gif" position="anchor"/></alternatives></disp-formula>and repeat the following two steps a few times (or until convergence):<list list-type="alpha-lower"><list-item><p id="Par83">Optimization in <italic>γ</italic><sub><italic>π</italic></sub>:<disp-formula id="Equ26"><label>8</label><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{c}} {\hat \gamma _\pi \in \mathop {{{\mathrm{argmin}}}}\limits_{\gamma _\pi } \mathop {\sum }\limits_{(i,j)} \left[ { - \hat Z_{ij}\left( {X\hat \beta _\pi + \left( {V\gamma _\pi } \right)^ \top + \hat W\hat \alpha _\pi } \right)} \right._{ij}} \\ {\left. { + {\mathrm{ln}}\left( {1 + e^{\left( {X\hat \beta _\pi + \left( {V\gamma _\pi } \right)^ \top + \hat W\hat \alpha _\pi } \right)_{ij}}} \right)} \right] + \frac{{{\it{\epsilon }}_\gamma }}{2}\left\| {\gamma _\pi } \right\|^2.} \end{array}$$\end{document}</tex-math><mml:math id="M128" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mfenced close="" open="[" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>Ẑ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>Ŵ</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfenced close="]" open="" separators=""><mml:mrow><mml:mo>+</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>Ŵ</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ26.gif" position="anchor"/></alternatives></disp-formula></p><p id="Par84">Note that this problem can be solved for each cell (<italic>i</italic>) independently and in parallel. When there is no gene covariate besides the constant intercept, the problem is easily solved by setting <inline-formula id="IEq39"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\hat \gamma _\pi } \right)_i$$\end{document}</tex-math><mml:math id="M130"><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq39.gif"/></alternatives></inline-formula> to the logit of the proportion of zeros in each cell.</p></list-item><list-item><p id="Par85">Optimization in <italic>β</italic><sub><italic>π</italic></sub> and <italic>α</italic><sub><italic>π</italic></sub>:</p></list-item></list><disp-formula id="Equ27"><label>9</label><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{c}} {\left( {\hat \beta _\pi ,\hat \alpha _\pi } \right) \in \mathop {{{\mathrm{argmin}}}}\limits_{\left( {\beta _\pi ,\alpha _\pi } \right)} \mathop {\sum }\limits_{(i,j)} \left[ { - \hat Z_{ij}\left( {X\beta _\pi + \left( {V\hat \gamma _\pi } \right)^ \top + \hat W\alpha _\pi } \right)_{ij}} \right.} \\ {\left. { + {\mathrm{ln}}\left( {1 + e^{\left( {X\beta _\pi + \left( {V\hat \gamma _\pi } \right)^ \top + \hat W\alpha _\pi } \right)_{ij}}} \right)} \right] + \frac{{{\it{\epsilon }}_\beta }}{2}\left\| {\beta _\pi } \right\|^2 + \frac{{{\it{\epsilon }}_\alpha }}{2}\left\| {\alpha _\pi } \right\|^2.} \end{array}$$\end{document}</tex-math><mml:math id="M132" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∈</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mfenced close="" open="[" separators=""><mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>Ẑ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>Ŵ</mml:mi><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:mfenced close="]" open="" separators=""><mml:mrow><mml:mo>+</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>V</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>Ŵ</mml:mi><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ27.gif" position="anchor"/></alternatives></disp-formula><list list-type="simple"><list-item><label>7.</label><p id="Par86">Initialize <inline-formula id="IEq40"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \zeta = 0$$\end{document}</tex-math><mml:math id="M134"><mml:mover accent="true"><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq40.gif"/></alternatives></inline-formula>.</p></list-item></list></p>
      <p id="Par87">Optimization<bold><italic>:</italic></bold> After initialization, we maximize locally the penalized log-likelihood by alternating optimization over the dispersion parameters and left and right-factors, iterating the following steps until convergence:<list list-type="order"><list-item><p id="Par88">Dispersion optimization:<disp-formula id="Equ28"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \zeta \leftarrow \mathop {{{\mathrm{argmax}}}}\limits_\zeta \left\{ {\ell \left( {\hat \beta ,\hat \gamma ,\hat W,\hat \alpha ,\zeta } \right) - \frac{{{\it{\epsilon }}_\zeta }}{2}{\mathrm{Var}}(\zeta )} \right\}.$$\end{document}</tex-math><mml:math id="M136" display="block"><mml:mover accent="true"><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>←</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmax</mml:mi></mml:mrow><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow></mml:munder><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mi>ℓ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>Ŵ</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>ζ</mml:mi></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">Var</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ28.gif" position="anchor"/></alternatives></disp-formula></p></list-item></list></p>
      <p id="Par89">To solve this problem, we start by estimating a common dispersion parameter for all the genes, by maximizing the objective function under the constraint that Var(<italic>ζ</italic>) = 0; in practice, we use a derivative-free one-dimensional optimization vector over the range [−50, 50]. We then optimize the objective function by a quasi-Newton optimization scheme starting from the constant solution found by the first step. To derive the gradient of the objective function used by the optimization procedure, note that the derivative of the NB log-density is:<disp-formula id="Equ29"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{\partial }{{\partial \theta }}{\mathrm{ln}}f_{\mathrm{NB}}(y;\mu ,\theta ) = {{\Psi }}(y + \theta ) - {{\Psi }}(\theta ) + {\mathrm{ln}}\theta + 1 - {\mathrm{ln}}(\mu + \theta ) - \frac{{y + \theta }}{{\mu + \theta }},$$\end{document}</tex-math><mml:math id="M138" display="block"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>Ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mi>Ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ29.gif" position="anchor"/></alternatives></disp-formula>where <italic>Ψ</italic>(<italic>z</italic>) = <italic>Γ</italic>′(<italic>z</italic>)/<italic>Γ</italic>(<italic>z</italic>) is the digamma function. We therefore get the derivative of the ZINB density as follows, for any <italic>π</italic> ∈ [0, 1]:<list list-type="bullet"><list-item><p id="Par90">-If <italic>y</italic> &gt; 0, <italic>f</italic><sub>ZINB</sub>(<italic>y</italic>; <italic>μ</italic>, <italic>θ</italic>, <italic>π</italic>) = (1 − <italic>π</italic>)<italic>f</italic><sub>NB</sub>(<italic>y</italic>; <italic>μ</italic>, <italic>θ</italic>) therefore<disp-formula id="Equ30"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{\partial }{{\partial \theta }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y;\mu ,\theta ) = {{\Psi }}(y + \theta ) - {{\Psi }}(\theta ) + {\mathrm{ln}}\theta + 1 - {\mathrm{ln}}(\mu + \theta ) - \frac{{y + \theta }}{{\mu + \theta }}.$$\end{document}</tex-math><mml:math id="M140" display="block"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>Ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mi>Ψ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ30.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par91">-For <italic>y</italic> = 0, <inline-formula id="IEq41"><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{\partial }{{\partial \theta }}{\mathrm{ln}}f_{\mathrm{NB}}(0;\mu ,\theta ) = {\mathrm{ln}}\theta + 1 - {\mathrm{ln}}(\mu + \theta ) - \frac{\theta }{{\mu + \theta }}$$\end{document}</tex-math><mml:math id="M142"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq41.gif"/></alternatives></inline-formula>, therefore</p></list-item></list><disp-formula id="Equ31"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{\partial }{{\partial \theta }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y;\mu ,\theta ) = \frac{{{\mathrm{ln}}\theta + 1 - {\mathrm{ln}}(\mu + \theta ) - \frac{\theta }{{\mu + \theta }}}}{{1 + \frac{{\pi (\mu + \theta )^\theta }}{{(1 - \pi )\theta ^\theta }}}}.$$\end{document}</tex-math><mml:math id="M144" display="block"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">ln</mml:mi><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>π</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ31.gif" position="anchor"/></alternatives></disp-formula>The derivative of the objective function w.r.t. <italic>ζ</italic><sub><italic>j</italic></sub>, for <italic>j</italic> = 1,…, <italic>J</italic>, is then easily obtained by<disp-formula id="Equ32"><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop {\sum }\limits_{i = 1}^n \theta _j\frac{\partial }{{\partial \theta }}{\mathrm{ln}}f_{\mathrm{ZINB}}\left( {y_{ij};\mu _{ij},\theta _j} \right) - \frac{{{\it{\epsilon }}_\zeta }}{{J - 1}}\left( {\zeta _j - \frac{1}{J}\mathop {\sum }\limits_{k = 1}^J \zeta _k} \right).$$\end{document}</tex-math><mml:math id="M146" display="block"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>J</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ32.gif" position="anchor"/></alternatives></disp-formula>(Note that the <italic>J</italic> − 1 term in the denominator comes from the use of the unbiased sample variance statistic in the penalty for <italic>ζ</italic>.)<list list-type="simple"><list-item><label>2.</label><p id="Par92">Left-factor (cell-specific) optimization:<disp-formula id="Equ33"><label>10</label><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\hat \gamma ,\hat W} \right) \leftarrow \mathop {{{\mathrm{argmax}}}}\limits_{\left( {\gamma ,W} \right)} \left\{ {\ell \left( {\hat \beta ,\gamma ,W,\hat \alpha ,\hat \zeta } \right) - \frac{{{\it{\epsilon }}_\gamma }}{2}\left\| {\gamma ^0} \right\|^2 - \frac{{{\it{\epsilon }}_W}}{2}\left\| W \right\|^2} \right\}.$$\end{document}</tex-math><mml:math id="M148" display="block"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>Ŵ</mml:mi></mml:mrow></mml:mfenced><mml:mo>←</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmax</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mi>ℓ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ33.gif" position="anchor"/></alternatives></disp-formula></p><p id="Par93">Note that this optimization can be performed independently and in parallel for each cell <italic>i</italic> = 1, …, <italic>n</italic>. For this purpose, we consider a subroutine solveZinbRegression (<italic>y</italic>, <italic>A</italic><sub><italic>μ</italic></sub>, <italic>B</italic><sub><italic>μ</italic></sub>, <italic>C</italic><sub><italic>μ</italic></sub>, <italic>A</italic><sub><italic>π</italic></sub>, <italic>B</italic><sub><italic>π</italic></sub>, <italic>C</italic><sub><italic>π</italic></sub>, <italic>C</italic><sub><italic>θ</italic></sub>) to find a set of vectors (<italic>a</italic><sub><italic>μ</italic></sub>, <italic>a</italic><sub><italic>π</italic></sub>, <italic>b</italic>) that locally maximize the log-likelihood of a ZINB model for a vector of counts <italic>y</italic> parametrized as follows:<disp-formula id="Equ34"><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{l}} {{\mathrm{ln}}(\mu )} \hfill &amp; = \hfill &amp; {A_\mu a_\mu + B_\mu b + C_\mu ,} \hfill \\ {{\mathrm{logit}}(\pi )} \hfill &amp; = \hfill &amp; {A_\pi a_\pi + B_\pi b + C_\pi ,} \hfill \\ {{\mathrm{ln}}(\theta )} \hfill &amp; = \hfill &amp; {C_\theta .} \hfill \end{array}$$\end{document}</tex-math><mml:math id="M150" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mi>b</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">logit</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mi>b</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ34.gif" position="anchor"/></alternatives></disp-formula>We give more details on how to solve solveZinbRegression in the next section. To solve (10) for cell <italic>i</italic> we call solveZinbRegression with the following parameters:<disp-formula id="Equ35"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{ \begin{array}{l}a_\mu = \gamma _\mu [.,i]\\ a_\pi = \gamma _\pi [.,i]\\ b = W[i,.]^ \top \\ y = Y[i,]^ \top \\ A_\mu = V_\mu \\ B_\mu = \alpha _\mu ^ \top \\ C_\mu = \left( {X_\mu [i,.]\beta _\mu + O_\mu [i,.]} \right)^ \top \\ A_\pi = V_\pi \\ B_\pi = \alpha _\pi ^ \top \\ C_\pi = \left( {X_\pi [i,.]\beta _\pi + O_\pi [i,.]} \right)^ \top \\ C_\theta = \zeta \end{array} \right..$$\end{document}</tex-math><mml:math id="M152" display="block"><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mi>W</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>.</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mi>Y</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>.</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>.</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msubsup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>.</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>.</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>ζ</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ35.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><label>3.</label><p id="Par94">Right-factor (gene-specific) optimization:<disp-formula id="Equ36"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\hat \beta ,\hat \alpha } \right) \leftarrow \mathop {{{\mathrm{argmax}}}}\limits_{\left( {\beta ,\alpha } \right)} \left\{ {\ell \left( {\beta ,\hat \gamma ,\hat W,\alpha ,\hat \zeta } \right) - \frac{{{\it{\epsilon }}_\beta }}{2}\left\| {\beta ^0} \right\|^2 - \frac{{{\it{\epsilon }}_\alpha }}{2}\left\| \alpha \right\|^2} \right\}.$$\end{document}</tex-math><mml:math id="M154" display="block"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>←</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmax</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>β</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:munder><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:mi>ℓ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>β</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>Ŵ</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ36.gif" position="anchor"/></alternatives></disp-formula>Note that this optimization can be performed independently and in parallel for each gene <italic>j</italic> = 1,…, <italic>J</italic>, by calling solveZinbRegression with the following parameters:<disp-formula id="Equ37"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left\{ {\begin{array}{*{20}{l}} {a_\mu } \hfill &amp; { = \left( {{\mathrm{\beta }}_{\mathrm{\mu }}[.,{\mathrm{j}}];{\mathrm{\alpha }}_\mu [.,{\mathrm{j}}]} \right)} \hfill \\ {a_\pi } \hfill &amp; { = \left( {{\mathrm{\beta }}_{\mathrm{\pi }}[.,{\mathrm{j}}];{\mathrm{\alpha }}_{\mathrm{\pi }}[.,{\mathrm{j}}]} \right)} \hfill \\ b \hfill &amp; { = \emptyset } \hfill \\ y \hfill &amp; { = {\mathrm{Y}}[.,{\mathrm{j}}]} \hfill \\ {A_\mu } \hfill &amp; { = \left[ {{\mathrm{X}}_{\mathrm{\mu }},{\mathrm{W}}} \right]} \hfill \\ {B_\mu } \hfill &amp; { = \emptyset } \hfill \\ {C_\mu } \hfill &amp; { = \left( {{\mathrm{V}}_{\mathrm{\mu }}\left[ {{\mathrm{j}},.} \right]{\mathrm{\gamma }}_{\mathrm{\mu }}} \right)^ \top + {\mathrm{O}}_{\mathrm{\mu }}[.,{\mathrm{j}}]} \hfill \\ {A_\pi } \hfill &amp; { = [{\mathrm{X}}_{\mathrm{\pi }},{\mathrm{W}}]} \hfill \\ {B_\pi } \hfill &amp; { = \emptyset } \hfill \\ {C_\pi } \hfill &amp; { = \left( {{\mathrm{V}}_{\mathrm{\pi }}\left[ {{\mathrm{j}},.} \right]{\mathrm{\gamma }}_{\mathrm{\pi }}} \right)^ \top + {\mathrm{O}}_{\mathrm{\pi }}[.,{\mathrm{j}}]} \hfill \\ {C_\theta } \hfill &amp; { = {\mathrm{\zeta }}_{\mathrm{j}}{\bf{1}}_n} \hfill \end{array}} \right..$$\end{document}</tex-math><mml:math id="M156" display="block"><mml:mfenced close="" open="{" separators=""><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">β</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">μ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">α</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">β</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">π</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">α</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">π</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>b</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mi>∅</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>y</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Y</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">X</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">μ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">W</mml:mi></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mi>∅</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">V</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">μ</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mi mathvariant="normal">j</mml:mi><mml:mo>,</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi mathvariant="normal">γ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">O</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">μ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">X</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">W</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:mi>∅</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">V</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">π</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="[" separators=""><mml:mrow><mml:mi mathvariant="normal">j</mml:mi><mml:mo>,</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi mathvariant="normal">γ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">O</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">π</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal">j</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">ζ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="bold">1</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ37.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><label>4.</label><p id="Par95">Orthogonalization:</p></list-item></list><disp-formula id="Equ38"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\hat W,\hat \alpha } \right) \leftarrow \mathop {{{\mathrm{argmin}}}}\limits_{(W,\alpha ):W\alpha = \hat W\hat \alpha } \frac{1}{2}\left( {{\it{\epsilon }}_W\left\| W \right\|^2 + {\it{\epsilon }}_\alpha \left\| \alpha \right\|^2} \right).$$\end{document}</tex-math><mml:math id="M158" display="block"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>Ŵ</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>←</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>:</mml:mo><mml:mi>W</mml:mi><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mi>Ŵ</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>W</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mfenced close="∥" open="∥" separators=""><mml:mrow><mml:mi>α</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ38.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par96">This is obtained by applying Lemma 1, starting from an SVD decomposition of the current <inline-formula id="IEq42"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat W\hat \alpha$$\end{document}</tex-math><mml:math id="M160"><mml:mi>Ŵ</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq42.gif"/></alternatives></inline-formula>. Note that this step not only allows to maximize locally the penalized log-likelihood, but also ensures that the columns of <italic>W</italic> stay orthogonal to each other during optimization.</p>
    </sec>
    <sec id="Sec85">
      <title>Solving</title>
      <p id="Par97">solveZinbRegression Given a <italic>N</italic>-dimensional matrix of counts <inline-formula id="IEq43"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$y \in {\Bbb N}^N$$\end{document}</tex-math><mml:math id="M162"><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq43.gif"/></alternatives></inline-formula>, and matrix <inline-formula id="IEq44"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A_\mu \in {\Bbb R}^{N \times p}$$\end{document}</tex-math><mml:math id="M164"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq44.gif"/></alternatives></inline-formula>, <inline-formula id="IEq45"><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$B_\mu \in {\Bbb R}^{N \times r}$$\end{document}</tex-math><mml:math id="M166"><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq45.gif"/></alternatives></inline-formula>, <inline-formula id="IEq46"><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_\mu \in {\Bbb R}^N$$\end{document}</tex-math><mml:math id="M168"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq46.gif"/></alternatives></inline-formula>, <inline-formula id="IEq47"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A_\pi \in {\Bbb R}^{N \times q}$$\end{document}</tex-math><mml:math id="M170"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq47.gif"/></alternatives></inline-formula>, <inline-formula id="IEq48"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$B_\pi \in {\Bbb R}^{N \times r}$$\end{document}</tex-math><mml:math id="M172"><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq48.gif"/></alternatives></inline-formula>, <inline-formula id="IEq49"><alternatives><tex-math id="M173">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_\pi \in {\Bbb R}^N$$\end{document}</tex-math><mml:math id="M174"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq49.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq50"><alternatives><tex-math id="M175">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_\theta \in {\Bbb R}^N$$\end{document}</tex-math><mml:math id="M176"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq50.gif"/></alternatives></inline-formula>, for some integers <italic>p</italic>,<italic>q</italic>,<italic>r</italic>, the function attempts to find parameters <inline-formula id="IEq51"><alternatives><tex-math id="M177">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(a_\mu ,a_\pi ,b) \in {\Bbb R}^p \times {\Bbb R}^q \times {\Bbb R}^r$$\end{document}</tex-math><mml:math id="M178"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>q</mml:mi></mml:mrow></mml:msup><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq51.gif"/></alternatives></inline-formula> that maximize the ZINB log-likelihood of <italic>y</italic> with parameters:<disp-formula id="Equ39"><alternatives><tex-math id="M179">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{l}} {{\mathrm{ln}}(\mu )} \hfill &amp; = \hfill &amp; {A_\mu a_\mu + B_\mu b + C_\mu ,} \hfill \\ {{\mathrm{logit}}(\pi )} \hfill &amp; = \hfill &amp; {A_\pi a_\pi + B_\pi b + C_\pi ,} \hfill \\ {{\mathrm{ln}}(\theta )} \hfill &amp; = \hfill &amp; {C_\theta .} \hfill \end{array}$$\end{document}</tex-math><mml:math id="M180" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mi>b</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">logit</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mi>b</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ39.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par98">Starting from an initial guess (as explained in the different steps above), we perform a local minimization of this function <italic>F</italic>(<italic>a</italic><sub><italic>μ</italic></sub>, <italic>a</italic><sub><italic>π</italic></sub>, <italic>b</italic>) using the Broyden–Fletcher–Goldfarb–Shanno (BFGS) quasi-Newton method. Let us now give more details on how the gradient of <italic>F</italic> is computed.</p>
      <p id="Par99">Given a single count <italic>y</italic> (i.e., <italic>N</italic> = 1), we first explicit the derivatives of the log-likelihood of <italic>y</italic> with respect to the (<italic>μ</italic>,<italic>π</italic>) parameters of the ZINB distribution. We first observe that<disp-formula id="Equ40"><alternatives><tex-math id="M181">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{\partial }{{\partial \mu }}{\mathrm{ln}}f_{\mathrm{NB}}(y;\mu ,\theta ) = \frac{y}{\mu } - \frac{{y + \theta }}{{\mu + \theta }},$$\end{document}</tex-math><mml:math id="M182" display="block"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ40.gif" position="anchor"/></alternatives></disp-formula>and that by definition of the ZINB distribution the following holds:<disp-formula id="Equ41"><alternatives><tex-math id="M183">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{l}\frac{\partial }{{\partial \mu }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y;\mu ,\theta ,\pi ) = \frac{{(1 - \pi )f_{\mathrm{NB}}(y;\mu ,\theta )\frac{\partial }{{\partial \mu }}{\mathrm{ln}}f_{\mathrm{NB}}(y;\mu ,\theta )}}{{f_{\mathrm{ZINB}}(y;\mu ,\theta ,\pi )}},\\ \frac{\partial }{{\partial \pi }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y;\mu ,\theta ,\pi ) = \frac{{\delta _0(y) - f_{\mathrm{NB}}(y;\mu ,\theta )}}{{f_{\mathrm{ZINB}}(y;\mu ,\theta ,\pi )}}.\end{array}$$\end{document}</tex-math><mml:math id="M184" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>π</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">NB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ41.gif" position="anchor"/></alternatives></disp-formula>Let us explicit these expressions, depending on whether or not <italic>y</italic> is null:<list list-type="bullet"><list-item><p id="Par100">If <italic>y</italic> &gt; 0, then <italic>δ</italic><sub>0</sub>(<italic>y</italic>) = 0 and <italic>f</italic><sub>ZINB</sub>(<italic>y</italic>;<italic>μ</italic>, <italic>θ</italic>, <italic>π</italic>) = (1 − <italic>π</italic>)<italic>f</italic><sub>NB</sub>(<italic>y</italic>; <italic>μ</italic>, <italic>θ</italic>), so we obtain:<disp-formula id="Equ42"><alternatives><tex-math id="M185">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{l}\frac{\partial }{{\partial \mu }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y;\mu ,\theta ,\pi ) = \frac{y}{\mu } - \frac{{y + \theta }}{{\mu + \theta }},\\ \frac{\partial }{{\partial \pi }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y;\mu ,\theta ,\pi ) = \frac{{ - 1}}{{1 - \pi }}.\end{array}$$\end{document}</tex-math><mml:math id="M186" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>π</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ42.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p id="Par101">If <italic>y</italic> = 0, then <italic>δ</italic><sub>0</sub>(<italic>y</italic>) = 1, and we get</p></list-item></list><disp-formula id="Equ43"><alternatives><tex-math id="M187">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{l}\frac{\partial }{{\partial \mu }}{\mathrm{ln}}f_{\mathrm{ZINB}}(0;\mu ,\theta ,\pi ) = \frac{{ - (1 - \pi )\left( {\frac{\theta }{{\mu + \theta }}} \right)^{\theta + 1}}}{{\pi + (1 - \pi )\left( {\frac{\theta }{{\mu + \theta }}} \right)^\theta }},\\ \frac{\partial }{{\partial \pi }}{\mathrm{ln}}f_{\mathrm{ZINB}}(0;\mu ,\theta ,\pi ) = \frac{{1 - \left( {\frac{\theta }{{\mu + \theta }}} \right)^\theta }}{{\pi + (1 - \pi )\left( {\frac{\theta }{{\mu + \theta }}} \right)^\theta }}.\end{array}$$\end{document}</tex-math><mml:math id="M188" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>π</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>π</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>π</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mfrac><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>+</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ43.gif" position="anchor"/></alternatives></disp-formula>When <italic>N</italic> ≥ 1, using standard calculus for the differentiation of compositions and the facts that:<disp-formula id="Equ44"><alternatives><tex-math id="M189">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{c}\left( {{\mathrm{ln}}^{ - 1}} \right)^\prime ({\mathrm{ln}}\mu ) = \mu ,\\ \left( {{\mathrm{logit}}^{ - 1}} \right)^\prime ({\mathrm{logit}}\pi ) = \pi (1 - \pi ),\end{array}$$\end{document}</tex-math><mml:math id="M190" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="normal">ln</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">ln</mml:mi><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="center"><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="normal">logit</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">logit</mml:mi><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>π</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ44.gif" position="anchor"/></alternatives></disp-formula>we finally get that<disp-formula id="Equ45"><alternatives><tex-math id="M191">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{l}\nabla _{a_\mu }F = A_\mu ^{\it{ \top }}G,\\ \nabla _{a_\pi }F = A_\pi ^{\it{ \top }}H,\\ \nabla _bF = B_\mu ^{\it{ \top }}G + B_\pi ^{\it{ \top }}H.\end{array}$$\end{document}</tex-math><mml:math id="M192" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mo>∇</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi>F</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msubsup><mml:mi>G</mml:mi><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mo>∇</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi>F</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msubsup><mml:mi>H</mml:mi><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mo>∇</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mi>F</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msubsup><mml:mi>G</mml:mi><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>B</mml:mi></mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msubsup><mml:mi>H</mml:mi><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ45.gif" position="anchor"/></alternatives></disp-formula>where <italic>G</italic> and <italic>H</italic> are the <italic>N</italic>-dimensional vectors given by<disp-formula id="Equ46"><alternatives><tex-math id="M193">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{l}} {\forall i \in [1,N],\quad G_i} \hfill &amp; = \hfill &amp; {\mu _i\frac{\partial }{{\partial \mu }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y_i;\mu _i,\theta _i,\pi _i),} \hfill \\ {H_i} \hfill &amp; = \hfill &amp; {\pi _i(1 - \pi _i)\frac{\partial }{{\partial \pi }}{\mathrm{ln}}f_{\mathrm{ZINB}}(y_i;\mu _i,\theta _i,\pi _i).} \hfill \end{array}$$\end{document}</tex-math><mml:math id="M194" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mo>∀</mml:mo><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>π</mml:mi></mml:mrow></mml:mfrac><mml:mi mathvariant="normal">ln</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ZINB</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ46.gif" position="anchor"/></alternatives></disp-formula></p>
    </sec>
    <sec id="Sec15">
      <title>Simulated data sets</title>
      <p id="Par102">Simulating from the ZINB-WaVE model: In order to simulate realistic data, we fitted our ZINB-WaVE model to two real data sets (V1 and S1/CA1) and used the resulting parameter estimates as the truth to be estimated in the simulation. Genes that did not have at least five reads in at least five cells were filtered out and <italic>J</italic> = 1000 genes were then sampled at random for each data set. The ZINB-WaVE model was fit to the count matrix <bold><italic>Y</italic></bold> with the number of unknown cell-level covariates set to <bold><italic>K</italic></bold> = <bold>2</bold>, genewise dispersion (<italic>ζ</italic> = ln<italic>θ</italic> = −ln<italic>ϕ</italic>), <bold><italic>X</italic></bold><sub><bold><italic>μ</italic></bold></sub>, <bold><italic>X</italic></bold><sub><bold><italic>π</italic></bold></sub>, <bold><italic>V</italic></bold><sub><bold><italic>μ</italic></bold></sub>, and <bold><italic>V</italic></bold><sub><bold><italic>π</italic></bold></sub> as columns of ones (i.e., intercept only), and no offset matrices, to get estimates for <bold><italic>W</italic></bold>, <bold><italic>α</italic></bold><sub><bold><italic>μ</italic></bold></sub>, <bold><italic>α</italic></bold><sub><bold><italic>π</italic></bold></sub>, <bold><italic>β</italic></bold><sub><bold><italic>μ</italic></bold></sub>, <bold><italic>β</italic></bold><sub><bold><italic>π</italic></bold></sub>, <bold><italic>γ</italic></bold><sub><bold><italic>μ</italic></bold></sub>, <bold><italic>γ</italic></bold><sub><bold><italic>π</italic></bold></sub>, and <bold><italic>ζ</italic></bold>. The parameters which were varied in the simulations are the number of cells, the proportion of zero counts, and the ratio of within to between-cluster sums of squares for <bold><italic>W</italic></bold>. Details on the parameter choices follow.</p>
      <p id="Par103">The number of cells was set to <italic>n</italic> = 100; 1000; 10,000.</p>
      <p id="Par104">The proportion of zero counts, <inline-formula id="IEq52"><alternatives><tex-math id="M195">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$zfrac = \mathop {\sum }\limits_{i,j} 1(Y_{ij} = 0){\mathrm{/}}nJ$$\end{document}</tex-math><mml:math id="M196"><mml:mi>z</mml:mi><mml:mi>f</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi mathvariant="normal">∕</mml:mi><mml:mi>n</mml:mi><mml:mi>J</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq52.gif"/></alternatives></inline-formula>, was set via the parameter <italic>γ</italic><sub><italic>π</italic></sub>: <italic>zfrac</italic> ≈ 0.25, 0.50, 0.75. As logit(<italic>π</italic>) = <italic>Xβ</italic><sub><italic>π</italic></sub> + (<italic>Vγ</italic><sub><italic>π</italic></sub>)<sup><italic>T</italic></sup> + <italic>Wα</italic><sub><italic>π</italic></sub>, the value of <italic>γ</italic><sub><italic>π</italic></sub> is directly linked to the dropout probability <italic>π</italic>, thus to the zero fraction. Note that by changing only <italic>γ</italic><sub><italic>π</italic></sub> but not <italic>γ</italic><sub><italic>μ</italic></sub>, we change the dropout rate but not the underlying, unobserved mean expression, i.e., this varies the number of <italic>technical</italic> zeros but not <italic>biological</italic> zeros.</p>
      <p id="Par105">The ratio of within to between-cluster sums of squares for <italic>W</italic> was set in the following way. Let <italic>C</italic> denote the number of clusters and <italic>n</italic><sub><italic>c</italic></sub> the number of cells in cluster <italic>c</italic>. For a given column of <italic>W</italic> (out of <italic>K</italic> columns), let <italic>W</italic><sub><italic>ic</italic></sub> denote the value for cell <italic>i</italic> in cluster <italic>c</italic>, <inline-formula id="IEq53"><alternatives><tex-math id="M197">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar W$$\end{document}</tex-math><mml:math id="M198"><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq53.gif"/></alternatives></inline-formula> the overall average across all <italic>n</italic> cells, <inline-formula id="IEq54"><alternatives><tex-math id="M199">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar W_c$$\end{document}</tex-math><mml:math id="M200"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq54.gif"/></alternatives></inline-formula> the average for cells in cluster <italic>c</italic>, and TSS the total sum of squares. Then,<disp-formula id="Equ47"><alternatives><tex-math id="M201">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{r}} {\mathrm{TSS}} &amp; = {\mathop {\sum }\limits_{c = 1}^C \mathop {\sum }\limits_{i = 1}^{n_c} \left( {W_{ic} - \bar W} \right)^2}\\ &amp; = {\mathop {\sum }\limits_{c = 1}^C \mathop {\sum }\limits_{i = 1}^{n_c} \left( {W_{ic} - \bar W_c} \right)^2 + \mathop {\sum }\limits_{c = 1}^C n_c\left( {\bar W_c - \bar W} \right)^2}\\ &amp; = {\mathrm{WSS} + \mathrm{BSS},}\end{array}$$\end{document}</tex-math><mml:math id="M202" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi mathvariant="normal">TSS</mml:mi></mml:mtd><mml:mtd columnalign="right"><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"/><mml:mtd columnalign="right"><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"/><mml:mtd columnalign="right"><mml:mo>=</mml:mo><mml:mi mathvariant="normal">WSS</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">BSS</mml:mi><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ47.gif" position="anchor"/></alternatives></disp-formula>with <inline-formula id="IEq55"><alternatives><tex-math id="M203">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrm{WSS} = \mathop {\sum }\nolimits_{c = 1}^C \mathop {\sum }\nolimits_{i = 1}^{n_c} \left( {W_{ic} - \bar W_c} \right)^2$$\end{document}</tex-math><mml:math id="M204"><mml:mi mathvariant="normal">WSS</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq55.gif"/></alternatives></inline-formula> and <inline-formula id="IEq56"><alternatives><tex-math id="M205">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrm{BSS} = \mathop {\sum }\nolimits_{c = 1}^C n_c\left( {\bar W_c - \bar W} \right)^2$$\end{document}</tex-math><mml:math id="M206"><mml:mi mathvariant="normal">BSS</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq56.gif"/></alternatives></inline-formula> the within and between-cluster sums of squares, respectively. The level of difficulty of the clustering problem can be controlled by the ratio of within to between-cluster sums of squares. However, we want to keep the overall mean <inline-formula id="IEq57"><alternatives><tex-math id="M207">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar W$$\end{document}</tex-math><mml:math id="M208"><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq57.gif"/></alternatives></inline-formula> and overall variance (i.e., TSS) constant, so that the simulated values of <italic>W</italic> stay in the same range as the estimated <italic>W</italic> from the real data set; this prevents us from simulating an unrealistic count matrix <italic>Y</italic>.</p>
      <p id="Par106">Let us scale the between-cluster sum of squares by <italic>a</italic><sup>2</sup> and the within-cluster sum of squares by <italic>a</italic><sup>2</sup><italic>b</italic><sup>2</sup>, i.e., replace <inline-formula id="IEq58"><alternatives><tex-math id="M209">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\bar W_c - \bar W} \right)$$\end{document}</tex-math><mml:math id="M210"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq58.gif"/></alternatives></inline-formula> by <inline-formula id="IEq59"><alternatives><tex-math id="M211">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a\left( {\bar W_c - \bar W} \right)$$\end{document}</tex-math><mml:math id="M212"><mml:mi>a</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq59.gif"/></alternatives></inline-formula> and <inline-formula id="IEq60"><alternatives><tex-math id="M213">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {W_{ic} - \bar W_c} \right)$$\end{document}</tex-math><mml:math id="M214"><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq60.gif"/></alternatives></inline-formula> by <inline-formula id="IEq61"><alternatives><tex-math id="M215">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ab\left( {W_{ic} - \bar W_c} \right)$$\end{document}</tex-math><mml:math id="M216"><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq61.gif"/></alternatives></inline-formula>, with <italic>a</italic> ≥ 0 and <italic>b</italic> ≥ 0 such that <italic>TSS</italic> and <inline-formula id="IEq62"><alternatives><tex-math id="M217">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar W$$\end{document}</tex-math><mml:math id="M218"><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq62.gif"/></alternatives></inline-formula> are constant. The total sum of squares <italic>TSS</italic> remains constant, i.e.,<disp-formula id="Equ48"><alternatives><tex-math id="M219">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrm{TSS} = a^2b^2\mathrm{WSS} + a^2\mathrm{BSS},$$\end{document}</tex-math><mml:math id="M220" display="block"><mml:mi mathvariant="normal">TSS</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="normal">WSS</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="normal">BSS</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ48.gif" position="anchor"/></alternatives></disp-formula>provided<disp-formula id="Equ49"><alternatives><tex-math id="M221">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a^2 = \frac{{\mathrm{TSS}}}{{b^2\mathrm{WSS} + \mathrm{BSS}}}.$$\end{document}</tex-math><mml:math id="M222" display="block"><mml:msup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">TSS</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi mathvariant="normal">WSS</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">BSS</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ49.gif" position="anchor"/></alternatives></disp-formula>Requiring the overall mean <inline-formula id="IEq63"><alternatives><tex-math id="M223">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar W$$\end{document}</tex-math><mml:math id="M224"><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq63.gif"/></alternatives></inline-formula> to remain constant implies that<disp-formula id="Equ50"><alternatives><tex-math id="M225">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\bar W_c^ \ast = (1 - a)\bar W + a\bar W_c,$$\end{document}</tex-math><mml:math id="M226" display="block"><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ50.gif" position="anchor"/></alternatives></disp-formula>where the * superscript refers to the transformed <italic>W</italic>. Thus,<disp-formula id="Equ51"><label>11</label><alternatives><tex-math id="M227">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{r}} \hfill {W_{ic}^ \ast } = {\bar W_c^ \ast + ab\left( {W_{ic} - \bar W_c} \right)}\\ = {(1 - a)\bar W + a\bar W_c + ab\left( {W_{ic} - \bar W_c} \right)}\\ = {(1 - a)\bar W + a(1 - b)\bar W_c + abW_{ic}.}\end{array}$$\end{document}</tex-math><mml:math id="M228" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:msubsup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ51.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par107">The above transformation results in a scaling of the ratio of within to between-cluster sums of squares by <italic>b</italic><sup>2</sup>, while keeping the overall mean and variance constant.</p>
      <p id="Par108">In our simulations, we fixed <italic>C</italic> = 3 clusters and considered three values for <italic>b</italic><sup>2</sup>, where the same value of <italic>b</italic><sup>2</sup> is applied to each of the <italic>K</italic> columns of <italic>W</italic>: <italic>b</italic><sup>2</sup> = 1, corresponding to the case where the within and between-cluster sums of squares are the same as the ones of the fitted <italic>W</italic> from the real data set; <italic>b</italic><sup>2</sup> = 5, corresponding to a larger ratio of within to between-cluster sums of squares and hence a harder clustering problem; <italic>b</italic><sup>2</sup> = 10, corresponding to a very large ratio of within to between-cluster sums of squares and hence almost no clustering.</p>
      <p id="Par109">Overall, 2 (real data sets)) × 3 (<italic>n</italic>) × 3 (zfrac)) × 3 (clustering) = 54 scenarios were considered in the simulation.</p>
      <p id="Par110">For each of the 54 scenarios, we simulated <italic>B</italic> = 10 data sets, resulting in a total of 54 × 10 = 540 data sets. Using the fitted <italic>W</italic>, <italic>α</italic><sub><italic>μ</italic></sub>, <italic>α</italic><sub><italic>π</italic></sub>, <italic>β</italic><sub><italic>μ</italic></sub>, <italic>β</italic><sub><italic>π</italic></sub>, <italic>γ</italic><sub><italic>μ</italic></sub>, <italic>γ</italic><sub><italic>π</italic></sub>, and <italic>ζ</italic> from one of the two real data sets, the data sets were simulated according to the following steps.<list list-type="order"><list-item><p id="Par111">Simulate <italic>W</italic> with desired clustering strength. First fit a <italic>K</italic>-variate Gaussian mixture distribution to <italic>W</italic> inferred from one of the real data sets using the R function Mclust from the mclust package and specifying the number of clusters <italic>C</italic>. Then, for each of <italic>B</italic> = 10 data sets, simulate <italic>W</italic> cluster by cluster from <italic>K</italic>-variate Gaussian distributions using the mvrnorm function from the MASS package, with the cluster means, covariance matrices, and frequencies output by Mclust. Transform <italic>W</italic> as in Eq. (<xref rid="Equ51" ref-type="">11</xref>) to get the desired ratio of within to between-cluster sums of squares.</p></list-item><list-item><p id="Par112">Simulate <italic>γ</italic><sub><italic>μ</italic></sub> and <italic>γ</italic><sub><italic>π</italic></sub> to get the desired zero fraction. We only considered cell-level intercept <italic>n</italic>-vectors <italic>γ</italic><sub><italic>μ</italic></sub> and <italic>γ</italic><sub><italic>π</italic></sub>, i.e., <italic>L</italic> = 1 and a matrix <italic>V</italic> of gene-level covariates consisting of a single column of ones. As the fitted <italic>γ</italic><sub><italic>μ</italic></sub> and <italic>γ</italic><sub><italic>π</italic></sub> from the original data sets are correlated <italic>n</italic>-vectors, fit a bivariate Gaussian distribution to <italic>γ</italic><sub><italic>μ</italic></sub> and <italic>γ</italic><sub><italic>π</italic></sub> using the function Mclust from the mclust package with <italic>C</italic> = 1 cluster. Then, for each of <italic>B</italic> = 10 data sets, simulate <italic>γ</italic><sub><italic>μ</italic></sub> and <italic>γ</italic><sub><italic>π</italic></sub> from a bivariate Gaussian distribution using the mvrnorm function from the MASS package, with the mean and covariance matrix output by Mclust. To increase/decrease the zero fraction, increase/decrease each element of the mean vector for <italic>γ</italic><sub><italic>π</italic></sub> inferred from Mclust (shifts of {0,2,5} for V1 data set and {−1.5, 0.5, 2} for S1/CA1 data set).</p></list-item><list-item><p id="Par113">Create the ZINB-WaVE model using the function zinbModel from the package zinbwave.</p></list-item><list-item><p id="Par114">Simulate counts using the function zinbSim from the package zinbwave.</p></list-item></list></p>
      <p id="Par115">Simulating from the Lun &amp; Marioni<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> model: To simulate data sets from a different model than our ZINB-WaVE model, we simulated counts using the procedure described in Lun &amp; Marioni<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> (details in Supplementary Materials of original publication and code available from the Github repository <ext-link ext-link-type="uri" xlink:href="https://github.com/MarioniLab/PlateEffects2016">https://github.com/MarioniLab/PlateEffects2016</ext-link>). Although the Lun &amp; Marioni<sup><xref ref-type="bibr" rid="CR42">42</xref></sup> model is also based on a ZINB distribution, the distribution is parameterized differently and also fit differently, gene by gene. In particular, the negative binomial mean is parameterized as a product of the expression level of interest and two nuisance technical effects, a gene-level effect assumed to have a log-normal distribution and a cell-level effect (cf. library size) whose distribution is empirically derived. The zero-inflation probability is assumed to be constant across cells for each gene and is estimated independently of the negative binomial mean. The ZINB distribution is fit gene by gene using the zeroinfl function from the R package pscl. We used the raw gene-level read counts for the mESC data set as input to the script reference/submitter.sh, to create a simulation function constructed by fitting a ZINB distribution to these counts. The script simulations/submitter.sh was then run to simulate counts based on the estimated parameters (negative binomial mean, zero inflation probability, and genewise dispersion parameter). We simulated <italic>C</italic> = 3 clusters with equal number of cells per cluster. The parameters which were varied in the simulations are as follows.</p>
      <p id="Par116">The number of cells was set to <italic>n</italic> = 100; 1000; 10,000.</p>
      <p id="Par117">The proportion of zero counts, <inline-formula id="IEq64"><alternatives><tex-math id="M229">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrm{zfrac} = \mathop {\sum }\nolimits_{i,j} 1(Y_{ij} = 0){\mathrm{/}}nJ$$\end{document}</tex-math><mml:math id="M230"><mml:mi mathvariant="normal">zfrac</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi mathvariant="normal">∕</mml:mi><mml:mi>n</mml:mi><mml:mi>J</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq64.gif"/></alternatives></inline-formula>, was set via the zero inflation probability: zfrac ≈ 0.4, 0.6, 0.8. For zfrac = 0.4, we did not modify the code in Lun &amp; Marioni<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. However, to simulate data sets with greater zero fractions, namely zfrac = 0.6 and zfrac = 0.8, we added respectively 0.3 and 0.6 to the zero-inflation probability (<inline-formula id="IEq65"><alternatives><tex-math id="M231">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_i^\prime$$\end{document}</tex-math><mml:math id="M232"><mml:msubsup><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq65.gif"/></alternatives></inline-formula>, in their notation).</p>
      <p id="Par118">For each of the 3 (<italic>n</italic>)) × 3 (zfrac) = 9 scenarios, we simulated <italic>B</italic> (<italic>B</italic> = 10) data sets, resulting in 9) × 10 = 90 simulated data sets in total.</p>
    </sec>
    <sec id="Sec16">
      <title>Dimensionality reduction methods</title>
      <p id="Par119">Three different dimensionality reduction methods were applied to the real and simulated data sets: ZINB-WaVE, zero-inflated factor analysis, and PCA. For all the methods, we selected <italic>K</italic> = 2 dimensions, unless specified otherwise. A notable exception is the S1/CA1 data set, for which, given the large number of cells and the complexity of the signal, we specified <italic>K</italic> = 3 dimensions.</p>
      <p id="Par120">ZINB-WaVE: We applied the ZINB-WaVE procedure using the function zinbFit from our R package zinbwave, with the following parameter choices. Number of unknown cell-level covariates <italic>K</italic>: <italic>K</italic> = 1, 2, 3, 4. Gene-level covariate matrix <italic>V</italic>: not included or set to a column of ones 1<sub><italic>J</italic></sub>. Cell-level covariate matrix <italic>X</italic>: set to a column of ones 1<sub><italic>n</italic></sub>. For the mESC data set, we also considered including batch covariates in <italic>X</italic>. Dispersion parameter <italic>ζ</italic>: the same for all genes (common dispersion) or specific to each gene (genewise dispersion).</p>
      <p id="Par121">Zero-inflated factor analysis: We used the zero-inflated factor analysis (ZIFA) method<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, as implemented in the ZIFA python package (Version 0.1) available at <ext-link ext-link-type="uri" xlink:href="https://github.com/epierson9/ZIFA">https://github.com/epierson9/ZIFA</ext-link>, with the block algorithm (function block_ZIFA.fitModel, with default parameters). The output of ZIFA is an <italic>n</italic> × <italic>K</italic> matrix corresponding to a projection of the counts onto a latent low-dimensional space of dimension <italic>K</italic>.</p>
      <p id="Par122">PCA: We used the function prcomp from the R package stats for the simulation study and, for computational efficiency, the function jsvds from the R package rARPACK for the real data sets.</p>
    </sec>
    <sec id="Sec17">
      <title>Normalization methods</title>
      <p id="Par123">As normalization is essential, especially for zero-inflated distributions, PCA and ZIFA were applied to both raw and normalized counts. The following normalization methods were used.</p>
      <p id="Par124">Total count normalization (TC): Counts are divided by the total number of reads sequenced for each sample and multiplied by the mean total count across all the samples. This method is related to the popular transcripts per million (TPM)<sup><xref ref-type="bibr" rid="CR52">52</xref></sup> and fragments per kilobase million (FPKM)<sup><xref ref-type="bibr" rid="CR53">53</xref></sup> methods.</p>
      <p id="Par125">Full-quantile normalization (FQ)<sup><xref ref-type="bibr" rid="CR54">54</xref></sup><italic>:</italic> The quantiles of the distributions of the gene-level read counts are matched across samples. We used the function between Lane Normalization from the Bioconductor R package EDASeq.</p>
      <p id="Par126">Trimmed mean of M values (TMM)<sup><xref ref-type="bibr" rid="CR55">55</xref></sup><italic>:</italic> The TMM global-scaling factor is computed as the weighted mean of log-ratios between each sample and a reference sample. If the majority of the genes are not differentially expressed (DE), TMM should be close to 1, otherwise, it provides an estimate of the correction factor that must be applied in order to fulfill this hypothesis. We used the function calcNormFactors from the Bioconductor R package edgeR to compute these scaling factors.</p>
    </sec>
    <sec id="Sec18">
      <title>Clustering methods</title>
      <p id="Par127">Clustering of the OE data set: We used the resampling-based sequential ensemble clustering (RSEC) framework implemented in the RSEC function from the Bioconductor R package clusterExperiment<sup><xref ref-type="bibr" rid="CR56">56</xref></sup>. Briefly, RSEC implements a consensus clustering algorithm which generates and aggregates a collection of clusterings, based on resampling cells and using a sequential tight clustering algorithm<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>. See Fletcher et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> for details on the parameters used for RSEC in the original analysis and Perraudeau et al.<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> for details on the parameters used for RSEC in the ZINB-WaVE workflow.</p>
      <p id="Par128">Clustering of the 10× Genomics 68k PBMCs data set: We used two different clustering methods to assess the ability of ZINB-WaVE to extract biologically meaningful signal from the data.</p>
      <p id="Par129">First, we used a a clustering procedure similar to the one implemented in the R package Seurat<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Version 2.0.1). In particular, we used ZINB-WaVE (<italic>K</italic> = 10) instead of PCA for dimensionality reduction. The clustering is based on shared nearest neighbor modularity<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. We used the following parameters: k.param=10, k.scale=10, resolution=0.6. All the other parameters were left at their default values.</p>
      <p id="Par130">We also clustered the data using a sequential <italic>k</italic>-means clustering approach<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>, implemented in the clusterSingle function of the clusterExperiment package<sup><xref ref-type="bibr" rid="CR56">56</xref></sup>. We used the following parameters: sequential=TRUE, subsample=FALSE, k0=15, beta=0.95, clusterFunction="kmeans".</p>
    </sec>
    <sec id="Sec19">
      <title>Models for count data</title>
      <p id="Par131">We compared the goodness-of-fit of our ZINB-WaVE model to that of two other models for count data: a standard negative binomial model, that does not account for zero inflation, and the MAST hurdle model, that is specifically designed for scRNA-seq data<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>.</p>
      <p id="Par132">Goodness-of-fit was assessed on the V1 data set using mean-difference plots (MD-plots) of estimated vs. observed mean count and zero probability, as well as plots of the estimated dispersion parameter against the observed zero frequency.</p>
      <p id="Par133">ZINB-WaVE model: For our ZINB-WaVE model, the overall mean and zero probability are<disp-formula id="Equ52"><alternatives><tex-math id="M233">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{r}} \hfill {E[Y_{ij}]} = {\left( {1 - \pi _{ij}} \right)\mu _{ij},}\\ \hfill {P\left( {Y_{ij} = 0} \right)} = {\pi _{ij} + \left( {1 - \pi _{ij}} \right)\left( {1 + \phi _j\mu _{ij}} \right)^{\frac{1}{{\phi _j}}}.}\end{array}$$\end{document}</tex-math><mml:math id="M234" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ52.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par134">ZINB-WaVE was fit to the V1 data set using the function zinbFit from our R package zinbwave, with the following parameter choices: <italic>K</italic> = 0 unknown cell-level covariates, gene-level intercept (<italic>X</italic> = <bold>1</bold><sub><italic>n</italic></sub>), cell-level intercept (<italic>V</italic> = <bold>1</bold><sub><italic>J</italic></sub>), and genewise dispersion.</p>
      <p id="Par135">Negative binomial model: The negative binomial (NB) distribution is a special case of the ZINB distribution that does not account for zero inflation, i.e., for which <italic>π</italic> = 0. Thus,<disp-formula id="Equ53"><alternatives><tex-math id="M235">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{r}} \hfill {E[Y_{ij}]} &amp; \hfill = &amp; \hfill {\mu _{ij},}\\ \hfill {P\left( {Y_{ij} = 0} \right)} &amp; \hfill = &amp; \hfill {\left( {1 + \phi _j\mu _{ij}} \right)^{\frac{1}{{\phi _j}}}.}\end{array}$$\end{document}</tex-math><mml:math id="M236" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="right"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="right"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:mtd><mml:mtd columnalign="right"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="right"><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ53.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par136">A NB distribution was fit gene by gene to the V1 data set, after full-quantile normalization, using the Bioconductor R package edgeR<sup><xref ref-type="bibr" rid="CR41">41</xref></sup> (Version 3.16.5) with only an intercept (i.e., default value for the design argument as a single column of ones) and genewise dispersion.</p>
      <p id="Par137">Model-based analysis of single-cell transcriptomics: The model-based analysis of single-cell transcriptomics (MAST) hurdle model proposed by Finak et al.<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> is defined as follows:<disp-formula id="Equ54"><alternatives><tex-math id="M237">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{r}} \hfill {{\mathrm{logit}}(P(Z_{ij} = 1))} &amp; \hfill = &amp; \hfill {X_i\beta _j^D,}\\ \hfill {Y_{ij}|Z_{ij} = 1} &amp; \hfill \sim &amp; \hfill {{\cal N}\left( {X_i\beta _j^C,\sigma _j^2} \right),}\end{array}$$\end{document}</tex-math><mml:math id="M238" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi mathvariant="normal">logit</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="right"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="right"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="right"><mml:mo>~</mml:mo></mml:mtd><mml:mtd columnalign="right"><mml:mi mathvariant="script">N</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ54.gif" position="anchor"/></alternatives></disp-formula>where <italic>Y</italic><sub><italic>ij</italic></sub> is log2(TPM +1) for cell <italic>i</italic> and gene <italic>j</italic>, <inline-formula id="IEq66"><alternatives><tex-math id="M239">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$X_i \in {\Bbb R}^k$$\end{document}</tex-math><mml:math id="M240"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq66.gif"/></alternatives></inline-formula> is a known covariate vector, and <italic>Z</italic><sub><italic>ij</italic></sub> indicates whether gene <italic>j</italic> is truly expressed in cell <italic>i</italic>. For each gene <italic>j</italic>, the parameters of the MAST model are: the regression coefficients <inline-formula id="IEq67"><alternatives><tex-math id="M241">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _j^D \in {\Bbb R}^k$$\end{document}</tex-math><mml:math id="M242"><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq67.gif"/></alternatives></inline-formula> for the discrete part and the regression coefficients <inline-formula id="IEq68"><alternatives><tex-math id="M243">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\beta _j^C \in {\Bbb R}^k$$\end{document}</tex-math><mml:math id="M244"><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq68.gif"/></alternatives></inline-formula> and variance <inline-formula id="IEq69"><alternatives><tex-math id="M245">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma _j^2 \in {\Bbb R}$$\end{document}</tex-math><mml:math id="M246"><mml:msubsup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">R</mml:mi></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq69.gif"/></alternatives></inline-formula> for the Gaussian continuous part. Note that we follow the notation in Finak et al.<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>, which is different from that in the ZINB-WaVE model of Eq. (<xref rid="Equ4" ref-type="">4</xref>).</p>
      <p id="Par138">For the MAST model, the overall mean and zero probability are<disp-formula id="Equ55"><alternatives><tex-math id="M247">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{*{20}{r}} \hfill {E[Y_{ij}]} &amp; \hfill = &amp; \hfill {{\mathrm{logit}}^{ - 1}\left( {X_i\beta _j^D} \right)X_i\beta _j^C,}\\ \hfill {P\left( {Y_{ij} = 0} \right)} &amp; \hfill = &amp; \hfill {1 - {\mathrm{logit}}^{ - 1}\left( {X_i\beta _j^D} \right).}\end{array}$$\end{document}</tex-math><mml:math id="M248" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="right"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="right"><mml:msup><mml:mrow><mml:mi mathvariant="normal">logit</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mi>P</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:mtd><mml:mtd columnalign="right"><mml:mo>=</mml:mo></mml:mtd><mml:mtd columnalign="right"><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">logit</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ55.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par139">MAST is implemented in the Bioconductor R package MAST<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> (which allows different covariate vectors <italic>X</italic><sub><italic>i</italic></sub> for the continuous and discrete components). We use the function zlm to fit MAST with an intercept and a covariate for the cellular detection rate (as recommended in the MAST vignette for the MAIT data analysis) for both the discrete and continuous parts.</p>
      <p id="Par140">Note that in contrast to the NB and ZINB models, the MAST hurdle model is for log2(TPM+1) instead of counts and has no dispersion parameter. To be able to compare the fits of the three models, the MAST goodness-of-fit plots display estimated vs. observed mean log2(TPM+1) and estimated variance <inline-formula id="IEq70"><alternatives><tex-math id="M249">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma _j^2$$\end{document}</tex-math><mml:math id="M250"><mml:msubsup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq70.gif"/></alternatives></inline-formula> vs. observed zero frequency (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21</xref>). Although not a direct comparison, we think this allows a fair assessment of the goodness-of-fit of the different models.</p>
    </sec>
    <sec id="Sec20">
      <title>Evaluation criteria</title>
      <p id="Par141">Clustering: Silhouette width: Given a set of labels for the cells (e.g., biological condition, batch), silhouette widths provide a measure of goodness of the clustering of the cells with respect to these labels. Silhouette widths may be averaged within clusters or across all observations to assess clustering strength at the level of clusters or overall, respectively. The silhouette width <italic>s</italic><sub><italic>i</italic></sub> of a sample <italic>i</italic> is defined as follows:<disp-formula id="Equ56"><alternatives><tex-math id="M251">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$s_i = \frac{{b_i - a_i}}{{{\mathrm{max}}\left\{ {a_i,b_i} \right\}}},$$\end{document}</tex-math><mml:math id="M252" display="block"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi><mml:mfenced close="}" open="{" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ56.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq71"><alternatives><tex-math id="M253">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$a_i = d\left( {i,{\cal C}_{cl(i)}} \right)$$\end{document}</tex-math><mml:math id="M254"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>d</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq71.gif"/></alternatives></inline-formula>, <inline-formula id="IEq72"><alternatives><tex-math id="M255">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$b_i = {\mathrm{min}}_{l \ne cl(i)}d\left( {i,{\cal C}_l} \right)$$\end{document}</tex-math><mml:math id="M256"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>≠</mml:mo><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq72.gif"/></alternatives></inline-formula>, <inline-formula id="IEq73"><alternatives><tex-math id="M257">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\cal C}_{cl(i)}$$\end{document}</tex-math><mml:math id="M258"><mml:msub><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq73.gif"/></alternatives></inline-formula> is the cluster to which <italic>i</italic> belongs, and <inline-formula id="IEq74"><alternatives><tex-math id="M259">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d(i,{\cal C}_l)$$\end{document}</tex-math><mml:math id="M260"><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq74.gif"/></alternatives></inline-formula> is the average distance between sample <italic>i</italic> and the samples in cluster <inline-formula id="IEq75"><alternatives><tex-math id="M261">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\cal C}_l$$\end{document}</tex-math><mml:math id="M262"><mml:msub><mml:mrow><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq75.gif"/></alternatives></inline-formula>.</p>
      <p id="Par142">Average silhouette widths were used to compare ZINB-WaVE, PCA, and ZIFA on both real and simulated data sets. For simulated data, the cluster labels correspond to the true simulated <italic>W</italic> and, for each scenario, silhouette widths were computed and averaged over <italic>B</italic> data sets. For real data, the authors’ cluster labels or known cell types were used.</p>
      <p id="Par143">Clustering: Precision and recall: Two different clusterings (i.e., partitions) may be compared quantitatively using the precision and recall coefficients. These measures involve assessing whether pairs of cells cluster together in each of the two clusterings.  Let YY (respectively NY; YN; and NN) be the total number of pairs of cells which are in the same cluster in both Clustering 1 and Clustering 2 (respectively, in different clusters in Clustering 1 but in the same cluster in Clustering 2; in the same cluster in Clustering 1 but in different clusters in Clustering 2; in different clusters in both Clustering 1 and Clustering 2). Then, using Clustering 1 as a reference, the precision coefficient is defined as the proportion of cells clustered together in Clustering 2 which are also (correctly) clustered together in Clustering 1<disp-formula id="Equ57"><alternatives><tex-math id="M263">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrm{Precision} = \frac{{YY}}{{YY + NY}}.$$\end{document}</tex-math><mml:math id="M264" display="block"><mml:mi mathvariant="normal">Precision</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>Y</mml:mi><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi><mml:mi>Y</mml:mi><mml:mo>+</mml:mo><mml:mi>N</mml:mi><mml:mi>Y</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ57.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par145">Similarly, the recall coefficient is defined as the proportion of cells (correctly) clustered together in Clustering 1 which are also clustered together in Clustering 2<disp-formula id="Equ58"><alternatives><tex-math id="M265">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrm{Recall} = \frac{{YY}}{{YY + YN}}.$$\end{document}</tex-math><mml:math id="M266" display="block"><mml:mi mathvariant="normal">Recall</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>Y</mml:mi><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>Y</mml:mi><mml:mi>Y</mml:mi><mml:mo>+</mml:mo><mml:mi>Y</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ58.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par146">Precision and recall were used to compare ZINB-WaVE, PCA, and ZIFA on simulated data sets, where the reference Clustering 1 corresponds to the true simulated labels and Clustering 2 was performed using the R function kmeans in the reduced-dimensional space: the first two columns of <italic>W</italic> for ZINB-WaVE, the first two principal components for PCA, and the first two latent variables for ZIFA. We simulated 3 clusters and set the number of clusters equal to 3 in kmeans (argument centers). Precision and recall were computed using the extCriteria function from the R package clusterCrit<sup><xref ref-type="bibr" rid="CR59">59</xref></sup>.</p>
      <p id="Par147">Dimensionality reduction: Correlation with QC measures: To evaluate the dependence of the inferred low-dimensional signal on unwanted variation, we computed the absolute correlation between each dimension (e.g., principal component) and a set of quality control (QC) measures.</p>
      <p id="Par148">For the V1 data set, FastQC (<ext-link ext-link-type="uri" xlink:href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/">http://www.bioinformatics.babraham.ac.uk/projects/fastqc/</ext-link>) and Picard tools (<ext-link ext-link-type="uri" xlink:href="https://broadinstitute.github.io/picard/">https://broadinstitute.github.io/picard/</ext-link>) were used to compute a set of 16 QC measures. These measures are available as part of the Bioconductor R package scRNAseq (<ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/scRNAseq">https://bioconductor.org/packages/scRNAseq</ext-link>). For the glioblastoma and mESC data sets, we used the scater Bioconductor R package<sup><xref ref-type="bibr" rid="CR60">60</xref></sup> (Version 1.2.0) to compute a set of 7 QC measures. For the S1/CA1 data set, we used a set of 6 QC measures provided by the authors (<ext-link ext-link-type="uri" xlink:href="http://linnarssonlab.org/cortex/">http://linnarssonlab.org/cortex/</ext-link>).</p>
      <p id="Par149">Dimensionality reduction: Correlation of pairwise distances between observations: For simulated data, we assessed different dimensionality reduction methods (ZINB-WaVE, PCA, and ZIFA) in terms of the correlation between pairwise distances between observations in the true and in the estimated reduced-dimensional space. In particular, we monitored the influence of the number of unknown cell-level covariates <italic>K</italic> when the other parameters are set correctly (<italic>V</italic> is a column of ones <bold>1</bold><sub><italic>J</italic></sub> and genewise dispersion). For each simulation scenario, the correlation between true and estimated pairwise distances was computed and averaged over <italic>B</italic> data sets.</p>
      <p id="Par150">Bias and MSE of the ZINB-WaVE estimators: For data simulated from the ZINB-WaVE model, let <italic>θ</italic> and <inline-formula id="IEq76"><alternatives><tex-math id="M267">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \theta _b$$\end{document}</tex-math><mml:math id="M268"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq76.gif"/></alternatives></inline-formula>, <italic>b</italic> = 1,…, <italic>B</italic>, respectively denote the true parameter and an estimator of this parameter for the <italic>b</italic>th simulated data set. Then, for each scenario, the performance of the estimator <inline-formula id="IEq77"><alternatives><tex-math id="M269">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat \theta$$\end{document}</tex-math><mml:math id="M270"><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq77.gif"/></alternatives></inline-formula> can be assessed in terms of bias and mean squared error (MSE) as follows:<disp-formula id="Equ59"><alternatives><tex-math id="M271">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{l}{\mathrm{Bias}} = \frac{1}{B}\mathop {\sum }\limits_{b = 1}^B \left( {\hat \theta _b - \theta } \right),\\ {\mathrm{MSE}} = \frac{1}{B}\mathop {\sum }\limits_{b = 1}^B \left( {\hat \theta _b - \theta } \right)^2.\end{array}$$\end{document}</tex-math><mml:math id="M272" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">Bias</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:munderover><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">MSE</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:mfrac><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo> ∑</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ59.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par151">Bias and MSE were computed for <italic>β</italic><sub><italic>μ</italic></sub>, <italic>β</italic><sub><italic>π</italic></sub>, <italic>γ</italic><sub><italic>μ</italic></sub>, <italic>γ</italic><sub><italic>π</italic></sub>, <italic>ζ</italic>, <italic>Wα</italic><sub><italic>μ</italic></sub>, <italic>Wα</italic><sub><italic>π</italic></sub>, ln(<italic>μ</italic>), and logit(<italic>π</italic>). When the parameter to be estimated was an <italic>n</italic> × <italic>J</italic> matrix, the matrix was converted to a 1 × <italic>nJ</italic> row vector and bias and MSE were averaged over the elements of the vector.</p>
      <p id="Par152">Model selection for ZINB-WaVE: The Akaike information criterion (AIC) and the Bayesian information criterion (BIC) are widely used for model selection and are defined as follows:<disp-formula id="Equ60"><alternatives><tex-math id="M273">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{l}\mathrm{AIC} = 2N - 2\ell \left( {\widehat \beta ,\widehat \gamma ,\widehat W,\widehat \alpha ,\widehat \zeta } \right),\\ \mathrm{BIC} = {\mathrm{ln}}(n)N - 2\ell (\widehat \beta ,\widehat \gamma ,\widehat W,\widehat \alpha ,\widehat \zeta ),\end{array}$$\end{document}</tex-math><mml:math id="M274" display="block"><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">AIC</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:mi>ℓ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="normal">BIC</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:mi>ℓ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41467_2017_2554_Article_Equ60.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par153">where <inline-formula id="IEq78"><alternatives><tex-math id="M275">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\ell \left( {\hat \beta ,\hat \gamma ,\hat W,\hat \alpha ,\hat \zeta } \right)$$\end{document}</tex-math><mml:math id="M276"><mml:mi>ℓ</mml:mi><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>Ŵ</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>ζ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41467_2017_2554_Article_IEq78.gif"/></alternatives></inline-formula> is the log-likelihood function evaluated at the MLE (Eq. (<xref rid="Equ6" ref-type="">5</xref>)), <italic>n</italic> is the sample size, and <italic>N</italic> is the total number of estimated parameters, i.e., <italic>N</italic> = <italic>J</italic>(<italic>M</italic><sub><italic>μ</italic></sub> + <italic>M</italic><sub><italic>π</italic></sub>) + <italic>n</italic>(<italic>L</italic><sub><italic>μ</italic></sub> + <italic>L</italic><sub><italic>π</italic></sub>) + 2<italic>KJ</italic> + <italic>nK</italic> + <italic>J</italic> when the model is fit with genewise dispersion and <italic>N</italic> = <italic>J</italic>(<italic>M</italic><sub><italic>μ</italic></sub> + <italic>M</italic><sub><italic>π</italic></sub>) + <italic>n</italic>(<italic>L</italic><sub><italic>μ</italic></sub> + <italic>L</italic><sub><italic>π</italic></sub>) + 2<italic>KJ</italic> + <italic>nK</italic> + 1 when the model is fit with common dispersion.</p>
      <p id="Par154">We use AIC and BIC in the simulation to select the number of unknown cell-level covariates (<italic>K</italic>).</p>
      <p id="Par155">Note that because of the complex non-convex likelihood function for the ZINB-WaVE model, there is no closed-form expression for the MLE and our numerical optimization procedure only provides an approximation of the AIC and BIC. In practice, however, we found that our results closely approximated the true MLE (see Results and Supplementary Fig. <xref rid="MOESM1" ref-type="media">22</xref>).</p>
    </sec>
    <sec id="Sec21">
      <title>Real data sets</title>
      <p id="Par156">V1 data set: Tasic et al.<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> characterized more than 1600 cells from the primary visual cortex (V1) in adult male mice, using a set of established Cre lines. Single cells were isolated by FACS into 96-well plates and RNA was reverse transcribed and amplified using the SMARTer kit. Sequencing was performed using the Illumina HiSeq platform, yielding 100 bp-long reads. We selected a subset of three Cre lines, Ntsr1-Cre, Rbp4-Cre, and Scnn1a-Tg3-Cre, that label layer 4, layer 5, and layer 6 excitatory neurons, respectively. This subset consists of 379 cells, grouped by the authors into 17 clusters; we excluded the cells that did not pass the authors’ quality control filters and that were classified by the authors as “intermediate” cells between two clusters, retaining a total of 285 cells. Gene expression was quantified by gene-level read counts. Raw gene-level read counts and QC metrics (see below) are available as part of the scRNAseq Bioconductor R package (<ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/scRNAseq">https://bioconductor.org/packages/scRNAseq</ext-link>). We applied the dimensionality reduction methods to the 1000 most variable genes.</p>
      <p id="Par157">S1/CA1 data set: Zeisel et al.<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> characterized 3005 cells from the primary somatosensory cortex (S1) and the hippocampal CA1 region, using the Fluidigm C1 microfluidics cell capture platform followed by Illumina sequencing. Gene expression was quantified by UMI counts. In addition to gene expression measures, we have access to metadata that can be used to assess the methods: batch, sex, number of mRNA molecules. Raw UMI counts and metadata were downloaded from <ext-link ext-link-type="uri" xlink:href="http://linnarssonlab.org/cortex/">http://linnarssonlab.org/cortex/</ext-link>.</p>
      <p id="Par158">mESC data set: Kolodziejczyk et al.<sup><xref ref-type="bibr" rid="CR37">37</xref></sup> sequenced the transcriptome of 704 mouse embryonic stem cells (mESCs), across three culture conditions (serum, 2i, and a2i), using the Fluidigm C1 microfluidics cell capture platform followed by Illumina sequencing. We selected only the cells from the second and third batch, after excluding the samples that did not pass the authors’ QC filtering. This allowed us to have cells from each culture condition in each batch and resulted in a total of 169 serum cells, 141 2i cells, and 159 a2i cells. In addition to gene expression measures, we have access to batch and plate information that can be included as covariates in our model. Raw gene-level read counts were downloaded from <ext-link ext-link-type="uri" xlink:href="http://www.ebi.ac.uk/teichmann-srv/espresso/">http://www.ebi.ac.uk/teichmann-srv/espresso/</ext-link>. Batch and plate information was extracted from the sample names, as done in Lun &amp; Marioni<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. We applied the dimensionality reduction methods to the 1000 most variable genes.</p>
      <p id="Par159">Glioblastoma data set: Patel et al.<sup><xref ref-type="bibr" rid="CR6">6</xref></sup> collected 672 cells from five dissociated human glioblastomas. Transcriptional profiles were generated using the SMART-Seq protocol. We analyzed only the cells that passed the authors’ QC filtering. The raw data were downloaded from the NCBI GEO database (accession GSE57872). Reads were aligned using TopHat with the following parameters: –rg-library Illumina –rg-platform Illumina –keep-fasta-order -G -N 3 –read-edit-dist 3 –no-coverage-search -x 1 -M -p 12. Counts were obtained using htseq-count with the following parameters (<ext-link ext-link-type="uri" xlink:href="http://www-huber.embl.de/HTSeq/doc/count.html">http://www-huber.embl.de/HTSeq/doc/count.html</ext-link>): -a 10 -q -s no -m union. We applied the dimensionality reduction methods to the 1000 most variable genes.</p>
      <p id="Par160">OE data set: Fletcher et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> characterized 849 FACS-purified cells from the mouse OE, using the Fluidigm C1 microfluidics cell capture platform followed by Illumina sequencing. Gene-level read counts were downloaded from GEO (GSE95601; file GSE95601_oeHBCdiff_Cufflinks_eSet_counts_table.txt.gz). As done in Perraudeau et al.<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, we filtered the cells that exhibited poor sample quality using SCONE<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> (v. 1.1.2). A total of 747 cells passed this filtering procedure. To compare with the original results, we also re-analyze the final repertoire of 13 stable clusters found in Fletcher et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>, consisting of 616 cells, downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/rufletch/p63-HBC-diff">https://github.com/rufletch/p63-HBC-diff</ext-link>. See Fletcher et al.<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> for details on the original analysis and Perraudeau et al.<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> for details on the ZINB-WaVE based workflow.</p>
      <p id="Par161">10× Genomics 68k PBMCs data set: Zheng et al.<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> characterized 68,579 peripheral blood mononuclear cells (PBMCs) from a healthy donor. The gene-level UMI counts were downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/single-cell/">https://www.10xgenomics.com/single-cell/</ext-link> using the cellrangerRkit R package (Version 1.1.0). We applied the dimensionality reduction methods to the 1000 most variable genes.</p>
    </sec>
    <sec id="Sec22" sec-type="data-availability">
      <title>Data availability</title>
      <p id="Par162">The ZINB-WaVE method is implemented in the open-source R package zinbwave, available as part of the Bioconductor Project (<ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/zinbwave">https://bioconductor.org/packages/zinbwave</ext-link>). See the package vignette for a detailed example of a typical use. The code to reproduce all the analyses and figures of this article is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/drisso/zinb_analysis">https://github.com/drisso/zinb_analysis</ext-link>.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Electronic supplementary material</title>
    <sec id="Sec23">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2017_2554_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2017_2554_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher's note:</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>
        <bold>Change history</bold>
      </p>
      <p>2/4/2019</p>
      <p>The original PDF version of this Article contained errors in two equations. In Eq. (1), all Γ symbols were inadvertently omitted. In the second equation in the subsection entitled ‘1. Dispersion optimization’ within the Methods section ‘ZINB-WaVE estimation procedure’, all Ψ symbols were inadvertently omitted. These errors have been corrected in the PDF version of the Article; the HTML version was correct from the time of publication.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Electronic supplementary material</title>
    <p><bold>Supplementary Information</bold> accompanies this paper at 10.1038/s41467-017-02554-5.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We would like to thank Olivier Mirabeau from the Curie Institute for the pre-processing of the Glioblastoma data set. We also thank Aaron Lun and the Marioni Lab for making the code needed for the simulations available online. Finally, we are grateful to Russell Fletcher for his help with the re-analysis of the OE data. D.R. and S.D. are supported by the National Institutes of Health BRAIN Initiative (Grant U01 MH105979, PI: John Ngai). S.G. and J.-P.V. are supported by the French National Research Agency (Grant ABS4NGS ANR-11-BINF-0001). J.-P.V. is supported by the European Research Council (Grant ERC-SMAC-280032), the Miller Institute for Basic Research in Science, and the Fulbright Foundation.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>D.R., S.D., and J.-P.V. formulated the statistical model. S.G. and J.-P.V. conceived and implemented the optimization algorithm. D.R., S.G., F.P., and J.-P.V. wrote the R package. D.R. performed the real data analysis. D.R., F.P., S.D., and J.-P.V. designed the simulation study. F.P. performed the simulations and analyzed the simulated data. D.R., F.P., S.D., and J.-P.V. wrote the manuscript.</p>
  </notes>
  <notes notes-type="COI-statement">
    <sec id="FPar3">
      <title>Competing interests</title>
      <p>The authors declare no competing financial interests.</p>
    </sec>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kolodziejczyk</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>JK</given-names>
          </name>
          <name>
            <surname>Svensson</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>The technology and biology of single-cell RNA sequencing</article-title>
        <source>Mol. Cell</source>
        <year>2015</year>
        <volume>58</volume>
        <fpage>610</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="doi">10.1016/j.molcel.2015.04.005</pub-id>
        <pub-id pub-id-type="pmid">26000846</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macosko</surname>
            <given-names>EZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly parallel genome-wide expression profiling of individual cells using nanoliter droplets</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>161</volume>
        <fpage>1202</fpage>
        <lpage>1214</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.002</pub-id>
        <pub-id pub-id-type="pmid">26000488</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tasic</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Adult mouse cortical cell taxonomy revealed by single cell transcriptomics</article-title>
        <source>Nat. Neurosci.</source>
        <year>2016</year>
        <volume>19</volume>
        <fpage>335</fpage>
        <lpage>346</lpage>
        <pub-id pub-id-type="doi">10.1038/nn.4216</pub-id>
        <pub-id pub-id-type="pmid">26727548</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell types in the mouse cortex and hippocampus revealed by single-cell RNA-seq</article-title>
        <source>Science</source>
        <year>2015</year>
        <volume>347</volume>
        <fpage>1138</fpage>
        <lpage>1142</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aaa1934</pub-id>
        <pub-id pub-id-type="pmid">25700174</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Deng</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Ramsköld</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Reinius</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Sandberg</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA-seq reveals dynamic, random monoallelic gene expression in mammalian cells</article-title>
        <source>Science</source>
        <year>2014</year>
        <volume>343</volume>
        <fpage>193</fpage>
        <lpage>196</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1245316</pub-id>
        <pub-id pub-id-type="pmid">24408435</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Patel</surname>
            <given-names>AP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq highlights intratumoral heterogeneity in primary glioblastoma</article-title>
        <source>Science</source>
        <year>2014</year>
        <volume>344</volume>
        <fpage>1396</fpage>
        <lpage>1401</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1254257</pub-id>
        <pub-id pub-id-type="pmid">24925914</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bacher</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Kendziorski</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Design and computational analysis of single-cell RNA-sequencing experiments</article-title>
        <source>Genome Biol.</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>1</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-016-0927-y</pub-id>
        <pub-id pub-id-type="pmid">26753840</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kharchenko</surname>
            <given-names>PV</given-names>
          </name>
          <name>
            <surname>Silberstein</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Scadden</surname>
            <given-names>DT</given-names>
          </name>
        </person-group>
        <article-title>Bayesian approach to single-cell differential expression analysis</article-title>
        <source>Nat. Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>740</fpage>
        <lpage>742</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2967</pub-id>
        <pub-id pub-id-type="pmid">24836921</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Islam</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Quantitative single-cell RNA-seq with unique molecular identifiers</article-title>
        <source>Nat. Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>163</fpage>
        <lpage>166</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2772</pub-id>
        <pub-id pub-id-type="pmid">24363023</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tung</surname>
            <given-names>PY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Batch effects and the effective design of single-cell gene expression studies</article-title>
        <source>Sci. Rep.</source>
        <year>2017</year>
        <volume>7</volume>
        <fpage>39921</fpage>
        <pub-id pub-id-type="doi">10.1038/srep39921</pub-id>
        <pub-id pub-id-type="pmid">28045081</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <mixed-citation publication-type="other">Vallejos, C. A., Risso, D., Scialdone, A., Dudoit, S. &amp; Marioni, J. C. Normalizing single-cell RNA sequencing data: challenges and opportunities. <italic>Nat. Methods</italic><bold>14</bold>, 565–571 (2017).</mixed-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marinov</surname>
            <given-names>GK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>From single-cell to cell-pool transcriptomes: stochasticity in gene expression and RNA splicing</article-title>
        <source>Genome Res.</source>
        <year>2014</year>
        <volume>24</volume>
        <fpage>496</fpage>
        <lpage>510</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.161034.113</pub-id>
        <pub-id pub-id-type="pmid">24299736</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pollen</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Low-coverage single-cell mRNA sequencing reveals cellular heterogeneity and activated signaling pathways in developing cerebral cortex</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2967</pub-id>
        <pub-id pub-id-type="pmid">25086649</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buettner</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Computational analysis of cell-to-cell heterogeneity in single-cell RNA-sequencing data reveals hidden subpopulations of cells</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>155</fpage>
        <lpage>160</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3102</pub-id>
        <pub-id pub-id-type="pmid">25599176</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The dynamics and regulators of cell fate decisions are revealed by pseudotemporal ordering of single cells</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>381</fpage>
        <lpage>386</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2859</pub-id>
        <pub-id pub-id-type="pmid">24658644</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ji</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>TSCAN: Pseudo-time reconstruction and evaluation in single-cell RNA-seq analysis</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>e117</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkw430</pub-id>
        <pub-id pub-id-type="pmid">27179027</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shin</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-Seq with waterfall reveals molecular cascades underlying adult neurogenesis</article-title>
        <source>Cell Stem Cell</source>
        <year>2015</year>
        <volume>17</volume>
        <fpage>360</fpage>
        <lpage>372</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2015.07.013</pub-id>
        <pub-id pub-id-type="pmid">26299571</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">Campbell, K., Ponting, C. P. &amp; Webber, C. Laplacian eigenmaps and principal curves for high resolution pseudotemporal ordering of single-cell RNA-seq profiles. <italic>bioRxiv</italic>10.1101/027219 027219 (2015).</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shalek</surname>
            <given-names>AK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-seq reveals dynamic paracrine control of cellular variation</article-title>
        <source>Nature</source>
        <year>2014</year>
        <volume>510</volume>
        <fpage>363</fpage>
        <lpage>369</lpage>
        <pub-id pub-id-type="doi">10.1038/nature13437</pub-id>
        <pub-id pub-id-type="pmid">24919153</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gaublomme</surname>
            <given-names>JT</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell genomics unveils critical regulators of Th17 cell pathogenicity</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>163</volume>
        <fpage>1400</fpage>
        <lpage>1412</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2015.11.009</pub-id>
        <pub-id pub-id-type="pmid">26607794</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Hicks, S. C., Teng, M. &amp; Irizarry, R. A. On the widespread and critical impact of systematic bias and batch effects in single-cell RNA-Seq data. <italic>bioRxiv</italic>10.1101/025528 025528 (2015).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finak</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>
        <source>Genome Biol.</source>
        <year>2015</year>
        <volume>16</volume>
        <fpage>278</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-015-0844-5</pub-id>
        <pub-id pub-id-type="pmid">26653891</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Belkin</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Niyogi</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Laplacian Eigenmaps for dimensionality reduction and data representation</article-title>
        <source>Neural Comput.</source>
        <year>2003</year>
        <volume>15</volume>
        <fpage>1373</fpage>
        <lpage>1396</lpage>
        <pub-id pub-id-type="doi">10.1162/089976603321780317</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Van Der Maaten</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing data using t-SNE</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <mixed-citation publication-type="other">Pierson, E. &amp; Yau, C. Dimensionality reduction for zero-inflated single cell gene expression analysis. <italic>Genome Biol</italic>. <bold>16</bold>, 241 (2015).</mixed-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gagnon-Bartsch</surname>
            <given-names>Ja</given-names>
          </name>
          <name>
            <surname>Speed</surname>
            <given-names>TP</given-names>
          </name>
        </person-group>
        <article-title>Using control genes to correct for unwanted variation in microarray data</article-title>
        <source>Biostatistics</source>
        <year>2012</year>
        <volume>13</volume>
        <fpage>539</fpage>
        <lpage>552</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxr034</pub-id>
        <pub-id pub-id-type="pmid">22101192</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Risso</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Ngai</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Speed</surname>
            <given-names>TP</given-names>
          </name>
          <name>
            <surname>Dudoit</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Normalization of RNA-seq data using factor analysis of control genes or samples</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2014</year>
        <volume>32</volume>
        <fpage>896</fpage>
        <lpage>902</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2931</pub-id>
        <pub-id pub-id-type="pmid">25150836</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fletcher</surname>
            <given-names>RB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deconstructing olfactory stem cell trajectories at single-cell resolution</article-title>
        <source>Cell Stem Cell</source>
        <year>2017</year>
        <volume>20</volume>
        <fpage>817</fpage>
        <lpage>830</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2017.04.003</pub-id>
        <pub-id pub-id-type="pmid">28506465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Street, K. et al. Slingshot: cell lineage and pseudotime inference for single-cell transcriptomics. <italic>bioRxiv</italic> 128843 (2017).</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Perraudeau, F., Risso, D., Street, K., Purdom, E. &amp; Dudoit, S. Bioconductor workflow for single-cell rna sequencing: Normalization, dimensionality reduction, clustering, and lineage inference. <italic>F1000Research</italic><bold>6</bold>, 1158 (2017).</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GX</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>14049</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <pub-id pub-id-type="pmid">28091601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Waltman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Eck</surname>
            <given-names>NJ</given-names>
          </name>
        </person-group>
        <article-title>A smart local moving algorithm for large-scale modularity-based community detection</article-title>
        <source> Eur. Phys. J. B</source>
        <year>2013</year>
        <volume>86</volume>
        <fpage>471</fpage>
        <pub-id pub-id-type="doi">10.1140/epjb/e2013-40829-0</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <mixed-citation publication-type="other">Satija, R., Butler, A. &amp; Hoffman, P. <italic>Seurat: Tools for Single Cell Genomics</italic> (2017).</mixed-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Villani</surname>
            <given-names>AC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell rna-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title>
        <source>Science</source>
        <year>2017</year>
        <volume>356</volume>
        <fpage>eaah4573</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aah4573</pub-id>
        <pub-id pub-id-type="pmid">28428369</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <mixed-citation publication-type="other">Cole, M. &amp; Risso, D. <italic>Scone: Single Cell Overview of Normalized Expression Data</italic> (2017).</mixed-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kolodziejczyk</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single cell RNA-sequencing of pluripotent states unlocks modular transcriptional variation</article-title>
        <source>Cell. Stem. Cell</source>
        <year>2015</year>
        <volume>17</volume>
        <fpage>471</fpage>
        <lpage>485</lpage>
        <pub-id pub-id-type="doi">10.1016/j.stem.2015.09.011</pub-id>
        <pub-id pub-id-type="pmid">26431182</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Johnson</surname>
            <given-names>WE</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Rabinovic</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Adjusting batch effects in microarray expression data using empirical Bayes methods</article-title>
        <source>Biostatistics</source>
        <year>2007</year>
        <volume>8</volume>
        <fpage>118</fpage>
        <lpage>127</lpage>
        <pub-id pub-id-type="doi">10.1093/biostatistics/kxj037</pub-id>
        <pub-id pub-id-type="pmid">16632515</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leek</surname>
            <given-names>JT</given-names>
          </name>
          <name>
            <surname>Johnson</surname>
            <given-names>WE</given-names>
          </name>
          <name>
            <surname>Parker</surname>
            <given-names>HS</given-names>
          </name>
          <name>
            <surname>Jaffe</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>The sva package for removing batch effects and other unwanted variation in high-throughput experiments</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>882</fpage>
        <lpage>883</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts034</pub-id>
        <pub-id pub-id-type="pmid">22257669</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Townes, F. W., Hicks, S. C., Aryee, M. J. &amp; Irizarry, R. A. Varying-censoring aware matrix factorization for single cell RNA-sequencing. <italic>bioRxiv</italic> 166736 (2017).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Robinson</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Smyth</surname>
            <given-names>GK</given-names>
          </name>
        </person-group>
        <article-title>edgeR: a Bioconductor package for differential expression analysis of digital gene expression data</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>139</fpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp616</pub-id>
        <pub-id pub-id-type="pmid">19910308</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Lun, A. T. L. &amp; Marioni, J. C. Overcoming confounding plate effects in differential expression analyses of single-cell RNA-seq data. <italic>Biostatistics</italic><bold>18</bold>, 451–464 (2016).</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Campbell</surname>
            <given-names>KR</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Wills</surname>
            <given-names>QF</given-names>
          </name>
        </person-group>
        <article-title>Scater: pre-processing, quality control, normalisation and visualisation of single-cell RNA-seq data in R</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>33</volume>
        <fpage>1179</fpage>
        <lpage>1186</lpage>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leek</surname>
            <given-names>JT</given-names>
          </name>
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>Capturing heterogeneity in gene expression studies by surrogate variable analysis</article-title>
        <source>PLoS Genet.</source>
        <year>2007</year>
        <volume>3</volume>
        <fpage>e161</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pgen.0030161</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous dimension reduction and adjustment for confounding variation</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2016</year>
        <volume>113</volume>
        <fpage>14662</fpage>
        <lpage>14667</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1617317113</pub-id>
        <pub-id pub-id-type="pmid">27930330</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Love</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Hogenesch</surname>
            <given-names>JB</given-names>
          </name>
          <name>
            <surname>Irizarry</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <article-title>Modeling of RNA-seq fragment sequence bias reduces systematic errors in transcript abundance estimation</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2016</year>
        <volume>34</volume>
        <fpage>1287</fpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3682</pub-id>
        <pub-id pub-id-type="pmid">27669167</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <mixed-citation publication-type="other">Regev, A. et al. The human cell atlas. <italic>bioRxiv</italic> 121202 (2017).</mixed-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Pierson</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Ramazzotti</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Batzoglou</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Visualization and analysis of single-cell RNA-seq data by kernel-based similarity learning</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>414</fpage>
        <lpage>416</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4207</pub-id>
        <pub-id pub-id-type="pmid">28263960</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <mixed-citation publication-type="other">Van den Berge, K., Soneson, C., Love, M. I., Robinson, M. D. &amp; Clement, L. ZingeR: unlocking rna-seq tools for zero-inflation and single cell applications. <italic>bioRxiv</italic> 157982 (2017).</mixed-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Srebro</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Rennie</surname>
            <given-names>JDM</given-names>
          </name>
          <name>
            <surname>Jaakkola</surname>
            <given-names>TS</given-names>
          </name>
        </person-group>
        <article-title>Maximum-margin matrix factorization</article-title>
        <source>Adv. Neural Inf. Process. Syst.</source>
        <year>2005</year>
        <volume>17</volume>
        <fpage>1329</fpage>
        <lpage>1336</lpage>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mazumder</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Hastie</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Spectral regularization algorithms for learning large incomplete matrices</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>2287</fpage>
        <lpage>2322</lpage>
        <?supplied-pmid 21552465?>
        <pub-id pub-id-type="pmid">21552465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Dewey</surname>
            <given-names>CN</given-names>
          </name>
        </person-group>
        <article-title>RSEM: accurate transcript quantification from RNA-Seq data with or without a reference genome</article-title>
        <source>BMC Bioinformatics</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>323</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-12-323</pub-id>
        <pub-id pub-id-type="pmid">21816040</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcript assembly and quantification by RNA-Seq reveals unannotated transcripts and isoform switching during cell differentiation</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2010</year>
        <volume>28</volume>
        <fpage>511</fpage>
        <lpage>515</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.1621</pub-id>
        <pub-id pub-id-type="pmid">20436464</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bullard</surname>
            <given-names>JH</given-names>
          </name>
          <name>
            <surname>Purdom</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Hansen</surname>
            <given-names>KD</given-names>
          </name>
          <name>
            <surname>Dudoit</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Evaluation of statistical methods for normalization and differential expression in mRNA-Seq experiments</article-title>
        <source>BMC Bioinformatics</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>94</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-94</pub-id>
        <pub-id pub-id-type="pmid">20167110</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Robinson</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Oshlack</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>A scaling normalization method for differential expression analysis of RNA-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>R25</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2010-11-3-r25</pub-id>
        <pub-id pub-id-type="pmid">20196867</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <mixed-citation publication-type="other">Purdom, E. &amp; Risso, D. <italic>clusterExperiment: Compare Clusterings for Single-Cell Sequencing</italic> (2017).</mixed-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tseng</surname>
            <given-names>GC</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>WH</given-names>
          </name>
        </person-group>
        <article-title>Tight clustering: A resampling-based approach for identifying stable and tight patterns in data</article-title>
        <source>Biometrics</source>
        <year>2005</year>
        <volume>61</volume>
        <fpage>10</fpage>
        <lpage>16</lpage>
        <pub-id pub-id-type="doi">10.1111/j.0006-341X.2005.031032.x</pub-id>
        <pub-id pub-id-type="pmid">15737073</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <mixed-citation publication-type="other">McDavid, A., Finak, G. &amp; Yajima, M. <italic>MAST: Model-Based Analysis of Single Cell Transcriptomics</italic> (2017).</mixed-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <mixed-citation publication-type="other">Desgraupes, B. <italic>clusterCrit: Clustering Indices</italic> (2016).</mixed-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <mixed-citation publication-type="other">Mccarthy, D. J., Campbell, K. R., Lun, A. T. L. &amp; Wills, Q. F. Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R. <italic>Bioinformatics</italic><bold>33</bold>, 1179–1186 (2017).</mixed-citation>
    </ref>
  </ref-list>
</back>
