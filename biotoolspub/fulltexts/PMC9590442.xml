<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinform Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinform Adv</journal-id>
    <journal-id journal-id-type="publisher-id">bioadv</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2635-0041</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9590442</article-id>
    <article-id pub-id-type="pmid">36284674</article-id>
    <article-id pub-id-type="doi">10.1093/bioadv/vbac061</article-id>
    <article-id pub-id-type="publisher-id">vbac061</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Application Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Software</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>STtools: a comprehensive software pipeline for ultra-high-resolution spatial transcriptomics data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Xi</surname>
          <given-names>Jingyue</given-names>
        </name>
        <aff><institution>Department of Biostatistics, School of Public Health, University of Michigan</institution>, Ann Arbor, MI 48109, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lee</surname>
          <given-names>Jun Hee</given-names>
        </name>
        <aff><institution>Department of Molecular &amp; Integrative Physiology, University of Michigan Medical School</institution>, Ann Arbor, MI 48109, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Kang</surname>
          <given-names>Hyun Min</given-names>
        </name>
        <aff><institution>Department of Biostatistics, School of Public Health, University of Michigan</institution>, Ann Arbor, MI 48109, <country country="US">USA</country></aff>
        <xref rid="vbac061-cor1" ref-type="corresp"/>
        <!--hmkang@umich.edu-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0891-0204</contrib-id>
        <name>
          <surname>Jun</surname>
          <given-names>Goo</given-names>
        </name>
        <aff><institution>Department of Epidemiology, Human Genetics &amp; Environmental Sciences, School of Public Health, University of Texas Health Science Center at Houston</institution>, Houston, TX 77030, <country country="US">USA</country></aff>
        <xref rid="vbac061-cor1" ref-type="corresp"/>
        <!--goo.jun@uth.tmc.edu-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Rattray</surname>
          <given-names>Magnus</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="vbac061-cor1">To whom correspondence should be addressed. <email>hmkang@umich.edu</email> or <email>goo.jun@uth.tmc.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-09-01">
      <day>01</day>
      <month>9</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>01</day>
      <month>9</month>
      <year>2022</year>
    </pub-date>
    <volume>2</volume>
    <issue>1</issue>
    <elocation-id>vbac061</elocation-id>
    <history>
      <date date-type="received">
        <day>15</day>
        <month>3</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>15</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>09</day>
        <month>8</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>8</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>12</day>
        <month>9</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="vbac061.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>While there are many software pipelines for analyzing spatial transcriptomics (ST) data, few can process ultra-high-resolution datasets generated by emerging technologies. There is a clear need for new software tools that can handle submicrometer resolution ST data with computational scalability without compromising its resolution.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We developed STtools, a software pipeline that provides a versatile framework to handle ST datasets with various resolutions, such as the ones produced by Seq-Scope (&lt;1 μm), Slide-seq (10 μm) and VISIUM (100 μm). It automatically processes raw FASTQ files and runs downstream analyses at several folds higher resolution than existing methods. It also generates various visualizations including transcriptome density, cell type mapping, marker gene highlighting and subcellular architectures.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>STtools is publically available for download at <ext-link xlink:href="https://github.com/seqscope/STtools" ext-link-type="uri">https://github.com/seqscope/STtools</ext-link></p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics Advances</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Institute of Health</institution>
          </institution-wrap>
        </funding-source>
        <award-id>DK118631</award-id>
        <award-id>HD098552</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Recent developments in single-cell and spatial RNA-sequencing technologies enabled fine-scale exploration of cell-type-specific expressions and tissue compositions. Technologies such as VISIUM (<xref rid="vbac061-B10" ref-type="bibr">Ståhl <italic toggle="yes">et al.</italic>, 2016</xref>), Slide-seq (<xref rid="vbac061-B8" ref-type="bibr">Rodriques <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="vbac061-B11" ref-type="bibr">Stickels <italic toggle="yes">et al.</italic>, 2021</xref>) and Seq-Scope (<xref rid="vbac061-B2" ref-type="bibr">Cho <italic toggle="yes">et al.</italic>, 2021</xref>) associates specific barcode sequences with spatial coordinates and attaches these spatial barcodes to individual cDNA fragments to resolve transcriptomic profiles with spatial resolution.</p>
    <p>Current software tools analyzing spatially resolved transcriptomes (<xref rid="vbac061-B1" ref-type="bibr">10x Genomics, 2022</xref>; <xref rid="vbac061-B6" ref-type="bibr">Palla <italic toggle="yes">et al.</italic>, 2022</xref>; <xref rid="vbac061-B7" ref-type="bibr">Petukhov <italic toggle="yes">et al.</italic>, 2021</xref>) are primarily designed for relatively coarse resolution technologies such as VISIUM (100 μm) or Slide-seq (10 μm), where each spatial barcode typically represents more than single cells. However, when analyzing transcriptome spatially resolved at a micrometer or a submicrometer resolution, most current tools perform poorly due to various computational challenges. First, the number of spatial barcodes per mm<sup>2</sup> rapidly increases as resolution increases (∼120 for VISIUM, ∼3K for Slide-seq and &gt;1M for Seq-Scope), and few tools seamlessly scale to handle millions of spatial barcodes. Second, even though higher-resolution technologies may contain larger Universal Molecular Identifier (UMI) counts per given area, the UMI count per spatial barcode is typically much lower due to the limited number of mRNAs that can be captured. As a result, existing tools may perform poorly if they assume that individual spatial barcodes contain sufficient UMIs to be clustered into a cell type. Third, submicrometer-resolution technologies inform us of subcellular transcriptomic architecture within individual cells (<xref rid="vbac061-B2" ref-type="bibr">Cho <italic toggle="yes">et al.</italic>, 2021</xref>), but existing tools do not account for subcellular components in their analysis and visualization to accommodate the ultra-high resolution from recent technologies.</p>
    <p>To address these challenges, we developed STtools, which is capable of handling various spatial transcriptomics (ST) platforms, including submicrometer-resolution ST platforms such as Seq-Scope. STtools provides a comprehensive framework for analyzing ST datasets, enabling both super-cellular, cellular and sub-cellular resolution analysis and visualization.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <p>STtools is able to process ST data from various platforms including, but not limited to, Seq-Scope, Slide-seq and VISIUM. STtools provides a complete solution from raw FASTQ file preprocessing to automated downstream analysis with the flexibility to run the pipeline end-to-end automatically. It also allows users to run a specified set of consecutive steps, or to run individual steps separately. For example, users can skip the FASTQ processing steps and instead start from a spatial gene expression matrix for downstream analysis such as clustering and visualization using STtools. STtools workflow currently performs three major tasks—alignment, clustering and visualization—consisting of eight individual steps (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). The alignment step performs quality control (QC), alignment and spatial expression matrix generation from raw sequence data. The clustering steps perform cell-type clustering in multiscale resolution. The visualization steps visualize the ST data from multiple different perspectives as illustrated (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>, <xref rid="vbac061-F1" ref-type="fig">Fig. 1</xref>).</p>
    <fig position="float" id="vbac061-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Visualization of ST data with STtools. (<bold>A–D</bold>) Visualize Seq-Scope mouse liver dataset, and (<bold>E–H</bold>) visualize Slide-seq mouse cerebellum dataset. (A, E) Visualize UMAP coordinates and clustered cell types for each squared grid. (B, F) Visualize the clustered cell types for each simple grid (10<inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mo> </mml:mo><mml:mi mathvariant="normal">μ</mml:mi></mml:math></inline-formula>m for Seq-Scope, 50 <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi mathvariant="normal">μ</mml:mi></mml:math></inline-formula>m for Slide-seq). (C, G) Visualize the cell types from MSSW with higher resolution (2 <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mi mathvariant="normal">μ</mml:mi></mml:math></inline-formula>m for Seq-Scope and 10<inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mo> </mml:mo><mml:mi mathvariant="normal">μ</mml:mi></mml:math></inline-formula>m for Slide-seq). (D, H) Visualize selected marker genes in RGB color at ultra-high resolution (1<inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mo> </mml:mo><mml:mi mathvariant="normal">μ</mml:mi></mml:math></inline-formula>m/pixel for Seq-Scope and 10 <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mi mathvariant="normal">μ</mml:mi></mml:math></inline-formula>m/pixel for Slide-seq)</p>
      </caption>
      <graphic xlink:href="vbac061f1" position="float"/>
    </fig>
    <p>The full STtools workflow starts with taking two sets of raw sequence reads in FASTQ format. The first FASTQ file (1st-seq) contains spatial barcode sequences associated with spatial coordinates that are encoded in their Illumina sequence identifiers (Line 1 of FASTQ reads). The second FASTQ file (2nd-seq) contains cDNA sequences from transcripts, attached with the spatial barcodes (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). After performing initial QC to inspect the distribution of spatial coordinates of barcodes, using these two sets of FASTQ files, STtools aligns each cDNA sequence to the reference genome using STARsolo (<xref rid="vbac061-B4" ref-type="bibr">Kaminow <italic toggle="yes">et al.</italic>, 2021</xref>). Each aligned 2nd-seq read in the BAM file is annotated with error-corrected spatial barcodes based on 1st-seq. After the alignment, multiple sets of digital expression matrices are generated focusing on exonic reads only (Gene), exonic and intronic reads together (GeneFull), or by distinguishing spliced and unspliced reads (Velocyto).</p>
    <p>STtools takes digital expression matrices annotated with spatial coordinates, either from the steps above or from external sources, to aid interpretation of the data through barcode aggregation, clustering and visualization. Aggregation across nearby spatial barcodes is particularly important for submicrometer resolution ST technologies and will help infer cell types accurately. However, it may compromise the subcellular resolution attainable by the technology. To support clustering at cellular/subcellular level while keeping the details of high spatial resolution, STtools employs two different spatial aggregation (i.e. binning) algorithms: simple aggregation and multiscale sliding-window (MSSW) aggregation. The simple aggregation method generates a set of non-overlapping, equal-sized bins to capture enough transcripts to be used for cell-type clustering. MSSW generates a set of overlapping bins for finer resolution cell-type identification and visualization (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>). This two-track approach seamlessly and efficiently integrates with Seurat (<xref rid="vbac061-B3" ref-type="bibr">Hao <italic toggle="yes">et al.</italic>, 2021</xref>), so that simple aggregation is used for clustering cell types and MSSW aggregated bins are used to assign cluster types at a finer resolution (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1D–F</xref>). STtools also generates high-resolution (&lt;1 μm<sup>2</sup>/pixel) images where red/green/blue (RGB) colors quantify specific arbitrary marker gene sets to help investigators understand the raw spatial gene expression without sacrificing the resolution. Comparing other tools that can handle high-resolution spatial transcriptomic data, STtools offers more comprehensive coverage across various user cases, particularly for SeqScope data (<xref rid="vbac061-T1" ref-type="table">Table 1</xref>).</p>
    <table-wrap position="float" id="vbac061-T1">
      <label>Table 1.</label>
      <caption>
        <p>Comparison between STTools and other related tools (spacemake and squidpy)</p>
      </caption>
      <table frame="hsides" rules="groups">
        <colgroup span="1">
          <col valign="top" align="left" span="1"/>
          <col valign="top" align="center" span="1"/>
          <col valign="top" align="center" span="1"/>
          <col valign="top" align="center" span="1"/>
        </colgroup>
        <thead>
          <tr>
            <th rowspan="1" colspan="1">Functionality</th>
            <th rowspan="1" colspan="1">Spacemake</th>
            <th rowspan="1" colspan="1">Squidpy</th>
            <th align="center" rowspan="1" colspan="1">STtools</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="1" colspan="1">Preprocess 1st-Seq FASTQ to prepare alignment (Step A1)</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Quality control of spatial coordinates and tissue boundary detection (Step A2)</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Aligns the transcriptomic sequence reads and produces spatial expression matrix in standard format (Step A3)</td>
            <td rowspan="1" colspan="1">O</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Grid-based simple spatial segmentation (Step C1)</td>
            <td rowspan="1" colspan="1">O</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">MSSW segmentation (Step C2)</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Clustering of each segment (Step C3)</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">High-resolution visualization of selected genes (Step V1)</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Compatible with SlideSeq</td>
            <td rowspan="1" colspan="1">O</td>
            <td rowspan="1" colspan="1">O</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Compatible with SeqScope</td>
            <td rowspan="1" colspan="1">△</td>
            <td rowspan="1" colspan="1">△</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Provides an end-end solution (including alignment, clustering and visualization)</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Allows running individual steps separately</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Quantifies both spliced and unspliced reads for subcellular analysis</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">X</td>
            <td rowspan="1" colspan="1">O</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>We applied STtools to multiple spatial transcriptomic platforms, including Seq-Scope, Slide-seq and VISIUM. We illustrated example results from Seq-Scope mouse liver dataset (<xref rid="vbac061-F1" ref-type="fig">Fig. 1A–D</xref>) and Slide-seq mouse cerebellum dataset (<xref rid="vbac061-F1" ref-type="fig">Fig. 1E–H</xref>), which have ∼0.8 and ∼10 μm distance between adjacent spatial barcodes, respectively. We first applied simple square barcode aggregation (100 μm<sup>2</sup> for Seq-Scope, 2500 μm<sup>2</sup> for Slide-seq) and then estimated their cell types and UMAP manifolds (<xref rid="vbac061-F1" ref-type="fig">Fig. 1A and E</xref>). STtools is featured at MSSW analysis by accumulating reads counts in a smaller square grid, to enhance resolution via sliding grid strategy. Using MSSW, we produced 25-fold finer resolution spatial map (4 μm<sup>2</sup> for Seq-Scope and 100 μm<sup>2</sup> for Slide-Seq) and performed high-resolution cell-type identification by high-dimensional projection implemented in Seurat (<xref rid="vbac061-F1" ref-type="fig">Fig. 1C</xref>). As a result, the spatial cluster map from MSSW algorithm provides finer cell-type boundaries than simple barcode aggregation (<xref rid="vbac061-F1" ref-type="fig">Fig. 1B</xref>) for Seq-Scope dataset. On the other hand, for SlideSeq, the benefit of MSSW was not visually pronounced primarily due to the low resolution of the technology. (<xref rid="vbac061-F1" ref-type="fig">Fig. 1F and G</xref>).</p>
    <p>We also produced ultra-high-resolution spatial RGB geneset plots that visualize the expressions of selected marker gene sets with STtools to visualize customized spatial maps based on user-defined genes. This RGB plotting tool is capable of separating spliced and unspliced reads, and we were able to visualize both cell-type differences (periportal versus pericentral hepatocytes versus macrophages; <xref rid="vbac061-F1" ref-type="fig">Fig. 1D</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3A</xref>) as well as subcellular differences (e.g. nucleus versus mitochondria versus macrophages; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3C</xref>) at a resolution of 1 μm<sup>2</sup>/pixel. These plots can help investigators interpret ST data at an ultra-high resolution to understand subcellular architecture or infiltration of non-parenchymal cell types.</p>
    <p>STtools also generates additional visualization of ST data such as the distribution of UMIs across spatial coordinates (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4A</xref>) or violin plots of gene counts, UMI counts or fraction of mitochondrial genes (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4B–D</xref>) by seamless connection to other single-cell or ST software such as STARsolo (<xref rid="vbac061-B4" ref-type="bibr">Kaminow <italic toggle="yes">et al.</italic>, 2021</xref>), Seurat (<xref rid="vbac061-B3" ref-type="bibr">Hao <italic toggle="yes">et al.</italic>, 2021</xref>) and seqtk (<xref rid="vbac061-B5" ref-type="bibr">Li, 2021</xref>). The digital expression matrix generated by STtools follows the widely used format from 10× Genomics can be directly read from other software tools such as Seurat (<xref rid="vbac061-B3" ref-type="bibr">Hao <italic toggle="yes">et al.</italic>, 2021</xref>) or squidpy (<xref rid="vbac061-B6" ref-type="bibr">Palla <italic toggle="yes">et al.</italic>, 2022</xref>) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>). STtools also offers a functionality to run Bayespace (<xref rid="vbac061-B12" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic>, 2021</xref>) for VISIUM data to enhance its resolution.</p>
    <p>STtools is designed to efficiently process spatial transcriptomic data scaling with millions of spatially resolved barcodes. The total computational cost to process the SeqScope data consisting of 15M spatial barcodes and 1.9 billion raw sequence reads across all stages was modest, taking ∼16 h in an high performance computing (HPC) cluster with 6 3.0 GHz Intel Xeon Gold 6154 CPUs with 30 GB of RAMs for the mouse liver dataset. The cost was orders of magnitude smaller for lower-resolution datasets such as Slide-seq or VISIUM. To compare the computational efficiency of STtools with spacemake, we ran both tools with the same mouse liver SeqScope data (GSM5212844). Spacemake could not handle the full 2nd-seq data with 625.1G bases, so we ran experiments for a subset (SRR14082757) with 104.7G bases. As shown in <xref rid="vbac061-T1" ref-type="table">Table 1</xref>, spacemake approximately corresponds to STtools steps A1 to A3, which produces the spatial gene expression matrix after alignments. Spacemake does not have the functionality to extract spatial coordinates from 1st-seq data of SeqScope, so we used the coordinates generated by STtools step A1. It took 254 min to run STtools steps A1–A3, while spacemake took 1100 min. Both pipelines were executed with <monospace>–-cores 8</monospace> option and ran locally on an HP DL380 server with Dual Intel Xeon-G 5118 processor (24 physical cores). The usage of STARsolo instead of STAR and efficiencies in intermediate file generation resulted in significant runtime differences between two pipelines for high-resolution SeqScope data.</p>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>In summary, STtools is a comprehensive software pipeline that allows users to align, cluster and visualize spatial transcriptome sequence data generated at submicrometer resolution. Especially, STtools improves the resolution of spatial inference compared to typical segmentation-based approach by leveraging MSSW algorithm. The spatial expression matrix, spatial segmentation and clustering results produced by STtools can be easily fed to other software tools widely used for downstream analysis, such as Seurat (<xref rid="vbac061-B3" ref-type="bibr">Hao <italic toggle="yes">et al.</italic>, 2021</xref>) and squidpy (<xref rid="vbac061-B6" ref-type="bibr">Palla <italic toggle="yes">et al.</italic>, 2022</xref>).</p>
    <p>While STtools offers all-in-one analysis to translate raw sequence reads into spatial expression matrix and clustering, it also provides options to perform step-by-step analyses so that the investigators can perform sanity check from each step and adjust the parameters as needed. Users can customize many parameters during the alignment and clustering, including adapter sequences to trim, reference genomes to align and the thresholds to filter genes and spatial segments before clustering. Users can always load the spatial expression matrix generated by STtools in a standard format to perform more tailored analysis on their own using Seurat, squidpy or other downstream software tools.</p>
    <p>Although higher-resolution spatial inference can be made by the MSSW algorithm, compared to other standard spatial transcriptomic analysis tools, it still has rooms for improvement. Due to the limited number of UMIs per region, each spatial segment still needs to be larger than subcellular compartments (e.g. ∼10 µm), so subcellular analysis with MSSW is not feasible. Spatial smoothing algorithms that deliver robust inference for extremely sparse expression profiles per spatial unit will be needed to enable truly subcellular inference beyond visualization of subcellular compartments.</p>
    <p>There are many more improvements that can be made to STtools in the future. For example, methods to impute spatial expression profiles (<xref rid="vbac061-B9" ref-type="bibr">Shengquan <italic toggle="yes">et al.</italic>, 2021</xref>), methods to jointly cluster cellular and subcellular components together, or methods to automatically overlay histological images and spatial expressions are useful features that can be added in the next major updates of STtools.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>vbac061_Supplementary_Data</label>
      <media xlink:href="vbac061_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We thank Chun-Seok Cho for generating and providing the Seq-Scope datasets and Yongsung Kim for assisting cell-type annotation of the Slide-seq dataset.</p>
    <sec>
      <title>Funding</title>
      <p>G.J. is supported by National Institute of Health (NIH) grants DK118631 and HD098552. J.H.L. and J.X. are supported by NIH grants CA268091, DK114131 and DK102850, by Taubman Institute, and by ADVANCE and MTRAC awards, funded by the Michigan Economic Development Corporation.</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: J.X. is an employee of Intel Corp. H.M.K. is an employee of Regeneron Pharmaceuticals, he owns stock and stock options for Regeneron Pharmaceuticals. J.H.L. is an inventor on pending patent applications related to Seq-Scope.</p>
    </sec>
  </ack>
  <sec sec-type="data-availability">
    <title>Data Availability</title>
    <p>The data used to generate images in this paper is available at the Gene Expression Omnibus (GEO) database with accession number GSE169706.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="vbac061-B1">
      <mixed-citation publication-type="other"><collab>10x Genomics</collab> (<year>2022</year>) Space ranger: spatial transcriptomics. <ext-link xlink:href="https://support.10xgenomics.com/spatial-gene-expression/software/pipelines/latest/what-is-space-ranger" ext-link-type="uri">https://support.10xgenomics.com/spatial-gene-expression/software/pipelines/latest/what-is-space-ranger</ext-link> (1 May 2022, date last accessed).</mixed-citation>
    </ref>
    <ref id="vbac061-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cho</surname><given-names>C.S.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Microscopic examination of spatial transcriptome using Seq-Scope</article-title>. <source>Cell</source>, <volume>184</volume>, <fpage>3559</fpage>–<lpage>3572.e22</lpage>.<pub-id pub-id-type="pmid">34115981</pub-id></mixed-citation>
    </ref>
    <ref id="vbac061-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hao</surname><given-names>Y.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Integrated analysis of multimodal single-cell data</article-title>. <source>Cell</source>, <volume>184</volume>, <fpage>3573</fpage>–<lpage>3587.e29</lpage>.<pub-id pub-id-type="pmid">34062119</pub-id></mixed-citation>
    </ref>
    <ref id="vbac061-B4">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Kaminow</surname><given-names>B.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) STARsolo: accurate, fast and versatile mapping/quantification of single-cell and single-nucleus RNA-seq data. <italic toggle="yes">bioRxiv</italic> doi:10.1101/2021.05.05.442755.</mixed-citation>
    </ref>
    <ref id="vbac061-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>H.</given-names></string-name></person-group> (<year>2021</year>) Seqtk. <ext-link xlink:href="https://github.com/lh3/seqtk" ext-link-type="uri">https://github.com/lh3/seqtk</ext-link> (1 May 2022, date last accessed).</mixed-citation>
    </ref>
    <ref id="vbac061-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Palla</surname><given-names>G.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>. <source>Nat. Methods</source>, <volume>19</volume>, <fpage>171</fpage>–<lpage>178</lpage>.<pub-id pub-id-type="pmid">35102346</pub-id></mixed-citation>
    </ref>
    <ref id="vbac061-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Petukhov</surname><given-names>V.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Cell segmentation in imaging-based spatial transcriptomics</article-title>. <source>Nat. Biotechnol</source>., <volume>2021</volume>, <fpage>1</fpage>–<lpage>10</lpage>.</mixed-citation>
    </ref>
    <ref id="vbac061-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rodriques</surname><given-names>S.G.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>. <source>Science</source>, <volume>363</volume>, <fpage>1463</fpage>–<lpage>1467</lpage>.<pub-id pub-id-type="pmid">30923225</pub-id></mixed-citation>
    </ref>
    <ref id="vbac061-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shengquan</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>stPlus: a reference-based method for the accurate enhancement of spatial transcriptomics</article-title>. <source>Bioinformatics</source>, <volume>37</volume>, <fpage>i299</fpage>–<lpage>i307</lpage>.<pub-id pub-id-type="pmid">34252941</pub-id></mixed-citation>
    </ref>
    <ref id="vbac061-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ståhl</surname><given-names>P.L.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>. <source>Science</source>, <volume>353</volume>, <fpage>78</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">27365449</pub-id></mixed-citation>
    </ref>
    <ref id="vbac061-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stickels</surname><given-names>R.R.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqV2</article-title>. <source>Nat. Biotechnol</source>., <volume>39</volume>, <fpage>313</fpage>–<lpage>319</lpage>.<pub-id pub-id-type="pmid">33288904</pub-id></mixed-citation>
    </ref>
    <ref id="vbac061-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhao</surname><given-names>E.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat. Biotechnol</source>., <volume>39</volume>, <fpage>1375</fpage>–<lpage>1384</lpage>.<pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
