<?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName art560.dtd?>
<?SourceDTD.Version 5.6.0?>
<?ConverterInfo.XSLTName elsevier2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin publisher?>
<?FILEmeta_MEX100808 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEgr3 jpg ?>
<?FILEgr4 jpg ?>
<?FILEgr5 jpg ?>
<?FILEgr6 jpg ?>
<?FILEfx1 jpg ?>
<?FILEsi1 svg ?>
<?FILEsi2 svg ?>
<?FILEsi3 svg ?>
<?FILEsi4 svg ?>
<?FILEsi5 svg ?>
<?FILEsi6 svg ?>
<?FILEsi7 svg ?>
<?FILEsi8 svg ?>
<?FILEsi9 svg ?>
<?FILEsi10 svg ?>
<?FILEsi11 svg ?>
<?FILEsi12 svg ?>
<?FILEsi13 svg ?>
<?FILEsi14 svg ?>
<?FILEsi15 svg ?>
<?FILEsi16 svg ?>
<?FILEsi17 svg ?>
<?FILEsi18 svg ?>
<?FILEsi19 svg ?>
<?FILEsi20 svg ?>
<?FILEsi21 svg ?>
<?FILEsi22 svg ?>
<?FILEsi23 svg ?>
<?FILEsi24 svg ?>
<?FILEsi25 svg ?>
<?FILEsi26 svg ?>
<?FILEsi27 svg ?>
<?FILEsi28 svg ?>
<?FILEsi29 svg ?>
<?FILEsi30 svg ?>
<?FILEsi31 svg ?>
<?FILEsi32 svg ?>
<?FILEsi33 svg ?>
<?FILEsi34 svg ?>
<?FILEsi35 svg ?>
<?FILEsi36 svg ?>
<?FILEsi37 svg ?>
<?FILEsi38 svg ?>
<?FILEsi39 svg ?>
<?FILEsi40 svg ?>
<?FILEsi41 svg ?>
<?FILEsi42 svg ?>
<?FILEsi43 svg ?>
<?FILEsi44 svg ?>
<?properties open_access?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">MethodsX</journal-id>
    <journal-id journal-id-type="iso-abbrev">MethodsX</journal-id>
    <journal-title-group>
      <journal-title>MethodsX</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2215-0161</issn>
    <publisher>
      <publisher-name>Elsevier</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7063232</article-id>
    <article-id pub-id-type="publisher-id">S2215-0161(20)30028-5</article-id>
    <article-id pub-id-type="doi">10.1016/j.mex.2020.100808</article-id>
    <article-id pub-id-type="publisher-id">100808</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Environmental Science</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>i-Tree cool river: An open source, freeware tool to simulate river water temperature coupled with HEC-RAS</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="au0001">
        <name>
          <surname>Abdi</surname>
          <given-names>Reza</given-names>
        </name>
        <email>rabdi@mines.edu</email>
        <xref rid="aff0001" ref-type="aff">a</xref>
        <xref rid="cor0001" ref-type="corresp">⁎</xref>
      </contrib>
      <contrib contrib-type="author" id="au0002">
        <name>
          <surname>Endreny</surname>
          <given-names>Theodore</given-names>
        </name>
        <xref rid="aff0002" ref-type="aff">b</xref>
      </contrib>
      <contrib contrib-type="author" id="au0003">
        <name>
          <surname>Nowak</surname>
          <given-names>David</given-names>
        </name>
        <xref rid="aff0003" ref-type="aff">c</xref>
      </contrib>
    </contrib-group>
    <aff id="aff0001"><label>a</label>Department of Civil and Environmental Engineering, Colorado School of Mines, Golden, CO 80401, USA</aff>
    <aff id="aff0002"><label>b</label>Department of Environmental Resources Engineering, State University of New York, College of Environmental Science and Forestry, Syracuse, NY 13210, USA</aff>
    <aff id="aff0003"><label>c</label>USDA Forest Service, SUNY-ESF, Northern Research Station, 5 Moon Library, Syracuse, NY 13210, USA</aff>
    <author-notes>
      <corresp id="cor0001"><label>⁎</label>Corresponding author. <email>rabdi@mines.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>2</month>
      <year>2020</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.-->
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>20</day>
      <month>2</month>
      <year>2020</year>
    </pub-date>
    <volume>7</volume>
    <elocation-id>100808</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>1</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>12</day>
        <month>2</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2020 The Author(s). Published by Elsevier B.V.</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder/>
      <license license-type="CC BY" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).</license-p>
      </license>
    </permissions>
    <abstract id="abs0001">
      <p>This method paper explains the i-Tree Cool River model algorithms for simulating the response of river water temperature to urban greening. The model captures the warming and cooling impacts of urban development and restoration through a water and energy budget. The water budget includes river inflows from urban storm sewers and reservoirs, and the associated water temperatures. The energy budget adjusts radiation fluxes due to riparian shading and evapotranspiration, and propagates temperature downstream. Restorative cooling of the river can be simulated through algorithms for cool groundwater, either as direct inflows or by river water replacement called hyporheic exchange. Novel features in the model include diurnal variation in riparian shading, use of the Army Corps of Engineers HEC-RAS model predicted river depths and velocities, and periodic boundary conditions to rapidly extend restoration scenarios.<list list-type="simple" id="celist0001"><list-item id="celistitem0001"><label>•</label><p id="para0001">Freely available code in C++ for Visual Studio, with a detailed manual and sample inputs and outputs at <ext-link ext-link-type="uri" xlink:href="http://www.itreetools.org/research_suite/coolriver" id="interref0032">http://www.itreetools.org/research_suite/coolriver</ext-link>.</p></list-item><list-item id="celistitem0002"><label>•</label><p id="para0002">Useful for simulating river warming or cooling due to urban development or greening.</p></list-item><list-item id="celistitem0003"><label>•</label><p id="para0003">Well documented source code compatible with requirements of other modeling groups.</p></list-item></list></p>
    </abstract>
    <abstract abstract-type="graphical" id="abs0002">
      <title>Graphical abstract</title>
      <p>
        <fig id="fig0007" position="anchor">
          <alt-text id="alttx001">Image, graphical abstract</alt-text>
          <graphic xlink:href="fx1"/>
        </fig>
      </p>
    </abstract>
    <kwd-group id="keys0001">
      <title>Keywords</title>
      <kwd>Thermal pollution</kwd>
      <kwd>Aquatic thermal habitat</kwd>
      <kwd>Mechanistic model</kwd>
      <kwd>Energy balance</kwd>
    </kwd-group>
  </article-meta>
</front>
<body>
  <p id="para0004">
    <table-wrap position="float" id="utbl0001">
      <caption>
        <p>Specifications table</p>
      </caption>
      <table frame="hsides" rules="groups">
        <tbody>
          <tr>
            <td valign="top">Subject Area</td>
            <td valign="top">Environmental Science</td>
          </tr>
          <tr>
            <td valign="top">More specific subject area</td>
            <td valign="top"><italic>[Describe narrower subject area]</italic> River water quality</td>
          </tr>
          <tr>
            <td valign="top">Method name</td>
            <td valign="top"><italic>[Please specify a name of the method that you customized]</italic> i-Tree Cool River</td>
          </tr>
          <tr>
            <td valign="top">Name and reference of original method</td>
            <td valign="top">
              <italic>[If applicable, include full bibliographic details of the main reference(s) describing the original method from which the new method was derived.]</italic>
              <list list-type="simple" id="celist0002">
                <list-item id="celistitem0004">
                  <label>•</label>
                  <p id="para0005">Martin, J.L.; McCutcheon, S.C. Hydrodynamics and Transport for Water Quality Modeling; Lewis Publishers: New York, NY, USA, 1999.</p>
                </list-item>
                <list-item id="celistitem0005">
                  <label>•</label>
                  <p id="para0006">Boyd, M.; Kasper, B. Analytical Methods for Dynamic Open Channel Heat and Mass Transfer: Methodology for Heat Source Model Version 7.0; Watershed Sciences Inc.: Portland, OR, USA, 2003.</p>
                </list-item>
                <list-item id="celistitem0006">
                  <label>•</label>
                  <p id="para0007">Chen, Y.D.; Carsel, R.F.; McCutcheon, S.C.; Nutter, W.L. Stream temperature simulation of forested riparian areas: I. Watershed-Scale model development. J. Environ. Eng. 1998.</p>
                </list-item>
              </list>
            </td>
          </tr>
          <tr>
            <td valign="top">Resource availability</td>
            <td valign="top">
              <ext-link ext-link-type="uri" xlink:href="http://www.itreetools.org/research_suite/coolriver" id="interref0033">http://www.itreetools.org/research_suite/coolriver</ext-link>
            </td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
  </p>
  <sec id="sec0001">
    <title>Method details</title>
    <sec id="sec0002">
      <title>Model description</title>
      <p id="para0008">The i-Tree Cool River model's main equation for simulating the river temperature is based on an advection-dispersion relationship which includes the impacts of the lateral inflows and heat fluxes affecting the simulated river temperature <xref rid="bib0001" ref-type="bibr">[1]</xref>, <xref rid="bib0002" ref-type="bibr">[2]</xref>, <xref rid="bib0003" ref-type="bibr">[3]</xref>:<disp-formula id="eqn0001"><label>(1)</label><mml:math id="M1" altimg="si1.svg"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:msub><mml:mi>T</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo linebreak="goodbreak">=</mml:mo><mml:mo>−</mml:mo><mml:mi>U</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:msub><mml:mi>T</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msub><mml:mi>T</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>h</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula>where <italic>T<sub>w</sub></italic> is the cross-sectional averaged river temperature (°C), <italic>t</italic> is time in the simulation (s), <italic>U</italic> is the reach average flow velocity (m/s), <italic>∂x</italic> is river cross-sectional intervals (m), <italic>D<sub>L</sub></italic> is the dispersion coefficient (m<sup>2</sup>/s), <italic>R<sub>h</sub></italic> is the heat flux reaction term, and <italic>R<sub>i</sub></italic> is the reaction term of the external inflows. Combining the reaction term, <italic>R<sub>i</sub></italic>, with the first (advection) and second (dispersion) terms in the right-hand side in the <xref rid="eqn0001" ref-type="disp-formula">Eq. (1)</xref>, altogether define the mass transfer [<xref rid="bib0002" ref-type="bibr">2</xref>,<xref rid="bib0003" ref-type="bibr">3</xref>,<xref rid="bib0004" ref-type="bibr">4]</xref>. The <italic>R<sub>h</sub></italic> and <italic>R<sub>i</sub></italic> are defined as:<disp-formula id="eqn0002"><label>(2)</label><mml:math id="M2" altimg="si2.svg"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>h</mml:mi></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mfrac><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi>ρ</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula><disp-formula id="eqn0003"><label>(3)</label><mml:math id="M3" altimg="si3.svg"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mi>W</mml:mi></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mi>W</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>G</mml:mi><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>G</mml:mi><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>H</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>H</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>G</mml:mi><mml:mi>W</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>H</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo linebreak="goodbreak">−</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula>where Φ<sub><italic>net</italic></sub> is the net thermal energy (W/m<sup>2</sup>), <italic>ρ</italic> is the water density as 1000 (kg/m<sup>3</sup>), <italic>C<sub>p</sub></italic> is the specific heat capacity of water which is defined as 4182 (J/kg °C), <italic>y</italic> is the average water column depth (m), <italic>Q</italic> is the discharge (m<sup>3</sup>/s), <italic>T</italic> is water temperature (°C), given that the subscripts <italic>W</italic> represents the river, <italic>GW</italic> represents the groundwater, <italic>Hyp</italic> represents the hyporheic exchange, and <italic>SS</italic> represents the stormwater inflow. In the <xref rid="eqn0003" ref-type="disp-formula">Eq. (3)</xref> the <italic>t-1</italic> refers to the prior time step. For surface inflows in <xref rid="eqn0003" ref-type="disp-formula">Eq. (3)</xref> represented by the subscript <italic>SS</italic>, the users can include an unlimited number of surface inflows for each cross-section.</p>
      <p id="para0009">The i-Tree Cool River Model uses inputs of river discharge to solve for the advection and dispersion terms in <xref rid="eqn0001" ref-type="disp-formula">Eq. (1)</xref> as well as solve for the inflow reaction term, <italic>R<sub>i</sub></italic> in <xref rid="eqn0001" ref-type="disp-formula">Eqs. (1)</xref> and <xref rid="eqn0003" ref-type="disp-formula">(3)</xref>. In unsteady conditions, such as during a storm event, the model determines river velocity and dispersion using the one-dimensional St. Venant equation, which is solved numerically using the finite difference method given in <xref rid="eqn0003" ref-type="disp-formula">Eqs. (3</xref>)–(<xref rid="eqn0025" ref-type="disp-formula">25</xref>) to (<xref rid="eqn0003" ref-type="disp-formula">3</xref>)–(<xref rid="eqn0029" ref-type="disp-formula">29</xref>) by Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref>. This St. Venant finite difference method uses the Manning equation to relate velocity with river water depth, wetted perimeter, and cross-sectional area. The Manning equation operates in trapezoidal, triangular, or square channels with prescribed width, roughness, and side slope. The i-Tree Cool River model uses a version of the Manning equation provided by Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref> in <xref rid="eqn0003" ref-type="disp-formula">Eq. (3</xref>)–(<xref rid="eqn0011" ref-type="disp-formula">11</xref>) <xref rid="bib0003" ref-type="bibr">[3]</xref>. The Newton-Raphson root-finding iterative method is used to solve the Manning equation and determine the adjusted wetted depth, hydraulic radius, wetted perimeter, cross-sectional area, and bottom width <xref rid="bib0002" ref-type="bibr">[2]</xref>. The i-Tree Cool River model uses the estimated velocity with the MacCormick method to determine the rate at which river water temperature travels between cross-sections, using <xref rid="eqn0002" ref-type="disp-formula">Eqs. (2</xref>-119) to (<xref rid="eqn0002" ref-type="disp-formula">2</xref>-122) from Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref>. The St. Venant finite difference method requires compliance with Courant and frictional stability conditions for each node every timestep, using <xref rid="eqn0003" ref-type="disp-formula">Eqs. (3</xref>-<xref rid="eqn0030" ref-type="disp-formula">30</xref>) and (<xref rid="eqn0003" ref-type="disp-formula">3</xref>-31) of Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref>. In steady-state conditions, the model can determine velocity and dispersion using the St. Venant method, as done by Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref>, or the user can select the Crank-Nicolson numerical method [<xref rid="bib0005" ref-type="bibr">5</xref>,<xref rid="bib0006" ref-type="bibr">6]</xref> to solve a coupled set of velocity and temperature equations <xref rid="bib0003" ref-type="bibr">[3]</xref>.</p>
      <p id="para0010">Inflows are composed of surface and subsurface sources. The surface inflow terms, <italic>Q<sub>ss</sub></italic> and <italic>T<sub>ss</sub></italic> of <xref rid="eqn0003" ref-type="disp-formula">Eq. (3)</xref> are input as a time series of flow rate (m<sup>3</sup>/s) and temperature (°C), respectively, for any node receiving storm sewer, tributary, or other surface inflows. The flow and temperature values are either provided through measured observation or through estimation. The subsurface terms for groundwater inflow, <italic>Q<sub>GW</sub></italic> and <italic>T<sub>GW</sub></italic> of <xref rid="eqn0003" ref-type="disp-formula">Eq. (3)</xref> are input as a time series of groundwater flow rate (m<sup>3</sup>/s) and temperature ( °C) for each node and can be based on observation or estimation. The groundwater temperature is set to a constant value based on a function of annual average air temperature warming slightly in the summertime and cooling slightly in the wintertime as suggested in the literature <xref rid="bib0006" ref-type="bibr">[6]</xref>. Groundwater inflow is determined from observation, or based on measuring baseflow at the upstream (station at the 0 m) and downstream (station at the end of the reach) sections during dry weather<sub>,</sub> and computing the inflow rate per unit length of the reach. The subsurface hyporheic flow rate (m<sup>3</sup>/s), <italic>Q<sub>Hyp,</sub></italic> and hyporheic flow temperature (°C), <italic>T<sub>Hyp</sub></italic> terms of <xref rid="eqn0003" ref-type="disp-formula">Eq. (3)</xref> for each node can be based on observation or estimation. Similar to groundwater flow, the hyporheic temperature is set to the constant value. The hyporheic inflow is calculated in the model based on the Darcy Law <xref rid="bib0007" ref-type="bibr">[7]</xref> as<disp-formula id="eqn0004"><label>(4)</label><mml:math id="M4" altimg="si4.svg"><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>H</mml:mi><mml:mi>y</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:msub><mml:mi>K</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>h</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where <italic>A<sub>S</sub></italic> is cross-sectional across seepage face (m<sup>2</sup>), <italic>K<sub>S</sub></italic> is dominant substrate hydraulic conductivity (m/s), <italic>h<sub>D</sub></italic> is hydraulic head for Darcy calculation (m), and <italic>x</italic> is the model distance step (m).</p>
      <p id="para0011">The net exchange of thermal energy in <xref rid="eqn0002" ref-type="disp-formula">Eq. (2)</xref> is defined as a combination of energy fluxes as in Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref> as<disp-formula id="eqn0005"><label>(5)</label><mml:math id="M5" altimg="si5.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula>where theΦ is the heat flux (W/m<sup>2</sup>), and subscripts <italic><sub>net</sub></italic> is the net heat flux at the water surface, <italic><sub>longwave</sub></italic> is the longwave radiation flux at the water surface, <italic><sub>shortwave</sub></italic> is the shortwave radiation at the water surface, <italic><sub>latent</sub></italic> is the latent heat flux from evaporation, <italic><sub>sensible</sub></italic> is the sensible heat flux representing the convective thermal flux from the water surface, and <italic><sub>sediment</sub></italic> is the bed sediment heat flux representing conduction forcing at the water column interface <xref rid="bib0003" ref-type="bibr">[3]</xref>.</p>
    </sec>
    <sec id="sec0003">
      <title>Longwave radiation flux</title>
      <p id="para0012">The longwave radiation flux in <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref> includes three terms determining positive downward fluxes from the atmosphere and land cover over the water surface, and a negative upward flux from the waterbody to the air [<xref rid="bib0002" ref-type="bibr">2</xref>,<xref rid="bib0003" ref-type="bibr">3]</xref><disp-formula id="eqn0006"><label>(6)</label><mml:math id="M6" altimg="si6.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">+</mml:mo><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mtext>cov</mml:mtext><mml:mi>e</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">+</mml:mo><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M7" altimg="si7.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is the atmospheric flux (W/m<sup>2</sup>), <inline-formula><mml:math id="M8" altimg="si8.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mtext>cov</mml:mtext><mml:mi>e</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is the land cover flux (W/m<sup>2</sup>), and <inline-formula><mml:math id="M9" altimg="si9.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is the back-to-air flux (W/m<sup>2</sup>). Atmospheric longwave radiation is a function of air temperature and exposure from the river surface to the atmosphere, called the view-to-sky factor (<italic>f</italic>), calculated using Boyd et al. [27]<disp-formula id="eqn0007"><label>(7)</label><mml:math id="M10" altimg="si10.svg"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">=</mml:mo><mml:mn>0.96</mml:mn><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mi>σ</mml:mi><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>273.2</mml:mn><mml:mo>)</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:msup><mml:mi>min</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mrow/><mml:msub><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mrow/><mml:msub><mml:mi>f</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>T<sub>air</sub></italic> is air temperature ( °C), the ɛ<sub><italic>atm</italic></sub> is the emissivity of the atmosphere (0 to 1), <italic>σ</italic> is the Stefan-Boltzmann constant (5.6696 × 10<sup>−8</sup>, W/m<sup>2</sup>K<sup>4</sup>), and min(<italic>f</italic><sub>1</sub><italic>, f</italic><sub>2</sub><italic>, f</italic><sub>3</sub>) is the minimum of the three view-to-sky factors (0 to 1), including the <italic>f</italic><sub>1</sub> as the building effects, the <italic>f</italic><sub>2</sub> as the vegetation effects, and the <italic>f</italic><sub>3</sub> as the topographic effects (<xref rid="fig0001" ref-type="fig">Fig. 1</xref>). The emissivity of the atmosphere ɛ<sub><italic>atm</italic></sub> is calculated using <xref rid="bib0008" ref-type="bibr">[8]</xref><disp-formula id="eqn0008"><label>(8)</label><mml:math id="M11" altimg="si11.svg"><mml:mrow><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mn>1.72</mml:mn><mml:msup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mn>0.1</mml:mn><mml:msub><mml:mi>e</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>273.2</mml:mn></mml:mrow></mml:mfrac><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>7</mml:mn></mml:mfrac></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">+</mml:mo><mml:mn>0.22</mml:mn><mml:msup><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>e<sub>a</sub></italic> is the actual vapor pressure (mbar) and <italic>C<sub>L</sub></italic> is the cloudiness factor, which ranges from 0 for a clear sky to 1 for full cloud cover and can be found from the weather station data or can be estimated from comparison between the solar radiation in the edge of the atmosphere and on the ground <xref rid="bib0009" ref-type="bibr">[9]</xref>.<fig id="fig0001"><label>Fig. 1</label><caption><p>Schematic of a river cross-section where the BSA, TSA, and VSA terms are shading angles due to building, topography, and vegetation respectively. h<sub>building</sub>, h<sub>tree</sub>, and h<sub>bank</sub> are building, vegetation, and bank heights respectively and the D<sub>building</sub>, D<sub>canopy</sub>, and D<sub>bank</sub> terms are the distances of the building, canopy, and bank respectively to the edge of the water.</p></caption><alt-text id="alt0001">Fig 1</alt-text><graphic xlink:href="gr1"/></fig></p>
      <p id="para0013">The view-to-sky factors with a value of 1 indicate a full unobstructed sky view and with 0 indicates a blocked condition for the solar radiation <xref rid="bib0002" ref-type="bibr">[2</xref>,<xref rid="bib0010" ref-type="bibr">10]</xref>. The general sky-view-factor formula for <italic>f<sub>i</sub></italic> is computed for all the cross-sections with the determined interval <xref rid="bib0011" ref-type="bibr">[11]</xref><disp-formula id="eqn0009"><label>(9)</label><mml:math id="M12" altimg="si12.svg"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="goodbreak">−</mml:mo><mml:mfrac><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mfrac><mml:mi>S</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula>where <italic>i</italic> indicates the object at that cross-section (1 for the building, 2 for the vegetation, and 3 for the topography), and <italic>SA</italic> is the shade angle (radians), computed as and <italic>h<sub>c</sub></italic> is the combined height of the objects above the water (e.g., if a tree is set on a hill, <italic>h<sub>c</sub></italic> = <italic>h<sub>tree</sub></italic> + <italic>h<sub>bank</sub></italic>), and max (<italic>D<sub>i</sub></italic>) is the maximum distance from all objects at that cross-section to the edge of the water.<disp-formula id="eqn0010"><label>(10)</label><mml:math id="M13" altimg="si13.svg"><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msup><mml:mi>tan</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mfrac><mml:msub><mml:mi>h</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mrow><mml:mi>max</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p id="para0014">The landcover longwave radiation in <xref rid="eqn0006" ref-type="disp-formula">Eq. (6)</xref> also uses the view-to-sky factor parameters as in <xref rid="eqn0007" ref-type="disp-formula">Eq. (7)</xref>. The land cover radiation flux represents the land cover effect, e.g., vegetation cover's influence on water temperature in the form of longwave radiation. The model by default sets land cover temperature equal to atmospheric temperature, following the approach of Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref><disp-formula id="eqn0011"><label>(11)</label><mml:math id="M14" altimg="si14.svg"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mtext>cov</mml:mtext><mml:mi>e</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">=</mml:mo><mml:mn>0.96</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mi>min</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mrow/><mml:msub><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mrow/><mml:msub><mml:mi>f</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>0.96</mml:mn><mml:mi>σ</mml:mi><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>273.2</mml:mn><mml:mo>)</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:math></disp-formula></p>
      <p id="para0015">The waterbody to air radiation term in <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref> is a function of water temperature, representing heat flux emitted from the water surface, following the approach of Boyd and Kasper <xref rid="bib0002" ref-type="bibr">[2]</xref><disp-formula id="eqn0012"><label>(12)</label><mml:math id="M15" altimg="si15.svg"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">=</mml:mo><mml:mo>−</mml:mo><mml:mn>0.96</mml:mn><mml:mi>σ</mml:mi><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>273.2</mml:mn><mml:mo>)</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:math></disp-formula>where the <italic>T<sub>W</sub></italic> is the river temperature ( °C).</p>
      <sec id="sec0004">
        <title>Shortwave radiation (first method)</title>
        <p id="para0016">The model provides two methods for calculating shortwave radiation. The first method calculates the total shortwave radiation in <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref> is a function of the incoming solar radiation <xref rid="bib0012" ref-type="bibr">[12]</xref>, based on the albedo and a shading factor, which is based on the riparian vegetation condition along the river corridor [<xref rid="bib0006" ref-type="bibr">6</xref>,<xref rid="bib0011" ref-type="bibr">11]</xref><disp-formula id="eqn0013"><label>(13)</label><mml:math id="M16" altimg="si16.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mi>S</mml:mi><mml:mi>F</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where S<sub>in</sub> is incoming shortwave radiation, as the sum of direct and diffuse shortwave radiations, <italic>a</italic> is the albedo (ranging from 0 to 1), and <italic>SF</italic> is the estimated shading factor (0 to 1, with 1 for complete shade).</p>
      </sec>
      <sec id="sec0005">
        <title>Shortwave radiation (second method)</title>
        <p id="para0017">The second method for evaluating the shortwave radiation combines the adjusted direct and diffuse shortwave radiation and uses sky view factors (discussed in section 1.1) and shading width in place of a shading factor <xref rid="bib0003" ref-type="bibr">[3</xref>,<xref rid="bib0015" ref-type="bibr">15]</xref><disp-formula id="eqn0014"><label>(14)</label><mml:math id="M17" altimg="si17.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">+</mml:mo><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></disp-formula></p>
        <p id="para0018">The view-to-sky factor is applied to compute the topographic shading effect on diffuse solar radiation (<inline-formula><mml:math id="M18" altimg="si18.svg"><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>) [<xref rid="bib0011" ref-type="bibr">11</xref>,<xref rid="bib0015" ref-type="bibr">15]</xref><disp-formula id="eqn0015"><label>(15)</label><mml:math id="M19" altimg="si19.svg"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">=</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>min</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mrow/><mml:msub><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mrow/><mml:msub><mml:mi>f</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p id="para0019">Direct shortwave radiation is computed using a two-step adjustment process, accounting for the width of shade across the river surface, and the river slope and aspect, as well as the slope, aspect, solar azimuth, as well as solar altitude <xref rid="bib0013" ref-type="bibr">[13]</xref><disp-formula id="eqn0016"><label>(16)</label><mml:math id="M20" altimg="si20.svg"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">=</mml:mo><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mfrac><mml:msub><mml:mrow><mml:msup><mml:mi>W</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>W’<sub>eff</sub></italic> is the width of the effective shading and <italic>W<sub>river</sub></italic> is the river section wetted width. The width of the effective shading and river section wetted width are explained in the next paragraph. The adjusted shortwave radiation (<inline-formula><mml:math id="M21" altimg="si21.svg"><mml:msubsup><mml:mrow><mml:msup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>) is calculated as <xref rid="bib0013" ref-type="bibr">[13]</xref><disp-formula id="eqn0017"><label>(17)</label><mml:math id="M22" altimg="si22.svg"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo linebreak="goodbreak">=</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mi>sin</mml:mi><mml:mi>α</mml:mi><mml:mi>cos</mml:mi><mml:mi>φ</mml:mi><mml:mi>cos</mml:mi><mml:mo>(</mml:mo><mml:mi>β</mml:mi><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mtext>sun</mml:mtext></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:mi>cos</mml:mi><mml:mi>α</mml:mi><mml:mi>sin</mml:mi><mml:mi>φ</mml:mi><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M23" altimg="si23.svg"><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> is the incoming direct shortwave radiation can be imported to the model as an input file, <italic>α</italic> is the longitudinal water surface slope (radians), <italic>β</italic> is the aspect with considering the 0 as the true north (radians), <italic>θ<sub>sun</sub></italic> is solar azimuth angle (radians), indicating the angle of the position of the sun relative to true north, and <italic>φ</italic> is solar altitude (radians). The second method for calculating shortwave radiation can reduce to the first method, in cases of full shade and full sun. For the case of full sun, the shade angle, <italic>SA</italic> = 0 and <italic>f<sub>i</sub></italic> = 1, resulting in <inline-formula><mml:math id="M24" altimg="si24.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>= <inline-formula><mml:math id="M25" altimg="si25.svg"><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi><mml:mi>u</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for <xref rid="eqn0014" ref-type="disp-formula">Eq. (14)</xref>, and the complementary term for the <inline-formula><mml:math id="M26" altimg="si26.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>, becomes <inline-formula><mml:math id="M27" altimg="si27.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>= <inline-formula><mml:math id="M28" altimg="si28.svg"><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> when φ = <italic>π/2</italic> in <xref rid="eqn0017" ref-type="disp-formula">Eq. (17)</xref> and <inline-formula><mml:math id="M29" altimg="si29.svg"><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:math></inline-formula>= 0 in <xref rid="eqn0016" ref-type="disp-formula">Eq. (16)</xref>. For the case of full shade, the corollary occurs, with <italic>SA</italic> = 1 and <italic>f<sub>i</sub></italic> = 0, and <inline-formula><mml:math id="M30" altimg="si29.svg"><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:math></inline-formula>= <italic>W<sub>river</sub></italic> in <xref rid="eqn0015" ref-type="disp-formula">Eq. (15)</xref>, resulting in no solar radiation on the river.</p>
        <p id="para0020">The total width for the shading in the river cross-section, <italic>W<sub>shade</sub></italic>, caused by near river objects, is calculated at each time step as a function of solar azimuth, altitude, and river azimuth (<italic>θ<sub>river</sub></italic>), in addition to object height at each node <xref rid="bib0013" ref-type="bibr">[13]</xref><disp-formula id="eqn0018"><label>(18)</label><mml:math id="M31" altimg="si30.svg"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:mfrac><mml:mrow><mml:mi>sin</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>u</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>tan</mml:mi><mml:mi>φ</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true">|</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where the <italic>h<sub>i</sub></italic> is the combined height of the topography and building or vegetation bordering the river (<italic>i</italic> = 3) depending on the cross-sectional condition. When building and vegetation are present, the object is selected based on which has the largest shade angle <italic>SA</italic> from <xref rid="eqn0010" ref-type="disp-formula">Eq. (10)</xref>. The river width and distance from river to the shading object are compared with <italic>W<sub>shade</sub></italic> to determine the distances across the river cross-section surface covered in shade and to determine the width of river effectively shaded (<italic>W<sub>eff</sub></italic>) and the width of the river directly under an overhanging object, <italic>W<sub>overhang</sub></italic> such as tree canopy <xref rid="bib0011" ref-type="bibr">[11]</xref>. The model estimates the tree canopy width protruding from the tree trunk midpoint as 10% of the tree height base on the suggestion by Chen et al., <xref rid="bib0011" ref-type="bibr">[11]</xref>. The overhang is computed for either left or right banks as <xref rid="bib0011" ref-type="bibr">[11]</xref><disp-formula id="eqn0019"><label>(19)</label><mml:math id="M32" altimg="si31.svg"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.1</mml:mn><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mtext>if</mml:mtext></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.1</mml:mn><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak="badbreak">&lt;</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mtext>if</mml:mtext></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>0.1</mml:mn><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>≥</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>ρ<sub>veg</sub></italic>is the average density of the vegetation canopy, which ranges from 0 to 1 (unitless) and should be determined by the user. The effective shading width is computed using Beer's Law as <xref rid="bib0011" ref-type="bibr">[11]</xref><disp-formula id="eqn0020"><label>(20)</label><mml:math id="M33" altimg="si32.svg"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:mrow/><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo linebreak="badbreak">−</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mtext>if</mml:mtext></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="badbreak">&gt;</mml:mo><mml:mi>S</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:mrow/><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mtext>if</mml:mtext></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo linebreak="badbreak">&gt;</mml:mo><mml:mi>S</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>λ</italic>, the radiation extinction coefficient, is calculated as a function of the leaf area index, <italic>LAI</italic> from the <xref rid="eqn0002" ref-type="disp-formula">Eq. (2)</xref> of <xref rid="bib0014" ref-type="bibr">[14]</xref> and <italic>L<sub>avg</sub></italic> is the average path length of direct solar radiation through the shaded zone around the river (m) <xref rid="bib0013" ref-type="bibr">[13]</xref>. When canopy overhangs the river surface, the model uses an adjusted effective width <inline-formula><mml:math id="M34" altimg="si29.svg"><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:math></inline-formula> computed as<disp-formula id="eqn0021"><label>(21)</label><mml:math id="M35" altimg="si33.svg"><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mo linebreak="goodbreak">=</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:mrow/><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p>
        <p id="para0021">Using the adjusted direct radiation affected by topographic shading (<inline-formula><mml:math id="M36" altimg="si27.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula>) and the calculated adjusted effective width, the net direct solar radiation affected by the topographic and shading barriers reaching to the surface,<inline-formula><mml:math id="M37" altimg="si26.svg"><mml:msubsup><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi><mml:mi>w</mml:mi><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow/><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> can be calculated as shown in <xref rid="eqn0014" ref-type="disp-formula">Eq. (14)</xref>
<xref rid="bib0013" ref-type="bibr">[13]</xref>.</p>
      </sec>
    </sec>
    <sec id="sec0006">
      <title>Latent heat flux</title>
      <p id="para0022">The latent heat flux in <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref> is a negative upward flux representing evaporative cooling [<xref rid="bib0010" ref-type="bibr">10</xref>,<xref rid="bib0015" ref-type="bibr">15]</xref>. The latent heat flux is computed as <xref rid="bib0002" ref-type="bibr">[2]</xref><disp-formula id="eqn0022"><label>(22)</label><mml:math id="M38" altimg="si34.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:msub><mml:mi>L</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mi>E</mml:mi></mml:mrow></mml:math></disp-formula>where <italic>L<sub>e</sub></italic> is the latent heat of vaporization (J/kg), and <italic>E</italic> is the evaporation rate (m/s). The i-Tree Cool River Model provides two methods for calculation of <italic>E</italic> from open water, the Penman-Monteith combination method using <xref rid="eqn0030" ref-type="disp-formula">Eq. (30)</xref> of <xref rid="bib0010" ref-type="bibr">[10]</xref>, and a mass transfer method using <xref rid="eqn0002" ref-type="disp-formula">Eq. (2</xref>-96) of <xref rid="bib0002" ref-type="bibr">[2]</xref>.</p>
    </sec>
    <sec id="sec0007">
      <title>Sensible heat flux</title>
      <p id="para0023">Sensible convection of heat in <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref> represents the heat exchange between the surface of the water and the air <xref rid="bib0015" ref-type="bibr">[15]</xref>. The i-Tree Cool River Model provides three flexible methods to calculate the sensible heat flux, first and second methods (<xref rid="eqn0023" ref-type="disp-formula">Eqs. (23)</xref> and <xref rid="eqn0024" ref-type="disp-formula">24</xref>) based on the Bowen ratio of sensible to latent heat, and the third method (<xref rid="eqn0025" ref-type="disp-formula">Eq. (25)</xref>) based on the sensible heat. The simpler of the two Bowen ratio methods is based on <xref rid="bib0002" ref-type="bibr">[2]</xref><disp-formula id="eqn0023"><label>(23)</label><mml:math id="M39" altimg="si35.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msub><mml:mi>B</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula>where <italic>Br</italic> is the Bowen ratio. The more complex of the Bowen ratio methods is based on <xref rid="bib0016" ref-type="bibr">[16]</xref><disp-formula id="eqn0024"><label>(24)</label><mml:math id="M40" altimg="si36.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:msub><mml:mi>B</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:msub><mml:mi>ρ</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mi>γ</mml:mi><mml:mi>N</mml:mi><mml:msub><mml:mi>U</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:mrow/><mml:msub><mml:mi>T</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>γ</italic> is the latent heat of vaporization (2.4995 × 10<sup>6</sup> J/kg), <italic>N</italic> is an empirical constant (1.59 × 10<sup>−9</sup> s/m.mb) and <italic>U<sub>wind</sub></italic> is wind speed (m/s). The sensible-heat-based method considers wind speed as a driver of the convective flux, based on <xref rid="bib0009" ref-type="bibr">[9]</xref>, given by <xref rid="bib0002" ref-type="bibr">[2]</xref> as<disp-formula id="eqn0025"><label>(25)</label><mml:math id="M41" altimg="si37.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>b</mml:mi><mml:mi>l</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>H</mml:mi></mml:msub><mml:msub><mml:mi>U</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo linebreak="badbreak">−</mml:mo><mml:mrow/><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>K<sub>H</sub></italic> is the heat exchange coefficient for sensible heat (J/ m<sup>3 o</sup>C).</p>
    </sec>
    <sec id="sec0008">
      <title>Bed sediment heat flux</title>
      <p id="para0024">The bed sediment heat flux in <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref> represents the heat conduction between the bed sediment and the water column in the cross-section and is rate limited by the size and conductance properties of the substrate. The approach used in the i-Tree Cool River model modifies <xref rid="eqn0002" ref-type="disp-formula">Eq. (2</xref>-90) of <xref rid="bib0002" ref-type="bibr">[2]</xref> as<disp-formula id="eqn0026"><label>(26)</label><mml:math id="M42" altimg="si38.svg"><mml:mrow><mml:msub><mml:mstyle mathvariant="normal"><mml:mi>Φ</mml:mi></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>dim</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>K</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow/><mml:msub><mml:mi>T</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:mrow><mml:mfrac><mml:msub><mml:mi>d</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:mfrac></mml:mfrac></mml:mrow></mml:math></disp-formula> where <italic>K<sub>CL</sub></italic> is the volumetric weighted thermal conductivity (J/ms °C), <italic>T<sub>bed</sub></italic> is the bed temperature (°C), and <italic>d<sub>w</sub></italic> is the average river depth in the cross-section (m). The sediment interface with the river water is the <italic>T<sub>bed</sub></italic> in <xref rid="eqn0026" ref-type="disp-formula">Eq. (26)</xref>; some applications prescribe <italic>T<sub>bed</sub></italic> to a depth below the interface. The mid-depth of the river, <italic>d<sub>W</sub>/2,</italic> is used in <xref rid="eqn0026" ref-type="disp-formula">Eq. (26)</xref> to represent a mid-point of the river water temperature reservoir. By solving for the heat fluxes of <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref>, the i-Tree Cool River model can solve <xref rid="eqn0002" ref-type="disp-formula">Eq. (2)</xref> and provide the heat flux reaction term, <italic>R<sub>e</sub></italic>, for the governing advection-dispersion-reaction <xref rid="eqn0001" ref-type="disp-formula">Eq. (1)</xref> used to simulate river temperatures.</p>
    </sec>
  </sec>
  <sec id="sec0009">
    <title>Coupling the i-Tree cool river model with the HEC-RAS</title>
    <p id="para0026">For coupling the i-Tree Cool River model <xref rid="bib0003" ref-type="bibr">[3]</xref> with the HEC-RAS <xref rid="bib0017" ref-type="bibr">[17]</xref>, <xref rid="eqn0001" ref-type="disp-formula">Eq. (1)</xref> was updated to include HEC-RAS model river water surface materials as <xref rid="bib0019" ref-type="bibr">[19]</xref><disp-formula id="eqn0027"><label>(27)</label><mml:math id="M43" altimg="si39.svg"><mml:mrow><mml:mi>T</mml:mi><mml:mo linebreak="goodbreak">=</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo linebreak="goodbreak">+</mml:mo><mml:mstyle mathvariant="normal"><mml:mi>Δ</mml:mi></mml:mstyle><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mstyle mathvariant="normal"><mml:mi>Δ</mml:mi></mml:mstyle><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mstyle mathvariant="normal"><mml:mi>Δ</mml:mi></mml:mstyle><mml:mi>x</mml:mi></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfrac></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>h</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula>where similar to <xref rid="eqn0001" ref-type="disp-formula">Eq. (1)</xref>, <italic>T</italic> (°C) is the temperature at a river cross-section, the superscript <italic>t-1</italic> indicates the prior time, <italic>∆t</italic> (s) is the time step, the subscript <italic>up</italic> indicates the upstream cross-section, the subscript <italic>dn</italic> indicates the downstream cross-section, <italic>V</italic> (m/s) is the cross-section velocity, <italic>∆x</italic> (m) is the length of the reach segment bounded by the cross-section and upstream cross-section, <italic>D<sub>L</sub></italic> (m<sup>2</sup>/s) is the reach longitudinal dispersion computed as a function of cross-section velocity and depth, <italic>R<sub>h</sub></italic> (°C) is the loss or gain (i.e., reaction term) of temperature due to heat flux, and <italic>R<sub>i</sub></italic> (°C) is the loss or gain of temperature due to lateral inflows <xref rid="bib0003" ref-type="bibr">[3</xref>,<xref rid="bib0017" ref-type="bibr">17]</xref>. The velocity is determined by a separate set of hydraulic equations, which in steady-state mode involves simultaneously estimating depth and velocity to satisfy the conservation of energy, mass, and momentum, i.e., the 5-step algorithm used in HEC-RAS <xref rid="bib0017" ref-type="bibr">[17]</xref>, which is an alternative to the Newton-Raphson algorithm used in i-Tree Cool River <xref rid="bib0018" ref-type="bibr">[18</xref>,<xref rid="bib0019" ref-type="bibr">19]</xref>.</p>
    <p id="para0027">To combine the i-Tree Cool River with the HEC-RAS model simulation of water surface profiles, <xref rid="eqn0027" ref-type="disp-formula">Eq. (27)</xref> was modified to include the velocity and discharge data from the HEC-RAS model. To that end, the retention time was added to the equation in order to apply the HEC-RAS model calculated velocity data <xref rid="bib0018" ref-type="bibr">[18</xref>,<xref rid="bib0019" ref-type="bibr">19]</xref>.<disp-formula id="eqn0028"><label>(28)</label><mml:math id="M44" altimg="si40.svg"><mml:mrow><mml:mi>T</mml:mi><mml:mo linebreak="goodbreak">=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:msubsup><mml:mi>T</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mstyle mathvariant="normal"><mml:mi>Δ</mml:mi></mml:mstyle><mml:msub><mml:mi>t</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>h</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>Q</mml:mi></mml:mfrac><mml:mo linebreak="goodbreak">+</mml:mo><mml:mfrac><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mi>Q</mml:mi></mml:mfrac></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M45" altimg="si41.svg"><mml:msubsup><mml:mi>T</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:math></inline-formula> is the temperature of the upstream cross-section at the prior time step, <italic>∆t<sub>r</sub></italic> (s) is the retention time step defined as <inline-formula><mml:math id="M46" altimg="si42.svg"><mml:mrow><mml:mstyle mathvariant="normal"><mml:mi>Δ</mml:mi></mml:mstyle><mml:msub><mml:mi>t</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mstyle mathvariant="normal"><mml:mi>Δ</mml:mi></mml:mstyle><mml:mi>x</mml:mi><mml:mo linebreak="goodbreak">/</mml:mo><mml:mi>V</mml:mi></mml:mrow></mml:math></inline-formula>and <italic>V</italic> (m/s) is the HEC-RAS velocity at the cross-section, <italic>Q</italic> (m<sup>3</sup>/s) is the HEC-RAS discharge at the cross-section, and <italic>R<sub>h</sub></italic><sub>2</sub> is the heat flux reaction term, and <italic>R<sub>i2</sub></italic> is lateral inflows reaction term. An updated heat flux reaction term was considered for <xref rid="eqn0028" ref-type="disp-formula">Eq. (28)</xref>
<xref rid="bib0018" ref-type="bibr">[18</xref>,<xref rid="bib0019" ref-type="bibr">19]</xref>,<disp-formula id="eqn0029"><label>(29)</label><mml:math id="M47" altimg="si43.svg"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>h</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mfrac><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>·</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo linebreak="badbreak">−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mfrac><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>·</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mi>y</mml:mi><mml:mo>·</mml:mo><mml:mi>V</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>·</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mrow><mml:mstyle mathvariant="normal"><mml:mi>Δ</mml:mi></mml:mstyle><mml:mi>x</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic>φ</italic> is defined to include the i-Tree Cool River model tree-based terms (e.g. <xref rid="eqn0005" ref-type="disp-formula">Eq. (5)</xref>). The lateral inflows reaction term equation also was updated as <xref rid="bib0018" ref-type="bibr">[18</xref>,<xref rid="bib0019" ref-type="bibr">19]</xref>,<disp-formula id="eqn0030"><label>(30)</label><mml:math id="M48" altimg="si44.svg"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo linebreak="goodbreak">=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where subscripts a, b, and c are defined as the i-Tree Cool River form with <xref rid="eqn0003" ref-type="disp-formula">Eq. (3)</xref> above.</p>
    <p id="para0028">Considering this set of the formulation, we coupled the i-Tree Cool River model with the HEC-RAS model in order to utilize water surface profile data from the HEC-RAS model and thereby coordinate evaluations of thermal and flood management impacts. By coupling the hydraulic transport model of HEC-RAS with the temperature transport model of i-Tree Cool River, <xref rid="eqn0028" ref-type="disp-formula">Eq. (28)</xref> can lead to differences in the volume of water predicted by the two transport models. This difference is due to the first right-hand side term in <xref rid="eqn0028" ref-type="disp-formula">Eq. (28)</xref> representing temperature transport as plug flow, with upstream temperature from the prior time step replacing downstream temperature in the current time step, even when upstream and downstream volumes may not be equal for each reach segment. To avoid this continuity error, the i-Tree Cool River model maintains the HEC-RAS model volume for each reach segment and uses a cross-section spacing of 5 m or less to constrain the error in the temperature estimate <xref rid="bib0018" ref-type="bibr">[18</xref>,<xref rid="bib0019" ref-type="bibr">19]</xref>.</p>
  </sec>
  <sec id="sec0010">
    <title>Model inputs</title>
    <p id="para0029">The i-Tree Cool River Model uses a set of input data including upstream boundary condition, steady or unsteady discharge hydrograph for the river and lateral storm sewer inflows, groundwater and hyporheic exchange data, streambed temperature, meteorological data, etc. for the simulation process, which can be imported to the model using the DAT files (the input data for temperature modeling in time and space) and the XML file (which includes the initial necessary data for the beginning of the simulation). The i-Tree Cool River model has a function to linearly interpolate the input data based on the defined ∆x and ∆t and the input files can be imported at different intervals. The name of the required input files and a brief description for each input file represented in <xref rid="tbl0001" ref-type="table">Table 1</xref>. Input files contain three TXT files including the impervious cover, land cover, and tree cover which are converted from raster to ASCⅡ and are not effective in the simulation process of the i-Tree Cool River model. <xref rid="tbl0002" ref-type="table">Table 2</xref> presents the alternative methods for obtaining the input data for the i-Tree Cool River model input data. <xref rid="tbl0003" ref-type="table">Table 3</xref> also represents the description of the initial parameters which are imported to the model in the XML file. More information such as sample inputs and outputs as well as a detailed manual can be downloaded at <ext-link ext-link-type="uri" xlink:href="http://www.itreetools.org/research_suite/coolriver/" id="interref0034">http://www.itreetools.org/research_suite/coolriver/</ext-link>.<table-wrap position="float" id="tbl0001"><label>Table 1</label><caption><p>List of the input files required for the simulation process of the i-Tree Cool River Model.</p></caption><alt-text id="alt0007">Table 1</alt-text><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="top">Input file</th><th valign="top">The parameter name</th><th valign="top">Description</th></tr></thead><tbody><tr><td align="left" rowspan="8" valign="top">BedData.dat</td><td valign="top">Number</td><td valign="top">The number of observations indicates the locations of the observed streambed data.</td></tr><tr><td valign="top">Distance (m)</td><td valign="top">Distances through the river reach where the streambed observations are recorded.</td></tr><tr><td valign="top">Depth of Measurement (m)</td><td valign="top">Depth at which groundwater temperatures are recorded in each cross-section</td></tr><tr><td valign="top">GW_Temp (°C)</td><td valign="top">Groundwater temperature in the downstream.</td></tr><tr><td valign="top">Type</td><td valign="top">Bed-sediment type which can be clay, silt, sand, or gravel.</td></tr><tr><td valign="top">Horizontal Bed Conductivity (mm/s)</td><td valign="top">Horizontal effective thermal conductivity in each observed cross-section.</td></tr><tr><td valign="top">Bed Particle Size (mm)</td><td valign="top">Bed particle size (Bedient and Huber, 1992, Rosgen, 1996) in the observed location.</td></tr><tr><td valign="top">Embeddedness (fraction)</td><td valign="top">Embeddedness in each considered cross-section.</td></tr><tr><td align="left" valign="top">DEM.txt</td><td colspan="2" align="left" valign="top">Elevation data for calculating slope and aspect for calculating the hillslope effect on energy flux which can be converted from raster file to ASCІІ in Arc Map. The raw DEM data can be downloaded from the <underline>National Map Viewer</underline>.</td></tr><tr><td align="left" rowspan="3" valign="top">Discharge.dat</td><td valign="top">Number</td><td valign="top">The number of observations indicates the locations of the observed groundwater data.</td></tr><tr><td valign="top">Distance (m)</td><td valign="top">Distances through the river reach where the magnitude of groundwater flow is recorded</td></tr><tr><td valign="top">Q_GW (cms)</td><td valign="top">Groundwater discharge.</td></tr><tr><td align="left" rowspan="8" valign="top">Inflow.dat*</td><td valign="top">Number</td><td valign="top">The number of observations which indicates the number of the time steps for the hydrographs of the river and lateral inflows.</td></tr><tr><td valign="top">Inflow Rate Storm (cms)</td><td valign="top">Discharge rates of the river in upstream at each timestep defining the hydrograph in steady or unsteady mode.</td></tr><tr><td valign="top">Inflow Temp Storm (°C)</td><td valign="top">Observed stream temperatures corresponding to the river hydrograph timesteps in upstream.</td></tr><tr><td valign="top">Inflow Rate 1 (cms)</td><td valign="top">Discharge rates of the lateral storm sewer inflow at each timestep for the first location defining the hydrograph in steady or unsteady mode.</td></tr><tr><td valign="top">Inflow Temp 1 (°C)</td><td valign="top">Observed stream temperatures corresponding to the first lateral storm sewer inflow hydrograph timesteps.</td></tr><tr><td valign="top">Inflow Rate 2 (cms)</td><td valign="top">Discharge rates of the lateral storm sewer inflow at each timestep for the second location defining the hydrograph in steady or unsteady mode.</td></tr><tr><td valign="top">Inflow Temp 2 (°C)**</td><td valign="top">Observed stream temperatures corresponding to the second lateral storm sewer inflow hydrograph timesteps.</td></tr><tr><td colspan="2" valign="top">* The First row of the input file below the headings should be considered as the location of each hydrograph. The river's hydrograph gets 1 m indicating the upstream and other lateral inflows receive their own location from the upstream. ** The number of lateral inflows can be changed in the code by the user.</td></tr><tr><td align="left" rowspan="13" valign="top">Morphology.dat</td><td valign="top">Number</td><td valign="top">The number of observations indicates the locations of the measured geomorphic data.</td></tr><tr><td valign="top">Distance (m)</td><td valign="top">Distances through the river reach corresponding with the cross-sections where the geomorphic data are recorded.</td></tr><tr><td valign="top">Area (m<sup>2</sup>)</td><td valign="top">The initial cross-sectional wetted area of the river channel; dummy variable.</td></tr><tr><td valign="top">Width (m)</td><td valign="top">Channel bottom width.</td></tr><tr><td valign="top">Depth (m)</td><td valign="top">Initial channel water depth.</td></tr><tr><td valign="top">Discharge (cms)</td><td valign="top">River discharge magnitude at the location where the geometric data are measured.</td></tr><tr><td valign="top">Slope</td><td valign="top">Channel longitudinal slope</td></tr><tr><td valign="top">Row#**</td><td valign="top">The row number in the DEM file where the cross-section is located.</td></tr><tr><td valign="top">Column#**</td><td valign="top">The column number in the DEM file where the cross-section is located.</td></tr><tr><td valign="top">Longitude (deg)**</td><td valign="top">Longitude of the cross-section in the geographic coordinate system.</td></tr><tr><td valign="top">Latitude (deg)**</td><td valign="top">Latitude of the cross-section in the geographic coordinate system.</td></tr><tr><td valign="top">Z (H:V)</td><td valign="top">The side slope of the trapezoidal channel, equivalent to horizontal distance to vertical distance ratio. Same value for both channel sides.</td></tr><tr><td colspan="2" valign="top">** These input data are required for calculating the slope and aspect of each cell to apply the values on the hillslope effect and the shortwave radiation. In case of using fixed magnitudes for the shade factor and view-to-sky values, these values are not effective in the simulation process.</td></tr><tr><td align="left" rowspan="19" valign="top">Shading.dat*</td><td valign="top">Number</td><td valign="top">The number of observations reflecting the locations of the measured shading information.</td></tr><tr><td valign="top">Distance (m)</td><td valign="top">Distances through the river reach corresponding with the cross-sections where the shading information is recorded.</td></tr><tr><td valign="top">EastBankH (m)</td><td valign="top">The height of the bankfull<xref rid="tb1fn1" ref-type="table-fn">a</xref> at the measured cross-section on the Eastside.</td></tr><tr><td valign="top">EastTreeH (m)</td><td valign="top">The height of the canopy at the measured cross-section on the Eastside.</td></tr><tr><td valign="top">EastBuildingH (m)</td><td valign="top">The height of the building at the measured cross-section on the Eastside.</td></tr><tr><td valign="top">EastBankDist (m)</td><td valign="top">Distance from the bankfull to the edge of the water at the measured cross-section on the Eastside.</td></tr><tr><td valign="top">EastCanDist (m)</td><td valign="top">Distance from the canopy to the edge of the water at the measured cross-section on the Eastside.</td></tr><tr><td valign="top">EastBuildingDist (m)</td><td valign="top">Distance from the building to edge of the water at the measured cross-section on the Eastside.</td></tr><tr><td valign="top">EastBufferW (m)</td><td valign="top">The magnitude of the canopy buffer at the location of the measured cross-section on the Westside</td></tr><tr><td valign="top">WestBankH (m)</td><td valign="top">The height of the bankfull at the measured cross-section in the Westside.</td></tr><tr><td valign="top">WestTreeH (m)</td><td valign="top">The height of the canopy at the measured cross-section on the Westside.</td></tr><tr><td valign="top">WestBuildingH (m)</td><td valign="top">The height of the building at the measured cross-section on the Westside.</td></tr><tr><td valign="top">WestBankDist (m)</td><td valign="top">Distance from the bankfull to the edge of the water at the measured cross-section on the Westside.</td></tr><tr><td valign="top">WestCanDist (m)</td><td valign="top">Distance from the canopy to the edge of the water at the measured cross-section on the Westside.</td></tr><tr><td valign="top">WestBuildingDist (m)</td><td valign="top">Distance from the building to edge of the water at the measured cross-section on the Westside.</td></tr><tr><td valign="top">WestBufferW (m)</td><td valign="top">The magnitude of the canopy buffer at the location of the measured cross-section on the Westside</td></tr><tr><td valign="top">Elevation (m)</td><td valign="top">The elevation of the cross-section.</td></tr><tr><td valign="top">StreamAzimuth (deg)</td><td valign="top">The stream azimuth at the location of the measured cross-section.</td></tr><tr><td colspan="2" align="left" valign="top">* These input data are required for calculating the topographic, canopy (tree), and building shade angle and view-to-sky factor to apply the values to the hillslope effect and the shortwave radiation. In case of using fixed magnitudes for the shading factor and view-to-sky values, these values are not effective in the simulation process.</td></tr><tr><td align="left" rowspan="5" valign="top">ShadingPercent.dat*</td><td valign="top">Number</td><td valign="top">The number of observations reflecting the locations of the shading factors.</td></tr><tr><td valign="top">Distance (m)</td><td valign="top">Distances through the river reach corresponding with the cross-sections where the shading factor and the view-to-sky values are calculated.</td></tr><tr><td valign="top">ShadeFactor</td><td valign="top">The value of cross-section shade factor for daily average, with 0 for no shading, and 1 for full shading. This is representative of the entire channel, and can be the average for right and left banks. It can be estimated using site visits, aerial photos, or best estimates.</td></tr><tr><td valign="top">View-to-Sky</td><td valign="top">The value of View-to-Sky in the desired cross-section which is 1-ShadeFactor</td></tr><tr><td colspan="2" align="left" valign="top">* In case the topographic, canopy, and building heights and distances are considered for shading calculations, the magnitude of ShadeFactor and View-to-Sky are not effective in the simulation process.</td></tr><tr><td align="left" rowspan="5" valign="top">SolarRadiation.dat*<break/> The number of entries in this file should match the attribute value of totTime in the config file (see <xref rid="tbl0002" ref-type="table">Table 2</xref>)</td><td valign="top">yyyymmdd</td><td valign="top">The date of the simulation period.</td></tr><tr><td valign="top">Hr: Min: Sec</td><td valign="top">The time of the simulation period.</td></tr><tr><td valign="top">DirSW (W/m<sup>2</sup>)</td><td valign="top">Direct shortwave radiation at the edge of the atmosphere.</td></tr><tr><td valign="top">DiffSW (W/m<sup>2</sup>)</td><td valign="top">Diffuse shortwave radiation at the edge of the atmosphere.</td></tr><tr><td colspan="2" align="left" valign="top">* Source: National Solar Radiation Database (NSRDB)</td></tr><tr><td align="left" rowspan="2" valign="top">Time.dat</td><td valign="top">Number</td><td valign="top">The number of time steps.</td></tr><tr><td valign="top">Time (s)</td><td valign="top">The desired time step for the output intervals.</td></tr><tr><td align="left" rowspan="10" valign="top">Weather.dat* The number of entries in this file should match the attribute value of totTime in the config file (see <xref rid="tbl0002" ref-type="table">Table 2</xref>)</td><td valign="top">yyyymmdd</td><td valign="top">The date of the simulation period.</td></tr><tr><td valign="top">Hr: Min: Sec</td><td valign="top">The time of the simulation period.</td></tr><tr><td valign="top">Tair (F)</td><td valign="top">Air temperature.</td></tr><tr><td valign="top">WndSpd (m/s)</td><td valign="top">Wind speed.</td></tr><tr><td valign="top">Precip (m/h)</td><td valign="top">Precipitation rate.</td></tr><tr><td valign="top">Cloudiness</td><td valign="top">The magnitude of the cloudiness.</td></tr><tr><td valign="top">Humidity</td><td valign="top">Relative humidity.</td></tr><tr><td valign="top">obsT_x0 ( °C)</td><td valign="top">Observed river temperature in the upstream.</td></tr><tr><td valign="top">sedT ( °C)</td><td valign="top">Riverbed temperature.</td></tr><tr><td colspan="2" align="left" valign="top">* National Center for Environmental Information</td></tr></tbody></table><table-wrap-foot><fn id="tb1fn1"><label>a</label><p id="notep0001">The water level, or stage, at which a stream, river or lake is at the top of its banks and any further rise would result in water moving into the flood plain.</p></fn></table-wrap-foot></table-wrap><table-wrap position="float" id="tbl0002"><label>Table 2</label><caption><p>The alternative methods for obtaining the input data for the i-Tree Cool River model input data.</p></caption><alt-text id="alt0008">Table 2</alt-text><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="top">Input file</th><th valign="top">Parameter</th><th valign="top">Explanation / Obtaining method</th><th valign="top">Alternative Obtaining method/website</th></tr></thead><tbody><tr><td align="left" rowspan="6" valign="top">BedData.dat</td><td valign="top">Depth of Measurement (m)</td><td valign="top">Typically set to 2 m below the bed for measurement of groundwater temperature.</td><td valign="top"/></tr><tr><td valign="top">GW_Temp (°C)</td><td valign="top">At 2 m depth is estimated as average annual air temperature, possibly with seasonal adjustment.</td><td valign="top">NOAA's NCDC database:<break/><ext-link ext-link-type="uri" xlink:href="https://gis.ncdc.noaa.gov/maps/ncei/" id="interref0002">https://gis.ncdc.noaa.gov/maps/ncei/</ext-link><break/>or National Solar Radiation Database:<break/><ext-link ext-link-type="uri" xlink:href="https://rredc.nrel.gov/solar/old_data/nsrdb/" id="interref0003">https://rredc.nrel.gov/solar/old_data/nsrdb/</ext-link></td></tr><tr><td valign="top">Type</td><td valign="top">Bed substrate material type is based on the estimate of site visit and is selected from a range of 4 types within model code: cobble, gravel, sand, clay</td><td valign="top"/></tr><tr><td valign="top">Horizontal Bed Conductivity (mm/s)</td><td valign="top">Values are associated with bed substrate material type and can be set based on hydrology reference materials or site testing. Boyd and Kasper (2003) has values for these.</td><td valign="top"/></tr><tr><td valign="top">Bed Particle Size (mm)</td><td valign="top">Values are associated with bed substrate material type and can be set based on hydrology reference materials or site testing. Boyd and Kasper (2003) has values for these.</td><td valign="top"/></tr><tr><td valign="top">Embeddedness (fraction)</td><td valign="top">Values are associated with bed substrate material type and can be set based on morphology reference materials or site testing. Boyd and Kasper (2003) has values for these.</td><td valign="top"/></tr><tr><td align="left" valign="top">DEM.txt</td><td valign="top"/><td valign="top">Extent of DEM can extend out to entire watershed or be limited to the river corridor, and used tp compute hillslope effect on energy flux.</td><td valign="top">National Map Viewer:<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/advanced-viewer/" id="interref0004">https://viewer.nationalmap.gov/advanced-viewer/</ext-link>Google Engine:<break/><ext-link ext-link-type="uri" xlink:href="https://earthengine.google.com/" id="interref0005">https://earthengine.google.com/</ext-link></td></tr><tr><td align="left" valign="top">Discharge.dat</td><td valign="top">Q_GW (cms)</td><td valign="top">Estimated as the difference in discharge at the downstream and upstream section of the reach. The discharge at each end of the reach could be from i-Tree Hydro simulations, observation, or USGS StreamStats.</td><td valign="top">USGS's Stream stats:<break/><ext-link ext-link-type="uri" xlink:href="https://streamstats.usgs.gov/ss/" id="interref0006">https://streamstats.usgs.gov/ss/</ext-link></td></tr><tr><td align="left" rowspan="2" valign="top">Inflow.dat</td><td valign="top">Inflow Rate (cms)</td><td valign="top">Lateral flow from steady or unsteady state, and is either estimated or observed. Estimates could come from i-Tree Hydro model simulation.</td><td valign="top">SWMM:<break/><ext-link ext-link-type="uri" xlink:href="https://www.epa.gov/water-research/storm-water-management-model-swmm" id="interref0007">https://www.epa.gov/water-research/storm-water-management-model-swmm</ext-link></td></tr><tr><td valign="top">Inflow Temp (°C)</td><td valign="top">Estimate or observation, for steady or unsteady state. Anticipate a new algorithm could be added to Unified Hydro (w/ Cool Air) to simulate this value.</td><td valign="top">A non-linear regression equation based on air temperature: Mohseni et al., (1998)<break/><ext-link ext-link-type="uri" xlink:href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/98WR01877" id="interref0008">https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/98WR01877</ext-link></td></tr><tr><td align="left" rowspan="9" valign="top">Morphology.dat used for 3 model options: Crank Nicholson, Runge Cutta, or Explicit Finite Difference. Not used in model option: HEC-RAS. Alternatively use: HecRasData.dat, which contains: downstream distance (between cross-sections); discharge; minimum channel elevation; water surface elevation; velocity; area; top width; water surface slope; wetted perimeter. All of these outputs are generated by HEC-RAS as SI units.</td><td valign="top">Distance (m)</td><td valign="top">Distances to downstream channel cross-sections. Estimated based on map or site analysis such as NHD, or based on systematic intervals.</td><td valign="top">National Hydrography Data:<break/><ext-link ext-link-type="uri" xlink:href="https://www.usgs.gov/core-science-systems/ngp/national-hydrography" id="interref0009">https://www.usgs.gov/core-science-systems/ngp/national-hydrography</ext-link><break/>National Map Viewer:<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/advanced-viewer/" id="interref0010">https://viewer.nationalmap.gov/advanced-viewer/</ext-link> Google Engine:<break/><ext-link ext-link-type="uri" xlink:href="https://earthengine.google.com/" id="interref0011">https://earthengine.google.com/</ext-link></td></tr><tr><td valign="top">Area (m<sup>2</sup>)</td><td valign="top">Initial value of the cross-sectional area, dummy variable not used by the model.</td><td valign="top"/></tr><tr><td valign="top">Width (m)</td><td valign="top">Cross-sectional bottom width for trapezoidal channel (0 value for triangular). Could be estimated: a) using field surveys; or b) using a modification of hydraulic geometry relations to get channel geometry at bankfull based on the watershed area, which is provided by some USGS SteamStats sites and NHD - scale values for lower flow.</td><td valign="top"/></tr><tr><td valign="top">Depth (m)</td><td valign="top">Initial time step of water depth. Could be estimated: a) using field surveys; or b) using a modification of hydraulic geometry relations to get channel geometry at bankfull based on the watershed area, which is provided by some USGS SteamStats sites and NHD - scale values for lower flow.</td><td valign="top"/></tr><tr><td valign="top">Discharge (cms)</td><td valign="top">Upstream boundary flow from steady or unsteady state and is either estimated or observed. Estimates could come from i-Tree Hydro model simulation.</td><td valign="top"/></tr><tr><td valign="top">Slope</td><td valign="top">Longitudinal bed slope. Could be estimated: a) using field surveys; b) using DEM analysis, or c) USGS SteamStats sites and NHD.</td><td valign="top">USGS's Stream stats:<break/><ext-link ext-link-type="uri" xlink:href="https://streamstats.usgs.gov/ss/" id="interref0012">https://streamstats.usgs.gov/ss/</ext-link></td></tr><tr><td valign="top">Row#</td><td valign="top">Associated with the DEM.txt input, and is input row number (0 is the first row) of each river cross-section. Used to compute slope and aspect for radiation estimates. Could estimate from observation or overlaying NHD image of the river on DEM in ArcGIS.</td><td valign="top">National Map Viewer:<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/advanced-viewer/" id="interref0013">https://viewer.nationalmap.gov/advanced-viewer/</ext-link><break/>Google Engine:<break/><ext-link ext-link-type="uri" xlink:href="https://earthengine.google.com/" id="interref0014">https://earthengine.google.com/</ext-link></td></tr><tr><td valign="top">Column#</td><td valign="top">Associated with the DEM.txt input, and is input column number (0 is the first column) of each river cross-section. Used to compute slope and aspect for radiation estimates. Could estimate from observation or overlaying NHD image of the river on DEM in ArcGIS.</td><td valign="top">National Map Viewer:<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/advanced-viewer/" id="interref0015">https://viewer.nationalmap.gov/advanced-viewer/</ext-link><break/>Google Engine:<break/><ext-link ext-link-type="uri" xlink:href="https://earthengine.google.com/" id="interref0016">https://earthengine.google.com/</ext-link></td></tr><tr><td valign="top">Longitude (deg)</td><td valign="top">Associated with each river cross-section. It may not vary with short river. Could estimate from observation or map analysis.</td><td valign="top">National Map Viewer:<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/advanced-viewer/" id="interref0017">https://viewer.nationalmap.gov/advanced-viewer/</ext-link><break/>Google Engine:<break/><ext-link ext-link-type="uri" xlink:href="https://earthengine.google.com/" id="interref0018">https://earthengine.google.com/</ext-link></td></tr><tr><td/><td valign="top">Latitude (deg)</td><td valign="top">Associated with each river cross-section. It may not vary with short river. Could estimate from observation or map analysis.</td><td valign="top">National Map Viewer:<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/advanced-viewer/" id="interref0019">https://viewer.nationalmap.gov/advanced-viewer/</ext-link><break/>Google Engine:<break/><ext-link ext-link-type="uri" xlink:href="https://earthengine.google.com/" id="interref0020">https://earthengine.google.com/</ext-link></td></tr><tr><td/><td valign="top">Z (H:V)</td><td valign="top">Channel side slope for trapezoidal channel banks, the same value used on each bank. Could estimate from field observation, design decision, or image analysis.</td><td valign="top">National Map Viewer:<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/advanced-viewer/" id="interref0021">https://viewer.nationalmap.gov/advanced-viewer/</ext-link><break/>Google Engine:<break/><ext-link ext-link-type="uri" xlink:href="https://earthengine.google.com/" id="interref0022">https://earthengine.google.com/</ext-link></td></tr><tr><td align="left" valign="top">Shading.dat</td><td valign="top">All the parameters</td><td valign="top">All the parameters for this input data (2nd method of calculating the longwave and shortwave radiations) are based on direct measurements at the field sites or of maps and images.</td><td valign="top">Lidar surveying data (if it is available)<break/><ext-link ext-link-type="uri" xlink:href="https://viewer.nationalmap.gov/basic/" id="interref0023">https://viewer.nationalmap.gov/basic/</ext-link><break/><ext-link ext-link-type="uri" xlink:href="https://gisgeography.com/top-6-free-lidar-data-sources/" id="interref0024">https://gisgeography.com/top-6-free-lidar-data-sources/</ext-link></td></tr><tr><td align="left" rowspan="2" valign="top">ShadingPercent.dat</td><td valign="top">ShadeFactor</td><td valign="top">The value of cross-section shade factor for daily average, with 0 for no shading, and 1 for full shading. This is representative of the entire channel, and can be the average for right and left banks. It can be estimated using: a) site visits; b) aerial photos with the manual interpretation or TTools module in Heat Source Model; or c) scenario estimates.</td><td valign="top">The heat source model's TTools module:<break/><ext-link ext-link-type="uri" xlink:href="https://www.oregon.gov/deq/wq/tmdls/Pages/TMDLs-Tools.aspx" id="interref0025">https://www.oregon.gov/deq/wq/tmdls/Pages/TMDLs-Tools.aspx</ext-link></td></tr><tr><td valign="top">View-to-Sky</td><td valign="top">The value of View-to-Sky in the desired cross-section which is 1-ShadeFactor</td><td valign="top"/></tr><tr><td align="left" valign="top">SolarRadiation.dat</td><td valign="top">Direct and Diffuse shortwave radiation data</td><td valign="top">National Solar Radiation Database:<break/><ext-link ext-link-type="uri" xlink:href="https://rredc.nrel.gov/solar/old_data/nsrdb/" id="interref0026">https://rredc.nrel.gov/solar/old_data/nsrdb/</ext-link></td><td valign="top">i-Tree Hydro preprocessor:</td></tr><tr><td align="left" valign="top">Time.dat</td><td valign="top">Time (s)</td><td valign="top">The desired time step for the output data intervals.</td><td valign="top"/></tr><tr><td align="left" rowspan="7" valign="top">Weather.dat</td><td valign="top">Tair (F)</td><td valign="top">Weather input data of air temperature</td><td valign="top">NOAA's NCDC database:<break/><ext-link ext-link-type="uri" xlink:href="https://gis.ncdc.noaa.gov/maps/ncei/" id="interref0027">https://gis.ncdc.noaa.gov/maps/ncei/</ext-link><break/>National Solar Radiation Database:<break/><ext-link ext-link-type="uri" xlink:href="https://rredc.nrel.gov/solar/old_data/nsrdb/" id="interref0028">https://rredc.nrel.gov/solar/old_data/nsrdb/</ext-link></td></tr><tr><td valign="top">WndSpd (m/s)</td><td valign="top">Weather input data of wind speed</td><td valign="top"/></tr><tr><td valign="top">Precip (m/h)</td><td valign="top">Weather input data of precipitation</td><td valign="top"/></tr><tr><td valign="top">Cloudiness</td><td valign="top">Weather input data of cloudiness</td><td valign="top"/></tr><tr><td valign="top">Humidity</td><td valign="top">Weather input data of humidity</td><td valign="top"/></tr><tr><td valign="top">obsT_x0 (°C)</td><td valign="top">Upstream boundary river temperature, for each time step. Estimated with observation or non-linear regression with air temperature.</td><td valign="top">A non-linear regression equation using air temperature: Mohseni et al., (1998)<break/><ext-link ext-link-type="uri" xlink:href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/98WR01877" id="interref0029">https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/98WR01877</ext-link></td></tr><tr><td valign="top">sedT (°C)</td><td valign="top">Channel bed substrate temperature, for each time step. Estimated with observation or model prediction based on solar radiation or temperature data.</td><td valign="top">NOAA's NCDC database:<break/><ext-link ext-link-type="uri" xlink:href="https://gis.ncdc.noaa.gov/maps/ncei/" id="interref0030">https://gis.ncdc.noaa.gov/maps/ncei/</ext-link><break/>National Solar Radiation Database:<break/><ext-link ext-link-type="uri" xlink:href="https://rredc.nrel.gov/solar/old_data/nsrdb/" id="interref0031">https://rredc.nrel.gov/solar/old_data/nsrdb/</ext-link></td></tr></tbody></table></table-wrap><table-wrap position="float" id="tbl0003"><label>Table 3</label><caption><p>List of the parameters which should be specified in the XML file for the simulation process of the i-Tree Cool River Model.</p></caption><alt-text id="alt0009">Table 3</alt-text><table frame="hsides" rules="groups"><thead><tr><th valign="top">Key tags</th><th valign="top">The parameter name</th><th valign="top">Description</th></tr></thead><tbody><tr><td valign="top">Inputs</td><td valign="top">Input_Folder</td><td valign="top">The address of the input folder directory that could be different for every machine.</td></tr><tr><td valign="top">Outputs</td><td valign="top">Output_Folder</td><td valign="top">The address of the output folder directory that could be different for every machine.</td></tr><tr><td valign="top">Temporal_Domain</td><td valign="top">starttime</td><td valign="top">The date of the starting of the simulation in the yyyymmdd format.</td></tr><tr><td valign="top"/><td valign="top">endtime</td><td valign="top">The date of the finishing of the simulation in the yyyymmdd format.</td></tr><tr><td valign="top"/><td valign="top">Timeinterval (h)</td><td valign="top">The intervals of the timesteps in the simulation process.</td></tr><tr><td valign="top"/><td valign="top">startingHour</td><td valign="top">The starting hour of the simulation process.</td></tr><tr><td valign="top"/><td valign="top">SWMethod</td><td valign="top">The code of the desired method for calculating the shortwave and longwave radiation energy fluxes:<list list-type="simple" id="celist0007"><list-item id="celistitem0014"><label>•</label><p id="para0046">Number 1 is for solving shortwave and longwave radiation fluxes based on the sky-to-view factor shading angles calculated from the provided heights and distances of the hillslope, vegetation, and building.</p></list-item><list-item id="celistitem0015"><label>•</label><p id="para0047">Number 2 is for solving shortwave and longwave radiation fluxes based on the fixed values for sky-to-view and shading factors.</p></list-item></list></td></tr><tr><td valign="top"/><td valign="top">initialTemp</td><td valign="top">The observed river temperature of the upstream cross-section at the first timestep.</td></tr><tr><td valign="top"/><td valign="top">canDensity</td><td valign="top">The density of the vegetation in the study area.</td></tr><tr><td valign="top"/><td valign="top">roughness</td><td valign="top">Manning's roughness coefficient (n).</td></tr><tr><td valign="top"/><td valign="top">LAI</td><td valign="top">The magnitude of the leaf area index in the study area.</td></tr><tr><td valign="top">Shading_inputs</td><td valign="top">tarLat</td><td valign="top">Representative latitude of the study area.</td></tr><tr><td valign="top"/><td valign="top">tarLong</td><td valign="top">Representative longitude of the study area.</td></tr><tr><td valign="top"/><td valign="top">tarRow</td><td valign="top">The row number of the representative cell of the study area.</td></tr><tr><td valign="top"/><td valign="top">tarCol</td><td valign="top">The column number of the representative cell of the study area.</td></tr><tr><td valign="top"/><td valign="top">standardMeridian</td><td valign="top">The meridian ranking of the time zone in the study area.</td></tr><tr><td valign="top"/><td valign="top">totDist</td><td valign="top">The total distance of the river.</td></tr><tr><td valign="top"/><td valign="top">calcMethod</td><td valign="top">The desired method to calculate the river temperature<break/>1: Solution Method=Crank-Nicolson<break/>2: Solution Method=Explicit finite difference<break/>3: Solution Method=HEC-RAS based method<break/>4: Solution Method=Rung-Kutta</td></tr><tr><td valign="top"/><td valign="top">depthOfBed</td><td valign="top">The measured or assumed depth of the river bed</td></tr><tr><td valign="top"/><td valign="top">totTime</td><td valign="top">A total number of the simulation process in an hour.</td></tr><tr><td valign="top"/><td valign="top">sensMethod</td><td valign="top">The code of the desired method for calculating the sensible heat flux:<break/>1: The method as a function of the wind speed (See Eq. S14, Abdi &amp; Endreny 2019)<break/>2: The method as a function of Bowen ration and latent heat (See Eq. S12, Abdi &amp; Endreny 2019)<break/>3: The method as a function of Bowen ratio, latent heat, and an empirical constant described in Sun et al., (2015) (See Eq. S13, Abdi &amp; Endreny 2019)</td></tr><tr><td valign="top"/><td valign="top">Sediment_method</td><td valign="top">The method for calculating the sediment flux<break/>1: Solving sediment flux based on RBM model<break/>2: Solving sediment flux based on Heat Source model (for HEC-RAS based method)</td></tr><tr><td valign="top">Unsteady_inputs</td><td valign="top">dx</td><td valign="top">The considered distance (Δx) for the numerical finite difference method.</td></tr><tr><td valign="top"/><td valign="top">dt</td><td valign="top">The considered timestep (Δt) for the numerical finite difference method.</td></tr></tbody></table></table-wrap></p>
  </sec>
  <sec id="sec0011">
    <title>Model outputs</title>
    <p id="para0030">After the simulation process, the i-Tree Cool River model generates four comma-separated-value (CSV) files for the predicted temperatures and the net value of the heat flux in minute and hour based intervals (<xref rid="tbl0004" ref-type="table">Table 4</xref>). The CSV files are two-dimensional vectors in which each row shows each meter of the river reach and each column represents each timestep of the running process. The user can add extra output files in the code as well.<table-wrap position="float" id="tbl0004"><label>Table 4</label><caption><p>List of the default outputs created by simulating the i-Tree Cool River Model.</p></caption><alt-text id="alt0010">Table 4</alt-text><table frame="hsides" rules="groups"><thead><tr><th valign="top">Output filename</th><th valign="top">Description</th></tr></thead><tbody><tr><td valign="top">2D_Hourly_Temperature.csv</td><td valign="top">A two-dimensional (2D) matrix including the hourly simulated river temperature. The columns reflect the timestep (∆T) and the rows show the intervals (∆X).</td></tr><tr><td valign="top">2D_Hourly_TotalFlux</td><td valign="top">A two-dimensional (2D) matrix including the hourly simulated total flux as a combination of the longwave, shortwave, latent, sensible, and sediment fluxes. The columns reflect the timestep (∆T) and the rows show the intervals (∆X).</td></tr><tr><td valign="top">2D_Minutely_Temperature</td><td valign="top">A two-dimensional (2D) matrix including the simulated river temperature. The timestep in this output file is one minute and the spatial intervals are one meter. The columns reflect the timestep (∆T) and the rows show the intervals (∆X).</td></tr><tr><td valign="top">2D_Minutely_TotalFlux.csv</td><td valign="top">A two-dimensional (2D) matrix including the simulated total flux as a combination of the longwave, shortwave, latent, sensible, and sediment fluxes. The timestep in this output file is one minute and the spatial intervals are one meter. The columns reflect the timestep (∆T) and the rows show the intervals (∆X).</td></tr></tbody></table></table-wrap></p>
  </sec>
  <sec id="sec0012">
    <title>Running the i-Tree cool river m</title>
    <p id="para0031">We provide an application file (iTreeCoolRiver.exe) in the iTreeCoolRiver_x64/86exe folder (can be downloaded at <ext-link ext-link-type="uri" xlink:href="http://www.itreetools.org/research_suite/coolriver/" id="interref0035">http://www.itreetools.org/research_suite/coolriver/</ext-link>). The model executable is called at the command line along with an extensible markup language (XML) file, which includes the required initial information in the sample input files folder. The target platform for this application is Windows 10. In case of any trouble running this application for a different platform, the users should consider creating a build for their platform (see Compile and Build iTreeCoolRiver via Visual Studio 2017 section). The easiest way to get the application “up and running” is to download the compressed iTreeCoolRiver.exe file (the iTreeCoolRiver_x64/86exe folder) and extract all to the C: drive. (If the user chooses a different location, it will be necessary to edit the Inputs and Outputs tag of the iTreeCoolRiver.xml config file accordingly and specify the correct config location when running the application. See the Input Data section, <xref rid="tbl0002" ref-type="table">Table 2</xref>).</p>
    <p id="para0032">The required steps for running the i-Tree Cool River model:<list list-type="simple" id="celist0003"><list-item id="celistitem0007"><label>•</label><p id="para0033">Uncompress the “iTreeCoolRiver_x64exe.zip” file to “c:\iTreeCoolRiver (<xref rid="fig0002" ref-type="fig">Fig. 2</xref>)<fig id="fig0002"><label>Fig. 2</label><caption><p>Uncompressing the “iTreeCoolRiver_x64exe.zip” file to get access to the executable file.</p></caption><alt-text id="alt0002">Fig 2</alt-text><graphic xlink:href="gr2"/></fig></p></list-item><list-item id="celistitem0008"><label>•</label><p id="para0034">Uncompress the “iTreeCoolRiver_SampleData.zip” file to “c:\iTreeCoolRiver”, creating “C:\iTreeCoolRiver\ExampleInputs” and C:\iTreeCoolRiver\ ExampleOutputs (<xref rid="fig0003" ref-type="fig">Fig. 3</xref>)<fig id="fig0003"><label>Fig. 3</label><caption><p>Uncompressing the “iTreeCoolRiver_SampleData.zip” file to get the sample input and output folders.</p></caption><alt-text id="alt0003">Fig 3</alt-text><graphic xlink:href="gr3"/></fig></p></list-item><list-item id="celistitem0009"><label>•</label><p id="para0035">To run the model, either<list list-type="simple" id="celist0004"><list-item id="celistitem0010"><label>○</label><p id="para0036">In a DOS Command Prompt navigate to “C:\ iTreeCoolRiver\” and type the name of the executable and the config file and its path: “C:\ iTreeCoolRiver&gt; iTreeCoolRiver.exe C:\ iTreeCoolRiver\iTreeCoolRiver.xml” (<xref rid="fig0004" ref-type="fig">Fig. 4</xref>)<fig id="fig0004"><label>Fig. 4</label><caption><p>Executing the i-Tree Cool River model in a DOS Command Prompt.</p></caption><alt-text id="alt0004">Fig 4</alt-text><graphic xlink:href="gr4"/></fig></p></list-item><list-item id="celistitem0011"><label>○</label><p id="para0037">In a Windows Explorer double click on the iTreeCoolRiver.exe file and a DOS Command Prompt will open, type the config file and path:</p></list-item></list></p></list-item></list><list list-type="simple" id="celist0005"><list-item id="celistitem0012"><p id="para0038">“C:\ iTreeCoolRiver\iTreeCoolRiver.xml (<xref rid="fig0005" ref-type="fig">Fig. 5</xref>)<fig id="fig0005"><label>Fig. 5</label><caption><p>Executing the i-Tree Cool River model in a Windows Explorer.</p></caption><alt-text id="alt0005">Fig 5</alt-text><graphic xlink:href="gr5"/></fig></p></list-item></list><list list-type="simple" id="celist0006"><list-item id="celistitem0013"><label>•</label><p id="para0039">You will find the output of this run in the ExampleOutputs folder (<xref rid="fig0006" ref-type="fig">Fig. 6</xref>).<fig id="fig0006"><label>Fig. 6</label><caption><p>Outputs after executing the sample input data (see the link <ext-link ext-link-type="uri" xlink:href="http://www.itreetools.org/research_suite/coolriver/" id="interref0001">http://www.itreetools.org/research_suite/coolriver/</ext-link>).</p></caption><alt-text id="alt0006">Fig 6</alt-text><graphic xlink:href="gr6"/></fig></p></list-item></list></p>
    <p id="para0040">The detailed steps for compiling the building the i-Tree Cool River model solution file in Visual Studio 2017 also are described in the model's manual which can be downloaded at <ext-link ext-link-type="uri" xlink:href="http://www.itreetools.org/research_suite/coolriver/" id="interref0036">http://www.itreetools.org/research_suite/coolriver/</ext-link>.</p>
  </sec>
  <sec id="sec0013">
    <title>Method validation</title>
    <p id="para0041">Using the model described in the previous sections, we simulated river water temperature for several rivers in different climates for the steady and unsteady states. We used the i-Tree Cool River model in order to simulate the effects of the riparian vegetation and lateral inflows from different sources including urban storm sewers, hyporheic exchange inflows, and groundwater on river temperature in the unsteady state. The model was tested along 1500 m of a New York mountain river with riparian forest and urban areas during 30 h with two summer storm events in 2007 <xref rid="bib0003" ref-type="bibr">[3</xref>,<xref rid="bib0020" ref-type="bibr">20]</xref>. The model simulated hourly river temperature for 30 h simulation period with a 2-hour rain event in June 11 and 12, 2007 with an R<sup>2</sup> of 0.98. Our simulations showed that the river water temperatures are sensitive to the inflows of storm sewers, subsurface inflows, riparian shading, and upstream boundary condition temperatures for both steady and unsteady conditions. We removed the riparian shading from the simulation and the R<sup>2</sup> decreased 0.88, indicating the importance of riparian shading in river thermal modeling. We also removed the stormwater inflows from the simulation and observed that the R<sup>2</sup> decreased from 0.98 to 0.92, and by removing the subsurface inflows, we saw that the R<sup>2</sup> decreased to 0.94 <xref rid="bib0003" ref-type="bibr">[3</xref>,<xref rid="bib0020" ref-type="bibr">20]</xref>.</p>
    <p id="para0042">We updated our model to couple it with the HEC-RAS as described in section 2 and tested our updates study updates by simulating the impacts of warm surface runoff, lack of riparian forests, and impervious channels that transfer heat and block cool subsurface flows on river water temperature <xref rid="bib0018" ref-type="bibr">[18]</xref> to address the urban river syndrome <xref rid="bib0021" ref-type="bibr">[21]</xref>. We tested the updated i-Tree Cool River model on a 2 km mountain river within the New York City drinking water supply area (Sawmill, SM, Creek in Tannersville, NY), and used for base case and restoration scenarios on the 17.5 km reach of the Los Angeles (LA) River in a 48 h simulation period. The model simulated the LA River average temperature in the base case decreased from 29.5 °C by 0.3 °C when warm surface inflows were converted to cooler groundwater inflows by terrestrial green infrastructure; by 0.7 °C when subsurface hyporheic exchange was increased by removal of armoring and installation of riffle-pool bedforms; by 3.6 °C when riparian forests shaded the river; and by 6.4 °C when floodplain forests were added to riparian forests to cool surface reservoirs and local air temperatures <xref rid="bib0018" ref-type="bibr">[18</xref>,<xref rid="bib0022" ref-type="bibr">22]</xref>. We observed that by applying all four restoration treatments on the model, the average river temperature decreased by 7.2 °C <xref rid="bib0018" ref-type="bibr">[18</xref>,<xref rid="bib0022" ref-type="bibr">22]</xref>.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Declaration of Competing Interests</title>
    <p id="para0044">The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.</p>
  </sec>
</body>
<back>
  <ref-list id="cebibl1">
    <title>References</title>
    <ref id="bib0001">
      <label>1</label>
      <element-citation publication-type="book" id="sbref0001">
        <person-group person-group-type="author">
          <name>
            <surname>Martin</surname>
            <given-names>J.L.</given-names>
          </name>
          <name>
            <surname>McCutcheon</surname>
            <given-names>S.C.</given-names>
          </name>
        </person-group>
        <chapter-title>Hydrodynamics and Transport for Water Quality Modeling</chapter-title>
        <year>1999</year>
        <publisher-name>Lewis Publishers</publisher-name>
        <publisher-loc>New York, NY, USA</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0002">
      <label>2</label>
      <element-citation publication-type="book" id="sbref0002">
        <person-group person-group-type="author">
          <name>
            <surname>Boyd</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Kasper</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <chapter-title>Analytical Methods for Dynamic Open Channel Heat and Mass Transfer: Methodology for Heat Source Model Version 7.0</chapter-title>
        <year>2003</year>
        <publisher-name>Watershed Sciences Inc</publisher-name>
        <publisher-loc>Portland, OR, USA</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0003">
      <label>3</label>
      <element-citation publication-type="journal" id="sbref0003">
        <person-group person-group-type="author">
          <name>
            <surname>Abdi</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Endreny</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>A river temperature model to assist managers in identifying thermal pollution causes and solutions</article-title>
        <source>Water (Basel)</source>
        <volume>11</volume>
        <issue>5</issue>
        <year>2019</year>
        <fpage>1060</fpage>
      </element-citation>
    </ref>
    <ref id="bib0004">
      <label>4</label>
      <element-citation publication-type="book" id="sbref0004">
        <person-group person-group-type="author">
          <name>
            <surname>Wunderlich</surname>
            <given-names>T.E.</given-names>
          </name>
        </person-group>
        <chapter-title>Heat and mass transfer between a water surface and the atmosphere; report no. 14</chapter-title>
        <source>Water Resources Research Laboratory</source>
        <year>1972</year>
        <publisher-name>Tennessee Valley Authority: Norris Tennessee</publisher-name>
        <publisher-loc>TN, USA</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0005">
      <label>5</label>
      <element-citation publication-type="book" id="sbref0005">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Bennett</surname>
            <given-names>G.D.</given-names>
          </name>
        </person-group>
        <chapter-title>Applied Contaminant Transport Modeling</chapter-title>
        <year>1995</year>
        <publisher-name>Van Nostrand Reinhold</publisher-name>
        <publisher-loc>New York, NY</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0006">
      <label>6</label>
      <element-citation publication-type="journal" id="sbref0006">
        <person-group person-group-type="author">
          <name>
            <surname>Glose</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Lautz</surname>
            <given-names>L.K.</given-names>
          </name>
          <name>
            <surname>Baker</surname>
            <given-names>E.A.</given-names>
          </name>
        </person-group>
        <article-title>Stream heat budget modeling with HFLUX: model development, evaluation, and applications across contrasting sites and seasons</article-title>
        <source>Environ. Model. Softw.</source>
        <volume>92</volume>
        <year>2017</year>
        <fpage>213</fpage>
        <lpage>228</lpage>
      </element-citation>
    </ref>
    <ref id="bib0007">
      <label>7</label>
      <element-citation publication-type="book" id="sbref0007">
        <person-group person-group-type="author">
          <name>
            <surname>Domenico</surname>
            <given-names>P.A.</given-names>
          </name>
          <name>
            <surname>Scwartz</surname>
            <given-names>F.W</given-names>
          </name>
        </person-group>
        <chapter-title>Physical and Chemical Hydrogeology</chapter-title>
        <year>1990</year>
        <publisher-name>John Wiley and Sons, Inc</publisher-name>
        <publisher-loc>New York, USA</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0008">
      <label>8</label>
      <element-citation publication-type="journal" id="sbref0008">
        <person-group person-group-type="author">
          <name>
            <surname>Kustas</surname>
            <given-names>W.P.</given-names>
          </name>
          <name>
            <surname>Rango</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Uijlenhoet</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>A simple energy balance algorithm for snowmelt runoff model</article-title>
        <source>Water Resour. Res.</source>
        <volume>30</volume>
        <year>1994</year>
        <fpage>1515</fpage>
        <lpage>1527</lpage>
      </element-citation>
    </ref>
    <ref id="bib0009">
      <label>9</label>
      <element-citation publication-type="book" id="sbref0009">
        <person-group person-group-type="author">
          <name>
            <surname>Dingman</surname>
            <given-names>S.L.</given-names>
          </name>
        </person-group>
        <chapter-title>Physical Hydrology</chapter-title>
        <edition>2nd Ed</edition>
        <year>2002</year>
        <publisher-name>Prentice Hall</publisher-name>
        <publisher-loc>New Jersey, NJ, USA</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0010">
      <label>10</label>
      <element-citation publication-type="journal" id="sbref0010">
        <person-group person-group-type="author">
          <name>
            <surname>Westhoff</surname>
            <given-names>M.C.</given-names>
          </name>
          <name>
            <surname>Savenije</surname>
            <given-names>H.H.G.</given-names>
          </name>
          <name>
            <surname>Luxemburg</surname>
            <given-names>W.M.J.</given-names>
          </name>
          <name>
            <surname>Stelling</surname>
            <given-names>G.S.</given-names>
          </name>
          <name>
            <surname>Van De Giesen</surname>
            <given-names>N.C.</given-names>
          </name>
          <name>
            <surname>Selker</surname>
            <given-names>J.S</given-names>
          </name>
        </person-group>
        <article-title>Sciences a distributed stream temperature model using high-resolution temperature observations</article-title>
        <source>Hydrol. Earth Syst. Sci.</source>
        <volume>11</volume>
        <year>2007</year>
        <fpage>1469</fpage>
        <lpage>1480</lpage>
      </element-citation>
    </ref>
    <ref id="bib0011">
      <label>11</label>
      <element-citation publication-type="journal" id="sbref0011">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>Y.D.</given-names>
          </name>
          <name>
            <surname>Carsel</surname>
            <given-names>R.F.</given-names>
          </name>
          <name>
            <surname>McCutcheon</surname>
            <given-names>S.C.</given-names>
          </name>
          <name>
            <surname>Nutter</surname>
            <given-names>W.L.</given-names>
          </name>
        </person-group>
        <article-title>Stream temperature simulation of forested riparian areas: I. Watershed-scale model development</article-title>
        <source>J. Environ. Eng.</source>
        <volume>124</volume>
        <year>1998</year>
        <fpage>304</fpage>
        <lpage>315</lpage>
      </element-citation>
    </ref>
    <ref id="bib0012">
      <label>12</label>
      <element-citation publication-type="journal" id="sbref0012">
        <person-group person-group-type="author">
          <name>
            <surname>Ouellet</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Secretan</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>St-Hilaire</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Morin</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>Water temperature modelling in a controlled environment: comparative study of heat budget equations</article-title>
        <source>Hydrol. Process.</source>
        <volume>28</volume>
        <year>2017</year>
        <comment>279e292</comment>
      </element-citation>
    </ref>
    <ref id="bib0013">
      <label>13</label>
      <element-citation publication-type="journal" id="sbref0013">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Yearsley</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Voisin</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Lettenmaier</surname>
            <given-names>D.P.</given-names>
          </name>
        </person-group>
        <article-title>A spatially distributed model for the assessment of land use impacts on stream temperature in small urban watersheds</article-title>
        <source>Hydrol. Process.</source>
        <volume>29</volume>
        <year>2015</year>
        <fpage>2331</fpage>
        <lpage>2345</lpage>
      </element-citation>
    </ref>
    <ref id="bib0014">
      <label>14</label>
      <element-citation publication-type="journal" id="sbref0014">
        <person-group person-group-type="author">
          <name>
            <surname>DeWalle</surname>
            <given-names>D.R.</given-names>
          </name>
        </person-group>
        <article-title>Modeling stream shade: riparian buffer height and density as important as buffer width</article-title>
        <source>Journal of the American Water Resources Association</source>
        <volume>46</volume>
        <year>2010</year>
        <fpage>323</fpage>
        <lpage>333</lpage>
      </element-citation>
    </ref>
    <ref id="bib0015">
      <label>15</label>
      <element-citation publication-type="journal" id="sbref0015">
        <person-group person-group-type="author">
          <name>
            <surname>Webb</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Y.</given-names>
          </name>
        </person-group>
        <article-title>Spatial and seasonal variability in the components of the river heat budget</article-title>
        <source>Hydrol. Process.</source>
        <volume>11</volume>
        <year>1997</year>
        <fpage>79</fpage>
        <lpage>101</lpage>
      </element-citation>
    </ref>
    <ref id="bib0016">
      <label>16</label>
      <element-citation publication-type="journal" id="sbref0016">
        <person-group person-group-type="author">
          <name>
            <surname>Yearsley</surname>
            <given-names>J.R.</given-names>
          </name>
        </person-group>
        <article-title>A semi-Lagrangian water temperature model for advection-dominated river systems</article-title>
        <source>Water Resour. Res.</source>
        <volume>45</volume>
        <year>2009</year>
        <fpage>W12405</fpage>
      </element-citation>
    </ref>
    <ref id="bib0017">
      <label>17</label>
      <element-citation publication-type="book" id="sbref0017">
        <person-group person-group-type="author">
          <collab>US Army Corps of Engineers</collab>
        </person-group>
        <chapter-title>Los Angeles River Ecosystem Restoration Feasibility Study</chapter-title>
        <year>2015</year>
        <publisher-name>U.S. Army Corps of Engineers</publisher-name>
        <publisher-loc>Los Angeles District</publisher-loc>
        <fpage>623</fpage>
      </element-citation>
    </ref>
    <ref id="bib0018">
      <label>18</label>
      <element-citation publication-type="book" id="sbref0018">
        <person-group person-group-type="author">
          <name>
            <surname>Abdi</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <chapter-title>Computer Algorithms to Simulate Nature-Based Restoration of Urban River and Storwater Systems</chapter-title>
        <year>2019</year>
        <publisher-name>State University of New York, College of Environmental Science and Forestry (SUNY ESF)</publisher-name>
        <publisher-loc>Syracuse, New York, USA</publisher-loc>
        <comment>P<italic>hD dissertation</italic></comment>
      </element-citation>
    </ref>
    <ref id="bib0019">
      <label>19</label>
      <element-citation publication-type="journal" id="sbref0019">
        <person-group person-group-type="author">
          <name>
            <surname>Abdi</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Endreny</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Nowak</surname>
            <given-names>D.A.</given-names>
          </name>
        </person-group>
        <article-title>Model to integrate analysis of urban river thermal cooling in river restoration</article-title>
        <source>J. Environ. Manage.</source>
        <volume>258</volume>
        <issue>110023</issue>
        <year>2020</year>
      </element-citation>
    </ref>
    <ref id="bib0020">
      <label>20</label>
      <element-citation publication-type="book" id="sbref0020">
        <person-group person-group-type="author">
          <name>
            <surname>Abdi</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Endreny</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <chapter-title>Dynamic River Temperature Simulation of Urban Stormwater Inflows and Riparian Shading in an Urban Forest Landscape</chapter-title>
        <year>2018</year>
        <publisher-name>AGU Fall Meeting</publisher-name>
        <publisher-loc>Washington DC, USA</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0021">
      <label>21</label>
      <element-citation publication-type="book" id="sbref0021">
        <person-group person-group-type="author">
          <name>
            <surname>Nowak</surname>
            <given-names>D.J.</given-names>
          </name>
          <name>
            <surname>Coville</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Endreny</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Abdi</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Van Stan II</surname>
            <given-names>J.T.</given-names>
          </name>
        </person-group>
        <chapter-title>Valuing Urban Tree Impacts on Precipitation Partitioning. Book Chapter</chapter-title>
        <year>2020</year>
        <publisher-name>Springer</publisher-name>
        <publisher-loc>Nature Switzerland</publisher-loc>
      </element-citation>
    </ref>
    <ref id="bib0022">
      <label>22</label>
      <element-citation publication-type="book" id="sbref0022">
        <person-group person-group-type="author">
          <name>
            <surname>Abdi</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Endreny</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Nowak</surname>
            <given-names>D.A.</given-names>
          </name>
        </person-group>
        <chapter-title>Simulation of Nature-Based Management Scenarios For Restoring Thermal Pollution and Flood Risk in Urban Rivers</chapter-title>
        <year>2019</year>
        <publisher-name>AGU Fall Meeting</publisher-name>
        <publisher-loc>San Francisco CA, USA</publisher-loc>
      </element-citation>
    </ref>
  </ref-list>
  <ack id="ack0001">
    <title>Acknowledgments</title>
    <p>This research was supported by the USDA Forest Service Northern Research Station i-Tree grant No. 15-JV-11242308-114. We would like to thank Drs. Omid Mohseni, Laura Lautz, and Ning Sun, as well as Jill Crispell, MS for explaining their models.</p>
  </ack>
</back>
