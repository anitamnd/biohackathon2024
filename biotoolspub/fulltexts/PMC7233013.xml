<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Acta Crystallogr A Found Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Acta Crystallogr A Found Adv</journal-id>
    <journal-id journal-id-type="publisher-id">Acta Cryst. A</journal-id>
    <journal-title-group>
      <journal-title>Acta Crystallographica. Section A, Foundations and Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2053-2733</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7233013</article-id>
    <article-id pub-id-type="pmid">32356787</article-id>
    <article-id pub-id-type="publisher-id">ib5084</article-id>
    <article-id pub-id-type="doi">10.1107/S2053273320001916</article-id>
    <article-id pub-id-type="coden">ACSAD7</article-id>
    <article-id pub-id-type="pii">S2053273320001916</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Papers</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>SPIND-TC</italic>: an indexing method for two-color X-ray diffraction data</article-title>
      <alt-title><italic>SPIND-TC</italic>: indexing two-color diffraction data</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Xuanxuan</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Chufeng</given-names>
        </name>
        <xref ref-type="aff" rid="c">c</xref>
        <xref ref-type="aff" rid="d">d</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0001-7324-6632</contrib-id>
        <name>
          <surname>Liu</surname>
          <given-names>Haiguang</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <aff id="a"><label>a</label>Department of Engineering Physics, <institution>Tsinghua University</institution>, Beijing 100084, <country>China</country></aff>
      <aff id="b"><label>b</label>Complex Systems Division, <institution>Beijing Computational Science Research Center</institution>, ZPark II, Haidian, Beijing 100193, <country>China</country></aff>
      <aff id="c"><label>c</label>Department of Physics, <institution>Arizona State University</institution>, Tempe, AZ 85287, <country>USA</country></aff>
      <aff id="d"><label>d</label>Center for Free-Electron Laser Science, <institution>Deutsches Elektronen-Synchrotron DESY</institution>, Notkestraße 85, 22607 Hamburg, <country>Germany</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>hgliu@csrc.ac.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>02</day>
      <month>4</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>02</day>
      <month>4</month>
      <year>2020</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>76</volume>
    <issue>Pt 3</issue>
    <issue-id pub-id-type="publisher-id">a200300</issue-id>
    <fpage>369</fpage>
    <lpage>375</lpage>
    <history>
      <date date-type="received">
        <day>02</day>
        <month>10</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>2</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Xuanxuan Li et al. 2020</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution (CC-BY) Licence, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/">http://creativecommons.org/licenses/by/4.0/</ali:license_ref>
      </license>
    </permissions>
    <self-uri xlink:href="https://doi.org/10.1107/S2053273320001916">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p>An auto-indexing method for two-color X-ray diffraction data is presented, which has been tested on both simulated and experimental protein diffraction data. The indexing yield is increased significantly compared with the previous approach using conventional indexers.</p>
    </abstract>
    <abstract>
      <p>Recent developments of two-color operation modes at X-ray free-electron laser facilities provide new research opportunities, such as X-ray pump/X-ray probe experiments and multiple-wavelength anomalous dispersion phasing methods. However, most existing indexing methods were developed for indexing diffraction data from monochromatic X-ray beams. Here, a new algorithm is presented for indexing two-color diffraction data, as an extension of the sparse-pattern indexing algorithm <italic>SPIND</italic>, which has been demonstrated to be capable of indexing diffraction patterns with as few as five peaks. The principle and implementation of the two-color indexing method, <italic>SPIND-TC</italic>, are reported in this paper. The algorithm was tested on both simulated and experimental data of protein crystals. The results show that the diffraction data can be accurately indexed in both cases. Source codes are publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/lixx11/SPIND-TC">https://github.com/lixx11/SPIND-TC</ext-link>.</p>
    </abstract>
    <kwd-group>
      <kwd>serial crystallography</kwd>
      <kwd>two-color diffraction</kwd>
      <kwd>indexing algorithm</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>National Natural Science Foundation of China</funding-source>
        <award-id>11575021</award-id>
        <award-id>U1930402</award-id>
        <award-id>U1430237</award-id>
        <principal-award-recipient>Haiguang Liu</principal-award-recipient>
        <principal-award-recipient>Haiguang Liu</principal-award-recipient>
        <principal-award-recipient>Haiguang Liu</principal-award-recipient>
      </award-group>
      <award-group>
        <funding-source>National Science Foundation</funding-source>
        <award-id>1565180</award-id>
      </award-group>
      <funding-statement>This work was funded by <funding-source>National Natural Science Foundation of China</funding-source> grants <award-id>11575021</award-id>, <award-id>U1930402</award-id>, and <award-id>U1430237</award-id>. <funding-source>National Science Foundation</funding-source> grant <award-id>1565180</award-id>. </funding-statement>
    </funding-group>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="introduction" id="sec1">
    <label>1.</label>
    <title>Introduction   </title>
    <p>Over the past few years, serial femtosecond crystallography (SFX) has demonstrated the capabilities of determining three-dimensional macromolecular structures from microcrystals (Chapman <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb8"> ▸</xref>; Boutet <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb6"> ▸</xref>; Barends <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb2"> ▸</xref>; Kupitz <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb21"> ▸</xref>). Using femtosecond pulses of bright X-ray free-electron lasers (XFELs), diffraction signals are recorded from protein crystals at room temperature in the ‘diffraction-before-destruction’ approach (Solem, 1986<xref ref-type="bibr" rid="bb31"> ▸</xref>; Neutze <italic>et al.</italic>, 2000<xref ref-type="bibr" rid="bb28"> ▸</xref>). This scheme avoids the structure alteration in the cryogenic cooling process (Fraser <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb11"> ▸</xref>; Keedy <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb20"> ▸</xref>), which is frequently adopted to protect protein crystals from radiation damage in macromolecular diffraction experiments at synchrotron facilities.</p>
    <p>In contrast to the conventional macromolecular crystallography using synchrotron light sources, where only one or a few large crystals are required for a complete data set using the oscillation approach, SFX experiments usually require thousands to millions of microcrystals to yield a complete data set. Since every crystal sample is destroyed after being illuminated by XFEL pulses, one crystal only produces a single still diffraction pattern. Each diffraction pattern corresponds to a slice of the three-dimensional reciprocal space. Due to the femtosecond duration and the narrow bandwidth of XFEL pulses, only partial intensities of Bragg spots are recorded on each diffraction pattern. Moreover, the variation of crystal size, shape and shot-to-shot XFEL intensity adds more fluctuation to diffraction signals. To reconstruct a reciprocal space with full intensities, each reflection needs to be sampled many times to average out the noise due to these stochastic factors, which in turn requires a large volume of diffraction data.</p>
    <p>To reduce the sample consumption and experiment time, several attempts have been made to improve the throughput. At the Coherent X-ray Imaging (CXI) instrument (Liang <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb24"> ▸</xref>) of Linac Coherent Light Source (LCLS), researchers can refocus the transmitted beam that passes through the primary chamber, and conduct another independent experiment simultaneously (Boutet <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb5"> ▸</xref>). This serial operation doubles the data collection efficiency but can not reduce the sample consumption. The recent development of XFELs makes it possible to generate a pair of pulses with an adjustable separation of wavelength and time delay (Lutman <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb25"> ▸</xref>; Hara <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb15"> ▸</xref>). This two-color mode doubles the number of diffraction patterns collected from crystals, reducing both the beam time and the sample consumption. Gorel <italic>et al.</italic> applied the two-color approach in a multiple-wavelength anomalous dispersion experiment to determine the structure of lysozyme, and demonstrated that two-wavelength phases can be potentially more accurate than the single-wavelength case, since the second wavelength produces an additional independent measurement (Gorel <italic>et al.</italic>, 2017<italic>b</italic>
<xref ref-type="bibr" rid="bb14"> ▸</xref>).</p>
    <p>In SFX experiments, terabytes of diffraction data are collected and processed. Indexed patterns are merged to produce the intensity list for structure determination. At the first stage, the raw data are rapidly sorted and filtered by programs such as <italic>Cheetah</italic> (Barty <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb3"> ▸</xref>), <italic>CASS</italic> (Foucar, 2016<xref ref-type="bibr" rid="bb10"> ▸</xref>) or <italic>ClickX</italic> (Li <italic>et al.</italic>, 2019<italic>b</italic>
<xref ref-type="bibr" rid="bb23"> ▸</xref>). The resulting diffraction images can be further indexed and merged using the <italic>CrystFEL</italic> suite (White <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb32"> ▸</xref>). The program <italic>indexamajig</italic> of <italic>CrystFEL</italic> is integrated with several auto-indexers, such as <italic>MOSFLM</italic> (Powell, 1999<xref ref-type="bibr" rid="bb29"> ▸</xref>), <italic>DirAx</italic> (Duisenberg, 1992<xref ref-type="bibr" rid="bb9"> ▸</xref>) and <italic>XDS</italic> (Kabsch, 1988<xref ref-type="bibr" rid="bb18"> ▸</xref>, 1993<xref ref-type="bibr" rid="bb19"> ▸</xref>). Several new indexing algorithms have been developed recently. Brewster <italic>et al.</italic> developed a new indexing algorithm for sparse patterns, which showed good performance in indexing experimental patterns of peptide nanocrystals with small unit cells (Brewster <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb7"> ▸</xref>). Based on inter-spot vectors, <italic>TakeTwo</italic> (Ginn <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb12"> ▸</xref>) was shown to improve the indexing rate with the prior knowledge of unit-cell parameters for cubic, hexagonal and orthorhombic space groups. <italic>SPIND</italic> (Li <italic>et al.</italic>, 2019<italic>a</italic>
<xref ref-type="bibr" rid="bb22"> ▸</xref>) is another prior-unit-cell-knowledge-based method, which searches the best rotation solutions using lengths and angles between pairs of Bragg spots and the origin point of the reciprocal space. <italic>FELIX</italic> (Beyerlein <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb4"> ▸</xref>) is able to index multiple crystals in serial crystallography patterns, and has been applied to simulated data sets of cubic, tetragonal and monoclinic crystals and experimental data sets from lysozyme microcrystals. The suite <italic>cctbx.xfel</italic> (Sauter <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb30"> ▸</xref>; Hattne <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb16"> ▸</xref>) represents an alternative set of SFX data processing programs, which can also index multiple crystals.</p>
    <p>Here, we present an auto-indexing method for two-color diffraction patterns, <italic>SPIND-TC</italic>, as an extension of the sparse-data indexing method <italic>SPIND</italic>. This method has been tested on both simulated and experimental data sets, showing accurate indexing results. In particular, the indexing rate for an experimental data set is improved from 11.1% (as in the original work) to 50.9%.</p>
  </sec>
  <sec sec-type="methods" id="sec2">
    <label>2.</label>
    <title>Methods   </title>
    <p><italic>SPIND-TC</italic> is developed based on the sparse-pattern indexing algorithm <italic>SPIND</italic>, which finds the optimal orientation of a crystal using the prior knowledge of the unit cell as a reference. The core idea is summarized as follows:<disp-formula id="fd1"><graphic xlink:href="a-76-00369-efd1.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
<disp-formula id="fd2"><graphic xlink:href="a-76-00369-efd2.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
<disp-formula id="fd3"><graphic xlink:href="a-76-00369-efd3.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
    <p>In equation (1)<xref ref-type="disp-formula" rid="fd1"/>, <italic>S</italic> is the scoring function to evaluate the matching quality between the observed peaks and predicted peaks by comparing the fractional Miller index, which is denoted by <inline-formula><inline-graphic xlink:href="a-76-00369-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, and the corresponding nearest integer Miller index <inline-formula><inline-graphic xlink:href="a-76-00369-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> for the <italic>i</italic>th peak. The goal is to find a rotation matrix <italic>U</italic>, such that the scoring function <italic>S</italic> (the number of matched peaks) is maximized. <italic>B</italic> is the orthogonalization matrix of the reference lattice, and <inline-formula><inline-graphic xlink:href="a-76-00369-efi3.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is the <italic>i</italic>th reciprocal vector. For any rotation matrix, Miller indices of all peaks are calculated. For the <italic>i</italic>th peak, if <inline-formula><inline-graphic xlink:href="a-76-00369-efi4.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, which is a 3-element tuple (<inline-formula><inline-graphic xlink:href="a-76-00369-efi5.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, <inline-formula><inline-graphic xlink:href="a-76-00369-efi6.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, <inline-formula><inline-graphic xlink:href="a-76-00369-efi7.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>), is small enough, it is considered as a matched peak. The matching criterion is formulated as below: <disp-formula id="fd4"><graphic xlink:href="a-76-00369-efd4.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>where δ is a user-specified parameter, and is set to 0.25 by default. In other words, if the largest deviation of Miller index is within 0.25, the observed peak is considered to match the predicted peak determined by <italic>U</italic> and <italic>B</italic>. The solution with most matched peaks, <italic>i.e.</italic> largest <italic>S</italic>, is considered as the best solution.</p>
    <p>If the raw diffraction patterns (or the Miller indices derived from each diffraction pattern) were directly used to compare with the reference patterns, then many reference patterns are required to sample all possible orientations. This approach is impractical due to the high demands in computation. The <italic>SPIND</italic> algorithm first converts the Bragg vectors to the representation that is independent of orientations, using [<inline-formula><inline-graphic xlink:href="a-76-00369-efi8.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, <inline-formula><inline-graphic xlink:href="a-76-00369-efi9.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>] to generate a reference table [see the <italic>SPIND</italic> paper (Li <italic>et al.</italic>, 2019<italic>a</italic>
<xref ref-type="bibr" rid="bb22"> ▸</xref>) and Appendix <italic>A</italic>
<xref ref-type="app" rid="appa"/> for details].</p>
    <p>For two-color pattern indexing, the scoring function is modified to take the two different wavelengths into account. A peak matched to either color is regarded as a matched peak. The workflow is described in Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>.</p>
    <p>First, the peaks are detected on the two-dimensional diffraction images. The reciprocal vectors are calculated with given geometry parameters. The indexing (or searching) is conducted on the corresponding reciprocal vectors for two wavelengths independently.</p>
    <p>The searching is a reference-matching process (dashed boxes in Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>). The reference in <italic>SPIND</italic>/<italic>SPIND-TC</italic> is a pre-calculated table for the given space group and unit-cell parameters in the specified resolution range. Each Miller index pair is represented using three parameters, two vector lengths and the angle between the two vectors, hereafter denoted as a reference triple. The reference table is used to match peak pairs from diffraction patterns. The vector lengths and angles are used to narrow down the potential Bragg vectors to a small set, and then the rotation matrix is calculated using the other information in each reference to identify the orientation and assess the matching quality using the Miller indices.</p>
    <p>For a pattern with <italic>N</italic> peaks, <inline-formula><inline-graphic xlink:href="a-76-00369-efi10.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> peak pairs can be generated and sorted by intensity, resolution or signal-to-noise ratio (SNR). Users can select top <italic>k</italic> peak pairs for matching. The two lengths and one angle for each pair, denoted as an observed triple, are used to match the entries in the reference table within the given tolerance. A rotation matrix <italic>U</italic> can be calculated for each matched entry. Each rotation solution is evaluated by the scoring function. In monochromatic cases, a peak with small <inline-formula><inline-graphic xlink:href="a-76-00369-efi11.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is considered as a matched peak. In two-color cases, a peak with either small <inline-formula><inline-graphic xlink:href="a-76-00369-efi12.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> or small <inline-formula><inline-graphic xlink:href="a-76-00369-efi13.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> (1, 2 are used to denote the two colors) is considered as a matched peak.</p>
    <p>After the reference-based indexing, the peak list is divided into two groups, <inline-formula><inline-graphic xlink:href="a-76-00369-efi14.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi15.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, according to the color probabilities. The probability of the <italic>i</italic>th peak resulting from color <italic>j</italic> is assigned as below: <disp-formula id="fd5"><graphic xlink:href="a-76-00369-efd5.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
<disp-formula id="fd6"><graphic xlink:href="a-76-00369-efd6.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>Finally a global refinement is performed to optimize the final solution for the following objective function using <italic>scipy.optimize</italic> (Jones <italic>et al.</italic>, 2001–2020<xref ref-type="bibr" rid="bb17"> ▸</xref>):<disp-formula id="fd7"><graphic xlink:href="a-76-00369-efd7.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
  </sec>
  <sec sec-type="results" id="sec3">
    <label>3.</label>
    <title>Results   </title>
    <sec id="sec3.1">
      <label>3.1.</label>
      <title>Indexing simulated two-color diffraction data   </title>
      <p>To validate the ability of <italic>SPIND-TC</italic> to index two-color diffraction patterns, a simulated data set was generated from protein crystals [Protein Data Bank (PDB) code <ext-link ext-link-type="uri" xlink:href="https://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=5m2t">5m2t</ext-link>, Prokofev <italic>et al.</italic>, unpublished] at random orientations. The protein crystal has a <italic>P</italic>1 space group and a unit cell of <italic>a</italic> = 64.3, <italic>b</italic> = 72.0, <italic>c</italic> = 89.2 Å and α = 110.6, β = 107.5, γ = 85.8°. The diffraction patterns are simulated on a 1440 × 1440-pixel virtual detector with a pixel size of 100 × 100 µm. The detector is placed 0.1 m away from the sample downstream of the incident beam and perpendicular to the beam. Because the absolute intensity values are not used for indexing simulated data, a simplified model is used to calculate the diffraction patterns, where structure factors, excitation error and signal noise are not included. The lattice points are modeled as spheres with fixed radius. A lattice point is considered as an excited spot if it is intercepted by the Ewald spheres of photon energy at 7 or 9 keV, and the corresponding peak coordinate and the photon energy are registered. Each simulated diffraction pattern consists of multiple peaks from two photon energies on the two-dimensional detector [see Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>(<italic>a</italic>) for an example]. All 100 simulated patterns were indexed successfully with correct orientation solutions (Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>).</p>
    </sec>
    <sec id="sec3.2">
      <label>3.2.</label>
      <title>Indexing experimental two-color diffraction data   </title>
      <p>To further investigate the performance of <italic>SPIND-TC</italic> on actual experimental data, we carried out an indexing test on data set ID 66 (Gorel <italic>et al.</italic>, 2017<italic>a</italic>
<xref ref-type="bibr" rid="bb13"> ▸</xref>) in the Coherent X-ray Imaging Data Bank (CXIDB) (Maia, 2012<xref ref-type="bibr" rid="bb26"> ▸</xref>). This data set was collected at SACLA (SPring-8 Angstrom Compact free-electron LAser) in 2016, and contains 208 373 diffraction patterns identified with <italic>Cheetah</italic>. In this experiment, 7 and 9 keV XFEL pulses were used to produce the diffraction images. Since no available program had been developed to index such two-color diffraction data by the time of the work, Gorel <italic>et al.</italic> used a two-round indexing approach, which utilizes the fact that the two-color images usually consist of two sets of diffraction peaks resulting from XFEL pulses with different fluences, so that the observed Bragg spots can be grouped by intensity. They first used a high-intensity threshold to detect strong peaks and tried indexing assuming 7 or 9 keV photon energy independently. After the first round of indexing, the diffraction images were reprocessed to extract peaks using a low threshold, resulting in more peaks including the ones with weaker signals. Peaks that can be indexed in the first round are masked out for the second round of indexing. The remaining peaks are indexed assuming the other photon energy that was not used for the first round. Using this detect–index–detect–index approach, which is referred to as the <italic>CrystFEL-TC</italic> approach in this article, 23 144 patterns were indexed for both colors.</p>
      <p>However, the peak intensities are not only affected by the intensity of the XFEL pulses, but also by characteristics of crystal samples, including structure factors, partiality and mosaicity. The previous approach relies on the intensity-based peak grouping, resulting in low data efficiency. The <italic>SPIND-TC</italic> algorithm overcomes the dependency on correctly sorting the Bragg peaks based on intensity information. It searches the optimal orientation solution for two colors based on the location of peaks in a single round of data processing, and could improve the indexing rate significantly.</p>
      <p>To be consistent with the workflow of Gorel <italic>et al.</italic>, <italic>indexamajig</italic> was used to detect peaks with an intensity threshold of 150 and SNR of 3 to include both strong and weak Bragg peaks. The peak lists were then processed by <italic>SPIND-TC</italic>. The peaks that were successfully classified into two colors were saved to hdf5 files with the associated indexing solution. Finally, we used <italic>indexamajig</italic> to check all indexing solutions on the classified peaks, and wrote results to stream files that are compatible with <italic>CrystFEL</italic>. By following this workflow, 106 154 images were indexed successfully, about 3.6 times more than that using the previous approach (Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>).</p>
      <p>To compare the merged data quality between <italic>SPIND-TC</italic> and <italic>CrystFEL-TC</italic>, we followed the instruction in the original paper to index the 9 keV data set with <italic>MOSFLM</italic> and <italic>DirAx</italic>, and obtained 30 663 indexed patterns. The indexing results of <italic>SPIND-TC</italic> and <italic>CrystFEL-TC</italic> were merged using <italic>partialator</italic>. Since <italic>SPIND-TC</italic> had more patterns indexed, the redundancy was improved significantly, as well as <italic>R</italic>
<sub>split</sub> and CC*. A higher SNR indicates that <italic>SPIND-TC</italic> indexed more accurately than the <italic>CrystFEL-TC</italic> approach (Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>).</p>
    </sec>
    <sec id="sec3.3">
      <label>3.3.</label>
      <title>Speed test   </title>
      <p><italic>SPIND-TC</italic> is implemented in Python, but the throughput of indexing on experimental protein data is reasonably high. A series of tests were conducted to evaluate the processing speed of <italic>SPIND-TC</italic>. We used 10, 000 two-color images from the CXIDB 66 repository for all the speed tests. A reference table containing reflections below 5 Å was generated for indexing. The matching tolerances for vector lengths and angles were set to 0.0025 Å and 1°. All peaks were sorted by SNR values. The numbers of peak pairs selected for finding rotation solutions were tested in the range from one to 100, and the corresponding indexing time was 2.2 to 168.7 core-seconds per pattern as shown in Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>. The utility is defined as the percentage of indexed patterns out of all indexable patterns. In this case, the number of all indexable patterns was determined to be 6192. Users can select a proper number of peak pairs according to the available computation power. With limited computational facility, it is recommended to start with a small number of peak pairs for matching, <italic>e.g.</italic> five, as the matching targets. It is found that a high utility can still be achieved with fast processing speed by using only five peak pairs from each pattern.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec4">
    <label>4.</label>
    <title>Discussion and conclusions   </title>
    <p>Two-color modes of XFEL provide new opportunities and also bring challenges for serial crystallography. In two-color experiments, the data collection rate is doubled since one image contains two diffraction patterns. For small energy separation, such as  1%, which is feasible at LCLS, it is anticipated that such two-color data can be indexed by monochromatic methods as well as <italic>SPIND-TC</italic>. This was confirmed by a simulation test with 9 and 9.1 keV energy, where all images could be successfully indexed by <italic>MOSFLM</italic> and <italic>SPIND-TC</italic>. The problem for such data is the peak integration for the overlapped spots in the low-resolution region, which requires accurate orientation refinement and careful intensity deconvolution. On the other hand, such data can be analyzed using the pink-beam diffraction method, which uitlizes broader energy bandwidth (up to 5% <inline-formula><inline-graphic xlink:href="a-76-00369-efi16.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>) (Meents <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb27"> ▸</xref>).</p>
    <p>In this work, we focused on the large energy separation cases (<italic>e.g.</italic> 7 and 9 keV). The two Ewald spheres sample different regions of the reciprocal space and thus are difficult to index using indexing algorithms which are developed for indexing diffraction patterns from monochromatic X-rays. The indexing method <italic>SPIND-TC</italic> presented here perfectly fulfills the requirements for indexing two-color diffraction patterns. It does not depend on intensity sorting of Bragg spots, and has been tested on both simulated and experimental protein data. The indexing rate for experimental data was increased by approximately 3.6 times compared with the previously reported results. Source codes are publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/lixx11/SPIND-TC">https://github.com/lixx11/SPIND-TC</ext-link>.</p>
  </sec>
</body>
<back>
  <app-group>
    <app id="appa">
      <label>Appendix A </label>
      <title>Implementation of rotation solution searching in <italic>SPIND/SPIND-TC</italic>
</title>
      <p>For <italic>N</italic> reciprocal-lattice points within a specified resolution range, <inline-formula><inline-graphic xlink:href="a-76-00369-efi17.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> (the number of possible combinations of the vector pairs) entries are pre-calculated and stored in the reference table [for one crystal sample with known unit-cell parameters, only one reference table is generated, instead of discretely sampling the whole three-dimensional reciprocal lattice with sufficiently small angular intervals, the strategy used in many reference matching algorithms such as the expand–maximize–compress (EMC) method (Ayyer <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb1"> ▸</xref>)]. Each entry in the reference table consists of two <italic>hkl</italic> indices, two lengths and one angle of a reciprocal-lattice pair, which are shown as follows: <disp-formula id="fdu1"><graphic xlink:href="a-76-00369-efd8.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>The rotation solution searching is a matching process. Using the experimental geometry and XFEL wavelength information, two lengths and one angle are calculated for each experimental Bragg spot pair in the reciprocal space. These experimental triples are then used to match the entries in the reference table within the given tolerance: <disp-formula id="fd8"><graphic xlink:href="a-76-00369-efd9.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>For each match between the experimental entry (two vector lengths and one angle) and the reference entry, a rotation matrix <italic>U</italic> was computed based on the vectors (<inline-formula><inline-graphic xlink:href="a-76-00369-efi18.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>
<inline-formula><inline-graphic xlink:href="a-76-00369-efi19.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>). The rotation matrix <italic>U</italic> represents the appropriate orientation relation between the experimental lattice and the reference lattice in reciprocal space: <disp-formula id="fd9"><graphic xlink:href="a-76-00369-efd10.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>The rotation matrix <italic>U</italic> is calculated in two steps. In the first step, <inline-formula><inline-graphic xlink:href="a-76-00369-efi20.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, which represents the mapping from the plane of <inline-formula><inline-graphic xlink:href="a-76-00369-efi21.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi22.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> to the plane of <inline-formula><inline-graphic xlink:href="a-76-00369-efi23.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi24.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, is calculated using the axis–angle method:<disp-formula id="fd10"><graphic xlink:href="a-76-00369-efd11.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>where <inline-formula><inline-graphic xlink:href="a-76-00369-efi25.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi26.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> are normal vectors for the <inline-formula><inline-graphic xlink:href="a-76-00369-efi27.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> plane and the <inline-formula><inline-graphic xlink:href="a-76-00369-efi28.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> plane. <inline-formula><inline-graphic xlink:href="a-76-00369-efi20.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> can be calculated with the axis <inline-formula><inline-graphic xlink:href="a-76-00369-efi30.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> [<inline-formula><inline-graphic xlink:href="a-76-00369-efi31.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>] and the angle <inline-formula><inline-graphic xlink:href="a-76-00369-efi32.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
      <p>After the first step, we can calculate <inline-formula><inline-graphic xlink:href="a-76-00369-efi33.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi34.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="a-76-00369-efi35.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi36.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> are in the same plane of <inline-formula><inline-graphic xlink:href="a-76-00369-efi23.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi24.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
      <p>In the second step, we can calculate <inline-formula><inline-graphic xlink:href="a-76-00369-efi39.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, which transforms <inline-formula><inline-graphic xlink:href="a-76-00369-efi35.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi36.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> to <inline-formula><inline-graphic xlink:href="a-76-00369-efi23.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi24.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>:<disp-formula id="fd11"><graphic xlink:href="a-76-00369-efd12.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>This is also done with the axis–angle method, where the axis is <inline-formula><inline-graphic xlink:href="a-76-00369-efi25.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and the angle is the average value of <inline-formula><inline-graphic xlink:href="a-76-00369-efi45.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi46.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
      <p>Finally, the rotation matrix <italic>U</italic> can be calculated from the product of <inline-formula><inline-graphic xlink:href="a-76-00369-efi20.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="a-76-00369-efi39.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>,<disp-formula id="fd12"><graphic xlink:href="a-76-00369-efd13.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
    </app>
  </app-group>
  <ref-list>
    <title>References</title>
    <ref id="bb1">
      <mixed-citation publication-type="other">Ayyer, K., Philipp, H. T., Tate, M. W., Wierman, J. L., Elser, V. &amp; Gruner, S. M. (2015). <italic>IUCrJ</italic>, <bold>2</bold>, 29–34.</mixed-citation>
    </ref>
    <ref id="bb2">
      <mixed-citation publication-type="other">Barends, T. R. M., Foucar, L., Botha, S., Doak, R. B., Shoeman, R. L., Nass, K., Koglin, J. E., Williams, G. J., Boutet, S., Messerschmidt, M. &amp; Schlichting, I. (2014). <italic>Nature</italic>, <bold>505</bold>, 244–247.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Barty, A., Kirian, R. A., Maia, F. R. N. C., Hantke, M., Yoon, C. H., White, T. A. &amp; Chapman, H. (2014). <italic>J. Appl. Cryst.</italic>
<bold>47</bold>, 1118–1131.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Beyerlein, K. R., White, T. A., Yefanov, O., Gati, C., Kazantsev, I. G., Nielsen, N. F.-G., Larsen, P. M., Chapman, H. N. &amp; Schmidt, S. (2017). <italic>J. Appl. Cryst.</italic>
<bold>50</bold>, 1075–1083.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Boutet, S., Foucar, L., Barends, T. R. M., Botha, S., Doak, R. B., Koglin, J. E., Messerschmidt, M., Nass, K., Schlichting, I., Seibert, M. M., Shoeman, R. L. &amp; Williams, G. J. (2015). <italic>J. Synchrotron Rad.</italic>
<bold>22</bold>, 634–643.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Boutet, S., Lomb, L., Williams, G. J., Barends, T. R. M., Aquila, A., Doak, R. B., Weierstall, U., DePonte, D. P., Steinbrener, J., Shoeman, R. L., Messerschmidt, M., Barty, A., White, T. A., Kassemeyer, S., Kirian, R. A., Seibert, M. M., Montanez, P. A., Kenney, C., Herbst, R., Hart, P., Pines, J., Haller, G., Gruner, S. M., Philipp, H. T., Tate, M. W., Hromalik, M., Koerner, L. J., van Bakel, N., Morse, J., Ghonsalves, W., Arnlund, D., Bogan, M. J., Caleman, C., Fromme, R., Hampton, C. Y., Hunter, M. S., Johansson, L. C., Katona, G., Kupitz, C., Liang, M., Martin, A. V., Nass, K., Redecke, L., Stellato, F., Timneanu, N., Wang, D., Zatsepin, N. A., Schafer, D., Defever, J., Neutze, R., Fromme, P., Spence, J. C. H., Chapman, H. N. &amp; Schlichting, I. (2012). <italic>Science</italic>, <bold>337</bold>, 362–364.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Brewster, A. S., Sawaya, M. R., Rodriguez, J., Hattne, J., Echols, N., McFarlane, H. T., Cascio, D., Adams, P. D., Eisenberg, D. S. &amp; Sauter, N. K. (2015). <italic>Acta Cryst.</italic> D<bold>71</bold>, 357–366.</mixed-citation>
    </ref>
    <ref id="bb8">
      <mixed-citation publication-type="other">Chapman, H. N., Fromme, P., Barty, A., White, T. A., Kirian, R. A., Aquila, A., Hunter, M. S., Schulz, J., DePonte, D. P., Weierstall, U., Doak, R. B., Maia, F. R. N. C., Martin, A. V., Schlichting, I., Lomb, L., Coppola, N., Shoeman, R. L., Epp, S. W., Hartmann, R., Rolles, D., Rudenko, A., Foucar, L., Kimmel, N., Weidenspointner, G., Holl, P., Liang, M., Barthelmess, M., Caleman, C., Boutet, S., Bogan, M. J., Krzywinski, J., Bostedt, C., Bajt, S., Gumprecht, L., Rudek, B., Erk, B., Schmidt, C., Hömke, A., Reich, C., Pietschner, D., Strüder, L., Hauser, G., Gorke, H., Ullrich, J., Herrmann, S., Schaller, G., Schopper, F., Soltau, H., Kühnel, K.-U., Messer­schmidt, M., Bozek, J. D., Hau-Riege, S. P., Frank, M., Hampton, C. Y., Sierra, R. G., Starodub, D., Williams, G. J., Hajdu, J., Timneanu, N., Seibert, M. M., Andreasson, J., Rocker, A., Jönsson, O., Svenda, M., Stern, S., Nass, K., Andritschke, R., Schröter, C.-D., Krasniqi, F., Bott, M., Schmidt, K. E., Wang, X., Grotjohann, I., Holton, J. M., Barends, T. R. M., Neutze, R., Marchesini, S., Fromme, R., Schorb, S., Rupp, D., Adolph, M., Gorkhover, T., Andersson, I., Hirsemann, H., Potdevin, G., Graafsma, H., Nilsson, B. &amp; Spence, J. C. H. (2011). <italic>Nature</italic>, <bold>470</bold>, 73–77.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Duisenberg, A. J. M. (1992). <italic>J. Appl. Cryst.</italic>
<bold>25</bold>, 92–96.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Foucar, L. (2016). <italic>J. Appl. Cryst.</italic>
<bold>49</bold>, 1336–1346.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Fraser, J. S., van den Bedem, H., Samelson, A. J., Lang, P. T., Holton, J. M., Echols, N. &amp; Alber, T. (2011). <italic>Proc. Natl Acad. Sci. USA</italic>, <bold>108</bold>, 16247–16252.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Ginn, H. M., Roedig, P., Kuo, A., Evans, G., Sauter, N. K., Ernst, O. P., Meents, A., Mueller-Werkmeister, H., Miller, R. J. D. &amp; Stuart, D. I. (2016). <italic>Acta Cryst.</italic> D<bold>72</bold>, 956–965.</mixed-citation>
    </ref>
    <ref id="bb13">
      <mixed-citation publication-type="other">Gorel, A., Motomura, K., Fukuzawa, H., Doak, R. B., Grünbein, M. L., Hilpert, M., Inoue, I., Kloos, M., Kovács, G. N., Nango, E., Nass, K., Roome, C. M., Shoeman, R. L., Tanaka, R., Tono, K., Foucar, L., Joti, Y., Yabashi, M., Iwata, S., Ueda, K., Barends, T. R. M. &amp; Schlichting, I. (2017<italic>a</italic>). <italic>Scientific Data</italic>, <bold>4</bold>, 170188.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Gorel, A., Motomura, K., Fukuzawa, H., Doak, R. B., Grünbein, M. L., Hilpert, M., Inoue, I., Kloos, M., Kovácsová, G., Nango, E., Nass, K., Roome, C. M., Shoeman, R. L., Tanaka, R., Tono, K., Joti, Y., Yabashi, M., Iwata, S., Foucar, L., Ueda, K., Barends, T. R. M. &amp; Schlichting, I. (2017<italic>b</italic>). <italic>Nat. Commun.</italic>
<bold>8</bold>, 1170.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="other">Hara, T., Inubushi, Y., Katayama, T., Sato, T., Tanaka, H., Tanaka, T., Togashi, T., Togawa, K., Tono, K., Yabashi, M. &amp; Ishikawa, T. (2013). <italic>Nat. Commun.</italic>
<bold>4</bold>, 2919.</mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">Hattne, J., Echols, N., Tran, R., Kern, J., Gildea, R. J., Brewster, A. S., Alonso-Mori, R., Glöckner, C., Hellmich, J., Laksmono, H., Sierra, R. G., Lassalle-Kaiser, B., Lampe, A., Han, G., Gul, S., DiFiore, D., Milathianaki, D., Fry, A. R., Miahnahri, A., White, W. E., Schafer, D. W., Seibert, M. M., Koglin, J. E., Sokaras, D., Weng, T.-C., Sellberg, J., Latimer, M. J., Glatzel, P., Zwart, P. H., Grosse-Kunstleve, R. W., Bogan, M. J., Messerschmidt, M., Williams, G. J., Boutet, S., Messinger, J., Zouni, A., Yano, J., Bergmann, U., Yachandra, V. K., Adams, P. D. &amp; Sauter, N. K. (2014). <italic>Nat. Methods</italic>, <bold>11</bold>, 545–548.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Jones, E., Oliphant, T. &amp; Peterson, P. (2001–2020). <italic>SciPy: open source scientific tools for Python.</italic> http://www.scipy.org/.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Kabsch, W. (1988). <italic>J. Appl. Cryst.</italic>
<bold>21</bold>, 67–72.</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Kabsch, W. (1993). <italic>J. Appl. Cryst.</italic>
<bold>26</bold>, 795–800.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Keedy, D. A., van den Bedem, H., Sivak, D. A., Petsko, G. A., Ringe, D., Wilson, M. A. &amp; Fraser, J. S. (2014). <italic>Structure</italic>, <bold>22</bold>, 899–910.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">Kupitz, C., Basu, S., Grotjohann, I., Fromme, R., Zatsepin, N. A., Rendek, K. N., Hunter, M. S., Shoeman, R. L., White, T. A., Wang, D., James, D., Yang, J.-H., Cobb, D. E., Reeder, B., Sierra, R. G., Liu, H., Barty, A., Aquila, A., Deponte, D., Kirian, R. A., Bari, S., Bergkamp, J. J., Beyerlein, K. R., Bogan, M. J., Caleman, C., Chao, T.-C., Conrad, C. E., Davis, K. M., Fleckenstein, H., Galli, L., Hau-Riege, S. P., Kassemeyer, S., Laksmono, H., Liang, M., Lomb, L., Marchesini, S., Martin, A. V., Messerschmidt, M., Milathianaki, D., Nass, K., Ros, A., Roy-Chowdhury, S., Schmidt, K., Seibert, M. M., Steinbrener, J., Stellato, F., Yan, L., Yoon, C., Moore, T. A., Moore, A. L., Pushkar, Y., Williams, G. J., Boutet, S., Doak, R. B., Weierstall, U., Frank, M., Chapman, H. N., Spence, J. C. H. &amp; Fromme, P. (2014). <italic>Nature</italic>, <bold>513</bold>, 261–265.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="other">Li, C., Li, X., Kirian, R., Spence, J. C. H., Liu, H. &amp; Zatsepin, N. A. (2019<italic>a</italic>). <italic>IUCrJ</italic>, <bold>6</bold>, 72–84.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">Li, X., Li, C. &amp; Liu, H. (2019<italic>b</italic>). <italic>J. Appl. Cryst.</italic>
<bold>52</bold>, 674–682.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">Liang, M., Williams, G. J., Messerschmidt, M., Seibert, M. M., Montanez, P. A., Hayes, M., Milathianaki, D., Aquila, A., Hunter, M. S., Koglin, J. E., Schafer, D. W., Guillet, S., Busse, A., Bergan, R., Olson, W., Fox, K., Stewart, N., Curtis, R., Miahnahri, A. A. &amp; Boutet, S. (2015). <italic>J. Synchrotron Rad.</italic>
<bold>22</bold>, 514–519.</mixed-citation>
    </ref>
    <ref id="bb25">
      <mixed-citation publication-type="other">Lutman, A., Coffee, R., Ding, Y., Huang, Z., Krzywinski, J., Maxwell, T., Messerschmidt, M. &amp; Nuhn, H.-D. (2013). <italic>Phys. Rev. Lett.</italic>
<bold>110</bold>, 134801.</mixed-citation>
    </ref>
    <ref id="bb26">
      <mixed-citation publication-type="other">Maia, F. R. N. C. (2012). <italic>Nat. Methods</italic>, <bold>9</bold>, 854–855.</mixed-citation>
    </ref>
    <ref id="bb27">
      <mixed-citation publication-type="other">Meents, A., Wiedorn, M., Srajer, V., Henning, R., Sarrou, I., Bergtholdt, J., Barthelmess, M., Reinke, P., Dierksmeyer, D., Tolstikova, A., Schaible, S., Messerschmidt, M., Ogata, C. M., Kissick, D. J., Taft, M. H., Manstein, D. J., Lieske, J., Oberthuer, D., Fischetti, R. F. &amp; Chapman, H. N. (2017). <italic>Nat. Commun.</italic>
<bold>8</bold>, 1281.</mixed-citation>
    </ref>
    <ref id="bb28">
      <mixed-citation publication-type="other">Neutze, R., Wouts, R., van der Spoel, D., Weckert, E. &amp; Hajdu, J. (2000). <italic>Nature</italic>, <bold>406</bold>, 752–757.</mixed-citation>
    </ref>
    <ref id="bb29">
      <mixed-citation publication-type="other">Powell, H. R. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1690–1695.</mixed-citation>
    </ref>
    <ref id="bb30">
      <mixed-citation publication-type="other">Sauter, N. K., Hattne, J., Grosse-Kunstleve, R. W. &amp; Echols, N. (2013). <italic>Acta Cryst.</italic> D<bold>69</bold>, 1274–1282.</mixed-citation>
    </ref>
    <ref id="bb31">
      <mixed-citation publication-type="other">Solem, J. C. (1986). <italic>J. Opt. Soc. Am. B</italic>, <bold>3</bold>, 1551–1565.</mixed-citation>
    </ref>
    <ref id="bb32">
      <mixed-citation publication-type="other">White, T. A., Kirian, R. A., Martin, A. V., Aquila, A., Nass, K., Barty, A. &amp; Chapman, H. N. (2012). <italic>J. Appl. Cryst.</italic>
<bold>45</bold>, 335–341.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Workflow of SPIND-TC. The indexing is performed for two colors independently, which is shown in two blue dashed boxes. The best rotation matrix is refined to obtain the final indexing solution and used to split the peaks into two color groups.</p>
    </caption>
    <graphic xlink:href="a-76-00369-fig1"/>
  </fig>
  <fig id="fig2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Indexing results on the simulated data set. (<italic>a</italic>) A typical simulated two-color diffraction pattern using 7 keV (orange peaks) and 9 keV (blue peaks) XFELs in the orientation specified by Euler angles 10, 20, 30°. (<italic>b</italic>) Probabilities of 7 keV for all peaks in the simulated pattern (<italic>a</italic>). The probabilities larger than 0.5 corresponding to the peaks of 7 keV (orange). (<italic>c</italic>) Distribution of orientation errors for each Euler angle. Most of the angle errors are smaller than 0.2°.</p>
    </caption>
    <graphic xlink:href="a-76-00369-fig2"/>
  </fig>
  <fig id="fig3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <p>(<italic>a</italic>) Indexing results with <italic>CrystFEL-TC</italic> and <italic>SPIND-TC</italic> on the two-color data set. In 208 000 hits, <italic>CrystFEL-TC</italic> indexed 23 000 two-color patterns, while <italic>SPIND-TC</italic> can index 106 000 patterns, covering almost all of the patterns indexed by <italic>CrystFEL-TC</italic> (except 34 patterns). (<italic>b</italic>) Representative patterns that can only be indexed with <italic>SPIND-TC</italic>.</p>
    </caption>
    <graphic xlink:href="a-76-00369-fig3"/>
  </fig>
  <fig id="fig4" orientation="portrait" position="float">
    <label>Figure 4</label>
    <caption>
      <p>Binned figures-of-merit (FOMs) comparison between <italic>SPIND-TC</italic> and <italic>CrystFEL-TC</italic>. <italic>SPIND-TC</italic> performs better than the <italic>CrystFEL-TC</italic> method in all FOMs, including redundancy, SNR, <italic>R</italic>
<sub>split</sub> and CC*.</p>
    </caption>
    <graphic xlink:href="a-76-00369-fig4"/>
  </fig>
  <fig id="fig5" orientation="portrait" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Performance of <italic>SPIND-TC</italic> at various matching pairs. The blue line shows the processing speed in core-seconds, while the green line represents the utility. If 100 peak pairs are searched in <italic>SPIND-TC</italic>, 170 core-seconds is required to index a single image, resulting in 6192 images indexed.</p>
    </caption>
    <graphic xlink:href="a-76-00369-fig5"/>
  </fig>
</floats-group>
