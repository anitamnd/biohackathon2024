<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6736366</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btz030</article-id>
    <article-id pub-id-type="publisher-id">btz030</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genetics and Population Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>admixr</italic>—R package for reproducible analyses using ADMIXTOOLS</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-4879-8421</contrib-id>
        <name>
          <surname>Petr</surname>
          <given-names>Martin</given-names>
        </name>
        <xref ref-type="corresp" rid="btz030-cor1"/>
        <!--<email>mp@bodkan.net</email>-->
        <xref ref-type="aff" rid="btz030-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0002-6820-2181</contrib-id>
        <name>
          <surname>Vernot</surname>
          <given-names>Benjamin</given-names>
        </name>
        <xref ref-type="aff" rid="btz030-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0002-3618-322X</contrib-id>
        <name>
          <surname>Kelso</surname>
          <given-names>Janet</given-names>
        </name>
        <xref ref-type="corresp" rid="btz030-cor1"/>
        <!--<email>kelso@eva.mpg.de</email>-->
        <xref ref-type="aff" rid="btz030-aff1"/>
      </contrib>
    </contrib-group>
    <aff id="btz030-aff1">Department of Evolutionary Genetics, <institution>Max Planck Institute for Evolutionary Anthropology</institution>, Leipzig, Germany</aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Valencia</surname>
          <given-names>Alfonso</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btz030-cor1">To whom correspondence should be addressed. E-mail: <email>mp@bodkan.net</email> or <email>kelso@eva.mpg.de</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>9</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-01-22">
      <day>22</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>22</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>35</volume>
    <issue>17</issue>
    <fpage>3194</fpage>
    <lpage>3195</lpage>
    <history>
      <date date-type="received">
        <day>04</day>
        <month>12</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>1</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btz030.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>We present a new R package <italic>admixr</italic>, which provides a convenient interface for performing reproducible population genetic analyses (<italic>f<sub>3</sub></italic>, <italic>D</italic>, <italic>f<sub>4</sub></italic>, <italic>f<sub>4</sub></italic>-ratio, <italic>qpWave</italic> and <italic>qpAdm</italic>), as implemented by command-line programs in the ADMIXTOOLS software suite. In a traditional ADMIXTOOLS workflow, the user must first generate a set of text configuration files tailored to each individual analysis, often using a combination of shell scripting and manual text editing. The non-tabular output files then need to be parsed to extract values of interest prior to further analyses. Our package simplifies this process by automating all low-level configuration and parsing steps, making analyses as simple as running a single R command. Furthermore, we provide a set of R functions for processing, filtering and manipulating datasets in the EIGENSTRAT format. By unifying all steps of the workflow under a single R framework, this package enables the automation of analytic pipelines, significantly improving the reproducibility of population genetic studies.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>The source code of the R package is available under the MIT license. Installation instructions, reference manual and a tutorial can be found on the package website at <ext-link ext-link-type="uri" xlink:href="http://bodkan.net/admixr">https://bioinf.eva.mpg.de/admixr</ext-link>.</p>
      </sec>
      <sec id="s3">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Max Planck Society</named-content>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="2"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>The growing number of ancient and modern genome sequences have transformed our understanding of the evolutionary history of humans and other species. Several statistical methods have been developed to make inferences about past population movements and admixtures from genomic data. Chief among these has been a series of population genetic methods (<italic>D</italic>, <inline-formula id="IE1"><mml:math id="IM1"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>,<inline-formula id="IE2"><mml:math id="IM2"><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>,<inline-formula id="IE3"><mml:math id="IM3"><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>-ratio, <italic>qpWave</italic> and <italic>qpAdm)</italic> for estimating the amounts of genetic drift shared between populations, testing admixture hypotheses and estimating admixture proportions, implemented as command-line utilities in the ADMIXTOOLS software suite (<xref rid="btz030-B5" ref-type="bibr">Patterson <italic>et al.</italic>, 2012</xref>). Although ADMIXTOOLS has been used in many recent studies of human ancient DNA (<xref rid="btz030-B1" ref-type="bibr">Fu <italic>et al.</italic>, 2016</xref>; <xref rid="btz030-B2" ref-type="bibr">Haak <italic>et al.</italic>, 2015</xref>; <xref rid="btz030-B3" ref-type="bibr">Hajdinjak <italic>et al.</italic>, 2018</xref>; <xref rid="btz030-B4" ref-type="bibr">Lazaridis <italic>et al.</italic>, 2016</xref>), the tools in this package are rather cumbersome to use. First, each individual analysis or hypothesis test relies on a set of configuration files, which have to be generated using a combination of shell scripting and manual editing. Second, after running an ADMIXTOOLS command on the command-line, the user needs to extract relevant values from a non-tabular text file before they can be imported into software such as R for further analysis and plotting. This workflow is slow and potentially error-prone, especially if the user wishes to quickly iterate through different hypotheses involving many different populations or samples. Most importantly, however, it makes it challenging to conduct fully reproducible research. To overcome these challenges, we present a new R package for population admixture analyses which utilizes the ADMIXTOOLS software suite for the underlying calculations, but that provides a unified and convenient R interface. The package completely automates the generation, processing and parsing of all intermediate files, hiding all low-level details from the user, and allowing them to focus on the analysis itself. Importantly, unifying the entire analytic workflow in a single environment makes it possible to implement and share fully automated, reproducible analytic pipelines.</p>
  </sec>
  <sec>
    <title>2 Implementation</title>
    <p>The <italic>admixr</italic> package is implemented using the R programming language. It consists of several wrapper functions (calling ADMIXTOOLS commands internally from R), and a set of complementary functions for filtering and processing datasets in the EIGENSTRAT file format required by ADMIXTOOLS (<xref rid="btz030-B5" ref-type="bibr">Patterson <italic>et al.</italic>, 2012</xref>).</p>
    <p>An EIGENSTRAT dataset is represented by an S3 object of the class EIGENSTRAT, which is created using the <monospace>eigenstrat()</monospace> constructor function, and encapsulates the paths to a trio of ‘ind’, ‘snp’ and ‘geno’ files:</p>
    <p>
      <disp-quote content-type="extract">
        <p>
          <monospace>&gt; snps &lt;- eigenstrat(“∼/path/to/eigenstrat/data”)</monospace>
        </p>
        <p>
          <monospace>&gt; snps</monospace>
        </p>
        <p>
          <monospace>EIGENSTRAT object</monospace>
        </p>
        <p>
          <monospace>=================</monospace>
        </p>
        <p>
          <monospace>components:</monospace>
        </p>
        <p> <monospace>ind file: ∼/path/to/eigenstrat/data.ind</monospace></p>
        <p> <monospace>snp file: ∼/path/to/eigenstrat/data.snp</monospace></p>
        <p> <monospace>geno file: ∼/path/to/eigenstrat/data.geno</monospace></p>
      </disp-quote>
    </p>
    <p>All other functions in the package accept this object as their first argument, and perform either a requested calculation on it (returning an R data frame for further analysis), or return a new, modified EIGENSTRAT S3 object (in case of filtering and processing functions) which can be used in additional downstream steps or calculations.</p>
    <p>The core functionality of the package consists of the following set of R functions: <monospace>f3(), d(), f4(), f4ratio(), qpWave() and qpAdm()</monospace>, each implemented as a wrapper around one of the command-line programs distributed as part of the ADMIXTOOLS package.</p>
  </sec>
  <sec>
    <title>3 Example usage</title>
    <p>Performing even the most trivial analysis using ADMIXTOOLS presents a significant amount of overhead for the user. For example, to estimate the proportion of Neandertal ancestry in a set of individuals, <inline-formula id="IE4"><mml:math id="IM4"><mml:mi>X</mml:mi><mml:mo>,</mml:mo></mml:math></inline-formula> the user would typically calculate an <inline-formula id="IE5"><mml:math id="IM5"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>-ratio statistic such as:
<disp-formula id="E1"><label>(1)</label><mml:math id="M1"><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="normal">A</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">C</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">p</mml:mi><mml:mo>;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">X</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">M</mml:mi><mml:mi mathvariant="normal">b</mml:mi><mml:mi mathvariant="normal">u</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">i</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="normal">A</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">C</mml:mi><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">p</mml:mi><mml:mo>;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">V</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">j</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi mathvariant="normal">M</mml:mi><mml:mi mathvariant="normal">b</mml:mi><mml:mi mathvariant="normal">u</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">i</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math></disp-formula></p>
    <p>The user first needs to create a file with a list of samples in each position of both <italic>f<sub>4</sub></italic> statistics, a parameter file specifying the paths to a trio of EIGENSTRAT component files, then manually run the qpF4ratio command-line program, and then capture and parse its output to obtain relevant values (see <xref ref-type="supplementary-material" rid="sup1">Supplementary Information</xref> for a complete example workflow using a traditional ADMIXTOOLS approach). Note that changing the analysis setup [such as including a different set of populations in <xref ref-type="disp-formula" rid="E1">Equation (1)</xref>], performing the analysis on a subset of the genome, or modifying the analysis in another way, requires changes to be made to its configuration files. This presents a significant overhead for the user, especially when iterating through a complex set of population genetic hypotheses.</p>
    <p>In contrast, using the <italic>admixr</italic> package, the same analysis can be performed with just the following snippet of R code:</p>
    <p>
      <disp-quote content-type="extract">
        <p> <monospace>result &lt;- f4ratio(</monospace></p>
        <p> <monospace>X = c(“French”, “Han”, “Papuan”),</monospace></p>
        <p> <monospace>A = “Altai”, B = “Vindija”, C = “Mbuti”, O =</monospace>  <monospace>“Chimp”,</monospace></p>
        <p> <monospace>data = eigenstrat(“&lt;path to EIGENSTRAT data&gt;”)</monospace></p>
        <p> <monospace>)</monospace></p>
      </disp-quote>
    </p>
    <p>Internally, the <monospace>f4ratio()</monospace> function performs all configuration and parsing work, and returns an R data frame which can be immediately used for further statistical analysis and plotting:</p>
    <p>
      <disp-quote content-type="extract">
        <p>
          <monospace>&gt; result</monospace>
        </p>
        <p>
          <monospace>A B X C O alpha stderr Zscore</monospace>
        </p>
        <p>
          <monospace>Altai Vindija French Mbuti Chimp 0.019696 0.003114  6.324</monospace>
        </p>
        <p>
          <monospace>Altai Vindija Han Mbuti Chimp 0.024379 0.003364 7.248</monospace>
        </p>
        <p>
          <monospace>Altai Vindija Papuan Mbuti Chimp 0.032167 0.003499 9.193</monospace>
        </p>
      </disp-quote>
    </p>
    <p>All other <italic>admixr</italic> wrapper functions have a similar interface and are described in the tutorial vignette on the package website in more detail.</p>
  </sec>
  <sec>
    <title>4 Additional functionality</title>
    <p>The fact that ADMIXTOOLS requires the data to be in EIGENSTRAT format presents additional challenges for quality control, processing and filtering, as this format is not supported by standard bioinformatics tools. Our R package therefore provides additional functionality to simplify the processing and filtering of EIGENSTRAT genotype data. This includes:
<list list-type="bullet"><list-item><p>Reading and writing of ind, snp and geno file components.</p></list-item><list-item><p>Filtering of SNPs based on regions specified in a BED file.</p></list-item><list-item><p>Restricting analyses to sites carrying transversion SNPs.</p></list-item><list-item><p>Renaming samples or grouping them into larger population groups.</p></list-item><list-item><p>Merging of EIGENSTRAT datasets.</p></list-item><list-item><p>Counting the number of sites present or missing in each sample.</p></list-item></list></p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>btz030_Supplementary_Information</label>
      <media xlink:href="btz030_supplementary_information.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We would like to thank Benjamin Peter and Hassan Shafiey for helpful comments, suggestions and testing.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported by funding from the Max Planck Society.</p>
      <p><italic>Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btz030-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Fu</surname><given-names>Q.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>The genetic history of Ice Age Europe</article-title>. <source>Nature</source>, <volume>534</volume>, <fpage>200</fpage>–<lpage>205</lpage>.<pub-id pub-id-type="pmid">27135931</pub-id></mixed-citation>
    </ref>
    <ref id="btz030-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Haak</surname><given-names>W.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>Massive migration from the steppe was a source for Indo-European languages in Europe</article-title>. <source>Nature</source>, <volume>522</volume>, <fpage>207</fpage>–<lpage>211</lpage>.<pub-id pub-id-type="pmid">25731166</pub-id></mixed-citation>
    </ref>
    <ref id="btz030-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Hajdinjak</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Reconstructing the genetic history of late Neanderthals</article-title>. <source>Nature</source>, <volume>555</volume>, <fpage>652</fpage>–<lpage>656</lpage>.<pub-id pub-id-type="pmid">29562232</pub-id></mixed-citation>
    </ref>
    <ref id="btz030-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lazaridis</surname><given-names>I.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Genomic insights into the origin of farming in the ancient Near East</article-title>. <source>Nature</source>, <volume>536</volume>, <fpage>419</fpage>–<lpage>424</lpage>.<pub-id pub-id-type="pmid">27459054</pub-id></mixed-citation>
    </ref>
    <ref id="btz030-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Patterson</surname><given-names>N.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Ancient admixture in human history</article-title>. <source>Genetics</source>, <volume>192</volume>, <fpage>1065</fpage>–<lpage>1093</lpage>.<pub-id pub-id-type="pmid">22960212</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
