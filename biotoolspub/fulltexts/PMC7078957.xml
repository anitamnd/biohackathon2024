<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with OASIS Tables with MathML3 v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-archive-oasis-article1-mathml3.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jpoasis-nisons2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Cytometry A</journal-id>
    <journal-id journal-id-type="iso-abbrev">Cytometry A</journal-id>
    <journal-id journal-id-type="doi">10.1002/(ISSN)1552-4930</journal-id>
    <journal-id journal-id-type="publisher-id">CYTO</journal-id>
    <journal-title-group>
      <journal-title>Cytometry</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1552-4922</issn>
    <issn pub-type="epub">1552-4930</issn>
    <publisher>
      <publisher-name>John Wiley &amp; Sons, Inc.</publisher-name>
      <publisher-loc>Hoboken, USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7078957</article-id>
    <article-id pub-id-type="doi">10.1002/cyto.a.23904</article-id>
    <article-id pub-id-type="publisher-id">CYTOA23904</article-id>
    <article-categories>
      <subj-group subj-group-type="overline">
        <subject>Original Article</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Original Articles</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>CytoNorm: A Normalization Algorithm for Cytometry Data</article-title>
      <alt-title alt-title-type="right-running-head">CytoNorm: A Normalization Algorithm for Cytometry Data</alt-title>
    </title-group>
    <contrib-group>
      <contrib id="cytoa23904-cr-0001" contrib-type="author">
        <name>
          <surname>Van Gassen</surname>
          <given-names>Sofie</given-names>
        </name>
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7119-5330</contrib-id>
        <xref ref-type="aff" rid="cytoa23904-aff-0001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="cytoa23904-aff-0002">
          <sup>2</sup>
        </xref>
        <xref ref-type="author-notes" rid="cytoa23904-note-0001">
          <sup>†</sup>
        </xref>
      </contrib>
      <contrib id="cytoa23904-cr-0002" contrib-type="author">
        <name>
          <surname>Gaudilliere</surname>
          <given-names>Brice</given-names>
        </name>
        <xref ref-type="aff" rid="cytoa23904-aff-0003">
          <sup>3</sup>
        </xref>
        <xref ref-type="author-notes" rid="cytoa23904-note-0001">
          <sup>†</sup>
        </xref>
      </contrib>
      <contrib id="cytoa23904-cr-0003" contrib-type="author">
        <name>
          <surname>Angst</surname>
          <given-names>Martin S.</given-names>
        </name>
        <xref ref-type="aff" rid="cytoa23904-aff-0003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib id="cytoa23904-cr-0004" contrib-type="author" corresp="yes">
        <name>
          <surname>Saeys</surname>
          <given-names>Yvan</given-names>
        </name>
        <xref ref-type="aff" rid="cytoa23904-aff-0001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="cytoa23904-aff-0002">
          <sup>2</sup>
        </xref>
        <xref ref-type="author-notes" rid="cytoa23904-note-0002">
          <sup>‡</sup>
        </xref>
        <address>
          <email>yvan.saeys@ugent.be</email>
        </address>
      </contrib>
      <contrib id="cytoa23904-cr-0005" contrib-type="author" corresp="yes">
        <name>
          <surname>Aghaeepour</surname>
          <given-names>Nima</given-names>
        </name>
        <xref ref-type="aff" rid="cytoa23904-aff-0003">
          <sup>3</sup>
        </xref>
        <xref ref-type="aff" rid="cytoa23904-aff-0004">
          <sup>4</sup>
        </xref>
        <xref ref-type="author-notes" rid="cytoa23904-note-0002">
          <sup>‡</sup>
        </xref>
        <address>
          <email>naghaeep@stanford.edu</email>
        </address>
      </contrib>
    </contrib-group>
    <aff id="cytoa23904-aff-0001">
      <label>
        <sup>1</sup>
      </label>
      <named-content content-type="organisation-division">Department of Applied Mathematics</named-content>
      <institution>Computer Science and Statistics, Ghent University</institution>
      <city>Ghent</city>
      <country country="BE">Belgium</country>
    </aff>
    <aff id="cytoa23904-aff-0002">
      <label>
        <sup>2</sup>
      </label>
      <named-content content-type="organisation-division">Data Mining and Modeling for Biomedicine</named-content>
      <institution>VIB Center for Inflammation Research</institution>
      <city>Ghent</city>
      <country country="BE">Belgium</country>
    </aff>
    <aff id="cytoa23904-aff-0003">
      <label>
        <sup>3</sup>
      </label>
      <named-content content-type="organisation-division">Department of Anesthesiology, Perioperative and Pain Medicine</named-content>
      <institution>Stanford University School of Medicine</institution>
      <city>Stanford</city>
      <named-content content-type="country-part">California</named-content>
    </aff>
    <aff id="cytoa23904-aff-0004">
      <label>
        <sup>4</sup>
      </label>
      <named-content content-type="organisation-division">Department of Biomedical Data Sciences</named-content>
      <institution>Stanford University School of Medicine</institution>
      <city>Stanford</city>
      <named-content content-type="country-part">California</named-content>
    </aff>
    <author-notes>
      <corresp id="correspondenceTo"><label>*</label>
Correspondence to: Yvan Saeys, Department of Applied Mathematics, Computer Science and Statistics, Ghent University, Ghent, Belgium<break/>
Email: <email>yvan.saeys@ugent.be</email>; Nima Aghaeepour, Department of Anesthesiology, Perioperative and Pain Medicine, Stanford University School of Medicine, Stanford, CA 94121<break/>
Email: <email>naghaeep@stanford.edu</email><break/></corresp>
      <fn id="cytoa23904-note-0001">
        <label>†</label>
        <p>Sofie Van Gassen and Brice Gaudilliere share colead authorship.</p>
      </fn>
      <fn id="cytoa23904-note-0002">
        <label>‡</label>
        <p>Yvan Saeys and Nima Aghaeepour share cosenior authorship.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>21</day>
      <month>10</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>3</month>
      <year>2020</year>
    </pub-date>
    <volume>97</volume>
    <issue>3</issue>
    <issue-id pub-id-type="doi">10.1002/cyto.v97.3</issue-id>
    <issue-title content-type="special-issue-title">Machine Learning for Single Cell Data</issue-title>
    <fpage>268</fpage>
    <lpage>278</lpage>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>5</month>
        <year>2019</year>
      </date>
      <date date-type="rev-recd">
        <day>12</day>
        <month>9</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>13</day>
        <month>9</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <!--<copyright-statement content-type="issue-copyright"> &#x000a9; 2020 International Society for Advancement of Cytometry <copyright-statement>-->
      <copyright-statement content-type="article-copyright">© 2019 The Authors. <italic>Cytometry Part A</italic> published by Wiley Periodicals, Inc. on behalf of International Society for Advancement of Cytometry.</copyright-statement>
      <license license-type="creativeCommonsBy">
        <license-p>This is an open access article under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link> License, which permits use, distribution and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="file:CYTO-97-268.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>High‐dimensional flow cytometry has matured to a level that enables deep phenotyping of cellular systems at a clinical scale. The resulting high‐content data sets allow characterizing the human immune system at unprecedented single cell resolution. However, the results are highly dependent on sample preparation and measurements might drift over time. While various controls exist for assessment and improvement of data quality in a single sample, the challenges of cross‐sample normalization attempts have been limited to aligning marker distributions across subjects. These approaches, inspired by bulk genomics and proteomics assays, ignore the single‐cell nature of the data and risk the removal of biologically relevant signals. This work proposes CytoNorm, a normalization algorithm to ensure internal consistency between clinical samples based on shared controls across various study batches. Data from the shared controls is used to learn the appropriate transformations for each batch (e.g., each analysis day). Importantly, some sources of technical variation are strongly influenced by the amount of protein expressed on specific cell types, requiring several population‐specific transformations to normalize cells from a heterogeneous sample. To address this, our approach first identifies the overall cellular distribution using a clustering step, and calculates subset‐specific transformations on the control samples by computing their quantile distributions and aligning them with splines. These transformations are then applied to all other clinical samples in the batch to remove the batch‐specific variations. We evaluated the algorithm on a customized data set with two shared controls across batches. One control sample was used for calculation of the normalization transformations and the second control was used as a blinded test set and evaluated with Earth Mover's distance. Additional results are provided using two real‐world clinical data sets. Overall, our method compared favorably to standard normalization procedures. The algorithm is implemented in the R package “CytoNorm” and available via the following link: <ext-link ext-link-type="uri" xlink:href="http://www.github.com/saeyslab/CytoNorm">http://www.github.com/saeyslab/CytoNorm</ext-link> © 2019 The Authors. <italic>Cytometry Part A</italic> published by Wiley Periodicals, Inc. on behalf of International Society for Advancement of Cytometry.</p>
    </abstract>
    <kwd-group kwd-group-type="author-generated">
      <kwd id="cytoa23904-kwd-0001">normalization</kwd>
      <kwd id="cytoa23904-kwd-0002">mass cytometry</kwd>
      <kwd id="cytoa23904-kwd-0003">computational cytometry</kwd>
      <kwd id="cytoa23904-kwd-0004">barcoding</kwd>
    </kwd-group>
    <funding-group>
      <award-group id="funding-0001">
        <funding-source>
          <institution-wrap>
            <institution>Bill and Melinda Gates Foundation </institution>
            <institution-id institution-id-type="open-funder-registry">10.13039/100000865</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group id="funding-0002">
        <funding-source>Burroughs Wellcome Preterm Birth Initiative</funding-source>
      </award-group>
      <award-group id="funding-0003">
        <funding-source>
          <institution-wrap>
            <institution>Doris Duke Charitable Foundation </institution>
            <institution-id institution-id-type="open-funder-registry">10.13039/100000862</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group id="funding-0004">
        <funding-source>
          <institution-wrap>
            <institution>Fonds Wetenschappelijk Onderzoek </institution>
            <institution-id institution-id-type="open-funder-registry">10.13039/501100003130</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group id="funding-0005">
        <funding-source>
          <institution-wrap>
            <institution>March of Dimes Prematurity Research Center </institution>
            <institution-id institution-id-type="open-funder-registry">10.13039/100011636</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group id="funding-0006">
        <funding-source>March of Dimes Prematurity Research Center of Stanford University</funding-source>
      </award-group>
      <award-group id="funding-0007">
        <funding-source>National Institute of Health</funding-source>
        <award-id>R21DE027728‐01</award-id>
      </award-group>
      <award-group id="funding-0008">
        <funding-source>Robertson Family Foundation</funding-source>
      </award-group>
    </funding-group>
    <counts>
      <fig-count count="8"/>
      <table-count count="1"/>
      <page-count count="11"/>
      <word-count count="6575"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>source-schema-version-number</meta-name>
        <meta-value>2.0</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>cover-date</meta-name>
        <meta-value>March 2020</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>details-of-publishers-convertor</meta-name>
        <meta-value>Converter:WILEY_ML3GV2_TO_JATSPMC version:5.7.8 mode:remove_FC converted:18.03.2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body id="cytoa23904-body-0001">
  <p>High‐dimensional flow cytometry technologies, such as mass cytometry, are increasingly employed in large clinical studies to better understand the biological mechanisms of diseases <xref rid="cytoa23904-bib-0001" ref-type="ref">1</xref>, <xref rid="cytoa23904-bib-0002" ref-type="ref">2</xref>, <xref rid="cytoa23904-bib-0003" ref-type="ref">3</xref>. However, when samples are measured at multiple timepoints, technical variances between experimental batches can influence the measurements, resulting in so‐called batch effects. Technical variance can have various causes, including differences in sample collection time, stimulation, freezing, thawing, staining or instrument‐dependent effects.</p>
  <p>One of the known instrument‐dependent issues specific to mass cytometry is signal fluctuation over time, due to changes in instrument performance. This signal drift is typically corrected by using polystyrene beads embedded with metals of known concentration <xref rid="cytoa23904-bib-0004" ref-type="ref">4</xref>. However, these beads will not capture differences due to experimental variability in sample preparation or changes in channels that are not represented by the bead signals. Therefore, additional normalization is still needed.</p>
  <p>One solution to reduce batch effects is cellular barcoding <xref rid="cytoa23904-bib-0005" ref-type="ref">5</xref>, <xref rid="cytoa23904-bib-0006" ref-type="ref">6</xref>, an approach in which each individual sample is first stained with a specific set of tags, allowing unique identification of the samples. The samples can then be merged together and further processed as one, significantly reducing the experimental variability in sample handling, antibody staining and instrument detector sensitivity. However, the number of samples that can be uniquely labeled is limited (typically 20 or 96 samples), and clinical data sets may include more samples than a single barcode scheme can accommodate. Additionally, not all samples are always available at the same time, which complicates the barcoding process. Therefore, samples are often split in multiple groups, each of which are processed in one barcoded plate. While in this scenario, experimental variability is limited between samples on the same barcoded plate, separate plates suffer from similar experimental variability as two nonbarcoded samples would.</p>
  <p>While several additional protocol standardization efforts are taking place <xref rid="cytoa23904-bib-0007" ref-type="ref">7</xref>, slight differences in sample handling between multiple batches are unavoidable <xref rid="cytoa23904-bib-0008" ref-type="ref">8</xref>. Computational techniques to remove this variance postmeasurement can offer a solution in those cases. A number of techniques have been proposed to align the distribution of markers across samples <xref rid="cytoa23904-bib-0009" ref-type="ref">9</xref>, <xref rid="cytoa23904-bib-0010" ref-type="ref">10</xref>, <xref rid="cytoa23904-bib-0011" ref-type="ref">11</xref>. However, these methods will align the distribution of each of the individual samples without making use of reference controls, which will also remove potentially biologically relevant differences in the distribution. In this work, we propose a pipeline for identification and normalization of technical variations using shared controls across multiple batches. Using control samples allows us to guarantee that the detected changes are only due to technical issues. Importantly, here we demonstrate that technical sources of variation can impact cell types differently, as was also described in <xref rid="cytoa23904-bib-0010" ref-type="ref">Reference 10</xref>. They provided the option to normalize one marker at the time during the manual gating process, allowing the user to choose for which subpopulation the normalization is applied. In contrast, to allow a fully automated procedure, our algorithm first uses a clustering algorithm for automated cell type identification prior to normalization.</p>
  <sec id="cytoa23904-sec-0002">
    <title>Materials and Methods</title>
    <sec id="cytoa23904-sec-0003">
      <title>Mass Cytometry Data Sets</title>
      <p>The main data set used in this study is a previously published mass cytometry data set immunoprofiling women during pregnancy <xref rid="cytoa23904-bib-0012" ref-type="ref">12</xref>. This data set included whole blood samples at four timepoints for 17 patients in the original cohort and an additional 10 patients in the validation cohort. Each patient was measured on a separately barcoded plate (including all timepoints and multiple stimulations (not used in this study)). In addition to the actual patient samples, we also made use of control samples. In the original cohort, blood from one healthy donor was taken along on every plate, both unstimulated and stimulated with Interferonα (IFNα) and Lipopolysaccharide (LPS). In the validation cohort, an additional healthy donor was taken along across all plates, to be used as a validation sample for our normalization protocol (four healthy donor samples per plate). The mass cytometry cytometry panel included 23 surface markers for cell phenotyping and 10 markers for functional analysis of the signaling responses (Supporting Information Table <xref rid="cytoa23904-supitem-0002" ref-type="supplementary-material">S1</xref>).</p>
    </sec>
    <sec id="cytoa23904-sec-0004">
      <title>Proposed Method</title>
      <p>A schematic overview of the proposed method is given in Figure <xref rid="cytoa23904-fig-0001" ref-type="fig">1</xref>. An identical control sample taken at one timepoint from one healthy control is included in each of the batches. Using the information from this control sample, our algorithm corrects for batch‐to‐batch variability, which might result from sample thawing, processing, staining and instrument particularities. The algorithm consists of two main parts: The batch effects are first modeled using the control sample, and afterward all samples can be normalized using the resulting models. This results in normalized data that is comparable between plates and can be used for further analysis.</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0001" orientation="portrait" position="float">
        <label>Figure 1</label>
        <caption>
          <p>Schematic overview of the proposed workflow. First the batch effects are learned on the control sample (blue part). Afterward, the other samples can be normalized (red part). When a validation sample is included on the plates, we can evaluate whether these aliquot measurements become more similar as well, as they should after correct normalization. [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-1" xlink:href="CYTO-97-268-g001"/>
      </fig>
      <sec id="cytoa23904-sec-0005">
        <title>Modeling the Batch Effects</title>
        <p>To model the batch effects, we propose a four‐step pipeline (shown in blue in Fig. <xref rid="cytoa23904-fig-0001" ref-type="fig">1</xref>). First, it clusters the cells of the control samples to capture the different cell types present in the data. Next the quantiles are computed to capture the distribution of the cells over the marker expression values. A goal distribution is then determined based on the means of the quantiles. Finally monotone Hermite splines are computed to translate the original values to new values that follow the goal distribution.</p>
        <p>We used FlowSOM for the automated cell population identification <xref rid="cytoa23904-bib-0013" ref-type="ref">13</xref>, Step 1 in Figure <xref rid="cytoa23904-fig-0001" ref-type="fig">1</xref>. The FlowSOM algorithm uses a two‐step clustering: The data are first divided in many more clusters than expected cell populations using a self‐organizing map (SOM) and next the resulting cluster centers are grouped using a consensus hierarchical clustering, resulting in the final cluster labels. By using this two‐step clustering, the FlowSOM algorithm can detect populations of varying sizes and shapes, without the computational overhead of density‐based clustering algorithms <xref rid="cytoa23904-bib-0014" ref-type="ref">14</xref>. To identify the populations from all batches, the training samples were first aggregated and the FlowSOM algorithm was applied to the aggregated sample. To limit the running time, a random subset was selected from each sample to use for training (1 million cells in total). All 37 markers were used for FlowSOM clustering. Once the clusters were determined, all original cells were mapped to their closest SOM‐cluster centers for further analysis.</p>
        <p>By applying clustering on the original data first, we made the assumption that while the measurements might have shifted between the different samples, the differences between the cell types are still bigger than the shifts caused by the batch effects. If this is the case, the percentage of cells assigned to each of the clusters should be similar across all control samples. We evaluated this by computing the percentage of cells assigned to each of the clusters for each of the samples, and computing the coefficient of variation for each of the clusters. In the training set, this resulted in a maximal CV of 0.87 for 25 clusters. Once CV values higher than two occur (which was the case for 30 or more clusters), it is likely that some of the clusters are severely impacted by the batch effects, which renders the clustering step inappropriate as a preprocessing step before quantile normalization.</p>
        <p>Once the FlowSOM algorithm was run, we applied the normalization per cluster. By processing only one cluster at a time, we assumed no further dependencies between the markers and normalized each marker separately. To describe the distribution of the cells for a specific marker, we made use of quantiles. A quantile indicates a boundary value for which a certain percentage of cells is lower, for example the 0.5 quantile corresponds to the median value, whereas the 0 quantile corresponds to the minimum value and the 1 quantile to the maximum. We computed 101 quantiles, from 0 to 1 in steps of 0.01, and obtained an overview of the distributions for each control sample per marker, per cluster (Step 2).</p>
        <p>Once the distributions were determined for all control samples, a goal distribution can either be computed as the mean value for each of the quantiles over the different control samples (Step 3), or the result of one of the specific batches can be picked as the goal distribution.</p>
        <p>To model the transformation needed to go from the actual distribution to the goal distribution, we used monotone hermite spline functions (as implemented in the monoH.FC method of the stats::splinefun function in R). A spline is a piece‐wise defined function, used to interpolate between given points, while still keeping a certain smoothness at the transitions between the piece‐wise defined functions. For each control sample, we used the original quantiles as the x‐values and the corresponding quantiles from the goal distribution as the y‐values to define the interpolation points. To avoid spurious extrapolation, we also added (0,0) and (8,8) to the interpolation points. The resulting spline function was then used to translate all original marker values to the new values, causing the data to become close to the goal distribution (Step 4).</p>
        <p>For every control sample, this resulted in one spline for each pair of clusters and markers.</p>
      </sec>
      <sec id="cytoa23904-sec-0006">
        <title>Normalizing the Data</title>
        <p>The precalculated FlowSOM model and the splines were used to normalize the rest of the samples, as shown in red in Figure <xref rid="cytoa23904-fig-0001" ref-type="fig">1</xref>. First the new samples were mapped on the given FlowSOM clustering, to assign every cell to a cluster (Step 5). Then, for every measured value, the corresponding spline function (given the cluster, the marker and the control sample of relevance) was applied (Step 6). This way, we adapted the cell expression values in the new samples to reverse the shifts detected in the control samples. The variation left could then be assumed to only represent the real biological variation (which should be minimal for the second control sample).</p>
      </sec>
    </sec>
    <sec id="cytoa23904-sec-0007">
      <title>Alternative methods</title>
      <p>We compared our proposed method with a few variations. Instead of using the 101 quantiles, we also tried an approach using only two quantiles, aligning either the minimum and maximum or the 0.001 and 0.999 quantiles. If only two quantiles are used, a linear function is modelled instead of using a spline function. Additionally, we also tried these methods either with or without the clustering step. In all these cases, we learned the models on the control samples, and afterward applied them on the validation samples.<disp-formula id="cytoa23904-disp-0001"><mml:math id="nlm-math-1"><mml:msub><mml:mi mathvariant="normal">x</mml:mi><mml:mi>norm</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfenced><mml:mrow><mml:mi mathvariant="normal">x</mml:mi><mml:mo> </mml:mo><mml:mo>–</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi mathvariant="normal">x</mml:mi><mml:mrow><mml:mi mathvariant="normal">q</mml:mi><mml:mn>0</mml:mn><mml:mo>.</mml:mo><mml:mn>001</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>/</mml:mo><mml:mfenced><mml:mrow><mml:msub><mml:mi mathvariant="normal">x</mml:mi><mml:mrow><mml:mi mathvariant="normal">q</mml:mi><mml:mn>0</mml:mn><mml:mo>.</mml:mo><mml:mn>999</mml:mn></mml:mrow></mml:msub><mml:mo> </mml:mo><mml:mo>–</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi mathvariant="normal">x</mml:mi><mml:mrow><mml:mi mathvariant="normal">q</mml:mi><mml:mn>0</mml:mn><mml:mo>.</mml:mo><mml:mn>001</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></disp-formula>
</p>
      <p>Next to these variations, which have been used in microarray normalization before <xref rid="cytoa23904-bib-0015" ref-type="ref">15</xref>, <xref rid="cytoa23904-bib-0016" ref-type="ref">16</xref>, we also compared our algorithm to GaussNorm <xref rid="cytoa23904-bib-0009" ref-type="ref">9</xref>, a technique previously proposed for the normalization of cytometry data. This algorithm does not allow to learn on control samples and translate the shifts to other samples afterward, so this was applied immediately on the set of sample of interest. It takes as input the expected number of peaks for every marker, which was manually determined by looking at the density plots. To enable application of a static gating build on one sample, we computed the landmarks used for alignment on one sample, and gave those landmarks as input for the normalization of all other samples.</p>
    </sec>
    <sec id="cytoa23904-sec-0008">
      <title>Evaluation</title>
      <p>A first evaluation of CytoNorm was applied on the validation samples included in the second cohort of the pregnancy study. We used the control samples of the first healthy donor to train a model and then normalized the validation samples from the second healthy donor. We tested whether known populations (as defined by a manually adapted gating) aligned better after normalization. To quantify this alignment, we made use of the Earth Movers Distance (EMD,<xref rid="cytoa23904-bib-0017" ref-type="ref">17</xref>). EMD is a distance measure specifically developed to compare distributions. To describe the distributions, we binned the data in bins of size 0.1 for every marker (on transformed data). For every manually gated cell population <italic>p</italic> and every marker <italic>m</italic>, we computed the pairwise EMDs across all the batches and took the maximum value. This indicates the maximum distances between two plates occurring in this data set. The lower this value is, the better. To evaluate how these distances change after normalization, we compute the EMDs for both the original data set and the normalized data sets. This allows us to compute the reduction in EMD, the percentage of the original distance that is eliminated by the normalization. To capture all this information in one number, we did not take into account the population‐marker pairs where both the original and normalized EMD values where lower than 2 (thus not impacted by the batch effects or the normalization) and compute the average over all other population‐marker pairs as a final score.<disp-formula id="cytoa23904-disp-0002"><mml:math id="nlm-math-2"><mml:msub><mml:mi mathvariant="italic">EMD</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mi>max</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mtext mathvariant="italic">validation samples</mml:mtext></mml:mrow></mml:munder><mml:mi mathvariant="italic">EMD</mml:mi><mml:mfenced open="(" close=")" separators=","><mml:mrow><mml:msub><mml:mtext mathvariant="italic">data</mml:mtext><mml:mi>i</mml:mi></mml:msub><mml:mfenced open="[" close="]"><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msub><mml:mtext mathvariant="italic">data</mml:mtext><mml:mi>j</mml:mi></mml:msub><mml:mfenced open="[" close="]"><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math></disp-formula>
<disp-formula id="cytoa23904-disp-0003"><mml:math id="nlm-math-3"><mml:msub><mml:mtext mathvariant="italic">Reduction</mml:mtext><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext mathvariant="italic">original</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi mathvariant="italic">EMD</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mtext mathvariant="italic">normalized</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi mathvariant="italic">EMD</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">original</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi mathvariant="italic">EMD</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math></disp-formula>
<disp-formula id="cytoa23904-disp-0004"><mml:math id="nlm-math-4"><mml:mtext mathvariant="italic">Reduction</mml:mtext><mml:mo>=</mml:mo><mml:munder><mml:mtext>mean</mml:mtext><mml:mtable columnalign="center"><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mtext mathvariant="italic">populations</mml:mtext></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>m</mml:mi><mml:mo>∈</mml:mo><mml:mtext mathvariant="italic">markers</mml:mtext></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="italic">EMD</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:munder><mml:msub><mml:mtext mathvariant="italic">Reduction</mml:mtext><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math></disp-formula>
</p>
      <p>Additionally, we evaluate the normalization procedure on the patient samples of the pregnancy study. For this purpose, we make use of a manual gating defined on one control sample, and apply this as a static gating on all files. In contrast, we also have the population frequencies of the original publication, where all gates were adapted as needed on the individual files. We show that on a normalized data set, time and effort can be saved by getting relevant results without having to manually adapt all gates.</p>
    </sec>
    <sec id="cytoa23904-sec-0009">
      <title>Availability</title>
      <p>This proposed algorithm is implemented in the R package “CytoNorm” and available on github at <ext-link ext-link-type="uri" xlink:href="http://www.github.com/saeyslab/CytoNorm">http://www.github.com/saeyslab/CytoNorm</ext-link>. As input, the user needs to provide the fcs files from the control samples, the fcs files that need to be normalized and labels indicating the batch origin for each file. Optionally, parameter settings for the FlowSOM algorithm and the number of quantiles can be chosen. In the end, a new set of fcs files is generated with normalized values. The pipeline used to generate the results described in this manuscript is available at <ext-link ext-link-type="uri" xlink:href="http://www.github.com/saeyslab/CytoNorm_Figures">http://www.github.com/saeyslab/CytoNorm_Figures</ext-link>. The fcs files and manual gating from the control samples from the original pregnancy cohort are available at flow repository ID FR‐FCM‐Z246. The fcs files and manual gatings from the validation pregnancy cohort are available at flow repository ID FR‐FCM‐Z247.</p>
    </sec>
  </sec>
  <sec id="cytoa23904-sec-0010">
    <title>Results</title>
    <sec id="cytoa23904-sec-0011">
      <title>Batch Effects Are Nonlinear and Can Be Cell‐Type Specific</title>
      <p>Before applying the CytoNorm method, we characterized the marker distributions of the control and validation samples (Fig. <xref rid="cytoa23904-fig-0002" ref-type="fig">2</xref>). While some small aliquot‐specific differences occurred, the main differences were caused by batch effects: the control and validation samples on the same plate had undergone similar changes in distribution compared to the other plates. When comparing a marker's median values of the 10 plates between the control and validation samples, there was an average correlation of 0.92 (± 0.10) for the unstimulated samples and an average correlation of 0.85 (± 0.15) for the stimulated samples. From this observation, we extrapolated that all samples on one barcoded plate had undergone similar changes. Learning these shifts based on one control sample taken along on all the plates should give us sufficient information to correct for the technical variability caused by the batch effects. As demonstrated with CD15 and CD66 in Figure <xref rid="cytoa23904-fig-0002" ref-type="fig">2</xref>, the batch effects can differ between the different markers, indicating that using beads in only a few channels would be insufficient to correct all batch effects.</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0002" orientation="portrait" position="float">
        <label>Figure 2</label>
        <caption>
          <p>Overview of CD15 and CD66 expression of four samples, replicated across 10 plates (ordered by time of measurement). It is notable that all samples from the same plate had similar shifts in comparison to the other plates, which indicates that these shifts were caused by batch effects. The density plots show the arcsinh‐transformed expression values (cofactor 5). The red line represents the median value, the full grey lines represent the 0.25 and 0.75 quantiles and the dashed gray lines represent the 0.05 and 0.95 quantiles. For CD15 the negative peak (in this case represented by the 0.05 and 0.25 quantiles) was quite stable, but the positive peak shifted between the plates. For CD66, especially the negative peak was impacted, although the positive peak also underwent slight shifts. [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-3" xlink:href="CYTO-97-268-g002"/>
      </fig>
      <p>Another important characteristic of the batch effects is shown in Figure <xref rid="cytoa23904-fig-0002" ref-type="fig">2</xref>: The shifts were dependent on the level of a marker's expression. Often the lines indicating the 25% quantiles followed a different pattern than the lines indicating the 75% quantiles. Therefore, applying a linear transformation to all cells would not remove the batch effect correctly. The proposed method utilizes spline functions, which can model nonlinear patterns across the expression range.</p>
      <p>In addition, we noted that some technical variations affected different cell types at different rates. An example is shown in Figure <xref rid="cytoa23904-fig-0003" ref-type="fig">3</xref>, where cells from two distinct populations had similar expression values for the HLA‐DR marker, but showed different patterns depending on other markers (gated as B cells [CD45 + CD66‐CD3‐CD7‐CD11c‐CD123‐] or monocytes [CD45 + CD66‐CD3‐CD7‐CD11c + CD123‐CD11b + CD33 + CD14+]). To handle these cell‐type specific batch effects, we applied a rough clustering on the cytometry data to detect the main cell populations before normalization.</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0003" orientation="portrait" position="float">
        <label>Figure 3</label>
        <caption>
          <p>Aliquots of blood samples from two healthy volunteers were measured on 10 separately barcoded plates. We focused on the HLADR intensities for manually gated B cells and monocytes (gated as resp. CD45 + CD66‐CD3‐CD7‐CD11c‐CD123‐ and CD45 + CD66‐CD3‐CD7‐CD11c + CD123‐CD11b + CD33 + CD14+). Even on the same intensity level, these cells underwent different shifts, while similar effects were still occurring between the different samples (note the stronger shift in HLADR signal for PTLG033 and PTLG034 for the monocytes vs. the B cells). The correlations between the median expression values per cell type were resp. 0.99 and 0.97, while across the two cell types, these correlations dropped to 0.79 and 0.86. This indicated that the batch effects were cell‐type specific and a one‐dimensional approach would not be sufficient to remove them. [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-5" xlink:href="CYTO-97-268-g003"/>
      </fig>
    </sec>
    <sec id="cytoa23904-sec-0012">
      <title>FlowSOM Metaclusters Are Minimally Effected by Batch Effects</title>
      <p>One strong assumption made by the CytoNorm pipeline is that the clusters which are normalized separately, are themselves not affected by the batch effects. We evaluated the proposal of using 25 final clusters on a FlowSOM result based on a 15 × 15 grid. Maximum CV between replicates was 0.87, indicating that on this level, little to no batch effects were influencing the results. We tested multiple numbers of final clusters (going from 3 to 50), and computed the coefficient of variation for the percentage of each of the control samples assigned to the cluster, as shown in Figure <xref rid="cytoa23904-fig-0004" ref-type="fig">4</xref>. Once CV values higher than 2 occur (which is the case for 30 or more clusters), it is likely that some of the clusters are severely impacted by the batch effects, which renders the clustering step inappropriate as a preprocessing step before quantile normalization.</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0004" orientation="portrait" position="float">
        <label>Figure 4</label>
        <caption>
          <p>Coefficient of variation results for several clustering results (varied from 3 to 50 final FlowSOM clusters [each one row in the figure] and the 225 original clusters [the bottom 5 rows]). Values are shown on the figure if they are higher than 1.5. We note that as the number of clusters increases, the coefficient of variation increases, as some clusters become batch‐specific. [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-7" xlink:href="CYTO-97-268-g004"/>
      </fig>
    </sec>
    <sec id="cytoa23904-sec-0013">
      <title>CytoNorm Aligns Populations between Validation Controls</title>
      <p>We applied the CytoNorm method to normalize the signal variability across the samples. We used either the unstimulated or the stimulated samples of one of the volunteers to learn the batch effects and applied the resulting model to the corresponding samples from the other volunteer. We modeled the batch effects using a FlowSOM grid with 10 × 10 nodes and 25 final clusters, and modeled the splines using 101 quantiles. The new distribution of the data is shown in Figure <xref rid="cytoa23904-fig-0005" ref-type="fig">5</xref>A, analogous to Figure <xref rid="cytoa23904-fig-0002" ref-type="fig">2</xref> before normalization. Additionally, we computed the EMD values for every marker per cell type, using a manual gating of the data set (see Supporting Information Fig. S1). We applied this measurement on both the original and the normalized samples and plotted those EMD values against each other. A representative result of one experiment for our proposed method is shown in Figure <xref rid="cytoa23904-fig-0005" ref-type="fig">5</xref>B, while Supporting Information <xref rid="cytoa23904-supitem-0002" ref-type="supplementary-material">Figure S5</xref> gives the full overview of the different samples and methods we tested. In these figures, points on the black diagonal line have the same EMD value before and after normalization. The points above the black line have smaller distances after normalization, while the points below the diagonal have an increased EMD. We conclude that most distances decreased, indicating a reduction in overall batch effect. The average percentage of decrease in distance over the four different testing setups was 0.61 (± 0.39), not taking distances smaller than two into account. In all four of the setups, the EMDs significantly decreased after normalization.</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0005" orientation="portrait" position="float">
        <label>Figure 5</label>
        <caption>
          <p>(<bold>A</bold>) Overview of the density distributions of the validation samples after normalization (trained on the control samples). The distributions align much better than before, indicating the removal of the batch effects. (<bold>B</bold>) Comparison of the original distances between unstimulated samples measured for Volunteer 2, versus the distances after normalization using the batch effect model of Volunteer 1. Every dot represents one specific population‐marker combination (36 markers × 10 manually gated cell types = 360 dots). The thick black line indicates the diagonal, all values above this line have decreased after normalization. Dots situated more to the left indicate better results. Red dots indicate values with a bigger distance after normalization than before. Values in the grey area had distances smaller than two before and after normalization, indicating they were not affected by the batch effects and were ignored in the evaluation. For those values affected by the batch effects, normalization with our proposed method resulted in an average decrease of 0.6623 for the unstimulated samples from Volunteer 2, trained on the unstimulated samples from Volunteer 1. [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-9" xlink:href="CYTO-97-268-g005"/>
      </fig>
      <p>We compared our proposed method with three alternatives: quantile normalization without clustering and approximate min‐max normalization with or without clustering. We compared the results from the approaches with clustering to the results without, as shown in Table <xref rid="cytoa23904-tbl-0001" ref-type="table">1</xref>. When we computed the reduction compared to the original distances, the quantile normalization algorithm resulted in a reduction of only 0.21 (± 1.62). Approximate min‐max normalization applied on clustered cells resulted in a reduction of 0.21 (± 0.62), while approximate min‐max normalization without clustering had a negative average score. Plots comparing the EMDs before and after normalization for all methods are given in Supporting Information <xref rid="cytoa23904-supitem-0002" ref-type="supplementary-material">Figure S2</xref>.</p>
      <table-wrap id="cytoa23904-tbl-0001" xml:lang="en" orientation="portrait" position="float">
        <label>Table 1</label>
        <caption>
          <p>Overview of the average reduction of all different methods, over all experiments and per individual experiment setup (V1,V2: volunteer used for training, stim,unstim: stimulation of samples used)</p>
        </caption>
        <table frame="hsides" rules="groups">
          <col align="left" span="1"/>
          <col align="char" char="(" span="1"/>
          <col align="char" char="(" span="1"/>
          <col align="char" char="(" span="1"/>
          <col align="char" char="(" span="1"/>
          <thead valign="bottom">
            <tr style="border-bottom:solid 1px #000000">
              <th align="left" style="border-bottom:solid 1px #000000" valign="bottom" rowspan="1" colspan="1"/>
              <th colspan="2" align="center" style="border-bottom:solid 1px #000000" valign="bottom" rowspan="1">101 quantiles (0, 0.01, 0.02, …, 1)</th>
              <th colspan="2" align="center" style="border-bottom:solid 1px #000000" valign="bottom" rowspan="1">2 quantiles (0.001, 0.999)</th>
            </tr>
            <tr style="border-bottom:solid 1px #000000">
              <th align="left" valign="bottom" rowspan="1" colspan="1"/>
              <th align="center" valign="bottom" rowspan="1" colspan="1">With clustering “CytoNorm”</th>
              <th align="center" valign="bottom" rowspan="1" colspan="1">Without clustering</th>
              <th align="center" valign="bottom" rowspan="1" colspan="1">With clustering</th>
              <th align="center" valign="bottom" rowspan="1" colspan="1">Without clustering</th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">Overall score</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.62 (±0.43)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.21 (±1.62)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.21 (±0.62)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">−0.12 (±0.74)</td>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">V1, unstim</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.65 (±0.34)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.20 (±0.80)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.26 (±0.46)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">−0.10 (±0.69)</td>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">V1, stim</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.58 (±0.48)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.16 (±0.71)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.21 (±0.58)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">−0.30 (±1.04)</td>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">V2, unstim</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.69 (±0.41)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.36 (±0.66)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.22 (±0.38)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.05 (±0.47)</td>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">V2, stim</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.56 (±0.46)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.13 (±2.94)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">0.15 (±0.90)</td>
              <td align="char" valign="top" rowspan="1" colspan="1">−0.09 (±0.57)</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
    <sec id="cytoa23904-sec-0014">
      <title>CytoNorm Allows Better Alignment in Dimensionality Reduction Figures</title>
      <p>To have another look at the data, we applied tSNE dimensionality reduction (perplexity 30) on 10.000 cells sampled from the 10 unstimulated validation samples, either of the original data or the data after normalization. When using the original validation samples as input for a tSNE dimensionality reduction, we noticed a batch effect where the location of the cells was impacted by their measurement plate. After normalization, the populations were better aligned, and fewer batch specific regions could be identified (Fig. <xref rid="cytoa23904-fig-0006" ref-type="fig">6</xref>)</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0006" orientation="portrait" position="float">
        <label>Figure 6</label>
        <caption>
          <p>tSNE dimensionality reduction of 10.000 cells sampled from the 10 validation samples (1,000 cells each). Colored by sample (= batch). [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-11" xlink:href="CYTO-97-268-g006"/>
      </fig>
    </sec>
    <sec id="cytoa23904-sec-0015">
      <title>Control Samples Should Span the Full Data Range</title>
      <p>It is important that the control samples encompass the whole range of expression values. To demonstrate this, we combined the unstimulated control samples with the stimulated control samples. The cells in these stimulated samples contained intracellular signaling responses that were not present in the unstimulated samples.</p>
      <p>We explored three different settings: training on an aggregate of stimulated and unstimulated control samples, training on only the unstimulated control samples or training on only the stimulated control samples. The results on the unstimulated and stimulated validation samples are shown in Figure <xref rid="cytoa23904-fig-0007" ref-type="fig">7</xref>.</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0007" orientation="portrait" position="float">
        <label>Figure 7</label>
        <caption>
          <p>Effect of different stimulations between the training and normalization data set. When the necessary range was not present in the reference samples, extrapolation of the splines introduced wrong transformations, indicated by dots below the diagonal line. [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-13" xlink:href="CYTO-97-268-g007"/>
      </fig>
      <p>When we trained only on the unstimulated sample from Volunteer 1 (middle column), we estimated the batch effects correctly for the unstimulated samples of Volunteer 2: Almost all distances became smaller (top row, middle), as shown in the previous section. However, when we used this model on the stimulated samples, many distances became larger instead of smaller (bottom row, middle, contains many dots under the diagonal in the figure, colored in red). This confirmed that the batch effects were not linear over the range of the expression values. As we could only train on cells where the expression values were low, the model had no information about the batch effects for high expression and made mistakes when extrapolating (example of such a spline given in Supporting Information <xref rid="cytoa23904-supitem-0002" ref-type="supplementary-material">Fig. S3</xref>).</p>
      <p>When we trained on the stimulated samples (right column), this problem was resolved and the stimulated samples were correctly normalized (bottom row, right). However, in this case, the unstimulated samples caused a problem because the negative populations were not always represented well in the stimulated samples (top row, right).</p>
      <p>The optimal solution was to make sure that the training samples included the whole marker expression range, which was the case when the model was built using both stimulated and unstimulated controls (left column). This model worked well for both the stimulated and unstimulated samples of Volunteer 2 and few red dots appear in either the top or the bottom plot.</p>
    </sec>
    <sec id="cytoa23904-sec-0016">
      <title>Improved Results for Static Gatings on Clinical Data Set</title>
      <p>Finally, we applied CytoNorm on the 27 unstimulated patient samples of the pregnancy study (both the original and the validation cohort). The model was trained on the unstimulated control samples, with a FlowSOM grid of 15 by 15 and a final number of 5 clusters (as we saw some increased CV values for 10 clusters, Supporting Information <xref rid="cytoa23904-supitem-0002" ref-type="supplementary-material">Fig. S4</xref>). The goal quantiles were set to be those of the first control sample, rather than the average overall. We then normalized all unstimulated patient samples, and applied a static gating (defined on this first control sample) to all the samples. We compared these static gating results to the manually adapted gating results as reported in the original publication. Results are shown in Figure <xref rid="cytoa23904-fig-0008" ref-type="fig">8</xref>A. It is clear that the validation cohort (blue dots) underwent a big batch effect, strongly skewing the static gating on the original files. While gaussNorm improved the samples, CytoNorm gained results closest to the frequency of the manually adapted gates (closest to the diagonal). When we checked the main parameter that was of relevance in the original paper, we could confirm that the normalization procedure helps to align the data points from the two cohorts better, whereas gaussNorm seemed to have over‐normalized and removed some of the actual biological variation between the samples.</p>
      <fig fig-type="Figure" xml:lang="en" id="cytoa23904-fig-0008" orientation="portrait" position="float">
        <label>Figure 8</label>
        <caption>
          <p>Results on the patient files from the pregnancy study. Red dots: values from original cohort, Blue dots: values from the validation cohort. Top row: comparison of population frequencies acquired by manually adapted gates (x‐axis) and static gating (y‐axis). Applied on files before or after normalization (gaussNorm/CytoNorm). Bottom row: STAT5 MFI values for statically gated CD4+ Naïve T cells. [Color figure can be viewed at <ext-link ext-link-type="uri" xlink:href="http://wileyonlinelibrary.com">http://wileyonlinelibrary.com</ext-link>]</p>
        </caption>
        <graphic id="nlm-graphic-15" xlink:href="CYTO-97-268-g008"/>
      </fig>
    </sec>
  </sec>
  <sec id="cytoa23904-sec-0017">
    <title>Discussion</title>
    <p>We developed and evaluated CytoNorm, a new normalization method for cytometry data applicable to large clinical studies. We demonstrate that CytoNorm allows reducing mass cytometry signal variability across multiple batches of barcoded samples. However, the algorithm is not limited to mass cytometry data, but could also be applied to other data sets that contain multiple batches, if a reference sample was used and subset‐specific effects are suspected. Notably, CytoNorm could be applied to fluorescence flow cytometry data sets, because many of the causes of technical variance will be the same as for mass cytometry data (e.g., sample preparation happens in a similar manner).</p>
    <p>The main requirement for a successful application is that the individual sample variation should be limited compared to the batch‐to‐batch variation. We proposed the CV of the cluster percentages to validate this requirement. It is also important that the reference samples span the full expression range of the samples of interest and consist of cell types that are similar to the ones in the samples of interest. To ensure that the full expression range is captured, it might be necessary to include multiple control samples (e.g., with different stimulations), which can be synthetically combined to learn the batch effects.</p>
    <p>To evaluate the strength of the normalization procedure in new settings, it is highly recommended to take two control samples along. Only this way a correct estimation of the impact of the model can be made. In cases where the changes to the control samples are not corresponding to the changes in the other samples, the model might incorrectly transform the data. If taking two controls along with all the batches would not be feasible, it might be useful to at least run a preliminary study with two control samples to test if the same conclusions hold. In this case, it would be recommended to have one control sample from an easily accessible source, which can be taken along on all other batches as the references, and one which is as close to the real samples of interest as possible (same tissue, stimulation, etc.) to test whether the control sample is sufficient to estimate the batch effects on the real samples.</p>
    <p>A limitation of our pipeline is the assumption that the batch effects are small enough that the clustering result is minimally impacted. In experiments where large batch effects occur, biologically similar cells might be split in different clusters, which will thus not be aligned. Future research could optimize the clustering step included in the algorithm to avoid these issues. Additionally, it might be difficult to ensure that the control samples span the same expression range as the samples of interest. Future research could optimize the splines to not deviate too far from the identity function in case of extrapolation to avoid spurious artefacts.</p>
    <p>In summary, we proposed a normalization strategy for batch effect removal that enables mass cytometry analysis of large clinical cohorts. Importantly, to avoid accidental removal of biologically relevant signals, the algorithm makes no assumptions about the distributions of the clinical samples and relies on the consistency of cellular barcoding and control samples. Also, the algorithm uses a multilayer learning strategy to account for cell‐type specific technical variations. The results demonstrated significant improvements in the quality of primary clinical samples, by reducing the technical variability between the samples.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="cytoa23904-supitem-0001">
      <caption>
        <p><bold>MIFlowCyt</bold>: MIFlowCyt‐Compliant Items</p>
      </caption>
      <media xlink:href="CYTO-97-268-s001.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="cytoa23904-supitem-0002">
      <caption>
        <p><bold>Supplementary Table 1</bold> Antibody Panel</p>
        <p><bold>Supplementary Figure 1</bold>: Manual gating of the dataset</p>
        <p><bold>Supplementary Figure 2</bold>: Evaluation of multiple normalization algorithms</p>
        <p><bold>Supplementary Figure 3</bold>: Issues with extrapolation</p>
        <p>Example of a spline learned on small values only (A) or with few small values (B). x‐values shows the control quantiles, y‐values show the goal quantiles. The red line shows the fitted spline, grey line shows identity function. Both are normalization splines for STAT5 (different clusters, A trained on unstimulated, B trained on stimulated).</p>
        <p><bold>Supplementary Figure 4</bold>: CV values for the unstimulated controls over the original and validation cohort. Tested for 5, 10, 15 or 20 metaclusters and 225 original clusters.</p>
      </caption>
      <media xlink:href="CYTO-97-268-s002.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="cytoa23904-sec-0018">
    <title>Acknowledgments</title>
    <p>Y.S. and S.V.G. are ISAC Marylou Ingram Scholars. S.V.G. was supported by an FWO travel grant and an FWO postdoctoral research grant (Research Foundation – Flanders). B.G., M.S.A., and N.A. were supported by Department of Anesthesiology Pain, and Perioperative Medicine at Stanford University, the Bill and Melinda Gates Foundation, the Robertson Family Foundation, and the March of Dimes Prematurity Research Center at Stanford University, the Doris Duke Charitable Foundation (B.G.), the National Institute of Health (R21DE027728‐01, B.G.), and the Burroughs Wellcome Preterm Birth Initiative (N.A.).</p>
  </ack>
  <ref-list id="cytoa23904-bibl-0001" content-type="cited-references">
    <title>References</title>
    <ref id="cytoa23904-bib-0001">
      <label>1</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0001"><string-name><surname>Staser</surname><given-names>KW</given-names></string-name>, <string-name><surname>Eades</surname><given-names>W</given-names></string-name>, <string-name><surname>Choi</surname><given-names>J</given-names></string-name>, <string-name><surname>Karpova</surname><given-names>D</given-names></string-name>, <string-name><surname>DiPersio</surname><given-names>JF</given-names></string-name>. <article-title>OMIP‐042: 21‐color flow cytometry to comprehensively immunophenotype major lymphocyte and myeloid subsets in human peripheral blood</article-title>. <source xml:lang="en">Cytometry</source><year>2018</year>;<volume>93</volume>:<fpage>186</fpage>–<lpage>189</lpage>. <pub-id pub-id-type="doi">10.1002/cyto.a.23303</pub-id>.<pub-id pub-id-type="pmid">29288606</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0002">
      <label>2</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0002"><string-name><surname>van Dongen</surname><given-names>JJM</given-names></string-name>, <string-name><surname>Lhermitte</surname><given-names>L</given-names></string-name>, <string-name><surname>Böttcher</surname><given-names>S</given-names></string-name>, <string-name><surname>Almeida</surname><given-names>J</given-names></string-name>, <string-name><surname>Van der Velden</surname><given-names>VHJ</given-names></string-name>, <string-name><surname>Flores‐Montero</surname><given-names>J</given-names></string-name>, <string-name><surname>Rawstron</surname><given-names>A</given-names></string-name>, <string-name><surname>Asnafi</surname><given-names>V</given-names></string-name>, <string-name><surname>Lecrevisse</surname><given-names>Q</given-names></string-name>, <string-name><surname>Lucio</surname><given-names>P</given-names></string-name>, et al. <article-title>EuroFlow antibody panels for standardized n‐dimensional flow cytometric immunophenotyping of normal, reactive and malignant leukocytes</article-title>. <source xml:lang="en">Leukemia</source><year>2012</year>;<volume>26</volume>(<issue>9</issue>):<fpage>1908</fpage>–<lpage>1975</lpage>.<pub-id pub-id-type="pmid">22552007</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0003">
      <label>3</label>
      <mixed-citation publication-type="book" id="cytoa23904-cit-0003"><string-name><surname>Larbi</surname><given-names>A</given-names></string-name>. <chapter-title>Flow cytometry in multi‐center and longitudinal studies</chapter-title> In: <person-group person-group-type="editor"><name name-style="western"><surname>Robinson</surname><given-names>J</given-names></name></person-group>, <person-group person-group-type="editor"><name name-style="western"><surname>Cossarizza</surname><given-names>A</given-names></name></person-group>, editors. <source xml:lang="en">Single Cell Analysis. Series in BioEngineering</source>. <publisher-loc>Singapore</publisher-loc>: <publisher-name>Springer</publisher-name>, <year>2017</year>.</mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0004">
      <label>4</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0004"><string-name><surname>Finck</surname><given-names>R</given-names></string-name>, <string-name><surname>Simonds</surname><given-names>EF</given-names></string-name>, <string-name><surname>Jager</surname><given-names>A</given-names></string-name>, <string-name><surname>Krishnaswamy</surname><given-names>S</given-names></string-name>, <string-name><surname>Sachs</surname><given-names>K</given-names></string-name>, <string-name><surname>Fantl</surname><given-names>W</given-names></string-name>, <string-name><surname>Pe'er</surname><given-names>D</given-names></string-name>, <string-name><surname>Nolan</surname><given-names>GP</given-names></string-name>, <string-name><surname>Bendall</surname><given-names>SC</given-names></string-name>. <article-title>Normalization of mass cytometry data with bead standards</article-title>. <source xml:lang="en">Cytometry A</source><year>2013</year>;<volume>83</volume>(<issue>5</issue>):<fpage>483</fpage>–<lpage>494</lpage>.<pub-id pub-id-type="pmid">23512433</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0005">
      <label>5</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0005"><string-name><surname>Krutzik</surname><given-names>PO</given-names></string-name>, <string-name><surname>Nolan</surname><given-names>GP</given-names></string-name>. <article-title>Fluorescent cell barcoding in flow cytometry allows high‐throughput drug screening and signaling profiling</article-title>. <source xml:lang="en">Nat Methods</source><year>2006</year>;<volume>3</volume>:<fpage>361</fpage>–<lpage>368</lpage>.<pub-id pub-id-type="pmid">16628206</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0006">
      <label>6</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0006"><string-name><surname>Zunder</surname><given-names>ER</given-names></string-name>, <string-name><surname>Finck</surname><given-names>R</given-names></string-name>, <string-name><surname>Behbehani</surname><given-names>GK</given-names></string-name>, <string-name><surname>El‐ad</surname><given-names>DA</given-names></string-name>, <string-name><surname>Krishnaswamy</surname><given-names>S</given-names></string-name>, <string-name><surname>Gonzalez</surname><given-names>VD</given-names></string-name>, <string-name><surname>Lorang</surname><given-names>CG</given-names></string-name>, <string-name><surname>Bjornson</surname><given-names>Z</given-names></string-name>, <string-name><surname>Spitzer</surname><given-names>MH</given-names></string-name>, <string-name><surname>Bodenmiller</surname><given-names>B</given-names></string-name>, et al. <article-title>Palladium‐based mass tag cell barcoding with a doublet‐filtering scheme and single‐cell deconvolution algorithm</article-title>. <source xml:lang="en">Nat Protoc</source><year>2015</year>;<volume>10</volume>(<issue>2</issue>):<fpage>316</fpage>–<lpage>333</lpage>.<pub-id pub-id-type="pmid">25612231</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0007">
      <label>7</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0007"><string-name><surname>Finak</surname><given-names>G</given-names></string-name>, <string-name><surname>Langweiler</surname><given-names>M</given-names></string-name>, <string-name><surname>Jaimes</surname><given-names>M</given-names></string-name>, <string-name><surname>Malek</surname><given-names>M</given-names></string-name>, <string-name><surname>Taghiyar</surname><given-names>J</given-names></string-name>, <string-name><surname>Korin</surname><given-names>Y</given-names></string-name>, <string-name><surname>Raddassi</surname><given-names>K</given-names></string-name>, <string-name><surname>Devine</surname><given-names>L</given-names></string-name>, <string-name><surname>Obermoser</surname><given-names>G</given-names></string-name>, <string-name><surname>Pekalski</surname><given-names>ML</given-names></string-name>, et al. <article-title>Standardizing flow cytometry immunophenotyping analysis from the Human ImmunoPhenotyping Consortium</article-title>. <source xml:lang="en">Sci Rep</source><year>2016</year>;<volume>6</volume>:<elocation-id>20686</elocation-id>.<pub-id pub-id-type="pmid">26861911</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0008">
      <label>8</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0008"><string-name><surname>Kleinsteuber</surname><given-names>K</given-names></string-name>, <string-name><surname>Corleis</surname><given-names>B</given-names></string-name>, <string-name><surname>Rashidi</surname><given-names>N</given-names></string-name>, <string-name><surname>Nchinda</surname><given-names>N</given-names></string-name>, <string-name><surname>Lisanti</surname><given-names>A</given-names></string-name>, <string-name><surname>Cho</surname><given-names>JL</given-names></string-name>, <string-name><surname>Medoff</surname><given-names>BD</given-names></string-name>, <string-name><surname>Kwon</surname><given-names>D</given-names></string-name>, <string-name><surname>Walker</surname><given-names>BD</given-names></string-name>. <article-title>Standardization and quality control for high‐dimensional mass cytometry studies of human samples</article-title>. <source xml:lang="en">Cytometry A</source><year>2016</year>;<volume>89</volume>(<issue>10</issue>):<fpage>903</fpage>–<lpage>913</lpage>.<pub-id pub-id-type="pmid">27575385</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0009">
      <label>9</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0009"><string-name><surname>Hahne</surname><given-names>F</given-names></string-name>, <string-name><surname>Khodabakhshi</surname><given-names>AH</given-names></string-name>, <string-name><surname>Bashashati</surname><given-names>A</given-names></string-name>, <string-name><surname>Wong</surname><given-names>C</given-names></string-name>, <string-name><surname>Gascoyne</surname><given-names>RD</given-names></string-name>, <string-name><surname>Weng</surname><given-names>AP</given-names></string-name>, <string-name><surname>Seifert‐Margolis</surname><given-names>V</given-names></string-name>, <string-name><surname>Bourcier</surname><given-names>D</given-names></string-name>, <string-name><surname>Asare</surname><given-names>A</given-names></string-name>, <string-name><surname>Lumley</surname><given-names>T</given-names></string-name>, et al. <article-title>Per‐channel basis normalization methods for flow cytometry data</article-title>. <source xml:lang="en">Cytometry A</source><year>2010</year>;<volume>77</volume>(<issue>2</issue>):<fpage>121</fpage>–<lpage>131</lpage>.<pub-id pub-id-type="pmid">19899135</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0010">
      <label>10</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0010"><string-name><surname>Finak</surname><given-names>G</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>W</given-names></string-name>, <string-name><surname>Krouse</surname><given-names>K</given-names></string-name>, <string-name><surname>Wei</surname><given-names>C</given-names></string-name>, <string-name><surname>Sanz</surname><given-names>I</given-names></string-name>, <string-name><surname>Phippard</surname><given-names>D</given-names></string-name>, <string-name><surname>Asare</surname><given-names>A</given-names></string-name>, <string-name><surname>De Rosa</surname><given-names>SC</given-names></string-name>, <string-name><surname>Self</surname><given-names>S</given-names></string-name>, <string-name><surname>Gottardo</surname><given-names>R</given-names></string-name>. <article-title>High throughput flow cytometry data normalization for clinical trials</article-title>. <source xml:lang="en">Cytometry A</source><year>2014</year>;<volume>85</volume>(<issue>3</issue>):<fpage>277</fpage>–<lpage>286</lpage>.<pub-id pub-id-type="pmid">24382714</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0011">
      <label>11</label>
      <mixed-citation publication-type="miscellaneous" id="cytoa23904-cit-0011"><string-name><surname>Upadhyay</surname><given-names>U</given-names></string-name>, <string-name><surname>Jain</surname><given-names>A</given-names></string-name>. <article-title>Removal of batch effects using generative adversarial networks. arXiv preprint 2019; arXiv:1901.06654</article-title>.</mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0012">
      <label>12</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0012"><string-name><surname>Aghaeepour</surname><given-names>N</given-names></string-name>, <string-name><surname>Ganio</surname><given-names>EA</given-names></string-name>, <string-name><surname>Mcilwain</surname><given-names>D</given-names></string-name>, <string-name><surname>Tsai</surname><given-names>AS</given-names></string-name>, <string-name><surname>Tingle</surname><given-names>M</given-names></string-name>, <string-name><surname>Van Gassen</surname><given-names>S</given-names></string-name>, <string-name><surname>Gaudilliere</surname><given-names>DK</given-names></string-name>, <string-name><surname>Baca</surname><given-names>Q</given-names></string-name>, <string-name><surname>McNeil</surname><given-names>L</given-names></string-name>, <string-name><surname>Okada</surname><given-names>R</given-names></string-name>, et al. <article-title>An immune clock of human pregnancy</article-title>. <source xml:lang="en">Sci Immunol</source><year>2017</year>;<volume>2</volume>(<issue>15</issue>):<elocation-id>eaan2946</elocation-id>.<pub-id pub-id-type="pmid">28864494</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0013">
      <label>13</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0013"><string-name><surname>Van Gassen</surname><given-names>S</given-names></string-name>, <string-name><surname>Callebaut</surname><given-names>B</given-names></string-name>, <string-name><surname>Van Helden</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Lambrecht</surname><given-names>BN</given-names></string-name>, <string-name><surname>Demeester</surname><given-names>P</given-names></string-name>, <string-name><surname>Dhaene</surname><given-names>T</given-names></string-name>, <string-name><surname>Saeys</surname><given-names>Y</given-names></string-name>. <article-title>FlowSOM: using self‐organizing maps for visualization and interpretation of cytometry data</article-title>. <source xml:lang="en">Cytometry A</source><year>2015</year>;<volume>87</volume>(<issue>7</issue>):<fpage>636</fpage>–<lpage>645</lpage>.<pub-id pub-id-type="pmid">25573116</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0014">
      <label>14</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0014"><string-name><surname>Weber</surname><given-names>L</given-names></string-name>, <string-name><surname>Robinson</surname><given-names>M</given-names></string-name>. <article-title>Comparison of clustering methods for high‐dimensional single‐cell flow and mass cytometry data</article-title>. <source xml:lang="en">Cytometry A</source><year>2016</year>;<volume>89</volume>(<issue>12</issue>):<fpage>1084</fpage>–<lpage>1096</lpage>.<pub-id pub-id-type="pmid">27992111</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0015">
      <label>15</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0015"><string-name><surname>Workman</surname><given-names>C</given-names></string-name>, <string-name><surname>Jensen</surname><given-names>LJ</given-names></string-name>, <string-name><surname>Jarmer</surname><given-names>H</given-names></string-name>, <string-name><surname>Berka</surname><given-names>R</given-names></string-name>, <string-name><surname>Gautier</surname><given-names>L</given-names></string-name>, <string-name><surname>Nielser</surname><given-names>HB</given-names></string-name>, <string-name><surname>Saxild</surname><given-names>H</given-names></string-name>, <string-name><surname>Nielsen</surname><given-names>C</given-names></string-name>, <string-name><surname>Brunak</surname><given-names>S</given-names></string-name>, <string-name><surname>Knudsen</surname><given-names>S</given-names></string-name>. <article-title>A new non‐linear normalization method for reducing variability in DNA microarray experiments</article-title>. <source xml:lang="en">Genome Biol</source><year>2002</year>;<volume>3</volume>(<issue>9</issue>):0048.1</mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0016">
      <label>16</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0016"><string-name><surname>Hansen</surname><given-names>KD</given-names></string-name>, <string-name><surname>Irizarry</surname><given-names>RA</given-names></string-name>, <string-name><surname>Wu</surname><given-names>Z</given-names></string-name>. <article-title>Removing technical variability in RNA‐seq data using conditional quantile normalization</article-title>. <source xml:lang="en">Biostatistics</source><year>2012</year>;<volume>13</volume>(<issue>2</issue>):<fpage>204</fpage>–<lpage>216</lpage>.<pub-id pub-id-type="pmid">22285995</pub-id></mixed-citation>
    </ref>
    <ref id="cytoa23904-bib-0017">
      <label>17</label>
      <mixed-citation publication-type="journal" id="cytoa23904-cit-0017"><string-name><surname>Rubner</surname><given-names>Y</given-names></string-name>, <string-name><surname>Tomasi</surname><given-names>C</given-names></string-name>, <string-name><surname>Guibas</surname><given-names>LJ</given-names></string-name>. <article-title>The earth mover's distance as a metric for image retrieval</article-title>. <source xml:lang="en">Int. J Comp Vision</source><year>2000</year>;<volume>40</volume>(<issue>2</issue>):<fpage>99</fpage>–<lpage>121</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
