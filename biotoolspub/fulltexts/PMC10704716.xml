<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Algorithms Mol Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Algorithms Mol Biol</journal-id>
    <journal-title-group>
      <journal-title>Algorithms for Molecular Biology : AMB</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1748-7188</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10704716</article-id>
    <article-id pub-id-type="pmid">38062452</article-id>
    <article-id pub-id-type="publisher-id">247</article-id>
    <article-id pub-id-type="doi">10.1186/s13015-023-00247-x</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EMMA: a new method for computing multiple sequence alignments given a constraint subset alignment</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Shen</surname>
          <given-names>Chengze</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Baqiao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Williams</surname>
          <given-names>Kelly P.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Warnow</surname>
          <given-names>Tandy</given-names>
        </name>
        <address>
          <email>warnow@illinois.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/047426m28</institution-id><institution-id institution-id-type="GRID">grid.35403.31</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 9991</institution-id><institution>Computer Science, </institution><institution>University of Illinois, Urbana-Champaign, </institution></institution-wrap>201 N. Goodwin Ave, Urbana, 61801 IL USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/01apwpt12</institution-id><institution-id institution-id-type="GRID">grid.474520.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2151 9272</institution-id><institution>Sandia National Laboratories, </institution></institution-wrap>7011 East Ave., Livermore, 94550 CA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>7</day>
      <month>12</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>7</day>
      <month>12</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>18</volume>
    <elocation-id>21</elocation-id>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Adding sequences into an existing (possibly user-provided) alignment has multiple applications, including updating a large alignment with new data, adding sequences into a constraint alignment constructed using biological knowledge, or computing alignments in the presence of sequence length heterogeneity. Although this is a natural problem, only a few tools have been developed to use this information with high fidelity.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We present EMMA (Extending Multiple alignments using MAFFT--add) for the problem of adding a set of unaligned sequences into a multiple sequence alignment (i.e., a constraint alignment). EMMA builds on MAFFT--add, which is also designed to add sequences into a given constraint alignment. EMMA improves on MAFFT--add methods by using a divide-and-conquer framework to scale its most accurate version, MAFFT-linsi--add, to constraint alignments with many sequences. We show that EMMA has an accuracy advantage over other techniques for adding sequences into alignments under many realistic conditions and can scale to large datasets with high accuracy (hundreds of thousands of sequences). EMMA is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/c5shen/EMMA">https://github.com/c5shen/EMMA</ext-link>.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">EMMA is a new tool that provides high accuracy and scalability for adding sequences into an existing alignment.</p>
      </sec>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s13015-023-00247-x.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Multiple sequence alignment</kwd>
      <kwd>Constraint alignment</kwd>
      <kwd>MAFFT</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100006234</institution-id>
            <institution>Sandia National Laboratories</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100006234</institution-id>
            <institution>Sandia National Laboratories</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>US National Science Foundation</institution>
        </funding-source>
        <award-id>2006069</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© BioMed Central Ltd., part of Springer Nature 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <sec id="Sec2">
      <title>Adding sequences to a multiple sequence alignment</title>
      <p id="Par4">Multiple sequence alignment (MSA) is a crucial precursor to many downstream biological analyses, such as phylogeny estimation [<xref ref-type="bibr" rid="CR1">1</xref>], RNA structure prediction [<xref ref-type="bibr" rid="CR2">2</xref>], protein structure prediction [<xref ref-type="bibr" rid="CR3">3</xref>], etc. Obtaining an accurate MSA can be challenging, especially when the dataset is large (i.e., more than 1000 sequences). In some cases, the problem of estimating an alignment on a large dataset can be addressed through approaches that seek to add sequences into a given alignment without allowing the given alignment to change; for this reason, the given alignment is referred to as a “constraint alignment”. For example, biological knowledge can be used to form a reference alignment on a subset of the sequences, and then the remaining sequences can be added to the reference alignment; this has the potential to improve accuracy compared to methods that do not include biological knowledge to define a constraint alignment. Another case where adding sequences into an existing alignment occurs is when new sequences or genomes are added to databases, leading to the opportunity to add the new sequences for each gene in the genome into a growing alignment. In this second case, adding sequences into the existing alignment avoids the need to recompute the alignment from scratch and could lead to substantial running time benefits. A third case is for <italic>de novo</italic> multiple sequence alignment, where a subset of the sequences is selected and aligned, and then the remaining sequences are added into this “backbone alignment”; examples of such methods include UPP [<xref ref-type="bibr" rid="CR4">4</xref>], UPP2 [<xref ref-type="bibr" rid="CR5">5</xref>], WITCH [<xref ref-type="bibr" rid="CR6">6</xref>], WITCH-ng [<xref ref-type="bibr" rid="CR7">7</xref>], HMMerge [<xref ref-type="bibr" rid="CR8">8</xref>], and MAFFT-sparsecore [<xref ref-type="bibr" rid="CR9">9</xref>]. One of the motivations for this type of alignment method (which we refer to as “two-stage” methods) is when the input dataset has substantial sequence length heterogeneity, which can result in poor alignment accuracy using standard methods [<xref ref-type="bibr" rid="CR4">4</xref>]. Thus, adding sequences into existing alignments is a natural problem with multiple applications to biological sequence analysis.</p>
      <p id="Par5">A few methods have been developed to add sequences into an existing alignment, with MAFFT--add [<xref ref-type="bibr" rid="CR10">10</xref>] perhaps the most well-known. However, multiple sequence alignment methods that operate in two steps—i.e., they first extract and align the backbone sequences and then add the remaining sequences into this backbone alignment—can be modified to enable sequences to be added into a user-provided alignment.</p>
    </sec>
    <sec id="Sec3">
      <title>HMM-based methods</title>
      <p id="Par6">Many of the methods that have been developed for adding sequences into a given multiple-sequence alignment operate by representing the existing alignment by either a single HMM or by an ensemble of HMMs. Then, for every additional sequence, which we call “query sequences,” the HMM or ensemble of HMMs is used to find an alignment of the query sequence to the given alignment. Examples of such approaches include functionality provided in UPP [<xref ref-type="bibr" rid="CR4">4</xref>], UPP2 [<xref ref-type="bibr" rid="CR5">5</xref>], WITCH [<xref ref-type="bibr" rid="CR6">6</xref>], WITCH-ng [<xref ref-type="bibr" rid="CR7">7</xref>], and HMMerge [<xref ref-type="bibr" rid="CR8">8</xref>]. We refer to these functions by appending “-add” to the MSA method name (e.g., this functionality in WITCH is referred to as WITCH-add). In this study, we examine the performance of WITCH-ng-add as it has been shown to be at least as accurate and generally faster than WITCH-add, and both are, in turn, at least as accurate as UPP-add and UPP2-add. Finally, HMMerge-add is slower than WITCH-ng-add, and so is omitted from this study. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S1 for additional details about these HMM-based methods.</p>
      <p id="Par7">Because HMM-based methods operate by aligning the query sequences to one or more HMMs, homologies between query sequences can only be discovered if these homologies align through match states in the HMMs. This approach has the potential to miss valid homologies between query sequences, for example, when the given alignment is insufficiently representative of the entire family. Thus, only query sequence characters (i.e., nucleotides or residues) that are aligned through match states in the HMMs can be placed in columns that have other nucleotides or residues; if the character is added to the alignment through an insertion state, it will never be detected as homologous to any other character in any other sequence. This aspect of using HMMs for alignment has a potentially significant impact on the accuracy of the alignments of query sequences to the backbone alignment.</p>
    </sec>
    <sec id="Sec4">
      <title>MAFFT--add and MAFFT-linsi--add</title>
      <p id="Par8">MAFFT--add [<xref ref-type="bibr" rid="CR10">10</xref>] in its default setting uses a standard progressive alignment procedure with two iterations to add query sequences. In each iteration, it computes the pairwise distance matrix between the complete set of sequences (both in the backbone and the query sequence set) using shared 6-mers. Then, it computes a guide tree using the distance matrix and builds an alignment. More specifically, for each node in the guide tree, MAFFT--add does an alignment computation only if a query sequence is involved at the node (i.e., at least one child has some query sequences). Otherwise, it simply uses the alignment from the backbone and so is guaranteed to preserve the input backbone alignment. This property of guaranteeing that the input backbone alignment is not changed is true of the more accurate variants of MAFFT--add, including the variant that uses MAFFT-linsi to add query sequences (which we refer to as MAFFT-linsi--add), which we briefly describe below.<fig id="Fig1"><label>Fig. 1</label><caption><p>Comparing MAFFT-linsi--add to UPP-add We ran MAFFT-linsi--add and UPP-add on a backbone alignment and two query sequences. The initial two sites in the MAFFT-linsi--add alignment each contains two letters from the query sequences, thus indicating it detects them as homologous to each other, although there are no letters from the backbone alignment in these two sites. This is impossible for any method that represents the backbone alignment by one or more HMMs and then adds sequences to the backbone alignment using the HMMs. Thus, UPP-add places these initial letters of the query sequences into separate sites. Visualization is done with WASABI [<xref ref-type="bibr" rid="CR11">11</xref>]</p></caption><graphic xlink:href="13015_2023_247_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par9">MAFFT-linsi--add has two differences to the default version of MAFFT--add. First, MAFFT-linsi--add uses <italic>localpair</italic> (local pairwise alignment scores) for the distance matrix calculation, which is more accurate than shared 6-mers. Second, it only runs for one iteration of progressive alignment and uses at most 1000 iterations of iterative refinement after the progressive alignment finishes. MAFFT--add and MAFFT-linsi--add have runtimes that are at least quadratic in the input size due to the <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$O((m+q)^2)$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo>+</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq1.gif"/></alternatives></inline-formula> distance matrix calculation, where there are <italic>q</italic> query sequences and <italic>m</italic> sequences in the provided backbone alignment. MAFFT-linsi--add is even less scalable since its distance calculation is more costly. In addition, MAFFT-linsi--add does many steps of refinement that further impact the runtime. Hence, the developers of MAFFT recommend that MAFFT-linsi--add be limited to a few hundred sequences [<xref ref-type="bibr" rid="CR12">12</xref>].</p>
    </sec>
    <sec id="Sec5">
      <title>Limitations of HMM-based methods</title>
      <p id="Par10">Both MAFFT-linsi--add and MAFFT--add can recover homologies between query sequences that do not have homologous characters in the backbone alignment, and—as mentioned above—they are guaranteed to leave the backbone alignment unchanged as they add query sequences.</p>
      <p id="Par11">In contrast, methods such as WITCH-add, WITCH-ng-add, etc., that use HMMs or ensembles of HMMs to represent the backbone alignment cannot find homologies between letters in the query sequences that do not also have homologs in the backbone alignment. This is an inherent limitation of HMM-based methods for adding sequences into backbone alignment and implies that MAFFT--add and MAFFT-linsi--add may be more robust to the selection of the backbone sequences than the HMM-based methods.</p>
      <p id="Par12">Figure <xref rid="Fig1" ref-type="fig">1</xref> gives an example of a backbone alignment and query sequences, comparing MAFFT-linsi--add and UPP-add. Note that MAFFT-linsi--add finds homologous nucleotides in the query sequences that do not correspond to homologs in the backbone alignment, while UPP-add fails to recover these. This is an inherent limitation of HMM-based methods and motivates the development of EMMA.</p>
    </sec>
  </sec>
  <sec id="Sec6">
    <title>New method: EMMA</title>
    <sec id="Sec7">
      <title>Comparing MAFFT--add and MAFFT-linsi--add</title>
      <p id="Par13">In a preliminary study (Experiment 0), we compared MAFFT--add and MAFFT-linsi--add to determine their relative accuracy and computational performance, especially as the number of sequences increased. We used 5000M2, a simulated dataset developed for this study (see "<xref rid="Sec13" ref-type="sec">Datasets</xref>" section), for this comparison. For this experiment, the backbone alignment has 1000 sequences and we varied the total number of added sequences from 100 to 2000.<fig id="Fig2"><label>Fig. 2</label><caption><p>Experiment 0: MAFFT-linsi--add scalability issues. Alignment error (left) and runtime in hours (right) of MAFFT--add and MAFFT-linsi--add for adding 100, 200, 1000, or 2000 sequences to a 1000-taxon backbone alignment computed using MAGUS [<xref ref-type="bibr" rid="CR13">13</xref>] on the INDELible 5000M2-het dataset with 5000 sequences. Averages over ten replicates are shown. Error bars shown for alignment errors are standard errors and standard deviations for runtime. We exclude replicate 4 because MAFFT-linsi--add encountered out-of-memory issues (64 GB) when adding 100 or 200 query sequences. Additionally, MAFFT-linsi--add is not shown for 1000 or 2000 query sequences because it either encountered out-of-memory issues or failed to complete within 12 h. Alignment error is the average of SPFN (fraction of true pairwise homologies missing in the estimated alignment) and SPFP (fraction of pairwise homologies in the estimated alignment not found in the true alignment). Results for SPFN and SPFP separately show the same trends and can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S1</p></caption><graphic xlink:href="13015_2023_247_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par14">Figure <xref rid="Fig2" ref-type="fig">2</xref> demonstrates that MAFFT-linsi--add (i.e., MAFFT--add run using-linsi) has a substantial accuracy improvement over MAFFT--add when run in default mode, but is limited to relatively small datasets. Hence, we are motivated to see if we can improve the scalability of MAFFT-linsi--add to large datasets.</p>
    </sec>
    <sec id="Sec8">
      <title>EMMA’s algorithmic design</title>
      <p id="Par15">EMMA takes as input a multiple sequence alignment <italic>C</italic> on subset <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0$$\end{document}</tex-math><mml:math id="M4"><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq2.gif"/></alternatives></inline-formula> and a set <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_1$$\end{document}</tex-math><mml:math id="M6"><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq3.gif"/></alternatives></inline-formula> of additional “query” sequences, and returns an alignment on <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S = S_0 \cup S_1$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq4.gif"/></alternatives></inline-formula> that is required to induce alignment <italic>C</italic> (thus <italic>C</italic> is treated as a constraint). We refer to <italic>C</italic> as a backbone alignment or as a constraint alignment.</p>
      <p id="Par16">EMMA was designed to enable MAFFT-linsi--add to scale to datasets where the total number of sequences in <italic>S</italic> (backbone plus query sequences) is very large. To achieve this, we use a divide-and-conquer strategy where we create a number of problems with smaller numbers of backbone sequences and query sequences on which MAFFT-linsi--add can efficiently and accurately run. We then show how we can combine the results into a solution to the overall problem of adding sequences into the backbone alignment. Some of the techniques in EMMA are adapted from PASTA [<xref ref-type="bibr" rid="CR14">14</xref>] and UPP [<xref ref-type="bibr" rid="CR4">4</xref>], as described below and in the supplementary materials.</p>
      <p id="Par17">EMMA has two algorithmic parameters, <italic>l</italic> and <italic>u</italic>, that govern the decomposition strategy; our study set default values for these parameters, but they can be supplied by the user. Given the input backbone alignment <italic>C</italic>, unaligned sequences, and (optional) values for parameters <italic>l</italic> and <italic>u</italic>, EMMA operates as follows: <list list-type="order"><list-item><p id="Par18">Step 1: Construct set of constraint subalignments: Compute a tree on <italic>C</italic> (default: using the maximum likelihood heuristic FastTree2 [<xref ref-type="bibr" rid="CR15">15</xref>]), and break it into smaller subsets by repeatedly deleting centroid edges (i.e., edges whose removal splits the leaf set into two sets of roughly equal size), and retaining only those subsets that contain at least <italic>l</italic> and at most <italic>u</italic> sequences. Each subset of the tree defines a subalignment <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq5.gif"/></alternatives></inline-formula> of <italic>C</italic> (defined by the set <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_i$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq6.gif"/></alternatives></inline-formula> of sequences in the subset). For each subalignment <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i, i=1 \ldots k$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq7.gif"/></alternatives></inline-formula>, construct a profile HMM.</p></list-item><list-item><p id="Par19">Step 2: Define the set of subproblems: For each query sequence <italic>q</italic>, assign <italic>q</italic> to the constraint subalignment whose HMM has the best fit, as determined by the adjusted bitscore (introduced in [<xref ref-type="bibr" rid="CR6">6</xref>]), which provides an estimate of the probability that the given HMM generates the given query sequence. This defines a set of subproblems: the constraint subalignment <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq8.gif"/></alternatives></inline-formula> and the set of query sequences <inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q_i$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mi>Q</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq9.gif"/></alternatives></inline-formula> assigned to <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq10.gif"/></alternatives></inline-formula>. For each <italic>i</italic>, if the total number of sequences in <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_i \cup Q_i$$\end{document}</tex-math><mml:math id="M22"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq11.gif"/></alternatives></inline-formula> exceeds 500, then partition the query sequences in <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q_i$$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mi>Q</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq12.gif"/></alternatives></inline-formula> into the smallest number of subsets needed in order to have at most 500 sequences in each subset, and ensure that have the subsets are as balanced in size as possible.</p></list-item><list-item><p id="Par20">Step 3: Apply MAFFT-linsi--add to add the query sequences: For each resultant subproblem, use MAFFT-linsi--add to add all assigned query sequences to the selected constraint subalignment. The output of this step is a collection of extended subalignments (i.e., an alignment that agrees with the constraint alignment <inline-formula id="IEq13"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq13.gif"/></alternatives></inline-formula> but has some query sequences added).</p></list-item><list-item><p id="Par21">Step 4: Merge the extended subalignments using transitivity: Each subalignment contains sites that come from the backbone alignment as well as newly introduced sites (representing homologies inferred between query sequence letters through the use of MAFFT-linsi--add). The sites from the backbone alignment allow us to merge these subalignments in an obvious way: if subalignments <inline-formula id="IEq14"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A_1$$\end{document}</tex-math><mml:math id="M28"><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq14.gif"/></alternatives></inline-formula> and <inline-formula id="IEq15"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A_2$$\end{document}</tex-math><mml:math id="M30"><mml:msub><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq15.gif"/></alternatives></inline-formula> both have sites drawn from site <italic>j</italic> from the backbone alignment, then these two sites are merged in the output alignment. Furthermore, the left-to-right ordering of columns in the subalignments can be used to define the left-to-right ordering in the output alignment. Transitivity was first used in PASTA and has been used in many subsequent methods, such as UPP, WITCH, and WITCH-ng. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S2 for an example of transitivity merging.</p></list-item></list></p>
      <sec id="FPar1">
        <title>Theorem 1</title>
        <p id="Par22">Given backbone alignment <italic>C</italic> on set <inline-formula id="IEq16"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0$$\end{document}</tex-math><mml:math id="M32"><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq16.gif"/></alternatives></inline-formula> and query sequences <inline-formula id="IEq17"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_1$$\end{document}</tex-math><mml:math id="M34"><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq17.gif"/></alternatives></inline-formula>, EMMA outputs an alignment on <inline-formula id="IEq18"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0 \cup S_1$$\end{document}</tex-math><mml:math id="M36"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq18.gif"/></alternatives></inline-formula> that induces <italic>C</italic> when restricted to <inline-formula id="IEq19"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0$$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq19.gif"/></alternatives></inline-formula>.</p>
      </sec>
      <sec id="FPar2">
        <title>Proof</title>
        <p id="Par23">Every subproblem consists of a constraint subalignment <inline-formula id="IEq20"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C'$$\end{document}</tex-math><mml:math id="M40"><mml:msup><mml:mi>C</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq20.gif"/></alternatives></inline-formula> and a set of query sequences <inline-formula id="IEq21"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q'$$\end{document}</tex-math><mml:math id="M42"><mml:msup><mml:mi>Q</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq21.gif"/></alternatives></inline-formula>. MAFFT-linsi--add applied to subproblem (<inline-formula id="IEq22"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C',Q'$$\end{document}</tex-math><mml:math id="M44"><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>Q</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq22.gif"/></alternatives></inline-formula>) is guaranteed to return an extended subalignment that induces <inline-formula id="IEq23"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C'$$\end{document}</tex-math><mml:math id="M46"><mml:msup><mml:mi>C</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq23.gif"/></alternatives></inline-formula> when restricted to the sequences for that set. Since every query sequence is in exactly one subalignment, all the extended subalignments will be consistent with <italic>C</italic>, the constraint alignment given to EMMA. By definition, the transitivity merge cannot undo homologies in any extended subalignment nor in the <italic>i</italic>. Furthermore, because each query sequence and each backbone sequence are in exactly one subalignment, the transitivity merge never merges columns in the constraint alignment; hence, it is guaranteed to return an alignment that induces the backbone alignment when restricted to the backbone sequences. <inline-formula id="IEq24"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\square$$\end{document}</tex-math><mml:math id="M48"><mml:mo>□</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq24.gif"/></alternatives></inline-formula></p>
        <p>In addition to guaranteeing that the output of EMMA is consistent with the constraint alignment, the four-step design achieves several properties that are beneficial for alignment accuracy and scalability to a large number of sequences: (1) all runs of MAFFT-linsi--add have at most 500 sequences in total and (2) the division into subalignments is based on an estimated phylogeny so that the sequences in each subalignment are likely to be closely related, and (3) each query sequence is assigned to a subalignment of sequences for which they are likely to be closely related (based on the bit-score calculation of the fit between the query sequence and the subalignment). These properties together make for subproblems that are small enough for MAFFT-linsi--add to run well on (i.e., we reduce the computational effort) and closely related enough for MAFFT-linsi--add to be highly accurate.</p>
        <p>Note that EMMA uses HMMs to determine <italic>which</italic> subset alignment to assign a given query sequence but does not use the HMMs to perform the alignment. Instead, the alignment of the query sequence to the subalignment is performed using MAFFT-linsi--add in batch mode (i.e., all the query sequences assigned to the same subalignment are aligned together), which allows MAFFT-linsi--add to find homologies between letters in query sequences even if the backbone alignment does not have homologies as well.</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec9">
    <title>Experimental design</title>
    <sec id="Sec10">
      <title>Overview</title>
      <p id="Par26">Experiment 1 sets the parameters <italic>l</italic> and <italic>u</italic> in EMMA; these experiments are performed on the training data. In Experiment 2, we compare EMMA to MAFFT--add (v7.490, run in default mode), MAFFT-linsi--add (v7.490), and WITCH-ng-add (v0.0.2), using the testing datasets (disjoint from the training data).</p>
      <p id="Par27">All methods are evaluated for running time as well as alignment error (see below). Experiment 1 analyses were limited to 64 GB and 12 h. Experiment 2 was run with 16 cores and 64 GB memory, with 24 h of runtime. For MAFFT-linsi--add and MAFFT--add, we allowed 128 GB memory. All experiments were run on the UIUC Campus Cluster. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S3 for exact commands of all methods, and Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S4 for additional details on dataset generation.</p>
    </sec>
    <sec id="Sec11">
      <title>Alignment error</title>
      <p id="Par28">For alignment error, we compare the estimated to the reference/true alignment, restricted to the (added) query sequences from the reference alignment. We report SPFN, SPFP, and expansion scores, which are defined as follows. The expansion score is the length of the estimated alignment divided by the length of the true or reference alignment; thus, the best result is 1.0, alignments that have expansion scores less than 1.0 are said to be “over-aligned”, while alignments that have expansion scores greater than 1.0 are “under-aligned”. The SPFN and SPFP error metrics are based on homologies, i.e., pairs of letters (nucleotides or amino acids) found in the same column in the true or estimated alignment. The sum-of-pairs false-negative (SPFN) rate is the fraction of homologies in the reference alignment that are missing in the estimated alignment. The sum-of-pairs false-positive (SPFP) rate is the fraction of pairs of homologies in the estimated alignment that are missing in the reference alignment. These metrics are calculated using FastSP [<xref ref-type="bibr" rid="CR16">16</xref>].</p>
    </sec>
    <sec id="Sec12">
      <title>Datasets</title>
      <p id="Par30">We use both simulated and biological datasets of nucleotide and protein to evaluate EMMA. In addition to datasets from prior studies [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR17">17</xref>, <xref ref-type="bibr" rid="CR18">18</xref>], we also generated one new simulated dataset using INDELible [<xref ref-type="bibr" rid="CR19">19</xref>] and we use two new biological datasets (Rec and Res). The training datasets were used in Experiments 0 and 1, and all subsequent experiments used the testing data (a separate collection of datasets). Empirical statistics for these datasets can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Table S1. All datasets are described below, with the new datasets freely available online through the Illinois Data Bank (see Data Availability statement).</p>
      <sec id="Sec13">
        <title>Simulated datasets</title>
        <p id="Par31">All simulated datasets are based on evolving sequences down model trees with indels so that all sequence alignments involve gaps. As described below, these simulated datasets vary in terms of indel length distribution, rate of evolution, and whether the sites evolve identically and independently or under selection. All simulated datasets have at least 1000 sequences.</p>
        <p id="Par32">ROSE: We included datasets from [<xref ref-type="bibr" rid="CR17">17</xref>], which were generated using the ROSE [<xref ref-type="bibr" rid="CR20">20</xref>] software. We used four model conditions (1000M1, 1000M2, 1000M3, and 1000M4) from [<xref ref-type="bibr" rid="CR17">17</xref>]. Each model condition has 10 replicates, and each replicate has 1000 sequences, with an average sequence length of <inline-formula id="IEq25"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sim$$\end{document}</tex-math><mml:math id="M50"><mml:mo>∼</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq25.gif"/></alternatives></inline-formula>1000 bp. The 1000M1–1000M4 models vary in rate of evolution (with 1000M1 the highest, and reducing rates as the index increases), thus enabling us to evaluate the impact of rates of evolution on alignment difficulty. All site evolution is non-ultrametric, and the sites evolve identically and independently.</p>
        <p id="Par33">The INDELible simulated datasets: These datasets were generated for this study. We used INDELible [<xref ref-type="bibr" rid="CR19">19</xref>] to evolve sequence datasets down a tree with a heterogeneous indel (insertion and deletion) model. Under this model, with a small probability, an indel event can be promoted to long indel events, modeling infrequent large gain or loss during the evolutionary process (e.g., domain-level indels). Hence, we name these new model conditions “het” to reflect their heterogeneous indels. Each replicate has 5000 sequences, and the model conditions range in evolutionary rates (and hence alignment difficulty), with model condition 5000M2-het having the highest rate of evolution, 5000M3-het somewhat slower, and 5000M4-het the slowest. We used non-ultrametric model trees, and all sites evolved identically and independently. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S4 for details of the data generation and Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Tables S2 and S3 for the parameter values used in the simulations.</p>
        <p id="Par34">RNASim: The RNASim million-sequence dataset is from [<xref ref-type="bibr" rid="CR14">14</xref>] and has been used in prior studies to evaluate alignment methods [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR21">21</xref>]. In the RNASim simulation, RNA sequences evolve under a biophysical model and under selection in order to conserve the rRNA structure. Thus, the sites do not evolve independently. In this study, we subsampled 10 replicates, each with 10,000 sequences.</p>
      </sec>
      <sec id="Sec14">
        <title>Biological datasets</title>
        <p id="Par35">CRW: The Comparative Ribosomal Website [<xref ref-type="bibr" rid="CR18">18</xref>] (CRW) is a collection of nucleotide datasets with curated alignments based on secondary structure. We include 16 S.3, 16 S.T, and 16 S.B.ALL, three large datasets from the CRW, with 5323, 6350, and 27,643 sequences, respectively. These datasets have been used in previous studies [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR21">21</xref>, <xref ref-type="bibr" rid="CR22">22</xref>] and exhibit sequence length heterogeneity. We use the cleaned versions from [<xref ref-type="bibr" rid="CR21">21</xref>], for which any ambiguity codes or entirely gapped columns are removed.</p>
        <p id="Par36">10AA: The “10 AA” dataset is a publicly available collection of large curated protein alignments, originally assembled for the study evaluating PASTA [<xref ref-type="bibr" rid="CR14">14</xref>], but also used to evaluate multiple sequence alignment methods [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR22">22</xref>]. These curated alignments are based on protein structure and range from 320 to 807 sequences and include the eight largest BAliBASE datasets [<xref ref-type="bibr" rid="CR23">23</xref>] and two datasets from [<xref ref-type="bibr" rid="CR24">24</xref>].</p>
        <p id="Par37">Serine recombinases (Rec and Res): These datasets were assembled for this study and are for two domains from serine recombinase. Protein sequences were taken from 350,378 GenBank bacterial and archaeal genome assemblies (Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S4) using Prodigal [<xref ref-type="bibr" rid="CR25">25</xref>]. Serine recombinases were identified using the Pfam HMMs [<xref ref-type="bibr" rid="CR26">26</xref>] Resolvase (Res) for the catalytic domain, and Recombinase (Rec) for the integrase-specific domain using <italic>hmmsearch</italic> from the HMMER package with the “trusted cutoffs” supplied by Pfam. Standards phiC31 and Bxb1 were added. From the 199,090 unique protein sequences, the Rec and Res domains were separately extracted using the boundaries determined by the HMM hits.</p>
        <p id="Par38">The Rec and Res datasets have reference alignments on a subset of the sequences (i.e., the seed alignment from Pfam), with Rec having 66 and Res having 112 seed sequences. Hence, the reference set for each dataset is much smaller than the entire set of sequences. Alignment error is evaluated only on these specific reference sequences.</p>
      </sec>
      <sec id="Sec15">
        <title>Constraint alignment selection</title>
        <p id="Par39">Recall that we have true alignments for the simulated datasets and reference alignments (based on structure) for the biological datasets. However, for the Rec and Res datasets, we have reference alignments only on a subset of the sequences. Alignment error is evaluated only on sequences for which we have reference alignments, which means that for the Rec and Res datasets we can only evaluate alignment error on a subset of the sequences.</p>
        <p id="Par40">In Experiment 2, we designed different ways of selecting a subset of the reference sequences to form the constraint alignment. The reference alignment, restricted to the selected sequences, is treated as the backbone alignment (i.e., the constraint alignment), and the remaining sequences are query sequences.</p>
        <p id="Par41">We considered three different scenarios for the selection of the backbone sequences, for which a constraint alignment would be provided by the user. The first two scenarios select sequences randomly from across the assume that the backbone sequences are selected randomly from the input. For these two scenarios, we vary the number of sampled sequences from “large” (at 25% of the full set of sequences) to “small” (at 10% of the sequences). The third scenario is designed for the case where a curated alignment is available for a small and likely closely related set of sequences found within a clade. <list list-type="order"><list-item><p id="Par42">Large random subset: We begin by determining the set of reference sequences that are “full-length,” which means their length is within 25% of the median length. From the set of <italic>F</italic> full-length sequences, we randomly select <inline-formula id="IEq26"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\min (1000, 0.25F)$$\end{document}</tex-math><mml:math id="M52"><mml:mrow><mml:mo movablelimits="true">min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1000</mml:mn><mml:mo>,</mml:mo><mml:mn>0.25</mml:mn><mml:mi>F</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq26.gif"/></alternatives></inline-formula> sequences.</p></list-item><list-item><p id="Par43">Small random subset: The protocol is identical to the large random subset protocol, except that we randomly select <inline-formula id="IEq27"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\min (100, 0.1F)$$\end{document}</tex-math><mml:math id="M54"><mml:mrow><mml:mo movablelimits="true">min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>100</mml:mn><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn><mml:mi>F</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq27.gif"/></alternatives></inline-formula> full-length sequences. However, if this number is less than 10, we just pick 10 sequences at random.</p></list-item><list-item><p id="Par44">Large clade-based subset: Here, we restrict to sequences from a clade (as defined on either the true tree for simulated data or a maximum likelihood tree for the biological data), selecting a clade that has at most 1000 sequences, and that comes as close as possible to 25% of the reference sequences. In the case of ties, we pick the clade randomly,</p></list-item></list></p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec16">
    <title>Results</title>
    <sec id="Sec17">
      <title>Experiment 1: Designing EMMA</title>
      <p id="Par45">Experiment 1 is the experiment where we set the algorithmic parameters, <italic>l</italic> and <italic>u</italic>, for EMMA. We vary <italic>l</italic> between 10 and 50 and <italic>u</italic> between <italic>l</italic> and 100, using the INDELiBLE 5000M2-het model condition, which has a high rate of evolution and so makes for difficult alignments. We use the <italic>large random subset</italic> scenario so that the backbone alignment contains 1000 randomly selected sequences, and the remaining 4000 sequences are query sequences.</p>
      <p id="Par46">Results for EMMA with different settings of (<italic>l</italic>, <italic>u</italic>) on 5000M2-het (10 replicates) are presented in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S3. The lowest error is found when <inline-formula id="IEq28"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M56"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq28.gif"/></alternatives></inline-formula>, and for this setting of <italic>l</italic>, <italic>u</italic> then has little impact. However, the setting for <italic>u</italic> does impact runtime, with the fastest runtime found (across all settings) with <inline-formula id="IEq29"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M58"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq29.gif"/></alternatives></inline-formula> and <inline-formula id="IEq30"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M60"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq30.gif"/></alternatives></inline-formula>. Based on this experiment, we set these as the default settings for <italic>l</italic> and <italic>u</italic>.<fig id="Fig3"><label>Fig. 3</label><caption><p>Expansion score (top) and SPFP (bottom) on large random backbones. In each subfigure, the top panel denotes biological datasets, and the bottom panel denotes simulated datasets (note the change in the y-axis range for expansion scores between the top and bottom panels). The horizontal dashed line indicates a perfect expansion score of 1. MAFFT-linsi--add failed to finish within 24 h for datasets except for 10AA and ROSE 1000M1–4 and was not run on Rec and Res (due to their very large size, we knew it would not complete within the allowed time), and MAFFT--add encountered out-of-memory issues on the Res dataset (failed runs, or runs that were not attempted, are marked with “X”). The expansion score is the length of the estimated alignment normalized by the length of the reference or true alignment; optimal is 1.0, and values above 1.0 indicate alignments that are too long (and so are under-aligned)</p></caption><graphic xlink:href="13015_2023_247_Fig3_HTML" id="MO3"/></fig></p>
    </sec>
    <sec id="Sec18">
      <title>Experiment 2: Evaluating EMMA to other sequence-adding methods</title>
      <p id="Par47">Here, we show comparisons of EMMA using the default settings of <inline-formula id="IEq31"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M62"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq31.gif"/></alternatives></inline-formula> and <inline-formula id="IEq32"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M64"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq32.gif"/></alternatives></inline-formula> to WITCH-ng-add and MAFFT-linsi--add. We show a comparison to MAFFT--add in default mode only for a limited set of analyses since its error rates were much higher than the other methods; see Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S4–S14 for full results, including MAFFT--add.</p>
      <sec id="Sec19">
        <title>Expansion scores and SPFP</title>
        <p id="Par48">The expansion score is the estimated alignment length normalized by the reference or true alignment length. As seen in the Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Table S4, MAFFT-linsi--add had the best expansion scores, coming close to 1.0 in most cases. All the other methods, however, produced alignments that were longer than the true alignment (and hence were under-aligning), as indicated by expansion scores being greater than 1. MAFFT--add under-aligned the least of these methods, followed closely by EMMA, and WITCH-ng-add has by far the largest expansion scores. For the expansion score, WITCH-ng is the outlier, as its expansion scores were excessively high. This level of under-alignment also means that interpreting its SPFP rates is difficult since under-alignment also reduces false positives.</p>
        <p id="Par49">With these observations, we now consider the SPFP scores. Results for large random backbones are provided in Fig. <xref rid="Fig3" ref-type="fig">3</xref>, and results for the two other conditions are shown in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S4 and S5. WITCH-ng-add typically had among the best SPFP scores, but MAFFT-linsi-add and EMMA sometimes had better SPFP scores. Thus, the improved SPFP scores achieved by WITCH-ng-add are partially the result of its very high degree of under-alignment.</p>
        <p id="Par50">EMMA and MAFFT-linsi--add both had SPFP scores that are relatively close. There is an advantage to MAFFT-linsi--add over EMMA on the simulated ROSE datasets (1000M1–1000M4) but not on the 10AA datasets (the only biological datasets on which MAFFT-linsi--add completed).</p>
        <p id="Par51">We also see that MAFFT--add had higher SPFP scores than MAFFT-linsi--add on the datasets on which MAFFT-linsi--add could run. Given that MAFFT--add also had worse expansion scores than MAFFT-linsi--add, this indicates that MAFFT--add was generally inferior to MAFFT-linsi--add (consistent with Experiment 0, and also with other prior studies). Interestingly, although MAFFT--add had lower expansion scores than EMMA, it had higher SPFP scores. Given these trends, we omit MAFFT--add from the rest of the study (though see Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S3–S8 for comparisons involving MAFFT--add).</p>
        <p id="Par52">We note that the SPFP scores, other than for WITCH-ng-add, were all relatively close (and generally low), making SPFP scores not very informative. Therefore, for the remainder of this study, we focus on SPFN, noting that 1-SPFN is the same as <italic>recall</italic> (or SP-Score).<fig id="Fig4"><label>Fig. 4</label><caption><p>SPFN of EMMA, WITCH-ng-add, and MAFFT-linsi--add when adding sequences into large random backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Error bars indicate standard errors. MAFFT-linsi--add only completed within the allowed 24 h on datasets with at most 1000 sequences, and we did not run it on Rec or Res due to their large numbers of sequences (failed runs, or runs that were not attempted, are marked with “X”). Comparisons with MAFFT--add can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S7. SPFN results for each of the 10AA datasets are in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S12</p></caption><graphic xlink:href="13015_2023_247_Fig4_HTML" id="MO4"/></fig></p>
      </sec>
      <sec id="Sec20">
        <title>SPFN alignment error on large random backbones</title>
        <p id="Par53">Figure <xref rid="Fig4" ref-type="fig">4</xref> shows the SPFN of the three sequence-adding methods (i.e., EMMA, WITCH-ng-add, and MAFFT-linsi--add) when adding to large random backbone alignments. The most striking observation is that MAFFT-linsi--add only succeeded in completing the datasets with at most 1000 sequences (i.e., the 10AA biological datasets and the ROSE simulated datasets with 1000 sequences); on all the other datasets, it failed to complete within the allowed time (24 h). For all datasets, EMMA had the best SPFN score, better than both MAFFT-linsi--add and WITCH-ng. We also note that its advantage in SPFN was more noticeable on datasets with high rates of evolution (1000M1, 1000M2).</p>
      </sec>
      <sec id="Sec21">
        <title>SPFN alignment error on small random backbones</title>
        <p id="Par54">As with large random backbones, MAFFT-linsi--add only succeeded in finishing on the datasets with at most 1000 sequences (Fig. <xref rid="Fig5" ref-type="fig">5</xref>), but on those datasets, it was among the most accurate methods. The relative accuracy between the three methods is very similar to that displayed on the large backbones: EMMA was still the most accurate, followed by MAFFT-linsi--add when it can run, then by WITCH-ng. Finally, the gaps in accuracy between methods were smaller than when placing into large random backbones, while the absolute error rates were higher.<fig id="Fig5"><label>Fig. 5</label><caption><p>SPFN of EMMA, WITCH-ng-add, and MAFFT-linsi--add when adding sequences into small random backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Error bars indicate standard errors. MAFFT-linsi--add failed to finish within 24 h for datasets except for 10AA and ROSE 1000M1–4, and we did not run it on Rec or Res due to their large numbers of sequences (failed runs, or runs that were not attempted, are marked with “X”). Comparisons with MAFFT--add can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S8. SPFN results for each of the 10AA datasets are in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S13</p></caption><graphic xlink:href="13015_2023_247_Fig5_HTML" id="MO5"/></fig></p>
      </sec>
      <sec id="Sec22">
        <title>SPFN alignment error on clade-based backbones</title>
        <p id="Par55">As with the other conditions, when adding sequences into a clade-based backbone alignment, MAFFT-linsi--add failed to complete on any dataset with more than 1000 sequences. However, in many respects, the results for the clade-based backbone are different than for the random backbones (Fig. <xref rid="Fig6" ref-type="fig">6</xref>). The most noteworthy difference is that error rates increased for all methods when given clade-based backbones instead of random backbones, but the increase was largest for WITCH-ng-add. MAFFT-linsi--add is clearly the most accurate of all the methods on the 1000M1, 1000M2, and 1000M3 datasets and then ties for best on 1000M4. EMMA is strictly more accurate than WITCH-ng-add, usually by a large margin, on all datasets. Nevertheless, both EMMA and WITCH-ng-add have high errors on datasets with high rates of evolution (1000M1, 5000M3-het).<fig id="Fig6"><label>Fig. 6</label><caption><p>SPFN of EMMA, WITCH-ng-add, and MAFFT-linsi--add when adding sequences into clade-based backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Error bars indicate standard errors. MAFFT-linsi--add failed to finish within 24 h for datasets except for 10AA and ROSE 1000M1–4, and we did not run it on Rec or Res due to their large numbers of sequences (failed runs, or runs that were not attempted, are marked with “X”). Comparisons with MAFFT--add can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S9. SPFN results for each of the 10AA datasets are in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S14</p></caption><graphic xlink:href="13015_2023_247_Fig6_HTML" id="MO6"/></fig></p>
      </sec>
      <sec id="Sec23">
        <title>Computational performance</title>
        <p id="Par56">MAFFT-linsi--add and MAFFT--add are the only methods that failed to complete on at least one of the datasets within the allowed runtime (24 h), using 16 cores and 128 GB memory. Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S5 shows that both methods reported out-of-memory issues or crashes. Specifically, MAFFT-linsi--add had an out-of-memory issue when attempting to analyze the INDELible 5000M2-het training dataset and allowed 64 GB. We also noted that MAFFT--add had an out-of-memory issue on the Res dataset with <inline-formula id="IEq33"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sim$$\end{document}</tex-math><mml:math id="M66"><mml:mo>∼</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq33.gif"/></alternatives></inline-formula>186K sequences, even when allowed 128 GB of memory. This is perhaps not surprising since MAFFT--add also computes the <inline-formula id="IEq34"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n \times n$$\end{document}</tex-math><mml:math id="M68"><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq34.gif"/></alternatives></inline-formula> pairwise distance matrix, where <italic>n</italic> is the number of sequences in total (backbone sequences and query sequences together), and shows that MAFFT--add as well as MAFFT-linsi--add both have large memory requirements.</p>
        <p id="Par57">Figure <xref rid="Fig7" ref-type="fig">7</xref> compares the methods given a large random backbone. MAFFT-linsi--add was the slowest method on all the datasets when it could run (as noted above, it failed to complete on any dataset with more than 1000 sequences). WITCH-ng-add was overall the next slowest method, but it was faster than EMMA on the 10AA datasets (which are the smallest datasets we examined, all below 1000 sequences). MAFFT--add was overall the fastest method, but WITCH-ng-add was faster on the Rec dataset, and EMMA was faster on the 5000M3-het dataset. Overall, EMMA was in between WITCH-ng-add and MAFFT--add in terms of running time on these datasets.</p>
        <p id="Par58">The runtimes of all methods on the other conditions (small random backbones and clade-based backbones) are shown in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S10 and S11. On these datasets, we see somewhat similar trends, with EMMA faster than MAFFT-linsi--add on the datasets where MAFFT-linsi--add can run, but now EMMA is slower than both WITCH-ng-add and MAFFT--add.<fig id="Fig7"><label>Fig. 7</label><caption><p>Experiment 2: Runtime (log-scale) in minutes when adding to large random backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Except for the datasets with at most 1000 sequences, MAFFT-linsi--add failed to finish within 24 h and was not attempted on Rec and Res due to their large number of sequences. MAFFT--add encountered out-of-memory issues on the Res dataset. Failed runs, or runs not attempted due to dataset size, are marked with “X”. Error bars indicate standard deviation</p></caption><graphic xlink:href="13015_2023_247_Fig7_HTML" id="MO7"/></fig></p>
        <p id="Par59">The only methods that succeeded in completing all datasets were EMMA and WITCH-ng-add, and the maximum runtimes used by EMMA and WITCH-ng-add were 12.2 and 10.5 h, respectively. Given that WITCH-ng-add and EMMA completed so quickly using under 64 GB memory on these datasets and that the datasets had up to <inline-formula id="IEq35"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sim$$\end{document}</tex-math><mml:math id="M70"><mml:mo>∼</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq35.gif"/></alternatives></inline-formula>186,000 sequences, it is reasonable to say that WITCH-ng-add and EMMA are acceptable with respect to speed and scalability.</p>
        <p id="Par60">We also tried to give MAFFT-linsi--add three days (72 h instead of 24 h) to run on 16 S.3 and 16 S.T for the small random backbone and large clade-based backbone, but it still could not complete. Finally, we consider MAFFT--add to be reasonably scalable since it only had computational problems with the largest dataset (Res), and it is by far the fastest method we tested.</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec24">
    <title>Discussion</title>
    <p id="Par61">The four methods we have evaluated—EMMA, MAFFT--add, MAFFT-linsi--add, and WITCH-ng-add, vary in their ability to run on large datasets (i.e., scalability), runtime, and accuracy (here focused on SPFN). The relative performance is summarized in Table <xref rid="Tab1" ref-type="table">1</xref>, and discussed further below.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Overall performance of the tested methods</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Criterion</th><th align="left">EMMA</th><th align="left">WITCH-ng-add</th><th align="left">MAFFT--add</th><th align="left">MAFFT-linsi--add</th></tr></thead><tbody><tr><td align="left">Scalability</td><td align="left">All</td><td align="left">All</td><td align="left">All but largest</td><td align="left"><inline-formula id="IEq36"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\le 1000$$\end{document}</tex-math><mml:math id="M72"><mml:mrow><mml:mo>≤</mml:mo><mml:mn>1000</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq36.gif"/></alternatives></inline-formula> sequences</td></tr><tr><td align="left">SPFN-random</td><td align="left">1</td><td align="left">2</td><td align="left">3</td><td align="left">1</td></tr><tr><td align="left">SPFN-clade</td><td align="left">2</td><td align="left">3</td><td align="left">4</td><td align="left">1</td></tr><tr><td align="left">Speed</td><td align="left">2</td><td align="left">2</td><td align="left">1</td><td align="left">3</td></tr></tbody></table><table-wrap-foot><p>For scalability, we indicate which study datasets the method completed on</p><p>For SPFN and speed, we indicate the relative position (1 is best, 2 is second best, etc.)</p></table-wrap-foot></table-wrap></p>
    <p id="Par62">Our study showed clear differences in scalability, with EMMA and WITCH-ng-add the most scalable (completing on all datasets within the time and memory limits), MAFFT--add the next most scalable (failing to complete on one dataset), and MAFFT-linsi--add the least scalable (failing on all but the datasets with at most 1000 sequences). It is easy to see why EMMA can scale to the largest datasets, as the decomposition strategy and transitivity merge are both very fast, and the only potentially computationally intensive part is when it runs MAFFT-linsi--add on subsets of query sequences to add them to subsets of the backbone alignment. However, by design, the subproblems are all small (at most <inline-formula id="IEq37"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M74"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq37.gif"/></alternatives></inline-formula> backbone sequences and at most 500 query sequences). This design strategy allows EMMA to complete on all the datasets in our study. It is also easy to see why MAFFT-linsi--add is limited in scalability since its algorithmic design involves a quadratic runtime.</p>
    <p id="Par63">Accuracy differences were also apparent but were generally very small when the rates of evolution were low enough. This also is as expected since prior studies have shown differences in alignment error often are very small or negligible when sequence identity is high, which occurs under low rates of evolution (e.g., [<xref ref-type="bibr" rid="CR17">17</xref>, <xref ref-type="bibr" rid="CR27">27</xref>]).</p>
    <p id="Par64">When comparing accuracy under higher rates of evolution, we see that the selection strategy for the backbone sequences—i.e., whether they were selected randomly or from within a clade and the number of backbone sequences—impacts both absolute and relative alignment error. In particular, all methods have better accuracy with random sampling than with clade-based sampling and also have better accuracy when there are more sequences in the backbone alignment. These trends are expected since the constraint alignment is used as a model of the family, and dense sampling throughout the family (i.e., the large random backbone) ensures a better model than sparse random sampling (i.e., the small random backbone) or sampling from just within a clade.</p>
    <p id="Par65">The comparison between EMMA and WITCH-ng-add with respect to accuracy favors EMMA across all sampling strategies, although the two methods have nearly identical accuracy for some conditions. The accuracy advantage of EMMA is more noticeable on datasets with high rates of evolution, such as ROSE 1000M1, 1000M2, and INDELible 5000M3-het. Since WITCH-ng-add relies on using HMMs created from the backbone to align the queries, whereas EMMA uses MAFFT-linsi--add to align the queries, the improvement in accuracy for EMMA is likely to be due to the greater sensitivity of MAFFT-linsi--add for detecting homologies than the HMM-based approach within WITCH-ng-add.</p>
    <p id="Par66">The comparison between MAFFT-linsi--add and EMMA, although restricted to just those datasets on which MAFFT-linsi--add could run (i.e., the datasets with at most 1000 sequences), reveals the following trends. When given a large random backbone, EMMA matches or improves on MAFFT-linsi--add under all conditions, but has an advantage given on the ROSE 1000M1 and 1000M2 conditions, and then matches MAFFT-linsi--add for the 1000M3 and 1000M4 conditions. The same relative performance is seen for the small random backbone, but with a smaller difference between the methods. Thus, the rate of evolution impacts the relative accuracy of the two methods, favoring EMMA when the rate of evolution is high, suggesting that MAFFT-linsi--add accuracy is impacted more substantially by the rate of evolution than EMMA. This trend is consistent with prior studies showing that MAFFT-linsi is sensitive to rate of evolution, an observation that led to the design of SATé [<xref ref-type="bibr" rid="CR17">17</xref>] and its descendent methods [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR28">28</xref>].</p>
    <p id="Par67">Interestingly, MAFFT-linsi--add improves on EMMA when the sequences are drawn from a clade, with a substantial improvement under the higher rate of evolution. In other words, when the backbone is drawn from a clade, the algorithmic strategy in EMMA—which applies MAFFT-linsi--add to subsets that contain at most 25 backbone sequences from the clade – is inferior to using the entire backbone. This is clearly a condition where the EMMA divide-and-conquer strategy is not well-suited.</p>
    <p id="Par68">In understanding the conditions where MAFFT-linsi--add is more accurate than EMMA, it is helpful to understand that the homologies between query sequences found by EMMA are either found directly by MAFFT-linsi-add on a small subset (with at most 500 sequences) or inferred when combining these extended alignments using transitivity. Thus, the relative accuracy of EMMA and MAFFT-linsi--add is impacted by the divide-and-conquer strategy and, in particular, the size of the subsets in the decomposition of the backbone tree. Given that our default setting currently sets <inline-formula id="IEq38"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M76"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq38.gif"/></alternatives></inline-formula>, this choice creates subsets that have very few backbone sequences (at most 25) and then adds query sequences, but not so many as to exceed 500 total sequences. This is potentially why MAFFT-linsi-add can be more accurate than EMMA since MAFFT-linsi-add can find homologies between all pairs of query sequences, whereas EMMA (which applies MAFFT-linsi-add to small subsets) can only achieve this within the subsets it produces. Our Experiment 1, where we set the parameters <inline-formula id="IEq39"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M78"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq39.gif"/></alternatives></inline-formula> and <inline-formula id="IEq40"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M80"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq40.gif"/></alternatives></inline-formula>, was based on the INDELible 5000M2 dataset, which has a high rate of evolution. It seems likely that other settings for <italic>l</italic> and <italic>u</italic> might lead to improved accuracy when the model condition has a lower rate of evolution since MAFFT-linsi--add’s accuracy improves as the rate of evolution decreases. In other words, EMMA’s algorithmic design aimed to reduce runtime and improve scalability, but for some challenging inputs (e.g., clade-based backbones) where MAFFT-linsi--add can run, the algorithmic design of EMMA may reduce accuracy relative to MAFFT-linsi--add. Hence, there is room for improvement in designing EMMA.</p>
    <p id="Par69">However, MAFFT-linsi--add could not complete the study datasets with more than 1000 sequences given the limitations in computational resources we imposed. In contrast, EMMA was able to complete all study datasets. Thus, while MAFFT-linsi--add had a clear accuracy advantage over EMMA for the clade-based backbones (though not on the random backbones), EMMA has a computational advantage over MAFFT-linsi--add in being able to scale to larger datasets.</p>
    <p id="Par70">Given the impact of clade-based sampling for the backbone sequences, it is important to remember that EMMA is never identical to MAFFT-linsi--add, even when analyzing small subsets. When we run MAFFT-linsi--add on the datasets with at most 1000 sequences, all the query sequences are considered together when added to the backbone alignment. In contrast, by construction, EMMA only adds query sequences to subsets of the backbone alignment with at most <italic>u</italic> sequences, and in our study, we set <inline-formula id="IEq41"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M82"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq41.gif"/></alternatives></inline-formula> by default. From a computational standpoint, this strategy allows EMMA to scale to very large datasets. From an accuracy perspective, however, the impact clearly depends on how the backbone sequences were sampled. EMMA has an accuracy advantage over MAFFT-linsi--add when the backbone sequences are randomly sampled and there is a high rate of evolution and matches MAFFT-linsi--add for accuracy when the backbone sequences are randomly sampled with a lower rate of evolution. However, as we have seen, this strategy is poor when the backbone sequences are sampled from a clade, and the rate of evolution is high.</p>
    <p id="Par71">This observation also indicates that two-phase multiple sequence alignment methods that operate by selecting and aligning a set of sequences for the backbone and then adding in the remaining sequences should—if possible—select the backbone sequences from across the evolutionary tree for the dataset to obtain the best representative model of the gene family.</p>
  </sec>
  <sec id="Sec25">
    <title>Conclusions</title>
    <p id="Par72">This study presented EMMA, a new method for adding sequences into existing constraint alignments (also called backbone alignments). EMMA uses a divide-and-conquer strategy to enable MAFFT-linsi--add, a highly accurate version of MAFFT--add, to scale to large datasets. By itself, MAFFT-linsi--add was unable to complete using the computational resources on the datasets we studied with more than 1000 sequences, but EMMA succeeded in completing with even fewer resources on the largest dataset we studied, with more than 180,000 sequences.</p>
    <p id="Par73">Our study shows that EMMA has comparable or better alignment accuracy than MAFFT--add and WITCH-ng-add under all the conditions tested, and also comparable or better accuracy than MAFFT-linsi--add when the backbone sequences are selected randomly. However, our study also showed that when the backbone sequences are selected from a clade and the dataset is sufficiently small, then MAFFT-linsi--add is more accurate than EMMA. This finding indicates clearly that the design of EMMA needs to be reconsidered for the case where the user provides a curated alignment for a closely related group of sequences contained within a clade and wishes to add additional sequences that are distantly related to the backbone sequences.</p>
    <p id="Par74">Thus, future work should investigate appropriate modifications to the divide-and-conquer strategy in EMMA to address the case where the backbone sequences are distantly related to the query sequences. EMMA alignment accuracy could potentially be improved with a re-alignment stage to see if sets of sites could be merged together through the detection of additional homologies between query sequences. We should also explore other biological datasets to document the accuracy of these methods under a wider range of real-world conditions. EMMA is not yet optimized for speed, and a more careful parallel implementation may provide a substantial speed-up. Finally, EMMA could be studied as the second stage of the standard two-stage pipeline protocol used by UPP/UPP2, WITCH, and WITCH-ng for de novo multiple sequence alignment. Given the high accuracy of these two-stage methods for aligning datasets with high sequence length heterogeneity, this is likely to provide improved accuracy.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec26">
      <title>Supplementary Information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13015_2023_247_MOESM1_ESM.pdf">
            <caption>
              <p><bold>Additional file 1.</bold> Supplementary text, tables, and figures.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>CS developed the EMMA software, performed the analyses, interpreted the data, and drafted the manuscript. BL provided simulated datasets. KPW provided biological datasets and interpreted the data.. TW conceived of the approach, designed the study, interpreted the data, wrote the final draft, and supervised the research. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>CS and TW were supported by the US National Science Foundation grant 2006069 (to TW). K.P.W., C.S., and B.L. were supported by the Laboratory Directed Research and Development program at Sandia National Laboratories, which is a multimission laboratory managed and operated by National Technology and Engineering Solutions of Sandia LLC, a wholly-owned subsidiary of Honeywell International Inc. for the U.S. Department of Energy’s National Nuclear Security Administration under contract DE-NA0003525.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The INDELible, Rec, and Res datasets were created for this study. The Rec and Res datasets are available in the Illinois Data Bank at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.13012/B2IDB-2567453_V1">https://doi.org/10.13012/B2IDB-2567453_V1</ext-link>. The subsampled RNASim datasets (10,000 sequences for each replicate) are available at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.13012/B2IDB-4194451_V1">https://doi.org/10.13012/B2IDB-4194451_V1</ext-link>. Pfam seed sequences are included for both datasets (66 and 112 sequences for Rec and Res, respectively). The INDELible datasets (5000M2-het, 5000M3-het, and 5000M4-het) are available at <ext-link ext-link-type="uri" xlink:href="https://databank.illinois.edu/datasets/IDB-3974819">https://databank.illinois.edu/datasets/IDB-3974819</ext-link>. All other datasets are from prior studies and are available in public repositories. The 10AA datasets are available at <ext-link ext-link-type="uri" xlink:href="https://sites.google.com/eng.ucsd.edu/datasets/alignment/pastaupp">https://sites.google.com/eng.ucsd.edu/datasets/alignment/pastaupp</ext-link>. The three CRW datasets are available at <ext-link ext-link-type="uri" xlink:href="https://databank.illinois.edu/datasets/IDB-2419626">https://databank.illinois.edu/datasets/IDB-2419626</ext-link>. The ROSE datasets are available at <ext-link ext-link-type="uri" xlink:href="https://sites.google.com/eng.ucsd.edu/datasets/alignment/sate-i">https://sites.google.com/eng.ucsd.edu/datasets/alignment/sate-i</ext-link>.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar4">
      <title>Ethics approval and consent to participate</title>
      <p id="Par75">Not applicable.</p>
    </notes>
    <notes id="FPar5">
      <title>Consent for publication</title>
      <p id="Par76">Not applicable.</p>
    </notes>
    <notes id="FPar3" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par77">The authors declare that they have no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morrison</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Multiple sequence alignment for phylogenetic purposes</article-title>
        <source>Aust Syst Bot</source>
        <year>2006</year>
        <volume>19</volume>
        <issue>6</issue>
        <fpage>479</fpage>
        <lpage>539</lpage>
        <pub-id pub-id-type="doi">10.1071/SB06020</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shapiro</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Yingling</surname>
            <given-names>YG</given-names>
          </name>
          <name>
            <surname>Kasprzak</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Bindewald</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Bridging the gap in RNA structure prediction</article-title>
        <source>Curr Opin Struct Biol</source>
        <year>2007</year>
        <volume>17</volume>
        <issue>2</issue>
        <fpage>157</fpage>
        <lpage>165</lpage>
        <pub-id pub-id-type="doi">10.1016/j.sbi.2007.03.001</pub-id>
        <?supplied-pmid 17383172?>
        <pub-id pub-id-type="pmid">17383172</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jumper</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Evans</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Pritzel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Figurnov</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ronneberger</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Tunyasuvunakool</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Bates</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Žídek</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Potapenko</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bridgland</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Kohl</surname>
            <given-names>SAA</given-names>
          </name>
          <name>
            <surname>Ballard</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Cowie</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Romera-Paredes</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Nikolov</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Jain</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Adler</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Back</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Petersen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Reiman</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Clancy</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zielinski</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Steinegger</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pacholska</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Berghammer</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Bodenstein</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Silver</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Vinyals</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Senior</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Kavukcuoglu</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Kohli</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Hassabis</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Highly accurate protein structure prediction with AlphaFold</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <issue>7873</issue>
        <fpage>583</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03819-2</pub-id>
        <?supplied-pmid 34265844?>
        <pub-id pub-id-type="pmid">34265844</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nguyen</surname>
            <given-names>NpD</given-names>
          </name>
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kumar</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Ultra-large alignments using phylogeny-aware profiles</article-title>
        <source>Genome Biol</source>
        <year>2015</year>
        <volume>16</volume>
        <issue>1</issue>
        <fpage>124</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-015-0688-z</pub-id>
        <?supplied-pmid 26076734?>
        <pub-id pub-id-type="pmid">26076734</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Park</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ivanovic</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Chu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Shen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>UPP2: fast and accurate alignment of datasets with fragmentary sequences</article-title>
        <source>Bioinform</source>
        <year>2023</year>
        <volume>39</volume>
        <issue>1</issue>
        <fpage>007</fpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btad007</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>WITCH: improved multiple sequence alignment through weighted consensus hidden markov model alignment</article-title>
        <source>J Comput Biol</source>
        <year>2022</year>
        <pub-id pub-id-type="doi">10.1089/cmb.2021.0585</pub-id>
        <?supplied-pmid 35575747?>
        <pub-id pub-id-type="pmid">35575747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>WITCH-NG: efficient and accurate alignment of datasets with sequence length heterogeneity</article-title>
        <source>Bioinform Adv</source>
        <year>2023</year>
        <volume>3</volume>
        <issue>1</issue>
        <fpage>024</fpage>
        <pub-id pub-id-type="doi">10.1093/bioadv/vbad024</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Park</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>HMMerge: an ensemble method for multiple sequence alignment</article-title>
        <source>Bioinform Adv</source>
        <year>2023</year>
        <volume>3</volume>
        <fpage>vbad052</fpage>
        <pub-id pub-id-type="doi">10.1093/bioadv/vbad052</pub-id>
        <?supplied-pmid 37128578?>
        <pub-id pub-id-type="pmid">37128578</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yamada</surname>
            <given-names>KD</given-names>
          </name>
          <name>
            <surname>Tomii</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Katoh</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Application of the MAFFT sequence alignment program to large data-reexamination of the usefulness of chained guide trees</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <issue>21</issue>
        <fpage>3246</fpage>
        <lpage>3251</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw412</pub-id>
        <?supplied-pmid 27378296?>
        <pub-id pub-id-type="pmid">27378296</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Katoh</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Frith</surname>
            <given-names>MC</given-names>
          </name>
        </person-group>
        <article-title>Adding unaligned sequences into an existing alignment using MAFFT and LAST</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <issue>23</issue>
        <fpage>3144</fpage>
        <lpage>3146</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts578</pub-id>
        <?supplied-pmid 23023983?>
        <pub-id pub-id-type="pmid">23023983</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Veidenberg</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Medlar</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Löytynoja</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Wasabi: an integrated platform for evolutionary sequence analysis and data visualization</article-title>
        <source>Mol Biol Evol</source>
        <year>2016</year>
        <volume>33</volume>
        <issue>4</issue>
        <fpage>1126</fpage>
        <lpage>1130</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msv333</pub-id>
        <?supplied-pmid 26635364?>
        <pub-id pub-id-type="pmid">26635364</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <mixed-citation publication-type="other">Katoh K, Frith MC. MAFFT – a multiple alignment program for amino acid or nucleotide sequences. <ext-link ext-link-type="uri" xlink:href="https://mafft.cbrc.jp/alignment/software/addsequences.html">https://mafft.cbrc.jp/alignment/software/addsequences.html</ext-link>. Accessed 20 May 2022.</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Smirnov</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>MAGUS: Multiple sequence Alignment using Graph clUStering</article-title>
        <source>Bioinformatics</source>
        <year>2021</year>
        <volume>37</volume>
        <issue>12</issue>
        <fpage>1666</fpage>
        <lpage>1672</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa992</pub-id>
        <?supplied-pmid 33252662?>
        <pub-id pub-id-type="pmid">33252662</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Nguyen</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>L-S</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>PASTA: ultra-large multiple sequence alignment for nucleotide and amino-acid sequences</article-title>
        <source>J Comput Biol</source>
        <year>2015</year>
        <volume>22</volume>
        <issue>5</issue>
        <fpage>377</fpage>
        <lpage>386</lpage>
        <pub-id pub-id-type="doi">10.1089/cmb.2014.0156</pub-id>
        <?supplied-pmid 25549288?>
        <pub-id pub-id-type="pmid">25549288</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Price</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Dehal</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Arkin</surname>
            <given-names>AP</given-names>
          </name>
        </person-group>
        <article-title>FastTree 2—approximately maximum-likelihood trees for large alignments</article-title>
        <source>PLoS ONE</source>
        <year>2010</year>
        <volume>5</volume>
        <issue>3</issue>
        <fpage>9490</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0009490</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>FASTSP: linear time calculation of alignment accuracy</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <issue>23</issue>
        <fpage>3250</fpage>
        <lpage>3258</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr553</pub-id>
        <?supplied-pmid 21984754?>
        <pub-id pub-id-type="pmid">21984754</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Raghavan</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Nelesen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Linder</surname>
            <given-names>CR</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Rapid and accurate large-scale coestimation of sequence alignments and phylogenetic trees</article-title>
        <source>Science</source>
        <year>2009</year>
        <volume>324</volume>
        <issue>5934</issue>
        <fpage>1561</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1171243</pub-id>
        <?supplied-pmid 19541996?>
        <pub-id pub-id-type="pmid">19541996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cannone</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Subramanian</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Schnare</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Collett</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>D’Souza</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Du</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Madabusi</surname>
            <given-names>LV</given-names>
          </name>
          <name>
            <surname>Müller</surname>
            <given-names>KM</given-names>
          </name>
          <name>
            <surname>Pande</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Shang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Gutell</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <article-title>The Comparative RNA Web (CRW) Site: an online database of comparative sequence and structure information for ribosomal, intron, and other RNAs</article-title>
        <source>BMC Bioinform</source>
        <year>2002</year>
        <volume>3</volume>
        <issue>1</issue>
        <fpage>2</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-3-2</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fletcher</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>INDELible: a flexible simulator of biological sequence evolution</article-title>
        <source>Mol Biol Evol</source>
        <year>2009</year>
        <volume>26</volume>
        <issue>8</issue>
        <fpage>1879</fpage>
        <lpage>1888</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msp098</pub-id>
        <?supplied-pmid 19423664?>
        <pub-id pub-id-type="pmid">19423664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stoye</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Evers</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Rose: generating sequence families</article-title>
        <source>Bioinformatics (Oxford, England)</source>
        <year>1998</year>
        <volume>14</volume>
        <issue>2</issue>
        <fpage>157</fpage>
        <lpage>163</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/14.2.157</pub-id>
        <?supplied-pmid 9545448?>
        <pub-id pub-id-type="pmid">9545448</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Zaharias</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>MAGUS+eHMMs: improved multiple sequence alignment accuracy for fragmentary sequences</article-title>
        <source>Bioinformatics</source>
        <year>2022</year>
        <volume>38</volume>
        <issue>4</issue>
        <fpage>918</fpage>
        <lpage>924</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btab788</pub-id>
        <?supplied-pmid 34791036?>
        <pub-id pub-id-type="pmid">34791036</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Collins</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>PASTA for proteins</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>34</volume>
        <issue>22</issue>
        <fpage>3939</fpage>
        <lpage>3941</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty495</pub-id>
        <?supplied-pmid 29931282?>
        <pub-id pub-id-type="pmid">29931282</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thompson</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Linard</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lecompte</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Poch</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>A comprehensive benchmark study of multiple sequence alignment methods: current challenges and future perspectives</article-title>
        <source>PLoS ONE</source>
        <year>2011</year>
        <volume>6</volume>
        <issue>3</issue>
        <fpage>18093</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0018093</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gloor</surname>
            <given-names>GB</given-names>
          </name>
          <name>
            <surname>Martin</surname>
            <given-names>LC</given-names>
          </name>
          <name>
            <surname>Wahl</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Dunn</surname>
            <given-names>SD</given-names>
          </name>
        </person-group>
        <article-title>Mutual information in protein multiple sequence alignments reveals two classes of coevolving positions</article-title>
        <source>Biochemistry</source>
        <year>2005</year>
        <volume>44</volume>
        <issue>19</issue>
        <fpage>7156</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1021/bi050293e</pub-id>
        <?supplied-pmid 15882054?>
        <pub-id pub-id-type="pmid">15882054</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyatt</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>G-L</given-names>
          </name>
          <name>
            <surname>LoCascio</surname>
            <given-names>PF</given-names>
          </name>
          <name>
            <surname>Land</surname>
            <given-names>ML</given-names>
          </name>
          <name>
            <surname>Larimer</surname>
            <given-names>FW</given-names>
          </name>
          <name>
            <surname>Hauser</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Prodigal: prokaryotic gene recognition and translation initiation site identification</article-title>
        <source>BMC Bioinform</source>
        <year>2010</year>
        <volume>11</volume>
        <issue>1</issue>
        <fpage>119</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mistry</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chuguransky</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Qureshi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Salazar</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Sonnhammer</surname>
            <given-names>ELL</given-names>
          </name>
          <name>
            <surname>Tosatto</surname>
            <given-names>SCE</given-names>
          </name>
          <name>
            <surname>Paladin</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Raj</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Richardson</surname>
            <given-names>LJ</given-names>
          </name>
          <name>
            <surname>Finn</surname>
            <given-names>RD</given-names>
          </name>
          <name>
            <surname>Bateman</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Pfam: The protein families database in 2021</article-title>
        <source>Nucleic Acids Res</source>
        <year>2021</year>
        <volume>49</volume>
        <issue>D1</issue>
        <fpage>412</fpage>
        <lpage>419</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkaa913</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sievers</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Wilm</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dineen</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gibson</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Karplus</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>McWilliam</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Remmert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Söding</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, scalable generation of high-quality protein multiple sequence alignments using Clustal Omega</article-title>
        <source>Mol Syst Biol</source>
        <year>2011</year>
        <volume>7</volume>
        <issue>1</issue>
        <fpage>539</fpage>
        <pub-id pub-id-type="doi">10.1038/msb.2011.75</pub-id>
        <?supplied-pmid 21988835?>
        <pub-id pub-id-type="pmid">21988835</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Holder</surname>
            <given-names>MT</given-names>
          </name>
          <name>
            <surname>Nelesen</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Stamatakis</surname>
            <given-names>AP</given-names>
          </name>
          <name>
            <surname>Linder</surname>
            <given-names>CR</given-names>
          </name>
        </person-group>
        <article-title>SATé-II: very fast and accurate simultaneous estimation of multiple sequence alignments and phylogenetic trees</article-title>
        <source>Syst Biol</source>
        <year>2011</year>
        <volume>61</volume>
        <issue>1</issue>
        <fpage>90</fpage>
        <lpage>90</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syr095</pub-id>
        <?supplied-pmid 22139466?>
        <pub-id pub-id-type="pmid">22139466</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Algorithms Mol Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Algorithms Mol Biol</journal-id>
    <journal-title-group>
      <journal-title>Algorithms for Molecular Biology : AMB</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1748-7188</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10704716</article-id>
    <article-id pub-id-type="pmid">38062452</article-id>
    <article-id pub-id-type="publisher-id">247</article-id>
    <article-id pub-id-type="doi">10.1186/s13015-023-00247-x</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EMMA: a new method for computing multiple sequence alignments given a constraint subset alignment</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Shen</surname>
          <given-names>Chengze</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Baqiao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Williams</surname>
          <given-names>Kelly P.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Warnow</surname>
          <given-names>Tandy</given-names>
        </name>
        <address>
          <email>warnow@illinois.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/047426m28</institution-id><institution-id institution-id-type="GRID">grid.35403.31</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 9991</institution-id><institution>Computer Science, </institution><institution>University of Illinois, Urbana-Champaign, </institution></institution-wrap>201 N. Goodwin Ave, Urbana, 61801 IL USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/01apwpt12</institution-id><institution-id institution-id-type="GRID">grid.474520.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2151 9272</institution-id><institution>Sandia National Laboratories, </institution></institution-wrap>7011 East Ave., Livermore, 94550 CA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>7</day>
      <month>12</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>7</day>
      <month>12</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>18</volume>
    <elocation-id>21</elocation-id>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>11</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Adding sequences into an existing (possibly user-provided) alignment has multiple applications, including updating a large alignment with new data, adding sequences into a constraint alignment constructed using biological knowledge, or computing alignments in the presence of sequence length heterogeneity. Although this is a natural problem, only a few tools have been developed to use this information with high fidelity.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We present EMMA (Extending Multiple alignments using MAFFT--add) for the problem of adding a set of unaligned sequences into a multiple sequence alignment (i.e., a constraint alignment). EMMA builds on MAFFT--add, which is also designed to add sequences into a given constraint alignment. EMMA improves on MAFFT--add methods by using a divide-and-conquer framework to scale its most accurate version, MAFFT-linsi--add, to constraint alignments with many sequences. We show that EMMA has an accuracy advantage over other techniques for adding sequences into alignments under many realistic conditions and can scale to large datasets with high accuracy (hundreds of thousands of sequences). EMMA is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/c5shen/EMMA">https://github.com/c5shen/EMMA</ext-link>.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">EMMA is a new tool that provides high accuracy and scalability for adding sequences into an existing alignment.</p>
      </sec>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s13015-023-00247-x.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Multiple sequence alignment</kwd>
      <kwd>Constraint alignment</kwd>
      <kwd>MAFFT</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100006234</institution-id>
            <institution>Sandia National Laboratories</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100006234</institution-id>
            <institution>Sandia National Laboratories</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>US National Science Foundation</institution>
        </funding-source>
        <award-id>2006069</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© BioMed Central Ltd., part of Springer Nature 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <sec id="Sec2">
      <title>Adding sequences to a multiple sequence alignment</title>
      <p id="Par4">Multiple sequence alignment (MSA) is a crucial precursor to many downstream biological analyses, such as phylogeny estimation [<xref ref-type="bibr" rid="CR1">1</xref>], RNA structure prediction [<xref ref-type="bibr" rid="CR2">2</xref>], protein structure prediction [<xref ref-type="bibr" rid="CR3">3</xref>], etc. Obtaining an accurate MSA can be challenging, especially when the dataset is large (i.e., more than 1000 sequences). In some cases, the problem of estimating an alignment on a large dataset can be addressed through approaches that seek to add sequences into a given alignment without allowing the given alignment to change; for this reason, the given alignment is referred to as a “constraint alignment”. For example, biological knowledge can be used to form a reference alignment on a subset of the sequences, and then the remaining sequences can be added to the reference alignment; this has the potential to improve accuracy compared to methods that do not include biological knowledge to define a constraint alignment. Another case where adding sequences into an existing alignment occurs is when new sequences or genomes are added to databases, leading to the opportunity to add the new sequences for each gene in the genome into a growing alignment. In this second case, adding sequences into the existing alignment avoids the need to recompute the alignment from scratch and could lead to substantial running time benefits. A third case is for <italic>de novo</italic> multiple sequence alignment, where a subset of the sequences is selected and aligned, and then the remaining sequences are added into this “backbone alignment”; examples of such methods include UPP [<xref ref-type="bibr" rid="CR4">4</xref>], UPP2 [<xref ref-type="bibr" rid="CR5">5</xref>], WITCH [<xref ref-type="bibr" rid="CR6">6</xref>], WITCH-ng [<xref ref-type="bibr" rid="CR7">7</xref>], HMMerge [<xref ref-type="bibr" rid="CR8">8</xref>], and MAFFT-sparsecore [<xref ref-type="bibr" rid="CR9">9</xref>]. One of the motivations for this type of alignment method (which we refer to as “two-stage” methods) is when the input dataset has substantial sequence length heterogeneity, which can result in poor alignment accuracy using standard methods [<xref ref-type="bibr" rid="CR4">4</xref>]. Thus, adding sequences into existing alignments is a natural problem with multiple applications to biological sequence analysis.</p>
      <p id="Par5">A few methods have been developed to add sequences into an existing alignment, with MAFFT--add [<xref ref-type="bibr" rid="CR10">10</xref>] perhaps the most well-known. However, multiple sequence alignment methods that operate in two steps—i.e., they first extract and align the backbone sequences and then add the remaining sequences into this backbone alignment—can be modified to enable sequences to be added into a user-provided alignment.</p>
    </sec>
    <sec id="Sec3">
      <title>HMM-based methods</title>
      <p id="Par6">Many of the methods that have been developed for adding sequences into a given multiple-sequence alignment operate by representing the existing alignment by either a single HMM or by an ensemble of HMMs. Then, for every additional sequence, which we call “query sequences,” the HMM or ensemble of HMMs is used to find an alignment of the query sequence to the given alignment. Examples of such approaches include functionality provided in UPP [<xref ref-type="bibr" rid="CR4">4</xref>], UPP2 [<xref ref-type="bibr" rid="CR5">5</xref>], WITCH [<xref ref-type="bibr" rid="CR6">6</xref>], WITCH-ng [<xref ref-type="bibr" rid="CR7">7</xref>], and HMMerge [<xref ref-type="bibr" rid="CR8">8</xref>]. We refer to these functions by appending “-add” to the MSA method name (e.g., this functionality in WITCH is referred to as WITCH-add). In this study, we examine the performance of WITCH-ng-add as it has been shown to be at least as accurate and generally faster than WITCH-add, and both are, in turn, at least as accurate as UPP-add and UPP2-add. Finally, HMMerge-add is slower than WITCH-ng-add, and so is omitted from this study. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S1 for additional details about these HMM-based methods.</p>
      <p id="Par7">Because HMM-based methods operate by aligning the query sequences to one or more HMMs, homologies between query sequences can only be discovered if these homologies align through match states in the HMMs. This approach has the potential to miss valid homologies between query sequences, for example, when the given alignment is insufficiently representative of the entire family. Thus, only query sequence characters (i.e., nucleotides or residues) that are aligned through match states in the HMMs can be placed in columns that have other nucleotides or residues; if the character is added to the alignment through an insertion state, it will never be detected as homologous to any other character in any other sequence. This aspect of using HMMs for alignment has a potentially significant impact on the accuracy of the alignments of query sequences to the backbone alignment.</p>
    </sec>
    <sec id="Sec4">
      <title>MAFFT--add and MAFFT-linsi--add</title>
      <p id="Par8">MAFFT--add [<xref ref-type="bibr" rid="CR10">10</xref>] in its default setting uses a standard progressive alignment procedure with two iterations to add query sequences. In each iteration, it computes the pairwise distance matrix between the complete set of sequences (both in the backbone and the query sequence set) using shared 6-mers. Then, it computes a guide tree using the distance matrix and builds an alignment. More specifically, for each node in the guide tree, MAFFT--add does an alignment computation only if a query sequence is involved at the node (i.e., at least one child has some query sequences). Otherwise, it simply uses the alignment from the backbone and so is guaranteed to preserve the input backbone alignment. This property of guaranteeing that the input backbone alignment is not changed is true of the more accurate variants of MAFFT--add, including the variant that uses MAFFT-linsi to add query sequences (which we refer to as MAFFT-linsi--add), which we briefly describe below.<fig id="Fig1"><label>Fig. 1</label><caption><p>Comparing MAFFT-linsi--add to UPP-add We ran MAFFT-linsi--add and UPP-add on a backbone alignment and two query sequences. The initial two sites in the MAFFT-linsi--add alignment each contains two letters from the query sequences, thus indicating it detects them as homologous to each other, although there are no letters from the backbone alignment in these two sites. This is impossible for any method that represents the backbone alignment by one or more HMMs and then adds sequences to the backbone alignment using the HMMs. Thus, UPP-add places these initial letters of the query sequences into separate sites. Visualization is done with WASABI [<xref ref-type="bibr" rid="CR11">11</xref>]</p></caption><graphic xlink:href="13015_2023_247_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par9">MAFFT-linsi--add has two differences to the default version of MAFFT--add. First, MAFFT-linsi--add uses <italic>localpair</italic> (local pairwise alignment scores) for the distance matrix calculation, which is more accurate than shared 6-mers. Second, it only runs for one iteration of progressive alignment and uses at most 1000 iterations of iterative refinement after the progressive alignment finishes. MAFFT--add and MAFFT-linsi--add have runtimes that are at least quadratic in the input size due to the <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$O((m+q)^2)$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo>+</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq1.gif"/></alternatives></inline-formula> distance matrix calculation, where there are <italic>q</italic> query sequences and <italic>m</italic> sequences in the provided backbone alignment. MAFFT-linsi--add is even less scalable since its distance calculation is more costly. In addition, MAFFT-linsi--add does many steps of refinement that further impact the runtime. Hence, the developers of MAFFT recommend that MAFFT-linsi--add be limited to a few hundred sequences [<xref ref-type="bibr" rid="CR12">12</xref>].</p>
    </sec>
    <sec id="Sec5">
      <title>Limitations of HMM-based methods</title>
      <p id="Par10">Both MAFFT-linsi--add and MAFFT--add can recover homologies between query sequences that do not have homologous characters in the backbone alignment, and—as mentioned above—they are guaranteed to leave the backbone alignment unchanged as they add query sequences.</p>
      <p id="Par11">In contrast, methods such as WITCH-add, WITCH-ng-add, etc., that use HMMs or ensembles of HMMs to represent the backbone alignment cannot find homologies between letters in the query sequences that do not also have homologs in the backbone alignment. This is an inherent limitation of HMM-based methods for adding sequences into backbone alignment and implies that MAFFT--add and MAFFT-linsi--add may be more robust to the selection of the backbone sequences than the HMM-based methods.</p>
      <p id="Par12">Figure <xref rid="Fig1" ref-type="fig">1</xref> gives an example of a backbone alignment and query sequences, comparing MAFFT-linsi--add and UPP-add. Note that MAFFT-linsi--add finds homologous nucleotides in the query sequences that do not correspond to homologs in the backbone alignment, while UPP-add fails to recover these. This is an inherent limitation of HMM-based methods and motivates the development of EMMA.</p>
    </sec>
  </sec>
  <sec id="Sec6">
    <title>New method: EMMA</title>
    <sec id="Sec7">
      <title>Comparing MAFFT--add and MAFFT-linsi--add</title>
      <p id="Par13">In a preliminary study (Experiment 0), we compared MAFFT--add and MAFFT-linsi--add to determine their relative accuracy and computational performance, especially as the number of sequences increased. We used 5000M2, a simulated dataset developed for this study (see "<xref rid="Sec13" ref-type="sec">Datasets</xref>" section), for this comparison. For this experiment, the backbone alignment has 1000 sequences and we varied the total number of added sequences from 100 to 2000.<fig id="Fig2"><label>Fig. 2</label><caption><p>Experiment 0: MAFFT-linsi--add scalability issues. Alignment error (left) and runtime in hours (right) of MAFFT--add and MAFFT-linsi--add for adding 100, 200, 1000, or 2000 sequences to a 1000-taxon backbone alignment computed using MAGUS [<xref ref-type="bibr" rid="CR13">13</xref>] on the INDELible 5000M2-het dataset with 5000 sequences. Averages over ten replicates are shown. Error bars shown for alignment errors are standard errors and standard deviations for runtime. We exclude replicate 4 because MAFFT-linsi--add encountered out-of-memory issues (64 GB) when adding 100 or 200 query sequences. Additionally, MAFFT-linsi--add is not shown for 1000 or 2000 query sequences because it either encountered out-of-memory issues or failed to complete within 12 h. Alignment error is the average of SPFN (fraction of true pairwise homologies missing in the estimated alignment) and SPFP (fraction of pairwise homologies in the estimated alignment not found in the true alignment). Results for SPFN and SPFP separately show the same trends and can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S1</p></caption><graphic xlink:href="13015_2023_247_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par14">Figure <xref rid="Fig2" ref-type="fig">2</xref> demonstrates that MAFFT-linsi--add (i.e., MAFFT--add run using-linsi) has a substantial accuracy improvement over MAFFT--add when run in default mode, but is limited to relatively small datasets. Hence, we are motivated to see if we can improve the scalability of MAFFT-linsi--add to large datasets.</p>
    </sec>
    <sec id="Sec8">
      <title>EMMA’s algorithmic design</title>
      <p id="Par15">EMMA takes as input a multiple sequence alignment <italic>C</italic> on subset <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0$$\end{document}</tex-math><mml:math id="M4"><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq2.gif"/></alternatives></inline-formula> and a set <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_1$$\end{document}</tex-math><mml:math id="M6"><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq3.gif"/></alternatives></inline-formula> of additional “query” sequences, and returns an alignment on <inline-formula id="IEq4"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S = S_0 \cup S_1$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq4.gif"/></alternatives></inline-formula> that is required to induce alignment <italic>C</italic> (thus <italic>C</italic> is treated as a constraint). We refer to <italic>C</italic> as a backbone alignment or as a constraint alignment.</p>
      <p id="Par16">EMMA was designed to enable MAFFT-linsi--add to scale to datasets where the total number of sequences in <italic>S</italic> (backbone plus query sequences) is very large. To achieve this, we use a divide-and-conquer strategy where we create a number of problems with smaller numbers of backbone sequences and query sequences on which MAFFT-linsi--add can efficiently and accurately run. We then show how we can combine the results into a solution to the overall problem of adding sequences into the backbone alignment. Some of the techniques in EMMA are adapted from PASTA [<xref ref-type="bibr" rid="CR14">14</xref>] and UPP [<xref ref-type="bibr" rid="CR4">4</xref>], as described below and in the supplementary materials.</p>
      <p id="Par17">EMMA has two algorithmic parameters, <italic>l</italic> and <italic>u</italic>, that govern the decomposition strategy; our study set default values for these parameters, but they can be supplied by the user. Given the input backbone alignment <italic>C</italic>, unaligned sequences, and (optional) values for parameters <italic>l</italic> and <italic>u</italic>, EMMA operates as follows: <list list-type="order"><list-item><p id="Par18">Step 1: Construct set of constraint subalignments: Compute a tree on <italic>C</italic> (default: using the maximum likelihood heuristic FastTree2 [<xref ref-type="bibr" rid="CR15">15</xref>]), and break it into smaller subsets by repeatedly deleting centroid edges (i.e., edges whose removal splits the leaf set into two sets of roughly equal size), and retaining only those subsets that contain at least <italic>l</italic> and at most <italic>u</italic> sequences. Each subset of the tree defines a subalignment <inline-formula id="IEq5"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq5.gif"/></alternatives></inline-formula> of <italic>C</italic> (defined by the set <inline-formula id="IEq6"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_i$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq6.gif"/></alternatives></inline-formula> of sequences in the subset). For each subalignment <inline-formula id="IEq7"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i, i=1 \ldots k$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq7.gif"/></alternatives></inline-formula>, construct a profile HMM.</p></list-item><list-item><p id="Par19">Step 2: Define the set of subproblems: For each query sequence <italic>q</italic>, assign <italic>q</italic> to the constraint subalignment whose HMM has the best fit, as determined by the adjusted bitscore (introduced in [<xref ref-type="bibr" rid="CR6">6</xref>]), which provides an estimate of the probability that the given HMM generates the given query sequence. This defines a set of subproblems: the constraint subalignment <inline-formula id="IEq8"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq8.gif"/></alternatives></inline-formula> and the set of query sequences <inline-formula id="IEq9"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q_i$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mi>Q</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq9.gif"/></alternatives></inline-formula> assigned to <inline-formula id="IEq10"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq10.gif"/></alternatives></inline-formula>. For each <italic>i</italic>, if the total number of sequences in <inline-formula id="IEq11"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_i \cup Q_i$$\end{document}</tex-math><mml:math id="M22"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq11.gif"/></alternatives></inline-formula> exceeds 500, then partition the query sequences in <inline-formula id="IEq12"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q_i$$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mi>Q</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq12.gif"/></alternatives></inline-formula> into the smallest number of subsets needed in order to have at most 500 sequences in each subset, and ensure that have the subsets are as balanced in size as possible.</p></list-item><list-item><p id="Par20">Step 3: Apply MAFFT-linsi--add to add the query sequences: For each resultant subproblem, use MAFFT-linsi--add to add all assigned query sequences to the selected constraint subalignment. The output of this step is a collection of extended subalignments (i.e., an alignment that agrees with the constraint alignment <inline-formula id="IEq13"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_i$$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq13.gif"/></alternatives></inline-formula> but has some query sequences added).</p></list-item><list-item><p id="Par21">Step 4: Merge the extended subalignments using transitivity: Each subalignment contains sites that come from the backbone alignment as well as newly introduced sites (representing homologies inferred between query sequence letters through the use of MAFFT-linsi--add). The sites from the backbone alignment allow us to merge these subalignments in an obvious way: if subalignments <inline-formula id="IEq14"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A_1$$\end{document}</tex-math><mml:math id="M28"><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq14.gif"/></alternatives></inline-formula> and <inline-formula id="IEq15"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A_2$$\end{document}</tex-math><mml:math id="M30"><mml:msub><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq15.gif"/></alternatives></inline-formula> both have sites drawn from site <italic>j</italic> from the backbone alignment, then these two sites are merged in the output alignment. Furthermore, the left-to-right ordering of columns in the subalignments can be used to define the left-to-right ordering in the output alignment. Transitivity was first used in PASTA and has been used in many subsequent methods, such as UPP, WITCH, and WITCH-ng. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S2 for an example of transitivity merging.</p></list-item></list></p>
      <sec id="FPar1">
        <title>Theorem 1</title>
        <p id="Par22">Given backbone alignment <italic>C</italic> on set <inline-formula id="IEq16"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0$$\end{document}</tex-math><mml:math id="M32"><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq16.gif"/></alternatives></inline-formula> and query sequences <inline-formula id="IEq17"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_1$$\end{document}</tex-math><mml:math id="M34"><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq17.gif"/></alternatives></inline-formula>, EMMA outputs an alignment on <inline-formula id="IEq18"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0 \cup S_1$$\end{document}</tex-math><mml:math id="M36"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∪</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq18.gif"/></alternatives></inline-formula> that induces <italic>C</italic> when restricted to <inline-formula id="IEq19"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_0$$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq19.gif"/></alternatives></inline-formula>.</p>
      </sec>
      <sec id="FPar2">
        <title>Proof</title>
        <p id="Par23">Every subproblem consists of a constraint subalignment <inline-formula id="IEq20"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C'$$\end{document}</tex-math><mml:math id="M40"><mml:msup><mml:mi>C</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq20.gif"/></alternatives></inline-formula> and a set of query sequences <inline-formula id="IEq21"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$Q'$$\end{document}</tex-math><mml:math id="M42"><mml:msup><mml:mi>Q</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq21.gif"/></alternatives></inline-formula>. MAFFT-linsi--add applied to subproblem (<inline-formula id="IEq22"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C',Q'$$\end{document}</tex-math><mml:math id="M44"><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>Q</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq22.gif"/></alternatives></inline-formula>) is guaranteed to return an extended subalignment that induces <inline-formula id="IEq23"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C'$$\end{document}</tex-math><mml:math id="M46"><mml:msup><mml:mi>C</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq23.gif"/></alternatives></inline-formula> when restricted to the sequences for that set. Since every query sequence is in exactly one subalignment, all the extended subalignments will be consistent with <italic>C</italic>, the constraint alignment given to EMMA. By definition, the transitivity merge cannot undo homologies in any extended subalignment nor in the <italic>i</italic>. Furthermore, because each query sequence and each backbone sequence are in exactly one subalignment, the transitivity merge never merges columns in the constraint alignment; hence, it is guaranteed to return an alignment that induces the backbone alignment when restricted to the backbone sequences. <inline-formula id="IEq24"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\square$$\end{document}</tex-math><mml:math id="M48"><mml:mo>□</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq24.gif"/></alternatives></inline-formula></p>
        <p>In addition to guaranteeing that the output of EMMA is consistent with the constraint alignment, the four-step design achieves several properties that are beneficial for alignment accuracy and scalability to a large number of sequences: (1) all runs of MAFFT-linsi--add have at most 500 sequences in total and (2) the division into subalignments is based on an estimated phylogeny so that the sequences in each subalignment are likely to be closely related, and (3) each query sequence is assigned to a subalignment of sequences for which they are likely to be closely related (based on the bit-score calculation of the fit between the query sequence and the subalignment). These properties together make for subproblems that are small enough for MAFFT-linsi--add to run well on (i.e., we reduce the computational effort) and closely related enough for MAFFT-linsi--add to be highly accurate.</p>
        <p>Note that EMMA uses HMMs to determine <italic>which</italic> subset alignment to assign a given query sequence but does not use the HMMs to perform the alignment. Instead, the alignment of the query sequence to the subalignment is performed using MAFFT-linsi--add in batch mode (i.e., all the query sequences assigned to the same subalignment are aligned together), which allows MAFFT-linsi--add to find homologies between letters in query sequences even if the backbone alignment does not have homologies as well.</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec9">
    <title>Experimental design</title>
    <sec id="Sec10">
      <title>Overview</title>
      <p id="Par26">Experiment 1 sets the parameters <italic>l</italic> and <italic>u</italic> in EMMA; these experiments are performed on the training data. In Experiment 2, we compare EMMA to MAFFT--add (v7.490, run in default mode), MAFFT-linsi--add (v7.490), and WITCH-ng-add (v0.0.2), using the testing datasets (disjoint from the training data).</p>
      <p id="Par27">All methods are evaluated for running time as well as alignment error (see below). Experiment 1 analyses were limited to 64 GB and 12 h. Experiment 2 was run with 16 cores and 64 GB memory, with 24 h of runtime. For MAFFT-linsi--add and MAFFT--add, we allowed 128 GB memory. All experiments were run on the UIUC Campus Cluster. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S3 for exact commands of all methods, and Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S4 for additional details on dataset generation.</p>
    </sec>
    <sec id="Sec11">
      <title>Alignment error</title>
      <p id="Par28">For alignment error, we compare the estimated to the reference/true alignment, restricted to the (added) query sequences from the reference alignment. We report SPFN, SPFP, and expansion scores, which are defined as follows. The expansion score is the length of the estimated alignment divided by the length of the true or reference alignment; thus, the best result is 1.0, alignments that have expansion scores less than 1.0 are said to be “over-aligned”, while alignments that have expansion scores greater than 1.0 are “under-aligned”. The SPFN and SPFP error metrics are based on homologies, i.e., pairs of letters (nucleotides or amino acids) found in the same column in the true or estimated alignment. The sum-of-pairs false-negative (SPFN) rate is the fraction of homologies in the reference alignment that are missing in the estimated alignment. The sum-of-pairs false-positive (SPFP) rate is the fraction of pairs of homologies in the estimated alignment that are missing in the reference alignment. These metrics are calculated using FastSP [<xref ref-type="bibr" rid="CR16">16</xref>].</p>
    </sec>
    <sec id="Sec12">
      <title>Datasets</title>
      <p id="Par30">We use both simulated and biological datasets of nucleotide and protein to evaluate EMMA. In addition to datasets from prior studies [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR17">17</xref>, <xref ref-type="bibr" rid="CR18">18</xref>], we also generated one new simulated dataset using INDELible [<xref ref-type="bibr" rid="CR19">19</xref>] and we use two new biological datasets (Rec and Res). The training datasets were used in Experiments 0 and 1, and all subsequent experiments used the testing data (a separate collection of datasets). Empirical statistics for these datasets can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Table S1. All datasets are described below, with the new datasets freely available online through the Illinois Data Bank (see Data Availability statement).</p>
      <sec id="Sec13">
        <title>Simulated datasets</title>
        <p id="Par31">All simulated datasets are based on evolving sequences down model trees with indels so that all sequence alignments involve gaps. As described below, these simulated datasets vary in terms of indel length distribution, rate of evolution, and whether the sites evolve identically and independently or under selection. All simulated datasets have at least 1000 sequences.</p>
        <p id="Par32">ROSE: We included datasets from [<xref ref-type="bibr" rid="CR17">17</xref>], which were generated using the ROSE [<xref ref-type="bibr" rid="CR20">20</xref>] software. We used four model conditions (1000M1, 1000M2, 1000M3, and 1000M4) from [<xref ref-type="bibr" rid="CR17">17</xref>]. Each model condition has 10 replicates, and each replicate has 1000 sequences, with an average sequence length of <inline-formula id="IEq25"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sim$$\end{document}</tex-math><mml:math id="M50"><mml:mo>∼</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq25.gif"/></alternatives></inline-formula>1000 bp. The 1000M1–1000M4 models vary in rate of evolution (with 1000M1 the highest, and reducing rates as the index increases), thus enabling us to evaluate the impact of rates of evolution on alignment difficulty. All site evolution is non-ultrametric, and the sites evolve identically and independently.</p>
        <p id="Par33">The INDELible simulated datasets: These datasets were generated for this study. We used INDELible [<xref ref-type="bibr" rid="CR19">19</xref>] to evolve sequence datasets down a tree with a heterogeneous indel (insertion and deletion) model. Under this model, with a small probability, an indel event can be promoted to long indel events, modeling infrequent large gain or loss during the evolutionary process (e.g., domain-level indels). Hence, we name these new model conditions “het” to reflect their heterogeneous indels. Each replicate has 5000 sequences, and the model conditions range in evolutionary rates (and hence alignment difficulty), with model condition 5000M2-het having the highest rate of evolution, 5000M3-het somewhat slower, and 5000M4-het the slowest. We used non-ultrametric model trees, and all sites evolved identically and independently. See Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S4 for details of the data generation and Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Tables S2 and S3 for the parameter values used in the simulations.</p>
        <p id="Par34">RNASim: The RNASim million-sequence dataset is from [<xref ref-type="bibr" rid="CR14">14</xref>] and has been used in prior studies to evaluate alignment methods [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR21">21</xref>]. In the RNASim simulation, RNA sequences evolve under a biophysical model and under selection in order to conserve the rRNA structure. Thus, the sites do not evolve independently. In this study, we subsampled 10 replicates, each with 10,000 sequences.</p>
      </sec>
      <sec id="Sec14">
        <title>Biological datasets</title>
        <p id="Par35">CRW: The Comparative Ribosomal Website [<xref ref-type="bibr" rid="CR18">18</xref>] (CRW) is a collection of nucleotide datasets with curated alignments based on secondary structure. We include 16 S.3, 16 S.T, and 16 S.B.ALL, three large datasets from the CRW, with 5323, 6350, and 27,643 sequences, respectively. These datasets have been used in previous studies [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR21">21</xref>, <xref ref-type="bibr" rid="CR22">22</xref>] and exhibit sequence length heterogeneity. We use the cleaned versions from [<xref ref-type="bibr" rid="CR21">21</xref>], for which any ambiguity codes or entirely gapped columns are removed.</p>
        <p id="Par36">10AA: The “10 AA” dataset is a publicly available collection of large curated protein alignments, originally assembled for the study evaluating PASTA [<xref ref-type="bibr" rid="CR14">14</xref>], but also used to evaluate multiple sequence alignment methods [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR22">22</xref>]. These curated alignments are based on protein structure and range from 320 to 807 sequences and include the eight largest BAliBASE datasets [<xref ref-type="bibr" rid="CR23">23</xref>] and two datasets from [<xref ref-type="bibr" rid="CR24">24</xref>].</p>
        <p id="Par37">Serine recombinases (Rec and Res): These datasets were assembled for this study and are for two domains from serine recombinase. Protein sequences were taken from 350,378 GenBank bacterial and archaeal genome assemblies (Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S4) using Prodigal [<xref ref-type="bibr" rid="CR25">25</xref>]. Serine recombinases were identified using the Pfam HMMs [<xref ref-type="bibr" rid="CR26">26</xref>] Resolvase (Res) for the catalytic domain, and Recombinase (Rec) for the integrase-specific domain using <italic>hmmsearch</italic> from the HMMER package with the “trusted cutoffs” supplied by Pfam. Standards phiC31 and Bxb1 were added. From the 199,090 unique protein sequences, the Rec and Res domains were separately extracted using the boundaries determined by the HMM hits.</p>
        <p id="Par38">The Rec and Res datasets have reference alignments on a subset of the sequences (i.e., the seed alignment from Pfam), with Rec having 66 and Res having 112 seed sequences. Hence, the reference set for each dataset is much smaller than the entire set of sequences. Alignment error is evaluated only on these specific reference sequences.</p>
      </sec>
      <sec id="Sec15">
        <title>Constraint alignment selection</title>
        <p id="Par39">Recall that we have true alignments for the simulated datasets and reference alignments (based on structure) for the biological datasets. However, for the Rec and Res datasets, we have reference alignments only on a subset of the sequences. Alignment error is evaluated only on sequences for which we have reference alignments, which means that for the Rec and Res datasets we can only evaluate alignment error on a subset of the sequences.</p>
        <p id="Par40">In Experiment 2, we designed different ways of selecting a subset of the reference sequences to form the constraint alignment. The reference alignment, restricted to the selected sequences, is treated as the backbone alignment (i.e., the constraint alignment), and the remaining sequences are query sequences.</p>
        <p id="Par41">We considered three different scenarios for the selection of the backbone sequences, for which a constraint alignment would be provided by the user. The first two scenarios select sequences randomly from across the assume that the backbone sequences are selected randomly from the input. For these two scenarios, we vary the number of sampled sequences from “large” (at 25% of the full set of sequences) to “small” (at 10% of the sequences). The third scenario is designed for the case where a curated alignment is available for a small and likely closely related set of sequences found within a clade. <list list-type="order"><list-item><p id="Par42">Large random subset: We begin by determining the set of reference sequences that are “full-length,” which means their length is within 25% of the median length. From the set of <italic>F</italic> full-length sequences, we randomly select <inline-formula id="IEq26"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\min (1000, 0.25F)$$\end{document}</tex-math><mml:math id="M52"><mml:mrow><mml:mo movablelimits="true">min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1000</mml:mn><mml:mo>,</mml:mo><mml:mn>0.25</mml:mn><mml:mi>F</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq26.gif"/></alternatives></inline-formula> sequences.</p></list-item><list-item><p id="Par43">Small random subset: The protocol is identical to the large random subset protocol, except that we randomly select <inline-formula id="IEq27"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\min (100, 0.1F)$$\end{document}</tex-math><mml:math id="M54"><mml:mrow><mml:mo movablelimits="true">min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>100</mml:mn><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn><mml:mi>F</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq27.gif"/></alternatives></inline-formula> full-length sequences. However, if this number is less than 10, we just pick 10 sequences at random.</p></list-item><list-item><p id="Par44">Large clade-based subset: Here, we restrict to sequences from a clade (as defined on either the true tree for simulated data or a maximum likelihood tree for the biological data), selecting a clade that has at most 1000 sequences, and that comes as close as possible to 25% of the reference sequences. In the case of ties, we pick the clade randomly,</p></list-item></list></p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec16">
    <title>Results</title>
    <sec id="Sec17">
      <title>Experiment 1: Designing EMMA</title>
      <p id="Par45">Experiment 1 is the experiment where we set the algorithmic parameters, <italic>l</italic> and <italic>u</italic>, for EMMA. We vary <italic>l</italic> between 10 and 50 and <italic>u</italic> between <italic>l</italic> and 100, using the INDELiBLE 5000M2-het model condition, which has a high rate of evolution and so makes for difficult alignments. We use the <italic>large random subset</italic> scenario so that the backbone alignment contains 1000 randomly selected sequences, and the remaining 4000 sequences are query sequences.</p>
      <p id="Par46">Results for EMMA with different settings of (<italic>l</italic>, <italic>u</italic>) on 5000M2-het (10 replicates) are presented in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S3. The lowest error is found when <inline-formula id="IEq28"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M56"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq28.gif"/></alternatives></inline-formula>, and for this setting of <italic>l</italic>, <italic>u</italic> then has little impact. However, the setting for <italic>u</italic> does impact runtime, with the fastest runtime found (across all settings) with <inline-formula id="IEq29"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M58"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq29.gif"/></alternatives></inline-formula> and <inline-formula id="IEq30"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M60"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq30.gif"/></alternatives></inline-formula>. Based on this experiment, we set these as the default settings for <italic>l</italic> and <italic>u</italic>.<fig id="Fig3"><label>Fig. 3</label><caption><p>Expansion score (top) and SPFP (bottom) on large random backbones. In each subfigure, the top panel denotes biological datasets, and the bottom panel denotes simulated datasets (note the change in the y-axis range for expansion scores between the top and bottom panels). The horizontal dashed line indicates a perfect expansion score of 1. MAFFT-linsi--add failed to finish within 24 h for datasets except for 10AA and ROSE 1000M1–4 and was not run on Rec and Res (due to their very large size, we knew it would not complete within the allowed time), and MAFFT--add encountered out-of-memory issues on the Res dataset (failed runs, or runs that were not attempted, are marked with “X”). The expansion score is the length of the estimated alignment normalized by the length of the reference or true alignment; optimal is 1.0, and values above 1.0 indicate alignments that are too long (and so are under-aligned)</p></caption><graphic xlink:href="13015_2023_247_Fig3_HTML" id="MO3"/></fig></p>
    </sec>
    <sec id="Sec18">
      <title>Experiment 2: Evaluating EMMA to other sequence-adding methods</title>
      <p id="Par47">Here, we show comparisons of EMMA using the default settings of <inline-formula id="IEq31"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M62"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq31.gif"/></alternatives></inline-formula> and <inline-formula id="IEq32"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M64"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq32.gif"/></alternatives></inline-formula> to WITCH-ng-add and MAFFT-linsi--add. We show a comparison to MAFFT--add in default mode only for a limited set of analyses since its error rates were much higher than the other methods; see Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S4–S14 for full results, including MAFFT--add.</p>
      <sec id="Sec19">
        <title>Expansion scores and SPFP</title>
        <p id="Par48">The expansion score is the estimated alignment length normalized by the reference or true alignment length. As seen in the Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Table S4, MAFFT-linsi--add had the best expansion scores, coming close to 1.0 in most cases. All the other methods, however, produced alignments that were longer than the true alignment (and hence were under-aligning), as indicated by expansion scores being greater than 1. MAFFT--add under-aligned the least of these methods, followed closely by EMMA, and WITCH-ng-add has by far the largest expansion scores. For the expansion score, WITCH-ng is the outlier, as its expansion scores were excessively high. This level of under-alignment also means that interpreting its SPFP rates is difficult since under-alignment also reduces false positives.</p>
        <p id="Par49">With these observations, we now consider the SPFP scores. Results for large random backbones are provided in Fig. <xref rid="Fig3" ref-type="fig">3</xref>, and results for the two other conditions are shown in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S4 and S5. WITCH-ng-add typically had among the best SPFP scores, but MAFFT-linsi-add and EMMA sometimes had better SPFP scores. Thus, the improved SPFP scores achieved by WITCH-ng-add are partially the result of its very high degree of under-alignment.</p>
        <p id="Par50">EMMA and MAFFT-linsi--add both had SPFP scores that are relatively close. There is an advantage to MAFFT-linsi--add over EMMA on the simulated ROSE datasets (1000M1–1000M4) but not on the 10AA datasets (the only biological datasets on which MAFFT-linsi--add completed).</p>
        <p id="Par51">We also see that MAFFT--add had higher SPFP scores than MAFFT-linsi--add on the datasets on which MAFFT-linsi--add could run. Given that MAFFT--add also had worse expansion scores than MAFFT-linsi--add, this indicates that MAFFT--add was generally inferior to MAFFT-linsi--add (consistent with Experiment 0, and also with other prior studies). Interestingly, although MAFFT--add had lower expansion scores than EMMA, it had higher SPFP scores. Given these trends, we omit MAFFT--add from the rest of the study (though see Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S3–S8 for comparisons involving MAFFT--add).</p>
        <p id="Par52">We note that the SPFP scores, other than for WITCH-ng-add, were all relatively close (and generally low), making SPFP scores not very informative. Therefore, for the remainder of this study, we focus on SPFN, noting that 1-SPFN is the same as <italic>recall</italic> (or SP-Score).<fig id="Fig4"><label>Fig. 4</label><caption><p>SPFN of EMMA, WITCH-ng-add, and MAFFT-linsi--add when adding sequences into large random backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Error bars indicate standard errors. MAFFT-linsi--add only completed within the allowed 24 h on datasets with at most 1000 sequences, and we did not run it on Rec or Res due to their large numbers of sequences (failed runs, or runs that were not attempted, are marked with “X”). Comparisons with MAFFT--add can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S7. SPFN results for each of the 10AA datasets are in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S12</p></caption><graphic xlink:href="13015_2023_247_Fig4_HTML" id="MO4"/></fig></p>
      </sec>
      <sec id="Sec20">
        <title>SPFN alignment error on large random backbones</title>
        <p id="Par53">Figure <xref rid="Fig4" ref-type="fig">4</xref> shows the SPFN of the three sequence-adding methods (i.e., EMMA, WITCH-ng-add, and MAFFT-linsi--add) when adding to large random backbone alignments. The most striking observation is that MAFFT-linsi--add only succeeded in completing the datasets with at most 1000 sequences (i.e., the 10AA biological datasets and the ROSE simulated datasets with 1000 sequences); on all the other datasets, it failed to complete within the allowed time (24 h). For all datasets, EMMA had the best SPFN score, better than both MAFFT-linsi--add and WITCH-ng. We also note that its advantage in SPFN was more noticeable on datasets with high rates of evolution (1000M1, 1000M2).</p>
      </sec>
      <sec id="Sec21">
        <title>SPFN alignment error on small random backbones</title>
        <p id="Par54">As with large random backbones, MAFFT-linsi--add only succeeded in finishing on the datasets with at most 1000 sequences (Fig. <xref rid="Fig5" ref-type="fig">5</xref>), but on those datasets, it was among the most accurate methods. The relative accuracy between the three methods is very similar to that displayed on the large backbones: EMMA was still the most accurate, followed by MAFFT-linsi--add when it can run, then by WITCH-ng. Finally, the gaps in accuracy between methods were smaller than when placing into large random backbones, while the absolute error rates were higher.<fig id="Fig5"><label>Fig. 5</label><caption><p>SPFN of EMMA, WITCH-ng-add, and MAFFT-linsi--add when adding sequences into small random backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Error bars indicate standard errors. MAFFT-linsi--add failed to finish within 24 h for datasets except for 10AA and ROSE 1000M1–4, and we did not run it on Rec or Res due to their large numbers of sequences (failed runs, or runs that were not attempted, are marked with “X”). Comparisons with MAFFT--add can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S8. SPFN results for each of the 10AA datasets are in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S13</p></caption><graphic xlink:href="13015_2023_247_Fig5_HTML" id="MO5"/></fig></p>
      </sec>
      <sec id="Sec22">
        <title>SPFN alignment error on clade-based backbones</title>
        <p id="Par55">As with the other conditions, when adding sequences into a clade-based backbone alignment, MAFFT-linsi--add failed to complete on any dataset with more than 1000 sequences. However, in many respects, the results for the clade-based backbone are different than for the random backbones (Fig. <xref rid="Fig6" ref-type="fig">6</xref>). The most noteworthy difference is that error rates increased for all methods when given clade-based backbones instead of random backbones, but the increase was largest for WITCH-ng-add. MAFFT-linsi--add is clearly the most accurate of all the methods on the 1000M1, 1000M2, and 1000M3 datasets and then ties for best on 1000M4. EMMA is strictly more accurate than WITCH-ng-add, usually by a large margin, on all datasets. Nevertheless, both EMMA and WITCH-ng-add have high errors on datasets with high rates of evolution (1000M1, 5000M3-het).<fig id="Fig6"><label>Fig. 6</label><caption><p>SPFN of EMMA, WITCH-ng-add, and MAFFT-linsi--add when adding sequences into clade-based backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Error bars indicate standard errors. MAFFT-linsi--add failed to finish within 24 h for datasets except for 10AA and ROSE 1000M1–4, and we did not run it on Rec or Res due to their large numbers of sequences (failed runs, or runs that were not attempted, are marked with “X”). Comparisons with MAFFT--add can be found in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S9. SPFN results for each of the 10AA datasets are in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Fig. S14</p></caption><graphic xlink:href="13015_2023_247_Fig6_HTML" id="MO6"/></fig></p>
      </sec>
      <sec id="Sec23">
        <title>Computational performance</title>
        <p id="Par56">MAFFT-linsi--add and MAFFT--add are the only methods that failed to complete on at least one of the datasets within the allowed runtime (24 h), using 16 cores and 128 GB memory. Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Section S5 shows that both methods reported out-of-memory issues or crashes. Specifically, MAFFT-linsi--add had an out-of-memory issue when attempting to analyze the INDELible 5000M2-het training dataset and allowed 64 GB. We also noted that MAFFT--add had an out-of-memory issue on the Res dataset with <inline-formula id="IEq33"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sim$$\end{document}</tex-math><mml:math id="M66"><mml:mo>∼</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq33.gif"/></alternatives></inline-formula>186K sequences, even when allowed 128 GB of memory. This is perhaps not surprising since MAFFT--add also computes the <inline-formula id="IEq34"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n \times n$$\end{document}</tex-math><mml:math id="M68"><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq34.gif"/></alternatives></inline-formula> pairwise distance matrix, where <italic>n</italic> is the number of sequences in total (backbone sequences and query sequences together), and shows that MAFFT--add as well as MAFFT-linsi--add both have large memory requirements.</p>
        <p id="Par57">Figure <xref rid="Fig7" ref-type="fig">7</xref> compares the methods given a large random backbone. MAFFT-linsi--add was the slowest method on all the datasets when it could run (as noted above, it failed to complete on any dataset with more than 1000 sequences). WITCH-ng-add was overall the next slowest method, but it was faster than EMMA on the 10AA datasets (which are the smallest datasets we examined, all below 1000 sequences). MAFFT--add was overall the fastest method, but WITCH-ng-add was faster on the Rec dataset, and EMMA was faster on the 5000M3-het dataset. Overall, EMMA was in between WITCH-ng-add and MAFFT--add in terms of running time on these datasets.</p>
        <p id="Par58">The runtimes of all methods on the other conditions (small random backbones and clade-based backbones) are shown in Additional file <xref ref-type="sec" rid="Sec26">1</xref>: Figs. S10 and S11. On these datasets, we see somewhat similar trends, with EMMA faster than MAFFT-linsi--add on the datasets where MAFFT-linsi--add can run, but now EMMA is slower than both WITCH-ng-add and MAFFT--add.<fig id="Fig7"><label>Fig. 7</label><caption><p>Experiment 2: Runtime (log-scale) in minutes when adding to large random backbone alignments. The top panel denotes biological datasets, and the bottom panel denotes simulated datasets. Except for the datasets with at most 1000 sequences, MAFFT-linsi--add failed to finish within 24 h and was not attempted on Rec and Res due to their large number of sequences. MAFFT--add encountered out-of-memory issues on the Res dataset. Failed runs, or runs not attempted due to dataset size, are marked with “X”. Error bars indicate standard deviation</p></caption><graphic xlink:href="13015_2023_247_Fig7_HTML" id="MO7"/></fig></p>
        <p id="Par59">The only methods that succeeded in completing all datasets were EMMA and WITCH-ng-add, and the maximum runtimes used by EMMA and WITCH-ng-add were 12.2 and 10.5 h, respectively. Given that WITCH-ng-add and EMMA completed so quickly using under 64 GB memory on these datasets and that the datasets had up to <inline-formula id="IEq35"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sim$$\end{document}</tex-math><mml:math id="M70"><mml:mo>∼</mml:mo></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq35.gif"/></alternatives></inline-formula>186,000 sequences, it is reasonable to say that WITCH-ng-add and EMMA are acceptable with respect to speed and scalability.</p>
        <p id="Par60">We also tried to give MAFFT-linsi--add three days (72 h instead of 24 h) to run on 16 S.3 and 16 S.T for the small random backbone and large clade-based backbone, but it still could not complete. Finally, we consider MAFFT--add to be reasonably scalable since it only had computational problems with the largest dataset (Res), and it is by far the fastest method we tested.</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec24">
    <title>Discussion</title>
    <p id="Par61">The four methods we have evaluated—EMMA, MAFFT--add, MAFFT-linsi--add, and WITCH-ng-add, vary in their ability to run on large datasets (i.e., scalability), runtime, and accuracy (here focused on SPFN). The relative performance is summarized in Table <xref rid="Tab1" ref-type="table">1</xref>, and discussed further below.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Overall performance of the tested methods</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Criterion</th><th align="left">EMMA</th><th align="left">WITCH-ng-add</th><th align="left">MAFFT--add</th><th align="left">MAFFT-linsi--add</th></tr></thead><tbody><tr><td align="left">Scalability</td><td align="left">All</td><td align="left">All</td><td align="left">All but largest</td><td align="left"><inline-formula id="IEq36"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\le 1000$$\end{document}</tex-math><mml:math id="M72"><mml:mrow><mml:mo>≤</mml:mo><mml:mn>1000</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq36.gif"/></alternatives></inline-formula> sequences</td></tr><tr><td align="left">SPFN-random</td><td align="left">1</td><td align="left">2</td><td align="left">3</td><td align="left">1</td></tr><tr><td align="left">SPFN-clade</td><td align="left">2</td><td align="left">3</td><td align="left">4</td><td align="left">1</td></tr><tr><td align="left">Speed</td><td align="left">2</td><td align="left">2</td><td align="left">1</td><td align="left">3</td></tr></tbody></table><table-wrap-foot><p>For scalability, we indicate which study datasets the method completed on</p><p>For SPFN and speed, we indicate the relative position (1 is best, 2 is second best, etc.)</p></table-wrap-foot></table-wrap></p>
    <p id="Par62">Our study showed clear differences in scalability, with EMMA and WITCH-ng-add the most scalable (completing on all datasets within the time and memory limits), MAFFT--add the next most scalable (failing to complete on one dataset), and MAFFT-linsi--add the least scalable (failing on all but the datasets with at most 1000 sequences). It is easy to see why EMMA can scale to the largest datasets, as the decomposition strategy and transitivity merge are both very fast, and the only potentially computationally intensive part is when it runs MAFFT-linsi--add on subsets of query sequences to add them to subsets of the backbone alignment. However, by design, the subproblems are all small (at most <inline-formula id="IEq37"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M74"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq37.gif"/></alternatives></inline-formula> backbone sequences and at most 500 query sequences). This design strategy allows EMMA to complete on all the datasets in our study. It is also easy to see why MAFFT-linsi--add is limited in scalability since its algorithmic design involves a quadratic runtime.</p>
    <p id="Par63">Accuracy differences were also apparent but were generally very small when the rates of evolution were low enough. This also is as expected since prior studies have shown differences in alignment error often are very small or negligible when sequence identity is high, which occurs under low rates of evolution (e.g., [<xref ref-type="bibr" rid="CR17">17</xref>, <xref ref-type="bibr" rid="CR27">27</xref>]).</p>
    <p id="Par64">When comparing accuracy under higher rates of evolution, we see that the selection strategy for the backbone sequences—i.e., whether they were selected randomly or from within a clade and the number of backbone sequences—impacts both absolute and relative alignment error. In particular, all methods have better accuracy with random sampling than with clade-based sampling and also have better accuracy when there are more sequences in the backbone alignment. These trends are expected since the constraint alignment is used as a model of the family, and dense sampling throughout the family (i.e., the large random backbone) ensures a better model than sparse random sampling (i.e., the small random backbone) or sampling from just within a clade.</p>
    <p id="Par65">The comparison between EMMA and WITCH-ng-add with respect to accuracy favors EMMA across all sampling strategies, although the two methods have nearly identical accuracy for some conditions. The accuracy advantage of EMMA is more noticeable on datasets with high rates of evolution, such as ROSE 1000M1, 1000M2, and INDELible 5000M3-het. Since WITCH-ng-add relies on using HMMs created from the backbone to align the queries, whereas EMMA uses MAFFT-linsi--add to align the queries, the improvement in accuracy for EMMA is likely to be due to the greater sensitivity of MAFFT-linsi--add for detecting homologies than the HMM-based approach within WITCH-ng-add.</p>
    <p id="Par66">The comparison between MAFFT-linsi--add and EMMA, although restricted to just those datasets on which MAFFT-linsi--add could run (i.e., the datasets with at most 1000 sequences), reveals the following trends. When given a large random backbone, EMMA matches or improves on MAFFT-linsi--add under all conditions, but has an advantage given on the ROSE 1000M1 and 1000M2 conditions, and then matches MAFFT-linsi--add for the 1000M3 and 1000M4 conditions. The same relative performance is seen for the small random backbone, but with a smaller difference between the methods. Thus, the rate of evolution impacts the relative accuracy of the two methods, favoring EMMA when the rate of evolution is high, suggesting that MAFFT-linsi--add accuracy is impacted more substantially by the rate of evolution than EMMA. This trend is consistent with prior studies showing that MAFFT-linsi is sensitive to rate of evolution, an observation that led to the design of SATé [<xref ref-type="bibr" rid="CR17">17</xref>] and its descendent methods [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR28">28</xref>].</p>
    <p id="Par67">Interestingly, MAFFT-linsi--add improves on EMMA when the sequences are drawn from a clade, with a substantial improvement under the higher rate of evolution. In other words, when the backbone is drawn from a clade, the algorithmic strategy in EMMA—which applies MAFFT-linsi--add to subsets that contain at most 25 backbone sequences from the clade – is inferior to using the entire backbone. This is clearly a condition where the EMMA divide-and-conquer strategy is not well-suited.</p>
    <p id="Par68">In understanding the conditions where MAFFT-linsi--add is more accurate than EMMA, it is helpful to understand that the homologies between query sequences found by EMMA are either found directly by MAFFT-linsi-add on a small subset (with at most 500 sequences) or inferred when combining these extended alignments using transitivity. Thus, the relative accuracy of EMMA and MAFFT-linsi--add is impacted by the divide-and-conquer strategy and, in particular, the size of the subsets in the decomposition of the backbone tree. Given that our default setting currently sets <inline-formula id="IEq38"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M76"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq38.gif"/></alternatives></inline-formula>, this choice creates subsets that have very few backbone sequences (at most 25) and then adds query sequences, but not so many as to exceed 500 total sequences. This is potentially why MAFFT-linsi-add can be more accurate than EMMA since MAFFT-linsi-add can find homologies between all pairs of query sequences, whereas EMMA (which applies MAFFT-linsi-add to small subsets) can only achieve this within the subsets it produces. Our Experiment 1, where we set the parameters <inline-formula id="IEq39"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$l=10$$\end{document}</tex-math><mml:math id="M78"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq39.gif"/></alternatives></inline-formula> and <inline-formula id="IEq40"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M80"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq40.gif"/></alternatives></inline-formula>, was based on the INDELible 5000M2 dataset, which has a high rate of evolution. It seems likely that other settings for <italic>l</italic> and <italic>u</italic> might lead to improved accuracy when the model condition has a lower rate of evolution since MAFFT-linsi--add’s accuracy improves as the rate of evolution decreases. In other words, EMMA’s algorithmic design aimed to reduce runtime and improve scalability, but for some challenging inputs (e.g., clade-based backbones) where MAFFT-linsi--add can run, the algorithmic design of EMMA may reduce accuracy relative to MAFFT-linsi--add. Hence, there is room for improvement in designing EMMA.</p>
    <p id="Par69">However, MAFFT-linsi--add could not complete the study datasets with more than 1000 sequences given the limitations in computational resources we imposed. In contrast, EMMA was able to complete all study datasets. Thus, while MAFFT-linsi--add had a clear accuracy advantage over EMMA for the clade-based backbones (though not on the random backbones), EMMA has a computational advantage over MAFFT-linsi--add in being able to scale to larger datasets.</p>
    <p id="Par70">Given the impact of clade-based sampling for the backbone sequences, it is important to remember that EMMA is never identical to MAFFT-linsi--add, even when analyzing small subsets. When we run MAFFT-linsi--add on the datasets with at most 1000 sequences, all the query sequences are considered together when added to the backbone alignment. In contrast, by construction, EMMA only adds query sequences to subsets of the backbone alignment with at most <italic>u</italic> sequences, and in our study, we set <inline-formula id="IEq41"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$u=25$$\end{document}</tex-math><mml:math id="M82"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="13015_2023_247_Article_IEq41.gif"/></alternatives></inline-formula> by default. From a computational standpoint, this strategy allows EMMA to scale to very large datasets. From an accuracy perspective, however, the impact clearly depends on how the backbone sequences were sampled. EMMA has an accuracy advantage over MAFFT-linsi--add when the backbone sequences are randomly sampled and there is a high rate of evolution and matches MAFFT-linsi--add for accuracy when the backbone sequences are randomly sampled with a lower rate of evolution. However, as we have seen, this strategy is poor when the backbone sequences are sampled from a clade, and the rate of evolution is high.</p>
    <p id="Par71">This observation also indicates that two-phase multiple sequence alignment methods that operate by selecting and aligning a set of sequences for the backbone and then adding in the remaining sequences should—if possible—select the backbone sequences from across the evolutionary tree for the dataset to obtain the best representative model of the gene family.</p>
  </sec>
  <sec id="Sec25">
    <title>Conclusions</title>
    <p id="Par72">This study presented EMMA, a new method for adding sequences into existing constraint alignments (also called backbone alignments). EMMA uses a divide-and-conquer strategy to enable MAFFT-linsi--add, a highly accurate version of MAFFT--add, to scale to large datasets. By itself, MAFFT-linsi--add was unable to complete using the computational resources on the datasets we studied with more than 1000 sequences, but EMMA succeeded in completing with even fewer resources on the largest dataset we studied, with more than 180,000 sequences.</p>
    <p id="Par73">Our study shows that EMMA has comparable or better alignment accuracy than MAFFT--add and WITCH-ng-add under all the conditions tested, and also comparable or better accuracy than MAFFT-linsi--add when the backbone sequences are selected randomly. However, our study also showed that when the backbone sequences are selected from a clade and the dataset is sufficiently small, then MAFFT-linsi--add is more accurate than EMMA. This finding indicates clearly that the design of EMMA needs to be reconsidered for the case where the user provides a curated alignment for a closely related group of sequences contained within a clade and wishes to add additional sequences that are distantly related to the backbone sequences.</p>
    <p id="Par74">Thus, future work should investigate appropriate modifications to the divide-and-conquer strategy in EMMA to address the case where the backbone sequences are distantly related to the query sequences. EMMA alignment accuracy could potentially be improved with a re-alignment stage to see if sets of sites could be merged together through the detection of additional homologies between query sequences. We should also explore other biological datasets to document the accuracy of these methods under a wider range of real-world conditions. EMMA is not yet optimized for speed, and a more careful parallel implementation may provide a substantial speed-up. Finally, EMMA could be studied as the second stage of the standard two-stage pipeline protocol used by UPP/UPP2, WITCH, and WITCH-ng for de novo multiple sequence alignment. Given the high accuracy of these two-stage methods for aligning datasets with high sequence length heterogeneity, this is likely to provide improved accuracy.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec26">
      <title>Supplementary Information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13015_2023_247_MOESM1_ESM.pdf">
            <caption>
              <p><bold>Additional file 1.</bold> Supplementary text, tables, and figures.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>CS developed the EMMA software, performed the analyses, interpreted the data, and drafted the manuscript. BL provided simulated datasets. KPW provided biological datasets and interpreted the data.. TW conceived of the approach, designed the study, interpreted the data, wrote the final draft, and supervised the research. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>CS and TW were supported by the US National Science Foundation grant 2006069 (to TW). K.P.W., C.S., and B.L. were supported by the Laboratory Directed Research and Development program at Sandia National Laboratories, which is a multimission laboratory managed and operated by National Technology and Engineering Solutions of Sandia LLC, a wholly-owned subsidiary of Honeywell International Inc. for the U.S. Department of Energy’s National Nuclear Security Administration under contract DE-NA0003525.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The INDELible, Rec, and Res datasets were created for this study. The Rec and Res datasets are available in the Illinois Data Bank at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.13012/B2IDB-2567453_V1">https://doi.org/10.13012/B2IDB-2567453_V1</ext-link>. The subsampled RNASim datasets (10,000 sequences for each replicate) are available at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.13012/B2IDB-4194451_V1">https://doi.org/10.13012/B2IDB-4194451_V1</ext-link>. Pfam seed sequences are included for both datasets (66 and 112 sequences for Rec and Res, respectively). The INDELible datasets (5000M2-het, 5000M3-het, and 5000M4-het) are available at <ext-link ext-link-type="uri" xlink:href="https://databank.illinois.edu/datasets/IDB-3974819">https://databank.illinois.edu/datasets/IDB-3974819</ext-link>. All other datasets are from prior studies and are available in public repositories. The 10AA datasets are available at <ext-link ext-link-type="uri" xlink:href="https://sites.google.com/eng.ucsd.edu/datasets/alignment/pastaupp">https://sites.google.com/eng.ucsd.edu/datasets/alignment/pastaupp</ext-link>. The three CRW datasets are available at <ext-link ext-link-type="uri" xlink:href="https://databank.illinois.edu/datasets/IDB-2419626">https://databank.illinois.edu/datasets/IDB-2419626</ext-link>. The ROSE datasets are available at <ext-link ext-link-type="uri" xlink:href="https://sites.google.com/eng.ucsd.edu/datasets/alignment/sate-i">https://sites.google.com/eng.ucsd.edu/datasets/alignment/sate-i</ext-link>.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar4">
      <title>Ethics approval and consent to participate</title>
      <p id="Par75">Not applicable.</p>
    </notes>
    <notes id="FPar5">
      <title>Consent for publication</title>
      <p id="Par76">Not applicable.</p>
    </notes>
    <notes id="FPar3" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par77">The authors declare that they have no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morrison</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Multiple sequence alignment for phylogenetic purposes</article-title>
        <source>Aust Syst Bot</source>
        <year>2006</year>
        <volume>19</volume>
        <issue>6</issue>
        <fpage>479</fpage>
        <lpage>539</lpage>
        <pub-id pub-id-type="doi">10.1071/SB06020</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shapiro</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Yingling</surname>
            <given-names>YG</given-names>
          </name>
          <name>
            <surname>Kasprzak</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Bindewald</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Bridging the gap in RNA structure prediction</article-title>
        <source>Curr Opin Struct Biol</source>
        <year>2007</year>
        <volume>17</volume>
        <issue>2</issue>
        <fpage>157</fpage>
        <lpage>165</lpage>
        <pub-id pub-id-type="doi">10.1016/j.sbi.2007.03.001</pub-id>
        <?supplied-pmid 17383172?>
        <pub-id pub-id-type="pmid">17383172</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jumper</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Evans</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Pritzel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Figurnov</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ronneberger</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Tunyasuvunakool</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Bates</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Žídek</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Potapenko</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bridgland</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Kohl</surname>
            <given-names>SAA</given-names>
          </name>
          <name>
            <surname>Ballard</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Cowie</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Romera-Paredes</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Nikolov</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Jain</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Adler</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Back</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Petersen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Reiman</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Clancy</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zielinski</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Steinegger</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pacholska</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Berghammer</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Bodenstein</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Silver</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Vinyals</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Senior</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Kavukcuoglu</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Kohli</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Hassabis</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Highly accurate protein structure prediction with AlphaFold</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>596</volume>
        <issue>7873</issue>
        <fpage>583</fpage>
        <lpage>9</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03819-2</pub-id>
        <?supplied-pmid 34265844?>
        <pub-id pub-id-type="pmid">34265844</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nguyen</surname>
            <given-names>NpD</given-names>
          </name>
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kumar</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Ultra-large alignments using phylogeny-aware profiles</article-title>
        <source>Genome Biol</source>
        <year>2015</year>
        <volume>16</volume>
        <issue>1</issue>
        <fpage>124</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-015-0688-z</pub-id>
        <?supplied-pmid 26076734?>
        <pub-id pub-id-type="pmid">26076734</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Park</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ivanovic</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Chu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Shen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>UPP2: fast and accurate alignment of datasets with fragmentary sequences</article-title>
        <source>Bioinform</source>
        <year>2023</year>
        <volume>39</volume>
        <issue>1</issue>
        <fpage>007</fpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btad007</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>WITCH: improved multiple sequence alignment through weighted consensus hidden markov model alignment</article-title>
        <source>J Comput Biol</source>
        <year>2022</year>
        <pub-id pub-id-type="doi">10.1089/cmb.2021.0585</pub-id>
        <?supplied-pmid 35575747?>
        <pub-id pub-id-type="pmid">35575747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>WITCH-NG: efficient and accurate alignment of datasets with sequence length heterogeneity</article-title>
        <source>Bioinform Adv</source>
        <year>2023</year>
        <volume>3</volume>
        <issue>1</issue>
        <fpage>024</fpage>
        <pub-id pub-id-type="doi">10.1093/bioadv/vbad024</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Park</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>HMMerge: an ensemble method for multiple sequence alignment</article-title>
        <source>Bioinform Adv</source>
        <year>2023</year>
        <volume>3</volume>
        <fpage>vbad052</fpage>
        <pub-id pub-id-type="doi">10.1093/bioadv/vbad052</pub-id>
        <?supplied-pmid 37128578?>
        <pub-id pub-id-type="pmid">37128578</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yamada</surname>
            <given-names>KD</given-names>
          </name>
          <name>
            <surname>Tomii</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Katoh</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Application of the MAFFT sequence alignment program to large data-reexamination of the usefulness of chained guide trees</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <issue>21</issue>
        <fpage>3246</fpage>
        <lpage>3251</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw412</pub-id>
        <?supplied-pmid 27378296?>
        <pub-id pub-id-type="pmid">27378296</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Katoh</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Frith</surname>
            <given-names>MC</given-names>
          </name>
        </person-group>
        <article-title>Adding unaligned sequences into an existing alignment using MAFFT and LAST</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <issue>23</issue>
        <fpage>3144</fpage>
        <lpage>3146</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts578</pub-id>
        <?supplied-pmid 23023983?>
        <pub-id pub-id-type="pmid">23023983</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Veidenberg</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Medlar</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Löytynoja</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Wasabi: an integrated platform for evolutionary sequence analysis and data visualization</article-title>
        <source>Mol Biol Evol</source>
        <year>2016</year>
        <volume>33</volume>
        <issue>4</issue>
        <fpage>1126</fpage>
        <lpage>1130</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msv333</pub-id>
        <?supplied-pmid 26635364?>
        <pub-id pub-id-type="pmid">26635364</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <mixed-citation publication-type="other">Katoh K, Frith MC. MAFFT – a multiple alignment program for amino acid or nucleotide sequences. <ext-link ext-link-type="uri" xlink:href="https://mafft.cbrc.jp/alignment/software/addsequences.html">https://mafft.cbrc.jp/alignment/software/addsequences.html</ext-link>. Accessed 20 May 2022.</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Smirnov</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>MAGUS: Multiple sequence Alignment using Graph clUStering</article-title>
        <source>Bioinformatics</source>
        <year>2021</year>
        <volume>37</volume>
        <issue>12</issue>
        <fpage>1666</fpage>
        <lpage>1672</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa992</pub-id>
        <?supplied-pmid 33252662?>
        <pub-id pub-id-type="pmid">33252662</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Nguyen</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>L-S</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>PASTA: ultra-large multiple sequence alignment for nucleotide and amino-acid sequences</article-title>
        <source>J Comput Biol</source>
        <year>2015</year>
        <volume>22</volume>
        <issue>5</issue>
        <fpage>377</fpage>
        <lpage>386</lpage>
        <pub-id pub-id-type="doi">10.1089/cmb.2014.0156</pub-id>
        <?supplied-pmid 25549288?>
        <pub-id pub-id-type="pmid">25549288</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Price</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Dehal</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Arkin</surname>
            <given-names>AP</given-names>
          </name>
        </person-group>
        <article-title>FastTree 2—approximately maximum-likelihood trees for large alignments</article-title>
        <source>PLoS ONE</source>
        <year>2010</year>
        <volume>5</volume>
        <issue>3</issue>
        <fpage>9490</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0009490</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mirarab</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>FASTSP: linear time calculation of alignment accuracy</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <issue>23</issue>
        <fpage>3250</fpage>
        <lpage>3258</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr553</pub-id>
        <?supplied-pmid 21984754?>
        <pub-id pub-id-type="pmid">21984754</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Raghavan</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Nelesen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Linder</surname>
            <given-names>CR</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Rapid and accurate large-scale coestimation of sequence alignments and phylogenetic trees</article-title>
        <source>Science</source>
        <year>2009</year>
        <volume>324</volume>
        <issue>5934</issue>
        <fpage>1561</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1171243</pub-id>
        <?supplied-pmid 19541996?>
        <pub-id pub-id-type="pmid">19541996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cannone</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Subramanian</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Schnare</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Collett</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>D’Souza</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Du</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Madabusi</surname>
            <given-names>LV</given-names>
          </name>
          <name>
            <surname>Müller</surname>
            <given-names>KM</given-names>
          </name>
          <name>
            <surname>Pande</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Shang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Gutell</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <article-title>The Comparative RNA Web (CRW) Site: an online database of comparative sequence and structure information for ribosomal, intron, and other RNAs</article-title>
        <source>BMC Bioinform</source>
        <year>2002</year>
        <volume>3</volume>
        <issue>1</issue>
        <fpage>2</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-3-2</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fletcher</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <article-title>INDELible: a flexible simulator of biological sequence evolution</article-title>
        <source>Mol Biol Evol</source>
        <year>2009</year>
        <volume>26</volume>
        <issue>8</issue>
        <fpage>1879</fpage>
        <lpage>1888</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msp098</pub-id>
        <?supplied-pmid 19423664?>
        <pub-id pub-id-type="pmid">19423664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stoye</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Evers</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Rose: generating sequence families</article-title>
        <source>Bioinformatics (Oxford, England)</source>
        <year>1998</year>
        <volume>14</volume>
        <issue>2</issue>
        <fpage>157</fpage>
        <lpage>163</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/14.2.157</pub-id>
        <?supplied-pmid 9545448?>
        <pub-id pub-id-type="pmid">9545448</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Zaharias</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>MAGUS+eHMMs: improved multiple sequence alignment accuracy for fragmentary sequences</article-title>
        <source>Bioinformatics</source>
        <year>2022</year>
        <volume>38</volume>
        <issue>4</issue>
        <fpage>918</fpage>
        <lpage>924</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btab788</pub-id>
        <?supplied-pmid 34791036?>
        <pub-id pub-id-type="pmid">34791036</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Collins</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>PASTA for proteins</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>34</volume>
        <issue>22</issue>
        <fpage>3939</fpage>
        <lpage>3941</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty495</pub-id>
        <?supplied-pmid 29931282?>
        <pub-id pub-id-type="pmid">29931282</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thompson</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Linard</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Lecompte</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Poch</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>A comprehensive benchmark study of multiple sequence alignment methods: current challenges and future perspectives</article-title>
        <source>PLoS ONE</source>
        <year>2011</year>
        <volume>6</volume>
        <issue>3</issue>
        <fpage>18093</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0018093</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gloor</surname>
            <given-names>GB</given-names>
          </name>
          <name>
            <surname>Martin</surname>
            <given-names>LC</given-names>
          </name>
          <name>
            <surname>Wahl</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Dunn</surname>
            <given-names>SD</given-names>
          </name>
        </person-group>
        <article-title>Mutual information in protein multiple sequence alignments reveals two classes of coevolving positions</article-title>
        <source>Biochemistry</source>
        <year>2005</year>
        <volume>44</volume>
        <issue>19</issue>
        <fpage>7156</fpage>
        <lpage>65</lpage>
        <pub-id pub-id-type="doi">10.1021/bi050293e</pub-id>
        <?supplied-pmid 15882054?>
        <pub-id pub-id-type="pmid">15882054</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyatt</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>G-L</given-names>
          </name>
          <name>
            <surname>LoCascio</surname>
            <given-names>PF</given-names>
          </name>
          <name>
            <surname>Land</surname>
            <given-names>ML</given-names>
          </name>
          <name>
            <surname>Larimer</surname>
            <given-names>FW</given-names>
          </name>
          <name>
            <surname>Hauser</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Prodigal: prokaryotic gene recognition and translation initiation site identification</article-title>
        <source>BMC Bioinform</source>
        <year>2010</year>
        <volume>11</volume>
        <issue>1</issue>
        <fpage>119</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mistry</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chuguransky</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Qureshi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Salazar</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Sonnhammer</surname>
            <given-names>ELL</given-names>
          </name>
          <name>
            <surname>Tosatto</surname>
            <given-names>SCE</given-names>
          </name>
          <name>
            <surname>Paladin</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Raj</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Richardson</surname>
            <given-names>LJ</given-names>
          </name>
          <name>
            <surname>Finn</surname>
            <given-names>RD</given-names>
          </name>
          <name>
            <surname>Bateman</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Pfam: The protein families database in 2021</article-title>
        <source>Nucleic Acids Res</source>
        <year>2021</year>
        <volume>49</volume>
        <issue>D1</issue>
        <fpage>412</fpage>
        <lpage>419</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkaa913</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sievers</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Wilm</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Dineen</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gibson</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Karplus</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>McWilliam</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Remmert</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Söding</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, scalable generation of high-quality protein multiple sequence alignments using Clustal Omega</article-title>
        <source>Mol Syst Biol</source>
        <year>2011</year>
        <volume>7</volume>
        <issue>1</issue>
        <fpage>539</fpage>
        <pub-id pub-id-type="doi">10.1038/msb.2011.75</pub-id>
        <?supplied-pmid 21988835?>
        <pub-id pub-id-type="pmid">21988835</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Warnow</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Holder</surname>
            <given-names>MT</given-names>
          </name>
          <name>
            <surname>Nelesen</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Stamatakis</surname>
            <given-names>AP</given-names>
          </name>
          <name>
            <surname>Linder</surname>
            <given-names>CR</given-names>
          </name>
        </person-group>
        <article-title>SATé-II: very fast and accurate simultaneous estimation of multiple sequence alignments and phylogenetic trees</article-title>
        <source>Syst Biol</source>
        <year>2011</year>
        <volume>61</volume>
        <issue>1</issue>
        <fpage>90</fpage>
        <lpage>90</lpage>
        <pub-id pub-id-type="doi">10.1093/sysbio/syr095</pub-id>
        <?supplied-pmid 22139466?>
        <pub-id pub-id-type="pmid">22139466</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
