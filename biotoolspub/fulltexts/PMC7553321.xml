<?properties open_access?>
<?subarticle pcbi.1008240.r001?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS Comput Biol</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">ploscomp</journal-id>
    <journal-title-group>
      <journal-title>PLoS Computational Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1553-734X</issn>
    <issn pub-type="epub">1553-7358</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7553321</article-id>
    <article-id pub-id-type="pmid">33001973</article-id>
    <article-id pub-id-type="publisher-id">PCOMPBIOL-D-20-00693</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1008240</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Evolutionary Biology</subject>
          <subj-group>
            <subject>Evolutionary Systematics</subject>
            <subj-group>
              <subject>Phylogenetics</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Taxonomy</subject>
          <subj-group>
            <subject>Evolutionary Systematics</subject>
            <subj-group>
              <subject>Phylogenetics</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Data Management</subject>
          <subj-group>
            <subject>Taxonomy</subject>
            <subj-group>
              <subject>Evolutionary Systematics</subject>
              <subj-group>
                <subject>Phylogenetics</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Molecular Biology</subject>
          <subj-group>
            <subject>Molecular Biology Techniques</subject>
            <subj-group>
              <subject>Cloning</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Molecular Biology Techniques</subject>
          <subj-group>
            <subject>Cloning</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Surgical and Invasive Medical Procedures</subject>
          <subj-group>
            <subject>Biopsy</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Oncology</subject>
          <subj-group>
            <subject>Cancers and Neoplasms</subject>
            <subj-group>
              <subject>Lung and Intrathoracic Tumors</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Evolutionary Biology</subject>
          <subj-group>
            <subject>Evolutionary Systematics</subject>
            <subj-group>
              <subject>Phylogenetics</subject>
              <subj-group>
                <subject>Phylogenetic Analysis</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Taxonomy</subject>
          <subj-group>
            <subject>Evolutionary Systematics</subject>
            <subj-group>
              <subject>Phylogenetics</subject>
              <subj-group>
                <subject>Phylogenetic Analysis</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Computer and Information Sciences</subject>
        <subj-group>
          <subject>Data Management</subject>
          <subj-group>
            <subject>Taxonomy</subject>
            <subj-group>
              <subject>Evolutionary Systematics</subject>
              <subj-group>
                <subject>Phylogenetics</subject>
                <subj-group>
                  <subject>Phylogenetic Analysis</subject>
                </subj-group>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Oncology</subject>
          <subj-group>
            <subject>Cancers and Neoplasms</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Oncology</subject>
          <subj-group>
            <subject>Cancers and Neoplasms</subject>
            <subj-group>
              <subject>Malignant Tumors</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Molecular biology</subject>
          <subj-group>
            <subject>Molecular biology techniques</subject>
            <subj-group>
              <subject>Sequencing techniques</subject>
              <subj-group>
                <subject>DNA sequencing</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and analysis methods</subject>
        <subj-group>
          <subject>Molecular biology techniques</subject>
          <subj-group>
            <subject>Sequencing techniques</subject>
            <subj-group>
              <subject>DNA sequencing</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>PhyDOSE: Design of follow-up single-cell sequencing experiments of tumors</article-title>
      <alt-title alt-title-type="running-head">Designing follow-up single-cell sequencing experiment</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Weber</surname>
          <given-names>Leah L.</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Investigation</role>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Visualization</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Aguse</surname>
          <given-names>Nuraini</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Investigation</role>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Visualization</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9652-691X</contrib-id>
        <name>
          <surname>Chia</surname>
          <given-names>Nicholas</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Funding acquisition</role>
        <role content-type="https://casrai.org/credit/">Validation</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1468-2407</contrib-id>
        <name>
          <surname>El-Kebir</surname>
          <given-names>Mohammed</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Conceptualization</role>
        <role content-type="https://casrai.org/credit/">Funding acquisition</role>
        <role content-type="https://casrai.org/credit/">Investigation</role>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <role content-type="https://casrai.org/credit/">Project administration</role>
        <role content-type="https://casrai.org/credit/">Resources</role>
        <role content-type="https://casrai.org/credit/">Supervision</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Dept. of Computer Science, University of Illinois at Urbana-Champaign, Urbana, Illinois, United States of America</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Microbiome Program, Center for Individualized Medicine, Mayo Clinic, Rochester, Minnesota, United States of America</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Division of Surgical Research, Department of Surgery, Mayo Clinic, Rochester, Minnesota, United States of America</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Nagarajan</surname>
          <given-names>Niranjan</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Genome Institute of Singapore, UNITED STATES</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>melkebir@illinois.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>10</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>1</day>
      <month>10</month>
      <year>2020</year>
    </pub-date>
    <volume>16</volume>
    <issue>10</issue>
    <elocation-id>e1008240</elocation-id>
    <history>
      <date date-type="received">
        <day>26</day>
        <month>4</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>12</day>
        <month>8</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2020 Weber et al</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>Weber et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pcbi.1008240.pdf"/>
    <abstract>
      <p>The combination of bulk and single-cell DNA sequencing data of the same tumor enables the inference of high-fidelity phylogenies that form the input to many important downstream analyses in cancer genomics. While many studies simultaneously perform bulk and single-cell sequencing, some studies have analyzed initial bulk data to identify which mutations to target in a follow-up single-cell sequencing experiment, thereby decreasing cost. Bulk data provide an additional untapped source of valuable information, composed of candidate phylogenies and associated clonal prevalence. Here, we introduce PhyDOSE, a method that uses this information to strategically optimize the design of follow-up single cell experiments. Underpinning our method is the observation that only a small number of clones uniquely distinguish one candidate tree from all other trees. We incorporate distinguishing features into a probabilistic model that infers the number of cells to sequence so as to confidently reconstruct the phylogeny of the tumor. We validate PhyDOSE using simulations and a retrospective analysis of a leukemia patient, concluding that PhyDOSE’s computed number of cells resolves tree ambiguity even in the presence of typical single-cell sequencing errors. We also conduct a retrospective analysis on an acute myeloid leukemia cohort, demonstrating the potential to achieve similar results with a significant reduction in the number of cells sequenced. In a prospective analysis, we demonstrate the advantage of selecting cells to sequence across multiple biopsies and that only a small number of cells suffice to disambiguate the solution space of trees in a recent lung cancer cohort. In summary, PhyDOSE proposes cost-efficient single-cell sequencing experiments that yield high-fidelity phylogenies, which will improve downstream analyses aimed at deepening our understanding of cancer biology.</p>
    </abstract>
    <abstract abstract-type="summary">
      <title>Author summary</title>
      <p>Cancer development in a patient can be explained using a phylogeny—a tree that describes the evolutionary history of a tumor and has therapeutic implications. A tumor phylogeny is constructed from sequencing data, commonly obtained using either bulk or single-cell DNA sequencing technology. The accuracy of tumor phylogeny inference increases when both types of data are used, but single-cell sequencing may become prohibitively costly with increasing number of cells. Here, we propose a method that uses bulk sequencing data to guide the design of a follow-up single-cell sequencing experiment. Our results suggest that PhyDOSE provides a significant decrease in the number of cells to sequence compared to the number of cells sequenced in existing studies. The ability to make informed decisions based on prior data can help reduce the cost of follow-up single cell sequencing experiments of tumors, improving accuracy of tumor phylogeny inference and ultimately getting us closer to understanding and treating cancer.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution>National Science Foundation (US)</institution>
        </funding-source>
        <award-id>CCF 1850502</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1468-2407</contrib-id>
          <name>
            <surname>El-Kebir</surname>
            <given-names>Mohammed</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award002">
        <funding-source>
          <institution>UIUC Center for Computational Biotechnology and Genomic Medicine</institution>
        </funding-source>
        <award-id>CSN 1624790</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1468-2407</contrib-id>
          <name>
            <surname>El-Kebir</surname>
            <given-names>Mohammed</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <funding-statement>L.L.W., N.A., N.C. and M.E.K. were supported by UIUC Center for Computational Biotechnology and Genomic Medicine (grant: CSN 1624790). M.E.K. was supported by the National Science Foundation (grant: CCF 1850502). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="6"/>
      <table-count count="1"/>
      <page-count count="22"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>PLOS Publication Stage</meta-name>
        <meta-value>vor-update-to-uncorrected-proof</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>Publication Update</meta-name>
        <meta-value>2020-10-13</meta-value>
      </custom-meta>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>Simulated and real data are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/elkebir-group/PhyDOSE">https://github.com/elkebir-group/PhyDOSE</ext-link>. Source code and R package are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/elkebir-group/phydoser">https://github.com/elkebir-group/phydoser</ext-link> (under AGPL-3.0 license).</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>Simulated and real data are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/elkebir-group/PhyDOSE">https://github.com/elkebir-group/PhyDOSE</ext-link>. Source code and R package are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/elkebir-group/phydoser">https://github.com/elkebir-group/phydoser</ext-link> (under AGPL-3.0 license).</p>
  </notes>
</front>
<body>
  <disp-quote>
    <p>This is a <italic>PLOS Computational Biology</italic> Methods paper.</p>
  </disp-quote>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>Tumorigenesis follows an evolutionary process during which cells gain and accumulate somatic mutations that lead to cancer [<xref rid="pcbi.1008240.ref001" ref-type="bibr">1</xref>]. The most natural expression of an evolutionary process is a <italic>phylogeny</italic>—a tree that describes the order and branching points of events in the history of a cellular population. Tumor phylogenies are critical to understanding and ultimately treating cancer, with recent studies using tumor phylogenies to identify mutations that drive cancer progression [<xref rid="pcbi.1008240.ref002" ref-type="bibr">2</xref>, <xref rid="pcbi.1008240.ref003" ref-type="bibr">3</xref>], assess the interplay between the immune system and the clonal architecture of a tumor [<xref rid="pcbi.1008240.ref004" ref-type="bibr">4</xref>, <xref rid="pcbi.1008240.ref005" ref-type="bibr">5</xref>], and identify common evolutionary patterns in tumorigenesis and metastasis [<xref rid="pcbi.1008240.ref006" ref-type="bibr">6</xref>, <xref rid="pcbi.1008240.ref007" ref-type="bibr">7</xref>]. These downstream analyses critically rely on accurate phylogenies that are inferred from sequencing data of a tumor.</p>
    <p>The majority of current cancer genomics data consist of pairs of matched normal and tumor samples that have undergone bulk DNA sequencing. Bulk data is composed of sequences from cells with distinct genomes. More specifically, we observe frequencies <bold>f</bold> = [<italic>f</italic><sub><italic>i</italic></sub>] for the set of somatic mutations in the tumor (<xref ref-type="fig" rid="pcbi.1008240.g001">Fig 1A</xref>). Many deconvolution methods have been proposed for tumor phylogeny inference from such data [<xref rid="pcbi.1008240.ref008" ref-type="bibr">8</xref>–<xref rid="pcbi.1008240.ref013" ref-type="bibr">13</xref>], typically inferring a set <inline-formula id="pcbi.1008240.e001"><alternatives><graphic xlink:href="pcbi.1008240.e001.jpg" id="pcbi.1008240.e001g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M1"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of equally plausible trees (<xref ref-type="fig" rid="pcbi.1008240.g001">Fig 1B</xref>). These approaches are unsatisfactory, as candidate trees with different topologies may alter conclusions in downstream analyses. Single-cell sequencing (SCS), as opposed to bulk sequencing, enables us to observe specific clones present within the tumor. These clones correspond to the leaves of the true phylogeny, allowing phylogeny inference methods to reconstruct the tree itself once we observe all clones in the tumor [<xref rid="pcbi.1008240.ref014" ref-type="bibr">14</xref>–<xref rid="pcbi.1008240.ref017" ref-type="bibr">17</xref>]. However, the elevated error rates of SCS, as well as its high cost [<xref rid="pcbi.1008240.ref018" ref-type="bibr">18</xref>], make it prohibitive as a standalone method for phylogeny inference. As such, hybrid methods have been recently proposed to infer high-fidelity phylogenies from combined bulk and SCS data obtained from the same tumor [<xref rid="pcbi.1008240.ref019" ref-type="bibr">19</xref>, <xref rid="pcbi.1008240.ref020" ref-type="bibr">20</xref>]. Furthermore, without a rigorous framework to determine the number of single-cells to sequence, this decision is currently guided by budget constraints or arbitrarily determined by exogenous factors, such as thresholds for a sequencing run. This could result in excessive costs by sequencing too many cells or sunk costs associated with an unsuccessful experiment when an insufficient number of cells are sequenced.</p>
    <fig id="pcbi.1008240.g001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1008240.g001</object-id>
      <label>Fig 1</label>
      <caption>
        <title>PhyDOSE computes the number of single cells to sequence to identify the true phylogeny.</title>
        <p>(A) Mutation frequencies <bold>f</bold> obtained from bulk DNA sequencing data. (B) The solution space <inline-formula id="pcbi.1008240.e002"><alternatives><graphic id="pcbi.1008240.e002g" xlink:href="pcbi.1008240.e002"/><mml:math id="M2"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of trees inferred from <bold>f</bold>. We show a distinguishing feature of <italic>T</italic><sub>1</sub> (orange and green). (C) For tree <italic>T</italic><sub>1</sub>, PhyDOSE suggests that <italic>k</italic> = 2 single cells suffice to observe clones that are unique to <italic>T</italic><sub>1</sub>. (D) In a follow-up SCS experiment we observe <italic>k</italic> = 2 cells, one from the orange clone and one from the green clone. As such, we eliminate trees <italic>T</italic><sub>2</sub> and <italic>T</italic><sub>3</sub>, concluding that phylogeny <italic>T</italic><sub>1</sub> is the true phylogeny <italic>T</italic>*.</p>
      </caption>
      <graphic xlink:href="pcbi.1008240.g001"/>
    </fig>
    <p>Several hybrid datasets have been obtained by performing bulk and single-cell DNA sequencing simultaneously [<xref rid="pcbi.1008240.ref021" ref-type="bibr">21</xref>, <xref rid="pcbi.1008240.ref022" ref-type="bibr">22</xref>]. However, there is merit in first performing bulk sequencing to guide follow-up SCS experiments. For instance, several studies first identified a subset of single-nucleotide variants from the bulk data to target in subsequent SCS experiments, thereby reducing costs compared to conventional whole-genome SCS approaches [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>–<xref rid="pcbi.1008240.ref025" ref-type="bibr">25</xref>]. A recently introduced method, SCOPIT, computes how many cells are needed to observe all clones of a tumor, given estimates on the smallest prevalence of a clone as well as the number of clones with that smallest prevalence to detect [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>]. The authors provide no guidance on how to obtain these two quantities. Here, we build upon this work by directly incorporating knowledge encoded by the trees <inline-formula id="pcbi.1008240.e003"><alternatives><graphic xlink:href="pcbi.1008240.e003.jpg" id="pcbi.1008240.e003g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M3"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> inferred from the initial bulk sequencing data. Indeed, by using data from an SCS experiment we may eliminate trees from <inline-formula id="pcbi.1008240.e004"><alternatives><graphic xlink:href="pcbi.1008240.e004.jpg" id="pcbi.1008240.e004g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M4"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> that do not align with the observed clones (<xref ref-type="fig" rid="pcbi.1008240.g001">Fig 1</xref>). In other words, if we observe all clones in a tumor, it is possible to determine the phylogeny of the tumor. However, is it possible to achieve the same goal by observing fewer clones? If so, how many cells are necessary for us to observe the required clones?</p>
    <p>We introduce <underline>Phy</underline>logenetic <underline>D</underline>esign <underline>O</underline>f <underline>S</underline>ingle-cell sequencing <underline>E</underline>xperiments (PhyDOSE), a method to strategically design a follow-up SCS experiment aimed at inferring the true phylogeny (<xref ref-type="fig" rid="pcbi.1008240.g001">Fig 1</xref>). Given a set <inline-formula id="pcbi.1008240.e005"><alternatives><graphic xlink:href="pcbi.1008240.e005.jpg" id="pcbi.1008240.e005g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M5"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of candidate trees inferred from initial bulk data, we describe how to distinguish a single tree <italic>T</italic> among the rest using features unique to <italic>T</italic>. In particular, if our SCS experiment results in observing cells corresponding to a distinguishing feature of <italic>T</italic>, we may conclude that <italic>T</italic> is in fact the true tree. This means that we can typically identify <italic>T</italic> using only a subset of the clones. To determine the number of cells to sequence, we introduce a probabilistic model that incorporates SCS errors and models successful SCS experiments as a tail probability of a multinomial distribution (<xref ref-type="fig" rid="pcbi.1008240.g001">Fig 1D</xref>). Finally, we reconcile the sampled cells utilizing these distinguishing features to infer the true phylogeny (<xref ref-type="fig" rid="pcbi.1008240.g001">Fig 1D</xref>) and provide heuristics for considering uncertainty in frequency estimates and determining the number of cells to sequence across multiple available biopsies. We validate PhyDOSE using both simulated data and a retrospective analysis of a leukemia patient that has undergone both bulk and SCS sequencing. We also demonstrate the utility of PhyDOSE by prospectively computing how many cells are needed to resolve the uncertainty in phylogenies of a recent acute myeloid leukemia cohort [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>] and lung cancer cohort [<xref rid="pcbi.1008240.ref003" ref-type="bibr">3</xref>]. The cost-efficient SCS experiments enabled by PhyDOSE will yield high-fidelity phylogenies, improving downstream analyses aimed at understanding tumorigenesis and developing treatment plans.</p>
  </sec>
  <sec sec-type="materials|methods" id="sec002">
    <title>Materials and methods</title>
    <p>We introduce <underline>Phy</underline>logenetic <underline>D</underline>esign <underline>O</underline>f <underline>S</underline>ingle-cell sequencing <underline>E</underline>xperiments (PhyDOSE), a method to determine the number of single cells to sequence to identify the true phylogeny given initial bulk sequencing data. PhyDOSE is implemented in C++/R and is available as an R package at <ext-link ext-link-type="uri" xlink:href="https://github.com/elkebir-group/phydoser">https://github.com/elkebir-group/phydoser</ext-link>. This section describes the various methodological components of PhyDOSE.</p>
    <sec id="sec003">
      <title>Problem statement</title>
      <p>Let <italic>n</italic> be the number of single-nucleotide variants, or simply <italic>mutations</italic>, identified from initial bulk sequencing data of a matched normal and tumor biopsy sample. For each mutation <italic>i</italic>, we observe the <italic>variant allele frequency</italic> (VAF), i.e. the fraction of aligned reads that harbor the tumor allele at the locus of mutation <italic>i</italic>. Specialized methods exist that combine copy number information and VAFs to infer a <italic>cancer cell fraction</italic>
<italic>f</italic><sub><italic>i</italic></sub> for each mutation <italic>i</italic>, which is the proportion of cells in the tumor biopsy that contain at least one copy of the mutation [<xref rid="pcbi.1008240.ref003" ref-type="bibr">3</xref>, <xref rid="pcbi.1008240.ref028" ref-type="bibr">28</xref>–<xref rid="pcbi.1008240.ref030" ref-type="bibr">30</xref>]. Here, we refer to cancer cell fractions as <italic>frequencies</italic>. Typically, phylogenies <inline-formula id="pcbi.1008240.e006"><alternatives><graphic xlink:href="pcbi.1008240.e006.jpg" id="pcbi.1008240.e006g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M6"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> inferred by current methods from frequencies <bold>f</bold> = [<italic>f</italic><sub><italic>i</italic></sub>] adhere to the infinite sites assumption. That is, each mutation <italic>i</italic> is introduced exactly once at vertex <italic>v</italic><sub><italic>i</italic></sub> and never subsequently lost.</p>
      <p>When we sequence a single cell from the same tumor biopsy, assuming no errors, we identify a clone of the tumor. In other words, we observe a set of mutations that must form a connected path in the unknown true phylogeny <italic>T</italic>*. By repeatedly sequencing single cells until we observe all clones in the tumor, we will have observed all root-to-vertex paths of <italic>T</italic>*, thus identifying tree <italic>T</italic>* itself. We assume that (i) the true unknown phylogeny <italic>T</italic>* is among the trees in <inline-formula id="pcbi.1008240.e007"><alternatives><graphic xlink:href="pcbi.1008240.e007.jpg" id="pcbi.1008240.e007g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M7"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> and that (ii) mutations among single cells that we sample from the tumor biopsy follow the same distribution as <bold>f</bold>. These assumptions are important for the mathematical derivation of PhyDOSE but it is typical for violations to occur in practice. Through simulations, we explore the impact of violating these assumptions and show that our approach is robust to many realistic scenarios.</p>
      <p>This leads to the following question and problem statement with respect to these two assumptions. How many single cells do we need to identify <italic>T</italic>* with confidence level <italic>γ</italic>?</p>
      <p><bold>Problem 1</bold> (<sc>SCS Power Calculation</sc> (<sc>SCS-PC</sc>)). Given a set <inline-formula id="pcbi.1008240.e008"><alternatives><graphic xlink:href="pcbi.1008240.e008.jpg" id="pcbi.1008240.e008g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M8"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of candidate phylogenies, frequencies <bold>f</bold> and confidence level <italic>γ</italic>, find the minimum number <italic>k</italic>* of single cells needed to determine the true phylogeny <italic>T</italic>* among <inline-formula id="pcbi.1008240.e009"><alternatives><graphic xlink:href="pcbi.1008240.e009.jpg" id="pcbi.1008240.e009g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M9"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> with probability at least <italic>γ</italic>.</p>
      <p>Clearly, we do not know which phylogeny in <inline-formula id="pcbi.1008240.e010"><alternatives><graphic xlink:href="pcbi.1008240.e010.jpg" id="pcbi.1008240.e010g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M10"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> is the true underlying phylogeny <italic>T</italic>* of the tumor. Thus, we consider a slightly different problem: In the <italic>T</italic>-<sc>SCS-PC</sc> problem (defined formally at the end of the section), we are given an arbitrary phylogeny <inline-formula id="pcbi.1008240.e011"><alternatives><graphic xlink:href="pcbi.1008240.e011.jpg" id="pcbi.1008240.e011g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M11"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> and want to perform a similar power calculation when conditioning on <italic>T</italic> being the true phylogeny. By solving the <italic>T</italic>-<sc>SCS-PC</sc> problem for all trees <inline-formula id="pcbi.1008240.e012"><alternatives><graphic xlink:href="pcbi.1008240.e012.jpg" id="pcbi.1008240.e012g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M12"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, we obtain the numbers <inline-formula id="pcbi.1008240.e013"><alternatives><graphic xlink:href="pcbi.1008240.e013.jpg" id="pcbi.1008240.e013g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M13"><mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> of single cells needed for each tree. As <italic>T</italic>* is in <inline-formula id="pcbi.1008240.e014"><alternatives><graphic xlink:href="pcbi.1008240.e014.jpg" id="pcbi.1008240.e014g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M14"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula>, the maximum number among <inline-formula id="pcbi.1008240.e015"><alternatives><graphic xlink:href="pcbi.1008240.e015.jpg" id="pcbi.1008240.e015g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M15"><mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> is an upper bound on the number of required SCS experiments to identify <italic>T</italic>* with probability at least <italic>γ</italic>. To solve the <italic>T</italic>-<sc>SCS-PC</sc> problem, we need to reason for which SCS experiments we can conclude that <italic>T</italic> is the true phylogeny.</p>
      <p>Observe that each tree <italic>T</italic> in <inline-formula id="pcbi.1008240.e016"><alternatives><graphic xlink:href="pcbi.1008240.e016.jpg" id="pcbi.1008240.e016g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M16"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> describes a unique set of clones, corresponding to the sets of mutations encountered in all root-to-vertex paths of <italic>T</italic> (<xref ref-type="fig" rid="pcbi.1008240.g001">Fig 1</xref>). Thus, if we observe all clones of a phylogeny <italic>T</italic> in our SCS experiments, we may conclude that <italic>T</italic> is the true phylogeny. What is the probability of doing so? To answer this question, we must compute the prevalence of each clone in the tumor biopsy.</p>
      <p>For phylogenies that adhere to the infinite sites assumption, the <italic>prevalence</italic>
<bold>u</bold>(<italic>T</italic>, <bold>f</bold>) = [<italic>u</italic><sub><italic>i</italic></sub>] of the clones in the tumor biopsy are uniquely determined by the phylogeny <italic>T</italic> and frequencies <bold>f</bold> as
<disp-formula id="pcbi.1008240.e017"><alternatives><graphic xlink:href="pcbi.1008240.e017.jpg" id="pcbi.1008240.e017g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M17"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msub><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mtd><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>∀</mml:mo><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mo>[</mml:mo><mml:mi>n</mml:mi><mml:mo>]</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1)</label></disp-formula>
where <italic>δ</italic><sub><italic>T</italic></sub>(<italic>i</italic>) is the set of children of the node where mutation <italic>i</italic> was introduced [<xref rid="pcbi.1008240.ref009" ref-type="bibr">9</xref>].</p>
      <p>Tumor phylogeny inference methods guarantee that the inferred phylogenies <inline-formula id="pcbi.1008240.e018"><alternatives><graphic xlink:href="pcbi.1008240.e018.jpg" id="pcbi.1008240.e018g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M18"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> from frequencies <bold>f</bold> have clonal prevalence <bold>u</bold>(<italic>T</italic>, <bold>f</bold>) = [<italic>u</italic><sub><italic>i</italic></sub>] that are nonnegative and that <inline-formula id="pcbi.1008240.e019"><alternatives><graphic xlink:href="pcbi.1008240.e019.jpg" id="pcbi.1008240.e019g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M19"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, where the remainder <inline-formula id="pcbi.1008240.e020"><alternatives><graphic xlink:href="pcbi.1008240.e020.jpg" id="pcbi.1008240.e020g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M20"><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is the prevalence of the normal clone. Thus, conditioning on a phylogeny <italic>T</italic> and frequencies <bold>f</bold>, sequencing one cell from the tumor will lead us to observe one of the <italic>n</italic> + 1 clones of <italic>T</italic> with probabilities (<italic>u</italic><sub>0</sub>, …, <italic>u</italic><sub><italic>n</italic></sub>). In other words, the outcome of this SCS experiment with one cell is a draw from the categorical distribution Cat(<italic>u</italic><sub>0</sub>, …, <italic>u</italic><sub><italic>n</italic></sub>). The possible outcomes of an SCS experiment composed of <italic>k</italic> cells thus follow a multinomial distribution Mult(<italic>u</italic><sub>0</sub>, …, <italic>u</italic><sub><italic>n</italic></sub>). Thus, the probability of observing all tumor clones of <italic>T</italic> in such an SCS experiment with <italic>k</italic> cells corresponds to the tail probability of the multinomial where each of the <italic>n</italic> tumor clones is observed at least once.</p>
      <p>The corresponding <italic>power calculation</italic> is to determine the smallest number for <italic>k</italic> where the tail probability is greater or equal to the confidence level <italic>γ</italic>. Note that this power calculation for observing all clones has been previously introduced [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>].</p>
      <p>Importantly, in many cases we need not observe all clones of <italic>T</italic> to distinguish <italic>T</italic> from the remaining phylogenies <inline-formula id="pcbi.1008240.e021"><alternatives><graphic xlink:href="pcbi.1008240.e021.jpg" id="pcbi.1008240.e021g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M21"><mml:mrow><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> (<xref ref-type="fig" rid="pcbi.1008240.g002">Fig 2</xref>). This means that we may conclude that <italic>T</italic> is the true phylogeny with an SCS experiment with fewer cells. To formalize this notion, we start by defining a featurette.</p>
      <fig id="pcbi.1008240.g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008240.g002</object-id>
        <label>Fig 2</label>
        <caption>
          <title>The SCS power calculation for phylogeny <italic>T</italic> (<italic>T</italic>-SCS-PC) problem.</title>
          <p>(A) We are given frequencies <bold>f</bold> and a tree <italic>T</italic><sub>1</sub> that we want to distinguish from the other trees {<italic>T</italic><sub>2</sub>, <italic>T</italic><sub>3</sub>}. The pair (<italic>T</italic><sub>1</sub>, <bold>f</bold>) uniquely determine clonal prevalence <bold>u</bold>(<italic>T</italic><sub>1</sub>, <bold>f</bold>). (B) Featurettes of <italic>T</italic><sub>1</sub> correspond to root-to-vertex paths, yielding distinguishing features <italic>Π</italic><sub>1</sub> and <italic>Π</italic><sub>2</sub>, each with one featurette absent in <italic>T</italic><sub>2</sub> and another absent in <italic>T</italic><sub>3</sub>. (C) With <italic>k</italic> = 2 cells, we must observe clones from either <italic>Π</italic><sub>1</sub> or <italic>Π</italic><sub>2</sub> for a successful outcome, resulting in probability Pr(<italic>Y</italic><sub>2</sub>∣<bold>u</bold>(<italic>T</italic><sub>1</sub>, <bold>f</bold>)) ≈ 0.12. (d) To increase this probability to <italic>γ</italic> = 0.95, we need <italic>k</italic>* = 32 cells.</p>
        </caption>
        <graphic xlink:href="pcbi.1008240.g002"/>
      </fig>
      <p><bold>Definition 1</bold>. A <italic>featurette</italic><italic>τ</italic> is a subset of mutations.</p>
      <p>We say that a featurette <italic>τ</italic> is <italic>present</italic> in a phylogeny <italic>T</italic> if the nodes/mutations of <italic>τ</italic> form a connected path of <italic>T</italic> starting at the root node, otherwise we say that <italic>τ</italic> is <italic>absent</italic> in <italic>T</italic>. The same featurette, however, may be present in more that one phylogeny. Thus, multiple featurettes may be required to distinguish a phylogeny <italic>T</italic> from the remaining phylogenies <inline-formula id="pcbi.1008240.e022"><alternatives><graphic xlink:href="pcbi.1008240.e022.jpg" id="pcbi.1008240.e022g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M22"><mml:mrow><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</p>
      <p><bold>Definition 2</bold>. A set <italic>Π</italic> of featurettes is a <italic>distinguishing feature of T</italic> if (i) for all featurettes <italic>τ</italic> ∈ <italic>Π</italic> it holds that <italic>τ</italic> is present in <italic>T</italic>, and (ii) for each remaining phylogeny <inline-formula id="pcbi.1008240.e023"><alternatives><graphic xlink:href="pcbi.1008240.e023.jpg" id="pcbi.1008240.e023g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M23"><mml:mrow><mml:msup><mml:mi>T</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> there exists a featurette <italic>τ</italic>′ ∈ <italic>Π</italic> where <italic>τ</italic>′ is absent in <italic>T</italic>′.</p>
      <p>Thus, an SCS experiment where we observe one cell from each clone of a distinguishing feature <italic>Π</italic> of <italic>T</italic> enables us to conclude that phylogeny <italic>T</italic> is the true phylogeny. As discussed, every phylogeny <italic>T</italic> has a <italic>trivial distinguishing feature</italic>, which is composed of all featurettes present in <italic>T</italic>. Moreover, <italic>T</italic> may have multiple distinguishing features. Therefore, we must consider the complete set of all distinguishing features, which we call the distinguishing feature family.</p>
      <p><bold>Definition 3</bold>. The set <inline-formula id="pcbi.1008240.e024"><alternatives><graphic xlink:href="pcbi.1008240.e024.jpg" id="pcbi.1008240.e024g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M24"><mml:mrow><mml:mo>Φ</mml:mo><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> composed of all distinguishing features of <italic>T</italic> with respect to <inline-formula id="pcbi.1008240.e025"><alternatives><graphic xlink:href="pcbi.1008240.e025.jpg" id="pcbi.1008240.e025g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M25"><mml:mrow><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is a <italic>distinguishing feature family of T</italic>.</p>
      <p>Let (<italic>c</italic><sub>0</sub>, …, <italic>c</italic><sub><italic>n</italic></sub>) be the outcome of an SCS experiment of <italic>k</italic> cells, where <italic>c</italic><sub><italic>i</italic></sub> ≥ 0 is the number of cells observed of clone <italic>i</italic> and <inline-formula id="pcbi.1008240.e026"><alternatives><graphic xlink:href="pcbi.1008240.e026.jpg" id="pcbi.1008240.e026g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M26"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. This experiment is <italic>successful</italic> if, among the <italic>k</italic> sequenced cells, we observe the clones of at least one distinguishing feature <inline-formula id="pcbi.1008240.e027"><alternatives><graphic xlink:href="pcbi.1008240.e027.jpg" id="pcbi.1008240.e027g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M27"><mml:mrow><mml:mo>Π</mml:mo><mml:mo>∈</mml:mo><mml:mo>Φ</mml:mo><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>—i.e. <italic>c</italic><sub><italic>i</italic></sub> &gt; 0 for all clones <italic>i</italic> in some distinguishing feature <inline-formula id="pcbi.1008240.e028"><alternatives><graphic xlink:href="pcbi.1008240.e028.jpg" id="pcbi.1008240.e028g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M28"><mml:mrow><mml:mo>Π</mml:mo><mml:mo>∈</mml:mo><mml:mo>Φ</mml:mo><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. As discussed, conditioning on frequencies <bold>f</bold> and <italic>T</italic> being the true phylogeny, outcomes (<italic>c</italic><sub>0</sub>, …, <italic>c</italic><sub><italic>n</italic></sub>) of SCS experiments of <italic>k</italic> cells follow a multinomial distribution Mult(<italic>k</italic>, <italic>u</italic><sub>0</sub>, …, <italic>u</italic><sub><italic>n</italic></sub>) where <bold>u</bold>(<italic>T</italic>, <bold>f</bold>) = [<italic>u</italic><sub><italic>i</italic></sub>] is defined as in <xref ref-type="disp-formula" rid="pcbi.1008240.e017">(1)</xref>. Let <italic>Y</italic><sub><italic>k</italic></sub> denote the event of a successful outcome. We are interested in computing the probability Pr(<italic>Y</italic><sub><italic>k</italic></sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)), which equals the sum of the probabilities of all successful outcomes. More specifically, we want to determine the smallest number <italic>k</italic>* of single cells to sequence such that Pr(<italic>Y</italic><sub><italic>k</italic>*</sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)) is at least the prescribed confidence level <italic>γ</italic> (<xref ref-type="fig" rid="pcbi.1008240.g002">Fig 2</xref>).</p>
      <p><bold>Problem 2</bold> (<sc>SCS Power Calculation for Phylogeny <italic>T</italic></sc> (<italic>T</italic>-SCS-PC)). Given a set <inline-formula id="pcbi.1008240.e029"><alternatives><graphic xlink:href="pcbi.1008240.e029.jpg" id="pcbi.1008240.e029g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M29"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of candidate phylogenies and a phylogeny <inline-formula id="pcbi.1008240.e030"><alternatives><graphic xlink:href="pcbi.1008240.e030.jpg" id="pcbi.1008240.e030g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M30"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, frequencies <bold>f</bold> and confidence level <italic>γ</italic>, find the minimum number <italic>k</italic>* of single cells needed such that Pr(<italic>Y</italic><sub><italic>k</italic>*</sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)) ≥ <italic>γ</italic>.</p>
      <p>In Section A.1 in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>, we prove that the above problem is NP-hard.</p>
      <p><bold>Theorem 1</bold>. <italic>T</italic>-SCS-PC is NP-hard.</p>
      <sec id="sec004">
        <title>Multiple biopsies</title>
        <p>The SCS-PC problem is only applicable to bulk sequencing data obtained from a single biopsy, i.e. the number of cells calculated is only for an SCS experiment on one sample. However, bulk samples from tumors are often obtained from multiple biopsies, each with different mutation frequencies and consequently different clonal prevalences. One approach to support such data is to solve the SCS-PC problem for each biopsy in isolation and select the biopsy that requires the smallest number of cells. However, a more cost-effective approach that also better captures intra-tumor heterogeneity is to perform a follow-up SCS experiment with cells from multiple biopsies. In particular, the naive selection approach might not yield a solution if the clones of a distinguishing feature do not co-occur in a single biopsy.</p>
        <p>With <italic>b</italic> ≥ 1 biospies, the input changes from a frequency vector <bold>f</bold> ∈ [0, 1]<sup><italic>n</italic></sup> to a frequency matrix <italic>F</italic> ∈ [0, 1]<sup><italic>b</italic>×<italic>n</italic></sup>, whose entries <italic>f</italic><sub><italic>pi</italic></sub> indicate the frequency of mutation <italic>i</italic> in biospy <italic>p</italic>. Similarly, the output changes from an integer <inline-formula id="pcbi.1008240.e031"><alternatives><graphic xlink:href="pcbi.1008240.e031.jpg" id="pcbi.1008240.e031g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M31"><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> to a count vector <inline-formula id="pcbi.1008240.e032"><alternatives><graphic xlink:href="pcbi.1008240.e032.jpg" id="pcbi.1008240.e032g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M32"><mml:mrow><mml:msup><mml:mi mathvariant="bold">k</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">N</mml:mi><mml:mi>b</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, such that each entry <inline-formula id="pcbi.1008240.e033"><alternatives><graphic xlink:href="pcbi.1008240.e033.jpg" id="pcbi.1008240.e033g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M33"><mml:msubsup><mml:mi>k</mml:mi><mml:mi>p</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> indicates the number of single cells in biopsy <italic>p</italic>. We have the following two generalizations of the SCS-PC problem and the <italic>T</italic>-SCS-PC problem for the case of <italic>b</italic> ≥ 1 biopsies.</p>
        <p><bold>Problem 3</bold> (<sc>Multi-Sample SCS Power Calculation</sc> (<sc>Mul-SCS-PC</sc>)). Given a set <inline-formula id="pcbi.1008240.e034"><alternatives><graphic xlink:href="pcbi.1008240.e034.jpg" id="pcbi.1008240.e034g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M34"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of candidate phylogenies, frequencies <italic>F</italic> from <italic>b</italic> biopsies and confidence level <italic>γ</italic>, find the numbers <inline-formula id="pcbi.1008240.e035"><alternatives><graphic xlink:href="pcbi.1008240.e035.jpg" id="pcbi.1008240.e035g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M35"><mml:mrow><mml:msup><mml:mi mathvariant="bold">k</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mi>b</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> of single cells needed from each biopsy to determine the true phylogeny <italic>T</italic>* among <inline-formula id="pcbi.1008240.e036"><alternatives><graphic xlink:href="pcbi.1008240.e036.jpg" id="pcbi.1008240.e036g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M36"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> with probability at least <italic>γ</italic> and the total number <inline-formula id="pcbi.1008240.e037"><alternatives><graphic xlink:href="pcbi.1008240.e037.jpg" id="pcbi.1008240.e037g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M37"><mml:mrow><mml:mrow><mml:mo>∥</mml:mo></mml:mrow><mml:msup><mml:mi mathvariant="bold">k</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:msub><mml:mrow><mml:mo>∥</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:msubsup><mml:msubsup><mml:mi>k</mml:mi><mml:mi>p</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> of cells is minimum.</p>
        <p><bold>Problem 4</bold> (<sc>Multi-Sample SCS Power Calculation for Phylogeny <italic>T</italic></sc> (<sc><italic>T</italic>-Mul-SCS-PC</sc>)). Given a set <inline-formula id="pcbi.1008240.e038"><alternatives><graphic xlink:href="pcbi.1008240.e038.jpg" id="pcbi.1008240.e038g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M38"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of candidate phylogenies and a phylogeny <inline-formula id="pcbi.1008240.e039"><alternatives><graphic xlink:href="pcbi.1008240.e039.jpg" id="pcbi.1008240.e039g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M39"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, frequencies <italic>F</italic> from <italic>b</italic> biopsies and confidence level <italic>γ</italic>, find the numbers <inline-formula id="pcbi.1008240.e040"><alternatives><graphic xlink:href="pcbi.1008240.e040.jpg" id="pcbi.1008240.e040g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M40"><mml:mrow><mml:msup><mml:mi mathvariant="bold">k</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mi>b</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> of single cells needed from each biopsy such that Pr(<italic>Y</italic><sub><bold>k</bold><sup>*</sup></sub>∣<italic>U</italic>(<italic>T</italic>, <italic>F</italic>)) ≥ <italic>γ</italic> and the total number <inline-formula id="pcbi.1008240.e041"><alternatives><graphic xlink:href="pcbi.1008240.e041.jpg" id="pcbi.1008240.e041g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M41"><mml:mrow><mml:mrow><mml:mo>∥</mml:mo></mml:mrow><mml:msup><mml:mi mathvariant="bold">k</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:msub><mml:mrow><mml:mo>∥</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:msubsup><mml:msubsup><mml:mi>k</mml:mi><mml:mi>p</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> of cells is minimum.</p>
        <p>For the case where <italic>b</italic> = 1, the <italic>T</italic>-SCS-PC and the <italic>T</italic>-<sc>Mul-SCS-PC</sc> problems are identical, amounting to following hardness result.</p>
        <p><bold>Corollary 1</bold>. <sc><italic>T</italic>-Mul-SCS-PC</sc> is NP-hard.</p>
      </sec>
    </sec>
    <sec id="sec005">
      <title>Multinomial power calculation</title>
      <p>To solve the <sc><italic>T</italic>-SCS-PC</sc> problem, it suffices to have an algorithm that computes Pr(<italic>Y</italic><sub><italic>k</italic></sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)), which is the probability of concluding that <italic>T</italic> is the true phylogeny. Using this algorithm we identify <italic>k</italic>* by starting from <italic>k</italic> = 0 and simply incrementing <italic>k</italic> until the corresponding probability Pr(<italic>Y</italic><sub><italic>k</italic></sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)) exceeds the prescribed confidence level <italic>γ</italic>. In the following, we describe how to efficiently compute Pr(<italic>Y</italic><sub><italic>k</italic></sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)).</p>
      <p>Recall that the outcome of an SCS experiment composed of <italic>k</italic> cells corresponds to a vector <bold>c</bold> = [<italic>c</italic><sub><italic>i</italic></sub>], where <italic>c</italic><sub><italic>i</italic></sub> ≥ 0 is the number of cells that we observe from clone <italic>i</italic> and <inline-formula id="pcbi.1008240.e042"><alternatives><graphic xlink:href="pcbi.1008240.e042.jpg" id="pcbi.1008240.e042g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M42"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. In a successful outcome <bold>c</bold> we observe at least one cell for each featurette in at least one distinguishing feature <inline-formula id="pcbi.1008240.e043"><alternatives><graphic xlink:href="pcbi.1008240.e043.jpg" id="pcbi.1008240.e043g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M43"><mml:mrow><mml:mo>Π</mml:mo><mml:mo>∈</mml:mo><mml:mo>Φ</mml:mo><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, where <inline-formula id="pcbi.1008240.e044"><alternatives><graphic xlink:href="pcbi.1008240.e044.jpg" id="pcbi.1008240.e044g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M44"><mml:mrow><mml:mo>Φ</mml:mo><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is the distinguishing feature family. For brevity, we will write Φ rather than <inline-formula id="pcbi.1008240.e045"><alternatives><graphic xlink:href="pcbi.1008240.e045.jpg" id="pcbi.1008240.e045g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M45"><mml:mrow><mml:mo>Φ</mml:mo><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</p>
      <p>Let <bold>c</bold>(Π, <italic>k</italic>) denote the set of all outcomes where we observe at least one cell for each featurette in a distinguishing feature Π—i.e. <inline-formula id="pcbi.1008240.e046"><alternatives><graphic xlink:href="pcbi.1008240.e046.jpg" id="pcbi.1008240.e046g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M46"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, and for all <italic>i</italic> ∈ {0, …, <italic>n</italic>} it holds that <italic>c</italic><sub><italic>i</italic></sub> &gt; 0 if clone <italic>i</italic> is a featurette in Π and <italic>c</italic><sub><italic>i</italic></sub> ≥ 0 otherwise. The set <bold>c</bold>(Φ, <italic>k</italic>) of successful outcomes is defined as the union ⋃<sub>Π∈Φ</sub>
<bold>c</bold>(Π, <italic>k</italic>). The probability of any SCS outcome <bold>c</bold> = (<italic>c</italic><sub>0</sub>, …, <italic>c</italic><sub><italic>n</italic></sub>) is distributed according to Mult(<italic>k</italic>, <bold>u</bold>(<italic>T</italic>, <bold>f</bold>)). Since successful outcomes enable us to conclude that <italic>T</italic> is the true phylogeny, we have
<disp-formula id="pcbi.1008240.e047"><alternatives><graphic xlink:href="pcbi.1008240.e047.jpg" id="pcbi.1008240.e047g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M47"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo form="prefix">Pr</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">f</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold">c</mml:mi><mml:mo>(</mml:mo><mml:mo>Φ</mml:mo><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:mtext>Mult</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>∣</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">f</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold">c</mml:mi><mml:mo>(</mml:mo><mml:mo>Φ</mml:mo><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mi>k</mml:mi><mml:mo>!</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:msubsup><mml:mi>u</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2)</label></disp-formula></p>
      <p>If there is only one distinguishing feature Π, i.e. Φ = {Π}, then the desired probability is a standard tail probability of the multinomial where we sum up the probabilities of outcomes <bold>c</bold>(Π, <italic>k</italic>) = [<italic>c</italic><sub><italic>i</italic></sub>] such that <inline-formula id="pcbi.1008240.e048"><alternatives><graphic xlink:href="pcbi.1008240.e048.jpg" id="pcbi.1008240.e048g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M48"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, <italic>c</italic><sub><italic>i</italic></sub> &gt; 0 if clone <italic>i</italic> is a featurette of Π and <italic>c</italic><sub><italic>i</italic></sub> ≥ 0 otherwise. A fast calculation of this tail probability was developed using a connection to the conditional probability of independent Poisson random variables [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>, <xref rid="pcbi.1008240.ref031" ref-type="bibr">31</xref>]. If there are multiple distinguishing features but they are pairwise disjoint—i.e. no two distinct distinguishing features share the same featurette—then we simply have
<disp-formula id="pcbi.1008240.e049"><alternatives><graphic xlink:href="pcbi.1008240.e049.jpg" id="pcbi.1008240.e049g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M49"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo form="prefix">Pr</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">f</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mo>Π</mml:mo><mml:mo>∈</mml:mo><mml:mo>Φ</mml:mo></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold">c</mml:mi><mml:mo>(</mml:mo><mml:mo>Π</mml:mo><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:mtext>Mult</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>∣</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">f</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(3)</label></disp-formula>
and we can apply the fast computation [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>] to obtain each independent tail probability. However, the equality in the above equation does not hold if the family Φ is composed of distinguishing features with overlapping featurettes. Incorrectly applying this equation will lead us to overestimate the value of <italic>k</italic>*. Since single-cell sequencing is expensive, overestimating the number of cells to sequence in an SCS experiment can be costly and unnecessary. One naive way would be to simply brute force all (<italic>n</italic> + 1)<sup><italic>k</italic></sup> SCS outcomes, but this will not scale. Instead, to calculate Pr(<italic>Y</italic><sub><italic>k</italic></sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)) exactly, we propose to use the inclusion-exclusion principle as follows.
<disp-formula id="pcbi.1008240.e050"><alternatives><graphic xlink:href="pcbi.1008240.e050.jpg" id="pcbi.1008240.e050g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M50"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo form="prefix">Pr</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">f</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>∅</mml:mi><mml:mo>⊊</mml:mo><mml:msup><mml:mo>Φ</mml:mo><mml:mo>′</mml:mo></mml:msup><mml:mo>⊊</mml:mo><mml:mo>Φ</mml:mo></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:msup><mml:mo>Φ</mml:mo><mml:mo>′</mml:mo></mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:msup><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold">c</mml:mi><mml:mo>(</mml:mo><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mo>Φ</mml:mo><mml:mo>′</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:mtext>Mult</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>∣</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">f</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(4)</label></disp-formula>
where <italic>I</italic>(Φ′) is the set of all featurettes in Φ′, i.e. <italic>I</italic>(Φ′) = ⋃<sub>Π∈Φ′</sub> Π (<xref ref-type="fig" rid="pcbi.1008240.g003">Fig 3A</xref>).</p>
      <fig id="pcbi.1008240.g003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008240.g003</object-id>
        <label>Fig 3</label>
        <caption>
          <title>PhyDOSE implementation details.</title>
          <p>(A) To account for minimal distinguishing features that share featurettes, we use the inclusion-exclusion principle to compute Pr(<italic>Y</italic><sub><italic>k</italic></sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)). Here, Π<sub>1</sub> (red) and Π<sub>2</sub> (blue) share a featurette (with ‘triangle’ and ‘heart’ mutations). (B) To enumerate the set Φ* of minimal distinguishing features of <italic>T</italic><sub>1</sub>, we reduce the problem to <sc>Set Cover</sc> and repeatedly identify minimum covers. Here, the universe <italic>U</italic> is composed of trees {<italic>T</italic><sub>2</sub>, <italic>T</italic><sub>3</sub>} and there is a subset in <inline-formula id="pcbi.1008240.e051"><alternatives><graphic id="pcbi.1008240.e051g" xlink:href="pcbi.1008240.e051"/><mml:math id="M51"><mml:mi mathvariant="script">F</mml:mi></mml:math></alternatives></inline-formula> for each featurette <italic>τ</italic> of <italic>T</italic><sub>1</sub> composed of the trees where <italic>τ</italic> is absent.</p>
        </caption>
        <graphic xlink:href="pcbi.1008240.g003"/>
      </fig>
      <p>Thus, we need to compute 2<sup>|Φ|</sup> − 1 tail probabilities, which each can be done using the fast calculation in SCOPIT [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>].</p>
      <p>In the worst case, Φ has <italic>O</italic>(2<sup><italic>n</italic></sup>) distinguishing features resulting in <italic>O</italic>(2<sup><italic>n</italic></sup>) tail probabilities. We now describe one final optimization that will significantly reduce the number of required computations. This is based on the following observation.</p>
      <p><bold>Observation 1</bold>. If Π is a distinguishing feature of <italic>T</italic> then for all featurettes <italic>τ</italic> present in <italic>T</italic> it holds that Π ∪ {<italic>τ</italic>} is a distinguishing feature of <italic>T</italic>.</p>
      <p>This means that distinguishing features in Φ form a partially ordered set under the set inclusion relation. We call a distinguishing feature Π <italic>minimal</italic> if there does not exist another distinguishing feature Π′ ∈ Φ that is a proper subset of Π, i.e. Π′ ⊊ Π.</p>
      <p>A direct consequence of Observation 1 is that the outcome of an SCS experiment is successful when we observe all featurettes of a distinguishing feature Π, and remains so even if we observe additional featurettes <italic>τ</italic>′ ∉ Π.</p>
      <p>As such, successful outcomes w.r.t. Φ equal those w.r.t. the set Φ* of all minimal distinguishing features of <italic>T</italic>.</p>
      <p><bold>Observation 2</bold>. It holds that <bold>c</bold>(Φ*, <italic>k</italic>) = <bold>c</bold>(Φ, <italic>k</italic>).</p>
      <p>Therefore, it suffices to restrict our attention to only Φ* rather than the complete family Φ when computing Pr(<italic>Y</italic><sub><italic>k</italic></sub>∣<bold>u</bold>(<italic>T</italic>, <bold>f</bold>)) using <xref ref-type="disp-formula" rid="pcbi.1008240.e050">(4)</xref>. Section B.1 in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref> describes how to find Φ* by reducing the problem to that of finding all minimal set covers, which we solve in an iterative fashion using integer linear programming.</p>
    </sec>
    <sec id="sec006">
      <title>Power calculation for multiple biopsies</title>
      <p>We now discuss the <sc><italic>T</italic>-Mul-SCS-PC</sc>, which is the generalization of the <sc><italic>T</italic>-SCS-PC</sc> problem to <italic>b</italic> ≥ 1 biopsies. The key probability is Pr(<italic>Y</italic><sub><bold>k</bold></sub>∣<italic>U</italic>(<italic>T</italic>, <italic>F</italic>)), i.e. the probability of concluding that <italic>T</italic> is the true tree when sequencing <bold>k</bold> = [<italic>k</italic><sub>1</sub>, …, <italic>k</italic><sub><italic>b</italic></sub>]<sup><italic>T</italic></sup> cells from each biopsy. In the following, we discuss an exact (but computationally intensive) approach to compute this probability as well as a fast heuristic.</p>
      <p>Given the numbers <bold>k</bold> = [<italic>k</italic><sub>1</sub>, …, <italic>k</italic><sub><italic>b</italic></sub>]<sup><italic>T</italic></sup> of cells to sequence from each biopsy, an <italic>outcome</italic> of the corresponding SCS experiment across <italic>b</italic> biopsies is defined as a matrix <italic>C</italic> = [<italic>c</italic><sub><italic>pi</italic></sub>] such that <inline-formula id="pcbi.1008240.e052"><alternatives><graphic xlink:href="pcbi.1008240.e052.jpg" id="pcbi.1008240.e052g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M52"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> is the number of cells that we observe from clone <italic>i</italic> in biopsy <italic>p</italic>, and ∑<sub><italic>i</italic> = 0</sub>
<italic>c</italic><sub><italic>pi</italic></sub> = <italic>k</italic><sub><italic>p</italic></sub> for all biopsies <italic>p</italic>. A <italic>successful outcome</italic> for a distinguishing feature Π is an outcome where we observe at least one cell for each featurette in Π. Let <italic>C</italic>(Π, <bold>k</bold>) denote the set of all successful outcomes for distinguishing feature Π. The set <italic>C</italic>(Φ*, <bold>k</bold>) of successful outcomes for the minimal distinguishing feature family Φ* is defined as the union ⋃<sub>Π∈Φ*</sub>
<italic>C</italic>(Π, <bold>k</bold>). Since sequencing of each biopsies proceeds independently, the probability of a observing an outcome <italic>C</italic> = [<bold>c</bold><sub>1</sub>, …, <bold>c</bold><sub><italic>b</italic></sub>]<sup><italic>T</italic></sup> across <italic>b</italic> biopsies equals
<disp-formula id="pcbi.1008240.e053"><alternatives><graphic xlink:href="pcbi.1008240.e053.jpg" id="pcbi.1008240.e053g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M53"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo form="prefix">Pr</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi mathvariant="bold">k</mml:mi><mml:mo>,</mml:mo><mml:mi>U</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi>F</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:munderover><mml:mo form="prefix">Pr</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">f</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:munderover><mml:mrow><mml:mtext>Mult</mml:mtext><mml:mo>(</mml:mo></mml:mrow><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">f</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>)</mml:mo><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(5)</label></disp-formula></p>
      <p>Hence, the desired tail probability of successful outcomes for the minimal distinguishing feature family Φ* equals
<disp-formula id="pcbi.1008240.e054"><alternatives><graphic xlink:href="pcbi.1008240.e054.jpg" id="pcbi.1008240.e054g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M54"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo form="prefix">Pr</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mi mathvariant="bold">k</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi>U</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi>F</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>]</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:mi>C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mo>Φ</mml:mo><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:munderover><mml:mtext>Mult</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>u</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">f</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(6)</label></disp-formula></p>
      <p>For a single biopsy (<italic>b</italic> = 1), the probability Pr(<italic>Y</italic><sub><bold>k</bold></sub>∣<italic>U</italic>(<italic>T</italic>, <italic>F</italic>)) corresponds to sums of multinomial tail probabilities, enabling fast calculation using [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>] as discussed in the previous section. This is no longer the case for <italic>b</italic> &gt; 1 biopsies where the tail probability is over <italic>b</italic> independent multinomial distributions (see product in <xref ref-type="disp-formula" rid="pcbi.1008240.e054">Eq (6)</xref>). A naive way to compute Pr(<italic>Y</italic><sub><bold>k</bold></sub>∣<italic>U</italic>(<italic>T</italic>, <italic>F</italic>)) would be to exhaustively enumerate all SCS outcomes with <bold>k</bold> cells, which scales exponentially in <bold>k</bold>. As such, we develop a heuristic approach, which selects a subset of required featurettes/clones in each biopsy that together form a distinguishing feature in Φ* and achieve the smallest total number of cells with confidence level <italic>γ</italic>. Section B.4 in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref> provides more details and Figure B in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref> provides an example where the heuristic returns a suboptimal solution.</p>
    </sec>
    <sec id="sec007">
      <title>Consideration of SCS error rates</title>
      <p>One current challenge with SCS is that the false negative rate per site is quite high with typical rates up to 0.4 for the commonly used multiple displacement amplification (MDA) method [<xref rid="pcbi.1008240.ref032" ref-type="bibr">32</xref>]. On the other hand, current false positive rates are low and are typically less than 0.0005 for MDA-based whole-genome amplification [<xref rid="pcbi.1008240.ref032" ref-type="bibr">32</xref>]. A <italic>false negative</italic> is defined as not observing a mutation that is present in the cell. A <italic>false positive</italic> occurs when we observe the presence of a mutation that did not occur in that cell.</p>
      <p>With PhyDOSE, we propose one possible method for incorporating the false negative rate <italic>β</italic> when it is known. Specifically, sampled cells follow a categorical distribution <bold>u</bold> = [<italic>u</italic><sub>0</sub>, …, <italic>u</italic><sub><italic>n</italic></sub>] when conditioned on tree <italic>T</italic>. Hence, the probability of sampling a cell from clone <italic>i</italic> equals <italic>u</italic><sub><italic>i</italic></sub>. True positives, i.e. correctly observing a mutation in a clone, follow a Bernoulli distribution with parameter 1 − <italic>β</italic>. To observe a featurette/clone <italic>i</italic> that has <italic>n</italic><sub><italic>i</italic></sub> mutations and a prevalence of <italic>u</italic><sub><italic>i</italic></sub>, we thus need to have <italic>n</italic><sub><italic>i</italic></sub> true positives. In other words, assuming independence among mutations, we require <italic>n</italic><sub><italic>i</italic></sub> successful draws from a Bernoulli distribution parameterized by 1 − <italic>β</italic>. As such, we derive new clonal prevalence <inline-formula id="pcbi.1008240.e055"><alternatives><graphic xlink:href="pcbi.1008240.e055.jpg" id="pcbi.1008240.e055g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M55"><mml:mrow><mml:msup><mml:mi mathvariant="bold">u</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">f</mml:mi><mml:mo>,</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> from <bold>u</bold>(<italic>T</italic>, <bold>f</bold>) = [<italic>u</italic><sub><italic>i</italic></sub>]. Additionally assuming independence between the events of a cell being sampled from clone <italic>i</italic> and the absence of false negatives, we set <inline-formula id="pcbi.1008240.e056"><alternatives><graphic xlink:href="pcbi.1008240.e056.jpg" id="pcbi.1008240.e056g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M56"><mml:mrow><mml:msubsup><mml:mi>u</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> where <italic>n</italic><sub><italic>i</italic></sub> is the number of mutations in featurette/clone <italic>i</italic>. We set <inline-formula id="pcbi.1008240.e057"><alternatives><graphic xlink:href="pcbi.1008240.e057.jpg" id="pcbi.1008240.e057g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M57"><mml:msubsup><mml:mi>u</mml:mi><mml:mn>0</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> to be equal to <inline-formula id="pcbi.1008240.e058"><alternatives><graphic xlink:href="pcbi.1008240.e058.jpg" id="pcbi.1008240.e058g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M58"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msubsup><mml:mi>u</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>. This adjustment results in a reduction of the clonal prevalence and ultimately increases the value of <italic>k</italic>*. The issue of false positives is less serious as error rates are low enough to be negligible.</p>
    </sec>
    <sec id="sec008">
      <title>Prioritizing candidate trees post SCS experiment</title>
      <p>The final step is to prioritize candidate trees after performing an SCS experiment with the number <italic>k</italic>* of cells computed by PhyDOSE. To this end, we compute the <italic>support</italic> of each tree <inline-formula id="pcbi.1008240.e059"><alternatives><graphic xlink:href="pcbi.1008240.e059.jpg" id="pcbi.1008240.e059g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M59"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. Intuitively, support(<italic>T</italic>) is the number of cells that support the conclusion that <italic>T</italic> is the actual phylogeny. Formally, we say that a distinguishing feature Π of a tree <italic>T</italic> is <italic>observed</italic> if each featurette of Π is observed in at least one cell. Using this, we define support(<italic>T</italic>) as the number of cells that correspond to featurettes of an observed distinguishing feature Π of <italic>T</italic>. Per Observation 1, it suffices to restrict our attention to the set Π* of minimal distinguishing features.</p>
      <p>There are two outcomes of an SCS experiment with <italic>k</italic>* cells. Either there is no tree <inline-formula id="pcbi.1008240.e060"><alternatives><graphic xlink:href="pcbi.1008240.e060.jpg" id="pcbi.1008240.e060g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M60"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> with non-zero support or there are one or more trees with non-zero support. In the former case, the SCS experiment has failed, which is expected to occur with probability 1 − <italic>γ</italic>. In the latter case, which may occur in the presence of false negatives and false positives, we return the set of trees with maximum support.</p>
      <p>Alternatively, we may use existing methods that infer tumor phylogeny from SCS data [<xref rid="pcbi.1008240.ref014" ref-type="bibr">14</xref>, <xref rid="pcbi.1008240.ref016" ref-type="bibr">16</xref>, <xref rid="pcbi.1008240.ref033" ref-type="bibr">33</xref>] or a combination of SCS and bulk data [<xref rid="pcbi.1008240.ref019" ref-type="bibr">19</xref>, <xref rid="pcbi.1008240.ref020" ref-type="bibr">20</xref>].</p>
    </sec>
    <sec id="sec009">
      <title><italic>k</italic>* confidence interval</title>
      <p>A common challenge in bulk sequencing is uncertainty in the cancer cell fractions <bold>f</bold> due to sampling of reads as well as sequencing and mapping errors. Following standard practice [<xref rid="pcbi.1008240.ref009" ref-type="bibr">9</xref>, <xref rid="pcbi.1008240.ref010" ref-type="bibr">10</xref>, <xref rid="pcbi.1008240.ref034" ref-type="bibr">34</xref>], we account for this uncertainty by taking confidence intervals [<bold>f</bold><sup>−</sup>, <bold>f</bold><sup>+</sup>] as input. Typically, such confidence intervals are obtained by viewing variant read counts as draws from a binomial or beta-binomial distribution. Importantly, uncertainty in the cancer cell fraction leads to uncertainty in clonal prevalences. Therefore, for each tree <inline-formula id="pcbi.1008240.e061"><alternatives><graphic xlink:href="pcbi.1008240.e061.jpg" id="pcbi.1008240.e061g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M61"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, we utilize [<bold>f</bold><sup>−</sup>, <bold>f</bold><sup>+</sup>] to construct an interval <inline-formula id="pcbi.1008240.e062"><alternatives><graphic xlink:href="pcbi.1008240.e062.jpg" id="pcbi.1008240.e062g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M62"><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> of the number of single cells reflecting the extreme values the clonal prevalences may assume. To find these values, we must consider the frequencies [<bold>f</bold><sup>−</sup>, <bold>f</bold><sup>+</sup>] using constraints from the tree <italic>T</italic> following the sum condition <xref ref-type="disp-formula" rid="pcbi.1008240.e017">(1)</xref> and the featurettes in a distinguishing feature of <italic>T</italic>. We do this using a heuristic that we describe in Section B.2 in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>. We set the overall interval <inline-formula id="pcbi.1008240.e063"><alternatives><graphic xlink:href="pcbi.1008240.e063.jpg" id="pcbi.1008240.e063g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M63"><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> conservatively as the confidence interval <inline-formula id="pcbi.1008240.e064"><alternatives><graphic xlink:href="pcbi.1008240.e064.jpg" id="pcbi.1008240.e064g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M64"><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> from the tree <italic>T</italic> with the maximum <inline-formula id="pcbi.1008240.e065"><alternatives><graphic xlink:href="pcbi.1008240.e065.jpg" id="pcbi.1008240.e065g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M65"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> among all trees <inline-formula id="pcbi.1008240.e066"><alternatives><graphic xlink:href="pcbi.1008240.e066.jpg" id="pcbi.1008240.e066g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M66"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>.</p>
    </sec>
    <sec id="sec010">
      <title><monospace>phydoser</monospace> R package</title>
      <p>We developed PhyDOSE and the associated optimizations into a freely available R package named <monospace>phydoser</monospace>. The functions in the <monospace>phydoser</monospace> R package are grouped into four areas: (i) I/O support (ii) pre and post processing (iii) PhyDOSE implementation iv) visualization. For I/O support, <monospace>phydoser</monospace> offers a suite of functions to read and convert external data into the data structures required by the R implementation of PhyDOSE. The pre and post processing capabilities include generation of the distinguishing feature families of each tree, the frequency inputs for the <italic>k</italic>* confidence interval and the computation of the support metric for a completed SCS experiment. The implementation of PhyDOSE includes both a single biopsy and a multiple biopsy mode. Lastly, the visualization functions facilitate creation of high resolution tree graphics while annotating the distinguishing feature or a specific featurette of a tree. <monospace>phydoser</monospace> is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/elkebir-group/phydoser">https://github.com/elkebir-group/phydoser</ext-link>.</p>
    </sec>
  </sec>
  <sec sec-type="results" id="sec011">
    <title>Results</title>
    <p>In this section, we demonstrate the application of PhyDOSE to simulated and real data. We begin by validating our method using simulated data. Next, we provide retrospective results for a leukemia patient [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>] and an acute myeloid leukemia cohort [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>] where both bulk and single-cell DNA sequencing have been performed [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>]. Finally, we use PhyDOSE to perform a prospective analysis to determine the required number of single cells to identify the true phylogeny in a non-small cell lung cancer patient cohort [<xref rid="pcbi.1008240.ref003" ref-type="bibr">3</xref>]. Source data and results can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/elkebir-group/PhyDOSE">https://github.com/elkebir-group/PhyDOSE</ext-link>.</p>
    <sec id="sec012">
      <title>Simulations</title>
      <sec id="sec013">
        <title>Design</title>
        <p>We used simulations to assess (i) the benefit of PhyDOSE’s distinguishing feature analysis, (ii) robustness to uncertainty due to sequencing errors and (iii) robustness to violations of PhyDOSE’s model assumptions. We generated simulated data where the ground truth tree <italic>T</italic>* is known. Given a fixed number <italic>c</italic> of clones and <italic>n</italic> mutations, we first generated a ground truth tree <italic>T</italic>* with <italic>c</italic> vertices uniformly at random using Prüfer sequences [<xref rid="pcbi.1008240.ref035" ref-type="bibr">35</xref>] and randomly distributed the <italic>n</italic> mutations to the <italic>c</italic> clones while ensuring that every clone had at least one mutation. Next, we generated clonal prevalences <bold>u</bold> = [<italic>u</italic><sub><italic>i</italic></sub>] by drawing from a symmetric (<italic>n</italic> + 1)-dimensional Dirichlet distribution with concentration parameter 0.2. We used rejection sampling to ensure that each clonal prevalence <italic>u</italic><sub><italic>i</italic></sub> was at least 0.05. Let <italic>σ</italic>(<italic>i</italic>) be the set of clones that contain mutation <italic>i</italic>. We generated frequencies <bold>f</bold> = [<italic>f</italic><sub><italic>i</italic></sub>] by setting <italic>f</italic><sub><italic>i</italic></sub> = ∑<sub><italic>j</italic>∈<italic>σ</italic>(<italic>i</italic>)</sub>
<italic>u</italic><sub><italic>j</italic></sub> for each mutation <italic>i</italic> ∈ {1, …, <italic>n</italic>}. We used the SPRUCE algorithm to enumerate the set <inline-formula id="pcbi.1008240.e067"><alternatives><graphic xlink:href="pcbi.1008240.e067.jpg" id="pcbi.1008240.e067g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M67"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of trees given frequencies <bold>f</bold> [<xref rid="pcbi.1008240.ref009" ref-type="bibr">9</xref>].</p>
        <p>To account for common single-cell sequencing errors, we varied false negative rates <italic>β</italic> ∈ {0, 0.2} and doublet rates <italic>δ</italic> ∈ {0, 0.1}. We generated, for each simulation instance, 10, 000 single cells sampled under the specified false negative rates <italic>β</italic> and doublet rates <italic>δ</italic> according to the bulk clonal prevalence <bold>u</bold>. To account for uncertainty in bulk sequencing, we additionally obtained confidence intervals on the cancer cell fractions of simulation instances sim3a, using a binomial distribution (with confidence <italic>α</italic> = 0.05) and a mean coverage of 1000x (drawn from a Poisson distribution). Modeling additional uncertainty in bulk sequencing, sim4a instances consist of <italic>n</italic> = 100 mutations each and use PyClone [<xref rid="pcbi.1008240.ref036" ref-type="bibr">36</xref>] to cluster the 100 mutations before enumerating <inline-formula id="pcbi.1008240.e068"><alternatives><graphic xlink:href="pcbi.1008240.e068.jpg" id="pcbi.1008240.e068g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M68"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula>.</p>
        <p>Recall that PhyDOSE has three model assumptions: (i) ground truth tree <italic>T</italic>* is among the candidates trees <inline-formula id="pcbi.1008240.e069"><alternatives><graphic xlink:href="pcbi.1008240.e069.jpg" id="pcbi.1008240.e069g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M69"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula>, (ii) correspondence between clonal prevalences in bulk and subsequent single-cell sequencing samples, and (iii) infinite sites assumption for mutations. To assess (i), for simulation conditions ‘b’ (sim1b, sim2b and sim3b), we randomly sampled 10% of the trees outputted by SPRUCE [<xref rid="pcbi.1008240.ref009" ref-type="bibr">9</xref>]. To assess (ii), we varied single-cell clonal prevalences from the bulk clonal prevalences by resampling <inline-formula id="pcbi.1008240.e070"><alternatives><graphic xlink:href="pcbi.1008240.e070.jpg" id="pcbi.1008240.e070g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M70"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>∼</mml:mo><mml:mtext>D</mml:mtext><mml:mtext mathsize="small">IR</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mo>λ</mml:mo><mml:mi mathvariant="bold">u</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. We tuned the parameter λ so that the clonal prevalence varied by an absolute average of 5% and 20% from the clones of the ground truth tree <italic>T</italic>*, which resulted in λ = 2000 and λ = 50, respectively (Figure C in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). To assess (iii), we introduced violations of the infinite sites assumption (ISA) in the form of mutation losses. Specifically, we introduced one mutation loss in each of the instances of sim1a as follows. First, we randomly picked two distinct mutations (<italic>i</italic>, <italic>j</italic>) where <italic>i</italic> is introduced prior to <italic>j</italic> in the ground truth tree <italic>T</italic>*. Then, we designated the descendant mutation <italic>j</italic> as a loss of mutation <italic>i</italic> in each candidate tree <inline-formula id="pcbi.1008240.e071"><alternatives><graphic xlink:href="pcbi.1008240.e071.jpg" id="pcbi.1008240.e071g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M71"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>.</p>
        <p>In total, we generated 100 simulation instances under eight varying conditions as specified in <xref rid="pcbi.1008240.t001" ref-type="table">Table 1</xref>.</p>
        <table-wrap id="pcbi.1008240.t001" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1008240.t001</object-id>
          <label>Table 1</label>
          <caption>
            <title>Simulation conditions.</title>
            <p>We generate simulated data under eight conditions with 100 instances each. These conditions have varying subsets of candidate trees, number of clones, number of mutations per clone, clonal prevalence distortions, false negative and doublet rates. To analyze violations of the infinite sites assumption analysis, we introduced mutation losses in the sim1a instances. To analyze uncertainty in cancer cell fractions, we used the sim3a instances with a coverage of 1000x.</p>
          </caption>
          <alternatives>
            <graphic id="pcbi.1008240.t001g" xlink:href="pcbi.1008240.t001"/>
            <table frame="box" rules="all" border="0">
              <colgroup span="1">
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
                <col align="left" valign="middle" span="1"/>
              </colgroup>
              <thead>
                <tr>
                  <th align="center" style="border-bottom:thick" rowspan="1" colspan="1">ID</th>
                  <th align="center" style="border-bottom:thick" rowspan="1" colspan="1">% of Trees</th>
                  <th align="center" style="border-bottom:thick" rowspan="1" colspan="1">Clones</th>
                  <th align="center" style="border-bottom:thick" rowspan="1" colspan="1">Mutations</th>
                  <th align="center" style="border-bottom:thick" rowspan="1" colspan="1">Prevalence Noise</th>
                  <th align="center" style="border-bottom:thick" rowspan="1" colspan="1">FNR <italic>β</italic></th>
                  <th align="center" style="border-bottom:thick" rowspan="1" colspan="1">Doublet <italic>δ</italic></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim1a</td>
                  <td align="center" rowspan="1" colspan="1">100%</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">0%</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim1b</td>
                  <td align="center" rowspan="1" colspan="1">10%</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">0%</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim2a</td>
                  <td align="center" rowspan="1" colspan="1">100%</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">5%</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim2b</td>
                  <td align="center" rowspan="1" colspan="1">10%</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">5%</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim2c</td>
                  <td align="center" rowspan="1" colspan="1">100%</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">20%</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                  <td align="center" rowspan="1" colspan="1">0</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim3a</td>
                  <td align="center" rowspan="1" colspan="1">100%</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">5%</td>
                  <td align="center" rowspan="1" colspan="1">0.2</td>
                  <td align="center" rowspan="1" colspan="1">0.1</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim3b</td>
                  <td align="center" rowspan="1" colspan="1">10%</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">7</td>
                  <td align="center" rowspan="1" colspan="1">5%</td>
                  <td align="center" rowspan="1" colspan="1">0.2</td>
                  <td align="center" rowspan="1" colspan="1">0.1</td>
                </tr>
                <tr>
                  <td align="center" rowspan="1" colspan="1">sim4a</td>
                  <td align="center" rowspan="1" colspan="1">100%</td>
                  <td align="center" rowspan="1" colspan="1">10</td>
                  <td align="center" rowspan="1" colspan="1">100</td>
                  <td align="center" rowspan="1" colspan="1">5%</td>
                  <td align="center" rowspan="1" colspan="1">0.2</td>
                  <td align="center" rowspan="1" colspan="1">0.1</td>
                </tr>
              </tbody>
            </table>
          </alternatives>
        </table-wrap>
      </sec>
      <sec id="sec014">
        <title>The benefit of PhyDOSE’s distinguishing feature analysis</title>
        <p>We compared PhyDOSE against SCOPIT [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>], an existing method to design SCS experiments which takes as input a confidence level and the prevalence rate of each clone. Since SCOPIT does not connect the clones to be observed with a phylogenetic tree, we ran SCOPIT under two regimes. In the first regime (called ‘SCOPIT’), we input the clonal prevalence rates for each <inline-formula id="pcbi.1008240.e072"><alternatives><graphic xlink:href="pcbi.1008240.e072.jpg" id="pcbi.1008240.e072g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M72"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> and take the maximum SCOPIT output of all trees as an upper bound. In the second regime (called ‘SCOPIT (true clones)’), we supplied SCOPIT with the prevalence rates of the simulated ground truth clones. The comparison to PhyDOSE was conducted at confidence level <italic>γ</italic> = 0.95.</p>
        <p>PhyDOSE yielded a significant reduction in the number of cells to sequence compared to SCOPIT (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4A</xref>). This is even the case when we provided the clonal prevalences of the ground truth tree to SCOPIT but not to PhyDOSE. In particular, for sim1a, SCOPIT required a median of 18.7 times as many cells than PhyDOSE, whereas SCOPIT (true clones) required 1.5 times as many cells (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4A</xref>). In absolute numbers, PhyDOSE computed a median number of <italic>k</italic>* = 35 cells compared to 544 cells computed by SCOPIT and 59 cells computed by SCOPIT (true clones) (Figure D in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>).</p>
        <fig id="pcbi.1008240.g004" orientation="portrait" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1008240.g004</object-id>
          <label>Fig 4</label>
          <caption>
            <title>Simulations demonstrate that PhyDOSE’s calculated number of single cells resolves tree ambiguity in bulk sequencing data.</title>
            <p>We used confidence level <italic>γ</italic> = 0.95 to determine the number <italic>k</italic>* of single cells to sequence. (A) SCOPIT to PhyDOSE cell ratio on a log scale when considering SCOPIT in a worst case regime where the true phylogeny is unknown and a best case regime where SCOPIT utilizes the clonal prevalance of the clones in the simulated ground truth tree. (B) Recall metrics of the tree inferred by SPhyR [<xref rid="pcbi.1008240.ref016" ref-type="bibr">16</xref>] by randomly sampling <italic>k</italic>*/2, <italic>k</italic>* and 2<italic>k</italic>* simulated single cells. (C) Number |Π| of featurettes among minimal distinguishing features Φ* when compared between the enumerated candidate set <inline-formula id="pcbi.1008240.e073"><alternatives><graphic id="pcbi.1008240.e073g" xlink:href="pcbi.1008240.e073"/><mml:math id="M73"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> (conditions <italic>a</italic>) and the downsampled candidate set (conditions <italic>b</italic>). (D) Number <inline-formula id="pcbi.1008240.e074"><alternatives><graphic id="pcbi.1008240.e074g" xlink:href="pcbi.1008240.e074"/><mml:math id="M74"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> of trees in the candidate set when enumerated by SPRUCE [<xref rid="pcbi.1008240.ref009" ref-type="bibr">9</xref>] (condition <italic>a</italic>) and when downsampling the enumerated candidate set (condition <italic>b</italic>). (E) Number <italic>k</italic>* of cells identified by PhyDOSE.</p>
          </caption>
          <graphic xlink:href="pcbi.1008240.g004"/>
        </fig>
        <p>To assess the accuracy of PhyDOSE’s <italic>k</italic>* value, we generated follow-up <italic>in silico</italic> SCS experiments. Specifically, we ran our approach for prioritizing candidate trees and SPhyR [<xref rid="pcbi.1008240.ref016" ref-type="bibr">16</xref>] on sampled single cells. For the former, we performed 100 experiments for each simulation instance, reporting the number of experiments that successfully recovered the ground truth tree <italic>T</italic>*. We counted an experiment as successful if we correctly and uniquely selected the ground truth tree as <italic>T</italic>*. For the latter, we also considered the performance of SPhyR when sampling half and double the number <italic>k</italic>* of cells determined by PhyDOSE.</p>
        <p>Figure F in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref> shows that the prioritization approach worked particularly well for sim1a with a median success rate of 96%. Similarly, SPhyR [<xref rid="pcbi.1008240.ref016" ref-type="bibr">16</xref>] was able to identify the true tree in the majority of cases after sampling PhyDOSE computed number <italic>k</italic>* of cells. To quantify the similarity between the tree <italic>T</italic> estimated by SPhyR and the true tree <italic>T</italic>*, we used two commonly-used tree distance metrics, ancestral and incomparable pair recall. <italic>Ancestral pair recall</italic> is defined as <inline-formula id="pcbi.1008240.e075"><alternatives><graphic xlink:href="pcbi.1008240.e075.jpg" id="pcbi.1008240.e075g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M75"><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∩</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pcbi.1008240.e076"><alternatives><graphic xlink:href="pcbi.1008240.e076.jpg" id="pcbi.1008240.e076g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M76"><mml:mrow><mml:mi mathvariant="script">A</mml:mi><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> (<inline-formula id="pcbi.1008240.e077"><alternatives><graphic xlink:href="pcbi.1008240.e077.jpg" id="pcbi.1008240.e077g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M77"><mml:mrow><mml:mi mathvariant="script">A</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>) is the set of ordered pairs of mutations that occur on distinct edges of the same branch of <italic>T</italic> (<italic>T</italic>*). <italic>Incomparable pair recall</italic> is defined as <inline-formula id="pcbi.1008240.e078"><alternatives><graphic xlink:href="pcbi.1008240.e078.jpg" id="pcbi.1008240.e078g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M78"><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∩</mml:mo><mml:mi mathvariant="script">I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="script">I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pcbi.1008240.e079"><alternatives><graphic xlink:href="pcbi.1008240.e079.jpg" id="pcbi.1008240.e079g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M79"><mml:mrow><mml:mi mathvariant="script">I</mml:mi><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> (<inline-formula id="pcbi.1008240.e080"><alternatives><graphic xlink:href="pcbi.1008240.e080.jpg" id="pcbi.1008240.e080g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M80"><mml:mrow><mml:mi mathvariant="script">I</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>) is the set of unordered pairs of mutation that occur on edges in distinct branches in <italic>T</italic> (<italic>T</italic>*). For sim1a, the median of both metrics is 1 when sampling <italic>k</italic>* cells, reflecting that SPhyR identified the true tree in the majority of cases (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4B</xref>). Moreover, we found greater gains in performance between sampling <italic>k</italic>* cells versus <italic>k</italic>*/2 cells than sampling 2<italic>k</italic>* cells versus <italic>k</italic>* cells.</p>
        <p><xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4C</xref> shows the number of clones in each minimal distinguishing feature identified by PhyDOSE, ranging from 1 to 5 with a median of 3 for simulation conditions ‘a’. Importantly, this number is smaller than the total number of 7 clones, demonstrating that a distinguishing feature yields an efficient representation of a tree. This led to a smaller number <italic>k</italic>* of cells inferred by PhyDOSE compared to SCOPIT without sacrificing performance in the tree reconstruction from the follow-up SCS experiment.</p>
      </sec>
      <sec id="sec015">
        <title>Robustness to violations of PhyDOSE’s model assumptions</title>
        <p>We used simulations to assess PhyDOSE’s performance when model assumptions are violated. We begin with the case where the ground truth tree <italic>T</italic>* is not guaranteed to be present among the candidate trees <inline-formula id="pcbi.1008240.e081"><alternatives><graphic xlink:href="pcbi.1008240.e081.jpg" id="pcbi.1008240.e081g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M81"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula>. In sim1b, we downsampled the set of candidate trees of the instances in sim1a to 10% (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4D</xref>). Similarly to sim1a, PhyDOSE significantly reduced the required number <italic>k</italic>* of single cells compared to SCOPIT (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4A</xref>). We analyzed follow-up <italic>in silico</italic> SCS experiments using the prioritization approach and SPhyR [<xref rid="pcbi.1008240.ref016" ref-type="bibr">16</xref>]. Since the prioritization approach only considers candidate trees <inline-formula id="pcbi.1008240.e082"><alternatives><graphic xlink:href="pcbi.1008240.e082.jpg" id="pcbi.1008240.e082g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M82"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula>, which may not contain the ground truth tree, it is not surprising that performance dropped to a median success rate of 0%. However, SPhyR was able to identify the ground truth tree in the majority of cases (median of 1 for both incomparable and ancestral pair recall).</p>
        <p>Next, we assessed the impact of clonal prevalence distortions between bulk and single cell data in sim2a, sim2b and sim2c. We found PhyDOSE to be robust to random clonal prevalence noise between bulk and single-cell sequencing as evidenced by a drop of only 1% in the median percentage of successful <italic>in silico</italic> SCS experiment when there is no downsampling of trees (Figure C in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). Additionally, the recall performance metrics (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4B</xref>, Figure C in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>) are also not substantially different between sim1a versus sim2a and sim2c, showing similar trends when using <italic>k</italic>*/2 and 2<italic>k</italic>* cells. We attribute this to the fact that PhyDOSE’s use of distinguishing features relies on the clonal prevalence of a few key clones. Furthermore, PhyDOSE performs well for the case where candidate trees have been downsampled and clonal prevalences have been distorted (sim2b, see <xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4B</xref>).</p>
        <p>Finally, we assessed the sensitivity of PhyDOSE to ISA violations by applying it to a candidate set <inline-formula id="pcbi.1008240.e083"><alternatives><graphic xlink:href="pcbi.1008240.e083.jpg" id="pcbi.1008240.e083g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M83"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of 1-Dollo phylogenies obtained from sim1a. Specifically, the resulting simulation instances had candidate trees composed of 6 mutations, one of which having undergone a loss. We performed 100 <italic>in silico</italic> experiments for each of the 100 simulation instances. Like sim1a under the ISA, the median percentage of successful experiments is 95% for the 1-Dollo phylogenies (Figure H in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). However, 23 simulation instances had a success rate of 0%. This increased variance is to be expected as distinguishing features may no longer be distinguishable from those of other trees when mutation losses occur. Nevertheless, PhyDOSE’s suggested SCS experiments for these 23 instances significantly reduced the number of candidate trees from a median of 161 trees pre-experiment to a median of 5 trees post-experiment (Figure H in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). In all cases, the ground truth tree was included in the candidate set after performing the SCS experiment. Hence, as distinguishing features provide an efficient representation for each tree using only a subset of clones, PhyDOSE performed well on data with violations of the infinite sites assumption.</p>
      </sec>
      <sec id="sec016">
        <title>Robustness to uncertainty due to sequencing errors</title>
        <p>Sequencing errors occur in both the initial bulk sequencing experiment as well as the follow-up single-cell sequencing experiment. We begin by considering common SCS errors using false negative rate <italic>β</italic> = 0.2 and doublet rate <italic>δ</italic> = 0.1 in sim3a and sim3b. While the number <italic>k</italic>* significantly increased compared to the simulations without false negatives (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4E</xref>), PhyDOSE’s computed number <italic>k</italic>* of cells remained an order of magnitude smaller than SCOPIT but not for SCOPIT (true clones) (<xref ref-type="fig" rid="pcbi.1008240.g004">Fig 4</xref>). The latter is due to PhyDOSE’s adjustments of the clonal prevalence when factoring in a false negative rate of <italic>β</italic> = 0.2 in trees other than <italic>T</italic>* (Figure E in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). Tree inference using SPhyR in subsequent SCS experiments based on PhyDOSE’s <italic>k</italic>* identified the ground truth tree in the majority of cases (median of 1 for both incomparable and ancestral pair recall).</p>
        <p>Figure G in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref> shows PhyDOSE performance in sim4a instances with mutation clusters inferred by PyClone [<xref rid="pcbi.1008240.ref036" ref-type="bibr">36</xref>]. We included the clustered pair recall in our analysis defined as <inline-formula id="pcbi.1008240.e084"><alternatives><graphic xlink:href="pcbi.1008240.e084.jpg" id="pcbi.1008240.e084g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M84"><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∩</mml:mo><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="script">C</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, where <inline-formula id="pcbi.1008240.e085"><alternatives><graphic xlink:href="pcbi.1008240.e085.jpg" id="pcbi.1008240.e085g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M85"><mml:mrow><mml:mi mathvariant="script">C</mml:mi><mml:mo>(</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> (<inline-formula id="pcbi.1008240.e086"><alternatives><graphic xlink:href="pcbi.1008240.e086.jpg" id="pcbi.1008240.e086g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M86"><mml:mrow><mml:mi mathvariant="script">C</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>) is defined as the set of unordered pairs of mutations that are introduced on the same edge in <italic>T</italic> (<italic>T</italic>*). At <italic>k</italic>* cells, the median ancestral pair recall was 0.96, the incomparable pair recall was 0.86 and the clustered pair recall was 0.94, showing a reduction in performance from the first sim1, sim2 and sim3 simulations due to the additional errors introduced by PyClone [<xref rid="pcbi.1008240.ref036" ref-type="bibr">36</xref>].</p>
        <p>Finally, we evaluated the performance of PhyDOSE in the presence of cancer cell fraction uncertainty by adapting sim3a instances. We simulated variant and total read counts with a coverage of 1000x. Then, we constructed a binomial proportion 95%-confidence interval using Jeffrey’s prior interval [<xref rid="pcbi.1008240.ref037" ref-type="bibr">37</xref>]. Next, we used the mean of this interval to enumerate the candidate set of trees with SPRUCE [<xref rid="pcbi.1008240.ref010" ref-type="bibr">10</xref>]. Using the method described in Section B.2 in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>, we constructed a confidence interval <inline-formula id="pcbi.1008240.e087"><alternatives><graphic xlink:href="pcbi.1008240.e087.jpg" id="pcbi.1008240.e087g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M87"><mml:mrow><mml:mo>[</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mo>*</mml:mo></mml:msubsup><mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> for each replication (Figure I in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). We performed 100 <italic>in silico</italic> for each replication using both <inline-formula id="pcbi.1008240.e088"><alternatives><graphic xlink:href="pcbi.1008240.e088.jpg" id="pcbi.1008240.e088g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M88"><mml:msubsup><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1008240.e089"><alternatives><graphic xlink:href="pcbi.1008240.e089.jpg" id="pcbi.1008240.e089g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M89"><mml:msubsup><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula>, selecting the tree <inline-formula id="pcbi.1008240.e090"><alternatives><graphic xlink:href="pcbi.1008240.e090.jpg" id="pcbi.1008240.e090g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M90"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> with the maximum support(<italic>T</italic>) as <italic>T</italic>*. We obtained a median percentage of successful trials of 86% (IQR: 44%–93%) and 86% (IQR: 31%–98%) when randomly sampling <inline-formula id="pcbi.1008240.e091"><alternatives><graphic xlink:href="pcbi.1008240.e091.jpg" id="pcbi.1008240.e091g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M91"><mml:msubsup><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1008240.e092"><alternatives><graphic xlink:href="pcbi.1008240.e092.jpg" id="pcbi.1008240.e092g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M92"><mml:msubsup><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula>
<italic>in silico</italic> cells, respectively (Figure I in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>).</p>
      </sec>
      <sec id="sec017">
        <title>Running time</title>
        <p>We performed an empirical run time analysis on a server with two Intel Xeon Gold 5120 CPUs @ 2.20GHz and 512 GB RAM. Performing the power calculation of <italic>k</italic>* is fast [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>] when |Φ| = 1 and the median of |Φ| in our simulations was 1. Therefore, the main bottleneck in PhyDOSE is the determination of Φ for each tree in the candidate using the algorithm presented in Section B.1 in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>. Note that this step is embarrassingly parallelized because Φ is computed independently for each <inline-formula id="pcbi.1008240.e093"><alternatives><graphic xlink:href="pcbi.1008240.e093.jpg" id="pcbi.1008240.e093g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M93"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. However, we leave the parallel <monospace>phydoser</monospace> implementation as future work. To additionally explore how PhyDOSE scales with <inline-formula id="pcbi.1008240.e094"><alternatives><graphic xlink:href="pcbi.1008240.e094.jpg" id="pcbi.1008240.e094g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M94"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, we generated an additional simulation set with 10 mutations and no mutations clusters and set a ten minute time limit on finding the distinguishing features. We calculated the runtime in seconds for each simulation instance when Φ is solved sequentially for each <inline-formula id="pcbi.1008240.e095"><alternatives><graphic xlink:href="pcbi.1008240.e095.jpg" id="pcbi.1008240.e095g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M95"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. The largest input size to complete was 9901 required 619 seconds with 92% of the the spent on finding the distinguishing features. The results are displayed in Figure J in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>.</p>
        <p>In summary, our simulations demonstrate that PhyDOSE’s distinguishing feature analysis results in significantly fewer cells to sequence than SCOPIT [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>] without a subsequent loss in power to identify the true phylogeny. Moreover, we find that PhyDOSE is robust to typical sequencing errors in both the bulk and SCS data as well as violations of model assumptions.</p>
      </sec>
    </sec>
    <sec id="sec018">
      <title>Retrospective analysis of an acute lymphoblastic leukemia patient</title>
      <p>We considered a cohort of six childhood acute lymphoblastic leukemia (ALL) patients whose blood was sequenced using bulk and targeted single-cell DNA sequencing [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>]. The number of sequenced single cells per patient varied between 96 and 150. To validate our approach, we used PhyDOSE to calculate the number <italic>k</italic>(<italic>T</italic>*) of cells needed to identify the true phylogeny <italic>T</italic>* that is consistent with both data types, thereby retrospectively determining whether fewer single cells suffice to determine <italic>T</italic>*, decreasing the cost of replicate experiments. In addition, we assessed whether the calculated number <italic>k</italic>(<italic>T</italic>*) yielded <italic>T</italic>* using <italic>in silico</italic> SCS experiments.</p>
      <p>Due to the absence of published copy-number aberration information for this dataset, we focused our attention on patient 2 whose single-cell phylogeny adhered to the infinite sites assumption and the variant allele frequencies suggested the absence of copy-number aberrations (as detailed in Section C in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). For this patient, 16 autosomal mutations in 115 cells were sequenced [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>]. We note that the authors had no knowledge of the number of cells that would suffice to infer the tumor phylogeny of the patient. Using the infinite sites assumption and assuming the absence of copy-number aberrations, we define the cancer cell fraction, or frequency <italic>f</italic><sub><italic>i</italic></sub> of each mutation <italic>i</italic> in the bulk data as 2 ⋅ VAF(<italic>i</italic>). We define the <italic>SCS mutation frequency</italic> as the fraction of single cells that harbor the mutation. Strikingly, there is a clear correlation between the bulk and SCS mutation frequencies, supporting PhyDOSE’s first assumption (<xref ref-type="fig" rid="pcbi.1008240.g005">Fig 5A</xref>). We excluded mutation <italic>CMTM8</italic> because of a notable discrepancy in frequencies (0.4 in bulk vs. 0.2 in SCS). Using SPRUCE [<xref rid="pcbi.1008240.ref009" ref-type="bibr">9</xref>], we enumerated the set <inline-formula id="pcbi.1008240.e096"><alternatives><graphic xlink:href="pcbi.1008240.e096.jpg" id="pcbi.1008240.e096g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M96"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of trees from the bulk data, yielding over 2.5 million trees. This number is mainly driven by 3 mutations (<italic>ATRNL1</italic>, <italic>LINC00052</italic> and <italic>TRRAP</italic>) with a VAF less than 0.05. Excluding these 3 mutations resulted in a more tractable number of 2, 576 trees. We note that in practice we may similarly exclude mutations because of very low VAFs or less importance in downstream analyses. <xref ref-type="fig" rid="pcbi.1008240.g005">Fig 5B</xref> shows the single tree <inline-formula id="pcbi.1008240.e097"><alternatives><graphic xlink:href="pcbi.1008240.e097.jpg" id="pcbi.1008240.e097g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M97"><mml:mrow><mml:msup><mml:mi>T</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> that was consistent with the cleaned single-cell data, supporting PhyDOSE’s second assumption.</p>
      <fig id="pcbi.1008240.g005" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008240.g005</object-id>
        <label>Fig 5</label>
        <caption>
          <title>Retrospective analysis of ALL patient 2 [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>] and AML cohort [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>] demonstrates that fewer cells suffice for replication.</title>
          <p>Panels (A)-(D) consider ALL patient 2 [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>] and panel (E) considers the AML cohort [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>]. (A) There is a strong correlation between bulk and single-cell mutation frequencies. Colors indicate mutation clusters from SCS data and excluded mutations are indicated by ‘x’. (B) Phylogeny <italic>T</italic>* that is consistent with the SCS and bulk data. (C) Percent of successful outcomes in 100 <italic>in silico</italic> SCS experiments, obtained by sampling from the 115 sequenced cells without replacement following PhyDOSE’s calculated number <italic>k</italic>(<italic>T</italic>*) of cells (103 for <italic>γ</italic> = 0.95 and 50 for <italic>γ</italic> = 0.75). Exclusive outcomes (yellow) uniquely identified <italic>T</italic>* whereas tied outcomes (purple) yielded a small set of candidate phylogenies that include <italic>T</italic>*. (D) Number of candidate phylogenies in the case of ties. (E) The distribution of PhyDOSE’s <italic>k</italic>* for <italic>γ</italic> ∈ {0.75, 0.95} of all patients in the AML cohort with <inline-formula id="pcbi.1008240.e098"><alternatives><graphic id="pcbi.1008240.e098g" xlink:href="pcbi.1008240.e098"/><mml:math id="M98"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">T</mml:mi><mml:mo>|</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></alternatives></inline-formula> as well as the number of cells that were originally sequenced.</p>
        </caption>
        <graphic xlink:href="pcbi.1008240.g005"/>
      </fig>
      <p>We ran PhyDOSE using varying confidence levels <italic>γ</italic> ∈ {0.75, 0.95} and an estimated false negative rate of <italic>β</italic> = 0.2 reported by the authors [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>]. PhyDOSE calculated that <italic>k</italic>(<italic>T</italic>*) = 103 cells suffice to identify <italic>T</italic>* with confidence level <italic>γ</italic> = 0.95. Indeed, performing 100 <italic>in silico</italic> SCS experiments, by sampling <italic>k</italic>(<italic>T</italic>*) cells among the 115 sequenced cells without replacement, yielded a success rate of 99% (<xref ref-type="fig" rid="pcbi.1008240.g005">Fig 5C</xref>).</p>
      <p>To reduce costs, we explored what would have happened retrospectively with a lower confidence level <italic>γ</italic> of 0.75. PhyDOSE calculated that <italic>k</italic>(<italic>T</italic>*) = 50 cells are needed for <italic>γ</italic> = 0.75, which is a significant cost savings over <italic>γ</italic> = 0.95. Performing 100 <italic>in silico</italic> SCS experiments yielded a success rate of uniquely identifying <italic>T</italic>* of 66%, which was lower than the expected rate of 75%. Furthermore, we noted that in an additional 26% of experiments the correct phylogeny <italic>T</italic>* was among the trees with the highest overall support (<xref ref-type="fig" rid="pcbi.1008240.g005">Fig 5C</xref>). The number of trees in the tied set of successes varied from 2 to 6 (Figure L in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>), showing that although PhyDOSE did not uniquely identify the tree, it was able to significantly reduce the original set of 2576 trees (Figure L in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref> and Figure M in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>).</p>
      <p>In summary, this retrospective analysis shows that the true tree for patient 2 could have been identified confidently with fewer cells than the 115 cells initially sequenced [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>]. With a lower confidence level <italic>γ</italic>, PhyDOSE computes that far fewer cells are required, significantly reducing costs but at the expense of a lower success rate of uniquely identifying the true phylogeny. Nevertheless, the resulting SCS experiment will eliminate a large fraction of the original set of candidate phylogenies due to the incorporation of distinguishing features in the PhyDOSE power calculation.</p>
    </sec>
    <sec id="sec019">
      <title>Retrospective analysis of an acute myeloid leukemia cohort</title>
      <p>Morita et al. [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>] performed high-throughput targeted microfluidic single-sequencing using the Tapestri platform [<xref rid="pcbi.1008240.ref038" ref-type="bibr">38</xref>] on a cohort of 77 patients with acute myeloid leukemia (AML). The authors additionally performed bulk sequencing in order to confirm the presence of a mutation in the single-cell data. We note that the authors restricted their analysis to somatic mutations (SNVs and indels) that did not occur in regions affected by additional copy number aberrations.</p>
      <p>Here, we utilized the published bulk sequencing VAFs of the SNVs in each patient, eliminating any mutations not detected via bulk sequencing, to enumerate a set of candidate trees using SPRUCE [<xref rid="pcbi.1008240.ref009" ref-type="bibr">9</xref>]. We restrict our analysis to the 24 patients where bulk sequencing data was available and SPRUCE identified more than one candidate tree. The median number of mutations for these patients was 4 (IQR: 3-5). We retrospectively used PhyDOSE at confidence levels <italic>γ</italic> ∈ {0.75, 0.95} to estimate the cells needed to perform an equivalent single-cell experiment. We used false negative rate <italic>β</italic> = 0.049, which is the mean of the per patient published false negative rate. In the original study, a median of 7, 584 cells per patient (IQR: 6, 194–8, 361) were sequenced. <xref ref-type="fig" rid="pcbi.1008240.g005">Fig 5E</xref> shows the distribution of PhyDOSE <italic>k</italic>* for the 24 patients (median is 2, IQR: 2–6, max is 316) at <italic>γ</italic> ∈ {0.75, 0.95} versus the total number of cells sequenced in [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>]. For <italic>γ</italic> = 0.95, the median value of <italic>k</italic>* was 274 cells (IQR: 230–497). This is a significant reduction from the number of cells sequenced per patient in [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>] with a median percent reduction at confidence level <italic>γ</italic> = 0.95 of 95.4% (IQR: 92.2%–98.0%) (Table A in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>).</p>
      <p>For these 24 patients, Morita et al. [<xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>] sequenced 153, 558 cells while the PhyDOSE design at confidence level <italic>γ</italic> = 0.95 requires 8,144 cells (Table A in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>). Using that a Tapestri run of 10,000 cells costs $795 and including additional sequencing costs of $200 per run with NovaSeq or $1000 per run with MiSeq [<xref rid="pcbi.1008240.ref039" ref-type="bibr">39</xref>, <xref rid="pcbi.1008240.ref040" ref-type="bibr">40</xref>], we estimate the costs of the original study as $15,920 and the estimated costs of the PhyDOSE design as $1,995. This assumes the original study utilized 16 Tapestri runs with NovaSeq while PhyDOSE requires 1 Tapestri run with the more expensive MiSeq to avoid multiplexing. Thus, designing the experiment with PhyDOSE would have yielded a 93.75% cost savings. Further, we note that this study design requires targeted sequencing and that the potential cost savings when the experimental design requires whole genome sequencing would further increase.</p>
    </sec>
    <sec id="sec020">
      <title>Prospective analysis of a non-small cell lung cancer cohort</title>
      <p>Using PhyDOSE, we prospectively determined the number of cells needed to uniquely identify the true phylogeny for the 25 out of 100 patients in the TRACERx non-small-cell lung cancer cohort that have multiple candidate trees [<xref rid="pcbi.1008240.ref003" ref-type="bibr">3</xref>]. The authors previously identified the set <inline-formula id="pcbi.1008240.e099"><alternatives><graphic xlink:href="pcbi.1008240.e099.jpg" id="pcbi.1008240.e099g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M99"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of candidate trees for each patient using CITUP [<xref rid="pcbi.1008240.ref011" ref-type="bibr">11</xref>] after clustering mutations with PyClone [<xref rid="pcbi.1008240.ref036" ref-type="bibr">36</xref>]. The authors also reported the cancer cell fraction of each mutation cluster in each bulk sample. The number of trees in the candidate set for each patient ranged from 2 to 17, with each containing mutation clusters with between 5 and 882 mutations (Table B in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref>).</p>
      <p>Assuming high confidence on the co-occurrence of mutations in a cluster, mutation clusters alleviate the issue of false negatives, i.e. it suffices to only observe a small number of mutations to impute the presence of the other mutations in the same cluster. Here, with a typical SCS false negative rate of 0.2, the probability of all mutations in the smallest cluster (with size 5) dropping out thus equals 0.2<sup>5</sup> = 0.00032, a probability that can be neglected. As such, we set <italic>β</italic> = 0. Unlike in the simulations and the previous real datasets, multiple bulk samples corresponding to distinct spatial locations were available for analysis per patient. In addition to the naive method where we select a single biopsy that minimizes <italic>k</italic>*, we used the multiple biopsy heuristic to infer numbers <bold>k</bold>* of cells for each biopsy. For both methods, we used confidence level <italic>γ</italic> = 0.95.</p>
      <p>Following the naive approach, PhyDOSE returned a finite value of <italic>k</italic>* for 24 out of the 25 patients. The naive approach yielded <italic>k</italic>* = ∞ for patient CRUK0037 because for each of the 5 biopsies there is a tree where every distinguishing feature is not observable. That is, the clonal prevalence of one of the comprising featurettes is 0. By contrast, the heuristic calculated a total of 243 cells (R1: 36; R2: 49; R3: 60; R4: 38 and R5: 51 cells) for this patient. For patients CRUK0013 and CRUK0076, the naive approach required the sequencing of more cells from a single biopsy than the multiple biopsy heuristic (CRUK0013: 1, 051 vs. 215 cells; CRUK0076 47, 479 vs. 48 cells). For the remaining 22 patients, treating the samples independently yields the same number of cells from the selected biopsy as the heuristic. Table B in <xref ref-type="supplementary-material" rid="pcbi.1008240.s001">S1 Text</xref> and <xref ref-type="fig" rid="pcbi.1008240.g006">Fig 6</xref> provide detailed numbers.</p>
      <fig id="pcbi.1008240.g006" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008240.g006</object-id>
        <label>Fig 6</label>
        <caption>
          <title>PhyDOSE multiple biopsy heuristic calculated numbers k* of cells per biopsy for the lung cancer cohort [<xref rid="pcbi.1008240.ref003" ref-type="bibr">3</xref>] at confidence level <italic>γ</italic> = 0.95.</title>
        </caption>
        <graphic xlink:href="pcbi.1008240.g006"/>
      </fig>
      <p>These strikingly low values of total number of cells for the 25 patients with multiple candidate trees and multiple biopsies demonstrate the benefit of using PhyDOSE to strategically optimize the design of follow-up single cell experiments.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec021">
    <title>Discussion</title>
    <p>In this work, we showed that the mutation frequencies <bold>f</bold> and the set <inline-formula id="pcbi.1008240.e100"><alternatives><graphic xlink:href="pcbi.1008240.e100.jpg" id="pcbi.1008240.e100g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M100"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of tumor phylogenies inferred from initial bulk data contain valuable information to provide guidance for follow-up SCS experiments. We introduced PhyDOSE, a method to calculate the number <italic>k</italic>* of single cells needed to infer the true phylogeny <italic>T</italic>* given <bold>f</bold>, <inline-formula id="pcbi.1008240.e101"><alternatives><graphic xlink:href="pcbi.1008240.e101.jpg" id="pcbi.1008240.e101g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M101"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> and a user-specified confidence level <italic>γ</italic>. Underpinning our method is the observation that often only a subset of clones suffices to distinguish one tree <inline-formula id="pcbi.1008240.e102"><alternatives><graphic xlink:href="pcbi.1008240.e102.jpg" id="pcbi.1008240.e102g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M102"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> from the remaining trees <inline-formula id="pcbi.1008240.e103"><alternatives><graphic xlink:href="pcbi.1008240.e103.jpg" id="pcbi.1008240.e103g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M103"><mml:mrow><mml:mi mathvariant="script">T</mml:mi><mml:mo>\</mml:mo><mml:mo>{</mml:mo><mml:mi>T</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. Although PhyDOSE is motivated by the output of deconvolution methods for bulk sequencing, it is agnostic to the method used to obtain the candidate set as long as the clonal prevalence rates of the distinguishing features can be estimated. Thus, the input set <inline-formula id="pcbi.1008240.e104"><alternatives><graphic xlink:href="pcbi.1008240.e104.jpg" id="pcbi.1008240.e104g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M104"><mml:mi mathvariant="script">T</mml:mi></mml:math></alternatives></inline-formula> of candidate trees can be obtained from preliminary single-cell and/or bulk sequencing data. Similarly, PhyDOSE is agnostic to the phylogeny inference method used to analyze data from the proposed SCS experiment. We also provided heuristics for realistic scenarios that arise in practice, such as handling uncertainty in the estimation of cancer cell fractions and the availability of multiple biopsies.</p>
    <p>We validated PhyDOSE using simulations and a retrospective analysis of leukemia patients [<xref rid="pcbi.1008240.ref023" ref-type="bibr">23</xref>, <xref rid="pcbi.1008240.ref027" ref-type="bibr">27</xref>], concluding that PhyDOSE’s computed number <italic>k</italic>* of cells resolves tree ambiguity, even in the presence of SCS errors. Our simulations showed that PhyDOSE remains robust in the presence of sequencing errors and violations of model assumptions, outperforming the competing method, SCOPIT [<xref rid="pcbi.1008240.ref026" ref-type="bibr">26</xref>]. In a prospective analysis, we demonstrated that only a small number of cells suffice to disambiguate the solution space of trees in a recent non-small cell lung cancer cohort [<xref rid="pcbi.1008240.ref003" ref-type="bibr">3</xref>]. In summary, PhyDOSE proposes cost-efficient SCS experiments that will yield high-fidelity phylogenies, which may consequently improve downstream analyses in cancer genomics aimed at deepening our understanding of cancer biology.</p>
    <p>There are several future research directions. First, in the case of multiple bulk samples, although we propose an exact calculation, we only implement a heuristic since the exact calculation does not scale to realistic problem sizes. Developing an implementation of the exact calculation in the case of multiple samples would yield a further cost reduction in the experimental design since the heuristic overestimates the number of cells at given confidence level <italic>γ</italic>. Second, to further reduce SCS costs, we might want to include a mutation selection step as part of our approach to perform targeted rather than whole-genome sequencing. Third, similar ideas can be used to design follow-up sequencing experiments using alternative sequencing technologies such as long read sequencing. Alternatively, performing additional bulk sequencing rather than single-cell sequencing might be more cost-effective, especially when obtaining a bulk sample with distinct clonal prevalences [<xref rid="pcbi.1008240.ref010" ref-type="bibr">10</xref>, <xref rid="pcbi.1008240.ref041" ref-type="bibr">41</xref>]. Fourth, we plan to develop an easy-to-use Shiny user interface to facilitate the use of PhyDOSE for the design of sequencing experiments. Fifth, to improve robustness in the presence of SCS errors, we plan to explore alternative definitions of successful SCS experiment outcomes, requiring that more than one cells is observed of each featurette of a distinguishing feature. This will enable us to address errors such as doublets and false positives in an SCS experiment. Similar ideas can be used to address uncertainty in mutation clusters inferred from bulk sequencing data. Sixth, the concept of distinguishing features may be useful to summarize diverse solution spaces in cancer phylogenetics [<xref rid="pcbi.1008240.ref042" ref-type="bibr">42</xref>]. Finally, we plan to explore evolutionary models beyond the infinite sites model, such as the Dollo parsimony model where mutations might be lost [<xref rid="pcbi.1008240.ref016" ref-type="bibr">16</xref>], requiring a more careful approach to find the distinguishing features of a tree.</p>
  </sec>
  <sec sec-type="supplementary-material" id="sec022">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="pcbi.1008240.s001">
      <label>S1 Text</label>
      <caption>
        <title>Supplementary materials.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1008240.s001.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="pcbi.1008240.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Nowell</surname><given-names>PC</given-names></name>. <article-title>The clonal evolution of tumor cell populations</article-title>. <source>Science</source>. <year>1976</year>;<volume>194</volume>(<issue>4260</issue>):<fpage>23</fpage>–<lpage>8</lpage>. <pub-id pub-id-type="doi">10.1126/science.959840</pub-id><?supplied-pmid 959840?><pub-id pub-id-type="pmid">959840</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>McGranahan</surname><given-names>N</given-names></name>, <name><surname>Favero</surname><given-names>F</given-names></name>, <name><surname>de Bruin</surname><given-names>EC</given-names></name>, <name><surname>Birkbak</surname><given-names>NJ</given-names></name>, <name><surname>Szallasi</surname><given-names>Z</given-names></name>, <name><surname>Swanton</surname><given-names>C</given-names></name>. <article-title>Clonal status of actionable driver events and the timing of mutational processes in cancer evolution</article-title>. <source>Science Translational Medicine</source>. <year>2015</year>;<volume>7</volume>(<issue>283</issue>):<fpage>283ra54</fpage>–<lpage>283ra54</lpage>. <pub-id pub-id-type="doi">10.1126/scitranslmed.aaa1408</pub-id><?supplied-pmid 25877892?><pub-id pub-id-type="pmid">25877892</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Jamal-Hanjani</surname><given-names>M</given-names></name>, <name><surname>Wilson</surname><given-names>GA</given-names></name>, <name><surname>McGranahan</surname><given-names>N</given-names></name>, <name><surname>Birkbak</surname><given-names>NJ</given-names></name>, <name><surname>Watkins</surname><given-names>TB</given-names></name>, <name><surname>Veeriah</surname><given-names>S</given-names></name>, <etal>et al</etal><article-title>Tracking the evolution of non–small-cell lung cancer</article-title>. <source>New England Journal of Medicine</source>. <year>2017</year>;<volume>376</volume>(<issue>22</issue>):<fpage>2109</fpage>–<lpage>2121</lpage>. <pub-id pub-id-type="doi">10.1056/NEJMoa1616288</pub-id><?supplied-pmid 28445112?><pub-id pub-id-type="pmid">28445112</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Zhang</surname><given-names>AW</given-names></name>, <name><surname>McPherson</surname><given-names>A</given-names></name>, <name><surname>Milne</surname><given-names>K</given-names></name>, <name><surname>Kroeger</surname><given-names>DR</given-names></name>, <name><surname>Hamilton</surname><given-names>PT</given-names></name>, <name><surname>Miranda</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>Interfaces of Malignant and Immunologic Clonal Dynamics in Ovarian Cancer</article-title>. <source>Cell</source>. <year>2018</year>;<volume>173</volume>(<issue>7</issue>):<fpage>1755</fpage>–<lpage>1769.e22</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2018.03.073</pub-id><?supplied-pmid 29754820?><pub-id pub-id-type="pmid">29754820</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Łuksza</surname><given-names>M</given-names></name>, <name><surname>Riaz</surname><given-names>N</given-names></name>, <name><surname>Makarov</surname><given-names>V</given-names></name>, <name><surname>Balachandran</surname><given-names>VP</given-names></name>, <name><surname>Hellmann</surname><given-names>MD</given-names></name>, <name><surname>Solovyov</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>A neoantigen fitness model predicts tumour response to checkpoint blockade immunotherapy</article-title>. <source>Nature</source>. <year>2017</year>;<volume>551</volume>(<issue>7681</issue>):<fpage>517</fpage><pub-id pub-id-type="doi">10.1038/nature24473</pub-id><?supplied-pmid 29132144?><pub-id pub-id-type="pmid">29132144</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Turajlic</surname><given-names>S</given-names></name>, <name><surname>Xu</surname><given-names>H</given-names></name>, <name><surname>Litchfield</surname><given-names>K</given-names></name>, <name><surname>Rowan</surname><given-names>A</given-names></name>, <name><surname>Chambers</surname><given-names>T</given-names></name>, <name><surname>Lopez</surname><given-names>JI</given-names></name>, <etal>et al</etal><article-title>Tracking Cancer Evolution Reveals Constrained Routes to Metastases: TRACERx Renal</article-title>. <source>Cell</source>. <year>2018</year>;<volume>173</volume>(<issue>3</issue>):<fpage>581</fpage>–<lpage>594.e12</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2018.03.057</pub-id><?supplied-pmid 29656895?><pub-id pub-id-type="pmid">29656895</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Turajlic</surname><given-names>S</given-names></name>, <name><surname>Xu</surname><given-names>H</given-names></name>, <name><surname>Litchfield</surname><given-names>K</given-names></name>, <name><surname>Rowan</surname><given-names>A</given-names></name>, <name><surname>Horswell</surname><given-names>S</given-names></name>, <name><surname>Chambers</surname><given-names>T</given-names></name>, <etal>et al</etal><article-title>Deterministic Evolutionary Trajectories Influence Primary Tumor Growth: TRACERx Renal</article-title>. <source>Cell</source>. <year>2018</year>;<volume>173</volume>(<issue>3</issue>):<fpage>595</fpage>–<lpage>610.e11</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2018.03.043</pub-id><?supplied-pmid 29656894?><pub-id pub-id-type="pmid">29656894</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Deshwar</surname><given-names>AG</given-names></name>, <name><surname>Vembu</surname><given-names>S</given-names></name>, <name><surname>Yung</surname><given-names>CK</given-names></name>, <name><surname>Jang</surname><given-names>GH</given-names></name>, <name><surname>Stein</surname><given-names>L</given-names></name>, <name><surname>Morris</surname><given-names>Q</given-names></name>. <article-title>PhyloWGS: Reconstructing subclonal composition and evolution from whole-genome sequencing of tumors</article-title>. <source>Genome Biology</source>. <year>2015</year>;<volume>16</volume>(<issue>1</issue>):<fpage>35</fpage><pub-id pub-id-type="doi">10.1186/s13059-015-0602-8</pub-id><?supplied-pmid 25786235?><pub-id pub-id-type="pmid">25786235</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>El-Kebir</surname><given-names>M</given-names></name>, <name><surname>Oesper</surname><given-names>L</given-names></name>, <name><surname>Acheson-Field</surname><given-names>H</given-names></name>, <name><surname>Raphael</surname><given-names>BJ</given-names></name>. <article-title>Reconstruction of clonal trees and tumor composition from multi-sample sequencing data</article-title>. <source>Bioinformatics</source>. <year>2015</year>;<volume>31</volume>(<issue>12</issue>):<fpage>i62</fpage>–<lpage>i70</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btv261</pub-id><?supplied-pmid 26072510?><pub-id pub-id-type="pmid">26072510</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>El-Kebir</surname><given-names>M</given-names></name>, <name><surname>Satas</surname><given-names>G</given-names></name>, <name><surname>Oesper</surname><given-names>L</given-names></name>, <name><surname>Raphael</surname><given-names>BJ</given-names></name>. <article-title>Inferring the Mutational History of a Tumor Using Multi-state Perfect Phylogeny Mixtures</article-title>. <source>Cell Systems</source>. <year>2016</year>;<volume>3</volume>(<issue>1</issue>):<fpage>43</fpage>–<lpage>53</lpage>. <pub-id pub-id-type="doi">10.1016/j.cels.2016.07.004</pub-id><?supplied-pmid 27467246?><pub-id pub-id-type="pmid">27467246</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Malikic</surname><given-names>S</given-names></name>, <name><surname>McPherson</surname><given-names>AW</given-names></name>, <name><surname>Donmez</surname><given-names>N</given-names></name>, <name><surname>Sahinalp</surname><given-names>CS</given-names></name>. <article-title>Clonality Inference in Multiple Tumor Samples using Phylogeny</article-title>. <source>Bioinformatics</source>. <year>2015</year><pub-id pub-id-type="doi">10.1093/bioinformatics/btv003</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Yuan</surname><given-names>K</given-names></name>, <name><surname>Sakoparnig</surname><given-names>T</given-names></name>, <name><surname>Markowetz</surname><given-names>F</given-names></name>, <name><surname>Beerenwinkel</surname><given-names>N</given-names></name>. <article-title>BitPhylogeny: a probabilistic framework for reconstructing intra-tumor phylogenies</article-title>. <source>Genome Biology</source>. <year>2015</year>;<volume>16</volume>(<issue>1</issue>):<fpage>36</fpage><pub-id pub-id-type="doi">10.1186/s13059-015-0592-6</pub-id><?supplied-pmid 25786108?><pub-id pub-id-type="pmid">25786108</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Popic</surname><given-names>V</given-names></name>, <name><surname>Salari</surname><given-names>R</given-names></name>, <name><surname>Hajirasouliha</surname><given-names>I</given-names></name>, <name><surname>Kashef-Haghighi</surname><given-names>D</given-names></name>, <name><surname>West</surname><given-names>RB</given-names></name>, <name><surname>Batzoglou</surname><given-names>S</given-names></name>. <article-title>Fast and scalable inference of multi-sample cancer lineages</article-title>. <source>Genome Biology</source>. <year>2015</year>;<volume>16</volume>(<issue>1</issue>):<fpage>91</fpage><pub-id pub-id-type="doi">10.1186/s13059-015-0647-8</pub-id><?supplied-pmid 25944252?><pub-id pub-id-type="pmid">25944252</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Jahn</surname><given-names>K</given-names></name>, <name><surname>Kuipers</surname><given-names>J</given-names></name>, <name><surname>Beerenwinkel</surname><given-names>N</given-names></name>. <article-title>Tree inference for single-cell data</article-title>. <source>Genome Biology</source>. <year>2016</year>;<volume>17</volume>(<issue>1</issue>):<fpage>86</fpage><pub-id pub-id-type="doi">10.1186/s13059-016-0936-x</pub-id><?supplied-pmid 27149953?><pub-id pub-id-type="pmid">27149953</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Ross</surname><given-names>EM</given-names></name>, <name><surname>Markowetz</surname><given-names>F</given-names></name>. <article-title>OncoNEM: inferring tumor evolution from single-cell sequencing data</article-title>. <source>Genome Biology</source>. <year>2016</year>;<volume>17</volume>(<issue>1</issue>):<fpage>69</fpage><pub-id pub-id-type="doi">10.1186/s13059-016-0929-9</pub-id><?supplied-pmid 27083415?><pub-id pub-id-type="pmid">27083415</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>El-Kebir</surname><given-names>M</given-names></name>. <article-title>SPhyR: tumor phylogeny estimation from single-cell sequencing data under loss and error</article-title>. <source>Bioinformatics</source>. <year>2018</year>;<volume>34</volume>(<issue>17</issue>):<fpage>i671</fpage>–<lpage>i679</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/bty589</pub-id><?supplied-pmid 30423070?><pub-id pub-id-type="pmid">30423070</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Zafar</surname><given-names>H</given-names></name>, <name><surname>Tzen</surname><given-names>A</given-names></name>, <name><surname>Navin</surname><given-names>N</given-names></name>, <name><surname>Chen</surname><given-names>K</given-names></name>, <name><surname>Nakhleh</surname><given-names>L</given-names></name>. <article-title>SiFit: inferring tumor trees from single-cell sequencing data under finite-sites models</article-title>. <source>Genome Biology</source>. <year>2017</year>;<volume>18</volume>(<issue>1</issue>):<fpage>178</fpage><pub-id pub-id-type="doi">10.1186/s13059-017-1311-2</pub-id><?supplied-pmid 28927434?><pub-id pub-id-type="pmid">28927434</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref018">
      <label>18</label>
      <mixed-citation publication-type="journal"><name><surname>Navin</surname><given-names>NE</given-names></name>. <article-title>Cancer genomics: one cell at a time</article-title>. <source>Genome Biology</source>. <year>2014</year>;<volume>15</volume>(<issue>8</issue>):<fpage>452</fpage><pub-id pub-id-type="doi">10.1186/s13059-014-0452-9</pub-id><?supplied-pmid 25222669?><pub-id pub-id-type="pmid">25222669</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref019">
      <label>19</label>
      <mixed-citation publication-type="journal"><name><surname>Malikic</surname><given-names>S</given-names></name>, <name><surname>Jahn</surname><given-names>K</given-names></name>, <name><surname>Kuipers</surname><given-names>J</given-names></name>, <name><surname>Sahinalp</surname><given-names>SC</given-names></name>, <name><surname>Beerenwinkel</surname><given-names>N</given-names></name>. <article-title>Integrative inference of subclonal tumour evolution from single-cell and bulk sequencing data</article-title>. <source>Nature Communications</source>. <year>2019</year>;<volume>10</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>12</lpage>. <pub-id pub-id-type="doi">10.1038/s41467-019-10737-5</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Malikic</surname><given-names>S</given-names></name>, <name><surname>Mehrabadi</surname><given-names>FR</given-names></name>, <name><surname>Ciccolella</surname><given-names>S</given-names></name>, <name><surname>Rahman</surname><given-names>MK</given-names></name>, <name><surname>Ricketts</surname><given-names>C</given-names></name>, <name><surname>Haghshenas</surname><given-names>E</given-names></name>, <etal>et al</etal><article-title>PhISCS: a combinatorial approach for subperfect tumor phylogeny reconstruction via integrative use of single-cell and bulk sequencing data</article-title>. <source>Genome Research</source>. <year>2019</year>;<volume>29</volume>(<issue>11</issue>):<fpage>1860</fpage>–<lpage>1877</lpage>. <pub-id pub-id-type="doi">10.1101/gr.234435.118</pub-id><?supplied-pmid 31628256?><pub-id pub-id-type="pmid">31628256</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref021">
      <label>21</label>
      <mixed-citation publication-type="journal"><name><surname>Kuboki</surname><given-names>Y</given-names></name>, <name><surname>Fischer</surname><given-names>CG</given-names></name>, <name><surname>Guthrie</surname><given-names>VB</given-names></name>, <name><surname>Huang</surname><given-names>W</given-names></name>, <name><surname>Yu</surname><given-names>J</given-names></name>, <name><surname>Chianchiano</surname><given-names>P</given-names></name>, <etal>et al</etal><article-title>Single-cell sequencing defines genetic heterogeneity in pancreatic cancer precursor lesions</article-title>. <source>The Journal of Pathology</source>. <year>2019</year>;<volume>247</volume>(<issue>3</issue>):<fpage>347</fpage>–<lpage>356</lpage>. <pub-id pub-id-type="doi">10.1002/path.5194</pub-id><?supplied-pmid 30430578?><pub-id pub-id-type="pmid">30430578</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref022">
      <label>22</label>
      <mixed-citation publication-type="journal"><name><surname>Leung</surname><given-names>ML</given-names></name>, <name><surname>Davis</surname><given-names>A</given-names></name>, <name><surname>Gao</surname><given-names>R</given-names></name>, <name><surname>Casasent</surname><given-names>A</given-names></name>, <name><surname>Wang</surname><given-names>Y</given-names></name>, <name><surname>Sei</surname><given-names>E</given-names></name>, <etal>et al</etal><article-title>Single cell DNA sequencing reveals a late-dissemination model in metastatic colorectal cancer</article-title>. <source>Genome Research</source>. <year>2017</year>; p. gr.209973.116. <pub-id pub-id-type="doi">10.1101/gr.209973.116</pub-id><?supplied-pmid 28546418?><pub-id pub-id-type="pmid">28546418</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Gawad</surname><given-names>C</given-names></name>, <name><surname>Koh</surname><given-names>W</given-names></name>, <name><surname>Quake</surname><given-names>SR</given-names></name>. <article-title>Dissecting the clonal origins of childhood acute lymphoblastic leukemia by single-cell genomics</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2014</year>;<volume>111</volume>(<issue>50</issue>):<fpage>17947</fpage>–<lpage>17952</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1420822111</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref024">
      <label>24</label>
      <mixed-citation publication-type="journal"><name><surname>McPherson</surname><given-names>A</given-names></name>, <name><surname>Roth</surname><given-names>A</given-names></name>, <name><surname>Laks</surname><given-names>E</given-names></name>, <name><surname>Masud</surname><given-names>T</given-names></name>, <name><surname>Bashashati</surname><given-names>A</given-names></name>, <name><surname>Zhang</surname><given-names>AW</given-names></name>, <etal>et al</etal><article-title>Divergent modes of clonal spread and intraperitoneal mixing in high-grade serous ovarian cancer</article-title>. <source>Nature Genetics</source>. <year>2016</year>;. <pub-id pub-id-type="doi">10.1038/ng.3573</pub-id><?supplied-pmid 27182968?><pub-id pub-id-type="pmid">27182968</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Kim</surname><given-names>C</given-names></name>, <name><surname>Gao</surname><given-names>R</given-names></name>, <name><surname>Sei</surname><given-names>E</given-names></name>, <name><surname>Brandt</surname><given-names>R</given-names></name>, <name><surname>Hartman</surname><given-names>J</given-names></name>, <name><surname>Hatschek</surname><given-names>T</given-names></name>, <etal>et al</etal><article-title>Chemoresistance evolution in triple-negative breast cancer delineated by single-cell sequencing</article-title>. <source>Cell</source>. <year>2018</year>;<volume>173</volume>(<issue>4</issue>):<fpage>879</fpage>–<lpage>893</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2018.03.041</pub-id><?supplied-pmid 29681456?><pub-id pub-id-type="pmid">29681456</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref026">
      <label>26</label>
      <mixed-citation publication-type="journal"><name><surname>Davis</surname><given-names>A</given-names></name>, <name><surname>Gao</surname><given-names>R</given-names></name>, <name><surname>Navin</surname><given-names>NE</given-names></name>. <article-title>SCOPIT: sample size calculations for single-cell sequencing experiments</article-title>. <source>BMC Bioinformatics</source>. <year>2019</year>;<volume>20</volume>(<issue>1</issue>):<fpage>566</fpage><pub-id pub-id-type="doi">10.1186/s12859-019-3167-9</pub-id><?supplied-pmid 31718533?><pub-id pub-id-type="pmid">31718533</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref027">
      <label>27</label>
      <mixed-citation publication-type="journal"><name><surname>Morita</surname><given-names>K</given-names></name>, <name><surname>Wang</surname><given-names>F</given-names></name>, <name><surname>Jahn</surname><given-names>K</given-names></name>, <name><surname>Kuipers</surname><given-names>J</given-names></name>, <name><surname>Yan</surname><given-names>Y</given-names></name>, <name><surname>Matthews</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>Clonal Evolution of Acute Myeloid Leukemia Revealed by High-Throughput Single-Cell Genomics</article-title>. <source>bioRxiv</source>. <year>2020</year>.</mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref028">
      <label>28</label>
      <mixed-citation publication-type="journal"><name><surname>Bolli</surname><given-names>N</given-names></name>, <name><surname>Avet-Loiseau</surname><given-names>H</given-names></name>, <name><surname>Wedge</surname><given-names>DC</given-names></name>, <name><surname>Van Loo</surname><given-names>P</given-names></name>, <name><surname>Alexandrov</surname><given-names>LB</given-names></name>, <name><surname>Martincorena</surname><given-names>I</given-names></name>, <etal>et al</etal><article-title>Heterogeneity of genomic evolution and mutational profiles in multiple myeloma</article-title>. <source>Nature Communications</source>. <year>2014</year>;<volume>5</volume><pub-id pub-id-type="doi">10.1038/ncomms3997</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref029">
      <label>29</label>
      <mixed-citation publication-type="journal"><name><surname>Dentro</surname><given-names>SC</given-names></name>, <name><surname>Wedge</surname><given-names>DC</given-names></name>, <name><surname>Van Loo</surname><given-names>P</given-names></name>. <article-title>Principles of Reconstructing the Subclonal Architecture of Cancers</article-title>. <source>Cold Spring Harbor Perspectives in Medicine</source>. <year>2017</year>;<volume>7</volume>(<issue>8</issue>):<fpage>a026625</fpage><pub-id pub-id-type="doi">10.1101/cshperspect.a026625</pub-id><?supplied-pmid 28270531?><pub-id pub-id-type="pmid">28270531</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Stephens</surname><given-names>PJ</given-names></name>, <name><surname>Tarpey</surname><given-names>PS</given-names></name>, <name><surname>Davies</surname><given-names>H</given-names></name>, <name><surname>Van Loo</surname><given-names>P</given-names></name>, <name><surname>Greenman</surname><given-names>C</given-names></name>, <name><surname>Wedge</surname><given-names>DC</given-names></name>, <etal>et al</etal><article-title>The landscape of cancer genes and mutational processes in breast cancer</article-title>. <source>Nature</source>. <year>2012</year>;<volume>486</volume>(<issue>7403</issue>):<fpage>400</fpage>–<lpage>404</lpage>. <pub-id pub-id-type="doi">10.1038/nature11017</pub-id><?supplied-pmid 22722201?><pub-id pub-id-type="pmid">22722201</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref031">
      <label>31</label>
      <mixed-citation publication-type="journal"><name><surname>Levin</surname><given-names>B</given-names></name>. <article-title>A Representation for Multinomial Cumulative Distribution Functions</article-title>. <source>The Annals of Statistics</source>. <year>1981</year>;<volume>9</volume>(<issue>5</issue>):<fpage>1123</fpage>–<lpage>1126</lpage>. <pub-id pub-id-type="doi">10.1214/aos/1176345593</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref032">
      <label>32</label>
      <mixed-citation publication-type="journal"><name><surname>Fu</surname><given-names>Y</given-names></name>, <name><surname>Li</surname><given-names>C</given-names></name>, <name><surname>Lu</surname><given-names>S</given-names></name>, <name><surname>Zhou</surname><given-names>W</given-names></name>, <name><surname>Tang</surname><given-names>F</given-names></name>, <name><surname>Xie</surname><given-names>XS</given-names></name>, <etal>et al</etal><article-title>Uniform and accurate single-cell sequencing based on emulsion whole-genome amplification</article-title>. <source>Proceedings of the National Academy of Sciences of the United States of America</source>. <year>2015</year>;<volume>112</volume>(<issue>38</issue>):<fpage>11923</fpage>–<lpage>11928</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1513988112</pub-id><?supplied-pmid 26340991?><pub-id pub-id-type="pmid">26340991</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref033">
      <label>33</label>
      <mixed-citation publication-type="journal"><name><surname>Zafar</surname><given-names>H</given-names></name>, <name><surname>Navin</surname><given-names>N</given-names></name>, <name><surname>Chen</surname><given-names>K</given-names></name>, <name><surname>Nakhleh</surname><given-names>L</given-names></name>. <article-title>SiCloneFit: Bayesian inference of population structure, genotype, and phylogeny of tumor clones from single-cell genome sequencing data</article-title>. <source>Genome Research</source>. <year>2019</year>;<volume>29</volume>(<issue>11</issue>):<fpage>1847</fpage>–<lpage>1859</lpage>. <pub-id pub-id-type="doi">10.1101/gr.243121.118</pub-id><?supplied-pmid 31628257?><pub-id pub-id-type="pmid">31628257</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref034">
      <label>34</label>
      <mixed-citation publication-type="journal"><name><surname>El-Kebir</surname><given-names>M</given-names></name>, <name><surname>Satas</surname><given-names>G</given-names></name>, <name><surname>Raphael</surname><given-names>BJ</given-names></name>. <article-title>Inferring parsimonious migration histories for metastatic cancers</article-title>. <source>Nature Genetics</source>. <year>2018</year>;<volume>50</volume>(<issue>5</issue>):<fpage>718</fpage>–<lpage>726</lpage>. <pub-id pub-id-type="doi">10.1038/s41588-018-0106-z</pub-id><?supplied-pmid 29700472?><pub-id pub-id-type="pmid">29700472</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref035">
      <label>35</label>
      <mixed-citation publication-type="journal"><name><surname>Prüfer</surname><given-names>H</given-names></name>. <article-title>Neuer beweis eines satzes uber permutationen</article-title>. <source>Arch Math Phys</source>. <year>1918</year>;<volume>27</volume>:<fpage>742</fpage>–<lpage>4</lpage>.</mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref036">
      <label>36</label>
      <mixed-citation publication-type="journal"><name><surname>Roth</surname><given-names>A</given-names></name>, <name><surname>Khattra</surname><given-names>J</given-names></name>, <name><surname>Yap</surname><given-names>D</given-names></name>, <name><surname>Wan</surname><given-names>A</given-names></name>, <name><surname>Laks</surname><given-names>E</given-names></name>, <name><surname>Biele</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>PyClone: statistical inference of clonal population structure in cancer</article-title>. <source>Nature Methods</source>. <year>2014</year>;<volume>11</volume>(<issue>4</issue>):<fpage>396</fpage>–<lpage>398</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.2883</pub-id><?supplied-pmid 24633410?><pub-id pub-id-type="pmid">24633410</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref037">
      <label>37</label>
      <mixed-citation publication-type="journal"><name><surname>Brown</surname><given-names>LD</given-names></name>, <name><surname>Cai</surname><given-names>TT</given-names></name>, <name><surname>DasGupta</surname><given-names>A</given-names></name>. <article-title>Interval estimation for a binomial proportion</article-title>. <source>Statistical science</source>. <year>2001</year>; p. <fpage>101</fpage>–<lpage>117</lpage>.</mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref038">
      <label>38</label>
      <mixed-citation publication-type="journal"><name><surname>Pellegrino</surname><given-names>M</given-names></name>, <name><surname>Sciambi</surname><given-names>A</given-names></name>, <name><surname>Treusch</surname><given-names>S</given-names></name>, <name><surname>Durruthy-Durruthy</surname><given-names>R</given-names></name>, <name><surname>Gokhale</surname><given-names>K</given-names></name>, <name><surname>Jacob</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>High-throughput single-cell DNA sequencing of acute myeloid leukemia tumors with droplet microfluidics</article-title>. <source>Genome Research</source>. <year>2018</year>;<volume>28</volume>(<issue>9</issue>):<fpage>1345</fpage>–<lpage>1352</lpage>. <pub-id pub-id-type="doi">10.1101/gr.232272.117</pub-id><?supplied-pmid 30087104?><pub-id pub-id-type="pmid">30087104</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref039">
      <label>39</label>
      <mixed-citation publication-type="other">DECIBIO INSIGHTS. Mission Bio Launches Single-Cell DNA Analysis Platform at ASHG 2017; 2017. Available from: <ext-link ext-link-type="uri" xlink:href="https://www.decibio.com/2017/10/17/mission-bio-launches-single-cell-dna-analysis-platform-ashg-2017/">https://www.decibio.com/2017/10/17/mission-bio-launches-single-cell-dna-analysis-platform-ashg-2017/</ext-link>.</mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref040">
      <label>40</label>
      <mixed-citation publication-type="other">Bioinformatics. ASHG 2017: New Single-cell, CRISPR and NGS Products Highlight Lab Technology’s Progress; 2017. Available from: <ext-link ext-link-type="uri" xlink:href="https://bioinfoinc.com/digest/ashg-2017-new-single-cell-crispr-ngs-products-highlight-lab-technologys-progress/">https://bioinfoinc.com/digest/ashg-2017-new-single-cell-crispr-ngs-products-highlight-lab-technologys-progress/</ext-link>.</mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref041">
      <label>41</label>
      <mixed-citation publication-type="journal"><name><surname>Qi</surname><given-names>Y</given-names></name>, <name><surname>Pradhan</surname><given-names>D</given-names></name>, <name><surname>El-Kebir</surname><given-names>M</given-names></name>. <article-title>Implications of non-uniqueness in phylogenetic deconvolution of bulk DNA samples of tumors</article-title>. <source>Algorithms for Molecular Biology</source>. <year>2019</year>;<volume>14</volume>(<issue>1</issue>):<fpage>23</fpage>–<lpage>14</lpage>. <pub-id pub-id-type="doi">10.1186/s13015-019-0155-6</pub-id><pub-id pub-id-type="pmid">31832082</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008240.ref042">
      <label>42</label>
      <mixed-citation publication-type="journal"><name><surname>Aguse</surname><given-names>N</given-names></name>, <name><surname>Qi</surname><given-names>Y</given-names></name>, <name><surname>El-Kebir</surname><given-names>M</given-names></name>. <article-title>Summarizing the solution space in tumor phylogeny inference by multiple consensus trees</article-title>. <source>Bioinformatics</source>. <year>2019</year>;<volume>35</volume>(<issue>14</issue>):<fpage>i408</fpage>–<lpage>i416</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btz312</pub-id><?supplied-pmid 31510657?><pub-id pub-id-type="pmid">31510657</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article id="pcbi.1008240.r001" article-type="aggregated-review-documents">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1008240.r001</article-id>
    <title-group>
      <article-title>Decision Letter 0</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Markowetz</surname>
          <given-names>Florian</given-names>
        </name>
        <role>Deputy Editor</role>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nagarajan</surname>
          <given-names>Niranjan</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2020 Markowetz, Nagarajan</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>Markowetz, Nagarajan</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article id="rel-obj001" ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1008240" related-article-type="reviewed-article"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>0</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">1 Jun 2020</named-content>
    </p>
    <p>Dear Dr. El-Kebir,</p>
    <p>Thank you very much for submitting your manuscript "PhyDOSE: Design of Follow-up Single-cell Sequencing Experiments of Tumors" for consideration at PLOS Computational Biology.</p>
    <p>As with all papers reviewed by the journal, your manuscript was reviewed by members of the editorial board and by several independent reviewers. In light of the reviews (below this email), we would like to invite the resubmission of a significantly-revised version that takes into account the reviewers' comments.</p>
    <p>While the reviewers acknowledge that this work represents a rigorous methodological contribution to this field, they raise concerns about comparisons with other methods (reviewer #3) and practical limitations (reviewer #1, #2) that need to be addressed in a revised manuscript.</p>
    <p>We cannot make any decision about publication until we have seen the revised manuscript and your response to the reviewers' comments. Your revised manuscript is also likely to be sent to reviewers for further evaluation.</p>
    <p>When you are ready to resubmit, please upload the following:</p>
    <p>[1] A letter containing a detailed list of your responses to the review comments and a description of the changes you have made in the manuscript. Please note while forming your response, if your article is accepted, you may have the opportunity to make the peer review history publicly available. The record will include editor decision letters (with reviews) and your responses to reviewer comments. If eligible, we will contact you to opt in or out.</p>
    <p>[2] Two versions of the revised manuscript: one with either highlights or tracked changes denoting where the text has been changed; the other a clean version (uploaded as the manuscript file).</p>
    <p>Important additional instructions are given below your reviewer comments.</p>
    <p>Please prepare and submit your revised manuscript within 60 days. If you anticipate any delay, please let us know the expected resubmission date by replying to this email. Please note that revised manuscripts received after the 60-day due date may require evaluation and peer review similar to newly submitted manuscripts.</p>
    <p>Thank you again for your submission. We hope that our editorial process has been constructive so far, and we welcome your feedback at any time. Please don't hesitate to contact us if you have any questions or comments.</p>
    <p>Sincerely,</p>
    <p>Florian Markowetz</p>
    <p>Deputy Editor</p>
    <p>PLOS Computational Biology</p>
    <p>Florian Markowetz</p>
    <p>Deputy Editor</p>
    <p>PLOS Computational Biology</p>
    <p>***********************</p>
    <p>While the reviewers acknowledge that this work represents a rigorous methodological contribution to this field, they raise concerns about comparisons with other methods (reviewer #3) and practical limitations (reviewer #1, #2) that need to be addressed in a revised manuscript.</p>
    <p>Reviewer's Responses to Questions</p>
    <p>
      <bold>Comments to the Authors:</bold>
    </p>
    <p>
      <bold>Please note here if the review is uploaded as an attachment.</bold>
    </p>
    <p>Reviewer #1: This paper develops a method, PhyDOSE, for designing follow-up single-cell sequencing experiments to resolve tumor phylogenies based on initial bulk sequence analysis. This paper is based on a conference submission that has already been through a round of revision in response to the conference reviewers. Although I was not one of the reviewers of the conference version, I recognize that it is more polished than a typical new submission as a result and that the conference reviewers already raised what would have been some of my concerns about the paper. I therefore read it in the spirit of a paper that has already been through a round of revisions. The general problem is well motivated. Although the cost of single-cell sequencing is dropping rapidly, it remains costly for large studies and there is good reason to use it efficiently. The approach proposed here appears sensible and technically sound, making good use of prior theory of the authors on tumor phylogeny enumeration, adding robust handling for common kinds of data errors in single-cell sequencing, and connecting the theory nicely to a rigorous new probabilistic model for use in power calculations. The method is well backed up by empirical analysis of simulated data and three real cohorts, showing the method to be effective and to improve substantially on naïve approaches in at least some cases. Some natural concerns about the approach in the conference version, such as robustness to biased sampling or to failing to identify some clones, were raised by the conference reviewers and effectively rebutted by new experiments. The method does still make some restrictive assumptions and limitations, as was pointed out by the prior reviewers. While these are not fully resolved even in the revision, the authors do have fair responses for them.</p>
    <p>Given this, I have little to add in the way of criticism and would consider my remaining points largely discretionary. My only real substantive concern is that some of the limitations of the method raised in the conference reviews are still limitations and one might question whether it is sufficient in some cases to note them and defer them to future work. I refer here essentially to the points raised in the final paragraph of Discussion.</p>
    <p>In that regard, the use of the infinite sites model is questionable enough that one could argue it needs to be at least demonstrated that the method is reasonably robust to violations. While many methods in this space use the infinite sites assumption, it is well established that it is not consistently accurate and is at least becoming more accepted that methods must handle some violations. I think it is fine to defer to future work extension to a more robust model like Dollo parsimony, which would understandably require some significant changes to the theory and algorithms, so long as the method works reasonably well on data that violates the assumption without that.</p>
    <p>The paper also considers a criticism about the use of single rather than multiple bulk samples and defers that question to future work. There is good evidence that phylogeny inference from single bulk samples is simply not accurate enough to be the basis for even the initial step of a combined bulk and single-cell study, and so one might reasonably argue that accommodating multiple bulk samples is so important that it should be part of even a first method of this class.</p>
    <p>I will also just raise as a discretionary thought some other possible scenarios where I could imagine this method being useful. I wonder if the method could be applied if there has already been some bulk and some single-cell sequencing done, as in some studies to date, and we want to plan further single-cell sequencing. Would the method be adaptable to such a case? Or could it do better if we assume multiple batches of single-cell sequencing, with an opportunity to reevaluate after each batch? I can accept that these are getting far enough afield that they do not need to be solved in this paper, but might also be questions for future work.</p>
    <p>Reviewer #2: This paper discusses PhyDOSE, a method to perform power calculation for single-cell sequencing, when we need to disentangle the clone tree associated to a tumour sample. The idea is that, while we often perform a bulk sequencing experiment to assess a number of possible trees that fit the mutation allele frequency (VAF), it happens often that more than one tree are equally-likely to fit the data. If we can generate single-cell sequencing data of a number X of single-cells, then we can disambuiguate which tree best fits the data. PhyDOSE is a method that tells us what should be the value of X to bound the probability that we can determine a unique best tree.</p>
    <p>The paper is clear, and the problem is known in the field. There is abundant literature explaining/ showing that determining a single tree from bulk data can be challenging, therefore the solution of sequencing single cells can be appealing, as much as other approaches. The ILP formulation of the problem seems to be correct, and the results and methods consistent with the theory.</p>
    <p>However, there are some major limitations of the work in the current form. I think fixing them would make the main message (a computational design technology) appealing.</p>
    <p>- I do not think that you can prescind from the fact that many datasets collect multiple tumour bulks at once, as you also note in your Discussion. This requires a multivariate problem definition, in principle, that you need at least to discuss. There are multi-region sequencing simulators that you can use to this respect, if you want to try to simualte data. The current work presents instead an independence assumption, and uses that in the current analyses (sect "Prospective Analysis of a Non-small Cell Lung Cancer Cohort"). The choice of PhyDOSE is to minimise the number of cell estimates across all samples; is this supported by some consideration?</p>
    <p>- [related to the above] what do the author mean by saying that "Mutation clusters alleviate the issue of false negatives, i.e. it suffices to only observe a single mutation to impute the presence of the other mutations in the same cluster.". Imputation can be tricky; if I observe a low-VAF mutation in 3 out of 4 biopsies, I think that the imputation should depend on the coverage at the locus. If high-enough, imputation can be supported by a statistical argument based on Binomial testing on read counts (what are the odds of not-seeing a mutation with a certain VAF with my current coverage). If low, imputation might generate false positives. Is it possible to frame this uncertainty in PhyDOSE's computation of the optimal number of cells for these scenarios?</p>
    <p>- You present some reduction in cells numbers that are not exceptionally striking. Can you justify a difference in sequencing cost for the effort of using your design method? At the end of the day, if one does not save a substantial amount of sequencing costs, why would he/ she bother using PhyDOSE? I think you need to provide stronger evidence of why your computations can be important for a molecular biologist that is designing a new experiment. If the reduction is not substantial, I think that your contribution would be just theoretical and could be less appealing. In the context of sequencing technologies, you should put effort to understand the cost for standard experimental setups (e.g., I presume you would be using either a deep sequencing panel, or a digital-PCR assay) and their possible parametrisation. On your real data you can effectively discuss these reductions (assuming certain costs since you did not generate the data).</p>
    <p>- It is increasingly evident that a number of "clusters" identified through standard VAF deconvolution method can represent random ancestors constituted by neutrally evolving mutations (<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1101/586560">https://doi.org/10.1101/586560</ext-link>). Clustering tail mutations is also wrong because tail lineages are polyphyletic. You should discuss this when you consider the problem of using certain subsets of mutations. Since some of the input clusters should be removed from the clone trees, and you could discuss what happens if you end up taking cells from those clusters to design your experiment. This is important because many of your inconsistencies in assembling a bulk clone tree stem from low-frequency mutations, but the low-VAF spectrum is where most of the neutral mutations reside; if those are removed how often is it that you remain with a non-identifiable treee?</p>
    <p>Reviewer #3: The authors report on a new method, PhyDOSE, for determining the number of cells to sequence in a single-cell sequencing experiment based on information from bulk data. The bulk data is first used to estimate the mutation frequencies and then this information is used to estimate the number of cells. The authors state that their method improves upon SCOPIT, since the latter assumes knowledge about the number of clones and the frequency of the smallest clone. The authors study the performance of their method on simulated and empirical datasets.</p>
    <p>I would like the authors to address the following questions:</p>
    <p>1. How does the reliability of the mutations called from the bulk data affect the performance of the method? What if some/many of those mutations were wrong?</p>
    <p>2. Why not compare to SCOPIT? After all, there are method for estimating clonality from bulk data. Why not run such a method, get the number of clones and frequencies, and use those as inputs to SCOPIT? I think it's very important to do this comparison.</p>
    <p>3. I think the model of evolution must be incorporated into the problem formulation, as the number of cells and mutations needed depends on whether the infinite-sites assumptions holds or not.</p>
    <p>My main issue with this method (which applies to SCOPIT as well, I feel, even though I don't know the details of how SCOPIT works) is that the number of cells to sequence is not the only/main quantity of interest in in an SCS experiment. The number of spatial regions to sample and sequence in order to capture the heterogeneity is as important, and that number must be a lower bound on the number of cells to sequence. So, I'm not sure how useful these methods will be in practice. Yes, SCOPIT has been published for a year only, but it still has no real citations (the two citations it has are this article and one that develops a simpler method for scRNA data). As scDNAseq becomes even less expensive, I doubt the number of cells is the bottleneck; it's the spatial regions to sample and sequence (indeed, some recent studies, mainly focused on CNA detection, are now sequencing thousands of single cells).</p>
    <p>**********</p>
    <p>
      <bold>Have all data underlying the figures and results presented in the manuscript been provided?</bold>
    </p>
    <p>Large-scale datasets should be made available via a public repository as described in the <italic>PLOS Computational Biology</italic>
<ext-link ext-link-type="uri" xlink:href="http://journals.plos.org/ploscompbiol/s/data-availability">data availability policy</ext-link>, and numerical data that underlies graphs or summary statistics should be provided in spreadsheet form as supporting information.</p>
    <p>Reviewer #1: Yes</p>
    <p>Reviewer #2: Yes</p>
    <p>Reviewer #3: Yes</p>
    <p>**********</p>
    <p>PLOS authors have the option to publish the peer review history of their article (<ext-link ext-link-type="uri" xlink:href="https://journals.plos.org/ploscompbiol/s/editorial-and-peer-review-process#loc-peer-review-history">what does this mean?</ext-link>). If published, this will include your full peer review and any attached files.</p>
    <p>If you choose “no”, your identity will remain anonymous but your review may still be made public.</p>
    <p><bold>Do you want your identity to be public for this peer review?</bold> For information about this choice, including consent withdrawal, please see our <ext-link ext-link-type="uri" xlink:href="https://www.plos.org/privacy-policy">Privacy Policy</ext-link>.</p>
    <p>Reviewer #1: No</p>
    <p>Reviewer #2: No</p>
    <p>Reviewer #3: No</p>
    <p>
      <underline>Figure Files:</underline>
    </p>
    <p>While revising your submission, please upload your figure files to the Preflight Analysis and Conversion Engine (PACE) digital diagnostic tool, <underline><ext-link ext-link-type="uri" xlink:href="https://pacev2.apexcovantage.com/" xlink:type="simple">https://pacev2.apexcovantage.com</ext-link></underline>. PACE helps ensure that figures meet PLOS requirements. To use PACE, you must first register as a user. Then, login and navigate to the UPLOAD tab, where you will find detailed instructions on how to use the tool. If you encounter any issues or have any questions when using PACE, please email us at <underline><email xlink:type="simple">figures@plos.org</email></underline>.</p>
    <p>
      <underline>Data Requirements:</underline>
    </p>
    <p>Please note that, as a condition of publication, PLOS' data policy requires that you make available all data used to draw the conclusions outlined in your manuscript. Data must be deposited in an appropriate repository, included within the body of the manuscript, or uploaded as supporting information. This includes all numerical values that were used to generate graphs, histograms etc.. For an example in PLOS Biology see here: <ext-link ext-link-type="uri" xlink:href="http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5">http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5</ext-link>.</p>
    <p>
      <underline>Reproducibility:</underline>
    </p>
    <p>To enhance the reproducibility of your results, PLOS recommends that you deposit laboratory protocols in protocols.io, where a protocol can be assigned its own identifier (DOI) such that it can be cited independently in the future. For instructions, please see <underline><ext-link ext-link-type="uri" xlink:href="http://journals.plos.org/plospathogens/s/submission-guidelines" xlink:type="simple">http://journals.plos.org/compbiol/s/submission-guidelines#loc-materials-and-methods</ext-link></underline></p>
  </body>
</sub-article>
<sub-article id="pcbi.1008240.r002" article-type="author-comment">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1008240.r002</article-id>
    <title-group>
      <article-title>Author response to Decision Letter 0</article-title>
    </title-group>
    <related-article id="rel-obj002" ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1008240" related-article-type="editor-report"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>1</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="author-response-date">19 Jul 2020</named-content>
    </p>
    <supplementary-material content-type="local-data" id="pcbi.1008240.s002">
      <label>Attachment</label>
      <caption>
        <p>Submitted filename: <named-content content-type="submitted-filename">response.pdf</named-content></p>
      </caption>
      <media xlink:href="pcbi.1008240.s002.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </body>
</sub-article>
<sub-article id="pcbi.1008240.r003" article-type="aggregated-review-documents">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1008240.r003</article-id>
    <title-group>
      <article-title>Decision Letter 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Markowetz</surname>
          <given-names>Florian</given-names>
        </name>
        <role>Deputy Editor</role>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nagarajan</surname>
          <given-names>Niranjan</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2020 Markowetz, Nagarajan</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>Markowetz, Nagarajan</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article id="rel-obj003" ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1008240" related-article-type="reviewed-article"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>1</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">12 Aug 2020</named-content>
    </p>
    <p>Dear Dr. El-Kebir,</p>
    <p>We are pleased to inform you that your manuscript 'PhyDOSE: Design of Follow-up Single-cell Sequencing Experiments of Tumors' has been provisionally accepted for publication in PLOS Computational Biology.</p>
    <p>Before your manuscript can be formally accepted you will need to complete some formatting changes, which you will receive in a follow up email. A member of our team will be in touch with a set of requests.</p>
    <p>Please note that your manuscript will not be scheduled for publication until you have made the required changes, so a swift response is appreciated.</p>
    <p>IMPORTANT: The editorial review process is now complete. PLOS will only permit corrections to spelling, formatting or significant scientific errors from this point onwards. Requests for major changes, or any which affect the scientific understanding of your work, will cause delays to the publication date of your manuscript.</p>
    <p>Should you, your institution's press office or the journal office choose to press release your paper, you will automatically be opted out of early publication. We ask that you notify us now if you or your institution is planning to press release the article. All press must be co-ordinated with PLOS.</p>
    <p>Thank you again for supporting Open Access publishing; we are looking forward to publishing your work in PLOS Computational Biology. </p>
    <p>Best regards,</p>
    <p>Niranjan Nagarajan</p>
    <p>Associate Editor</p>
    <p>PLOS Computational Biology</p>
    <p>Florian Markowetz</p>
    <p>Deputy Editor</p>
    <p>PLOS Computational Biology</p>
    <p>***********************************************************</p>
    <p>Reviewer's Responses to Questions</p>
    <p>
      <bold>Comments to the Authors:</bold>
    </p>
    <p>
      <bold>Please note here if the review is uploaded as an attachment.</bold>
    </p>
    <p>Reviewer #1: The revisions have satisfied all of my concerns about the paper. The authors have made a number of significant improvements to address the original criticisms, including extending the theory and code to multiple samples and uncertainty in the inferences, and empirically demonstrating robustness to data errors and violations of the infinite sites model, along with other more minor changes. The new material is substantial and very responsive to the critiques. I do not see any new problems introduced by the new material or have any other issues to raise. As before, I consider this an innovative and technically rigorous contribution to important current problems in cancer genomics that should be of interest to many working in computational biology or cancer research.</p>
    <p>Reviewer #2: The authors presented an extended version with a new technical improvement to handle multiple biopsies of the same tumour. The formulation of the new problems follows from the single-sample ILP one. A new heuristic is proposed to solve some algorithmic complexity issues in some cases, but in general this is reasonable given the problem complexity.</p>
    <p>This improvement approaches a point was shared also by another reviewer, and hasI feel it has been addressed properly.</p>
    <p>I also asked to motivate practically the advantage of using this tool, showing the drop in costs in doing a proper experimental design with this new tool. The authors have motivated this for one case study that uses Tapestri; I never used Tapestri so I cannot confirm the reported costs, but the advantage is evident and I think this might be an important motivation to use this approach to designs Cancer Evolution assays that need to find the exact tumour clone tree.</p>
    <p>Reviewer #3: The authors have done an excellent job responding to all comments, revising the writing, and running more experiments that I believe have strengthened the paper significantly.</p>
    <p>I'm satisfied with it.</p>
    <p>Very minor comments: What are A and B in panels (c) and (d) of Fig. 4? This should be described in the caption.</p>
    <p>**********</p>
    <p>
      <bold>Have all data underlying the figures and results presented in the manuscript been provided?</bold>
    </p>
    <p>Large-scale datasets should be made available via a public repository as described in the <italic>PLOS Computational Biology</italic>
<ext-link ext-link-type="uri" xlink:href="http://journals.plos.org/ploscompbiol/s/data-availability">data availability policy</ext-link>, and numerical data that underlies graphs or summary statistics should be provided in spreadsheet form as supporting information.</p>
    <p>Reviewer #1: Yes</p>
    <p>Reviewer #2: None</p>
    <p>Reviewer #3: Yes</p>
    <p>**********</p>
    <p>PLOS authors have the option to publish the peer review history of their article (<ext-link ext-link-type="uri" xlink:href="https://journals.plos.org/ploscompbiol/s/editorial-and-peer-review-process#loc-peer-review-history">what does this mean?</ext-link>). If published, this will include your full peer review and any attached files.</p>
    <p>If you choose “no”, your identity will remain anonymous but your review may still be made public.</p>
    <p><bold>Do you want your identity to be public for this peer review?</bold> For information about this choice, including consent withdrawal, please see our <ext-link ext-link-type="uri" xlink:href="https://www.plos.org/privacy-policy">Privacy Policy</ext-link>.</p>
    <p>Reviewer #1: No</p>
    <p>Reviewer #2: No</p>
    <p>Reviewer #3: No</p>
  </body>
</sub-article>
<sub-article id="pcbi.1008240.r004" article-type="editor-report">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1008240.r004</article-id>
    <title-group>
      <article-title>Acceptance letter</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Markowetz</surname>
          <given-names>Florian</given-names>
        </name>
        <role>Deputy Editor</role>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nagarajan</surname>
          <given-names>Niranjan</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2020 Markowetz, Nagarajan</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>Markowetz, Nagarajan</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article id="rel-obj004" ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1008240" related-article-type="reviewed-article"/>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">23 Sep 2020</named-content>
    </p>
    <p>PCOMPBIOL-D-20-00693R1 </p>
    <p>PhyDOSE: Design of Follow-up Single-cell Sequencing Experiments of Tumors</p>
    <p>Dear Dr El-Kebir,</p>
    <p>I am pleased to inform you that your manuscript has been formally accepted for publication in PLOS Computational Biology. Your manuscript is now with our production department and you will be notified of the publication date in due course.</p>
    <p>The corresponding author will soon be receiving a typeset proof for review, to ensure errors have not been introduced during production. Please review the PDF proof of your manuscript carefully, as this is the last chance to correct any errors. Please note that major changes, or those which affect the scientific understanding of the work, will likely cause delays to the publication date of your manuscript. </p>
    <p>Soon after your final files are uploaded, unless you have opted out, the early version of your manuscript will be published online. The date of the early version will be your article's publication date. The final article will be published to the same URL, and all versions of the paper will be accessible to readers.</p>
    <p>Thank you again for supporting PLOS Computational Biology and open-access publishing. We are looking forward to publishing your work! </p>
    <p>With kind regards,</p>
    <p>Laura Mallard</p>
    <p>PLOS Computational Biology | Carlyle House, Carlyle Road, Cambridge CB4 3DN | United Kingdom <email>ploscompbiol@plos.org</email> | Phone +44 (0) 1223-442824 | <ext-link ext-link-type="uri" xlink:href="http://ploscompbiol.org">ploscompbiol.org</ext-link> | @PLOSCompBiol</p>
  </body>
</sub-article>
