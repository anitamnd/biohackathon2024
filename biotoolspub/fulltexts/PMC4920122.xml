<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d1 20130915//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4920122</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btw112</article-id>
    <article-id pub-id-type="publisher-id">btw112</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>repgenHMM: a dynamic programming tool to infer the rules of immune receptor generation from sequence data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Elhanati</surname>
          <given-names>Yuval</given-names>
        </name>
        <xref ref-type="aff" rid="btw112-aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="btw112-cor1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Marcou</surname>
          <given-names>Quentin</given-names>
        </name>
        <xref ref-type="aff" rid="btw112-aff1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mora</surname>
          <given-names>Thierry</given-names>
        </name>
        <xref ref-type="aff" rid="btw112-aff2">
          <sup>2</sup>
        </xref>
        <xref ref-type="corresp" rid="btw112-cor1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Walczak</surname>
          <given-names>Aleksandra M.</given-names>
        </name>
        <xref ref-type="aff" rid="btw112-aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="btw112-cor1">*</xref>
      </contrib>
      <aff id="btw112-aff1"><sup>1</sup>Laboratoire de physique théorique, CNRS, UPMC and Ecole normale supérieure, Paris, France</aff>
      <aff id="btw112-aff2"><sup>2</sup>Laboratoire de physique statistique, CNRS, UPMC and Ecole normale supérieure, Paris, France</aff>
    </contrib-group>
    <author-notes>
      <corresp id="btw112-cor1">*To whom correspondence should be addressed.</corresp>
      <fn id="btw112-FM1">
        <p>Associate Editor: Inanc Birol</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>7</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>07</day>
      <month>3</month>
      <year>2016</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>07</day>
      <month>3</month>
      <year>2016</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>32</volume>
    <issue>13</issue>
    <fpage>1943</fpage>
    <lpage>1951</lpage>
    <history>
      <date date-type="received">
        <day>30</day>
        <month>10</month>
        <year>2015</year>
      </date>
      <date date-type="rev-recd">
        <day>12</day>
        <month>2</month>
        <year>2016</year>
      </date>
      <date date-type="accepted">
        <day>20</day>
        <month>2</month>
        <year>2016</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2016. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2016</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by-nc/4.0/" license-type="creative-commons">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation</bold>: The diversity of the immune repertoire is initially generated by random rearrangements of the receptor gene during early T and B cell development. Rearrangement scenarios are composed of random events—choices of gene templates, base pair deletions and insertions—described by probability distributions. Not all scenarios are equally likely, and the same receptor sequence may be obtained in several different ways. Quantifying the distribution of these rearrangements is an essential baseline for studying the immune system diversity. Inferring the properties of the distributions from receptor sequences is a computationally hard problem, requiring enumerating every possible scenario for every sampled receptor sequence.</p>
      <p><bold>Results</bold>: We present a Hidden Markov model, which accounts for all plausible scenarios that can generate the receptor sequences. We developed and implemented a method based on the Baum–Welch algorithm that can efficiently infer the parameters for the different events of the rearrangement process. We tested our software tool on sequence data for both the alpha and beta chains of the T cell receptor. To test the validity of our algorithm, we also generated synthetic sequences produced by a known model, and confirmed that its parameters could be accurately inferred back from the sequences. The inferred model can be used to generate synthetic sequences, to calculate the probability of generation of any receptor sequence, as well as the theoretical diversity of the repertoire. We estimate this diversity to be <inline-formula id="IE1"><mml:math id="IEQ1"><mml:mrow><mml:mo>≈</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>23</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> for human T cells. The model gives a baseline to investigate the selection and dynamics of immune repertoires.</p>
      <p><bold>Availability and implementation</bold>: Source code and sample sequence files are available at <ext-link ext-link-type="uri" xlink:href="https://bitbucket.org/yuvalel/repgenhmm/downloads">https://bitbucket.org/yuvalel/repgenhmm/downloads</ext-link>.</p>
      <p><bold>Contact:</bold><email>elhanati@lpt.ens.fr</email> or <email>tmora@lps.ens.fr</email> or <email>awalczak@lpt.ens.fr</email></p>
    </abstract>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>The ability of the adaptive immune system to identify a wide range of threats rests upon the diversity of its lymphocyte receptors, which together make up the immune repertoire. Each such receptor can bind specifically to antigenic molecules, and initiate an immune response against the threat. T cell receptors (TCR) are composed of two protein chains, called alpha and beta. B cell receptors (BCR) share a very similar structure, with a light chain and heavy chain playing the same role. Each chain is produced according to the same process of V(D)J rearrangement. In each new cell and for each of the two chains, two germline segments for alpha chains (V<italic>α</italic> and J<italic>α</italic> genes), or three segments for beta chains (V<italic>β</italic>, D<italic>β</italic> and J<italic>β</italic> genes), are assembled together to form the recombined gene coding for the chain. In addition, at the junctions where the segments are joined, the ends of the segments are trimmed, and random nucleotides are inserted (see <xref ref-type="fig" rid="btw112-F1">Fig. 1a</xref> for a diagram describing the alpha chain rearrangement process). This process creates a large initial diversity of possible receptors, which are later selected according to their recognition functionality. An important property of this process is that it is redundant, as many different V(D)J rearrangements may lead to the exact same sequence. It is thus impossible to unambiguously reconstruct the scenario from the sequence alone, a problem that is aggravated by sequencing errors.
<fig id="btw112-F1" orientation="portrait" position="float"><label>Fig. 1.</label><caption><p>(<bold>a</bold>) Schematic description of the rearrangement process for the alpha chains. Random V and J genes are chosen from the genome. A random number of nucleotides are trimmed from their facing ends. These ends are then joined with an insertion segment of variable length and composition. (<bold>b</bold>) Markov model for this rearrangement process, when the V and J gene choices are known. By progressing one path following the arrows, the model produces a rearranged receptor gene. Each state denoted by a circle emits a nucleotide. V and J states each emit one nucleotide from the chosen template, up to an error rate. Emissions from the I states are drawn from a specified distribution. The states represented by squares are nonemitting ghost states. The arrows represent the allowed transitions, some of them are marked on the diagram with <inline-formula id="IE2"><mml:math id="IEQ2"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The probabilities of the transitions and emissions are the parameters of the HMM, as described in the main text</p></caption><graphic xlink:href="btw112f1p"/></fig>
</p>
    <p>The rearrangement process is random, as is each of the elements composing it—choice of germline segments, number of deleted nucleotides, number and identity of insertions. Since the rearrangement process is the basis of repertoire diversity, it is important to study its distribution quantitatively. With recent advances in high throughput sequencing, there is a growing body of data on repertoires for both T and B cells, in a variety of situations (<xref rid="btw112-B2" ref-type="bibr">Bolotin <italic>et al.</italic>, 2012</xref>; <xref rid="btw112-B14" ref-type="bibr">Georgiou <italic>et al.</italic>, 2014</xref>). Using large sequence datasets of rearranged, non-productive genes, the probability distribution of rearrangement events in human TCR beta chain and BCR heavy chains could be inferred using statistical methods, gaining important insights into the random processes underlying repertoire diversity (<xref rid="btw112-B9" ref-type="bibr">Elhanati <italic>et al.</italic>, 2015</xref>; <xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>). However, these studies are based on a brute force approach, which enumerates every possible rearrangement scenario for each observed sequence. This is a very computationally costly procedure, which is unrealistic for very large datasets.</p>
    <p>In this report we present a dynamic programming approach to learn the distribution of rearrangement scenarios from large numbers of non-productive sequences in an efficient way. This approach is based on a Hidden Markov Models (HMM) formulation of the problem, and learns its parameters using a modified Baum–Welch (BW) algorithm to avoid the full enumerations of all scenarios. Many studies have described algorithms designed to process or post-process large numbers of rearranged TCR or BCR genes and extract the template V(D)J genes of the rearrangement (<xref rid="btw112-B4" ref-type="bibr">Bonissone and Pevzner, 2015</xref>; <xref rid="btw112-B5" ref-type="bibr">Brochet <italic>et al.</italic>, 2008</xref>; <xref rid="btw112-B10" ref-type="bibr">Frost <italic>et al.</italic>, 2015</xref>; <xref rid="btw112-B11" ref-type="bibr">Gadala-Maria <italic>et al.</italic>, 2015</xref>; <xref rid="btw112-B12" ref-type="bibr">Gaëta <italic>et al.</italic>, 2007</xref>; <xref rid="btw112-B23" ref-type="bibr">Munshaw and Kepler, 2010</xref>; <xref rid="btw112-B25" ref-type="bibr">Ohm-Laursen <italic>et al.</italic>, 2006</xref>; <xref rid="btw112-B27" ref-type="bibr">Paciello <italic>et al.</italic>, 2015</xref>; <xref rid="btw112-B28" ref-type="bibr">Ralph and Matsen, 2015</xref>; <xref rid="btw112-B31" ref-type="bibr">Russ <italic>et al.</italic>, 2015</xref>; <xref rid="btw112-B36" ref-type="bibr">Souto-Carneiro <italic>et al.</italic>, 2004</xref>; <xref rid="btw112-B38" ref-type="bibr">Thomas <italic>et al.</italic>, 2013</xref>; <xref rid="btw112-B40" ref-type="bibr">Volpe <italic>et al.</italic>, 2006</xref>; <xref rid="btw112-B41" ref-type="bibr">Wang <italic>et al.</italic>, 2008</xref>; <xref rid="btw112-B43" ref-type="bibr">Ye <italic>et al.</italic>, 2013</xref>). These tools process each sequence separately to obtain the best (but often incorrect) alignment to a V(D)J combination, sometimes using dynamic programming or HMM (<xref rid="btw112-B12" ref-type="bibr">Gaëta <italic>et al.</italic>, 2007</xref>; <xref rid="btw112-B23" ref-type="bibr">Munshaw and Kepler, 2010</xref>; <xref rid="btw112-B28" ref-type="bibr">Ralph and Matsen, 2015</xref>; <xref rid="btw112-B40" ref-type="bibr">Volpe <italic>et al.</italic>, 2006</xref>), and assume an implicit, <italic>ad hoc</italic> prior on rearrangements. By contrast, our algorithm explores all plausible alignments for each sequence from data to learn accurately the distribution of rearrangement events.</p>
    <p>Once the model of rearrangement has been learned by our procedure, the entire distribution of possible sequences and their probabilities is accessible. Our algorithm can calculate the probability of any sampled sequence, even if it is not part of the data used to learn the model, and it can generate arbitrary numbers of synthetic sequences with the exact same statistics as the data. Such large samples can be used to investigate the origin of shared sequences, or public repertoires, between different individuals. The procedure can also calculate the entropy of the rearrangement process—a classical measure of sequence diversity. This enables us to further our understanding of the generation process, quantify the baseline state of the immune system and evaluate subsequent processes such as somatic selection. Finally, our work produces insights not just on the data sequences, but on the underlying biological processes.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <sec>
      <title>2.1 Model</title>
      <p>The algorithm assumes a general form for the probability distribution of possible rearrangements, and then finds the parameters of that distribution that best fit the sequence data (<xref rid="btw112-B9" ref-type="bibr">Elhanati <italic>et al.</italic>, 2015</xref>; <xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>). For simplicity we first describe the model for the alpha chain of TCRs. The case of the beta chains will be described later.</p>
      <p>The model specifies probability distributions for each of the rearrangement events: V and J gene choices <italic>P</italic>(<italic>V</italic>, <italic>J</italic>), number of deletions conditioned on the gene being deleted <inline-formula id="IE3"><mml:math id="IEQ3"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>V</mml:mi><mml:mo>|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE4"><mml:math id="IEQ4"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>J</mml:mi><mml:mo>|</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and insertion length and nucleotide identity <inline-formula id="IE5"><mml:math id="IEQ5"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>ins</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Together these distributions form the parameter set <inline-formula id="IE6"><mml:math id="IEQ6"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>V</mml:mi><mml:mo>|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. The probability of a given rearrangement scenario <inline-formula id="IE7"><mml:math id="IEQ7"><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mtext>ins</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is then given by:
<disp-formula id="E1"><label>(1)</label><mml:math id="EQ1"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>rearr</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>|</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>V</mml:mi><mml:mo>|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>J</mml:mi><mml:mo>|</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>ins</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>The specific form of the model assumes some dependencies between the events. In the above formula, for instance, the probabilities of each V and J choice can be dependent, but the insertion is independent from both, while the deletion probabilities are dependent only on the identity of the gene being deleted. The model choice is done based on biological knowledge, and has been validated by previous work in the case of the beta chain (<xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>).</p>
      <p>To avoid confounding factors related to thymic or peripheral selection, the inference of the parameters is performed on non-productive genes. During the maturation of cells, some rearrangement events produce non-productive genes that are either out of frame, having the wrong combination of insertions and deletions, or contain a stop codon. When this happens, the other chromosome in the same cell may undergo a second successful rearrangement event, ensuring the survival of the cell. Yet the non-productive rearrangements remain and are part of the sequence dataset. Since these sequences have no effect on the cell in which they reside, they have not been selected. Studying their statistics is thus equivalent to studying the generation process itself, with no selection. Nonproductive reads may also result from sequencing errors or problems in the assembly of sequences. However, contigs are typically designed to cover the entire CDR3, limiting such frameshifts to the genomic regions, typically to the longer V segment. To ensure that we analyze truly non-functional sequences, we exclude the very rare sequences with a frameshift in the genomic V segment, and restrict our analysis to sequences with a frameshift within the CDR3.</p>
      <p>More generally, standard error correcting techniques applied to the raw sequencing data, such as correction using molecular barcodes and clustering methods, has been shown to limit the number of errors and misattributions of out-of-frame sequences (<xref rid="btw112-B2" ref-type="bibr">Bolotin <italic>et al.</italic>, 2012</xref>; <xref rid="btw112-B14" ref-type="bibr">Georgiou <italic>et al.</italic>, 2014</xref>; <xref rid="btw112-B29" ref-type="bibr">Robins, 2013</xref>; <xref rid="btw112-B35" ref-type="bibr">Shugay <italic>et al.</italic>, 2014</xref>).</p>
      <p>Specifically, the data analyzed in this work were error-corrected by clustering raw reads as explained in <xref rid="btw112-B30" ref-type="bibr">Robins <italic>et al.</italic> (2009)</xref> and <xref rid="btw112-B44" ref-type="bibr">Zvyagin <italic>et al.</italic> (2014)</xref>.</p>
      <p>While the model specifies the distribution over rearrangement scenarios, the data consists of recombined sequences, denoted by <bold>s</bold>, which can be the result of different scenarios <italic>r</italic>. The recombination events are hidden variables, and the likelihood of a sequence is the sum of the probabilities of all scenarios leading to it, <inline-formula id="IE8"><mml:math id="IEQ8"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>→</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>rearr</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The likelihood of the sequence dataset cannot easily be maximized with respect to the model parameters. To overcome this problem, the Expectation–Maximization (EM) algorithm can be used to maximize the likelihood in an iterative manner. In each iteration, new model parameters <inline-formula id="IE9"><mml:math id="IEQ9"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> are chosen to increase the likelihood until the maximum is obtained. In the expectation step, the log-likelihood of hidden rearrangements is averaged over their posterior distribution under the current model <italic>θ</italic>, to form <inline-formula id="IE10"><mml:math id="IEQ10"><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo>′</mml:mo><mml:mo>|</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>r</mml:mi></mml:msub><mml:mi>P</mml:mi></mml:mstyle></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>log</mml:mi><mml:mo> </mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>arran</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>|</mml:mo><mml:mi>θ</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where the sum on <italic>a</italic> runs over the <italic>n</italic> sequences <inline-formula id="IE11"><mml:math id="IEQ11"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> in the dataset. The maximization step consists of maximizing <inline-formula id="IE12"><mml:math id="IEQ12"><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> over <inline-formula id="IE13"><mml:math id="IEQ13"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> to obtain the new parameter set. Because of the simple factorized form of <xref ref-type="disp-formula" rid="E1">Eq. 1</xref>, this second step is equivalent to calculating the frequency of each rearrangement event under the posterior <inline-formula id="IE14"><mml:math id="IEQ14"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. For example, <italic>P</italic>(<italic>V</italic>, <italic>J</italic>) is updated according to:
<disp-formula id="E2"><label>(2)</label><mml:math id="EQ2"><mml:mrow><mml:mi>P</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>:</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi></mml:mstyle></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where the sum on <inline-formula id="IE15"><mml:math id="IEQ15"><mml:mrow><mml:mi>r</mml:mi><mml:mo>:</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:math></inline-formula> runs over scenarios with gene choices <italic>V</italic> and <italic>J</italic>. Similar update rules are used for the other model parameters <inline-formula id="IE16"><mml:math id="IEQ16"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>V</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>J</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula id="IE17"><mml:math id="IEQ17"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>ins</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The sums over possible scenarios, for each data sequence <inline-formula id="IE18"><mml:math id="IEQ18"><mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, are computationally heavy. To make them easier, we now introduce an equivalent HMM formulation of the model.</p>
    </sec>
    <sec>
      <title>2.2 HMM formulation</title>
      <p>The almost linear structure of rearrangements allows for their description as a Markov chain. Hidden Markov models lend themselves to the much more efficient forward-backward algorithm for marginal estimations, and in combination with Expectation–Maximization, the Baum–Welch (BW) algorithm, for parameter inference. In general however, the V and J gene choices may be correlated in their joint distribution <italic>P</italic>(<italic>V</italic>, <italic>J</italic>), breaking the Markovian nature of the rearrangement statistics. To preserve the Markovian structure, we built a separate HMM for each choice of the pair of germline genes (<italic>V</italic>, <italic>J</italic>), and use the forward-backward algorithm to calculate the marginals of the other rearrangement events conditioned on that choice. These conditional marginals will then be combined for all (<italic>V</italic>, <italic>J</italic>) to perform the maximization step of EM.</p>
      <p>For a chosen (<italic>V</italic>, <italic>J</italic>) pair, a Hidden Markov Model (HMM) is constructed to yield the recombined sequences in accordance with <xref ref-type="disp-formula" rid="E1">Eq. 1</xref>. <xref ref-type="fig" rid="btw112-F1">Figure 1b</xref> shows a diagram of the model. The model proceeds through a sequence of hidden states <italic>S</italic>, which emit nucleotides <italic>s<sub>i</sub></italic>, for <inline-formula id="IE19"><mml:math id="IEQ19"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula> where <italic>L</italic> is the sequence length, thus producing the entire sequence <inline-formula id="IE20"><mml:math id="IEQ20"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>We distinguish between two types of emitting states, represented by circles in <xref ref-type="fig" rid="btw112-F1">Figure 1b</xref>. First, ‘genomic states,’ or V and J states, are defined for each position on the genomic templates <italic>V</italic> and <italic>J</italic>, and are denoted by <inline-formula id="IE21"><mml:math id="IEQ21"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mtext>end</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> for V states, and likewise for J states. These states emit the nucleotide encoded in the genomic template at the corresponding position, or, with a small error probability <inline-formula id="IE22"><mml:math id="IEQ22"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>err</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, a different nucleotide. These non-templated emissions can be caused by sequencing errors, B cell hypermutations or uncharted alleles. Second, ‘insertions states’ emit random nontemplated nucleotides according to a distribution. <italic>I</italic><sub>1</sub> corresponds to the first inserted nucleotide, <italic>I</italic><sub>2</sub> to the second one and so on. In addition, we introduce two ‘ghost states’ <italic>G</italic><sub>1</sub> and <italic>G</italic><sub>2</sub>, represented by rectangles in <xref ref-type="fig" rid="btw112-F1">Figure 1b</xref>, between the V and I states, and between I and J states. These states do not emit nucleotides and their sole function is to reduce the number of possible transitions between states by isolating the state types, thus easing computations.</p>
      <p>Each sequence is the result of a stochastic path through a series of states, defined in <xref ref-type="fig" rid="btw112-F1">Figure 1b</xref>, and their random emissions. To illustrate how the HMM operates, we follow a possible path leading to the production of a light chain for a given choice of V and J. The chain starts from the <italic>V</italic><sub>1</sub> state, going along the V gene and emitting nucleotides from the gene. Most of these nucleotides are those of the genomic template, up to the error rate. At some point (possibly before all V states are exhausted to account for potential V deletions) the process transitions to the first ghost state <italic>G</italic><sub>1</sub>. From <italic>G</italic><sub>1</sub> the process goes to the first insertion state <italic>I</italic><sub>1</sub>, or directly to <italic>G</italic><sub>2</sub> if there are no insertions. Each insertion state emits a nucleotide. After a certain number of insertions, the process moves to the second ghost state, <italic>G</italic><sub>2</sub>, and then on to a J state (but not necessarily <italic>J</italic><sub>1</sub> to account for J deletions). Finally the process will continue along the J states until <inline-formula id="IE23"><mml:math id="IEQ23"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mtext>end</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, completing the sequence.</p>
      <p>The HMM is defined by two sets of parameters which map directly onto <inline-formula id="IE24"><mml:math id="IEQ24"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>\</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The first set of parameters is the transition probabilities <inline-formula id="IE25"><mml:math id="IEQ25"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> between any two states <italic>S</italic> and <inline-formula id="IE26"><mml:math id="IEQ26"><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> connected by an arrow in <xref ref-type="fig" rid="btw112-F1">Figure 1</xref>. The transition rates between V states and <italic>G</italic><sub>1</sub>, and between <italic>G</italic><sub>2</sub> and J states, can be mapped onto the deletion profiles of the V and J genes respectively, and the transition rates between the I states and <italic>G</italic><sub>2</sub> can be mapped onto the distribution of the number of insertions. The transition matrix <inline-formula id="IE27"><mml:math id="IEQ27"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is very sparse, thanks in part to the ghost states, allowing for quick computations as we will see below. The second set of parameters are the emission probabilities <inline-formula id="IE28"><mml:math id="IEQ28"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> that nucleotide <italic>s</italic> is emitted by state <italic>S</italic>. If <italic>S</italic> is a genomic (V or J) state, then <inline-formula id="IE29"><mml:math id="IEQ29"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>err</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> if <italic>s</italic> is the template nucleotide, which we denote by <italic>σ<sub>S</sub></italic>, and <inline-formula id="IE30"><mml:math id="IEQ30"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>err</mml:mtext></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> otherwise. If <italic>S</italic> is an insertion state, it is given by a distribution <inline-formula id="IE31"><mml:math id="IEQ31"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, which we assume to be common to all insertion states, i.e. independent of the order of insertions.</p>
    </sec>
    <sec>
      <title>2.3 A modified Baum–Welch algorithm</title>
      <p>The Baum–Welch (BW) algorithm finds the parameters for a given HMM which maximize the likelihood of producing the observed sequences (<xref rid="btw112-B1" ref-type="bibr">Bishop, 2006</xref>; <xref rid="btw112-B8" ref-type="bibr">Durbin <italic>et al.</italic>, 1998</xref>). It is an instance of the EM algorithm, where the maximization step is performed using the forward-backward algorithm. Since our HMM is conditioned on the knowledge of the (<italic>V</italic>, <italic>J</italic>) pair, which is itself a hidden variable, BW cannot be applied without modification. However, we can still use the forward-backward algorithm to calculate the posterior probabilities of rearrangement events for a given sequence <inline-formula id="IE32"><mml:math id="IEQ32"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and a given putative (<italic>V</italic>, <italic>J</italic>) choice, and combine these probabilities at the end.</p>
      <p>The forward pass of the forward-backward algorithm calculates <inline-formula id="IE33"><mml:math id="IEQ33"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, the joint probability of the model being in a specific state <italic>S</italic> and emitting the sequence up to the <italic>i</italic>th nucleotide, (<inline-formula id="IE34"><mml:math id="IEQ34"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>). The backwards pass does the same for <inline-formula id="IE35"><mml:math id="IEQ35"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, the conditional probability of emitting the sequence upstream from position <italic>i</italic>, given that the state in this position is <italic>S</italic>:
<disp-formula id="E3"><label>(3)</label><mml:math id="EQ3"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="E4"><label>(4)</label><mml:math id="EQ4"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>S</mml:mi><mml:mo>,</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>These probabilities are calculated using the following recursion relations:
<disp-formula id="E5"><label>(5)</label><mml:math id="EQ5"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="E6"><label>(6)</label><mml:math id="EQ6"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>Since our transition matrix <inline-formula id="IE36"><mml:math id="IEQ36"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is very sparse, the sum over <inline-formula id="IE37"><mml:math id="IEQ37"><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> has few terms and can be calculated efficiently. Having obtained these forward and backward probabilities for a sequence given a choice of V and J genes, the posterior marginal probabilities for each transition (<inline-formula id="IE38"><mml:math id="IEQ38"><mml:mrow><mml:mi>S</mml:mi><mml:mo>→</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula>), as well as the posterior emission probabilities are calculated as
<disp-formula id="E7"><label>(7)</label><mml:math id="EQ7"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo>→</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="E8"><label>(8)</label><mml:math id="EQ8"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>err</mml:mtext><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>S</mml:mi><mml:mo>∈</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="E9"><label>(9)</label><mml:math id="EQ9"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>ins</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>S</mml:mi><mml:mo>∈</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
up to a normalization constant, where <italic>δ</italic> denotes Kroeneker’s delta.</p>
      <p>The existence of ghost states requires making a small adjustment to this scheme. Each ghost state introduces an offset between the state index and the corresponding position on the sequence. Thus, V states in the <italic>n</italic> position correspond to position <italic>n</italic> in the sequence, I states to position <italic>n</italic> – 1 in the sequence, and J states to position <italic>n</italic> – 2.</p>
      <p>Once the posterior marginals have been evaluated for each data sequence, and for each putative choice of <italic>V</italic> and <italic>J</italic>, we can combine them to obtain the update equations of our modified Baum–Welch algorithm:
<disp-formula id="E10"><label>(10)</label><mml:math id="EQ10"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi></mml:mstyle></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo>→</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="E11"><label>(11)</label><mml:math id="EQ11"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>err</mml:mtext></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi></mml:mstyle></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>err</mml:mtext><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="E12"><label>(12)</label><mml:math id="EQ12"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>←</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:munder><mml:mi>P</mml:mi></mml:mstyle></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>ins</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where the posterior probability <inline-formula id="IE39"><mml:math id="IEQ39"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is calculated using Bayes’ rule, <inline-formula id="IE40"><mml:math id="IEQ40"><mml:mrow><mml:mo>∝</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, with <inline-formula id="IE41"><mml:math id="IEQ41"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>Finally, the algorithm outputs the probability that any sequence <bold>s</bold> was generated as <inline-formula id="IE42"><mml:math id="IEQ42"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. This probability can be used to calculate the log-likelihood of the model, <inline-formula id="IE43"><mml:math id="IEQ43"><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mi>log</mml:mi><mml:mo> </mml:mo></mml:mrow></mml:mstyle><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and track the progress of the BW algorithm at each iteration.</p>
    </sec>
    <sec>
      <title>2.4 Pre-alignments</title>
      <p>For a given sequence, there may be many potential candidates for the segments (<italic>V</italic>, <italic>J</italic>), but not all are equally plausible, especially when sequence reads are long, and not all should be considered. Before starting the inference procedure, the sequences are locally aligned against all genomic templates using the Smith-Waterman algorithm. By creating a shortlist of genomic genes that had an alignment score larger than a tunable threshold, the inference procedure can exclude certain gene choices <italic>a priori</italic>. This saves considerable computation time by omitting rearrangement scenarios that would have a negligible effect due to high numbers of errors.</p>
      <p>In addition, this pre-alignment procedure provides us with a mapping between the positions along the sequence read and each genomic gene. Thus, each of the V and J states of the HMM may only be present at a single position along the sequence, drastically limiting the number of states that we need to consider at each position and improving the speed of computations.</p>
    </sec>
    <sec>
      <title>2.5 Beta chains</title>
      <p>For the beta chain of the TCR, the model is similar to the one in <xref ref-type="disp-formula" rid="E1">Eq. 1</xref>, with the addition of a D gene choice, its deletions from both the left and right sides (<inline-formula id="IE44"><mml:math id="IEQ44"><mml:mrow><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:math></inline-formula>) and two independent insertion events at the VD and DJ junctions (<inline-formula id="IE45"><mml:math id="IEQ45"><mml:mrow><mml:mtext>ins</mml:mtext><mml:mi>V</mml:mi><mml:mi>D</mml:mi><mml:mo>,</mml:mo><mml:mtext>ins</mml:mtext><mml:mi>D</mml:mi><mml:mi>J</mml:mi></mml:mrow></mml:math></inline-formula>):
<disp-formula id="E13"><mml:math id="EQ13"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>rearr</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>D</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>V</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>ins</mml:mtext><mml:mi>V</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="E14"><label>(13)</label><mml:math id="EQ14"><mml:mrow><mml:mo>×</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>ins</mml:mtext><mml:mi>D</mml:mi><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>J</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>A similar HMM as for the alpha chain can be built by adding genomic D states and having two types of insertion states, for the VD and DJ junctions, and extra ghost states to separate them. Then, the procedure described above can be applied <italic>mutatis mutandis</italic>.</p>
      <p>In addition to the V and J gene, the D gene has to be chosen. An HMM is built for each triplet of genomic segments (<italic>V</italic>, <italic>D</italic>, <italic>J</italic>). D genes are short and deleted on both sides. For this reason, they are much harder to align. Even the position of a candidate genomic D segment along the sequence is no longer unambiguous as is the case for V and J segments. For this reason, we do not pre-align the D genes to the sequence. Instead, for each sequence all D genes with all possible locations are considered. Technically this means that the sequence positions at which D states may occur are not pre-specified.</p>
      <p>During the rearrangement process D genes are deleted from both sides. The number of bases truncated from the left and right ends of the gene are correlated—in the extreme case, the sum of both deletions cannot exceed the length of the gene. Since the left and right D deletions correspond to transitions from non-adjacent states, this correlation cannot be described using a Markov model. We have addressed this issue by enumerating all the possible deletions from the left and the right as separate states. In practice, we define different types of D states for each choice of deletions, as depicted in <xref ref-type="fig" rid="btw112-F2">Figure 2</xref>. Each D deletion profile <inline-formula id="IE46"><mml:math id="IEQ46"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> defines a separate subchain of the Markov chain going along the D gene, which is entered from the previous ghost state with probability <inline-formula id="IE47"><mml:math id="IEQ47"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.
<fig id="btw112-F2" orientation="portrait" position="float"><label>Fig. 2.</label><caption><p>Subdiagram of Markov model for beta chain, focusing on the D gene. Each row corresponds to a different pattern of deletions <inline-formula id="IE48"><mml:math id="IEQ48"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for the left and right ends of the D segments. State <inline-formula id="IE49"><mml:math id="IEQ49"><mml:mrow><mml:msubsup><mml:mi>D</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> corresponds to the <italic>d</italic>th base in the D gene, when <italic>l</italic> bases are deleted from the left and <italic>r</italic> from the right. Each row is entered from the ghost state <italic>G</italic><sub>2</sub> with probability <inline-formula id="IE50"><mml:math id="IEQ50"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mtext>del</mml:mtext><mml:mi>D</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and then proceeds deterministically until <italic>G</italic><sub>3</sub>.</p></caption><graphic xlink:href="btw112f2p"/></fig>
</p>
    </sec>
    <sec>
      <title>2.6 Entropy estimates</title>
      <p>The inferred model can be used to characterize the diversity of the distribution of all possible receptors, and not just of the sampled sequences used when inferring that distribution. We quantify the diversity of a stochastic quantity <italic>X</italic> using the Shannon Entropy: <inline-formula id="IE51"><mml:math id="IEQ51"><mml:mrow><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>X</mml:mi></mml:msub><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mrow><mml:mi>log</mml:mi><mml:mo> </mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> (measured in bits). For instance, <inline-formula id="IE52"><mml:math id="IEQ52"><mml:mrow><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> gives a measure of sequence diversity. Since a uniform distribution with <inline-formula id="IE53"><mml:math id="IEQ53"><mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mi>H</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> outcomes has entropy <italic>H</italic>, the number <inline-formula id="IE54"><mml:math id="IEQ54"><mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mi>H</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> can, even for non-uniform distributions, be interpreted as an effective diversity number, sometimes called true diversity. The entropy of rearrangements can be calculated explicitly thanks to the factorized form of the distribution. For example, for alpha chains:
<disp-formula id="E15"><label>(14)</label><mml:math id="EQ15"><mml:mrow><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mi>V</mml:mi></mml:munder><mml:mi>P</mml:mi></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>V</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mi>J</mml:mi></mml:munder><mml:mi>P</mml:mi></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>del</mml:mtext><mml:mi>J</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>ins</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p>
      <p>This expression clearly separates the contributions from (<italic>V</italic>, <italic>J</italic>) segment choice, deletions and insertions. The entropy of sequences <inline-formula id="IE55"><mml:math id="IEQ55"><mml:mrow><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> cannot be calculated in this way since receptor sequences can be produced by multiple rearrangements, but can easily be estimated by averaging <inline-formula id="IE56"><mml:math id="IEQ56"><mml:mrow><mml:mi>log</mml:mi><mml:mo> </mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE57"><mml:math id="IEQ57"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is calculated by the forward-backward algorithm as explained above.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Implementation</title>
      <p>The method was implemented in C ++ (std11) as a command line tool. OpenMP was used for parallelization.</p>
      <p>The main pipeline has two parts, the alignment module and the inference module. The input for the entire pipeline is a FASTA or plain text file with unique recombined and non-productive nucleotide sequences, and FASTA files with the genomic templates for the different V, J germline segments (as well as D in the case of heavy or beta chains). Genomic files can be obtained from genomic databases such as IMGT (<xref rid="btw112-B15" ref-type="bibr">Giudicelli <italic>et al.</italic>, 2005</xref>). The alignment code was written to read IMGT FASTA files and extract gene names.</p>
      <p>Between the alignment and inference procedures, alignments below a certain threshold are discarded to improve performance. The threshold can be tuned for different datasets. Sequences that do not align well to at least one known gene of each type are completely eliminated as a quality control. Setting the thresholds should be done carefully, keeping a large majority of the sequences with at least one good alignment, but excluding ones which had only low score alignments. To this end, an auxiliary module is included that outputs statistics on the best alignment score for each sequence. Curated alignment files are saved at the end of the alignments stage, and used as input for the inference. Apart from the alignments, the only parameters needed for inference are the maximum numbers of insertions and deletions.</p>
      <p>The output of the main pipeline is the value of the model parameters: the joint distribution of segment usage; the distributions of deletions at each of the deletion sites conditioned on the gene; the distribution of the number and composition of inserted nucleotides at the junctions; and a global error rate accounting for sequencing errors, hypermutations or genomic variants.</p>
      <p>Two more modules are included. First, given a list of sequences and an inferred model, the software can compute generation probabilities for all sequences. Second, a synthetic sequence generation module that can produce sequences from a given model. This module can be used to study the properties of the distribution or to verify the inference algorithm using a known model, as we will see below.</p>
    </sec>
    <sec>
      <title>3.2 Application to alpha chain data</title>
      <p>The algorithm was applied to human TCR alpha chain sequences from <xref rid="btw112-B44" ref-type="bibr">Zvyagin <italic>et al.</italic> (2014)</xref>. The data consist of around 60 000 unique non-productive sequences, each 151 bp long, covering both the V and J segments. Sequences were aligned to lists of genomic sequences from the IMGT online database (<xref rid="btw112-B15" ref-type="bibr">Giudicelli <italic>et al.</italic>, 2005</xref>), and then given as input to the inference algorithm. The model converged rapidly as can be seen by the quick saturation of the likelihood (<xref ref-type="fig" rid="btw112-F3">Fig. 3a</xref>).
<fig id="btw112-F3" orientation="portrait" position="float"><label>Fig. 3.</label><caption><p>TCR alpha chain rearrangement distribution inferred from sequence data taken from <xref rid="btw112-B44" ref-type="bibr">Zvyagin <italic>et al.</italic> (2014)</xref>. (<bold>a</bold>) The log-likelihood of the data given the model saturates as a function of the number of iterations of the Expectation–Maximization algorithm. (<bold>b</bold>) Shannon entropy of rearrangements (top row) and sequences (middle row). The sequence entropy is lower than the total recombination entropy because of convergent rearrangements. The rearrangement entropy is the sum of entropies of its elementary events (bottom row). (<bold>c</bold>) Distribution of the number of inserted nucleotides (solid curve). For comparison, the same distribution obtained by the MiXCR software is represented by a dashed line. (<bold>d</bold>) Distributions of the number of deletions for both V and J genes, averaged over genes. (<bold>e</bold>) Joint distribution for V and J usage, <italic>P</italic>(<italic>V</italic>, <italic>J</italic>). Genes are ordered by position along the genome. (<bold>f</bold>) The covariance <inline-formula id="IE58"><mml:math id="IEQ58"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> clearly shows strong correlations for genes that are either close to the separation between the V and J segments, or far from it</p></caption><graphic xlink:href="btw112f3p"/></fig>
</p>
      <p>The entropy of the rearrangement process quantifies the diversity of possible scenarios. It was calculated using <xref ref-type="disp-formula" rid="E15">Eq. 14</xref> and found to be 32 bits (<xref ref-type="fig" rid="btw112-F3">Fig. 3b</xref>, top line). This entropy can be partitioned into contributions from each of the rearrangement events—segment choice, insertions and deletions (bottom line). The largest contribution to the entropy comes from the insertions, followed closely by gene choice. We also estimated the entropy of the sequence distribution (middle line), which is smaller than the rearrangement entropy because of convergent rearrangements—multiple rearrangements leading to the same sequence (grey box). This estimate was based on samples of simulated sequences. Undersampling bias and error were corrected for by using samples of different sizes and validating the convergence of the entropy. The entropy of the alpha chain sequences is 30 bits, which corresponds to a diversity number of about 10<sup>9</sup>. Inferred insertion and deletion profiles for the alpha rearrangements are shown in <xref ref-type="fig" rid="btw112-F3">Figure 3c and d</xref>, with the deletion profile averaged over genes. The peak of the insertion distribution is at 5 bp, similar to previous results for the beta chain.</p>
      <p>The joint distribution of gene usage for V and J, represented in <xref ref-type="fig" rid="btw112-F3">Figure 3e</xref>, shows a wide variety of gene usage probabilities, with clear dependencies on the ordering of genes according to their location on the chromosome (<xref rid="btw112-B22" ref-type="bibr">Lefranc and Lefranc, 2001</xref>). To better see these dependencies, in <xref ref-type="fig" rid="btw112-F3">Figure 3f</xref> we plotted <inline-formula id="IE59"><mml:math id="IEQ59"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> as a measure of the correlation between V and J choices. In <xref rid="btw112-B42" ref-type="bibr">Warmflash and Dinner (2006)</xref> and <xref rid="btw112-B18" ref-type="bibr">Hawwari and Krangel (2007)</xref>, it was proposed that rearrangements can occur in several steps, following earlier accounts in mice (<xref rid="btw112-B19" ref-type="bibr">Huang and Kanagawa, 2001</xref>). When a V and a J segment are joined, the genomic segments that were between them are excised, but the segments located on the outer flanks remain. Then, successive rearrangements joining these outer segments might occur. It was hypothesized that early joining events involve V and J genes that are close to each other, hence proximal to the boundary between the V and J cassettes. Later joining events, on the other hand, should involve more distal genes as the proximal genes are likely to have been excised. This phenomenon is expected to lead to correlations between pairs of genes which are either both distal or both proximal, which is consistent with the results of <xref ref-type="fig" rid="btw112-F3">Figure 3f</xref>. Notice also that in the intermediate range our model predicts low correlation within a certain window of distances between the V and J genes.</p>
      <p>To control for the finite size of the datasets, we ran our model on subsamples of the data. The distributions inferred using half of the dataset (30 000 sequences) differed by only 1% from the whole dataset, as measured by the Kullback–Leibler divergence normalized by the entropy.</p>
    </sec>
    <sec>
      <title>3.3 Test on synthetic data</title>
      <p>In order to check the validity of the algorithm, we ran it on sequences that were produced according to a known model. We generated 100 000 synthetic sequences according to the model learned in the previous section, and relearned a model from these sequences using our algorithm. In <xref ref-type="fig" rid="btw112-F4">Figure 4</xref> we compare the parameters of the model used for generation to those of the inferred model. Sampling was repeated 5 times to estimate sample noise, which was found to be very small for all parameters, except for gene usage (error bars in <xref ref-type="fig" rid="btw112-F4">Fig. 4b</xref>).
<fig id="btw112-F4" orientation="portrait" position="float"><label>Fig. 4.</label><caption><p>Performance of the algorithm on synthetic data. Sequences generated using a known model were given as an input to the inference algorithm. The results of the inference are compared to the true model used for generation, for (<bold>a</bold>) the distribution of the number of insertions (inset: usage of inserted nucleotides) and (<bold>b</bold>) V, J gene usage. The error bars, which correspond to sample noise, are smaller than symbol size for (a). In (a) we also report the distribution of insertions obtained using MiXCR</p></caption><graphic xlink:href="btw112f4p"/></fig>
</p>
      <p>The insertion bias, i.e. the usage of the different nucleotides in inserted segments, is inferred almost perfectly, as seen in the inset of <xref ref-type="fig" rid="btw112-F4">Fig. 4a</xref>. The probabilities for each V,J choice also show excellent agreement, within sampling errors (<xref ref-type="fig" rid="btw112-F4">Fig. 4b</xref>). The distribution of the number of insertions also agrees very well (<xref ref-type="fig" rid="btw112-F4">Fig. 4a</xref>). However, when inferring the same model, but with a higher error rate (1%), we found that the inferred insertion distribution noticeably overestimated the probability of zero insertions.</p>
    </sec>
    <sec>
      <title>3.4 Comparison to existing tools</title>
      <p>Results and performance can be compared with existing tools based on deterministic methods, which rely on the best alignment to the V and J genomic segments to call the number of deletions, insertions, and calculate their distributions. Here we compare our results to MiXCR (<xref rid="btw112-B3" ref-type="bibr">Bolotin <italic>et al.</italic>, 2015</xref>), a recent, representative and fast implementation of this method. We expect other existing software tools (<xref rid="btw112-B5" ref-type="bibr">Brochet <italic>et al.</italic>, 2008</xref>; <xref rid="btw112-B12" ref-type="bibr">Gaëta <italic>et al.</italic>, 2007</xref>; <xref rid="btw112-B38" ref-type="bibr">Thomas <italic>et al.</italic>, 2013</xref>; <xref rid="btw112-B43" ref-type="bibr">Ye <italic>et al.</italic>, 2013</xref>) to give equivalent results.</p>
      <p>The distributions obtained by summarizing the MiXCR alignments are shown in <xref ref-type="fig" rid="btw112-F3">Figure 3c and d</xref>, and do not agree with our inference. MiXCR assignments overestimate zero insertions by a twofold factor, and underestimate the central peak. This distortion is also apparent in synthetic data, for which we know the true distribution (<xref ref-type="fig" rid="btw112-F4">Fig. 4a</xref>). In this case, our method infers the correct distribution of insertions with high accuracy, while MiXCR does not, and even identifies a spurious second peak in the distribution at zero insertions.</p>
      <p>Because it treats each sequence in a fully probabilistic manner, our method is slower than MiXCR. On a multicore PC with 46 AMD Opteron processors, one iteration over a 50 000 database of alpha chains sequences takes about 200 s. For comparison, MiXCR could run over the same sequences in about 10 s. Note that the memory requirements of repgenHMM do not limit its performance. This slower time must be balanced by the obvious advantage conferred by the inference of the correct distribution. An accurate estimate of the distribution of insertions can be crucial for understanding the mechanistic details of the insertion process by TdT (<xref rid="btw112-B16" ref-type="bibr">Gouge <italic>et al.</italic>, 2015</xref>) or for estimating the number of cells with invariant receptors (NK or MAIT, for instance) (<xref rid="btw112-B13" ref-type="bibr">Gapin, 2014</xref>; <xref rid="btw112-B17" ref-type="bibr">Greenaway <italic>et al.</italic>, 2013</xref>) or zero-insertion clonotypes in cells that do not express TdT (<xref rid="btw112-B21" ref-type="bibr">Komori <italic>et al.</italic>, 1996</xref>).</p>
    </sec>
    <sec>
      <title>3.5 Sharing of alpha chain sequences</title>
      <p>The generation module of our software, which has no equivalent in existing tools, can be used to investigate important biological questions, such as the origin of receptor sharing between unrelated individuals. Sharing of receptor sequences is sometimes interpreted as resulting from convergent selection in response to common pathogens. However, it has recently been proposed that sharing could simply arise by chance, through the independent recombination of the same receptors in different individuals (<xref rid="btw112-B34" ref-type="bibr">Shugay <italic>et al.</italic>, 2013</xref>; <xref rid="btw112-B39" ref-type="bibr">Venturi <italic>et al.</italic>, 2011</xref>). In fact, we expect this to be the main source of sharing in non-productive sequences, because they are not subject to selection (<xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>).</p>
      <p>We investigated the sharing of alpha out-of-frame sequences in two unrelated individuals from <xref rid="btw112-B44" ref-type="bibr">Zvyagin <italic>et al.</italic> (2014)</xref>. The data contained <inline-formula id="IE60"><mml:math id="IEQ60"><mml:mrow><mml:mn>1.7</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>7</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> shared sequences for every pair of sequences in the two individuals. We learned a distinct model for each of the two individuals, then generated a large number of sequences from each model, and counted the number of shared sequences between the two sets. The two generated datasets shared <inline-formula id="IE61"><mml:math id="IEQ61"><mml:mrow><mml:mn>1.4</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>7</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> sequences per pair, in good agreement with the data, confirming that independent convergent recombination was the main source of shared sequences between these two individuals.</p>
    </sec>
    <sec>
      <title>3.6 Application to beta chain data</title>
      <p>The beta and heavy chain algorithm was applied to the human TCR beta data that was already analyzed in (<xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>) using brute-force methods. The inferred model parameters were all very similar to those reported in <xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic> (2012)</xref>, confirming the validity of our algorithm. The distribution of the number of insertions and deletions are displayed in <xref ref-type="fig" rid="btw112-F5">Figure 5</xref>. Remarkably, insertion profiles at the two insertion sites are very close to each other, as previously reported, but they also closely match the insertion profile of the alpha chain (<xref ref-type="fig" rid="btw112-F5">Figure 5a</xref>). Nucleotide usage in each of the two inserted regions (between V and D, and between D and J) is shown in the inset. The VD insertion base usage is similar to the usage of the complementary bases (antisense) in the DJ region, suggesting that the biological mechanism is operating on the opposite strands for both insertions types, as previously noted (<xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>). From the computational point of view, because the algorithm enumerates both the D gene choice and its deletions, its benefit is smaller for beta chains than for alpha chains.
<fig id="btw112-F5" orientation="portrait" position="float"><label>Fig. 5.</label><caption><p>TCR beta chain rearrangement distribution inferred from sequence data previously analyzed in (<xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>). (<bold>a</bold>) Distribution of the number of insertions at both VD and DJ junctions, and comparison with the distribution of insertion in the alpha chain from <xref ref-type="fig" rid="btw112-F3">Figure 3c</xref>. Inset: The nucleotide usage is identical for VD and DJ insertions when considered on opposite strands. (<bold>b</bold>) Distribution of the number of deletions on both the V and J genes, averaged over different genes</p></caption><graphic xlink:href="btw112f5p"/></fig>
</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>The strength of the adaptive immune system lies in its inherent diversity. This dynamic diversity is the result of several stochastic biological mechanisms, including complex enzymatic reactions that alter the DNA structure and composition. The action of some of the enzymes such as RAG and TdT have been studied extensively (see <xref rid="btw112-B33" ref-type="bibr">Schatz and Swanson, 2011</xref>; <xref rid="btw112-B20" ref-type="bibr">Jung and Alt, 2004</xref>; <xref rid="btw112-B32" ref-type="bibr">Schatz and Ji, 2011</xref> for reviews). In our work we have studied the way in which the diversity is generated in a top down approach, focusing on statistical properties as inferred from sequenced receptor genes. In principle, this is a computationally difficult problem, due to the very large number of possible rearrangement scenarios.</p>
    <p>The algorithm described here can be used to study the properties of generation of receptor chains of T cells in any species, from large sequence datasets. Our dynamic programming approach, which is a variant of the Baum–Welch algorithm, takes advantage of the linear structure of rearrangements to avoid a full enumeration of scenarios. In a brute-force approach such as the one presented in <xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic> (2012)</xref> and <xref rid="btw112-B9" ref-type="bibr">Elhanati <italic>et al.</italic> (2015)</xref>, the algorithmic complexity scales as the product of the numbers of each independent rearrangement event. By contrast, the complexity of the method we presented here is additive with the number of insertions and deletions.</p>
    <p>Despite technological advances, sequencing techniques still introduce errors. In addition, allelic variants and hypermutations in B-cells introduce additional discrepancies between known template genes and sequence reads. Our method can be used with models that account for such events. In the presented version of the algorithm, substitution errors are already fully accounted for, and can be partially interpreted as hypermutations, as has already been demonstrated for B cell heavy chains in <xref rid="btw112-B9" ref-type="bibr">Elhanati <italic>et al.</italic> (2015)</xref>, albeit with a different implementation. Hypermutations are known to be context dependent (<xref rid="btw112-B6" ref-type="bibr">Cowell and Kepler, 2000</xref>; <xref rid="btw112-B7" ref-type="bibr">Dunn-Walters <italic>et al.</italic>, 1998</xref>; <xref rid="btw112-B26" ref-type="bibr">Oprea <italic>et al.</italic>, 2001</xref>; <xref rid="btw112-B37" ref-type="bibr">Spencer and Dunn-Walters, 2005</xref>). Our method could be modified to take this into account, by having the substitution rate depend on the local sequence motif around the location of the substitution. Insertion and deletion errors could likewise be handled by adding transitions that skip or repeat bases. Other potential future software developments include a more general model of nucleotide insertions, where each insertion depends on the previous one, or the addition of palindromic insertions. These modifications can be implemented readily, as they do not affect the Markovian structure of the process. In addition, a module calculating the probability of generation of amino-acid sequences (and not just nucleotide sequences) could be implemented using a similar approach with Markov transitions between codons.</p>
    <p>We find many common features of generation for the alpha and beta chains of the TCR. There is a difference of diversity, due to the greater length and complexity of the beta compared to the alpha chain. The diversity number of the beta chain repertoire, estimated to be approximately 10<sup>14</sup> in <xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic> (2012)</xref>, is therefore much larger than that of the alpha chain reported here, 10<sup>9</sup>. Assuming that the rearrangements of the alpha and beta chains are independent, the total TCR diversity is about 10<sup>23</sup>.</p>
    <p>Inferring statistical properties of the underlying biological processes can be thought of as a diagnostic tool for the properties of the immune system, and could be used in a variety of clinical settings. The generation process and subsequent selection shape the initial diversity of the immune system, and we have found this process to be remarkably universal across normal, healthy humans, expect for slight variations in gene usage (<xref rid="btw112-B24" ref-type="bibr">Murugan <italic>et al.</italic>, 2012</xref>; <xref rid="btw112-B9" ref-type="bibr">Elhanati <italic>et al.</italic>, 2015</xref>). However, infections or irregularities in the immune system can be seen as perturbations that will change these distributions. By comparing the normal distributions to different pathological situations, information on the reaction of the immune system can be extracted. This information could in turn be used for diagnosis, using fast computational tools such as the one presented here.</p>
    <p>With more and more immune repertoire sequence data being collected, efficient algorithms are needed. The ability to quickly infer and analyze large datasets is essential both for our basic understanding of the adaptive immune system and also for specific clinical applications.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank members of the Chudakov and Lebedev groups at the Institute of Bioorganic Chemistry of the Russian Academy of Sciences, and in particular M. Pogorelyy, for sharing their TCR alpha data with us.</p>
  </ack>
  <sec>
    <title>Funding</title>
    <p>This work was supported by <funding-source>European Research Council Starting</funding-source> Grant n. <award-id>306312</award-id>.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="btw112-B1">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Bishop</surname><given-names>C.M.</given-names></name></person-group> (<year>2006</year>). <source>Pattern Recognition and Machine Learning</source>. <publisher-loc>New York, USA</publisher-loc>: <publisher-name>Springer</publisher-name>.</mixed-citation>
    </ref>
    <ref id="btw112-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bolotin</surname><given-names>D.A.</given-names></name></person-group><etal/> (<year>2012</year>) <article-title>Next generation sequencing for TCR repertoire profiling: platform-specific features and correction algorithms</article-title>. <source>Eur. J. Immunol</source>., <volume>42</volume>, <fpage>3073</fpage>–<lpage>3083</lpage>.<pub-id pub-id-type="pmid">22806588</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bolotin</surname><given-names>D.A.</given-names></name></person-group><etal/> (<year>2015</year>) <article-title>MiXCR: software for comprehensive adaptive immunity profiling</article-title>. <source>Nat. Methods</source>, <volume>12</volume>, <fpage>380</fpage>–<lpage>381</lpage>.<pub-id pub-id-type="pmid">25924071</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B4">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Bonissone</surname><given-names>S</given-names></name><name><surname>Pevzner</surname><given-names>P.</given-names></name></person-group> (<year>2015</year>). <chapter-title>Immunoglobulin classification using the colored antibody graph</chapter-title> In: <person-group person-group-type="editor"><name><surname>Przytycka</surname><given-names>T.M.</given-names></name></person-group> (ed.) <source>Research in Computational Molecular Biology SE - 7, volume 9029 of Lecture Notes in Computer Science</source>. <publisher-loc>Switzerland</publisher-loc>: <publisher-name>Springer International Publishing</publisher-name>, pp. <fpage>44</fpage>–<lpage>59</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brochet</surname><given-names>X.</given-names></name></person-group><etal/> (<year>2008</year>) <article-title>IMGT/V-QUEST: the highly customized and integrated system for IG and TR standardized V-J and V-D-J sequence analysis</article-title>. <source>Nucleic Acids Res</source>., <volume>36</volume>, <fpage>503</fpage>–<lpage>508</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cowell</surname><given-names>L.G.</given-names></name><name><surname>Kepler</surname><given-names>T.B.</given-names></name></person-group> (<year>2000</year>) <article-title>The nucleotide-replacement spectrum under somatic hypermutation exhibits microsequence dependence that is strand-symmetric and distinct from that under germline mutation</article-title>. <source>J. Immunol</source>., <volume>164</volume>, <fpage>1971</fpage>–<lpage>1976</lpage>.<pub-id pub-id-type="pmid">10657647</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dunn-Walters</surname><given-names>D.K.</given-names></name></person-group><etal/> (<year>1998</year>) <article-title>Base-specific sequences that bias somatic hypermutation deduced by analysis of out-of-frame human IgVH genes</article-title>. <source>J. Immunol. (Baltimore, MD.: 1950)</source>, <volume>160</volume>, <fpage>2360</fpage>–<lpage>2364</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B8">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Durbin</surname><given-names>R.</given-names></name></person-group><etal/> (<year>1998</year>). <source>Biological Sequence Analysis: Probabilistic Models of Proteins and Nucleic Acids</source>. <publisher-loc>Cambridge, UK</publisher-loc>: <publisher-name>Cambridge University Press</publisher-name>.</mixed-citation>
    </ref>
    <ref id="btw112-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elhanati</surname><given-names>Y.</given-names></name></person-group><etal/> (<year>2015</year>) <article-title>Inferring processes underlying B-cell repertoire diversity</article-title>. <source>Philos. Trans. R. Soc. Lond. Ser. B: Biol. Sci</source>., <volume>370</volume>, <fpage>20140243.</fpage><pub-id pub-id-type="pmid">26194757</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frost</surname><given-names>S.D.W.</given-names></name></person-group><etal/> (<year>2015</year>) <article-title>Assigning and visualizing germline genes in antibody repertoires</article-title>. <source>Philos. Trans. R. Soc. Lond. Ser. B: Biol. Sci</source>., <volume>370</volume>, <fpage>20140240.</fpage><pub-id pub-id-type="pmid">26194754</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gadala-Maria</surname><given-names>D.</given-names></name></person-group><etal/> (<year>2015</year>) <article-title>Automated analysis of high-throughput B-cell sequencing data reveals a high frequency of novel immunoglobulin V gene segment alleles</article-title>. <source>Proc. Natl. Acad. Sci. U. S. A</source>., <volume>112</volume>, <fpage>E862</fpage>–<lpage>E870</lpage>.<pub-id pub-id-type="pmid">25675496</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gaëta</surname><given-names>B.A.</given-names></name></person-group><etal/> (<year>2007</year>) <article-title>iHMMune-align: hidden Markov model-based alignment and identification of germline genes in rearranged immunoglobulin gene sequences</article-title>. <source>Bioinformatics</source>, <volume>23</volume>, <fpage>1580</fpage>–<lpage>1587</lpage>.<pub-id pub-id-type="pmid">17463026</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gapin</surname><given-names>L.</given-names></name></person-group> (<year>2014</year>) <article-title>Check MAIT</article-title>. <source>J. Immunol. (Baltimore, MD.: 1950)</source>, <volume>192</volume>, <fpage>4475</fpage>–<lpage>4480</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Georgiou</surname><given-names>G.</given-names></name></person-group><etal/> (<year>2014</year>) <article-title>The promise and challenge of high-throughput sequencing of the antibody repertoire</article-title>. <source>Nat. Biotechnol</source>., <volume>32</volume>, <fpage>158</fpage>–<lpage>168</lpage>.<pub-id pub-id-type="pmid">24441474</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Giudicelli</surname><given-names>V.</given-names></name></person-group><etal/> (<year>2005</year>) <article-title>IMGT/GENE-DB: a comprehensive database for human and mouse immunoglobulin and T cell receptor genes</article-title>. <source>Nucleic Acids Res</source>., <volume>33</volume>, <fpage>D256</fpage>–<lpage>D261</lpage>.<pub-id pub-id-type="pmid">15608191</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gouge</surname><given-names>J.</given-names></name></person-group><etal/> (<year>2015</year>) <article-title>Structural basis for a novel mechanism of DNA bridging and alignment in eukaryotic DSB DNA repair</article-title>. <source>EMBO J</source>., <volume>34</volume>, <fpage>1126</fpage>–<lpage>1142</lpage>.<pub-id pub-id-type="pmid">25762590</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Greenaway</surname><given-names>H.Y.</given-names></name></person-group><etal/> (<year>2013</year>) <article-title>NKT and MAIT invariant TCR<italic>α</italic> sequences can be produced efficiently by VJ gene recombination</article-title>. <source>Immunobiology</source>, <volume>218</volume>, <fpage>213</fpage>–<lpage>224</lpage>.<pub-id pub-id-type="pmid">22647874</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hawwari</surname><given-names>A.</given-names></name><name><surname>Krangel</surname><given-names>M.S.</given-names></name></person-group> (<year>2007</year>) <article-title>Role for rearranged variable gene segments in directing secondary T cell receptor alpha recombination</article-title>. <source>Proc. Natl. Acad. Sci. U. S. A</source>., <volume>104</volume>, <fpage>903</fpage>–<lpage>907</lpage>.<pub-id pub-id-type="pmid">17210914</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huang</surname><given-names>C.Y.</given-names></name><name><surname>Kanagawa</surname><given-names>O.</given-names></name></person-group> (<year>2001</year>) <article-title>Ordered and coordinated rearrangement of the TCR locus: role of secondary rearrangement in thymic selection</article-title>. <source>J. Immunol</source>., <volume>166</volume>, <fpage>2597</fpage>–<lpage>2601</lpage>.<pub-id pub-id-type="pmid">11160321</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jung</surname><given-names>D.</given-names></name><name><surname>Alt</surname><given-names>F.W.</given-names></name></person-group> (<year>2004</year>) <article-title>Unraveling V(D)J recombination; insights into gene regulation</article-title>. <source>Cell</source>, <volume>116</volume>, <fpage>299</fpage>–<lpage>311</lpage>.<pub-id pub-id-type="pmid">14744439</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Komori</surname><given-names>T.</given-names></name></person-group><etal/> (<year>1996</year>) <article-title>Repertoires of antigen receptors in Tdt congenitally deficient mice</article-title>. <source>Int. Rev. Immunol</source>., <volume>13</volume>, <fpage>317</fpage>–<lpage>325</lpage>.<pub-id pub-id-type="pmid">8884428</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B22">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Lefranc</surname><given-names>M.P</given-names></name><name><surname>Lefranc</surname><given-names>G.</given-names></name></person-group> (<year>2001</year>). <source>The T Cell Receptor FactsBook</source>. Factsbook. <publisher-loc>London</publisher-loc>: <publisher-name>Academic Press</publisher-name>.</mixed-citation>
    </ref>
    <ref id="btw112-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Munshaw</surname><given-names>S.</given-names></name><name><surname>Kepler</surname><given-names>T.B.</given-names></name></person-group> (<year>2010</year>) <article-title>SoDA2: a Hidden Markov Model approach for identification of immunoglobulin rearrangements</article-title>. <source>Bioinformatics</source>, <volume>26</volume>, <fpage>867</fpage>–<lpage>872</lpage>.<pub-id pub-id-type="pmid">20147303</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Murugan</surname><given-names>A.</given-names></name></person-group><etal/> (<year>2012</year>) <article-title>Statistical inference of the generation probability of T-cell receptors from sequence repertoires</article-title>. <source>Proc. Natl. Acad. Sci. U. S. A</source>., <volume>109</volume>, <fpage>16161</fpage>–<lpage>16166</lpage>.<pub-id pub-id-type="pmid">22988065</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ohm-Laursen</surname><given-names>L.</given-names></name></person-group><etal/> (<year>2006</year>) <article-title>No evidence for the use of DIR, D-D fusions, chromosome 15 open reading frames or VHreplacement in the peripheral repertoire was found on application of an improved algorithm, JointML, to 6329 human immunoglobulin H rearrangements</article-title>. <source>Immunology</source>, <volume>119</volume>, <fpage>265</fpage>–<lpage>277</lpage>.<pub-id pub-id-type="pmid">17005006</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oprea</surname><given-names>M.</given-names></name></person-group><etal/> (<year>2001</year>) <article-title>The targeting of somatic hypermutation closely resembles that of meiotic mutation</article-title>. <source>J. Immunol</source>., <volume>166</volume>, <fpage>892</fpage>–<lpage>899</lpage>.<pub-id pub-id-type="pmid">11145665</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paciello</surname><given-names>G.</given-names></name></person-group><etal/> (<year>2015</year>) <article-title>VDJSeq-Solver: in silico V(D)J recombination detection tool</article-title>. <source>Plos One</source>, <volume>10</volume>, <fpage>e0118192.</fpage><pub-id pub-id-type="pmid">25799103</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ralph</surname><given-names>D.K</given-names></name><name><surname>Matsen</surname><given-names>F.</given-names></name></person-group> (<year>2015</year>) <article-title>Consistency of VDJ rearrangement and substitution parameters enables accurate B cell receptor sequence annotation</article-title>. <source>PLoS computational biology</source>, <volume>12</volume>, <fpage>e1004409</fpage>.<pub-id pub-id-type="pmid">26751373</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robins</surname><given-names>H.</given-names></name></person-group> (<year>2013</year>) <article-title>Immunosequencing: applications of immune repertoire deep sequencing</article-title>. <source>Curr. Opin. Immunol</source>., <volume>25</volume>, <fpage>646</fpage>–<lpage>652</lpage>. (Special section: Systems biology and bioinformatics/Immunogenetics and transplantation).<pub-id pub-id-type="pmid">24140071</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robins</surname><given-names>H.S.</given-names></name></person-group><etal/> (<year>2009</year>) <article-title>Comprehensive assessment of T-cell receptor beta-chain diversity in alphabeta T cells</article-title>. <source>Blood</source>, <volume>114</volume>, <fpage>4099</fpage>–<lpage>4107</lpage>.<pub-id pub-id-type="pmid">19706884</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Russ</surname><given-names>D.E.</given-names></name></person-group><etal/> (<year>2015</year>) <article-title>HTJoinSolver: Human immunoglobulin VDJ partitioning using approximate dynamic programming constrained by conserved motifs</article-title>. <source>BMC Bioinf</source>., <volume>16</volume>, <fpage>1</fpage>–<lpage>11</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schatz</surname><given-names>D.G.</given-names></name><name><surname>Ji</surname><given-names>Y.</given-names></name></person-group> (<year>2011</year>) <article-title>Recombination centres and the orchestration of V(D)J recombination</article-title>. <source>Nat. Rev. Immunol</source>., <volume>11</volume>, <fpage>251</fpage>–<lpage>263</lpage>.<pub-id pub-id-type="pmid">21394103</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schatz</surname><given-names>D.G.</given-names></name><name><surname>Swanson</surname><given-names>P.C.</given-names></name></person-group> (<year>2011</year>) <article-title>V(D)J recombination: mechanisms of initiation</article-title>. <source>Annu. Rev. Genet</source>., <volume>45</volume>, <fpage>167</fpage>–<lpage>202</lpage>.<pub-id pub-id-type="pmid">21854230</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shugay</surname><given-names>M.</given-names></name></person-group><etal/> (<year>2013</year>) <article-title>Huge overlap of individual TCR beta repertoires</article-title>. <source>Front. Immunol</source>., <volume>4</volume>, <fpage>466.</fpage><pub-id pub-id-type="pmid">24400005</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shugay</surname><given-names>M.</given-names></name></person-group><etal/> (<year>2014</year>) <article-title>Towards error-free profiling of immune repertoires</article-title>. <source>Nat. Methods</source>, <volume>11</volume>, <fpage>653</fpage>–<lpage>655</lpage>.<pub-id pub-id-type="pmid">24793455</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Souto-Carneiro</surname><given-names>M.M.</given-names></name></person-group><etal/> (<year>2004</year>) <article-title>Characterization of the human Ig heavy chain antigen binding complementarity determining region 3 using a newly developed software algorithm, JOINSOLVER</article-title>. <source>J. Immunol. (Baltimore, MD.: 1950)</source>, <volume>172</volume>, <fpage>6790</fpage>–<lpage>6802</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spencer</surname><given-names>J.</given-names></name><name><surname>Dunn-Walters</surname><given-names>D.K.</given-names></name></person-group> (<year>2005</year>) <article-title>Hypermutation at A-T base pairs: the a nucleotide replacement spectrum is affected by adjacent nucleotides and there is no reverse complementarity of sequences flanking mutated A and T nucleotides</article-title>. <source>J. Immunol</source>., <volume>175</volume>, <fpage>5170</fpage>–<lpage>5177</lpage>.<pub-id pub-id-type="pmid">16210621</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thomas</surname><given-names>N.</given-names></name></person-group><etal/> (<year>2013</year>) <article-title>Decombinator: a tool for fast, efficient gene assignment in T-cell receptor sequences using a finite state machine</article-title>. <source>Bioinformatics (Oxford, England)</source>, <volume>29</volume>, <fpage>542</fpage>–<lpage>550</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Venturi</surname><given-names>V.</given-names></name></person-group><etal/> (<year>2011</year>) <article-title>A mechanism for TCR sharing between T cell subsets and individuals revealed by pyrosequencing</article-title>. <source>J. Immunol. (Baltimore, MD.: 1950)</source>, <volume>186</volume>, <fpage>4285</fpage>–<lpage>4294</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Volpe</surname><given-names>J.M.</given-names></name></person-group><etal/> (<year>2006</year>) <article-title>SoDA: implementation of a 3D alignment algorithm for inference of antigen receptor recombinations</article-title>. <source>Bioinformatics (Oxford, England)</source>, <volume>22</volume>, <fpage>438</fpage>–<lpage>444</lpage>.</mixed-citation>
    </ref>
    <ref id="btw112-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>X.</given-names></name></person-group><etal/> (<year>2008</year>) <article-title>Ab-origin: an enhanced tool to identify the sourcing gene segments in germline for rearranged antibodies</article-title>. <source>BMC Bioinf</source>., <volume>9</volume>, <fpage>S20.</fpage></mixed-citation>
    </ref>
    <ref id="btw112-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Warmflash</surname><given-names>A.</given-names></name><name><surname>Dinner</surname><given-names>A.R.</given-names></name></person-group> (<year>2006</year>) <article-title>A model for TCR gene segment use</article-title>. <source>J. Immunol</source>., <volume>177</volume>, <fpage>3857</fpage>–<lpage>3864</lpage>.<pub-id pub-id-type="pmid">16951348</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ye</surname><given-names>J.</given-names></name></person-group><etal/> (<year>2013</year>) <article-title>IgBLAST: an immunoglobulin variable domain sequence analysis tool</article-title>. <source>Nucleic Acids Res</source>., <volume>41</volume>, <fpage>1</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">23143271</pub-id></mixed-citation>
    </ref>
    <ref id="btw112-B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zvyagin</surname><given-names>I.V.</given-names></name></person-group><etal/> (<year>2014</year>) <article-title>Distinctive properties of identical twins’ TCR repertoires revealed by high-throughput sequencing</article-title>. <source>Proc. Natl. Acad. Sci. U. S. A</source>., <volume>111</volume>, <fpage>5980</fpage>–<lpage>5985</lpage>.<pub-id pub-id-type="pmid">24711416</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
