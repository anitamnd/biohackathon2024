<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10155328</article-id>
    <article-id pub-id-type="pmid">37131141</article-id>
    <article-id pub-id-type="publisher-id">5305</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-023-05305-0</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ERStruct: a fast Python package for inferring the number of top principal components from whole genome sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Yang</surname>
          <given-names>Jinghan</given-names>
        </name>
        <address>
          <email>eciel@connect.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Xu</surname>
          <given-names>Yuyang</given-names>
        </name>
        <address>
          <email>xuyy@connect.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yao</surname>
          <given-names>Minhao</given-names>
        </name>
        <address>
          <email>mhyao@connect.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Gao</given-names>
        </name>
        <address>
          <email>gw2411@cumc.columbia.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Liu</surname>
          <given-names>Zhonghua</given-names>
        </name>
        <address>
          <email>zl2509@cumc.columbia.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.194645.b</institution-id><institution-id institution-id-type="ISNI">0000000121742757</institution-id><institution>Department of Statistics and Actuarial Science, </institution><institution>The University of Hong Kong, </institution></institution-wrap>Pokfulam, Hong Kong SAR China </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.21729.3f</institution-id><institution-id institution-id-type="ISNI">0000000419368729</institution-id><institution>Department of Neurology, Gertrude. H. Sergievsky Center, </institution><institution>Columbia University, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.21729.3f</institution-id><institution-id institution-id-type="ISNI">0000000419368729</institution-id><institution>Department of Biostatistics, </institution><institution>Columbia University, </institution></institution-wrap>New York, NY USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>2</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>2</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>24</volume>
    <elocation-id>180</elocation-id>
    <history>
      <date date-type="received">
        <day>7</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>25</day>
        <month>4</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Large-scale multi-ethnic DNA sequencing data is increasingly available owing to decreasing cost of modern sequencing technologies. Inference of the population structure with such sequencing data is fundamentally important. However, the ultra-dimensionality and complicated linkage disequilibrium patterns across the whole genome make it challenging to infer population structure using traditional principal component analysis based methods and software.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We present the ERStruct Python Package, which enables the inference of population structure using whole-genome sequencing data. By leveraging parallel computing and GPU acceleration, our package achieves significant improvements in the speed of matrix operations for large-scale data. Additionally, our package features adaptive data splitting capabilities to facilitate computation on GPUs with limited memory.</p>
      </sec>
      <sec>
        <title>Conclusion</title>
        <p id="Par3">Our Python package ERStruct is an efficient and user-friendly tool for estimating the number of top informative principal components that capture population structure from whole genome sequencing data.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Population structure</kwd>
      <kwd>Principal component</kwd>
      <kwd>Random matrix theory</kwd>
      <kwd>Sequencing data</kwd>
      <kwd>Spectral analysis</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id>
            <institution>National Institutes of Health</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01 AG076901</award-id>
        <principal-award-recipient>
          <name>
            <surname>Wang</surname>
            <given-names>Gao</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par13">With the fast development and decreasing cost of next generation sequencing technology, whole genome sequencing (WGS) data are increasingly available and hold the promise of discovering the genetic architecture of human traits and diseases. One fundamental question is to infer population structure from the WGS data, which is critically important in population genetics and genetic association studies [<xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref>].</p>
    <p id="Par14">PCA (principal component analysis) based methods are prevalent in capturing the population structure from array-based genotype data [<xref ref-type="bibr" rid="CR4">4</xref>–<xref ref-type="bibr" rid="CR6">6</xref>]. However, it has been challenging to determine the number of top PCs (principal components) that can sufficiently capture the population structure in practice. A popular traditional method [<xref ref-type="bibr" rid="CR5">5</xref>] does not perform well on sequencing data for two reasons: ultra-dimensionality [<xref ref-type="bibr" rid="CR7">7</xref>] and linkage disequilibrium [<xref ref-type="bibr" rid="CR5">5</xref>]. To resolve those two practical issues on sequencing data, a novel method ERStruct based on eigenvalue ratios has been proposed [<xref ref-type="bibr" rid="CR8">8</xref>] for whole genome sequencing data and a MATLAB toolbox has been developed. Substantial improvements in accuracy and robustness are found when applying the ERStruct toolbox both on the HapMap 3 project [<xref ref-type="bibr" rid="CR9">9</xref>] array-based data and the 1000 Genomes Project [<xref ref-type="bibr" rid="CR10">10</xref>] sequencing data. Despite the great potential, we found that two issues may restrict the use of the ERStruct algorithm: <list list-type="order"><list-item><p id="Par15">Although the ERStruct MATLAB toolbox provides a parallelization computing feature, its scalability is heavily restricted by the size of memory available in the working environment, slowing down the speed of data analysis.</p></list-item><list-item><p id="Par16">The ERStruct algorithm was implemented as a MATLAB toolbox which is not freely available. In contrast, Python is open-sourced and free to use.</p></list-item></list>To improve the efficiency and accessibility of the ERStruct algorithm, we develop a new Python package implementing the same ERStruct algorithm. Our ERStruct Python implementation uses parallelization computing to accelerate simulations of GOE (Gaussian Orthogonal Ensemble) matrices used in the ERStruct algorithm. In addition, the package provides optional GPU acceleration to boost the speed of large-scale data matrix operations while maintaining feasible memory usage for GPUs with limited Video Random Access Memory (VRAM). We applied the ERStruct Python package to the 1000 Genomes Project data to demonstrate the computationally efficient performance in the "<xref rid="Sec7" ref-type="sec">Results</xref>" section. Compared with the original MATLAB version, we achieved a similar time spent using our Python implementation using only CPU (Central Processing Unit) acceleration and significantly reduced time consumption and memory usage with GPU acceleration.
</p>
  </sec>
  <sec id="Sec2">
    <title>Algorithm</title>
    <p id="Par17">For self-sufficiency of the article, in this section we briefly describe the ERStruct algorithm from [<xref ref-type="bibr" rid="CR8">8</xref>]. The algorithm starts from a <italic>n</italic>-by-<italic>p</italic> genotype data matrix <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{C}$$\end{document}</tex-math><mml:math id="M2"><mml:mi mathvariant="bold">C</mml:mi></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq1.gif"/></alternatives></inline-formula> that consists of <italic>p</italic> genetic markers from <italic>n</italic> individuals. Each of the entry <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{C}(i,j)$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mi mathvariant="bold">C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq2.gif"/></alternatives></inline-formula> takes a value from <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\{0,1,2\}$$\end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq3.gif"/></alternatives></inline-formula>, which represents the raw count of the minor alleles for the genetic marker <italic>j</italic> on the individual <italic>i</italic>. The ERStruct algorithm estimates the number of top informative PCs that capture the latent population structure. Suppose there are <italic>K</italic> different (latent) subpopulations in total, and the <italic>i</italic>th individual  is the <italic>l</italic>th person in the <italic>k</italic>th subpopulation, then the ERStruct model for the genetic markers of this <italic>i</italic>th individual is given by<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \textbf{C}(i,\cdot ) \equiv \textbf{c}_{k,l} = \mathbf {\mu }_k + \mathbf {\varepsilon }_{k,l}. \end{aligned}$$\end{document}</tex-math><mml:math id="M8" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi mathvariant="bold">C</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>≡</mml:mo><mml:msub><mml:mi mathvariant="bold">c</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>ε</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2023_5305_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>In this model, the <italic>p</italic>-dimensional vectors <inline-formula id="IEq4"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf {\mu }_k$$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mi>μ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq4.gif"/></alternatives></inline-formula> denote the <italic>k</italic>th subpopulation mean counts of minor alleles, and the vectors <inline-formula id="IEq5"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf {\varepsilon }_{k,l}$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mi>ε</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq5.gif"/></alternatives></inline-formula> denote the individual noise vectors, which are independent and identically distributed with mean zeros and an arbitrary covariance matrix <inline-formula id="IEq6"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathbf {\Sigma }$$\end{document}</tex-math><mml:math id="M14"><mml:mi mathvariant="normal">Σ</mml:mi></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq6.gif"/></alternatives></inline-formula>.
</p>
    <p id="Par18">We now summarize the key steps of the ERStruct algorithm. First, the data matrix <inline-formula id="IEq7"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{C}$$\end{document}</tex-math><mml:math id="M16"><mml:mi mathvariant="bold">C</mml:mi></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq7.gif"/></alternatives></inline-formula> is normalized column by column into the new matrix <inline-formula id="IEq8"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{M}$$\end{document}</tex-math><mml:math id="M18"><mml:mi mathvariant="bold">M</mml:mi></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq8.gif"/></alternatives></inline-formula> by<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \textbf{M}(i,\cdot ) = \bigl ( \hat{\textbf{D}} {\cdot } (\textbf{C}(i,\cdot )-\hat{\mathbf {\mu }}) \bigr )^{\textsf{T}}, \end{aligned}$$\end{document}</tex-math><mml:math id="M20" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em" stretchy="true">(</mml:mo></mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold">D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>·</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">C</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>-</mml:mo><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em" stretchy="true">)</mml:mo></mml:mrow><mml:mi mathvariant="sans-serif">T</mml:mi></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2023_5305_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>where<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \hat{\mathbf {\mu }} = \frac{1}{n} \sum _{i=1}^{n} \textbf{C}(i,\cdot ) = (\hat{\mu }_1,\ldots ,\hat{\mu }_p)^{\textsf{T}}, \qquad \hat{\textbf{D}} = \textrm{diag}\Bigl (1 \Big / {\sqrt{\hat{\mu }_j(1{-}\hat{\mu }_j/2)}} \Bigr ). \end{aligned}$$\end{document}</tex-math><mml:math id="M22" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mi mathvariant="bold">C</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi mathvariant="sans-serif">T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mover accent="true"><mml:mi mathvariant="bold">D</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mtext>diag</mml:mtext><mml:mrow><mml:mo maxsize="1.623em" minsize="1.623em" stretchy="true">(</mml:mo></mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo maxsize="1.623em" minsize="1.623em" stretchy="true">/</mml:mo></mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">/</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:msqrt><mml:mrow><mml:mo maxsize="1.623em" minsize="1.623em" stretchy="true">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2023_5305_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>Next, we calculate the matrix <inline-formula id="IEq9"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{S}_p = \textbf{M}\textbf{M}^{\textsf{T}}/p$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:msub><mml:mi mathvariant="bold">S</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="bold">M</mml:mi><mml:msup><mml:mi mathvariant="bold">M</mml:mi><mml:mi mathvariant="sans-serif">T</mml:mi></mml:msup><mml:mo stretchy="false">/</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq9.gif"/></alternatives></inline-formula>, compute its non-zero ordered sample eigenvalues <inline-formula id="IEq10"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\ell _1\geqslant \cdots \geqslant \ell _{n-1}&gt;0$$\end{document}</tex-math><mml:math id="M26"><mml:mrow><mml:msub><mml:mi>ℓ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>⩾</mml:mo><mml:mo>⋯</mml:mo><mml:mo>⩾</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq10.gif"/></alternatives></inline-formula>, and obtain the corresponding sample eigenvalue ratios <inline-formula id="IEq11"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_i = \ell _{i+1} / \ell _i,\ i=1,\ldots ,n-2$$\end{document}</tex-math><mml:math id="M28"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">/</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="4pt"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq11.gif"/></alternatives></inline-formula>.</p>
    <p id="Par19">According to the finite-rank perturbation theory [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>], under the ERStruct model <xref rid="Equ1" ref-type="disp-formula">1</xref> and the following two assumptions: <list list-type="order"><list-item><p id="Par20">Ultra-high-dimensional asymptotic regime: <inline-formula id="IEq12"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n\rightarrow \infty$$\end{document}</tex-math><mml:math id="M30"><mml:mrow><mml:mi>n</mml:mi><mml:mo stretchy="false">→</mml:mo><mml:mi>∞</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq12.gif"/></alternatives></inline-formula> and <inline-formula id="IEq13"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n/p \rightarrow 0$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mi>n</mml:mi><mml:mo stretchy="false">/</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">→</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq13.gif"/></alternatives></inline-formula>;</p></list-item><list-item><p id="Par21"><inline-formula id="IEq14"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\min _{k\ne k^*} \Vert \mathbf {\mu }_k-\mathbf {\mu }_{k^*}\Vert \rightarrow \infty$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:msub><mml:mo movablelimits="true">min</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>≠</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">‖</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:msup><mml:mi>k</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:msub><mml:mo stretchy="false">‖</mml:mo></mml:mrow><mml:mo stretchy="false">→</mml:mo><mml:mi>∞</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq14.gif"/></alternatives></inline-formula>;</p></list-item></list>the sample eigenvalue ratios <inline-formula id="IEq15"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_1,\ldots ,r_{n-2}$$\end{document}</tex-math><mml:math id="M36"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq15.gif"/></alternatives></inline-formula> can be separated into two sets: the bulk and the spike. The bulk set contains the major part of eigenvalue ratios <inline-formula id="IEq16"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_K,\ldots ,r_{n-2}$$\end{document}</tex-math><mml:math id="M38"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>K</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq16.gif"/></alternatives></inline-formula>, which will form a compact set and go to 1 asymptotically. The spike set contains the remaining top <inline-formula id="IEq17"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K-1$$\end{document}</tex-math><mml:math id="M40"><mml:mrow><mml:mi>K</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq17.gif"/></alternatives></inline-formula> sample eigenvalue ratios <inline-formula id="IEq18"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_1,\ldots ,r_{K-1}$$\end{document}</tex-math><mml:math id="M42"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>K</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq18.gif"/></alternatives></inline-formula>, which will converge (as <inline-formula id="IEq19"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n\rightarrow \infty$$\end{document}</tex-math><mml:math id="M44"><mml:mrow><mml:mi>n</mml:mi><mml:mo stretchy="false">→</mml:mo><mml:mi>∞</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq19.gif"/></alternatives></inline-formula>) to certain limits that are less than 1 and well-separated from the bulk set (see Fig. <xref rid="Fig1" ref-type="fig">1</xref> for illustration).<fig id="Fig1"><label>Fig. 1</label><caption><p>Illustration of a typical distribution of the eigenvalue ratios under the ERStruct model <xref rid="Equ1" ref-type="disp-formula">1</xref> (<inline-formula id="IEq20"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$K=12$$\end{document}</tex-math><mml:math id="M46"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mn>12</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq20.gif"/></alternatives></inline-formula>, <inline-formula id="IEq21"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n=2500$$\end{document}</tex-math><mml:math id="M48"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>2500</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq21.gif"/></alternatives></inline-formula>, <inline-formula id="IEq22"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p=$$\end{document}</tex-math><mml:math id="M50"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq22.gif"/></alternatives></inline-formula> 8,000,000)</p></caption><graphic xlink:href="12859_2023_5305_Fig1_HTML" id="MO4"/></fig></p>
    <p id="Par22">The ERStruct algorithm estimates the number of top informative PCs <italic>K</italic> by estimating the number of spikes as follows,<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \hat{K}_{ER} {:}{=}\min \bigl \{ 1\leqslant k\leqslant \hat{K}_c \, \text { such that }\, r_k \geqslant \xi _{\alpha ,k}, \ldots , r_{\hat{K}_c} \geqslant \xi _{\alpha ,\hat{K}_c} \bigr \}. \end{aligned}$$\end{document}</tex-math><mml:math id="M52" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">ER</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mo movablelimits="true">min</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em" stretchy="true">{</mml:mo></mml:mrow><mml:mn>1</mml:mn><mml:mo>⩽</mml:mo><mml:mi>k</mml:mi><mml:mo>⩽</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub><mml:mspace width="0.166667em"/><mml:mspace width="0.333333em"/><mml:mtext>such that</mml:mtext><mml:mspace width="0.333333em"/><mml:mspace width="0.166667em"/><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>⩾</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:msub><mml:mo>⩾</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em" stretchy="true">}</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2023_5305_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>That is, the first index <italic>k</italic> such that the <italic>k</italic>th and the <inline-formula id="IEq23"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{K}_c$$\end{document}</tex-math><mml:math id="M54"><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq23.gif"/></alternatives></inline-formula> subsequent eigenvalue ratios <inline-formula id="IEq24"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_k, \ldots , r_{\hat{K}_c}$$\end{document}</tex-math><mml:math id="M56"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq24.gif"/></alternatives></inline-formula> are respectively greater than their critical values <inline-formula id="IEq25"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\xi _{\alpha ,k}, \ldots , \xi _{\alpha ,\hat{K}_c}$$\end{document}</tex-math><mml:math id="M58"><mml:mrow><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq25.gif"/></alternatives></inline-formula>, which are the lower <inline-formula id="IEq26"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha$$\end{document}</tex-math><mml:math id="M60"><mml:mi>α</mml:mi></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq26.gif"/></alternatives></inline-formula> quantiles of the distributions of <inline-formula id="IEq27"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_k, \ldots , r_{\hat{K}_c}$$\end{document}</tex-math><mml:math id="M62"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq27.gif"/></alternatives></inline-formula>. Note that there are two user-specified parameters in Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>: the significance level <inline-formula id="IEq28"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha$$\end{document}</tex-math><mml:math id="M64"><mml:mi>α</mml:mi></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq28.gif"/></alternatives></inline-formula> and the coarse estimator <inline-formula id="IEq29"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{K}_c$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq29.gif"/></alternatives></inline-formula>. Based on the real data analysis results in [<xref ref-type="bibr" rid="CR8">8</xref>], we recommend to use <inline-formula id="IEq30"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha =0.001$$\end{document}</tex-math><mml:math id="M68"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>0.001</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq30.gif"/></alternatives></inline-formula>, and set the coarse estimate <inline-formula id="IEq31"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{K}_c = \lfloor n/10\rfloor$$\end{document}</tex-math><mml:math id="M70"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌊</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">/</mml:mo><mml:mn>10</mml:mn><mml:mo>⌋</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq31.gif"/></alternatives></inline-formula> by default. Note that the coarse estimate should be generally larger than the true number of top PCs <italic>K</italic>, so as to avoid under-estimation of the original eigenvalue ratio based estimator proposed in [<xref ref-type="bibr" rid="CR13">13</xref>].
</p>
    <p id="Par23">To determine the critical value <inline-formula id="IEq32"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\xi _{\alpha ,k}$$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq32.gif"/></alternatives></inline-formula> for <inline-formula id="IEq33"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_k$$\end{document}</tex-math><mml:math id="M74"><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq33.gif"/></alternatives></inline-formula>, the null distribution of <inline-formula id="IEq34"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_k$$\end{document}</tex-math><mml:math id="M76"><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq34.gif"/></alternatives></inline-formula> is needed and can be approximated by the distribution of the bulk eigenvalue ratio <inline-formula id="IEq35"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_K$$\end{document}</tex-math><mml:math id="M78"><mml:msub><mml:mi>r</mml:mi><mml:mi>K</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq35.gif"/></alternatives></inline-formula> when the sample size is <inline-formula id="IEq36"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n-k+1$$\end{document}</tex-math><mml:math id="M80"><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq36.gif"/></alternatives></inline-formula> according to [<xref ref-type="bibr" rid="CR12">12</xref>] (denotes as <inline-formula id="IEq37"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_K^{(k)}$$\end{document}</tex-math><mml:math id="M82"><mml:msubsup><mml:mi>r</mml:mi><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq37.gif"/></alternatives></inline-formula>). Applying the random matrix theory introduced in [<xref ref-type="bibr" rid="CR14">14</xref>–<xref ref-type="bibr" rid="CR16">16</xref>], the distribution of <inline-formula id="IEq38"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_K^{(k)}$$\end{document}</tex-math><mml:math id="M84"><mml:msubsup><mml:mi>r</mml:mi><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq38.gif"/></alternatives></inline-formula> can be further approximated by<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} r_K^{(k)} \mathrel {\dot{\sim }} \dfrac{w_2 {\cdot } \sqrt{\hat{b}_p^{(k)}/p} + \hat{a}_p^{(k)}}{{w_1} {\cdot } \sqrt{\hat{b}_p^{(k)}/p} + \hat{a}_p^{(k)}}, \end{aligned}$$\end{document}</tex-math><mml:math id="M86" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mover accent="true"><mml:mo>∼</mml:mo><mml:mo>˙</mml:mo></mml:mover><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>·</mml:mo><mml:msqrt><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">/</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msqrt><mml:mo>+</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>·</mml:mo><mml:msqrt><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">/</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msqrt><mml:mo>+</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2023_5305_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula>where the symbol <inline-formula id="IEq39"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrel {\dot{\sim }}$$\end{document}</tex-math><mml:math id="M88"><mml:mover accent="true"><mml:mo>∼</mml:mo><mml:mo>˙</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq39.gif"/></alternatives></inline-formula> denotes the left and right sides asymptotically follow the same distribution, and<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \hat{a}_p^{(k)} = \frac{1}{n-k} \sum _{i=k}^{n-1} \ell _i, \qquad \hat{b}_p^{(k)} = \frac{{p}}{(n-k)^2} \sum _{i=k}^{n-1} (\ell _i - \hat{a}_p^{(k)})^2, \end{aligned}$$\end{document}</tex-math><mml:math id="M90" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:msubsup><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mi>p</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>a</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2023_5305_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula><inline-formula id="IEq40"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$w_1$$\end{document}</tex-math><mml:math id="M92"><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq40.gif"/></alternatives></inline-formula>, <inline-formula id="IEq41"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$w_2$$\end{document}</tex-math><mml:math id="M94"><mml:msub><mml:mi>w</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq41.gif"/></alternatives></inline-formula> are the top two eigenvalues of a <italic>n</italic>-by-<italic>n</italic> GOE matrix (i.e., a square matrix with independent entries, where each diagonal entry follows <italic>N</italic>(0, 2) and each off-diagonal entry follows <italic>N</italic>(0, 1)).</p>
    <p id="Par24">Equations <xref rid="Equ5" ref-type="disp-formula">5</xref> and <xref rid="Equ6" ref-type="disp-formula">6</xref> link the distribution of <inline-formula id="IEq42"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w_1,w_2)$$\end{document}</tex-math><mml:math id="M96"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq42.gif"/></alternatives></inline-formula> together to our target distribution of <inline-formula id="IEq43"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_K^{(k)}$$\end{document}</tex-math><mml:math id="M98"><mml:msubsup><mml:mi>r</mml:mi><mml:mi>K</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq43.gif"/></alternatives></inline-formula>, and thus the distribution of <inline-formula id="IEq44"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_k$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq44.gif"/></alternatives></inline-formula>. In the ERStruct algorithm, Monte Carlo simulation is used to find out the empirical distribution of <inline-formula id="IEq45"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w_1,w_2)$$\end{document}</tex-math><mml:math id="M102"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq45.gif"/></alternatives></inline-formula>. Denote all the simulated replications as <inline-formula id="IEq46"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w_1^{(m)},w_2^{(m)})$$\end{document}</tex-math><mml:math id="M104"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq46.gif"/></alternatives></inline-formula>, <inline-formula id="IEq47"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$m=1,\ldots ,rep$$\end{document}</tex-math><mml:math id="M106"><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq47.gif"/></alternatives></inline-formula>, where <italic>rep</italic> is the number of replications. Then the empirical approximated distribution of <inline-formula id="IEq48"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_k$$\end{document}</tex-math><mml:math id="M108"><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq48.gif"/></alternatives></inline-formula> can be calculated by substituting <inline-formula id="IEq49"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w_1,w_2)$$\end{document}</tex-math><mml:math id="M110"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq49.gif"/></alternatives></inline-formula> as <inline-formula id="IEq50"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w_1^{(m)},w_2^{(m)})$$\end{document}</tex-math><mml:math id="M112"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq50.gif"/></alternatives></inline-formula> in Eq. <xref rid="Equ5" ref-type="disp-formula">5</xref>, and sorting the results in ascending order (denotes as <inline-formula id="IEq51"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_k^{(1)}\leqslant r_k^{(2)}\leqslant \cdots \leqslant r_k^{(rep)}$$\end{document}</tex-math><mml:math id="M114"><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⩽</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⩽</mml:mo><mml:mo>⋯</mml:mo><mml:mo>⩽</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq51.gif"/></alternatives></inline-formula>). Finally, the critical value can be calculated by<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \xi _{\alpha ,k} = r_k^{(\alpha \cdot rep)}, \end{aligned}$$\end{document}</tex-math><mml:math id="M116" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>·</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2023_5305_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>and the ERStruct estimator <inline-formula id="IEq52"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{K}_{ER}$$\end{document}</tex-math><mml:math id="M118"><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">ER</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq52.gif"/></alternatives></inline-formula> can be obtained by Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>.</p>
    <p id="Par25">Note that to ensure validity, the number of replications <italic>rep</italic> should be in general greater than <inline-formula id="IEq53"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$1/\alpha$$\end{document}</tex-math><mml:math id="M120"><mml:mrow><mml:mn>1</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq53.gif"/></alternatives></inline-formula>, the reciprocal of the input significance level. We recommend users to choose between <inline-formula id="IEq54"><alternatives><tex-math id="M121">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$2/\alpha$$\end{document}</tex-math><mml:math id="M122"><mml:mrow><mml:mn>2</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq54.gif"/></alternatives></inline-formula> to <inline-formula id="IEq55"><alternatives><tex-math id="M123">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$5/\alpha$$\end{document}</tex-math><mml:math id="M124"><mml:mrow><mml:mn>5</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq55.gif"/></alternatives></inline-formula> for the argument <italic>rep</italic>.
</p>
  </sec>
  <sec id="Sec3">
    <title>Implementation</title>
    <p id="Par26">For a given genotype data matrix as input, the ERStruct Python package estimates the number of top informative PCs that capture the latent population structure in three parts: GOE matrices simulation, calculating the eigenvalue ratios of the given data matrix, and estimating the number of top PCs. These parts correspond to GOE.py, Eigens.py and TopPCs.py files shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>, respectively. To boost the overall performance of the ERStruct algorithm, instead of the frequently used NumPy array processing framework, we choose to build up our ERStruct algorithm using PyTorch tensor and PyTorch functions. According to our experiments, PyTorch functions (e.g., torch.nanmean, torch.nansum, and torch.linalg.eigvalsh) are much faster than their NumPy equivalences (i.e., numpy.nanmean, numpy.nansum, and numpy.linalg.eigvalsh) for data processing in the ERStruct algorithm.<fig id="Fig2"><label>Fig. 2</label><caption><p>A flowchart that demonstrates the three parts of the ERStruct Python package for the whole genome sequencing data analysis. As an example we use the 1000 Genomes Project sequencing data set [<xref ref-type="bibr" rid="CR10">10</xref>] in which genetic markers with MAF less than 5% are removed. The input real data are processed as in Eigens.py and then transmitted to TopPCs.py to obtain the sample eigenvalue ratios <inline-formula id="IEq56"><alternatives><tex-math id="M125">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_i$$\end{document}</tex-math><mml:math id="M126"><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq56.gif"/></alternatives></inline-formula> (as plotted in the lower left panel). While in GOE.py, GOE matrices simulation is carried out and then transmitted to TopPCs.py to calculate the critical values <inline-formula id="IEq57"><alternatives><tex-math id="M127">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\xi _{\alpha ,1}, \ldots , \xi _{\alpha ,\hat{K}_c}$$\end{document}</tex-math><mml:math id="M128"><mml:mrow><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq57.gif"/></alternatives></inline-formula>. Finally, these critical values are used to infer the number of top principal components following Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref> (as plotted in the lower right panel)</p></caption><graphic xlink:href="12859_2023_5305_Fig2_HTML" id="MO9"/></fig></p>
    <sec id="Sec4">
      <title>Scalable simulation of GOE matrices</title>
      <p id="Par27">In GOE.py, Monte Carlo method is used in the ERStruct algorithm to obtain the null distribution of our proposed ERStruct test statistic, which starts by generating multiple replications of high-dimensional GOE matrices. A significant amount of computing resources is needed in this step, especially when the sample size of the experiment data is large. To efficiently simulate the high-dimensional GOE matrices, we have empirically tested different packages for parallelization computing on different scale GOE matrices, including Joblib, Multiprocessing, and Ray. Joblib is shown to have the most efficient and stable performance on our algorithm to apply parallelization computing for multicore. Without parallelization, the GOE matrices simulation takes 80.68 mins on the function GOE_L12_sim with sample size <inline-formula id="IEq58"><alternatives><tex-math id="M129">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n = 2504$$\end{document}</tex-math><mml:math id="M130"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>2504</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq58.gif"/></alternatives></inline-formula> and the number of Monte Carlo replications <inline-formula id="IEq59"><alternatives><tex-math id="M131">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$rep = 5000$$\end{document}</tex-math><mml:math id="M132"><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>5000</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq59.gif"/></alternatives></inline-formula>, while using parallelization by Joblib on 15 cores CPUs, it takes only 6.46 mins to finish the same job. Compared with the non-parallelization MATLAB version, we successfully decreased the computing time by 12.5 times.</p>
    </sec>
    <sec id="Sec5">
      <title>Calculate the eigenvalue ratios of a given matrix</title>
      <p id="Par28">In Eigens.py, we start from loading genotype data matrices <inline-formula id="IEq60"><alternatives><tex-math id="M133">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{C}_i$$\end{document}</tex-math><mml:math id="M134"><mml:msub><mml:mi mathvariant="bold">C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq60.gif"/></alternatives></inline-formula> from NPY files as the input, where each row of matrix <inline-formula id="IEq61"><alternatives><tex-math id="M135">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{C}_i$$\end{document}</tex-math><mml:math id="M136"><mml:msub><mml:mi mathvariant="bold">C</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq61.gif"/></alternatives></inline-formula> represents the genetic markers of an individual. Multiple files input are allowed in this step because all of these large-scale data files are often too large to fit in the memory at the same time. In this case, users need to ensure that each data file alone can fit in the memory, and all of these data contain the same individuals in the same order. Also note that by default, our package will impute all the missing data by 0. To achieve a better performance potentially, users may perform other types of imputations beforehand.</p>
      <p id="Par29">The data matrix is then normalized according to Eqs. <xref rid="Equ2" ref-type="disp-formula">2</xref> and <xref rid="Equ3" ref-type="disp-formula">3</xref>. In the next a few steps, sample covariance matrix <inline-formula id="IEq62"><alternatives><tex-math id="M137">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\textbf{S}_p = \textbf{MM}^{\textsf{T}}/p$$\end{document}</tex-math><mml:math id="M138"><mml:mrow><mml:msub><mml:mi mathvariant="bold">S</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi mathvariant="bold">MM</mml:mi><mml:mi mathvariant="sans-serif">T</mml:mi></mml:msup><mml:mo stretchy="false">/</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq62.gif"/></alternatives></inline-formula>, non-zero ordered eigenvalues <inline-formula id="IEq63"><alternatives><tex-math id="M139">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\ell _1,\ldots ,\ell _{n-1}$$\end{document}</tex-math><mml:math id="M140"><mml:mrow><mml:msub><mml:mi>ℓ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq63.gif"/></alternatives></inline-formula> and eigenvalue ratio <inline-formula id="IEq64"><alternatives><tex-math id="M141">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$r_i = \ell _{i+1}/\ell _i$$\end{document}</tex-math><mml:math id="M142"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">/</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq64.gif"/></alternatives></inline-formula> (as shown in the lower left panel in Fig. <xref rid="Fig2" ref-type="fig">2</xref>) are calculated accordingly. Although the above matrix operations involve only basic calculations, the data of interest are often massive, occupying a space of hundreds of gigabytes on disk, which may be expensive to process. In our ERStruct Python implementation, we accelerate the above computing steps by converting the CPU Tensor to a CUDA Tensor whenever GPU is available, taking advantage of fast matrix operations in GPU. Limited VRAM capacity on many GPUs makes it difficult to process massive data matrices. However, our approach demonstrates the flexibility of data splitting as a solution to this challenge when working with large data sets on resource-constrained hardware. Our package automatically splits the input data into multiple sub-arrays using a CPU before transmitting it to the GPU. The size of the sub-arrays is determined based on the available VRAM capacity in the working environment. By adopting this approach, users can accelerate computations on large-scale sequencing data, even with a small VRAM GPU, while simultaneously reducing overall memory usage. Our approach highlights the potential of data splitting as an effective method for handling large data sets on hardware with limited resources. Users may use other popular genotype data formats like VCF (variant call format) and bgen files. A tutorial to convert VCF or bgen files to NPY files can be found in the ERStruct code repository.</p>
    </sec>
    <sec id="Sec6">
      <title>Estimation of the number of top informative PCs</title>
      <p id="Par30">Finally, the sample eigenvalues <inline-formula id="IEq65"><alternatives><tex-math id="M143">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\ell _1,\ldots ,\ell _{n-1}$$\end{document}</tex-math><mml:math id="M144"><mml:mrow><mml:msub><mml:mi>ℓ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq65.gif"/></alternatives></inline-formula> from Eigens.py and the top two eigenvalues of simulated GOE matrices <inline-formula id="IEq66"><alternatives><tex-math id="M145">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(w_1^{(1)},w_2^{(1)}),\ldots ,(w_1^{(rep)}, w_2^{(rep)})$$\end{document}</tex-math><mml:math id="M146"><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq66.gif"/></alternatives></inline-formula> from GOE.py are transmitted together into TopPCs.py. Following Eqs. <xref rid="Equ4" ref-type="disp-formula">4</xref>–<xref rid="Equ7" ref-type="disp-formula">7</xref> in the ERStruct algorithm, the program output the estimation of the number of top informative PCs <inline-formula id="IEq67"><alternatives><tex-math id="M147">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{K}_{ER}$$\end{document}</tex-math><mml:math id="M148"><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">ER</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq67.gif"/></alternatives></inline-formula> in the end (as shown in the lower right panel in Fig. <xref rid="Fig2" ref-type="fig">2</xref>).</p>
      <p id="Par31">Note that if the target estimator <inline-formula id="IEq68"><alternatives><tex-math id="M149">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{K}_{ER}$$\end{document}</tex-math><mml:math id="M150"><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">ER</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq68.gif"/></alternatives></inline-formula> can not be found through Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>, an error message will appear. This may happen if the data exhibit serious multicollinearity. To resolve this potential issue, users may need to pre-process the genetic data to remove highly correlated genetic markers.</p>
    </sec>
  </sec>
  <sec id="Sec7">
    <title>Results</title>
    <p id="Par32">In this section, we compare the speed, maximum memory usage, and accuracy of the original MATLAB [<xref ref-type="bibr" rid="CR8">8</xref>] and our Python implementations of the ERStruct algorithm. We use the function tic in MATLAB and time.time in Python to record running time. To record memory usage, we use the Linux shell command /proc/&lt;pid&gt;/status | grep VmSize to check memory usage in MATLAB and use the Python module memory-profiler for checking in Python. Python (version 3.8.8) is used with NumPy (version 1.20.1), PyTorch (version 1.11.0) and Joblib (version 1.0.1). All results are obtained from a server running x86-64 Linux with 15 Intel(R) Xeon(R) E7-8891 v4 CPU cores and 12 GB Tesla K80 GPU.</p>
    <p id="Par33">We apply our ERStruct Python implementation to the publicly available 1000 Genomes Project [<xref ref-type="bibr" rid="CR10">10</xref>] data to estimate the number of top informative PCs. The 1000 Genomes Project is a whole genome sequencing data set with 2504 individuals from 26 subpopulations. Following the same procedure in [<xref ref-type="bibr" rid="CR8">8</xref>], the raw sequencing data file is first filtered out markers with MAF (Minor Allele Frequency) less than 0.05, 0.01, 0.005, and 0.001 using the PLINK software. The remaining number of markers are <inline-formula id="IEq69"><alternatives><tex-math id="M151">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_{0.05}=$$\end{document}</tex-math><mml:math id="M152"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mn>0.05</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq69.gif"/></alternatives></inline-formula> 7,921,8816, <inline-formula id="IEq70"><alternatives><tex-math id="M153">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_{0.01}=$$\end{document}</tex-math><mml:math id="M154"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mn>0.01</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq70.gif"/></alternatives></inline-formula> 13,650,478, <inline-formula id="IEq71"><alternatives><tex-math id="M155">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_{0.005}=$$\end{document}</tex-math><mml:math id="M156"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mn>0.005</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq71.gif"/></alternatives></inline-formula>17,307,567 and <inline-formula id="IEq72"><alternatives><tex-math id="M157">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_{0.001}=$$\end{document}</tex-math><mml:math id="M158"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mn>0.001</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq72.gif"/></alternatives></inline-formula> 28,793,505, respectively. Each pre-processed data is stored as NPY files and tested using our ERStruct Python package and the original MATLAB toolbox by [<xref ref-type="bibr" rid="CR8">8</xref>]. The testing parameters are fixed as: number of replications <inline-formula id="IEq73"><alternatives><tex-math id="M159">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$rep=5000$$\end{document}</tex-math><mml:math id="M160"><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>5000</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq73.gif"/></alternatives></inline-formula>, significance level <inline-formula id="IEq74"><alternatives><tex-math id="M161">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha = 10^{-3}$$\end{document}</tex-math><mml:math id="M162"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq74.gif"/></alternatives></inline-formula>.</p>
    <p id="Par34">The results are shown in Table <xref rid="Tab1" ref-type="table">1</xref>. The GPU-based Python implementation runs much faster than the CPU-based Python (2.02 times faster when MAF is greater than 0.001) and MATLAB (3.78 times faster when MAF is greater than 0.001) implementations. In terms of the maximum memory usage, the GPU-based Python implementation used only 0.27 of the CPU-based Python implementation and 0.31 of the MATLAB implementation (when MAF is greater than 0.001) due to the data splitting procedure. Noting that our function Eigens automatically splits large-scale data sets so that our algorithm can be run on a GPU with limited VRAM, so using GPU acceleration can be slower than using CPU only when the current available VRAM is too small. In our testing environment, this only happens when the available VRAM is less than 0.17 GB. It is only possible when another process in the working environment has taken up a large part of the available VRAM. In this case, we suggest releasing the VRAM first. In the package, we set the default VRAM value to 0.2 GB to ensure better performance.</p>
    <p id="Par35">To evaluate the accuracy of our ERStruct algorithm implemented in both the Python package and MATLAB toolbox, we conducted 30 identical experiments on CPU and GPU, respectively. We used the 1000 Genomes data set with MAF greater than 0.001, and set the number of replications to <inline-formula id="IEq75"><alternatives><tex-math id="M163">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$rep=5000$$\end{document}</tex-math><mml:math id="M164"><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>5000</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq75.gif"/></alternatives></inline-formula> and the significance level to <inline-formula id="IEq76"><alternatives><tex-math id="M165">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha = 10^{-3}$$\end{document}</tex-math><mml:math id="M166"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq76.gif"/></alternatives></inline-formula>. In all 30 experiments, the output consistently estimated <inline-formula id="IEq77"><alternatives><tex-math id="M167">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\hat{K}_{ER} = 25$$\end{document}</tex-math><mml:math id="M168"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover><mml:mrow><mml:mi mathvariant="italic">ER</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>25</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq77.gif"/></alternatives></inline-formula>. These results indicate that the ERStruct algorithm implemented in both versions are identical and produce the same output.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Running time (in minutes) and maximum memory usage (in GB) comparisons of the ERStruct algorithm, using MATLAB, Python CPU, and Python GPU implementations on the 1000 Genomes Project data with different MAF filtering thresholds</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">MAF filtering thresholds</th><th align="left">0.05</th><th align="left">0.01</th><th align="left">0.005</th><th align="left">0.001</th></tr></thead><tbody><tr><td align="left"><italic>Running Time</italic></td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">MATLAB</td><td char="." align="char">30.08</td><td char="." align="char">42.30</td><td char="." align="char">50.05</td><td char="." align="char">73.41</td></tr><tr><td align="left">Python CPU</td><td char="." align="char">34.89</td><td char="." align="char">66.54</td><td char="." align="char">84.97</td><td char="." align="char">137.54</td></tr><tr><td align="left">Python GPU</td><td char="." align="char">17.60</td><td char="." align="char">21.91</td><td char="." align="char">28.96</td><td char="." align="char">36.42</td></tr><tr><td align="left"><italic>Maximum Memory Usage</italic></td><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/><td char="." align="char"/></tr><tr><td align="left">MATLAB</td><td char="." align="char">51.55</td><td char="." align="char">62.22</td><td char="." align="char">69.54</td><td char="." align="char">92.50</td></tr><tr><td align="left">Python CPU</td><td char="." align="char">28.00</td><td char="." align="char">48.80</td><td char="." align="char">62.10</td><td char="." align="char">104.71</td></tr><tr><td align="left">Python GPU</td><td char="." align="char">10.08</td><td char="." align="char">15.07</td><td char="." align="char">18.33</td><td char="." align="char">28.67</td></tr></tbody></table></table-wrap></p>
  </sec>
  <sec id="Sec8">
    <title>Conclusion</title>
    <p id="Par36">In this paper, we developed a Python package that employs the ERStruct algorithm to determine the optimal number of top informative PCs in WGS data. By leveraging parallel computing on CPUs and GPU acceleration, our package demonstrates exceptional efficiency in performing matrix operations on large-scale sequencing data sets. To enhance the usability of our Python package across various environments, it features adaptive data splitting capabilities for GPU computation with limited VRAM. We conducted experiments that compared the computation speed of our ERStruct Python package to the ERStruct MATLAB toolbox in [<xref ref-type="bibr" rid="CR8">8</xref>]. Our results demonstrate a significant improvement in computation speed with the ERStruct Python package.</p>
  </sec>
  <sec id="Sec9">
    <title>Availability and requirements</title>
    <p id="Par37">
      <list list-type="bullet">
        <list-item>
          <p id="Par38">Project name: ERStruct.</p>
        </list-item>
        <list-item>
          <p id="Par39">Project home page: <ext-link ext-link-type="uri" xlink:href="https://github.com/ecielyang/ERStruct">https://github.com/ecielyang/ERStruct</ext-link>.</p>
        </list-item>
        <list-item>
          <p id="Par40">Programming language: Python.</p>
        </list-item>
        <list-item>
          <p id="Par41">Other requirements: Python 3.7<inline-formula id="IEq78"><alternatives><tex-math id="M169">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$-$$\end{document}</tex-math><mml:math id="M170"><mml:mo>-</mml:mo></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq78.gif"/></alternatives></inline-formula>3.9, PyTorch 1.10 or higher, NumPy, Joblib.</p>
        </list-item>
        <list-item>
          <p id="Par42">License: MIT License.</p>
        </list-item>
      </list>
    </p>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>ERStruct</term>
        <def>
          <p id="Par4">Eigenvalue-Ratio-based estimator to infer latent population Structure</p>
        </def>
      </def-item>
      <def-item>
        <term>PCA</term>
        <def>
          <p id="Par5">Principal Component Analysis</p>
        </def>
      </def-item>
      <def-item>
        <term>PC</term>
        <def>
          <p id="Par6">Principal Component</p>
        </def>
      </def-item>
      <def-item>
        <term>CPU</term>
        <def>
          <p id="Par7">Central Processing Unit</p>
        </def>
      </def-item>
      <def-item>
        <term>GPU</term>
        <def>
          <p id="Par8">Graphics Processing Unit</p>
        </def>
      </def-item>
      <def-item>
        <term>WGS</term>
        <def>
          <p id="Par9">Whole Genome Sequencing</p>
        </def>
      </def-item>
      <def-item>
        <term>GOE</term>
        <def>
          <p id="Par10">Gaussian Orthogonal Ensemble</p>
        </def>
      </def-item>
      <def-item>
        <term>VRAM</term>
        <def>
          <p id="Par11">Video Random Access Memory</p>
        </def>
      </def-item>
      <def-item>
        <term>MAF</term>
        <def>
          <p id="Par12">Minor Allele Frequency</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Jinghan Yang and Yuyang Xu contributed equally.</p>
    </fn>
  </fn-group>
  <ack>
    <p>The authors thank The University of Hong Kong for providing the computing resources.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>JY implemented the package, experiments and drafted the manuscript. YX conceived the ideas and drafted the manuscript. ZL conceived the ideas, supervised the manuscript writing and edited the manuscript. MY tested the package on GPU. GW helped with the manuscript revision. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>Dr. Gao Wang is supported by grant R01 AG076901.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The data sets generated and/or analyzed during the current study are available in the: <ext-link ext-link-type="uri" xlink:href="https://www.internationalgenome.org/data">https://www.internationalgenome.org/data</ext-link>.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar1">
      <title>Ethics approval and consent to participate</title>
      <p id="Par43">Not applicable.</p>
    </notes>
    <notes id="FPar2">
      <title>Consent for publication</title>
      <p id="Par44">Not applicable.</p>
    </notes>
    <notes id="FPar3" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par45">The authors declare that they have no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Price</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Patterson</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Plenge</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Weinblatt</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Shadick</surname>
            <given-names>NA</given-names>
          </name>
          <name>
            <surname>Reich</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Principal components analysis corrects for stratification in genome-wide association studies</article-title>
        <source>Nat Genet</source>
        <year>2006</year>
        <volume>38</volume>
        <issue>8</issue>
        <fpage>904</fpage>
        <pub-id pub-id-type="doi">10.1038/ng1847</pub-id>
        <?supplied-pmid 16862161?>
        <pub-id pub-id-type="pmid">16862161</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mathieson</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>McVean</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Differential confounding of rare and common variants in spatially structured populations</article-title>
        <source>Nat Genet</source>
        <year>2012</year>
        <volume>44</volume>
        <issue>3</issue>
        <fpage>243</fpage>
        <lpage>246</lpage>
        <pub-id pub-id-type="doi">10.1038/ng.1074</pub-id>
        <?supplied-pmid 22306651?>
        <pub-id pub-id-type="pmid">22306651</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Zhan</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Bragg-Gresham</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Kang</surname>
            <given-names>HM</given-names>
          </name>
          <name>
            <surname>Stambolian</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Chew</surname>
            <given-names>EY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ancestry estimation and control of population stratification for sequence-based association studies</article-title>
        <source>Nat Genet</source>
        <year>2014</year>
        <volume>46</volume>
        <issue>4</issue>
        <fpage>409</fpage>
        <lpage>415</lpage>
        <pub-id pub-id-type="doi">10.1038/ng.2924</pub-id>
        <?supplied-pmid 24633160?>
        <pub-id pub-id-type="pmid">24633160</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Menozzi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Piazza</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Cavalli-Sforza</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Synthetic maps of human gene frequencies in Europeans</article-title>
        <source>Science</source>
        <year>1978</year>
        <volume>201</volume>
        <fpage>786</fpage>
        <lpage>792</lpage>
        <pub-id pub-id-type="doi">10.1126/science.356262</pub-id>
        <?supplied-pmid 356262?>
        <pub-id pub-id-type="pmid">356262</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Patterson</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Reich</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Population structure and eigenanalysis</article-title>
        <source>PLoS Genet</source>
        <year>2006</year>
        <volume>2</volume>
        <fpage>e190</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pgen.0020190</pub-id>
        <?supplied-pmid 17194218?>
        <pub-id pub-id-type="pmid">17194218</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reich</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Price</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Patterson</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Principal component analysis of genetic data</article-title>
        <source>Nat Genet</source>
        <year>2008</year>
        <volume>40</volume>
        <fpage>491</fpage>
        <lpage>492</lpage>
        <pub-id pub-id-type="doi">10.1038/ng0508-491</pub-id>
        <?supplied-pmid 18443580?>
        <pub-id pub-id-type="pmid">18443580</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Johnstone</surname>
            <given-names>IM</given-names>
          </name>
        </person-group>
        <article-title>On the distribution of the largest eigenvalue in principal components analysis</article-title>
        <source>Ann Stat</source>
        <year>2001</year>
        <volume>29</volume>
        <issue>2</issue>
        <fpage>295</fpage>
        <lpage>327</lpage>
        <pub-id pub-id-type="doi">10.1214/aos/1009210544</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Yao</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>An eigenvalue ratio approach to inferring population structure from whole genome sequencing data</article-title>
        <source>Biometrics</source>
        <year>2022</year>
        <pub-id pub-id-type="doi">10.1111/biom.13691</pub-id>
        <?supplied-pmid 35942938?>
        <pub-id pub-id-type="pmid">35942938</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <collab>The International HapMap 3 Consortium</collab>
        </person-group>
        <article-title>Integrating common and rare genetic variation in diverse human populations</article-title>
        <source>Nature</source>
        <year>2010</year>
        <volume>467</volume>
        <fpage>52</fpage>
        <lpage>58</lpage>
        <pub-id pub-id-type="doi">10.1038/nature09298</pub-id>
        <pub-id pub-id-type="pmid">20811451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <collab>The 1000 Genomes Project Consortium</collab>
        </person-group>
        <article-title>A global reference for human genetic variation</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>526</volume>
        <issue>7571</issue>
        <fpage>68</fpage>
        <lpage>74</lpage>
        <pub-id pub-id-type="doi">10.1038/nature15393</pub-id>
        <pub-id pub-id-type="pmid">26432245</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Benaych-Georges</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Nadakuditi</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <article-title>The eigenvalues and eigenvectors of finite, low rank perturbations of large random matrices</article-title>
        <source>Adv Math</source>
        <year>2011</year>
        <volume>227</volume>
        <issue>1</issue>
        <fpage>494</fpage>
        <lpage>521</lpage>
        <pub-id pub-id-type="doi">10.1016/j.aim.2011.02.007</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Benaych-Georges</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Guionnet</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Maida</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Fluctuations of the extreme eigenvalues of finite rank deformations of random matrices</article-title>
        <source>Electron J Probab</source>
        <year>2011</year>
        <volume>16</volume>
        <issue>60</issue>
        <fpage>1621</fpage>
        <lpage>1662</lpage>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Yao</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Identifying the number of factors from singular values of a large sample auto-covariance matrix</article-title>
        <source>Ann Stat</source>
        <year>2017</year>
        <volume>45</volume>
        <issue>1</issue>
        <fpage>257</fpage>
        <lpage>288</lpage>
        <pub-id pub-id-type="doi">10.1214/16-AOS1452</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wigner</surname>
            <given-names>EP</given-names>
          </name>
        </person-group>
        <article-title>On the distribution of the roots of certain symmetric matrices</article-title>
        <source>Ann Math</source>
        <year>1958</year>
        <volume>67</volume>
        <issue>2</issue>
        <fpage>325</fpage>
        <lpage>327</lpage>
        <pub-id pub-id-type="doi">10.2307/1970008</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Arnold</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>On Wigner’s semicircle law for the eigenvalues of random matrices</article-title>
        <source>Probab Theory Relat Fields</source>
        <year>1971</year>
        <volume>19</volume>
        <issue>3</issue>
        <fpage>191</fpage>
        <lpage>198</lpage>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Paul</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Limiting spectral distribution of renormalized separable sample covariance matrices when p/n<inline-formula id="IEq80"><alternatives><tex-math id="M171">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rightarrow$$\end{document}</tex-math><mml:math id="M172"><mml:mo stretchy="false">→</mml:mo></mml:math><inline-graphic xlink:href="12859_2023_5305_Article_IEq80.gif"/></alternatives></inline-formula>0</article-title>
        <source>J Multivar Anal</source>
        <year>2014</year>
        <volume>126</volume>
        <fpage>25</fpage>
        <lpage>52</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jmva.2013.12.015</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
