<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7178409</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btz961</article-id>
    <article-id pub-id-type="publisher-id">btz961</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>iq</italic>: an R package to estimate relative protein abundances from ion quantification in DIA-MS-based proteomics</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-0333-2492</contrib-id>
        <name>
          <surname>Pham</surname>
          <given-names>Thang V</given-names>
        </name>
        <xref ref-type="corresp" rid="btz961-cor1"/>
        <!--<email>t.pham@amsterdamumc.nl</email>-->
        <xref ref-type="aff" rid="btz961-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Henneman</surname>
          <given-names>Alex A</given-names>
        </name>
        <xref ref-type="aff" rid="btz961-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jimenez</surname>
          <given-names>Connie R</given-names>
        </name>
        <xref ref-type="aff" rid="btz961-aff1"/>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Valencia</surname>
          <given-names>Alfonso</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="btz961-aff1"><institution>OncoProteomics Laboratory, Department of Medical Oncology, Cancer Center Amsterdam, Amsterdam UMC, Vrije Universiteit Amsterdam</institution>, Amsterdam 1081 HV, The <country country="NL">Netherlands</country></aff>
    <author-notes>
      <corresp id="btz961-cor1">To whom correspondence should be addressed. <email>t.pham@amsterdamumc.nl</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>4</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2020-01-07">
      <day>07</day>
      <month>1</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>07</day>
      <month>1</month>
      <year>2020</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>36</volume>
    <issue>8</issue>
    <fpage>2611</fpage>
    <lpage>2613</lpage>
    <history>
      <date date-type="received">
        <day>18</day>
        <month>7</month>
        <year>2019</year>
      </date>
      <date date-type="rev-recd">
        <day>15</day>
        <month>11</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>2</day>
        <month>1</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btz961.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>We present an R package called <italic>iq</italic> to enable accurate protein quantification for label-free data-independent acquisition (DIA) mass spectrometry-based proteomics, a recently developed global approach with superior quantitative consistency. We implement the popular maximal peptide ratio extraction module of the MaxLFQ algorithm, so far only applicable to data-dependent acquisition mode using the software suite MaxQuant. Moreover, our implementation shows, for each protein separately, the validity of quantification over all samples. Hence, <italic>iq</italic> exports a state-of-the-art protein quantification algorithm to the emerging DIA mode in an open-source implementation.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>The open-source R package is available on CRAN, <ext-link ext-link-type="uri" xlink:href="https://github.com/tvpham/iq/releases">https://github.com/tvpham/iq/releases</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://oncoproteomics.nl/iq">oncoproteomics.nl/iq</ext-link>.</p>
      </sec>
      <sec id="s3">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>The data-independent acquisition (DIA) approach in mass spectrometry (MS)-based proteomics has emerged as a promising alternative to data-dependent acquisition (DDA) because of its ability to provide a more complete data matrix by combining unbiased, broad range precursor ion fragmentation and targeted data extraction (<xref rid="btz961-B5" ref-type="bibr">Gillet <italic>et al.</italic>, 2012</xref>). Since in both approaches, protein abundances are derived from multiple partial intensities, peptide precursor and peptide fragment intensities in DDA and DIA, respectively, it is desirable to extend advanced DDA quantification methods and insights to DIA data, which possesses the largest degree of multiplicity. </p>
    <p>Existing methods to estimate protein abundances for DIA data include the so-called topN approach where the top <italic>N</italic> most intense ions are aggregated, either by summation or averaging, as they tend to be more robust than less intense ions. The MeanInt approach averages all extracted ion intensities (<xref rid="btz961-B1" ref-type="bibr">Ahrné <italic>et al.</italic>, 2013</xref>). Another method is the median polish algorithm (<xref rid="btz961-B7" ref-type="bibr">Tukey, 1977</xref>), available as part of the standard R distribution and employed by the package MSstats (<xref rid="btz961-B3" ref-type="bibr">Choi <italic>et al.</italic>, 2014</xref>). For DDA data, the MaxLFQ algorithm elegantly combines multiple peptide ratios to derive optimal protein ratios between pairs of samples (<xref rid="btz961-B4" ref-type="bibr">Cox <italic>et al.</italic>, 2014</xref>), which is widely used as part of the closed source MaxQuant software package. In this note, we present an open-source implementation of the MaxLFQ maximal peptide ratio extraction algorithm for protein quantification in a DIA data processing pipeline called <italic>iq</italic>, short for ion-based protein quantification.</p>
  </sec>
  <sec>
    <title>2 Implementation</title>
    <p>The analysis starts with a long-format data table as exported by Spectronaut version 13.0. The default columns include a primary protein identification column <italic>PG.ProteinGroups</italic>, secondary columns <italic>EG.ModifiedSequence, FG.Charge, F.FrgIon, F.Charge</italic> and quantitative values in <italic>F.PeakArea</italic>. By preparing the input data appropriately, we can use <italic>iq</italic> to accommodate other proteomic data extraction pipelines [see <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref> for examples of processing MaxQuant and OpenSWATH outputs (<xref rid="btz961-B6" ref-type="bibr">Röst <italic>et al.</italic>, 2014</xref>)].</p>
    <p><xref ref-type="fig" rid="btz961-F1">Figure 1</xref> outlines three main steps in <italic>iq</italic>. First, unique values in the primary column form the list of proteins and a concatenation of the secondary columns determines the fragments used to quantify individual proteins. We provide an option for median normalization of all observed intensities and visualization for quality control.
</p>
    <fig id="btz961-F1" orientation="portrait" position="float">
      <label>Fig. 1.</label>
      <caption>
        <p>The <italic>iq</italic> pipeline. The preprocessing step performs data filtering and median normalization. Subsequently, a numerical matrix is formed for each protein containing its fragment ion intensities. The MaxLFQ algorithm optimizes ratios <inline-formula id="IE1"><mml:math id="IM1"><mml:msub><mml:mi mathvariant="bold">b</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> between all pairs of samples <italic>i</italic> and <italic>j</italic></p>
      </caption>
      <graphic xlink:href="btz961f1"/>
    </fig>
    <p>Second, we enumerate a list of matrices of log2-transformed intensities for all proteins. Let <italic>X</italic> be an observed data matrix for a particular protein with <italic>n</italic> columns for samples and <italic>m</italic> rows for quantified fragment ions. The matrix <italic>X</italic> may have missing values. The aim is to estimate an <italic>n</italic>-vector <bold><italic>x</italic></bold> for relative protein abundance across all samples.</p>
    <p>The MaxLFQ algorithm obtains <bold><italic>x</italic></bold> by minimizing the sum of squared differences between the estimated pairwise sample ratio and the median of the observed ratios
<disp-formula id="E1"><label>(1)</label><mml:math id="M1"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo><mml:mo>∈</mml:mo><mml:mtext>valid</mml:mtext><mml:mo> </mml:mo><mml:mtext>pairs</mml:mtext></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi mathvariant="bold">b</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:math></disp-formula>where <inline-formula id="IE2"><mml:math id="IM2"><mml:msub><mml:mi mathvariant="bold">b</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the median of all pairwise fragment intensity ratios observed between sample <italic>i</italic> and <italic>j</italic> (here differences in log-space). For each fragment, all intensity ratios without missing values are valid pairs.</p>
    <p>Third, we solve the above minimization problem as follows. We populate a matrix <italic>A</italic> of size <italic>p </italic>×<italic> n</italic> and a <italic>p</italic>-element vector <bold><italic>b</italic></bold> where <italic>p</italic> is the number of valid pairs, and each row of <italic>A</italic> contains all zeroes except for two entries with value of −1 and +1 corresponding to the sample ratio in <bold><italic>b</italic></bold>. The minimization of (1) becomes an equality constrained least squares
<disp-formula id="E2"><mml:math id="M2"><mml:mtext>min</mml:mtext><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:mi>A</mml:mi><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="bold-italic">b</mml:mi><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mtext>subject</mml:mtext><mml:mo> </mml:mo><mml:mtext>to</mml:mtext><mml:mo> </mml:mo><mml:msup><mml:mn mathvariant="bold">1</mml:mn><mml:mi>T</mml:mi></mml:msup><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>=</mml:mo><mml:mi>c</mml:mi></mml:math></disp-formula>where <bold>1</bold> is an <italic>n</italic>-vector of ones and <italic>c</italic> is a scaling constant to preserve the average sum intensity. It can be shown that <bold><italic>x</italic></bold> is part of a solution of the system of <inline-formula id="IE3"><mml:math id="IM3"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> linear equations
<disp-formula id="E3"><label>(2)</label><mml:math id="M3"><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mn>2</mml:mn><mml:msup><mml:mi>A</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>A</mml:mi></mml:mtd><mml:mtd><mml:mn mathvariant="bold">1</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mn mathvariant="bold">1</mml:mn><mml:mi>T</mml:mi></mml:msup></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>z</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mn>2</mml:mn><mml:msup><mml:mi>A</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi mathvariant="bold-italic">b</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>c</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:math></disp-formula>where <italic>z</italic> is an auxiliary variable. We employ the R function <monospace>lsfit</monospace> to estimate <bold><italic>x</italic></bold>.</p>
    <p>Note that (2) has a unique solution when the square matrix on the left hand side is invertible. A close examination shows that <inline-formula id="IE4"><mml:math id="IM4"><mml:mrow><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mi>A</mml:mi></mml:mrow></mml:math></inline-formula> is the Laplacian matrix of the sample graph <inline-formula id="IE5"><mml:math id="IM5"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> whose nodes are the <italic>n</italic> samples, and two nodes are directly connected if there is at least a valid sample pair between them. If <inline-formula id="IE6"><mml:math id="IM6"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> is connected, that is there is a path connecting any two nodes, it can be shown that (2) has a unique solution. This is not the case when <inline-formula id="IE7"><mml:math id="IM7"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> is not connected. Therefore, we implement a recursive spreading algorithm to detect connected components of <inline-formula id="IE8"><mml:math id="IM8"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula>. Subsequently, the MaxLFQ algorithm is applied to each connected component. In principle, only samples within a connected component can be compared in downstream analysis due to factors such as different ionization efficiency of different protein fragments. An example is illustrated in <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S7</xref>. In short, we have specified the condition under which the algorithm will lead to a valid relative quantification.</p>
    <p>Finally, we also implement the topN method, the MeanInt method, and provide a wrapper for the median polish method in <italic>iq</italic>. The package is without any dependency on external R packages.</p>
  </sec>
  <sec>
    <title>3 Example</title>
    <p>We analyze a publicly available dataset used in a benchmark experiment for label-free DDA and DIA proteomics (<xref rid="btz961-B2" ref-type="bibr">Bruderer <italic>et al.</italic>, 2015</xref>). The dataset for each mode of data acquisition contains 24 runs of 8 biological replicates and 3 technical replicates, in which 12 proteins were spiked in at different concentrations. MaxQuant version 1.6.4.0 is used to process the DDA data, and Spectronaut version 13.0 is used for DIA data. The result of the MaxQuant DDA search is used as a spectral library in the DIA analysis. We use the default Spectronaut long format export with an addition of the columns: <italic>F.ExcludedFromQuantification</italic>, <italic>F.FrgLossType</italic>, <italic>F.FrgIon</italic>, <italic>F.Charge</italic> and <italic>F.PeakArea</italic>. An R script to process the Spectronaut output is as follows:<inline-graphic xlink:href="btz961ilf1.jpg" mimetype="image"/></p>
    <p>Briefly, the first two statements load the data into R and remove entries not used for quantification. The next four statements load the <italic>iq</italic> package and perform quantification in three steps as described in Section 2. The last statement exports the result to a text file. Protein quantitative visualization used in <xref ref-type="fig" rid="btz961-F1">Figure 1</xref> is created by a function call <monospace>iq</monospace><monospace>::plot</monospace><monospace>_protein(protein_list$P00366)</monospace>. In the <xref ref-type="supplementary-material" rid="sup1">Supplementary Material</xref>, we show that the MaxLFQ algorithm compares favorably with other methods in terms of both correlation to the ground-truth values for the 12 spike-in proteins and the stability of background proteins.</p>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>The R package <italic>iq</italic> contains an open-source implementation of the maximal peptide ratio extraction module of MaxLFQ algorithm in a complete pipeline for processing proteomics DIA data. It offers an additional option for protein quantification next to the topN and the median polish approach, while being a direct implementation of a popular algorithm for DDA analysis. We show that optimal relative protein quantification is achieved for comparisons involving the same peptide components.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>btz961_Supplementary_Data</label>
      <media xlink:href="btz961_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgement</title>
    <p>We thank the Dutch Cancer Society for support of this research (projects VU10212/2016, UVA2013-6331 and NKI2014-6813).</p>
    <p><italic>Conflict of Interest:</italic> none declared.</p>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btz961-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ahrné</surname><given-names>E.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>Critical assessment of proteome-wide label-free absolute abundance estimation strategies</article-title>. <source>Proteomics</source>, <volume>13</volume>, <fpage>2567</fpage>–<lpage>2578</lpage>.<pub-id pub-id-type="pmid">23794183</pub-id></mixed-citation>
    </ref>
    <ref id="btz961-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bruderer</surname><given-names>R.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>Extending the limits of quantitative proteome profiling with data-independent acquisition and application to acetaminophen-treated three-dimensional liver microtissues</article-title>. <source>Mol. Cell Proteomics</source>, <volume>14</volume>, <fpage>1400</fpage>–<lpage>1410</lpage>.<pub-id pub-id-type="pmid">25724911</pub-id></mixed-citation>
    </ref>
    <ref id="btz961-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Choi</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>MSstats: an R package for statistical analysis of quantitative mass spectrometry-based proteomic experiments</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>2524</fpage>–<lpage>2526</lpage>.<pub-id pub-id-type="pmid">24794931</pub-id></mixed-citation>
    </ref>
    <ref id="btz961-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cox</surname><given-names>J.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>Accurate proteome-wide label-free quantification by delayed normalization and maximal peptide ratio extraction, termed MaxLFQ</article-title>. <source>Mol. Cell Proteomics</source>, <volume>13</volume>, <fpage>2513</fpage>–<lpage>2526</lpage>.<pub-id pub-id-type="pmid">24942700</pub-id></mixed-citation>
    </ref>
    <ref id="btz961-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gillet</surname><given-names>L.C.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Targeted data extraction of the MS/MS spectra generated by data-independent acquisition: a new concept for consistent and accurate proteome analysis</article-title>. <source>Mol. Cell Proteomics</source>, <volume>11</volume>, <fpage>O111.016717</fpage>.</mixed-citation>
    </ref>
    <ref id="btz961-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Röst</surname><given-names>H.L.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>OpenSWATH enables automated, targeted analysis of data-independent acquisition MS data</article-title>. <source>Nat. Biotechnol</source>., <volume>32</volume>, <fpage>219</fpage>–<lpage>223</lpage>.<pub-id pub-id-type="pmid">24727770</pub-id></mixed-citation>
    </ref>
    <ref id="btz961-B7">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Tukey</surname><given-names>J.W.</given-names></name></person-group> (<year>1977</year>) <source>Exploratory Data Analysis</source>. 
<publisher-name>Addison-Wesley</publisher-name>, 
<publisher-loc>Reading, MA</publisher-loc>.</mixed-citation>
    </ref>
  </ref-list>
</back>
