<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">11026141</article-id>
    <article-id pub-id-type="pmid">38565260</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae178</article-id>
    <article-id pub-id-type="publisher-id">btae178</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EpiSegMix: a flexible distribution hidden Markov model with duration modeling for chromatin state discovery</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0009-0002-6377-2561</contrib-id>
        <name>
          <surname>Schmitz</surname>
          <given-names>Johanna Elena</given-names>
        </name>
        <aff><institution>Algorithmic Bioinformatics, Center for Bioinformatics Saar, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Fakultät MI, Saarland University, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Saarbrücken Graduate School of Computer Science, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aggarwal</surname>
          <given-names>Nihit</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Laufer</surname>
          <given-names>Lukas</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0563-7417</contrib-id>
        <name>
          <surname>Walter</surname>
          <given-names>Jörn</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Salhab</surname>
          <given-names>Abdulrahman</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Genomics Data Science Core, Integrated Genomics Services, Sidra Medicine</institution>, Doha, <country country="QA">Qatar</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-8536-6065</contrib-id>
        <name>
          <surname>Rahmann</surname>
          <given-names>Sven</given-names>
        </name>
        <aff><institution>Algorithmic Bioinformatics, Center for Bioinformatics Saar, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Fakultät MI, Saarland University, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
        <xref rid="btae178-cor1" ref-type="corresp"/>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
        <!--rahmann@cs.uni-saarland.de-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Kelso</surname>
          <given-names>Janet</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae178-cor1">Corresponding author. Algorithmic Bioinformatics, Center for Bioinformatics Saar and Saarland University, Saarland Informatics Campus E2.1, 66123 Saarbrücken, Germany. E-mail: <email>rahmann@cs.uni-saarland.de</email> (S.R.)</corresp>
      <fn id="btae178-FM1">
        <p>Johanna Elena Schmitz and Nihit Aggarwal Equal contribution.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-04-02">
      <day>02</day>
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>02</day>
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>4</issue>
    <elocation-id>btae178</elocation-id>
    <history>
      <date date-type="received">
        <day>06</day>
        <month>10</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>07</day>
        <month>3</month>
        <year>2024</year>
      </date>
      <date date-type="editorial-decision">
        <day>28</day>
        <month>3</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>01</day>
        <month>4</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>18</day>
        <month>4</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae178.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Automated chromatin segmentation based on ChIP-seq (chromatin immunoprecipitation followed by sequencing) data reveals insights into the epigenetic regulation of chromatin accessibility. Existing segmentation methods are constrained by simplifying modeling assumptions, which may have a negative impact on the segmentation quality.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We introduce EpiSegMix, a novel segmentation method based on a hidden Markov model with flexible read count distribution types and state duration modeling, allowing for a more flexible modeling of both histone signals and segment lengths. In a comparison with existing tools, ChromHMM, Segway, and EpiCSeg, we show that EpiSegMix is more predictive of cell biology, such as gene expression. Its flexible framework enables it to fit an accurate probabilistic model, which has the potential to increase the biological interpretability of chromatin states.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code: <ext-link xlink:href="https://gitlab.com/rahmannlab/episegmix" ext-link-type="uri">https://gitlab.com/rahmannlab/episegmix</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>ELIXIR-DE</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Each cell in a eukaryotic organism contains the same genetic information to build all required structural and functional gene products. However, cell-to-cell variation is essential for having specialized tissues with distinct physiological functions and to adapt to environmental changes (<xref rid="btae178-B10" ref-type="bibr">Cavalli and Heard 2019</xref>, <xref rid="btae178-B9" ref-type="bibr">Carter and Zhao 2021</xref>). This necessitates an additional layer of processes regulating gene expression to enable cell differentiation and to maintain cellular identities throughout cell divisions (<xref rid="btae178-B1" ref-type="bibr">Allis and Jenuwein 2016</xref>). Among the mechanisms tightly regulating gene expression are transcription factors and epigenetic modifications, like DNA methylation and histone modifications.</p>
    <sec>
      <title>1.1 Histone modifications</title>
      <p>With increasing knowledge about the role of histone modifications in altering the chromatin structure and DNA accessibility, it became apparent that different histone modifications are enriched in chromatin regions with distinct functional roles (<xref rid="btae178-B2" ref-type="bibr">Baker 2011</xref>). For example, modification H3K4me3 [in histone protein H3, the lysine at position 4 (K4) is trimethylated (me3)] is enriched in promoters and can be linked to transcriptional activation; H3K36me3 is enriched in active genes, and H3K27me3 can be associated with gene repression by the Polycomb protein complex (<xref rid="btae178-B7" ref-type="bibr">Blackledge and Klose 2021</xref>). Densely packed chromatin, called heterochromatin, is typically characterized by low levels of acetylation, whereas open, actively transcribed chromatin, called euchromatin, shows enrichment of acetylated lysine (<xref rid="btae178-B3" ref-type="bibr">Bannister and Kouzarides 2011</xref>). Combinatorial patterns of multiple histone modifications allow us to characterize so-called <italic toggle="yes">chromatin states</italic> that describe the different functional states of both coding and noncoding regions in the genome (<xref rid="btae178-B2" ref-type="bibr">Baker 2011</xref>).</p>
    </sec>
    <sec>
      <title>1.2 Chromatin immunoprecipitation followed by sequencing</title>
      <p>Chromatin immunoprecipitation followed by sequencing (ChIP-seq) enables the generation of genome-wide histone maps in high-throughput experiments (<xref rid="btae178-B4" ref-type="bibr">Barski <italic toggle="yes">et al.</italic> 2007</xref>). For ChIP-seq, DNA-binding proteins of interest, such as specifically modified histones or transcription factors, are tagged with specific antibodies. After chromatin shearing, DNA fragments bound to the desired proteins or protein-modifications are captured and the bound DNA is extracted for sequencing. Reads are mapped to the reference genome to infer the positioning of histone marks across the genome (<xref rid="btae178-B26" ref-type="bibr">Park 2009</xref>). The positional enrichment of reads is compromised by a certain amount of noise.</p>
    </sec>
    <sec>
      <title>1.3 Probabilistic models for segmentation</title>
      <p>The availability of genome-wide ChIP-seq data led to the development of automated methods for genome segmentation and annotation. These methods use a probabilistic model to detect recurrent patterns of epigenetic marks using the aligned reads to determine the signal intensity at different positions in the genome (<xref rid="btae178-F1" ref-type="fig">Fig. 1</xref>). HMMSeg (<xref rid="btae178-B13" ref-type="bibr">Day <italic toggle="yes">et al.</italic> 2007</xref>), ChromHMM (<xref rid="btae178-B16" ref-type="bibr">Ernst and Kellis 2010</xref>), and EpiCSeg (<xref rid="btae178-B22" ref-type="bibr">Mammana and Chung 2015</xref>) are based on hidden Markov models (HMMs), Segway, and Segway 2.0 (<xref rid="btae178-B11" ref-type="bibr">Chan <italic toggle="yes">et al.</italic> 2018</xref>) fit a Gaussian mixture model using a dynamic Bayesian network and <xref rid="btae178-B12" ref-type="bibr">Daneshpajouh <italic toggle="yes">et al.</italic> (2022)</xref> developed a state–space model assuming that the observed data is a linear function of the state-specific parameter matrix plus Gaussian noise. <xref rid="btae178-B24" ref-type="bibr">Marco <italic toggle="yes">et al.</italic> (2017)</xref> proposed a hierarchical HMM to simultaneously generate two segmentations at different length scales. The first (nucleosome level) segmentation works similarly to ChromHHM and captures histone modification patterns. The second (domain level) segmentation interprets sequences of nucleosome states (e.g. a super-enhancer domain state combining strong, weak, and flanking enhancer nucleosome states). In the present work, we focus on the accurate modeling of the nucleosome level. For a more comprehensive review, we refer to <xref rid="btae178-B21" ref-type="bibr">Libbrecht <italic toggle="yes">et al.</italic> (2021)</xref>.</p>
      <fig position="float" id="btae178-F1">
        <label>Figure 1.</label>
        <caption>
          <p>Chromatin segmentation: the reads of a ChIP-seq experiment are converted into a count matrix by counting the number of reads mapping to each nonoverlapping 200-bp genomic interval. The states of a multivariate HMM capture patterns in the multivariate read count distribution of the histone marks, and the transition probabilities between states capture the relations between adjacent chromatin states.</p>
        </caption>
        <graphic xlink:href="btae178f1" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>1.4 HMMs</title>
      <p>Multivariate HMMs capture both combinatorial patterns of multiple histone marks and adjacency relations between different genomic elements, which makes them a prominent tool for chromatin state discovery (<xref rid="btae178-B20" ref-type="bibr">Lee and Park 2014</xref>). An HMM describes two stochastic processes, an invisible Markov chain consisting of a finite set of hidden states and a visible process of observable signals. Here, the hidden states correspond to chromatin states and the observable signals to the observed read count vector per genomic region. Each hidden state has state-specific probabilities of emitting an observation, called <italic toggle="yes">emission probabilities</italic>. For chromatin segmentation, the genome is divided into nonoverlapping intervals (of typical length 200 bp), such that each observation is a vector of counts corresponding to the number of reads assigned to the interval per histone mark. Thus, the emission probabilities of a single hidden state capture a specific combinatorial pattern of multiple histone marks. Different states may hence define different functional genomic elements, such as promoters, enhancers or gene bodies. In addition, the relations between adjacent chromatin states are modeled via transition probabilities, which determine, for each state, the probabilities to either stay in the same state or to transition to another state.</p>
    </sec>
    <sec>
      <title>1.5 Modeling assumptions</title>
      <p>The ability of an HMM to detect patterns that correspond to biologically meaningful chromatin states is constrained by the modeling assumptions underlying the emission and transition probabilities. These assumptions are thus a distinguishing feature of existing HMM-based methods. For example, ChromHMM fits an HMM on binarized data (high versus low read count), where the emission probabilities are assumed to be independent Bernoulli experiments, and EpiCSeg models the emission probabilities using a Negative Multinomial distribution. Previous analyses of ChIP-seq data have shown that the read count distributions in some states and for some histone marks may be overdispersed and skewed, partly caused by differential protection against sonication, unequal binding affinity of distinct antibodies, sequence dependent PCR amplification and discrepancies when mapping to repeat-rich regions, which all introduce bias to the data (<xref rid="btae178-B14" ref-type="bibr">Diaz <italic toggle="yes">et al.</italic> 2012</xref>). Not all observed combinations of overdispersion and skewness can be captured by the commonly used probability distribution families, such as the Negative Binomial distribution. Furthermore, <xref rid="btae178-B5" ref-type="bibr">Beacon <italic toggle="yes">et al.</italic> (2021)</xref> showed that histone marks that are enriched in short domains, like promoters or TSS, are typically characterized by narrow peaks with high signal intensities, while histone marks enriched in broad domains, like heterochromatic regions, have lower signal intensities. Thus, regions in the genome covered by the same chromatin state may have different lengths, e.g. short promoters and long heterochromatic regions. Existing tools only model a single duration distribution type (Geometric) with exponentially decreasing probabilities, and can only fit the mean length of a region, but not its shape to the observed data. Hyperparameters, such as introduced by Segway, allow to place a prior on the expected segment length, but are still prone to the above limitations due to the unchanged geometric distribution type (<xref rid="btae178-B18" ref-type="bibr">Hoffman <italic toggle="yes">et al.</italic> 2012</xref>). Furthermore, they are either limited to the same parameters for all states or can be set for each numeric label, which may require extensive manual fine tuning.</p>
    </sec>
    <sec>
      <title>1.6 Novel contributions</title>
      <p>We propose a new flexible HMM architecture that relaxes the modeling assumptions of existing HMM-based methods in two ways. First, we allow to choose, for each histone modification, a different discrete distribution type from a broad selection (<xref rid="btae178-T1" ref-type="table">Table 1</xref>). This allows us to model more flexible read count distribution shapes, including overdispersed and skewed distributions. Second, we provide flexible duration modeling (using an automated state extension technique) to capture the characteristics of broad and narrow chromatin domains in a single segmentation with nucleosome resolution. By applying our method to publicly available ChIP-seq data, we show that such a flexible HMM leads to a better model fit and may increase segmentation accuracy and biological interpretability.</p>
      <table-wrap position="float" id="btae178-T1">
        <label>Table 1.</label>
        <caption>
          <p>Overview of available discrete distributions (<xref rid="btae178-B19" ref-type="bibr">Johnson et al. 1993</xref>).</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Name</th>
              <th rowspan="1" colspan="1">Parameters</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE1">
                  <mml:math id="IM1" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">N</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mn>1</mml:mn>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Poisson</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE2">
                  <mml:math id="IM2" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>λ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Negative binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE3">
                  <mml:math id="IM3" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mn>1</mml:mn>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Beta binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE4">
                  <mml:math id="IM4" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">N</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mo>α</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>β</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Beta negative binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE5">
                  <mml:math id="IM5" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>α</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>β</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Sichel</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE6">
                  <mml:math id="IM6" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>μ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>σ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>v</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">R</mml:mi>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec>
    <title>2 Methods</title>
    <sec>
      <title>2.1 Probabilistic model</title>
      <p>An HMM is formally defined as a quintuple <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mo>π</mml:mo><mml:mo>,</mml:mo><mml:mo>Σ</mml:mo><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is a finite set of hidden states, <italic toggle="yes">π</italic> is a probability vector with the starting probabilities for each state, Σ is a set of observable emission values, <italic toggle="yes">A</italic> is an <italic toggle="yes">N </italic>×<italic toggle="yes"> N</italic> matrix, where each entry <italic toggle="yes">a<sub>ij</sub></italic> denotes the transition probability to move from state <italic toggle="yes">i</italic> to state <italic toggle="yes">j</italic>, and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the complete collection of parameters required to calculate the emission probabilities of an observation in each state <italic toggle="yes">j</italic> (<xref rid="btae178-B20" ref-type="bibr">Lee and Park 2014</xref>). For a sample with <italic toggle="yes">T</italic> observations or time points, the collection of random variables is thus given by (<italic toggle="yes">O</italic>, <italic toggle="yes">Q</italic>), where <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the observed sequence and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the hidden state sequence.</p>
      <p>Due to the HMM independence assumptions [<italic toggle="yes">Q</italic> is a Markov chain, <italic toggle="yes">O<sub>t</sub></italic> is conditionally independent of everything else, given <italic toggle="yes">Q<sub>t</sub></italic>; <xref rid="btae178-B6" ref-type="bibr">Bilmes (1998)</xref>], the probability that an HMM with parameters <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo>θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>π</mml:mo><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> generates the combination <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mi>o</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mi>o</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:munderover></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>For given fixed <italic toggle="yes">O </italic>=<italic toggle="yes"> o</italic>, the Viterbi algorithm (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>) determines the state sequence <italic toggle="yes">q</italic> that maximizes this probability (for fixed transition and emission probabilities).</p>
      <p>For chromatin segmentation, the emission alphabet is given by the multivariate, countable infinite set
<disp-formula id="E2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mo>Σ</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>M</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>}</mml:mo><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">M</italic> is the dimension of the emission alphabet, corresponding to the number of histone modifications in the input data. Hence, the natural choice is to model the emission probabilities using a multivariate discrete distribution. Under the assumption that the read counts of all histone modifications are conditionally independent of each other given a state, the emission probability for an observation <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> in state <italic toggle="yes">j</italic> is given by
<disp-formula id="E3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>This leads to a flexible framework in which different distribution types may be selected to model the read counts of distinct histone marks. <xref rid="btae178-T1" ref-type="table">Table 1</xref> gives an overview over the univariate discrete distributions available in EpiSegMix (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref> for details). Distributions with more parameters are more flexible and hence lead to a more accurate model fit: One-parameter distributions (Poisson) may fit the mean of the observed read counts, but not variance or skewness; two-parameter distributions (e.g. Negative Binomial) may fit both mean and variance but not skewness; three-parameter distributions may fit all three moments. With data from several thousand genomic intervals per state, there is no danger of overfitting three parameters. Still, each distribution has its own limitations and dependencies between moments, so having a variety of options is beneficial. The best performing distribution may vary for histone modifications and between experiments with different data quality. Therefore, we provide a workflow to find for each mark the distribution that maximizes the log-likelihood of a three-state HMM with univariate emissions. For further information, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Duration modeling</title>
      <p>The typical HMM topology is a fully connected graph, including self-loops on states. Hence the sojourn time <italic toggle="yes">X</italic> in a state follows a Geometric distribution <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo>·</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> for some <inline-formula id="IE9000"><mml:math id="IM9000" display="inline" overflow="scroll"><mml:mi>p</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula>, with exponentially decreasing probabilities for longer durations (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>). Although the mean of a Geometric distribution can be made arbitrarily large, the variance increases with it and the mode stays at <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Geometric distributions model durations that are short with higher probability, but have limited flexibility when modeling longer durations with a mode far away from 1. We therefore propose to use an extended-state HMM architecture, in which each state is internally represented as a sub-HMM. Each sub-HMM has a linear left-to-right topology with a different number of sub-states, but with the additional constraints that all sub-states have the same emission probabilities and same self-transition probabilities (<xref rid="btae178-B28" ref-type="bibr">Russell and Cook 1987</xref>) (see <xref rid="btae178-F2" ref-type="fig">Fig. 2A</xref>). With this topology, the state duration is the sum of a number of independent Geometrically distributed random variables, which has a Negative Binomial distribution. It has two parameters: the state-exit probability <italic toggle="yes">P</italic> (same as for a Geometric distribution), and the copy number <italic toggle="yes">r</italic> (where <italic toggle="yes">r </italic>=<italic toggle="yes"> </italic>1 gives the Geometric distribution). In contrast to a Geometric distribution, the mean and variance of a Negative Binomial distribution can be controlled independently, and the mode can be placed at an arbitrary duration (<xref rid="btae178-F2" ref-type="fig">Fig. 2B</xref>). Therefore, both long and short durations can be modeled flexibly.</p>
      <fig position="float" id="btae178-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Duration modeling. (A) Extended-state HMM with different numbers of states in the sub-HMMs for a univariate four-state HMM. (B) Comparison of state duration distribution for a state in a classical HMM (<italic toggle="yes">r </italic>=<italic toggle="yes"> </italic>1) and in a topology HMM with two or four sub-states to achieve the same mean of 5 (left) or 20 (right).</p>
        </caption>
        <graphic xlink:href="btae178f2" position="float"/>
      </fig>
      <p>The number of sub-states is fitted automatically during parameter estimation. Starting from a standard ergodic topology (each state is represented by one sub-state), the segment lengths are computed for each state under the current model. The number of sub-states is then given by the estimated parameter <italic toggle="yes">r</italic> of a Negative Binomial distribution under the additional constraint that <italic toggle="yes">r</italic> is a natural number between 1 and 5. Each state may hence have a different number of sub-states depending on the observed segment lengths. By default, the topology is adjusted twice. Before the adjustments, the parameters of the HMM are estimated for a fixed number of iterations (default 5) and until convergence for the final topology.</p>
    </sec>
    <sec>
      <title>2.3 Parameter estimation</title>
      <p>Before an HMM can be used to estimate the state sequence, its parameters (transition and emission probabilities) must be estimated. As we typically do not have labeled training data, parameter estimation must proceed in an unsupervised manner using the Baum–Welch algorithm, which is a concretization of the general expectation maximization (EM) algorithm tailored to the structure of HMMs (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>). It alternates between estimating the model parameters (M-step), given a (fuzzy or probabilistic) assignment of observations to states, and re-estimating the state membership probabilities of each observation (E-step) until convergence (details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>3 Implementation</title>
    <p>The flexible distribution HMM and parameter estimation is implemented in C++ as a command-line tool <monospace>EpiSegMix</monospace>. Its source code is at <ext-link xlink:href="https://gitlab.com/rahmannlab/episegmix" ext-link-type="uri">https://gitlab.com/rahmannlab/episegmix</ext-link>.</p>
    <p>All steps of the surrounding workflow are incorporated in a <monospace>Snakemake</monospace> workflow (<xref rid="btae178-B25" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic> 2021</xref>).</p>
    <p>By default, we estimate parameters on the ENCODE pilot regions which contain a good representation of the whole genome and are thus commonly used to fit the model (<xref rid="btae178-B18" ref-type="bibr">Hoffman <italic toggle="yes">et al.</italic> 2012</xref>, <xref rid="btae178-B12" ref-type="bibr">Daneshpajouh <italic toggle="yes">et al.</italic> 2022</xref>). Alternatively, the user may specify a list of chromosomes to be used for model fitting. The segmentation is performed genome-wide.</p>
    <p>The main output of chromatin segmentation is a file that assigns one state to each position in the genome, and an HTML report with plots that characterize the model and segmentation, enabling their biological interpretation. For example, the heatmap showing the normalized histone modification intensities of each state (as in <xref rid="btae178-F6" ref-type="fig">Fig. 6B</xref>) is central to determine the genomic function of the states.</p>
  </sec>
  <sec>
    <title>4 Results</title>
    <p>We evaluated EpiSegMix on publicly available ChIP-seq data for the human cell lines K562, HepG2, GM12878, IMR90, H1, and SJCRH30 provided by the ENCODE consortium (<xref rid="btae178-B15" ref-type="bibr">Dunham <italic toggle="yes">et al.</italic> 2012</xref>) using the most recently processed data. With the selected cell lines, we evaluate our method on ChIP-seq experiments that were performed over the last decade (from 2010 to 2020) with different data properties (e.g. the mapped read length ranges from 36 to 100 bp). To analyze the robustness of all methods, we generated the count matrix for two replicate experiments each (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>). To reproduce the results, all accession numbers are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S9</xref> and the script to create the count matrix is part of the code repository. We restricted our analysis to the six core histone marks H3K9me3, H3K27me3, H3K36me3, H3K4me1, H3K4me3, and H3K27ac defined by the IHEC consortium (<xref rid="btae178-B8" ref-type="bibr">Bujold <italic toggle="yes">et al.</italic> 2016</xref>).</p>
    <p>Since chromatin segmentation is an unsupervised method and no ground truth is available, we evaluate the performance of EpiSegMix by comparing it to three established chromatin segmentation tools ChromHMM (<xref rid="btae178-B17" ref-type="bibr">Ernst and Kellis 2012</xref>), EpiCSeg (<xref rid="btae178-B22" ref-type="bibr">Mammana and Chung 2015</xref>), and Segway (<xref rid="btae178-B11" ref-type="bibr">Chan <italic toggle="yes">et al.</italic> 2018</xref>).</p>
    <p>We first perform a quantitative comparison by evaluating how well the different methods can predict gene expression and ATAC-seq data. Afterwards, we analyze how the different methods reflect known genome biology by showing further characteristic plots for one exemplary dataset.</p>
    <sec>
      <title>4.1 Data processing</title>
      <p>In a preprocessing step, we convert the aligned reads into a count matrix using the <italic toggle="yes">bamsignals</italic> package (<xref rid="btae178-B23" ref-type="bibr">Mammana and Helmuth 2023</xref>). In the count matrix, each row corresponds to a consecutive, nonoverlapping region with a fixed window size (default 200 base pairs), called bins, and each column corresponds to a distinct histone mark. Each read is assigned to exactly one genomic bin depending on the position of its 5’ end.</p>
      <p>For all methods, we fitted a 10-state model. EpiSegMix and Segway were trained on the ENCODE pilot regions of <italic toggle="yes">hg38</italic>. For EpiSegMix, three-state HMMs were fitted individually for each mark and different distributions. We then chose the distribution with the highest log-likelihood, listed in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section 4</xref>. For Segway, the <italic toggle="yes">resolution</italic> was set to 200 bp, the <italic toggle="yes">track-weight</italic> to 0.01, and the <italic toggle="yes">segtransition-weight-scale</italic> and <italic toggle="yes">prior-strength</italic> to 1. For ChromHMM and EpiCSeg, the default parameters were used (200 bp resolution, 10-state model).</p>
    </sec>
    <sec>
      <title>4.2 Advantages of flexible distribution modeling</title>
      <p>To show the advantages of flexible emission and duration distribution types for chromatin segmentation, we compare fitted models using different emission distributions and with and without duration modeling. Narrow marks, such as H3K4me3, often have skewed read count distributions. Fitting the Negative Binomial (2 parameters) and Sichel (3 parameters) distribution to the read counts of H3K4me3 shows the limitation of the Negative Binomial distributions to model highly skewed and overdispersed data (<xref rid="btae178-F3" ref-type="fig">Fig. 3A</xref>). Further evaluation of the effect that emission modeling has on the segmentation is provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.</p>
      <fig position="float" id="btae178-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Flexible emission and duration modeling. The histograms show the sample distribution and the curves show the theoretical distribution fitted by the model. (A) Results of fitting a three-state HMM to the mark H3K4me3 using the Negative Binomial and Sichel distribution (for the state with high H3K4me3 in HepG2_1). (B) State duration in the HepG2_1 promoter state for an HMM with a classic (Geometric) and extended (Negative Binomial) topology.</p>
        </caption>
        <graphic xlink:href="btae178f3" position="float"/>
      </fig>
      <p><xref rid="btae178-F3" ref-type="fig">Figure 3B</xref> shows that the state duration, determining the segment length (number of consecutive bins assigned to the same state), does not follow a Geometric distribution for most chromatin states. In comparison, the Negative Binomial distribution, as fitted by our flexible duration model, leads to a more accurate description of the real segment length distribution.</p>
    </sec>
    <sec>
      <title>4.3 Evaluation of gene expression prediction</title>
      <p>Since a biologically meaningful segmentation should have states that correlate with different gene expression levels, we compared how well the chromatin states of EpiSegMix, EpiCSeg, ChromHMM, and Segway can predict gene expression. To measure the gene expression in each 200 bp bin that contains (part of) a protein-coding gene, we used total RNA-seq experiments for the different cell lines provided by ENCODE and assigned each bin the log(FPKM + 1) normalized expression value of the gene (FPKM: fragments per kilobase of transcript per million mapped reads). We performed linear regression with the state labels as categorical predictors, i.e. for each bin <italic toggle="yes">i’</italic>s true expression <italic toggle="yes">x<sub>i</sub></italic>, we used the state-specific mean expression as predictor <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and measured the mean quadratic regression error versus the mean quadratic error using the global mean <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></inline-formula> as predictor and computed the coefficient of determination <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>/</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> (between 0 and 1, where 1 is perfect). The <italic toggle="yes">R</italic><sup>2</sup> values vary for the different cell lines, which can partly be explained by the unequal data quality. <xref rid="btae178-F4" ref-type="fig">Figure 4</xref> compares the <italic toggle="yes">R</italic><sup>2</sup> values of the different methods across cell lines. On average, EpiSegMix has the highest predictive power among the methods.</p>
      <fig position="float" id="btae178-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Prediction of transcription levels from chromatin state labels: coefficient of determination <italic toggle="yes">R</italic><sup>2</sup> (<italic toggle="yes">y</italic>-axis) using state labels as categorical predictors for <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>FPKM</mml:mtext><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> expression values for the different methods (<italic toggle="yes">x</italic>-axis) on different cell lines (color). Black lines indicate mean <italic toggle="yes">R</italic><sup>2</sup> for each method.</p>
        </caption>
        <graphic xlink:href="btae178f4" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.4 Evaluation of ATAC-seq prediction</title>
      <p>We performed a similar analysis predicting ATAC-seq read counts instead of gene expression levels for all cell lines with available ATAC-seq experiments. We counted how many reads of the ATAC-seq experiment map to each nonoverlapping 200 bp bin in the genome to generate a count matrix in the same way as for the histone counts. In the same way as for gene expression, we performed linear regression to predict log-transformed ATAC-seq read counts using the state labels as categorical predictors. Since ATAC-seq measures the chromatin accessibility, active states, like promoter or transcription states, should be predictive of high ATAC-seq counts, while heterochromatic states should be predictive of low ATAC-seq counts. <xref rid="btae178-F5" ref-type="fig">Figure 5</xref> shows that EpiSegMix and EpiCSeg have a similar predictive power of chromatin accessibility, as measured by the coefficient of determination <italic toggle="yes">R</italic><sup>2</sup>, while ChromHMM and Segway have lower <italic toggle="yes">R</italic><sup>2</sup> scores on average.</p>
      <fig position="float" id="btae178-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Prediction of ATAC-seq levels from chromatin state labels. The plot shows the coefficient of variation (<italic toggle="yes">R</italic><sup>2</sup>) using standard linear regression with the state labels as categorical predictors to predict <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula> transformed ATAC counts. The black line shows the mean <italic toggle="yes">R</italic><sup>2</sup> value.</p>
        </caption>
        <graphic xlink:href="btae178f5" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.5 Evaluation of reflected genome biology</title>
      <p>We perform a qualitative analysis of the different methods by comparing the similarities of the genome-wide segmentation and functional assignment of states, their genome coverage, overall segment length, and enrichment around protein coding genes (<xref rid="btae178-F6" ref-type="fig">Fig. 6</xref>). An in-depth example (genome browser view) is provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>. For better comparability, we manually assigned a label that best describes the biological function of the state to each numerical state ID. This facilitates the comparison of state assignments between methods. A description of each label is given in <xref rid="btae178-F6" ref-type="fig">Fig. 6E</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S8</xref>.</p>
      <fig position="float" id="btae178-F6">
        <label>Figure 6.</label>
        <caption>
          <p>Comparison between EpiSegMix and EpiCSeg, Segway and ChromHMM for K562_1. (A) State overlap between methods. The bar heights correspond to the genomic coverage of the biologically annotated state and the edge thickness to the overlap between the methods. (B) Heatmaps showing the histone enrichment per state. The mean counts per state are normalized column wise, such that for each histone modification the state with the maximum mean count has a value of one and the state with the lowest mean count has a value of zero. (C) State distribution. The line plots show how often each state occurs around protein coding genes. (D) State duration. The plot shows for each biologically annotated state the state length distribution in base pairs of the different methods. (E) State description.</p>
        </caption>
        <graphic xlink:href="btae178f6" position="float"/>
      </fig>
      <p><xref rid="btae178-F6" ref-type="fig">Figure 6A</xref> shows that the states assigned by the count-based methods EpiSegMix, EpiCSeg, and Segway have a similar genome coverage and high overlap between state assignments. Moreover, all three methods EpiSegMix, EpiCSeg, and Segway provide a deeper epigenomic distinction of heterochromatic regions that ChromHMM aggregates into a single state. EpiSegMix discriminates a “no signal” state from a strong and a weak heterochromatic state that show distinctive patterns of enriched histone marks. Thereby, EpiSegMix better captures transitions from closed to open chromatin as compared to ChromHMM (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>). This distinction is also supported by Segway and EpiCSeg. In addition, EpiSegMix defines a more consistent and accurate label for unmappable regions in comparison to all other methods (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>). While, in a 10-state model, ChromHMM appears to provide a more fine-grained distinction of regulatory states, such as weak and flanking promoter regions, the robustness of these classifications is not always given. Thus, a biological interpretation of these regions should be taken with caution (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>).</p>
      <p><xref rid="btae178-F6" ref-type="fig">Figure 6B</xref> shows the genome wide enrichment of histone marks across states for each tool. All methods find similar patterns of histone marks: Enrichment of regulatory marks such as H3K27ac, H3K4me1, and H3K4me3, is predominantly observed in promoter and enhancer states, as expected. Actively transcribed mark H3K36me3 is enriched in transcription states; the repressive mark H3K27me3 is most strongly enriched in Polycomb repressed heterochromatin. Overall absolute levels of H3K9me3 are low, but due to the column-wise normalization in <xref rid="btae178-F6" ref-type="fig">Fig. 6B</xref>, it appears enriched in a number of states, possibly reflecting overall background noise.</p>
      <p>Despite the overall high state concordance across tools, some differences can be observed particularly in a gene centered comparison, i.e. across gene bodies, including ±3 kb upstream and downstream of the gene transcription start and gene end, respectively (<xref rid="btae178-F6" ref-type="fig">Fig. 6C</xref>). Coordinates were taken from ENCODE reference ENCFF824ZKD. EpiSegMix and Segway show a higher enrichment of promoter states around TSSs as compared to ChromHMM and EpiCSeg, which discriminate between weak and strong promoters. This distinction is not linked to a better prediction of transcription levels.</p>
      <p>When comparing the segment lengths (i.e. consecutive genomic bins assigned to the same state) and their genomic distributions across the different methods we observe that the duration flexibility of EpiSegMix helps to capture the wide range of short (promoters/enhancers), intermediate (short to long genes), and long (heterochromatic regions) state durations in a more consistent manner as compared to all other methods. For example, EpiSegMix’ Tx state most effectively covers large genes (i.e. over 40% of all human genes are longer than 0.8 × 10<sup>4</sup> bp), allowing for a more accurate annotation of genes among different classes. Another advantage of EpiSegMix in comparison to EpiCSeg and Segway can be observed in the longer segment lengths for Polycomb repressed genes (Repr_Pc) and for heterochromatic regions (Het_Wk and Het_Str), which more closely match the known size of broad domains (<xref rid="btae178-B29" ref-type="bibr">Steensel and Belmont 2017</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>We developed EpiSegMix, a flexible HMM framework for chromatin segmentation. We enhanced the flexibility of existing HMMs with respect to modeling both emission probabilities and state durations. To account for the overdispersed and skewed ChIP-seq read count distributions, the read counts of each histone modification can follow a different discrete distribution type. We currently support a variety of distributions, and further distributions may be added in the future. The internal HMM topology was adjusted to be able to model state durations that follow a Negative Binomial instead of a Geometric distribution, which better reflects the inherent segment length of chromatin states that cover either small peaks or broad domains. For example, lamina-associated domains (LADs; heterochromatin at the nuclear periphery) usually have a size between 10<sup>4</sup> and 10<sup>7</sup> bp (<xref rid="btae178-B29" ref-type="bibr">Steensel and Belmont 2017</xref>).</p>
    <p>A comparison with ChromHMM, Segway, and EpiCSeg suggests that EpiSegMix has the potential to provide segmentations that better reflect genomic annotations and yields states that are more predictive of gene expression. Moreover, the flexible duration modeling allows to effectively capture the reflective state lengths of long gene bodies and heterochromatic domains. The influence of the modified HMM topology on the segmentation suggests that testing other topology models is an important aspect to increase the modeling accuracy. Another direction of future work could be to combine the flexible duration modeling of EpiSegMix with a hierarchical HMM, as proposed by <xref rid="btae178-B24" ref-type="bibr">Marco <italic toggle="yes">et al.</italic> (2017)</xref>, which may prove to be a powerful idea to perform inter-dependent chromatin segmentation at different length scales.</p>
    <p>Although our results suggest that flexible distributions such as the Sichel or Beta Negative Binomial distribution often give the best results, we support a variety of distributions to deal with changing data properties and provide an easily extendable framework to integrate other data, such as ATAC-seq, DNase-seq or transcription factor ChIP-seq data.</p>
    <p>In summary, we show that the modeling assumptions of the HMM have an impact on the segmentation quality and biological interpretation. Due to its high flexibility, EpiSegMix accurately fits HMM read count data with varying distributional properties and provides the additional option of flexible duration modeling. Finally, EpiSegMix provides a widely configurable framework for chromatin segmentation that can be applied to a wide range of data.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae178_Supplementary_Data</label>
      <media xlink:href="btae178_supplementary_data.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We acknowledge the ENCODE consortium for producing the data.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>J.E.S. and N.A. contributed equally to this work. The method was developed by J.E.S. and N.A. under the supervision of J.W., A.S., and S.R. L.L. performed preliminary analyses to select suitable distributions. J.E.S, N.A., J.W., and S.R. contributed to writing, and all authors contributed to revising the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by internal funding and by ELIXIR-DE (de.nbi), the research infrastructure for life science data (grant to N.A.).</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data can be downloaded from the ENCODE portal. All accession numbers are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S9</xref>.</p>
  </sec>
  <sec>
    <title>Ethics declaration</title>
    <p>None declared.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae178-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Allis</surname><given-names>CD</given-names></string-name>, <string-name><surname>Jenuwein</surname><given-names>T.</given-names></string-name></person-group><article-title>The molecular hallmarks of epigenetic control</article-title>. <source>Nat Rev Genet</source><year>2016</year>;<volume>17</volume>:<fpage>487</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">27346641</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baker</surname><given-names>M.</given-names></string-name></person-group><article-title>Making sense of chromatin states</article-title>. <source>Nat Methods</source><year>2011</year>;<volume>8</volume>:<fpage>717</fpage>–<lpage>22</lpage>.<pub-id pub-id-type="pmid">21878916</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bannister</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Kouzarides</surname><given-names>T.</given-names></string-name></person-group><article-title>Regulation of chromatin by histone modifications</article-title>. <source>Cell Res</source><year>2011</year>;<volume>21</volume>:<fpage>381</fpage>–<lpage>95</lpage>.<pub-id pub-id-type="pmid">21321607</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barski</surname><given-names>A</given-names></string-name>, <string-name><surname>Cuddapah</surname><given-names>S</given-names></string-name>, <string-name><surname>Cui</surname><given-names>K</given-names></string-name></person-group><etal>et al</etal><article-title>High-resolution profiling of histone methylations in the human genome</article-title>. <source>Cell</source><year>2007</year>;<volume>129</volume>:<fpage>823</fpage>–<lpage>37</lpage>.<pub-id pub-id-type="pmid">17512414</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Beacon</surname><given-names>TH</given-names></string-name>, <string-name><surname>Delcuve</surname><given-names>GP</given-names></string-name>, <string-name><surname>López</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>The dynamic broad epigenetic (H3K4me3, H3K27ac) domain as a mark of essential genes</article-title>. <source>Clin Epigenet</source><year>2021</year>;<volume>13</volume>:<fpage>138</fpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bilmes</surname><given-names>J.</given-names></string-name></person-group><article-title>A gentle tutorial of the EM algorithm and its application to parameter estimation for Gaussian mixture and hidden Markov models</article-title>. <source>ICSI Tech Rep Ser vol. TR-97-021, Berkeley,</source><year>1998</year>.</mixed-citation>
    </ref>
    <ref id="btae178-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blackledge</surname><given-names>NP</given-names></string-name>, <string-name><surname>Klose</surname><given-names>RJ.</given-names></string-name></person-group><article-title>The molecular principles of gene regulation by polycomb repressive complexes</article-title>. <source>Nat Rev Mol Cell Biol</source><year>2021</year>;<volume>22</volume>:<fpage>815</fpage>–<lpage>33</lpage>.<pub-id pub-id-type="pmid">34400841</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bujold</surname><given-names>D</given-names></string-name>, <string-name><surname>Morais</surname><given-names>DAdL</given-names></string-name>, <string-name><surname>Gauthier</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>The international human epigenome consortium data portal</article-title>. <source>Cell Syst</source><year>2016</year>;<volume>3</volume>:<fpage>496</fpage>–<lpage>9.e2</lpage>.<pub-id pub-id-type="pmid">27863956</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Carter</surname><given-names>B</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>K.</given-names></string-name></person-group><article-title>The epigenetic basis of cellular heterogeneity</article-title>. <source>Nat Rev Genet</source><year>2021</year>;<volume>22</volume>:<fpage>235</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">33244170</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cavalli</surname><given-names>G</given-names></string-name>, <string-name><surname>Heard</surname><given-names>E.</given-names></string-name></person-group><article-title>Advances in epigenetics link genetics to the environment and disease</article-title>. <source>Nature</source><year>2019</year>;<volume>571</volume>:<fpage>489</fpage>–<lpage>99</lpage>.<pub-id pub-id-type="pmid">31341302</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chan</surname><given-names>RCW</given-names></string-name>, <string-name><surname>Libbrecht</surname><given-names>MW</given-names></string-name>, <string-name><surname>Roberts</surname><given-names>EG</given-names></string-name></person-group><etal>et al</etal><article-title>Segway 2.0: gaussian mixture models and minibatch training</article-title>. <source>Bioinformatics</source><year>2018</year>;<volume>34</volume>:<fpage>669</fpage>–<lpage>71</lpage>.<pub-id pub-id-type="pmid">29028889</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Daneshpajouh</surname><given-names>H</given-names></string-name>, <string-name><surname>Chen</surname><given-names>B</given-names></string-name>, <string-name><surname>Shokraneh</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Continuous chromatin state feature annotation of the human epigenome</article-title>. <source>Bioinformatics</source><year>2022</year>;<volume>38</volume>:<fpage>3029</fpage>–<lpage>36</lpage>.<pub-id pub-id-type="pmid">35451453</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Day</surname><given-names>N</given-names></string-name>, <string-name><surname>Hemmaplardh</surname><given-names>A</given-names></string-name>, <string-name><surname>Thurman</surname><given-names>RE</given-names></string-name></person-group><etal>et al</etal><article-title>Unsupervised segmentation of continuous genomic data</article-title>. <source>Bioinformatics</source><year>2007</year>;<volume>23</volume>:<fpage>1424</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">17384021</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Diaz</surname><given-names>A</given-names></string-name>, <string-name><surname>Park</surname><given-names>K</given-names></string-name>, <string-name><surname>Lim</surname><given-names>DA</given-names></string-name></person-group><etal>et al</etal><article-title>Normalization, bias correction, and peak calling for ChIP-seq</article-title>. <source>Stat Appl Genet Mol Biol</source><year>2012</year>;<volume>11</volume>:<fpage>Article 9</fpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dunham</surname><given-names>I</given-names></string-name>, <string-name><surname>Kundaje</surname><given-names>A</given-names></string-name>, <string-name><surname>Aldred</surname><given-names>SF</given-names></string-name></person-group><etal>et al</etal><article-title>An integrated encyclopedia of DNA elements in the human genome</article-title>. <source>Nature</source><year>2012</year>;<volume>489</volume>:<fpage>57</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group><article-title>Discovery and characterization of chromatin states for systematic annotation of the human genome</article-title>. <source>Nat Biotechnol</source><year>2010</year>;<volume>28</volume>:<fpage>817</fpage>–<lpage>25</lpage>.<pub-id pub-id-type="pmid">20657582</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group><article-title>ChromHMM: automating chromatin-state discovery and characterization</article-title>. <source>Nat Methods</source><year>2012</year>;<volume>9</volume>:<fpage>215</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">22373907</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hoffman</surname><given-names>MM</given-names></string-name>, <string-name><surname>Buske</surname><given-names>OJ</given-names></string-name>, <string-name><surname>Wang</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Unsupervised pattern discovery in human chromatin structure through genomic segmentation</article-title>. <source>Nat Methods</source><year>2012</year>;<volume>9</volume>:<fpage>473</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">22426492</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B19">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Johnson</surname><given-names>NL</given-names></string-name>, <string-name><surname>Kotz</surname><given-names>S</given-names></string-name>, <string-name><surname>Kemp</surname><given-names>AW</given-names></string-name></person-group><etal>et al</etal><source>Univariate discrete distributions</source>, <edition>2nd edn</edition>. <publisher-loc>New York, NY</publisher-loc>: <publisher-name>Wiley</publisher-name>, <year>1993</year>.</mixed-citation>
    </ref>
    <ref id="btae178-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>K-E</given-names></string-name>, <string-name><surname>Park</surname><given-names>H-S.</given-names></string-name></person-group><article-title>A review of three different studies on hidden Markov models for epigenetic problems: a computational perspective</article-title>. <source>Genomics Inform</source><year>2014</year>;<volume>12</volume>:<fpage>145</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">25705151</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Libbrecht</surname><given-names>MW</given-names></string-name>, <string-name><surname>Chan</surname><given-names>RCW</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>MM.</given-names></string-name></person-group><article-title>Segmentation and genome annotation algorithms for identifying chromatin state and other genomic patterns</article-title>. <source>PLoS Comput Biol</source><year>2021</year>;<volume>17</volume>:<fpage>e1009423</fpage>.<pub-id pub-id-type="pmid">34648491</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mammana</surname><given-names>A</given-names></string-name>, <string-name><surname>Chung</surname><given-names>H-R.</given-names></string-name></person-group><article-title>Chromatin segmentation based on a probabilistic model for read counts explains a large portion of the epigenome</article-title>. <source>Genome Biol</source><year>2015</year>;<volume>16</volume>:<fpage>151</fpage>.<pub-id pub-id-type="pmid">26206277</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B23">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Mammana</surname><given-names>A</given-names></string-name>, <string-name><surname>Helmuth</surname><given-names>J.</given-names></string-name></person-group><italic toggle="yes">bamsignals: Extract Read Count Signals from Bam Files</italic>. R package version 1.34.0, <year>2023</year>. <ext-link xlink:href="https://bioconductor.org/packages/bamsignals" ext-link-type="uri">https://bioconductor.org/packages/bamsignals</ext-link>.</mixed-citation>
    </ref>
    <ref id="btae178-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marco</surname><given-names>E</given-names></string-name>, <string-name><surname>Meuleman</surname><given-names>W</given-names></string-name>, <string-name><surname>Huang</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Multi-scale chromatin state annotation using a hierarchical hidden Markov model</article-title>. <source>Nat Commun</source><year>2017</year>;<volume>8</volume>:<fpage>15011</fpage>.<pub-id pub-id-type="pmid">28387224</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mölder</surname><given-names>F</given-names></string-name>, <string-name><surname>Jablonski</surname><given-names>KP</given-names></string-name>, <string-name><surname>Letcher</surname><given-names>B</given-names></string-name></person-group><etal>et al</etal><article-title>Sustainable data analysis with snakemake</article-title>. <source>F1000Res</source><year>2021</year>;<volume>10</volume>:<fpage>33</fpage>.<pub-id pub-id-type="pmid">34035898</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Park</surname><given-names>PJ.</given-names></string-name></person-group><article-title>ChIP–seq: advantages and challenges of a maturing technology</article-title>. <source>Nat Rev Genet</source><year>2009</year>;<volume>10</volume>:<fpage>669</fpage>–<lpage>80</lpage>.<pub-id pub-id-type="pmid">19736561</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rabiner</surname><given-names>L.</given-names></string-name></person-group><article-title>A tutorial on hidden Markov models and selected applications in speech recognition</article-title>. <source>Proc IEEE</source><year>1989</year>;<volume>77</volume>:<fpage>257</fpage>–<lpage>86</lpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B28">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Russell</surname><given-names>M</given-names></string-name>, <string-name><surname>Cook</surname><given-names>A.</given-names></string-name></person-group> Experimental evaluation of duration modelling techniques for automatic speech recognition. In: <italic toggle="yes">ICASSP ’87. IEEE International Conference on Acoustics, Speech, and Signal Processing, Dallas, TX, USA</italic>, Vol. 12, New York, NY, USA: IEEE (Institute of Electrical and Electronics Engineers) <year>1987</year>, <fpage>2376</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Steensel</surname><given-names>B. V</given-names></string-name>, <string-name><surname>Belmont</surname><given-names>AS.</given-names></string-name></person-group><article-title>Lamina-Associated domains: links with chromosome architecture, heterochromatin, and gene repression</article-title>. <source>Cell</source><year>2017</year>;<volume>169</volume>:<fpage>780</fpage>–<lpage>91</lpage>.<pub-id pub-id-type="pmid">28525751</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">11026141</article-id>
    <article-id pub-id-type="pmid">38565260</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae178</article-id>
    <article-id pub-id-type="publisher-id">btae178</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EpiSegMix: a flexible distribution hidden Markov model with duration modeling for chromatin state discovery</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0009-0002-6377-2561</contrib-id>
        <name>
          <surname>Schmitz</surname>
          <given-names>Johanna Elena</given-names>
        </name>
        <aff><institution>Algorithmic Bioinformatics, Center for Bioinformatics Saar, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Fakultät MI, Saarland University, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Saarbrücken Graduate School of Computer Science, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aggarwal</surname>
          <given-names>Nihit</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Laufer</surname>
          <given-names>Lukas</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0563-7417</contrib-id>
        <name>
          <surname>Walter</surname>
          <given-names>Jörn</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Salhab</surname>
          <given-names>Abdulrahman</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Genomics Data Science Core, Integrated Genomics Services, Sidra Medicine</institution>, Doha, <country country="QA">Qatar</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-8536-6065</contrib-id>
        <name>
          <surname>Rahmann</surname>
          <given-names>Sven</given-names>
        </name>
        <aff><institution>Algorithmic Bioinformatics, Center for Bioinformatics Saar, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Fakultät MI, Saarland University, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
        <xref rid="btae178-cor1" ref-type="corresp"/>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
        <!--rahmann@cs.uni-saarland.de-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Kelso</surname>
          <given-names>Janet</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae178-cor1">Corresponding author. Algorithmic Bioinformatics, Center for Bioinformatics Saar and Saarland University, Saarland Informatics Campus E2.1, 66123 Saarbrücken, Germany. E-mail: <email>rahmann@cs.uni-saarland.de</email> (S.R.)</corresp>
      <fn id="btae178-FM1">
        <p>Johanna Elena Schmitz and Nihit Aggarwal Equal contribution.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-04-02">
      <day>02</day>
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>02</day>
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>4</issue>
    <elocation-id>btae178</elocation-id>
    <history>
      <date date-type="received">
        <day>06</day>
        <month>10</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>07</day>
        <month>3</month>
        <year>2024</year>
      </date>
      <date date-type="editorial-decision">
        <day>28</day>
        <month>3</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>01</day>
        <month>4</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>18</day>
        <month>4</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae178.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Automated chromatin segmentation based on ChIP-seq (chromatin immunoprecipitation followed by sequencing) data reveals insights into the epigenetic regulation of chromatin accessibility. Existing segmentation methods are constrained by simplifying modeling assumptions, which may have a negative impact on the segmentation quality.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We introduce EpiSegMix, a novel segmentation method based on a hidden Markov model with flexible read count distribution types and state duration modeling, allowing for a more flexible modeling of both histone signals and segment lengths. In a comparison with existing tools, ChromHMM, Segway, and EpiCSeg, we show that EpiSegMix is more predictive of cell biology, such as gene expression. Its flexible framework enables it to fit an accurate probabilistic model, which has the potential to increase the biological interpretability of chromatin states.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code: <ext-link xlink:href="https://gitlab.com/rahmannlab/episegmix" ext-link-type="uri">https://gitlab.com/rahmannlab/episegmix</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>ELIXIR-DE</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Each cell in a eukaryotic organism contains the same genetic information to build all required structural and functional gene products. However, cell-to-cell variation is essential for having specialized tissues with distinct physiological functions and to adapt to environmental changes (<xref rid="btae178-B10" ref-type="bibr">Cavalli and Heard 2019</xref>, <xref rid="btae178-B9" ref-type="bibr">Carter and Zhao 2021</xref>). This necessitates an additional layer of processes regulating gene expression to enable cell differentiation and to maintain cellular identities throughout cell divisions (<xref rid="btae178-B1" ref-type="bibr">Allis and Jenuwein 2016</xref>). Among the mechanisms tightly regulating gene expression are transcription factors and epigenetic modifications, like DNA methylation and histone modifications.</p>
    <sec>
      <title>1.1 Histone modifications</title>
      <p>With increasing knowledge about the role of histone modifications in altering the chromatin structure and DNA accessibility, it became apparent that different histone modifications are enriched in chromatin regions with distinct functional roles (<xref rid="btae178-B2" ref-type="bibr">Baker 2011</xref>). For example, modification H3K4me3 [in histone protein H3, the lysine at position 4 (K4) is trimethylated (me3)] is enriched in promoters and can be linked to transcriptional activation; H3K36me3 is enriched in active genes, and H3K27me3 can be associated with gene repression by the Polycomb protein complex (<xref rid="btae178-B7" ref-type="bibr">Blackledge and Klose 2021</xref>). Densely packed chromatin, called heterochromatin, is typically characterized by low levels of acetylation, whereas open, actively transcribed chromatin, called euchromatin, shows enrichment of acetylated lysine (<xref rid="btae178-B3" ref-type="bibr">Bannister and Kouzarides 2011</xref>). Combinatorial patterns of multiple histone modifications allow us to characterize so-called <italic toggle="yes">chromatin states</italic> that describe the different functional states of both coding and noncoding regions in the genome (<xref rid="btae178-B2" ref-type="bibr">Baker 2011</xref>).</p>
    </sec>
    <sec>
      <title>1.2 Chromatin immunoprecipitation followed by sequencing</title>
      <p>Chromatin immunoprecipitation followed by sequencing (ChIP-seq) enables the generation of genome-wide histone maps in high-throughput experiments (<xref rid="btae178-B4" ref-type="bibr">Barski <italic toggle="yes">et al.</italic> 2007</xref>). For ChIP-seq, DNA-binding proteins of interest, such as specifically modified histones or transcription factors, are tagged with specific antibodies. After chromatin shearing, DNA fragments bound to the desired proteins or protein-modifications are captured and the bound DNA is extracted for sequencing. Reads are mapped to the reference genome to infer the positioning of histone marks across the genome (<xref rid="btae178-B26" ref-type="bibr">Park 2009</xref>). The positional enrichment of reads is compromised by a certain amount of noise.</p>
    </sec>
    <sec>
      <title>1.3 Probabilistic models for segmentation</title>
      <p>The availability of genome-wide ChIP-seq data led to the development of automated methods for genome segmentation and annotation. These methods use a probabilistic model to detect recurrent patterns of epigenetic marks using the aligned reads to determine the signal intensity at different positions in the genome (<xref rid="btae178-F1" ref-type="fig">Fig. 1</xref>). HMMSeg (<xref rid="btae178-B13" ref-type="bibr">Day <italic toggle="yes">et al.</italic> 2007</xref>), ChromHMM (<xref rid="btae178-B16" ref-type="bibr">Ernst and Kellis 2010</xref>), and EpiCSeg (<xref rid="btae178-B22" ref-type="bibr">Mammana and Chung 2015</xref>) are based on hidden Markov models (HMMs), Segway, and Segway 2.0 (<xref rid="btae178-B11" ref-type="bibr">Chan <italic toggle="yes">et al.</italic> 2018</xref>) fit a Gaussian mixture model using a dynamic Bayesian network and <xref rid="btae178-B12" ref-type="bibr">Daneshpajouh <italic toggle="yes">et al.</italic> (2022)</xref> developed a state–space model assuming that the observed data is a linear function of the state-specific parameter matrix plus Gaussian noise. <xref rid="btae178-B24" ref-type="bibr">Marco <italic toggle="yes">et al.</italic> (2017)</xref> proposed a hierarchical HMM to simultaneously generate two segmentations at different length scales. The first (nucleosome level) segmentation works similarly to ChromHHM and captures histone modification patterns. The second (domain level) segmentation interprets sequences of nucleosome states (e.g. a super-enhancer domain state combining strong, weak, and flanking enhancer nucleosome states). In the present work, we focus on the accurate modeling of the nucleosome level. For a more comprehensive review, we refer to <xref rid="btae178-B21" ref-type="bibr">Libbrecht <italic toggle="yes">et al.</italic> (2021)</xref>.</p>
      <fig position="float" id="btae178-F1">
        <label>Figure 1.</label>
        <caption>
          <p>Chromatin segmentation: the reads of a ChIP-seq experiment are converted into a count matrix by counting the number of reads mapping to each nonoverlapping 200-bp genomic interval. The states of a multivariate HMM capture patterns in the multivariate read count distribution of the histone marks, and the transition probabilities between states capture the relations between adjacent chromatin states.</p>
        </caption>
        <graphic xlink:href="btae178f1" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>1.4 HMMs</title>
      <p>Multivariate HMMs capture both combinatorial patterns of multiple histone marks and adjacency relations between different genomic elements, which makes them a prominent tool for chromatin state discovery (<xref rid="btae178-B20" ref-type="bibr">Lee and Park 2014</xref>). An HMM describes two stochastic processes, an invisible Markov chain consisting of a finite set of hidden states and a visible process of observable signals. Here, the hidden states correspond to chromatin states and the observable signals to the observed read count vector per genomic region. Each hidden state has state-specific probabilities of emitting an observation, called <italic toggle="yes">emission probabilities</italic>. For chromatin segmentation, the genome is divided into nonoverlapping intervals (of typical length 200 bp), such that each observation is a vector of counts corresponding to the number of reads assigned to the interval per histone mark. Thus, the emission probabilities of a single hidden state capture a specific combinatorial pattern of multiple histone marks. Different states may hence define different functional genomic elements, such as promoters, enhancers or gene bodies. In addition, the relations between adjacent chromatin states are modeled via transition probabilities, which determine, for each state, the probabilities to either stay in the same state or to transition to another state.</p>
    </sec>
    <sec>
      <title>1.5 Modeling assumptions</title>
      <p>The ability of an HMM to detect patterns that correspond to biologically meaningful chromatin states is constrained by the modeling assumptions underlying the emission and transition probabilities. These assumptions are thus a distinguishing feature of existing HMM-based methods. For example, ChromHMM fits an HMM on binarized data (high versus low read count), where the emission probabilities are assumed to be independent Bernoulli experiments, and EpiCSeg models the emission probabilities using a Negative Multinomial distribution. Previous analyses of ChIP-seq data have shown that the read count distributions in some states and for some histone marks may be overdispersed and skewed, partly caused by differential protection against sonication, unequal binding affinity of distinct antibodies, sequence dependent PCR amplification and discrepancies when mapping to repeat-rich regions, which all introduce bias to the data (<xref rid="btae178-B14" ref-type="bibr">Diaz <italic toggle="yes">et al.</italic> 2012</xref>). Not all observed combinations of overdispersion and skewness can be captured by the commonly used probability distribution families, such as the Negative Binomial distribution. Furthermore, <xref rid="btae178-B5" ref-type="bibr">Beacon <italic toggle="yes">et al.</italic> (2021)</xref> showed that histone marks that are enriched in short domains, like promoters or TSS, are typically characterized by narrow peaks with high signal intensities, while histone marks enriched in broad domains, like heterochromatic regions, have lower signal intensities. Thus, regions in the genome covered by the same chromatin state may have different lengths, e.g. short promoters and long heterochromatic regions. Existing tools only model a single duration distribution type (Geometric) with exponentially decreasing probabilities, and can only fit the mean length of a region, but not its shape to the observed data. Hyperparameters, such as introduced by Segway, allow to place a prior on the expected segment length, but are still prone to the above limitations due to the unchanged geometric distribution type (<xref rid="btae178-B18" ref-type="bibr">Hoffman <italic toggle="yes">et al.</italic> 2012</xref>). Furthermore, they are either limited to the same parameters for all states or can be set for each numeric label, which may require extensive manual fine tuning.</p>
    </sec>
    <sec>
      <title>1.6 Novel contributions</title>
      <p>We propose a new flexible HMM architecture that relaxes the modeling assumptions of existing HMM-based methods in two ways. First, we allow to choose, for each histone modification, a different discrete distribution type from a broad selection (<xref rid="btae178-T1" ref-type="table">Table 1</xref>). This allows us to model more flexible read count distribution shapes, including overdispersed and skewed distributions. Second, we provide flexible duration modeling (using an automated state extension technique) to capture the characteristics of broad and narrow chromatin domains in a single segmentation with nucleosome resolution. By applying our method to publicly available ChIP-seq data, we show that such a flexible HMM leads to a better model fit and may increase segmentation accuracy and biological interpretability.</p>
      <table-wrap position="float" id="btae178-T1">
        <label>Table 1.</label>
        <caption>
          <p>Overview of available discrete distributions (<xref rid="btae178-B19" ref-type="bibr">Johnson et al. 1993</xref>).</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Name</th>
              <th rowspan="1" colspan="1">Parameters</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE1">
                  <mml:math id="IM1" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">N</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mn>1</mml:mn>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Poisson</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE2">
                  <mml:math id="IM2" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>λ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Negative binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE3">
                  <mml:math id="IM3" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mn>1</mml:mn>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Beta binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE4">
                  <mml:math id="IM4" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">N</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mo>α</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>β</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Beta negative binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE5">
                  <mml:math id="IM5" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>α</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>β</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Sichel</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE6">
                  <mml:math id="IM6" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>μ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>σ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>v</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">R</mml:mi>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec>
    <title>2 Methods</title>
    <sec>
      <title>2.1 Probabilistic model</title>
      <p>An HMM is formally defined as a quintuple <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mo>π</mml:mo><mml:mo>,</mml:mo><mml:mo>Σ</mml:mo><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is a finite set of hidden states, <italic toggle="yes">π</italic> is a probability vector with the starting probabilities for each state, Σ is a set of observable emission values, <italic toggle="yes">A</italic> is an <italic toggle="yes">N </italic>×<italic toggle="yes"> N</italic> matrix, where each entry <italic toggle="yes">a<sub>ij</sub></italic> denotes the transition probability to move from state <italic toggle="yes">i</italic> to state <italic toggle="yes">j</italic>, and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the complete collection of parameters required to calculate the emission probabilities of an observation in each state <italic toggle="yes">j</italic> (<xref rid="btae178-B20" ref-type="bibr">Lee and Park 2014</xref>). For a sample with <italic toggle="yes">T</italic> observations or time points, the collection of random variables is thus given by (<italic toggle="yes">O</italic>, <italic toggle="yes">Q</italic>), where <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the observed sequence and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the hidden state sequence.</p>
      <p>Due to the HMM independence assumptions [<italic toggle="yes">Q</italic> is a Markov chain, <italic toggle="yes">O<sub>t</sub></italic> is conditionally independent of everything else, given <italic toggle="yes">Q<sub>t</sub></italic>; <xref rid="btae178-B6" ref-type="bibr">Bilmes (1998)</xref>], the probability that an HMM with parameters <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo>θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>π</mml:mo><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> generates the combination <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mi>o</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mi>o</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:munderover></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>For given fixed <italic toggle="yes">O </italic>=<italic toggle="yes"> o</italic>, the Viterbi algorithm (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>) determines the state sequence <italic toggle="yes">q</italic> that maximizes this probability (for fixed transition and emission probabilities).</p>
      <p>For chromatin segmentation, the emission alphabet is given by the multivariate, countable infinite set
<disp-formula id="E2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mo>Σ</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>M</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>}</mml:mo><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">M</italic> is the dimension of the emission alphabet, corresponding to the number of histone modifications in the input data. Hence, the natural choice is to model the emission probabilities using a multivariate discrete distribution. Under the assumption that the read counts of all histone modifications are conditionally independent of each other given a state, the emission probability for an observation <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> in state <italic toggle="yes">j</italic> is given by
<disp-formula id="E3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>This leads to a flexible framework in which different distribution types may be selected to model the read counts of distinct histone marks. <xref rid="btae178-T1" ref-type="table">Table 1</xref> gives an overview over the univariate discrete distributions available in EpiSegMix (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref> for details). Distributions with more parameters are more flexible and hence lead to a more accurate model fit: One-parameter distributions (Poisson) may fit the mean of the observed read counts, but not variance or skewness; two-parameter distributions (e.g. Negative Binomial) may fit both mean and variance but not skewness; three-parameter distributions may fit all three moments. With data from several thousand genomic intervals per state, there is no danger of overfitting three parameters. Still, each distribution has its own limitations and dependencies between moments, so having a variety of options is beneficial. The best performing distribution may vary for histone modifications and between experiments with different data quality. Therefore, we provide a workflow to find for each mark the distribution that maximizes the log-likelihood of a three-state HMM with univariate emissions. For further information, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Duration modeling</title>
      <p>The typical HMM topology is a fully connected graph, including self-loops on states. Hence the sojourn time <italic toggle="yes">X</italic> in a state follows a Geometric distribution <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo>·</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> for some <inline-formula id="IE9000"><mml:math id="IM9000" display="inline" overflow="scroll"><mml:mi>p</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula>, with exponentially decreasing probabilities for longer durations (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>). Although the mean of a Geometric distribution can be made arbitrarily large, the variance increases with it and the mode stays at <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Geometric distributions model durations that are short with higher probability, but have limited flexibility when modeling longer durations with a mode far away from 1. We therefore propose to use an extended-state HMM architecture, in which each state is internally represented as a sub-HMM. Each sub-HMM has a linear left-to-right topology with a different number of sub-states, but with the additional constraints that all sub-states have the same emission probabilities and same self-transition probabilities (<xref rid="btae178-B28" ref-type="bibr">Russell and Cook 1987</xref>) (see <xref rid="btae178-F2" ref-type="fig">Fig. 2A</xref>). With this topology, the state duration is the sum of a number of independent Geometrically distributed random variables, which has a Negative Binomial distribution. It has two parameters: the state-exit probability <italic toggle="yes">P</italic> (same as for a Geometric distribution), and the copy number <italic toggle="yes">r</italic> (where <italic toggle="yes">r </italic>=<italic toggle="yes"> </italic>1 gives the Geometric distribution). In contrast to a Geometric distribution, the mean and variance of a Negative Binomial distribution can be controlled independently, and the mode can be placed at an arbitrary duration (<xref rid="btae178-F2" ref-type="fig">Fig. 2B</xref>). Therefore, both long and short durations can be modeled flexibly.</p>
      <fig position="float" id="btae178-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Duration modeling. (A) Extended-state HMM with different numbers of states in the sub-HMMs for a univariate four-state HMM. (B) Comparison of state duration distribution for a state in a classical HMM (<italic toggle="yes">r </italic>=<italic toggle="yes"> </italic>1) and in a topology HMM with two or four sub-states to achieve the same mean of 5 (left) or 20 (right).</p>
        </caption>
        <graphic xlink:href="btae178f2" position="float"/>
      </fig>
      <p>The number of sub-states is fitted automatically during parameter estimation. Starting from a standard ergodic topology (each state is represented by one sub-state), the segment lengths are computed for each state under the current model. The number of sub-states is then given by the estimated parameter <italic toggle="yes">r</italic> of a Negative Binomial distribution under the additional constraint that <italic toggle="yes">r</italic> is a natural number between 1 and 5. Each state may hence have a different number of sub-states depending on the observed segment lengths. By default, the topology is adjusted twice. Before the adjustments, the parameters of the HMM are estimated for a fixed number of iterations (default 5) and until convergence for the final topology.</p>
    </sec>
    <sec>
      <title>2.3 Parameter estimation</title>
      <p>Before an HMM can be used to estimate the state sequence, its parameters (transition and emission probabilities) must be estimated. As we typically do not have labeled training data, parameter estimation must proceed in an unsupervised manner using the Baum–Welch algorithm, which is a concretization of the general expectation maximization (EM) algorithm tailored to the structure of HMMs (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>). It alternates between estimating the model parameters (M-step), given a (fuzzy or probabilistic) assignment of observations to states, and re-estimating the state membership probabilities of each observation (E-step) until convergence (details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>3 Implementation</title>
    <p>The flexible distribution HMM and parameter estimation is implemented in C++ as a command-line tool <monospace>EpiSegMix</monospace>. Its source code is at <ext-link xlink:href="https://gitlab.com/rahmannlab/episegmix" ext-link-type="uri">https://gitlab.com/rahmannlab/episegmix</ext-link>.</p>
    <p>All steps of the surrounding workflow are incorporated in a <monospace>Snakemake</monospace> workflow (<xref rid="btae178-B25" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic> 2021</xref>).</p>
    <p>By default, we estimate parameters on the ENCODE pilot regions which contain a good representation of the whole genome and are thus commonly used to fit the model (<xref rid="btae178-B18" ref-type="bibr">Hoffman <italic toggle="yes">et al.</italic> 2012</xref>, <xref rid="btae178-B12" ref-type="bibr">Daneshpajouh <italic toggle="yes">et al.</italic> 2022</xref>). Alternatively, the user may specify a list of chromosomes to be used for model fitting. The segmentation is performed genome-wide.</p>
    <p>The main output of chromatin segmentation is a file that assigns one state to each position in the genome, and an HTML report with plots that characterize the model and segmentation, enabling their biological interpretation. For example, the heatmap showing the normalized histone modification intensities of each state (as in <xref rid="btae178-F6" ref-type="fig">Fig. 6B</xref>) is central to determine the genomic function of the states.</p>
  </sec>
  <sec>
    <title>4 Results</title>
    <p>We evaluated EpiSegMix on publicly available ChIP-seq data for the human cell lines K562, HepG2, GM12878, IMR90, H1, and SJCRH30 provided by the ENCODE consortium (<xref rid="btae178-B15" ref-type="bibr">Dunham <italic toggle="yes">et al.</italic> 2012</xref>) using the most recently processed data. With the selected cell lines, we evaluate our method on ChIP-seq experiments that were performed over the last decade (from 2010 to 2020) with different data properties (e.g. the mapped read length ranges from 36 to 100 bp). To analyze the robustness of all methods, we generated the count matrix for two replicate experiments each (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>). To reproduce the results, all accession numbers are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S9</xref> and the script to create the count matrix is part of the code repository. We restricted our analysis to the six core histone marks H3K9me3, H3K27me3, H3K36me3, H3K4me1, H3K4me3, and H3K27ac defined by the IHEC consortium (<xref rid="btae178-B8" ref-type="bibr">Bujold <italic toggle="yes">et al.</italic> 2016</xref>).</p>
    <p>Since chromatin segmentation is an unsupervised method and no ground truth is available, we evaluate the performance of EpiSegMix by comparing it to three established chromatin segmentation tools ChromHMM (<xref rid="btae178-B17" ref-type="bibr">Ernst and Kellis 2012</xref>), EpiCSeg (<xref rid="btae178-B22" ref-type="bibr">Mammana and Chung 2015</xref>), and Segway (<xref rid="btae178-B11" ref-type="bibr">Chan <italic toggle="yes">et al.</italic> 2018</xref>).</p>
    <p>We first perform a quantitative comparison by evaluating how well the different methods can predict gene expression and ATAC-seq data. Afterwards, we analyze how the different methods reflect known genome biology by showing further characteristic plots for one exemplary dataset.</p>
    <sec>
      <title>4.1 Data processing</title>
      <p>In a preprocessing step, we convert the aligned reads into a count matrix using the <italic toggle="yes">bamsignals</italic> package (<xref rid="btae178-B23" ref-type="bibr">Mammana and Helmuth 2023</xref>). In the count matrix, each row corresponds to a consecutive, nonoverlapping region with a fixed window size (default 200 base pairs), called bins, and each column corresponds to a distinct histone mark. Each read is assigned to exactly one genomic bin depending on the position of its 5’ end.</p>
      <p>For all methods, we fitted a 10-state model. EpiSegMix and Segway were trained on the ENCODE pilot regions of <italic toggle="yes">hg38</italic>. For EpiSegMix, three-state HMMs were fitted individually for each mark and different distributions. We then chose the distribution with the highest log-likelihood, listed in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section 4</xref>. For Segway, the <italic toggle="yes">resolution</italic> was set to 200 bp, the <italic toggle="yes">track-weight</italic> to 0.01, and the <italic toggle="yes">segtransition-weight-scale</italic> and <italic toggle="yes">prior-strength</italic> to 1. For ChromHMM and EpiCSeg, the default parameters were used (200 bp resolution, 10-state model).</p>
    </sec>
    <sec>
      <title>4.2 Advantages of flexible distribution modeling</title>
      <p>To show the advantages of flexible emission and duration distribution types for chromatin segmentation, we compare fitted models using different emission distributions and with and without duration modeling. Narrow marks, such as H3K4me3, often have skewed read count distributions. Fitting the Negative Binomial (2 parameters) and Sichel (3 parameters) distribution to the read counts of H3K4me3 shows the limitation of the Negative Binomial distributions to model highly skewed and overdispersed data (<xref rid="btae178-F3" ref-type="fig">Fig. 3A</xref>). Further evaluation of the effect that emission modeling has on the segmentation is provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.</p>
      <fig position="float" id="btae178-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Flexible emission and duration modeling. The histograms show the sample distribution and the curves show the theoretical distribution fitted by the model. (A) Results of fitting a three-state HMM to the mark H3K4me3 using the Negative Binomial and Sichel distribution (for the state with high H3K4me3 in HepG2_1). (B) State duration in the HepG2_1 promoter state for an HMM with a classic (Geometric) and extended (Negative Binomial) topology.</p>
        </caption>
        <graphic xlink:href="btae178f3" position="float"/>
      </fig>
      <p><xref rid="btae178-F3" ref-type="fig">Figure 3B</xref> shows that the state duration, determining the segment length (number of consecutive bins assigned to the same state), does not follow a Geometric distribution for most chromatin states. In comparison, the Negative Binomial distribution, as fitted by our flexible duration model, leads to a more accurate description of the real segment length distribution.</p>
    </sec>
    <sec>
      <title>4.3 Evaluation of gene expression prediction</title>
      <p>Since a biologically meaningful segmentation should have states that correlate with different gene expression levels, we compared how well the chromatin states of EpiSegMix, EpiCSeg, ChromHMM, and Segway can predict gene expression. To measure the gene expression in each 200 bp bin that contains (part of) a protein-coding gene, we used total RNA-seq experiments for the different cell lines provided by ENCODE and assigned each bin the log(FPKM + 1) normalized expression value of the gene (FPKM: fragments per kilobase of transcript per million mapped reads). We performed linear regression with the state labels as categorical predictors, i.e. for each bin <italic toggle="yes">i’</italic>s true expression <italic toggle="yes">x<sub>i</sub></italic>, we used the state-specific mean expression as predictor <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and measured the mean quadratic regression error versus the mean quadratic error using the global mean <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></inline-formula> as predictor and computed the coefficient of determination <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>/</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> (between 0 and 1, where 1 is perfect). The <italic toggle="yes">R</italic><sup>2</sup> values vary for the different cell lines, which can partly be explained by the unequal data quality. <xref rid="btae178-F4" ref-type="fig">Figure 4</xref> compares the <italic toggle="yes">R</italic><sup>2</sup> values of the different methods across cell lines. On average, EpiSegMix has the highest predictive power among the methods.</p>
      <fig position="float" id="btae178-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Prediction of transcription levels from chromatin state labels: coefficient of determination <italic toggle="yes">R</italic><sup>2</sup> (<italic toggle="yes">y</italic>-axis) using state labels as categorical predictors for <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>FPKM</mml:mtext><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> expression values for the different methods (<italic toggle="yes">x</italic>-axis) on different cell lines (color). Black lines indicate mean <italic toggle="yes">R</italic><sup>2</sup> for each method.</p>
        </caption>
        <graphic xlink:href="btae178f4" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.4 Evaluation of ATAC-seq prediction</title>
      <p>We performed a similar analysis predicting ATAC-seq read counts instead of gene expression levels for all cell lines with available ATAC-seq experiments. We counted how many reads of the ATAC-seq experiment map to each nonoverlapping 200 bp bin in the genome to generate a count matrix in the same way as for the histone counts. In the same way as for gene expression, we performed linear regression to predict log-transformed ATAC-seq read counts using the state labels as categorical predictors. Since ATAC-seq measures the chromatin accessibility, active states, like promoter or transcription states, should be predictive of high ATAC-seq counts, while heterochromatic states should be predictive of low ATAC-seq counts. <xref rid="btae178-F5" ref-type="fig">Figure 5</xref> shows that EpiSegMix and EpiCSeg have a similar predictive power of chromatin accessibility, as measured by the coefficient of determination <italic toggle="yes">R</italic><sup>2</sup>, while ChromHMM and Segway have lower <italic toggle="yes">R</italic><sup>2</sup> scores on average.</p>
      <fig position="float" id="btae178-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Prediction of ATAC-seq levels from chromatin state labels. The plot shows the coefficient of variation (<italic toggle="yes">R</italic><sup>2</sup>) using standard linear regression with the state labels as categorical predictors to predict <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula> transformed ATAC counts. The black line shows the mean <italic toggle="yes">R</italic><sup>2</sup> value.</p>
        </caption>
        <graphic xlink:href="btae178f5" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.5 Evaluation of reflected genome biology</title>
      <p>We perform a qualitative analysis of the different methods by comparing the similarities of the genome-wide segmentation and functional assignment of states, their genome coverage, overall segment length, and enrichment around protein coding genes (<xref rid="btae178-F6" ref-type="fig">Fig. 6</xref>). An in-depth example (genome browser view) is provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>. For better comparability, we manually assigned a label that best describes the biological function of the state to each numerical state ID. This facilitates the comparison of state assignments between methods. A description of each label is given in <xref rid="btae178-F6" ref-type="fig">Fig. 6E</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S8</xref>.</p>
      <fig position="float" id="btae178-F6">
        <label>Figure 6.</label>
        <caption>
          <p>Comparison between EpiSegMix and EpiCSeg, Segway and ChromHMM for K562_1. (A) State overlap between methods. The bar heights correspond to the genomic coverage of the biologically annotated state and the edge thickness to the overlap between the methods. (B) Heatmaps showing the histone enrichment per state. The mean counts per state are normalized column wise, such that for each histone modification the state with the maximum mean count has a value of one and the state with the lowest mean count has a value of zero. (C) State distribution. The line plots show how often each state occurs around protein coding genes. (D) State duration. The plot shows for each biologically annotated state the state length distribution in base pairs of the different methods. (E) State description.</p>
        </caption>
        <graphic xlink:href="btae178f6" position="float"/>
      </fig>
      <p><xref rid="btae178-F6" ref-type="fig">Figure 6A</xref> shows that the states assigned by the count-based methods EpiSegMix, EpiCSeg, and Segway have a similar genome coverage and high overlap between state assignments. Moreover, all three methods EpiSegMix, EpiCSeg, and Segway provide a deeper epigenomic distinction of heterochromatic regions that ChromHMM aggregates into a single state. EpiSegMix discriminates a “no signal” state from a strong and a weak heterochromatic state that show distinctive patterns of enriched histone marks. Thereby, EpiSegMix better captures transitions from closed to open chromatin as compared to ChromHMM (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>). This distinction is also supported by Segway and EpiCSeg. In addition, EpiSegMix defines a more consistent and accurate label for unmappable regions in comparison to all other methods (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>). While, in a 10-state model, ChromHMM appears to provide a more fine-grained distinction of regulatory states, such as weak and flanking promoter regions, the robustness of these classifications is not always given. Thus, a biological interpretation of these regions should be taken with caution (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>).</p>
      <p><xref rid="btae178-F6" ref-type="fig">Figure 6B</xref> shows the genome wide enrichment of histone marks across states for each tool. All methods find similar patterns of histone marks: Enrichment of regulatory marks such as H3K27ac, H3K4me1, and H3K4me3, is predominantly observed in promoter and enhancer states, as expected. Actively transcribed mark H3K36me3 is enriched in transcription states; the repressive mark H3K27me3 is most strongly enriched in Polycomb repressed heterochromatin. Overall absolute levels of H3K9me3 are low, but due to the column-wise normalization in <xref rid="btae178-F6" ref-type="fig">Fig. 6B</xref>, it appears enriched in a number of states, possibly reflecting overall background noise.</p>
      <p>Despite the overall high state concordance across tools, some differences can be observed particularly in a gene centered comparison, i.e. across gene bodies, including ±3 kb upstream and downstream of the gene transcription start and gene end, respectively (<xref rid="btae178-F6" ref-type="fig">Fig. 6C</xref>). Coordinates were taken from ENCODE reference ENCFF824ZKD. EpiSegMix and Segway show a higher enrichment of promoter states around TSSs as compared to ChromHMM and EpiCSeg, which discriminate between weak and strong promoters. This distinction is not linked to a better prediction of transcription levels.</p>
      <p>When comparing the segment lengths (i.e. consecutive genomic bins assigned to the same state) and their genomic distributions across the different methods we observe that the duration flexibility of EpiSegMix helps to capture the wide range of short (promoters/enhancers), intermediate (short to long genes), and long (heterochromatic regions) state durations in a more consistent manner as compared to all other methods. For example, EpiSegMix’ Tx state most effectively covers large genes (i.e. over 40% of all human genes are longer than 0.8 × 10<sup>4</sup> bp), allowing for a more accurate annotation of genes among different classes. Another advantage of EpiSegMix in comparison to EpiCSeg and Segway can be observed in the longer segment lengths for Polycomb repressed genes (Repr_Pc) and for heterochromatic regions (Het_Wk and Het_Str), which more closely match the known size of broad domains (<xref rid="btae178-B29" ref-type="bibr">Steensel and Belmont 2017</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>We developed EpiSegMix, a flexible HMM framework for chromatin segmentation. We enhanced the flexibility of existing HMMs with respect to modeling both emission probabilities and state durations. To account for the overdispersed and skewed ChIP-seq read count distributions, the read counts of each histone modification can follow a different discrete distribution type. We currently support a variety of distributions, and further distributions may be added in the future. The internal HMM topology was adjusted to be able to model state durations that follow a Negative Binomial instead of a Geometric distribution, which better reflects the inherent segment length of chromatin states that cover either small peaks or broad domains. For example, lamina-associated domains (LADs; heterochromatin at the nuclear periphery) usually have a size between 10<sup>4</sup> and 10<sup>7</sup> bp (<xref rid="btae178-B29" ref-type="bibr">Steensel and Belmont 2017</xref>).</p>
    <p>A comparison with ChromHMM, Segway, and EpiCSeg suggests that EpiSegMix has the potential to provide segmentations that better reflect genomic annotations and yields states that are more predictive of gene expression. Moreover, the flexible duration modeling allows to effectively capture the reflective state lengths of long gene bodies and heterochromatic domains. The influence of the modified HMM topology on the segmentation suggests that testing other topology models is an important aspect to increase the modeling accuracy. Another direction of future work could be to combine the flexible duration modeling of EpiSegMix with a hierarchical HMM, as proposed by <xref rid="btae178-B24" ref-type="bibr">Marco <italic toggle="yes">et al.</italic> (2017)</xref>, which may prove to be a powerful idea to perform inter-dependent chromatin segmentation at different length scales.</p>
    <p>Although our results suggest that flexible distributions such as the Sichel or Beta Negative Binomial distribution often give the best results, we support a variety of distributions to deal with changing data properties and provide an easily extendable framework to integrate other data, such as ATAC-seq, DNase-seq or transcription factor ChIP-seq data.</p>
    <p>In summary, we show that the modeling assumptions of the HMM have an impact on the segmentation quality and biological interpretation. Due to its high flexibility, EpiSegMix accurately fits HMM read count data with varying distributional properties and provides the additional option of flexible duration modeling. Finally, EpiSegMix provides a widely configurable framework for chromatin segmentation that can be applied to a wide range of data.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae178_Supplementary_Data</label>
      <media xlink:href="btae178_supplementary_data.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We acknowledge the ENCODE consortium for producing the data.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>J.E.S. and N.A. contributed equally to this work. The method was developed by J.E.S. and N.A. under the supervision of J.W., A.S., and S.R. L.L. performed preliminary analyses to select suitable distributions. J.E.S, N.A., J.W., and S.R. contributed to writing, and all authors contributed to revising the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by internal funding and by ELIXIR-DE (de.nbi), the research infrastructure for life science data (grant to N.A.).</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data can be downloaded from the ENCODE portal. All accession numbers are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S9</xref>.</p>
  </sec>
  <sec>
    <title>Ethics declaration</title>
    <p>None declared.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae178-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Allis</surname><given-names>CD</given-names></string-name>, <string-name><surname>Jenuwein</surname><given-names>T.</given-names></string-name></person-group><article-title>The molecular hallmarks of epigenetic control</article-title>. <source>Nat Rev Genet</source><year>2016</year>;<volume>17</volume>:<fpage>487</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">27346641</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baker</surname><given-names>M.</given-names></string-name></person-group><article-title>Making sense of chromatin states</article-title>. <source>Nat Methods</source><year>2011</year>;<volume>8</volume>:<fpage>717</fpage>–<lpage>22</lpage>.<pub-id pub-id-type="pmid">21878916</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bannister</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Kouzarides</surname><given-names>T.</given-names></string-name></person-group><article-title>Regulation of chromatin by histone modifications</article-title>. <source>Cell Res</source><year>2011</year>;<volume>21</volume>:<fpage>381</fpage>–<lpage>95</lpage>.<pub-id pub-id-type="pmid">21321607</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barski</surname><given-names>A</given-names></string-name>, <string-name><surname>Cuddapah</surname><given-names>S</given-names></string-name>, <string-name><surname>Cui</surname><given-names>K</given-names></string-name></person-group><etal>et al</etal><article-title>High-resolution profiling of histone methylations in the human genome</article-title>. <source>Cell</source><year>2007</year>;<volume>129</volume>:<fpage>823</fpage>–<lpage>37</lpage>.<pub-id pub-id-type="pmid">17512414</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Beacon</surname><given-names>TH</given-names></string-name>, <string-name><surname>Delcuve</surname><given-names>GP</given-names></string-name>, <string-name><surname>López</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>The dynamic broad epigenetic (H3K4me3, H3K27ac) domain as a mark of essential genes</article-title>. <source>Clin Epigenet</source><year>2021</year>;<volume>13</volume>:<fpage>138</fpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bilmes</surname><given-names>J.</given-names></string-name></person-group><article-title>A gentle tutorial of the EM algorithm and its application to parameter estimation for Gaussian mixture and hidden Markov models</article-title>. <source>ICSI Tech Rep Ser vol. TR-97-021, Berkeley,</source><year>1998</year>.</mixed-citation>
    </ref>
    <ref id="btae178-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blackledge</surname><given-names>NP</given-names></string-name>, <string-name><surname>Klose</surname><given-names>RJ.</given-names></string-name></person-group><article-title>The molecular principles of gene regulation by polycomb repressive complexes</article-title>. <source>Nat Rev Mol Cell Biol</source><year>2021</year>;<volume>22</volume>:<fpage>815</fpage>–<lpage>33</lpage>.<pub-id pub-id-type="pmid">34400841</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bujold</surname><given-names>D</given-names></string-name>, <string-name><surname>Morais</surname><given-names>DAdL</given-names></string-name>, <string-name><surname>Gauthier</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>The international human epigenome consortium data portal</article-title>. <source>Cell Syst</source><year>2016</year>;<volume>3</volume>:<fpage>496</fpage>–<lpage>9.e2</lpage>.<pub-id pub-id-type="pmid">27863956</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Carter</surname><given-names>B</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>K.</given-names></string-name></person-group><article-title>The epigenetic basis of cellular heterogeneity</article-title>. <source>Nat Rev Genet</source><year>2021</year>;<volume>22</volume>:<fpage>235</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">33244170</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cavalli</surname><given-names>G</given-names></string-name>, <string-name><surname>Heard</surname><given-names>E.</given-names></string-name></person-group><article-title>Advances in epigenetics link genetics to the environment and disease</article-title>. <source>Nature</source><year>2019</year>;<volume>571</volume>:<fpage>489</fpage>–<lpage>99</lpage>.<pub-id pub-id-type="pmid">31341302</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chan</surname><given-names>RCW</given-names></string-name>, <string-name><surname>Libbrecht</surname><given-names>MW</given-names></string-name>, <string-name><surname>Roberts</surname><given-names>EG</given-names></string-name></person-group><etal>et al</etal><article-title>Segway 2.0: gaussian mixture models and minibatch training</article-title>. <source>Bioinformatics</source><year>2018</year>;<volume>34</volume>:<fpage>669</fpage>–<lpage>71</lpage>.<pub-id pub-id-type="pmid">29028889</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Daneshpajouh</surname><given-names>H</given-names></string-name>, <string-name><surname>Chen</surname><given-names>B</given-names></string-name>, <string-name><surname>Shokraneh</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Continuous chromatin state feature annotation of the human epigenome</article-title>. <source>Bioinformatics</source><year>2022</year>;<volume>38</volume>:<fpage>3029</fpage>–<lpage>36</lpage>.<pub-id pub-id-type="pmid">35451453</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Day</surname><given-names>N</given-names></string-name>, <string-name><surname>Hemmaplardh</surname><given-names>A</given-names></string-name>, <string-name><surname>Thurman</surname><given-names>RE</given-names></string-name></person-group><etal>et al</etal><article-title>Unsupervised segmentation of continuous genomic data</article-title>. <source>Bioinformatics</source><year>2007</year>;<volume>23</volume>:<fpage>1424</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">17384021</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Diaz</surname><given-names>A</given-names></string-name>, <string-name><surname>Park</surname><given-names>K</given-names></string-name>, <string-name><surname>Lim</surname><given-names>DA</given-names></string-name></person-group><etal>et al</etal><article-title>Normalization, bias correction, and peak calling for ChIP-seq</article-title>. <source>Stat Appl Genet Mol Biol</source><year>2012</year>;<volume>11</volume>:<fpage>Article 9</fpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dunham</surname><given-names>I</given-names></string-name>, <string-name><surname>Kundaje</surname><given-names>A</given-names></string-name>, <string-name><surname>Aldred</surname><given-names>SF</given-names></string-name></person-group><etal>et al</etal><article-title>An integrated encyclopedia of DNA elements in the human genome</article-title>. <source>Nature</source><year>2012</year>;<volume>489</volume>:<fpage>57</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group><article-title>Discovery and characterization of chromatin states for systematic annotation of the human genome</article-title>. <source>Nat Biotechnol</source><year>2010</year>;<volume>28</volume>:<fpage>817</fpage>–<lpage>25</lpage>.<pub-id pub-id-type="pmid">20657582</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group><article-title>ChromHMM: automating chromatin-state discovery and characterization</article-title>. <source>Nat Methods</source><year>2012</year>;<volume>9</volume>:<fpage>215</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">22373907</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hoffman</surname><given-names>MM</given-names></string-name>, <string-name><surname>Buske</surname><given-names>OJ</given-names></string-name>, <string-name><surname>Wang</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Unsupervised pattern discovery in human chromatin structure through genomic segmentation</article-title>. <source>Nat Methods</source><year>2012</year>;<volume>9</volume>:<fpage>473</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">22426492</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B19">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Johnson</surname><given-names>NL</given-names></string-name>, <string-name><surname>Kotz</surname><given-names>S</given-names></string-name>, <string-name><surname>Kemp</surname><given-names>AW</given-names></string-name></person-group><etal>et al</etal><source>Univariate discrete distributions</source>, <edition>2nd edn</edition>. <publisher-loc>New York, NY</publisher-loc>: <publisher-name>Wiley</publisher-name>, <year>1993</year>.</mixed-citation>
    </ref>
    <ref id="btae178-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>K-E</given-names></string-name>, <string-name><surname>Park</surname><given-names>H-S.</given-names></string-name></person-group><article-title>A review of three different studies on hidden Markov models for epigenetic problems: a computational perspective</article-title>. <source>Genomics Inform</source><year>2014</year>;<volume>12</volume>:<fpage>145</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">25705151</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Libbrecht</surname><given-names>MW</given-names></string-name>, <string-name><surname>Chan</surname><given-names>RCW</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>MM.</given-names></string-name></person-group><article-title>Segmentation and genome annotation algorithms for identifying chromatin state and other genomic patterns</article-title>. <source>PLoS Comput Biol</source><year>2021</year>;<volume>17</volume>:<fpage>e1009423</fpage>.<pub-id pub-id-type="pmid">34648491</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mammana</surname><given-names>A</given-names></string-name>, <string-name><surname>Chung</surname><given-names>H-R.</given-names></string-name></person-group><article-title>Chromatin segmentation based on a probabilistic model for read counts explains a large portion of the epigenome</article-title>. <source>Genome Biol</source><year>2015</year>;<volume>16</volume>:<fpage>151</fpage>.<pub-id pub-id-type="pmid">26206277</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B23">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Mammana</surname><given-names>A</given-names></string-name>, <string-name><surname>Helmuth</surname><given-names>J.</given-names></string-name></person-group><italic toggle="yes">bamsignals: Extract Read Count Signals from Bam Files</italic>. R package version 1.34.0, <year>2023</year>. <ext-link xlink:href="https://bioconductor.org/packages/bamsignals" ext-link-type="uri">https://bioconductor.org/packages/bamsignals</ext-link>.</mixed-citation>
    </ref>
    <ref id="btae178-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marco</surname><given-names>E</given-names></string-name>, <string-name><surname>Meuleman</surname><given-names>W</given-names></string-name>, <string-name><surname>Huang</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Multi-scale chromatin state annotation using a hierarchical hidden Markov model</article-title>. <source>Nat Commun</source><year>2017</year>;<volume>8</volume>:<fpage>15011</fpage>.<pub-id pub-id-type="pmid">28387224</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mölder</surname><given-names>F</given-names></string-name>, <string-name><surname>Jablonski</surname><given-names>KP</given-names></string-name>, <string-name><surname>Letcher</surname><given-names>B</given-names></string-name></person-group><etal>et al</etal><article-title>Sustainable data analysis with snakemake</article-title>. <source>F1000Res</source><year>2021</year>;<volume>10</volume>:<fpage>33</fpage>.<pub-id pub-id-type="pmid">34035898</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Park</surname><given-names>PJ.</given-names></string-name></person-group><article-title>ChIP–seq: advantages and challenges of a maturing technology</article-title>. <source>Nat Rev Genet</source><year>2009</year>;<volume>10</volume>:<fpage>669</fpage>–<lpage>80</lpage>.<pub-id pub-id-type="pmid">19736561</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rabiner</surname><given-names>L.</given-names></string-name></person-group><article-title>A tutorial on hidden Markov models and selected applications in speech recognition</article-title>. <source>Proc IEEE</source><year>1989</year>;<volume>77</volume>:<fpage>257</fpage>–<lpage>86</lpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B28">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Russell</surname><given-names>M</given-names></string-name>, <string-name><surname>Cook</surname><given-names>A.</given-names></string-name></person-group> Experimental evaluation of duration modelling techniques for automatic speech recognition. In: <italic toggle="yes">ICASSP ’87. IEEE International Conference on Acoustics, Speech, and Signal Processing, Dallas, TX, USA</italic>, Vol. 12, New York, NY, USA: IEEE (Institute of Electrical and Electronics Engineers) <year>1987</year>, <fpage>2376</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Steensel</surname><given-names>B. V</given-names></string-name>, <string-name><surname>Belmont</surname><given-names>AS.</given-names></string-name></person-group><article-title>Lamina-Associated domains: links with chromosome architecture, heterochromatin, and gene repression</article-title>. <source>Cell</source><year>2017</year>;<volume>169</volume>:<fpage>780</fpage>–<lpage>91</lpage>.<pub-id pub-id-type="pmid">28525751</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">11026141</article-id>
    <article-id pub-id-type="pmid">38565260</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae178</article-id>
    <article-id pub-id-type="publisher-id">btae178</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EpiSegMix: a flexible distribution hidden Markov model with duration modeling for chromatin state discovery</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0009-0002-6377-2561</contrib-id>
        <name>
          <surname>Schmitz</surname>
          <given-names>Johanna Elena</given-names>
        </name>
        <aff><institution>Algorithmic Bioinformatics, Center for Bioinformatics Saar, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Fakultät MI, Saarland University, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Saarbrücken Graduate School of Computer Science, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aggarwal</surname>
          <given-names>Nihit</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Laufer</surname>
          <given-names>Lukas</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0563-7417</contrib-id>
        <name>
          <surname>Walter</surname>
          <given-names>Jörn</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Salhab</surname>
          <given-names>Abdulrahman</given-names>
        </name>
        <aff><institution>Department of Genetics, Saarland University</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Genomics Data Science Core, Integrated Genomics Services, Sidra Medicine</institution>, Doha, <country country="QA">Qatar</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-8536-6065</contrib-id>
        <name>
          <surname>Rahmann</surname>
          <given-names>Sven</given-names>
        </name>
        <aff><institution>Algorithmic Bioinformatics, Center for Bioinformatics Saar, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <aff><institution>Fakultät MI, Saarland University, Saarland Informatics Campus</institution>, 66123 Saarbrücken, <country country="DE">Germany</country></aff>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
        <xref rid="btae178-cor1" ref-type="corresp"/>
        <xref rid="btae178-FM1" ref-type="author-notes"/>
        <!--rahmann@cs.uni-saarland.de-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Kelso</surname>
          <given-names>Janet</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae178-cor1">Corresponding author. Algorithmic Bioinformatics, Center for Bioinformatics Saar and Saarland University, Saarland Informatics Campus E2.1, 66123 Saarbrücken, Germany. E-mail: <email>rahmann@cs.uni-saarland.de</email> (S.R.)</corresp>
      <fn id="btae178-FM1">
        <p>Johanna Elena Schmitz and Nihit Aggarwal Equal contribution.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-04-02">
      <day>02</day>
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>02</day>
      <month>4</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>4</issue>
    <elocation-id>btae178</elocation-id>
    <history>
      <date date-type="received">
        <day>06</day>
        <month>10</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>07</day>
        <month>3</month>
        <year>2024</year>
      </date>
      <date date-type="editorial-decision">
        <day>28</day>
        <month>3</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>01</day>
        <month>4</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>18</day>
        <month>4</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae178.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Automated chromatin segmentation based on ChIP-seq (chromatin immunoprecipitation followed by sequencing) data reveals insights into the epigenetic regulation of chromatin accessibility. Existing segmentation methods are constrained by simplifying modeling assumptions, which may have a negative impact on the segmentation quality.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We introduce EpiSegMix, a novel segmentation method based on a hidden Markov model with flexible read count distribution types and state duration modeling, allowing for a more flexible modeling of both histone signals and segment lengths. In a comparison with existing tools, ChromHMM, Segway, and EpiCSeg, we show that EpiSegMix is more predictive of cell biology, such as gene expression. Its flexible framework enables it to fit an accurate probabilistic model, which has the potential to increase the biological interpretability of chromatin states.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Source code: <ext-link xlink:href="https://gitlab.com/rahmannlab/episegmix" ext-link-type="uri">https://gitlab.com/rahmannlab/episegmix</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>ELIXIR-DE</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Each cell in a eukaryotic organism contains the same genetic information to build all required structural and functional gene products. However, cell-to-cell variation is essential for having specialized tissues with distinct physiological functions and to adapt to environmental changes (<xref rid="btae178-B10" ref-type="bibr">Cavalli and Heard 2019</xref>, <xref rid="btae178-B9" ref-type="bibr">Carter and Zhao 2021</xref>). This necessitates an additional layer of processes regulating gene expression to enable cell differentiation and to maintain cellular identities throughout cell divisions (<xref rid="btae178-B1" ref-type="bibr">Allis and Jenuwein 2016</xref>). Among the mechanisms tightly regulating gene expression are transcription factors and epigenetic modifications, like DNA methylation and histone modifications.</p>
    <sec>
      <title>1.1 Histone modifications</title>
      <p>With increasing knowledge about the role of histone modifications in altering the chromatin structure and DNA accessibility, it became apparent that different histone modifications are enriched in chromatin regions with distinct functional roles (<xref rid="btae178-B2" ref-type="bibr">Baker 2011</xref>). For example, modification H3K4me3 [in histone protein H3, the lysine at position 4 (K4) is trimethylated (me3)] is enriched in promoters and can be linked to transcriptional activation; H3K36me3 is enriched in active genes, and H3K27me3 can be associated with gene repression by the Polycomb protein complex (<xref rid="btae178-B7" ref-type="bibr">Blackledge and Klose 2021</xref>). Densely packed chromatin, called heterochromatin, is typically characterized by low levels of acetylation, whereas open, actively transcribed chromatin, called euchromatin, shows enrichment of acetylated lysine (<xref rid="btae178-B3" ref-type="bibr">Bannister and Kouzarides 2011</xref>). Combinatorial patterns of multiple histone modifications allow us to characterize so-called <italic toggle="yes">chromatin states</italic> that describe the different functional states of both coding and noncoding regions in the genome (<xref rid="btae178-B2" ref-type="bibr">Baker 2011</xref>).</p>
    </sec>
    <sec>
      <title>1.2 Chromatin immunoprecipitation followed by sequencing</title>
      <p>Chromatin immunoprecipitation followed by sequencing (ChIP-seq) enables the generation of genome-wide histone maps in high-throughput experiments (<xref rid="btae178-B4" ref-type="bibr">Barski <italic toggle="yes">et al.</italic> 2007</xref>). For ChIP-seq, DNA-binding proteins of interest, such as specifically modified histones or transcription factors, are tagged with specific antibodies. After chromatin shearing, DNA fragments bound to the desired proteins or protein-modifications are captured and the bound DNA is extracted for sequencing. Reads are mapped to the reference genome to infer the positioning of histone marks across the genome (<xref rid="btae178-B26" ref-type="bibr">Park 2009</xref>). The positional enrichment of reads is compromised by a certain amount of noise.</p>
    </sec>
    <sec>
      <title>1.3 Probabilistic models for segmentation</title>
      <p>The availability of genome-wide ChIP-seq data led to the development of automated methods for genome segmentation and annotation. These methods use a probabilistic model to detect recurrent patterns of epigenetic marks using the aligned reads to determine the signal intensity at different positions in the genome (<xref rid="btae178-F1" ref-type="fig">Fig. 1</xref>). HMMSeg (<xref rid="btae178-B13" ref-type="bibr">Day <italic toggle="yes">et al.</italic> 2007</xref>), ChromHMM (<xref rid="btae178-B16" ref-type="bibr">Ernst and Kellis 2010</xref>), and EpiCSeg (<xref rid="btae178-B22" ref-type="bibr">Mammana and Chung 2015</xref>) are based on hidden Markov models (HMMs), Segway, and Segway 2.0 (<xref rid="btae178-B11" ref-type="bibr">Chan <italic toggle="yes">et al.</italic> 2018</xref>) fit a Gaussian mixture model using a dynamic Bayesian network and <xref rid="btae178-B12" ref-type="bibr">Daneshpajouh <italic toggle="yes">et al.</italic> (2022)</xref> developed a state–space model assuming that the observed data is a linear function of the state-specific parameter matrix plus Gaussian noise. <xref rid="btae178-B24" ref-type="bibr">Marco <italic toggle="yes">et al.</italic> (2017)</xref> proposed a hierarchical HMM to simultaneously generate two segmentations at different length scales. The first (nucleosome level) segmentation works similarly to ChromHHM and captures histone modification patterns. The second (domain level) segmentation interprets sequences of nucleosome states (e.g. a super-enhancer domain state combining strong, weak, and flanking enhancer nucleosome states). In the present work, we focus on the accurate modeling of the nucleosome level. For a more comprehensive review, we refer to <xref rid="btae178-B21" ref-type="bibr">Libbrecht <italic toggle="yes">et al.</italic> (2021)</xref>.</p>
      <fig position="float" id="btae178-F1">
        <label>Figure 1.</label>
        <caption>
          <p>Chromatin segmentation: the reads of a ChIP-seq experiment are converted into a count matrix by counting the number of reads mapping to each nonoverlapping 200-bp genomic interval. The states of a multivariate HMM capture patterns in the multivariate read count distribution of the histone marks, and the transition probabilities between states capture the relations between adjacent chromatin states.</p>
        </caption>
        <graphic xlink:href="btae178f1" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>1.4 HMMs</title>
      <p>Multivariate HMMs capture both combinatorial patterns of multiple histone marks and adjacency relations between different genomic elements, which makes them a prominent tool for chromatin state discovery (<xref rid="btae178-B20" ref-type="bibr">Lee and Park 2014</xref>). An HMM describes two stochastic processes, an invisible Markov chain consisting of a finite set of hidden states and a visible process of observable signals. Here, the hidden states correspond to chromatin states and the observable signals to the observed read count vector per genomic region. Each hidden state has state-specific probabilities of emitting an observation, called <italic toggle="yes">emission probabilities</italic>. For chromatin segmentation, the genome is divided into nonoverlapping intervals (of typical length 200 bp), such that each observation is a vector of counts corresponding to the number of reads assigned to the interval per histone mark. Thus, the emission probabilities of a single hidden state capture a specific combinatorial pattern of multiple histone marks. Different states may hence define different functional genomic elements, such as promoters, enhancers or gene bodies. In addition, the relations between adjacent chromatin states are modeled via transition probabilities, which determine, for each state, the probabilities to either stay in the same state or to transition to another state.</p>
    </sec>
    <sec>
      <title>1.5 Modeling assumptions</title>
      <p>The ability of an HMM to detect patterns that correspond to biologically meaningful chromatin states is constrained by the modeling assumptions underlying the emission and transition probabilities. These assumptions are thus a distinguishing feature of existing HMM-based methods. For example, ChromHMM fits an HMM on binarized data (high versus low read count), where the emission probabilities are assumed to be independent Bernoulli experiments, and EpiCSeg models the emission probabilities using a Negative Multinomial distribution. Previous analyses of ChIP-seq data have shown that the read count distributions in some states and for some histone marks may be overdispersed and skewed, partly caused by differential protection against sonication, unequal binding affinity of distinct antibodies, sequence dependent PCR amplification and discrepancies when mapping to repeat-rich regions, which all introduce bias to the data (<xref rid="btae178-B14" ref-type="bibr">Diaz <italic toggle="yes">et al.</italic> 2012</xref>). Not all observed combinations of overdispersion and skewness can be captured by the commonly used probability distribution families, such as the Negative Binomial distribution. Furthermore, <xref rid="btae178-B5" ref-type="bibr">Beacon <italic toggle="yes">et al.</italic> (2021)</xref> showed that histone marks that are enriched in short domains, like promoters or TSS, are typically characterized by narrow peaks with high signal intensities, while histone marks enriched in broad domains, like heterochromatic regions, have lower signal intensities. Thus, regions in the genome covered by the same chromatin state may have different lengths, e.g. short promoters and long heterochromatic regions. Existing tools only model a single duration distribution type (Geometric) with exponentially decreasing probabilities, and can only fit the mean length of a region, but not its shape to the observed data. Hyperparameters, such as introduced by Segway, allow to place a prior on the expected segment length, but are still prone to the above limitations due to the unchanged geometric distribution type (<xref rid="btae178-B18" ref-type="bibr">Hoffman <italic toggle="yes">et al.</italic> 2012</xref>). Furthermore, they are either limited to the same parameters for all states or can be set for each numeric label, which may require extensive manual fine tuning.</p>
    </sec>
    <sec>
      <title>1.6 Novel contributions</title>
      <p>We propose a new flexible HMM architecture that relaxes the modeling assumptions of existing HMM-based methods in two ways. First, we allow to choose, for each histone modification, a different discrete distribution type from a broad selection (<xref rid="btae178-T1" ref-type="table">Table 1</xref>). This allows us to model more flexible read count distribution shapes, including overdispersed and skewed distributions. Second, we provide flexible duration modeling (using an automated state extension technique) to capture the characteristics of broad and narrow chromatin domains in a single segmentation with nucleosome resolution. By applying our method to publicly available ChIP-seq data, we show that such a flexible HMM leads to a better model fit and may increase segmentation accuracy and biological interpretability.</p>
      <table-wrap position="float" id="btae178-T1">
        <label>Table 1.</label>
        <caption>
          <p>Overview of available discrete distributions (<xref rid="btae178-B19" ref-type="bibr">Johnson et al. 1993</xref>).</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Name</th>
              <th rowspan="1" colspan="1">Parameters</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE1">
                  <mml:math id="IM1" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">N</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mn>1</mml:mn>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Poisson</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE2">
                  <mml:math id="IM2" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>λ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Negative binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE3">
                  <mml:math id="IM3" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>p</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mn>1</mml:mn>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Beta binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE4">
                  <mml:math id="IM4" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">N</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mo>α</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>β</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Beta negative binomial</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE5">
                  <mml:math id="IM5" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>r</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>α</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>β</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Sichel</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE6">
                  <mml:math id="IM6" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>μ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mo>σ</mml:mo>
                      <mml:mo>∈</mml:mo>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mrow>
                            <mml:mi mathvariant="double-struck">R</mml:mi>
                          </mml:mrow>
                          <mml:mo>+</mml:mo>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mo>,</mml:mo>
                      <mml:mi>v</mml:mi>
                      <mml:mo>∈</mml:mo>
                      <mml:mi mathvariant="double-struck">R</mml:mi>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec>
    <title>2 Methods</title>
    <sec>
      <title>2.1 Probabilistic model</title>
      <p>An HMM is formally defined as a quintuple <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mo>π</mml:mo><mml:mo>,</mml:mo><mml:mo>Σ</mml:mo><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is a finite set of hidden states, <italic toggle="yes">π</italic> is a probability vector with the starting probabilities for each state, Σ is a set of observable emission values, <italic toggle="yes">A</italic> is an <italic toggle="yes">N </italic>×<italic toggle="yes"> N</italic> matrix, where each entry <italic toggle="yes">a<sub>ij</sub></italic> denotes the transition probability to move from state <italic toggle="yes">i</italic> to state <italic toggle="yes">j</italic>, and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mi>B</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the complete collection of parameters required to calculate the emission probabilities of an observation in each state <italic toggle="yes">j</italic> (<xref rid="btae178-B20" ref-type="bibr">Lee and Park 2014</xref>). For a sample with <italic toggle="yes">T</italic> observations or time points, the collection of random variables is thus given by (<italic toggle="yes">O</italic>, <italic toggle="yes">Q</italic>), where <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the observed sequence and <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> denotes the hidden state sequence.</p>
      <p>Due to the HMM independence assumptions [<italic toggle="yes">Q</italic> is a Markov chain, <italic toggle="yes">O<sub>t</sub></italic> is conditionally independent of everything else, given <italic toggle="yes">Q<sub>t</sub></italic>; <xref rid="btae178-B6" ref-type="bibr">Bilmes (1998)</xref>], the probability that an HMM with parameters <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo>θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>π</mml:mo><mml:mo>,</mml:mo><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> generates the combination <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mi>o</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mi>o</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:munderover></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>For given fixed <italic toggle="yes">O </italic>=<italic toggle="yes"> o</italic>, the Viterbi algorithm (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>) determines the state sequence <italic toggle="yes">q</italic> that maximizes this probability (for fixed transition and emission probabilities).</p>
      <p>For chromatin segmentation, the emission alphabet is given by the multivariate, countable infinite set
<disp-formula id="E2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mo>Σ</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>M</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>}</mml:mo><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">M</italic> is the dimension of the emission alphabet, corresponding to the number of histone modifications in the input data. Hence, the natural choice is to model the emission probabilities using a multivariate discrete distribution. Under the assumption that the read counts of all histone modifications are conditionally independent of each other given a state, the emission probability for an observation <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> in state <italic toggle="yes">j</italic> is given by
<disp-formula id="E3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>O</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>This leads to a flexible framework in which different distribution types may be selected to model the read counts of distinct histone marks. <xref rid="btae178-T1" ref-type="table">Table 1</xref> gives an overview over the univariate discrete distributions available in EpiSegMix (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref> for details). Distributions with more parameters are more flexible and hence lead to a more accurate model fit: One-parameter distributions (Poisson) may fit the mean of the observed read counts, but not variance or skewness; two-parameter distributions (e.g. Negative Binomial) may fit both mean and variance but not skewness; three-parameter distributions may fit all three moments. With data from several thousand genomic intervals per state, there is no danger of overfitting three parameters. Still, each distribution has its own limitations and dependencies between moments, so having a variety of options is beneficial. The best performing distribution may vary for histone modifications and between experiments with different data quality. Therefore, we provide a workflow to find for each mark the distribution that maximizes the log-likelihood of a three-state HMM with univariate emissions. For further information, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Duration modeling</title>
      <p>The typical HMM topology is a fully connected graph, including self-loops on states. Hence the sojourn time <italic toggle="yes">X</italic> in a state follows a Geometric distribution <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo>·</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> for some <inline-formula id="IE9000"><mml:math id="IM9000" display="inline" overflow="scroll"><mml:mi>p</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula>, with exponentially decreasing probabilities for longer durations (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>). Although the mean of a Geometric distribution can be made arbitrarily large, the variance increases with it and the mode stays at <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Geometric distributions model durations that are short with higher probability, but have limited flexibility when modeling longer durations with a mode far away from 1. We therefore propose to use an extended-state HMM architecture, in which each state is internally represented as a sub-HMM. Each sub-HMM has a linear left-to-right topology with a different number of sub-states, but with the additional constraints that all sub-states have the same emission probabilities and same self-transition probabilities (<xref rid="btae178-B28" ref-type="bibr">Russell and Cook 1987</xref>) (see <xref rid="btae178-F2" ref-type="fig">Fig. 2A</xref>). With this topology, the state duration is the sum of a number of independent Geometrically distributed random variables, which has a Negative Binomial distribution. It has two parameters: the state-exit probability <italic toggle="yes">P</italic> (same as for a Geometric distribution), and the copy number <italic toggle="yes">r</italic> (where <italic toggle="yes">r </italic>=<italic toggle="yes"> </italic>1 gives the Geometric distribution). In contrast to a Geometric distribution, the mean and variance of a Negative Binomial distribution can be controlled independently, and the mode can be placed at an arbitrary duration (<xref rid="btae178-F2" ref-type="fig">Fig. 2B</xref>). Therefore, both long and short durations can be modeled flexibly.</p>
      <fig position="float" id="btae178-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Duration modeling. (A) Extended-state HMM with different numbers of states in the sub-HMMs for a univariate four-state HMM. (B) Comparison of state duration distribution for a state in a classical HMM (<italic toggle="yes">r </italic>=<italic toggle="yes"> </italic>1) and in a topology HMM with two or four sub-states to achieve the same mean of 5 (left) or 20 (right).</p>
        </caption>
        <graphic xlink:href="btae178f2" position="float"/>
      </fig>
      <p>The number of sub-states is fitted automatically during parameter estimation. Starting from a standard ergodic topology (each state is represented by one sub-state), the segment lengths are computed for each state under the current model. The number of sub-states is then given by the estimated parameter <italic toggle="yes">r</italic> of a Negative Binomial distribution under the additional constraint that <italic toggle="yes">r</italic> is a natural number between 1 and 5. Each state may hence have a different number of sub-states depending on the observed segment lengths. By default, the topology is adjusted twice. Before the adjustments, the parameters of the HMM are estimated for a fixed number of iterations (default 5) and until convergence for the final topology.</p>
    </sec>
    <sec>
      <title>2.3 Parameter estimation</title>
      <p>Before an HMM can be used to estimate the state sequence, its parameters (transition and emission probabilities) must be estimated. As we typically do not have labeled training data, parameter estimation must proceed in an unsupervised manner using the Baum–Welch algorithm, which is a concretization of the general expectation maximization (EM) algorithm tailored to the structure of HMMs (<xref rid="btae178-B27" ref-type="bibr">Rabiner 1989</xref>). It alternates between estimating the model parameters (M-step), given a (fuzzy or probabilistic) assignment of observations to states, and re-estimating the state membership probabilities of each observation (E-step) until convergence (details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>3 Implementation</title>
    <p>The flexible distribution HMM and parameter estimation is implemented in C++ as a command-line tool <monospace>EpiSegMix</monospace>. Its source code is at <ext-link xlink:href="https://gitlab.com/rahmannlab/episegmix" ext-link-type="uri">https://gitlab.com/rahmannlab/episegmix</ext-link>.</p>
    <p>All steps of the surrounding workflow are incorporated in a <monospace>Snakemake</monospace> workflow (<xref rid="btae178-B25" ref-type="bibr">Mölder <italic toggle="yes">et al.</italic> 2021</xref>).</p>
    <p>By default, we estimate parameters on the ENCODE pilot regions which contain a good representation of the whole genome and are thus commonly used to fit the model (<xref rid="btae178-B18" ref-type="bibr">Hoffman <italic toggle="yes">et al.</italic> 2012</xref>, <xref rid="btae178-B12" ref-type="bibr">Daneshpajouh <italic toggle="yes">et al.</italic> 2022</xref>). Alternatively, the user may specify a list of chromosomes to be used for model fitting. The segmentation is performed genome-wide.</p>
    <p>The main output of chromatin segmentation is a file that assigns one state to each position in the genome, and an HTML report with plots that characterize the model and segmentation, enabling their biological interpretation. For example, the heatmap showing the normalized histone modification intensities of each state (as in <xref rid="btae178-F6" ref-type="fig">Fig. 6B</xref>) is central to determine the genomic function of the states.</p>
  </sec>
  <sec>
    <title>4 Results</title>
    <p>We evaluated EpiSegMix on publicly available ChIP-seq data for the human cell lines K562, HepG2, GM12878, IMR90, H1, and SJCRH30 provided by the ENCODE consortium (<xref rid="btae178-B15" ref-type="bibr">Dunham <italic toggle="yes">et al.</italic> 2012</xref>) using the most recently processed data. With the selected cell lines, we evaluate our method on ChIP-seq experiments that were performed over the last decade (from 2010 to 2020) with different data properties (e.g. the mapped read length ranges from 36 to 100 bp). To analyze the robustness of all methods, we generated the count matrix for two replicate experiments each (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>). To reproduce the results, all accession numbers are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S9</xref> and the script to create the count matrix is part of the code repository. We restricted our analysis to the six core histone marks H3K9me3, H3K27me3, H3K36me3, H3K4me1, H3K4me3, and H3K27ac defined by the IHEC consortium (<xref rid="btae178-B8" ref-type="bibr">Bujold <italic toggle="yes">et al.</italic> 2016</xref>).</p>
    <p>Since chromatin segmentation is an unsupervised method and no ground truth is available, we evaluate the performance of EpiSegMix by comparing it to three established chromatin segmentation tools ChromHMM (<xref rid="btae178-B17" ref-type="bibr">Ernst and Kellis 2012</xref>), EpiCSeg (<xref rid="btae178-B22" ref-type="bibr">Mammana and Chung 2015</xref>), and Segway (<xref rid="btae178-B11" ref-type="bibr">Chan <italic toggle="yes">et al.</italic> 2018</xref>).</p>
    <p>We first perform a quantitative comparison by evaluating how well the different methods can predict gene expression and ATAC-seq data. Afterwards, we analyze how the different methods reflect known genome biology by showing further characteristic plots for one exemplary dataset.</p>
    <sec>
      <title>4.1 Data processing</title>
      <p>In a preprocessing step, we convert the aligned reads into a count matrix using the <italic toggle="yes">bamsignals</italic> package (<xref rid="btae178-B23" ref-type="bibr">Mammana and Helmuth 2023</xref>). In the count matrix, each row corresponds to a consecutive, nonoverlapping region with a fixed window size (default 200 base pairs), called bins, and each column corresponds to a distinct histone mark. Each read is assigned to exactly one genomic bin depending on the position of its 5’ end.</p>
      <p>For all methods, we fitted a 10-state model. EpiSegMix and Segway were trained on the ENCODE pilot regions of <italic toggle="yes">hg38</italic>. For EpiSegMix, three-state HMMs were fitted individually for each mark and different distributions. We then chose the distribution with the highest log-likelihood, listed in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section 4</xref>. For Segway, the <italic toggle="yes">resolution</italic> was set to 200 bp, the <italic toggle="yes">track-weight</italic> to 0.01, and the <italic toggle="yes">segtransition-weight-scale</italic> and <italic toggle="yes">prior-strength</italic> to 1. For ChromHMM and EpiCSeg, the default parameters were used (200 bp resolution, 10-state model).</p>
    </sec>
    <sec>
      <title>4.2 Advantages of flexible distribution modeling</title>
      <p>To show the advantages of flexible emission and duration distribution types for chromatin segmentation, we compare fitted models using different emission distributions and with and without duration modeling. Narrow marks, such as H3K4me3, often have skewed read count distributions. Fitting the Negative Binomial (2 parameters) and Sichel (3 parameters) distribution to the read counts of H3K4me3 shows the limitation of the Negative Binomial distributions to model highly skewed and overdispersed data (<xref rid="btae178-F3" ref-type="fig">Fig. 3A</xref>). Further evaluation of the effect that emission modeling has on the segmentation is provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.</p>
      <fig position="float" id="btae178-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Flexible emission and duration modeling. The histograms show the sample distribution and the curves show the theoretical distribution fitted by the model. (A) Results of fitting a three-state HMM to the mark H3K4me3 using the Negative Binomial and Sichel distribution (for the state with high H3K4me3 in HepG2_1). (B) State duration in the HepG2_1 promoter state for an HMM with a classic (Geometric) and extended (Negative Binomial) topology.</p>
        </caption>
        <graphic xlink:href="btae178f3" position="float"/>
      </fig>
      <p><xref rid="btae178-F3" ref-type="fig">Figure 3B</xref> shows that the state duration, determining the segment length (number of consecutive bins assigned to the same state), does not follow a Geometric distribution for most chromatin states. In comparison, the Negative Binomial distribution, as fitted by our flexible duration model, leads to a more accurate description of the real segment length distribution.</p>
    </sec>
    <sec>
      <title>4.3 Evaluation of gene expression prediction</title>
      <p>Since a biologically meaningful segmentation should have states that correlate with different gene expression levels, we compared how well the chromatin states of EpiSegMix, EpiCSeg, ChromHMM, and Segway can predict gene expression. To measure the gene expression in each 200 bp bin that contains (part of) a protein-coding gene, we used total RNA-seq experiments for the different cell lines provided by ENCODE and assigned each bin the log(FPKM + 1) normalized expression value of the gene (FPKM: fragments per kilobase of transcript per million mapped reads). We performed linear regression with the state labels as categorical predictors, i.e. for each bin <italic toggle="yes">i’</italic>s true expression <italic toggle="yes">x<sub>i</sub></italic>, we used the state-specific mean expression as predictor <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and measured the mean quadratic regression error versus the mean quadratic error using the global mean <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></inline-formula> as predictor and computed the coefficient of determination <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>/</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> (between 0 and 1, where 1 is perfect). The <italic toggle="yes">R</italic><sup>2</sup> values vary for the different cell lines, which can partly be explained by the unequal data quality. <xref rid="btae178-F4" ref-type="fig">Figure 4</xref> compares the <italic toggle="yes">R</italic><sup>2</sup> values of the different methods across cell lines. On average, EpiSegMix has the highest predictive power among the methods.</p>
      <fig position="float" id="btae178-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Prediction of transcription levels from chromatin state labels: coefficient of determination <italic toggle="yes">R</italic><sup>2</sup> (<italic toggle="yes">y</italic>-axis) using state labels as categorical predictors for <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>FPKM</mml:mtext><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> expression values for the different methods (<italic toggle="yes">x</italic>-axis) on different cell lines (color). Black lines indicate mean <italic toggle="yes">R</italic><sup>2</sup> for each method.</p>
        </caption>
        <graphic xlink:href="btae178f4" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.4 Evaluation of ATAC-seq prediction</title>
      <p>We performed a similar analysis predicting ATAC-seq read counts instead of gene expression levels for all cell lines with available ATAC-seq experiments. We counted how many reads of the ATAC-seq experiment map to each nonoverlapping 200 bp bin in the genome to generate a count matrix in the same way as for the histone counts. In the same way as for gene expression, we performed linear regression to predict log-transformed ATAC-seq read counts using the state labels as categorical predictors. Since ATAC-seq measures the chromatin accessibility, active states, like promoter or transcription states, should be predictive of high ATAC-seq counts, while heterochromatic states should be predictive of low ATAC-seq counts. <xref rid="btae178-F5" ref-type="fig">Figure 5</xref> shows that EpiSegMix and EpiCSeg have a similar predictive power of chromatin accessibility, as measured by the coefficient of determination <italic toggle="yes">R</italic><sup>2</sup>, while ChromHMM and Segway have lower <italic toggle="yes">R</italic><sup>2</sup> scores on average.</p>
      <fig position="float" id="btae178-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Prediction of ATAC-seq levels from chromatin state labels. The plot shows the coefficient of variation (<italic toggle="yes">R</italic><sup>2</sup>) using standard linear regression with the state labels as categorical predictors to predict <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula> transformed ATAC counts. The black line shows the mean <italic toggle="yes">R</italic><sup>2</sup> value.</p>
        </caption>
        <graphic xlink:href="btae178f5" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.5 Evaluation of reflected genome biology</title>
      <p>We perform a qualitative analysis of the different methods by comparing the similarities of the genome-wide segmentation and functional assignment of states, their genome coverage, overall segment length, and enrichment around protein coding genes (<xref rid="btae178-F6" ref-type="fig">Fig. 6</xref>). An in-depth example (genome browser view) is provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>. For better comparability, we manually assigned a label that best describes the biological function of the state to each numerical state ID. This facilitates the comparison of state assignments between methods. A description of each label is given in <xref rid="btae178-F6" ref-type="fig">Fig. 6E</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S8</xref>.</p>
      <fig position="float" id="btae178-F6">
        <label>Figure 6.</label>
        <caption>
          <p>Comparison between EpiSegMix and EpiCSeg, Segway and ChromHMM for K562_1. (A) State overlap between methods. The bar heights correspond to the genomic coverage of the biologically annotated state and the edge thickness to the overlap between the methods. (B) Heatmaps showing the histone enrichment per state. The mean counts per state are normalized column wise, such that for each histone modification the state with the maximum mean count has a value of one and the state with the lowest mean count has a value of zero. (C) State distribution. The line plots show how often each state occurs around protein coding genes. (D) State duration. The plot shows for each biologically annotated state the state length distribution in base pairs of the different methods. (E) State description.</p>
        </caption>
        <graphic xlink:href="btae178f6" position="float"/>
      </fig>
      <p><xref rid="btae178-F6" ref-type="fig">Figure 6A</xref> shows that the states assigned by the count-based methods EpiSegMix, EpiCSeg, and Segway have a similar genome coverage and high overlap between state assignments. Moreover, all three methods EpiSegMix, EpiCSeg, and Segway provide a deeper epigenomic distinction of heterochromatic regions that ChromHMM aggregates into a single state. EpiSegMix discriminates a “no signal” state from a strong and a weak heterochromatic state that show distinctive patterns of enriched histone marks. Thereby, EpiSegMix better captures transitions from closed to open chromatin as compared to ChromHMM (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S7</xref>). This distinction is also supported by Segway and EpiCSeg. In addition, EpiSegMix defines a more consistent and accurate label for unmappable regions in comparison to all other methods (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>). While, in a 10-state model, ChromHMM appears to provide a more fine-grained distinction of regulatory states, such as weak and flanking promoter regions, the robustness of these classifications is not always given. Thus, a biological interpretation of these regions should be taken with caution (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S6</xref>).</p>
      <p><xref rid="btae178-F6" ref-type="fig">Figure 6B</xref> shows the genome wide enrichment of histone marks across states for each tool. All methods find similar patterns of histone marks: Enrichment of regulatory marks such as H3K27ac, H3K4me1, and H3K4me3, is predominantly observed in promoter and enhancer states, as expected. Actively transcribed mark H3K36me3 is enriched in transcription states; the repressive mark H3K27me3 is most strongly enriched in Polycomb repressed heterochromatin. Overall absolute levels of H3K9me3 are low, but due to the column-wise normalization in <xref rid="btae178-F6" ref-type="fig">Fig. 6B</xref>, it appears enriched in a number of states, possibly reflecting overall background noise.</p>
      <p>Despite the overall high state concordance across tools, some differences can be observed particularly in a gene centered comparison, i.e. across gene bodies, including ±3 kb upstream and downstream of the gene transcription start and gene end, respectively (<xref rid="btae178-F6" ref-type="fig">Fig. 6C</xref>). Coordinates were taken from ENCODE reference ENCFF824ZKD. EpiSegMix and Segway show a higher enrichment of promoter states around TSSs as compared to ChromHMM and EpiCSeg, which discriminate between weak and strong promoters. This distinction is not linked to a better prediction of transcription levels.</p>
      <p>When comparing the segment lengths (i.e. consecutive genomic bins assigned to the same state) and their genomic distributions across the different methods we observe that the duration flexibility of EpiSegMix helps to capture the wide range of short (promoters/enhancers), intermediate (short to long genes), and long (heterochromatic regions) state durations in a more consistent manner as compared to all other methods. For example, EpiSegMix’ Tx state most effectively covers large genes (i.e. over 40% of all human genes are longer than 0.8 × 10<sup>4</sup> bp), allowing for a more accurate annotation of genes among different classes. Another advantage of EpiSegMix in comparison to EpiCSeg and Segway can be observed in the longer segment lengths for Polycomb repressed genes (Repr_Pc) and for heterochromatic regions (Het_Wk and Het_Str), which more closely match the known size of broad domains (<xref rid="btae178-B29" ref-type="bibr">Steensel and Belmont 2017</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>We developed EpiSegMix, a flexible HMM framework for chromatin segmentation. We enhanced the flexibility of existing HMMs with respect to modeling both emission probabilities and state durations. To account for the overdispersed and skewed ChIP-seq read count distributions, the read counts of each histone modification can follow a different discrete distribution type. We currently support a variety of distributions, and further distributions may be added in the future. The internal HMM topology was adjusted to be able to model state durations that follow a Negative Binomial instead of a Geometric distribution, which better reflects the inherent segment length of chromatin states that cover either small peaks or broad domains. For example, lamina-associated domains (LADs; heterochromatin at the nuclear periphery) usually have a size between 10<sup>4</sup> and 10<sup>7</sup> bp (<xref rid="btae178-B29" ref-type="bibr">Steensel and Belmont 2017</xref>).</p>
    <p>A comparison with ChromHMM, Segway, and EpiCSeg suggests that EpiSegMix has the potential to provide segmentations that better reflect genomic annotations and yields states that are more predictive of gene expression. Moreover, the flexible duration modeling allows to effectively capture the reflective state lengths of long gene bodies and heterochromatic domains. The influence of the modified HMM topology on the segmentation suggests that testing other topology models is an important aspect to increase the modeling accuracy. Another direction of future work could be to combine the flexible duration modeling of EpiSegMix with a hierarchical HMM, as proposed by <xref rid="btae178-B24" ref-type="bibr">Marco <italic toggle="yes">et al.</italic> (2017)</xref>, which may prove to be a powerful idea to perform inter-dependent chromatin segmentation at different length scales.</p>
    <p>Although our results suggest that flexible distributions such as the Sichel or Beta Negative Binomial distribution often give the best results, we support a variety of distributions to deal with changing data properties and provide an easily extendable framework to integrate other data, such as ATAC-seq, DNase-seq or transcription factor ChIP-seq data.</p>
    <p>In summary, we show that the modeling assumptions of the HMM have an impact on the segmentation quality and biological interpretation. Due to its high flexibility, EpiSegMix accurately fits HMM read count data with varying distributional properties and provides the additional option of flexible duration modeling. Finally, EpiSegMix provides a widely configurable framework for chromatin segmentation that can be applied to a wide range of data.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae178_Supplementary_Data</label>
      <media xlink:href="btae178_supplementary_data.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>We acknowledge the ENCODE consortium for producing the data.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>J.E.S. and N.A. contributed equally to this work. The method was developed by J.E.S. and N.A. under the supervision of J.W., A.S., and S.R. L.L. performed preliminary analyses to select suitable distributions. J.E.S, N.A., J.W., and S.R. contributed to writing, and all authors contributed to revising the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by internal funding and by ELIXIR-DE (de.nbi), the research infrastructure for life science data (grant to N.A.).</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data can be downloaded from the ENCODE portal. All accession numbers are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S9</xref>.</p>
  </sec>
  <sec>
    <title>Ethics declaration</title>
    <p>None declared.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae178-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Allis</surname><given-names>CD</given-names></string-name>, <string-name><surname>Jenuwein</surname><given-names>T.</given-names></string-name></person-group><article-title>The molecular hallmarks of epigenetic control</article-title>. <source>Nat Rev Genet</source><year>2016</year>;<volume>17</volume>:<fpage>487</fpage>–<lpage>500</lpage>.<pub-id pub-id-type="pmid">27346641</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baker</surname><given-names>M.</given-names></string-name></person-group><article-title>Making sense of chromatin states</article-title>. <source>Nat Methods</source><year>2011</year>;<volume>8</volume>:<fpage>717</fpage>–<lpage>22</lpage>.<pub-id pub-id-type="pmid">21878916</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bannister</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Kouzarides</surname><given-names>T.</given-names></string-name></person-group><article-title>Regulation of chromatin by histone modifications</article-title>. <source>Cell Res</source><year>2011</year>;<volume>21</volume>:<fpage>381</fpage>–<lpage>95</lpage>.<pub-id pub-id-type="pmid">21321607</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barski</surname><given-names>A</given-names></string-name>, <string-name><surname>Cuddapah</surname><given-names>S</given-names></string-name>, <string-name><surname>Cui</surname><given-names>K</given-names></string-name></person-group><etal>et al</etal><article-title>High-resolution profiling of histone methylations in the human genome</article-title>. <source>Cell</source><year>2007</year>;<volume>129</volume>:<fpage>823</fpage>–<lpage>37</lpage>.<pub-id pub-id-type="pmid">17512414</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Beacon</surname><given-names>TH</given-names></string-name>, <string-name><surname>Delcuve</surname><given-names>GP</given-names></string-name>, <string-name><surname>López</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>The dynamic broad epigenetic (H3K4me3, H3K27ac) domain as a mark of essential genes</article-title>. <source>Clin Epigenet</source><year>2021</year>;<volume>13</volume>:<fpage>138</fpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bilmes</surname><given-names>J.</given-names></string-name></person-group><article-title>A gentle tutorial of the EM algorithm and its application to parameter estimation for Gaussian mixture and hidden Markov models</article-title>. <source>ICSI Tech Rep Ser vol. TR-97-021, Berkeley,</source><year>1998</year>.</mixed-citation>
    </ref>
    <ref id="btae178-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blackledge</surname><given-names>NP</given-names></string-name>, <string-name><surname>Klose</surname><given-names>RJ.</given-names></string-name></person-group><article-title>The molecular principles of gene regulation by polycomb repressive complexes</article-title>. <source>Nat Rev Mol Cell Biol</source><year>2021</year>;<volume>22</volume>:<fpage>815</fpage>–<lpage>33</lpage>.<pub-id pub-id-type="pmid">34400841</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bujold</surname><given-names>D</given-names></string-name>, <string-name><surname>Morais</surname><given-names>DAdL</given-names></string-name>, <string-name><surname>Gauthier</surname><given-names>C</given-names></string-name></person-group><etal>et al</etal><article-title>The international human epigenome consortium data portal</article-title>. <source>Cell Syst</source><year>2016</year>;<volume>3</volume>:<fpage>496</fpage>–<lpage>9.e2</lpage>.<pub-id pub-id-type="pmid">27863956</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Carter</surname><given-names>B</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>K.</given-names></string-name></person-group><article-title>The epigenetic basis of cellular heterogeneity</article-title>. <source>Nat Rev Genet</source><year>2021</year>;<volume>22</volume>:<fpage>235</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">33244170</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cavalli</surname><given-names>G</given-names></string-name>, <string-name><surname>Heard</surname><given-names>E.</given-names></string-name></person-group><article-title>Advances in epigenetics link genetics to the environment and disease</article-title>. <source>Nature</source><year>2019</year>;<volume>571</volume>:<fpage>489</fpage>–<lpage>99</lpage>.<pub-id pub-id-type="pmid">31341302</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chan</surname><given-names>RCW</given-names></string-name>, <string-name><surname>Libbrecht</surname><given-names>MW</given-names></string-name>, <string-name><surname>Roberts</surname><given-names>EG</given-names></string-name></person-group><etal>et al</etal><article-title>Segway 2.0: gaussian mixture models and minibatch training</article-title>. <source>Bioinformatics</source><year>2018</year>;<volume>34</volume>:<fpage>669</fpage>–<lpage>71</lpage>.<pub-id pub-id-type="pmid">29028889</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Daneshpajouh</surname><given-names>H</given-names></string-name>, <string-name><surname>Chen</surname><given-names>B</given-names></string-name>, <string-name><surname>Shokraneh</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>Continuous chromatin state feature annotation of the human epigenome</article-title>. <source>Bioinformatics</source><year>2022</year>;<volume>38</volume>:<fpage>3029</fpage>–<lpage>36</lpage>.<pub-id pub-id-type="pmid">35451453</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Day</surname><given-names>N</given-names></string-name>, <string-name><surname>Hemmaplardh</surname><given-names>A</given-names></string-name>, <string-name><surname>Thurman</surname><given-names>RE</given-names></string-name></person-group><etal>et al</etal><article-title>Unsupervised segmentation of continuous genomic data</article-title>. <source>Bioinformatics</source><year>2007</year>;<volume>23</volume>:<fpage>1424</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">17384021</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Diaz</surname><given-names>A</given-names></string-name>, <string-name><surname>Park</surname><given-names>K</given-names></string-name>, <string-name><surname>Lim</surname><given-names>DA</given-names></string-name></person-group><etal>et al</etal><article-title>Normalization, bias correction, and peak calling for ChIP-seq</article-title>. <source>Stat Appl Genet Mol Biol</source><year>2012</year>;<volume>11</volume>:<fpage>Article 9</fpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dunham</surname><given-names>I</given-names></string-name>, <string-name><surname>Kundaje</surname><given-names>A</given-names></string-name>, <string-name><surname>Aldred</surname><given-names>SF</given-names></string-name></person-group><etal>et al</etal><article-title>An integrated encyclopedia of DNA elements in the human genome</article-title>. <source>Nature</source><year>2012</year>;<volume>489</volume>:<fpage>57</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group><article-title>Discovery and characterization of chromatin states for systematic annotation of the human genome</article-title>. <source>Nat Biotechnol</source><year>2010</year>;<volume>28</volume>:<fpage>817</fpage>–<lpage>25</lpage>.<pub-id pub-id-type="pmid">20657582</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ernst</surname><given-names>J</given-names></string-name>, <string-name><surname>Kellis</surname><given-names>M.</given-names></string-name></person-group><article-title>ChromHMM: automating chromatin-state discovery and characterization</article-title>. <source>Nat Methods</source><year>2012</year>;<volume>9</volume>:<fpage>215</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">22373907</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hoffman</surname><given-names>MM</given-names></string-name>, <string-name><surname>Buske</surname><given-names>OJ</given-names></string-name>, <string-name><surname>Wang</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Unsupervised pattern discovery in human chromatin structure through genomic segmentation</article-title>. <source>Nat Methods</source><year>2012</year>;<volume>9</volume>:<fpage>473</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">22426492</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B19">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Johnson</surname><given-names>NL</given-names></string-name>, <string-name><surname>Kotz</surname><given-names>S</given-names></string-name>, <string-name><surname>Kemp</surname><given-names>AW</given-names></string-name></person-group><etal>et al</etal><source>Univariate discrete distributions</source>, <edition>2nd edn</edition>. <publisher-loc>New York, NY</publisher-loc>: <publisher-name>Wiley</publisher-name>, <year>1993</year>.</mixed-citation>
    </ref>
    <ref id="btae178-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>K-E</given-names></string-name>, <string-name><surname>Park</surname><given-names>H-S.</given-names></string-name></person-group><article-title>A review of three different studies on hidden Markov models for epigenetic problems: a computational perspective</article-title>. <source>Genomics Inform</source><year>2014</year>;<volume>12</volume>:<fpage>145</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">25705151</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Libbrecht</surname><given-names>MW</given-names></string-name>, <string-name><surname>Chan</surname><given-names>RCW</given-names></string-name>, <string-name><surname>Hoffman</surname><given-names>MM.</given-names></string-name></person-group><article-title>Segmentation and genome annotation algorithms for identifying chromatin state and other genomic patterns</article-title>. <source>PLoS Comput Biol</source><year>2021</year>;<volume>17</volume>:<fpage>e1009423</fpage>.<pub-id pub-id-type="pmid">34648491</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mammana</surname><given-names>A</given-names></string-name>, <string-name><surname>Chung</surname><given-names>H-R.</given-names></string-name></person-group><article-title>Chromatin segmentation based on a probabilistic model for read counts explains a large portion of the epigenome</article-title>. <source>Genome Biol</source><year>2015</year>;<volume>16</volume>:<fpage>151</fpage>.<pub-id pub-id-type="pmid">26206277</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B23">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Mammana</surname><given-names>A</given-names></string-name>, <string-name><surname>Helmuth</surname><given-names>J.</given-names></string-name></person-group><italic toggle="yes">bamsignals: Extract Read Count Signals from Bam Files</italic>. R package version 1.34.0, <year>2023</year>. <ext-link xlink:href="https://bioconductor.org/packages/bamsignals" ext-link-type="uri">https://bioconductor.org/packages/bamsignals</ext-link>.</mixed-citation>
    </ref>
    <ref id="btae178-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marco</surname><given-names>E</given-names></string-name>, <string-name><surname>Meuleman</surname><given-names>W</given-names></string-name>, <string-name><surname>Huang</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Multi-scale chromatin state annotation using a hierarchical hidden Markov model</article-title>. <source>Nat Commun</source><year>2017</year>;<volume>8</volume>:<fpage>15011</fpage>.<pub-id pub-id-type="pmid">28387224</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mölder</surname><given-names>F</given-names></string-name>, <string-name><surname>Jablonski</surname><given-names>KP</given-names></string-name>, <string-name><surname>Letcher</surname><given-names>B</given-names></string-name></person-group><etal>et al</etal><article-title>Sustainable data analysis with snakemake</article-title>. <source>F1000Res</source><year>2021</year>;<volume>10</volume>:<fpage>33</fpage>.<pub-id pub-id-type="pmid">34035898</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Park</surname><given-names>PJ.</given-names></string-name></person-group><article-title>ChIP–seq: advantages and challenges of a maturing technology</article-title>. <source>Nat Rev Genet</source><year>2009</year>;<volume>10</volume>:<fpage>669</fpage>–<lpage>80</lpage>.<pub-id pub-id-type="pmid">19736561</pub-id></mixed-citation>
    </ref>
    <ref id="btae178-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rabiner</surname><given-names>L.</given-names></string-name></person-group><article-title>A tutorial on hidden Markov models and selected applications in speech recognition</article-title>. <source>Proc IEEE</source><year>1989</year>;<volume>77</volume>:<fpage>257</fpage>–<lpage>86</lpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B28">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Russell</surname><given-names>M</given-names></string-name>, <string-name><surname>Cook</surname><given-names>A.</given-names></string-name></person-group> Experimental evaluation of duration modelling techniques for automatic speech recognition. In: <italic toggle="yes">ICASSP ’87. IEEE International Conference on Acoustics, Speech, and Signal Processing, Dallas, TX, USA</italic>, Vol. 12, New York, NY, USA: IEEE (Institute of Electrical and Electronics Engineers) <year>1987</year>, <fpage>2376</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btae178-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Steensel</surname><given-names>B. V</given-names></string-name>, <string-name><surname>Belmont</surname><given-names>AS.</given-names></string-name></person-group><article-title>Lamina-Associated domains: links with chromosome architecture, heterochromatin, and gene repression</article-title>. <source>Cell</source><year>2017</year>;<volume>169</volume>:<fpage>780</fpage>–<lpage>91</lpage>.<pub-id pub-id-type="pmid">28525751</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
