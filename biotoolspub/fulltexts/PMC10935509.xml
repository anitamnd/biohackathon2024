<?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName art560.dtd?>
<?SourceDTD.Version 5.6.0?>
<?ConverterInfo.XSLTName elsevier2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin publisher?>
<?FILEmeta_PATTER100915 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEgr3 jpg ?>
<?FILEgr4 jpg ?>
<?FILEgr5 jpg ?>
<?FILEfx1 jpg ?>
<?FILEmmc1 pdf ?>
<?FILEmmc2 pdf ?>
<?FILEsi1 gif ?>
<?FILEsi2 gif ?>
<?FILEsi3 gif ?>
<?FILEsi4 gif ?>
<?FILEsi5 gif ?>
<?FILEsi6 gif ?>
<?FILEsi7 gif ?>
<?FILEsi8 gif ?>
<?FILEsi9 gif ?>
<?FILEsi10 gif ?>
<?FILEsi11 gif ?>
<?FILEsi12 gif ?>
<?FILEsi13 gif ?>
<?FILEsi14 gif ?>
<?FILEsi15 gif ?>
<?FILEsi16 gif ?>
<?FILEsi17 gif ?>
<?FILEsi18 gif ?>
<?FILEsi19 gif ?>
<?FILEsi20 gif ?>
<?FILEsi21 gif ?>
<?FILEsi22 gif ?>
<?FILEsi23 gif ?>
<?FILEsi24 gif ?>
<?FILEsi25 gif ?>
<?FILEsi26 gif ?>
<?FILEsi27 gif ?>
<?FILEsi28 gif ?>
<?FILEsi29 gif ?>
<?FILEsi30 gif ?>
<?FILEsi31 gif ?>
<?FILEsi32 gif ?>
<?FILEsi33 gif ?>
<?FILEsi34 gif ?>
<?FILEsi35 gif ?>
<?FILEsi36 gif ?>
<?FILEsi37 gif ?>
<?FILEsi38 gif ?>
<?FILEsi39 gif ?>
<?FILEsi40 gif ?>
<?FILEsi41 gif ?>
<?FILEsi42 gif ?>
<?FILEsi43 gif ?>
<?FILEsi44 gif ?>
<?FILEsi45 gif ?>
<?FILEsi46 gif ?>
<?FILEsi47 gif ?>
<?FILEsi48 gif ?>
<?FILEsi49 gif ?>
<?FILEsi50 gif ?>
<?FILEsi51 gif ?>
<?FILEsi52 gif ?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Patterns (N Y)</journal-id>
    <journal-id journal-id-type="iso-abbrev">Patterns (N Y)</journal-id>
    <journal-title-group>
      <journal-title>Patterns</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2666-3899</issn>
    <publisher>
      <publisher-name>Elsevier</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10935509</article-id>
    <article-id pub-id-type="pii">S2666-3899(23)00324-0</article-id>
    <article-id pub-id-type="doi">10.1016/j.patter.2023.100915</article-id>
    <article-id pub-id-type="publisher-id">100915</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Spaco: A comprehensive tool for coloring spatial data at single-cell resolution</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="au1">
        <name>
          <surname>Jing</surname>
          <given-names>Zehua</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au2">
        <name>
          <surname>Zhu</surname>
          <given-names>Qianhua</given-names>
        </name>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au3">
        <name>
          <surname>Li</surname>
          <given-names>Linxuan</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au4">
        <name>
          <surname>Xie</surname>
          <given-names>Yue</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au5">
        <name>
          <surname>Wu</surname>
          <given-names>Xinchao</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff5" ref-type="aff">5</xref>
      </contrib>
      <contrib contrib-type="author" id="au6">
        <name>
          <surname>Fang</surname>
          <given-names>Qi</given-names>
        </name>
        <xref rid="aff4" ref-type="aff">4</xref>
      </contrib>
      <contrib contrib-type="author" id="au7">
        <name>
          <surname>Yang</surname>
          <given-names>Bolin</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff3" ref-type="aff">3</xref>
      </contrib>
      <contrib contrib-type="author" id="au8">
        <name>
          <surname>Dai</surname>
          <given-names>Baojun</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff5" ref-type="aff">5</xref>
      </contrib>
      <contrib contrib-type="author" id="au9">
        <name>
          <surname>Xu</surname>
          <given-names>Xun</given-names>
        </name>
        <email>xuxun@genomics.cn</email>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff2" ref-type="aff">2</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="cor1" ref-type="corresp">∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au10">
        <name>
          <surname>Pan</surname>
          <given-names>Hailin</given-names>
        </name>
        <email>panhailin@genomics.cn</email>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="cor2" ref-type="corresp">∗∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au11">
        <name>
          <surname>Bai</surname>
          <given-names>Yinqi</given-names>
        </name>
        <email>baiyinqi@genomics.cn</email>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn2" ref-type="fn">7</xref>
        <xref rid="cor3" ref-type="corresp">∗∗∗</xref>
      </contrib>
      <aff id="aff1"><label>1</label>College of Life Sciences, University of Chinese Academy of Sciences, Beijing 100049, China</aff>
      <aff id="aff2"><label>2</label>Guangdong Provincial Key Laboratory of Genome Read and Write, BGI Research, Shenzhen 518083, China</aff>
      <aff id="aff3"><label>3</label>BGI Research, Hangzhou 310012, China</aff>
      <aff id="aff4"><label>4</label>BGI Research, Shenzhen 518083, China</aff>
      <aff id="aff5"><label>5</label>School of Life Sciences, Southern University of Science and Technology, Shenzhen 518055, China</aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>∗</label>Corresponding author <email>xuxun@genomics.cn</email></corresp>
      <corresp id="cor2"><label>∗∗</label>Corresponding author <email>panhailin@genomics.cn</email></corresp>
      <corresp id="cor3"><label>∗∗∗</label>Corresponding author <email>baiyinqi@genomics.cn</email></corresp>
      <fn id="fn1">
        <label>6</label>
        <p id="ntpara0010">These authors contributed equally</p>
      </fn>
      <fn id="fn2">
        <label>7</label>
        <p id="ntpara0015">Lead contact</p>
      </fn>
    </author-notes>
    <pub-date pub-type="pmc-release">
      <day>16</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.-->
    <pub-date pub-type="collection">
      <day>08</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>16</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>5</volume>
    <issue>3</issue>
    <elocation-id>100915</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>18</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2023 The Author(s)</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).</license-p>
      </license>
    </permissions>
    <abstract id="abs0010">
      <title>Summary</title>
      <p>Understanding tissue architecture and niche-specific microenvironments in spatially resolved transcriptomics (SRT) requires <italic>in situ</italic> annotation and labeling of cells. Effective spatial visualization of these data demands appropriate colorization of numerous cell types. However, current colorization frameworks often inadequately account for the spatial relationships between cell types. This results in perceptual ambiguity in neighboring cells of biological distinct types, particularly in complex environments such as brain or tumor. To address this, we introduce Spaco, a potent tool for spatially aware colorization. Spaco utilizes the Degree of Interlacement metric to construct a weighted graph that evaluates the spatial relationships among different cell types, refining color assignments. Furthermore, Spaco incorporates an adaptive palette selection approach to amplify chromatic distinctions. When benchmarked on four diverse datasets, Spaco outperforms existing solutions, capturing complex spatial relationships and boosting visual clarity. Spaco ensures broad accessibility by accommodating color vision deficiency and offering open-accessible code in both Python and R.</p>
    </abstract>
    <abstract abstract-type="graphical" id="abs0015">
      <title>Graphical abstract</title>
      <fig id="undfig1" position="anchor">
        <graphic xlink:href="fx1"/>
      </fig>
    </abstract>
    <abstract abstract-type="author-highlights" id="abs0020">
      <title>Highlights</title>
      <p>
        <list list-type="simple" id="ulist0010">
          <list-item id="u0010">
            <label>•</label>
            <p id="p0010">This study underscores the importance of coloring in scientific data visualization</p>
          </list-item>
          <list-item id="u0015">
            <label>•</label>
            <p id="p0015">Authors developed a spatially aware colorization method</p>
          </list-item>
          <list-item id="u0020">
            <label>•</label>
            <p id="p0020">The method proposed a spatial metric modeling the topology among various categories</p>
          </list-item>
          <list-item id="u0025">
            <label>•</label>
            <p id="p0025">Broad accessibility of the method for both full-color vision and colorblind users</p>
          </list-item>
        </list>
      </p>
    </abstract>
    <abstract abstract-type="editor-highlights" id="abs0025">
      <title>The bigger picture</title>
      <p>Data visualization has become an indispensable step in exploring, interpreting, and deriving insights from large-scale analyses. The use of contrastive colorization to visualize categorical labels can significantly enhance visual perception and aid in uncovering underlying patterns. However, when dealing with spatially resolved data, traditional palettes and lexicographical color-category mappings often result in neighboring categories displaying similar colors, thereby making visual differentiation more difficult. To effectively visualize spatial data, colorization methods must consider the positioning of the data points. Spaco is a space-aware colorization method that can be used across research domains to deal with spatial datasets. This software incorporates a new metric that considers the intricate topology of categorical spatial data and is accessible for both full-color and colorblind users.</p>
    </abstract>
    <abstract abstract-type="teaser" id="abs0030">
      <p>The basic idea to visualize categorical data is to select unique colors for each category and use them to plot labeled data points. However, current colorization strategies often lead to biased visual perception. Jing et al. developed a software to perform spatially aware colorization. The authors proposed a metric to model the neighborship between intricately distributed points and achieved adaptive palette generation with optimized color-category mapping. The method can provide enhanced categorical data visualization in diverse research fields.</p>
    </abstract>
    <kwd-group id="kwrds0010">
      <title>Keywords</title>
      <kwd>spatial transcriptomics</kwd>
      <kwd>data visualization</kwd>
      <kwd>tissue topology modeling</kwd>
      <kwd>color palette optimization</kwd>
      <kwd>color vision deficiency support</kwd>
      <kwd>theme color extraction</kwd>
    </kwd-group>
  </article-meta>
  <notes>
    <p id="misc0010">Published: January 16, 2024</p>
  </notes>
</front>
<body>
  <sec id="sec1">
    <title>Introduction</title>
    <p id="p0030">A comprehensive understanding of tissue architecture is rooted in the exploration of anatomical and histological regions, complemented by the study of cell-type spatial organizations. This pursuit has been profoundly advanced by the emergence of spatially resolved transcriptomics (SRT),<xref rid="bib1" ref-type="bibr"><sup>1</sup></xref><sup>,</sup><xref rid="bib2" ref-type="bibr"><sup>2</sup></xref><sup>,</sup><xref rid="bib3" ref-type="bibr"><sup>3</sup></xref><sup>,</sup><xref rid="bib4" ref-type="bibr"><sup>4</sup></xref><sup>,</sup><xref rid="bib5" ref-type="bibr"><sup>5</sup></xref> which has illuminated recent studies in neuroscience,<xref rid="bib6" ref-type="bibr"><sup>6</sup></xref><sup>,</sup><xref rid="bib7" ref-type="bibr"><sup>7</sup></xref> developmental biology,<xref rid="bib8" ref-type="bibr"><sup>8</sup></xref><sup>,</sup><xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and a range of diseases.<xref rid="bib10" ref-type="bibr"><sup>10</sup></xref><sup>,</sup><xref rid="bib11" ref-type="bibr"><sup>11</sup></xref> To visualize and explore these datasets, cells are <italic>in situ</italic> annotated and labeled, creating a cellular cartography where each cell type is distinguished by a unique color.<xref rid="bib12" ref-type="bibr"><sup>12</sup></xref> Therefore, colorization—the process of selecting and assigning colors<xref rid="bib13" ref-type="bibr"><sup>13</sup></xref> to spatially intricately distributed cell clusters—is pivotal to ensure unbiased visual perception and facilitate downstream biological analyses.</p>
    <p id="p0035">Currently, popular data analysis frameworks like Seurat,<xref rid="bib14" ref-type="bibr"><sup>14</sup></xref> Giotto,<xref rid="bib15" ref-type="bibr"><sup>15</sup></xref> Scanpy,<xref rid="bib16" ref-type="bibr"><sup>16</sup></xref> and Squidpy<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref> derive their colorization approaches from widely used data visualization libraries, such as matplotlib<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref> in Python or ggplot2<xref rid="bib19" ref-type="bibr"><sup>19</sup></xref> in R. These methods typically allocate a color palette to cell types either alphabetically or based on descending cell count per type unless a specific order has been manually set. Given that these colorizing principles do not consider the spatial positions of cells, neighboring cells of distinct types often exhibit strikingly similar colors. This becomes particularly challenging for clear visualization in niche-specific microenvironments teeming with multiple cell types, exemplified by brain tissues or tumor niches.</p>
    <p id="p0040">The colorization of cell types for SRT data can be defined as a mathematical problem: given a limited palette, how can we assign more contrasting colors to adjacent cell-type pairs? This poses the challenge of determining the overall proximity of one cell type, which may comprise thousands of cells and is intricately distributed across space, to another. In practice, two cell types might be isolated, adjacent, partially interlaced, or entirely intertwined. However, current public metrics only capture some of these spatial relationships. For instance, the Wasserstein distance<xref rid="bib20" ref-type="bibr"><sup>20</sup></xref> measures the degree of isolation between non-overlapping cell types but lacks sensitivity to various interlaced scenarios. In contrast, the local inverse Simpson’s index<xref rid="bib21" ref-type="bibr"><sup>21</sup></xref> is used to quantify local diversity, determining if cell types are thoroughly intermixed. Palo, a recent palette optimization method,<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> employs the Jaccard index to measure overlaps between the spatial territories of two cell types but shows bias toward spatially sparse cell types.</p>
    <p id="p0045">On the other hand, most existing visualization methods employ pre-set palettes from sources like matplotlib<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref> or colorbrewer.<xref rid="bib23" ref-type="bibr"><sup>23</sup></xref> While these palettes are visually appealing, they eschew high-contrast colors, thereby reducing discernibility. This becomes pressing when coloring high-resolution SRT datasets containing hundreds of cell types. In addition, these palettes did not support color vision deficiency (CVD).<xref rid="bib13" ref-type="bibr"><sup>13</sup></xref></p>
    <p id="p0050">To address these challenges, we developed Spaco, a comprehensive tool tailored for spatially aware colorization of cellular-resolution SRT data. Spaco introduces the Degree of Interlacement (DOI) metric to evaluate the spatial relationship between individual cell-type pairs. Subsequently, a weighted graph, referred to as the cluster interlacement graph (CI-graph), is constructed to globally model these relationships. Using the CI-graph, Spaco facilitates spatially aware cell-color assignment, ensuring that cluster pairs with larger DOIs are visualized in more distinct colors. For enhanced palette discernibility, Spaco introduces an automatic, spatially aware palette selection approach that exploits the embedding of CI-graph vertices to optimally utilize the visible color spectrum. Furthermore, Spaco shows its capabilities to integratively apply these colorization strategies across multiple tissue sections, aiding spatial differential analyses. It can also derive theme color palettes from high-quality images, making it easier to attain aesthetically pleasing, publication-ready colors. Notably, Spaco ensures its broad accessibility by providing CVD support and public distributed codes in both Python and R.</p>
    <p id="p0055">We benchmarked Spaco on four real-world datasets from diverse cellular-resolution SRT assays and tissue types. These datasets include a STARmap mouse brain dataset,<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> a Stereo-seq axolotl brain dataset,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> a sequential fluorescence <italic>in situ</italic> hybridization (seqFISH) mouse embryo dataset,<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and an imaging mass cytometry (IMC) human breast cancer dataset.<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> Our findings illustrate Spaco’s capability to capture a variety of spatial relationships using the DOI metric, produce cell-color assignments with enhanced visual clarity, and curate palettes with hundreds of colors to distinguish fine-grained cell types. Furthermore, Spaco significantly aids downstream biological research, such as detailing intricate anatomical structures and cell co-localization in the mouse brain or highlighting the spatial proliferation of specific cell types in wound-healing axolotls. In summary, our results indicate that Spaco offers superior visual clarity for SRT data visualization compared to existing methodologies.</p>
  </sec>
  <sec id="sec2">
    <title>Results</title>
    <sec id="sec2.1">
      <title>Spaco basics and workflow</title>
      <p id="p0060">Generally, the Spaco colorization process is composed of three primary modules: (1) cell cluster interlacement modeling, (2) color palette selection, and (3) cluster-color assignment (<xref rid="fig1" ref-type="fig">Figure 1</xref>A).<fig id="fig1"><label>Figure 1</label><caption><p>Framework of Spaco for colorization of single-cell-resolution spatial data</p><p>Spaco accepts the coordinates of spatial single cells (or cell centroids) along with the categorical (i.e., cell-type) label of each cell, which can be provided in the widely used AnnData format.<xref rid="bib50" ref-type="bibr"><sup>27</sup></xref> The colorization process consists of three main parts (A). The first part, referred to as cluster interlacement modeling, employs a dual-outlier-free spatial nearest-neighbor algorithm (B) to calculate the Degree of Interlacement (DOI) between cell clusters, forming a cluster interlacement graph (CI-graph). The second part (adaptive palette selection) offers users two modes for color palette selection: a graph-guided algorithm for automatic palette selection based on a previously calculated CI-graph (C) and an image-guided algorithm that extracts an aesthetic theme palette from a user-provided image (D). Once the palette is selected, perceptual differences between all colors are calculated to construct a color difference graph (CD-graph). The final part utilizes a coarse-to-fine stochastic optimization to match the two graphs, resulting in a cluster-color assignment where heavily interlaced clusters are assigned colors with high perceptual differences (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p></caption><graphic xlink:href="gr1"/></fig></p>
      <p id="p0065">In the first module, Spaco accepts a spatial transcriptomic dataset with cell coordinates and corresponding cell-type labels as input. Then, Spaco establishes a DOI metric to form the CI-graph that models the overall topology between clusters, where vertices represent different cell clusters and each edge represents the DOI-assessed spatial relationship between two cell clusters. The DOI is computed via a modified spatial k-nearest neighbor network incorporating a dual-outlier-free strategy, which specifically excludes both spatially sparse cells and cell types in its calculation to enhance the stability (<xref rid="fig1" ref-type="fig">Figure 1</xref>B; see the <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0070">The subsequent module focuses on selecting a discernible color palette and calculating the perceptual differences between selected colors with optional CVD support. In color selection, users have the option to choose from two modes. The first and default mode is to automatically generate colors based on pre-calculated CI-graph (<xref rid="fig1" ref-type="fig">Figure 1</xref>C; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Spaco computes the 3D embedding of the CI-graph vertices using the uniform manifold approximation and projection (UMAP) algorithm.<xref rid="bib27" ref-type="bibr"><sup>28</sup></xref> As these vertex embeddings are expected to retain their relative distances from the original graph, we then scale them to the perceptually uniform CIELab color space,<xref rid="bib28" ref-type="bibr"><sup>29</sup></xref> allowing each vertex to acquire a Lab color. This results in a palette that optimally utilizes the entire color space. The alternative mode does not use spatial information but is designed to facilitate the acquisition of aesthetic colors for publications (<xref rid="fig1" ref-type="fig">Figure 1</xref>D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Given a user-preferred image, Spaco assesses the color frequencies within the image. It then extracts colors iteratively in descending order of these frequencies and updates the frequencies after each iteration to avoid repetitive extraction of similar colors. The iteration stops when the needed number of colors is extracted, forming an initial color palette. The discernibility of the initial palette is further refined using farthest point sampling (FPS).<xref rid="bib29" ref-type="bibr"><sup>30</sup></xref> Both modes allow manual adjustments by users, and the image-palette extraction is supplemented with optional CVD support. After the palette selection, Spaco computes a color difference graph (CD-graph), where the vertices represent the selected colors and the edges denote pairwise perceptual differences with optional CVD simulation (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0075">In the final module, Spaco delegates cluster-color assignments (i.e., pairing) by identifying an optimal match between the CI-graph and the CD-graph (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). A coarse-to-fine stochastic optimization is used to determine these assignments. This graph-matching process aims to find an optimal correspondence (i.e., one-to-one relationship) between the vertices of the CI-graph and those of the CD-graph such that the differences between the edges of the two graphs are minimized. Spaco interprets the correspondence between the CI-graph and CD-graph vertices as an optimized color assignment for cell clusters. The minimized difference between the corresponding edges of the CI- and CD-graphs ensures that clusters with larger DOIs are paired with more distinct colors.</p>
    </sec>
    <sec id="sec2.2">
      <title>Evaluation and benchmarking of DOI metric</title>
      <p id="p0080">Measuring the spatial relationships of cell clusters is fundamental to spatially aware colorization. To assess DOI’s capability in measuring interlacement, we first tested it on simulated data. We generated 10 sets of 2D points, with each set simulating the spatial coordinates of a unique cell cluster (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>A and S1B; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). These clusters were arranged to represent five typical types of spatial relationships: completely mixed, partially interlaced, adjacent, isolated, and distantly isolated (<xref rid="fig2" ref-type="fig">Figure 2</xref>A). Notably, the primary goal of colorization is to enhance the visual distinction among mixed, overlapped, or adjacent clusters. Therefore, we examined the DOI’s capability to differentiate these three scenarios from the other two (isolated and distant). We benchmarked it against three typical types of spatial relationship metrics: distance-based metrics, entropy-based metrics, and spatial-coverage-based metrics. These were exemplified by the Wasserstein distance, the local inverse Simpson’s index (LISI), and the 2D kernel density estimation-Jaccard index (2D KDE), respectively.<fig id="fig2"><label>Figure 2</label><caption><p>Benchmarking the DOI metric using simulated data</p><p>(A) Illustration of five typical spatial relationships observed in cellular SRT data. Colored sidebars highlight the occurrence of these relationships in UMAP-like (single-cell transcriptomic) visualizations, low-resolution SRT, and cellular-resolution SRT data.</p><p>(B) Min-max normalized scores for five differently distributed cluster pairs in the simulation data, evaluated using various metrics (top), accompanied by a visualization detailing the spatial distribution of each cluster pair (bottom).</p><p>(C) Parallel to (B) but for cluster pairs simulated with a sparse constraint (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p></caption><graphic xlink:href="gr2"/></fig></p>
      <p id="p0085">When cells display a dense or continuous distribution, all metrics recorded the highest scores for the mixed cluster pair and the lowest for the distantly isolated pair (<xref rid="fig2" ref-type="fig">Figure 2</xref>B). However, the Wasserstein distance showed a significant difference between the isolated pair and the distantly isolated pair due to its sensitivity to spatial distance. The 2D KDE scored zero for all three non-overlapping pairs, failing to identify the adjacent pair. Both the DOI and LISI successfully distinguished the two isolated cases from the non-isolated ones, serving as appropriate spatial relation metrics to indicate the necessity for distinct colors.</p>
      <p id="p0090">On the other hand, within a real tissue context, certain cell types, such as immunocytes, may display a relatively sparse distribution compared to others. While these cells typically do not dominate the global visualization of an SRT section, they play a crucial role in the biological exploration of cellular niches (e.g., the tumor-immune microenvironments). The DOI metric captured the neighborship (whether mixed, overlapped, or adjacent) of these sparse cluster pairs with relatively low scores. In contrast, other metrics did not demonstrate significant sensitivity to cell sparsity (<xref rid="fig2" ref-type="fig">Figures 2</xref>C, <xref rid="mmc1" ref-type="supplementary-material">S1</xref>C, and S1D). This suggests that the dual-outlier-free strategy employed in the DOI calculation can prevent sparse clusters from having a disproportionate impact during the colorization process.</p>
      <p id="p0095">The robustness of the DOI in response to varying cell sparsity was further illustrated using a public STARmap mouse brain dataset.<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> We presented the cluster pairs with the top three highest scores across all metrics (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>E and S1H). The DOI identified the mixture of inhibitory and excitatory neurons, the partial interlacement between astrocytes and neurons, and the adjacency between the cortex and fiber tract. These observations align with widely discussed topics in cell co-location and brain structure studies<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> (<xref rid="mmc1" ref-type="supplementary-material">Figure S1</xref>E). The Wasserstein distance and LISI seemed to favor cell types with globally similar distributions (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>F and S1G). While these globally sparsely distributed cells might have significant roles in brain functions, their spatial relationships offer limited insight into tissue heterogeneity. The 2D KDE echoed the DOI by emphasizing the mixed neuron subtypes in the cortex (<xref rid="mmc1" ref-type="supplementary-material">Figure S1</xref>H). However, it overestimated the spatial neighborship of sparsely co-located cell types, as its kernel density estimation had a tendency to exaggerate the spatial coverage of sparsely distributed cells.</p>
      <p id="p0100">Collectively, these results demonstrate the DOI’s capability to capture spatial neighborships with biological significance and to serve as a proper metric to constrain the colorization of SRT data.</p>
    </sec>
    <sec id="sec2.3">
      <title>Spaco facilitates the exploration of anatomic structure and cell heterogeneity</title>
      <p id="p0105">Next, we evaluated Spaco’s cell-color assignment method. In high-definition spatial transcriptomics, effective colorization should cater to both a global overview within a large field of view (FOV) and detailed perspectives of micro-FOVs. This dual capacity is biologically relevant for studying anatomical tissue structures and discerning niche heterogeneity. To showcase Spaco’s visualization proficiencies in these contexts, we applied our method to the STARmap mouse brain dataset,<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> which includes 23 pre-annotated cell clusters. These clusters display either spatially dispersed or aggregated distributions, offering a comprehensive assessment of Spaco’s color assignment algorithm (<xref rid="fig3" ref-type="fig">Figure 3</xref>A).<fig id="fig3"><label>Figure 3</label><caption><p>Benchmarking Spaco color assignment on STARmap mouse brain data</p><p>(A) Color assignment of 23 brain-related cell subtypes using Spaco, Spaco’s general-CVD-support mode, Scanpy (matplotlib), random shuffling, and Palo. All methods shared the same color palette generated from Scanpy (matplotlib) by default.</p><p>(B) Anatomical reference from the Allen Brain Atlas<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> corresponding to the STARmap mouse brain section (left) and neighborship between cell clusters that are enriched in one of the brain areas determined according to the anatomical map (right). The vertices of the graph are colored the same as in (A).</p><p>(C) Benchmarking of anatomical visualization in Spaco against other methods. Scatters represent the color difference (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>) between anatomically adjacent cluster pairs determined in (B).</p><p>(D) Same as (C) but for Spaco’s general-CVD-support mode.</p><p>(E) Gridded fields of view (FOVs) of the mouse brain section with 500 × 500 μm each.</p><p>(F) Benchmarking of cellular visualization in Spaco against other methods. Scatters represent the mean cell-cell color difference within each FOV in (E).</p><p>(G) Spaco visualization of the two FOVs with the highest color difference.</p></caption><graphic xlink:href="gr3"/></fig></p>
      <p id="p0110">We compared Spaco’s result with those of Scanpy<xref rid="bib16" ref-type="bibr"><sup>16</sup></xref> (utilizing the default matplotlib visualization), random-shuffled assignment, and Palo<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> (<xref rid="fig3" ref-type="fig">Figure 3</xref>A), all using the same color palette. To benchmark performance based on brain anatomical features, we identified 10 anatomic-region-localized cell clusters (predominant in one anatomic region) after mapping cell types to the Allen Brain Atlas,<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> yielding 17 spatially adjacent cluster pairs (<xref rid="fig3" ref-type="fig">Figure 3</xref>B). Our analysis revealed that Spaco achieved significant visual differences between these anatomically adjacent pairs, as determined by one-sided Wilcoxon tests (no-CVD-support mode, p = 1.45e−4, 2.32e−3, and 4.51e−3 when compared to Scanpy, random assignments, and Palo, respectively) (<xref rid="fig3" ref-type="fig">Figures 3</xref>C and 3D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Additionally, we distributed a questionnaire to experts, comprising 19 neurologists and 34 bioinformaticians, asking them to grade each colorization outcome on a scale of 1–10 based on their professional experience. This survey further underscored the superior visual effectiveness of Spaco’s colorization approach (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>A; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0115">On the other hand, exploring microenvironment heterogeneity requires the zoomed-in visualization of cellular niches. To simulate such scenarios, we arbitrarily divided the data into micro-FOVs measuring 500 × 500 μm each and scored the discernibility of each FOV based on the mean of pairwise color differences among all present cells (<xref rid="fig3" ref-type="fig">Figure 3</xref>E; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). The overall discernibility scores across all FOVs were significantly higher in Spaco’s visualizations, as shown by one-sided Wilcoxon tests (no-CVD-support mode, p = 8.42e−21, 9.16e−19, and 8.87e−21 when compared to Scanpy, random assignments, and Palo, respectively) (<xref rid="fig3" ref-type="fig">Figures 3</xref>F and <xref rid="mmc1" ref-type="supplementary-material">S2</xref>B). FOVs with the highest discernibility scores in Spaco highlighted the co-localization of various neuron subtypes, such as glutamatergic (excitatory), GABAergic (inhibitory), and peptidergic neurons, around the amygdalar area (<xref rid="fig3" ref-type="fig">Figures 3</xref>G and <xref rid="mmc1" ref-type="supplementary-material">S2</xref>C). In contrast, the FOVs with the lowest scores were typically situated at tissue boundaries or contained fewer clusters, indicating that they were less valuable for analyzing cellular heterogeneity (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>D).</p>
      <p id="p0120">Additionally, we sought to determine whether our CI-graph and DOIs contributed to Spaco’s enhanced performance. A notable correlation between DOI scores and color differences (linear regression R-square = 0.45, p = 4e−61) indicated that the subsequent optimization effectively utilized the DOI in Spaco’s color-mapping process (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>E). We further evaluated the time complexity of our algorithm. The colorization process required less than 30 s for simulated datasets encompassing up to 100,000 cells (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>F). Hence, the additional computations do not introduce a substantial time burden.</p>
    </sec>
    <sec id="sec2.4">
      <title>Spaco improves palette discernibility by adaptive color selection</title>
      <p id="p0125">Above, while Spaco effectively enhanced visualization by optimizing the cell-color assignment, its overall performance was still constrained by the discernibility of pre-defined palettes<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref><sup>,</sup><xref rid="bib19" ref-type="bibr"><sup>19</sup></xref><sup>,</sup><xref rid="bib23" ref-type="bibr"><sup>23</sup></xref> (<xref rid="mmc1" ref-type="supplementary-material">Figure S3</xref>A). Therefore, we extended the efficacy of Spaco’s adaptive color selection algorithm to augment palette discernibility and evaluated its two modes of color selection separately (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0130">Firstly, we applied our CI-graph-guided color selection approach to a published Stereo-seq dataset of wound-healing axolotl brain,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> which contains 16 pre-annotated cell types (<xref rid="fig4" ref-type="fig">Figure 4</xref>A). We found that the discernibility of the adaptively generated palette, as quantified by the distribution of pairwise color differences among all palette colors, was significantly higher than that of the pre-defined palette (one-sided Wilcoxon test, p = 1.27e−11) (<xref rid="fig4" ref-type="fig">Figure 4</xref>B). Furthermore, the Spaco-generated palette displayed a bimodal distribution of color differences, suggesting an imbalanced color selection across the color space. This indicates that Spaco adeptly integrated the biases of DOIs in the CI-graph, tailoring color selection to accommodate both distant and adjacent cluster pairs (<xref rid="fig4" ref-type="fig">Figures 4</xref>C and <xref rid="mmc1" ref-type="supplementary-material">S3</xref>B). Analyzing these colors in the CIELab space, we pinpointed three neighboring cell types associated with shades of blue. These colors corresponded to the embedding of spatially distant cell clusters with low DOIs, which are easily distinguishable through subtle color variations (<xref rid="fig4" ref-type="fig">Figure 4</xref>D). Leveraging this, Spaco also effectively crafted a suitable palette for the clear visualization of the STARmap dataset comprising 181 fine-grained cell types (<xref rid="mmc1" ref-type="supplementary-material">Figure S3</xref>C). In contrast, matplotlib failed to capture such a plethora of clusters, producing an uncolored plot due to its limited color pre-sets.<fig id="fig4"><label>Figure 4</label><caption><p>Evaluation of adaptive graph-guided and image-guided palette selection in Spaco</p><p>(A) Colorization of 16 cell clusters in the Stereo-seq axolotl brain dataset,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> using palettes generated by Spaco cluster interlacement graph embedding (left) and Scanpy’s default palette (right).</p><p>(B) Distribution of pairwise color differences within the Spaco-generated palette in (A), compared to Scanpy’s default palette.</p><p>(C) Visualization of the colors from the Spaco-generated palette in the 2D CIELab space (channels a and b).</p><p>(D) Spatial distributions of cell clusters that are highlighted in (C).</p><p>(E) Public journal cover image used to create the image-guided palette (sourced from <italic>Cell</italic>, March 08, 2018, volume 172, issue 6).</p><p>(F) Colors and their frequencies derived from the reference image in (E).</p><p>(G) Colorization of 16 cell clusters in the Stereo-seq axolotl brain dataset using the palette extracted from the image in (E).</p><p>(H) Same as (G) but using Spaco’s general-CVD-support mode.</p><p>(I) Pairwise color differences within the palette extracted from the image compared to Scanpy’s default palette.</p></caption><graphic xlink:href="gr4"/></fig></p>
      <p id="p0135">While maximizing color differences can enhance daily data visualization, researchers occasionally prefer to adopt coloring themes from prior publications or presentations. Spaco supports this requirement with its image-guided palette extraction mode (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). We illustrated this process using a public journal cover image as shown in <xref rid="fig4" ref-type="fig">Figure 4</xref>E. The extracted colors, and their subsequent application to the axolotl dataset, showed comparable discernibility to a pre-defined color palette (tab20 in matplotlib colormap) (Wilcoxon test, p = 1.20e−11) (<xref rid="fig4" ref-type="fig">Figures 4</xref>F–4I). Importantly, this was achieved while preserving the thematic consistency of the original image.</p>
      <p id="p0140">These results underscore Spaco’s capability to navigate the confines of the limited visible color space, achieving superior perceptual discernibility in both daily and publication scenarios.</p>
    </sec>
    <sec id="sec2.5">
      <title>Spaco integratively colors cell clusters across multiple SRT sections</title>
      <p id="p0145">A subsequent challenge in SRT data analysis lies in discerning variations in spatial cell distribution across diverse biological samples. This requires the visualization of multiple tissue sections using a uniform palette and color assignment scheme. To address this, Spaco has been enhanced with a feature that facilitates integrative colorization by seamlessly merging CI-graphs (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0150">We applied Spaco to a time-series study of axolotl brain regeneration.<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> The optimized visualization highlighted an increase in Sfrp+ ependymoglial cells (sfrpEGCs) during the wound-healing progression from 10 days post-injury (DPI-10) to DPI-15. This increase was difficult to detect using Scanpy’s default visualization due to challenges from incorrectly matching telencephalon neuroblasts (TLNBLs) at DPI-10 with sfrpEGCs at DPI-15 (<xref rid="fig5" ref-type="fig">Figures 5</xref>A–5C).<fig id="fig5"><label>Figure 5</label><caption><p>Integrative colorization across multiple plots by Spaco</p><p>(A) Scanpy colorization of two Stereo-seq axolotl datasets (days post-injury 10 and 15), with separate color assignment by default.</p><p>(B) Spaco colorization of the Stereo-seq axolotl datasets using integrative color assignment and sharing the same palette as the Scanpy default plots.</p><p>(C) Highlighted spatial distribution of telencephalon neuroblasts (TLNBLs) and Sfrp+ ependymoglial cells (sfrpEGCs) in (B).</p><p>(D) Cluster-wise intersection over union (IoU) score between two Louvain clustering results; top IoU scores are labeled. Blue digits represent the final correspondences derived using Spaco’s greedy strategy (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p><p>(E) Scanpy colorization of two different Louvain clustering results of DPI-10 dataset, using separate color assignments by default. Red arrow highlights the TLNBL cell cluster.</p><p>(F) Spaco colorization of the two different Louvain clustering results of DPI-10 dataset, using aligned cluster label from (D) and an integrative color assignment and palette selection based on the cluster interlacement graph. Red arrow highlights the TLNBL cell cluster.</p></caption><graphic xlink:href="gr5"/></fig></p>
      <p id="p0155">Additionally, we employed a method to streamline the tuning process in clustering analysis. This approach involved comparing clustering outcomes generated using different parameters. By computing Jaccard indices and employing a greedy matching algorithm, we established correspondences between clusters (<xref rid="fig5" ref-type="fig">Figure 5</xref>D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Contrary to Louvain’s default colorization method, which entirely altered the colors between the two rounds clustering of the same dataset (<xref rid="fig5" ref-type="fig">Figure 5</xref>E), Spaco retained the colors for the cell types annotated in the first round. It then suitably designated colors to newly emerged cell subtypes <italic>in situ</italic>. This directly distinguished WNT+ EGCs (wntEGCs) from TLNBLs in the ventricular zone, aiding biologists in further studying the dynamics of EGCs and the locally newly generated neurons (medial pallium excitatory neuron [mpEX]) during axolotl brain regeneration (<xref rid="fig5" ref-type="fig">Figure 5</xref>F).</p>
    </sec>
    <sec id="sec2.6">
      <title>Spaco is applicable to diverse technologies and tissue types</title>
      <p id="p0160">We extended our testing of Spaco to a seqFISH mouse embryo dataset<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and an IMC human breast cancer dataset.<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> We sourced the color palettes for both datasets from the online tutorial of the Squidpy package.<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref> The optimized color assignment and autogenerated palette by Spaco demonstrated superior visual clarity compared to other methods (<xref rid="mmc1" ref-type="supplementary-material">Figures S4</xref>A and S4B). In the IMC dataset, Spaco’s color assignment aligned with the manual assignment from the Squidpy tutorial, notably mapping cyan to the predominant apoptotic tumor cells. Furthermore, it excelled in differentiating between apoptotic and basal cytokeratins (CK) tumor cells located in the bottom right of the section (<xref rid="mmc1" ref-type="supplementary-material">Figure S4</xref>B).</p>
    </sec>
    <sec id="sec2.7">
      <title>Spaco ensures broad accessibility by supporting diverse userships</title>
      <p id="p0165">As a color-based visualization method, Spaco was designed to adapt to various situations of CVD. Using an LMS (long, medium, short) space-based color conversion method,<xref rid="bib31" ref-type="bibr"><sup>32</sup></xref> Spaco was capable of simulating perceptual colors as perceived by individuals with CVD and modifying color difference calculations (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>) to simultaneously consider three common types of CVD conditions: protanopia, deuteranopia, and tritanopia.</p>
      <p id="p0170">We integrated and tested this feature for both Spaco’s color assignment (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>A–S5D) and its image-guided palette extraction approach (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>E–S5H) on the STARmap mouse brain dataset and the Stereo-seq axolotl dataset, respectively. We excluded our graph-embedding color selection from being CVD friendly due to the absence of a continuous, perceptually uniform CVD color space for UMAP embedding. Notably, Spaco’s CVD-friendly colorization achieved improved discernibility compared visually to Scanpy’s default colorization, not only in all three simulated CVD conditions (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>B, S5D, and S5H) but also in full-color perception (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>A, S5C, and S5G). This is important for ensuring broad readability of Spaco’s visualization for diverse audiences in publications. In addition, Spaco also gives the option to perform CVD-friendly colorization under one given type of CVD, which intends to provide even better support for users with that CVD type in their daily work.</p>
      <p id="p0175">Another key aspect of our approach is to support user communities of both Python and R, the two predominant programming languages in the fields of single-cell and spatial omics. We have made available scripts related to all benchmarking experiments, which are particularly beneficial for users of Python and Scanpy. For the R community, we have constructed a tutorial that demonstrates the combined use of Spaco and Seurat, as illustrated in <xref rid="mmc1" ref-type="supplementary-material">Figure S6</xref>. All of these code resources are available in open-access repositories, as detailed in the <xref rid="sec4.1.3" ref-type="sec">data and code availability</xref> section.</p>
    </sec>
  </sec>
  <sec id="sec3">
    <title>Discussion</title>
    <p id="p0180">On one single spatial transcriptomics chip, millions of cells and hundreds of cell-type clusters organize in spatially structured arrangements. It is conceivable that the cell types can be either isolated, neighbored, partially interlaced, or completely mixed in a tissue, orchestrating the diverse microenvironmental niches. We therefore developed Spaco, an automatic palette selection and colorization tool, to solve this newly emerged data visualization problem. With Spaco, experienced biologists, anatomists, and pathologists can identify the pivotal cell clusters and quickly zoom in on the candidate biological interests based on their spatial characteristics, given their prior knowledge of tissue configuration.</p>
    <p id="p0185">As Spaco is a graph-based method, it possesses many computational applications rooted in graph structure, surpassing existing coloring algorithms. Notably, the identification of an appropriate edge metric to characterize the graph is in the first priority. To develop the DOI metric, we utilized the spatial k-nearest neighbor graph in the local neighborhoods of each cell, which serves as a discrete spatial kernel. Consequently, DOI is able to model the interlacement between spatially scattered cells in cellular SRT data rather than continuous domains in low-resolution SRTs. On the other hand, leveraging the interlacement graphs, Spaco offers the potential to assess variations in tissue topology across different sections by identifying changes in edges (i.e., DOIs). This capability could further facilitate the discovery of topologically conservative or variable cell types over timescales. These functionalities are not available in any other publicly available packages.</p>
    <p id="p0190">While Spaco effectively employs distinct colors to visualize the spatial organization of cell types for biological insights, other studies, such as Baysor<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref> and Bento,<xref rid="bib33" ref-type="bibr"><sup>34</sup></xref> harness the color space for segmenting cells or even subcellular domains in spatial transcriptomic data analyses. The idea of utilizing color-based analyses to explore a variety of biological features is compelling. Another notable example is DeepVariant,<xref rid="bib34" ref-type="bibr"><sup>35</sup></xref> which introduced an approach where sequencing reads are encoded into RGB-colored images to enhance variant-calling accuracy. Though the majority of color space applications currently focus on data visualization, our attempts at downstream color-based graph analysis underscore the potential of adapting color-centric algorithms for broader biological research.</p>
    <p id="p0195">One major limitation of Spaco is its enforcement of a correspondence between color differences and the spatial distribution of cells. However, there might be scenarios where users wish to use similar colors for cell subtypes, regardless of their spatial relationships, or they might want to specify colors for certain cell types to align with existing literature. To address these situations, Spaco offers an option allowing users to manually fix or adjust colors for user-specified cell types and then optimize the color differences for the remaining cell types. Second, the visual contrast that can be obtained through color space is limited when performing CVD-supporting colorization or in the case of coloring hundreds of clusters. It would be helpful to exploit fine-designed CVD-supporting palettes<xref rid="bib35" ref-type="bibr"><sup>36</sup></xref><sup>,</sup><xref rid="bib36" ref-type="bibr"><sup>37</sup></xref> and more rich-formatted techniques like interactive plots and virtual reality. On a different note, while Spaco’s algorithm is theoretically adept at processing 3D data, fine-tuning of parameters is crucial to differentiate “sparse” from “dense” cell types for efficient 3D colorization.</p>
    <p id="p0200">Spaco is implemented in Python using a modularized architecture to seamlessly integrate into a variety of analytical platforms and to incorporate emerging deep-learning-based clustering methods. This approach also facilitates community contributions, extension of new functions, and even the separation of program functions to support individual scripts. As spatial technologies continue to evolve, potentially becoming the primary method for characterizing the molecular profiles of cells, we anticipate that Spaco will become an indispensable tool for researchers across a broad range of biological fields.</p>
  </sec>
  <sec id="sec4">
    <title>Experimental procedures</title>
    <sec id="sec4.1">
      <title>Resource availability</title>
      <sec id="sec4.1.1">
        <title>Lead contact</title>
        <p id="p0205">Further information and requests for resources and reagents should be directed to and will be fulfilled by the lead contact, Yinqi Bai (<email>baiyinqi@genomics.cn</email>).</p>
      </sec>
      <sec id="sec4.1.2">
        <title>Materials availability</title>
        <p id="p0210">This study did not generate new unique materials.</p>
      </sec>
      <sec sec-type="data-availability" id="sec4.1.3">
        <title>Data and code availability</title>
        <p id="p0215">All datasets are public and available for download from their original publications, which are listed as follows.<list list-type="simple" id="olist0010"><list-item id="o0010"><label>(1)</label><p id="p0220">The adult mouse brain STARmap dataset<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1830/" id="intref0015">https://singlecell.broadinstitute.org/single_cell/study/SCP1830/</ext-link>.</p></list-item><list-item id="o0015"><label>(2)</label><p id="p0225">The wound-healing axolotl Stereo-seq datasets<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://db.cngb.org/stomics/artista/download" id="intref0020">https://db.cngb.org/stomics/artista/download</ext-link>.</p></list-item><list-item id="o0020"><label>(3)</label><p id="p0230">The mouse embryo seqFISH dataset<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://marionilab.cruk.cam.ac.uk/SpatialMouseAtlas/" id="intref0025">https://marionilab.cruk.cam.ac.uk/SpatialMouseAtlas/</ext-link>.</p></list-item><list-item id="o0025"><label>(4)</label><p id="p0235">The breast cancer IMC datasets<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.3518284" id="intref0030">https://doi.org/10.5281/zenodo.3518284</ext-link>.</p></list-item></list></p>
        <p id="p0240">Spaco is an open source, collaborative Python package available at Zenodo (<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.10113347" id="intref0035">https://zenodo.org/doi/10.5281/zenodo.10113347</ext-link>)<xref rid="bib37" ref-type="bibr"><sup>38</sup></xref> and also at the GitHub repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco" id="intref0040">https://github.com/BrainStOrmics/Spaco</ext-link>). The scripts to reproduce Spaco’s results and figures are available at <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.10113359" id="intref0045">https://zenodo.org/doi/10.5281/zenodo.10113359</ext-link><xref rid="bib38" ref-type="bibr"><sup>39</sup></xref> and <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco_scripts" id="intref0050">https://github.com/BrainStOrmics/Spaco_scripts</ext-link>. For combinatorial use of Spaco with R, see <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/SpacoR" id="intref0055">https://github.com/BrainStOrmics/SpacoR</ext-link>.</p>
      </sec>
    </sec>
    <sec id="sec4.2">
      <title>Modeling spatial interlacement of clusters</title>
      <sec id="sec4.2.1">
        <title>Design of DOI</title>
        <p id="p0245">To characterize the spatial differentiation between clusters, we assess the interlacement of the cells within each cluster. One of the main challenges in calculating spatial interlacement by estimating cluster overlap in single-cell resolution spatial data arises when cells are sparsely distributed, resulting in variable density within the tissue section. This can lead to an overestimation of the spatial coverage of clusters.</p>
        <p id="p0250">To circumvent the risk of inferring incorrect interlacement relationships from such instances, we employ the k-dimensional tree algorithm to calculate k-nearest neighbors for all cells, with k defaulting to 30. This method draws inspiration from domain identification algorithms that utilize spatial neighbors.<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref><sup>,</sup><xref rid="bib39" ref-type="bibr"><sup>40</sup></xref><sup>,</sup><xref rid="bib40" ref-type="bibr"><sup>41</sup></xref></p>
        <p id="p0255">Additionally, we apply a dual-outlier-free strategy to refine this k-nearest neighbor calculation. The term “dual” pertains to two distinct outlier cell categories.<list list-type="simple" id="olist0015"><list-item id="o0030"><label>(1)</label><p id="p0260">The “sparse-type” outlier, characterized by having fewer than <italic>k</italic> cells within a specified radius <italic>r</italic>. This suggests that the cell occupies a sparsely populated region of the tissue.</p></list-item><list-item id="o0035"><label>(2)</label><p id="p0265">The “orphan-type” outlier, which lacks (or has fewer than a designated number n) cells of its cluster within its neighboring cells. This indicates that the cell might be isolated from the primary group of the cluster or that the cluster itself may have a sparse spatial configuration.</p></list-item></list></p>
        <p id="p0270">For sparse types, Spaco retains only the closest neighbors within the radius <italic>r</italic> (defaulting to 50 μm) to prevent incorrect associations with distant cells. For orphan types, we omit the orphan cells from the neighbor calculations, ensuring we do not overestimate the spatial coverage and interlacement of clusters.</p>
        <p id="p0275">Following these steps, the spatial interlacement is determined pairwise for all clusters using the refined cell-cell neighbor relationships. Let x and y denote the labels (indices) of two distinct clusters. We define the interlacement score between them, <inline-formula><mml:math id="M1" altimg="si1.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>, as<disp-formula id="ufd1"><mml:math id="M2" altimg="si2.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub><mml:mo linebreak="badbreak">=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M3" altimg="si3.gif"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denote the cells in clusters x and y, respectively, and <inline-formula><mml:math id="M4" altimg="si4.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">|</mml:mo></mml:mrow></mml:math></inline-formula> denotes the number of nearest neighbors of cell <inline-formula><mml:math id="M5" altimg="si5.gif"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="M6" altimg="si6.gif"><mml:mrow><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the Euclidean distance between cells <inline-formula><mml:math id="M7" altimg="si7.gif"><mml:mrow><mml:mi>i</mml:mi><mml:mspace width="0.5em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> under the given spatial coordinates.</p>
      </sec>
      <sec id="sec4.2.2">
        <title>Constructing CI-graph</title>
        <p id="p0280">Basically, the interlacement score models the mean inversed distance between the neighboring cells of two clusters. Calculated scores are used to construct a weighted CI-graph, where vertices represent each cluster and edges are weighted by the interlacement scores (i.e., DOIs described in the previous part). The adjacency matrix of this graph is symmetrized (converted to undirected graph) by replacing <inline-formula><mml:math id="M8" altimg="si1.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M9" altimg="si8.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>yx</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="M10" altimg="si9.gif"><mml:mrow><mml:mi mathvariant="italic">Max</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mtext>yx</mml:mtext></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for any x and y, and the diagonal is set to zeros in the matrix.</p>
      </sec>
    </sec>
    <sec id="sec4.3">
      <title>Adaptive color palette selection</title>
      <sec id="sec4.3.1">
        <title>Generating palette using graph embedding</title>
        <p id="p0285">Spaco offers adaptive generation of a color palette by embedding the CI-graph into the CIELab color space.<xref rid="bib28" ref-type="bibr"><sup>29</sup></xref> To achieve this, we utilize UMAP<xref rid="bib27" ref-type="bibr"><sup>28</sup></xref> to compute a 3D embedding of all vertices in the CI-graph. In this configuration, less interlaced clusters present as hubs in the CI-graph since the DOIs (i.e., edge weights) among their corresponding vertices are relatively low. Consequently, these hubs are embedded into aggregately distributed points groups in the 3D UMAP space (like the case in <xref rid="fig4" ref-type="fig">Figure 4</xref>D), leading cluster pairs with lower DOIs to closer distances in the embedded space, and vice versa.</p>
        <p id="p0290">Subsequently, these embeddings are rescaled to fit the value range of the CIELab, a perceptually uniform color space where the difference between colors corresponds to the Euclidean distance. A similar method was adopted in previous studies to colorize single-molecule FISH (smFISH) data based on the niche composition of the captured molecules.<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref></p>
        <p id="p0295">In the CIELab color space, the L, a, and b values typically range within <inline-formula><mml:math id="M11" altimg="si10.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>100</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M12" altimg="si11.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>127</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="M13" altimg="si11.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>127</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, respectively. To prevent the generation of colors that are either too dark or too bright, we further limit the illuminant channel L to a range of <inline-formula><mml:math id="M14" altimg="si12.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:mn>85</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> by default. The final step involves converting the Lab values into RGB hex values to suit general applications.</p>
        <p id="p0300">A limitation of using UMAP involves potential distortion in neighborhood and distance.<xref rid="bib41" ref-type="bibr"><sup>42</sup></xref> Nevertheless, this coarse alignment between DOIs and color differences was sufficient for colorization purposes, whose feasibility was proven in Baysor.<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref> The non-linear nature of UMAP also contributes to Spaco’s robustness against outliers (i.e., heavily isolated vertices in CI-graph causing polarized palettes selection). Optional linear embedding methods in Spaco, such as multidimensional scaling (MDS), can be used for outlier-free cases.</p>
        <p id="p0305">Spaco allows the direct utilization of the embedded colors as effective color mapping depending on the coarse correspondence between DOIs and color differences, and it also provides users options for further optimization in the cluster-color assignment, detailed in the final module.</p>
      </sec>
      <sec id="sec4.3.2">
        <title>Image-guided theme palette extraction</title>
        <p id="p0310">Spaco offers an additional feature for adaptive color palette selection: the extraction of theme colors from images, enabling users to oversee the palette selection process by designating preferred images. Drawing inspiration from recent advancements in computational visual media,<xref rid="bib42" ref-type="bibr"><sup>43</sup></xref> for a given image, we summarize the colors of all pixels in a given image under 3D CIELab color space, using a binning size of 20 (by default) on each dimension (channel). This aggregation condenses all raw pixel colors into a potential maximum of 8,000 distinct binned colors, each represented by the centroid color of its respective bin. Colors falling within the L (illumination channel) range of <inline-formula><mml:math id="M15" altimg="si12.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:mn>85</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> by default (considered either too dark or excessively bright), as well as those occurring below the third percentile in frequency (considered non-theme colors), are excluded from further calculation.</p>
        <p id="p0315">The initial palette is progressively assembled from binned colors, selected in descending order of frequency until the desired number of colors is attained. To prevent the selection of similar colors, we update frequencies during the process, employing the following equation<xref rid="bib43" ref-type="bibr"><sup>44</sup></xref>:<disp-formula id="ufd2"><mml:math id="M16" altimg="si13.gif"><mml:mrow><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo linebreak="badbreak">=</mml:mo><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi mathvariant="italic">exp</mml:mi><mml:mspace width="0.25em"/><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M17" altimg="si14.gif"><mml:mrow><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> denotes the frequency of color <inline-formula><mml:math id="M18" altimg="si15.gif"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> after the <inline-formula><mml:math id="M19" altimg="si16.gif"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>-th selection, with <inline-formula><mml:math id="M20" altimg="si17.gif"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> denoting the pulled color. <inline-formula><mml:math id="M21" altimg="si18.gif"><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the CIEDE2000 color difference metric<xref rid="bib44" ref-type="bibr"><sup>45</sup></xref> in default. <inline-formula><mml:math id="M22" altimg="si19.gif"><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> is set to 80 by default.</p>
        <p id="p0320">Once an initial palette is established, we initiate a refinement process for the palette. We iteratively replace each color in the palette using farthest point sampling<xref rid="bib29" ref-type="bibr"><sup>30</sup></xref> (FPS) to maximize the minimum distance between the replaced color and the rest of the palette, ensuring optimal linear separation. In each iteration, <italic>k</italic> (3 by default) colors that are farthest from the rest of the palette are selected. Subsequently, we evaluate the <italic>k</italic> potential replacements using the formula<disp-formula id="ufd3"><mml:math id="M23" altimg="si20.gif"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:msub><mml:mi>f</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>in which <inline-formula><mml:math id="M24" altimg="si21.gif"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the linear separation of color <inline-formula><mml:math id="M25" altimg="si15.gif"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M26" altimg="si22.gif"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the pre-calculated distance in FPS. <inline-formula><mml:math id="M27" altimg="si23.gif"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M28" altimg="si24.gif"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are weights to balance between <inline-formula><mml:math id="M29" altimg="si21.gif"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M30" altimg="si25.gif"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, defaulting to 0.15 and the inverse of 0.03% of the image’s pixel number, respectively. The color with the highest score is then employed to replace the corresponding color in the current palette. The iteration process concludes when the coefficient of variation (CV) for all pairwise distances within the color palette surpasses the CV of edge weights in the CI-graph or when the number of iterations exceeds the pre-defined limit (set to 20 times the palette size by default). Finally, a conversion from Lab values to RGB hex values is executed to facilitate general usage.</p>
      </sec>
    </sec>
    <sec id="sec4.4">
      <title>Graph-based color assignment</title>
      <sec id="sec4.4.1">
        <title>Calculating perceptual differences and constructing CD-graph</title>
        <p id="p0325">Once an adequate color palette is available, we proceed to construct a CD-graph that captures the color relationships within the palette.</p>
        <p id="p0330">We quantify the pairwise differences between colors by employing a well-established weighted metric within the RGB color space<xref rid="bib45" ref-type="bibr"><sup>46</sup></xref>:<disp-formula id="ufd4"><mml:math id="M31" altimg="si26.gif"><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mo linebreak="badbreak">=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo linebreak="badbreak">+</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="ufd5"><mml:math id="M32" altimg="si27.gif"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>C</mml:mi><mml:mo linebreak="badbreak">=</mml:mo><mml:msqrt><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo linebreak="badbreak">+</mml:mo><mml:mfrac><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>256</mml:mn></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo linebreak="badbreak">+</mml:mo><mml:mn>4</mml:mn><mml:mo>Δ</mml:mo><mml:msup><mml:mi>G</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo linebreak="badbreak">+</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo linebreak="badbreak">+</mml:mo><mml:mfrac><mml:mrow><mml:mn>255</mml:mn><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mn>256</mml:mn></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:msup><mml:mi>B</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M33" altimg="si28.gif"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M34" altimg="si29.gif"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are the red channels of the compared colors. <inline-formula><mml:math id="M35" altimg="si30.gif"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:math></inline-formula> represents the perceptual difference between two RGB colors, and <inline-formula><mml:math id="M36" altimg="si31.gif"><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M37" altimg="si32.gif"><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="M38" altimg="si33.gif"><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:math></inline-formula> stand for the corresponding color channels. The computed differences are utilized as edge weights in the adjacency matrix of the CD-graph.</p>
      </sec>
      <sec id="sec4.4.2">
        <title>Graph matching via coarse-to-fine optimization</title>
        <p id="p0335">The primary objective of color assignment is to ensure that clusters containing closely located or intertwined cells are allocated colors with significant perceptual differences. By utilizing the adjacency matrices of our CI-graph and CD-graph, we can frame the solution to this color-mapping challenge as a graph-matching problem. In this problem, our aim is to establish a one-to-one correspondence between the vertices of the CI-graph and the CD-graph, thereby achieving optimal consistency between the edge weights of the two graphs.</p>
        <p id="p0340">Mathematically, we can express the optimization as an objective function <inline-formula><mml:math id="M39" altimg="si34.gif"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> defined as<disp-formula id="ufd6"><mml:math id="M40" altimg="si35.gif"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mi>P</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi></mml:msub><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M41" altimg="si36.gif"><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:math></inline-formula> is a permutation matrix representing the bijective assignment, in which <inline-formula><mml:math id="M42" altimg="si37.gif"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M43" altimg="si38.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="M44" altimg="si39.gif"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M45" altimg="si40.gif"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the weighted adjacency matrices of CI-graph and CD-graph. <inline-formula><mml:math id="M46" altimg="si41.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>‖</mml:mo><mml:mi>M</mml:mi><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the Frobenius norm of matrix <inline-formula><mml:math id="M47" altimg="si42.gif"><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
        <p id="p0345">Then, we can define the optimal assignment <inline-formula><mml:math id="M48" altimg="si43.gif"><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> to be the solution of following optimization:<disp-formula id="ufd7"><mml:math id="M49" altimg="si44.gif"><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi mathvariant="italic">argmin</mml:mi><mml:mi>P</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mtext>.</mml:mtext></mml:mrow></mml:math></disp-formula></p>
        <p id="p0350">While graph-matching problems of this nature, closely related to the challenging quadratic assignment problem, are known to be NP-hard (NP, nondeterministic polynomial time),<xref rid="bib46" ref-type="bibr"><sup>47</sup></xref><sup>,</sup><xref rid="bib47" ref-type="bibr"><sup>48</sup></xref><sup>,</sup><xref rid="bib48" ref-type="bibr"><sup>49</sup></xref> in the context of cluster-color assignment, we anticipate that the number of clusters will be relatively modest, likely not exceeding thousands.</p>
        <p id="p0355">Therefore, similar to previous methodologies employed in the optimization of palettes for single-cell data,<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> we adopt a straightforward stochastic optimization approach employing a coarse-to-fine strategy. Specifically, Spaco initiates the process by generating a set of permutation matrices (default size of 2,000) and identifies the optimal permutation that yields the minimal loss within this set. Subsequently, Spaco randomly selects a pair of clusters and attempts to refine the loss by exchanging color assignments between the two clusters. This fine-tuning process is iterated until a maximum number of permutations is reached (default value of 5,000) or until the loss remains unchanged for 100 consecutive permutations.</p>
      </sec>
    </sec>
    <sec id="sec4.5">
      <title>Integrative colorization for multiple plots</title>
      <p id="p0360">Furthermore, Spaco extends its capabilities to encompass colorization across multiple datasets or label categories by seamlessly integrating multiple CI-graphs.</p>
      <p id="p0365">Prior to the integration of CI-graphs, it is imperative to establish correspondences among identical cell labels present across distinct datasets. Spaco achieves this by evaluating gene expression similarity between clusters from different datasets, utilizing Pearson correlation across the top 5,000 highly variable genes. This similarity is denoted as <inline-formula><mml:math id="M50" altimg="si45.gif"><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M51" altimg="si46.gif"><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M52" altimg="si47.gif"><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula> are the numbers of unique clusters in two different plots.</p>
      <p id="p0370">Similarly, when aligning distinct label categories, such as when tuning the resolution in the clustering refinement process, the intersection over union (IoU) is employed in place of expression similarities.</p>
      <p id="p0375">Once <inline-formula><mml:math id="M53" altimg="si48.gif"><mml:mrow><mml:msup><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is calculated, we employ a greedy approach to iteratively map <inline-formula><mml:math id="M54" altimg="si49.gif"><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M55" altimg="si50.gif"><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>, where<disp-formula id="ufd8"><mml:math id="M56" altimg="si51.gif"><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi mathvariant="italic">argmax</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mtext>.</mml:mtext></mml:mrow></mml:math></disp-formula></p>
      <p id="p0380">The corresponding row and column of the mapped indices in <inline-formula><mml:math id="M57" altimg="si48.gif"><mml:mrow><mml:msup><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> are then set to zero to ensure injective mapping. This iteration continues until all clusters have been mapped or until <inline-formula><mml:math id="M58" altimg="si52.gif"><mml:mrow><mml:msub><mml:mi mathvariant="italic">max</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> falls below a certain threshold (default to 0 for IoU similarity and 0.5 for normalized expression similarity). Unmapped clusters remain distinct after the iteration concludes. Subsequently, cluster labels in various plots are transformed into unified labels using the established mapping, facilitating the integration of CI-graphs.</p>
    </sec>
    <sec id="sec4.6">
      <title>CVD support</title>
      <p id="p0385">When performing a colorblind-friendly colorization, Spaco slightly adjusts the calculation relating to color differences. Colors are converted to three common types of CVD conditions including protanopia, deuteranopia, and tritanopia, following a previously established transformation.<xref rid="bib49" ref-type="bibr"><sup>50</sup></xref> Then, color perceptual differences are calculated separately using these three sets of simulated CVD colors. Finally, the mean value of these three CVD-simulating color differences and a normally calculated full-color-vision color difference is used (1) in the cluster-color assignment module, as edge weights in the adjacency matrix of the CD-graph, and (2) in the image-palette-extraction module, as color differences to punish color frequency. As for colorblind support for one certain type of CVD, only color differences under the given type of CVD simulation are used.</p>
    </sec>
    <sec id="sec4.7">
      <title>Benchmarking on simulated data</title>
      <sec id="sec4.7.1">
        <title>Generation of simulated dataset</title>
        <p id="p0390">In order to comprehensively evaluate the distance calculation methods for the DOI (Spaco), Wasserstein distance, LISI, and 2D KDE (Palo), we utilized the “normal” function from the “<italic>numpy</italic>.<italic>random</italic>” module to generate multiple sets of 2D points with x and y coordinates following a normal distribution with a standard deviation of 25. These point sets were used to simulate spatial topological relationships. We selected two sets of points with center-to-center distances of 10, 50, 70, 120, and 300, representing five spatial topologies: mixed, overlapped, adjacent, isolated, and distant. Specifically, we generated two types of point sets: dense and sparse. Each dense point set contained 100 points, while each sparse point set contained 25 points. We assessed the results of different calculation methods under the aforementioned five spatial topologies in three scenarios: dense point set with dense point set, sparse point set with sparse point set, and dense point set with sparse point set.</p>
      </sec>
      <sec id="sec4.7.2">
        <title>Calculation of Wasserstein distance</title>
        <p id="p0395">We utilized the Python Optimal Transport (POT; <ext-link ext-link-type="uri" xlink:href="https://pythonot.github.io/index.html" id="intref0060">https://pythonot.github.io/index.html</ext-link>) package to compute the Wasserstein distance between pairwise point sets. The POT package offers several solvers related to Optimal Transport. Specifically, we used the “<italic>dist</italic>” function provided in the package to calculate the distance matrix between individual points of the two sets. Subsequently, we used the “emd2” function to solve the Earth Mover’s distance problem, where the weights of each point were set to be equal. The resulting loss obtained from this computation is considered as the Wasserstein distance between the two point sets.</p>
      </sec>
      <sec id="sec4.7.3">
        <title>Calculation of LISI</title>
        <p id="p0400">The LISI represents the average number of labels present in the N-nearest points.<xref rid="bib21" ref-type="bibr"><sup>21</sup></xref> We used the “<italic>lisi</italic>” function provided in the “scPOP”' R package (<ext-link ext-link-type="uri" xlink:href="https://github.com/vinay-swamy/scPOP" id="intref0065">https://github.com/vinay-swamy/scPOP</ext-link>) to calculate the LISI between two sets of points. Specifically, we inputted all the points from both sets into the function, using the categories of each point as the label. The remaining parameters required by function <italic>lisi</italic> were set to their default values. The resulting LISI value between the two point sets was determined by averaging the LISI values of individual points. To invoke the functionality of R packages in Python, we utilized the “rpy2” package (<ext-link ext-link-type="uri" xlink:href="https://github.com/rpy2/rpy2" id="intref0070">https://github.com/rpy2/rpy2</ext-link>).</p>
      </sec>
      <sec id="sec4.7.4">
        <title>Calculation of 2D KDE</title>
        <p id="p0405">The Palo method provides another approach for the color assignment of palettes considering the spatial relationships of single-cell data.<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> The Palo method consists of three components: spatial overlap score calculation, color dissimilarities calculation, and color assignments. All functionalities are encompassed within the <italic>Palo</italic> function provided in the R package Palo. To meet our evaluation requirements, we extracted the functionality for calculating spatial overlap scores between point sets from the Palo function. We used our complete set of points and categories information as input, and the spatial overlap scores between the point sets calculated by the Palo function were considered as the distances of sets.</p>
      </sec>
    </sec>
    <sec id="sec4.8">
      <title>Benchmarking on real-world data</title>
      <sec id="sec4.8.1">
        <title>Dataset collection</title>
        <p id="p0410">To evaluate the efficacy of Spaco, we collected four distinct real-world datasets spanning different technologies and tissue types.<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref><sup>,</sup><xref rid="bib24" ref-type="bibr"><sup>24</sup></xref><sup>,</sup><xref rid="bib25" ref-type="bibr"><sup>25</sup></xref><sup>,</sup><xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> Each of these datasets has been previously analyzed, as detailed in their original publications. They provide crucial information for Spaco, including expression data, spatial coordinates, and labeling details. These labels represent cell types and anatomical annotations for individual cells or spatial spots. All datasets are publicly available and can be obtained directly from their source publications.</p>
      </sec>
      <sec id="sec4.8.2">
        <title>Measuring perceptual discernibility</title>
        <p id="p0415">As most colors are presented in hexadecimal form of RGB color space, we use the same metric as in CD-graph construction (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>: <xref rid="sec4.4.1" ref-type="sec">calculating perceptual differences</xref>) and employ a CVD simulation (see <xref rid="sec4.6" ref-type="sec">experimental procedures: CVD support</xref>) when benchmarking CVD-supporting colorizations. We measure the discernibility between cell clusters as the perceptual difference between the corresponding colors. For micro-FOVs, the discernibility of a FOV is evaluated as the mean color difference of all cell pairs derived in this FOV. For palettes, the discernibility of a palette is measured as the mean color difference of all color pairs derived in the palette.</p>
      </sec>
      <sec id="sec4.8.3">
        <title>Blind user scoring of colorized spatial plots</title>
        <p id="p0420">To supplementarily assess Spaco’s colorization performance from a user-centric viewpoint, we conducted a single-blind experiment. This experiment involved the creation of a questionnaire administered to 53 participants, all of whom possessed expertise in spatial transcriptomics analysis. The experiment aimed to evaluate the colorization of four distinct plots derived from the STARmap mouse brain dataset<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> using Spaco, Scanpy (matplotlib), random shuffling, and Palo.</p>
        <p id="p0425">Participants were requested to judge the discernibility of all cell clusters in each plot. To provide a reference of cluster distributions, the questionnaire was supplemented with split plots that highlighted each individual cell cluster. Participants were asked to assign scores to these colorized plots, rating them on a scale from 1 (worst) to 10 (best), based on their perceived quality. The original questionnaire and the gathered results are accessible through the following link: <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco_scripts" id="intref0075">https://github.com/BrainStOrmics/Spaco_scripts</ext-link>.</p>
        <p id="p0430">This experimental design allows us to comprehensively gauge and compare the effectiveness of Spaco’s colorization with other methods and to draw insightful conclusions from the gathered evaluations. However, a lack of participants with CVD made this survey limited to a full-color-vision perspective. Also, this survey should only be interpreted as a supplementary evaluation paratactic to our computational metric and did not lead to statistical conclusions due to insufficient sample size and potential bias of individual scoring criteria.</p>
      </sec>
    </sec>
  </sec>
</body>
<back>
  <ref-list id="cebib0010">
    <title>References</title>
    <ref id="bib1">
      <label>1</label>
      <element-citation publication-type="journal" id="sref1">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Barkley</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>França</surname>
            <given-names>G.S.</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I.</given-names>
          </name>
        </person-group>
        <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>
        <source>Nature</source>
        <volume>596</volume>
        <year>2021</year>
        <fpage>211</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="pmid">34381231</pub-id>
      </element-citation>
    </ref>
    <ref id="bib2">
      <label>2</label>
      <element-citation publication-type="journal" id="sref2">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Allen</surname>
            <given-names>W.E.</given-names>
          </name>
          <name>
            <surname>Wright</surname>
            <given-names>M.A.</given-names>
          </name>
          <name>
            <surname>Sylwestrak</surname>
            <given-names>E.L.</given-names>
          </name>
          <name>
            <surname>Samusik</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Vesuna</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Evans</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Ramakrishnan</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>J.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>
        <source>Science</source>
        <volume>361</volume>
        <year>2018</year>
        <object-id pub-id-type="publisher-id">eaat5691</object-id>
      </element-citation>
    </ref>
    <ref id="bib3">
      <label>3</label>
      <element-citation publication-type="journal" id="sref3">
        <person-group person-group-type="author">
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Lawson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Dries</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Takei</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Yun</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Cronin</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Karp</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G.-C.</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH</article-title>
        <source>Nature</source>
        <volume>568</volume>
        <year>2019</year>
        <fpage>235</fpage>
        <lpage>239</lpage>
        <pub-id pub-id-type="pmid">30911168</pub-id>
      </element-citation>
    </ref>
    <ref id="bib4">
      <label>4</label>
      <element-citation publication-type="journal" id="sref4">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>P.L.</given-names>
          </name>
          <name>
            <surname>Salmén</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Vickovic</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Lundmark</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>J.F.</given-names>
          </name>
          <name>
            <surname>Magnusson</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Giacomello</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Asp</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Westholm</surname>
            <given-names>J.O.</given-names>
          </name>
          <name>
            <surname>Huss</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science</source>
        <volume>353</volume>
        <year>2016</year>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="bib5">
      <label>5</label>
      <element-citation publication-type="journal" id="sref5">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Liao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Qiu</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Hao</surname>
            <given-names>S.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>
        <source>Cell</source>
        <volume>185</volume>
        <year>2022</year>
        <fpage>1777</fpage>
        <lpage>1792.e21</lpage>
        <pub-id pub-id-type="pmid">35512705</pub-id>
      </element-citation>
    </ref>
    <ref id="bib6">
      <label>6</label>
      <element-citation publication-type="journal" id="sref6">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Lei</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Liao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Meng</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Bai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Liang</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell spatial transcriptome reveals cell-type organization in the macaque cortex</article-title>
        <source>Cell</source>
        <volume>186</volume>
        <year>2023</year>
        <fpage>3726</fpage>
        <lpage>3743.e24</lpage>
        <pub-id pub-id-type="pmid">37442136</pub-id>
      </element-citation>
    </ref>
    <ref id="bib7">
      <label>7</label>
      <element-citation publication-type="journal" id="sref7">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Siletti</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Furlan</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Gyllborg</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Vinsland</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Mossi Albiach</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Mattsson Langseth</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Khven</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Lederer</surname>
            <given-names>A.R.</given-names>
          </name>
          <name>
            <surname>Dratva</surname>
            <given-names>L.M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the developing mouse brain</article-title>
        <source>Nature</source>
        <volume>596</volume>
        <year>2021</year>
        <fpage>92</fpage>
        <lpage>96</lpage>
        <pub-id pub-id-type="pmid">34321664</pub-id>
      </element-citation>
    </ref>
    <ref id="bib8">
      <label>8</label>
      <element-citation publication-type="journal" id="sref8">
        <person-group person-group-type="author">
          <name>
            <surname>Zeng</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhong</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Qin</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Zeng</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>Y.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The single-cell and spatial transcriptional landscape of human gastrulation and early brain development</article-title>
        <source>Cell Stem Cell</source>
        <volume>30</volume>
        <year>2023</year>
        <fpage>851</fpage>
        <lpage>866.e7</lpage>
        <pub-id pub-id-type="pmid">37192616</pub-id>
      </element-citation>
    </ref>
    <ref id="bib9">
      <label>9</label>
      <element-citation publication-type="journal" id="sref9">
        <person-group person-group-type="author">
          <name>
            <surname>Lohoff</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Ghazanfar</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Missarova</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Pierson</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Griffiths</surname>
            <given-names>J.A.</given-names>
          </name>
          <name>
            <surname>Bardot</surname>
            <given-names>E.S.</given-names>
          </name>
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Tyser</surname>
            <given-names>R.C.V.</given-names>
          </name>
          <name>
            <surname>Argelaguet</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integration of spatial and single-cell transcriptomic data elucidates mouse organogenesis</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>40</volume>
        <year>2022</year>
        <fpage>74</fpage>
        <lpage>85</lpage>
        <pub-id pub-id-type="pmid">34489600</pub-id>
      </element-citation>
    </ref>
    <ref id="bib10">
      <label>10</label>
      <element-citation publication-type="journal" id="sref10">
        <person-group person-group-type="author">
          <name>
            <surname>Berglund</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Maaskola</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Schultz</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Friedrich</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Marklund</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Bergenstråhle</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Tarish</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Tanoglidi</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Vickovic</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Larsson</surname>
            <given-names>L.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial maps of prostate cancer transcriptomes reveal an unexplored landscape of heterogeneity</article-title>
        <source>Nat. Commun.</source>
        <volume>9</volume>
        <year>2018</year>
        <fpage>2419</fpage>
        <pub-id pub-id-type="pmid">29925878</pub-id>
      </element-citation>
    </ref>
    <ref id="bib11">
      <label>11</label>
      <element-citation publication-type="journal" id="sref11">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Yan</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Bai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Zou</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Hou</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Zhong</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An invasive zone in human liver cancer identified by Stereo-seq promotes hepatocyte-tumor cell crosstalk, local immunosuppression and tumor progression</article-title>
        <source>Cell Res.</source>
        <volume>33</volume>
        <year>2023</year>
        <fpage>585</fpage>
        <lpage>603</lpage>
        <pub-id pub-id-type="pmid">37337030</pub-id>
      </element-citation>
    </ref>
    <ref id="bib12">
      <label>12</label>
      <element-citation publication-type="journal" id="sref12">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>Analysis and Visualization of Spatial Transcriptomic Data</article-title>
        <source>Front. Genet.</source>
        <volume>12</volume>
        <year>2021</year>
        <object-id pub-id-type="publisher-id">785290</object-id>
      </element-citation>
    </ref>
    <ref id="bib13">
      <label>13</label>
      <element-citation publication-type="journal" id="sref13">
        <person-group person-group-type="author">
          <name>
            <surname>Crameri</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Shephard</surname>
            <given-names>G.E.</given-names>
          </name>
          <name>
            <surname>Heron</surname>
            <given-names>P.J.</given-names>
          </name>
        </person-group>
        <article-title>The misuse of colour in science communication</article-title>
        <source>Nat. Commun.</source>
        <volume>11</volume>
        <year>2020</year>
        <fpage>5444</fpage>
        <pub-id pub-id-type="pmid">33116149</pub-id>
      </element-citation>
    </ref>
    <ref id="bib14">
      <label>14</label>
      <element-citation publication-type="journal" id="sref14">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>36</volume>
        <year>2018</year>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="bib15">
      <label>15</label>
      <element-citation publication-type="journal" id="sref15">
        <person-group person-group-type="author">
          <name>
            <surname>Dries</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Sarkar</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Bao</surname>
            <given-names>F.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>
        <source>Genome Biol.</source>
        <volume>22</volume>
        <year>2021</year>
        <fpage>78</fpage>
        <pub-id pub-id-type="pmid">33685491</pub-id>
      </element-citation>
    </ref>
    <ref id="bib16">
      <label>16</label>
      <element-citation publication-type="journal" id="sref16">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>F.A.</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>F.J.</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <volume>19</volume>
        <year>2018</year>
        <fpage>15</fpage>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="bib17">
      <label>17</label>
      <element-citation publication-type="journal" id="sref17">
        <person-group person-group-type="author">
          <name>
            <surname>Palla</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Spitzer</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Klein</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Schaar</surname>
            <given-names>A.C.</given-names>
          </name>
          <name>
            <surname>Kuemmerle</surname>
            <given-names>L.B.</given-names>
          </name>
          <name>
            <surname>Rybakov</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Ibarra</surname>
            <given-names>I.L.</given-names>
          </name>
          <name>
            <surname>Holmberg</surname>
            <given-names>O.</given-names>
          </name>
          <name>
            <surname>Virshup</surname>
            <given-names>I.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>
        <source>Nat. Methods</source>
        <volume>19</volume>
        <year>2022</year>
        <fpage>171</fpage>
        <lpage>178</lpage>
        <pub-id pub-id-type="pmid">35102346</pub-id>
      </element-citation>
    </ref>
    <ref id="bib18">
      <label>18</label>
      <element-citation publication-type="journal" id="sref18">
        <person-group person-group-type="author">
          <name>
            <surname>Hunter</surname>
            <given-names>J.D.</given-names>
          </name>
        </person-group>
        <article-title>Matplotlib: A 2D Graphics Environment</article-title>
        <source>Comput. Sci. Eng.</source>
        <volume>9</volume>
        <year>2007</year>
        <fpage>90</fpage>
        <lpage>95</lpage>
      </element-citation>
    </ref>
    <ref id="bib19">
      <label>19</label>
      <element-citation publication-type="journal" id="sref19">
        <person-group person-group-type="author">
          <name>
            <surname>Wickham</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Ggplot2</article-title>
        <source>WIREs Computational Stats.</source>
        <volume>3</volume>
        <year>2011</year>
        <fpage>180</fpage>
        <lpage>185</lpage>
      </element-citation>
    </ref>
    <ref id="bib20">
      <label>20</label>
      <element-citation publication-type="journal" id="sref20">
        <person-group person-group-type="author">
          <name>
            <surname>Vaserstein</surname>
            <given-names>L.N.</given-names>
          </name>
        </person-group>
        <article-title>Markov processes over denumerable products of spaces, describing large systems of automata</article-title>
        <source>Probl. Peredachi Inf.</source>
        <volume>5</volume>
        <year>1969</year>
        <fpage>64</fpage>
        <lpage>72</lpage>
      </element-citation>
    </ref>
    <ref id="bib21">
      <label>21</label>
      <element-citation publication-type="journal" id="sref21">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Millard</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Fan</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Slowikowski</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Wei</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Baglaenko</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Loh</surname>
            <given-names>P.-R.</given-names>
          </name>
          <name>
            <surname>Raychaudhuri</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <volume>16</volume>
        <year>2019</year>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="bib22">
      <label>22</label>
      <element-citation publication-type="journal" id="sref22">
        <person-group person-group-type="author">
          <name>
            <surname>Hou</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>Z.</given-names>
          </name>
        </person-group>
        <article-title>Palo: spatially aware color palette optimization for single-cell and spatial data</article-title>
        <source>Bioinformatics</source>
        <volume>38</volume>
        <year>2022</year>
        <fpage>3654</fpage>
        <lpage>3656</lpage>
        <pub-id pub-id-type="pmid">35642896</pub-id>
      </element-citation>
    </ref>
    <ref id="bib23">
      <label>23</label>
      <element-citation publication-type="journal" id="sref23">
        <person-group person-group-type="author">
          <name>
            <surname>Neuwirth</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Brewer</surname>
            <given-names>R.C.</given-names>
          </name>
        </person-group>
        <article-title>Package RColorBrewer palettes</article-title>
        <source>ColorBrewer palettes</source>
        <year>2014</year>
        <fpage>1</fpage>
      </element-citation>
    </ref>
    <ref id="bib24">
      <label>24</label>
      <element-citation publication-type="journal" id="sref24">
        <person-group person-group-type="author">
          <name>
            <surname>Shi</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Maher</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Tan</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial atlas of the mouse central nervous system at molecular resolution</article-title>
        <source>Nature</source>
        <volume>1–10</volume>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib25">
      <label>25</label>
      <element-citation publication-type="journal" id="sref25">
        <person-group person-group-type="author">
          <name>
            <surname>Wei</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Zeng</surname>
            <given-names>Y.-Y.</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell Stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>
        <source>Science</source>
        <volume>377</volume>
        <year>2022</year>
        <object-id pub-id-type="publisher-id">eabp9444</object-id>
      </element-citation>
    </ref>
    <ref id="bib26">
      <label>26</label>
      <element-citation publication-type="journal" id="sref26">
        <person-group person-group-type="author">
          <name>
            <surname>Jackson</surname>
            <given-names>H.W.</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>J.R.</given-names>
          </name>
          <name>
            <surname>Zanotelli</surname>
            <given-names>V.R.T.</given-names>
          </name>
          <name>
            <surname>Ali</surname>
            <given-names>H.R.</given-names>
          </name>
          <name>
            <surname>Mechera</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Soysal</surname>
            <given-names>S.D.</given-names>
          </name>
          <name>
            <surname>Moch</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Muenst</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Varga</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>W.P.</given-names>
          </name>
          <name>
            <surname>Bodenmiller</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <article-title>The single-cell pathology landscape of breast cancer</article-title>
        <source>Nature</source>
        <volume>578</volume>
        <year>2020</year>
        <fpage>615</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="pmid">31959985</pub-id>
      </element-citation>
    </ref>
    <ref id="bib50">
      <label>27</label>
      <element-citation publication-type="journal" id="sref50">
        <person-group person-group-type="author">
          <name>
            <surname>Virshup</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Rybakov</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>F.J.</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Alexander Wolf</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <article-title>anndata: Annotated data</article-title>
        <comment>Preprint at</comment>
        <source>bioRxiv</source>
        <year>2021</year>
        <pub-id pub-id-type="doi">10.1101/2021.12.16.473007</pub-id>
      </element-citation>
    </ref>
    <ref id="bib27">
      <label>28</label>
      <element-citation publication-type="journal" id="sref28">
        <person-group person-group-type="author">
          <name>
            <surname>McInnes</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Healy</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Melville</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction</article-title>
        <comment>Preprint at</comment>
        <source>arXiv</source>
        <year>2018</year>
        <pub-id pub-id-type="doi">10.48550/arXiv.1802.03426</pub-id>
      </element-citation>
    </ref>
    <ref id="bib28">
      <label>29</label>
      <element-citation publication-type="journal" id="sref51">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Wandell</surname>
            <given-names>B.A.</given-names>
          </name>
        </person-group>
        <article-title>A Spatial Extension of CIELAB for digital color image reproduction</article-title>
        <source>J. Soc. Inf. Display</source>
        <volume>5</volume>
        <year>2012</year>
        <fpage>61</fpage>
        <lpage>63</lpage>
      </element-citation>
    </ref>
    <ref id="bib29">
      <label>30</label>
      <element-citation publication-type="journal" id="sref29">
        <person-group person-group-type="author">
          <name>
            <surname>Eldar</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Lindenbaum</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Porat</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Zeevi</surname>
            <given-names>Y.Y.</given-names>
          </name>
        </person-group>
        <article-title>The farthest point strategy for progressive image sampling</article-title>
        <source>IEEE Trans. Image Process.</source>
        <volume>6</volume>
        <year>1997</year>
        <fpage>1305</fpage>
        <lpage>1315</lpage>
        <pub-id pub-id-type="pmid">18283019</pub-id>
      </element-citation>
    </ref>
    <ref id="bib30">
      <label>31</label>
      <element-citation publication-type="journal" id="sref30">
        <person-group person-group-type="author">
          <name>
            <surname>Sunkin</surname>
            <given-names>S.M.</given-names>
          </name>
          <name>
            <surname>Ng</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lau</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Dolbeare</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Gilbert</surname>
            <given-names>T.L.</given-names>
          </name>
          <name>
            <surname>Thompson</surname>
            <given-names>C.L.</given-names>
          </name>
          <name>
            <surname>Hawrylycz</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Dang</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Allen Brain Atlas: an integrated spatio-temporal portal for exploring the central nervous system</article-title>
        <source>Nucleic Acids Res.</source>
        <volume>41</volume>
        <year>2013</year>
        <fpage>D996</fpage>
        <lpage>D1008</lpage>
        <pub-id pub-id-type="pmid">23193282</pub-id>
      </element-citation>
    </ref>
    <ref id="bib31">
      <label>32</label>
      <element-citation publication-type="journal" id="sref31">
        <person-group person-group-type="author">
          <name>
            <surname>Brettel</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Viénot</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Mollon</surname>
            <given-names>J.D.</given-names>
          </name>
        </person-group>
        <article-title>Computerized simulation of color appearance for dichromats</article-title>
        <source>J. Opt. Soc. Am. Opt Image Sci. Vis.</source>
        <volume>14</volume>
        <year>1997</year>
        <fpage>2647</fpage>
        <lpage>2655</lpage>
      </element-citation>
    </ref>
    <ref id="bib32">
      <label>33</label>
      <element-citation publication-type="journal" id="sref32">
        <person-group person-group-type="author">
          <name>
            <surname>Petukhov</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>R.J.</given-names>
          </name>
          <name>
            <surname>Soldatov</surname>
            <given-names>R.A.</given-names>
          </name>
          <name>
            <surname>Cadinu</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Khodosevich</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Moffitt</surname>
            <given-names>J.R.</given-names>
          </name>
          <name>
            <surname>Kharchenko</surname>
            <given-names>P.V.</given-names>
          </name>
        </person-group>
        <article-title>Cell segmentation in imaging-based spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>40</volume>
        <year>2022</year>
        <fpage>345</fpage>
        <lpage>354</lpage>
        <pub-id pub-id-type="pmid">34650268</pub-id>
      </element-citation>
    </ref>
    <ref id="bib33">
      <label>34</label>
      <element-citation publication-type="journal" id="sref33">
        <person-group person-group-type="author">
          <name>
            <surname>Mah</surname>
            <given-names>C.K.</given-names>
          </name>
          <name>
            <surname>Ahmed</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Lam</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Monell</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Kern</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Cesnik</surname>
            <given-names>A.J.</given-names>
          </name>
          <name>
            <surname>Lundberg</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Carter</surname>
            <given-names>H.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bento: A toolkit for subcellular analysis of spatial transcriptomics data</article-title>
        <source>Preprint at bioRxiv</source>
        <year>2022</year>
        <pub-id pub-id-type="doi">10.1101/2022.06.10.495510</pub-id>
      </element-citation>
    </ref>
    <ref id="bib34">
      <label>35</label>
      <element-citation publication-type="journal" id="sref34">
        <person-group person-group-type="author">
          <name>
            <surname>Poplin</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>P.-C.</given-names>
          </name>
          <name>
            <surname>Alexander</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Schwartz</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Colthurst</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Ku</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Newburger</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Dijamco</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Nguyen</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Afshar</surname>
            <given-names>P.T.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A universal SNP and small-indel variant caller using deep neural networks</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>36</volume>
        <year>2018</year>
        <fpage>983</fpage>
        <lpage>987</lpage>
        <pub-id pub-id-type="pmid">30247488</pub-id>
      </element-citation>
    </ref>
    <ref id="bib35">
      <label>36</label>
      <element-citation publication-type="journal" id="sref35">
        <person-group person-group-type="author">
          <name>
            <surname>Bunis</surname>
            <given-names>D.G.</given-names>
          </name>
          <name>
            <surname>Andrews</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Fragiadakis</surname>
            <given-names>G.K.</given-names>
          </name>
          <name>
            <surname>Burt</surname>
            <given-names>T.D.</given-names>
          </name>
          <name>
            <surname>Sirota</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>dittoSeq: universal user-friendly single-cell and bulk RNA sequencing visualization toolkit</article-title>
        <source>Bioinformatics</source>
        <volume>36</volume>
        <year>2021</year>
        <fpage>5535</fpage>
        <lpage>5536</lpage>
        <pub-id pub-id-type="pmid">33313640</pub-id>
      </element-citation>
    </ref>
    <ref id="bib36">
      <label>37</label>
      <element-citation publication-type="book" id="sref36">
        <person-group person-group-type="author">
          <name>
            <surname>Crameri</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <source>Scientific Colour Maps (8.0.1). Zenodo</source>
        <year>2023</year>
        <pub-id pub-id-type="doi">10.5281/zenodo.1243862</pub-id>
      </element-citation>
    </ref>
    <ref id="bib37">
      <label>38</label>
      <element-citation publication-type="other" id="sref37">
        <person-group person-group-type="author">
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
        </person-group>
        <article-title>BrainStOrmics/Spaco: Spaco 0.2. Zenodo</article-title>
        <pub-id pub-id-type="doi">10.5281/zenodo.10121765</pub-id>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib38">
      <label>39</label>
      <element-citation publication-type="other" id="sref38">
        <person-group person-group-type="author">
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
        </person-group>
        <article-title>BrainStOrmics/Spaco_scripts: Spaco_scripts_231111. Zenodo</article-title>
        <pub-id pub-id-type="doi">10.5281/zenodo.10113360</pub-id>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib39">
      <label>40</label>
      <element-citation publication-type="journal" id="sref39">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Stone</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Ren</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Guenthoer</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Smythe</surname>
            <given-names>K.S.</given-names>
          </name>
          <name>
            <surname>Pulliam</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>S.R.</given-names>
          </name>
          <name>
            <surname>Uytingco</surname>
            <given-names>C.R.</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>S.E.B.</given-names>
          </name>
          <name>
            <surname>Nghiem</surname>
            <given-names>P.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>39</volume>
        <year>2021</year>
        <fpage>1375</fpage>
        <lpage>1384</lpage>
        <pub-id pub-id-type="pmid">34083791</pub-id>
      </element-citation>
    </ref>
    <ref id="bib40">
      <label>41</label>
      <element-citation publication-type="journal" id="sref40">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Coleman</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Schroeder</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Irwin</surname>
            <given-names>D.J.</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>E.B.</given-names>
          </name>
          <name>
            <surname>Shinohara</surname>
            <given-names>R.T.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>
        <source>Nat. Methods</source>
        <volume>18</volume>
        <year>2021</year>
        <fpage>1342</fpage>
        <lpage>1351</lpage>
        <pub-id pub-id-type="pmid">34711970</pub-id>
      </element-citation>
    </ref>
    <ref id="bib41">
      <label>42</label>
      <element-citation publication-type="journal" id="sref41">
        <person-group person-group-type="author">
          <name>
            <surname>Chari</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>The specious art of single-cell genomics</article-title>
        <source>PLoS Comput. Biol.</source>
        <volume>19</volume>
        <year>2023</year>
        <object-id pub-id-type="publisher-id">e1011288</object-id>
      </element-citation>
    </ref>
    <ref id="bib42">
      <label>43</label>
      <element-citation publication-type="journal" id="sref42">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Lanir</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Image-guided color mapping for categorical data visualization</article-title>
        <source>Comput. Vis. Media (Beijing).</source>
        <volume>8</volume>
        <year>2022</year>
        <fpage>613</fpage>
        <lpage>629</lpage>
      </element-citation>
    </ref>
    <ref id="bib43">
      <label>44</label>
      <element-citation publication-type="journal" id="sref43">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Xiao</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <article-title>Palette-Based Image Recoloring Using Color Decomposition Optimization</article-title>
        <source>IEEE Trans. Image Process.</source>
        <volume>26</volume>
        <year>2017</year>
        <fpage>1952</fpage>
        <lpage>1964</lpage>
        <pub-id pub-id-type="pmid">28237926</pub-id>
      </element-citation>
    </ref>
    <ref id="bib44">
      <label>45</label>
      <element-citation publication-type="journal" id="sref44">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Cui</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Rigg</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <article-title>The development of the CIE 2000 colour-difference formula: CIEDE2000</article-title>
        <source>Color Res. Appl.</source>
        <volume>26</volume>
        <year>2001</year>
        <fpage>340</fpage>
        <lpage>350</lpage>
      </element-citation>
    </ref>
    <ref id="bib45">
      <label>46</label>
      <element-citation publication-type="other" id="sref45">
        <person-group person-group-type="author">
          <name>
            <surname>Riemersma</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>Colour Metric</article-title>
        <ext-link ext-link-type="uri" xlink:href="https://www.compuphase.com/cmetric.htm" id="interref0020">https://www.compuphase.com/cmetric.htm</ext-link>
        <year>2019</year>
      </element-citation>
    </ref>
    <ref id="bib46">
      <label>47</label>
      <element-citation publication-type="journal" id="sref46">
        <person-group person-group-type="author">
          <name>
            <surname>Grohe</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Rattan</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Woeginger</surname>
            <given-names>G.J.</given-names>
          </name>
        </person-group>
        <article-title>Graph Similarity and Approximate Isomorphism</article-title>
        <comment>Preprint at</comment>
        <source>arXiv</source>
        <year>2018</year>
        <pub-id pub-id-type="doi">10.48550/arXiv.1802.08509</pub-id>
      </element-citation>
    </ref>
    <ref id="bib47">
      <label>48</label>
      <element-citation publication-type="journal" id="sref47">
        <person-group person-group-type="author">
          <name>
            <surname>Koopmans</surname>
            <given-names>T.C.</given-names>
          </name>
          <name>
            <surname>Beckmann</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Assignment problems and the location of economic activities</article-title>
        <source>Econometrica</source>
        <volume>25</volume>
        <year>1957</year>
        <fpage>53</fpage>
      </element-citation>
    </ref>
    <ref id="bib48">
      <label>49</label>
      <element-citation publication-type="journal" id="sref48">
        <person-group person-group-type="author">
          <name>
            <surname>Sahni</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Gonzalez</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>P-complete approximation problems</article-title>
        <source>J. ACM</source>
        <volume>23</volume>
        <year>1976</year>
        <fpage>555</fpage>
        <lpage>565</lpage>
      </element-citation>
    </ref>
    <ref id="bib49">
      <label>50</label>
      <element-citation publication-type="journal" id="sref49">
        <person-group person-group-type="author">
          <name>
            <surname>Elrefaei</surname>
            <given-names>L.A.</given-names>
          </name>
        </person-group>
        <article-title>Smartphone Based Image Color Correction for Color Blindness</article-title>
        <source>Int. J. Interact. Mob. Technol.</source>
        <volume>12</volume>
        <year>2018</year>
        <fpage>104</fpage>
        <lpage>119</lpage>
      </element-citation>
    </ref>
  </ref-list>
  <sec id="appsec2" sec-type="supplementary-material">
    <title>Supplemental information</title>
    <p id="p0460">
      <supplementary-material content-type="local-data" id="mmc1">
        <caption>
          <title>Document S1. Figures S1–S6</title>
        </caption>
        <media xlink:href="mmc1.pdf"/>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="mmc2">
        <caption>
          <title>Document S2. Article plus supplemental information</title>
        </caption>
        <media xlink:href="mmc2.pdf"/>
      </supplementary-material>
    </p>
  </sec>
  <ack id="ack0010">
    <title>Acknowledgments</title>
    <p id="p0435">This work was supported by the <funding-source id="gs1"><institution-wrap><institution-id institution-id-type="doi">10.13039/501100012166</institution-id><institution>National Key R&amp;D Program of China</institution></institution-wrap></funding-source> (2022YFC3400400) (X.X.) and the <funding-source id="gs2">Guangdong Provincial Key Laboratory of Genome Read and Write</funding-source> (X.X.). We are sincerely thankful for the technical support provided by <funding-source id="gs3">China National Gene Bank</funding-source>.</p>
    <sec id="sec5">
      <title>Author contributions</title>
      <p id="p0440">Conceptualization, Y.B. and H.P.; methodology, Z.J. and Q.Z.; software, Z.J., Q.Z., and L.L.; formal analysis, Z.J., L.L., Y.X., and Q.Z.; validation, Z.J. and Y.X.; investigation, Y.X. and B.Y.; writing – original draft, Z.J.; writing – review &amp; editing, Z.J., Y.B., X.W., L.L., H.P., Y.X., Q.F., and B.D.; funding acquisition, X.X.; resources, Y.B. and X.X.; supervision, Y.B., H.P., and X.X.</p>
    </sec>
    <sec sec-type="COI-statement" id="sec6">
      <title>Declaration of interests</title>
      <p id="p0445">The authors declare no competing interests.</p>
    </sec>
    <sec id="sec7">
      <title>Declaration of generative AI and AI-assisted technologies in the writing process</title>
      <p id="p0450">During the preparation of this work, the authors used ChatGPT 4.0 (GPT-4) in order to facilitate the process of proofreading the contents of our draft. After using this tool/service, the authors reviewed and edited the content as needed and take full responsibility for the content of the publication.</p>
    </sec>
  </ack>
  <fn-group>
    <fn id="appsec1" fn-type="supplementary-material">
      <p id="p0455">Supplemental information can be found online at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.patter.2023.100915" id="intref0080">https://doi.org/10.1016/j.patter.2023.100915</ext-link>.</p>
    </fn>
  </fn-group>
</back>
<?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName art560.dtd?>
<?SourceDTD.Version 5.6.0?>
<?ConverterInfo.XSLTName elsevier2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin publisher?>
<?FILEmeta_PATTER100915 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEgr3 jpg ?>
<?FILEgr4 jpg ?>
<?FILEgr5 jpg ?>
<?FILEfx1 jpg ?>
<?FILEmmc1 pdf ?>
<?FILEmmc2 pdf ?>
<?FILEsi1 gif ?>
<?FILEsi2 gif ?>
<?FILEsi3 gif ?>
<?FILEsi4 gif ?>
<?FILEsi5 gif ?>
<?FILEsi6 gif ?>
<?FILEsi7 gif ?>
<?FILEsi8 gif ?>
<?FILEsi9 gif ?>
<?FILEsi10 gif ?>
<?FILEsi11 gif ?>
<?FILEsi12 gif ?>
<?FILEsi13 gif ?>
<?FILEsi14 gif ?>
<?FILEsi15 gif ?>
<?FILEsi16 gif ?>
<?FILEsi17 gif ?>
<?FILEsi18 gif ?>
<?FILEsi19 gif ?>
<?FILEsi20 gif ?>
<?FILEsi21 gif ?>
<?FILEsi22 gif ?>
<?FILEsi23 gif ?>
<?FILEsi24 gif ?>
<?FILEsi25 gif ?>
<?FILEsi26 gif ?>
<?FILEsi27 gif ?>
<?FILEsi28 gif ?>
<?FILEsi29 gif ?>
<?FILEsi30 gif ?>
<?FILEsi31 gif ?>
<?FILEsi32 gif ?>
<?FILEsi33 gif ?>
<?FILEsi34 gif ?>
<?FILEsi35 gif ?>
<?FILEsi36 gif ?>
<?FILEsi37 gif ?>
<?FILEsi38 gif ?>
<?FILEsi39 gif ?>
<?FILEsi40 gif ?>
<?FILEsi41 gif ?>
<?FILEsi42 gif ?>
<?FILEsi43 gif ?>
<?FILEsi44 gif ?>
<?FILEsi45 gif ?>
<?FILEsi46 gif ?>
<?FILEsi47 gif ?>
<?FILEsi48 gif ?>
<?FILEsi49 gif ?>
<?FILEsi50 gif ?>
<?FILEsi51 gif ?>
<?FILEsi52 gif ?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Patterns (N Y)</journal-id>
    <journal-id journal-id-type="iso-abbrev">Patterns (N Y)</journal-id>
    <journal-title-group>
      <journal-title>Patterns</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2666-3899</issn>
    <publisher>
      <publisher-name>Elsevier</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10935509</article-id>
    <article-id pub-id-type="pii">S2666-3899(23)00324-0</article-id>
    <article-id pub-id-type="doi">10.1016/j.patter.2023.100915</article-id>
    <article-id pub-id-type="publisher-id">100915</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Spaco: A comprehensive tool for coloring spatial data at single-cell resolution</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="au1">
        <name>
          <surname>Jing</surname>
          <given-names>Zehua</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au2">
        <name>
          <surname>Zhu</surname>
          <given-names>Qianhua</given-names>
        </name>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au3">
        <name>
          <surname>Li</surname>
          <given-names>Linxuan</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au4">
        <name>
          <surname>Xie</surname>
          <given-names>Yue</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au5">
        <name>
          <surname>Wu</surname>
          <given-names>Xinchao</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff5" ref-type="aff">5</xref>
      </contrib>
      <contrib contrib-type="author" id="au6">
        <name>
          <surname>Fang</surname>
          <given-names>Qi</given-names>
        </name>
        <xref rid="aff4" ref-type="aff">4</xref>
      </contrib>
      <contrib contrib-type="author" id="au7">
        <name>
          <surname>Yang</surname>
          <given-names>Bolin</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff3" ref-type="aff">3</xref>
      </contrib>
      <contrib contrib-type="author" id="au8">
        <name>
          <surname>Dai</surname>
          <given-names>Baojun</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff5" ref-type="aff">5</xref>
      </contrib>
      <contrib contrib-type="author" id="au9">
        <name>
          <surname>Xu</surname>
          <given-names>Xun</given-names>
        </name>
        <email>xuxun@genomics.cn</email>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff2" ref-type="aff">2</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="cor1" ref-type="corresp">∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au10">
        <name>
          <surname>Pan</surname>
          <given-names>Hailin</given-names>
        </name>
        <email>panhailin@genomics.cn</email>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="cor2" ref-type="corresp">∗∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au11">
        <name>
          <surname>Bai</surname>
          <given-names>Yinqi</given-names>
        </name>
        <email>baiyinqi@genomics.cn</email>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn2" ref-type="fn">7</xref>
        <xref rid="cor3" ref-type="corresp">∗∗∗</xref>
      </contrib>
      <aff id="aff1"><label>1</label>College of Life Sciences, University of Chinese Academy of Sciences, Beijing 100049, China</aff>
      <aff id="aff2"><label>2</label>Guangdong Provincial Key Laboratory of Genome Read and Write, BGI Research, Shenzhen 518083, China</aff>
      <aff id="aff3"><label>3</label>BGI Research, Hangzhou 310012, China</aff>
      <aff id="aff4"><label>4</label>BGI Research, Shenzhen 518083, China</aff>
      <aff id="aff5"><label>5</label>School of Life Sciences, Southern University of Science and Technology, Shenzhen 518055, China</aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>∗</label>Corresponding author <email>xuxun@genomics.cn</email></corresp>
      <corresp id="cor2"><label>∗∗</label>Corresponding author <email>panhailin@genomics.cn</email></corresp>
      <corresp id="cor3"><label>∗∗∗</label>Corresponding author <email>baiyinqi@genomics.cn</email></corresp>
      <fn id="fn1">
        <label>6</label>
        <p id="ntpara0010">These authors contributed equally</p>
      </fn>
      <fn id="fn2">
        <label>7</label>
        <p id="ntpara0015">Lead contact</p>
      </fn>
    </author-notes>
    <pub-date pub-type="pmc-release">
      <day>16</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.-->
    <pub-date pub-type="collection">
      <day>08</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>16</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>5</volume>
    <issue>3</issue>
    <elocation-id>100915</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>18</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2023 The Author(s)</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).</license-p>
      </license>
    </permissions>
    <abstract id="abs0010">
      <title>Summary</title>
      <p>Understanding tissue architecture and niche-specific microenvironments in spatially resolved transcriptomics (SRT) requires <italic>in situ</italic> annotation and labeling of cells. Effective spatial visualization of these data demands appropriate colorization of numerous cell types. However, current colorization frameworks often inadequately account for the spatial relationships between cell types. This results in perceptual ambiguity in neighboring cells of biological distinct types, particularly in complex environments such as brain or tumor. To address this, we introduce Spaco, a potent tool for spatially aware colorization. Spaco utilizes the Degree of Interlacement metric to construct a weighted graph that evaluates the spatial relationships among different cell types, refining color assignments. Furthermore, Spaco incorporates an adaptive palette selection approach to amplify chromatic distinctions. When benchmarked on four diverse datasets, Spaco outperforms existing solutions, capturing complex spatial relationships and boosting visual clarity. Spaco ensures broad accessibility by accommodating color vision deficiency and offering open-accessible code in both Python and R.</p>
    </abstract>
    <abstract abstract-type="graphical" id="abs0015">
      <title>Graphical abstract</title>
      <fig id="undfig1" position="anchor">
        <graphic xlink:href="fx1"/>
      </fig>
    </abstract>
    <abstract abstract-type="author-highlights" id="abs0020">
      <title>Highlights</title>
      <p>
        <list list-type="simple" id="ulist0010">
          <list-item id="u0010">
            <label>•</label>
            <p id="p0010">This study underscores the importance of coloring in scientific data visualization</p>
          </list-item>
          <list-item id="u0015">
            <label>•</label>
            <p id="p0015">Authors developed a spatially aware colorization method</p>
          </list-item>
          <list-item id="u0020">
            <label>•</label>
            <p id="p0020">The method proposed a spatial metric modeling the topology among various categories</p>
          </list-item>
          <list-item id="u0025">
            <label>•</label>
            <p id="p0025">Broad accessibility of the method for both full-color vision and colorblind users</p>
          </list-item>
        </list>
      </p>
    </abstract>
    <abstract abstract-type="editor-highlights" id="abs0025">
      <title>The bigger picture</title>
      <p>Data visualization has become an indispensable step in exploring, interpreting, and deriving insights from large-scale analyses. The use of contrastive colorization to visualize categorical labels can significantly enhance visual perception and aid in uncovering underlying patterns. However, when dealing with spatially resolved data, traditional palettes and lexicographical color-category mappings often result in neighboring categories displaying similar colors, thereby making visual differentiation more difficult. To effectively visualize spatial data, colorization methods must consider the positioning of the data points. Spaco is a space-aware colorization method that can be used across research domains to deal with spatial datasets. This software incorporates a new metric that considers the intricate topology of categorical spatial data and is accessible for both full-color and colorblind users.</p>
    </abstract>
    <abstract abstract-type="teaser" id="abs0030">
      <p>The basic idea to visualize categorical data is to select unique colors for each category and use them to plot labeled data points. However, current colorization strategies often lead to biased visual perception. Jing et al. developed a software to perform spatially aware colorization. The authors proposed a metric to model the neighborship between intricately distributed points and achieved adaptive palette generation with optimized color-category mapping. The method can provide enhanced categorical data visualization in diverse research fields.</p>
    </abstract>
    <kwd-group id="kwrds0010">
      <title>Keywords</title>
      <kwd>spatial transcriptomics</kwd>
      <kwd>data visualization</kwd>
      <kwd>tissue topology modeling</kwd>
      <kwd>color palette optimization</kwd>
      <kwd>color vision deficiency support</kwd>
      <kwd>theme color extraction</kwd>
    </kwd-group>
  </article-meta>
  <notes>
    <p id="misc0010">Published: January 16, 2024</p>
  </notes>
</front>
<body>
  <sec id="sec1">
    <title>Introduction</title>
    <p id="p0030">A comprehensive understanding of tissue architecture is rooted in the exploration of anatomical and histological regions, complemented by the study of cell-type spatial organizations. This pursuit has been profoundly advanced by the emergence of spatially resolved transcriptomics (SRT),<xref rid="bib1" ref-type="bibr"><sup>1</sup></xref><sup>,</sup><xref rid="bib2" ref-type="bibr"><sup>2</sup></xref><sup>,</sup><xref rid="bib3" ref-type="bibr"><sup>3</sup></xref><sup>,</sup><xref rid="bib4" ref-type="bibr"><sup>4</sup></xref><sup>,</sup><xref rid="bib5" ref-type="bibr"><sup>5</sup></xref> which has illuminated recent studies in neuroscience,<xref rid="bib6" ref-type="bibr"><sup>6</sup></xref><sup>,</sup><xref rid="bib7" ref-type="bibr"><sup>7</sup></xref> developmental biology,<xref rid="bib8" ref-type="bibr"><sup>8</sup></xref><sup>,</sup><xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and a range of diseases.<xref rid="bib10" ref-type="bibr"><sup>10</sup></xref><sup>,</sup><xref rid="bib11" ref-type="bibr"><sup>11</sup></xref> To visualize and explore these datasets, cells are <italic>in situ</italic> annotated and labeled, creating a cellular cartography where each cell type is distinguished by a unique color.<xref rid="bib12" ref-type="bibr"><sup>12</sup></xref> Therefore, colorization—the process of selecting and assigning colors<xref rid="bib13" ref-type="bibr"><sup>13</sup></xref> to spatially intricately distributed cell clusters—is pivotal to ensure unbiased visual perception and facilitate downstream biological analyses.</p>
    <p id="p0035">Currently, popular data analysis frameworks like Seurat,<xref rid="bib14" ref-type="bibr"><sup>14</sup></xref> Giotto,<xref rid="bib15" ref-type="bibr"><sup>15</sup></xref> Scanpy,<xref rid="bib16" ref-type="bibr"><sup>16</sup></xref> and Squidpy<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref> derive their colorization approaches from widely used data visualization libraries, such as matplotlib<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref> in Python or ggplot2<xref rid="bib19" ref-type="bibr"><sup>19</sup></xref> in R. These methods typically allocate a color palette to cell types either alphabetically or based on descending cell count per type unless a specific order has been manually set. Given that these colorizing principles do not consider the spatial positions of cells, neighboring cells of distinct types often exhibit strikingly similar colors. This becomes particularly challenging for clear visualization in niche-specific microenvironments teeming with multiple cell types, exemplified by brain tissues or tumor niches.</p>
    <p id="p0040">The colorization of cell types for SRT data can be defined as a mathematical problem: given a limited palette, how can we assign more contrasting colors to adjacent cell-type pairs? This poses the challenge of determining the overall proximity of one cell type, which may comprise thousands of cells and is intricately distributed across space, to another. In practice, two cell types might be isolated, adjacent, partially interlaced, or entirely intertwined. However, current public metrics only capture some of these spatial relationships. For instance, the Wasserstein distance<xref rid="bib20" ref-type="bibr"><sup>20</sup></xref> measures the degree of isolation between non-overlapping cell types but lacks sensitivity to various interlaced scenarios. In contrast, the local inverse Simpson’s index<xref rid="bib21" ref-type="bibr"><sup>21</sup></xref> is used to quantify local diversity, determining if cell types are thoroughly intermixed. Palo, a recent palette optimization method,<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> employs the Jaccard index to measure overlaps between the spatial territories of two cell types but shows bias toward spatially sparse cell types.</p>
    <p id="p0045">On the other hand, most existing visualization methods employ pre-set palettes from sources like matplotlib<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref> or colorbrewer.<xref rid="bib23" ref-type="bibr"><sup>23</sup></xref> While these palettes are visually appealing, they eschew high-contrast colors, thereby reducing discernibility. This becomes pressing when coloring high-resolution SRT datasets containing hundreds of cell types. In addition, these palettes did not support color vision deficiency (CVD).<xref rid="bib13" ref-type="bibr"><sup>13</sup></xref></p>
    <p id="p0050">To address these challenges, we developed Spaco, a comprehensive tool tailored for spatially aware colorization of cellular-resolution SRT data. Spaco introduces the Degree of Interlacement (DOI) metric to evaluate the spatial relationship between individual cell-type pairs. Subsequently, a weighted graph, referred to as the cluster interlacement graph (CI-graph), is constructed to globally model these relationships. Using the CI-graph, Spaco facilitates spatially aware cell-color assignment, ensuring that cluster pairs with larger DOIs are visualized in more distinct colors. For enhanced palette discernibility, Spaco introduces an automatic, spatially aware palette selection approach that exploits the embedding of CI-graph vertices to optimally utilize the visible color spectrum. Furthermore, Spaco shows its capabilities to integratively apply these colorization strategies across multiple tissue sections, aiding spatial differential analyses. It can also derive theme color palettes from high-quality images, making it easier to attain aesthetically pleasing, publication-ready colors. Notably, Spaco ensures its broad accessibility by providing CVD support and public distributed codes in both Python and R.</p>
    <p id="p0055">We benchmarked Spaco on four real-world datasets from diverse cellular-resolution SRT assays and tissue types. These datasets include a STARmap mouse brain dataset,<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> a Stereo-seq axolotl brain dataset,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> a sequential fluorescence <italic>in situ</italic> hybridization (seqFISH) mouse embryo dataset,<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and an imaging mass cytometry (IMC) human breast cancer dataset.<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> Our findings illustrate Spaco’s capability to capture a variety of spatial relationships using the DOI metric, produce cell-color assignments with enhanced visual clarity, and curate palettes with hundreds of colors to distinguish fine-grained cell types. Furthermore, Spaco significantly aids downstream biological research, such as detailing intricate anatomical structures and cell co-localization in the mouse brain or highlighting the spatial proliferation of specific cell types in wound-healing axolotls. In summary, our results indicate that Spaco offers superior visual clarity for SRT data visualization compared to existing methodologies.</p>
  </sec>
  <sec id="sec2">
    <title>Results</title>
    <sec id="sec2.1">
      <title>Spaco basics and workflow</title>
      <p id="p0060">Generally, the Spaco colorization process is composed of three primary modules: (1) cell cluster interlacement modeling, (2) color palette selection, and (3) cluster-color assignment (<xref rid="fig1" ref-type="fig">Figure 1</xref>A).<fig id="fig1"><label>Figure 1</label><caption><p>Framework of Spaco for colorization of single-cell-resolution spatial data</p><p>Spaco accepts the coordinates of spatial single cells (or cell centroids) along with the categorical (i.e., cell-type) label of each cell, which can be provided in the widely used AnnData format.<xref rid="bib50" ref-type="bibr"><sup>27</sup></xref> The colorization process consists of three main parts (A). The first part, referred to as cluster interlacement modeling, employs a dual-outlier-free spatial nearest-neighbor algorithm (B) to calculate the Degree of Interlacement (DOI) between cell clusters, forming a cluster interlacement graph (CI-graph). The second part (adaptive palette selection) offers users two modes for color palette selection: a graph-guided algorithm for automatic palette selection based on a previously calculated CI-graph (C) and an image-guided algorithm that extracts an aesthetic theme palette from a user-provided image (D). Once the palette is selected, perceptual differences between all colors are calculated to construct a color difference graph (CD-graph). The final part utilizes a coarse-to-fine stochastic optimization to match the two graphs, resulting in a cluster-color assignment where heavily interlaced clusters are assigned colors with high perceptual differences (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p></caption><graphic xlink:href="gr1"/></fig></p>
      <p id="p0065">In the first module, Spaco accepts a spatial transcriptomic dataset with cell coordinates and corresponding cell-type labels as input. Then, Spaco establishes a DOI metric to form the CI-graph that models the overall topology between clusters, where vertices represent different cell clusters and each edge represents the DOI-assessed spatial relationship between two cell clusters. The DOI is computed via a modified spatial k-nearest neighbor network incorporating a dual-outlier-free strategy, which specifically excludes both spatially sparse cells and cell types in its calculation to enhance the stability (<xref rid="fig1" ref-type="fig">Figure 1</xref>B; see the <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0070">The subsequent module focuses on selecting a discernible color palette and calculating the perceptual differences between selected colors with optional CVD support. In color selection, users have the option to choose from two modes. The first and default mode is to automatically generate colors based on pre-calculated CI-graph (<xref rid="fig1" ref-type="fig">Figure 1</xref>C; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Spaco computes the 3D embedding of the CI-graph vertices using the uniform manifold approximation and projection (UMAP) algorithm.<xref rid="bib27" ref-type="bibr"><sup>28</sup></xref> As these vertex embeddings are expected to retain their relative distances from the original graph, we then scale them to the perceptually uniform CIELab color space,<xref rid="bib28" ref-type="bibr"><sup>29</sup></xref> allowing each vertex to acquire a Lab color. This results in a palette that optimally utilizes the entire color space. The alternative mode does not use spatial information but is designed to facilitate the acquisition of aesthetic colors for publications (<xref rid="fig1" ref-type="fig">Figure 1</xref>D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Given a user-preferred image, Spaco assesses the color frequencies within the image. It then extracts colors iteratively in descending order of these frequencies and updates the frequencies after each iteration to avoid repetitive extraction of similar colors. The iteration stops when the needed number of colors is extracted, forming an initial color palette. The discernibility of the initial palette is further refined using farthest point sampling (FPS).<xref rid="bib29" ref-type="bibr"><sup>30</sup></xref> Both modes allow manual adjustments by users, and the image-palette extraction is supplemented with optional CVD support. After the palette selection, Spaco computes a color difference graph (CD-graph), where the vertices represent the selected colors and the edges denote pairwise perceptual differences with optional CVD simulation (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0075">In the final module, Spaco delegates cluster-color assignments (i.e., pairing) by identifying an optimal match between the CI-graph and the CD-graph (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). A coarse-to-fine stochastic optimization is used to determine these assignments. This graph-matching process aims to find an optimal correspondence (i.e., one-to-one relationship) between the vertices of the CI-graph and those of the CD-graph such that the differences between the edges of the two graphs are minimized. Spaco interprets the correspondence between the CI-graph and CD-graph vertices as an optimized color assignment for cell clusters. The minimized difference between the corresponding edges of the CI- and CD-graphs ensures that clusters with larger DOIs are paired with more distinct colors.</p>
    </sec>
    <sec id="sec2.2">
      <title>Evaluation and benchmarking of DOI metric</title>
      <p id="p0080">Measuring the spatial relationships of cell clusters is fundamental to spatially aware colorization. To assess DOI’s capability in measuring interlacement, we first tested it on simulated data. We generated 10 sets of 2D points, with each set simulating the spatial coordinates of a unique cell cluster (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>A and S1B; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). These clusters were arranged to represent five typical types of spatial relationships: completely mixed, partially interlaced, adjacent, isolated, and distantly isolated (<xref rid="fig2" ref-type="fig">Figure 2</xref>A). Notably, the primary goal of colorization is to enhance the visual distinction among mixed, overlapped, or adjacent clusters. Therefore, we examined the DOI’s capability to differentiate these three scenarios from the other two (isolated and distant). We benchmarked it against three typical types of spatial relationship metrics: distance-based metrics, entropy-based metrics, and spatial-coverage-based metrics. These were exemplified by the Wasserstein distance, the local inverse Simpson’s index (LISI), and the 2D kernel density estimation-Jaccard index (2D KDE), respectively.<fig id="fig2"><label>Figure 2</label><caption><p>Benchmarking the DOI metric using simulated data</p><p>(A) Illustration of five typical spatial relationships observed in cellular SRT data. Colored sidebars highlight the occurrence of these relationships in UMAP-like (single-cell transcriptomic) visualizations, low-resolution SRT, and cellular-resolution SRT data.</p><p>(B) Min-max normalized scores for five differently distributed cluster pairs in the simulation data, evaluated using various metrics (top), accompanied by a visualization detailing the spatial distribution of each cluster pair (bottom).</p><p>(C) Parallel to (B) but for cluster pairs simulated with a sparse constraint (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p></caption><graphic xlink:href="gr2"/></fig></p>
      <p id="p0085">When cells display a dense or continuous distribution, all metrics recorded the highest scores for the mixed cluster pair and the lowest for the distantly isolated pair (<xref rid="fig2" ref-type="fig">Figure 2</xref>B). However, the Wasserstein distance showed a significant difference between the isolated pair and the distantly isolated pair due to its sensitivity to spatial distance. The 2D KDE scored zero for all three non-overlapping pairs, failing to identify the adjacent pair. Both the DOI and LISI successfully distinguished the two isolated cases from the non-isolated ones, serving as appropriate spatial relation metrics to indicate the necessity for distinct colors.</p>
      <p id="p0090">On the other hand, within a real tissue context, certain cell types, such as immunocytes, may display a relatively sparse distribution compared to others. While these cells typically do not dominate the global visualization of an SRT section, they play a crucial role in the biological exploration of cellular niches (e.g., the tumor-immune microenvironments). The DOI metric captured the neighborship (whether mixed, overlapped, or adjacent) of these sparse cluster pairs with relatively low scores. In contrast, other metrics did not demonstrate significant sensitivity to cell sparsity (<xref rid="fig2" ref-type="fig">Figures 2</xref>C, <xref rid="mmc1" ref-type="supplementary-material">S1</xref>C, and S1D). This suggests that the dual-outlier-free strategy employed in the DOI calculation can prevent sparse clusters from having a disproportionate impact during the colorization process.</p>
      <p id="p0095">The robustness of the DOI in response to varying cell sparsity was further illustrated using a public STARmap mouse brain dataset.<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> We presented the cluster pairs with the top three highest scores across all metrics (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>E and S1H). The DOI identified the mixture of inhibitory and excitatory neurons, the partial interlacement between astrocytes and neurons, and the adjacency between the cortex and fiber tract. These observations align with widely discussed topics in cell co-location and brain structure studies<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> (<xref rid="mmc1" ref-type="supplementary-material">Figure S1</xref>E). The Wasserstein distance and LISI seemed to favor cell types with globally similar distributions (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>F and S1G). While these globally sparsely distributed cells might have significant roles in brain functions, their spatial relationships offer limited insight into tissue heterogeneity. The 2D KDE echoed the DOI by emphasizing the mixed neuron subtypes in the cortex (<xref rid="mmc1" ref-type="supplementary-material">Figure S1</xref>H). However, it overestimated the spatial neighborship of sparsely co-located cell types, as its kernel density estimation had a tendency to exaggerate the spatial coverage of sparsely distributed cells.</p>
      <p id="p0100">Collectively, these results demonstrate the DOI’s capability to capture spatial neighborships with biological significance and to serve as a proper metric to constrain the colorization of SRT data.</p>
    </sec>
    <sec id="sec2.3">
      <title>Spaco facilitates the exploration of anatomic structure and cell heterogeneity</title>
      <p id="p0105">Next, we evaluated Spaco’s cell-color assignment method. In high-definition spatial transcriptomics, effective colorization should cater to both a global overview within a large field of view (FOV) and detailed perspectives of micro-FOVs. This dual capacity is biologically relevant for studying anatomical tissue structures and discerning niche heterogeneity. To showcase Spaco’s visualization proficiencies in these contexts, we applied our method to the STARmap mouse brain dataset,<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> which includes 23 pre-annotated cell clusters. These clusters display either spatially dispersed or aggregated distributions, offering a comprehensive assessment of Spaco’s color assignment algorithm (<xref rid="fig3" ref-type="fig">Figure 3</xref>A).<fig id="fig3"><label>Figure 3</label><caption><p>Benchmarking Spaco color assignment on STARmap mouse brain data</p><p>(A) Color assignment of 23 brain-related cell subtypes using Spaco, Spaco’s general-CVD-support mode, Scanpy (matplotlib), random shuffling, and Palo. All methods shared the same color palette generated from Scanpy (matplotlib) by default.</p><p>(B) Anatomical reference from the Allen Brain Atlas<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> corresponding to the STARmap mouse brain section (left) and neighborship between cell clusters that are enriched in one of the brain areas determined according to the anatomical map (right). The vertices of the graph are colored the same as in (A).</p><p>(C) Benchmarking of anatomical visualization in Spaco against other methods. Scatters represent the color difference (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>) between anatomically adjacent cluster pairs determined in (B).</p><p>(D) Same as (C) but for Spaco’s general-CVD-support mode.</p><p>(E) Gridded fields of view (FOVs) of the mouse brain section with 500 × 500 μm each.</p><p>(F) Benchmarking of cellular visualization in Spaco against other methods. Scatters represent the mean cell-cell color difference within each FOV in (E).</p><p>(G) Spaco visualization of the two FOVs with the highest color difference.</p></caption><graphic xlink:href="gr3"/></fig></p>
      <p id="p0110">We compared Spaco’s result with those of Scanpy<xref rid="bib16" ref-type="bibr"><sup>16</sup></xref> (utilizing the default matplotlib visualization), random-shuffled assignment, and Palo<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> (<xref rid="fig3" ref-type="fig">Figure 3</xref>A), all using the same color palette. To benchmark performance based on brain anatomical features, we identified 10 anatomic-region-localized cell clusters (predominant in one anatomic region) after mapping cell types to the Allen Brain Atlas,<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> yielding 17 spatially adjacent cluster pairs (<xref rid="fig3" ref-type="fig">Figure 3</xref>B). Our analysis revealed that Spaco achieved significant visual differences between these anatomically adjacent pairs, as determined by one-sided Wilcoxon tests (no-CVD-support mode, p = 1.45e−4, 2.32e−3, and 4.51e−3 when compared to Scanpy, random assignments, and Palo, respectively) (<xref rid="fig3" ref-type="fig">Figures 3</xref>C and 3D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Additionally, we distributed a questionnaire to experts, comprising 19 neurologists and 34 bioinformaticians, asking them to grade each colorization outcome on a scale of 1–10 based on their professional experience. This survey further underscored the superior visual effectiveness of Spaco’s colorization approach (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>A; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0115">On the other hand, exploring microenvironment heterogeneity requires the zoomed-in visualization of cellular niches. To simulate such scenarios, we arbitrarily divided the data into micro-FOVs measuring 500 × 500 μm each and scored the discernibility of each FOV based on the mean of pairwise color differences among all present cells (<xref rid="fig3" ref-type="fig">Figure 3</xref>E; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). The overall discernibility scores across all FOVs were significantly higher in Spaco’s visualizations, as shown by one-sided Wilcoxon tests (no-CVD-support mode, p = 8.42e−21, 9.16e−19, and 8.87e−21 when compared to Scanpy, random assignments, and Palo, respectively) (<xref rid="fig3" ref-type="fig">Figures 3</xref>F and <xref rid="mmc1" ref-type="supplementary-material">S2</xref>B). FOVs with the highest discernibility scores in Spaco highlighted the co-localization of various neuron subtypes, such as glutamatergic (excitatory), GABAergic (inhibitory), and peptidergic neurons, around the amygdalar area (<xref rid="fig3" ref-type="fig">Figures 3</xref>G and <xref rid="mmc1" ref-type="supplementary-material">S2</xref>C). In contrast, the FOVs with the lowest scores were typically situated at tissue boundaries or contained fewer clusters, indicating that they were less valuable for analyzing cellular heterogeneity (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>D).</p>
      <p id="p0120">Additionally, we sought to determine whether our CI-graph and DOIs contributed to Spaco’s enhanced performance. A notable correlation between DOI scores and color differences (linear regression R-square = 0.45, p = 4e−61) indicated that the subsequent optimization effectively utilized the DOI in Spaco’s color-mapping process (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>E). We further evaluated the time complexity of our algorithm. The colorization process required less than 30 s for simulated datasets encompassing up to 100,000 cells (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>F). Hence, the additional computations do not introduce a substantial time burden.</p>
    </sec>
    <sec id="sec2.4">
      <title>Spaco improves palette discernibility by adaptive color selection</title>
      <p id="p0125">Above, while Spaco effectively enhanced visualization by optimizing the cell-color assignment, its overall performance was still constrained by the discernibility of pre-defined palettes<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref><sup>,</sup><xref rid="bib19" ref-type="bibr"><sup>19</sup></xref><sup>,</sup><xref rid="bib23" ref-type="bibr"><sup>23</sup></xref> (<xref rid="mmc1" ref-type="supplementary-material">Figure S3</xref>A). Therefore, we extended the efficacy of Spaco’s adaptive color selection algorithm to augment palette discernibility and evaluated its two modes of color selection separately (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0130">Firstly, we applied our CI-graph-guided color selection approach to a published Stereo-seq dataset of wound-healing axolotl brain,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> which contains 16 pre-annotated cell types (<xref rid="fig4" ref-type="fig">Figure 4</xref>A). We found that the discernibility of the adaptively generated palette, as quantified by the distribution of pairwise color differences among all palette colors, was significantly higher than that of the pre-defined palette (one-sided Wilcoxon test, p = 1.27e−11) (<xref rid="fig4" ref-type="fig">Figure 4</xref>B). Furthermore, the Spaco-generated palette displayed a bimodal distribution of color differences, suggesting an imbalanced color selection across the color space. This indicates that Spaco adeptly integrated the biases of DOIs in the CI-graph, tailoring color selection to accommodate both distant and adjacent cluster pairs (<xref rid="fig4" ref-type="fig">Figures 4</xref>C and <xref rid="mmc1" ref-type="supplementary-material">S3</xref>B). Analyzing these colors in the CIELab space, we pinpointed three neighboring cell types associated with shades of blue. These colors corresponded to the embedding of spatially distant cell clusters with low DOIs, which are easily distinguishable through subtle color variations (<xref rid="fig4" ref-type="fig">Figure 4</xref>D). Leveraging this, Spaco also effectively crafted a suitable palette for the clear visualization of the STARmap dataset comprising 181 fine-grained cell types (<xref rid="mmc1" ref-type="supplementary-material">Figure S3</xref>C). In contrast, matplotlib failed to capture such a plethora of clusters, producing an uncolored plot due to its limited color pre-sets.<fig id="fig4"><label>Figure 4</label><caption><p>Evaluation of adaptive graph-guided and image-guided palette selection in Spaco</p><p>(A) Colorization of 16 cell clusters in the Stereo-seq axolotl brain dataset,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> using palettes generated by Spaco cluster interlacement graph embedding (left) and Scanpy’s default palette (right).</p><p>(B) Distribution of pairwise color differences within the Spaco-generated palette in (A), compared to Scanpy’s default palette.</p><p>(C) Visualization of the colors from the Spaco-generated palette in the 2D CIELab space (channels a and b).</p><p>(D) Spatial distributions of cell clusters that are highlighted in (C).</p><p>(E) Public journal cover image used to create the image-guided palette (sourced from <italic>Cell</italic>, March 08, 2018, volume 172, issue 6).</p><p>(F) Colors and their frequencies derived from the reference image in (E).</p><p>(G) Colorization of 16 cell clusters in the Stereo-seq axolotl brain dataset using the palette extracted from the image in (E).</p><p>(H) Same as (G) but using Spaco’s general-CVD-support mode.</p><p>(I) Pairwise color differences within the palette extracted from the image compared to Scanpy’s default palette.</p></caption><graphic xlink:href="gr4"/></fig></p>
      <p id="p0135">While maximizing color differences can enhance daily data visualization, researchers occasionally prefer to adopt coloring themes from prior publications or presentations. Spaco supports this requirement with its image-guided palette extraction mode (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). We illustrated this process using a public journal cover image as shown in <xref rid="fig4" ref-type="fig">Figure 4</xref>E. The extracted colors, and their subsequent application to the axolotl dataset, showed comparable discernibility to a pre-defined color palette (tab20 in matplotlib colormap) (Wilcoxon test, p = 1.20e−11) (<xref rid="fig4" ref-type="fig">Figures 4</xref>F–4I). Importantly, this was achieved while preserving the thematic consistency of the original image.</p>
      <p id="p0140">These results underscore Spaco’s capability to navigate the confines of the limited visible color space, achieving superior perceptual discernibility in both daily and publication scenarios.</p>
    </sec>
    <sec id="sec2.5">
      <title>Spaco integratively colors cell clusters across multiple SRT sections</title>
      <p id="p0145">A subsequent challenge in SRT data analysis lies in discerning variations in spatial cell distribution across diverse biological samples. This requires the visualization of multiple tissue sections using a uniform palette and color assignment scheme. To address this, Spaco has been enhanced with a feature that facilitates integrative colorization by seamlessly merging CI-graphs (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0150">We applied Spaco to a time-series study of axolotl brain regeneration.<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> The optimized visualization highlighted an increase in Sfrp+ ependymoglial cells (sfrpEGCs) during the wound-healing progression from 10 days post-injury (DPI-10) to DPI-15. This increase was difficult to detect using Scanpy’s default visualization due to challenges from incorrectly matching telencephalon neuroblasts (TLNBLs) at DPI-10 with sfrpEGCs at DPI-15 (<xref rid="fig5" ref-type="fig">Figures 5</xref>A–5C).<fig id="fig5"><label>Figure 5</label><caption><p>Integrative colorization across multiple plots by Spaco</p><p>(A) Scanpy colorization of two Stereo-seq axolotl datasets (days post-injury 10 and 15), with separate color assignment by default.</p><p>(B) Spaco colorization of the Stereo-seq axolotl datasets using integrative color assignment and sharing the same palette as the Scanpy default plots.</p><p>(C) Highlighted spatial distribution of telencephalon neuroblasts (TLNBLs) and Sfrp+ ependymoglial cells (sfrpEGCs) in (B).</p><p>(D) Cluster-wise intersection over union (IoU) score between two Louvain clustering results; top IoU scores are labeled. Blue digits represent the final correspondences derived using Spaco’s greedy strategy (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p><p>(E) Scanpy colorization of two different Louvain clustering results of DPI-10 dataset, using separate color assignments by default. Red arrow highlights the TLNBL cell cluster.</p><p>(F) Spaco colorization of the two different Louvain clustering results of DPI-10 dataset, using aligned cluster label from (D) and an integrative color assignment and palette selection based on the cluster interlacement graph. Red arrow highlights the TLNBL cell cluster.</p></caption><graphic xlink:href="gr5"/></fig></p>
      <p id="p0155">Additionally, we employed a method to streamline the tuning process in clustering analysis. This approach involved comparing clustering outcomes generated using different parameters. By computing Jaccard indices and employing a greedy matching algorithm, we established correspondences between clusters (<xref rid="fig5" ref-type="fig">Figure 5</xref>D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Contrary to Louvain’s default colorization method, which entirely altered the colors between the two rounds clustering of the same dataset (<xref rid="fig5" ref-type="fig">Figure 5</xref>E), Spaco retained the colors for the cell types annotated in the first round. It then suitably designated colors to newly emerged cell subtypes <italic>in situ</italic>. This directly distinguished WNT+ EGCs (wntEGCs) from TLNBLs in the ventricular zone, aiding biologists in further studying the dynamics of EGCs and the locally newly generated neurons (medial pallium excitatory neuron [mpEX]) during axolotl brain regeneration (<xref rid="fig5" ref-type="fig">Figure 5</xref>F).</p>
    </sec>
    <sec id="sec2.6">
      <title>Spaco is applicable to diverse technologies and tissue types</title>
      <p id="p0160">We extended our testing of Spaco to a seqFISH mouse embryo dataset<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and an IMC human breast cancer dataset.<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> We sourced the color palettes for both datasets from the online tutorial of the Squidpy package.<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref> The optimized color assignment and autogenerated palette by Spaco demonstrated superior visual clarity compared to other methods (<xref rid="mmc1" ref-type="supplementary-material">Figures S4</xref>A and S4B). In the IMC dataset, Spaco’s color assignment aligned with the manual assignment from the Squidpy tutorial, notably mapping cyan to the predominant apoptotic tumor cells. Furthermore, it excelled in differentiating between apoptotic and basal cytokeratins (CK) tumor cells located in the bottom right of the section (<xref rid="mmc1" ref-type="supplementary-material">Figure S4</xref>B).</p>
    </sec>
    <sec id="sec2.7">
      <title>Spaco ensures broad accessibility by supporting diverse userships</title>
      <p id="p0165">As a color-based visualization method, Spaco was designed to adapt to various situations of CVD. Using an LMS (long, medium, short) space-based color conversion method,<xref rid="bib31" ref-type="bibr"><sup>32</sup></xref> Spaco was capable of simulating perceptual colors as perceived by individuals with CVD and modifying color difference calculations (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>) to simultaneously consider three common types of CVD conditions: protanopia, deuteranopia, and tritanopia.</p>
      <p id="p0170">We integrated and tested this feature for both Spaco’s color assignment (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>A–S5D) and its image-guided palette extraction approach (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>E–S5H) on the STARmap mouse brain dataset and the Stereo-seq axolotl dataset, respectively. We excluded our graph-embedding color selection from being CVD friendly due to the absence of a continuous, perceptually uniform CVD color space for UMAP embedding. Notably, Spaco’s CVD-friendly colorization achieved improved discernibility compared visually to Scanpy’s default colorization, not only in all three simulated CVD conditions (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>B, S5D, and S5H) but also in full-color perception (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>A, S5C, and S5G). This is important for ensuring broad readability of Spaco’s visualization for diverse audiences in publications. In addition, Spaco also gives the option to perform CVD-friendly colorization under one given type of CVD, which intends to provide even better support for users with that CVD type in their daily work.</p>
      <p id="p0175">Another key aspect of our approach is to support user communities of both Python and R, the two predominant programming languages in the fields of single-cell and spatial omics. We have made available scripts related to all benchmarking experiments, which are particularly beneficial for users of Python and Scanpy. For the R community, we have constructed a tutorial that demonstrates the combined use of Spaco and Seurat, as illustrated in <xref rid="mmc1" ref-type="supplementary-material">Figure S6</xref>. All of these code resources are available in open-access repositories, as detailed in the <xref rid="sec4.1.3" ref-type="sec">data and code availability</xref> section.</p>
    </sec>
  </sec>
  <sec id="sec3">
    <title>Discussion</title>
    <p id="p0180">On one single spatial transcriptomics chip, millions of cells and hundreds of cell-type clusters organize in spatially structured arrangements. It is conceivable that the cell types can be either isolated, neighbored, partially interlaced, or completely mixed in a tissue, orchestrating the diverse microenvironmental niches. We therefore developed Spaco, an automatic palette selection and colorization tool, to solve this newly emerged data visualization problem. With Spaco, experienced biologists, anatomists, and pathologists can identify the pivotal cell clusters and quickly zoom in on the candidate biological interests based on their spatial characteristics, given their prior knowledge of tissue configuration.</p>
    <p id="p0185">As Spaco is a graph-based method, it possesses many computational applications rooted in graph structure, surpassing existing coloring algorithms. Notably, the identification of an appropriate edge metric to characterize the graph is in the first priority. To develop the DOI metric, we utilized the spatial k-nearest neighbor graph in the local neighborhoods of each cell, which serves as a discrete spatial kernel. Consequently, DOI is able to model the interlacement between spatially scattered cells in cellular SRT data rather than continuous domains in low-resolution SRTs. On the other hand, leveraging the interlacement graphs, Spaco offers the potential to assess variations in tissue topology across different sections by identifying changes in edges (i.e., DOIs). This capability could further facilitate the discovery of topologically conservative or variable cell types over timescales. These functionalities are not available in any other publicly available packages.</p>
    <p id="p0190">While Spaco effectively employs distinct colors to visualize the spatial organization of cell types for biological insights, other studies, such as Baysor<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref> and Bento,<xref rid="bib33" ref-type="bibr"><sup>34</sup></xref> harness the color space for segmenting cells or even subcellular domains in spatial transcriptomic data analyses. The idea of utilizing color-based analyses to explore a variety of biological features is compelling. Another notable example is DeepVariant,<xref rid="bib34" ref-type="bibr"><sup>35</sup></xref> which introduced an approach where sequencing reads are encoded into RGB-colored images to enhance variant-calling accuracy. Though the majority of color space applications currently focus on data visualization, our attempts at downstream color-based graph analysis underscore the potential of adapting color-centric algorithms for broader biological research.</p>
    <p id="p0195">One major limitation of Spaco is its enforcement of a correspondence between color differences and the spatial distribution of cells. However, there might be scenarios where users wish to use similar colors for cell subtypes, regardless of their spatial relationships, or they might want to specify colors for certain cell types to align with existing literature. To address these situations, Spaco offers an option allowing users to manually fix or adjust colors for user-specified cell types and then optimize the color differences for the remaining cell types. Second, the visual contrast that can be obtained through color space is limited when performing CVD-supporting colorization or in the case of coloring hundreds of clusters. It would be helpful to exploit fine-designed CVD-supporting palettes<xref rid="bib35" ref-type="bibr"><sup>36</sup></xref><sup>,</sup><xref rid="bib36" ref-type="bibr"><sup>37</sup></xref> and more rich-formatted techniques like interactive plots and virtual reality. On a different note, while Spaco’s algorithm is theoretically adept at processing 3D data, fine-tuning of parameters is crucial to differentiate “sparse” from “dense” cell types for efficient 3D colorization.</p>
    <p id="p0200">Spaco is implemented in Python using a modularized architecture to seamlessly integrate into a variety of analytical platforms and to incorporate emerging deep-learning-based clustering methods. This approach also facilitates community contributions, extension of new functions, and even the separation of program functions to support individual scripts. As spatial technologies continue to evolve, potentially becoming the primary method for characterizing the molecular profiles of cells, we anticipate that Spaco will become an indispensable tool for researchers across a broad range of biological fields.</p>
  </sec>
  <sec id="sec4">
    <title>Experimental procedures</title>
    <sec id="sec4.1">
      <title>Resource availability</title>
      <sec id="sec4.1.1">
        <title>Lead contact</title>
        <p id="p0205">Further information and requests for resources and reagents should be directed to and will be fulfilled by the lead contact, Yinqi Bai (<email>baiyinqi@genomics.cn</email>).</p>
      </sec>
      <sec id="sec4.1.2">
        <title>Materials availability</title>
        <p id="p0210">This study did not generate new unique materials.</p>
      </sec>
      <sec sec-type="data-availability" id="sec4.1.3">
        <title>Data and code availability</title>
        <p id="p0215">All datasets are public and available for download from their original publications, which are listed as follows.<list list-type="simple" id="olist0010"><list-item id="o0010"><label>(1)</label><p id="p0220">The adult mouse brain STARmap dataset<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1830/" id="intref0015">https://singlecell.broadinstitute.org/single_cell/study/SCP1830/</ext-link>.</p></list-item><list-item id="o0015"><label>(2)</label><p id="p0225">The wound-healing axolotl Stereo-seq datasets<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://db.cngb.org/stomics/artista/download" id="intref0020">https://db.cngb.org/stomics/artista/download</ext-link>.</p></list-item><list-item id="o0020"><label>(3)</label><p id="p0230">The mouse embryo seqFISH dataset<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://marionilab.cruk.cam.ac.uk/SpatialMouseAtlas/" id="intref0025">https://marionilab.cruk.cam.ac.uk/SpatialMouseAtlas/</ext-link>.</p></list-item><list-item id="o0025"><label>(4)</label><p id="p0235">The breast cancer IMC datasets<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.3518284" id="intref0030">https://doi.org/10.5281/zenodo.3518284</ext-link>.</p></list-item></list></p>
        <p id="p0240">Spaco is an open source, collaborative Python package available at Zenodo (<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.10113347" id="intref0035">https://zenodo.org/doi/10.5281/zenodo.10113347</ext-link>)<xref rid="bib37" ref-type="bibr"><sup>38</sup></xref> and also at the GitHub repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco" id="intref0040">https://github.com/BrainStOrmics/Spaco</ext-link>). The scripts to reproduce Spaco’s results and figures are available at <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.10113359" id="intref0045">https://zenodo.org/doi/10.5281/zenodo.10113359</ext-link><xref rid="bib38" ref-type="bibr"><sup>39</sup></xref> and <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco_scripts" id="intref0050">https://github.com/BrainStOrmics/Spaco_scripts</ext-link>. For combinatorial use of Spaco with R, see <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/SpacoR" id="intref0055">https://github.com/BrainStOrmics/SpacoR</ext-link>.</p>
      </sec>
    </sec>
    <sec id="sec4.2">
      <title>Modeling spatial interlacement of clusters</title>
      <sec id="sec4.2.1">
        <title>Design of DOI</title>
        <p id="p0245">To characterize the spatial differentiation between clusters, we assess the interlacement of the cells within each cluster. One of the main challenges in calculating spatial interlacement by estimating cluster overlap in single-cell resolution spatial data arises when cells are sparsely distributed, resulting in variable density within the tissue section. This can lead to an overestimation of the spatial coverage of clusters.</p>
        <p id="p0250">To circumvent the risk of inferring incorrect interlacement relationships from such instances, we employ the k-dimensional tree algorithm to calculate k-nearest neighbors for all cells, with k defaulting to 30. This method draws inspiration from domain identification algorithms that utilize spatial neighbors.<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref><sup>,</sup><xref rid="bib39" ref-type="bibr"><sup>40</sup></xref><sup>,</sup><xref rid="bib40" ref-type="bibr"><sup>41</sup></xref></p>
        <p id="p0255">Additionally, we apply a dual-outlier-free strategy to refine this k-nearest neighbor calculation. The term “dual” pertains to two distinct outlier cell categories.<list list-type="simple" id="olist0015"><list-item id="o0030"><label>(1)</label><p id="p0260">The “sparse-type” outlier, characterized by having fewer than <italic>k</italic> cells within a specified radius <italic>r</italic>. This suggests that the cell occupies a sparsely populated region of the tissue.</p></list-item><list-item id="o0035"><label>(2)</label><p id="p0265">The “orphan-type” outlier, which lacks (or has fewer than a designated number n) cells of its cluster within its neighboring cells. This indicates that the cell might be isolated from the primary group of the cluster or that the cluster itself may have a sparse spatial configuration.</p></list-item></list></p>
        <p id="p0270">For sparse types, Spaco retains only the closest neighbors within the radius <italic>r</italic> (defaulting to 50 μm) to prevent incorrect associations with distant cells. For orphan types, we omit the orphan cells from the neighbor calculations, ensuring we do not overestimate the spatial coverage and interlacement of clusters.</p>
        <p id="p0275">Following these steps, the spatial interlacement is determined pairwise for all clusters using the refined cell-cell neighbor relationships. Let x and y denote the labels (indices) of two distinct clusters. We define the interlacement score between them, <inline-formula><mml:math id="M1" altimg="si1.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>, as<disp-formula id="ufd1"><mml:math id="M2" altimg="si2.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub><mml:mo linebreak="badbreak">=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M3" altimg="si3.gif"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denote the cells in clusters x and y, respectively, and <inline-formula><mml:math id="M4" altimg="si4.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">|</mml:mo></mml:mrow></mml:math></inline-formula> denotes the number of nearest neighbors of cell <inline-formula><mml:math id="M5" altimg="si5.gif"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="M6" altimg="si6.gif"><mml:mrow><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the Euclidean distance between cells <inline-formula><mml:math id="M7" altimg="si7.gif"><mml:mrow><mml:mi>i</mml:mi><mml:mspace width="0.5em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> under the given spatial coordinates.</p>
      </sec>
      <sec id="sec4.2.2">
        <title>Constructing CI-graph</title>
        <p id="p0280">Basically, the interlacement score models the mean inversed distance between the neighboring cells of two clusters. Calculated scores are used to construct a weighted CI-graph, where vertices represent each cluster and edges are weighted by the interlacement scores (i.e., DOIs described in the previous part). The adjacency matrix of this graph is symmetrized (converted to undirected graph) by replacing <inline-formula><mml:math id="M8" altimg="si1.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M9" altimg="si8.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>yx</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="M10" altimg="si9.gif"><mml:mrow><mml:mi mathvariant="italic">Max</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mtext>yx</mml:mtext></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for any x and y, and the diagonal is set to zeros in the matrix.</p>
      </sec>
    </sec>
    <sec id="sec4.3">
      <title>Adaptive color palette selection</title>
      <sec id="sec4.3.1">
        <title>Generating palette using graph embedding</title>
        <p id="p0285">Spaco offers adaptive generation of a color palette by embedding the CI-graph into the CIELab color space.<xref rid="bib28" ref-type="bibr"><sup>29</sup></xref> To achieve this, we utilize UMAP<xref rid="bib27" ref-type="bibr"><sup>28</sup></xref> to compute a 3D embedding of all vertices in the CI-graph. In this configuration, less interlaced clusters present as hubs in the CI-graph since the DOIs (i.e., edge weights) among their corresponding vertices are relatively low. Consequently, these hubs are embedded into aggregately distributed points groups in the 3D UMAP space (like the case in <xref rid="fig4" ref-type="fig">Figure 4</xref>D), leading cluster pairs with lower DOIs to closer distances in the embedded space, and vice versa.</p>
        <p id="p0290">Subsequently, these embeddings are rescaled to fit the value range of the CIELab, a perceptually uniform color space where the difference between colors corresponds to the Euclidean distance. A similar method was adopted in previous studies to colorize single-molecule FISH (smFISH) data based on the niche composition of the captured molecules.<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref></p>
        <p id="p0295">In the CIELab color space, the L, a, and b values typically range within <inline-formula><mml:math id="M11" altimg="si10.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>100</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M12" altimg="si11.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>127</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="M13" altimg="si11.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>127</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, respectively. To prevent the generation of colors that are either too dark or too bright, we further limit the illuminant channel L to a range of <inline-formula><mml:math id="M14" altimg="si12.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:mn>85</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> by default. The final step involves converting the Lab values into RGB hex values to suit general applications.</p>
        <p id="p0300">A limitation of using UMAP involves potential distortion in neighborhood and distance.<xref rid="bib41" ref-type="bibr"><sup>42</sup></xref> Nevertheless, this coarse alignment between DOIs and color differences was sufficient for colorization purposes, whose feasibility was proven in Baysor.<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref> The non-linear nature of UMAP also contributes to Spaco’s robustness against outliers (i.e., heavily isolated vertices in CI-graph causing polarized palettes selection). Optional linear embedding methods in Spaco, such as multidimensional scaling (MDS), can be used for outlier-free cases.</p>
        <p id="p0305">Spaco allows the direct utilization of the embedded colors as effective color mapping depending on the coarse correspondence between DOIs and color differences, and it also provides users options for further optimization in the cluster-color assignment, detailed in the final module.</p>
      </sec>
      <sec id="sec4.3.2">
        <title>Image-guided theme palette extraction</title>
        <p id="p0310">Spaco offers an additional feature for adaptive color palette selection: the extraction of theme colors from images, enabling users to oversee the palette selection process by designating preferred images. Drawing inspiration from recent advancements in computational visual media,<xref rid="bib42" ref-type="bibr"><sup>43</sup></xref> for a given image, we summarize the colors of all pixels in a given image under 3D CIELab color space, using a binning size of 20 (by default) on each dimension (channel). This aggregation condenses all raw pixel colors into a potential maximum of 8,000 distinct binned colors, each represented by the centroid color of its respective bin. Colors falling within the L (illumination channel) range of <inline-formula><mml:math id="M15" altimg="si12.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:mn>85</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> by default (considered either too dark or excessively bright), as well as those occurring below the third percentile in frequency (considered non-theme colors), are excluded from further calculation.</p>
        <p id="p0315">The initial palette is progressively assembled from binned colors, selected in descending order of frequency until the desired number of colors is attained. To prevent the selection of similar colors, we update frequencies during the process, employing the following equation<xref rid="bib43" ref-type="bibr"><sup>44</sup></xref>:<disp-formula id="ufd2"><mml:math id="M16" altimg="si13.gif"><mml:mrow><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo linebreak="badbreak">=</mml:mo><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi mathvariant="italic">exp</mml:mi><mml:mspace width="0.25em"/><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M17" altimg="si14.gif"><mml:mrow><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> denotes the frequency of color <inline-formula><mml:math id="M18" altimg="si15.gif"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> after the <inline-formula><mml:math id="M19" altimg="si16.gif"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>-th selection, with <inline-formula><mml:math id="M20" altimg="si17.gif"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> denoting the pulled color. <inline-formula><mml:math id="M21" altimg="si18.gif"><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the CIEDE2000 color difference metric<xref rid="bib44" ref-type="bibr"><sup>45</sup></xref> in default. <inline-formula><mml:math id="M22" altimg="si19.gif"><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> is set to 80 by default.</p>
        <p id="p0320">Once an initial palette is established, we initiate a refinement process for the palette. We iteratively replace each color in the palette using farthest point sampling<xref rid="bib29" ref-type="bibr"><sup>30</sup></xref> (FPS) to maximize the minimum distance between the replaced color and the rest of the palette, ensuring optimal linear separation. In each iteration, <italic>k</italic> (3 by default) colors that are farthest from the rest of the palette are selected. Subsequently, we evaluate the <italic>k</italic> potential replacements using the formula<disp-formula id="ufd3"><mml:math id="M23" altimg="si20.gif"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:msub><mml:mi>f</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>in which <inline-formula><mml:math id="M24" altimg="si21.gif"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the linear separation of color <inline-formula><mml:math id="M25" altimg="si15.gif"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M26" altimg="si22.gif"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the pre-calculated distance in FPS. <inline-formula><mml:math id="M27" altimg="si23.gif"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M28" altimg="si24.gif"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are weights to balance between <inline-formula><mml:math id="M29" altimg="si21.gif"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M30" altimg="si25.gif"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, defaulting to 0.15 and the inverse of 0.03% of the image’s pixel number, respectively. The color with the highest score is then employed to replace the corresponding color in the current palette. The iteration process concludes when the coefficient of variation (CV) for all pairwise distances within the color palette surpasses the CV of edge weights in the CI-graph or when the number of iterations exceeds the pre-defined limit (set to 20 times the palette size by default). Finally, a conversion from Lab values to RGB hex values is executed to facilitate general usage.</p>
      </sec>
    </sec>
    <sec id="sec4.4">
      <title>Graph-based color assignment</title>
      <sec id="sec4.4.1">
        <title>Calculating perceptual differences and constructing CD-graph</title>
        <p id="p0325">Once an adequate color palette is available, we proceed to construct a CD-graph that captures the color relationships within the palette.</p>
        <p id="p0330">We quantify the pairwise differences between colors by employing a well-established weighted metric within the RGB color space<xref rid="bib45" ref-type="bibr"><sup>46</sup></xref>:<disp-formula id="ufd4"><mml:math id="M31" altimg="si26.gif"><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mo linebreak="badbreak">=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo linebreak="badbreak">+</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="ufd5"><mml:math id="M32" altimg="si27.gif"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>C</mml:mi><mml:mo linebreak="badbreak">=</mml:mo><mml:msqrt><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo linebreak="badbreak">+</mml:mo><mml:mfrac><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>256</mml:mn></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo linebreak="badbreak">+</mml:mo><mml:mn>4</mml:mn><mml:mo>Δ</mml:mo><mml:msup><mml:mi>G</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo linebreak="badbreak">+</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo linebreak="badbreak">+</mml:mo><mml:mfrac><mml:mrow><mml:mn>255</mml:mn><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mn>256</mml:mn></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:msup><mml:mi>B</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M33" altimg="si28.gif"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M34" altimg="si29.gif"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are the red channels of the compared colors. <inline-formula><mml:math id="M35" altimg="si30.gif"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:math></inline-formula> represents the perceptual difference between two RGB colors, and <inline-formula><mml:math id="M36" altimg="si31.gif"><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M37" altimg="si32.gif"><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="M38" altimg="si33.gif"><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:math></inline-formula> stand for the corresponding color channels. The computed differences are utilized as edge weights in the adjacency matrix of the CD-graph.</p>
      </sec>
      <sec id="sec4.4.2">
        <title>Graph matching via coarse-to-fine optimization</title>
        <p id="p0335">The primary objective of color assignment is to ensure that clusters containing closely located or intertwined cells are allocated colors with significant perceptual differences. By utilizing the adjacency matrices of our CI-graph and CD-graph, we can frame the solution to this color-mapping challenge as a graph-matching problem. In this problem, our aim is to establish a one-to-one correspondence between the vertices of the CI-graph and the CD-graph, thereby achieving optimal consistency between the edge weights of the two graphs.</p>
        <p id="p0340">Mathematically, we can express the optimization as an objective function <inline-formula><mml:math id="M39" altimg="si34.gif"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> defined as<disp-formula id="ufd6"><mml:math id="M40" altimg="si35.gif"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mi>P</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi></mml:msub><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M41" altimg="si36.gif"><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:math></inline-formula> is a permutation matrix representing the bijective assignment, in which <inline-formula><mml:math id="M42" altimg="si37.gif"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M43" altimg="si38.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="M44" altimg="si39.gif"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M45" altimg="si40.gif"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the weighted adjacency matrices of CI-graph and CD-graph. <inline-formula><mml:math id="M46" altimg="si41.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>‖</mml:mo><mml:mi>M</mml:mi><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the Frobenius norm of matrix <inline-formula><mml:math id="M47" altimg="si42.gif"><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
        <p id="p0345">Then, we can define the optimal assignment <inline-formula><mml:math id="M48" altimg="si43.gif"><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> to be the solution of following optimization:<disp-formula id="ufd7"><mml:math id="M49" altimg="si44.gif"><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi mathvariant="italic">argmin</mml:mi><mml:mi>P</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mtext>.</mml:mtext></mml:mrow></mml:math></disp-formula></p>
        <p id="p0350">While graph-matching problems of this nature, closely related to the challenging quadratic assignment problem, are known to be NP-hard (NP, nondeterministic polynomial time),<xref rid="bib46" ref-type="bibr"><sup>47</sup></xref><sup>,</sup><xref rid="bib47" ref-type="bibr"><sup>48</sup></xref><sup>,</sup><xref rid="bib48" ref-type="bibr"><sup>49</sup></xref> in the context of cluster-color assignment, we anticipate that the number of clusters will be relatively modest, likely not exceeding thousands.</p>
        <p id="p0355">Therefore, similar to previous methodologies employed in the optimization of palettes for single-cell data,<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> we adopt a straightforward stochastic optimization approach employing a coarse-to-fine strategy. Specifically, Spaco initiates the process by generating a set of permutation matrices (default size of 2,000) and identifies the optimal permutation that yields the minimal loss within this set. Subsequently, Spaco randomly selects a pair of clusters and attempts to refine the loss by exchanging color assignments between the two clusters. This fine-tuning process is iterated until a maximum number of permutations is reached (default value of 5,000) or until the loss remains unchanged for 100 consecutive permutations.</p>
      </sec>
    </sec>
    <sec id="sec4.5">
      <title>Integrative colorization for multiple plots</title>
      <p id="p0360">Furthermore, Spaco extends its capabilities to encompass colorization across multiple datasets or label categories by seamlessly integrating multiple CI-graphs.</p>
      <p id="p0365">Prior to the integration of CI-graphs, it is imperative to establish correspondences among identical cell labels present across distinct datasets. Spaco achieves this by evaluating gene expression similarity between clusters from different datasets, utilizing Pearson correlation across the top 5,000 highly variable genes. This similarity is denoted as <inline-formula><mml:math id="M50" altimg="si45.gif"><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M51" altimg="si46.gif"><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M52" altimg="si47.gif"><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula> are the numbers of unique clusters in two different plots.</p>
      <p id="p0370">Similarly, when aligning distinct label categories, such as when tuning the resolution in the clustering refinement process, the intersection over union (IoU) is employed in place of expression similarities.</p>
      <p id="p0375">Once <inline-formula><mml:math id="M53" altimg="si48.gif"><mml:mrow><mml:msup><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is calculated, we employ a greedy approach to iteratively map <inline-formula><mml:math id="M54" altimg="si49.gif"><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M55" altimg="si50.gif"><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>, where<disp-formula id="ufd8"><mml:math id="M56" altimg="si51.gif"><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi mathvariant="italic">argmax</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mtext>.</mml:mtext></mml:mrow></mml:math></disp-formula></p>
      <p id="p0380">The corresponding row and column of the mapped indices in <inline-formula><mml:math id="M57" altimg="si48.gif"><mml:mrow><mml:msup><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> are then set to zero to ensure injective mapping. This iteration continues until all clusters have been mapped or until <inline-formula><mml:math id="M58" altimg="si52.gif"><mml:mrow><mml:msub><mml:mi mathvariant="italic">max</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> falls below a certain threshold (default to 0 for IoU similarity and 0.5 for normalized expression similarity). Unmapped clusters remain distinct after the iteration concludes. Subsequently, cluster labels in various plots are transformed into unified labels using the established mapping, facilitating the integration of CI-graphs.</p>
    </sec>
    <sec id="sec4.6">
      <title>CVD support</title>
      <p id="p0385">When performing a colorblind-friendly colorization, Spaco slightly adjusts the calculation relating to color differences. Colors are converted to three common types of CVD conditions including protanopia, deuteranopia, and tritanopia, following a previously established transformation.<xref rid="bib49" ref-type="bibr"><sup>50</sup></xref> Then, color perceptual differences are calculated separately using these three sets of simulated CVD colors. Finally, the mean value of these three CVD-simulating color differences and a normally calculated full-color-vision color difference is used (1) in the cluster-color assignment module, as edge weights in the adjacency matrix of the CD-graph, and (2) in the image-palette-extraction module, as color differences to punish color frequency. As for colorblind support for one certain type of CVD, only color differences under the given type of CVD simulation are used.</p>
    </sec>
    <sec id="sec4.7">
      <title>Benchmarking on simulated data</title>
      <sec id="sec4.7.1">
        <title>Generation of simulated dataset</title>
        <p id="p0390">In order to comprehensively evaluate the distance calculation methods for the DOI (Spaco), Wasserstein distance, LISI, and 2D KDE (Palo), we utilized the “normal” function from the “<italic>numpy</italic>.<italic>random</italic>” module to generate multiple sets of 2D points with x and y coordinates following a normal distribution with a standard deviation of 25. These point sets were used to simulate spatial topological relationships. We selected two sets of points with center-to-center distances of 10, 50, 70, 120, and 300, representing five spatial topologies: mixed, overlapped, adjacent, isolated, and distant. Specifically, we generated two types of point sets: dense and sparse. Each dense point set contained 100 points, while each sparse point set contained 25 points. We assessed the results of different calculation methods under the aforementioned five spatial topologies in three scenarios: dense point set with dense point set, sparse point set with sparse point set, and dense point set with sparse point set.</p>
      </sec>
      <sec id="sec4.7.2">
        <title>Calculation of Wasserstein distance</title>
        <p id="p0395">We utilized the Python Optimal Transport (POT; <ext-link ext-link-type="uri" xlink:href="https://pythonot.github.io/index.html" id="intref0060">https://pythonot.github.io/index.html</ext-link>) package to compute the Wasserstein distance between pairwise point sets. The POT package offers several solvers related to Optimal Transport. Specifically, we used the “<italic>dist</italic>” function provided in the package to calculate the distance matrix between individual points of the two sets. Subsequently, we used the “emd2” function to solve the Earth Mover’s distance problem, where the weights of each point were set to be equal. The resulting loss obtained from this computation is considered as the Wasserstein distance between the two point sets.</p>
      </sec>
      <sec id="sec4.7.3">
        <title>Calculation of LISI</title>
        <p id="p0400">The LISI represents the average number of labels present in the N-nearest points.<xref rid="bib21" ref-type="bibr"><sup>21</sup></xref> We used the “<italic>lisi</italic>” function provided in the “scPOP”' R package (<ext-link ext-link-type="uri" xlink:href="https://github.com/vinay-swamy/scPOP" id="intref0065">https://github.com/vinay-swamy/scPOP</ext-link>) to calculate the LISI between two sets of points. Specifically, we inputted all the points from both sets into the function, using the categories of each point as the label. The remaining parameters required by function <italic>lisi</italic> were set to their default values. The resulting LISI value between the two point sets was determined by averaging the LISI values of individual points. To invoke the functionality of R packages in Python, we utilized the “rpy2” package (<ext-link ext-link-type="uri" xlink:href="https://github.com/rpy2/rpy2" id="intref0070">https://github.com/rpy2/rpy2</ext-link>).</p>
      </sec>
      <sec id="sec4.7.4">
        <title>Calculation of 2D KDE</title>
        <p id="p0405">The Palo method provides another approach for the color assignment of palettes considering the spatial relationships of single-cell data.<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> The Palo method consists of three components: spatial overlap score calculation, color dissimilarities calculation, and color assignments. All functionalities are encompassed within the <italic>Palo</italic> function provided in the R package Palo. To meet our evaluation requirements, we extracted the functionality for calculating spatial overlap scores between point sets from the Palo function. We used our complete set of points and categories information as input, and the spatial overlap scores between the point sets calculated by the Palo function were considered as the distances of sets.</p>
      </sec>
    </sec>
    <sec id="sec4.8">
      <title>Benchmarking on real-world data</title>
      <sec id="sec4.8.1">
        <title>Dataset collection</title>
        <p id="p0410">To evaluate the efficacy of Spaco, we collected four distinct real-world datasets spanning different technologies and tissue types.<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref><sup>,</sup><xref rid="bib24" ref-type="bibr"><sup>24</sup></xref><sup>,</sup><xref rid="bib25" ref-type="bibr"><sup>25</sup></xref><sup>,</sup><xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> Each of these datasets has been previously analyzed, as detailed in their original publications. They provide crucial information for Spaco, including expression data, spatial coordinates, and labeling details. These labels represent cell types and anatomical annotations for individual cells or spatial spots. All datasets are publicly available and can be obtained directly from their source publications.</p>
      </sec>
      <sec id="sec4.8.2">
        <title>Measuring perceptual discernibility</title>
        <p id="p0415">As most colors are presented in hexadecimal form of RGB color space, we use the same metric as in CD-graph construction (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>: <xref rid="sec4.4.1" ref-type="sec">calculating perceptual differences</xref>) and employ a CVD simulation (see <xref rid="sec4.6" ref-type="sec">experimental procedures: CVD support</xref>) when benchmarking CVD-supporting colorizations. We measure the discernibility between cell clusters as the perceptual difference between the corresponding colors. For micro-FOVs, the discernibility of a FOV is evaluated as the mean color difference of all cell pairs derived in this FOV. For palettes, the discernibility of a palette is measured as the mean color difference of all color pairs derived in the palette.</p>
      </sec>
      <sec id="sec4.8.3">
        <title>Blind user scoring of colorized spatial plots</title>
        <p id="p0420">To supplementarily assess Spaco’s colorization performance from a user-centric viewpoint, we conducted a single-blind experiment. This experiment involved the creation of a questionnaire administered to 53 participants, all of whom possessed expertise in spatial transcriptomics analysis. The experiment aimed to evaluate the colorization of four distinct plots derived from the STARmap mouse brain dataset<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> using Spaco, Scanpy (matplotlib), random shuffling, and Palo.</p>
        <p id="p0425">Participants were requested to judge the discernibility of all cell clusters in each plot. To provide a reference of cluster distributions, the questionnaire was supplemented with split plots that highlighted each individual cell cluster. Participants were asked to assign scores to these colorized plots, rating them on a scale from 1 (worst) to 10 (best), based on their perceived quality. The original questionnaire and the gathered results are accessible through the following link: <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco_scripts" id="intref0075">https://github.com/BrainStOrmics/Spaco_scripts</ext-link>.</p>
        <p id="p0430">This experimental design allows us to comprehensively gauge and compare the effectiveness of Spaco’s colorization with other methods and to draw insightful conclusions from the gathered evaluations. However, a lack of participants with CVD made this survey limited to a full-color-vision perspective. Also, this survey should only be interpreted as a supplementary evaluation paratactic to our computational metric and did not lead to statistical conclusions due to insufficient sample size and potential bias of individual scoring criteria.</p>
      </sec>
    </sec>
  </sec>
</body>
<back>
  <ref-list id="cebib0010">
    <title>References</title>
    <ref id="bib1">
      <label>1</label>
      <element-citation publication-type="journal" id="sref1">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Barkley</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>França</surname>
            <given-names>G.S.</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I.</given-names>
          </name>
        </person-group>
        <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>
        <source>Nature</source>
        <volume>596</volume>
        <year>2021</year>
        <fpage>211</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="pmid">34381231</pub-id>
      </element-citation>
    </ref>
    <ref id="bib2">
      <label>2</label>
      <element-citation publication-type="journal" id="sref2">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Allen</surname>
            <given-names>W.E.</given-names>
          </name>
          <name>
            <surname>Wright</surname>
            <given-names>M.A.</given-names>
          </name>
          <name>
            <surname>Sylwestrak</surname>
            <given-names>E.L.</given-names>
          </name>
          <name>
            <surname>Samusik</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Vesuna</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Evans</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Ramakrishnan</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>J.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>
        <source>Science</source>
        <volume>361</volume>
        <year>2018</year>
        <object-id pub-id-type="publisher-id">eaat5691</object-id>
      </element-citation>
    </ref>
    <ref id="bib3">
      <label>3</label>
      <element-citation publication-type="journal" id="sref3">
        <person-group person-group-type="author">
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Lawson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Dries</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Takei</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Yun</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Cronin</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Karp</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G.-C.</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH</article-title>
        <source>Nature</source>
        <volume>568</volume>
        <year>2019</year>
        <fpage>235</fpage>
        <lpage>239</lpage>
        <pub-id pub-id-type="pmid">30911168</pub-id>
      </element-citation>
    </ref>
    <ref id="bib4">
      <label>4</label>
      <element-citation publication-type="journal" id="sref4">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>P.L.</given-names>
          </name>
          <name>
            <surname>Salmén</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Vickovic</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Lundmark</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>J.F.</given-names>
          </name>
          <name>
            <surname>Magnusson</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Giacomello</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Asp</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Westholm</surname>
            <given-names>J.O.</given-names>
          </name>
          <name>
            <surname>Huss</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science</source>
        <volume>353</volume>
        <year>2016</year>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="bib5">
      <label>5</label>
      <element-citation publication-type="journal" id="sref5">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Liao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Qiu</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Hao</surname>
            <given-names>S.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>
        <source>Cell</source>
        <volume>185</volume>
        <year>2022</year>
        <fpage>1777</fpage>
        <lpage>1792.e21</lpage>
        <pub-id pub-id-type="pmid">35512705</pub-id>
      </element-citation>
    </ref>
    <ref id="bib6">
      <label>6</label>
      <element-citation publication-type="journal" id="sref6">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Lei</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Liao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Meng</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Bai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Liang</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell spatial transcriptome reveals cell-type organization in the macaque cortex</article-title>
        <source>Cell</source>
        <volume>186</volume>
        <year>2023</year>
        <fpage>3726</fpage>
        <lpage>3743.e24</lpage>
        <pub-id pub-id-type="pmid">37442136</pub-id>
      </element-citation>
    </ref>
    <ref id="bib7">
      <label>7</label>
      <element-citation publication-type="journal" id="sref7">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Siletti</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Furlan</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Gyllborg</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Vinsland</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Mossi Albiach</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Mattsson Langseth</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Khven</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Lederer</surname>
            <given-names>A.R.</given-names>
          </name>
          <name>
            <surname>Dratva</surname>
            <given-names>L.M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the developing mouse brain</article-title>
        <source>Nature</source>
        <volume>596</volume>
        <year>2021</year>
        <fpage>92</fpage>
        <lpage>96</lpage>
        <pub-id pub-id-type="pmid">34321664</pub-id>
      </element-citation>
    </ref>
    <ref id="bib8">
      <label>8</label>
      <element-citation publication-type="journal" id="sref8">
        <person-group person-group-type="author">
          <name>
            <surname>Zeng</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhong</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Qin</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Zeng</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>Y.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The single-cell and spatial transcriptional landscape of human gastrulation and early brain development</article-title>
        <source>Cell Stem Cell</source>
        <volume>30</volume>
        <year>2023</year>
        <fpage>851</fpage>
        <lpage>866.e7</lpage>
        <pub-id pub-id-type="pmid">37192616</pub-id>
      </element-citation>
    </ref>
    <ref id="bib9">
      <label>9</label>
      <element-citation publication-type="journal" id="sref9">
        <person-group person-group-type="author">
          <name>
            <surname>Lohoff</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Ghazanfar</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Missarova</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Pierson</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Griffiths</surname>
            <given-names>J.A.</given-names>
          </name>
          <name>
            <surname>Bardot</surname>
            <given-names>E.S.</given-names>
          </name>
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Tyser</surname>
            <given-names>R.C.V.</given-names>
          </name>
          <name>
            <surname>Argelaguet</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integration of spatial and single-cell transcriptomic data elucidates mouse organogenesis</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>40</volume>
        <year>2022</year>
        <fpage>74</fpage>
        <lpage>85</lpage>
        <pub-id pub-id-type="pmid">34489600</pub-id>
      </element-citation>
    </ref>
    <ref id="bib10">
      <label>10</label>
      <element-citation publication-type="journal" id="sref10">
        <person-group person-group-type="author">
          <name>
            <surname>Berglund</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Maaskola</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Schultz</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Friedrich</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Marklund</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Bergenstråhle</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Tarish</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Tanoglidi</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Vickovic</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Larsson</surname>
            <given-names>L.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial maps of prostate cancer transcriptomes reveal an unexplored landscape of heterogeneity</article-title>
        <source>Nat. Commun.</source>
        <volume>9</volume>
        <year>2018</year>
        <fpage>2419</fpage>
        <pub-id pub-id-type="pmid">29925878</pub-id>
      </element-citation>
    </ref>
    <ref id="bib11">
      <label>11</label>
      <element-citation publication-type="journal" id="sref11">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Yan</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Bai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Zou</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Hou</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Zhong</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An invasive zone in human liver cancer identified by Stereo-seq promotes hepatocyte-tumor cell crosstalk, local immunosuppression and tumor progression</article-title>
        <source>Cell Res.</source>
        <volume>33</volume>
        <year>2023</year>
        <fpage>585</fpage>
        <lpage>603</lpage>
        <pub-id pub-id-type="pmid">37337030</pub-id>
      </element-citation>
    </ref>
    <ref id="bib12">
      <label>12</label>
      <element-citation publication-type="journal" id="sref12">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>Analysis and Visualization of Spatial Transcriptomic Data</article-title>
        <source>Front. Genet.</source>
        <volume>12</volume>
        <year>2021</year>
        <object-id pub-id-type="publisher-id">785290</object-id>
      </element-citation>
    </ref>
    <ref id="bib13">
      <label>13</label>
      <element-citation publication-type="journal" id="sref13">
        <person-group person-group-type="author">
          <name>
            <surname>Crameri</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Shephard</surname>
            <given-names>G.E.</given-names>
          </name>
          <name>
            <surname>Heron</surname>
            <given-names>P.J.</given-names>
          </name>
        </person-group>
        <article-title>The misuse of colour in science communication</article-title>
        <source>Nat. Commun.</source>
        <volume>11</volume>
        <year>2020</year>
        <fpage>5444</fpage>
        <pub-id pub-id-type="pmid">33116149</pub-id>
      </element-citation>
    </ref>
    <ref id="bib14">
      <label>14</label>
      <element-citation publication-type="journal" id="sref14">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>36</volume>
        <year>2018</year>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="bib15">
      <label>15</label>
      <element-citation publication-type="journal" id="sref15">
        <person-group person-group-type="author">
          <name>
            <surname>Dries</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Sarkar</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Bao</surname>
            <given-names>F.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>
        <source>Genome Biol.</source>
        <volume>22</volume>
        <year>2021</year>
        <fpage>78</fpage>
        <pub-id pub-id-type="pmid">33685491</pub-id>
      </element-citation>
    </ref>
    <ref id="bib16">
      <label>16</label>
      <element-citation publication-type="journal" id="sref16">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>F.A.</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>F.J.</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <volume>19</volume>
        <year>2018</year>
        <fpage>15</fpage>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="bib17">
      <label>17</label>
      <element-citation publication-type="journal" id="sref17">
        <person-group person-group-type="author">
          <name>
            <surname>Palla</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Spitzer</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Klein</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Schaar</surname>
            <given-names>A.C.</given-names>
          </name>
          <name>
            <surname>Kuemmerle</surname>
            <given-names>L.B.</given-names>
          </name>
          <name>
            <surname>Rybakov</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Ibarra</surname>
            <given-names>I.L.</given-names>
          </name>
          <name>
            <surname>Holmberg</surname>
            <given-names>O.</given-names>
          </name>
          <name>
            <surname>Virshup</surname>
            <given-names>I.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>
        <source>Nat. Methods</source>
        <volume>19</volume>
        <year>2022</year>
        <fpage>171</fpage>
        <lpage>178</lpage>
        <pub-id pub-id-type="pmid">35102346</pub-id>
      </element-citation>
    </ref>
    <ref id="bib18">
      <label>18</label>
      <element-citation publication-type="journal" id="sref18">
        <person-group person-group-type="author">
          <name>
            <surname>Hunter</surname>
            <given-names>J.D.</given-names>
          </name>
        </person-group>
        <article-title>Matplotlib: A 2D Graphics Environment</article-title>
        <source>Comput. Sci. Eng.</source>
        <volume>9</volume>
        <year>2007</year>
        <fpage>90</fpage>
        <lpage>95</lpage>
      </element-citation>
    </ref>
    <ref id="bib19">
      <label>19</label>
      <element-citation publication-type="journal" id="sref19">
        <person-group person-group-type="author">
          <name>
            <surname>Wickham</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Ggplot2</article-title>
        <source>WIREs Computational Stats.</source>
        <volume>3</volume>
        <year>2011</year>
        <fpage>180</fpage>
        <lpage>185</lpage>
      </element-citation>
    </ref>
    <ref id="bib20">
      <label>20</label>
      <element-citation publication-type="journal" id="sref20">
        <person-group person-group-type="author">
          <name>
            <surname>Vaserstein</surname>
            <given-names>L.N.</given-names>
          </name>
        </person-group>
        <article-title>Markov processes over denumerable products of spaces, describing large systems of automata</article-title>
        <source>Probl. Peredachi Inf.</source>
        <volume>5</volume>
        <year>1969</year>
        <fpage>64</fpage>
        <lpage>72</lpage>
      </element-citation>
    </ref>
    <ref id="bib21">
      <label>21</label>
      <element-citation publication-type="journal" id="sref21">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Millard</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Fan</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Slowikowski</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Wei</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Baglaenko</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Loh</surname>
            <given-names>P.-R.</given-names>
          </name>
          <name>
            <surname>Raychaudhuri</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <volume>16</volume>
        <year>2019</year>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="bib22">
      <label>22</label>
      <element-citation publication-type="journal" id="sref22">
        <person-group person-group-type="author">
          <name>
            <surname>Hou</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>Z.</given-names>
          </name>
        </person-group>
        <article-title>Palo: spatially aware color palette optimization for single-cell and spatial data</article-title>
        <source>Bioinformatics</source>
        <volume>38</volume>
        <year>2022</year>
        <fpage>3654</fpage>
        <lpage>3656</lpage>
        <pub-id pub-id-type="pmid">35642896</pub-id>
      </element-citation>
    </ref>
    <ref id="bib23">
      <label>23</label>
      <element-citation publication-type="journal" id="sref23">
        <person-group person-group-type="author">
          <name>
            <surname>Neuwirth</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Brewer</surname>
            <given-names>R.C.</given-names>
          </name>
        </person-group>
        <article-title>Package RColorBrewer palettes</article-title>
        <source>ColorBrewer palettes</source>
        <year>2014</year>
        <fpage>1</fpage>
      </element-citation>
    </ref>
    <ref id="bib24">
      <label>24</label>
      <element-citation publication-type="journal" id="sref24">
        <person-group person-group-type="author">
          <name>
            <surname>Shi</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Maher</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Tan</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial atlas of the mouse central nervous system at molecular resolution</article-title>
        <source>Nature</source>
        <volume>1–10</volume>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib25">
      <label>25</label>
      <element-citation publication-type="journal" id="sref25">
        <person-group person-group-type="author">
          <name>
            <surname>Wei</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Zeng</surname>
            <given-names>Y.-Y.</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell Stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>
        <source>Science</source>
        <volume>377</volume>
        <year>2022</year>
        <object-id pub-id-type="publisher-id">eabp9444</object-id>
      </element-citation>
    </ref>
    <ref id="bib26">
      <label>26</label>
      <element-citation publication-type="journal" id="sref26">
        <person-group person-group-type="author">
          <name>
            <surname>Jackson</surname>
            <given-names>H.W.</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>J.R.</given-names>
          </name>
          <name>
            <surname>Zanotelli</surname>
            <given-names>V.R.T.</given-names>
          </name>
          <name>
            <surname>Ali</surname>
            <given-names>H.R.</given-names>
          </name>
          <name>
            <surname>Mechera</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Soysal</surname>
            <given-names>S.D.</given-names>
          </name>
          <name>
            <surname>Moch</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Muenst</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Varga</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>W.P.</given-names>
          </name>
          <name>
            <surname>Bodenmiller</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <article-title>The single-cell pathology landscape of breast cancer</article-title>
        <source>Nature</source>
        <volume>578</volume>
        <year>2020</year>
        <fpage>615</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="pmid">31959985</pub-id>
      </element-citation>
    </ref>
    <ref id="bib50">
      <label>27</label>
      <element-citation publication-type="journal" id="sref50">
        <person-group person-group-type="author">
          <name>
            <surname>Virshup</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Rybakov</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>F.J.</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Alexander Wolf</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <article-title>anndata: Annotated data</article-title>
        <comment>Preprint at</comment>
        <source>bioRxiv</source>
        <year>2021</year>
        <pub-id pub-id-type="doi">10.1101/2021.12.16.473007</pub-id>
      </element-citation>
    </ref>
    <ref id="bib27">
      <label>28</label>
      <element-citation publication-type="journal" id="sref28">
        <person-group person-group-type="author">
          <name>
            <surname>McInnes</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Healy</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Melville</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction</article-title>
        <comment>Preprint at</comment>
        <source>arXiv</source>
        <year>2018</year>
        <pub-id pub-id-type="doi">10.48550/arXiv.1802.03426</pub-id>
      </element-citation>
    </ref>
    <ref id="bib28">
      <label>29</label>
      <element-citation publication-type="journal" id="sref51">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Wandell</surname>
            <given-names>B.A.</given-names>
          </name>
        </person-group>
        <article-title>A Spatial Extension of CIELAB for digital color image reproduction</article-title>
        <source>J. Soc. Inf. Display</source>
        <volume>5</volume>
        <year>2012</year>
        <fpage>61</fpage>
        <lpage>63</lpage>
      </element-citation>
    </ref>
    <ref id="bib29">
      <label>30</label>
      <element-citation publication-type="journal" id="sref29">
        <person-group person-group-type="author">
          <name>
            <surname>Eldar</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Lindenbaum</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Porat</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Zeevi</surname>
            <given-names>Y.Y.</given-names>
          </name>
        </person-group>
        <article-title>The farthest point strategy for progressive image sampling</article-title>
        <source>IEEE Trans. Image Process.</source>
        <volume>6</volume>
        <year>1997</year>
        <fpage>1305</fpage>
        <lpage>1315</lpage>
        <pub-id pub-id-type="pmid">18283019</pub-id>
      </element-citation>
    </ref>
    <ref id="bib30">
      <label>31</label>
      <element-citation publication-type="journal" id="sref30">
        <person-group person-group-type="author">
          <name>
            <surname>Sunkin</surname>
            <given-names>S.M.</given-names>
          </name>
          <name>
            <surname>Ng</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lau</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Dolbeare</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Gilbert</surname>
            <given-names>T.L.</given-names>
          </name>
          <name>
            <surname>Thompson</surname>
            <given-names>C.L.</given-names>
          </name>
          <name>
            <surname>Hawrylycz</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Dang</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Allen Brain Atlas: an integrated spatio-temporal portal for exploring the central nervous system</article-title>
        <source>Nucleic Acids Res.</source>
        <volume>41</volume>
        <year>2013</year>
        <fpage>D996</fpage>
        <lpage>D1008</lpage>
        <pub-id pub-id-type="pmid">23193282</pub-id>
      </element-citation>
    </ref>
    <ref id="bib31">
      <label>32</label>
      <element-citation publication-type="journal" id="sref31">
        <person-group person-group-type="author">
          <name>
            <surname>Brettel</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Viénot</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Mollon</surname>
            <given-names>J.D.</given-names>
          </name>
        </person-group>
        <article-title>Computerized simulation of color appearance for dichromats</article-title>
        <source>J. Opt. Soc. Am. Opt Image Sci. Vis.</source>
        <volume>14</volume>
        <year>1997</year>
        <fpage>2647</fpage>
        <lpage>2655</lpage>
      </element-citation>
    </ref>
    <ref id="bib32">
      <label>33</label>
      <element-citation publication-type="journal" id="sref32">
        <person-group person-group-type="author">
          <name>
            <surname>Petukhov</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>R.J.</given-names>
          </name>
          <name>
            <surname>Soldatov</surname>
            <given-names>R.A.</given-names>
          </name>
          <name>
            <surname>Cadinu</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Khodosevich</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Moffitt</surname>
            <given-names>J.R.</given-names>
          </name>
          <name>
            <surname>Kharchenko</surname>
            <given-names>P.V.</given-names>
          </name>
        </person-group>
        <article-title>Cell segmentation in imaging-based spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>40</volume>
        <year>2022</year>
        <fpage>345</fpage>
        <lpage>354</lpage>
        <pub-id pub-id-type="pmid">34650268</pub-id>
      </element-citation>
    </ref>
    <ref id="bib33">
      <label>34</label>
      <element-citation publication-type="journal" id="sref33">
        <person-group person-group-type="author">
          <name>
            <surname>Mah</surname>
            <given-names>C.K.</given-names>
          </name>
          <name>
            <surname>Ahmed</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Lam</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Monell</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Kern</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Cesnik</surname>
            <given-names>A.J.</given-names>
          </name>
          <name>
            <surname>Lundberg</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Carter</surname>
            <given-names>H.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bento: A toolkit for subcellular analysis of spatial transcriptomics data</article-title>
        <source>Preprint at bioRxiv</source>
        <year>2022</year>
        <pub-id pub-id-type="doi">10.1101/2022.06.10.495510</pub-id>
      </element-citation>
    </ref>
    <ref id="bib34">
      <label>35</label>
      <element-citation publication-type="journal" id="sref34">
        <person-group person-group-type="author">
          <name>
            <surname>Poplin</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>P.-C.</given-names>
          </name>
          <name>
            <surname>Alexander</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Schwartz</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Colthurst</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Ku</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Newburger</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Dijamco</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Nguyen</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Afshar</surname>
            <given-names>P.T.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A universal SNP and small-indel variant caller using deep neural networks</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>36</volume>
        <year>2018</year>
        <fpage>983</fpage>
        <lpage>987</lpage>
        <pub-id pub-id-type="pmid">30247488</pub-id>
      </element-citation>
    </ref>
    <ref id="bib35">
      <label>36</label>
      <element-citation publication-type="journal" id="sref35">
        <person-group person-group-type="author">
          <name>
            <surname>Bunis</surname>
            <given-names>D.G.</given-names>
          </name>
          <name>
            <surname>Andrews</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Fragiadakis</surname>
            <given-names>G.K.</given-names>
          </name>
          <name>
            <surname>Burt</surname>
            <given-names>T.D.</given-names>
          </name>
          <name>
            <surname>Sirota</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>dittoSeq: universal user-friendly single-cell and bulk RNA sequencing visualization toolkit</article-title>
        <source>Bioinformatics</source>
        <volume>36</volume>
        <year>2021</year>
        <fpage>5535</fpage>
        <lpage>5536</lpage>
        <pub-id pub-id-type="pmid">33313640</pub-id>
      </element-citation>
    </ref>
    <ref id="bib36">
      <label>37</label>
      <element-citation publication-type="book" id="sref36">
        <person-group person-group-type="author">
          <name>
            <surname>Crameri</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <source>Scientific Colour Maps (8.0.1). Zenodo</source>
        <year>2023</year>
        <pub-id pub-id-type="doi">10.5281/zenodo.1243862</pub-id>
      </element-citation>
    </ref>
    <ref id="bib37">
      <label>38</label>
      <element-citation publication-type="other" id="sref37">
        <person-group person-group-type="author">
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
        </person-group>
        <article-title>BrainStOrmics/Spaco: Spaco 0.2. Zenodo</article-title>
        <pub-id pub-id-type="doi">10.5281/zenodo.10121765</pub-id>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib38">
      <label>39</label>
      <element-citation publication-type="other" id="sref38">
        <person-group person-group-type="author">
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
        </person-group>
        <article-title>BrainStOrmics/Spaco_scripts: Spaco_scripts_231111. Zenodo</article-title>
        <pub-id pub-id-type="doi">10.5281/zenodo.10113360</pub-id>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib39">
      <label>40</label>
      <element-citation publication-type="journal" id="sref39">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Stone</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Ren</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Guenthoer</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Smythe</surname>
            <given-names>K.S.</given-names>
          </name>
          <name>
            <surname>Pulliam</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>S.R.</given-names>
          </name>
          <name>
            <surname>Uytingco</surname>
            <given-names>C.R.</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>S.E.B.</given-names>
          </name>
          <name>
            <surname>Nghiem</surname>
            <given-names>P.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>39</volume>
        <year>2021</year>
        <fpage>1375</fpage>
        <lpage>1384</lpage>
        <pub-id pub-id-type="pmid">34083791</pub-id>
      </element-citation>
    </ref>
    <ref id="bib40">
      <label>41</label>
      <element-citation publication-type="journal" id="sref40">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Coleman</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Schroeder</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Irwin</surname>
            <given-names>D.J.</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>E.B.</given-names>
          </name>
          <name>
            <surname>Shinohara</surname>
            <given-names>R.T.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>
        <source>Nat. Methods</source>
        <volume>18</volume>
        <year>2021</year>
        <fpage>1342</fpage>
        <lpage>1351</lpage>
        <pub-id pub-id-type="pmid">34711970</pub-id>
      </element-citation>
    </ref>
    <ref id="bib41">
      <label>42</label>
      <element-citation publication-type="journal" id="sref41">
        <person-group person-group-type="author">
          <name>
            <surname>Chari</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>The specious art of single-cell genomics</article-title>
        <source>PLoS Comput. Biol.</source>
        <volume>19</volume>
        <year>2023</year>
        <object-id pub-id-type="publisher-id">e1011288</object-id>
      </element-citation>
    </ref>
    <ref id="bib42">
      <label>43</label>
      <element-citation publication-type="journal" id="sref42">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Lanir</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Image-guided color mapping for categorical data visualization</article-title>
        <source>Comput. Vis. Media (Beijing).</source>
        <volume>8</volume>
        <year>2022</year>
        <fpage>613</fpage>
        <lpage>629</lpage>
      </element-citation>
    </ref>
    <ref id="bib43">
      <label>44</label>
      <element-citation publication-type="journal" id="sref43">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Xiao</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <article-title>Palette-Based Image Recoloring Using Color Decomposition Optimization</article-title>
        <source>IEEE Trans. Image Process.</source>
        <volume>26</volume>
        <year>2017</year>
        <fpage>1952</fpage>
        <lpage>1964</lpage>
        <pub-id pub-id-type="pmid">28237926</pub-id>
      </element-citation>
    </ref>
    <ref id="bib44">
      <label>45</label>
      <element-citation publication-type="journal" id="sref44">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Cui</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Rigg</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <article-title>The development of the CIE 2000 colour-difference formula: CIEDE2000</article-title>
        <source>Color Res. Appl.</source>
        <volume>26</volume>
        <year>2001</year>
        <fpage>340</fpage>
        <lpage>350</lpage>
      </element-citation>
    </ref>
    <ref id="bib45">
      <label>46</label>
      <element-citation publication-type="other" id="sref45">
        <person-group person-group-type="author">
          <name>
            <surname>Riemersma</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>Colour Metric</article-title>
        <ext-link ext-link-type="uri" xlink:href="https://www.compuphase.com/cmetric.htm" id="interref0020">https://www.compuphase.com/cmetric.htm</ext-link>
        <year>2019</year>
      </element-citation>
    </ref>
    <ref id="bib46">
      <label>47</label>
      <element-citation publication-type="journal" id="sref46">
        <person-group person-group-type="author">
          <name>
            <surname>Grohe</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Rattan</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Woeginger</surname>
            <given-names>G.J.</given-names>
          </name>
        </person-group>
        <article-title>Graph Similarity and Approximate Isomorphism</article-title>
        <comment>Preprint at</comment>
        <source>arXiv</source>
        <year>2018</year>
        <pub-id pub-id-type="doi">10.48550/arXiv.1802.08509</pub-id>
      </element-citation>
    </ref>
    <ref id="bib47">
      <label>48</label>
      <element-citation publication-type="journal" id="sref47">
        <person-group person-group-type="author">
          <name>
            <surname>Koopmans</surname>
            <given-names>T.C.</given-names>
          </name>
          <name>
            <surname>Beckmann</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Assignment problems and the location of economic activities</article-title>
        <source>Econometrica</source>
        <volume>25</volume>
        <year>1957</year>
        <fpage>53</fpage>
      </element-citation>
    </ref>
    <ref id="bib48">
      <label>49</label>
      <element-citation publication-type="journal" id="sref48">
        <person-group person-group-type="author">
          <name>
            <surname>Sahni</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Gonzalez</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>P-complete approximation problems</article-title>
        <source>J. ACM</source>
        <volume>23</volume>
        <year>1976</year>
        <fpage>555</fpage>
        <lpage>565</lpage>
      </element-citation>
    </ref>
    <ref id="bib49">
      <label>50</label>
      <element-citation publication-type="journal" id="sref49">
        <person-group person-group-type="author">
          <name>
            <surname>Elrefaei</surname>
            <given-names>L.A.</given-names>
          </name>
        </person-group>
        <article-title>Smartphone Based Image Color Correction for Color Blindness</article-title>
        <source>Int. J. Interact. Mob. Technol.</source>
        <volume>12</volume>
        <year>2018</year>
        <fpage>104</fpage>
        <lpage>119</lpage>
      </element-citation>
    </ref>
  </ref-list>
  <sec id="appsec2" sec-type="supplementary-material">
    <title>Supplemental information</title>
    <p id="p0460">
      <supplementary-material content-type="local-data" id="mmc1">
        <caption>
          <title>Document S1. Figures S1–S6</title>
        </caption>
        <media xlink:href="mmc1.pdf"/>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="mmc2">
        <caption>
          <title>Document S2. Article plus supplemental information</title>
        </caption>
        <media xlink:href="mmc2.pdf"/>
      </supplementary-material>
    </p>
  </sec>
  <ack id="ack0010">
    <title>Acknowledgments</title>
    <p id="p0435">This work was supported by the <funding-source id="gs1"><institution-wrap><institution-id institution-id-type="doi">10.13039/501100012166</institution-id><institution>National Key R&amp;D Program of China</institution></institution-wrap></funding-source> (2022YFC3400400) (X.X.) and the <funding-source id="gs2">Guangdong Provincial Key Laboratory of Genome Read and Write</funding-source> (X.X.). We are sincerely thankful for the technical support provided by <funding-source id="gs3">China National Gene Bank</funding-source>.</p>
    <sec id="sec5">
      <title>Author contributions</title>
      <p id="p0440">Conceptualization, Y.B. and H.P.; methodology, Z.J. and Q.Z.; software, Z.J., Q.Z., and L.L.; formal analysis, Z.J., L.L., Y.X., and Q.Z.; validation, Z.J. and Y.X.; investigation, Y.X. and B.Y.; writing – original draft, Z.J.; writing – review &amp; editing, Z.J., Y.B., X.W., L.L., H.P., Y.X., Q.F., and B.D.; funding acquisition, X.X.; resources, Y.B. and X.X.; supervision, Y.B., H.P., and X.X.</p>
    </sec>
    <sec sec-type="COI-statement" id="sec6">
      <title>Declaration of interests</title>
      <p id="p0445">The authors declare no competing interests.</p>
    </sec>
    <sec id="sec7">
      <title>Declaration of generative AI and AI-assisted technologies in the writing process</title>
      <p id="p0450">During the preparation of this work, the authors used ChatGPT 4.0 (GPT-4) in order to facilitate the process of proofreading the contents of our draft. After using this tool/service, the authors reviewed and edited the content as needed and take full responsibility for the content of the publication.</p>
    </sec>
  </ack>
  <fn-group>
    <fn id="appsec1" fn-type="supplementary-material">
      <p id="p0455">Supplemental information can be found online at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.patter.2023.100915" id="intref0080">https://doi.org/10.1016/j.patter.2023.100915</ext-link>.</p>
    </fn>
  </fn-group>
</back>
<?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName art560.dtd?>
<?SourceDTD.Version 5.6.0?>
<?ConverterInfo.XSLTName elsevier2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin publisher?>
<?FILEmeta_PATTER100915 xml ?>
<?FILEmain xml ?>
<?FILEmain pdf ?>
<?FILEgr1 jpg ?>
<?FILEgr2 jpg ?>
<?FILEgr3 jpg ?>
<?FILEgr4 jpg ?>
<?FILEgr5 jpg ?>
<?FILEfx1 jpg ?>
<?FILEmmc1 pdf ?>
<?FILEmmc2 pdf ?>
<?FILEsi1 gif ?>
<?FILEsi2 gif ?>
<?FILEsi3 gif ?>
<?FILEsi4 gif ?>
<?FILEsi5 gif ?>
<?FILEsi6 gif ?>
<?FILEsi7 gif ?>
<?FILEsi8 gif ?>
<?FILEsi9 gif ?>
<?FILEsi10 gif ?>
<?FILEsi11 gif ?>
<?FILEsi12 gif ?>
<?FILEsi13 gif ?>
<?FILEsi14 gif ?>
<?FILEsi15 gif ?>
<?FILEsi16 gif ?>
<?FILEsi17 gif ?>
<?FILEsi18 gif ?>
<?FILEsi19 gif ?>
<?FILEsi20 gif ?>
<?FILEsi21 gif ?>
<?FILEsi22 gif ?>
<?FILEsi23 gif ?>
<?FILEsi24 gif ?>
<?FILEsi25 gif ?>
<?FILEsi26 gif ?>
<?FILEsi27 gif ?>
<?FILEsi28 gif ?>
<?FILEsi29 gif ?>
<?FILEsi30 gif ?>
<?FILEsi31 gif ?>
<?FILEsi32 gif ?>
<?FILEsi33 gif ?>
<?FILEsi34 gif ?>
<?FILEsi35 gif ?>
<?FILEsi36 gif ?>
<?FILEsi37 gif ?>
<?FILEsi38 gif ?>
<?FILEsi39 gif ?>
<?FILEsi40 gif ?>
<?FILEsi41 gif ?>
<?FILEsi42 gif ?>
<?FILEsi43 gif ?>
<?FILEsi44 gif ?>
<?FILEsi45 gif ?>
<?FILEsi46 gif ?>
<?FILEsi47 gif ?>
<?FILEsi48 gif ?>
<?FILEsi49 gif ?>
<?FILEsi50 gif ?>
<?FILEsi51 gif ?>
<?FILEsi52 gif ?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Patterns (N Y)</journal-id>
    <journal-id journal-id-type="iso-abbrev">Patterns (N Y)</journal-id>
    <journal-title-group>
      <journal-title>Patterns</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2666-3899</issn>
    <publisher>
      <publisher-name>Elsevier</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10935509</article-id>
    <article-id pub-id-type="pii">S2666-3899(23)00324-0</article-id>
    <article-id pub-id-type="doi">10.1016/j.patter.2023.100915</article-id>
    <article-id pub-id-type="publisher-id">100915</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Spaco: A comprehensive tool for coloring spatial data at single-cell resolution</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="au1">
        <name>
          <surname>Jing</surname>
          <given-names>Zehua</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au2">
        <name>
          <surname>Zhu</surname>
          <given-names>Qianhua</given-names>
        </name>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au3">
        <name>
          <surname>Li</surname>
          <given-names>Linxuan</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au4">
        <name>
          <surname>Xie</surname>
          <given-names>Yue</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn1" ref-type="fn">6</xref>
      </contrib>
      <contrib contrib-type="author" id="au5">
        <name>
          <surname>Wu</surname>
          <given-names>Xinchao</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff5" ref-type="aff">5</xref>
      </contrib>
      <contrib contrib-type="author" id="au6">
        <name>
          <surname>Fang</surname>
          <given-names>Qi</given-names>
        </name>
        <xref rid="aff4" ref-type="aff">4</xref>
      </contrib>
      <contrib contrib-type="author" id="au7">
        <name>
          <surname>Yang</surname>
          <given-names>Bolin</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff3" ref-type="aff">3</xref>
      </contrib>
      <contrib contrib-type="author" id="au8">
        <name>
          <surname>Dai</surname>
          <given-names>Baojun</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff5" ref-type="aff">5</xref>
      </contrib>
      <contrib contrib-type="author" id="au9">
        <name>
          <surname>Xu</surname>
          <given-names>Xun</given-names>
        </name>
        <email>xuxun@genomics.cn</email>
        <xref rid="aff1" ref-type="aff">1</xref>
        <xref rid="aff2" ref-type="aff">2</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="cor1" ref-type="corresp">∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au10">
        <name>
          <surname>Pan</surname>
          <given-names>Hailin</given-names>
        </name>
        <email>panhailin@genomics.cn</email>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="cor2" ref-type="corresp">∗∗</xref>
      </contrib>
      <contrib contrib-type="author" id="au11">
        <name>
          <surname>Bai</surname>
          <given-names>Yinqi</given-names>
        </name>
        <email>baiyinqi@genomics.cn</email>
        <xref rid="aff3" ref-type="aff">3</xref>
        <xref rid="aff4" ref-type="aff">4</xref>
        <xref rid="fn2" ref-type="fn">7</xref>
        <xref rid="cor3" ref-type="corresp">∗∗∗</xref>
      </contrib>
      <aff id="aff1"><label>1</label>College of Life Sciences, University of Chinese Academy of Sciences, Beijing 100049, China</aff>
      <aff id="aff2"><label>2</label>Guangdong Provincial Key Laboratory of Genome Read and Write, BGI Research, Shenzhen 518083, China</aff>
      <aff id="aff3"><label>3</label>BGI Research, Hangzhou 310012, China</aff>
      <aff id="aff4"><label>4</label>BGI Research, Shenzhen 518083, China</aff>
      <aff id="aff5"><label>5</label>School of Life Sciences, Southern University of Science and Technology, Shenzhen 518055, China</aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>∗</label>Corresponding author <email>xuxun@genomics.cn</email></corresp>
      <corresp id="cor2"><label>∗∗</label>Corresponding author <email>panhailin@genomics.cn</email></corresp>
      <corresp id="cor3"><label>∗∗∗</label>Corresponding author <email>baiyinqi@genomics.cn</email></corresp>
      <fn id="fn1">
        <label>6</label>
        <p id="ntpara0010">These authors contributed equally</p>
      </fn>
      <fn id="fn2">
        <label>7</label>
        <p id="ntpara0015">Lead contact</p>
      </fn>
    </author-notes>
    <pub-date pub-type="pmc-release">
      <day>16</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.-->
    <pub-date pub-type="collection">
      <day>08</day>
      <month>3</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>16</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>5</volume>
    <issue>3</issue>
    <elocation-id>100915</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>9</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>18</day>
        <month>12</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2023 The Author(s)</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).</license-p>
      </license>
    </permissions>
    <abstract id="abs0010">
      <title>Summary</title>
      <p>Understanding tissue architecture and niche-specific microenvironments in spatially resolved transcriptomics (SRT) requires <italic>in situ</italic> annotation and labeling of cells. Effective spatial visualization of these data demands appropriate colorization of numerous cell types. However, current colorization frameworks often inadequately account for the spatial relationships between cell types. This results in perceptual ambiguity in neighboring cells of biological distinct types, particularly in complex environments such as brain or tumor. To address this, we introduce Spaco, a potent tool for spatially aware colorization. Spaco utilizes the Degree of Interlacement metric to construct a weighted graph that evaluates the spatial relationships among different cell types, refining color assignments. Furthermore, Spaco incorporates an adaptive palette selection approach to amplify chromatic distinctions. When benchmarked on four diverse datasets, Spaco outperforms existing solutions, capturing complex spatial relationships and boosting visual clarity. Spaco ensures broad accessibility by accommodating color vision deficiency and offering open-accessible code in both Python and R.</p>
    </abstract>
    <abstract abstract-type="graphical" id="abs0015">
      <title>Graphical abstract</title>
      <fig id="undfig1" position="anchor">
        <graphic xlink:href="fx1"/>
      </fig>
    </abstract>
    <abstract abstract-type="author-highlights" id="abs0020">
      <title>Highlights</title>
      <p>
        <list list-type="simple" id="ulist0010">
          <list-item id="u0010">
            <label>•</label>
            <p id="p0010">This study underscores the importance of coloring in scientific data visualization</p>
          </list-item>
          <list-item id="u0015">
            <label>•</label>
            <p id="p0015">Authors developed a spatially aware colorization method</p>
          </list-item>
          <list-item id="u0020">
            <label>•</label>
            <p id="p0020">The method proposed a spatial metric modeling the topology among various categories</p>
          </list-item>
          <list-item id="u0025">
            <label>•</label>
            <p id="p0025">Broad accessibility of the method for both full-color vision and colorblind users</p>
          </list-item>
        </list>
      </p>
    </abstract>
    <abstract abstract-type="editor-highlights" id="abs0025">
      <title>The bigger picture</title>
      <p>Data visualization has become an indispensable step in exploring, interpreting, and deriving insights from large-scale analyses. The use of contrastive colorization to visualize categorical labels can significantly enhance visual perception and aid in uncovering underlying patterns. However, when dealing with spatially resolved data, traditional palettes and lexicographical color-category mappings often result in neighboring categories displaying similar colors, thereby making visual differentiation more difficult. To effectively visualize spatial data, colorization methods must consider the positioning of the data points. Spaco is a space-aware colorization method that can be used across research domains to deal with spatial datasets. This software incorporates a new metric that considers the intricate topology of categorical spatial data and is accessible for both full-color and colorblind users.</p>
    </abstract>
    <abstract abstract-type="teaser" id="abs0030">
      <p>The basic idea to visualize categorical data is to select unique colors for each category and use them to plot labeled data points. However, current colorization strategies often lead to biased visual perception. Jing et al. developed a software to perform spatially aware colorization. The authors proposed a metric to model the neighborship between intricately distributed points and achieved adaptive palette generation with optimized color-category mapping. The method can provide enhanced categorical data visualization in diverse research fields.</p>
    </abstract>
    <kwd-group id="kwrds0010">
      <title>Keywords</title>
      <kwd>spatial transcriptomics</kwd>
      <kwd>data visualization</kwd>
      <kwd>tissue topology modeling</kwd>
      <kwd>color palette optimization</kwd>
      <kwd>color vision deficiency support</kwd>
      <kwd>theme color extraction</kwd>
    </kwd-group>
  </article-meta>
  <notes>
    <p id="misc0010">Published: January 16, 2024</p>
  </notes>
</front>
<body>
  <sec id="sec1">
    <title>Introduction</title>
    <p id="p0030">A comprehensive understanding of tissue architecture is rooted in the exploration of anatomical and histological regions, complemented by the study of cell-type spatial organizations. This pursuit has been profoundly advanced by the emergence of spatially resolved transcriptomics (SRT),<xref rid="bib1" ref-type="bibr"><sup>1</sup></xref><sup>,</sup><xref rid="bib2" ref-type="bibr"><sup>2</sup></xref><sup>,</sup><xref rid="bib3" ref-type="bibr"><sup>3</sup></xref><sup>,</sup><xref rid="bib4" ref-type="bibr"><sup>4</sup></xref><sup>,</sup><xref rid="bib5" ref-type="bibr"><sup>5</sup></xref> which has illuminated recent studies in neuroscience,<xref rid="bib6" ref-type="bibr"><sup>6</sup></xref><sup>,</sup><xref rid="bib7" ref-type="bibr"><sup>7</sup></xref> developmental biology,<xref rid="bib8" ref-type="bibr"><sup>8</sup></xref><sup>,</sup><xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and a range of diseases.<xref rid="bib10" ref-type="bibr"><sup>10</sup></xref><sup>,</sup><xref rid="bib11" ref-type="bibr"><sup>11</sup></xref> To visualize and explore these datasets, cells are <italic>in situ</italic> annotated and labeled, creating a cellular cartography where each cell type is distinguished by a unique color.<xref rid="bib12" ref-type="bibr"><sup>12</sup></xref> Therefore, colorization—the process of selecting and assigning colors<xref rid="bib13" ref-type="bibr"><sup>13</sup></xref> to spatially intricately distributed cell clusters—is pivotal to ensure unbiased visual perception and facilitate downstream biological analyses.</p>
    <p id="p0035">Currently, popular data analysis frameworks like Seurat,<xref rid="bib14" ref-type="bibr"><sup>14</sup></xref> Giotto,<xref rid="bib15" ref-type="bibr"><sup>15</sup></xref> Scanpy,<xref rid="bib16" ref-type="bibr"><sup>16</sup></xref> and Squidpy<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref> derive their colorization approaches from widely used data visualization libraries, such as matplotlib<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref> in Python or ggplot2<xref rid="bib19" ref-type="bibr"><sup>19</sup></xref> in R. These methods typically allocate a color palette to cell types either alphabetically or based on descending cell count per type unless a specific order has been manually set. Given that these colorizing principles do not consider the spatial positions of cells, neighboring cells of distinct types often exhibit strikingly similar colors. This becomes particularly challenging for clear visualization in niche-specific microenvironments teeming with multiple cell types, exemplified by brain tissues or tumor niches.</p>
    <p id="p0040">The colorization of cell types for SRT data can be defined as a mathematical problem: given a limited palette, how can we assign more contrasting colors to adjacent cell-type pairs? This poses the challenge of determining the overall proximity of one cell type, which may comprise thousands of cells and is intricately distributed across space, to another. In practice, two cell types might be isolated, adjacent, partially interlaced, or entirely intertwined. However, current public metrics only capture some of these spatial relationships. For instance, the Wasserstein distance<xref rid="bib20" ref-type="bibr"><sup>20</sup></xref> measures the degree of isolation between non-overlapping cell types but lacks sensitivity to various interlaced scenarios. In contrast, the local inverse Simpson’s index<xref rid="bib21" ref-type="bibr"><sup>21</sup></xref> is used to quantify local diversity, determining if cell types are thoroughly intermixed. Palo, a recent palette optimization method,<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> employs the Jaccard index to measure overlaps between the spatial territories of two cell types but shows bias toward spatially sparse cell types.</p>
    <p id="p0045">On the other hand, most existing visualization methods employ pre-set palettes from sources like matplotlib<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref> or colorbrewer.<xref rid="bib23" ref-type="bibr"><sup>23</sup></xref> While these palettes are visually appealing, they eschew high-contrast colors, thereby reducing discernibility. This becomes pressing when coloring high-resolution SRT datasets containing hundreds of cell types. In addition, these palettes did not support color vision deficiency (CVD).<xref rid="bib13" ref-type="bibr"><sup>13</sup></xref></p>
    <p id="p0050">To address these challenges, we developed Spaco, a comprehensive tool tailored for spatially aware colorization of cellular-resolution SRT data. Spaco introduces the Degree of Interlacement (DOI) metric to evaluate the spatial relationship between individual cell-type pairs. Subsequently, a weighted graph, referred to as the cluster interlacement graph (CI-graph), is constructed to globally model these relationships. Using the CI-graph, Spaco facilitates spatially aware cell-color assignment, ensuring that cluster pairs with larger DOIs are visualized in more distinct colors. For enhanced palette discernibility, Spaco introduces an automatic, spatially aware palette selection approach that exploits the embedding of CI-graph vertices to optimally utilize the visible color spectrum. Furthermore, Spaco shows its capabilities to integratively apply these colorization strategies across multiple tissue sections, aiding spatial differential analyses. It can also derive theme color palettes from high-quality images, making it easier to attain aesthetically pleasing, publication-ready colors. Notably, Spaco ensures its broad accessibility by providing CVD support and public distributed codes in both Python and R.</p>
    <p id="p0055">We benchmarked Spaco on four real-world datasets from diverse cellular-resolution SRT assays and tissue types. These datasets include a STARmap mouse brain dataset,<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> a Stereo-seq axolotl brain dataset,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> a sequential fluorescence <italic>in situ</italic> hybridization (seqFISH) mouse embryo dataset,<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and an imaging mass cytometry (IMC) human breast cancer dataset.<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> Our findings illustrate Spaco’s capability to capture a variety of spatial relationships using the DOI metric, produce cell-color assignments with enhanced visual clarity, and curate palettes with hundreds of colors to distinguish fine-grained cell types. Furthermore, Spaco significantly aids downstream biological research, such as detailing intricate anatomical structures and cell co-localization in the mouse brain or highlighting the spatial proliferation of specific cell types in wound-healing axolotls. In summary, our results indicate that Spaco offers superior visual clarity for SRT data visualization compared to existing methodologies.</p>
  </sec>
  <sec id="sec2">
    <title>Results</title>
    <sec id="sec2.1">
      <title>Spaco basics and workflow</title>
      <p id="p0060">Generally, the Spaco colorization process is composed of three primary modules: (1) cell cluster interlacement modeling, (2) color palette selection, and (3) cluster-color assignment (<xref rid="fig1" ref-type="fig">Figure 1</xref>A).<fig id="fig1"><label>Figure 1</label><caption><p>Framework of Spaco for colorization of single-cell-resolution spatial data</p><p>Spaco accepts the coordinates of spatial single cells (or cell centroids) along with the categorical (i.e., cell-type) label of each cell, which can be provided in the widely used AnnData format.<xref rid="bib50" ref-type="bibr"><sup>27</sup></xref> The colorization process consists of three main parts (A). The first part, referred to as cluster interlacement modeling, employs a dual-outlier-free spatial nearest-neighbor algorithm (B) to calculate the Degree of Interlacement (DOI) between cell clusters, forming a cluster interlacement graph (CI-graph). The second part (adaptive palette selection) offers users two modes for color palette selection: a graph-guided algorithm for automatic palette selection based on a previously calculated CI-graph (C) and an image-guided algorithm that extracts an aesthetic theme palette from a user-provided image (D). Once the palette is selected, perceptual differences between all colors are calculated to construct a color difference graph (CD-graph). The final part utilizes a coarse-to-fine stochastic optimization to match the two graphs, resulting in a cluster-color assignment where heavily interlaced clusters are assigned colors with high perceptual differences (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p></caption><graphic xlink:href="gr1"/></fig></p>
      <p id="p0065">In the first module, Spaco accepts a spatial transcriptomic dataset with cell coordinates and corresponding cell-type labels as input. Then, Spaco establishes a DOI metric to form the CI-graph that models the overall topology between clusters, where vertices represent different cell clusters and each edge represents the DOI-assessed spatial relationship between two cell clusters. The DOI is computed via a modified spatial k-nearest neighbor network incorporating a dual-outlier-free strategy, which specifically excludes both spatially sparse cells and cell types in its calculation to enhance the stability (<xref rid="fig1" ref-type="fig">Figure 1</xref>B; see the <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0070">The subsequent module focuses on selecting a discernible color palette and calculating the perceptual differences between selected colors with optional CVD support. In color selection, users have the option to choose from two modes. The first and default mode is to automatically generate colors based on pre-calculated CI-graph (<xref rid="fig1" ref-type="fig">Figure 1</xref>C; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Spaco computes the 3D embedding of the CI-graph vertices using the uniform manifold approximation and projection (UMAP) algorithm.<xref rid="bib27" ref-type="bibr"><sup>28</sup></xref> As these vertex embeddings are expected to retain their relative distances from the original graph, we then scale them to the perceptually uniform CIELab color space,<xref rid="bib28" ref-type="bibr"><sup>29</sup></xref> allowing each vertex to acquire a Lab color. This results in a palette that optimally utilizes the entire color space. The alternative mode does not use spatial information but is designed to facilitate the acquisition of aesthetic colors for publications (<xref rid="fig1" ref-type="fig">Figure 1</xref>D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Given a user-preferred image, Spaco assesses the color frequencies within the image. It then extracts colors iteratively in descending order of these frequencies and updates the frequencies after each iteration to avoid repetitive extraction of similar colors. The iteration stops when the needed number of colors is extracted, forming an initial color palette. The discernibility of the initial palette is further refined using farthest point sampling (FPS).<xref rid="bib29" ref-type="bibr"><sup>30</sup></xref> Both modes allow manual adjustments by users, and the image-palette extraction is supplemented with optional CVD support. After the palette selection, Spaco computes a color difference graph (CD-graph), where the vertices represent the selected colors and the edges denote pairwise perceptual differences with optional CVD simulation (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0075">In the final module, Spaco delegates cluster-color assignments (i.e., pairing) by identifying an optimal match between the CI-graph and the CD-graph (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). A coarse-to-fine stochastic optimization is used to determine these assignments. This graph-matching process aims to find an optimal correspondence (i.e., one-to-one relationship) between the vertices of the CI-graph and those of the CD-graph such that the differences between the edges of the two graphs are minimized. Spaco interprets the correspondence between the CI-graph and CD-graph vertices as an optimized color assignment for cell clusters. The minimized difference between the corresponding edges of the CI- and CD-graphs ensures that clusters with larger DOIs are paired with more distinct colors.</p>
    </sec>
    <sec id="sec2.2">
      <title>Evaluation and benchmarking of DOI metric</title>
      <p id="p0080">Measuring the spatial relationships of cell clusters is fundamental to spatially aware colorization. To assess DOI’s capability in measuring interlacement, we first tested it on simulated data. We generated 10 sets of 2D points, with each set simulating the spatial coordinates of a unique cell cluster (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>A and S1B; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). These clusters were arranged to represent five typical types of spatial relationships: completely mixed, partially interlaced, adjacent, isolated, and distantly isolated (<xref rid="fig2" ref-type="fig">Figure 2</xref>A). Notably, the primary goal of colorization is to enhance the visual distinction among mixed, overlapped, or adjacent clusters. Therefore, we examined the DOI’s capability to differentiate these three scenarios from the other two (isolated and distant). We benchmarked it against three typical types of spatial relationship metrics: distance-based metrics, entropy-based metrics, and spatial-coverage-based metrics. These were exemplified by the Wasserstein distance, the local inverse Simpson’s index (LISI), and the 2D kernel density estimation-Jaccard index (2D KDE), respectively.<fig id="fig2"><label>Figure 2</label><caption><p>Benchmarking the DOI metric using simulated data</p><p>(A) Illustration of five typical spatial relationships observed in cellular SRT data. Colored sidebars highlight the occurrence of these relationships in UMAP-like (single-cell transcriptomic) visualizations, low-resolution SRT, and cellular-resolution SRT data.</p><p>(B) Min-max normalized scores for five differently distributed cluster pairs in the simulation data, evaluated using various metrics (top), accompanied by a visualization detailing the spatial distribution of each cluster pair (bottom).</p><p>(C) Parallel to (B) but for cluster pairs simulated with a sparse constraint (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p></caption><graphic xlink:href="gr2"/></fig></p>
      <p id="p0085">When cells display a dense or continuous distribution, all metrics recorded the highest scores for the mixed cluster pair and the lowest for the distantly isolated pair (<xref rid="fig2" ref-type="fig">Figure 2</xref>B). However, the Wasserstein distance showed a significant difference between the isolated pair and the distantly isolated pair due to its sensitivity to spatial distance. The 2D KDE scored zero for all three non-overlapping pairs, failing to identify the adjacent pair. Both the DOI and LISI successfully distinguished the two isolated cases from the non-isolated ones, serving as appropriate spatial relation metrics to indicate the necessity for distinct colors.</p>
      <p id="p0090">On the other hand, within a real tissue context, certain cell types, such as immunocytes, may display a relatively sparse distribution compared to others. While these cells typically do not dominate the global visualization of an SRT section, they play a crucial role in the biological exploration of cellular niches (e.g., the tumor-immune microenvironments). The DOI metric captured the neighborship (whether mixed, overlapped, or adjacent) of these sparse cluster pairs with relatively low scores. In contrast, other metrics did not demonstrate significant sensitivity to cell sparsity (<xref rid="fig2" ref-type="fig">Figures 2</xref>C, <xref rid="mmc1" ref-type="supplementary-material">S1</xref>C, and S1D). This suggests that the dual-outlier-free strategy employed in the DOI calculation can prevent sparse clusters from having a disproportionate impact during the colorization process.</p>
      <p id="p0095">The robustness of the DOI in response to varying cell sparsity was further illustrated using a public STARmap mouse brain dataset.<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> We presented the cluster pairs with the top three highest scores across all metrics (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>E and S1H). The DOI identified the mixture of inhibitory and excitatory neurons, the partial interlacement between astrocytes and neurons, and the adjacency between the cortex and fiber tract. These observations align with widely discussed topics in cell co-location and brain structure studies<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> (<xref rid="mmc1" ref-type="supplementary-material">Figure S1</xref>E). The Wasserstein distance and LISI seemed to favor cell types with globally similar distributions (<xref rid="mmc1" ref-type="supplementary-material">Figures S1</xref>F and S1G). While these globally sparsely distributed cells might have significant roles in brain functions, their spatial relationships offer limited insight into tissue heterogeneity. The 2D KDE echoed the DOI by emphasizing the mixed neuron subtypes in the cortex (<xref rid="mmc1" ref-type="supplementary-material">Figure S1</xref>H). However, it overestimated the spatial neighborship of sparsely co-located cell types, as its kernel density estimation had a tendency to exaggerate the spatial coverage of sparsely distributed cells.</p>
      <p id="p0100">Collectively, these results demonstrate the DOI’s capability to capture spatial neighborships with biological significance and to serve as a proper metric to constrain the colorization of SRT data.</p>
    </sec>
    <sec id="sec2.3">
      <title>Spaco facilitates the exploration of anatomic structure and cell heterogeneity</title>
      <p id="p0105">Next, we evaluated Spaco’s cell-color assignment method. In high-definition spatial transcriptomics, effective colorization should cater to both a global overview within a large field of view (FOV) and detailed perspectives of micro-FOVs. This dual capacity is biologically relevant for studying anatomical tissue structures and discerning niche heterogeneity. To showcase Spaco’s visualization proficiencies in these contexts, we applied our method to the STARmap mouse brain dataset,<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> which includes 23 pre-annotated cell clusters. These clusters display either spatially dispersed or aggregated distributions, offering a comprehensive assessment of Spaco’s color assignment algorithm (<xref rid="fig3" ref-type="fig">Figure 3</xref>A).<fig id="fig3"><label>Figure 3</label><caption><p>Benchmarking Spaco color assignment on STARmap mouse brain data</p><p>(A) Color assignment of 23 brain-related cell subtypes using Spaco, Spaco’s general-CVD-support mode, Scanpy (matplotlib), random shuffling, and Palo. All methods shared the same color palette generated from Scanpy (matplotlib) by default.</p><p>(B) Anatomical reference from the Allen Brain Atlas<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> corresponding to the STARmap mouse brain section (left) and neighborship between cell clusters that are enriched in one of the brain areas determined according to the anatomical map (right). The vertices of the graph are colored the same as in (A).</p><p>(C) Benchmarking of anatomical visualization in Spaco against other methods. Scatters represent the color difference (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>) between anatomically adjacent cluster pairs determined in (B).</p><p>(D) Same as (C) but for Spaco’s general-CVD-support mode.</p><p>(E) Gridded fields of view (FOVs) of the mouse brain section with 500 × 500 μm each.</p><p>(F) Benchmarking of cellular visualization in Spaco against other methods. Scatters represent the mean cell-cell color difference within each FOV in (E).</p><p>(G) Spaco visualization of the two FOVs with the highest color difference.</p></caption><graphic xlink:href="gr3"/></fig></p>
      <p id="p0110">We compared Spaco’s result with those of Scanpy<xref rid="bib16" ref-type="bibr"><sup>16</sup></xref> (utilizing the default matplotlib visualization), random-shuffled assignment, and Palo<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> (<xref rid="fig3" ref-type="fig">Figure 3</xref>A), all using the same color palette. To benchmark performance based on brain anatomical features, we identified 10 anatomic-region-localized cell clusters (predominant in one anatomic region) after mapping cell types to the Allen Brain Atlas,<xref rid="bib30" ref-type="bibr"><sup>31</sup></xref> yielding 17 spatially adjacent cluster pairs (<xref rid="fig3" ref-type="fig">Figure 3</xref>B). Our analysis revealed that Spaco achieved significant visual differences between these anatomically adjacent pairs, as determined by one-sided Wilcoxon tests (no-CVD-support mode, p = 1.45e−4, 2.32e−3, and 4.51e−3 when compared to Scanpy, random assignments, and Palo, respectively) (<xref rid="fig3" ref-type="fig">Figures 3</xref>C and 3D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Additionally, we distributed a questionnaire to experts, comprising 19 neurologists and 34 bioinformaticians, asking them to grade each colorization outcome on a scale of 1–10 based on their professional experience. This survey further underscored the superior visual effectiveness of Spaco’s colorization approach (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>A; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0115">On the other hand, exploring microenvironment heterogeneity requires the zoomed-in visualization of cellular niches. To simulate such scenarios, we arbitrarily divided the data into micro-FOVs measuring 500 × 500 μm each and scored the discernibility of each FOV based on the mean of pairwise color differences among all present cells (<xref rid="fig3" ref-type="fig">Figure 3</xref>E; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). The overall discernibility scores across all FOVs were significantly higher in Spaco’s visualizations, as shown by one-sided Wilcoxon tests (no-CVD-support mode, p = 8.42e−21, 9.16e−19, and 8.87e−21 when compared to Scanpy, random assignments, and Palo, respectively) (<xref rid="fig3" ref-type="fig">Figures 3</xref>F and <xref rid="mmc1" ref-type="supplementary-material">S2</xref>B). FOVs with the highest discernibility scores in Spaco highlighted the co-localization of various neuron subtypes, such as glutamatergic (excitatory), GABAergic (inhibitory), and peptidergic neurons, around the amygdalar area (<xref rid="fig3" ref-type="fig">Figures 3</xref>G and <xref rid="mmc1" ref-type="supplementary-material">S2</xref>C). In contrast, the FOVs with the lowest scores were typically situated at tissue boundaries or contained fewer clusters, indicating that they were less valuable for analyzing cellular heterogeneity (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>D).</p>
      <p id="p0120">Additionally, we sought to determine whether our CI-graph and DOIs contributed to Spaco’s enhanced performance. A notable correlation between DOI scores and color differences (linear regression R-square = 0.45, p = 4e−61) indicated that the subsequent optimization effectively utilized the DOI in Spaco’s color-mapping process (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>E). We further evaluated the time complexity of our algorithm. The colorization process required less than 30 s for simulated datasets encompassing up to 100,000 cells (<xref rid="mmc1" ref-type="supplementary-material">Figure S2</xref>F). Hence, the additional computations do not introduce a substantial time burden.</p>
    </sec>
    <sec id="sec2.4">
      <title>Spaco improves palette discernibility by adaptive color selection</title>
      <p id="p0125">Above, while Spaco effectively enhanced visualization by optimizing the cell-color assignment, its overall performance was still constrained by the discernibility of pre-defined palettes<xref rid="bib18" ref-type="bibr"><sup>18</sup></xref><sup>,</sup><xref rid="bib19" ref-type="bibr"><sup>19</sup></xref><sup>,</sup><xref rid="bib23" ref-type="bibr"><sup>23</sup></xref> (<xref rid="mmc1" ref-type="supplementary-material">Figure S3</xref>A). Therefore, we extended the efficacy of Spaco’s adaptive color selection algorithm to augment palette discernibility and evaluated its two modes of color selection separately (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0130">Firstly, we applied our CI-graph-guided color selection approach to a published Stereo-seq dataset of wound-healing axolotl brain,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> which contains 16 pre-annotated cell types (<xref rid="fig4" ref-type="fig">Figure 4</xref>A). We found that the discernibility of the adaptively generated palette, as quantified by the distribution of pairwise color differences among all palette colors, was significantly higher than that of the pre-defined palette (one-sided Wilcoxon test, p = 1.27e−11) (<xref rid="fig4" ref-type="fig">Figure 4</xref>B). Furthermore, the Spaco-generated palette displayed a bimodal distribution of color differences, suggesting an imbalanced color selection across the color space. This indicates that Spaco adeptly integrated the biases of DOIs in the CI-graph, tailoring color selection to accommodate both distant and adjacent cluster pairs (<xref rid="fig4" ref-type="fig">Figures 4</xref>C and <xref rid="mmc1" ref-type="supplementary-material">S3</xref>B). Analyzing these colors in the CIELab space, we pinpointed three neighboring cell types associated with shades of blue. These colors corresponded to the embedding of spatially distant cell clusters with low DOIs, which are easily distinguishable through subtle color variations (<xref rid="fig4" ref-type="fig">Figure 4</xref>D). Leveraging this, Spaco also effectively crafted a suitable palette for the clear visualization of the STARmap dataset comprising 181 fine-grained cell types (<xref rid="mmc1" ref-type="supplementary-material">Figure S3</xref>C). In contrast, matplotlib failed to capture such a plethora of clusters, producing an uncolored plot due to its limited color pre-sets.<fig id="fig4"><label>Figure 4</label><caption><p>Evaluation of adaptive graph-guided and image-guided palette selection in Spaco</p><p>(A) Colorization of 16 cell clusters in the Stereo-seq axolotl brain dataset,<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> using palettes generated by Spaco cluster interlacement graph embedding (left) and Scanpy’s default palette (right).</p><p>(B) Distribution of pairwise color differences within the Spaco-generated palette in (A), compared to Scanpy’s default palette.</p><p>(C) Visualization of the colors from the Spaco-generated palette in the 2D CIELab space (channels a and b).</p><p>(D) Spatial distributions of cell clusters that are highlighted in (C).</p><p>(E) Public journal cover image used to create the image-guided palette (sourced from <italic>Cell</italic>, March 08, 2018, volume 172, issue 6).</p><p>(F) Colors and their frequencies derived from the reference image in (E).</p><p>(G) Colorization of 16 cell clusters in the Stereo-seq axolotl brain dataset using the palette extracted from the image in (E).</p><p>(H) Same as (G) but using Spaco’s general-CVD-support mode.</p><p>(I) Pairwise color differences within the palette extracted from the image compared to Scanpy’s default palette.</p></caption><graphic xlink:href="gr4"/></fig></p>
      <p id="p0135">While maximizing color differences can enhance daily data visualization, researchers occasionally prefer to adopt coloring themes from prior publications or presentations. Spaco supports this requirement with its image-guided palette extraction mode (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). We illustrated this process using a public journal cover image as shown in <xref rid="fig4" ref-type="fig">Figure 4</xref>E. The extracted colors, and their subsequent application to the axolotl dataset, showed comparable discernibility to a pre-defined color palette (tab20 in matplotlib colormap) (Wilcoxon test, p = 1.20e−11) (<xref rid="fig4" ref-type="fig">Figures 4</xref>F–4I). Importantly, this was achieved while preserving the thematic consistency of the original image.</p>
      <p id="p0140">These results underscore Spaco’s capability to navigate the confines of the limited visible color space, achieving superior perceptual discernibility in both daily and publication scenarios.</p>
    </sec>
    <sec id="sec2.5">
      <title>Spaco integratively colors cell clusters across multiple SRT sections</title>
      <p id="p0145">A subsequent challenge in SRT data analysis lies in discerning variations in spatial cell distribution across diverse biological samples. This requires the visualization of multiple tissue sections using a uniform palette and color assignment scheme. To address this, Spaco has been enhanced with a feature that facilitates integrative colorization by seamlessly merging CI-graphs (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p>
      <p id="p0150">We applied Spaco to a time-series study of axolotl brain regeneration.<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref> The optimized visualization highlighted an increase in Sfrp+ ependymoglial cells (sfrpEGCs) during the wound-healing progression from 10 days post-injury (DPI-10) to DPI-15. This increase was difficult to detect using Scanpy’s default visualization due to challenges from incorrectly matching telencephalon neuroblasts (TLNBLs) at DPI-10 with sfrpEGCs at DPI-15 (<xref rid="fig5" ref-type="fig">Figures 5</xref>A–5C).<fig id="fig5"><label>Figure 5</label><caption><p>Integrative colorization across multiple plots by Spaco</p><p>(A) Scanpy colorization of two Stereo-seq axolotl datasets (days post-injury 10 and 15), with separate color assignment by default.</p><p>(B) Spaco colorization of the Stereo-seq axolotl datasets using integrative color assignment and sharing the same palette as the Scanpy default plots.</p><p>(C) Highlighted spatial distribution of telencephalon neuroblasts (TLNBLs) and Sfrp+ ependymoglial cells (sfrpEGCs) in (B).</p><p>(D) Cluster-wise intersection over union (IoU) score between two Louvain clustering results; top IoU scores are labeled. Blue digits represent the final correspondences derived using Spaco’s greedy strategy (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>).</p><p>(E) Scanpy colorization of two different Louvain clustering results of DPI-10 dataset, using separate color assignments by default. Red arrow highlights the TLNBL cell cluster.</p><p>(F) Spaco colorization of the two different Louvain clustering results of DPI-10 dataset, using aligned cluster label from (D) and an integrative color assignment and palette selection based on the cluster interlacement graph. Red arrow highlights the TLNBL cell cluster.</p></caption><graphic xlink:href="gr5"/></fig></p>
      <p id="p0155">Additionally, we employed a method to streamline the tuning process in clustering analysis. This approach involved comparing clustering outcomes generated using different parameters. By computing Jaccard indices and employing a greedy matching algorithm, we established correspondences between clusters (<xref rid="fig5" ref-type="fig">Figure 5</xref>D; see <xref rid="sec4" ref-type="sec">experimental procedures</xref>). Contrary to Louvain’s default colorization method, which entirely altered the colors between the two rounds clustering of the same dataset (<xref rid="fig5" ref-type="fig">Figure 5</xref>E), Spaco retained the colors for the cell types annotated in the first round. It then suitably designated colors to newly emerged cell subtypes <italic>in situ</italic>. This directly distinguished WNT+ EGCs (wntEGCs) from TLNBLs in the ventricular zone, aiding biologists in further studying the dynamics of EGCs and the locally newly generated neurons (medial pallium excitatory neuron [mpEX]) during axolotl brain regeneration (<xref rid="fig5" ref-type="fig">Figure 5</xref>F).</p>
    </sec>
    <sec id="sec2.6">
      <title>Spaco is applicable to diverse technologies and tissue types</title>
      <p id="p0160">We extended our testing of Spaco to a seqFISH mouse embryo dataset<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref> and an IMC human breast cancer dataset.<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> We sourced the color palettes for both datasets from the online tutorial of the Squidpy package.<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref> The optimized color assignment and autogenerated palette by Spaco demonstrated superior visual clarity compared to other methods (<xref rid="mmc1" ref-type="supplementary-material">Figures S4</xref>A and S4B). In the IMC dataset, Spaco’s color assignment aligned with the manual assignment from the Squidpy tutorial, notably mapping cyan to the predominant apoptotic tumor cells. Furthermore, it excelled in differentiating between apoptotic and basal cytokeratins (CK) tumor cells located in the bottom right of the section (<xref rid="mmc1" ref-type="supplementary-material">Figure S4</xref>B).</p>
    </sec>
    <sec id="sec2.7">
      <title>Spaco ensures broad accessibility by supporting diverse userships</title>
      <p id="p0165">As a color-based visualization method, Spaco was designed to adapt to various situations of CVD. Using an LMS (long, medium, short) space-based color conversion method,<xref rid="bib31" ref-type="bibr"><sup>32</sup></xref> Spaco was capable of simulating perceptual colors as perceived by individuals with CVD and modifying color difference calculations (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>) to simultaneously consider three common types of CVD conditions: protanopia, deuteranopia, and tritanopia.</p>
      <p id="p0170">We integrated and tested this feature for both Spaco’s color assignment (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>A–S5D) and its image-guided palette extraction approach (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>E–S5H) on the STARmap mouse brain dataset and the Stereo-seq axolotl dataset, respectively. We excluded our graph-embedding color selection from being CVD friendly due to the absence of a continuous, perceptually uniform CVD color space for UMAP embedding. Notably, Spaco’s CVD-friendly colorization achieved improved discernibility compared visually to Scanpy’s default colorization, not only in all three simulated CVD conditions (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>B, S5D, and S5H) but also in full-color perception (<xref rid="mmc1" ref-type="supplementary-material">Figures S5</xref>A, S5C, and S5G). This is important for ensuring broad readability of Spaco’s visualization for diverse audiences in publications. In addition, Spaco also gives the option to perform CVD-friendly colorization under one given type of CVD, which intends to provide even better support for users with that CVD type in their daily work.</p>
      <p id="p0175">Another key aspect of our approach is to support user communities of both Python and R, the two predominant programming languages in the fields of single-cell and spatial omics. We have made available scripts related to all benchmarking experiments, which are particularly beneficial for users of Python and Scanpy. For the R community, we have constructed a tutorial that demonstrates the combined use of Spaco and Seurat, as illustrated in <xref rid="mmc1" ref-type="supplementary-material">Figure S6</xref>. All of these code resources are available in open-access repositories, as detailed in the <xref rid="sec4.1.3" ref-type="sec">data and code availability</xref> section.</p>
    </sec>
  </sec>
  <sec id="sec3">
    <title>Discussion</title>
    <p id="p0180">On one single spatial transcriptomics chip, millions of cells and hundreds of cell-type clusters organize in spatially structured arrangements. It is conceivable that the cell types can be either isolated, neighbored, partially interlaced, or completely mixed in a tissue, orchestrating the diverse microenvironmental niches. We therefore developed Spaco, an automatic palette selection and colorization tool, to solve this newly emerged data visualization problem. With Spaco, experienced biologists, anatomists, and pathologists can identify the pivotal cell clusters and quickly zoom in on the candidate biological interests based on their spatial characteristics, given their prior knowledge of tissue configuration.</p>
    <p id="p0185">As Spaco is a graph-based method, it possesses many computational applications rooted in graph structure, surpassing existing coloring algorithms. Notably, the identification of an appropriate edge metric to characterize the graph is in the first priority. To develop the DOI metric, we utilized the spatial k-nearest neighbor graph in the local neighborhoods of each cell, which serves as a discrete spatial kernel. Consequently, DOI is able to model the interlacement between spatially scattered cells in cellular SRT data rather than continuous domains in low-resolution SRTs. On the other hand, leveraging the interlacement graphs, Spaco offers the potential to assess variations in tissue topology across different sections by identifying changes in edges (i.e., DOIs). This capability could further facilitate the discovery of topologically conservative or variable cell types over timescales. These functionalities are not available in any other publicly available packages.</p>
    <p id="p0190">While Spaco effectively employs distinct colors to visualize the spatial organization of cell types for biological insights, other studies, such as Baysor<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref> and Bento,<xref rid="bib33" ref-type="bibr"><sup>34</sup></xref> harness the color space for segmenting cells or even subcellular domains in spatial transcriptomic data analyses. The idea of utilizing color-based analyses to explore a variety of biological features is compelling. Another notable example is DeepVariant,<xref rid="bib34" ref-type="bibr"><sup>35</sup></xref> which introduced an approach where sequencing reads are encoded into RGB-colored images to enhance variant-calling accuracy. Though the majority of color space applications currently focus on data visualization, our attempts at downstream color-based graph analysis underscore the potential of adapting color-centric algorithms for broader biological research.</p>
    <p id="p0195">One major limitation of Spaco is its enforcement of a correspondence between color differences and the spatial distribution of cells. However, there might be scenarios where users wish to use similar colors for cell subtypes, regardless of their spatial relationships, or they might want to specify colors for certain cell types to align with existing literature. To address these situations, Spaco offers an option allowing users to manually fix or adjust colors for user-specified cell types and then optimize the color differences for the remaining cell types. Second, the visual contrast that can be obtained through color space is limited when performing CVD-supporting colorization or in the case of coloring hundreds of clusters. It would be helpful to exploit fine-designed CVD-supporting palettes<xref rid="bib35" ref-type="bibr"><sup>36</sup></xref><sup>,</sup><xref rid="bib36" ref-type="bibr"><sup>37</sup></xref> and more rich-formatted techniques like interactive plots and virtual reality. On a different note, while Spaco’s algorithm is theoretically adept at processing 3D data, fine-tuning of parameters is crucial to differentiate “sparse” from “dense” cell types for efficient 3D colorization.</p>
    <p id="p0200">Spaco is implemented in Python using a modularized architecture to seamlessly integrate into a variety of analytical platforms and to incorporate emerging deep-learning-based clustering methods. This approach also facilitates community contributions, extension of new functions, and even the separation of program functions to support individual scripts. As spatial technologies continue to evolve, potentially becoming the primary method for characterizing the molecular profiles of cells, we anticipate that Spaco will become an indispensable tool for researchers across a broad range of biological fields.</p>
  </sec>
  <sec id="sec4">
    <title>Experimental procedures</title>
    <sec id="sec4.1">
      <title>Resource availability</title>
      <sec id="sec4.1.1">
        <title>Lead contact</title>
        <p id="p0205">Further information and requests for resources and reagents should be directed to and will be fulfilled by the lead contact, Yinqi Bai (<email>baiyinqi@genomics.cn</email>).</p>
      </sec>
      <sec id="sec4.1.2">
        <title>Materials availability</title>
        <p id="p0210">This study did not generate new unique materials.</p>
      </sec>
      <sec sec-type="data-availability" id="sec4.1.3">
        <title>Data and code availability</title>
        <p id="p0215">All datasets are public and available for download from their original publications, which are listed as follows.<list list-type="simple" id="olist0010"><list-item id="o0010"><label>(1)</label><p id="p0220">The adult mouse brain STARmap dataset<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1830/" id="intref0015">https://singlecell.broadinstitute.org/single_cell/study/SCP1830/</ext-link>.</p></list-item><list-item id="o0015"><label>(2)</label><p id="p0225">The wound-healing axolotl Stereo-seq datasets<xref rid="bib25" ref-type="bibr"><sup>25</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://db.cngb.org/stomics/artista/download" id="intref0020">https://db.cngb.org/stomics/artista/download</ext-link>.</p></list-item><list-item id="o0020"><label>(3)</label><p id="p0230">The mouse embryo seqFISH dataset<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://marionilab.cruk.cam.ac.uk/SpatialMouseAtlas/" id="intref0025">https://marionilab.cruk.cam.ac.uk/SpatialMouseAtlas/</ext-link>.</p></list-item><list-item id="o0025"><label>(4)</label><p id="p0235">The breast cancer IMC datasets<xref rid="bib26" ref-type="bibr"><sup>26</sup></xref>: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.3518284" id="intref0030">https://doi.org/10.5281/zenodo.3518284</ext-link>.</p></list-item></list></p>
        <p id="p0240">Spaco is an open source, collaborative Python package available at Zenodo (<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.10113347" id="intref0035">https://zenodo.org/doi/10.5281/zenodo.10113347</ext-link>)<xref rid="bib37" ref-type="bibr"><sup>38</sup></xref> and also at the GitHub repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco" id="intref0040">https://github.com/BrainStOrmics/Spaco</ext-link>). The scripts to reproduce Spaco’s results and figures are available at <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.10113359" id="intref0045">https://zenodo.org/doi/10.5281/zenodo.10113359</ext-link><xref rid="bib38" ref-type="bibr"><sup>39</sup></xref> and <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco_scripts" id="intref0050">https://github.com/BrainStOrmics/Spaco_scripts</ext-link>. For combinatorial use of Spaco with R, see <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/SpacoR" id="intref0055">https://github.com/BrainStOrmics/SpacoR</ext-link>.</p>
      </sec>
    </sec>
    <sec id="sec4.2">
      <title>Modeling spatial interlacement of clusters</title>
      <sec id="sec4.2.1">
        <title>Design of DOI</title>
        <p id="p0245">To characterize the spatial differentiation between clusters, we assess the interlacement of the cells within each cluster. One of the main challenges in calculating spatial interlacement by estimating cluster overlap in single-cell resolution spatial data arises when cells are sparsely distributed, resulting in variable density within the tissue section. This can lead to an overestimation of the spatial coverage of clusters.</p>
        <p id="p0250">To circumvent the risk of inferring incorrect interlacement relationships from such instances, we employ the k-dimensional tree algorithm to calculate k-nearest neighbors for all cells, with k defaulting to 30. This method draws inspiration from domain identification algorithms that utilize spatial neighbors.<xref rid="bib17" ref-type="bibr"><sup>17</sup></xref><sup>,</sup><xref rid="bib39" ref-type="bibr"><sup>40</sup></xref><sup>,</sup><xref rid="bib40" ref-type="bibr"><sup>41</sup></xref></p>
        <p id="p0255">Additionally, we apply a dual-outlier-free strategy to refine this k-nearest neighbor calculation. The term “dual” pertains to two distinct outlier cell categories.<list list-type="simple" id="olist0015"><list-item id="o0030"><label>(1)</label><p id="p0260">The “sparse-type” outlier, characterized by having fewer than <italic>k</italic> cells within a specified radius <italic>r</italic>. This suggests that the cell occupies a sparsely populated region of the tissue.</p></list-item><list-item id="o0035"><label>(2)</label><p id="p0265">The “orphan-type” outlier, which lacks (or has fewer than a designated number n) cells of its cluster within its neighboring cells. This indicates that the cell might be isolated from the primary group of the cluster or that the cluster itself may have a sparse spatial configuration.</p></list-item></list></p>
        <p id="p0270">For sparse types, Spaco retains only the closest neighbors within the radius <italic>r</italic> (defaulting to 50 μm) to prevent incorrect associations with distant cells. For orphan types, we omit the orphan cells from the neighbor calculations, ensuring we do not overestimate the spatial coverage and interlacement of clusters.</p>
        <p id="p0275">Following these steps, the spatial interlacement is determined pairwise for all clusters using the refined cell-cell neighbor relationships. Let x and y denote the labels (indices) of two distinct clusters. We define the interlacement score between them, <inline-formula><mml:math id="M1" altimg="si1.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>, as<disp-formula id="ufd1"><mml:math id="M2" altimg="si2.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub><mml:mo linebreak="badbreak">=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo linebreak="badbreak">∈</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M3" altimg="si3.gif"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.25em"/><mml:msub><mml:mi>C</mml:mi><mml:mi mathvariant="normal">y</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denote the cells in clusters x and y, respectively, and <inline-formula><mml:math id="M4" altimg="si4.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">|</mml:mo></mml:mrow></mml:math></inline-formula> denotes the number of nearest neighbors of cell <inline-formula><mml:math id="M5" altimg="si5.gif"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="M6" altimg="si6.gif"><mml:mrow><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the Euclidean distance between cells <inline-formula><mml:math id="M7" altimg="si7.gif"><mml:mrow><mml:mi>i</mml:mi><mml:mspace width="0.5em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.25em"/><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> under the given spatial coordinates.</p>
      </sec>
      <sec id="sec4.2.2">
        <title>Constructing CI-graph</title>
        <p id="p0280">Basically, the interlacement score models the mean inversed distance between the neighboring cells of two clusters. Calculated scores are used to construct a weighted CI-graph, where vertices represent each cluster and edges are weighted by the interlacement scores (i.e., DOIs described in the previous part). The adjacency matrix of this graph is symmetrized (converted to undirected graph) by replacing <inline-formula><mml:math id="M8" altimg="si1.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M9" altimg="si8.gif"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>yx</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="M10" altimg="si9.gif"><mml:mrow><mml:mi mathvariant="italic">Max</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mtext>xy</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mtext>yx</mml:mtext></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for any x and y, and the diagonal is set to zeros in the matrix.</p>
      </sec>
    </sec>
    <sec id="sec4.3">
      <title>Adaptive color palette selection</title>
      <sec id="sec4.3.1">
        <title>Generating palette using graph embedding</title>
        <p id="p0285">Spaco offers adaptive generation of a color palette by embedding the CI-graph into the CIELab color space.<xref rid="bib28" ref-type="bibr"><sup>29</sup></xref> To achieve this, we utilize UMAP<xref rid="bib27" ref-type="bibr"><sup>28</sup></xref> to compute a 3D embedding of all vertices in the CI-graph. In this configuration, less interlaced clusters present as hubs in the CI-graph since the DOIs (i.e., edge weights) among their corresponding vertices are relatively low. Consequently, these hubs are embedded into aggregately distributed points groups in the 3D UMAP space (like the case in <xref rid="fig4" ref-type="fig">Figure 4</xref>D), leading cluster pairs with lower DOIs to closer distances in the embedded space, and vice versa.</p>
        <p id="p0290">Subsequently, these embeddings are rescaled to fit the value range of the CIELab, a perceptually uniform color space where the difference between colors corresponds to the Euclidean distance. A similar method was adopted in previous studies to colorize single-molecule FISH (smFISH) data based on the niche composition of the captured molecules.<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref></p>
        <p id="p0295">In the CIELab color space, the L, a, and b values typically range within <inline-formula><mml:math id="M11" altimg="si10.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>100</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M12" altimg="si11.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>127</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="M13" altimg="si11.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>127</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula>, respectively. To prevent the generation of colors that are either too dark or too bright, we further limit the illuminant channel L to a range of <inline-formula><mml:math id="M14" altimg="si12.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:mn>85</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> by default. The final step involves converting the Lab values into RGB hex values to suit general applications.</p>
        <p id="p0300">A limitation of using UMAP involves potential distortion in neighborhood and distance.<xref rid="bib41" ref-type="bibr"><sup>42</sup></xref> Nevertheless, this coarse alignment between DOIs and color differences was sufficient for colorization purposes, whose feasibility was proven in Baysor.<xref rid="bib32" ref-type="bibr"><sup>33</sup></xref> The non-linear nature of UMAP also contributes to Spaco’s robustness against outliers (i.e., heavily isolated vertices in CI-graph causing polarized palettes selection). Optional linear embedding methods in Spaco, such as multidimensional scaling (MDS), can be used for outlier-free cases.</p>
        <p id="p0305">Spaco allows the direct utilization of the embedded colors as effective color mapping depending on the coarse correspondence between DOIs and color differences, and it also provides users options for further optimization in the cluster-color assignment, detailed in the final module.</p>
      </sec>
      <sec id="sec4.3.2">
        <title>Image-guided theme palette extraction</title>
        <p id="p0310">Spaco offers an additional feature for adaptive color palette selection: the extraction of theme colors from images, enabling users to oversee the palette selection process by designating preferred images. Drawing inspiration from recent advancements in computational visual media,<xref rid="bib42" ref-type="bibr"><sup>43</sup></xref> for a given image, we summarize the colors of all pixels in a given image under 3D CIELab color space, using a binning size of 20 (by default) on each dimension (channel). This aggregation condenses all raw pixel colors into a potential maximum of 8,000 distinct binned colors, each represented by the centroid color of its respective bin. Colors falling within the L (illumination channel) range of <inline-formula><mml:math id="M15" altimg="si12.gif"><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>20</mml:mn><mml:mo>,</mml:mo><mml:mn>85</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> by default (considered either too dark or excessively bright), as well as those occurring below the third percentile in frequency (considered non-theme colors), are excluded from further calculation.</p>
        <p id="p0315">The initial palette is progressively assembled from binned colors, selected in descending order of frequency until the desired number of colors is attained. To prevent the selection of similar colors, we update frequencies during the process, employing the following equation<xref rid="bib43" ref-type="bibr"><sup>44</sup></xref>:<disp-formula id="ufd2"><mml:math id="M16" altimg="si13.gif"><mml:mrow><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo linebreak="badbreak">=</mml:mo><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi mathvariant="italic">exp</mml:mi><mml:mspace width="0.25em"/><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M17" altimg="si14.gif"><mml:mrow><mml:msubsup><mml:mi>f</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> denotes the frequency of color <inline-formula><mml:math id="M18" altimg="si15.gif"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> after the <inline-formula><mml:math id="M19" altimg="si16.gif"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>-th selection, with <inline-formula><mml:math id="M20" altimg="si17.gif"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> denoting the pulled color. <inline-formula><mml:math id="M21" altimg="si18.gif"><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the CIEDE2000 color difference metric<xref rid="bib44" ref-type="bibr"><sup>45</sup></xref> in default. <inline-formula><mml:math id="M22" altimg="si19.gif"><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> is set to 80 by default.</p>
        <p id="p0320">Once an initial palette is established, we initiate a refinement process for the palette. We iteratively replace each color in the palette using farthest point sampling<xref rid="bib29" ref-type="bibr"><sup>30</sup></xref> (FPS) to maximize the minimum distance between the replaced color and the rest of the palette, ensuring optimal linear separation. In each iteration, <italic>k</italic> (3 by default) colors that are farthest from the rest of the palette are selected. Subsequently, we evaluate the <italic>k</italic> potential replacements using the formula<disp-formula id="ufd3"><mml:math id="M23" altimg="si20.gif"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:msub><mml:mi>f</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo linebreak="goodbreak">+</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>in which <inline-formula><mml:math id="M24" altimg="si21.gif"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the linear separation of color <inline-formula><mml:math id="M25" altimg="si15.gif"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M26" altimg="si22.gif"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represents the pre-calculated distance in FPS. <inline-formula><mml:math id="M27" altimg="si23.gif"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M28" altimg="si24.gif"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are weights to balance between <inline-formula><mml:math id="M29" altimg="si21.gif"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M30" altimg="si25.gif"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, defaulting to 0.15 and the inverse of 0.03% of the image’s pixel number, respectively. The color with the highest score is then employed to replace the corresponding color in the current palette. The iteration process concludes when the coefficient of variation (CV) for all pairwise distances within the color palette surpasses the CV of edge weights in the CI-graph or when the number of iterations exceeds the pre-defined limit (set to 20 times the palette size by default). Finally, a conversion from Lab values to RGB hex values is executed to facilitate general usage.</p>
      </sec>
    </sec>
    <sec id="sec4.4">
      <title>Graph-based color assignment</title>
      <sec id="sec4.4.1">
        <title>Calculating perceptual differences and constructing CD-graph</title>
        <p id="p0325">Once an adequate color palette is available, we proceed to construct a CD-graph that captures the color relationships within the palette.</p>
        <p id="p0330">We quantify the pairwise differences between colors by employing a well-established weighted metric within the RGB color space<xref rid="bib45" ref-type="bibr"><sup>46</sup></xref>:<disp-formula id="ufd4"><mml:math id="M31" altimg="si26.gif"><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mo linebreak="badbreak">=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo linebreak="badbreak">+</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="ufd5"><mml:math id="M32" altimg="si27.gif"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>C</mml:mi><mml:mo linebreak="badbreak">=</mml:mo><mml:msqrt><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo linebreak="badbreak">+</mml:mo><mml:mfrac><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>256</mml:mn></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo linebreak="badbreak">+</mml:mo><mml:mn>4</mml:mn><mml:mo>Δ</mml:mo><mml:msup><mml:mi>G</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo linebreak="badbreak">+</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo linebreak="badbreak">+</mml:mo><mml:mfrac><mml:mrow><mml:mn>255</mml:mn><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mn>256</mml:mn></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:msup><mml:mi>B</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M33" altimg="si28.gif"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M34" altimg="si29.gif"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are the red channels of the compared colors. <inline-formula><mml:math id="M35" altimg="si30.gif"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:math></inline-formula> represents the perceptual difference between two RGB colors, and <inline-formula><mml:math id="M36" altimg="si31.gif"><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M37" altimg="si32.gif"><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="M38" altimg="si33.gif"><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:math></inline-formula> stand for the corresponding color channels. The computed differences are utilized as edge weights in the adjacency matrix of the CD-graph.</p>
      </sec>
      <sec id="sec4.4.2">
        <title>Graph matching via coarse-to-fine optimization</title>
        <p id="p0335">The primary objective of color assignment is to ensure that clusters containing closely located or intertwined cells are allocated colors with significant perceptual differences. By utilizing the adjacency matrices of our CI-graph and CD-graph, we can frame the solution to this color-mapping challenge as a graph-matching problem. In this problem, our aim is to establish a one-to-one correspondence between the vertices of the CI-graph and the CD-graph, thereby achieving optimal consistency between the edge weights of the two graphs.</p>
        <p id="p0340">Mathematically, we can express the optimization as an objective function <inline-formula><mml:math id="M39" altimg="si34.gif"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> defined as<disp-formula id="ufd6"><mml:math id="M40" altimg="si35.gif"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mi>P</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi></mml:msub><mml:mtext>,</mml:mtext></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="M41" altimg="si36.gif"><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:math></inline-formula> is a permutation matrix representing the bijective assignment, in which <inline-formula><mml:math id="M42" altimg="si37.gif"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M43" altimg="si38.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo linebreak="goodbreak" linebreakstyle="after">=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="M44" altimg="si39.gif"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>I</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M45" altimg="si40.gif"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>C</mml:mi><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>p</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the weighted adjacency matrices of CI-graph and CD-graph. <inline-formula><mml:math id="M46" altimg="si41.gif"><mml:mrow><mml:msub><mml:mrow><mml:mo>‖</mml:mo><mml:mi>M</mml:mi><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the Frobenius norm of matrix <inline-formula><mml:math id="M47" altimg="si42.gif"><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula>.</p>
        <p id="p0345">Then, we can define the optimal assignment <inline-formula><mml:math id="M48" altimg="si43.gif"><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> to be the solution of following optimization:<disp-formula id="ufd7"><mml:math id="M49" altimg="si44.gif"><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi mathvariant="italic">argmin</mml:mi><mml:mi>P</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mi>L</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>P</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mtext>.</mml:mtext></mml:mrow></mml:math></disp-formula></p>
        <p id="p0350">While graph-matching problems of this nature, closely related to the challenging quadratic assignment problem, are known to be NP-hard (NP, nondeterministic polynomial time),<xref rid="bib46" ref-type="bibr"><sup>47</sup></xref><sup>,</sup><xref rid="bib47" ref-type="bibr"><sup>48</sup></xref><sup>,</sup><xref rid="bib48" ref-type="bibr"><sup>49</sup></xref> in the context of cluster-color assignment, we anticipate that the number of clusters will be relatively modest, likely not exceeding thousands.</p>
        <p id="p0355">Therefore, similar to previous methodologies employed in the optimization of palettes for single-cell data,<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> we adopt a straightforward stochastic optimization approach employing a coarse-to-fine strategy. Specifically, Spaco initiates the process by generating a set of permutation matrices (default size of 2,000) and identifies the optimal permutation that yields the minimal loss within this set. Subsequently, Spaco randomly selects a pair of clusters and attempts to refine the loss by exchanging color assignments between the two clusters. This fine-tuning process is iterated until a maximum number of permutations is reached (default value of 5,000) or until the loss remains unchanged for 100 consecutive permutations.</p>
      </sec>
    </sec>
    <sec id="sec4.5">
      <title>Integrative colorization for multiple plots</title>
      <p id="p0360">Furthermore, Spaco extends its capabilities to encompass colorization across multiple datasets or label categories by seamlessly integrating multiple CI-graphs.</p>
      <p id="p0365">Prior to the integration of CI-graphs, it is imperative to establish correspondences among identical cell labels present across distinct datasets. Spaco achieves this by evaluating gene expression similarity between clusters from different datasets, utilizing Pearson correlation across the top 5,000 highly variable genes. This similarity is denoted as <inline-formula><mml:math id="M50" altimg="si45.gif"><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M51" altimg="si46.gif"><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M52" altimg="si47.gif"><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula> are the numbers of unique clusters in two different plots.</p>
      <p id="p0370">Similarly, when aligning distinct label categories, such as when tuning the resolution in the clustering refinement process, the intersection over union (IoU) is employed in place of expression similarities.</p>
      <p id="p0375">Once <inline-formula><mml:math id="M53" altimg="si48.gif"><mml:mrow><mml:msup><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is calculated, we employ a greedy approach to iteratively map <inline-formula><mml:math id="M54" altimg="si49.gif"><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M55" altimg="si50.gif"><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>, where<disp-formula id="ufd8"><mml:math id="M56" altimg="si51.gif"><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo linebreak="badbreak">=</mml:mo><mml:msub><mml:mi mathvariant="italic">argmax</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mtext>.</mml:mtext></mml:mrow></mml:math></disp-formula></p>
      <p id="p0380">The corresponding row and column of the mapped indices in <inline-formula><mml:math id="M57" altimg="si48.gif"><mml:mrow><mml:msup><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> are then set to zero to ensure injective mapping. This iteration continues until all clusters have been mapped or until <inline-formula><mml:math id="M58" altimg="si52.gif"><mml:mrow><mml:msub><mml:mi mathvariant="italic">max</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.25em"/><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> falls below a certain threshold (default to 0 for IoU similarity and 0.5 for normalized expression similarity). Unmapped clusters remain distinct after the iteration concludes. Subsequently, cluster labels in various plots are transformed into unified labels using the established mapping, facilitating the integration of CI-graphs.</p>
    </sec>
    <sec id="sec4.6">
      <title>CVD support</title>
      <p id="p0385">When performing a colorblind-friendly colorization, Spaco slightly adjusts the calculation relating to color differences. Colors are converted to three common types of CVD conditions including protanopia, deuteranopia, and tritanopia, following a previously established transformation.<xref rid="bib49" ref-type="bibr"><sup>50</sup></xref> Then, color perceptual differences are calculated separately using these three sets of simulated CVD colors. Finally, the mean value of these three CVD-simulating color differences and a normally calculated full-color-vision color difference is used (1) in the cluster-color assignment module, as edge weights in the adjacency matrix of the CD-graph, and (2) in the image-palette-extraction module, as color differences to punish color frequency. As for colorblind support for one certain type of CVD, only color differences under the given type of CVD simulation are used.</p>
    </sec>
    <sec id="sec4.7">
      <title>Benchmarking on simulated data</title>
      <sec id="sec4.7.1">
        <title>Generation of simulated dataset</title>
        <p id="p0390">In order to comprehensively evaluate the distance calculation methods for the DOI (Spaco), Wasserstein distance, LISI, and 2D KDE (Palo), we utilized the “normal” function from the “<italic>numpy</italic>.<italic>random</italic>” module to generate multiple sets of 2D points with x and y coordinates following a normal distribution with a standard deviation of 25. These point sets were used to simulate spatial topological relationships. We selected two sets of points with center-to-center distances of 10, 50, 70, 120, and 300, representing five spatial topologies: mixed, overlapped, adjacent, isolated, and distant. Specifically, we generated two types of point sets: dense and sparse. Each dense point set contained 100 points, while each sparse point set contained 25 points. We assessed the results of different calculation methods under the aforementioned five spatial topologies in three scenarios: dense point set with dense point set, sparse point set with sparse point set, and dense point set with sparse point set.</p>
      </sec>
      <sec id="sec4.7.2">
        <title>Calculation of Wasserstein distance</title>
        <p id="p0395">We utilized the Python Optimal Transport (POT; <ext-link ext-link-type="uri" xlink:href="https://pythonot.github.io/index.html" id="intref0060">https://pythonot.github.io/index.html</ext-link>) package to compute the Wasserstein distance between pairwise point sets. The POT package offers several solvers related to Optimal Transport. Specifically, we used the “<italic>dist</italic>” function provided in the package to calculate the distance matrix between individual points of the two sets. Subsequently, we used the “emd2” function to solve the Earth Mover’s distance problem, where the weights of each point were set to be equal. The resulting loss obtained from this computation is considered as the Wasserstein distance between the two point sets.</p>
      </sec>
      <sec id="sec4.7.3">
        <title>Calculation of LISI</title>
        <p id="p0400">The LISI represents the average number of labels present in the N-nearest points.<xref rid="bib21" ref-type="bibr"><sup>21</sup></xref> We used the “<italic>lisi</italic>” function provided in the “scPOP”' R package (<ext-link ext-link-type="uri" xlink:href="https://github.com/vinay-swamy/scPOP" id="intref0065">https://github.com/vinay-swamy/scPOP</ext-link>) to calculate the LISI between two sets of points. Specifically, we inputted all the points from both sets into the function, using the categories of each point as the label. The remaining parameters required by function <italic>lisi</italic> were set to their default values. The resulting LISI value between the two point sets was determined by averaging the LISI values of individual points. To invoke the functionality of R packages in Python, we utilized the “rpy2” package (<ext-link ext-link-type="uri" xlink:href="https://github.com/rpy2/rpy2" id="intref0070">https://github.com/rpy2/rpy2</ext-link>).</p>
      </sec>
      <sec id="sec4.7.4">
        <title>Calculation of 2D KDE</title>
        <p id="p0405">The Palo method provides another approach for the color assignment of palettes considering the spatial relationships of single-cell data.<xref rid="bib22" ref-type="bibr"><sup>22</sup></xref> The Palo method consists of three components: spatial overlap score calculation, color dissimilarities calculation, and color assignments. All functionalities are encompassed within the <italic>Palo</italic> function provided in the R package Palo. To meet our evaluation requirements, we extracted the functionality for calculating spatial overlap scores between point sets from the Palo function. We used our complete set of points and categories information as input, and the spatial overlap scores between the point sets calculated by the Palo function were considered as the distances of sets.</p>
      </sec>
    </sec>
    <sec id="sec4.8">
      <title>Benchmarking on real-world data</title>
      <sec id="sec4.8.1">
        <title>Dataset collection</title>
        <p id="p0410">To evaluate the efficacy of Spaco, we collected four distinct real-world datasets spanning different technologies and tissue types.<xref rid="bib9" ref-type="bibr"><sup>9</sup></xref><sup>,</sup><xref rid="bib24" ref-type="bibr"><sup>24</sup></xref><sup>,</sup><xref rid="bib25" ref-type="bibr"><sup>25</sup></xref><sup>,</sup><xref rid="bib26" ref-type="bibr"><sup>26</sup></xref> Each of these datasets has been previously analyzed, as detailed in their original publications. They provide crucial information for Spaco, including expression data, spatial coordinates, and labeling details. These labels represent cell types and anatomical annotations for individual cells or spatial spots. All datasets are publicly available and can be obtained directly from their source publications.</p>
      </sec>
      <sec id="sec4.8.2">
        <title>Measuring perceptual discernibility</title>
        <p id="p0415">As most colors are presented in hexadecimal form of RGB color space, we use the same metric as in CD-graph construction (see <xref rid="sec4" ref-type="sec">experimental procedures</xref>: <xref rid="sec4.4.1" ref-type="sec">calculating perceptual differences</xref>) and employ a CVD simulation (see <xref rid="sec4.6" ref-type="sec">experimental procedures: CVD support</xref>) when benchmarking CVD-supporting colorizations. We measure the discernibility between cell clusters as the perceptual difference between the corresponding colors. For micro-FOVs, the discernibility of a FOV is evaluated as the mean color difference of all cell pairs derived in this FOV. For palettes, the discernibility of a palette is measured as the mean color difference of all color pairs derived in the palette.</p>
      </sec>
      <sec id="sec4.8.3">
        <title>Blind user scoring of colorized spatial plots</title>
        <p id="p0420">To supplementarily assess Spaco’s colorization performance from a user-centric viewpoint, we conducted a single-blind experiment. This experiment involved the creation of a questionnaire administered to 53 participants, all of whom possessed expertise in spatial transcriptomics analysis. The experiment aimed to evaluate the colorization of four distinct plots derived from the STARmap mouse brain dataset<xref rid="bib24" ref-type="bibr"><sup>24</sup></xref> using Spaco, Scanpy (matplotlib), random shuffling, and Palo.</p>
        <p id="p0425">Participants were requested to judge the discernibility of all cell clusters in each plot. To provide a reference of cluster distributions, the questionnaire was supplemented with split plots that highlighted each individual cell cluster. Participants were asked to assign scores to these colorized plots, rating them on a scale from 1 (worst) to 10 (best), based on their perceived quality. The original questionnaire and the gathered results are accessible through the following link: <ext-link ext-link-type="uri" xlink:href="https://github.com/BrainStOrmics/Spaco_scripts" id="intref0075">https://github.com/BrainStOrmics/Spaco_scripts</ext-link>.</p>
        <p id="p0430">This experimental design allows us to comprehensively gauge and compare the effectiveness of Spaco’s colorization with other methods and to draw insightful conclusions from the gathered evaluations. However, a lack of participants with CVD made this survey limited to a full-color-vision perspective. Also, this survey should only be interpreted as a supplementary evaluation paratactic to our computational metric and did not lead to statistical conclusions due to insufficient sample size and potential bias of individual scoring criteria.</p>
      </sec>
    </sec>
  </sec>
</body>
<back>
  <ref-list id="cebib0010">
    <title>References</title>
    <ref id="bib1">
      <label>1</label>
      <element-citation publication-type="journal" id="sref1">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Barkley</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>França</surname>
            <given-names>G.S.</given-names>
          </name>
          <name>
            <surname>Yanai</surname>
            <given-names>I.</given-names>
          </name>
        </person-group>
        <article-title>Exploring tissue architecture using spatial transcriptomics</article-title>
        <source>Nature</source>
        <volume>596</volume>
        <year>2021</year>
        <fpage>211</fpage>
        <lpage>220</lpage>
        <pub-id pub-id-type="pmid">34381231</pub-id>
      </element-citation>
    </ref>
    <ref id="bib2">
      <label>2</label>
      <element-citation publication-type="journal" id="sref2">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Allen</surname>
            <given-names>W.E.</given-names>
          </name>
          <name>
            <surname>Wright</surname>
            <given-names>M.A.</given-names>
          </name>
          <name>
            <surname>Sylwestrak</surname>
            <given-names>E.L.</given-names>
          </name>
          <name>
            <surname>Samusik</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Vesuna</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Evans</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Ramakrishnan</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>J.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>
        <source>Science</source>
        <volume>361</volume>
        <year>2018</year>
        <object-id pub-id-type="publisher-id">eaat5691</object-id>
      </element-citation>
    </ref>
    <ref id="bib3">
      <label>3</label>
      <element-citation publication-type="journal" id="sref3">
        <person-group person-group-type="author">
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Lawson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Dries</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Takei</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Yun</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Cronin</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Karp</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G.-C.</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH</article-title>
        <source>Nature</source>
        <volume>568</volume>
        <year>2019</year>
        <fpage>235</fpage>
        <lpage>239</lpage>
        <pub-id pub-id-type="pmid">30911168</pub-id>
      </element-citation>
    </ref>
    <ref id="bib4">
      <label>4</label>
      <element-citation publication-type="journal" id="sref4">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>P.L.</given-names>
          </name>
          <name>
            <surname>Salmén</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Vickovic</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Lundmark</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>J.F.</given-names>
          </name>
          <name>
            <surname>Magnusson</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Giacomello</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Asp</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Westholm</surname>
            <given-names>J.O.</given-names>
          </name>
          <name>
            <surname>Huss</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science</source>
        <volume>353</volume>
        <year>2016</year>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="bib5">
      <label>5</label>
      <element-citation publication-type="journal" id="sref5">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Liao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Qiu</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Hao</surname>
            <given-names>S.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>
        <source>Cell</source>
        <volume>185</volume>
        <year>2022</year>
        <fpage>1777</fpage>
        <lpage>1792.e21</lpage>
        <pub-id pub-id-type="pmid">35512705</pub-id>
      </element-citation>
    </ref>
    <ref id="bib6">
      <label>6</label>
      <element-citation publication-type="journal" id="sref6">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Lei</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Liao</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Meng</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Bai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Liang</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell spatial transcriptome reveals cell-type organization in the macaque cortex</article-title>
        <source>Cell</source>
        <volume>186</volume>
        <year>2023</year>
        <fpage>3726</fpage>
        <lpage>3743.e24</lpage>
        <pub-id pub-id-type="pmid">37442136</pub-id>
      </element-citation>
    </ref>
    <ref id="bib7">
      <label>7</label>
      <element-citation publication-type="journal" id="sref7">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Siletti</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Furlan</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Gyllborg</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Vinsland</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Mossi Albiach</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Mattsson Langseth</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Khven</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Lederer</surname>
            <given-names>A.R.</given-names>
          </name>
          <name>
            <surname>Dratva</surname>
            <given-names>L.M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the developing mouse brain</article-title>
        <source>Nature</source>
        <volume>596</volume>
        <year>2021</year>
        <fpage>92</fpage>
        <lpage>96</lpage>
        <pub-id pub-id-type="pmid">34321664</pub-id>
      </element-citation>
    </ref>
    <ref id="bib8">
      <label>8</label>
      <element-citation publication-type="journal" id="sref8">
        <person-group person-group-type="author">
          <name>
            <surname>Zeng</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhong</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Qin</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Zeng</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>Y.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The single-cell and spatial transcriptional landscape of human gastrulation and early brain development</article-title>
        <source>Cell Stem Cell</source>
        <volume>30</volume>
        <year>2023</year>
        <fpage>851</fpage>
        <lpage>866.e7</lpage>
        <pub-id pub-id-type="pmid">37192616</pub-id>
      </element-citation>
    </ref>
    <ref id="bib9">
      <label>9</label>
      <element-citation publication-type="journal" id="sref9">
        <person-group person-group-type="author">
          <name>
            <surname>Lohoff</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Ghazanfar</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Missarova</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Pierson</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Griffiths</surname>
            <given-names>J.A.</given-names>
          </name>
          <name>
            <surname>Bardot</surname>
            <given-names>E.S.</given-names>
          </name>
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Tyser</surname>
            <given-names>R.C.V.</given-names>
          </name>
          <name>
            <surname>Argelaguet</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integration of spatial and single-cell transcriptomic data elucidates mouse organogenesis</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>40</volume>
        <year>2022</year>
        <fpage>74</fpage>
        <lpage>85</lpage>
        <pub-id pub-id-type="pmid">34489600</pub-id>
      </element-citation>
    </ref>
    <ref id="bib10">
      <label>10</label>
      <element-citation publication-type="journal" id="sref10">
        <person-group person-group-type="author">
          <name>
            <surname>Berglund</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Maaskola</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Schultz</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Friedrich</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Marklund</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Bergenstråhle</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Tarish</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Tanoglidi</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Vickovic</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Larsson</surname>
            <given-names>L.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial maps of prostate cancer transcriptomes reveal an unexplored landscape of heterogeneity</article-title>
        <source>Nat. Commun.</source>
        <volume>9</volume>
        <year>2018</year>
        <fpage>2419</fpage>
        <pub-id pub-id-type="pmid">29925878</pub-id>
      </element-citation>
    </ref>
    <ref id="bib11">
      <label>11</label>
      <element-citation publication-type="journal" id="sref11">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Yan</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Bai</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Zou</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Hou</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Zhong</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An invasive zone in human liver cancer identified by Stereo-seq promotes hepatocyte-tumor cell crosstalk, local immunosuppression and tumor progression</article-title>
        <source>Cell Res.</source>
        <volume>33</volume>
        <year>2023</year>
        <fpage>585</fpage>
        <lpage>603</lpage>
        <pub-id pub-id-type="pmid">37337030</pub-id>
      </element-citation>
    </ref>
    <ref id="bib12">
      <label>12</label>
      <element-citation publication-type="journal" id="sref12">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>Analysis and Visualization of Spatial Transcriptomic Data</article-title>
        <source>Front. Genet.</source>
        <volume>12</volume>
        <year>2021</year>
        <object-id pub-id-type="publisher-id">785290</object-id>
      </element-citation>
    </ref>
    <ref id="bib13">
      <label>13</label>
      <element-citation publication-type="journal" id="sref13">
        <person-group person-group-type="author">
          <name>
            <surname>Crameri</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Shephard</surname>
            <given-names>G.E.</given-names>
          </name>
          <name>
            <surname>Heron</surname>
            <given-names>P.J.</given-names>
          </name>
        </person-group>
        <article-title>The misuse of colour in science communication</article-title>
        <source>Nat. Commun.</source>
        <volume>11</volume>
        <year>2020</year>
        <fpage>5444</fpage>
        <pub-id pub-id-type="pmid">33116149</pub-id>
      </element-citation>
    </ref>
    <ref id="bib14">
      <label>14</label>
      <element-citation publication-type="journal" id="sref14">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>36</volume>
        <year>2018</year>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="bib15">
      <label>15</label>
      <element-citation publication-type="journal" id="sref15">
        <person-group person-group-type="author">
          <name>
            <surname>Dries</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Eng</surname>
            <given-names>C.-H.L.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Sarkar</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Bao</surname>
            <given-names>F.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>
        <source>Genome Biol.</source>
        <volume>22</volume>
        <year>2021</year>
        <fpage>78</fpage>
        <pub-id pub-id-type="pmid">33685491</pub-id>
      </element-citation>
    </ref>
    <ref id="bib16">
      <label>16</label>
      <element-citation publication-type="journal" id="sref16">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>F.A.</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>F.J.</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <volume>19</volume>
        <year>2018</year>
        <fpage>15</fpage>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="bib17">
      <label>17</label>
      <element-citation publication-type="journal" id="sref17">
        <person-group person-group-type="author">
          <name>
            <surname>Palla</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Spitzer</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Klein</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Schaar</surname>
            <given-names>A.C.</given-names>
          </name>
          <name>
            <surname>Kuemmerle</surname>
            <given-names>L.B.</given-names>
          </name>
          <name>
            <surname>Rybakov</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Ibarra</surname>
            <given-names>I.L.</given-names>
          </name>
          <name>
            <surname>Holmberg</surname>
            <given-names>O.</given-names>
          </name>
          <name>
            <surname>Virshup</surname>
            <given-names>I.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>
        <source>Nat. Methods</source>
        <volume>19</volume>
        <year>2022</year>
        <fpage>171</fpage>
        <lpage>178</lpage>
        <pub-id pub-id-type="pmid">35102346</pub-id>
      </element-citation>
    </ref>
    <ref id="bib18">
      <label>18</label>
      <element-citation publication-type="journal" id="sref18">
        <person-group person-group-type="author">
          <name>
            <surname>Hunter</surname>
            <given-names>J.D.</given-names>
          </name>
        </person-group>
        <article-title>Matplotlib: A 2D Graphics Environment</article-title>
        <source>Comput. Sci. Eng.</source>
        <volume>9</volume>
        <year>2007</year>
        <fpage>90</fpage>
        <lpage>95</lpage>
      </element-citation>
    </ref>
    <ref id="bib19">
      <label>19</label>
      <element-citation publication-type="journal" id="sref19">
        <person-group person-group-type="author">
          <name>
            <surname>Wickham</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Ggplot2</article-title>
        <source>WIREs Computational Stats.</source>
        <volume>3</volume>
        <year>2011</year>
        <fpage>180</fpage>
        <lpage>185</lpage>
      </element-citation>
    </ref>
    <ref id="bib20">
      <label>20</label>
      <element-citation publication-type="journal" id="sref20">
        <person-group person-group-type="author">
          <name>
            <surname>Vaserstein</surname>
            <given-names>L.N.</given-names>
          </name>
        </person-group>
        <article-title>Markov processes over denumerable products of spaces, describing large systems of automata</article-title>
        <source>Probl. Peredachi Inf.</source>
        <volume>5</volume>
        <year>1969</year>
        <fpage>64</fpage>
        <lpage>72</lpage>
      </element-citation>
    </ref>
    <ref id="bib21">
      <label>21</label>
      <element-citation publication-type="journal" id="sref21">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Millard</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Fan</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Slowikowski</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Wei</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Baglaenko</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Loh</surname>
            <given-names>P.-R.</given-names>
          </name>
          <name>
            <surname>Raychaudhuri</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <volume>16</volume>
        <year>2019</year>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="bib22">
      <label>22</label>
      <element-citation publication-type="journal" id="sref22">
        <person-group person-group-type="author">
          <name>
            <surname>Hou</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>Z.</given-names>
          </name>
        </person-group>
        <article-title>Palo: spatially aware color palette optimization for single-cell and spatial data</article-title>
        <source>Bioinformatics</source>
        <volume>38</volume>
        <year>2022</year>
        <fpage>3654</fpage>
        <lpage>3656</lpage>
        <pub-id pub-id-type="pmid">35642896</pub-id>
      </element-citation>
    </ref>
    <ref id="bib23">
      <label>23</label>
      <element-citation publication-type="journal" id="sref23">
        <person-group person-group-type="author">
          <name>
            <surname>Neuwirth</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Brewer</surname>
            <given-names>R.C.</given-names>
          </name>
        </person-group>
        <article-title>Package RColorBrewer palettes</article-title>
        <source>ColorBrewer palettes</source>
        <year>2014</year>
        <fpage>1</fpage>
      </element-citation>
    </ref>
    <ref id="bib24">
      <label>24</label>
      <element-citation publication-type="journal" id="sref24">
        <person-group person-group-type="author">
          <name>
            <surname>Shi</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Maher</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Tan</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial atlas of the mouse central nervous system at molecular resolution</article-title>
        <source>Nature</source>
        <volume>1–10</volume>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib25">
      <label>25</label>
      <element-citation publication-type="journal" id="sref25">
        <person-group person-group-type="author">
          <name>
            <surname>Wei</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Zeng</surname>
            <given-names>Y.-Y.</given-names>
          </name>
          <name>
            <surname>Cheng</surname>
            <given-names>M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell Stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>
        <source>Science</source>
        <volume>377</volume>
        <year>2022</year>
        <object-id pub-id-type="publisher-id">eabp9444</object-id>
      </element-citation>
    </ref>
    <ref id="bib26">
      <label>26</label>
      <element-citation publication-type="journal" id="sref26">
        <person-group person-group-type="author">
          <name>
            <surname>Jackson</surname>
            <given-names>H.W.</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>J.R.</given-names>
          </name>
          <name>
            <surname>Zanotelli</surname>
            <given-names>V.R.T.</given-names>
          </name>
          <name>
            <surname>Ali</surname>
            <given-names>H.R.</given-names>
          </name>
          <name>
            <surname>Mechera</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Soysal</surname>
            <given-names>S.D.</given-names>
          </name>
          <name>
            <surname>Moch</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Muenst</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Varga</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>W.P.</given-names>
          </name>
          <name>
            <surname>Bodenmiller</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <article-title>The single-cell pathology landscape of breast cancer</article-title>
        <source>Nature</source>
        <volume>578</volume>
        <year>2020</year>
        <fpage>615</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="pmid">31959985</pub-id>
      </element-citation>
    </ref>
    <ref id="bib50">
      <label>27</label>
      <element-citation publication-type="journal" id="sref50">
        <person-group person-group-type="author">
          <name>
            <surname>Virshup</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Rybakov</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>F.J.</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Alexander Wolf</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <article-title>anndata: Annotated data</article-title>
        <comment>Preprint at</comment>
        <source>bioRxiv</source>
        <year>2021</year>
        <pub-id pub-id-type="doi">10.1101/2021.12.16.473007</pub-id>
      </element-citation>
    </ref>
    <ref id="bib27">
      <label>28</label>
      <element-citation publication-type="journal" id="sref28">
        <person-group person-group-type="author">
          <name>
            <surname>McInnes</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Healy</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Melville</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction</article-title>
        <comment>Preprint at</comment>
        <source>arXiv</source>
        <year>2018</year>
        <pub-id pub-id-type="doi">10.48550/arXiv.1802.03426</pub-id>
      </element-citation>
    </ref>
    <ref id="bib28">
      <label>29</label>
      <element-citation publication-type="journal" id="sref51">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Wandell</surname>
            <given-names>B.A.</given-names>
          </name>
        </person-group>
        <article-title>A Spatial Extension of CIELAB for digital color image reproduction</article-title>
        <source>J. Soc. Inf. Display</source>
        <volume>5</volume>
        <year>2012</year>
        <fpage>61</fpage>
        <lpage>63</lpage>
      </element-citation>
    </ref>
    <ref id="bib29">
      <label>30</label>
      <element-citation publication-type="journal" id="sref29">
        <person-group person-group-type="author">
          <name>
            <surname>Eldar</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Lindenbaum</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Porat</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Zeevi</surname>
            <given-names>Y.Y.</given-names>
          </name>
        </person-group>
        <article-title>The farthest point strategy for progressive image sampling</article-title>
        <source>IEEE Trans. Image Process.</source>
        <volume>6</volume>
        <year>1997</year>
        <fpage>1305</fpage>
        <lpage>1315</lpage>
        <pub-id pub-id-type="pmid">18283019</pub-id>
      </element-citation>
    </ref>
    <ref id="bib30">
      <label>31</label>
      <element-citation publication-type="journal" id="sref30">
        <person-group person-group-type="author">
          <name>
            <surname>Sunkin</surname>
            <given-names>S.M.</given-names>
          </name>
          <name>
            <surname>Ng</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Lau</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Dolbeare</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Gilbert</surname>
            <given-names>T.L.</given-names>
          </name>
          <name>
            <surname>Thompson</surname>
            <given-names>C.L.</given-names>
          </name>
          <name>
            <surname>Hawrylycz</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Dang</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Allen Brain Atlas: an integrated spatio-temporal portal for exploring the central nervous system</article-title>
        <source>Nucleic Acids Res.</source>
        <volume>41</volume>
        <year>2013</year>
        <fpage>D996</fpage>
        <lpage>D1008</lpage>
        <pub-id pub-id-type="pmid">23193282</pub-id>
      </element-citation>
    </ref>
    <ref id="bib31">
      <label>32</label>
      <element-citation publication-type="journal" id="sref31">
        <person-group person-group-type="author">
          <name>
            <surname>Brettel</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Viénot</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Mollon</surname>
            <given-names>J.D.</given-names>
          </name>
        </person-group>
        <article-title>Computerized simulation of color appearance for dichromats</article-title>
        <source>J. Opt. Soc. Am. Opt Image Sci. Vis.</source>
        <volume>14</volume>
        <year>1997</year>
        <fpage>2647</fpage>
        <lpage>2655</lpage>
      </element-citation>
    </ref>
    <ref id="bib32">
      <label>33</label>
      <element-citation publication-type="journal" id="sref32">
        <person-group person-group-type="author">
          <name>
            <surname>Petukhov</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>R.J.</given-names>
          </name>
          <name>
            <surname>Soldatov</surname>
            <given-names>R.A.</given-names>
          </name>
          <name>
            <surname>Cadinu</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Khodosevich</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Moffitt</surname>
            <given-names>J.R.</given-names>
          </name>
          <name>
            <surname>Kharchenko</surname>
            <given-names>P.V.</given-names>
          </name>
        </person-group>
        <article-title>Cell segmentation in imaging-based spatial transcriptomics</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>40</volume>
        <year>2022</year>
        <fpage>345</fpage>
        <lpage>354</lpage>
        <pub-id pub-id-type="pmid">34650268</pub-id>
      </element-citation>
    </ref>
    <ref id="bib33">
      <label>34</label>
      <element-citation publication-type="journal" id="sref33">
        <person-group person-group-type="author">
          <name>
            <surname>Mah</surname>
            <given-names>C.K.</given-names>
          </name>
          <name>
            <surname>Ahmed</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Lam</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Monell</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Kern</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Cesnik</surname>
            <given-names>A.J.</given-names>
          </name>
          <name>
            <surname>Lundberg</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Carter</surname>
            <given-names>H.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bento: A toolkit for subcellular analysis of spatial transcriptomics data</article-title>
        <source>Preprint at bioRxiv</source>
        <year>2022</year>
        <pub-id pub-id-type="doi">10.1101/2022.06.10.495510</pub-id>
      </element-citation>
    </ref>
    <ref id="bib34">
      <label>35</label>
      <element-citation publication-type="journal" id="sref34">
        <person-group person-group-type="author">
          <name>
            <surname>Poplin</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>P.-C.</given-names>
          </name>
          <name>
            <surname>Alexander</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Schwartz</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Colthurst</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Ku</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Newburger</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Dijamco</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Nguyen</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Afshar</surname>
            <given-names>P.T.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A universal SNP and small-indel variant caller using deep neural networks</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>36</volume>
        <year>2018</year>
        <fpage>983</fpage>
        <lpage>987</lpage>
        <pub-id pub-id-type="pmid">30247488</pub-id>
      </element-citation>
    </ref>
    <ref id="bib35">
      <label>36</label>
      <element-citation publication-type="journal" id="sref35">
        <person-group person-group-type="author">
          <name>
            <surname>Bunis</surname>
            <given-names>D.G.</given-names>
          </name>
          <name>
            <surname>Andrews</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Fragiadakis</surname>
            <given-names>G.K.</given-names>
          </name>
          <name>
            <surname>Burt</surname>
            <given-names>T.D.</given-names>
          </name>
          <name>
            <surname>Sirota</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>dittoSeq: universal user-friendly single-cell and bulk RNA sequencing visualization toolkit</article-title>
        <source>Bioinformatics</source>
        <volume>36</volume>
        <year>2021</year>
        <fpage>5535</fpage>
        <lpage>5536</lpage>
        <pub-id pub-id-type="pmid">33313640</pub-id>
      </element-citation>
    </ref>
    <ref id="bib36">
      <label>37</label>
      <element-citation publication-type="book" id="sref36">
        <person-group person-group-type="author">
          <name>
            <surname>Crameri</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <source>Scientific Colour Maps (8.0.1). Zenodo</source>
        <year>2023</year>
        <pub-id pub-id-type="doi">10.5281/zenodo.1243862</pub-id>
      </element-citation>
    </ref>
    <ref id="bib37">
      <label>38</label>
      <element-citation publication-type="other" id="sref37">
        <person-group person-group-type="author">
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q.</given-names>
          </name>
        </person-group>
        <article-title>BrainStOrmics/Spaco: Spaco 0.2. Zenodo</article-title>
        <pub-id pub-id-type="doi">10.5281/zenodo.10121765</pub-id>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib38">
      <label>39</label>
      <element-citation publication-type="other" id="sref38">
        <person-group person-group-type="author">
          <name>
            <surname>Jing</surname>
            <given-names>Z.</given-names>
          </name>
        </person-group>
        <article-title>BrainStOrmics/Spaco_scripts: Spaco_scripts_231111. Zenodo</article-title>
        <pub-id pub-id-type="doi">10.5281/zenodo.10113360</pub-id>
        <year>2023</year>
      </element-citation>
    </ref>
    <ref id="bib39">
      <label>40</label>
      <element-citation publication-type="journal" id="sref39">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Stone</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Ren</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Guenthoer</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Smythe</surname>
            <given-names>K.S.</given-names>
          </name>
          <name>
            <surname>Pulliam</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>S.R.</given-names>
          </name>
          <name>
            <surname>Uytingco</surname>
            <given-names>C.R.</given-names>
          </name>
          <name>
            <surname>Taylor</surname>
            <given-names>S.E.B.</given-names>
          </name>
          <name>
            <surname>Nghiem</surname>
            <given-names>P.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>
        <source>Nat. Biotechnol.</source>
        <volume>39</volume>
        <year>2021</year>
        <fpage>1375</fpage>
        <lpage>1384</lpage>
        <pub-id pub-id-type="pmid">34083791</pub-id>
      </element-citation>
    </ref>
    <ref id="bib40">
      <label>41</label>
      <element-citation publication-type="journal" id="sref40">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Coleman</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Schroeder</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Irwin</surname>
            <given-names>D.J.</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>E.B.</given-names>
          </name>
          <name>
            <surname>Shinohara</surname>
            <given-names>R.T.</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>
        <source>Nat. Methods</source>
        <volume>18</volume>
        <year>2021</year>
        <fpage>1342</fpage>
        <lpage>1351</lpage>
        <pub-id pub-id-type="pmid">34711970</pub-id>
      </element-citation>
    </ref>
    <ref id="bib41">
      <label>42</label>
      <element-citation publication-type="journal" id="sref41">
        <person-group person-group-type="author">
          <name>
            <surname>Chari</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L.</given-names>
          </name>
        </person-group>
        <article-title>The specious art of single-cell genomics</article-title>
        <source>PLoS Comput. Biol.</source>
        <volume>19</volume>
        <year>2023</year>
        <object-id pub-id-type="publisher-id">e1011288</object-id>
      </element-citation>
    </ref>
    <ref id="bib42">
      <label>43</label>
      <element-citation publication-type="journal" id="sref42">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Lu</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Lanir</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>H.</given-names>
          </name>
        </person-group>
        <article-title>Image-guided color mapping for categorical data visualization</article-title>
        <source>Comput. Vis. Media (Beijing).</source>
        <volume>8</volume>
        <year>2022</year>
        <fpage>613</fpage>
        <lpage>629</lpage>
      </element-citation>
    </ref>
    <ref id="bib43">
      <label>44</label>
      <element-citation publication-type="journal" id="sref43">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q.</given-names>
          </name>
          <name>
            <surname>Xiao</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>F.</given-names>
          </name>
        </person-group>
        <article-title>Palette-Based Image Recoloring Using Color Decomposition Optimization</article-title>
        <source>IEEE Trans. Image Process.</source>
        <volume>26</volume>
        <year>2017</year>
        <fpage>1952</fpage>
        <lpage>1964</lpage>
        <pub-id pub-id-type="pmid">28237926</pub-id>
      </element-citation>
    </ref>
    <ref id="bib44">
      <label>45</label>
      <element-citation publication-type="journal" id="sref44">
        <person-group person-group-type="author">
          <name>
            <surname>Luo</surname>
            <given-names>M.R.</given-names>
          </name>
          <name>
            <surname>Cui</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Rigg</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <article-title>The development of the CIE 2000 colour-difference formula: CIEDE2000</article-title>
        <source>Color Res. Appl.</source>
        <volume>26</volume>
        <year>2001</year>
        <fpage>340</fpage>
        <lpage>350</lpage>
      </element-citation>
    </ref>
    <ref id="bib45">
      <label>46</label>
      <element-citation publication-type="other" id="sref45">
        <person-group person-group-type="author">
          <name>
            <surname>Riemersma</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>Colour Metric</article-title>
        <ext-link ext-link-type="uri" xlink:href="https://www.compuphase.com/cmetric.htm" id="interref0020">https://www.compuphase.com/cmetric.htm</ext-link>
        <year>2019</year>
      </element-citation>
    </ref>
    <ref id="bib46">
      <label>47</label>
      <element-citation publication-type="journal" id="sref46">
        <person-group person-group-type="author">
          <name>
            <surname>Grohe</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Rattan</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Woeginger</surname>
            <given-names>G.J.</given-names>
          </name>
        </person-group>
        <article-title>Graph Similarity and Approximate Isomorphism</article-title>
        <comment>Preprint at</comment>
        <source>arXiv</source>
        <year>2018</year>
        <pub-id pub-id-type="doi">10.48550/arXiv.1802.08509</pub-id>
      </element-citation>
    </ref>
    <ref id="bib47">
      <label>48</label>
      <element-citation publication-type="journal" id="sref47">
        <person-group person-group-type="author">
          <name>
            <surname>Koopmans</surname>
            <given-names>T.C.</given-names>
          </name>
          <name>
            <surname>Beckmann</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>Assignment problems and the location of economic activities</article-title>
        <source>Econometrica</source>
        <volume>25</volume>
        <year>1957</year>
        <fpage>53</fpage>
      </element-citation>
    </ref>
    <ref id="bib48">
      <label>49</label>
      <element-citation publication-type="journal" id="sref48">
        <person-group person-group-type="author">
          <name>
            <surname>Sahni</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Gonzalez</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>P-complete approximation problems</article-title>
        <source>J. ACM</source>
        <volume>23</volume>
        <year>1976</year>
        <fpage>555</fpage>
        <lpage>565</lpage>
      </element-citation>
    </ref>
    <ref id="bib49">
      <label>50</label>
      <element-citation publication-type="journal" id="sref49">
        <person-group person-group-type="author">
          <name>
            <surname>Elrefaei</surname>
            <given-names>L.A.</given-names>
          </name>
        </person-group>
        <article-title>Smartphone Based Image Color Correction for Color Blindness</article-title>
        <source>Int. J. Interact. Mob. Technol.</source>
        <volume>12</volume>
        <year>2018</year>
        <fpage>104</fpage>
        <lpage>119</lpage>
      </element-citation>
    </ref>
  </ref-list>
  <sec id="appsec2" sec-type="supplementary-material">
    <title>Supplemental information</title>
    <p id="p0460">
      <supplementary-material content-type="local-data" id="mmc1">
        <caption>
          <title>Document S1. Figures S1–S6</title>
        </caption>
        <media xlink:href="mmc1.pdf"/>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="mmc2">
        <caption>
          <title>Document S2. Article plus supplemental information</title>
        </caption>
        <media xlink:href="mmc2.pdf"/>
      </supplementary-material>
    </p>
  </sec>
  <ack id="ack0010">
    <title>Acknowledgments</title>
    <p id="p0435">This work was supported by the <funding-source id="gs1"><institution-wrap><institution-id institution-id-type="doi">10.13039/501100012166</institution-id><institution>National Key R&amp;D Program of China</institution></institution-wrap></funding-source> (2022YFC3400400) (X.X.) and the <funding-source id="gs2">Guangdong Provincial Key Laboratory of Genome Read and Write</funding-source> (X.X.). We are sincerely thankful for the technical support provided by <funding-source id="gs3">China National Gene Bank</funding-source>.</p>
    <sec id="sec5">
      <title>Author contributions</title>
      <p id="p0440">Conceptualization, Y.B. and H.P.; methodology, Z.J. and Q.Z.; software, Z.J., Q.Z., and L.L.; formal analysis, Z.J., L.L., Y.X., and Q.Z.; validation, Z.J. and Y.X.; investigation, Y.X. and B.Y.; writing – original draft, Z.J.; writing – review &amp; editing, Z.J., Y.B., X.W., L.L., H.P., Y.X., Q.F., and B.D.; funding acquisition, X.X.; resources, Y.B. and X.X.; supervision, Y.B., H.P., and X.X.</p>
    </sec>
    <sec sec-type="COI-statement" id="sec6">
      <title>Declaration of interests</title>
      <p id="p0445">The authors declare no competing interests.</p>
    </sec>
    <sec id="sec7">
      <title>Declaration of generative AI and AI-assisted technologies in the writing process</title>
      <p id="p0450">During the preparation of this work, the authors used ChatGPT 4.0 (GPT-4) in order to facilitate the process of proofreading the contents of our draft. After using this tool/service, the authors reviewed and edited the content as needed and take full responsibility for the content of the publication.</p>
    </sec>
  </ack>
  <fn-group>
    <fn id="appsec1" fn-type="supplementary-material">
      <p id="p0455">Supplemental information can be found online at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.patter.2023.100915" id="intref0080">https://doi.org/10.1016/j.patter.2023.100915</ext-link>.</p>
    </fn>
  </fn-group>
</back>
