<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS Comput Biol</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">ploscomp</journal-id>
    <journal-title-group>
      <journal-title>PLoS Computational Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1553-734X</issn>
    <issn pub-type="epub">1553-7358</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7546467</article-id>
    <article-id pub-id-type="pmid">32966276</article-id>
    <article-id pub-id-type="publisher-id">PCOMPBIOL-D-20-00409</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1008270</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Cell biology</subject>
          <subj-group>
            <subject>Chromosome biology</subject>
            <subj-group>
              <subject>Chromatin</subject>
              <subj-group>
                <subject>Chromatin modification</subject>
                <subj-group>
                  <subject>DNA methylation</subject>
                </subj-group>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Epigenetics</subject>
            <subj-group>
              <subject>Chromatin</subject>
              <subj-group>
                <subject>Chromatin modification</subject>
                <subj-group>
                  <subject>DNA methylation</subject>
                </subj-group>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Gene expression</subject>
            <subj-group>
              <subject>Chromatin</subject>
              <subj-group>
                <subject>Chromatin modification</subject>
                <subj-group>
                  <subject>DNA methylation</subject>
                </subj-group>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>DNA</subject>
            <subj-group>
              <subject>DNA modification</subject>
              <subj-group>
                <subject>DNA methylation</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Biochemistry</subject>
          <subj-group>
            <subject>Nucleic acids</subject>
            <subj-group>
              <subject>DNA</subject>
              <subj-group>
                <subject>DNA modification</subject>
                <subj-group>
                  <subject>DNA methylation</subject>
                </subj-group>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Epigenetics</subject>
            <subj-group>
              <subject>DNA modification</subject>
              <subj-group>
                <subject>DNA methylation</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Gene expression</subject>
            <subj-group>
              <subject>DNA modification</subject>
              <subj-group>
                <subject>DNA methylation</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Physical Sciences</subject>
        <subj-group>
          <subject>Chemistry</subject>
          <subj-group>
            <subject>Chemical Reactions</subject>
            <subj-group>
              <subject>Methylation</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Oncology</subject>
          <subj-group>
            <subject>Cancers and Neoplasms</subject>
            <subj-group>
              <subject>Breast Tumors</subject>
              <subj-group>
                <subject>Breast Cancer</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Molecular Biology</subject>
          <subj-group>
            <subject>Molecular Biology Techniques</subject>
            <subj-group>
              <subject>Cloning</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Molecular Biology Techniques</subject>
          <subj-group>
            <subject>Cloning</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Mathematical and Statistical Techniques</subject>
          <subj-group>
            <subject>Cluster Analysis</subject>
            <subj-group>
              <subject>Hierarchical Clustering</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Cell Biology</subject>
          <subj-group>
            <subject>Chromosome Biology</subject>
            <subj-group>
              <subject>Chromosomes</subject>
              <subj-group>
                <subject>Sex Chromosomes</subject>
                <subj-group>
                  <subject>X Chromosomes</subject>
                </subj-group>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Medicine and Health Sciences</subject>
        <subj-group>
          <subject>Oncology</subject>
          <subj-group>
            <subject>Basic Cancer Research</subject>
            <subj-group>
              <subject>Cancer Genomics</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Genomic Medicine</subject>
              <subj-group>
                <subject>Cancer Genomics</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Genomics</subject>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Epiclomal: Probabilistic clustering of sparse single-cell DNA methylation data</article-title>
      <alt-title alt-title-type="running-head">Epiclomal: Probabilistic clustering of sparse single-cell DNA methylation data</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-4465-5792</contrib-id>
        <name>
          <surname>P. E. de Souza</surname>
          <given-names>Camila</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Investigation</role>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <role content-type="https://casrai.org/credit/">Project administration</role>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Visualization</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Andronescu</surname>
          <given-names>Mirela</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Formal analysis</role>
        <role content-type="https://casrai.org/credit/">Investigation</role>
        <role content-type="https://casrai.org/credit/">Methodology</role>
        <role content-type="https://casrai.org/credit/">Project administration</role>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Visualization</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <role content-type="https://casrai.org/credit/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Masud</surname>
          <given-names>Tehmina</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-3456-507X</contrib-id>
        <name>
          <surname>Kabeer</surname>
          <given-names>Farhia</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-4104-5486</contrib-id>
        <name>
          <surname>Biele</surname>
          <given-names>Justina</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Laks</surname>
          <given-names>Emma</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
        <xref ref-type="aff" rid="aff004">
          <sup>4</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9203-6323</contrib-id>
        <name>
          <surname>Lai</surname>
          <given-names>Daniel</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ye</surname>
          <given-names>Patricia</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Software</role>
        <role content-type="https://casrai.org/credit/">Visualization</role>
        <xref ref-type="aff" rid="aff005">
          <sup>5</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2692-0035</contrib-id>
        <name>
          <surname>Brimhall</surname>
          <given-names>Jazmine</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-7260-2885</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Beixi</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-3156-176X</contrib-id>
        <name>
          <surname>Su</surname>
          <given-names>Edmund</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff006">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0658-054X</contrib-id>
        <name>
          <surname>Hui</surname>
          <given-names>Tony</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff006">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cao</surname>
          <given-names>Qi</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff006">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-1931-968X</contrib-id>
        <name>
          <surname>Wong</surname>
          <given-names>Marcus</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff006">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-7852-4790</contrib-id>
        <name>
          <surname>Moksa</surname>
          <given-names>Michelle</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff006">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Moore</surname>
          <given-names>Richard A.</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Data curation</role>
        <xref ref-type="aff" rid="aff007">
          <sup>7</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9136-9054</contrib-id>
        <name>
          <surname>Hirst</surname>
          <given-names>Martin</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Resources</role>
        <xref ref-type="aff" rid="aff006">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0487-9599</contrib-id>
        <name>
          <surname>Aparicio</surname>
          <given-names>Samuel</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Conceptualization</role>
        <role content-type="https://casrai.org/credit/">Funding acquisition</role>
        <role content-type="https://casrai.org/credit/">Project administration</role>
        <role content-type="https://casrai.org/credit/">Supervision</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-6402-523X</contrib-id>
        <name>
          <surname>Shah</surname>
          <given-names>Sohrab P.</given-names>
        </name>
        <role content-type="https://casrai.org/credit/">Conceptualization</role>
        <role content-type="https://casrai.org/credit/">Funding acquisition</role>
        <role content-type="https://casrai.org/credit/">Project administration</role>
        <role content-type="https://casrai.org/credit/">Supervision</role>
        <role content-type="https://casrai.org/credit/">Writing – original draft</role>
        <xref ref-type="aff" rid="aff008">
          <sup>8</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Department of Statistical and Actuarial Sciences, University of Western Ontario, London, ON, Canada</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Department of Molecular Oncology, British Columbia Cancer Research Centre, Vancouver, BC, Canada</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Department of Pathology and Laboratory Medicine, University of British Columbia, Vancouver, BC, Canada</addr-line>
    </aff>
    <aff id="aff004">
      <label>4</label>
      <addr-line>Genome Science and Technology Graduate Program, University of British Columbia, Vancouver, BC, Canada</addr-line>
    </aff>
    <aff id="aff005">
      <label>5</label>
      <addr-line>Department of Statistics and Department of Computer Science, University of British Columbia, Vancouver, BC, Canada</addr-line>
    </aff>
    <aff id="aff006">
      <label>6</label>
      <addr-line>Department of Microbiology and Immunology and Michael Smith Laboratories, University of British Columbia, Vancouver, BC, Canada</addr-line>
    </aff>
    <aff id="aff007">
      <label>7</label>
      <addr-line>Genome Sciences Centre, BC Cancer, Vancouver, BC, Canada</addr-line>
    </aff>
    <aff id="aff008">
      <label>8</label>
      <addr-line>Department of Epidemiology and Biostatistics, Memorial Sloan Kettering Cancer Center, New York, NY, USA</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Panchenko</surname>
          <given-names>Anna R.</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Queen’s University, CANADA</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p>S.A. and S.P.S are cofounders and consultants to Canexia Health Inc. S.A is a consultant to Sangamo Pharmaceuticals and Repare Therapeutics. Author Emma Laks was unable to confirm their authorship contributions. On their behalf, the corresponding author has reported their contributions to the best of their knowledge.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>camila.souza@uwo.ca</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>9</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>23</day>
      <month>9</month>
      <year>2020</year>
    </pub-date>
    <volume>16</volume>
    <issue>9</issue>
    <elocation-id>e1008270</elocation-id>
    <history>
      <date date-type="received">
        <day>11</day>
        <month>3</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>18</day>
        <month>8</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2020 P. E. de Souza et al</copyright-statement>
      <copyright-year>2020</copyright-year>
      <copyright-holder>P. E. de Souza et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pcbi.1008270.pdf"/>
    <abstract>
      <p>We present Epiclomal, a probabilistic clustering method arising from a hierarchical mixture model to simultaneously cluster sparse single-cell DNA methylation data and impute missing values. Using synthetic and published single-cell CpG datasets, we show that Epiclomal outperforms non-probabilistic methods and can handle the inherent missing data characteristic that dominates single-cell CpG genome sequences. Using newly generated single-cell 5mCpG sequencing data, we show that Epiclomal discovers sub-clonal methylation patterns in aneuploid tumour genomes, thus defining epiclones that can match or transcend copy number-determined clonal lineages and opening up an important form of clonal analysis in cancer. Epiclomal is written in R and Python and is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/shahcompbio/Epiclomal">https://github.com/shahcompbio/Epiclomal</ext-link>.</p>
    </abstract>
    <abstract abstract-type="summary">
      <title>Author summary</title>
      <p>DNA methylation is an epigenetic mark that occurs when methyl groups are attached to the DNA molecule, thereby playing decisive roles in numerous biological processes. Advances in technology have allowed the generation of high-throughput DNA methylation sequencing data from single cells. One of the goals is to group cells according to their DNA methylation profiles; however, a major challenge arises due to a large amount of missing data per cell. To address this problem, we developed a novel statistical model and framework: Epiclomal. Our approach uses a hierarchical mixture model to borrow statistical strength across cells and neighboring loci to accurately define cell groups (clusters). We compare our approach to different methods on both synthetic and published datasets. We show that Epiclomal is more robust than other approaches, producing more accurate clusters of cells in the majority of experimental scenarios. We also apply Epiclomal to newly generated single-cell DNA methylation data from breast cancer xenografts. Our results show that methylation-based clusters can mirror or in some instances transcend the clusters defined by single-cell copy number analysis. This illustrates the importance of single-cell DNA methylation analysis in understanding cellular heterogeneity in cancer.</p>
    </abstract>
    <funding-group>
      <funding-statement>We acknowledge generous funding support provided by the BC Cancer Foundation. S.A. is supported by grants from CIHR, Terry Fox Research Institute, Canadian Cancer Society Research Institute, and the Breast Cancer Research Foundation. S.P.S. is supported by CIHR, Terry Fox Research Institute (grant 1082) and the Canadian Cancer Society (grant 705636). C.P.E.d.S. is supported by the National Science and Engineering Research Council of Canada. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="8"/>
      <table-count count="2"/>
      <page-count count="24"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>PLOS Publication Stage</meta-name>
        <meta-value>vor-update-to-uncorrected-proof</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>Publication Update</meta-name>
        <meta-value>2020-10-09</meta-value>
      </custom-meta>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>Our raw InHouse and SA501 DNA methylation data are available at the European Genome-Phenome Archive (<ext-link ext-link-type="uri" xlink:href="https://ega-archive.org/">https://ega-archive.org/</ext-link>), accession number EGAS00001003504.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>Our raw InHouse and SA501 DNA methylation data are available at the European Genome-Phenome Archive (<ext-link ext-link-type="uri" xlink:href="https://ega-archive.org/">https://ega-archive.org/</ext-link>), accession number EGAS00001003504.</p>
  </notes>
</front>
<body>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>DNA methylation of the fifth cytosine position (5mC) is a well studied epigenetic mark that plays decisive roles in the regulation of cell transcriptional programs [<xref rid="pcbi.1008270.ref001" ref-type="bibr">1</xref>]. In mammals, 5mC occurs mainly at CpG dinucleotides [<xref rid="pcbi.1008270.ref002" ref-type="bibr">2</xref>] whose distribution is clustered within regions of the genome called CpG islands (CGIs). Bisulfite mediated conversion of 5mC to uracil, referred to as bisulfite sequencing, has been a key tool for quantifying genome-wide DNA methylation at single-cytosine resolution. Advances in technology and laboratory protocols have made it possible to generate high-throughput sequencing data for individual cells [<xref rid="pcbi.1008270.ref003" ref-type="bibr">3</xref>–<xref rid="pcbi.1008270.ref006" ref-type="bibr">6</xref>]. In particular, single-cell whole-genome bisulfite sequencing (sc-WGBS) techniques have been developed to assess the epigenetic diversity of a cell population [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>, <xref rid="pcbi.1008270.ref008" ref-type="bibr">8</xref>]. Because of the limited amount of DNA material, the generated sc-WGBS data are usually sparse, that is, data from many CpG sites are missing and/or are subject to sequencing error. Therefore, there is a great need to develop statistical and computational methods to cluster cells according to their DNA methylation profiles and dealing with the extreme sparsity of the data. The resulting clusters can be used for identification of cancer tumor cell subpopulations [<xref rid="pcbi.1008270.ref009" ref-type="bibr">9</xref>–<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>], detection of previously unknown cell types as well as deeper characterization of known ones [<xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>–<xref rid="pcbi.1008270.ref014" ref-type="bibr">14</xref>], and imputation of missing CpG data by enabling information to be pooled across cells within the same cluster [<xref rid="pcbi.1008270.ref015" ref-type="bibr">15</xref>].</p>
    <p>An increasing amount of sc-WGBS data has been generated from various cell types, including mouse embryonic stem cells [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>, <xref rid="pcbi.1008270.ref017" ref-type="bibr">17</xref>], human hematopoietic stem cells [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>, <xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>], human hepatocellular carcinomas [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>], mouse hepatocytes and fibroblasts [<xref rid="pcbi.1008270.ref013" ref-type="bibr">13</xref>], human and mouse brain cells [<xref rid="pcbi.1008270.ref014" ref-type="bibr">14</xref>], and human cell lines [<xref rid="pcbi.1008270.ref018" ref-type="bibr">18</xref>]. To assess the epigenetic diversity in these different cell populations, a variety of non-probabilistic methods have been considered. Smallwood <italic>et al</italic>. [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>] proposed a sliding window approach to compute methylation rates of CpG sites across the genome followed by complete-linkage hierarchical clustering considering Euclidean distances and the most variable sites. Angermueller et al. [<xref rid="pcbi.1008270.ref017" ref-type="bibr">17</xref>] computed the mean methylation levels across gene bodies and as in [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>], clustered the cells using hierarchical clustering and only the most variable genes. Farlik <italic>et al</italic>. [<xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>] clustered cells based on their average methylation over different sets of transcription factor binding sites also using hierarchical clustering. Gravina <italic>et al</italic>. [<xref rid="pcbi.1008270.ref013" ref-type="bibr">13</xref>] considered the sliding window approach of [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>] to compute methylation rates and used principal component analysis to visually assess clusters of cells. Hou <italic>et al</italic>. [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>] considered the CpG-based Pearson correlation between pairs of cells followed by hierarchical clustering. Luo <italic>et al</italic>. [<xref rid="pcbi.1008270.ref014" ref-type="bibr">14</xref>] first applied a hierarchical clustering method called BackSPIN [<xref rid="pcbi.1008270.ref019" ref-type="bibr">19</xref>] to bin-based methylation rates, followed by cluster merging using gene body methylation levels. Mulqueen <italic>et al</italic>. [<xref rid="pcbi.1008270.ref018" ref-type="bibr">18</xref>] used NMF (non-negative matrix factorization, [<xref rid="pcbi.1008270.ref020" ref-type="bibr">20</xref>]) and tSNE [<xref rid="pcbi.1008270.ref021" ref-type="bibr">21</xref>] for dimensionality reduction, followed by DBSCAN [<xref rid="pcbi.1008270.ref022" ref-type="bibr">22</xref>] for clustering. Hui <italic>et al</italic>. [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>] proposed PDclust, a genome-wide pairwise dissimilarity clustering strategy that leverages the methylation states of individual CpGs. Recently, Kapourani and Sanguinetti [<xref rid="pcbi.1008270.ref015" ref-type="bibr">15</xref>] proposed a probabilistic clustering method based on a hierarchical mixture of probit regression models and focused their evaluation on missing CpG data imputation. Angermuller <italic>et al</italic>. [<xref rid="pcbi.1008270.ref023" ref-type="bibr">23</xref>] also proposed a deep learning approach for CpG missing data imputation, but did not address the clustering problem.</p>
    <p>Despite the considerable diversity in clustering approaches, there is still a great need for probabilistic, model-based approaches to simultaneously cluster sc-WGBS data while also inferring the missing methylation states. Because such methods enable statistical strength to be borrowed across cells and neighbouring CpGs by assuming that data within the same cell cluster and genomic region share the same model distribution parameters, we surmise that they should provide more robust inference than non-probabilistic methods.</p>
    <p>In this work, we propose Epiclomal, a probabilistic algorithm to cluster sparse CpG-based DNA methylation data from sc-WGBS. Our approach is based on a hierarchical mixture model (see the graphical models in <xref ref-type="fig" rid="pcbi.1008270.g001">Fig 1</xref>), which pools information from observed data across all cells and neighbouring CpGs to infer cell-specific cluster assignments and their corresponding hidden methylation profiles. Epiclomal is part of a novel comprehensive statistical and computational framework (<xref ref-type="fig" rid="pcbi.1008270.g002">Fig 2</xref>) that includes data pre-processing, different clustering methods corresponding to previously proposed approaches [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>, <xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>, <xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>–<xref rid="pcbi.1008270.ref018" ref-type="bibr">18</xref>], plotting, and quantitative performance evaluation measures to analyze the results. We use our framework to present an assessment of clustering methods over previously published and synthetic data sets, plus a novel large-scale sc-WGBS data set from breast cancer xenografts [<xref rid="pcbi.1008270.ref010" ref-type="bibr">10</xref>, <xref rid="pcbi.1008270.ref024" ref-type="bibr">24</xref>] generated using state-of-the-art methodology [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>].</p>
    <fig id="pcbi.1008270.g001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g001</object-id>
      <label>Fig 1</label>
      <caption>
        <title>(a) EpiclomalBasic and (b) EpiclomalRegion graphical models.</title>
        <p>In (a), the shaded node <italic>X</italic><sub><italic>nm</italic></sub> denotes the observed methylation state at CpG site <italic>m</italic> of cell <italic>n</italic>. In (b), we take into account the region location of each CpG and let the shaded node <italic>X</italic><sub><italic>nrl</italic></sub> denote the observed methylation state at CpG site <italic>l</italic> of region <italic>r</italic> of cell <italic>n</italic>. Both <italic>X</italic><sub><italic>nm</italic></sub> and <italic>X</italic><sub><italic>nrl</italic></sub> take values in <inline-formula id="pcbi.1008270.e001"><alternatives><graphic id="pcbi.1008270.e001g" xlink:href="pcbi.1008270.e001"/><mml:math id="M1"><mml:mrow><mml:mi mathvariant="script">S</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtext>unmethylated,</mml:mtext><mml:mspace width="4pt"/><mml:mtext>methylated</mml:mtext><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> or simply <inline-formula id="pcbi.1008270.e002"><alternatives><graphic id="pcbi.1008270.e002g" xlink:href="pcbi.1008270.e002"/><mml:math id="M2"><mml:mrow><mml:mi mathvariant="script">S</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. In (a) and (b), the unshaded <italic>Z</italic><sub><italic>n</italic></sub> node corresponds to the latent variable (with a value in {1, …, <italic>K</italic>}) indicating the true cluster population (epiclone) for cell <italic>n</italic>. The <italic>G</italic><sub><italic>km</italic></sub> and <italic>G</italic><sub><italic>krl</italic></sub> unshaded nodes in (a) and (b) respectively are the latent variables with values in <inline-formula id="pcbi.1008270.e003"><alternatives><graphic id="pcbi.1008270.e003g" xlink:href="pcbi.1008270.e003"/><mml:math id="M3"><mml:mi mathvariant="script">S</mml:mi></mml:math></alternatives></inline-formula> that correspond to the true hidden CpG epigenotypes for each epiclone <italic>k</italic>. The unshaded <italic>μ</italic>, <italic>π</italic>, and <italic>ϵ</italic> nodes in both (a) and (b) correspond to the unknown model parameters, which under the Bayesian paradigm have prior distributions with fixed hyperparameters described by the shaded nodes with the 0 superscript. The distribution assumed for each variable or parameter is written within its node. The edges of the graphs depict dependencies. The plates depict repetitions. In EpiclomalBasic (a), true hidden epigenotypes share the same probability distribution across all CpG sites in the same epiclone (<italic>G</italic><sub><italic>km</italic></sub> ∼ Bernoulli(<italic>μ</italic><sub><italic>k</italic></sub>)). In EpiclomalRegion (b), true hidden epigenotypes follow a Bernoulli distribution with probability parameters that vary across regions (<italic>G</italic><sub><italic>krl</italic></sub> ∼ Bernoulli(<italic>μ</italic><sub><italic>kr</italic></sub>)).</p>
      </caption>
      <graphic xlink:href="pcbi.1008270.g001"/>
    </fig>
    <fig id="pcbi.1008270.g002" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g002</object-id>
      <label>Fig 2</label>
      <caption>
        <title>The three components of our proposed framework.</title>
        <p><italic>Input data and pre-processing</italic>: data from regions of interest are extracted from methylation call files, which can be filtered to keep only data from regions with a desired amount of missing data and methylation level IQR. A synthetic data pipeline is also provided to simulate data under different parameters. <italic>Clustering</italic>: cells are clustered using different non-probabilistic clustering methods, with results that will then be used as initial values for Epiclomal methods. <italic>Output and performance measures</italic>: different metrics are provided to evaluate the output of each method when true cluster assignments are known.</p>
      </caption>
      <graphic xlink:href="pcbi.1008270.g002"/>
    </fig>
  </sec>
  <sec sec-type="results" id="sec002">
    <title>Results</title>
    <sec id="sec003">
      <title>Overview of Epiclomal</title>
      <p>Epiclomal is a clustering method based on a hierarchical mixture of Bernoulli distributions. It is given a sparse matrix of <italic>N</italic> rows (cells) and <italic>M</italic> columns (CpG sites), in which each entry is either 0 (unmethylated), 1 (methylated), or missing. The distribution of the observed data <italic>X</italic><sub><italic>nm</italic></sub> for each CpG site <italic>m</italic> from cell <italic>n</italic> depends on the latent cell-specific cluster assignment <italic>Z</italic><sub><italic>n</italic></sub> and the corresponding true hidden methylation state (epigenotype) at that CpG, <italic>G</italic><sub><italic>km</italic></sub> (<xref ref-type="fig" rid="pcbi.1008270.g001">Fig 1a</xref>). We use a Variational Bayes (VB) algorithm (<xref ref-type="sec" rid="sec012">Methods</xref>, subsection Model and inference) with random and informed initializations to infer not only cell-to-cluster assignments, but also the true hidden cluster-specific epigenotypes <italic>G</italic><sub><italic>k</italic>1</sub>, …, <italic>G</italic><sub><italic>kM</italic></sub> for each cluster <italic>k</italic>, for <italic>k</italic> = 1, …, <italic>K</italic>. We run Epiclomal considering <italic>K</italic> from 1 to a maximum number of possible clusters and choose the best <italic>K</italic> along with the best clustering assignments as the combination that minimizes the deviance information criterion (DIC, [<xref rid="pcbi.1008270.ref025" ref-type="bibr">25</xref>]) using an elbow plot selection procedure (<xref ref-type="sec" rid="sec012">Methods</xref>, subsection Initialization and choice of <italic>K</italic>).</p>
      <p>Epiclomal has two variants: EpiclomalBasic (<xref ref-type="fig" rid="pcbi.1008270.g001">Fig 1a</xref>) and EpiclomalRegion (<xref ref-type="fig" rid="pcbi.1008270.g001">Fig 1b</xref>). While EpiclomalBasic imposes less structure on the model by assuming that the true hidden methylation states share the same distribution across all the CpG sites considered, EpiclomalRegion allows their distribution to vary across genomic functional regions such as CGIs. Although computationally more expensive than EpiclomalBasic, EpiclomalRegion leads to a model that better reflects the expected behaviour of the real data. Bulk data can be used to reassign cells to the EpiclomalRegion clusters using an algorithm that stochastically reassigns cells to clusters while trying to best match the cumulative CpG states of all cells to the corresponding bulk CpG state. This extension is called EpiclomalBulk (<xref ref-type="sec" rid="sec012">Methods</xref>, subsection EpiclomalBulk).</p>
      <p>Epiclomal is then incorporated into the computational framework presented in <xref ref-type="fig" rid="pcbi.1008270.g002">Fig 2</xref> and described in what follows.</p>
    </sec>
    <sec id="sec004">
      <title>Overview of proposed framework</title>
      <sec id="sec005">
        <title>Input data and pre-processing</title>
        <p>Our framework (<xref ref-type="fig" rid="pcbi.1008270.g002">Fig 2</xref>) can take as input either real or synthetic data. For real data, we take files with CpG methylation calls across the genome from individual cells and extract data from defined regions of interest (e.g., CGIs, gene bodies, and differentially methylated regions). CpGs exhibiting partially methylated calls (median percentage &lt; 1.35 over observed sites for all datasets, Table A in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>) are assigned a value of one (methylated state) if the corresponding methylation fraction was ≥ 0.5 and a value of zero (unmethylated state) otherwise. Because some CpG sites do not exhibit variation and therefore are uninformative for clustering, our framework optionally allows selection of specific regions. One can then consider the data from all regions of interest or apply our region selection pipeline to use data from a subset of those regions. Our proposed selection pipeline first keeps the regions with at least 5% coverage in all or 10% of cells and then selects regions with the most variable methylation levels across cells (using the interquartile range, or IQR), optionally controlling for a desired number of CpG loci. If bulk methylation data are available, our framework can take them as input and use them to inform inference.</p>
        <p>For synthetic data, we provide a pipeline that generates single-cell methylation data considering various parameters (e.g., missing proportion, number of cells, and number of loci), assuming that true cluster methylation profiles arise from a phylogenetic process with loci changing methylation states at each new cluster generation (Section 2 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>). This process is motivated by tumour clonal composition theory [<xref rid="pcbi.1008270.ref009" ref-type="bibr">9</xref>, <xref rid="pcbi.1008270.ref010" ref-type="bibr">10</xref>], in which clonal sub-populations arise from a hierarchical ancestor-descendant phylogenetic process. Note that our proposed synthetic data generator does not simulate data according to our model because Epiclomal is unaware of phylogenetic dependencies.</p>
      </sec>
      <sec id="sec006">
        <title>Cluster initialization</title>
        <p>Given methylation calls and genomic coordinates of retained regions, we first cluster cells according to various non-probabilistic methods. The results will then be used as initial values for Epiclomal as well as for comparison. We deployed two types of non-probabilistic clustering methods: region- and CpG-based (see <xref ref-type="sec" rid="sec012">Methods</xref>, subsection Non-probabilistic clustering methods).</p>
        <p>In the region-based approaches, EuclideanClust and DensityCut, we cluster cells considering as input the mean methylation level of each region. EuclideanClust is based on the approaches of [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>] and [<xref rid="pcbi.1008270.ref017" ref-type="bibr">17</xref>] and uses hierarchical clustering with Euclidean distances. DensityCut [<xref rid="pcbi.1008270.ref026" ref-type="bibr">26</xref>] is a density-based clustering method applied after dimensionality reduction; this resembles the dimensionality reduction technique (NMF [<xref rid="pcbi.1008270.ref020" ref-type="bibr">20</xref>] + tSNE [<xref rid="pcbi.1008270.ref021" ref-type="bibr">21</xref>]) followed by a different density-based clustering algorithm (DBSCAN [<xref rid="pcbi.1008270.ref022" ref-type="bibr">22</xref>]) used by Mulqueen <italic>et al</italic>. [<xref rid="pcbi.1008270.ref018" ref-type="bibr">18</xref>].</p>
        <p>In the CpG-based approaches, Hammingclust and PearsonClust, we consider the methylation state of each individual CpG. HammingClust uses hierarchical clustering with Hamming distances, the same as in PDclust [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>]. PearsonClust applies hierarchical clustering using Pearson correlation values, which is equivalent to the approach used in [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>].</p>
        <p>To find the optimal number of clusters, DensityCut includes its own automatic method, whereas for the hierarchical clustering methods we use the Calinski-Harabasz (CH) index [<xref rid="pcbi.1008270.ref027" ref-type="bibr">27</xref>]. Our pipeline runs Epiclomal using the results of the non-probabilistic methods as initial values along with a set of random initial values and chooses the best configuration, as explained in the “Overview of Epiclomal” section.</p>
      </sec>
      <sec id="sec007">
        <title>Output and performance measures</title>
        <p>For all clustering methods, our framework outputs predictions of cell-to-cluster assignments, number of clusters, and cluster (or epiclone) distribution frequencies (i.e., the proportion of cells assigned to each cluster). In addition, for Epiclomal, we obtain the estimated missing CpG values and the cell-to-cluster assignment posterior probabilities.</p>
        <p>When ground-truth clustering is available, we also output a performance evaluation measure for each of the five predictions described above (<xref ref-type="fig" rid="pcbi.1008270.g002">Fig 2</xref> and Section 3 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>). The V-measure [<xref rid="pcbi.1008270.ref028" ref-type="bibr">28</xref>] evaluates the cell-to-cluster assignments and is a score between zero and one, where one stands for perfect clustering and zero for random cell-to-cluster assignments. The V-measure captures the homogeneity and completeness of a clustering result. To satisfy the homogeneity criterion, a clustering procedure must assign only those cells that are members of a single group to a single cluster. Completeness is satisfied if all those cells that are members of a single group are assigned to a single cluster. The harmonic mean of homogeneity (<italic>h</italic>) and completeness (<italic>c</italic>) gives rise to the V-measure (<inline-formula id="pcbi.1008270.e004"><alternatives><graphic xlink:href="pcbi.1008270.e004.jpg" id="pcbi.1008270.e004g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M4"><mml:mrow><mml:mi>V</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>h</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi><mml:mo>+</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>), and even a small percentage of misclassified cells can significantly affect it.</p>
        <p>We also report the predicted number of clusters and the mean absolute error (MAE) between true and predicted cluster frequencies. In addition, when applying Epiclomal on synthetic data, we consider the Hamming distance as the proportion of discordant entries between true and inferred vectors of methylation states. We also compute for Epiclomal the uncertainty true positive rate of cluster assignment probabilities, that is, how well the uncertainty is estimated for cells whose membership is unclear due to missing data.</p>
      </sec>
    </sec>
    <sec id="sec008">
      <title>Epiclomal outperforms other methods on synthetic data</title>
      <p>To evaluate the performance of our proposed methods over a wide range of characteristics, we generated a large number of synthetic datasets and applied our Epiclomal approaches (EpiclomalRegion, EpiclomalBasic, and EpiclomalBulk), as well as the four non-probabilistic methods (EuclideanClust, DensityCut, HammingClust, and PearsonClust) to each generated data set.</p>
      <p>We considered several experiments, where in each one we varied one of eight parameters while keeping the others fixed, as indicated in <xref rid="pcbi.1008270.t001" ref-type="table">Table 1</xref>. For each setting, we generated 30 input datasets and ran Epiclomal with a total of 300 informed and random VB initializations. Then we computed the V-measure along with the other quantities included in our framework to assess method performance.</p>
      <table-wrap id="pcbi.1008270.t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Varying parameters and their ranges for synthetic data simulation.</title>
          <p>For each experiment, we varied one parameter and kept the others fixed. Note that varying the number of regions is equivalent to varying region size because the total number of loci is fixed. Unless otherwise specified, the fixed parameters are: missing proportion 0.8, region size 100, number of cells 100, proportion of cell-to-cell variability 0, number of epiclones 3, equal epiclone frequencies (1/3), number of loci 10,000, and number of regions different between clusters 1. For the cell-to-cell variability experiment (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4c</xref>), we used 25 regions to have a larger number of loci that differed between clusters. For the number of epiclones experiment (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4d</xref>) and the epiclone frequency experiment (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4e</xref>), we used 500 cells to allow for enough cells to be represented in each case. For the number of loci experiment (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4f</xref>), we also varied the number of regions to keep the differences among clusters fixed (e.g., 50 regions for 5,000 loci, 5,000 regions for 500,000 loci).</p>
        </caption>
        <alternatives>
          <graphic id="pcbi.1008270.t001g" xlink:href="pcbi.1008270.t001"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="left" rowspan="1" colspan="1">Varying parameter</th>
                <th align="center" rowspan="1" colspan="1">Varying range</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">Missing proportion</td>
                <td align="center" rowspan="1" colspan="1">0.5 to 0.95</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of regions</td>
                <td align="center" rowspan="1" colspan="1">25 to 200</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of cells</td>
                <td align="center" rowspan="1" colspan="1">12 to 2500</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Cell-to-cell variability</td>
                <td align="center" rowspan="1" colspan="1">0 to 0.3</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of clusters (epiclones)</td>
                <td align="center" rowspan="1" colspan="1">1 to 10</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Epiclone frequencies</td>
                <td align="center" rowspan="1" colspan="1">balanced to very unbalanced</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of loci</td>
                <td align="center" rowspan="1" colspan="1">5 000 to 500 000</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Number of regions different between clusters</td>
                <td align="center" rowspan="1" colspan="1">1 to 6</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p><xref ref-type="fig" rid="pcbi.1008270.g003">Fig 3</xref> shows the results when the proportion of missing data is varied from 0.5 to 0.95. Our proposed probabilistic Epiclomal methods give better or comparable V-measures (panel a) with overall more correct values for the number of clusters (<italic>K</italic> = 3, panel b) than the non-probabilistic methods, which tend to overestimate (EuclideanClust) or underestimate (PearsonClust, HammingClust, and DensityCut) the number of clusters. PearsonClust and HammingClust fail to produce results in the case of 0.95 proportion of missing data. Using bulk data via EpiclomalBulk shows improvement in estimating cluster frequencies, especially when the missing data proportion is large (0.9 and 0.95, panel c). The cluster assignment uncertainty is well estimated by EpiclomalRegion for up to 0.7 missing proportion; however, it drops rapidly for 0.8 and 0.9 missing proportion (panel d).</p>
      <fig id="pcbi.1008270.g003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g003</object-id>
        <label>Fig 3</label>
        <caption>
          <title>Simulation results when varying the missing data proportion.</title>
          <p>We report mean results produced by Epiclomal and the non-probabilistic methods taken over 30 randomly generated synthetic datasets: (a) V-measure; (b) Number of predicted clusters (true is 3); the top panel shows the proportion of data sets for which a method failed to produce a result; (c) Epiclone frequency (prevalence) MAE (mean absolute error); (d) Uncertainty true positive rate; and (e) Hamming distance for three variants of EpiclomalRegion inferred methylation states: unadjusted, adjusted, and naive (see Sections 1.2 and 3.4 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>). The vertical bars correspond to one standard deviation above and below the mean value.</p>
        </caption>
        <graphic xlink:href="pcbi.1008270.g003"/>
      </fig>
      <p><xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4</xref> shows that Epiclomal results in a better V-measure than the non-probabilistic methods in all the remaining experimental scenarios with a fixed missing proportion of 0.8 (see also Figures C to I in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>). All methods perform worse when the problem is more difficult, such as when decreasing the number of different loci among clusters (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4a</xref> and Figure I in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>) or increasing cell-to-cell variability (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4c</xref>). Increasing the number of cells (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4b</xref>) does not improve the V-measure, except for DensityCut, but it does reduce its variability. The Epiclomal methods are more robust to an increasing number of epiclones (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4d</xref>) and a change in epiclone frequencies (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4e</xref>). When increasing the number of loci (<xref ref-type="fig" rid="pcbi.1008270.g004">Fig 4f</xref>), the performance of HammingClust and PearsonClust remains somewhat constant, but the other methods show a decreasing pattern of performance. However, the Epiclomal methods still perform better for all numbers of loci considered than all the other methods. Therefore, this provides support to a strategy for selecting a smaller number of loci (under 50,000) in order to keep the true signal and eliminate noise when analyzing a real data set.</p>
      <fig id="pcbi.1008270.g004" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g004</object-id>
        <label>Fig 4</label>
        <caption>
          <title>Predicted cell-to-cluster assignments on synthetic data.</title>
          <p>We report mean V-measures produced by Epiclomal and the non-probabilistic methods taken over 30 randomly generated synthetic data sets, when we vary by: (a) the number of regions, (b) the number of cells, (c) the cell-to-cell variability, (d) the number of clones, (e) the cluster frequencies (prevalences), and (f) the number of loci. The vertical bars correspond to one standard deviation above and below the mean value. The Epiclomal methods outperformed the other methods in all cases.</p>
        </caption>
        <graphic xlink:href="pcbi.1008270.g004"/>
      </fig>
      <p>Figs <xref ref-type="fig" rid="pcbi.1008270.g003">3e</xref> and <xref ref-type="fig" rid="pcbi.1008270.g005">5</xref> reveal that Epiclomal can generally impute CpG methylation states more correctly than a naive imputation (see Section 1.2 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>) for the same clustering result.</p>
      <fig id="pcbi.1008270.g005" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g005</object-id>
        <label>Fig 5</label>
        <caption>
          <title>Imputation results on synthetic data.</title>
          <p>Average hamming distance for three variants of EpiclomalRegion inferred methylation states: unadjusted, adjusted, and naive (see Sections 1.2 and 3.4 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>) when varying: (a) the number of regions, (b) the number of cells, (c) the cell-to-cell variability, (d) the number of clones, (e) the cluster frequencies (prevalences), and (f) the number of loci. The vertical bars correspond to one standard deviation above and below the mean value.</p>
        </caption>
        <graphic xlink:href="pcbi.1008270.g005"/>
      </fig>
    </sec>
    <sec id="sec009">
      <title>Epiclomal recapitulates methylation subgroups from public datasets</title>
      <p>We further assessed the performance of our methods on three published sc-WGBS datasets [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>, <xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>, <xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>] and compared our results with the clustering results reported in each paper. Experimental validation of epiclones is often difficult, and therefore when working with cells from different known types or treatment conditions, authors expect their clusters to somewhat reflect the epigenetic diversity of those types [<xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>, <xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>]. In [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>], there were no predefined cell sub-populations; however the authors considered gene expression and copy number changes to further support their findings.</p>
      <p><xref rid="pcbi.1008270.t002" ref-type="table">Table 2</xref> shows that these datasets display a variety of characteristics, with missing data proportions varying from 0.54 to 0.98. Table A in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref> presents the results of analysing the three datasets for non-binary methylation states. We observed extremely small percentages of CpGs with partially methylated states for all datasets analyzed, with a median &lt; 1.35% across cells when using all observed CpG sites for all datasets. When using only CpG sites with at least two reads aligned to them, we observed a median &lt; 2.25% for all datasets except for Farlik2016 (the sparsest dataset), which had a slightly larger median of 5.13%.</p>
      <table-wrap id="pcbi.1008270.t002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.t002</object-id>
        <label>Table 2</label>
        <caption>
          <title>Summary of the real data sets used in this work.</title>
          <p>Column descriptions (in order of appearance) are as follows: (1) data set names corresponding to three published data sets and the new in-house data set; (2) type of cells in each data set; (3) number of cells considered for each data set, which varied from tens to hundreds of cells; (4) number of clusters, as reported in the respective published papers, NA (not available) for our in-house data set; (5) genomic functional regions considered for each data set, which were the same as in the original papers when applicable, CGI stands for CpG Islands, TFBS stands for Transcription Factor Binding Sites; (6) missing data proportion for each data set for the 10,000 loci filtered input and varying from 0.69 to 0.89; (7) number of loci for the largest input data sets obtained by including all regions with methylation IQR ≥ 0.01; these varied from one-quarter million to 1 million CpG sites; (8) missing data proportion for the largest input data sets, which varied from 0.54 to 0.98.</p>
        </caption>
        <alternatives>
          <graphic id="pcbi.1008270.t002g" xlink:href="pcbi.1008270.t002"/>
          <table frame="box" rules="all" border="0">
            <colgroup span="1">
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
              <col align="left" valign="middle" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <th align="right" rowspan="1" colspan="1">Data set</th>
                <th align="left" rowspan="1" colspan="1">Cell type</th>
                <th align="center" rowspan="1" colspan="1"># cells</th>
                <th align="center" rowspan="1" colspan="1"># clusters</th>
                <th align="center" rowspan="1" colspan="1">Regions</th>
                <th align="center" rowspan="1" colspan="1">Miss 10K</th>
                <th align="right" rowspan="1" colspan="1">Nloci IQR ≥ .01</th>
                <th align="center" rowspan="1" colspan="1">Miss IQR ≥ .01</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="right" rowspan="1" colspan="1">Smallwood2014 [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>]</td>
                <td align="left" rowspan="1" colspan="1">mouse embryonic stem cells</td>
                <td align="center" rowspan="1" colspan="1">32</td>
                <td align="center" rowspan="1" colspan="1">2</td>
                <td align="center" rowspan="1" colspan="1">CGI</td>
                <td align="char" char="." rowspan="1" colspan="1">0.69</td>
                <td align="right" rowspan="1" colspan="1">786 620</td>
                <td align="char" char="." rowspan="1" colspan="1">0.54</td>
              </tr>
              <tr>
                <td align="right" rowspan="1" colspan="1">Hou2016 [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>]</td>
                <td align="left" rowspan="1" colspan="1">human hepatocellular carcinomas</td>
                <td align="center" rowspan="1" colspan="1">25</td>
                <td align="center" rowspan="1" colspan="1">2</td>
                <td align="center" rowspan="1" colspan="1">CGI</td>
                <td align="char" char="." rowspan="1" colspan="1">0.87</td>
                <td align="right" rowspan="1" colspan="1">255 136</td>
                <td align="char" char="." rowspan="1" colspan="1">0.90</td>
              </tr>
              <tr>
                <td align="right" rowspan="1" colspan="1">Farlik2016 [<xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>]</td>
                <td align="left" rowspan="1" colspan="1">human hematopoietic cells</td>
                <td align="center" rowspan="1" colspan="1">122</td>
                <td align="center" rowspan="1" colspan="1">6</td>
                <td align="center" rowspan="1" colspan="1">TFBS</td>
                <td align="char" char="." rowspan="1" colspan="1">0.89</td>
                <td align="right" rowspan="1" colspan="1">512 153</td>
                <td align="char" char="." rowspan="1" colspan="1">0.98</td>
              </tr>
              <tr>
                <td align="right" rowspan="1" colspan="1">InHouse</td>
                <td align="left" rowspan="1" colspan="1">human xenografted cancer cells (3 patients)</td>
                <td align="center" rowspan="1" colspan="1">558</td>
                <td align="center" rowspan="1" colspan="1">NA</td>
                <td align="center" rowspan="1" colspan="1">CGI</td>
                <td align="char" char="." rowspan="1" colspan="1">0.82</td>
                <td align="right" rowspan="1" colspan="1">1 019 956</td>
                <td align="char" char="." rowspan="1" colspan="1">0.79</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
      </table-wrap>
      <p><xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6a</xref> shows a dimensionality reduction visualization using NMF [<xref rid="pcbi.1008270.ref020" ref-type="bibr">20</xref>] followed by tSNE [<xref rid="pcbi.1008270.ref021" ref-type="bibr">21</xref>]. Note, however, that this does not clearly separate the clusters, particularly for more challenging data sets, such as Farlik2016. UMAP [<xref rid="pcbi.1008270.ref029" ref-type="bibr">29</xref>] or simple tSNE did not show better separation; instead, heatmaps of average methylation rates in each cell and genomic region clearly show the specific features of each epiclone (Figures K, L and M in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>). <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6b</xref> shows co-clustering plots that summarise the EpiclomalRegion’s cell-to-cluster assignments.</p>
      <fig id="pcbi.1008270.g006" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g006</object-id>
        <label>Fig 6</label>
        <caption>
          <title>Results on the real data sets.</title>
          <p>(a) Dimensionality reduction visualization plots showing the clustering reported in the published papers on the ≈ 10,000 loci processed data sets. (b) Co-clustering between the real data published clusters on the rows and EpiclomalRegion predictions on the columns. Each entry <italic>a</italic><sub><italic>ij</italic></sub> is the percentage of cells in published class <italic>i</italic> that are present in predicted cluster <italic>j</italic>, with the rows summing up to 100%. A perfect agreement would result in a square matrix with a black diagonal. (c) V-measures comparing the cell assignments with the published assignments, with higher values meaning better agreement. (d) Cluster frequencies mean absolute error, comparing the inferred proportions of clusters with the published proportions, with lower values meaning better agreement. (e) Number of predicted clusters. The horizontal dashed lines correspond to the published number of clusters; bars closer to this line represent better agreement.</p>
        </caption>
        <graphic xlink:href="pcbi.1008270.g006"/>
      </fig>
      <p><xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6c to 6e</xref> present the results for cell-to-cluster assignments, cluster frequencies and number of clusters, respectively, of applying our framework to these published datasets considering three filtered inputs with 10,000, 15,000 and 20,000 CpG loci (see <xref ref-type="sec" rid="sec012">Methods</xref> for details on pre-processing real data). In addition, we evaluated the usefulness of selecting regions by IQR of mean methylation levels by running all non-probabilistic methods on a large input that filtered out only regions with methylation IQR &lt; 0.01 and also plotted the results in <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6c to 6e</xref>.</p>
      <p>The Smallwood2014 dataset [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>] is made up of 32 mouse embryonic stem cells, where 20 cells were cultured in a regular serum medium and 12 cells in a 2i medium inducing hypomethylation. <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6</xref> shows good agreement between the clusters inferred by EpiclomalRegion and the ones obtained by [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>], with only one discordant cell (V-measure 0.82 for 10,000 loci, <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6c</xref> and Figure K in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>). PearsonClust correctly clustered all cells for the three filtered input datasets (V-measure = 1, <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6c</xref>), but the other non-probabilistic methods misclassified one or two cells.</p>
      <p>The Hou2016 dataset [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>] contains 25 cells from a human hepatocellular carcinoma tissue sample. We compared our results with the two subpopulations identified by [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>] based not only on DNA methylation, but also on copy number and gene expression data. For all input datasets, EpiclomalRegion correctly assigned all cells to their corresponding subpopulations (V-measure = 1, <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6</xref>).</p>
      <p>The Farlik2016 data set [<xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>] contains different types of human hematopoietic cells, totalling 122 cells. We compared our results with the six clusters found by Farlik et al. [<xref rid="pcbi.1008270.ref012" ref-type="bibr">12</xref>], made up of hematopoietic stem cells (HSC) and progenitor cell types (myeloid, multipotent, and lymphoid progenitor cells). For the input with 10,000 loci, EpiclomalRegion resulted in a V-measure of 0.34, with seven predicted clusters (<xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6c to 6e</xref>). As stated before, the V-measure can be significantly affected by a small percentage of misclassified cells. Therefore, even though the V-measure is low, <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6b</xref> shows good agreement between Epiclomal clustering and the clustering reported by Farlik <italic>et al</italic>.</p>
      <p><xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6c to 6e</xref> show that EpiclomalRegion generally outperformed the non-probabilistic methods on V-measure, cluster frequency mean absolute error, and number of correctly predicted clusters. In addition, because Epiclomal is based on a Bayesian inference approach, posterior means and standard deviations of model parameters can be obtained as illustrated in Figure J in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>, which presents EpiclomalRegion inferred posterior mean methylation probabilities along with standard deviations across regions and clusters (i.e., the posterior means and standard deviations of <italic>μ</italic><sub><italic>kr</italic></sub> for all <italic>k</italic> and <italic>r</italic>; see <xref ref-type="fig" rid="pcbi.1008270.g001">Fig 1b</xref> and Eq. (14) in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>) for the filtered input of about 10,000 loci.</p>
    </sec>
    <sec id="sec010">
      <title>Epiclomal reveals copy number-dependent and copy number-independent epiclones in breast cancer</title>
      <p>Having verified the performance of Epiclomal on synthetic data and public domain datasets, we set out to perform epiclone group discovery on single-cell epigenomes generated in-house on a range of patient-derived breast tumour xenografts. First, to illustrate the scalability of Epiclomal with aneuploid single-cell cancer epigenomes, we analysed 558 tumour xenograft single epigenomes (called InHouse data) from two patients (SA501 and SA609) with triple-negative breast cancer and one patient (SA532) with ER+PR-Her2+ breast cancer (Table B in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>) sequenced using the PBAL method [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>]. <xref ref-type="fig" rid="pcbi.1008270.g007">Fig 7a and 7b</xref> show the heatmap and t-SNE visualization respectively for the InHouse data along with the clustering results of EpiclomalRegion, which resulted in three clusters, one for each patient. <xref ref-type="fig" rid="pcbi.1008270.g007">Fig 7a</xref> shows the methylation differences between the three patients, with SA609 having a highly different methylation profile than the other two. Note that two different experimental plates of markedly different missing proportions for SA532 (<xref ref-type="fig" rid="pcbi.1008270.g007">Fig 7a</xref>) resulted in visually distinct subclusters in <xref ref-type="fig" rid="pcbi.1008270.g007">Fig 7b</xref>, potentially affecting density-based approaches. Indeed, DensityCut clustered these plates into two different clusters, yet Epiclomal was robust to this batch effect.</p>
      <fig id="pcbi.1008270.g007" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g007</object-id>
        <label>Fig 7</label>
        <caption>
          <title>Visualization of the InHouse clusters.</title>
          <p>(a) EpiclomalRegion clustering, with data filtered to include the most variable CGIs and obtain ≈ 15,000 loci (327 CGIs, cell average missing proportion 0.82, 558 cells). EpiclomalRegion obtained 3 clusters. Rows are cells, and columns are CGIs. (b) tSNE dimensionality reduction and color-coding of the Epiclomal clusters onto the tSNE 2-dimensional space.</p>
        </caption>
        <graphic xlink:href="pcbi.1008270.g007"/>
      </fig>
      <p>We next focused our analysis on one of the three patient-derived xenografts mentioned above, which was previously characterized with whole-genome sequencing (WGS) [<xref rid="pcbi.1008270.ref010" ref-type="bibr">10</xref>] and single-cell WGS [<xref rid="pcbi.1008270.ref004" ref-type="bibr">4</xref>] (patient SA501 in Table B in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>). Breast cancers often exhibit whole chromosome gains and losses (in addition to sub-chromosomal aneuploidy), especially of the X chromosome, which provides a strong methylation signal. As previously described, this patient-derived xenograft (PDX) underwent copy number clonal dynamics between passages, with clones losing one copy of X eventually dominating the populations of later passages. Patient tumour cells at diagnosis were mouse xenografted and serially transplanted over generations. Then sc-WGBS data from passages 2, 7, and 10 were generated using the PBAL protocol [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>]. After filtering out cells that did not pass quality control upon alignment (see <xref ref-type="sec" rid="sec012">Methods</xref>), we obtained a final sc-WGBS dataset of 244 single cells over three passages. We considered as initial regions the set of differentially methylated CGIs found when comparing bulk BS-seq data from passages 1 and 10 (see <xref ref-type="sec" rid="sec012">Methods</xref>). We then applied non-negative matrix factorization (NMF [<xref rid="pcbi.1008270.ref018" ref-type="bibr">18</xref>, <xref rid="pcbi.1008270.ref020" ref-type="bibr">20</xref>, <xref rid="pcbi.1008270.ref030" ref-type="bibr">30</xref>]) to the region mean methylation data of all 244 cells as a feature selection strategy obtaining a final input set of 94 regions (see <xref ref-type="supplementary-material" rid="pcbi.1008270.s003">S1 Table</xref> for their coordinates). Over all 94 regions, chromosome X contained the most differentially methylated regions of any single chromosome (29 out of 94; Figures N and O in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>).</p>
      <p>Using these 94 regions, EpiclomalRegion clustered the cells (<xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8a</xref>) into four epiclones: two primarily containing passage 2 cells, and two containing a mix of passage 7 and 10 cells (EpiclomalBasic produced the same results). The distribution of posterior cluster assignment probabilities (<italic>p</italic>) indicates that most cells were classified with <italic>p</italic>&gt;0.9, except for two cells that were assigned to Cluster 3 with probabilities of 0.73 and 0.69.</p>
      <fig id="pcbi.1008270.g008" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1008270.g008</object-id>
        <label>Fig 8</label>
        <caption>
          <title>Results for patient SA501.</title>
          <p>(a) Mean methylation level for each of the 94 NMF-selected regions (CGIs) for patient SA501 across all cells ordered according to the four methylation clusters found using EpiclomalRegion. Rows are cells, and columns are CGIs. (b) Inferred genome-wide copy numbers for the same cells as in (a) clustered using a ward.D2 hierarchical clustering method and Euclidean copy number distances. Note that copy number 5 means five or more copies. To call copy number changes, we used the methylation sc-WGBS data. Only one epiclone and one copy number clone matched, the remaining clones transcended each other. (c) Pearson correlation between mean methylation data and copy number data in each of the 94 regions. There was correlation in chromosome X, but not in the autosomal chromosomes. (d) Heatmap showing the percentage of cells in the copy number clusters (rows) that are in the methylation clusters (columns); rows sum up to 100.</p>
        </caption>
        <graphic xlink:href="pcbi.1008270.g008"/>
      </fig>
      <p>Inspection shows that Cluster 1 contains 10/40 passage 2 cells (and 1 passage 7 cell) with unmethylated features, except for chromosome X regions, which are mainly methylated. This is consistent with a small population of passage 2 cells presenting two copies of the X chromosome (<xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8b</xref>) and normal X-inactivation mechanism for which the X-inactive copy exhibits most CGIs hypermethylated [<xref rid="pcbi.1008270.ref031" ref-type="bibr">31</xref>]. Cluster 2 contains the remaining 30/40 passage 2 cells (and one passage 10 cell), but with unmethylated chromosome X regions, which is compatible with the loss of one copy of X (see also <xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8b</xref>) indicating that either the active X was the inherited copy or that the inactive X was demethylated. At later passages, several autosomal regions became methylated (see, for example, chromosomes 1, 9, 12, 19, and 20 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s004">S2 Table</xref>). In addition, we identified three main regions that are methylated only in some of the later passage cells (see also <xref ref-type="supplementary-material" rid="pcbi.1008270.s004">S2 Table</xref>), resulting in two different epiclones, each containing a mix of passage 7 and 10 cells (cluster 3 containing 53/98 passage 7 cells and 34/106 passage 10 cells; and cluster 4 containing 44/98 passage 7 cells and 71/106 passage 10 cells).</p>
      <p>These observations suggest that some chromosomal regions, such as X, may show strong copy number influence on CpG states, whereas others may differ in CpG state, but be unrelated to copy number state in aneuploid genomes. Therefore, we next investigated possible correlations between methylation and copy number alterations derived from the same sc-WGBS data (see <xref ref-type="sec" rid="sec012">Methods</xref>). A systematic comparison shows that indeed the average methylation levels and copy number states across cells for each of the 94 regions (<xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8b</xref>) were only highly correlated (Pearson correlation &gt;0.5; <xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8c</xref>) for the X chromosome. This implies that epiclones may transcend copy number-defined clones in the studied SA501 PDX.</p>
      <p>Indeed, when we compared the four epiclones with the four sc-PBAL copy number (CN) clones, we noticed that they can match or transcend each other as follows (<xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8b and 8d</xref>): epiclone 1 with methylated regions in the X chromosome matches exactly CN clone I having two copies of the X chromosome, which shows a strong relationship between the presence of the second copy of the X chromosome and the methylation pattern. However, 26/31 passage-2 cells with all 94 regions unmethylated from epiclone 2 are found in CN clone II, which also contains 47/87 cells from epiclone 3 and 6/115 cells from epiclone 4, even though these have several regions that are methylated. Finally, epiclone 3 transcends CN clones II (47/87 cells from epiclone 3 are in CN clone II) and IV (27/87 cells from epiclone 3 are in CN clone IV), and epiclone 4 transcends CN clones III (72/115 cells from epiclone 4 are in clone III) and IV (29/115 cells from epiclone 4 are in CN clone IV). Taken together, these data show for the first time with single-cell methylation analysis that epigenetically defined clones may present a different lineage from that of copy number-defined clonal architectures, opening up this form of analysis for cancer genomes.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec011">
    <title>Discussion</title>
    <p>Single-cell CpG genome analysis is currently held back by a dearth of principled methods for handling the features of single-cell methylation data. To this end, we have developed Epiclomal, a probabilistic CpG-based clustering method for clustering sparse sc-WGBS data and elucidating the epigenetic diversity of different types of cell populations. Epiclomal uses a principled Variational Bayes inference method that is robust to the initial starting point, with the optimal clustering being obtained multiple times across independent runs well before our 1000 iteration cut-off (Figure P in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>). Our method has produced overall better results than non-probabilistic based methods when tested on synthetic data from eight extensive simulation scenarios (Figs <xref ref-type="fig" rid="pcbi.1008270.g003">3</xref> and <xref ref-type="fig" rid="pcbi.1008270.g004">4</xref>, and Figures B to I in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>) and three comprehensive real data sets (<xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6</xref>). Epiclomal is robust and consistent to subsampling by CpG coverage and number of cells and can generally impute missing CpG methylation values more correctly than a naive imputation for the same clustering result (Figs <xref ref-type="fig" rid="pcbi.1008270.g003">3e</xref> and <xref ref-type="fig" rid="pcbi.1008270.g005">5</xref> and Figure Q in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>). Importantly, Epiclomal is reliable when the amount of data missing is large and/or varies across cells and can find the true clusters and epiclone frequencies when the signal is subtle, which are both limiting features of current sc-WGBS data.</p>
    <p>It is well understood that 5mC distribution in the genome is regionally clustered and that this has implications for computational methods. EpiclomalRegion considers CpG-based methylation dependencies in functional regions and models errors while simultaneously assigning cells to clusters and imputing missing data. It can also use bulk DNA methylation data to improve epiclone frequencies, which are important quantities, particularly for the study of cancer tumour composition. Epiclomal works at the CpG level and hence considers the contribution of every sequenced CpG site in the selected regions, without loss of information by region averaging. Epiclomal not only runs an uninformed clustering method, but also uses the clustering results of four other methods (with more easily added) and a robust model selection strategy to return the best prediction.</p>
    <p>Epiclomal is part of an extensive statistical and computational framework that provides interpretable results and five performance measures. It also enables the easy inclusion of novel components in the computational pipeline. Our framework includes a pre-processing step where specific regions can be selected to increase signal and eliminate noise in the input data. Epiclomal obtained better or equal results on the smaller filtered input datasets than on the larger ones, supporting the notion that filtering out the most invariant regions may improve the signal for clustering. In addition, our synthetic experiments as well as the SA501 intra-patient analysis on a well-designed set of differentially methylated regions showed that pre-processing the initial whole-genome data set in a way that keeps the clone differences and eliminates noise is likely to produce better results overall. Our selection strategy has the limitation of possibly removing regions that vary only in a small percentage of cells, which may result in clusters being condensed together. Future work includes a region selection strategy that can increase the signal-to-noise ratio. One approach, for example, would be to consider the variation across sites within regions, so that regions with the same variation pattern across cells could be represented only once in the model by appropriate weights in the data log-likelihood function.</p>
    <p>Although epigenomic states are of importance in cancer biology, to date very few single-cell whole-genome bisulfite datasets have been generated on aneuploid cancer genomes. In this study, Epiclomal was used with a large (598 genomes, Table B in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>) new sc-WGBS data set generated by the PBAL method to demonstrate how epiclones and copy number-determined clones differ. Epiclomal was able to identify known and novel CpG methylation substructures that could not be identified by non-probabilistic distance-based methods due to the missing data inherent in sc-WGBS. Specifically, the separation between the two passage 7/10 subclusters was not found by any of the non-probabilistic methods we considered, even when a larger set of regions was used. This demonstrates that sophisticated modeling of missing data and appropriate region selection are necessary to clearly separate possibly weak biological signals.</p>
    <p>The ability to identify CpG-defined sub-clones, or epiclones, made it possible for the first time to compare a copy number-determined lineage with an epigenetically defined lineage. It is expected that for certain regions of the genome, for example where allelic hemi-methylation occurs, changes in chromosomal copy number would strongly pattern 5mC CpG status. Indeed, we observed this with subclones of a breast cancer PDX (SA501), where biallelic X chromosome clones that were present in early passages contained epiclones with and without CpG methylation. In contrast, we observed in the PDX studied that clones defined by autosomal copy number aberrations can exhibit quite distinct epiclone structures, leading to the notion that in some cases, epiclone-defined lineage will transcend that of copy number-defined lineage. This is an expected result since DNA methylation mediates transcriptional cellular memory and therefore cell states that are not “clonal” in the sense of arising from cell division associated mutational processes. This has important implications for the study of cancer evolution and clonal states because a failure to include epigenetic states will under-represent the cellular population structures of interest. Further work is required to define the scope and nature of epiclone-defined versus copy number clone-defined cellular lineages in cancer.</p>
  </sec>
  <sec sec-type="materials|methods" id="sec012">
    <title>Methods</title>
    <sec id="sec013">
      <title>Proposed probabilistic approach—Epiclomal</title>
      <sec id="sec014">
        <title>Model and inference</title>
        <p>Our proposed methodology extends the approach of [<xref rid="pcbi.1008270.ref032" ref-type="bibr">32</xref>] to single-cell DNA methylation data. In what follows, we describe our model and the Bayesian inference technique for the case we call EpiclomalRegion, which is based on the assumption that the probability of a given locus being methylated depends on the genomic region where that locus is situated and that loci in the same genomic region share the same methylation probability. The EpiclomalBasic approach is a special case of EpiclomalRegion that is obtained by assuming that all loci belong to one single region sharing the same probability of being methylated and therefore can be obtained by setting <italic>R</italic> = 1 in all derivations below. See the graphical models in <xref ref-type="fig" rid="pcbi.1008270.g001">Fig 1</xref>.</p>
        <p>Let us consider a set of <italic>R</italic> regions in the genome (e.g., CGIs, gene bodies). Let <italic>X</italic><sub><italic>nrl</italic></sub> be the observed methylation status (or epigenotype) for cell <italic>n</italic> at locus <italic>l</italic> of region <italic>r</italic>, for <italic>n</italic> = 1, …, <italic>N</italic>, <italic>r</italic> = 1, …, <italic>R</italic>, and <italic>l</italic> = 1, …, <italic>L</italic><sub><italic>r</italic></sub>. Our approach allows the set of loci with observed data to vary across cells, but for simplicity, we write our model and inference derivations assuming that there are data for all loci in all cells, i.e., assuming complete data. Each <italic>X</italic><sub><italic>nrl</italic></sub> takes a value in <inline-formula id="pcbi.1008270.e005"><alternatives><graphic xlink:href="pcbi.1008270.e005.jpg" id="pcbi.1008270.e005g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M5"><mml:mrow><mml:mi mathvariant="script">S</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtext>unmethylated</mml:mtext><mml:mo>,</mml:mo><mml:mspace width="4pt"/><mml:mtext>methylated</mml:mtext><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> or simply <inline-formula id="pcbi.1008270.e006"><alternatives><graphic xlink:href="pcbi.1008270.e006.jpg" id="pcbi.1008270.e006g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M6"><mml:mrow><mml:mi mathvariant="script">S</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</p>
        <p>Let <inline-formula id="pcbi.1008270.e007"><alternatives><graphic xlink:href="pcbi.1008270.e007.jpg" id="pcbi.1008270.e007g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M7"><mml:mrow><mml:msub><mml:mi mathvariant="bold">X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi><mml:msub><mml:mi>L</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> be the vector of observed data for region <italic>r</italic> in cell <italic>n</italic>, and let <inline-formula id="pcbi.1008270.e008"><alternatives><graphic xlink:href="pcbi.1008270.e008.jpg" id="pcbi.1008270.e008g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M8"><mml:mrow><mml:msub><mml:mi mathvariant="bold">X</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi mathvariant="bold">X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> be the vector of all observed data for cell <italic>n</italic>. Assume that <inline-formula id="pcbi.1008270.e009"><alternatives><graphic xlink:href="pcbi.1008270.e009.jpg" id="pcbi.1008270.e009g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M9"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi><mml:msub><mml:mi>L</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are independent for all <italic>n</italic> and <italic>r</italic>. Suppose that there are <italic>K</italic> ≪ <italic>N</italic> vectors of true hidden methylation states shared across the cells. Let <italic>Z</italic><sub><italic>n</italic></sub> with values in {1, …, <italic>K</italic>} be the hidden variable indicating the true cluster (epiclonal) population of cell <italic>n</italic>. It is assumed that <italic>Z</italic><sub>1</sub>, …, <italic>Z</italic><sub><italic>N</italic></sub> are independent with <italic>P</italic>(<italic>Z</italic><sub><italic>n</italic></sub> = <italic>k</italic>) = <italic>π</italic><sub><italic>k</italic></sub> such that <inline-formula id="pcbi.1008270.e010"><alternatives><graphic xlink:href="pcbi.1008270.e010.jpg" id="pcbi.1008270.e010g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M10"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:msub><mml:mi>π</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. If <italic>Z</italic><sub><italic>n</italic></sub> = <italic>k</italic>, then the distribution of <bold>X</bold><sub><italic>n</italic></sub> depends on the <italic>k</italic>-th vector of true hidden epigenotypes <inline-formula id="pcbi.1008270.e011"><alternatives><graphic xlink:href="pcbi.1008270.e011.jpg" id="pcbi.1008270.e011g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M11"><mml:mrow><mml:msub><mml:mi mathvariant="bold">G</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi mathvariant="bold">G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi mathvariant="bold">G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, where <inline-formula id="pcbi.1008270.e012"><alternatives><graphic xlink:href="pcbi.1008270.e012.jpg" id="pcbi.1008270.e012g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M12"><mml:mrow><mml:msub><mml:mi mathvariant="bold">G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:msub><mml:mi>L</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>. We assume that <inline-formula id="pcbi.1008270.e013"><alternatives><graphic xlink:href="pcbi.1008270.e013.jpg" id="pcbi.1008270.e013g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M13"><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:msub><mml:mi>L</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are independent for all <italic>k</italic> and <italic>r</italic>, with <italic>P</italic>(<italic>G</italic><sub><italic>krl</italic></sub> = <italic>s</italic>) = <italic>μ</italic><sub><italic>krs</italic></sub> such that <inline-formula id="pcbi.1008270.e014"><alternatives><graphic xlink:href="pcbi.1008270.e014.jpg" id="pcbi.1008270.e014g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M14"><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, that is, <italic>G</italic><sub><italic>krl</italic></sub> follows a categorical (Bernoulli) distribution with parameter set <inline-formula id="pcbi.1008270.e015"><alternatives><graphic xlink:href="pcbi.1008270.e015.jpg" id="pcbi.1008270.e015g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M15"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. Therefore, given the true cluster assignment and the corresponding true hidden methylation states, the observed data <bold>X</bold><sub><italic>nr</italic></sub> are independent, with <italic>X</italic><sub><italic>nrl</italic></sub> following a categorical distribution with parameters depending on the hidden true state at locus <italic>l</italic> of region <italic>r</italic> for cluster population <italic>k</italic>, that is,
<disp-formula id="pcbi.1008270.e016"><alternatives><graphic xlink:href="pcbi.1008270.e016.jpg" id="pcbi.1008270.e016g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>r</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>t</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>s</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.277778em"/><mml:mtext>with</mml:mtext><mml:mspace width="0.277778em"/><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>ϵ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1)</label></disp-formula></p>
        <p>We can also interpret the probability in (<xref ref-type="disp-formula" rid="pcbi.1008270.e016">1</xref>) as a misclassification error, which in this context is related to sequencing error.</p>
        <p>Let Θ be the set containing all the model parameters, i.e., Θ = {<italic><bold>μ</bold></italic>, <italic><bold>ϵ</bold></italic>, <italic><bold>π</bold></italic>}, where
<list list-type="bullet"><list-item><p><inline-formula id="pcbi.1008270.e017"><alternatives><graphic xlink:href="pcbi.1008270.e017.jpg" id="pcbi.1008270.e017g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M17"><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mi>K</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> with <inline-formula id="pcbi.1008270.e018"><alternatives><graphic xlink:href="pcbi.1008270.e018.jpg" id="pcbi.1008270.e018g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M18"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>R</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1008270.e019"><alternatives><graphic xlink:href="pcbi.1008270.e019.jpg" id="pcbi.1008270.e019g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M19"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>;</p></list-item><list-item><p><inline-formula id="pcbi.1008270.e020"><alternatives><graphic xlink:href="pcbi.1008270.e020.jpg" id="pcbi.1008270.e020g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M20"><mml:mrow><mml:mi mathvariant="bold-italic">ϵ</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>:</mml:mo><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> with <inline-formula id="pcbi.1008270.e021"><alternatives><graphic xlink:href="pcbi.1008270.e021.jpg" id="pcbi.1008270.e021g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M21"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and</p></list-item><list-item><p><italic><bold>π</bold></italic> = (<italic>π</italic><sub>1</sub>, …, <italic>π<sub>K</sub></italic>)<sup><italic>T</italic></sup>.</p></list-item></list></p>
        <p>To infer Θ and the hidden states <bold>Z</bold> = (<italic>Z</italic><sub>1</sub>, …, <italic>Z</italic><sub><italic>n</italic></sub>)<sup><italic>T</italic></sup> and <bold>G</bold> = {<bold>G</bold><sub>1</sub>, …, <bold>G</bold><sub><italic>K</italic></sub>}, we adopt a Bayesian approach and derive a Variational Bayes (VB) algorithm [<xref rid="pcbi.1008270.ref033" ref-type="bibr">33</xref>] to approximate the posterior distribution of Θ, <bold>Z</bold>, and <bold>G</bold> given the observed data <bold>X</bold> = {<bold>X</bold><sub>1</sub>, …, <bold>X</bold><sub><italic>N</italic></sub>}, <italic>P</italic>(<bold>Z</bold>, <bold>G</bold>, Θ|<bold>X</bold>) by finding the Variational Distribution (VD), <italic>q</italic>(<bold>Z</bold>, <bold>G</bold>, Θ) with the smallest Kullback-Leibler divergence to the posterior <italic>P</italic>(<bold>Z</bold>, <bold>G</bold>, Θ|<bold>X</bold>), which is equivalent to maximizing the evidence lower bound (ELBO) given by
<disp-formula id="pcbi.1008270.e022"><alternatives><graphic xlink:href="pcbi.1008270.e022.jpg" id="pcbi.1008270.e022g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M22"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtext>ELBO</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">E</mml:mi><mml:mo>[</mml:mo><mml:mo form="prefix">log</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">X</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">G</mml:mi><mml:mo>,</mml:mo><mml:mo>Θ</mml:mo><mml:mo>)</mml:mo><mml:mo>]</mml:mo><mml:mo>-</mml:mo><mml:mi mathvariant="normal">E</mml:mi><mml:mo>[</mml:mo><mml:mo form="prefix">log</mml:mo><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold">Z</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold">G</mml:mi><mml:mo>,</mml:mo><mml:mo>Θ</mml:mo><mml:mo>)</mml:mo><mml:mo>]</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2)</label></disp-formula>
See [<xref rid="pcbi.1008270.ref034" ref-type="bibr">34</xref>] for more details. We assume the following prior distributions for the parameters in Θ.
<list list-type="bullet"><list-item><p><inline-formula id="pcbi.1008270.e023"><alternatives><graphic xlink:href="pcbi.1008270.e023.jpg" id="pcbi.1008270.e023g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:munderover><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">μ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></alternatives></inline-formula>, where <bold><italic>μ</italic></bold><italic><sub>kr</sub></italic> ∼ Dirichlet(<italic>β</italic><sup>0</sup>)</p></list-item><list-item><p><inline-formula id="pcbi.1008270.e024"><alternatives><graphic xlink:href="pcbi.1008270.e024.jpg" id="pcbi.1008270.e024g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">S</mml:mi></mml:mrow></mml:munder><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></alternatives></inline-formula>, where <inline-formula id="pcbi.1008270.e025"><alternatives><graphic xlink:href="pcbi.1008270.e025.jpg" id="pcbi.1008270.e025g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M25"><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mtext>Dirichlet</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>γ</mml:mi><mml:mi>s</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula></p></list-item><list-item><p><italic><bold>π</bold></italic> ∼ Dirichlet(<italic>α</italic><sup>0</sup>)</p></list-item></list></p>
        <p>Please refer to Section 1.1 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref> for all steps of the proposed VB algorithm for inferring <bold>Z</bold>, <bold>G</bold>, and Θ.</p>
      </sec>
      <sec id="sec015">
        <title>Initialization and choice of <italic>K</italic></title>
        <p>Because maximizing the ELBO, as given in (<xref ref-type="disp-formula" rid="pcbi.1008270.e022">2</xref>), is generally a non-convex optimization problem [<xref rid="pcbi.1008270.ref034" ref-type="bibr">34</xref>], it can lead to a local optimum. To avoid this problem, it is crucial to initialize the proposed VB algorithm properly. Therefore, we developed the following initialization framework to tackle this challenge. We ran the Variational Bayes algorithm a maximum number of times <italic>T</italic> (we used <italic>T</italic> = 1000 for the real data sets and <italic>T</italic> = 300 for the synthetic data sets). We started from different initial posterior cluster assignment probabilities, <inline-formula id="pcbi.1008270.e026"><alternatives><graphic xlink:href="pcbi.1008270.e026.jpg" id="pcbi.1008270.e026g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M26"><mml:msubsup><mml:mi>π</mml:mi><mml:mi>n</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula>, for each cell <italic>n</italic> (for the other two posterior parameters that needed to be initialized, we used their corresponding prior hyperparameters, that is, <inline-formula id="pcbi.1008270.e027"><alternatives><graphic xlink:href="pcbi.1008270.e027.jpg" id="pcbi.1008270.e027g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M27"><mml:mrow><mml:msubsup><mml:mi>γ</mml:mi><mml:mi>s</mml:mi><mml:mrow><mml:mo>*</mml:mo><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>γ</mml:mi><mml:mi>s</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1008270.e028"><alternatives><graphic xlink:href="pcbi.1008270.e028.jpg" id="pcbi.1008270.e028g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M28"><mml:mrow><mml:msubsup><mml:mi>β</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>; see Section 1.1 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>). In other words, each vector <inline-formula id="pcbi.1008270.e029"><alternatives><graphic xlink:href="pcbi.1008270.e029.jpg" id="pcbi.1008270.e029g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M29"><mml:msubsup><mml:mi>π</mml:mi><mml:mi>n</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> of length <italic>K</italic> will have <italic>K</italic> − 1 values of 0 and one value of 1, corresponding to the initial cluster assignment for that cell. Most initializations are uniformly random, but informed starting values often lead to better results. Therefore, for all analyses, we used the following initialization strategy. First, we ran EuclideanClust and if the hierarchical clustering was successful, we cut the hierarchical tree at 1, 2…<italic>K</italic> clusters, obtaining the first <italic>K</italic> initial points. Then we did the same for HammingClust and PearsonClust, obtaining 2 × <italic>K</italic> more initial points. Finally, we added the prediction made by DensityCut. Note that initializations from more clustering methods can be easily added to our framework.</p>
        <p>In our analyses, we used <italic>K</italic> = 10 for all synthetic and real data sets. Therefore, a maximum of <italic>I</italic> = 31 initializations came from the non-probabilistic methods. The remaining <italic>T</italic> − <italic>I</italic> VB runs were initialized randomly, with each initial number of clusters being a number chosen uniformly at random between 1 and <italic>K</italic>. For each run, the VB algorithm returned a number of recommended clusters <italic>c</italic> ≤ <italic>K</italic> and the corresponding cell-to-cluster assignments. With this strategy, we obtained a more uniform number of clusters across all runs than if we had used the same <italic>K</italic> for each run. Therefore, our strategy resembles a BIC or AIC selection criterion in which we would perform a roughly equal number of runs for each possible number of recommended clusters.</p>
        <p>After obtaining the <italic>T</italic> runs (this was done in parallel on a computing cluster), we have for each run the number of recommended clusters <italic>c</italic> ≤ <italic>K</italic> and the computed DIC score that takes into account the likelihood of the model as well as the model complexity [<xref rid="pcbi.1008270.ref025" ref-type="bibr">25</xref>]. Then, for each <italic>c</italic>, we compute the minimum DIC obtained for all runs that recommended <italic>c</italic> clusters, and we plot the DIC curve, as in Figure A in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>.</p>
        <p>Now, with a DIC curve, the elbow point can be found as follows. We draw a line from the first to the last point of the curve and then find the DIC point that is the farthest away from that line. Sometimes, the DIC curve is not a smooth decreasing function, but instead it can increase and decrease. Therefore, we decided to consider only the part of the curve with DIC values decreasing by at least a small percentage threshold (0.2%), which is the green line in Figure A in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>. We then find the elbow for this part of the curve, which corresponds to the best choice of the number of clusters and it is shown by the red line in Figure A in <xref ref-type="supplementary-material" rid="pcbi.1008270.s002">S1 Figs</xref>. The DIC-elbow selection strategy can be used as an automatic way to select the best run. However, visual inspection of the DIC-elbow can sometimes help choose the best thresholds.</p>
      </sec>
      <sec id="sec016">
        <title>EpiclomalBulk</title>
        <p>Often, bulk CpG-level methylation data are produced, that is, a vector of natural numbers, representing the number of methylated cytosines for each CpG, from 0 to the read depth <italic>D</italic> (e.g., <italic>D</italic> = 60). For instance, a value of 0 means that we expect no cell to be methylated (all are unmethylated) at that CpG site. A value of 60 means that we expect all the cells to be methylated, and a value of 30 means that roughly half the cells are methylated and half are unmethylated. Therefore, given the cell-to-cluster assignments and the corresponding imputed methylation values, we can compute a score that tells us how well the given imputed values match the bulk data (for each CpG site, we just have to count the number of cells that are methylated and then divide by the number of cells and multiply by <italic>D</italic>).</p>
        <p>With this bulk-based score function, we designed a stochastic local search algorithm that starts from a given configuration (which is EpiclomalRegion’s best result), keeps the number of clusters fixed, and randomly reassigns “uncertain cells” to one of their “candidate clusters”. The “uncertain cells” and the “candidate clusters” are obtained as described in Section 3.5 in <xref ref-type="supplementary-material" rid="pcbi.1008270.s001">S1 Material</xref>. Only the CpGs in the regions that make the clusters different are considered. If the new score is better than before, we always keep it; if it is not, we keep it only 20% of the time to help the algorithm escape local minima. We repeat this strategy for 10 iterations and return the combination of new cell-to-cluster assignments and imputed methylation states that gives the best score.</p>
      </sec>
    </sec>
    <sec id="sec017">
      <title>Non-probabilistic clustering methods</title>
      <sec id="sec018">
        <title>EuclideanClust</title>
        <p>EuclideanClust is a region-based method in which we first compute for each cell the mean methylation level of each region of interest. Because of the sparsity of the data, we cluster the cells, taking as input data not the original matrix of mean methylation levels, but instead we apply complete-linkage hierarchical clustering to the symmetric matrix of Euclidean distances between every pair of cells with a dissimilarity matrix based also on Euclidean distances. EuclideanClust is similar to the approach used by Smallwood <italic>et al</italic>. [<xref rid="pcbi.1008270.ref016" ref-type="bibr">16</xref>] and Angermuller <italic>et al</italic>. [<xref rid="pcbi.1008270.ref017" ref-type="bibr">17</xref>], with the difference that the regions are defined differently in our case (functional genomic regions) versus Smallwood (sliding windows across the genome) and Angermuller <italic>et al</italic>. (gene bodies). We use the Calinski-Harabasz (CH) index [<xref rid="pcbi.1008270.ref027" ref-type="bibr">27</xref>] to automatically choose the number of clusters that best fits the data.</p>
      </sec>
      <sec id="sec019">
        <title>DensityCut</title>
        <p>As in EuclideanClust, we first compute for each cell the mean methylation level of each region of interest. We then use principal component analysis as a dimensionality reduction technique with a maximum of 20 first principal components and apply DensityCut, a density-based clustering algorithm proposed by [<xref rid="pcbi.1008270.ref026" ref-type="bibr">26</xref>], to the resulting principal component scores.</p>
      </sec>
      <sec id="sec020">
        <title>HammingClust</title>
        <p>This method is a CpG-based method because it considers data from all individual CpGs from all regions of interest to cluster the cells. Because of the sparsity of the data, similarly to EuclideanClust, clustering is done by first calculating Hamming distance-based dissimilarities (proportion of discordant positions) between each pair of cells and then applying Ward’s linkage hierarchical clustering with Euclidean distances on the matrix of Hamming-based dissimilarities. PDclust as proposed by Hui <italic>et al</italic>. [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>] produces the same dendrogram as HammingClust because it consists of the same steps and dissimilarities, except that PDclust uses percentages of discordant positions and HammingClust proportions. PDClust does not include an automatic method to select the optimal number of clusters, but Hammingclust uses the CH index for that purpose. In addition, HammingClust has the advantage of being implemented in C++ within R, resulting in much faster computation than PDclust, which is implemented solely in R.</p>
      </sec>
      <sec id="sec021">
        <title>PearsonClust</title>
        <p>PearsonClust is also a CpG-based approach much like HammingClust, except that instead of Hamming and Euclidean distances, it is based entirely on Pearson correlation. In other words, it first computes the Pearson correlation between every pair of cells and then applies Ward’s linkage hierarchical clustering with again a Pearson-based dissimilarity matrix on the initial correlation matrix. This method is equivalent to the approach used by Hou <italic>et al</italic>. [<xref rid="pcbi.1008270.ref011" ref-type="bibr">11</xref>] with the addition of the CH index to select the best clustering partition.</p>
      </sec>
      <sec id="sec022">
        <title>Pre-imputation of missing values for non-probabilistic methods</title>
        <p>Sometimes the input matrix to the non-probabilistic methods is too sparse, and either hierarchical clustering or the CH-index method for choosing the number of clusters will fail to produce results. For the synthetic data, we simply report this as a failure in order to understand what characteristics of the input data set make this failure happen. However, for real data sets, we try to run the hierarchical methods without pre-imputation, and if they fail, we rerun them after pre-imputation; see the star-labelled runs in <xref ref-type="fig" rid="pcbi.1008270.g006">Fig 6</xref>.</p>
      </sec>
    </sec>
    <sec id="sec023">
      <title>Pre-processing of real data</title>
      <p>We pre-processed real data sets using the first part of our proposed framework. For each data set, we started by considering all regions of the corresponding type presented in the fifth column of <xref rid="pcbi.1008270.t002" ref-type="table">Table 2</xref>. Then, after eliminating the empty regions across all cells, we also removed regions with an average missing proportion across all cells greater than or equal to 95%. Next, we kept the most variable regions (as measured by IQR of mean methylation levels) that would produce three filtered inputs with 10,000, 15,000 and 20,000 loci respectively.</p>
    </sec>
    <sec id="sec024">
      <title>In-house sc-WGBS data generation</title>
      <sec id="sec025">
        <title>Biospecimen collection and ethical approval</title>
        <p>Tumour fragments from women diagnosed with breast lump undergoing surgery or diagnostic core biopsy were collected with informed consent according to procedures approved by the Ethics Committees at the University of British Columbia. Patients in British Columbia were recruited and samples collected under the tumor tissue repository (TTR-H06-00289) protocol that falls under the UBC BCCA Research Ethics Board.</p>
      </sec>
      <sec id="sec026">
        <title>Tissue processing</title>
        <p>The tumor materials were processed as described in [<xref rid="pcbi.1008270.ref010" ref-type="bibr">10</xref>]. Briefly, the tumor fragments were minced finely with scalpels and then mechanically disaggregated for one minute using a Stomacher 80 Biomaster (Seward Limited, Worthing, UK) in 1-2 mL cold DMEM-F12 medium. Aliquots from the resulting suspension of cells and clumps were used for xenotransplants.</p>
      </sec>
      <sec id="sec027">
        <title>Xenografting</title>
        <p>Xenograft samples were transplanted and passaged as described in [<xref rid="pcbi.1008270.ref010" ref-type="bibr">10</xref>]. Female immune compromised, NOD/SCID interleukin-2 receptor gamma null (NSG) and NOD Rag-1 null interleukin-2 receptor gamma null (NRG) mice were bred and housed at the Animal Resource Centre (ARC) at the British Columbia Cancer Research Centre (BCCRC) supervised by the Aparicio lab. Surgery was carried out on mice between the ages of 8-12 weeks. The animal care committee and animal welfare and ethical review committee of the University of British Columbia (UBC) approved all experimental procedures. For subcutaneous transplants, mechanically disaggregated cells and clumps of cells were resuspended in 100-200<italic>μ</italic>l of a 1:1 v/v mixture of cold DMEM/F12: Matrigel (BD Biosciences, San Jose, CA, USA). Eight- to twelve-week-old mice were anesthetised with isoflurane, after which the cell/clumps suspension was injected under the skin on the flank using a 1 ml syringe and a 21-gauge needle.</p>
      </sec>
      <sec id="sec028">
        <title>Histopathological review</title>
        <p>On histopathological review, two out of three, i.e., SA501 and SA609, patient-derived xenografts used in this study were triple negative breast cancers (TNBC). On immunohistochemistry, they were found to be receptor negative breast cancer subtype. SA532 was a ER+PR-HER2+ xenograft. A pathologist reviewed the slides.</p>
      </sec>
      <sec id="sec029">
        <title>Cell preparation and dispensing</title>
        <p>Xenograft tissues were dissociated to cells as described in [<xref rid="pcbi.1008270.ref004" ref-type="bibr">4</xref>] before dispensing single cells into the wells of 384 well plates using a contactless piezoelectric dispenser (sciFLEXArrayer S3, Scienion) with real-time cell detection in the glass capillary nozzle (CellenOne).</p>
      </sec>
      <sec id="sec030">
        <title>sc-WGBS experimental protocol</title>
        <p>The Post-Bisulfite Adapter Ligation (PBAL) protocol described in [<xref rid="pcbi.1008270.ref007" ref-type="bibr">7</xref>] was used to obtain in-house sc-WGBS data.</p>
      </sec>
      <sec id="sec031">
        <title>Data alignment and methylation calls</title>
        <p>One lane of paired end sequencing was used to create each single cell library. Trim Galore (v0.4.1) and Cutadapt(v1.10) were used for quality and adapter trimming. Libraries were aligned to a GRCh37-lite reference using Novoalign (v3.02.10) in bisulfite mode and converted to BAM format and sorted using Sambamba (v0.6.0). Bam files were annotated for duplicates using Picard Tools’ MarkDuplicates Jar (v1.92). Novomethyl (v1.10) was used in conjunction with in-house scripts (samtools v1.6 and bedtools v2.25.0) to determine methylation of each CpG as described in Section “NovoMethyl—Analysing Methylation Status” Section of the Novoalign documentation (<ext-link ext-link-type="uri" xlink:href="http://www.novocraft.com/documentation/novoalign-2/novoalign-user-guide/bisulphite-treated-reads/novomethyl-analyzing-methylation-status/">http://www.novocraft.com/documentation/novoalign-2/novoalign-user-guide/bisulphite-treated-reads/novomethyl-analyzing-methylation-status/</ext-link>).</p>
      </sec>
      <sec id="sec032">
        <title>Quality control</title>
        <p>Using an in-house script, libraries were filtered according to a delta CT and 100K read count threshold to account for suitable library depth. Libraries over the expected number of copy number variants were filtered out to control for chromothripsis and shattered cells.</p>
      </sec>
      <sec id="sec033">
        <title>Copy number calling</title>
        <p>Copy number changes for SA501 were called using the same sc-WGBS DNA methylation data (copy number calling from the DLP protocol [<xref rid="pcbi.1008270.ref004" ref-type="bibr">4</xref>] largely matches the sc-WGBS copy number calling for passage 2). Control Free-c (v7.0) was used to copy number variant call on processed BAMs. The following settings were used: ploidy: 2, window and telocentromeric: 500000, sex: XY, minExpectGC: 0.39 and maxExpectedGC: 0.51.</p>
      </sec>
    </sec>
    <sec id="sec034">
      <title>In-house bulk whole-genome bisulfite sequencing (SA501, passages 1 and 10)</title>
      <sec id="sec035">
        <title>Whole-genome bisulfite library construction for Illumina sequencing</title>
        <p>To track the efficiency of bisulfite conversion, 10 ng lambda DNA (Promega) was spiked into 1 <italic>μ</italic>g genomic DNA quantified using Qubit fluorometry and arrayed in a 96-well microtitre plate. DNA was sheared to a target size of 300 bp using Covaris sonication and the fragments end-repaired using DNA ligase and dNTPs at 30 C for 30 min. Repaired DNA was purified using a 2:1 AMPure XP beads-to-sample ratio and eluted in 40 <italic>μ</italic>L elution buffer in preparation for A-tailing; adenosine was then added to the 3’ end of DNA fragments using Klenow fragment and dATP incubated at 37 C for 30 min. Following reaction clean-up with magnetic beads, cytosine methylated paired-end adapters (5’-A<sup><italic>m</italic></sup>CA<sup><italic>m</italic></sup>CT<sup><italic>m</italic></sup>CTTT<sup><italic>m</italic></sup>C<sup><italic>m</italic></sup>C<sup><italic>m</italic></sup>CTA<sup><italic>m</italic></sup>CA<sup><italic>m</italic></sup>CGA<sup><italic>m</italic></sup>CG<sup><italic>m</italic></sup>CT<sup><italic>m</italic></sup>CTT<sup><italic>m</italic></sup>C<sup><italic>m</italic></sup>CGAT<sup><italic>m</italic></sup>CT-3’ and 3’-GAG<sup><italic>m</italic></sup>C<sup><italic>m</italic></sup>CGTAAGGA<sup><italic>m</italic></sup>CGA<sup><italic>m</italic></sup>CTTGG<sup><italic>m</italic></sup>CGAGAAGG<sup><italic>m</italic></sup>CTAG-5’) were ligated to the DNA at 30°C, 20 min, and adapter-flanked DNA fragments bead purified. Bisulfite conversion of the methylated adapter-ligated DNA fragments was achieved using the EZ Methylation-Gold kit (Zymo Research) following the manufacturer’s protocol. Seven cycles of PCR using HiFi polymerase (Kapa Biosystems) were used to enrich the bisulfite-converted DNA and introduce fault-tolerant hexamer barcode sequences. Post-PCR purification and size-selection of bisulfite-converted DNA were performed using 1:1 AMPure XP beads. To determine final library concentrations, fragment sizes were assessed using a high-sensitivity DNA assay (Agilent) and DNA quantified by Qubit fluorometry. Where necessary, libraries were diluted in elution buffer supplemented with 0.1% Tween-20 to achieve a concentration of 8 nM for Illumina HiSeq2500 flow cell cluster generation.</p>
      </sec>
      <sec id="sec036">
        <title>Data alignment and methylation calls</title>
        <p>FASTQ files were trimmed with TrimGalore (0.4.1) and then input into Bismark (0.14.4), aligning with bowtie2 (2.2.6). With the output BAM, we used samtools (1.3) to sort by name, fix mates, sort by position, remove duplicates, and then finally sort by name once again and filter out reads with a mapping quality of 10 or less. We then ran the resulting BAM files through the bismark_methylation_extractor script that accompanies Bismark to call methylation sites. All tools were run on all default settings, with changes made only to increase run speed.</p>
      </sec>
      <sec id="sec037">
        <title>Differentially methylated CpG Islands</title>
        <p>Differentially methylated CpG islands between bulk samples from tumour xenograft passages 1 and 10 were obtained via Fisher’s exact test considering all CpG islands with coverage greater than or equal to than five reads. The Benjamini-Hochberg procedure was used to correct for multiple testing.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="sec038">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="pcbi.1008270.s001">
      <label>S1 Material</label>
      <caption>
        <title>Supporting text and tables.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1008270.s001.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1008270.s002">
      <label>S1 Figs</label>
      <caption>
        <title>Supporting figures.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1008270.s002.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1008270.s003">
      <label>S1 Table</label>
      <caption>
        <title>Supporting table containing the coordinates of the 94 regions presented in <xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8</xref>.</title>
        <p>(XLSX)</p>
      </caption>
      <media xlink:href="pcbi.1008270.s003.xlsx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1008270.s004">
      <label>S2 Table</label>
      <caption>
        <title>Supporting table containing additional information regarding the regions presented in <xref ref-type="fig" rid="pcbi.1008270.g008">Fig 8</xref>.</title>
        <p>(XLSX)</p>
      </caption>
      <media xlink:href="pcbi.1008270.s004.xlsx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list>
    <title>References</title>
    <ref id="pcbi.1008270.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Smith</surname><given-names>ZD</given-names></name>, <name><surname>Meissner</surname><given-names>A</given-names></name>. <article-title>DNA methylation: roles in mammalian development</article-title>. <source>Nature Reviews Genetics</source>. <year>2013</year>;<volume>14</volume>(<issue>3</issue>):<fpage>204</fpage><pub-id pub-id-type="doi">10.1038/nrg3354</pub-id><?supplied-pmid 23400093?><pub-id pub-id-type="pmid">23400093</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Feng</surname><given-names>S</given-names></name>, <name><surname>Jacobsen</surname><given-names>SE</given-names></name>, <name><surname>Reik</surname><given-names>W</given-names></name>. <article-title>Epigenetic reprogramming in plant and animal development</article-title>. <source>Science</source>. <year>2010</year>;<volume>330</volume>(<issue>6004</issue>):<fpage>622</fpage>–<lpage>627</lpage>. <pub-id pub-id-type="doi">10.1126/science.1190614</pub-id><?supplied-pmid 21030646?><pub-id pub-id-type="pmid">21030646</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Navin</surname><given-names>N</given-names></name>, <name><surname>Kendall</surname><given-names>J</given-names></name>, <name><surname>Troge</surname><given-names>J</given-names></name>, <name><surname>Andrews</surname><given-names>P</given-names></name>, <name><surname>Rodgers</surname><given-names>L</given-names></name>, <name><surname>McIndoo</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>Tumour evolution inferred by single-cell sequencing</article-title>. <source>Nature</source>. <year>2011</year>;<volume>472</volume>(<issue>7341</issue>):<fpage>90</fpage><pub-id pub-id-type="doi">10.1038/nature09807</pub-id><?supplied-pmid 21399628?><pub-id pub-id-type="pmid">21399628</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Zahn</surname><given-names>H</given-names></name>, <name><surname>Steif</surname><given-names>A</given-names></name>, <name><surname>Laks</surname><given-names>E</given-names></name>, <name><surname>Eirew</surname><given-names>P</given-names></name>, <name><surname>VanInsberghe</surname><given-names>M</given-names></name>, <name><surname>Shah</surname><given-names>SP</given-names></name>, <etal>et al</etal><article-title>Scalable whole-genome single-cell library preparation without preamplification</article-title>. <source>Nature methods</source>. <year>2017</year>;<volume>14</volume>(<issue>2</issue>):<fpage>167</fpage><pub-id pub-id-type="doi">10.1038/nmeth.4140</pub-id><?supplied-pmid 28068316?><pub-id pub-id-type="pmid">28068316</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Shapiro</surname><given-names>E</given-names></name>, <name><surname>Biezuner</surname><given-names>T</given-names></name>, <name><surname>Linnarsson</surname><given-names>S</given-names></name>. <article-title>Single-cell sequencing-based technologies will revolutionize whole-organism science</article-title>. <source>Nature Reviews Genetics</source>. <year>2013</year>;<volume>14</volume>(<issue>9</issue>):<fpage>618</fpage><pub-id pub-id-type="doi">10.1038/nrg3542</pub-id><?supplied-pmid 23897237?><pub-id pub-id-type="pmid">23897237</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Gawad</surname><given-names>C</given-names></name>, <name><surname>Koh</surname><given-names>W</given-names></name>, <name><surname>Quake</surname><given-names>SR</given-names></name>. <article-title>Single-cell genome sequencing: current state of the science</article-title>. <source>Nature Reviews Genetics</source>. <year>2016</year>;<volume>17</volume>(<issue>3</issue>):<fpage>175</fpage><pub-id pub-id-type="doi">10.1038/nrg.2015.16</pub-id><?supplied-pmid 26806412?><pub-id pub-id-type="pmid">26806412</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Hui</surname><given-names>T</given-names></name>, <name><surname>Cao</surname><given-names>Q</given-names></name>, <name><surname>Wegrzyn-Woltosz</surname><given-names>J</given-names></name>, <name><surname>O’Neill</surname><given-names>K</given-names></name>, <name><surname>Hammond</surname><given-names>CA</given-names></name>, <name><surname>Knapp</surname><given-names>DJHF</given-names></name>, <etal>et al</etal><article-title>High-Resolution Single-Cell DNA Methylation Measurements Reveal Epigenetically Distinct Hematopoietic Stem Cell Subpopulations</article-title>. <source>Stem Cell Reports</source>. <year>2018</year>; <pub-id pub-id-type="doi">10.1016/j.stemcr.2018.07.003</pub-id>. <?supplied-pmid 30078558?><pub-id pub-id-type="pmid">30078558</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Clark</surname><given-names>SJ</given-names></name>, <name><surname>Lee</surname><given-names>HJ</given-names></name>, <name><surname>Smallwood</surname><given-names>SA</given-names></name>, <name><surname>Kelsey</surname><given-names>G</given-names></name>, <name><surname>Reik</surname><given-names>W</given-names></name>. <article-title>Single-cell epigenomics: powerful new methods for understanding gene regulation and cell identity</article-title>. <source>Genome biology</source>. <year>2016</year>;<volume>17</volume>(<issue>1</issue>):<fpage>72</fpage><pub-id pub-id-type="doi">10.1186/s13059-016-0944-x</pub-id><?supplied-pmid 27091476?><pub-id pub-id-type="pmid">27091476</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Nowell</surname><given-names>PC</given-names></name>. <article-title>The clonal evolution of tumor cell populations</article-title>. <source>Science</source>. <year>1976</year>;<volume>194</volume>(<issue>4260</issue>):<fpage>23</fpage>–<lpage>28</lpage>. <pub-id pub-id-type="doi">10.1126/science.959840</pub-id><?supplied-pmid 959840?><pub-id pub-id-type="pmid">959840</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Eirew</surname><given-names>P</given-names></name>, <name><surname>Steif</surname><given-names>A</given-names></name>, <name><surname>Khattra</surname><given-names>J</given-names></name>, <name><surname>Ha</surname><given-names>G</given-names></name>, <name><surname>Yap</surname><given-names>D</given-names></name>, <name><surname>Farahani</surname><given-names>H</given-names></name>, <etal>et al</etal><article-title>Dynamics of genomic clones in breast cancer patient xenografts at single cell resolution</article-title>. <source>Nature</source>. <year>2015</year>;<volume>518</volume>(<issue>7539</issue>):<fpage>422</fpage><pub-id pub-id-type="doi">10.1038/nature13952</pub-id><?supplied-pmid 25470049?><pub-id pub-id-type="pmid">25470049</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Hou</surname><given-names>Y</given-names></name>, <name><surname>Guo</surname><given-names>H</given-names></name>, <name><surname>Cao</surname><given-names>C</given-names></name>, <name><surname>Li</surname><given-names>X</given-names></name>, <name><surname>Hu</surname><given-names>B</given-names></name>, <name><surname>Zhu</surname><given-names>P</given-names></name>, <etal>et al</etal><article-title>Single-cell triple omics sequencing reveals genetic, epigenetic, and transcriptomic heterogeneity in hepatocellular carcinomas</article-title>. <source>Cell research</source>. <year>2016</year>;<volume>26</volume>(<issue>3</issue>):<fpage>304</fpage><pub-id pub-id-type="doi">10.1038/cr.2016.23</pub-id><?supplied-pmid 26902283?><pub-id pub-id-type="pmid">26902283</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Farlik</surname><given-names>M</given-names></name>, <name><surname>Halbritter</surname><given-names>F</given-names></name>, <name><surname>Müller</surname><given-names>F</given-names></name>, <name><surname>Choudry</surname><given-names>FA</given-names></name>, <name><surname>Ebert</surname><given-names>P</given-names></name>, <name><surname>Klughammer</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>DNA methylation dynamics of human hematopoietic stem cell differentiation</article-title>. <source>Cell stem cell</source>. <year>2016</year>;<volume>19</volume>(<issue>6</issue>):<fpage>808</fpage>–<lpage>822</lpage>. <pub-id pub-id-type="doi">10.1016/j.stem.2016.10.019</pub-id><?supplied-pmid 27867036?><pub-id pub-id-type="pmid">27867036</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Gravina</surname><given-names>S</given-names></name>, <name><surname>Dong</surname><given-names>X</given-names></name>, <name><surname>Yu</surname><given-names>B</given-names></name>, <name><surname>Vijg</surname><given-names>J</given-names></name>. <article-title>Single-cell genome-wide bisulfite sequencing uncovers extensive heterogeneity in the mouse liver methylome</article-title>. <source>Genome biology</source>. <year>2016</year>;<volume>17</volume>(<issue>1</issue>):<fpage>150</fpage><pub-id pub-id-type="doi">10.1186/s13059-016-1011-3</pub-id><?supplied-pmid 27380908?><pub-id pub-id-type="pmid">27380908</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Luo</surname><given-names>C</given-names></name>, <name><surname>Keown</surname><given-names>CL</given-names></name>, <name><surname>Kurihara</surname><given-names>L</given-names></name>, <name><surname>Zhou</surname><given-names>J</given-names></name>, <name><surname>He</surname><given-names>Y</given-names></name>, <name><surname>Li</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>Single-cell methylomes identify neuronal subtypes and regulatory elements in mammalian cortex</article-title>. <source>Science</source>. <year>2017</year>;<volume>357</volume>(<issue>6351</issue>):<fpage>600</fpage>–<lpage>604</lpage>. <pub-id pub-id-type="doi">10.1126/science.aan3351</pub-id><?supplied-pmid 28798132?><pub-id pub-id-type="pmid">28798132</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Kapourani</surname><given-names>CA</given-names></name>, <name><surname>Sanguinetti</surname><given-names>G</given-names></name>. <article-title>Melissa: Bayesian clustering and imputation of single-cell methylomes</article-title>. <source>Genome biology</source>. <year>2019</year>;<volume>20</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>15</lpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1665-8</pub-id><?supplied-pmid 30898142?><pub-id pub-id-type="pmid">30606230</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Smallwood</surname><given-names>SA</given-names></name>, <name><surname>Lee</surname><given-names>HJ</given-names></name>, <name><surname>Angermueller</surname><given-names>C</given-names></name>, <name><surname>Krueger</surname><given-names>F</given-names></name>, <name><surname>Saadeh</surname><given-names>H</given-names></name>, <name><surname>Peat</surname><given-names>J</given-names></name>, <etal>et al</etal><article-title>Single-cell genome-wide bisulfite sequencing for assessing epigenetic heterogeneity</article-title>. <source>Nature methods</source>. <year>2014</year>;<volume>11</volume>(<issue>8</issue>):<fpage>817</fpage>–<lpage>820</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.3035</pub-id><?supplied-pmid 25042786?><pub-id pub-id-type="pmid">25042786</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Angermueller</surname><given-names>C</given-names></name>, <name><surname>Clark</surname><given-names>SJ</given-names></name>, <name><surname>Lee</surname><given-names>HJ</given-names></name>, <name><surname>Macaulay</surname><given-names>IC</given-names></name>, <name><surname>Teng</surname><given-names>MJ</given-names></name>, <name><surname>Hu</surname><given-names>TX</given-names></name>, <etal>et al</etal><article-title>Parallel single-cell sequencing links transcriptional and epigenetic heterogeneity</article-title>. <source>Nature methods</source>. <year>2016</year>;<volume>13</volume>(<issue>3</issue>):<fpage>229</fpage><pub-id pub-id-type="doi">10.1038/nmeth.3728</pub-id><?supplied-pmid 26752769?><pub-id pub-id-type="pmid">26752769</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref018">
      <label>18</label>
      <mixed-citation publication-type="other">Mulqueen RM, Pokholok D, Norberg SJ, Torkenczy KA, Fields AJ, Sun D, et al. Highly scalable generation of DNA methylation profiles in single cells. Nature Biotechnology. 2018.</mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref019">
      <label>19</label>
      <mixed-citation publication-type="journal"><name><surname>Zeisel</surname><given-names>A</given-names></name>, <name><surname>Muñoz-Manchado</surname><given-names>AB</given-names></name>, <name><surname>Codeluppi</surname><given-names>S</given-names></name>, <name><surname>Lönnerberg</surname><given-names>P</given-names></name>, <name><surname>La Manno</surname><given-names>G</given-names></name>, <name><surname>Juréus</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>Cell types in the mouse cortex and hippocampus revealed by single-cell RNA-seq</article-title>. <source>Science</source>. <year>2015</year>;<volume>347</volume>(<issue>6226</issue>):<fpage>1138</fpage>–<lpage>1142</lpage>. <pub-id pub-id-type="doi">10.1126/science.aaa1934</pub-id><?supplied-pmid 25700174?><pub-id pub-id-type="pmid">25700174</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Lee</surname><given-names>DD</given-names></name>, <name><surname>Seung</surname><given-names>HS</given-names></name>. <article-title>Learning the parts of objects by non-negative matrix factorization</article-title>. <source>Nature</source>. <year>1999</year>;<volume>401</volume>(<issue>6755</issue>):<fpage>788</fpage><pub-id pub-id-type="doi">10.1038/44565</pub-id><?supplied-pmid 10548103?><pub-id pub-id-type="pmid">10548103</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref021">
      <label>21</label>
      <mixed-citation publication-type="journal"><name><surname>van der Maaten</surname><given-names>L</given-names></name>, <name><surname>Hinton</surname><given-names>G</given-names></name>. <article-title>Visualizing Data using t-SNE</article-title>. <source>Journal of Machine Learning Research</source>. <year>2008</year>;<volume>9</volume>:<fpage>2579</fpage>–<lpage>2605</lpage>.</mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref022">
      <label>22</label>
      <mixed-citation publication-type="other">Ester M, Kriegel HP, Sander J, Xu X. A Density-Based Algorithm for Discovering Clusters in Large Spatial Databases with Noise. In: Proc. of 2nd International Conference on Knowledge Discovery and; 1996. p. 226–231.</mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Angermueller</surname><given-names>C</given-names></name>, <name><surname>Lee</surname><given-names>HJ</given-names></name>, <name><surname>Reik</surname><given-names>W</given-names></name>, <name><surname>Stegle</surname><given-names>O</given-names></name>. <article-title>DeepCpG: accurate prediction of single-cell DNA methylation states using deep learning</article-title>. <source>Genome biology</source>. <year>2017</year>;<volume>18</volume>(<issue>1</issue>):<fpage>67</fpage><pub-id pub-id-type="doi">10.1186/s13059-017-1189-z</pub-id><?supplied-pmid 28395661?><pub-id pub-id-type="pmid">28395661</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref024">
      <label>24</label>
      <mixed-citation publication-type="journal"><name><surname>DeRose</surname><given-names>YS</given-names></name>, <name><surname>Wang</surname><given-names>G</given-names></name>, <name><surname>Lin</surname><given-names>YC</given-names></name>, <name><surname>Bernard</surname><given-names>PS</given-names></name>, <name><surname>Buys</surname><given-names>SS</given-names></name>, <name><surname>Ebbert</surname><given-names>MT</given-names></name>, <etal>et al</etal><article-title>Tumor grafts derived from women with breast cancer authentically reflect tumor pathology, growth, metastasis and disease outcomes</article-title>. <source>Nature medicine</source>. <year>2011</year>;<volume>17</volume>(<issue>11</issue>):<fpage>1514</fpage><pub-id pub-id-type="doi">10.1038/nm.2454</pub-id><?supplied-pmid 22019887?><pub-id pub-id-type="pmid">22019887</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Spiegelhalter</surname><given-names>DJ</given-names></name>, <name><surname>Best</surname><given-names>NG</given-names></name>, <name><surname>Carlin</surname><given-names>BP</given-names></name>, <name><surname>Van Der Linde</surname><given-names>A</given-names></name>. <article-title>Bayesian measures of model complexity and fit</article-title>. <source>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</source>. <year>2002</year>;<volume>64</volume>(<issue>4</issue>):<fpage>583</fpage>–<lpage>639</lpage>. <pub-id pub-id-type="doi">10.1111/1467-9868.00353</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref026">
      <label>26</label>
      <mixed-citation publication-type="journal"><name><surname>Ding</surname><given-names>J</given-names></name>, <name><surname>Shah</surname><given-names>S</given-names></name>, <name><surname>Condon</surname><given-names>A</given-names></name>. <article-title>densityCut: an efficient and versatile topological approach for automatic clustering of biological data</article-title>. <source>Bioinformatics</source>. <year>2016</year>;<volume>32</volume>(<issue>17</issue>):<fpage>2567</fpage>–<lpage>2576</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btw227</pub-id><?supplied-pmid 27153661?><pub-id pub-id-type="pmid">27153661</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref027">
      <label>27</label>
      <mixed-citation publication-type="journal"><name><surname>Caliński</surname><given-names>T</given-names></name>, <name><surname>Harabasz</surname><given-names>J</given-names></name>. <article-title>A dendrite method for cluster analysis</article-title>. <source>Communications in Statistics-theory and Methods</source>. <year>1974</year>;<volume>3</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>27</lpage>. <pub-id pub-id-type="doi">10.1080/03610927408827101</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref028">
      <label>28</label>
      <mixed-citation publication-type="other">Rosenberg A, Hirschberg J. V-measure: A conditional entropy-based external cluster evaluation measure. In: Proceedings of the 2007 joint conference on empirical methods in natural language processing and computational natural language learning (EMNLP-CoNLL); 2007.</mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref029">
      <label>29</label>
      <mixed-citation publication-type="other">McInnes L, Healy J, Melville J. Umap: Uniform manifold approximation and projection for dimension reduction. arXiv preprint arXiv:180203426. 2018.</mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Kim</surname><given-names>H</given-names></name>, <name><surname>Park</surname><given-names>H</given-names></name>. <article-title>Sparse non-negative matrix factorizations via alternating non-negativity-constrained least squares for microarray data analysis</article-title>. <source>Bioinformatics</source>. <year>2007</year>;<volume>23</volume>(<issue>12</issue>):<fpage>1495</fpage>–<lpage>1502</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btm134</pub-id><?supplied-pmid 17483501?><pub-id pub-id-type="pmid">17483501</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref031">
      <label>31</label>
      <mixed-citation publication-type="journal"><name><surname>Sharp</surname><given-names>AJ</given-names></name>, <name><surname>Stathaki</surname><given-names>E</given-names></name>, <name><surname>Migliavacca</surname><given-names>E</given-names></name>, <name><surname>Brahmachary</surname><given-names>M</given-names></name>, <name><surname>Montgomery</surname><given-names>SB</given-names></name>, <name><surname>Dupre</surname><given-names>Y</given-names></name>, <etal>et al</etal><article-title>DNA methylation profiles of human active and inactive X chromosomes</article-title>. <source>Genome research</source>. <year>2011</year>;<volume>21</volume>(<issue>10</issue>):<fpage>1592</fpage>–<lpage>1600</lpage>. <pub-id pub-id-type="doi">10.1101/gr.112680.110</pub-id><?supplied-pmid 21862626?><pub-id pub-id-type="pmid">21862626</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref032">
      <label>32</label>
      <mixed-citation publication-type="journal"><name><surname>Roth</surname><given-names>A</given-names></name>, <name><surname>McPherson</surname><given-names>A</given-names></name>, <name><surname>Laks</surname><given-names>E</given-names></name>, <name><surname>Biele</surname><given-names>J</given-names></name>, <name><surname>Yap</surname><given-names>D</given-names></name>, <name><surname>Wan</surname><given-names>A</given-names></name>, <etal>et al</etal><article-title>Clonal genotype and population structure inference from single-cell tumor sequencing</article-title>. <source>Nature methods</source>. <year>2016</year>;<volume>13</volume>(<issue>7</issue>):<fpage>573</fpage>–<lpage>579</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.3867</pub-id><?supplied-pmid 27183439?><pub-id pub-id-type="pmid">27183439</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref033">
      <label>33</label>
      <mixed-citation publication-type="journal"><name><surname>Jordan</surname><given-names>MI</given-names></name>, <name><surname>Ghahramani</surname><given-names>Z</given-names></name>, <name><surname>Jaakkola</surname><given-names>TS</given-names></name>, <name><surname>Saul</surname><given-names>LK</given-names></name>. <article-title>An introduction to variational methods for graphical models</article-title>. <source>Machine learning</source>. <year>1999</year>;<volume>37</volume>(<issue>2</issue>):<fpage>183</fpage>–<lpage>233</lpage>. <pub-id pub-id-type="doi">10.1023/A:1007665907178</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1008270.ref034">
      <label>34</label>
      <mixed-citation publication-type="journal"><name><surname>Blei</surname><given-names>DM</given-names></name>, <name><surname>Kucukelbir</surname><given-names>A</given-names></name>, <name><surname>McAuliffe</surname><given-names>JD</given-names></name>. <article-title>Variational inference: A review for statisticians</article-title>. <source>Journal of the American Statistical Association</source>. <year>2017</year>;<volume>112</volume>(<issue>518</issue>):<fpage>859</fpage>–<lpage>877</lpage>. <pub-id pub-id-type="doi">10.1080/01621459.2017.1285773</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
