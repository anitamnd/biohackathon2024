<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Biotechnol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Biotechnol</journal-id>
    <journal-title-group>
      <journal-title>Nature Biotechnology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1087-0156</issn>
    <issn pub-type="epub">1546-1696</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10635821</article-id>
    <article-id pub-id-type="pmid">36849830</article-id>
    <article-id pub-id-type="publisher-id">1663</article-id>
    <article-id pub-id-type="doi">10.1038/s41587-023-01663-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scPrisma infers, filters and enhances topological signals in single-cell data using spectral template matching</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8398-6025</contrib-id>
        <name>
          <surname>Karin</surname>
          <given-names>Jonathan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bornfeld</surname>
          <given-names>Yonathan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0074-9196</contrib-id>
        <name>
          <surname>Nitzan</surname>
          <given-names>Mor</given-names>
        </name>
        <address>
          <email>mor.nitzan@mail.huji.ac.il</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>School of Computer Science and Engineering, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>Racah Institute of Physics, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>Faculty of Medicine, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2023</year>
    </pub-date>
    <volume>41</volume>
    <issue>11</issue>
    <fpage>1645</fpage>
    <lpage>1654</lpage>
    <history>
      <date date-type="received">
        <day>7</day>
        <month>4</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>6</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Single-cell RNA sequencing has been instrumental in uncovering cellular spatiotemporal context. This task is challenging as cells simultaneously encode multiple, potentially cross-interfering, biological signals. Here we propose scPrisma, a spectral computational method that uses topological priors to decouple, enhance and filter different classes of biological processes in single-cell data, such as periodic and linear signals. We apply scPrisma to the analysis of the cell cycle in HeLa cells, circadian rhythm and spatial zonation in liver lobules, diurnal cycle in <italic>Chlamydomonas</italic> and circadian rhythm in the suprachiasmatic nucleus in the brain. scPrisma can be used to distinguish mixed cellular populations by specific characteristics such as cell type and uncover regulatory networks and cell–cell interactions specific to predefined biological signals, such as the circadian rhythm. We show scPrisma’s flexibility in incorporating prior knowledge, inference of topologically informative genes and generalization to additional diverse templates and systems. scPrisma can be used as a stand-alone workflow for signal analysis and as a prior step for downstream single-cell analysis.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">scPrisma deconvolutes different biological processes in single-cell RNA-sequencing data.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational models</kwd>
      <kwd>Data processing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100005155</institution-id>
            <institution>Azrieli Foundation</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100003977</institution-id>
            <institution>Israel Science Foundation (ISF)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>1079/21</award-id>
        <principal-award-recipient>
          <name>
            <surname>Nitzan</surname>
            <given-names>Mor</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature America, Inc. 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Main</title>
    <p id="Par3">In recent years, progress in single-cell RNA sequencing (scRNA-seq) that contains information about the gene expression profiles of the multitude of cells across tissues has led to substantial improvement in our understanding of a variety of intracellular and intercellular processes<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. Recent computational advances have pushed forward the interpretation of these data to extract information about the heterogeneity of cell types and states and their collective structure and behavior, including spatial context<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>, gene regulatory patterns<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, cell type<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> and temporal processes such as lineage<sup><xref ref-type="bibr" rid="CR5">5</xref></sup> and cell cycle<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. Because scRNA-seq data contain multiple biological signals, it can be challenging to uncover a particular underlying signal and in many cases, prior information about the signal in question is needed<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>. Recently, we have shown how topological priors about the hierarchical structure of lineage and differentiation in single-cell data can be leveraged for their identification using spectral approaches, as they exhibit power-law signatures in the covariance eigenvalue distribution<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. Relying on such global topological features can provide a more robust and generalizable approach than relying on specific features such as marker genes<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>, as these are many times unique to different biological systems and processes and can be challenging to infer for new systems. Here we show how topological priors can be used beyond signal identification. We use priors about the periodicity and linearity of diverse biological processes and later generalize to additional topologies, to either enhance or filter them out from single-cell data using a spectral projection approach.</p>
    <p id="Par4">Biological processes that are inherently periodic are abundant and have important roles in diverse contexts, such as the cell cycle and circadian rhythm. Multiple computational methods aim to infer periodic signals from single-cell data, with a particular focus to extract information related to the cell cycle or to remove its effect<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref></sup>. However, the majority of these methods are heavily based on the cell cycle marker gene information, including ccRemover<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> and reCAT<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, which makes them difficult to generalize across systems and across periodic signals beyond the cell cycle. On the contrary, Cyclum<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, which does not rely on marker genes, is an auto-encoder-based approach that optimizes a circular embedding for single-cell data to infer and remove cell cycle effects. However, fitting the data to a one-dimensional circle does not generally capture the variability of cyclic biological processes and lacks flexibility as it cannot easily incorporate additional prior knowledge, such as low-resolution temporal information, which may be necessary for weak cyclic signals.</p>
    <p id="Par5">Here we present scPrisma, a general spectral framework (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) for the reconstruction, enhancement and filtering of signals in single-cell data based on their topology and inference of topologically informative genes. We benchmark scPrisma and demonstrate its performance over simulated data and seven scRNA-seq datasets. Specifically, we show how the cell cycle can be revealed or filtered in a population of HeLa cells, how circadian rhythm and spatial zonation can be decoupled in liver lobules, how differences in <italic>Chlamydomonas</italic> that were grown in different environments can be emphasized by filtering their diurnal cycle signal, and how the signature of the circadian rhythm can be revealed in multiple cell types in the suprachiasmatic nucleus (SCN) in the brain, the master circadian pacemaker in mammals. In addition, we show how using scPrisma allows us to better distinguish distinct cellular subtypes of SCN neurons following temporal filtering, and uncover signal-related gene regulatory networks and cell–cell interactions following enhancement of the circadian rhythm signal. Finally, beyond cyclic and linear templates, scPrisma can be used to manipulate diverse template types, enhance the separation between clusters, identify multiple cyclic processes and enhance spatial signals in spatial transcriptomics. scPrisma is versatile and enables topological signal manipulation without low-dimensional embedding, which renders the results useful for diverse types of downstream analyses. Furthermore, it is flexible as it enables integration of diverse types of prior knowledge (such as low-resolution temporal ordering) but does not rely on it and can be used for de novo analyses.<fig id="Fig1"><label>Fig. 1</label><caption><title>General workflow of scPrisma.</title><p>Given single-cell data and a theoretical covariance matrix, for example, based on a topological model, we calculate its theoretical spectrum (1), order the cells along the topology (2) and either enhance the signal corresponding to that topology (3A, 4A) or filter it out from the data (3B).</p></caption><graphic xlink:href="41587_2023_1663_Fig1_HTML" id="d32e375"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Spectral template matching for scRNA-seq signal manipulation</title>
      <p id="Par6">We developed scPrisma, a spectral analysis framework that uses topological priors over underlying signals in single-cell data, to allow for their inference, enhancement and filtering. The core of scPrisma uses spectral template matching between the spectrum (the eigendecomposition of the covariance matrix) of a set of single-cell data (for example, scRNA-seq) and the expected analytical spectrum of a structure or process we aim to enhance or filter. To analyze a theoretical covariance spectrum (by analyzing its eigenvalues and eigenvectors), we need a reference model. Focusing first on cyclic signals, we propose a simple toy model of periodic biological signals (<xref rid="Sec10" ref-type="sec">Methods</xref>). The covariance matrix of the gene expression matrix of this model is a circulant matrix of a special form that depends on the model parameters (<xref rid="Sec10" ref-type="sec">Methods</xref>). Circulant matrices have closed-form formula for their eigenvectors and eigenvalues<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> (Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig1" ref-type="fig">1</xref>), which we used to estimate the ordering of cells along the cyclic topology. This was done by optimizing for a permutation matrix that maximizes the projection of the data over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig2" ref-type="fig">2</xref>). As input for the remainder of scPrisma’s workflow, cellular ordering can also be informed by prior knowledge of low-resolution pseudotime. Based on the reconstructed ordering, scPrisma infers topologically informative genes, as the set of genes that maximizes the projection over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig3" ref-type="fig">3A</xref>). scPrisma can then enhance (filter) the signal related to the cyclic process by filtering out gene expression entries that do not maximize (minimize) the projection over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig4" ref-type="fig">4A</xref> and <xref rid="Fig1" ref-type="fig">3B</xref>). scPrisma can successfully reconstruct, filter and enhance periodic signals in simulated single-cell data (Supplementary Note <xref rid="MOESM1" ref-type="media">A.1</xref>, Extended Data Fig. <xref rid="Fig6" ref-type="fig">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">1)</xref>.</p>
    </sec>
    <sec id="Sec4">
      <title>scPrisma manipulates the cell cycle signal in HeLa cells</title>
      <p id="Par7">We first tested our approach on a scRNA-seq dataset of HeLa cells, unsynchronized across the cell cycle<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). To assess the results, we used a list of approximately 400 genes, classified according to cell cycle phases<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, where for each phase, the corresponding genes were summed and normalized and their circular mean and variance were calculated<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>. For an ordered reconstructed signal, the ordering of the circular means should correspond to the cell cycle phases and the circular variance should be less than 1, while for randomly ordered data, the circular variance is expected to be close to 1 (corresponding to a uniform signal along the cycle). Following standard preprocessing of the HeLa single-cell data (<xref rid="Sec10" ref-type="sec">Methods</xref>; Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>, the distributions of all phases were found to be nearly uniform (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.991). However, after cyclic ordering by scPrisma (<xref rid="Sec10" ref-type="sec">Methods</xref>), different phases of the cell cycle became clearly separated (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.849) and peaked progressively according to the correct phase ordering.<fig id="Fig2"><label>Fig. 2</label><caption><title>scPrisma manipulates the cell cycle signal in HeLa cells.</title><p><bold>a</bold>, PCA representation of 683 cells in the unordered and ordered raw gene expression data, and data following spectral cyclic enhancement and filtering. The cells are colored according to the corresponding rows in the gene expression matrix. <bold>b</bold>, Smoothed polar plot of the normalized sum of the gene sets corresponding to different cell cycle phases<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. The circular mean of each phase is marked by a correspondingly colored star. <bold>c</bold>,<bold>d</bold>, Expression of <italic>CDC20</italic> (which peaks in the M phase<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>) and <italic>RRM2</italic> (which peaks in the S phase<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>) as a function of cellular location in the gene expression matrix. <bold>e</bold>, PCA representation of cells along iterations of the cyclic enhancement algorithm. <bold>f</bold>, Violin plot of AUC scores for <italic>n</italic> = 50 experiments of sampling random gene subsets and inference of cyclic genes by scPrisma based on unordered, ordered, enhanced and filtered data. White dots mark the median, gray bars mark the interquartile range and thin gray lines mark the rest of the distribution, except for outliers.</p></caption><graphic xlink:href="41587_2023_1663_Fig2_HTML" id="d32e530"/></fig></p>
      <p id="Par8">To further enhance the cell cycle signal in the data, we employed scPrisma’s cyclic enhancement algorithm. Iterations of our algorithm gradually revealed a cyclic signal, which was apparent after filtering less than 7% of the total signal and was clearly revealed after removing 22% of the total signal (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>). In addition, the reconstructed angular ordering was correlated with the cell cycle phases and the circular variance of phase-corresponding marker genes decreased substantially (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.666). Further, genes associated with different cell cycle phases peaked progressively in their expected order (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig2" ref-type="fig">2c,d</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">2)</xref>.</p>
      <p id="Par9">Next, we approached the reverse challenge: to filter out the cell cycle signal from the HeLa cells data. After applying scPrisma’s cyclic filtering algorithm to the ordered data, the separation between different cell cycle phases and their corresponding progressive peaks was lost (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.989).</p>
      <p id="Par10">Finally, we identified genes related to the cell cycle using the genes inference algorithm (<xref rid="Sec10" ref-type="sec">Methods</xref>; Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>. When using as input both randomly selected subsets of cell cycle-related genes<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> and subsets of genes unrelated to the cell cycle, we found a substantial improvement in our ability to identify cell cycle-related genes after reordering the cells (mean AUC = 0.804) relative to the original data (mean AUC = 0.295). Moreover, relative to the ordered data, identifying cell cycle-related genes was further improved following spectral cyclic enhancement (AUC mean 0.838, outperforming available baselines; Supplementary Fig. <xref rid="MOESM1" ref-type="media">2)</xref> and was diminished following cyclic filtering (mean AUC 0.183; Fig. <xref rid="Fig2" ref-type="fig">2f</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>scPrisma disentangles spatiotemporal signals in the liver</title>
      <p id="Par11">We next dissected spatiotemporal signals via a scRNA-seq dataset which captures gene expression variation of hepatocytes in the mammalian liver across both space (spatial zonation across the periportal to pericentral axis) and time (temporal variation across the circadian rhythm)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. Similarly to the cell cycle, the circadian rhythm was also expected to exhibit a cyclic structure in gene expression space. Here we used experimental prior knowledge in the form of low-resolution sampling time<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> to order the cells in a cycle. In this setting, we still missed information about temporally informative genes, and spatiotemporal information was still entangled (for example, <italic>Pck1</italic> varied informatively across both space and time of day<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>). We leveraged scPrisma to disentangle these data and showed clear enhancement and filtering of the circadian rhythm, relative to raw data (<italic>K</italic> = 4 Adjusted Rand Score (ARI) of <italic>K</italic>Means = 0.96; 0.013; 0.11, respectively; Fig. <xref rid="Fig3" ref-type="fig">3a,e</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3A</xref>; <xref rid="Sec10" ref-type="sec">Methods</xref>). scPrisma outperformed available baselines for filtering the circadian rhythm (Supplementary Note <xref rid="MOESM1" ref-type="media">A.5)</xref>. These results were reflected in the behavior of individual genes; <italic>Pck1</italic> is a rhythmic gene that was highly expressed at ZT06 and ZT12 (ref. <sup><xref ref-type="bibr" rid="CR15">15</xref></sup>), and indeed, following spectral cyclic enhancement, its resulting expression in ZT00 and ZT18 was diminished, while cyclic filtering resulted in a nearly constant temporal expression of <italic>Pck1</italic> (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). Spatially, <italic>Pck1</italic> is periportally zonated, and indeed, spectral cyclic enhancement flattens its spatial expression, while cyclic filtering retains its spatial variation (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). Similar behavior can be observed for additional spatiotemporally informative genes (Fig. <xref rid="Fig3" ref-type="fig">3d</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">4)</xref>.<fig id="Fig3"><label>Fig. 3</label><caption><title>Disentanglement of spatial and temporal signals in liver lobules.</title><p><bold>a</bold>,<bold>b</bold>, PCA representation of raw single-cell data of 4,000 cells (1,000 from each time point), and following spectral cyclic enhancement, cyclic filtering, linear enhancement and linear filtering. The cells are colored either according to their associated time points (ZT, sampled at four equally spaced time points along the circadian rhythm) (<bold>a</bold>), or by their respective spatial location (‘layer’, according to the zonation analysis done in <sup><xref ref-type="bibr" rid="CR15">15</xref></sup>) (<bold>b</bold>). <bold>c</bold>,<bold>d</bold>, Heatmaps of the expression of <italic>Pck1</italic> (<bold>c</bold>) and <italic>Oat</italic> (<bold>d</bold>) following scPrisma analysis as a function of the sampling time and zonation layer. <bold>e</bold>, ARI of <italic>K</italic>Means clustering with <italic>K</italic> = 4 (corresponding to four underlying time points) and <italic>K</italic> = 8 (corresponding to eight underlying zonation layers) after applying each of scPrisma’s spectral algorithms.</p></caption><graphic xlink:href="41587_2023_1663_Fig3_HTML" id="d32e694"/></fig></p>
      <p id="Par12">In a complementary manner, spectral analysis focusing on the characteristics of linear signals can be used to filter the spatial linear signal in the collective gene expression of hepatocytes (<xref rid="Sec10" ref-type="sec">Methods</xref>). Indeed, following spectral linear filtering by scPrisma, the cyclic circadian signal was clearly revealed (Fig. <xref rid="Fig3" ref-type="fig">3a</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3A)</xref> and the linear zonation signal was blurred out relative to the raw data (Fig. <xref rid="Fig3" ref-type="fig">3b</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3B,E</xref>; <italic>K</italic> = 8 ARI of <italic>K</italic>Means = 0.017; 0.11, respectively). Focusing again on <italic>Pck1</italic> expression, linear spectral enhancement retained only the expression around the portal vein and reduced the temporal variance, while linear filtering reduced the zonation variance and yet retained the temporal variance (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>).</p>
      <p id="Par13">Finally, we evaluated the dominant structure in the data following scPrisma analysis. As predicted, following spectral enhancement, the data clustered according to the enhanced signal, while following spectral filtering, the data clustered according to the unfiltered signal; for example, filtering the cyclic signal led to better identification and clustering of the spatial zonation signal (Fig. <xref rid="Fig3" ref-type="fig">3e</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>scPrisma manipulates the diurnal cycle in <italic>Chlamydomonas</italic></title>
      <p id="Par14">To demonstrate the use of scPrisma for more complex systems with diverse prior knowledge, we next turn our attention to scRNA-seq data collected for <italic>Chlamydomonas</italic> (green algae), grown under two contrasting conditions, iron replete (Fe<sup>+</sup>) and iron deficient (Fe<sup>−</sup>)<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. In both conditions, an expression signal that reflects the 24 h diurnal cycle was previously detected<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. To evaluate progression of cells along the diurnal cycle, we used marker genes corresponding to different cycle phases obtained from bulk RNA-sequencing<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.6)</xref>. Using scPrisma’s cyclic enhancement resulted in robust reconstruction of the diurnal cycle for each of the two conditions. This was done by splitting the 24-h cycle into six phases and validating that they are well separated following reconstruction and enhancement (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig4" ref-type="fig">4a</xref> for Fe<sup>+</sup> condition and Supplementary Fig. <xref rid="MOESM1" ref-type="media">5A</xref> for Fe<sup>−</sup> condition). Further, concatenating the enhanced cyclic signal of both experiments resulted in a reconstructed synchronized diurnal cycle (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5B)</xref>. We next focused on enhancing the biological differences between the Fe<sup>−</sup> and Fe<sup>+</sup> conditions by spectrally filtering their shared diurnal cycle (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). As expected, cyclic filtering increased the differences between the clusters of Fe<sup>−</sup> and Fe<sup>+</sup> associated cells (Silhouette score before/after filtering = 0.088/0.136, Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). scPrisma outperformed state-of-the-art cyclic filtering methods, including ccRemover<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and Cyclum<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> (Silhouette scores = 9.815 × 10<sup>-6</sup>, 9.868 × 10<sup>-4</sup> and 0.052, respectively; Supplementary Note <xref rid="MOESM1" ref-type="media">A.8</xref> and Fig. <xref rid="Fig4" ref-type="fig">4b</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>scPrisma detects and filters the diurnal cycle in <italic>Chlamydomonas</italic>.</title><p><bold>a</bold>, PCA representation of 3,000 cells in spectrally enhanced cyclic signal of the Fe<sup>+</sup> experiment<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. Each plot represents 1/6 of the 24 h cycle. The cells are colored according to the normalized sum of the marker genes associated with each phase<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. <bold>b</bold>, PCA representation of 6,000 cells (3,000 of each condition) in Fe<sup>+</sup> (blue) and Fe<sup>−</sup> (orange) conditions of raw gene expression data, data following scPrisma’s cyclic filtering (Silhouette score before/after filtering = 0.088/0.136, Calinski and Harabasz score before/after filtering = 600.802/1000.44) and enhancement, and data following filtering by Cyclum (Silhouette score = 0.052, Calinski and Harabasz score = 337.629), Seurat (Silhouette score = 9.868 × 10<sup>−</sup><sup>4</sup>, Calinski and Harabasz score = 1.29 × 10<sup>−</sup><sup>10</sup>) and ccRemover (Silhouette score = 9.815 × 10<sup>−</sup><sup>6</sup>, Calinski and Harabasz score = 6.25 × 10<sup>−</sup><sup>13</sup>).</p></caption><graphic xlink:href="41587_2023_1663_Fig4_HTML" id="d32e882"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>scPrisma extracts SCN cell-type-specific temporal signals</title>
      <p id="Par15">We next focus on scRNA-seq data collected for mice SCN, the mammalian brain’s circadian pacemaker<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. In this experiment, cells were sampled at 12 time points along two days. Again, we leveraged the cyclic nature of the circadian rhythm and explicitly used the prior knowledge regarding the experimental sampling times (instead of running the reconstruction algorithm). We first clustered the cells using the Louvain algorithm and mapped individual clusters to cell types using established marker genes<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">6)</xref>. scPrisma’s cyclic enhancement over each cell type separately revealed a cyclic signal associated with the circadian rhythm for 5/8 of cell types (Fig. <xref rid="Fig5" ref-type="fig">5</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>; <xref rid="Sec10" ref-type="sec">Methods</xref>). The three cell types that did not expose a clear cyclic signal (NG2, microglia and tanycytes) exhibit the lowest fraction of rhytmic gene expression<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. Moreover, we measured the separation of cells that were sampled at different time points, before and after cyclic filtering/enhancement using the Calinski and Harabasz score<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Overall, as expected, separation increased substantially following cyclic enhancement and decreased following cyclic filtering, which, as above, is least substantial for the three cell types exhibiting the lowest fraction of rhythmic genes (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). It can be observed that the cellular density varies with the rhythmic process and is correlated with the peak of temporal expression of rhythmic genes (Fig. <xref rid="Fig5" ref-type="fig">5a,b</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">A.7)</xref>. Focusing on gene expression, we found that spectral cyclic enhancement diminishes the expression of cell-type marker genes and retains the expression of rhythmic genes (core clock genes and protein folding genes, as characterized in ref. <sup><xref ref-type="bibr" rid="CR18">18</xref></sup>; Fig. <xref rid="Fig5" ref-type="fig">5c</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7)</xref>. Conversely, following cyclic filtering, cell-type marker gene expression was retained, while the resulting temporal expression of rhythmic and protein folding-related genes flattened (Fig. <xref rid="Fig5" ref-type="fig">5c</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7)</xref>.<fig id="Fig5"><label>Fig. 5</label><caption><title>scPrisma extracts cell-type specific circadian rhythm signals in the SCN.</title><p><bold>a</bold>, PCA representation of cells in raw SCN gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> and data following cyclic enhancement by scPrisma, colored according to CT, for several cell types: ependymal, SCN neurons, oligodendrocytes and astrocytes. <bold>b</bold>, PCA representation of ependymal cells colored by <italic>Tef</italic> expression and mean <italic>Tef</italic> expression as a function of circadian time, for raw data (top), data following scPrisma’s cyclic enhancement (middle) and filtering (bottom). <bold>c</bold>, Heatmaps of ependymal expression of (from left to right) cell-type marker genes, rhythmic genes and protein folding genes, for raw data (left) and data following scPrisma’s cyclic enhancement (middle) and filtering (right). <bold>d</bold>, Calinski and Harabasz score for cells sampled at different CT for raw data, and data following scPrisma’s cyclic enhancement and filtering. Cell types with low fraction of circadian genes<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> exhibit lower scores. <bold>e</bold>, Pre- and post-filtering gene expression dotplots of the marker genes of SCN neurons (before filtering, clusters 1, 3 and 4 contain mixtures of two different subtypes), and pre- and post-filtering heatmaps showing the contribution of cells sampled at different CT to each neuronal cluster. <bold>f</bold>, Regulatory network structure of core clock genes<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. <bold>g</bold>, Pre- and post-enhancement sum of scores of all regulatory interactions of the core clock network shown in <bold>f</bold>, scored by GRNBoost2, for each SCN cell type. <bold>h</bold>, Pre- and post-enhancement mean <italic>Rorc</italic>, <italic>Ahsa2</italic> and <italic>Hsp90ab1</italic> expression as a function of CT. Following cyclic enhancement, regulatory interactions between the transcription factor <italic>Rorc</italic> and <italic>Ahsa2</italic>, <italic>Hsp90ab1</italic> were uncovered. <bold>i</bold>, Mean <italic>Avp</italic> and <italic>Plau</italic> expression as a function of CT. Following cyclic enhancement, cell–cell interactions between astrocytes and microglia cell types, mediated by <italic>Avp</italic> and <italic>Plau</italic>, were revealed.</p></caption><graphic xlink:href="41587_2023_1663_Fig5_HTML" id="d32e1038"/></fig></p>
      <p id="Par16">scPrisma further enhanced cell-type classification, inference of gene regulatory interactions related to the circadian rhythm and underlying cell–cell interactions. When aiming to characterize cells by their type, additional biological signals can interfere with that task as similarity between cells can arise due to multiple factors. For example, direct clustering of cells according to their gene expression profiles may capture similarities according to the circadian rhythm phase and not their type, which can substantially hinder our ability to distinguish different cell types. Clustering the neurons yielded 14 distinct clusters, three of which can be identified using either established marker genes or previous subtype classification<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> as containing mixture of neurons from both SCN neuronal subtypes N0 and N2 (clusters 1, 3, 4; Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Fig. <xref rid="Fig5" ref-type="fig">5e</xref>). We found that the circadian rhythm signal interferes with the proper classification of cell subtypes in this case, supported by the observation that in clusters 1 and 3 the majority of cells (79% and 66%, respectively) were sampled at circadian time points (CT) = 14/18/22, while in cluster 4, 93% of cells were sampled at CT 02/06/10, which suggests that the clustering of cells in this subpopulation is dominated by their distinct temporal signatures and not their types (Fig. <xref rid="Fig5" ref-type="fig">5e</xref> and Extended Data Fig. <xref rid="Fig7" ref-type="fig">2</xref>). We were able to overcome the cell-type misclassification by spectrally filtering the circadian rhythm signal using scPrisma, after which, the clustering algorithm yielded a unique cluster for each of the two neuronal subtypes, N0 and N2 (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>). Moreover, as expected, the distribution over CT within each cluster flattened following cyclic filtering (Fig. <xref rid="Fig5" ref-type="fig">5e</xref> and Extended Data Fig. <xref rid="Fig7" ref-type="fig">2</xref>; mean circular variance increased from 0.781 to 0.863 following filtering).</p>
      <p id="Par17">Mixed biological signals in single-cell data can also interfere with the inference of gene regulatory networks. Therefore, we used scPrisma to highlight a set of regulatory interactions related to the circadian rhythm that were difficult to identify in the original data. Specifically, we expected that regulatory interactions that can be revealed following cyclic enhancement would be enriched with interactions associated with the cyclic circadian process. Indeed, regulatory interactions between core clock genes, as inferred using the gene regulatory network inference algorithm GRNBoost2 (ref. <sup><xref ref-type="bibr" rid="CR20">20</xref></sup>), are more highly correlated to the established core clock interaction network<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> (Fig. <xref rid="Fig5" ref-type="fig">5f</xref>) in the cyclically enhanced single-cell data, relative to the raw data, for 7/8 of the cell types (Fig. <xref rid="Fig5" ref-type="fig">5g</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">A.7)</xref>. Going beyond the core clock interaction network, using a list of known mice transcription factors<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, we searched for inferred interactions (based on GRNBoost2) which are substantially enhanced following scPrisma cyclic analysis (<xref rid="Sec10" ref-type="sec">Methods</xref>), where the regulator is a core clock transcription factor (<italic>Nr1d1</italic>, <italic>Nr1d2</italic>, <italic>Rora</italic>, <italic>Rorb</italic>, <italic>Rorc</italic>, <italic>Dbp</italic>, <italic>Tef</italic><sup><xref ref-type="bibr" rid="CR23">23</xref></sup>; a full list of inferred interactions is available in Supplementary Table <xref rid="MOESM3" ref-type="media">1)</xref>. For example, focusing on genes inferred to be highly regulated by <italic>Rorc</italic> in ependymal cells following spectral enhancement, we found that the genes that received the highest score were <italic>Ahsa2</italic> (0 to 6.341), <italic>Kif21a</italic> (0 to 6.231), <italic>Hsp90ab1</italic> (0.070 to 5.731) and <italic>Mt1</italic> (0 to 5.002) and the peaks of these genes along the circadian rhythm overlapped with the peak of <italic>Rorc</italic>, following spectral enhancement (Fig. <xref rid="Fig5" ref-type="fig">5h</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7E)</xref>. These results are consistent with previous results showing the existence of a regulatory interaction between <italic>Rorc</italic> and <italic>Hsp90ab1</italic> which is dependent on the time of day<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>.</p>
      <p id="Par18">Finally, we used scPrisma to infer hidden cell–cell interactions related to the circadian rhythm. We compared cell–cell communication patterns, using CellPhoneDB<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>, between different cell types at corresponding time points. Similarly to the regulatory network inference described above, we were able to recover interactions that were substantially enhanced following scPrisma’s cyclic analysis (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig5" ref-type="fig">5I</xref>, Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Supplementary Table <xref rid="MOESM4" ref-type="media">2)</xref>.</p>
    </sec>
    <sec id="Sec8">
      <title>Generalized template matching by scPrisma</title>
      <p id="Par19">Beyond cyclic and linear topologies, scPrisma can be used to manipulate a variety of different, complex topological signals in single-cell data. This is possible because scPrisma can use the numerical spectrum of a given covariance matrix, instead of the analytical spectrum, as was the case for the cyclic and linear topologies. We demonstrated the diversity of scPrisma on three additional types of templates as follows: (1) Clusters—we constructed a cluster-based template to enhance the separation, or maximize the variation in gene expression, between different cellular clusters and states (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>, specifically between cellular states of hepatocytes during day and night time (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3A</xref>). Further, this topology can be used for data integration via the spectral filtering workflow, as we demonstrated for human pancreas scRNA-seq data which were collected from four different studies<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>, labeled and preprocessed as given in ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. scPrisma can filter batch effects in this case, demonstrated visually (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3D,E</xref>) and quantitatively, as following cluster-based filtering, the Calinski and Harabasz score between the different batches drops from 298.63 to 3.80 and the score between the annotated cell types rises from 90.97 to 107.48. scPrisma’s results for batch correction are competitive or outperform state-of-the-art tailored methods for this task (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. (2) Multiple cycling processes—scPrisma can reconstruct multiple cycling processes across SCN cell types both for a synchronized case (Extended Data Fig. <xref rid="Fig9" ref-type="fig">4</xref>) and an un-synchronized case (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Extended Data Fig. <xref rid="Fig10" ref-type="fig">5</xref>). In the latter, more challenging case, circadian core clock genes are out-of-phase in the SCN neurons versus multiple other cell types<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. scPrisma can enhance every periodic signal separately by designing a covariance matrix that is block circulant (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. Furthermore, scPrisma can be used for the general, iterative inference of cyclic processes, although this task is more challenging and scPrisma is not optimized for it. As an example, we used human embryonic stem cells (hESC) single-cell dataset<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. We showed that scPrisma can be used (de novo, without prior knowledge on marker genes) to first infer a cyclic process corresponding to the cell cycle and then filter it out and use the filtered data to reconstruct a second cyclic process corresponding to an oscillatory pattern related to the experimental setup (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">8)</xref>. The encoding of both oscillatory processes by the hESC population is consistent with previous findings of ref. <sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. (3) Two-dimensional (2D) tissue organization—last, we enhanced the spatial signal in a spatially informed (Slide-seqV2) 2D dataset of the mouse hippocampus<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. We computed the shortest path matrix (calculated based on the spatial k-nearest neighbor graph over the data) and transformed it into an affinity matrix using a heat kernel (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. In this case, the affinity matrix is used by scPrisma as the covariance matrix of the spatial signal. scPrisma enables flexible manipulation of the spatial signal, which we leveraged to extract, and then either enhance or filter the spatial signal in the data by applying the enhancement algorithm based on numerical eigendecompositions of the affinity matrix (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Extended Data Fig. <xref rid="Fig11" ref-type="fig">6</xref>).</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par20">In this study, we developed scPrisma, a spectral analysis workflow based on topological priors for reconstruction, informative genes inference, signal filtering and enhancement. While we focus on periodic signals (cell cycle in HeLa cells, diurnal cycle in <italic>Chlamydomonas</italic> and circadian rhythm in the SCN), we also demonstrate it for convoluted spatial and cyclic signals (spatial zonation and circadian rhythm in liver lobules) and a diversity of additional signals and topologies, such as clusters, multiple cycling processes and 2D spatial templates.</p>
    <p id="Par21">scPrisma presents three major contributions as follows: First, it embodies a full workflow for analyzing underlying topological signals based on an approach that can be performed either de novo or enhanced using prior knowledge (for example, low-resolution pseudotime or marker gene information). This flexibility allows scPrisma to uncover topological signals of varying strengths. Second, scPrisma enables both signal enhancement and filtering without embedding to lower dimensions, which makes it useful as a prior step for existing downstream analyses, such as inferring gene regulation networks and cell–cell interactions. This can accelerate biological discovery, as we exemplify for SCN neurons, by revealing gene regulation patterns and cell–cell interactions that are associated with a specific biological process such as the circadian rhythm. Third, the enhancement algorithm does not overfit to a circular topology, by applying the genes inference task before enhancement (thus retaining only genes related to the desired signal), controlling the level of filtering by regularization and restricting the range of entries in the filtering matrix. Future work can leverage scPrisma’s flexibility and robustness to optimize it to diverse tasks that arise in the context of single-cell and spatial omics analysis, such as generalized spatial analysis, data integration and iterative manipulation of signals, which is a promising, yet challenging, direction for future work.</p>
    <p id="Par22">A computational challenge arises due to the nonconvexity and runtime complexity of the reconstruction task (Extended Data Fig. <xref rid="Fig12" ref-type="fig">7</xref>). This optimization challenge is relieved for cyclic signals, as the theoretical analysis of the eigenvectors does not depend on the specific values of the matrix but only on its circulant property. Moreover, the multiple solutions for the cyclic reconstruction task (every circular shift of a solution is a valid solution) ease the convergence to a feasible solution. In addition, the reconstruction step can be done either by scPrisma or by other pseudotime trajectory reconstruction algorithms. Another challenge is applying scPrisma when it is not clear whether a signal corresponding to the template exists or is strong enough to be detected in the data. This challenge is alleviated due to several reasons. First, we reason and provide empirical support on both synthetic and real single-cell data that scPrisma avoids overfitting to input template topologies. Therefore, in general, scPrisma does not converge to a topology that is not a reflection of a strong-enough signal in the data, as is demonstrated for the SCN, where the algorithm is limited in its convergence over cell types with weak periodic signal. Second, evaluating results obtained by scPrisma can be done by comparison to partial prior knowledge, such as marker genes known to be related (or unrelated) to recovered biological signals, low-resolution sampling times of cells relative to temporal signals, or by interpreting gene ontology enrichment analysis following signal manipulation. Additionally, we suggest a measure for the quality of convergence of scPrisma, the projection proportion score, and while it can be useful for exploring analysis options, it is not associated with a single threshold that can distinguish successful convergence, as it is affected by the signal and data characteristics (Supplementary Note <xref rid="MOESM1" ref-type="media">A.12</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">9)</xref>.</p>
    <p id="Par23">While in this work we focused on periodic signals, which can be analyzed analytically, scPrisma can also be applied using a numerical eigendecomposition of a covariance matrix that is either inferred from the data or constructed numerically based on a topological model. We anticipate that scPrisma will accelerate single-cell-based research by enhancing target signals of interest and enabling their identification and analysis and providing a general workflow for single-cell signal disentanglement in diverse biological contexts.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Spectral analysis of cyclic signals</title>
      <p id="Par24">For theoretical analysis, we constructed three simple models for the cyclic signals. In the first model, illustrated in Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>, we receive as input the number of cellular variations (<italic>q</italic>), the numbers of genes (<italic>p</italic>) and the number of changes between neighboring cells (<italic>k</italic>). We start with a root cell whose expression profile is a binary vector with <italic>p</italic> entries ({1, 0}<sup><italic>p</italic></sup>). Each gene is approximated to be either expressed (ON,1) or not expressed (OFF,0). Then, the next cell in the cycle is generated by duplicating the existing cell, choosing uniformly <italic>k</italic> genes and switching their state. This process is repeated <italic>q</italic> times. Then, within the last generated cell, <italic>k</italic> genes whose state differs from the root cell are chosen at random, their state is switched and the cell is duplicated. This process is then continued until the gene expression of the newest cell is identical to the root cell. For the analysis of the covariance matrix of the model, we will use a similar Markovian assumption to the assumption that was used in refs. <sup><xref ref-type="bibr" rid="CR8">8</xref>,<xref ref-type="bibr" rid="CR34">34</xref></sup>; the covariance between the expression profiles of two cells, separated by <italic>m</italic> state changes, where <italic>m</italic> is the minimum distance between the cells clockwise and counterclockwise (undirected cyclostationary assumption), is given by <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha (m)=E[X(m)X(0)]=\exp (-2mk/p),$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mo>/</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq1.gif"/></alternatives></inline-formula> where 0 ≤ <italic>m</italic> ≤ <italic>n</italic>/2, <italic>p</italic> is the number of genes and <italic>k</italic> is the number of changes between neighboring cells. More information about the model and the estimation of <italic>α</italic> from real data is described in Supplementary Note <xref rid="MOESM1" ref-type="media">A.11</xref>. According to this assumption, the expected covariance matrix of the gene expression matrix is circulant:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{n}E[X{X}^{\top }]=\left(\begin{array}{llllll}1&amp;\alpha &amp;{\alpha }^{2}&amp;\ldots &amp;{\alpha }^{2}&amp;\alpha \\ \alpha &amp;1&amp;\alpha &amp;\ldots &amp;{\alpha }^{3}&amp;{\alpha }^{2}\\ \vdots &amp;\vdots &amp;\vdots &amp;\ldots &amp;\vdots &amp;\vdots \\ {\alpha }^{2}&amp;{\alpha }^{3}&amp;{\alpha }^{4}&amp;\ldots &amp;1&amp;\alpha \\ \alpha &amp;{\alpha }^{2}&amp;{\alpha }^{3}&amp;\ldots &amp;\alpha &amp;1\end{array}\right)$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <italic>n</italic> is the number of cells. The first column (<inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\overrightarrow{c}$$\end{document}</tex-math><mml:math id="M6"><mml:mover accent="true"><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq2.gif"/></alternatives></inline-formula>) of a circulant matrix specifies the entire matrix. The (<italic>k</italic>, <italic>j</italic>) entry of a general circulant matrix <italic>C</italic> is given by <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k,j}={\overrightarrow{c}}_{(j-k) \% n}$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>%</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq3.gif"/></alternatives></inline-formula><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. The spectrum of a circulant matrix has analytical closed formula<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. Specifically, the eigenvalues are the discrete Fourier transform of the first row, and the eigenvectors are the normalized Fourier modes. Because a covariance matrix is symmetric and positive semidefinite, all its eigenvalues are real. Therefore, the eigenvalues are the discrete cosine transform of the first row<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\lambda }_{i}=\mathop{\sum }\limits_{j=0}^{n/2-1}{{\alpha }\,^{j}}_{i}* \cos \left(\frac{2\pi ji}{n}\right)\,+\,\mathop{\sum }\limits_{j=n/2}^{n-1}{{\alpha }\,^{j}}_{n-i}* \cos \left(\frac{2\pi ji}{n}\right)$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>α</mml:mi><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mspace width="0.25em"/><mml:mo>+</mml:mo><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>α</mml:mi><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par25">The <italic>s</italic>th entry of the <italic>i</italic>th eigenvector corresponding to the <italic>i</italic>th eigenvalue is<sup><xref ref-type="bibr" rid="CR35">35</xref></sup><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}=\sqrt{\frac{2}{n}}* \cos \left(\frac{2\pi is}{n}-\frac{\pi }{4}\right)$$\end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>To test our approach, we defined two additional models, described in Supplementary Note <xref rid="MOESM1" ref-type="media">A.2</xref>, which we used in the simulated data section (Supplementary Note <xref rid="MOESM1" ref-type="media">A.1)</xref>.</p>
    </sec>
    <sec id="Sec12">
      <title>Spectral analysis of linear signals</title>
      <p id="Par26">Similarly to the analysis of cyclic signals, we first construct a simple model for linear signals. We follow a similar linear model to the one that was presented in ref. <sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. The model receives the same input as the cyclic model, and each cell is represented by a binary vector {1, 0}<sup><italic>p</italic></sup>. We start from a root cell, and then over <italic>n</italic> iterations, a new cell is created in the linear chain by changing the state of <italic>k</italic> randomly chosen genes relative to the previous cell in the chain. As in the cyclic model, we assume that the covariance between the gene expression profiles of two cells, separated by <italic>m</italic> state changes, is given by <inline-formula id="IEq4"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha (m)=E[X(m)X(0)]=\exp (-2m/p)$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>m</mml:mi><mml:mo>/</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq4.gif"/></alternatives></inline-formula>. Thus, the expected covariance matrix of the gene expression matrix is<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{n}E[X{X}^{\top }]=\left(\begin{array}{llllll}1&amp;\alpha &amp;{\alpha }^{2}&amp;\ldots &amp;{\alpha }^{n-2}&amp;{\alpha }^{n-1}\\ \alpha &amp;1&amp;\alpha &amp;\ldots &amp;{\alpha }^{n-3}&amp;{\alpha }^{n-2}\\ \vdots &amp;\vdots &amp;\vdots &amp;\ldots &amp;\vdots &amp;\vdots \\ {\alpha }^{n-2}&amp;{\alpha }^{n-3}&amp;{\alpha }^{n-4}&amp;\ldots &amp;1&amp;\alpha \\ {\alpha }^{n-1}&amp;{\alpha }^{n-2}&amp;{\alpha }^{n-3}&amp;\ldots &amp;\alpha &amp;1\end{array}\right)$$\end{document}</tex-math><mml:math id="M16"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par27">This matrix is a special case of a Toeplitz matrix and is particularly known as Kac–Murdock–Szego matrix<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. The eigenvalues of such a Kac–Murdock–Szego matrix can be approximated as ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\lambda }_{i}=\frac{1-{\alpha }^{2}}{1+{\alpha }^{2}-2{\mathrm{cos}}\left(\frac{\left(i+1\right)\pi }{n+1}\right)\alpha }$$\end{document}</tex-math><mml:math id="M18"><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi mathvariant="normal">cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mi>α</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par28">The corresponding eigenvectors can either be estimated analytically<sup><xref ref-type="bibr" rid="CR38">38</xref></sup> or calculated by the numerical decomposition of the theoretical matrix.</p>
    </sec>
    <sec id="Sec13">
      <title>Preprocessing</title>
      <p id="Par29">We used a standard preprocessing pipeline as follows: first removing genes that are not expressed in any of the cells in our data, applying per-cell normalization by dividing each count by the total counts of that particular cell, applying log transformation and retaining only highly variable genes.</p>
      <p id="Par30">For the reconstruction algorithm, we scaled <italic>L</italic><sub>2</sub> of each cell to 1 to ensure that the circulant matrix has constant diagonal. For the gene inference algorithm, scaling <italic>L</italic><sub>2</sub> of each gene to 1 should be applied, as the score of each gene is relative to the rest of the genes. To estimate <italic>α</italic>, representing the correlation between neighbors according to the target topology, we search for the <italic>α</italic> value that best matches the spectrum of the given gene expression matrix. The results were improved by applying the algorithms after removing the theoretical covariance vector associated with the largest eigenvalue. For the cyclic case, the values of this eigenvector are constant.</p>
    </sec>
    <sec id="Sec14">
      <title>scPrisma general-case algorithm</title>
      <p id="Par31">
        <list list-type="order">
          <list-item>
            <p id="Par32">Choose the desired topology (for example, periodic/linear). Calculate the theoretical covariance eigenvectors and eigenvalues.</p>
          </list-item>
          <list-item>
            <p id="Par33">Preprocess the data.</p>
          </list-item>
          <list-item>
            <p id="Par34">Reconstruct the signal by reordering the gene expression rows by solving Problem 2 (below) or by using prior knowledge.</p>
          </list-item>
        </list>
      </p>
      <p id="Par35">Option 1—signal enhancement:<list list-type="alpha-lower"><list-item><p id="Par36">Infer informative genes by solving Problem 3 (below) or by using prior knowledge and remove the rest of the genes.</p></list-item><list-item><p id="Par37">Enhance the desired signal by solving Problem 4 (below).</p></list-item></list></p>
      <p id="Par38">Option 2—signal filtering:<list list-type="alpha-lower"><list-item><p id="Par39">Filter out the desired signal by solving Problem 5.</p></list-item></list></p>
    </sec>
    <sec id="Sec15">
      <title>Signal reconstruction</title>
      <p id="Par40">With a closed formula for the spectrum (<xref rid="Equ2" ref-type="disp-formula">2</xref>) and (<xref rid="Equ3" ref-type="disp-formula">3</xref>), we can estimate the pseudotime of the underlying cyclic trajectory. This can be done by estimating the rows reordering of the gene expression matrix that maximizes the projection over the theoretical spectrum. This problem can be formulated as a matrix permutation problem.</p>
      <sec id="FPar1">
        <title>Problem 1</title>
        <p id="Par41">Matrix permutation problem for estimating a pseudotime that maximizes the projection over the theoretical spectrum:<disp-formula id="Equa"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max E\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* (E* A)* {(E* A)}^{\rm {T}}* {\overrightarrow{v}}_{i}\\ &amp;{\mathrm{s.t}}\, \, E\in P\end{array}$$\end{document}</tex-math><mml:math id="M20"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>E</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi>E</mml:mi><mml:mo>∈</mml:mo><mml:mi>P</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where <italic>A</italic> is the original gene expression matrix, <inline-formula id="IEq5"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\overrightarrow{v}}_{i}$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq5.gif"/></alternatives></inline-formula> and <italic>λ</italic><sub><italic>i</italic></sub> are the theoretical eigenvectors and corresponding eigenvalues, respectively, and <italic>P</italic> is the set of permutation matrices. Under the assumption that <italic>A</italic> has a permutation <italic>Ẽ</italic> such that the spectrum of <inline-formula id="IEq6"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$({\tilde{\rm {E}}}*A)*({\tilde{\rm {E}}}*A)^{\rm{T}}$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">E</mml:mi></mml:mrow><mml:mrow><mml:mo>~</mml:mo></mml:mrow></mml:mover><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">E</mml:mi></mml:mrow><mml:mrow><mml:mo>~</mml:mo></mml:mrow></mml:mover><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq6.gif"/></alternatives></inline-formula> matches the theoretical spectrum, the optimal solution is <italic>E</italic> = <italic>Ẽ</italic> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.15)</xref>. Now, consider an identical formulation of the function we wish to maximize: <inline-formula id="IEq7"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\sum }\nolimits_{i = 0}^{n-1}{\lambda }_{i}* {{\left\Vert {(E* A)}^{\rm{T}}* {\overrightarrow{v}}_{i}\right\Vert }_{2}^{2}}$$\end{document}</tex-math><mml:math id="M26"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq7.gif"/></alternatives></inline-formula>. This formula aims to maximize the product of each gene sorted by the permutation matrix and each theoretical eigenvector multiplied by its eigenvalue. These theoretical eigenvectors, as they are the eigenvectors of the theoretical covariance matrix, represent the variance along the theoretical topology. As a result, the permutation which maximizes this objective maximizes the variance along the theoretical topology.</p>
        <p>Permutation problems are known to be NP-Hard<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>. We will follow previous studies in solving a convex relaxation of this problem, and instead of searching for a permutation matrix, we will search for a doubly stochastic matrix (the Birkhoff polytope)<sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>:</p>
      </sec>
      <sec id="FPar2">
        <title>Problem 2</title>
        <p id="Par43">Convex relaxation of Problem 1:<disp-formula id="Equb"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max E\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* (E* A)* {(E* A)}^{\rm{T}}* {\overrightarrow{v}}_{i}\\ &amp;{\mathrm{s.t}}\, \, \,{\overrightarrow{1}}^{\rm{T}}* E=\overrightarrow{1},\\ &amp;E* \overrightarrow{1}=\overrightarrow{1}\end{array}$$\end{document}</tex-math><mml:math id="M28"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>E</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equb.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Here the objective function is quadratic and convex (Supplementary Note <xref rid="MOESM1" ref-type="media">A.16)</xref>. Despite the fact that maximizing it is not convex optimization, previous studies have shown that such problems can be efficiently resolved with stochastic gradient descent<sup><xref ref-type="bibr" rid="CR41">41</xref>,<xref ref-type="bibr" rid="CR42">42</xref></sup>. To project into the Birkhoff polytope, we used Bregmanian bi-stochastication algorithm<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. Finally, for rounding the doubly stochastic matrix to a permutation matrix, we used a simple greedy algorithm. Specifically, the algorithm iterates over all rows, for each row rounds the maximum entry in each column that does not have 1 value yet to 1 and rounds to 0 the rest of the entries. The output of this algorithm is the permuted gene expression matrix: <italic>A</italic><sub>ordered</sub> = <inline-formula id="IEq8"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E*A$$\end{document}</tex-math><mml:math id="M30"><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq8.gif"/></alternatives></inline-formula>.</p>
      </sec>
    </sec>
    <sec id="Sec16">
      <title>Genes inference</title>
      <p id="Par45">Once the reconstructed signal is obtained, either by solving Problem 2 or by prior knowledge, identification of informative genes that are related to the desired signal is possible. This can be achieved by filtering genes that do not maximize the projection over the theoretical spectrum. Because of convexity considerations, it would be easier to infer genes that are not related to the desired signal and then flip the results. Inference of the genes that are not related to the desired signal can be done by solving the following optimization problem:</p>
      <sec id="FPar3">
        <title>Problem 3</title>
        <p id="Par46">Genes inference:<disp-formula id="Equc"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \min D\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{T}* ({A}_{{\mathrm{ordered}}}* D)* {({A}_{{\mathrm{ordered}}}* D)}^{T}* {\overrightarrow{v}}_{i}-{\gamma * \left\Vert D\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,D\,\,{\mathrm{is}}\,\,{\mathrm{diagonal}}\\ &amp;0\le D\le I\end{array}$$\end{document}</tex-math><mml:math id="M32"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>min</mml:mi><mml:mi>D</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi>D</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">is</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">diagonal</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>D</mml:mi><mml:mo>≤</mml:mo><mml:mi>I</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Because genes are represented by columns of <italic>A</italic>, each entry on the diagonal of <italic>D</italic> represents the influence of the respective gene on the spectrum. The number of filtered genes can be controlled by adding regularization. We can either increase the regularization coefficient, <italic>γ</italic>, to filter fewer genes or decrease it to filter more genes. The output of this algorithm is the gene expression matrix, after nullifying the genes that are not informative relative to the signal: <italic>D</italic><sub>1</sub> = <italic>I</italic> − <italic>D</italic>, <italic>A</italic><sub>gene-inferred</sub> = <italic>A</italic><sub>ordered</sub> <inline-formula id="IEq9"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$*$$\end{document}</tex-math><mml:math id="M34"><mml:mo>*</mml:mo></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq9.gif"/></alternatives></inline-formula> <italic>D</italic><sub>1</sub>.</p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>Filtering and enhancement</title>
      <p id="Par48">After inferring the set of informative genes (the genes related to the reconstructed signal), the next step is to remove any information that is not related to the signal, from the expression of those genes. This can be achieved by removing the diagonal constraint from Problem 3 and replacing the matrix product by the Hadamard product (element-wise product). For every entry in the expression matrix, <italic>A</italic><sub><italic>i</italic>,<italic>j</italic></sub>, this formulation matches an optimization variable <italic>F</italic><sub><italic>i</italic>,<italic>j</italic></sub>. Therefore, the enhanced gene expression matrix contains only expression profiles that maximize the projection over the theoretic spectrum.</p>
      <sec id="FPar4">
        <title>Problem 4</title>
        <p id="Par49">Signal enhancement:<disp-formula id="Equd"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max F\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* ({A}_{{\mathrm{genes-inferred}}}\odot F)* {({A}_{{\mathrm{genes-inferred}}}\odot F)}^{\rm{T}}* {\overrightarrow{v}}_{i}-\gamma * {\left\Vert F\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,0\le {F}_{i,j}\le 1\,\,\,\forall \,i,j\end{array}$$\end{document}</tex-math><mml:math id="M36"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>F</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">genes-inferred</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">genes-inferred</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mo>∀</mml:mo><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Because this problem is not a convex optimization problem, it can be solved by using stochastic gradient ascent (adding noise at each iteration<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>). The output of this algorithm is the gene expression matrix, after eliminating information that is unrelated to the signal of interest: <italic>A</italic><sub>enhanced</sub> = <italic>A</italic><sub>genes-inferred</sub> ⊙ <italic>F</italic>.</p>
        <p>Another option is similar to that described for Problem 3, which is to transform this problem into a minimization problem for filtering the reconstructed signal, thus turning it into a convex optimization problem (Supplementary Note <xref rid="MOESM1" ref-type="media">A.16)</xref>. Formulating this problem as a minimization problem eliminates the variance along the theoretical topology.</p>
      </sec>
      <sec id="FPar5">
        <title>Problem 5</title>
        <p id="Par52">Signal filtering:<disp-formula id="Eque"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \min F\,\,\,\,\mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* ({A}_{{\mathrm{ordered}}}\odot F)* {({A}_{{\mathrm{ordered}}}\odot F)}^{\rm{T}}* {\overrightarrow{v}}_{i}-\gamma * {\left\Vert F\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,0\le {F}_{i,j}\le 1\,\,\,\forall \,i,j\end{array}$$\end{document}</tex-math><mml:math id="M38"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>min</mml:mi><mml:mi>F</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mo>∀</mml:mo><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>The output of this algorithm is the gene expression matrix, after eliminating the information that is related to the signal of interest: <italic>A</italic><sub>filtered</sub> = <italic>A</italic><sub>ordered</sub> ⊙ <italic>F</italic>.</p>
      </sec>
    </sec>
    <sec id="Sec18">
      <title>Reporting summary</title>
      <p id="Par54">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec id="Sec19" sec-type="materials|methods">
    <title>Online content</title>
    <p id="Par55">Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests and statements of data and code availability are available at 10.1038/s41587-023-01663-5.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec21">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41587_2023_1663_MOESM1_ESM.pdf">
            <label>Supplementary Information</label>
            <caption>
              <p>Supplementary Notes A.1–A.16, Figs. 1–10, and References.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41587_2023_1663_MOESM2_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41587_2023_1663_MOESM3_ESM.xlsx">
            <label>Supplementary Table 1</label>
            <caption>
              <p>List of gene regulatory interactions related to the circadian rhythm signal inferred by GRNBoost2 after cyclic enhancement by scPrisma.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41587_2023_1663_MOESM4_ESM.xlsx">
            <label>Supplementary Table 2</label>
            <caption>
              <p>List of cell–cell interactions related to the circadian rhythm signal inferred by CellPhoneDB after cyclic enhancement by scPrisma.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec20">
        <title>Extended data</title>
        <p id="Par60">
          <fig id="Fig6">
            <label>Extended Data Fig. 1</label>
            <caption>
              <title>scPrisma identifies and filters periodic signals in simulated data.</title>
              <p>(A) PCA representation and gene expression covariance matrix before and after applying the reconstruction algorithm. This was done over a simulated gene expression matrix (100 cells, 500 genes, w=0.3) encoding a cyclic signal according to the spatial model (Supplementary A.2). The covariance matrix, after applying the reconstruction algorithm, is circulant. (B) Spearman correlation between the ground-truth permutation and the predicted permutation as a function of SNR over 300 simulations. A cyclic signal was simulated similarly to (A), Gaussian noise was added with varying variance, while the expression matrix was clipped to be positive. (C) AUC-ROC of informative genes inference task as a function of SNR over 300 simulations, each consisting of a cyclic signal and a lineage signal (256 cells, 250 genes) that were concatenated to form a combined gene expression matrix (256 cells, 500 genes), supplemented by additive Gaussian noise. (D) Filtering and enhancement of cyclic signals in combined simulated data. The combined simulation consists of the sum of linear and cyclic signals (200 cells, 500 genes each), and a Gaussian noise matrix (variance = 0.1). (E) Boxplots comparing the filtering and enhancement algorithms of scPrisma with Cyclum over n=100 simulations of the combined signal as described in (D). For the box plots, the center line is the median, box limits are the 0.25 and 0.75 quantiles, vertical lines extend from the top of the box to indicate the maximum value, and from the bottom to indicate the minimum value.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig6_ESM" id="d32e3701"/>
          </fig>
        </p>
        <p id="Par61">
          <fig id="Fig7">
            <label>Extended Data Fig. 2</label>
            <caption>
              <title>Temporal filtering by scPrisma enhances cell type clustering of single-cell data.</title>
              <p>Analysis based on single-cell data of suprachiasmatic nucleus neurons<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. (A) Before temporal filtering, clusters ‘1’ and ‘3’ mostly contain cells that were sampled in CT=14/18/22 while cluster ‘4’ mostly contains cells that were sampled in CT=06/10. (B) However, following filtering, the corresponding clusters (now labeled ‘0’ and ‘2’) are well-mixed in terms of their temporal labels.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig7_ESM" id="d32e3719"/>
          </fig>
        </p>
        <p id="Par62">
          <fig id="Fig8">
            <label>Extended Data Fig. 3</label>
            <caption>
              <title>Enhancement and filtering by scPrisma of clustered structure in cellular populations.</title>
              <p>(A-C) Enhancement of clustered structure in the liver lobule scRNA-seq data<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>; (A) 2D PCA of raw (left) and cluster-based enhanced (right) data, highlighting the separation between samples that were collected during the night (ZT = 0, 18) and the day (ZT = 6, 12). (B) Mean (triangle) and variance (error bar) of <italic>Pck1</italic> expression as a function of circadian time, for raw (left) and cluster-based enhanced (right) data. At each time point, the sample size is N=1000. (C) 2D PCA colored by <italic>Pck1</italic> expression for raw (left) and cluster-based enhanced (right) data. (D,E) Filtering of clustered structure, leading to integration of pancreas scRNA-seq data collected from 4 different studies<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>; UMAPs of pre and post data integration, colored by (D) batch and (E) cell type.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig8_ESM" id="d32e3750"/>
          </fig>
        </p>
        <p id="Par63">
          <fig id="Fig9">
            <label>Extended Data Fig. 4</label>
            <caption>
              <title>Enhancement by scPrisma of synchronized periodic processes.</title>
              <p>Analysis based on SCN single-cell gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. (A-C) 2D PCA of ependymal and endothelial cells, for (A) raw and (B,C) cyclic-enhanced data, colored by (A,B) circadian sample time (left) and by cell type (right), and by (C) <italic>Dbp</italic> (left) and <italic>Hsp90ab1</italic> (right) expression.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig9_ESM" id="d32e3774"/>
          </fig>
        </p>
        <p id="Par64">
          <fig id="Fig10">
            <label>Extended Data Fig. 5</label>
            <caption>
              <title>Enhancement by scPrisma of unsynchronized periodic processes.</title>
              <p>Analysis based on SCN single-cell gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. (A,B) 2D PCA of ependymal cells and SCN neurons, for (A) raw and (B) cyclic-enhanced data, colored by circadian sample time (left) and by cell type (right). (C,D) 2D tSNE of ependymal cells and SCN neurons, for cyclic-enhanced data, colored by circadian sample time (C; left), cell type (C; right), and <italic>Dbp</italic> expression (D). (E) Mean (triangle) and variance (error bar) of <italic>Dbp</italic> expression as a function of circadian time, which peaks at CT = 10 in ependymal cells (top), and peaks at CT = 2/6 in SCN neurons (bottom). The sample sizes at each time point (CT/N) for ependymal cells are: CT02/428, CT06/493, CT10/521, CT14/519, CT18/365 and CT22/480, and for SCN neurons they are: CT02/667, CT06/741, CT10/870, CT14/670, CT18/1375 and CT22/1029.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig10_ESM" id="d32e3798"/>
          </fig>
        </p>
        <p id="Par65">
          <fig id="Fig11">
            <label>Extended Data Fig. 6</label>
            <caption>
              <title>Spatial enhancement by scPrisma.</title>
              <p>Analysis based on Slide-seqV2 mouse hippocampus data <sup><xref ref-type="bibr" rid="CR32">32</xref></sup>(subsampled to 29,250 cells). Raw (left) and spatially-enhanced (right) gene expression of the top 3 spatially informative genes (based on Moran’s I score).</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig11_ESM" id="d32e3816"/>
          </fig>
        </p>
        <p id="Par66">
          <fig id="Fig12">
            <label>Extended Data Fig. 7</label>
            <caption>
              <title>Runtime and memory consumption analysis of scPrisma algorithms.</title>
              <p>Simulated cyclic signal of 2000 genes, varying number of cells, <italic>w</italic> = 0.3 and added Gaussian noise (variance=0.1), using a single GPU-‘NVIDIA RTX A5000’.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig12_ESM" id="d32e3833"/>
          </fig>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <sec id="FPar6">
      <title>Extended data</title>
      <p id="Par56">is available for this paper at 10.1038/s41587-023-01663-5.</p>
    </sec>
    <sec id="FPar7" sec-type="supplementary-material">
      <title>Supplementary information</title>
      <p id="Par57">The online version contains supplementary material available at 10.1038/s41587-023-01663-5.</p>
    </sec>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank N. Moriel, Y. Constantini, Z. Piran, E. Memet and the rest of our group members, and R. Mintz, O. Karin, D. Shalev and I. Alon for meaningful discussions and feedback. We thank O. Mittelpunkt for assistance in the graphic design. This work was funded by the Center for Interdisciplinary Data Science Research at the Hebrew University of Jerusalem (J.K.), an Azrieli Foundation Early Career Faculty Fellowship, Israel Science Foundation Research Grant (1079/21) and the European Union (ERC, DecodeSC, 101040660) (M.N.). Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Research Council. Neither the European Union nor the granting authority can be held responsible for them.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>J.K. and M.N. conceived the study, designed the research and developed the framework; J.K. implemented the method and analyzed the data, with guidance from M.N.; Y.B. contributed to the theoretical analysis of linear signals; J.K. and M.N. wrote the paper.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar8">
      <title>Peer review information</title>
      <p id="Par58"><italic>Nature Biotechnology</italic> thanks Ken Chen, Feng Bao and the other, anonymous, reviewer(s) for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The scRNA-seq datasets used for this study were acquired from the Gene Expression Omnibus (GEO) database with the following accession numbers: HeLaS3 (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE142277">GSM4224315</ext-link>), liver (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE145197">GSE145197</ext-link>), <italic>Chlamydomonas</italic> (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE157580">GSE157580</ext-link>), SCN (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117295">GSE117295</ext-link>) and hESC (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE64016">GSE64016</ext-link>). Slide-seqV2 dataset of the mice hippocampus was generated from ref. <sup><xref ref-type="bibr" rid="CR32">32</xref></sup> and downloaded using Squidpy<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. Pancreas datasets were generated from refs. <sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup> and downloaded using Scanpy<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The code for scPrisma is publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/nitzanlab/scPrisma/">https://github.com/nitzanlab/scPrisma/</ext-link></p>
  </notes>
  <notes id="FPar9" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par59">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>AR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Quantitative assessment of single-cell RNA-sequencing methods</article-title>
        <source>Nat. Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>41</fpage>
        <lpage>46</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2694</pub-id>
        <?supplied-pmid 24141493?>
        <pub-id pub-id-type="pmid">24141493</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Karaiskos</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Gene expression cartography</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>576</volume>
        <fpage>132</fpage>
        <lpage>137</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1773-3</pub-id>
        <?supplied-pmid 31748748?>
        <pub-id pub-id-type="pmid">31748748</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jansen</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Building gene regulatory networks from scatac-seq and scRNA-seq using linked self organizing maps</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2019</year>
        <volume>15</volume>
        <fpage>e1006555</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1006555</pub-id>
        <?supplied-pmid 31682608?>
        <pub-id pub-id-type="pmid">31682608</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Plass</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell type atlas and lineage tree of a whole complex animal by single-cell transcriptomics</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>360</volume>
        <fpage>eaaq1723</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aaq1723</pub-id>
        <?supplied-pmid 29674432?>
        <pub-id pub-id-type="pmid">29674432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Forrow</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schiebinger</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Lineageot is a unified framework for lineage tracing and trajectory inference</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>4940</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-25133-1</pub-id>
        <?supplied-pmid 34400634?>
        <pub-id pub-id-type="pmid">34400634</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reconstructing cell cycle pseudo time-series via single-cell transcriptome data</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>22</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-017-00039-z</pub-id>
        <?supplied-pmid 28630425?>
        <pub-id pub-id-type="pmid">28630425</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Barron</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Identifying and removing the cell-cycle effect from single-cell RNA-sequencing data</article-title>
        <source>Sci. Rep.</source>
        <year>2016</year>
        <volume>6</volume>
        <fpage>33892</fpage>
        <pub-id pub-id-type="doi">10.1038/srep33892</pub-id>
        <?supplied-pmid 27670849?>
        <pub-id pub-id-type="pmid">27670849</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>MP</given-names>
          </name>
        </person-group>
        <article-title>Revealing lineage-related signals in single-cell gene expression using random matrix theory</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2021</year>
        <volume>118</volume>
        <fpage>e1913931118</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1913931118</pub-id>
        <?supplied-pmid 33836557?>
        <pub-id pub-id-type="pmid">33836557</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liang</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Latent periodic process inference from single-cell RNA-seq data</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1441</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-15295-9</pub-id>
        <?supplied-pmid 32188848?>
        <pub-id pub-id-type="pmid">32188848</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <?supplied-pmid 25867923?>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rojo</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Rojo</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Some results on symmetric circulant matrices and on symmetric centrosymmetric matrices</article-title>
        <source>Linear Algebra Appl.</source>
        <year>2004</year>
        <volume>392</volume>
        <fpage>211</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1016/j.laa.2004.06.013</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schwabe</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Formichetti</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Junker</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Falcke</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>The transcriptome dynamics of single cells during the cell cycle</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2020</year>
        <volume>16</volume>
        <fpage>e9946</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20209946</pub-id>
        <?supplied-pmid 33205894?>
        <pub-id pub-id-type="pmid">33205894</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Jammalamadaka, S. R. &amp; Sengupta, A. <italic>Topics in Circular Statistics</italic> Vol. 5 (World Scientific, 2001).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Droin</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Space-time logic of liver gene expression at sub-lobular scale</article-title>
        <source>Nat. Metab.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>43</fpage>
        <lpage>58</lpage>
        <pub-id pub-id-type="doi">10.1038/s42255-020-00323-1</pub-id>
        <?supplied-pmid 33432202?>
        <pub-id pub-id-type="pmid">33432202</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Salomé</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Merchant</surname>
            <given-names>SS</given-names>
          </name>
          <name>
            <surname>Pellegrini</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing of batch Chlamydomonas cultures reveals heterogeneity in their diurnal cycle phase</article-title>
        <source>Plant Cell</source>
        <year>2021</year>
        <volume>33</volume>
        <fpage>1042</fpage>
        <lpage>1057</lpage>
        <pub-id pub-id-type="doi">10.1093/plcell/koab025</pub-id>
        <?supplied-pmid 33585940?>
        <pub-id pub-id-type="pmid">33585940</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Strenkert</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiomics resolution of molecular events during a day in the life of Chlamydomonas</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>2374</fpage>
        <lpage>2383</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1815238116</pub-id>
        <?supplied-pmid 30659148?>
        <pub-id pub-id-type="pmid">30659148</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal single-cell analysis of gene expression in the mouse suprachiasmatic nucleus</article-title>
        <source>Nat. Neurosci.</source>
        <year>2020</year>
        <volume>23</volume>
        <fpage>456</fpage>
        <lpage>467</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-020-0586-x</pub-id>
        <?supplied-pmid 32066983?>
        <pub-id pub-id-type="pmid">32066983</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <mixed-citation publication-type="other">Caliński, T. &amp; Harabasz, J. A dendrite method for cluster analysis. <italic>Commun. Stat.</italic><bold>3</bold>, 1–27 (1974).</mixed-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moerman</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GRNBoost2 and Arboreto: efficient and scalable inference of gene regulatory networks</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>2159</fpage>
        <lpage>2161</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty916</pub-id>
        <?supplied-pmid 30445495?>
        <pub-id pub-id-type="pmid">30445495</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pett</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Kondoff</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bordyugov</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kramer</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Herzel</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Co-existing feedback loops generate tissue-specific circadian rhythms</article-title>
        <source>Life Sci. Alliance</source>
        <year>2018</year>
        <volume>1</volume>
        <fpage>e201800078</fpage>
        <pub-id pub-id-type="doi">10.26508/lsa.201800078</pub-id>
        <?supplied-pmid 30456356?>
        <pub-id pub-id-type="pmid">30456356</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AnimalTFDB 3.0: a comprehensive resource for annotation and prediction of animal transcription factors</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D33</fpage>
        <lpage>D38</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky822</pub-id>
        <?supplied-pmid 30204897?>
        <pub-id pub-id-type="pmid">30204897</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>YH</given-names>
          </name>
          <name>
            <surname>Lazar</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <article-title>Transcriptional control of circadian rhythms and metabolism: a matter of time and space</article-title>
        <source>Endocrine Rev.</source>
        <year>2020</year>
        <volume>41</volume>
        <fpage>707</fpage>
        <lpage>732</lpage>
        <pub-id pub-id-type="doi">10.1210/endrev/bnaa014</pub-id>
        <pub-id pub-id-type="pmid">32392281</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Time-of-day specificity of anticancer drugs may be mediated by circadian regulation of the cell cycle</article-title>
        <source>Sci. Adv.</source>
        <year>2021</year>
        <volume>7</volume>
        <fpage>eabd2645</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.abd2645</pub-id>
        <?supplied-pmid 33579708?>
        <pub-id pub-id-type="pmid">33579708</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Efremova</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Cellphonedb: inferring cell–cell communication from combined expression of multi-subunit ligand–receptor complexes</article-title>
        <source>Nat. Protoc.</source>
        <year>2020</year>
        <volume>15</volume>
        <fpage>1484</fpage>
        <lpage>1506</lpage>
        <pub-id pub-id-type="doi">10.1038/s41596-020-0292-x</pub-id>
        <?supplied-pmid 32103204?>
        <pub-id pub-id-type="pmid">32103204</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Segerstolpe</surname>
            <given-names>Å</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title>
        <source>Cell Metab.</source>
        <year>2016</year>
        <volume>24</volume>
        <fpage>593</fpage>
        <lpage>607</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cmet.2016.08.020</pub-id>
        <?supplied-pmid 27667667?>
        <pub-id pub-id-type="pmid">27667667</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baron</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>346</fpage>
        <lpage>360</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id>
        <?supplied-pmid 27667365?>
        <pub-id pub-id-type="pmid">27667365</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>YJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptomics of the human endocrine pancreas</article-title>
        <source>Diabetes</source>
        <year>2016</year>
        <volume>65</volume>
        <fpage>3028</fpage>
        <lpage>3038</lpage>
        <pub-id pub-id-type="doi">10.2337/db16-0405</pub-id>
        <?supplied-pmid 27364731?>
        <pub-id pub-id-type="pmid">27364731</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Muraro</surname>
            <given-names>MJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>385</fpage>
        <lpage>394</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id>
        <?supplied-pmid 27693023?>
        <pub-id pub-id-type="pmid">27693023</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polański</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>964</fpage>
        <lpage>965</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id>
        <?supplied-pmid 31400197?>
        <pub-id pub-id-type="pmid">31400197</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leng</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Oscope identifies oscillatory genes in unsynchronized single-cell RNA-seq experiments</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>947</fpage>
        <lpage>950</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3549</pub-id>
        <?supplied-pmid 26301841?>
        <pub-id pub-id-type="pmid">26301841</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stickels</surname>
            <given-names>RR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqv2</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>313</fpage>
        <lpage>319</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id>
        <?supplied-pmid 33288904?>
        <pub-id pub-id-type="pmid">33288904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Santos</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wernersson</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jensen</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Cyclebase 3.0: a multi-organism database on cell-cycle regulation and phenotypes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2015</year>
        <volume>43</volume>
        <fpage>D1140</fpage>
        <lpage>D1144</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku1092</pub-id>
        <?supplied-pmid 25378319?>
        <pub-id pub-id-type="pmid">25378319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Colwell</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Power law tails in phylogenetic systems</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2018</year>
        <volume>115</volume>
        <fpage>690</fpage>
        <lpage>695</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1711913115</pub-id>
        <?supplied-pmid 29311320?>
        <pub-id pub-id-type="pmid">29311320</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <mixed-citation publication-type="other">Gray, R. M. <italic>Toeplitz and Circulant Matrices: A Review</italic> (Now, 2006).</mixed-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Demidenko</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Applications of symmetric circulant matrices to isotropic Markov chain models and electrical impedance tomography</article-title>
        <source>Adv. Pure Math.</source>
        <year>2017</year>
        <volume>7</volume>
        <fpage>188</fpage>
        <lpage>198</lpage>
        <pub-id pub-id-type="doi">10.4236/apm.2017.72010</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <mixed-citation publication-type="other">Grenander, U. &amp; Szegö, G. <italic>Toeplitz Forms and Their Applications</italic> (Univ. California Press, 1958).</mixed-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Trench, W. F. Spectral decomposition of Kac-Murdock-Szego matrices <ext-link ext-link-type="uri" xlink:href="https://works.bepress.com/william_trench/133/">https://works.bepress.com/william_trench/133/</ext-link> (2010).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Fogel, F., Jenatton, R., Bach, F. &amp; d’Aspremont, A. Convex relaxations for permutation problems. In <italic>Proc. 26th International Conference on Neural Information Processing Systems</italic> (eds Burges, C. J. C. et al.) 1016–1024 (Curran Associates Inc., 2013).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Wang, F., Li, P. &amp; Konig, A. C. Learning a bi-stochastic data similarity matrix. In <italic>Proc.</italic><italic>2010 IEEE International Conference on Data Mining</italic> 551–560 (IEEE, 2010).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Shamir, O. Convergence of stochastic gradient descent for PCA. In <italic>Proc. 33rd International Conference on Machine Learning</italic> (eds Balcan, M. F. &amp; Weinberger, K. Q.) 257–265 (PMLR, 2016).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Zhang, L., Yang, T., Yi, J., Jin, R. &amp; Zhou, Z.-H. Stochastic optimization for kernel PCA. In <italic>Proc.</italic><italic>Thirtieth AAAI Conference on Artificial Intelligence</italic> 2316–2322 (AAAI Press, 2016).</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Daneshmand, H., Kohler, J., Lucchi, A. &amp; Hofmann, T. Escaping saddles with stochastic gradients. In <italic>Proc. 35th International Conference on Machine Learning</italic> (eds Dy, J. &amp; Krause, A.) 1155–1164 (PMLR, 2018).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Palla</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>171</fpage>
        <lpage>178</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id>
        <?supplied-pmid 35102346?>
        <pub-id pub-id-type="pmid">35102346</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Scanpy: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <?supplied-pmid 29409532?>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Biotechnol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Biotechnol</journal-id>
    <journal-title-group>
      <journal-title>Nature Biotechnology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1087-0156</issn>
    <issn pub-type="epub">1546-1696</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10635821</article-id>
    <article-id pub-id-type="pmid">36849830</article-id>
    <article-id pub-id-type="publisher-id">1663</article-id>
    <article-id pub-id-type="doi">10.1038/s41587-023-01663-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scPrisma infers, filters and enhances topological signals in single-cell data using spectral template matching</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8398-6025</contrib-id>
        <name>
          <surname>Karin</surname>
          <given-names>Jonathan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bornfeld</surname>
          <given-names>Yonathan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0074-9196</contrib-id>
        <name>
          <surname>Nitzan</surname>
          <given-names>Mor</given-names>
        </name>
        <address>
          <email>mor.nitzan@mail.huji.ac.il</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>School of Computer Science and Engineering, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>Racah Institute of Physics, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>Faculty of Medicine, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2023</year>
    </pub-date>
    <volume>41</volume>
    <issue>11</issue>
    <fpage>1645</fpage>
    <lpage>1654</lpage>
    <history>
      <date date-type="received">
        <day>7</day>
        <month>4</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>6</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Single-cell RNA sequencing has been instrumental in uncovering cellular spatiotemporal context. This task is challenging as cells simultaneously encode multiple, potentially cross-interfering, biological signals. Here we propose scPrisma, a spectral computational method that uses topological priors to decouple, enhance and filter different classes of biological processes in single-cell data, such as periodic and linear signals. We apply scPrisma to the analysis of the cell cycle in HeLa cells, circadian rhythm and spatial zonation in liver lobules, diurnal cycle in <italic>Chlamydomonas</italic> and circadian rhythm in the suprachiasmatic nucleus in the brain. scPrisma can be used to distinguish mixed cellular populations by specific characteristics such as cell type and uncover regulatory networks and cell–cell interactions specific to predefined biological signals, such as the circadian rhythm. We show scPrisma’s flexibility in incorporating prior knowledge, inference of topologically informative genes and generalization to additional diverse templates and systems. scPrisma can be used as a stand-alone workflow for signal analysis and as a prior step for downstream single-cell analysis.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">scPrisma deconvolutes different biological processes in single-cell RNA-sequencing data.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational models</kwd>
      <kwd>Data processing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100005155</institution-id>
            <institution>Azrieli Foundation</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100003977</institution-id>
            <institution>Israel Science Foundation (ISF)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>1079/21</award-id>
        <principal-award-recipient>
          <name>
            <surname>Nitzan</surname>
            <given-names>Mor</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature America, Inc. 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Main</title>
    <p id="Par3">In recent years, progress in single-cell RNA sequencing (scRNA-seq) that contains information about the gene expression profiles of the multitude of cells across tissues has led to substantial improvement in our understanding of a variety of intracellular and intercellular processes<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. Recent computational advances have pushed forward the interpretation of these data to extract information about the heterogeneity of cell types and states and their collective structure and behavior, including spatial context<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>, gene regulatory patterns<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, cell type<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> and temporal processes such as lineage<sup><xref ref-type="bibr" rid="CR5">5</xref></sup> and cell cycle<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. Because scRNA-seq data contain multiple biological signals, it can be challenging to uncover a particular underlying signal and in many cases, prior information about the signal in question is needed<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>. Recently, we have shown how topological priors about the hierarchical structure of lineage and differentiation in single-cell data can be leveraged for their identification using spectral approaches, as they exhibit power-law signatures in the covariance eigenvalue distribution<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. Relying on such global topological features can provide a more robust and generalizable approach than relying on specific features such as marker genes<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>, as these are many times unique to different biological systems and processes and can be challenging to infer for new systems. Here we show how topological priors can be used beyond signal identification. We use priors about the periodicity and linearity of diverse biological processes and later generalize to additional topologies, to either enhance or filter them out from single-cell data using a spectral projection approach.</p>
    <p id="Par4">Biological processes that are inherently periodic are abundant and have important roles in diverse contexts, such as the cell cycle and circadian rhythm. Multiple computational methods aim to infer periodic signals from single-cell data, with a particular focus to extract information related to the cell cycle or to remove its effect<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref></sup>. However, the majority of these methods are heavily based on the cell cycle marker gene information, including ccRemover<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> and reCAT<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, which makes them difficult to generalize across systems and across periodic signals beyond the cell cycle. On the contrary, Cyclum<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, which does not rely on marker genes, is an auto-encoder-based approach that optimizes a circular embedding for single-cell data to infer and remove cell cycle effects. However, fitting the data to a one-dimensional circle does not generally capture the variability of cyclic biological processes and lacks flexibility as it cannot easily incorporate additional prior knowledge, such as low-resolution temporal information, which may be necessary for weak cyclic signals.</p>
    <p id="Par5">Here we present scPrisma, a general spectral framework (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) for the reconstruction, enhancement and filtering of signals in single-cell data based on their topology and inference of topologically informative genes. We benchmark scPrisma and demonstrate its performance over simulated data and seven scRNA-seq datasets. Specifically, we show how the cell cycle can be revealed or filtered in a population of HeLa cells, how circadian rhythm and spatial zonation can be decoupled in liver lobules, how differences in <italic>Chlamydomonas</italic> that were grown in different environments can be emphasized by filtering their diurnal cycle signal, and how the signature of the circadian rhythm can be revealed in multiple cell types in the suprachiasmatic nucleus (SCN) in the brain, the master circadian pacemaker in mammals. In addition, we show how using scPrisma allows us to better distinguish distinct cellular subtypes of SCN neurons following temporal filtering, and uncover signal-related gene regulatory networks and cell–cell interactions following enhancement of the circadian rhythm signal. Finally, beyond cyclic and linear templates, scPrisma can be used to manipulate diverse template types, enhance the separation between clusters, identify multiple cyclic processes and enhance spatial signals in spatial transcriptomics. scPrisma is versatile and enables topological signal manipulation without low-dimensional embedding, which renders the results useful for diverse types of downstream analyses. Furthermore, it is flexible as it enables integration of diverse types of prior knowledge (such as low-resolution temporal ordering) but does not rely on it and can be used for de novo analyses.<fig id="Fig1"><label>Fig. 1</label><caption><title>General workflow of scPrisma.</title><p>Given single-cell data and a theoretical covariance matrix, for example, based on a topological model, we calculate its theoretical spectrum (1), order the cells along the topology (2) and either enhance the signal corresponding to that topology (3A, 4A) or filter it out from the data (3B).</p></caption><graphic xlink:href="41587_2023_1663_Fig1_HTML" id="d32e375"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Spectral template matching for scRNA-seq signal manipulation</title>
      <p id="Par6">We developed scPrisma, a spectral analysis framework that uses topological priors over underlying signals in single-cell data, to allow for their inference, enhancement and filtering. The core of scPrisma uses spectral template matching between the spectrum (the eigendecomposition of the covariance matrix) of a set of single-cell data (for example, scRNA-seq) and the expected analytical spectrum of a structure or process we aim to enhance or filter. To analyze a theoretical covariance spectrum (by analyzing its eigenvalues and eigenvectors), we need a reference model. Focusing first on cyclic signals, we propose a simple toy model of periodic biological signals (<xref rid="Sec10" ref-type="sec">Methods</xref>). The covariance matrix of the gene expression matrix of this model is a circulant matrix of a special form that depends on the model parameters (<xref rid="Sec10" ref-type="sec">Methods</xref>). Circulant matrices have closed-form formula for their eigenvectors and eigenvalues<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> (Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig1" ref-type="fig">1</xref>), which we used to estimate the ordering of cells along the cyclic topology. This was done by optimizing for a permutation matrix that maximizes the projection of the data over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig2" ref-type="fig">2</xref>). As input for the remainder of scPrisma’s workflow, cellular ordering can also be informed by prior knowledge of low-resolution pseudotime. Based on the reconstructed ordering, scPrisma infers topologically informative genes, as the set of genes that maximizes the projection over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig3" ref-type="fig">3A</xref>). scPrisma can then enhance (filter) the signal related to the cyclic process by filtering out gene expression entries that do not maximize (minimize) the projection over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig4" ref-type="fig">4A</xref> and <xref rid="Fig1" ref-type="fig">3B</xref>). scPrisma can successfully reconstruct, filter and enhance periodic signals in simulated single-cell data (Supplementary Note <xref rid="MOESM1" ref-type="media">A.1</xref>, Extended Data Fig. <xref rid="Fig6" ref-type="fig">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">1)</xref>.</p>
    </sec>
    <sec id="Sec4">
      <title>scPrisma manipulates the cell cycle signal in HeLa cells</title>
      <p id="Par7">We first tested our approach on a scRNA-seq dataset of HeLa cells, unsynchronized across the cell cycle<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). To assess the results, we used a list of approximately 400 genes, classified according to cell cycle phases<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, where for each phase, the corresponding genes were summed and normalized and their circular mean and variance were calculated<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>. For an ordered reconstructed signal, the ordering of the circular means should correspond to the cell cycle phases and the circular variance should be less than 1, while for randomly ordered data, the circular variance is expected to be close to 1 (corresponding to a uniform signal along the cycle). Following standard preprocessing of the HeLa single-cell data (<xref rid="Sec10" ref-type="sec">Methods</xref>; Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>, the distributions of all phases were found to be nearly uniform (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.991). However, after cyclic ordering by scPrisma (<xref rid="Sec10" ref-type="sec">Methods</xref>), different phases of the cell cycle became clearly separated (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.849) and peaked progressively according to the correct phase ordering.<fig id="Fig2"><label>Fig. 2</label><caption><title>scPrisma manipulates the cell cycle signal in HeLa cells.</title><p><bold>a</bold>, PCA representation of 683 cells in the unordered and ordered raw gene expression data, and data following spectral cyclic enhancement and filtering. The cells are colored according to the corresponding rows in the gene expression matrix. <bold>b</bold>, Smoothed polar plot of the normalized sum of the gene sets corresponding to different cell cycle phases<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. The circular mean of each phase is marked by a correspondingly colored star. <bold>c</bold>,<bold>d</bold>, Expression of <italic>CDC20</italic> (which peaks in the M phase<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>) and <italic>RRM2</italic> (which peaks in the S phase<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>) as a function of cellular location in the gene expression matrix. <bold>e</bold>, PCA representation of cells along iterations of the cyclic enhancement algorithm. <bold>f</bold>, Violin plot of AUC scores for <italic>n</italic> = 50 experiments of sampling random gene subsets and inference of cyclic genes by scPrisma based on unordered, ordered, enhanced and filtered data. White dots mark the median, gray bars mark the interquartile range and thin gray lines mark the rest of the distribution, except for outliers.</p></caption><graphic xlink:href="41587_2023_1663_Fig2_HTML" id="d32e530"/></fig></p>
      <p id="Par8">To further enhance the cell cycle signal in the data, we employed scPrisma’s cyclic enhancement algorithm. Iterations of our algorithm gradually revealed a cyclic signal, which was apparent after filtering less than 7% of the total signal and was clearly revealed after removing 22% of the total signal (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>). In addition, the reconstructed angular ordering was correlated with the cell cycle phases and the circular variance of phase-corresponding marker genes decreased substantially (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.666). Further, genes associated with different cell cycle phases peaked progressively in their expected order (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig2" ref-type="fig">2c,d</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">2)</xref>.</p>
      <p id="Par9">Next, we approached the reverse challenge: to filter out the cell cycle signal from the HeLa cells data. After applying scPrisma’s cyclic filtering algorithm to the ordered data, the separation between different cell cycle phases and their corresponding progressive peaks was lost (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.989).</p>
      <p id="Par10">Finally, we identified genes related to the cell cycle using the genes inference algorithm (<xref rid="Sec10" ref-type="sec">Methods</xref>; Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>. When using as input both randomly selected subsets of cell cycle-related genes<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> and subsets of genes unrelated to the cell cycle, we found a substantial improvement in our ability to identify cell cycle-related genes after reordering the cells (mean AUC = 0.804) relative to the original data (mean AUC = 0.295). Moreover, relative to the ordered data, identifying cell cycle-related genes was further improved following spectral cyclic enhancement (AUC mean 0.838, outperforming available baselines; Supplementary Fig. <xref rid="MOESM1" ref-type="media">2)</xref> and was diminished following cyclic filtering (mean AUC 0.183; Fig. <xref rid="Fig2" ref-type="fig">2f</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>scPrisma disentangles spatiotemporal signals in the liver</title>
      <p id="Par11">We next dissected spatiotemporal signals via a scRNA-seq dataset which captures gene expression variation of hepatocytes in the mammalian liver across both space (spatial zonation across the periportal to pericentral axis) and time (temporal variation across the circadian rhythm)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. Similarly to the cell cycle, the circadian rhythm was also expected to exhibit a cyclic structure in gene expression space. Here we used experimental prior knowledge in the form of low-resolution sampling time<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> to order the cells in a cycle. In this setting, we still missed information about temporally informative genes, and spatiotemporal information was still entangled (for example, <italic>Pck1</italic> varied informatively across both space and time of day<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>). We leveraged scPrisma to disentangle these data and showed clear enhancement and filtering of the circadian rhythm, relative to raw data (<italic>K</italic> = 4 Adjusted Rand Score (ARI) of <italic>K</italic>Means = 0.96; 0.013; 0.11, respectively; Fig. <xref rid="Fig3" ref-type="fig">3a,e</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3A</xref>; <xref rid="Sec10" ref-type="sec">Methods</xref>). scPrisma outperformed available baselines for filtering the circadian rhythm (Supplementary Note <xref rid="MOESM1" ref-type="media">A.5)</xref>. These results were reflected in the behavior of individual genes; <italic>Pck1</italic> is a rhythmic gene that was highly expressed at ZT06 and ZT12 (ref. <sup><xref ref-type="bibr" rid="CR15">15</xref></sup>), and indeed, following spectral cyclic enhancement, its resulting expression in ZT00 and ZT18 was diminished, while cyclic filtering resulted in a nearly constant temporal expression of <italic>Pck1</italic> (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). Spatially, <italic>Pck1</italic> is periportally zonated, and indeed, spectral cyclic enhancement flattens its spatial expression, while cyclic filtering retains its spatial variation (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). Similar behavior can be observed for additional spatiotemporally informative genes (Fig. <xref rid="Fig3" ref-type="fig">3d</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">4)</xref>.<fig id="Fig3"><label>Fig. 3</label><caption><title>Disentanglement of spatial and temporal signals in liver lobules.</title><p><bold>a</bold>,<bold>b</bold>, PCA representation of raw single-cell data of 4,000 cells (1,000 from each time point), and following spectral cyclic enhancement, cyclic filtering, linear enhancement and linear filtering. The cells are colored either according to their associated time points (ZT, sampled at four equally spaced time points along the circadian rhythm) (<bold>a</bold>), or by their respective spatial location (‘layer’, according to the zonation analysis done in <sup><xref ref-type="bibr" rid="CR15">15</xref></sup>) (<bold>b</bold>). <bold>c</bold>,<bold>d</bold>, Heatmaps of the expression of <italic>Pck1</italic> (<bold>c</bold>) and <italic>Oat</italic> (<bold>d</bold>) following scPrisma analysis as a function of the sampling time and zonation layer. <bold>e</bold>, ARI of <italic>K</italic>Means clustering with <italic>K</italic> = 4 (corresponding to four underlying time points) and <italic>K</italic> = 8 (corresponding to eight underlying zonation layers) after applying each of scPrisma’s spectral algorithms.</p></caption><graphic xlink:href="41587_2023_1663_Fig3_HTML" id="d32e694"/></fig></p>
      <p id="Par12">In a complementary manner, spectral analysis focusing on the characteristics of linear signals can be used to filter the spatial linear signal in the collective gene expression of hepatocytes (<xref rid="Sec10" ref-type="sec">Methods</xref>). Indeed, following spectral linear filtering by scPrisma, the cyclic circadian signal was clearly revealed (Fig. <xref rid="Fig3" ref-type="fig">3a</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3A)</xref> and the linear zonation signal was blurred out relative to the raw data (Fig. <xref rid="Fig3" ref-type="fig">3b</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3B,E</xref>; <italic>K</italic> = 8 ARI of <italic>K</italic>Means = 0.017; 0.11, respectively). Focusing again on <italic>Pck1</italic> expression, linear spectral enhancement retained only the expression around the portal vein and reduced the temporal variance, while linear filtering reduced the zonation variance and yet retained the temporal variance (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>).</p>
      <p id="Par13">Finally, we evaluated the dominant structure in the data following scPrisma analysis. As predicted, following spectral enhancement, the data clustered according to the enhanced signal, while following spectral filtering, the data clustered according to the unfiltered signal; for example, filtering the cyclic signal led to better identification and clustering of the spatial zonation signal (Fig. <xref rid="Fig3" ref-type="fig">3e</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>scPrisma manipulates the diurnal cycle in <italic>Chlamydomonas</italic></title>
      <p id="Par14">To demonstrate the use of scPrisma for more complex systems with diverse prior knowledge, we next turn our attention to scRNA-seq data collected for <italic>Chlamydomonas</italic> (green algae), grown under two contrasting conditions, iron replete (Fe<sup>+</sup>) and iron deficient (Fe<sup>−</sup>)<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. In both conditions, an expression signal that reflects the 24 h diurnal cycle was previously detected<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. To evaluate progression of cells along the diurnal cycle, we used marker genes corresponding to different cycle phases obtained from bulk RNA-sequencing<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.6)</xref>. Using scPrisma’s cyclic enhancement resulted in robust reconstruction of the diurnal cycle for each of the two conditions. This was done by splitting the 24-h cycle into six phases and validating that they are well separated following reconstruction and enhancement (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig4" ref-type="fig">4a</xref> for Fe<sup>+</sup> condition and Supplementary Fig. <xref rid="MOESM1" ref-type="media">5A</xref> for Fe<sup>−</sup> condition). Further, concatenating the enhanced cyclic signal of both experiments resulted in a reconstructed synchronized diurnal cycle (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5B)</xref>. We next focused on enhancing the biological differences between the Fe<sup>−</sup> and Fe<sup>+</sup> conditions by spectrally filtering their shared diurnal cycle (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). As expected, cyclic filtering increased the differences between the clusters of Fe<sup>−</sup> and Fe<sup>+</sup> associated cells (Silhouette score before/after filtering = 0.088/0.136, Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). scPrisma outperformed state-of-the-art cyclic filtering methods, including ccRemover<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and Cyclum<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> (Silhouette scores = 9.815 × 10<sup>-6</sup>, 9.868 × 10<sup>-4</sup> and 0.052, respectively; Supplementary Note <xref rid="MOESM1" ref-type="media">A.8</xref> and Fig. <xref rid="Fig4" ref-type="fig">4b</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>scPrisma detects and filters the diurnal cycle in <italic>Chlamydomonas</italic>.</title><p><bold>a</bold>, PCA representation of 3,000 cells in spectrally enhanced cyclic signal of the Fe<sup>+</sup> experiment<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. Each plot represents 1/6 of the 24 h cycle. The cells are colored according to the normalized sum of the marker genes associated with each phase<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. <bold>b</bold>, PCA representation of 6,000 cells (3,000 of each condition) in Fe<sup>+</sup> (blue) and Fe<sup>−</sup> (orange) conditions of raw gene expression data, data following scPrisma’s cyclic filtering (Silhouette score before/after filtering = 0.088/0.136, Calinski and Harabasz score before/after filtering = 600.802/1000.44) and enhancement, and data following filtering by Cyclum (Silhouette score = 0.052, Calinski and Harabasz score = 337.629), Seurat (Silhouette score = 9.868 × 10<sup>−</sup><sup>4</sup>, Calinski and Harabasz score = 1.29 × 10<sup>−</sup><sup>10</sup>) and ccRemover (Silhouette score = 9.815 × 10<sup>−</sup><sup>6</sup>, Calinski and Harabasz score = 6.25 × 10<sup>−</sup><sup>13</sup>).</p></caption><graphic xlink:href="41587_2023_1663_Fig4_HTML" id="d32e882"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>scPrisma extracts SCN cell-type-specific temporal signals</title>
      <p id="Par15">We next focus on scRNA-seq data collected for mice SCN, the mammalian brain’s circadian pacemaker<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. In this experiment, cells were sampled at 12 time points along two days. Again, we leveraged the cyclic nature of the circadian rhythm and explicitly used the prior knowledge regarding the experimental sampling times (instead of running the reconstruction algorithm). We first clustered the cells using the Louvain algorithm and mapped individual clusters to cell types using established marker genes<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">6)</xref>. scPrisma’s cyclic enhancement over each cell type separately revealed a cyclic signal associated with the circadian rhythm for 5/8 of cell types (Fig. <xref rid="Fig5" ref-type="fig">5</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>; <xref rid="Sec10" ref-type="sec">Methods</xref>). The three cell types that did not expose a clear cyclic signal (NG2, microglia and tanycytes) exhibit the lowest fraction of rhytmic gene expression<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. Moreover, we measured the separation of cells that were sampled at different time points, before and after cyclic filtering/enhancement using the Calinski and Harabasz score<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Overall, as expected, separation increased substantially following cyclic enhancement and decreased following cyclic filtering, which, as above, is least substantial for the three cell types exhibiting the lowest fraction of rhythmic genes (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). It can be observed that the cellular density varies with the rhythmic process and is correlated with the peak of temporal expression of rhythmic genes (Fig. <xref rid="Fig5" ref-type="fig">5a,b</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">A.7)</xref>. Focusing on gene expression, we found that spectral cyclic enhancement diminishes the expression of cell-type marker genes and retains the expression of rhythmic genes (core clock genes and protein folding genes, as characterized in ref. <sup><xref ref-type="bibr" rid="CR18">18</xref></sup>; Fig. <xref rid="Fig5" ref-type="fig">5c</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7)</xref>. Conversely, following cyclic filtering, cell-type marker gene expression was retained, while the resulting temporal expression of rhythmic and protein folding-related genes flattened (Fig. <xref rid="Fig5" ref-type="fig">5c</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7)</xref>.<fig id="Fig5"><label>Fig. 5</label><caption><title>scPrisma extracts cell-type specific circadian rhythm signals in the SCN.</title><p><bold>a</bold>, PCA representation of cells in raw SCN gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> and data following cyclic enhancement by scPrisma, colored according to CT, for several cell types: ependymal, SCN neurons, oligodendrocytes and astrocytes. <bold>b</bold>, PCA representation of ependymal cells colored by <italic>Tef</italic> expression and mean <italic>Tef</italic> expression as a function of circadian time, for raw data (top), data following scPrisma’s cyclic enhancement (middle) and filtering (bottom). <bold>c</bold>, Heatmaps of ependymal expression of (from left to right) cell-type marker genes, rhythmic genes and protein folding genes, for raw data (left) and data following scPrisma’s cyclic enhancement (middle) and filtering (right). <bold>d</bold>, Calinski and Harabasz score for cells sampled at different CT for raw data, and data following scPrisma’s cyclic enhancement and filtering. Cell types with low fraction of circadian genes<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> exhibit lower scores. <bold>e</bold>, Pre- and post-filtering gene expression dotplots of the marker genes of SCN neurons (before filtering, clusters 1, 3 and 4 contain mixtures of two different subtypes), and pre- and post-filtering heatmaps showing the contribution of cells sampled at different CT to each neuronal cluster. <bold>f</bold>, Regulatory network structure of core clock genes<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. <bold>g</bold>, Pre- and post-enhancement sum of scores of all regulatory interactions of the core clock network shown in <bold>f</bold>, scored by GRNBoost2, for each SCN cell type. <bold>h</bold>, Pre- and post-enhancement mean <italic>Rorc</italic>, <italic>Ahsa2</italic> and <italic>Hsp90ab1</italic> expression as a function of CT. Following cyclic enhancement, regulatory interactions between the transcription factor <italic>Rorc</italic> and <italic>Ahsa2</italic>, <italic>Hsp90ab1</italic> were uncovered. <bold>i</bold>, Mean <italic>Avp</italic> and <italic>Plau</italic> expression as a function of CT. Following cyclic enhancement, cell–cell interactions between astrocytes and microglia cell types, mediated by <italic>Avp</italic> and <italic>Plau</italic>, were revealed.</p></caption><graphic xlink:href="41587_2023_1663_Fig5_HTML" id="d32e1038"/></fig></p>
      <p id="Par16">scPrisma further enhanced cell-type classification, inference of gene regulatory interactions related to the circadian rhythm and underlying cell–cell interactions. When aiming to characterize cells by their type, additional biological signals can interfere with that task as similarity between cells can arise due to multiple factors. For example, direct clustering of cells according to their gene expression profiles may capture similarities according to the circadian rhythm phase and not their type, which can substantially hinder our ability to distinguish different cell types. Clustering the neurons yielded 14 distinct clusters, three of which can be identified using either established marker genes or previous subtype classification<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> as containing mixture of neurons from both SCN neuronal subtypes N0 and N2 (clusters 1, 3, 4; Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Fig. <xref rid="Fig5" ref-type="fig">5e</xref>). We found that the circadian rhythm signal interferes with the proper classification of cell subtypes in this case, supported by the observation that in clusters 1 and 3 the majority of cells (79% and 66%, respectively) were sampled at circadian time points (CT) = 14/18/22, while in cluster 4, 93% of cells were sampled at CT 02/06/10, which suggests that the clustering of cells in this subpopulation is dominated by their distinct temporal signatures and not their types (Fig. <xref rid="Fig5" ref-type="fig">5e</xref> and Extended Data Fig. <xref rid="Fig7" ref-type="fig">2</xref>). We were able to overcome the cell-type misclassification by spectrally filtering the circadian rhythm signal using scPrisma, after which, the clustering algorithm yielded a unique cluster for each of the two neuronal subtypes, N0 and N2 (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>). Moreover, as expected, the distribution over CT within each cluster flattened following cyclic filtering (Fig. <xref rid="Fig5" ref-type="fig">5e</xref> and Extended Data Fig. <xref rid="Fig7" ref-type="fig">2</xref>; mean circular variance increased from 0.781 to 0.863 following filtering).</p>
      <p id="Par17">Mixed biological signals in single-cell data can also interfere with the inference of gene regulatory networks. Therefore, we used scPrisma to highlight a set of regulatory interactions related to the circadian rhythm that were difficult to identify in the original data. Specifically, we expected that regulatory interactions that can be revealed following cyclic enhancement would be enriched with interactions associated with the cyclic circadian process. Indeed, regulatory interactions between core clock genes, as inferred using the gene regulatory network inference algorithm GRNBoost2 (ref. <sup><xref ref-type="bibr" rid="CR20">20</xref></sup>), are more highly correlated to the established core clock interaction network<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> (Fig. <xref rid="Fig5" ref-type="fig">5f</xref>) in the cyclically enhanced single-cell data, relative to the raw data, for 7/8 of the cell types (Fig. <xref rid="Fig5" ref-type="fig">5g</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">A.7)</xref>. Going beyond the core clock interaction network, using a list of known mice transcription factors<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, we searched for inferred interactions (based on GRNBoost2) which are substantially enhanced following scPrisma cyclic analysis (<xref rid="Sec10" ref-type="sec">Methods</xref>), where the regulator is a core clock transcription factor (<italic>Nr1d1</italic>, <italic>Nr1d2</italic>, <italic>Rora</italic>, <italic>Rorb</italic>, <italic>Rorc</italic>, <italic>Dbp</italic>, <italic>Tef</italic><sup><xref ref-type="bibr" rid="CR23">23</xref></sup>; a full list of inferred interactions is available in Supplementary Table <xref rid="MOESM3" ref-type="media">1)</xref>. For example, focusing on genes inferred to be highly regulated by <italic>Rorc</italic> in ependymal cells following spectral enhancement, we found that the genes that received the highest score were <italic>Ahsa2</italic> (0 to 6.341), <italic>Kif21a</italic> (0 to 6.231), <italic>Hsp90ab1</italic> (0.070 to 5.731) and <italic>Mt1</italic> (0 to 5.002) and the peaks of these genes along the circadian rhythm overlapped with the peak of <italic>Rorc</italic>, following spectral enhancement (Fig. <xref rid="Fig5" ref-type="fig">5h</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7E)</xref>. These results are consistent with previous results showing the existence of a regulatory interaction between <italic>Rorc</italic> and <italic>Hsp90ab1</italic> which is dependent on the time of day<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>.</p>
      <p id="Par18">Finally, we used scPrisma to infer hidden cell–cell interactions related to the circadian rhythm. We compared cell–cell communication patterns, using CellPhoneDB<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>, between different cell types at corresponding time points. Similarly to the regulatory network inference described above, we were able to recover interactions that were substantially enhanced following scPrisma’s cyclic analysis (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig5" ref-type="fig">5I</xref>, Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Supplementary Table <xref rid="MOESM4" ref-type="media">2)</xref>.</p>
    </sec>
    <sec id="Sec8">
      <title>Generalized template matching by scPrisma</title>
      <p id="Par19">Beyond cyclic and linear topologies, scPrisma can be used to manipulate a variety of different, complex topological signals in single-cell data. This is possible because scPrisma can use the numerical spectrum of a given covariance matrix, instead of the analytical spectrum, as was the case for the cyclic and linear topologies. We demonstrated the diversity of scPrisma on three additional types of templates as follows: (1) Clusters—we constructed a cluster-based template to enhance the separation, or maximize the variation in gene expression, between different cellular clusters and states (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>, specifically between cellular states of hepatocytes during day and night time (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3A</xref>). Further, this topology can be used for data integration via the spectral filtering workflow, as we demonstrated for human pancreas scRNA-seq data which were collected from four different studies<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>, labeled and preprocessed as given in ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. scPrisma can filter batch effects in this case, demonstrated visually (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3D,E</xref>) and quantitatively, as following cluster-based filtering, the Calinski and Harabasz score between the different batches drops from 298.63 to 3.80 and the score between the annotated cell types rises from 90.97 to 107.48. scPrisma’s results for batch correction are competitive or outperform state-of-the-art tailored methods for this task (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. (2) Multiple cycling processes—scPrisma can reconstruct multiple cycling processes across SCN cell types both for a synchronized case (Extended Data Fig. <xref rid="Fig9" ref-type="fig">4</xref>) and an un-synchronized case (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Extended Data Fig. <xref rid="Fig10" ref-type="fig">5</xref>). In the latter, more challenging case, circadian core clock genes are out-of-phase in the SCN neurons versus multiple other cell types<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. scPrisma can enhance every periodic signal separately by designing a covariance matrix that is block circulant (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. Furthermore, scPrisma can be used for the general, iterative inference of cyclic processes, although this task is more challenging and scPrisma is not optimized for it. As an example, we used human embryonic stem cells (hESC) single-cell dataset<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. We showed that scPrisma can be used (de novo, without prior knowledge on marker genes) to first infer a cyclic process corresponding to the cell cycle and then filter it out and use the filtered data to reconstruct a second cyclic process corresponding to an oscillatory pattern related to the experimental setup (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">8)</xref>. The encoding of both oscillatory processes by the hESC population is consistent with previous findings of ref. <sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. (3) Two-dimensional (2D) tissue organization—last, we enhanced the spatial signal in a spatially informed (Slide-seqV2) 2D dataset of the mouse hippocampus<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. We computed the shortest path matrix (calculated based on the spatial k-nearest neighbor graph over the data) and transformed it into an affinity matrix using a heat kernel (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. In this case, the affinity matrix is used by scPrisma as the covariance matrix of the spatial signal. scPrisma enables flexible manipulation of the spatial signal, which we leveraged to extract, and then either enhance or filter the spatial signal in the data by applying the enhancement algorithm based on numerical eigendecompositions of the affinity matrix (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Extended Data Fig. <xref rid="Fig11" ref-type="fig">6</xref>).</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par20">In this study, we developed scPrisma, a spectral analysis workflow based on topological priors for reconstruction, informative genes inference, signal filtering and enhancement. While we focus on periodic signals (cell cycle in HeLa cells, diurnal cycle in <italic>Chlamydomonas</italic> and circadian rhythm in the SCN), we also demonstrate it for convoluted spatial and cyclic signals (spatial zonation and circadian rhythm in liver lobules) and a diversity of additional signals and topologies, such as clusters, multiple cycling processes and 2D spatial templates.</p>
    <p id="Par21">scPrisma presents three major contributions as follows: First, it embodies a full workflow for analyzing underlying topological signals based on an approach that can be performed either de novo or enhanced using prior knowledge (for example, low-resolution pseudotime or marker gene information). This flexibility allows scPrisma to uncover topological signals of varying strengths. Second, scPrisma enables both signal enhancement and filtering without embedding to lower dimensions, which makes it useful as a prior step for existing downstream analyses, such as inferring gene regulation networks and cell–cell interactions. This can accelerate biological discovery, as we exemplify for SCN neurons, by revealing gene regulation patterns and cell–cell interactions that are associated with a specific biological process such as the circadian rhythm. Third, the enhancement algorithm does not overfit to a circular topology, by applying the genes inference task before enhancement (thus retaining only genes related to the desired signal), controlling the level of filtering by regularization and restricting the range of entries in the filtering matrix. Future work can leverage scPrisma’s flexibility and robustness to optimize it to diverse tasks that arise in the context of single-cell and spatial omics analysis, such as generalized spatial analysis, data integration and iterative manipulation of signals, which is a promising, yet challenging, direction for future work.</p>
    <p id="Par22">A computational challenge arises due to the nonconvexity and runtime complexity of the reconstruction task (Extended Data Fig. <xref rid="Fig12" ref-type="fig">7</xref>). This optimization challenge is relieved for cyclic signals, as the theoretical analysis of the eigenvectors does not depend on the specific values of the matrix but only on its circulant property. Moreover, the multiple solutions for the cyclic reconstruction task (every circular shift of a solution is a valid solution) ease the convergence to a feasible solution. In addition, the reconstruction step can be done either by scPrisma or by other pseudotime trajectory reconstruction algorithms. Another challenge is applying scPrisma when it is not clear whether a signal corresponding to the template exists or is strong enough to be detected in the data. This challenge is alleviated due to several reasons. First, we reason and provide empirical support on both synthetic and real single-cell data that scPrisma avoids overfitting to input template topologies. Therefore, in general, scPrisma does not converge to a topology that is not a reflection of a strong-enough signal in the data, as is demonstrated for the SCN, where the algorithm is limited in its convergence over cell types with weak periodic signal. Second, evaluating results obtained by scPrisma can be done by comparison to partial prior knowledge, such as marker genes known to be related (or unrelated) to recovered biological signals, low-resolution sampling times of cells relative to temporal signals, or by interpreting gene ontology enrichment analysis following signal manipulation. Additionally, we suggest a measure for the quality of convergence of scPrisma, the projection proportion score, and while it can be useful for exploring analysis options, it is not associated with a single threshold that can distinguish successful convergence, as it is affected by the signal and data characteristics (Supplementary Note <xref rid="MOESM1" ref-type="media">A.12</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">9)</xref>.</p>
    <p id="Par23">While in this work we focused on periodic signals, which can be analyzed analytically, scPrisma can also be applied using a numerical eigendecomposition of a covariance matrix that is either inferred from the data or constructed numerically based on a topological model. We anticipate that scPrisma will accelerate single-cell-based research by enhancing target signals of interest and enabling their identification and analysis and providing a general workflow for single-cell signal disentanglement in diverse biological contexts.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Spectral analysis of cyclic signals</title>
      <p id="Par24">For theoretical analysis, we constructed three simple models for the cyclic signals. In the first model, illustrated in Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>, we receive as input the number of cellular variations (<italic>q</italic>), the numbers of genes (<italic>p</italic>) and the number of changes between neighboring cells (<italic>k</italic>). We start with a root cell whose expression profile is a binary vector with <italic>p</italic> entries ({1, 0}<sup><italic>p</italic></sup>). Each gene is approximated to be either expressed (ON,1) or not expressed (OFF,0). Then, the next cell in the cycle is generated by duplicating the existing cell, choosing uniformly <italic>k</italic> genes and switching their state. This process is repeated <italic>q</italic> times. Then, within the last generated cell, <italic>k</italic> genes whose state differs from the root cell are chosen at random, their state is switched and the cell is duplicated. This process is then continued until the gene expression of the newest cell is identical to the root cell. For the analysis of the covariance matrix of the model, we will use a similar Markovian assumption to the assumption that was used in refs. <sup><xref ref-type="bibr" rid="CR8">8</xref>,<xref ref-type="bibr" rid="CR34">34</xref></sup>; the covariance between the expression profiles of two cells, separated by <italic>m</italic> state changes, where <italic>m</italic> is the minimum distance between the cells clockwise and counterclockwise (undirected cyclostationary assumption), is given by <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha (m)=E[X(m)X(0)]=\exp (-2mk/p),$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mo>/</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq1.gif"/></alternatives></inline-formula> where 0 ≤ <italic>m</italic> ≤ <italic>n</italic>/2, <italic>p</italic> is the number of genes and <italic>k</italic> is the number of changes between neighboring cells. More information about the model and the estimation of <italic>α</italic> from real data is described in Supplementary Note <xref rid="MOESM1" ref-type="media">A.11</xref>. According to this assumption, the expected covariance matrix of the gene expression matrix is circulant:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{n}E[X{X}^{\top }]=\left(\begin{array}{llllll}1&amp;\alpha &amp;{\alpha }^{2}&amp;\ldots &amp;{\alpha }^{2}&amp;\alpha \\ \alpha &amp;1&amp;\alpha &amp;\ldots &amp;{\alpha }^{3}&amp;{\alpha }^{2}\\ \vdots &amp;\vdots &amp;\vdots &amp;\ldots &amp;\vdots &amp;\vdots \\ {\alpha }^{2}&amp;{\alpha }^{3}&amp;{\alpha }^{4}&amp;\ldots &amp;1&amp;\alpha \\ \alpha &amp;{\alpha }^{2}&amp;{\alpha }^{3}&amp;\ldots &amp;\alpha &amp;1\end{array}\right)$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <italic>n</italic> is the number of cells. The first column (<inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\overrightarrow{c}$$\end{document}</tex-math><mml:math id="M6"><mml:mover accent="true"><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq2.gif"/></alternatives></inline-formula>) of a circulant matrix specifies the entire matrix. The (<italic>k</italic>, <italic>j</italic>) entry of a general circulant matrix <italic>C</italic> is given by <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k,j}={\overrightarrow{c}}_{(j-k) \% n}$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>%</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq3.gif"/></alternatives></inline-formula><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. The spectrum of a circulant matrix has analytical closed formula<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. Specifically, the eigenvalues are the discrete Fourier transform of the first row, and the eigenvectors are the normalized Fourier modes. Because a covariance matrix is symmetric and positive semidefinite, all its eigenvalues are real. Therefore, the eigenvalues are the discrete cosine transform of the first row<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\lambda }_{i}=\mathop{\sum }\limits_{j=0}^{n/2-1}{{\alpha }\,^{j}}_{i}* \cos \left(\frac{2\pi ji}{n}\right)\,+\,\mathop{\sum }\limits_{j=n/2}^{n-1}{{\alpha }\,^{j}}_{n-i}* \cos \left(\frac{2\pi ji}{n}\right)$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>α</mml:mi><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mspace width="0.25em"/><mml:mo>+</mml:mo><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>α</mml:mi><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par25">The <italic>s</italic>th entry of the <italic>i</italic>th eigenvector corresponding to the <italic>i</italic>th eigenvalue is<sup><xref ref-type="bibr" rid="CR35">35</xref></sup><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}=\sqrt{\frac{2}{n}}* \cos \left(\frac{2\pi is}{n}-\frac{\pi }{4}\right)$$\end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>To test our approach, we defined two additional models, described in Supplementary Note <xref rid="MOESM1" ref-type="media">A.2</xref>, which we used in the simulated data section (Supplementary Note <xref rid="MOESM1" ref-type="media">A.1)</xref>.</p>
    </sec>
    <sec id="Sec12">
      <title>Spectral analysis of linear signals</title>
      <p id="Par26">Similarly to the analysis of cyclic signals, we first construct a simple model for linear signals. We follow a similar linear model to the one that was presented in ref. <sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. The model receives the same input as the cyclic model, and each cell is represented by a binary vector {1, 0}<sup><italic>p</italic></sup>. We start from a root cell, and then over <italic>n</italic> iterations, a new cell is created in the linear chain by changing the state of <italic>k</italic> randomly chosen genes relative to the previous cell in the chain. As in the cyclic model, we assume that the covariance between the gene expression profiles of two cells, separated by <italic>m</italic> state changes, is given by <inline-formula id="IEq4"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha (m)=E[X(m)X(0)]=\exp (-2m/p)$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>m</mml:mi><mml:mo>/</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq4.gif"/></alternatives></inline-formula>. Thus, the expected covariance matrix of the gene expression matrix is<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{n}E[X{X}^{\top }]=\left(\begin{array}{llllll}1&amp;\alpha &amp;{\alpha }^{2}&amp;\ldots &amp;{\alpha }^{n-2}&amp;{\alpha }^{n-1}\\ \alpha &amp;1&amp;\alpha &amp;\ldots &amp;{\alpha }^{n-3}&amp;{\alpha }^{n-2}\\ \vdots &amp;\vdots &amp;\vdots &amp;\ldots &amp;\vdots &amp;\vdots \\ {\alpha }^{n-2}&amp;{\alpha }^{n-3}&amp;{\alpha }^{n-4}&amp;\ldots &amp;1&amp;\alpha \\ {\alpha }^{n-1}&amp;{\alpha }^{n-2}&amp;{\alpha }^{n-3}&amp;\ldots &amp;\alpha &amp;1\end{array}\right)$$\end{document}</tex-math><mml:math id="M16"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par27">This matrix is a special case of a Toeplitz matrix and is particularly known as Kac–Murdock–Szego matrix<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. The eigenvalues of such a Kac–Murdock–Szego matrix can be approximated as ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\lambda }_{i}=\frac{1-{\alpha }^{2}}{1+{\alpha }^{2}-2{\mathrm{cos}}\left(\frac{\left(i+1\right)\pi }{n+1}\right)\alpha }$$\end{document}</tex-math><mml:math id="M18"><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi mathvariant="normal">cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mi>α</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par28">The corresponding eigenvectors can either be estimated analytically<sup><xref ref-type="bibr" rid="CR38">38</xref></sup> or calculated by the numerical decomposition of the theoretical matrix.</p>
    </sec>
    <sec id="Sec13">
      <title>Preprocessing</title>
      <p id="Par29">We used a standard preprocessing pipeline as follows: first removing genes that are not expressed in any of the cells in our data, applying per-cell normalization by dividing each count by the total counts of that particular cell, applying log transformation and retaining only highly variable genes.</p>
      <p id="Par30">For the reconstruction algorithm, we scaled <italic>L</italic><sub>2</sub> of each cell to 1 to ensure that the circulant matrix has constant diagonal. For the gene inference algorithm, scaling <italic>L</italic><sub>2</sub> of each gene to 1 should be applied, as the score of each gene is relative to the rest of the genes. To estimate <italic>α</italic>, representing the correlation between neighbors according to the target topology, we search for the <italic>α</italic> value that best matches the spectrum of the given gene expression matrix. The results were improved by applying the algorithms after removing the theoretical covariance vector associated with the largest eigenvalue. For the cyclic case, the values of this eigenvector are constant.</p>
    </sec>
    <sec id="Sec14">
      <title>scPrisma general-case algorithm</title>
      <p id="Par31">
        <list list-type="order">
          <list-item>
            <p id="Par32">Choose the desired topology (for example, periodic/linear). Calculate the theoretical covariance eigenvectors and eigenvalues.</p>
          </list-item>
          <list-item>
            <p id="Par33">Preprocess the data.</p>
          </list-item>
          <list-item>
            <p id="Par34">Reconstruct the signal by reordering the gene expression rows by solving Problem 2 (below) or by using prior knowledge.</p>
          </list-item>
        </list>
      </p>
      <p id="Par35">Option 1—signal enhancement:<list list-type="alpha-lower"><list-item><p id="Par36">Infer informative genes by solving Problem 3 (below) or by using prior knowledge and remove the rest of the genes.</p></list-item><list-item><p id="Par37">Enhance the desired signal by solving Problem 4 (below).</p></list-item></list></p>
      <p id="Par38">Option 2—signal filtering:<list list-type="alpha-lower"><list-item><p id="Par39">Filter out the desired signal by solving Problem 5.</p></list-item></list></p>
    </sec>
    <sec id="Sec15">
      <title>Signal reconstruction</title>
      <p id="Par40">With a closed formula for the spectrum (<xref rid="Equ2" ref-type="disp-formula">2</xref>) and (<xref rid="Equ3" ref-type="disp-formula">3</xref>), we can estimate the pseudotime of the underlying cyclic trajectory. This can be done by estimating the rows reordering of the gene expression matrix that maximizes the projection over the theoretical spectrum. This problem can be formulated as a matrix permutation problem.</p>
      <sec id="FPar1">
        <title>Problem 1</title>
        <p id="Par41">Matrix permutation problem for estimating a pseudotime that maximizes the projection over the theoretical spectrum:<disp-formula id="Equa"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max E\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* (E* A)* {(E* A)}^{\rm {T}}* {\overrightarrow{v}}_{i}\\ &amp;{\mathrm{s.t}}\, \, E\in P\end{array}$$\end{document}</tex-math><mml:math id="M20"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>E</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi>E</mml:mi><mml:mo>∈</mml:mo><mml:mi>P</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where <italic>A</italic> is the original gene expression matrix, <inline-formula id="IEq5"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\overrightarrow{v}}_{i}$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq5.gif"/></alternatives></inline-formula> and <italic>λ</italic><sub><italic>i</italic></sub> are the theoretical eigenvectors and corresponding eigenvalues, respectively, and <italic>P</italic> is the set of permutation matrices. Under the assumption that <italic>A</italic> has a permutation <italic>Ẽ</italic> such that the spectrum of <inline-formula id="IEq6"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$({\tilde{\rm {E}}}*A)*({\tilde{\rm {E}}}*A)^{\rm{T}}$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">E</mml:mi></mml:mrow><mml:mrow><mml:mo>~</mml:mo></mml:mrow></mml:mover><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">E</mml:mi></mml:mrow><mml:mrow><mml:mo>~</mml:mo></mml:mrow></mml:mover><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq6.gif"/></alternatives></inline-formula> matches the theoretical spectrum, the optimal solution is <italic>E</italic> = <italic>Ẽ</italic> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.15)</xref>. Now, consider an identical formulation of the function we wish to maximize: <inline-formula id="IEq7"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\sum }\nolimits_{i = 0}^{n-1}{\lambda }_{i}* {{\left\Vert {(E* A)}^{\rm{T}}* {\overrightarrow{v}}_{i}\right\Vert }_{2}^{2}}$$\end{document}</tex-math><mml:math id="M26"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq7.gif"/></alternatives></inline-formula>. This formula aims to maximize the product of each gene sorted by the permutation matrix and each theoretical eigenvector multiplied by its eigenvalue. These theoretical eigenvectors, as they are the eigenvectors of the theoretical covariance matrix, represent the variance along the theoretical topology. As a result, the permutation which maximizes this objective maximizes the variance along the theoretical topology.</p>
        <p>Permutation problems are known to be NP-Hard<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>. We will follow previous studies in solving a convex relaxation of this problem, and instead of searching for a permutation matrix, we will search for a doubly stochastic matrix (the Birkhoff polytope)<sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>:</p>
      </sec>
      <sec id="FPar2">
        <title>Problem 2</title>
        <p id="Par43">Convex relaxation of Problem 1:<disp-formula id="Equb"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max E\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* (E* A)* {(E* A)}^{\rm{T}}* {\overrightarrow{v}}_{i}\\ &amp;{\mathrm{s.t}}\, \, \,{\overrightarrow{1}}^{\rm{T}}* E=\overrightarrow{1},\\ &amp;E* \overrightarrow{1}=\overrightarrow{1}\end{array}$$\end{document}</tex-math><mml:math id="M28"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>E</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equb.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Here the objective function is quadratic and convex (Supplementary Note <xref rid="MOESM1" ref-type="media">A.16)</xref>. Despite the fact that maximizing it is not convex optimization, previous studies have shown that such problems can be efficiently resolved with stochastic gradient descent<sup><xref ref-type="bibr" rid="CR41">41</xref>,<xref ref-type="bibr" rid="CR42">42</xref></sup>. To project into the Birkhoff polytope, we used Bregmanian bi-stochastication algorithm<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. Finally, for rounding the doubly stochastic matrix to a permutation matrix, we used a simple greedy algorithm. Specifically, the algorithm iterates over all rows, for each row rounds the maximum entry in each column that does not have 1 value yet to 1 and rounds to 0 the rest of the entries. The output of this algorithm is the permuted gene expression matrix: <italic>A</italic><sub>ordered</sub> = <inline-formula id="IEq8"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E*A$$\end{document}</tex-math><mml:math id="M30"><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq8.gif"/></alternatives></inline-formula>.</p>
      </sec>
    </sec>
    <sec id="Sec16">
      <title>Genes inference</title>
      <p id="Par45">Once the reconstructed signal is obtained, either by solving Problem 2 or by prior knowledge, identification of informative genes that are related to the desired signal is possible. This can be achieved by filtering genes that do not maximize the projection over the theoretical spectrum. Because of convexity considerations, it would be easier to infer genes that are not related to the desired signal and then flip the results. Inference of the genes that are not related to the desired signal can be done by solving the following optimization problem:</p>
      <sec id="FPar3">
        <title>Problem 3</title>
        <p id="Par46">Genes inference:<disp-formula id="Equc"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \min D\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{T}* ({A}_{{\mathrm{ordered}}}* D)* {({A}_{{\mathrm{ordered}}}* D)}^{T}* {\overrightarrow{v}}_{i}-{\gamma * \left\Vert D\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,D\,\,{\mathrm{is}}\,\,{\mathrm{diagonal}}\\ &amp;0\le D\le I\end{array}$$\end{document}</tex-math><mml:math id="M32"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>min</mml:mi><mml:mi>D</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi>D</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">is</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">diagonal</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>D</mml:mi><mml:mo>≤</mml:mo><mml:mi>I</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Because genes are represented by columns of <italic>A</italic>, each entry on the diagonal of <italic>D</italic> represents the influence of the respective gene on the spectrum. The number of filtered genes can be controlled by adding regularization. We can either increase the regularization coefficient, <italic>γ</italic>, to filter fewer genes or decrease it to filter more genes. The output of this algorithm is the gene expression matrix, after nullifying the genes that are not informative relative to the signal: <italic>D</italic><sub>1</sub> = <italic>I</italic> − <italic>D</italic>, <italic>A</italic><sub>gene-inferred</sub> = <italic>A</italic><sub>ordered</sub> <inline-formula id="IEq9"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$*$$\end{document}</tex-math><mml:math id="M34"><mml:mo>*</mml:mo></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq9.gif"/></alternatives></inline-formula> <italic>D</italic><sub>1</sub>.</p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>Filtering and enhancement</title>
      <p id="Par48">After inferring the set of informative genes (the genes related to the reconstructed signal), the next step is to remove any information that is not related to the signal, from the expression of those genes. This can be achieved by removing the diagonal constraint from Problem 3 and replacing the matrix product by the Hadamard product (element-wise product). For every entry in the expression matrix, <italic>A</italic><sub><italic>i</italic>,<italic>j</italic></sub>, this formulation matches an optimization variable <italic>F</italic><sub><italic>i</italic>,<italic>j</italic></sub>. Therefore, the enhanced gene expression matrix contains only expression profiles that maximize the projection over the theoretic spectrum.</p>
      <sec id="FPar4">
        <title>Problem 4</title>
        <p id="Par49">Signal enhancement:<disp-formula id="Equd"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max F\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* ({A}_{{\mathrm{genes-inferred}}}\odot F)* {({A}_{{\mathrm{genes-inferred}}}\odot F)}^{\rm{T}}* {\overrightarrow{v}}_{i}-\gamma * {\left\Vert F\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,0\le {F}_{i,j}\le 1\,\,\,\forall \,i,j\end{array}$$\end{document}</tex-math><mml:math id="M36"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>F</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">genes-inferred</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">genes-inferred</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mo>∀</mml:mo><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Because this problem is not a convex optimization problem, it can be solved by using stochastic gradient ascent (adding noise at each iteration<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>). The output of this algorithm is the gene expression matrix, after eliminating information that is unrelated to the signal of interest: <italic>A</italic><sub>enhanced</sub> = <italic>A</italic><sub>genes-inferred</sub> ⊙ <italic>F</italic>.</p>
        <p>Another option is similar to that described for Problem 3, which is to transform this problem into a minimization problem for filtering the reconstructed signal, thus turning it into a convex optimization problem (Supplementary Note <xref rid="MOESM1" ref-type="media">A.16)</xref>. Formulating this problem as a minimization problem eliminates the variance along the theoretical topology.</p>
      </sec>
      <sec id="FPar5">
        <title>Problem 5</title>
        <p id="Par52">Signal filtering:<disp-formula id="Eque"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \min F\,\,\,\,\mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* ({A}_{{\mathrm{ordered}}}\odot F)* {({A}_{{\mathrm{ordered}}}\odot F)}^{\rm{T}}* {\overrightarrow{v}}_{i}-\gamma * {\left\Vert F\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,0\le {F}_{i,j}\le 1\,\,\,\forall \,i,j\end{array}$$\end{document}</tex-math><mml:math id="M38"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>min</mml:mi><mml:mi>F</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mo>∀</mml:mo><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>The output of this algorithm is the gene expression matrix, after eliminating the information that is related to the signal of interest: <italic>A</italic><sub>filtered</sub> = <italic>A</italic><sub>ordered</sub> ⊙ <italic>F</italic>.</p>
      </sec>
    </sec>
    <sec id="Sec18">
      <title>Reporting summary</title>
      <p id="Par54">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec id="Sec19" sec-type="materials|methods">
    <title>Online content</title>
    <p id="Par55">Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests and statements of data and code availability are available at 10.1038/s41587-023-01663-5.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec21">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41587_2023_1663_MOESM1_ESM.pdf">
            <label>Supplementary Information</label>
            <caption>
              <p>Supplementary Notes A.1–A.16, Figs. 1–10, and References.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41587_2023_1663_MOESM2_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41587_2023_1663_MOESM3_ESM.xlsx">
            <label>Supplementary Table 1</label>
            <caption>
              <p>List of gene regulatory interactions related to the circadian rhythm signal inferred by GRNBoost2 after cyclic enhancement by scPrisma.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41587_2023_1663_MOESM4_ESM.xlsx">
            <label>Supplementary Table 2</label>
            <caption>
              <p>List of cell–cell interactions related to the circadian rhythm signal inferred by CellPhoneDB after cyclic enhancement by scPrisma.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec20">
        <title>Extended data</title>
        <p id="Par60">
          <fig id="Fig6">
            <label>Extended Data Fig. 1</label>
            <caption>
              <title>scPrisma identifies and filters periodic signals in simulated data.</title>
              <p>(A) PCA representation and gene expression covariance matrix before and after applying the reconstruction algorithm. This was done over a simulated gene expression matrix (100 cells, 500 genes, w=0.3) encoding a cyclic signal according to the spatial model (Supplementary A.2). The covariance matrix, after applying the reconstruction algorithm, is circulant. (B) Spearman correlation between the ground-truth permutation and the predicted permutation as a function of SNR over 300 simulations. A cyclic signal was simulated similarly to (A), Gaussian noise was added with varying variance, while the expression matrix was clipped to be positive. (C) AUC-ROC of informative genes inference task as a function of SNR over 300 simulations, each consisting of a cyclic signal and a lineage signal (256 cells, 250 genes) that were concatenated to form a combined gene expression matrix (256 cells, 500 genes), supplemented by additive Gaussian noise. (D) Filtering and enhancement of cyclic signals in combined simulated data. The combined simulation consists of the sum of linear and cyclic signals (200 cells, 500 genes each), and a Gaussian noise matrix (variance = 0.1). (E) Boxplots comparing the filtering and enhancement algorithms of scPrisma with Cyclum over n=100 simulations of the combined signal as described in (D). For the box plots, the center line is the median, box limits are the 0.25 and 0.75 quantiles, vertical lines extend from the top of the box to indicate the maximum value, and from the bottom to indicate the minimum value.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig6_ESM" id="d32e3701"/>
          </fig>
        </p>
        <p id="Par61">
          <fig id="Fig7">
            <label>Extended Data Fig. 2</label>
            <caption>
              <title>Temporal filtering by scPrisma enhances cell type clustering of single-cell data.</title>
              <p>Analysis based on single-cell data of suprachiasmatic nucleus neurons<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. (A) Before temporal filtering, clusters ‘1’ and ‘3’ mostly contain cells that were sampled in CT=14/18/22 while cluster ‘4’ mostly contains cells that were sampled in CT=06/10. (B) However, following filtering, the corresponding clusters (now labeled ‘0’ and ‘2’) are well-mixed in terms of their temporal labels.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig7_ESM" id="d32e3719"/>
          </fig>
        </p>
        <p id="Par62">
          <fig id="Fig8">
            <label>Extended Data Fig. 3</label>
            <caption>
              <title>Enhancement and filtering by scPrisma of clustered structure in cellular populations.</title>
              <p>(A-C) Enhancement of clustered structure in the liver lobule scRNA-seq data<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>; (A) 2D PCA of raw (left) and cluster-based enhanced (right) data, highlighting the separation between samples that were collected during the night (ZT = 0, 18) and the day (ZT = 6, 12). (B) Mean (triangle) and variance (error bar) of <italic>Pck1</italic> expression as a function of circadian time, for raw (left) and cluster-based enhanced (right) data. At each time point, the sample size is N=1000. (C) 2D PCA colored by <italic>Pck1</italic> expression for raw (left) and cluster-based enhanced (right) data. (D,E) Filtering of clustered structure, leading to integration of pancreas scRNA-seq data collected from 4 different studies<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>; UMAPs of pre and post data integration, colored by (D) batch and (E) cell type.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig8_ESM" id="d32e3750"/>
          </fig>
        </p>
        <p id="Par63">
          <fig id="Fig9">
            <label>Extended Data Fig. 4</label>
            <caption>
              <title>Enhancement by scPrisma of synchronized periodic processes.</title>
              <p>Analysis based on SCN single-cell gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. (A-C) 2D PCA of ependymal and endothelial cells, for (A) raw and (B,C) cyclic-enhanced data, colored by (A,B) circadian sample time (left) and by cell type (right), and by (C) <italic>Dbp</italic> (left) and <italic>Hsp90ab1</italic> (right) expression.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig9_ESM" id="d32e3774"/>
          </fig>
        </p>
        <p id="Par64">
          <fig id="Fig10">
            <label>Extended Data Fig. 5</label>
            <caption>
              <title>Enhancement by scPrisma of unsynchronized periodic processes.</title>
              <p>Analysis based on SCN single-cell gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. (A,B) 2D PCA of ependymal cells and SCN neurons, for (A) raw and (B) cyclic-enhanced data, colored by circadian sample time (left) and by cell type (right). (C,D) 2D tSNE of ependymal cells and SCN neurons, for cyclic-enhanced data, colored by circadian sample time (C; left), cell type (C; right), and <italic>Dbp</italic> expression (D). (E) Mean (triangle) and variance (error bar) of <italic>Dbp</italic> expression as a function of circadian time, which peaks at CT = 10 in ependymal cells (top), and peaks at CT = 2/6 in SCN neurons (bottom). The sample sizes at each time point (CT/N) for ependymal cells are: CT02/428, CT06/493, CT10/521, CT14/519, CT18/365 and CT22/480, and for SCN neurons they are: CT02/667, CT06/741, CT10/870, CT14/670, CT18/1375 and CT22/1029.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig10_ESM" id="d32e3798"/>
          </fig>
        </p>
        <p id="Par65">
          <fig id="Fig11">
            <label>Extended Data Fig. 6</label>
            <caption>
              <title>Spatial enhancement by scPrisma.</title>
              <p>Analysis based on Slide-seqV2 mouse hippocampus data <sup><xref ref-type="bibr" rid="CR32">32</xref></sup>(subsampled to 29,250 cells). Raw (left) and spatially-enhanced (right) gene expression of the top 3 spatially informative genes (based on Moran’s I score).</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig11_ESM" id="d32e3816"/>
          </fig>
        </p>
        <p id="Par66">
          <fig id="Fig12">
            <label>Extended Data Fig. 7</label>
            <caption>
              <title>Runtime and memory consumption analysis of scPrisma algorithms.</title>
              <p>Simulated cyclic signal of 2000 genes, varying number of cells, <italic>w</italic> = 0.3 and added Gaussian noise (variance=0.1), using a single GPU-‘NVIDIA RTX A5000’.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig12_ESM" id="d32e3833"/>
          </fig>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <sec id="FPar6">
      <title>Extended data</title>
      <p id="Par56">is available for this paper at 10.1038/s41587-023-01663-5.</p>
    </sec>
    <sec id="FPar7" sec-type="supplementary-material">
      <title>Supplementary information</title>
      <p id="Par57">The online version contains supplementary material available at 10.1038/s41587-023-01663-5.</p>
    </sec>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank N. Moriel, Y. Constantini, Z. Piran, E. Memet and the rest of our group members, and R. Mintz, O. Karin, D. Shalev and I. Alon for meaningful discussions and feedback. We thank O. Mittelpunkt for assistance in the graphic design. This work was funded by the Center for Interdisciplinary Data Science Research at the Hebrew University of Jerusalem (J.K.), an Azrieli Foundation Early Career Faculty Fellowship, Israel Science Foundation Research Grant (1079/21) and the European Union (ERC, DecodeSC, 101040660) (M.N.). Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Research Council. Neither the European Union nor the granting authority can be held responsible for them.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>J.K. and M.N. conceived the study, designed the research and developed the framework; J.K. implemented the method and analyzed the data, with guidance from M.N.; Y.B. contributed to the theoretical analysis of linear signals; J.K. and M.N. wrote the paper.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar8">
      <title>Peer review information</title>
      <p id="Par58"><italic>Nature Biotechnology</italic> thanks Ken Chen, Feng Bao and the other, anonymous, reviewer(s) for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The scRNA-seq datasets used for this study were acquired from the Gene Expression Omnibus (GEO) database with the following accession numbers: HeLaS3 (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE142277">GSM4224315</ext-link>), liver (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE145197">GSE145197</ext-link>), <italic>Chlamydomonas</italic> (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE157580">GSE157580</ext-link>), SCN (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117295">GSE117295</ext-link>) and hESC (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE64016">GSE64016</ext-link>). Slide-seqV2 dataset of the mice hippocampus was generated from ref. <sup><xref ref-type="bibr" rid="CR32">32</xref></sup> and downloaded using Squidpy<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. Pancreas datasets were generated from refs. <sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup> and downloaded using Scanpy<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The code for scPrisma is publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/nitzanlab/scPrisma/">https://github.com/nitzanlab/scPrisma/</ext-link></p>
  </notes>
  <notes id="FPar9" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par59">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>AR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Quantitative assessment of single-cell RNA-sequencing methods</article-title>
        <source>Nat. Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>41</fpage>
        <lpage>46</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2694</pub-id>
        <?supplied-pmid 24141493?>
        <pub-id pub-id-type="pmid">24141493</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Karaiskos</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Gene expression cartography</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>576</volume>
        <fpage>132</fpage>
        <lpage>137</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1773-3</pub-id>
        <?supplied-pmid 31748748?>
        <pub-id pub-id-type="pmid">31748748</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jansen</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Building gene regulatory networks from scatac-seq and scRNA-seq using linked self organizing maps</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2019</year>
        <volume>15</volume>
        <fpage>e1006555</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1006555</pub-id>
        <?supplied-pmid 31682608?>
        <pub-id pub-id-type="pmid">31682608</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Plass</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell type atlas and lineage tree of a whole complex animal by single-cell transcriptomics</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>360</volume>
        <fpage>eaaq1723</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aaq1723</pub-id>
        <?supplied-pmid 29674432?>
        <pub-id pub-id-type="pmid">29674432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Forrow</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schiebinger</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Lineageot is a unified framework for lineage tracing and trajectory inference</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>4940</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-25133-1</pub-id>
        <?supplied-pmid 34400634?>
        <pub-id pub-id-type="pmid">34400634</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reconstructing cell cycle pseudo time-series via single-cell transcriptome data</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>22</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-017-00039-z</pub-id>
        <?supplied-pmid 28630425?>
        <pub-id pub-id-type="pmid">28630425</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Barron</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Identifying and removing the cell-cycle effect from single-cell RNA-sequencing data</article-title>
        <source>Sci. Rep.</source>
        <year>2016</year>
        <volume>6</volume>
        <fpage>33892</fpage>
        <pub-id pub-id-type="doi">10.1038/srep33892</pub-id>
        <?supplied-pmid 27670849?>
        <pub-id pub-id-type="pmid">27670849</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>MP</given-names>
          </name>
        </person-group>
        <article-title>Revealing lineage-related signals in single-cell gene expression using random matrix theory</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2021</year>
        <volume>118</volume>
        <fpage>e1913931118</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1913931118</pub-id>
        <?supplied-pmid 33836557?>
        <pub-id pub-id-type="pmid">33836557</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liang</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Latent periodic process inference from single-cell RNA-seq data</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1441</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-15295-9</pub-id>
        <?supplied-pmid 32188848?>
        <pub-id pub-id-type="pmid">32188848</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <?supplied-pmid 25867923?>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rojo</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Rojo</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Some results on symmetric circulant matrices and on symmetric centrosymmetric matrices</article-title>
        <source>Linear Algebra Appl.</source>
        <year>2004</year>
        <volume>392</volume>
        <fpage>211</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1016/j.laa.2004.06.013</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schwabe</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Formichetti</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Junker</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Falcke</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>The transcriptome dynamics of single cells during the cell cycle</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2020</year>
        <volume>16</volume>
        <fpage>e9946</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20209946</pub-id>
        <?supplied-pmid 33205894?>
        <pub-id pub-id-type="pmid">33205894</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Jammalamadaka, S. R. &amp; Sengupta, A. <italic>Topics in Circular Statistics</italic> Vol. 5 (World Scientific, 2001).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Droin</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Space-time logic of liver gene expression at sub-lobular scale</article-title>
        <source>Nat. Metab.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>43</fpage>
        <lpage>58</lpage>
        <pub-id pub-id-type="doi">10.1038/s42255-020-00323-1</pub-id>
        <?supplied-pmid 33432202?>
        <pub-id pub-id-type="pmid">33432202</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Salomé</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Merchant</surname>
            <given-names>SS</given-names>
          </name>
          <name>
            <surname>Pellegrini</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing of batch Chlamydomonas cultures reveals heterogeneity in their diurnal cycle phase</article-title>
        <source>Plant Cell</source>
        <year>2021</year>
        <volume>33</volume>
        <fpage>1042</fpage>
        <lpage>1057</lpage>
        <pub-id pub-id-type="doi">10.1093/plcell/koab025</pub-id>
        <?supplied-pmid 33585940?>
        <pub-id pub-id-type="pmid">33585940</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Strenkert</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiomics resolution of molecular events during a day in the life of Chlamydomonas</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>2374</fpage>
        <lpage>2383</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1815238116</pub-id>
        <?supplied-pmid 30659148?>
        <pub-id pub-id-type="pmid">30659148</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal single-cell analysis of gene expression in the mouse suprachiasmatic nucleus</article-title>
        <source>Nat. Neurosci.</source>
        <year>2020</year>
        <volume>23</volume>
        <fpage>456</fpage>
        <lpage>467</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-020-0586-x</pub-id>
        <?supplied-pmid 32066983?>
        <pub-id pub-id-type="pmid">32066983</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <mixed-citation publication-type="other">Caliński, T. &amp; Harabasz, J. A dendrite method for cluster analysis. <italic>Commun. Stat.</italic><bold>3</bold>, 1–27 (1974).</mixed-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moerman</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GRNBoost2 and Arboreto: efficient and scalable inference of gene regulatory networks</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>2159</fpage>
        <lpage>2161</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty916</pub-id>
        <?supplied-pmid 30445495?>
        <pub-id pub-id-type="pmid">30445495</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pett</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Kondoff</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bordyugov</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kramer</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Herzel</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Co-existing feedback loops generate tissue-specific circadian rhythms</article-title>
        <source>Life Sci. Alliance</source>
        <year>2018</year>
        <volume>1</volume>
        <fpage>e201800078</fpage>
        <pub-id pub-id-type="doi">10.26508/lsa.201800078</pub-id>
        <?supplied-pmid 30456356?>
        <pub-id pub-id-type="pmid">30456356</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AnimalTFDB 3.0: a comprehensive resource for annotation and prediction of animal transcription factors</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D33</fpage>
        <lpage>D38</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky822</pub-id>
        <?supplied-pmid 30204897?>
        <pub-id pub-id-type="pmid">30204897</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>YH</given-names>
          </name>
          <name>
            <surname>Lazar</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <article-title>Transcriptional control of circadian rhythms and metabolism: a matter of time and space</article-title>
        <source>Endocrine Rev.</source>
        <year>2020</year>
        <volume>41</volume>
        <fpage>707</fpage>
        <lpage>732</lpage>
        <pub-id pub-id-type="doi">10.1210/endrev/bnaa014</pub-id>
        <pub-id pub-id-type="pmid">32392281</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Time-of-day specificity of anticancer drugs may be mediated by circadian regulation of the cell cycle</article-title>
        <source>Sci. Adv.</source>
        <year>2021</year>
        <volume>7</volume>
        <fpage>eabd2645</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.abd2645</pub-id>
        <?supplied-pmid 33579708?>
        <pub-id pub-id-type="pmid">33579708</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Efremova</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Cellphonedb: inferring cell–cell communication from combined expression of multi-subunit ligand–receptor complexes</article-title>
        <source>Nat. Protoc.</source>
        <year>2020</year>
        <volume>15</volume>
        <fpage>1484</fpage>
        <lpage>1506</lpage>
        <pub-id pub-id-type="doi">10.1038/s41596-020-0292-x</pub-id>
        <?supplied-pmid 32103204?>
        <pub-id pub-id-type="pmid">32103204</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Segerstolpe</surname>
            <given-names>Å</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title>
        <source>Cell Metab.</source>
        <year>2016</year>
        <volume>24</volume>
        <fpage>593</fpage>
        <lpage>607</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cmet.2016.08.020</pub-id>
        <?supplied-pmid 27667667?>
        <pub-id pub-id-type="pmid">27667667</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baron</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>346</fpage>
        <lpage>360</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id>
        <?supplied-pmid 27667365?>
        <pub-id pub-id-type="pmid">27667365</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>YJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptomics of the human endocrine pancreas</article-title>
        <source>Diabetes</source>
        <year>2016</year>
        <volume>65</volume>
        <fpage>3028</fpage>
        <lpage>3038</lpage>
        <pub-id pub-id-type="doi">10.2337/db16-0405</pub-id>
        <?supplied-pmid 27364731?>
        <pub-id pub-id-type="pmid">27364731</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Muraro</surname>
            <given-names>MJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>385</fpage>
        <lpage>394</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id>
        <?supplied-pmid 27693023?>
        <pub-id pub-id-type="pmid">27693023</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polański</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>964</fpage>
        <lpage>965</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id>
        <?supplied-pmid 31400197?>
        <pub-id pub-id-type="pmid">31400197</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leng</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Oscope identifies oscillatory genes in unsynchronized single-cell RNA-seq experiments</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>947</fpage>
        <lpage>950</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3549</pub-id>
        <?supplied-pmid 26301841?>
        <pub-id pub-id-type="pmid">26301841</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stickels</surname>
            <given-names>RR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqv2</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>313</fpage>
        <lpage>319</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id>
        <?supplied-pmid 33288904?>
        <pub-id pub-id-type="pmid">33288904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Santos</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wernersson</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jensen</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Cyclebase 3.0: a multi-organism database on cell-cycle regulation and phenotypes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2015</year>
        <volume>43</volume>
        <fpage>D1140</fpage>
        <lpage>D1144</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku1092</pub-id>
        <?supplied-pmid 25378319?>
        <pub-id pub-id-type="pmid">25378319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Colwell</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Power law tails in phylogenetic systems</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2018</year>
        <volume>115</volume>
        <fpage>690</fpage>
        <lpage>695</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1711913115</pub-id>
        <?supplied-pmid 29311320?>
        <pub-id pub-id-type="pmid">29311320</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <mixed-citation publication-type="other">Gray, R. M. <italic>Toeplitz and Circulant Matrices: A Review</italic> (Now, 2006).</mixed-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Demidenko</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Applications of symmetric circulant matrices to isotropic Markov chain models and electrical impedance tomography</article-title>
        <source>Adv. Pure Math.</source>
        <year>2017</year>
        <volume>7</volume>
        <fpage>188</fpage>
        <lpage>198</lpage>
        <pub-id pub-id-type="doi">10.4236/apm.2017.72010</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <mixed-citation publication-type="other">Grenander, U. &amp; Szegö, G. <italic>Toeplitz Forms and Their Applications</italic> (Univ. California Press, 1958).</mixed-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Trench, W. F. Spectral decomposition of Kac-Murdock-Szego matrices <ext-link ext-link-type="uri" xlink:href="https://works.bepress.com/william_trench/133/">https://works.bepress.com/william_trench/133/</ext-link> (2010).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Fogel, F., Jenatton, R., Bach, F. &amp; d’Aspremont, A. Convex relaxations for permutation problems. In <italic>Proc. 26th International Conference on Neural Information Processing Systems</italic> (eds Burges, C. J. C. et al.) 1016–1024 (Curran Associates Inc., 2013).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Wang, F., Li, P. &amp; Konig, A. C. Learning a bi-stochastic data similarity matrix. In <italic>Proc.</italic><italic>2010 IEEE International Conference on Data Mining</italic> 551–560 (IEEE, 2010).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Shamir, O. Convergence of stochastic gradient descent for PCA. In <italic>Proc. 33rd International Conference on Machine Learning</italic> (eds Balcan, M. F. &amp; Weinberger, K. Q.) 257–265 (PMLR, 2016).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Zhang, L., Yang, T., Yi, J., Jin, R. &amp; Zhou, Z.-H. Stochastic optimization for kernel PCA. In <italic>Proc.</italic><italic>Thirtieth AAAI Conference on Artificial Intelligence</italic> 2316–2322 (AAAI Press, 2016).</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Daneshmand, H., Kohler, J., Lucchi, A. &amp; Hofmann, T. Escaping saddles with stochastic gradients. In <italic>Proc. 35th International Conference on Machine Learning</italic> (eds Dy, J. &amp; Krause, A.) 1155–1164 (PMLR, 2018).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Palla</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>171</fpage>
        <lpage>178</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id>
        <?supplied-pmid 35102346?>
        <pub-id pub-id-type="pmid">35102346</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Scanpy: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <?supplied-pmid 29409532?>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Biotechnol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Biotechnol</journal-id>
    <journal-title-group>
      <journal-title>Nature Biotechnology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1087-0156</issn>
    <issn pub-type="epub">1546-1696</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10635821</article-id>
    <article-id pub-id-type="pmid">36849830</article-id>
    <article-id pub-id-type="publisher-id">1663</article-id>
    <article-id pub-id-type="doi">10.1038/s41587-023-01663-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scPrisma infers, filters and enhances topological signals in single-cell data using spectral template matching</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8398-6025</contrib-id>
        <name>
          <surname>Karin</surname>
          <given-names>Jonathan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bornfeld</surname>
          <given-names>Yonathan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0074-9196</contrib-id>
        <name>
          <surname>Nitzan</surname>
          <given-names>Mor</given-names>
        </name>
        <address>
          <email>mor.nitzan@mail.huji.ac.il</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>School of Computer Science and Engineering, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>Racah Institute of Physics, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/03qxff017</institution-id><institution-id institution-id-type="GRID">grid.9619.7</institution-id><institution-id institution-id-type="ISNI">0000 0004 1937 0538</institution-id><institution>Faculty of Medicine, </institution><institution>The Hebrew University of Jerusalem, </institution></institution-wrap>Jerusalem, Israel </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2023</year>
    </pub-date>
    <volume>41</volume>
    <issue>11</issue>
    <fpage>1645</fpage>
    <lpage>1654</lpage>
    <history>
      <date date-type="received">
        <day>7</day>
        <month>4</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>6</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Single-cell RNA sequencing has been instrumental in uncovering cellular spatiotemporal context. This task is challenging as cells simultaneously encode multiple, potentially cross-interfering, biological signals. Here we propose scPrisma, a spectral computational method that uses topological priors to decouple, enhance and filter different classes of biological processes in single-cell data, such as periodic and linear signals. We apply scPrisma to the analysis of the cell cycle in HeLa cells, circadian rhythm and spatial zonation in liver lobules, diurnal cycle in <italic>Chlamydomonas</italic> and circadian rhythm in the suprachiasmatic nucleus in the brain. scPrisma can be used to distinguish mixed cellular populations by specific characteristics such as cell type and uncover regulatory networks and cell–cell interactions specific to predefined biological signals, such as the circadian rhythm. We show scPrisma’s flexibility in incorporating prior knowledge, inference of topologically informative genes and generalization to additional diverse templates and systems. scPrisma can be used as a stand-alone workflow for signal analysis and as a prior step for downstream single-cell analysis.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">scPrisma deconvolutes different biological processes in single-cell RNA-sequencing data.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational models</kwd>
      <kwd>Data processing</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100005155</institution-id>
            <institution>Azrieli Foundation</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100003977</institution-id>
            <institution>Israel Science Foundation (ISF)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>1079/21</award-id>
        <principal-award-recipient>
          <name>
            <surname>Nitzan</surname>
            <given-names>Mor</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature America, Inc. 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Main</title>
    <p id="Par3">In recent years, progress in single-cell RNA sequencing (scRNA-seq) that contains information about the gene expression profiles of the multitude of cells across tissues has led to substantial improvement in our understanding of a variety of intracellular and intercellular processes<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. Recent computational advances have pushed forward the interpretation of these data to extract information about the heterogeneity of cell types and states and their collective structure and behavior, including spatial context<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>, gene regulatory patterns<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, cell type<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> and temporal processes such as lineage<sup><xref ref-type="bibr" rid="CR5">5</xref></sup> and cell cycle<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. Because scRNA-seq data contain multiple biological signals, it can be challenging to uncover a particular underlying signal and in many cases, prior information about the signal in question is needed<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>. Recently, we have shown how topological priors about the hierarchical structure of lineage and differentiation in single-cell data can be leveraged for their identification using spectral approaches, as they exhibit power-law signatures in the covariance eigenvalue distribution<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. Relying on such global topological features can provide a more robust and generalizable approach than relying on specific features such as marker genes<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>, as these are many times unique to different biological systems and processes and can be challenging to infer for new systems. Here we show how topological priors can be used beyond signal identification. We use priors about the periodicity and linearity of diverse biological processes and later generalize to additional topologies, to either enhance or filter them out from single-cell data using a spectral projection approach.</p>
    <p id="Par4">Biological processes that are inherently periodic are abundant and have important roles in diverse contexts, such as the cell cycle and circadian rhythm. Multiple computational methods aim to infer periodic signals from single-cell data, with a particular focus to extract information related to the cell cycle or to remove its effect<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR9">9</xref>,<xref ref-type="bibr" rid="CR10">10</xref></sup>. However, the majority of these methods are heavily based on the cell cycle marker gene information, including ccRemover<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> and reCAT<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, which makes them difficult to generalize across systems and across periodic signals beyond the cell cycle. On the contrary, Cyclum<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, which does not rely on marker genes, is an auto-encoder-based approach that optimizes a circular embedding for single-cell data to infer and remove cell cycle effects. However, fitting the data to a one-dimensional circle does not generally capture the variability of cyclic biological processes and lacks flexibility as it cannot easily incorporate additional prior knowledge, such as low-resolution temporal information, which may be necessary for weak cyclic signals.</p>
    <p id="Par5">Here we present scPrisma, a general spectral framework (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) for the reconstruction, enhancement and filtering of signals in single-cell data based on their topology and inference of topologically informative genes. We benchmark scPrisma and demonstrate its performance over simulated data and seven scRNA-seq datasets. Specifically, we show how the cell cycle can be revealed or filtered in a population of HeLa cells, how circadian rhythm and spatial zonation can be decoupled in liver lobules, how differences in <italic>Chlamydomonas</italic> that were grown in different environments can be emphasized by filtering their diurnal cycle signal, and how the signature of the circadian rhythm can be revealed in multiple cell types in the suprachiasmatic nucleus (SCN) in the brain, the master circadian pacemaker in mammals. In addition, we show how using scPrisma allows us to better distinguish distinct cellular subtypes of SCN neurons following temporal filtering, and uncover signal-related gene regulatory networks and cell–cell interactions following enhancement of the circadian rhythm signal. Finally, beyond cyclic and linear templates, scPrisma can be used to manipulate diverse template types, enhance the separation between clusters, identify multiple cyclic processes and enhance spatial signals in spatial transcriptomics. scPrisma is versatile and enables topological signal manipulation without low-dimensional embedding, which renders the results useful for diverse types of downstream analyses. Furthermore, it is flexible as it enables integration of diverse types of prior knowledge (such as low-resolution temporal ordering) but does not rely on it and can be used for de novo analyses.<fig id="Fig1"><label>Fig. 1</label><caption><title>General workflow of scPrisma.</title><p>Given single-cell data and a theoretical covariance matrix, for example, based on a topological model, we calculate its theoretical spectrum (1), order the cells along the topology (2) and either enhance the signal corresponding to that topology (3A, 4A) or filter it out from the data (3B).</p></caption><graphic xlink:href="41587_2023_1663_Fig1_HTML" id="d32e375"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Spectral template matching for scRNA-seq signal manipulation</title>
      <p id="Par6">We developed scPrisma, a spectral analysis framework that uses topological priors over underlying signals in single-cell data, to allow for their inference, enhancement and filtering. The core of scPrisma uses spectral template matching between the spectrum (the eigendecomposition of the covariance matrix) of a set of single-cell data (for example, scRNA-seq) and the expected analytical spectrum of a structure or process we aim to enhance or filter. To analyze a theoretical covariance spectrum (by analyzing its eigenvalues and eigenvectors), we need a reference model. Focusing first on cyclic signals, we propose a simple toy model of periodic biological signals (<xref rid="Sec10" ref-type="sec">Methods</xref>). The covariance matrix of the gene expression matrix of this model is a circulant matrix of a special form that depends on the model parameters (<xref rid="Sec10" ref-type="sec">Methods</xref>). Circulant matrices have closed-form formula for their eigenvectors and eigenvalues<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> (Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig1" ref-type="fig">1</xref>), which we used to estimate the ordering of cells along the cyclic topology. This was done by optimizing for a permutation matrix that maximizes the projection of the data over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig2" ref-type="fig">2</xref>). As input for the remainder of scPrisma’s workflow, cellular ordering can also be informed by prior knowledge of low-resolution pseudotime. Based on the reconstructed ordering, scPrisma infers topologically informative genes, as the set of genes that maximizes the projection over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig3" ref-type="fig">3A</xref>). scPrisma can then enhance (filter) the signal related to the cyclic process by filtering out gene expression entries that do not maximize (minimize) the projection over the theoretical spectrum (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig1" ref-type="fig">1</xref>–<xref rid="Fig4" ref-type="fig">4A</xref> and <xref rid="Fig1" ref-type="fig">3B</xref>). scPrisma can successfully reconstruct, filter and enhance periodic signals in simulated single-cell data (Supplementary Note <xref rid="MOESM1" ref-type="media">A.1</xref>, Extended Data Fig. <xref rid="Fig6" ref-type="fig">1</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">1)</xref>.</p>
    </sec>
    <sec id="Sec4">
      <title>scPrisma manipulates the cell cycle signal in HeLa cells</title>
      <p id="Par7">We first tested our approach on a scRNA-seq dataset of HeLa cells, unsynchronized across the cell cycle<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). To assess the results, we used a list of approximately 400 genes, classified according to cell cycle phases<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, where for each phase, the corresponding genes were summed and normalized and their circular mean and variance were calculated<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>. For an ordered reconstructed signal, the ordering of the circular means should correspond to the cell cycle phases and the circular variance should be less than 1, while for randomly ordered data, the circular variance is expected to be close to 1 (corresponding to a uniform signal along the cycle). Following standard preprocessing of the HeLa single-cell data (<xref rid="Sec10" ref-type="sec">Methods</xref>; Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>, the distributions of all phases were found to be nearly uniform (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.991). However, after cyclic ordering by scPrisma (<xref rid="Sec10" ref-type="sec">Methods</xref>), different phases of the cell cycle became clearly separated (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.849) and peaked progressively according to the correct phase ordering.<fig id="Fig2"><label>Fig. 2</label><caption><title>scPrisma manipulates the cell cycle signal in HeLa cells.</title><p><bold>a</bold>, PCA representation of 683 cells in the unordered and ordered raw gene expression data, and data following spectral cyclic enhancement and filtering. The cells are colored according to the corresponding rows in the gene expression matrix. <bold>b</bold>, Smoothed polar plot of the normalized sum of the gene sets corresponding to different cell cycle phases<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. The circular mean of each phase is marked by a correspondingly colored star. <bold>c</bold>,<bold>d</bold>, Expression of <italic>CDC20</italic> (which peaks in the M phase<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>) and <italic>RRM2</italic> (which peaks in the S phase<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>) as a function of cellular location in the gene expression matrix. <bold>e</bold>, PCA representation of cells along iterations of the cyclic enhancement algorithm. <bold>f</bold>, Violin plot of AUC scores for <italic>n</italic> = 50 experiments of sampling random gene subsets and inference of cyclic genes by scPrisma based on unordered, ordered, enhanced and filtered data. White dots mark the median, gray bars mark the interquartile range and thin gray lines mark the rest of the distribution, except for outliers.</p></caption><graphic xlink:href="41587_2023_1663_Fig2_HTML" id="d32e530"/></fig></p>
      <p id="Par8">To further enhance the cell cycle signal in the data, we employed scPrisma’s cyclic enhancement algorithm. Iterations of our algorithm gradually revealed a cyclic signal, which was apparent after filtering less than 7% of the total signal and was clearly revealed after removing 22% of the total signal (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>). In addition, the reconstructed angular ordering was correlated with the cell cycle phases and the circular variance of phase-corresponding marker genes decreased substantially (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.666). Further, genes associated with different cell cycle phases peaked progressively in their expected order (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig2" ref-type="fig">2c,d</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">2)</xref>.</p>
      <p id="Par9">Next, we approached the reverse challenge: to filter out the cell cycle signal from the HeLa cells data. After applying scPrisma’s cyclic filtering algorithm to the ordered data, the separation between different cell cycle phases and their corresponding progressive peaks was lost (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>; mean circular variance = 0.989).</p>
      <p id="Par10">Finally, we identified genes related to the cell cycle using the genes inference algorithm (<xref rid="Sec10" ref-type="sec">Methods</xref>; Supplementary Note <xref rid="MOESM1" ref-type="media">A.4)</xref>. When using as input both randomly selected subsets of cell cycle-related genes<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> and subsets of genes unrelated to the cell cycle, we found a substantial improvement in our ability to identify cell cycle-related genes after reordering the cells (mean AUC = 0.804) relative to the original data (mean AUC = 0.295). Moreover, relative to the ordered data, identifying cell cycle-related genes was further improved following spectral cyclic enhancement (AUC mean 0.838, outperforming available baselines; Supplementary Fig. <xref rid="MOESM1" ref-type="media">2)</xref> and was diminished following cyclic filtering (mean AUC 0.183; Fig. <xref rid="Fig2" ref-type="fig">2f</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>scPrisma disentangles spatiotemporal signals in the liver</title>
      <p id="Par11">We next dissected spatiotemporal signals via a scRNA-seq dataset which captures gene expression variation of hepatocytes in the mammalian liver across both space (spatial zonation across the periportal to pericentral axis) and time (temporal variation across the circadian rhythm)<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. Similarly to the cell cycle, the circadian rhythm was also expected to exhibit a cyclic structure in gene expression space. Here we used experimental prior knowledge in the form of low-resolution sampling time<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> to order the cells in a cycle. In this setting, we still missed information about temporally informative genes, and spatiotemporal information was still entangled (for example, <italic>Pck1</italic> varied informatively across both space and time of day<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>). We leveraged scPrisma to disentangle these data and showed clear enhancement and filtering of the circadian rhythm, relative to raw data (<italic>K</italic> = 4 Adjusted Rand Score (ARI) of <italic>K</italic>Means = 0.96; 0.013; 0.11, respectively; Fig. <xref rid="Fig3" ref-type="fig">3a,e</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3A</xref>; <xref rid="Sec10" ref-type="sec">Methods</xref>). scPrisma outperformed available baselines for filtering the circadian rhythm (Supplementary Note <xref rid="MOESM1" ref-type="media">A.5)</xref>. These results were reflected in the behavior of individual genes; <italic>Pck1</italic> is a rhythmic gene that was highly expressed at ZT06 and ZT12 (ref. <sup><xref ref-type="bibr" rid="CR15">15</xref></sup>), and indeed, following spectral cyclic enhancement, its resulting expression in ZT00 and ZT18 was diminished, while cyclic filtering resulted in a nearly constant temporal expression of <italic>Pck1</italic> (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). Spatially, <italic>Pck1</italic> is periportally zonated, and indeed, spectral cyclic enhancement flattens its spatial expression, while cyclic filtering retains its spatial variation (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). Similar behavior can be observed for additional spatiotemporally informative genes (Fig. <xref rid="Fig3" ref-type="fig">3d</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">4)</xref>.<fig id="Fig3"><label>Fig. 3</label><caption><title>Disentanglement of spatial and temporal signals in liver lobules.</title><p><bold>a</bold>,<bold>b</bold>, PCA representation of raw single-cell data of 4,000 cells (1,000 from each time point), and following spectral cyclic enhancement, cyclic filtering, linear enhancement and linear filtering. The cells are colored either according to their associated time points (ZT, sampled at four equally spaced time points along the circadian rhythm) (<bold>a</bold>), or by their respective spatial location (‘layer’, according to the zonation analysis done in <sup><xref ref-type="bibr" rid="CR15">15</xref></sup>) (<bold>b</bold>). <bold>c</bold>,<bold>d</bold>, Heatmaps of the expression of <italic>Pck1</italic> (<bold>c</bold>) and <italic>Oat</italic> (<bold>d</bold>) following scPrisma analysis as a function of the sampling time and zonation layer. <bold>e</bold>, ARI of <italic>K</italic>Means clustering with <italic>K</italic> = 4 (corresponding to four underlying time points) and <italic>K</italic> = 8 (corresponding to eight underlying zonation layers) after applying each of scPrisma’s spectral algorithms.</p></caption><graphic xlink:href="41587_2023_1663_Fig3_HTML" id="d32e694"/></fig></p>
      <p id="Par12">In a complementary manner, spectral analysis focusing on the characteristics of linear signals can be used to filter the spatial linear signal in the collective gene expression of hepatocytes (<xref rid="Sec10" ref-type="sec">Methods</xref>). Indeed, following spectral linear filtering by scPrisma, the cyclic circadian signal was clearly revealed (Fig. <xref rid="Fig3" ref-type="fig">3a</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3A)</xref> and the linear zonation signal was blurred out relative to the raw data (Fig. <xref rid="Fig3" ref-type="fig">3b</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3B,E</xref>; <italic>K</italic> = 8 ARI of <italic>K</italic>Means = 0.017; 0.11, respectively). Focusing again on <italic>Pck1</italic> expression, linear spectral enhancement retained only the expression around the portal vein and reduced the temporal variance, while linear filtering reduced the zonation variance and yet retained the temporal variance (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>).</p>
      <p id="Par13">Finally, we evaluated the dominant structure in the data following scPrisma analysis. As predicted, following spectral enhancement, the data clustered according to the enhanced signal, while following spectral filtering, the data clustered according to the unfiltered signal; for example, filtering the cyclic signal led to better identification and clustering of the spatial zonation signal (Fig. <xref rid="Fig3" ref-type="fig">3e</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>scPrisma manipulates the diurnal cycle in <italic>Chlamydomonas</italic></title>
      <p id="Par14">To demonstrate the use of scPrisma for more complex systems with diverse prior knowledge, we next turn our attention to scRNA-seq data collected for <italic>Chlamydomonas</italic> (green algae), grown under two contrasting conditions, iron replete (Fe<sup>+</sup>) and iron deficient (Fe<sup>−</sup>)<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. In both conditions, an expression signal that reflects the 24 h diurnal cycle was previously detected<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. To evaluate progression of cells along the diurnal cycle, we used marker genes corresponding to different cycle phases obtained from bulk RNA-sequencing<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.6)</xref>. Using scPrisma’s cyclic enhancement resulted in robust reconstruction of the diurnal cycle for each of the two conditions. This was done by splitting the 24-h cycle into six phases and validating that they are well separated following reconstruction and enhancement (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig4" ref-type="fig">4a</xref> for Fe<sup>+</sup> condition and Supplementary Fig. <xref rid="MOESM1" ref-type="media">5A</xref> for Fe<sup>−</sup> condition). Further, concatenating the enhanced cyclic signal of both experiments resulted in a reconstructed synchronized diurnal cycle (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5B)</xref>. We next focused on enhancing the biological differences between the Fe<sup>−</sup> and Fe<sup>+</sup> conditions by spectrally filtering their shared diurnal cycle (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). As expected, cyclic filtering increased the differences between the clusters of Fe<sup>−</sup> and Fe<sup>+</sup> associated cells (Silhouette score before/after filtering = 0.088/0.136, Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). scPrisma outperformed state-of-the-art cyclic filtering methods, including ccRemover<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, Seurat<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and Cyclum<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> (Silhouette scores = 9.815 × 10<sup>-6</sup>, 9.868 × 10<sup>-4</sup> and 0.052, respectively; Supplementary Note <xref rid="MOESM1" ref-type="media">A.8</xref> and Fig. <xref rid="Fig4" ref-type="fig">4b</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>scPrisma detects and filters the diurnal cycle in <italic>Chlamydomonas</italic>.</title><p><bold>a</bold>, PCA representation of 3,000 cells in spectrally enhanced cyclic signal of the Fe<sup>+</sup> experiment<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. Each plot represents 1/6 of the 24 h cycle. The cells are colored according to the normalized sum of the marker genes associated with each phase<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. <bold>b</bold>, PCA representation of 6,000 cells (3,000 of each condition) in Fe<sup>+</sup> (blue) and Fe<sup>−</sup> (orange) conditions of raw gene expression data, data following scPrisma’s cyclic filtering (Silhouette score before/after filtering = 0.088/0.136, Calinski and Harabasz score before/after filtering = 600.802/1000.44) and enhancement, and data following filtering by Cyclum (Silhouette score = 0.052, Calinski and Harabasz score = 337.629), Seurat (Silhouette score = 9.868 × 10<sup>−</sup><sup>4</sup>, Calinski and Harabasz score = 1.29 × 10<sup>−</sup><sup>10</sup>) and ccRemover (Silhouette score = 9.815 × 10<sup>−</sup><sup>6</sup>, Calinski and Harabasz score = 6.25 × 10<sup>−</sup><sup>13</sup>).</p></caption><graphic xlink:href="41587_2023_1663_Fig4_HTML" id="d32e882"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>scPrisma extracts SCN cell-type-specific temporal signals</title>
      <p id="Par15">We next focus on scRNA-seq data collected for mice SCN, the mammalian brain’s circadian pacemaker<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. In this experiment, cells were sampled at 12 time points along two days. Again, we leveraged the cyclic nature of the circadian rhythm and explicitly used the prior knowledge regarding the experimental sampling times (instead of running the reconstruction algorithm). We first clustered the cells using the Louvain algorithm and mapped individual clusters to cell types using established marker genes<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">6)</xref>. scPrisma’s cyclic enhancement over each cell type separately revealed a cyclic signal associated with the circadian rhythm for 5/8 of cell types (Fig. <xref rid="Fig5" ref-type="fig">5</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>; <xref rid="Sec10" ref-type="sec">Methods</xref>). The three cell types that did not expose a clear cyclic signal (NG2, microglia and tanycytes) exhibit the lowest fraction of rhytmic gene expression<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. Moreover, we measured the separation of cells that were sampled at different time points, before and after cyclic filtering/enhancement using the Calinski and Harabasz score<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Overall, as expected, separation increased substantially following cyclic enhancement and decreased following cyclic filtering, which, as above, is least substantial for the three cell types exhibiting the lowest fraction of rhythmic genes (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). It can be observed that the cellular density varies with the rhythmic process and is correlated with the peak of temporal expression of rhythmic genes (Fig. <xref rid="Fig5" ref-type="fig">5a,b</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">A.7)</xref>. Focusing on gene expression, we found that spectral cyclic enhancement diminishes the expression of cell-type marker genes and retains the expression of rhythmic genes (core clock genes and protein folding genes, as characterized in ref. <sup><xref ref-type="bibr" rid="CR18">18</xref></sup>; Fig. <xref rid="Fig5" ref-type="fig">5c</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7)</xref>. Conversely, following cyclic filtering, cell-type marker gene expression was retained, while the resulting temporal expression of rhythmic and protein folding-related genes flattened (Fig. <xref rid="Fig5" ref-type="fig">5c</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7)</xref>.<fig id="Fig5"><label>Fig. 5</label><caption><title>scPrisma extracts cell-type specific circadian rhythm signals in the SCN.</title><p><bold>a</bold>, PCA representation of cells in raw SCN gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> and data following cyclic enhancement by scPrisma, colored according to CT, for several cell types: ependymal, SCN neurons, oligodendrocytes and astrocytes. <bold>b</bold>, PCA representation of ependymal cells colored by <italic>Tef</italic> expression and mean <italic>Tef</italic> expression as a function of circadian time, for raw data (top), data following scPrisma’s cyclic enhancement (middle) and filtering (bottom). <bold>c</bold>, Heatmaps of ependymal expression of (from left to right) cell-type marker genes, rhythmic genes and protein folding genes, for raw data (left) and data following scPrisma’s cyclic enhancement (middle) and filtering (right). <bold>d</bold>, Calinski and Harabasz score for cells sampled at different CT for raw data, and data following scPrisma’s cyclic enhancement and filtering. Cell types with low fraction of circadian genes<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> exhibit lower scores. <bold>e</bold>, Pre- and post-filtering gene expression dotplots of the marker genes of SCN neurons (before filtering, clusters 1, 3 and 4 contain mixtures of two different subtypes), and pre- and post-filtering heatmaps showing the contribution of cells sampled at different CT to each neuronal cluster. <bold>f</bold>, Regulatory network structure of core clock genes<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. <bold>g</bold>, Pre- and post-enhancement sum of scores of all regulatory interactions of the core clock network shown in <bold>f</bold>, scored by GRNBoost2, for each SCN cell type. <bold>h</bold>, Pre- and post-enhancement mean <italic>Rorc</italic>, <italic>Ahsa2</italic> and <italic>Hsp90ab1</italic> expression as a function of CT. Following cyclic enhancement, regulatory interactions between the transcription factor <italic>Rorc</italic> and <italic>Ahsa2</italic>, <italic>Hsp90ab1</italic> were uncovered. <bold>i</bold>, Mean <italic>Avp</italic> and <italic>Plau</italic> expression as a function of CT. Following cyclic enhancement, cell–cell interactions between astrocytes and microglia cell types, mediated by <italic>Avp</italic> and <italic>Plau</italic>, were revealed.</p></caption><graphic xlink:href="41587_2023_1663_Fig5_HTML" id="d32e1038"/></fig></p>
      <p id="Par16">scPrisma further enhanced cell-type classification, inference of gene regulatory interactions related to the circadian rhythm and underlying cell–cell interactions. When aiming to characterize cells by their type, additional biological signals can interfere with that task as similarity between cells can arise due to multiple factors. For example, direct clustering of cells according to their gene expression profiles may capture similarities according to the circadian rhythm phase and not their type, which can substantially hinder our ability to distinguish different cell types. Clustering the neurons yielded 14 distinct clusters, three of which can be identified using either established marker genes or previous subtype classification<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> as containing mixture of neurons from both SCN neuronal subtypes N0 and N2 (clusters 1, 3, 4; Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Fig. <xref rid="Fig5" ref-type="fig">5e</xref>). We found that the circadian rhythm signal interferes with the proper classification of cell subtypes in this case, supported by the observation that in clusters 1 and 3 the majority of cells (79% and 66%, respectively) were sampled at circadian time points (CT) = 14/18/22, while in cluster 4, 93% of cells were sampled at CT 02/06/10, which suggests that the clustering of cells in this subpopulation is dominated by their distinct temporal signatures and not their types (Fig. <xref rid="Fig5" ref-type="fig">5e</xref> and Extended Data Fig. <xref rid="Fig7" ref-type="fig">2</xref>). We were able to overcome the cell-type misclassification by spectrally filtering the circadian rhythm signal using scPrisma, after which, the clustering algorithm yielded a unique cluster for each of the two neuronal subtypes, N0 and N2 (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>). Moreover, as expected, the distribution over CT within each cluster flattened following cyclic filtering (Fig. <xref rid="Fig5" ref-type="fig">5e</xref> and Extended Data Fig. <xref rid="Fig7" ref-type="fig">2</xref>; mean circular variance increased from 0.781 to 0.863 following filtering).</p>
      <p id="Par17">Mixed biological signals in single-cell data can also interfere with the inference of gene regulatory networks. Therefore, we used scPrisma to highlight a set of regulatory interactions related to the circadian rhythm that were difficult to identify in the original data. Specifically, we expected that regulatory interactions that can be revealed following cyclic enhancement would be enriched with interactions associated with the cyclic circadian process. Indeed, regulatory interactions between core clock genes, as inferred using the gene regulatory network inference algorithm GRNBoost2 (ref. <sup><xref ref-type="bibr" rid="CR20">20</xref></sup>), are more highly correlated to the established core clock interaction network<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> (Fig. <xref rid="Fig5" ref-type="fig">5f</xref>) in the cyclically enhanced single-cell data, relative to the raw data, for 7/8 of the cell types (Fig. <xref rid="Fig5" ref-type="fig">5g</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">A.7)</xref>. Going beyond the core clock interaction network, using a list of known mice transcription factors<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, we searched for inferred interactions (based on GRNBoost2) which are substantially enhanced following scPrisma cyclic analysis (<xref rid="Sec10" ref-type="sec">Methods</xref>), where the regulator is a core clock transcription factor (<italic>Nr1d1</italic>, <italic>Nr1d2</italic>, <italic>Rora</italic>, <italic>Rorb</italic>, <italic>Rorc</italic>, <italic>Dbp</italic>, <italic>Tef</italic><sup><xref ref-type="bibr" rid="CR23">23</xref></sup>; a full list of inferred interactions is available in Supplementary Table <xref rid="MOESM3" ref-type="media">1)</xref>. For example, focusing on genes inferred to be highly regulated by <italic>Rorc</italic> in ependymal cells following spectral enhancement, we found that the genes that received the highest score were <italic>Ahsa2</italic> (0 to 6.341), <italic>Kif21a</italic> (0 to 6.231), <italic>Hsp90ab1</italic> (0.070 to 5.731) and <italic>Mt1</italic> (0 to 5.002) and the peaks of these genes along the circadian rhythm overlapped with the peak of <italic>Rorc</italic>, following spectral enhancement (Fig. <xref rid="Fig5" ref-type="fig">5h</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">7E)</xref>. These results are consistent with previous results showing the existence of a regulatory interaction between <italic>Rorc</italic> and <italic>Hsp90ab1</italic> which is dependent on the time of day<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>.</p>
      <p id="Par18">Finally, we used scPrisma to infer hidden cell–cell interactions related to the circadian rhythm. We compared cell–cell communication patterns, using CellPhoneDB<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>, between different cell types at corresponding time points. Similarly to the regulatory network inference described above, we were able to recover interactions that were substantially enhanced following scPrisma’s cyclic analysis (<xref rid="Sec10" ref-type="sec">Methods</xref>; Fig. <xref rid="Fig5" ref-type="fig">5I</xref>, Supplementary Note <xref rid="MOESM1" ref-type="media">A.7</xref> and Supplementary Table <xref rid="MOESM4" ref-type="media">2)</xref>.</p>
    </sec>
    <sec id="Sec8">
      <title>Generalized template matching by scPrisma</title>
      <p id="Par19">Beyond cyclic and linear topologies, scPrisma can be used to manipulate a variety of different, complex topological signals in single-cell data. This is possible because scPrisma can use the numerical spectrum of a given covariance matrix, instead of the analytical spectrum, as was the case for the cyclic and linear topologies. We demonstrated the diversity of scPrisma on three additional types of templates as follows: (1) Clusters—we constructed a cluster-based template to enhance the separation, or maximize the variation in gene expression, between different cellular clusters and states (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>, specifically between cellular states of hepatocytes during day and night time (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3A</xref>). Further, this topology can be used for data integration via the spectral filtering workflow, as we demonstrated for human pancreas scRNA-seq data which were collected from four different studies<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>, labeled and preprocessed as given in ref. <sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. scPrisma can filter batch effects in this case, demonstrated visually (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3D,E</xref>) and quantitatively, as following cluster-based filtering, the Calinski and Harabasz score between the different batches drops from 298.63 to 3.80 and the score between the annotated cell types rises from 90.97 to 107.48. scPrisma’s results for batch correction are competitive or outperform state-of-the-art tailored methods for this task (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. (2) Multiple cycling processes—scPrisma can reconstruct multiple cycling processes across SCN cell types both for a synchronized case (Extended Data Fig. <xref rid="Fig9" ref-type="fig">4</xref>) and an un-synchronized case (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Extended Data Fig. <xref rid="Fig10" ref-type="fig">5</xref>). In the latter, more challenging case, circadian core clock genes are out-of-phase in the SCN neurons versus multiple other cell types<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. scPrisma can enhance every periodic signal separately by designing a covariance matrix that is block circulant (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. Furthermore, scPrisma can be used for the general, iterative inference of cyclic processes, although this task is more challenging and scPrisma is not optimized for it. As an example, we used human embryonic stem cells (hESC) single-cell dataset<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. We showed that scPrisma can be used (de novo, without prior knowledge on marker genes) to first infer a cyclic process corresponding to the cell cycle and then filter it out and use the filtered data to reconstruct a second cyclic process corresponding to an oscillatory pattern related to the experimental setup (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">8)</xref>. The encoding of both oscillatory processes by the hESC population is consistent with previous findings of ref. <sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. (3) Two-dimensional (2D) tissue organization—last, we enhanced the spatial signal in a spatially informed (Slide-seqV2) 2D dataset of the mouse hippocampus<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. We computed the shortest path matrix (calculated based on the spatial k-nearest neighbor graph over the data) and transformed it into an affinity matrix using a heat kernel (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13)</xref>. In this case, the affinity matrix is used by scPrisma as the covariance matrix of the spatial signal. scPrisma enables flexible manipulation of the spatial signal, which we leveraged to extract, and then either enhance or filter the spatial signal in the data by applying the enhancement algorithm based on numerical eigendecompositions of the affinity matrix (Supplementary Note <xref rid="MOESM1" ref-type="media">A.13</xref> and Extended Data Fig. <xref rid="Fig11" ref-type="fig">6</xref>).</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par20">In this study, we developed scPrisma, a spectral analysis workflow based on topological priors for reconstruction, informative genes inference, signal filtering and enhancement. While we focus on periodic signals (cell cycle in HeLa cells, diurnal cycle in <italic>Chlamydomonas</italic> and circadian rhythm in the SCN), we also demonstrate it for convoluted spatial and cyclic signals (spatial zonation and circadian rhythm in liver lobules) and a diversity of additional signals and topologies, such as clusters, multiple cycling processes and 2D spatial templates.</p>
    <p id="Par21">scPrisma presents three major contributions as follows: First, it embodies a full workflow for analyzing underlying topological signals based on an approach that can be performed either de novo or enhanced using prior knowledge (for example, low-resolution pseudotime or marker gene information). This flexibility allows scPrisma to uncover topological signals of varying strengths. Second, scPrisma enables both signal enhancement and filtering without embedding to lower dimensions, which makes it useful as a prior step for existing downstream analyses, such as inferring gene regulation networks and cell–cell interactions. This can accelerate biological discovery, as we exemplify for SCN neurons, by revealing gene regulation patterns and cell–cell interactions that are associated with a specific biological process such as the circadian rhythm. Third, the enhancement algorithm does not overfit to a circular topology, by applying the genes inference task before enhancement (thus retaining only genes related to the desired signal), controlling the level of filtering by regularization and restricting the range of entries in the filtering matrix. Future work can leverage scPrisma’s flexibility and robustness to optimize it to diverse tasks that arise in the context of single-cell and spatial omics analysis, such as generalized spatial analysis, data integration and iterative manipulation of signals, which is a promising, yet challenging, direction for future work.</p>
    <p id="Par22">A computational challenge arises due to the nonconvexity and runtime complexity of the reconstruction task (Extended Data Fig. <xref rid="Fig12" ref-type="fig">7</xref>). This optimization challenge is relieved for cyclic signals, as the theoretical analysis of the eigenvectors does not depend on the specific values of the matrix but only on its circulant property. Moreover, the multiple solutions for the cyclic reconstruction task (every circular shift of a solution is a valid solution) ease the convergence to a feasible solution. In addition, the reconstruction step can be done either by scPrisma or by other pseudotime trajectory reconstruction algorithms. Another challenge is applying scPrisma when it is not clear whether a signal corresponding to the template exists or is strong enough to be detected in the data. This challenge is alleviated due to several reasons. First, we reason and provide empirical support on both synthetic and real single-cell data that scPrisma avoids overfitting to input template topologies. Therefore, in general, scPrisma does not converge to a topology that is not a reflection of a strong-enough signal in the data, as is demonstrated for the SCN, where the algorithm is limited in its convergence over cell types with weak periodic signal. Second, evaluating results obtained by scPrisma can be done by comparison to partial prior knowledge, such as marker genes known to be related (or unrelated) to recovered biological signals, low-resolution sampling times of cells relative to temporal signals, or by interpreting gene ontology enrichment analysis following signal manipulation. Additionally, we suggest a measure for the quality of convergence of scPrisma, the projection proportion score, and while it can be useful for exploring analysis options, it is not associated with a single threshold that can distinguish successful convergence, as it is affected by the signal and data characteristics (Supplementary Note <xref rid="MOESM1" ref-type="media">A.12</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">9)</xref>.</p>
    <p id="Par23">While in this work we focused on periodic signals, which can be analyzed analytically, scPrisma can also be applied using a numerical eigendecomposition of a covariance matrix that is either inferred from the data or constructed numerically based on a topological model. We anticipate that scPrisma will accelerate single-cell-based research by enhancing target signals of interest and enabling their identification and analysis and providing a general workflow for single-cell signal disentanglement in diverse biological contexts.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Spectral analysis of cyclic signals</title>
      <p id="Par24">For theoretical analysis, we constructed three simple models for the cyclic signals. In the first model, illustrated in Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>, we receive as input the number of cellular variations (<italic>q</italic>), the numbers of genes (<italic>p</italic>) and the number of changes between neighboring cells (<italic>k</italic>). We start with a root cell whose expression profile is a binary vector with <italic>p</italic> entries ({1, 0}<sup><italic>p</italic></sup>). Each gene is approximated to be either expressed (ON,1) or not expressed (OFF,0). Then, the next cell in the cycle is generated by duplicating the existing cell, choosing uniformly <italic>k</italic> genes and switching their state. This process is repeated <italic>q</italic> times. Then, within the last generated cell, <italic>k</italic> genes whose state differs from the root cell are chosen at random, their state is switched and the cell is duplicated. This process is then continued until the gene expression of the newest cell is identical to the root cell. For the analysis of the covariance matrix of the model, we will use a similar Markovian assumption to the assumption that was used in refs. <sup><xref ref-type="bibr" rid="CR8">8</xref>,<xref ref-type="bibr" rid="CR34">34</xref></sup>; the covariance between the expression profiles of two cells, separated by <italic>m</italic> state changes, where <italic>m</italic> is the minimum distance between the cells clockwise and counterclockwise (undirected cyclostationary assumption), is given by <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha (m)=E[X(m)X(0)]=\exp (-2mk/p),$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:mo>/</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq1.gif"/></alternatives></inline-formula> where 0 ≤ <italic>m</italic> ≤ <italic>n</italic>/2, <italic>p</italic> is the number of genes and <italic>k</italic> is the number of changes between neighboring cells. More information about the model and the estimation of <italic>α</italic> from real data is described in Supplementary Note <xref rid="MOESM1" ref-type="media">A.11</xref>. According to this assumption, the expected covariance matrix of the gene expression matrix is circulant:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{n}E[X{X}^{\top }]=\left(\begin{array}{llllll}1&amp;\alpha &amp;{\alpha }^{2}&amp;\ldots &amp;{\alpha }^{2}&amp;\alpha \\ \alpha &amp;1&amp;\alpha &amp;\ldots &amp;{\alpha }^{3}&amp;{\alpha }^{2}\\ \vdots &amp;\vdots &amp;\vdots &amp;\ldots &amp;\vdots &amp;\vdots \\ {\alpha }^{2}&amp;{\alpha }^{3}&amp;{\alpha }^{4}&amp;\ldots &amp;1&amp;\alpha \\ \alpha &amp;{\alpha }^{2}&amp;{\alpha }^{3}&amp;\ldots &amp;\alpha &amp;1\end{array}\right)$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <italic>n</italic> is the number of cells. The first column (<inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\overrightarrow{c}$$\end{document}</tex-math><mml:math id="M6"><mml:mover accent="true"><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq2.gif"/></alternatives></inline-formula>) of a circulant matrix specifies the entire matrix. The (<italic>k</italic>, <italic>j</italic>) entry of a general circulant matrix <italic>C</italic> is given by <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k,j}={\overrightarrow{c}}_{(j-k) \% n}$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>%</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq3.gif"/></alternatives></inline-formula><sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. The spectrum of a circulant matrix has analytical closed formula<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. Specifically, the eigenvalues are the discrete Fourier transform of the first row, and the eigenvectors are the normalized Fourier modes. Because a covariance matrix is symmetric and positive semidefinite, all its eigenvalues are real. Therefore, the eigenvalues are the discrete cosine transform of the first row<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\lambda }_{i}=\mathop{\sum }\limits_{j=0}^{n/2-1}{{\alpha }\,^{j}}_{i}* \cos \left(\frac{2\pi ji}{n}\right)\,+\,\mathop{\sum }\limits_{j=n/2}^{n-1}{{\alpha }\,^{j}}_{n-i}* \cos \left(\frac{2\pi ji}{n}\right)$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>α</mml:mi><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mspace width="0.25em"/><mml:mo>+</mml:mo><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mi>α</mml:mi><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par25">The <italic>s</italic>th entry of the <italic>i</italic>th eigenvector corresponding to the <italic>i</italic>th eigenvalue is<sup><xref ref-type="bibr" rid="CR35">35</xref></sup><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${q}_{i}=\sqrt{\frac{2}{n}}* \cos \left(\frac{2\pi is}{n}-\frac{\pi }{4}\right)$$\end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt><mml:mo>*</mml:mo><mml:mi>cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>To test our approach, we defined two additional models, described in Supplementary Note <xref rid="MOESM1" ref-type="media">A.2</xref>, which we used in the simulated data section (Supplementary Note <xref rid="MOESM1" ref-type="media">A.1)</xref>.</p>
    </sec>
    <sec id="Sec12">
      <title>Spectral analysis of linear signals</title>
      <p id="Par26">Similarly to the analysis of cyclic signals, we first construct a simple model for linear signals. We follow a similar linear model to the one that was presented in ref. <sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. The model receives the same input as the cyclic model, and each cell is represented by a binary vector {1, 0}<sup><italic>p</italic></sup>. We start from a root cell, and then over <italic>n</italic> iterations, a new cell is created in the linear chain by changing the state of <italic>k</italic> randomly chosen genes relative to the previous cell in the chain. As in the cyclic model, we assume that the covariance between the gene expression profiles of two cells, separated by <italic>m</italic> state changes, is given by <inline-formula id="IEq4"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\alpha (m)=E[X(m)X(0)]=\exp (-2m/p)$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>X</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>m</mml:mi><mml:mo>/</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq4.gif"/></alternatives></inline-formula>. Thus, the expected covariance matrix of the gene expression matrix is<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{1}{n}E[X{X}^{\top }]=\left(\begin{array}{llllll}1&amp;\alpha &amp;{\alpha }^{2}&amp;\ldots &amp;{\alpha }^{n-2}&amp;{\alpha }^{n-1}\\ \alpha &amp;1&amp;\alpha &amp;\ldots &amp;{\alpha }^{n-3}&amp;{\alpha }^{n-2}\\ \vdots &amp;\vdots &amp;\vdots &amp;\ldots &amp;\vdots &amp;\vdots \\ {\alpha }^{n-2}&amp;{\alpha }^{n-3}&amp;{\alpha }^{n-4}&amp;\ldots &amp;1&amp;\alpha \\ {\alpha }^{n-1}&amp;{\alpha }^{n-2}&amp;{\alpha }^{n-3}&amp;\ldots &amp;\alpha &amp;1\end{array}\right)$$\end{document}</tex-math><mml:math id="M16"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mo>⊤</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mo>⋮</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd columnalign="left"><mml:mo>…</mml:mo></mml:mtd><mml:mtd columnalign="left"><mml:mi>α</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par27">This matrix is a special case of a Toeplitz matrix and is particularly known as Kac–Murdock–Szego matrix<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. The eigenvalues of such a Kac–Murdock–Szego matrix can be approximated as ref. <sup><xref ref-type="bibr" rid="CR37">37</xref></sup>:<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\lambda }_{i}=\frac{1-{\alpha }^{2}}{1+{\alpha }^{2}-2{\mathrm{cos}}\left(\frac{\left(i+1\right)\pi }{n+1}\right)\alpha }$$\end{document}</tex-math><mml:math id="M18"><mml:mrow><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi mathvariant="normal">cos</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mi>α</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math><graphic xlink:href="41587_2023_1663_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par28">The corresponding eigenvectors can either be estimated analytically<sup><xref ref-type="bibr" rid="CR38">38</xref></sup> or calculated by the numerical decomposition of the theoretical matrix.</p>
    </sec>
    <sec id="Sec13">
      <title>Preprocessing</title>
      <p id="Par29">We used a standard preprocessing pipeline as follows: first removing genes that are not expressed in any of the cells in our data, applying per-cell normalization by dividing each count by the total counts of that particular cell, applying log transformation and retaining only highly variable genes.</p>
      <p id="Par30">For the reconstruction algorithm, we scaled <italic>L</italic><sub>2</sub> of each cell to 1 to ensure that the circulant matrix has constant diagonal. For the gene inference algorithm, scaling <italic>L</italic><sub>2</sub> of each gene to 1 should be applied, as the score of each gene is relative to the rest of the genes. To estimate <italic>α</italic>, representing the correlation between neighbors according to the target topology, we search for the <italic>α</italic> value that best matches the spectrum of the given gene expression matrix. The results were improved by applying the algorithms after removing the theoretical covariance vector associated with the largest eigenvalue. For the cyclic case, the values of this eigenvector are constant.</p>
    </sec>
    <sec id="Sec14">
      <title>scPrisma general-case algorithm</title>
      <p id="Par31">
        <list list-type="order">
          <list-item>
            <p id="Par32">Choose the desired topology (for example, periodic/linear). Calculate the theoretical covariance eigenvectors and eigenvalues.</p>
          </list-item>
          <list-item>
            <p id="Par33">Preprocess the data.</p>
          </list-item>
          <list-item>
            <p id="Par34">Reconstruct the signal by reordering the gene expression rows by solving Problem 2 (below) or by using prior knowledge.</p>
          </list-item>
        </list>
      </p>
      <p id="Par35">Option 1—signal enhancement:<list list-type="alpha-lower"><list-item><p id="Par36">Infer informative genes by solving Problem 3 (below) or by using prior knowledge and remove the rest of the genes.</p></list-item><list-item><p id="Par37">Enhance the desired signal by solving Problem 4 (below).</p></list-item></list></p>
      <p id="Par38">Option 2—signal filtering:<list list-type="alpha-lower"><list-item><p id="Par39">Filter out the desired signal by solving Problem 5.</p></list-item></list></p>
    </sec>
    <sec id="Sec15">
      <title>Signal reconstruction</title>
      <p id="Par40">With a closed formula for the spectrum (<xref rid="Equ2" ref-type="disp-formula">2</xref>) and (<xref rid="Equ3" ref-type="disp-formula">3</xref>), we can estimate the pseudotime of the underlying cyclic trajectory. This can be done by estimating the rows reordering of the gene expression matrix that maximizes the projection over the theoretical spectrum. This problem can be formulated as a matrix permutation problem.</p>
      <sec id="FPar1">
        <title>Problem 1</title>
        <p id="Par41">Matrix permutation problem for estimating a pseudotime that maximizes the projection over the theoretical spectrum:<disp-formula id="Equa"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max E\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* (E* A)* {(E* A)}^{\rm {T}}* {\overrightarrow{v}}_{i}\\ &amp;{\mathrm{s.t}}\, \, E\in P\end{array}$$\end{document}</tex-math><mml:math id="M20"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>E</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi>E</mml:mi><mml:mo>∈</mml:mo><mml:mi>P</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where <italic>A</italic> is the original gene expression matrix, <inline-formula id="IEq5"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\overrightarrow{v}}_{i}$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq5.gif"/></alternatives></inline-formula> and <italic>λ</italic><sub><italic>i</italic></sub> are the theoretical eigenvectors and corresponding eigenvalues, respectively, and <italic>P</italic> is the set of permutation matrices. Under the assumption that <italic>A</italic> has a permutation <italic>Ẽ</italic> such that the spectrum of <inline-formula id="IEq6"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$({\tilde{\rm {E}}}*A)*({\tilde{\rm {E}}}*A)^{\rm{T}}$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">E</mml:mi></mml:mrow><mml:mrow><mml:mo>~</mml:mo></mml:mrow></mml:mover><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="normal">E</mml:mi></mml:mrow><mml:mrow><mml:mo>~</mml:mo></mml:mrow></mml:mover><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq6.gif"/></alternatives></inline-formula> matches the theoretical spectrum, the optimal solution is <italic>E</italic> = <italic>Ẽ</italic> (Supplementary Note <xref rid="MOESM1" ref-type="media">A.15)</xref>. Now, consider an identical formulation of the function we wish to maximize: <inline-formula id="IEq7"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathop{\sum }\nolimits_{i = 0}^{n-1}{\lambda }_{i}* {{\left\Vert {(E* A)}^{\rm{T}}* {\overrightarrow{v}}_{i}\right\Vert }_{2}^{2}}$$\end{document}</tex-math><mml:math id="M26"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq7.gif"/></alternatives></inline-formula>. This formula aims to maximize the product of each gene sorted by the permutation matrix and each theoretical eigenvector multiplied by its eigenvalue. These theoretical eigenvectors, as they are the eigenvectors of the theoretical covariance matrix, represent the variance along the theoretical topology. As a result, the permutation which maximizes this objective maximizes the variance along the theoretical topology.</p>
        <p>Permutation problems are known to be NP-Hard<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>. We will follow previous studies in solving a convex relaxation of this problem, and instead of searching for a permutation matrix, we will search for a doubly stochastic matrix (the Birkhoff polytope)<sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>:</p>
      </sec>
      <sec id="FPar2">
        <title>Problem 2</title>
        <p id="Par43">Convex relaxation of Problem 1:<disp-formula id="Equb"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max E\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* (E* A)* {(E* A)}^{\rm{T}}* {\overrightarrow{v}}_{i}\\ &amp;{\mathrm{s.t}}\, \, \,{\overrightarrow{1}}^{\rm{T}}* E=\overrightarrow{1},\\ &amp;E* \overrightarrow{1}=\overrightarrow{1}\end{array}$$\end{document}</tex-math><mml:math id="M28"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>E</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equb.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Here the objective function is quadratic and convex (Supplementary Note <xref rid="MOESM1" ref-type="media">A.16)</xref>. Despite the fact that maximizing it is not convex optimization, previous studies have shown that such problems can be efficiently resolved with stochastic gradient descent<sup><xref ref-type="bibr" rid="CR41">41</xref>,<xref ref-type="bibr" rid="CR42">42</xref></sup>. To project into the Birkhoff polytope, we used Bregmanian bi-stochastication algorithm<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. Finally, for rounding the doubly stochastic matrix to a permutation matrix, we used a simple greedy algorithm. Specifically, the algorithm iterates over all rows, for each row rounds the maximum entry in each column that does not have 1 value yet to 1 and rounds to 0 the rest of the entries. The output of this algorithm is the permuted gene expression matrix: <italic>A</italic><sub>ordered</sub> = <inline-formula id="IEq8"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$E*A$$\end{document}</tex-math><mml:math id="M30"><mml:mrow><mml:mi>E</mml:mi><mml:mo>*</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq8.gif"/></alternatives></inline-formula>.</p>
      </sec>
    </sec>
    <sec id="Sec16">
      <title>Genes inference</title>
      <p id="Par45">Once the reconstructed signal is obtained, either by solving Problem 2 or by prior knowledge, identification of informative genes that are related to the desired signal is possible. This can be achieved by filtering genes that do not maximize the projection over the theoretical spectrum. Because of convexity considerations, it would be easier to infer genes that are not related to the desired signal and then flip the results. Inference of the genes that are not related to the desired signal can be done by solving the following optimization problem:</p>
      <sec id="FPar3">
        <title>Problem 3</title>
        <p id="Par46">Genes inference:<disp-formula id="Equc"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \min D\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{T}* ({A}_{{\mathrm{ordered}}}* D)* {({A}_{{\mathrm{ordered}}}* D)}^{T}* {\overrightarrow{v}}_{i}-{\gamma * \left\Vert D\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,D\,\,{\mathrm{is}}\,\,{\mathrm{diagonal}}\\ &amp;0\le D\le I\end{array}$$\end{document}</tex-math><mml:math id="M32"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>min</mml:mi><mml:mi>D</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>D</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi>D</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">is</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">diagonal</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>D</mml:mi><mml:mo>≤</mml:mo><mml:mi>I</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Because genes are represented by columns of <italic>A</italic>, each entry on the diagonal of <italic>D</italic> represents the influence of the respective gene on the spectrum. The number of filtered genes can be controlled by adding regularization. We can either increase the regularization coefficient, <italic>γ</italic>, to filter fewer genes or decrease it to filter more genes. The output of this algorithm is the gene expression matrix, after nullifying the genes that are not informative relative to the signal: <italic>D</italic><sub>1</sub> = <italic>I</italic> − <italic>D</italic>, <italic>A</italic><sub>gene-inferred</sub> = <italic>A</italic><sub>ordered</sub> <inline-formula id="IEq9"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$*$$\end{document}</tex-math><mml:math id="M34"><mml:mo>*</mml:mo></mml:math><inline-graphic xlink:href="41587_2023_1663_Article_IEq9.gif"/></alternatives></inline-formula> <italic>D</italic><sub>1</sub>.</p>
      </sec>
    </sec>
    <sec id="Sec17">
      <title>Filtering and enhancement</title>
      <p id="Par48">After inferring the set of informative genes (the genes related to the reconstructed signal), the next step is to remove any information that is not related to the signal, from the expression of those genes. This can be achieved by removing the diagonal constraint from Problem 3 and replacing the matrix product by the Hadamard product (element-wise product). For every entry in the expression matrix, <italic>A</italic><sub><italic>i</italic>,<italic>j</italic></sub>, this formulation matches an optimization variable <italic>F</italic><sub><italic>i</italic>,<italic>j</italic></sub>. Therefore, the enhanced gene expression matrix contains only expression profiles that maximize the projection over the theoretic spectrum.</p>
      <sec id="FPar4">
        <title>Problem 4</title>
        <p id="Par49">Signal enhancement:<disp-formula id="Equd"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \max F\,\,\,\, \mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* ({A}_{{\mathrm{genes-inferred}}}\odot F)* {({A}_{{\mathrm{genes-inferred}}}\odot F)}^{\rm{T}}* {\overrightarrow{v}}_{i}-\gamma * {\left\Vert F\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,0\le {F}_{i,j}\le 1\,\,\,\forall \,i,j\end{array}$$\end{document}</tex-math><mml:math id="M36"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>max</mml:mi><mml:mi>F</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">genes-inferred</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">genes-inferred</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mo>∀</mml:mo><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>Because this problem is not a convex optimization problem, it can be solved by using stochastic gradient ascent (adding noise at each iteration<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>). The output of this algorithm is the gene expression matrix, after eliminating information that is unrelated to the signal of interest: <italic>A</italic><sub>enhanced</sub> = <italic>A</italic><sub>genes-inferred</sub> ⊙ <italic>F</italic>.</p>
        <p>Another option is similar to that described for Problem 3, which is to transform this problem into a minimization problem for filtering the reconstructed signal, thus turning it into a convex optimization problem (Supplementary Note <xref rid="MOESM1" ref-type="media">A.16)</xref>. Formulating this problem as a minimization problem eliminates the variance along the theoretical topology.</p>
      </sec>
      <sec id="FPar5">
        <title>Problem 5</title>
        <p id="Par52">Signal filtering:<disp-formula id="Eque"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{array}{ll}&amp;\arg \min F\,\,\,\,\mathop{\sum }\limits_{i=0}^{n-1}{\lambda }_{i}* {\overrightarrow{v}}_{i}^{\rm{T}}* ({A}_{{\mathrm{ordered}}}\odot F)* {({A}_{{\mathrm{ordered}}}\odot F)}^{\rm{T}}* {\overrightarrow{v}}_{i}-\gamma * {\left\Vert F\right\Vert }_{1}\\ &amp;{\mathrm{s.t}}\,\,\,0\le {F}_{i,j}\le 1\,\,\,\forall \,i,j\end{array}$$\end{document}</tex-math><mml:math id="M38"><mml:mtable><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi>arg</mml:mi><mml:mi>min</mml:mi><mml:mi>F</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>*</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msubsup><mml:mo>*</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ordered</mml:mi></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi></mml:mrow></mml:msup><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mfenced close="∥" open="∥"><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"/><mml:mtd columnalign="left"><mml:mi mathvariant="normal">s.t</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mo>∀</mml:mo><mml:mspace width="0.25em"/><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="41587_2023_1663_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
        <p>The output of this algorithm is the gene expression matrix, after eliminating the information that is related to the signal of interest: <italic>A</italic><sub>filtered</sub> = <italic>A</italic><sub>ordered</sub> ⊙ <italic>F</italic>.</p>
      </sec>
    </sec>
    <sec id="Sec18">
      <title>Reporting summary</title>
      <p id="Par54">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec id="Sec19" sec-type="materials|methods">
    <title>Online content</title>
    <p id="Par55">Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests and statements of data and code availability are available at 10.1038/s41587-023-01663-5.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec21">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41587_2023_1663_MOESM1_ESM.pdf">
            <label>Supplementary Information</label>
            <caption>
              <p>Supplementary Notes A.1–A.16, Figs. 1–10, and References.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41587_2023_1663_MOESM2_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41587_2023_1663_MOESM3_ESM.xlsx">
            <label>Supplementary Table 1</label>
            <caption>
              <p>List of gene regulatory interactions related to the circadian rhythm signal inferred by GRNBoost2 after cyclic enhancement by scPrisma.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41587_2023_1663_MOESM4_ESM.xlsx">
            <label>Supplementary Table 2</label>
            <caption>
              <p>List of cell–cell interactions related to the circadian rhythm signal inferred by CellPhoneDB after cyclic enhancement by scPrisma.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec20">
        <title>Extended data</title>
        <p id="Par60">
          <fig id="Fig6">
            <label>Extended Data Fig. 1</label>
            <caption>
              <title>scPrisma identifies and filters periodic signals in simulated data.</title>
              <p>(A) PCA representation and gene expression covariance matrix before and after applying the reconstruction algorithm. This was done over a simulated gene expression matrix (100 cells, 500 genes, w=0.3) encoding a cyclic signal according to the spatial model (Supplementary A.2). The covariance matrix, after applying the reconstruction algorithm, is circulant. (B) Spearman correlation between the ground-truth permutation and the predicted permutation as a function of SNR over 300 simulations. A cyclic signal was simulated similarly to (A), Gaussian noise was added with varying variance, while the expression matrix was clipped to be positive. (C) AUC-ROC of informative genes inference task as a function of SNR over 300 simulations, each consisting of a cyclic signal and a lineage signal (256 cells, 250 genes) that were concatenated to form a combined gene expression matrix (256 cells, 500 genes), supplemented by additive Gaussian noise. (D) Filtering and enhancement of cyclic signals in combined simulated data. The combined simulation consists of the sum of linear and cyclic signals (200 cells, 500 genes each), and a Gaussian noise matrix (variance = 0.1). (E) Boxplots comparing the filtering and enhancement algorithms of scPrisma with Cyclum over n=100 simulations of the combined signal as described in (D). For the box plots, the center line is the median, box limits are the 0.25 and 0.75 quantiles, vertical lines extend from the top of the box to indicate the maximum value, and from the bottom to indicate the minimum value.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig6_ESM" id="d32e3701"/>
          </fig>
        </p>
        <p id="Par61">
          <fig id="Fig7">
            <label>Extended Data Fig. 2</label>
            <caption>
              <title>Temporal filtering by scPrisma enhances cell type clustering of single-cell data.</title>
              <p>Analysis based on single-cell data of suprachiasmatic nucleus neurons<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. (A) Before temporal filtering, clusters ‘1’ and ‘3’ mostly contain cells that were sampled in CT=14/18/22 while cluster ‘4’ mostly contains cells that were sampled in CT=06/10. (B) However, following filtering, the corresponding clusters (now labeled ‘0’ and ‘2’) are well-mixed in terms of their temporal labels.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig7_ESM" id="d32e3719"/>
          </fig>
        </p>
        <p id="Par62">
          <fig id="Fig8">
            <label>Extended Data Fig. 3</label>
            <caption>
              <title>Enhancement and filtering by scPrisma of clustered structure in cellular populations.</title>
              <p>(A-C) Enhancement of clustered structure in the liver lobule scRNA-seq data<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>; (A) 2D PCA of raw (left) and cluster-based enhanced (right) data, highlighting the separation between samples that were collected during the night (ZT = 0, 18) and the day (ZT = 6, 12). (B) Mean (triangle) and variance (error bar) of <italic>Pck1</italic> expression as a function of circadian time, for raw (left) and cluster-based enhanced (right) data. At each time point, the sample size is N=1000. (C) 2D PCA colored by <italic>Pck1</italic> expression for raw (left) and cluster-based enhanced (right) data. (D,E) Filtering of clustered structure, leading to integration of pancreas scRNA-seq data collected from 4 different studies<sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup>; UMAPs of pre and post data integration, colored by (D) batch and (E) cell type.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig8_ESM" id="d32e3750"/>
          </fig>
        </p>
        <p id="Par63">
          <fig id="Fig9">
            <label>Extended Data Fig. 4</label>
            <caption>
              <title>Enhancement by scPrisma of synchronized periodic processes.</title>
              <p>Analysis based on SCN single-cell gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. (A-C) 2D PCA of ependymal and endothelial cells, for (A) raw and (B,C) cyclic-enhanced data, colored by (A,B) circadian sample time (left) and by cell type (right), and by (C) <italic>Dbp</italic> (left) and <italic>Hsp90ab1</italic> (right) expression.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig9_ESM" id="d32e3774"/>
          </fig>
        </p>
        <p id="Par64">
          <fig id="Fig10">
            <label>Extended Data Fig. 5</label>
            <caption>
              <title>Enhancement by scPrisma of unsynchronized periodic processes.</title>
              <p>Analysis based on SCN single-cell gene expression data<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. (A,B) 2D PCA of ependymal cells and SCN neurons, for (A) raw and (B) cyclic-enhanced data, colored by circadian sample time (left) and by cell type (right). (C,D) 2D tSNE of ependymal cells and SCN neurons, for cyclic-enhanced data, colored by circadian sample time (C; left), cell type (C; right), and <italic>Dbp</italic> expression (D). (E) Mean (triangle) and variance (error bar) of <italic>Dbp</italic> expression as a function of circadian time, which peaks at CT = 10 in ependymal cells (top), and peaks at CT = 2/6 in SCN neurons (bottom). The sample sizes at each time point (CT/N) for ependymal cells are: CT02/428, CT06/493, CT10/521, CT14/519, CT18/365 and CT22/480, and for SCN neurons they are: CT02/667, CT06/741, CT10/870, CT14/670, CT18/1375 and CT22/1029.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig10_ESM" id="d32e3798"/>
          </fig>
        </p>
        <p id="Par65">
          <fig id="Fig11">
            <label>Extended Data Fig. 6</label>
            <caption>
              <title>Spatial enhancement by scPrisma.</title>
              <p>Analysis based on Slide-seqV2 mouse hippocampus data <sup><xref ref-type="bibr" rid="CR32">32</xref></sup>(subsampled to 29,250 cells). Raw (left) and spatially-enhanced (right) gene expression of the top 3 spatially informative genes (based on Moran’s I score).</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig11_ESM" id="d32e3816"/>
          </fig>
        </p>
        <p id="Par66">
          <fig id="Fig12">
            <label>Extended Data Fig. 7</label>
            <caption>
              <title>Runtime and memory consumption analysis of scPrisma algorithms.</title>
              <p>Simulated cyclic signal of 2000 genes, varying number of cells, <italic>w</italic> = 0.3 and added Gaussian noise (variance=0.1), using a single GPU-‘NVIDIA RTX A5000’.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1663_Fig12_ESM" id="d32e3833"/>
          </fig>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <sec id="FPar6">
      <title>Extended data</title>
      <p id="Par56">is available for this paper at 10.1038/s41587-023-01663-5.</p>
    </sec>
    <sec id="FPar7" sec-type="supplementary-material">
      <title>Supplementary information</title>
      <p id="Par57">The online version contains supplementary material available at 10.1038/s41587-023-01663-5.</p>
    </sec>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank N. Moriel, Y. Constantini, Z. Piran, E. Memet and the rest of our group members, and R. Mintz, O. Karin, D. Shalev and I. Alon for meaningful discussions and feedback. We thank O. Mittelpunkt for assistance in the graphic design. This work was funded by the Center for Interdisciplinary Data Science Research at the Hebrew University of Jerusalem (J.K.), an Azrieli Foundation Early Career Faculty Fellowship, Israel Science Foundation Research Grant (1079/21) and the European Union (ERC, DecodeSC, 101040660) (M.N.). Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Research Council. Neither the European Union nor the granting authority can be held responsible for them.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>J.K. and M.N. conceived the study, designed the research and developed the framework; J.K. implemented the method and analyzed the data, with guidance from M.N.; Y.B. contributed to the theoretical analysis of linear signals; J.K. and M.N. wrote the paper.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar8">
      <title>Peer review information</title>
      <p id="Par58"><italic>Nature Biotechnology</italic> thanks Ken Chen, Feng Bao and the other, anonymous, reviewer(s) for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The scRNA-seq datasets used for this study were acquired from the Gene Expression Omnibus (GEO) database with the following accession numbers: HeLaS3 (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE142277">GSM4224315</ext-link>), liver (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE145197">GSE145197</ext-link>), <italic>Chlamydomonas</italic> (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE157580">GSE157580</ext-link>), SCN (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117295">GSE117295</ext-link>) and hESC (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE64016">GSE64016</ext-link>). Slide-seqV2 dataset of the mice hippocampus was generated from ref. <sup><xref ref-type="bibr" rid="CR32">32</xref></sup> and downloaded using Squidpy<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. Pancreas datasets were generated from refs. <sup><xref ref-type="bibr" rid="CR26">26</xref>–<xref ref-type="bibr" rid="CR29">29</xref></sup> and downloaded using Scanpy<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The code for scPrisma is publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/nitzanlab/scPrisma/">https://github.com/nitzanlab/scPrisma/</ext-link></p>
  </notes>
  <notes id="FPar9" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par59">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>AR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Quantitative assessment of single-cell RNA-sequencing methods</article-title>
        <source>Nat. Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>41</fpage>
        <lpage>46</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2694</pub-id>
        <?supplied-pmid 24141493?>
        <pub-id pub-id-type="pmid">24141493</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Karaiskos</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Gene expression cartography</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>576</volume>
        <fpage>132</fpage>
        <lpage>137</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1773-3</pub-id>
        <?supplied-pmid 31748748?>
        <pub-id pub-id-type="pmid">31748748</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jansen</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Building gene regulatory networks from scatac-seq and scRNA-seq using linked self organizing maps</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2019</year>
        <volume>15</volume>
        <fpage>e1006555</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1006555</pub-id>
        <?supplied-pmid 31682608?>
        <pub-id pub-id-type="pmid">31682608</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Plass</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell type atlas and lineage tree of a whole complex animal by single-cell transcriptomics</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>360</volume>
        <fpage>eaaq1723</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aaq1723</pub-id>
        <?supplied-pmid 29674432?>
        <pub-id pub-id-type="pmid">29674432</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Forrow</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schiebinger</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Lineageot is a unified framework for lineage tracing and trajectory inference</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>4940</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-25133-1</pub-id>
        <?supplied-pmid 34400634?>
        <pub-id pub-id-type="pmid">34400634</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reconstructing cell cycle pseudo time-series via single-cell transcriptome data</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>22</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-017-00039-z</pub-id>
        <?supplied-pmid 28630425?>
        <pub-id pub-id-type="pmid">28630425</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Barron</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Identifying and removing the cell-cycle effect from single-cell RNA-sequencing data</article-title>
        <source>Sci. Rep.</source>
        <year>2016</year>
        <volume>6</volume>
        <fpage>33892</fpage>
        <pub-id pub-id-type="doi">10.1038/srep33892</pub-id>
        <?supplied-pmid 27670849?>
        <pub-id pub-id-type="pmid">27670849</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>MP</given-names>
          </name>
        </person-group>
        <article-title>Revealing lineage-related signals in single-cell gene expression using random matrix theory</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2021</year>
        <volume>118</volume>
        <fpage>e1913931118</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1913931118</pub-id>
        <?supplied-pmid 33836557?>
        <pub-id pub-id-type="pmid">33836557</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liang</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Latent periodic process inference from single-cell RNA-seq data</article-title>
        <source>Nat. Commun.</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>1441</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-15295-9</pub-id>
        <?supplied-pmid 32188848?>
        <pub-id pub-id-type="pmid">32188848</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <?supplied-pmid 25867923?>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rojo</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Rojo</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Some results on symmetric circulant matrices and on symmetric centrosymmetric matrices</article-title>
        <source>Linear Algebra Appl.</source>
        <year>2004</year>
        <volume>392</volume>
        <fpage>211</fpage>
        <lpage>233</lpage>
        <pub-id pub-id-type="doi">10.1016/j.laa.2004.06.013</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schwabe</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Formichetti</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Junker</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Falcke</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>The transcriptome dynamics of single cells during the cell cycle</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2020</year>
        <volume>16</volume>
        <fpage>e9946</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20209946</pub-id>
        <?supplied-pmid 33205894?>
        <pub-id pub-id-type="pmid">33205894</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Jammalamadaka, S. R. &amp; Sengupta, A. <italic>Topics in Circular Statistics</italic> Vol. 5 (World Scientific, 2001).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Droin</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Space-time logic of liver gene expression at sub-lobular scale</article-title>
        <source>Nat. Metab.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>43</fpage>
        <lpage>58</lpage>
        <pub-id pub-id-type="doi">10.1038/s42255-020-00323-1</pub-id>
        <?supplied-pmid 33432202?>
        <pub-id pub-id-type="pmid">33432202</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Salomé</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Merchant</surname>
            <given-names>SS</given-names>
          </name>
          <name>
            <surname>Pellegrini</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing of batch Chlamydomonas cultures reveals heterogeneity in their diurnal cycle phase</article-title>
        <source>Plant Cell</source>
        <year>2021</year>
        <volume>33</volume>
        <fpage>1042</fpage>
        <lpage>1057</lpage>
        <pub-id pub-id-type="doi">10.1093/plcell/koab025</pub-id>
        <?supplied-pmid 33585940?>
        <pub-id pub-id-type="pmid">33585940</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Strenkert</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiomics resolution of molecular events during a day in the life of Chlamydomonas</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>2374</fpage>
        <lpage>2383</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1815238116</pub-id>
        <?supplied-pmid 30659148?>
        <pub-id pub-id-type="pmid">30659148</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatiotemporal single-cell analysis of gene expression in the mouse suprachiasmatic nucleus</article-title>
        <source>Nat. Neurosci.</source>
        <year>2020</year>
        <volume>23</volume>
        <fpage>456</fpage>
        <lpage>467</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-020-0586-x</pub-id>
        <?supplied-pmid 32066983?>
        <pub-id pub-id-type="pmid">32066983</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <mixed-citation publication-type="other">Caliński, T. &amp; Harabasz, J. A dendrite method for cluster analysis. <italic>Commun. Stat.</italic><bold>3</bold>, 1–27 (1974).</mixed-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moerman</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GRNBoost2 and Arboreto: efficient and scalable inference of gene regulatory networks</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>2159</fpage>
        <lpage>2161</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty916</pub-id>
        <?supplied-pmid 30445495?>
        <pub-id pub-id-type="pmid">30445495</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pett</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Kondoff</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bordyugov</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kramer</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Herzel</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Co-existing feedback loops generate tissue-specific circadian rhythms</article-title>
        <source>Life Sci. Alliance</source>
        <year>2018</year>
        <volume>1</volume>
        <fpage>e201800078</fpage>
        <pub-id pub-id-type="doi">10.26508/lsa.201800078</pub-id>
        <?supplied-pmid 30456356?>
        <pub-id pub-id-type="pmid">30456356</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AnimalTFDB 3.0: a comprehensive resource for annotation and prediction of animal transcription factors</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D33</fpage>
        <lpage>D38</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky822</pub-id>
        <?supplied-pmid 30204897?>
        <pub-id pub-id-type="pmid">30204897</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>YH</given-names>
          </name>
          <name>
            <surname>Lazar</surname>
            <given-names>MA</given-names>
          </name>
        </person-group>
        <article-title>Transcriptional control of circadian rhythms and metabolism: a matter of time and space</article-title>
        <source>Endocrine Rev.</source>
        <year>2020</year>
        <volume>41</volume>
        <fpage>707</fpage>
        <lpage>732</lpage>
        <pub-id pub-id-type="doi">10.1210/endrev/bnaa014</pub-id>
        <pub-id pub-id-type="pmid">32392281</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Time-of-day specificity of anticancer drugs may be mediated by circadian regulation of the cell cycle</article-title>
        <source>Sci. Adv.</source>
        <year>2021</year>
        <volume>7</volume>
        <fpage>eabd2645</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.abd2645</pub-id>
        <?supplied-pmid 33579708?>
        <pub-id pub-id-type="pmid">33579708</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Efremova</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Cellphonedb: inferring cell–cell communication from combined expression of multi-subunit ligand–receptor complexes</article-title>
        <source>Nat. Protoc.</source>
        <year>2020</year>
        <volume>15</volume>
        <fpage>1484</fpage>
        <lpage>1506</lpage>
        <pub-id pub-id-type="doi">10.1038/s41596-020-0292-x</pub-id>
        <?supplied-pmid 32103204?>
        <pub-id pub-id-type="pmid">32103204</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Segerstolpe</surname>
            <given-names>Å</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title>
        <source>Cell Metab.</source>
        <year>2016</year>
        <volume>24</volume>
        <fpage>593</fpage>
        <lpage>607</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cmet.2016.08.020</pub-id>
        <?supplied-pmid 27667667?>
        <pub-id pub-id-type="pmid">27667667</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baron</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>346</fpage>
        <lpage>360</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id>
        <?supplied-pmid 27667365?>
        <pub-id pub-id-type="pmid">27667365</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>YJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptomics of the human endocrine pancreas</article-title>
        <source>Diabetes</source>
        <year>2016</year>
        <volume>65</volume>
        <fpage>3028</fpage>
        <lpage>3038</lpage>
        <pub-id pub-id-type="doi">10.2337/db16-0405</pub-id>
        <?supplied-pmid 27364731?>
        <pub-id pub-id-type="pmid">27364731</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Muraro</surname>
            <given-names>MJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>385</fpage>
        <lpage>394</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id>
        <?supplied-pmid 27693023?>
        <pub-id pub-id-type="pmid">27693023</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polański</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>964</fpage>
        <lpage>965</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id>
        <?supplied-pmid 31400197?>
        <pub-id pub-id-type="pmid">31400197</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leng</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Oscope identifies oscillatory genes in unsynchronized single-cell RNA-seq experiments</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>947</fpage>
        <lpage>950</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3549</pub-id>
        <?supplied-pmid 26301841?>
        <pub-id pub-id-type="pmid">26301841</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stickels</surname>
            <given-names>RR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqv2</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>313</fpage>
        <lpage>319</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id>
        <?supplied-pmid 33288904?>
        <pub-id pub-id-type="pmid">33288904</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Santos</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wernersson</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jensen</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Cyclebase 3.0: a multi-organism database on cell-cycle regulation and phenotypes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2015</year>
        <volume>43</volume>
        <fpage>D1140</fpage>
        <lpage>D1144</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku1092</pub-id>
        <?supplied-pmid 25378319?>
        <pub-id pub-id-type="pmid">25378319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Colwell</surname>
            <given-names>LJ</given-names>
          </name>
        </person-group>
        <article-title>Power law tails in phylogenetic systems</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2018</year>
        <volume>115</volume>
        <fpage>690</fpage>
        <lpage>695</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1711913115</pub-id>
        <?supplied-pmid 29311320?>
        <pub-id pub-id-type="pmid">29311320</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <mixed-citation publication-type="other">Gray, R. M. <italic>Toeplitz and Circulant Matrices: A Review</italic> (Now, 2006).</mixed-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Demidenko</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Applications of symmetric circulant matrices to isotropic Markov chain models and electrical impedance tomography</article-title>
        <source>Adv. Pure Math.</source>
        <year>2017</year>
        <volume>7</volume>
        <fpage>188</fpage>
        <lpage>198</lpage>
        <pub-id pub-id-type="doi">10.4236/apm.2017.72010</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <mixed-citation publication-type="other">Grenander, U. &amp; Szegö, G. <italic>Toeplitz Forms and Their Applications</italic> (Univ. California Press, 1958).</mixed-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Trench, W. F. Spectral decomposition of Kac-Murdock-Szego matrices <ext-link ext-link-type="uri" xlink:href="https://works.bepress.com/william_trench/133/">https://works.bepress.com/william_trench/133/</ext-link> (2010).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Fogel, F., Jenatton, R., Bach, F. &amp; d’Aspremont, A. Convex relaxations for permutation problems. In <italic>Proc. 26th International Conference on Neural Information Processing Systems</italic> (eds Burges, C. J. C. et al.) 1016–1024 (Curran Associates Inc., 2013).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Wang, F., Li, P. &amp; Konig, A. C. Learning a bi-stochastic data similarity matrix. In <italic>Proc.</italic><italic>2010 IEEE International Conference on Data Mining</italic> 551–560 (IEEE, 2010).</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Shamir, O. Convergence of stochastic gradient descent for PCA. In <italic>Proc. 33rd International Conference on Machine Learning</italic> (eds Balcan, M. F. &amp; Weinberger, K. Q.) 257–265 (PMLR, 2016).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Zhang, L., Yang, T., Yi, J., Jin, R. &amp; Zhou, Z.-H. Stochastic optimization for kernel PCA. In <italic>Proc.</italic><italic>Thirtieth AAAI Conference on Artificial Intelligence</italic> 2316–2322 (AAAI Press, 2016).</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Daneshmand, H., Kohler, J., Lucchi, A. &amp; Hofmann, T. Escaping saddles with stochastic gradients. In <italic>Proc. 35th International Conference on Machine Learning</italic> (eds Dy, J. &amp; Krause, A.) 1155–1164 (PMLR, 2018).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Palla</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>171</fpage>
        <lpage>178</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id>
        <?supplied-pmid 35102346?>
        <pub-id pub-id-type="pmid">35102346</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Scanpy: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <?supplied-pmid 29409532?>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
