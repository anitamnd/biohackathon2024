<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nucleic Acids Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nucleic Acids Res</journal-id>
    <journal-id journal-id-type="publisher-id">nar</journal-id>
    <journal-title-group>
      <journal-title>Nucleic Acids Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0305-1048</issn>
    <issn pub-type="epub">1362-4962</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7544237</article-id>
    <article-id pub-id-type="pmid">32955565</article-id>
    <article-id pub-id-type="doi">10.1093/nar/gkaa740</article-id>
    <article-id pub-id-type="publisher-id">gkaa740</article-id>
    <article-categories>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI00010</subject>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>Narese/9</subject>
      </subj-group>
      <subj-group subj-group-type="heading">
        <subject>Methods Online</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SpaGE: Spatial Gene Enhancement using scRNA-seq</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-2719-5736</contrib-id>
        <name>
          <surname>Abdelaal</surname>
          <given-names>Tamim</given-names>
        </name>
        <aff><institution>Delft Bioinformatics Lab, Delft University of Technology</institution>, Delft 2628XE, <country country="NL">The Netherlands</country></aff>
        <aff><institution>Leiden Computational Biology Center, Leiden University Medical Center</institution>, Leiden 2333ZC, <country country="NL">The Netherlands</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mourragui</surname>
          <given-names>Soufiane</given-names>
        </name>
        <aff><institution>Delft Bioinformatics Lab, Delft University of Technology</institution>, Delft 2628XE, <country country="NL">The Netherlands</country></aff>
        <aff><institution>Computational Cancer Biology, Division of Molecular Carcinogenesis, Oncode Institute, the Netherlands Cancer Institute</institution>, Amsterdam 1066 CX, <country country="NL">The Netherlands</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-8601-2149</contrib-id>
        <name>
          <surname>Mahfouz</surname>
          <given-names>Ahmed</given-names>
        </name>
        <aff><institution>Delft Bioinformatics Lab, Delft University of Technology</institution>, Delft 2628XE, <country country="NL">The Netherlands</country></aff>
        <aff><institution>Leiden Computational Biology Center, Leiden University Medical Center</institution>, Leiden 2333ZC, <country country="NL">The Netherlands</country></aff>
        <aff><institution>Department of Human Genetics, Leiden University Medical Center</institution>, Leiden 2333ZC, <country country="NL">The Netherlands</country></aff>
        <xref ref-type="author-notes" rid="FN1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Reinders</surname>
          <given-names>Marcel J T</given-names>
        </name>
        <!--<email>m.j.t.reinders@tudelft.nl</email>-->
        <aff><institution>Delft Bioinformatics Lab, Delft University of Technology</institution>, Delft 2628XE, <country country="NL">The Netherlands</country></aff>
        <aff><institution>Leiden Computational Biology Center, Leiden University Medical Center</institution>, Leiden 2333ZC, <country country="NL">The Netherlands</country></aff>
        <aff><institution>Department of Human Genetics, Leiden University Medical Center</institution>, Leiden 2333ZC, <country country="NL">The Netherlands</country></aff>
        <xref ref-type="author-notes" rid="FN1"/>
        <xref ref-type="corresp" rid="COR1"/>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="COR1">To whom correspondence should be addressed. Tel: +31 15 2786424; Fax: +31 15 2786424; Email: <email>m.j.t.reinders@tudelft.nl</email></corresp>
      <fn id="FN1">
        <p>The authors wish it to be known that, in their opinion, the last two authors contributed equally.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <day>09</day>
      <month>10</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2020-09-21">
      <day>21</day>
      <month>9</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>21</day>
      <month>9</month>
      <year>2020</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>48</volume>
    <issue>18</issue>
    <fpage>e107</fpage>
    <lpage>e107</lpage>
    <history>
      <date date-type="accepted">
        <day>25</day>
        <month>8</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>30</day>
        <month>7</month>
        <year>2020</year>
      </date>
      <date date-type="received">
        <day>16</day>
        <month>5</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020. Published by Oxford University Press on behalf of Nucleic Acids Research.</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact <email>journals.permissions@oup.com</email></license-p>
      </license>
    </permissions>
    <self-uri xlink:href="gkaa740.pdf"/>
    <abstract>
      <title>Abstract</title>
      <p>Single-cell technologies are emerging fast due to their ability to unravel the heterogeneity of biological systems. While scRNA-seq is a powerful tool that measures whole-transcriptome expression of single cells, it lacks their spatial localization. Novel spatial transcriptomics methods do retain cells spatial information but some methods can only measure tens to hundreds of transcripts. To resolve this discrepancy, we developed SpaGE, a method that integrates spatial and scRNA-seq datasets to predict whole-transcriptome expressions in their spatial configuration. Using five dataset-pairs, SpaGE outperformed previously published methods and showed scalability to large datasets. Moreover, SpaGE predicted new spatial gene patterns that are confirmed independently using in situ hybridization data from the Allen Mouse Brain Atlas.</p>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Commission</institution>
            <institution-id institution-id-type="DOI">10.13039/501100000780</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>675743</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>H2020</institution>
            <institution-id institution-id-type="DOI">10.13039/100010661</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>861190</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>NWO TTW</institution>
          </institution-wrap>
        </funding-source>
        <award-id>17126</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>ZonMw</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001826</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>40-00812-98-16012</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>PPP allowance</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="16"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="SEC1">
    <title>INTRODUCTION</title>
    <p>Single cell technologies rapidly developed over the last decade and have become valuable tools for enhancing our understanding of biological systems. Single-cell RNA-sequencing (scRNA-seq) allows unbiased measurement of the entire gene expression profile of each individual cell and has become the <italic>de facto</italic> technology used to characterize the cellular composition of complex tissues (<xref rid="B1" ref-type="bibr">1</xref>,<xref rid="B2" ref-type="bibr">2</xref>). However, single cells often have to be dissociated before performing scRNA-seq and results in losing the spatial context and hence limits our understanding of cell identities and relationships. Recently, spatial transcriptomics technologies have advanced and provide localizations of gene expressions and cellular structure at the cellular level (<xref rid="B3" ref-type="bibr">3</xref>,<xref rid="B4" ref-type="bibr">4</xref>). Many current protocols can be divided in two categories: (i) imaging-based methods (e.g. osmFISH, MERFISH and seqFISH+) (<xref rid="B5" ref-type="bibr">5–7</xref>), and (ii) sequencing-based methods (e.g. STARmap and Slide-seq) (<xref rid="B8" ref-type="bibr">8</xref>,<xref rid="B9" ref-type="bibr">9</xref>). Imaging-based protocols have a high gene detection sensitivity; capturing high proportion of the mRNA molecules with relatively small dropout rate. While seqFISH+ and the latest generation of MERFISH can measure up to ∼10 000 genes (<xref rid="B7" ref-type="bibr">7</xref>,<xref rid="B10" ref-type="bibr">10</xref>), many different imaging-based protocols are often limited in the number of genes that can be measured simultaneously. On the other hand, sequencing-based protocols like STARmap can scale up to thousands of genes, it has a relatively lower gene detection sensitivity. Slide-seq is not limited in the number of measured genes and can be used to measure the whole transcriptome. However, similar to STARmap, Slide-seq suffers from a low gene detection sensitivity. In addition, osmFISH, MERFISH and STARmap can capture genes at the single-molecule resolution, which can be averaged or aggregated to the single-cell level. While Slide-seq has a resolution of 10μm, which is comparable to the average cell size, but does not always represent a single-cell.</p>
    <p>Given the complementary information provided by both scRNA-seq and spatial transcriptomics data, integrating both types would provide a more complete overview of cell identities and interactions within complex tissues. This integration can be performed in two different ways (<xref rid="B11" ref-type="bibr">11</xref>): (i) dissociated single-cells measured with scRNA-seq can be mapped to their physical locations in the tissue (<xref rid="B12" ref-type="bibr">12–14</xref>), or (ii) missing gene expression measurements in the spatial data can be predicted from scRNA-seq. In this study, we focus on the second challenge in which measured gene expressions of spatial cells can be enhanced by predicting the expression of unmeasured genes based on scRNA-seq data of a matching tissue. Several methods have addressed this problem using various data integration approaches to account for the differences between the two data types (<xref rid="B15" ref-type="bibr">15–18</xref>). All these methods rely on joint dimensionality reduction methods to embed both spatial and scRNA-seq data into a common latent space. For example, Seurat uses canonical correlation analysis (CCA), Liger uses non-negative matrix factorization (NMF), and Harmony uses principal component analysis (PCA). While Seurat, Liger and Harmony rely on linear methods to embed the data, gimVI uses a non-linear deep generative model. Despite recent benchmarking efforts (<xref rid="B19" ref-type="bibr">19</xref>), a comprehensive evaluation of these methods for the task of spatial gene prediction from dissociated cells is currently lacking. For example, Seurat, Liger and gimVI, have only been tested using relatively small datasets (&lt;2,000 cells) (<xref rid="B15" ref-type="bibr">15</xref>,<xref rid="B16" ref-type="bibr">16</xref>,<xref rid="B18" ref-type="bibr">18</xref>). It is thus not clear whether a complex model, like gimVI, is really necessary. Moreover, Seurat, Harmony and gimVI lack interpretability of the integration procedure, so that it does not become clear which genes contribute in the prediction task.</p>
    <p>Here, we present SpaGE (Spatial Gene Enhancement), a robust, scalable and interpretable machine-learning method to predict unmeasured genes of each cell in spatial transcriptomic data through integration with scRNA-seq data from the same tissue. SpaGE relies on domain adaptation using PRECISE (<xref rid="B20" ref-type="bibr">20</xref>) to correct for differences in sensitivity of transcript detection between both single-cell technologies, followed by a <italic>k</italic>-nearest-neighbor (kNN) prediction of new spatial gene expression. We demonstrate that SpaGE outperforms state-of-the-art methods by accurately predicting unmeasured gene expression profiles across a variety of spatial and scRNA-seq dataset pairs of different regions in the mouse brain. These datasets include a large spatial data with &gt;60,000 cells, used to illustrate the scalability and computational efficiency of SpaGE compared to other methods.</p>
  </sec>
  <sec sec-type="materials|methods" id="SEC2">
    <title>MATERIALS AND METHODS</title>
    <sec id="SEC2-1">
      <title>SpaGE algorithm</title>
      <p>The SpaGE algorithm takes as input two gene expression matrices corresponding to the scRNA-seq data (reference) and the spatial transcriptomics data (query). Based on the set of shared genes between the two datasets, SpaGE enriches the spatial transcriptomics data using the scRNA-seq data, by predicting the expression of spatially unmeasured genes. The SpaGE algorithm can be divided in two major steps: (i) alignment of the two datasets using the domain adaptation algorithm PRECISE (<xref rid="B20" ref-type="bibr">20</xref>), and (ii) gene expression prediction using <italic>k</italic>-nearest-neighbor regression.</p>
      <p>First, PRECISE was used to project both datasets into a common latent space. Let <inline-formula><tex-math id="M13">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${R_{( {n\ \times \ g} )}}$\end{document}</tex-math></inline-formula> be the gene expression matrix of the reference dataset having <inline-formula><tex-math id="M14">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$n$\end{document}</tex-math></inline-formula> cells and <italic>g</italic> genes, and let <inline-formula><tex-math id="M15">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${Q_{( {m\ \times \ h} )}}$\end{document}</tex-math></inline-formula> be the gene expression matrix of the query dataset having <italic>m</italic> cells and <italic>h</italic> genes. Using the set of shared genes <inline-formula><tex-math id="M16">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$p\ = \ g\ \cap h$\end{document}</tex-math></inline-formula>, PRECISE applies independent Principal Component Analysis (PCA) for each dataset to define two independent sets of Principal Components (<italic>PCs</italic>), such that:<disp-formula id="M1"><label>(1)</label><tex-math id="M17">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{R_{\left( {n{\rm{ }} \times p} \right)}} = {R^{\prime}_{\left( {n\, \times \,d} \right)}}P{C_{r\left( {d \times p} \right)}}\,{\rm{with }}\,P{C_r}PC_r^T = {I_d}\end{equation*}$$\end{document}</tex-math></disp-formula>and<disp-formula id="M2"><label>(2)</label><tex-math id="M18">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{Q_{\left( {m{\rm{ }} \times p} \right)}} = {Q^{\prime}_{\left( {m\, \times \,d} \right)}}P{C_{q\left( {d \times p} \right)}}\,{\rm{with }}\,P{C_q}PC_q^T = {I_d}\end{equation*}$$\end{document}</tex-math></disp-formula>where <italic>d</italic> is the number of desired <italic>PCs</italic>, <italic>PC<sub>r</sub></italic> and <italic>PC<sub>q</sub></italic> represents the principal components of the reference and the query datasets, respectively. We choose <italic>d</italic> = 50 for the <bold>STARmap_AllenVISp, MERFISH_Moffit and seqFISH_AllenVISp</bold> dataset pairs, and <italic>d</italic> = 30 for all the <bold>osmFISH</bold> dataset pairs. Next, PRECISE compares these independent <italic>PCs</italic> by computing the cosine similarity matrix and decomposing it by SVD (<xref rid="B21" ref-type="bibr">21</xref>):<disp-formula id="M3"><label>(3)</label><tex-math id="M19">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}P{C_r}\ P{C_q}^T = \ U\Sigma {V^T}\end{equation*}$$\end{document}</tex-math></disp-formula>where <italic>U</italic> and <italic>V</italic> represent orthogonal (of size <italic>d</italic>) transformations on the reference and query <italic>PCs</italic>, respectively, and Σ is a diagonal matrix. <italic>U</italic> and <italic>V</italic> are then used to align the <italic>PCs</italic>, yielding the so-called Principal Vectors (<italic>PVs</italic>), such that:<disp-formula id="M4"><label>(4)</label><tex-math id="M20">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}P{V_r} = {U^T}\ P{C_r}\end{equation*}$$\end{document}</tex-math></disp-formula>and<disp-formula id="M5"><label>(5)</label><tex-math id="M21">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}\ P{V_q} = {V^T}\ P{C_q}\end{equation*}$$\end{document}</tex-math></disp-formula></p>
      <p><italic>PV<sub>r</sub></italic> and <italic>PV<sub>q</sub></italic> are the principal vectors of the reference and the query datasets, respectively, retaining the same information as the principal components. However, these <italic>PVs</italic> have now a one-to-one correspondence as their cosine similarity matrix is diagonal (the matrix Σ). <italic>PVs</italic> are pairs of vectors <inline-formula><tex-math id="M22">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$( {PV_r^1,PV_q^1} ),\ \ldots ,\ ( {PV_r^d,PV_q^d} )$\end{document}</tex-math></inline-formula> sorted in decreasing order based on similarity. To remove noisy components, we choose a limited number of <italic>PVs</italic>, <italic>d′</italic>, for further analysis, where the cosine similarity is higher than a certain threshold (0.3). The reference <italic>PVs</italic>, <italic>PV<sub>r</sub></italic>, are then used to project and align both the scRNA-seq (reference) and the spatial transcriptomics (query) datasets:<disp-formula id="M6"><label>(6)</label><tex-math id="M23">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{R_{aligned\ \left( {n\ \times \ d^{\prime}} \right)}} = \ {R_{\left( {n\ \times \ p} \right)}}PV_{r\ \left( {p\ \times \ d^{\prime}} \right)}^T\end{equation*}$$\end{document}</tex-math></disp-formula>and<disp-formula id="M7"><label>(7)</label><tex-math id="M24">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{Q_{aligned\ \left( {m\ \times \ d^{\prime}} \right)}} = \ {Q_{\left( {m\ \times \ p} \right)}}PV_{r\ \left( {p\ \times \ d^{\prime}} \right)}^T\end{equation*}$$\end{document}</tex-math></disp-formula></p>
      <p>After aligning the datasets, SpaGE predicts the expression of the spatially unmeasured genes, <inline-formula><tex-math id="M25">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$l\ = \ g - p$\end{document}</tex-math></inline-formula>, from the scRNA-seq dataset. For each spatial cell <inline-formula><tex-math id="M26">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$i\ \in m$\end{document}</tex-math></inline-formula>, we define the <italic>k</italic>-nearest-neighbors (<italic>k</italic> = 50) from the <italic>n</italic> dissociated scRNA-seq cells, using the cosine distance. Next, we calculate an array of weights <inline-formula><tex-math id="M27">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${w_{ij}}$\end{document}</tex-math></inline-formula> between spatial cell <italic>i</italic> and its nearest neighbors <inline-formula><tex-math id="M28">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$j\ \in NN( i )$\end{document}</tex-math></inline-formula>. Out of the 50 neighbors, we only keep neighbors with positive cosine similarity with cell <italic>i</italic> (i.e. cosine distance &lt; 1), such that:<disp-formula><tex-math id="M29">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}\forall \ j\ \in NN\left( i \right)\ and\ dist\left( {i,j} \right) &lt; 1\end{equation*}$$\end{document}</tex-math></disp-formula><disp-formula id="M8"><label>(8)</label><tex-math id="M30">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}\ {w_{ij}} = \ 1 - \ \frac{{dist\left( {i,j} \right)}}{{\mathop \sum \nolimits_j dist\left( {i,j} \right)}}\end{equation*}$$\end{document}</tex-math></disp-formula><disp-formula id="M9"><label>(9)</label><tex-math id="M31">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{w_{ij}} = \frac{{{w_{ij}}}}{{length\left( {{w_{ij}}} \right) - 1}}\end{equation*}$$\end{document}</tex-math></disp-formula></p>
      <p>The predicted expression <inline-formula><tex-math id="M32">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${Y_{il}}$\end{document}</tex-math></inline-formula> of the set of spatially unmeasured genes <italic>l</italic> for cell <italic>i</italic> is calculated as a weighted average of the nearest neighbors dissociated cells:<disp-formula id="M10"><label>(10)</label><tex-math id="M33">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{Y_{il}} = \sum\limits_{\begin{array}{@{}*{1}{c}@{}} {j \in NN\left( i \right)}\\ {dist\left( {i,j} \right) &lt; 1} \end{array}} {{w_{ij}}*{R_{jl}}} \end{equation*}$$\end{document}</tex-math></disp-formula></p>
    </sec>
    <sec id="SEC2-2">
      <title>Gene contribution to the integration</title>
      <p>To evaluate the contribution of each gene in forming this common latent space <inline-formula><tex-math id="M34">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$P{V_r}$\end{document}</tex-math></inline-formula>, we calculated the gene contribution <italic>C<sub>g</sub></italic> of gene <italic><sub>g</sub></italic> as follows:<disp-formula id="M11"><label>(11)</label><tex-math id="M35">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{C_g} = \ \sum\nolimits_{i\ = \ 1}^{d^{\prime}} {\beta _{gi}^2} \end{equation*}$$\end{document}</tex-math></disp-formula>where <inline-formula><tex-math id="M36">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${\beta _{gi}}$\end{document}</tex-math></inline-formula> is the loading of gene <italic>g</italic> to the <italic>i</italic>-th principal vector in <italic>PV<sub>r</sub></italic>, and <italic>d′</italic> is the final number of <italic>PVs</italic> in <italic>PV<sub>r</sub></italic>. To obtain the top contributing genes, the <italic>C<sub>g</sub></italic> values are sorted in descending order across all genes. We used the same criteria to calculate the contribution of each gene for dataset-specific <italic>PCs</italic> or <italic>PVs</italic>.</p>
    </sec>
    <sec id="SEC2-3">
      <title>Datasets</title>
      <p>We used six dataset pairs (Table <xref rid="tbl1" ref-type="table">1</xref>) composed of four scRNA-seq datasets (<bold>AllenVISp</bold> (<xref rid="B22" ref-type="bibr">22</xref>), <bold>AllenSSp</bold> (<xref rid="B23" ref-type="bibr">23</xref>), <bold>Zeisel</bold> (<xref rid="B24" ref-type="bibr">24</xref>) and <bold>Moffit</bold> (<xref rid="B4" ref-type="bibr">4</xref>)) and four spatial transcriptomics datasets (<bold>STARmap</bold> (<xref rid="B8" ref-type="bibr">8</xref>), <bold>osmFISH</bold> (<xref rid="B5" ref-type="bibr">5</xref>), <bold>MERFISH</bold> (<xref rid="B4" ref-type="bibr">4</xref>) and <bold>seqFISH+</bold> (<xref rid="B7" ref-type="bibr">7</xref>)). The <bold>AllenVISp</bold> (GSE115746) and the <bold>AllenSSp</bold> datasets were downloaded from <ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/atlases-and-data/rnaseq">https://portal.brain-map.org/atlases-and-data/rnaseq</ext-link>. The <bold>AllenVISp</bold> is obtained from the ‘Cell Diversity in the Mouse Cortex – 2018’ release. The <bold>AllenSSp</bold> is obtained from the ‘Cell Diversity in the Mouse Cortex and Hippocampus’ release of October 2019. We downloaded the whole dataset and used the metadata to only select cells from the SSp region. The <bold>Zeisel</bold> dataset (GSE60361) was downloaded from <ext-link ext-link-type="uri" xlink:href="http://linnarssonlab.org/cortex/">http://linnarssonlab.org/cortex/</ext-link>, while the <bold>Moffit</bold> 10X dataset (GSE113576) was downloaded from GEO.</p>
      <table-wrap id="tbl1" orientation="portrait" position="float">
        <label>Table 1.</label>
        <caption>
          <p>Summary of the dataset pairs used in this study</p>
        </caption>
        <table frame="hsides" rules="groups">
          <thead>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th colspan="3" align="center" rowspan="1">Spatial data</th>
              <th colspan="3" align="center" rowspan="1">scRNA-seq data</th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1">Spatial_scRNA-seq dataset pair</th>
              <th rowspan="1" colspan="1"># of cells</th>
              <th rowspan="1" colspan="1"># of genes</th>
              <th rowspan="1" colspan="1">Tissue</th>
              <th rowspan="1" colspan="1"># of cells</th>
              <th rowspan="1" colspan="1"># of genes</th>
              <th rowspan="1" colspan="1">Tissue</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">STARmap_AllenVISp (<xref rid="B8" ref-type="bibr">8</xref>,<xref rid="B22" ref-type="bibr">22</xref>)</td>
              <td rowspan="1" colspan="1">1,549</td>
              <td rowspan="1" colspan="1">1,020</td>
              <td rowspan="1" colspan="1">VISc</td>
              <td rowspan="1" colspan="1">14,249</td>
              <td rowspan="1" colspan="1">34,617</td>
              <td rowspan="1" colspan="1">VISc</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">osmFISH_Zeisel (<xref rid="B5" ref-type="bibr">5</xref>,<xref rid="B24" ref-type="bibr">24</xref>)</td>
              <td rowspan="1" colspan="1">3,405</td>
              <td rowspan="1" colspan="1">33</td>
              <td rowspan="1" colspan="1">SMSc</td>
              <td rowspan="1" colspan="1">1,691</td>
              <td rowspan="1" colspan="1">15,075</td>
              <td rowspan="1" colspan="1">SMSc</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">osmFISH_AllenSSp (<xref rid="B5" ref-type="bibr">5</xref>,<xref rid="B23" ref-type="bibr">23</xref>)</td>
              <td rowspan="1" colspan="1">3,405</td>
              <td rowspan="1" colspan="1">33</td>
              <td rowspan="1" colspan="1">SMSc</td>
              <td rowspan="1" colspan="1">5,577</td>
              <td rowspan="1" colspan="1">30,527</td>
              <td rowspan="1" colspan="1">SMSc</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">osmFISH_AllenVISp (<xref rid="B5" ref-type="bibr">5</xref>,<xref rid="B22" ref-type="bibr">22</xref>)</td>
              <td rowspan="1" colspan="1">3,405</td>
              <td rowspan="1" colspan="1">33</td>
              <td rowspan="1" colspan="1">SMSc</td>
              <td rowspan="1" colspan="1">14,249</td>
              <td rowspan="1" colspan="1">34,617</td>
              <td rowspan="1" colspan="1">VISc</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">MERFISH_Moffit (<xref rid="B4" ref-type="bibr">4</xref>)</td>
              <td rowspan="1" colspan="1">64,373</td>
              <td rowspan="1" colspan="1">155</td>
              <td rowspan="1" colspan="1">POR</td>
              <td rowspan="1" colspan="1">31,299</td>
              <td rowspan="1" colspan="1">18,646</td>
              <td rowspan="1" colspan="1">POR</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">seqFISH_AllenVISp (<xref rid="B7" ref-type="bibr">7</xref>,<xref rid="B22" ref-type="bibr">22</xref>)</td>
              <td rowspan="1" colspan="1">524</td>
              <td rowspan="1" colspan="1">10,000</td>
              <td rowspan="1" colspan="1">Cortex</td>
              <td rowspan="1" colspan="1">14,249</td>
              <td rowspan="1" colspan="1">34,617</td>
              <td rowspan="1" colspan="1">VISc</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="T1TFN1">
            <p>VISc: Visual cortex; SMSc: Somatosensory cortex; POR: Pre-optic region</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>The <bold>STARmap</bold> dataset was downloaded from the STARmap resources website (<ext-link ext-link-type="uri" xlink:href="https://www.starmapresources.com/data">https://www.starmapresources.com/data</ext-link>). We obtained the gene count matrix and the cell position information for the largest 1020-gene replicate. Cell locations and morphologies were identified using Python code provided by the original study (<ext-link ext-link-type="uri" xlink:href="https://github.com/weallen/STARmap">https://github.com/weallen/STARmap</ext-link>). The <bold>osmFISH</bold> dataset was downloaded as loom file from <ext-link ext-link-type="uri" xlink:href="http://linnarssonlab.org/osmFISH/">http://linnarssonlab.org/osmFISH/</ext-link>, we obtained the gene count matrix and the metadata using the loompy Python package. The <bold>MERFISH</bold> dataset was downloaded from Dryad repository (<ext-link ext-link-type="doi" xlink:href="10.5061/dryad.8t8s248">https://doi.org/10.5061/dryad.8t8s248</ext-link>), we used the first naïve female mouse (Animal_ID = 1). The <bold>seqFISH+</bold> dataset was obtained from the seqFISH-PLUS GitHub repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/CaiGroup/seqFISH-PLUS">https://github.com/CaiGroup/seqFISH-PLUS</ext-link>), we used the gene count matrix of the mouse cortex dataset.</p>
    </sec>
    <sec id="SEC2-4">
      <title>Data preprocessing</title>
      <p>For all the scRNA-seq datasets, we filtered out genes expressed in less than 10 cells. No filtration was applied on the cells, except for the <bold>AllenVISp</bold> dataset for which we filtered low quality cells provided from the metadata (‘Low Quality’ and ‘No Class’ cells). For the <bold>Zeisel</bold> dataset, we only used the somatosensory cortex cells excluding the hippocampus cells. Next, scRNA-seq datasets were normalized by dividing the counts within each cell by the total number of transcripts within that cell, scaling by 10<sup>6</sup> and log1p transformed. Further, we scaled the data by making each gene centered and scaled (zero mean and unit variance) using the SciPy Python package (<xref rid="B25" ref-type="bibr">25</xref>).</p>
      <p>For spatial transcriptomics datasets all gene were used, except for the <bold>MERFISH</bold> dataset for which we removed the blanks genes and the <italic>Fos</italic> gene (non-numerical values). Additionally, we filtered out cells labeled as ‘Ambiguous’ from the <bold>MERFISH</bold> dataset. Similar to the <bold>Zeisel</bold> dataset, we only kept cells from cortical regions for the <bold>osmFISH</bold> dataset (‘Layer 2–3 lateral’, ‘Layer 2–3 medial’, ‘Layer 3–4’, ‘Layer 4’, ’Layer 5’, ‘Layer 6’ and ‘Pia Layer 1’). For the <bold>seqFISH+</bold> dataset, we only used the cells from the ‘Cortex’ region. No cells were filtered from the <bold>STARmap</bold> dataset. Further, each dataset was normalized by dividing the counts within each cell by the total number of transcripts within that cell, scaling by the median number of transcripts per cell, and log1p transformed. Similar to the scRNA-seq data, we scaled the spatial data using the SciPy Python package (<xref rid="B25" ref-type="bibr">25</xref>).</p>
      <p>It is important to note that in all experiments, the scaled datasets are used as input for the alignment part, while the prediction is applied using the normalized version of the scRNA-seq dataset (Equation <xref ref-type="disp-formula" rid="M10">10</xref>).</p>
    </sec>
    <sec id="SEC2-5">
      <title>Cross validation</title>
      <p>We evaluated the prediction performance of all methods using a leave-one-gene-out cross validation. For a set of <italic>N</italic> shared genes between the spatial and the scRNA-seq datasets, one gene is left out and the remaining <italic>N</italic>-1 genes are used for integration and prediction of the left-out gene. The prediction is then evaluated by comparing the measured and predicted spatial profiles of the left-out-gene.</p>
      <p>For the <bold>STARmap_AllenVISp</bold> dataset pair, we applied a more challenging cross validation setup. Similar to the leave-one-gene-out setup, for a set of <italic>N</italic> shared genes, one gene is left out to be predicted. From the remaining <italic>N −</italic> 1 genes, we excluded the 100 genes that are most correlated (absolute Pearson correlation) with the left-out gene. The remaining <italic>N −</italic> 101 genes are then used for the integration and prediction of the left-out gene.</p>
    </sec>
    <sec id="SEC2-6">
      <title>Benchmarked methods</title>
      <p>We compared the performance of SpaGE versus three state-of-the-art methods for data integration: Seurat, Liger, and gimVI. Seurat and Liger are available as R packages, while gimVI is available through the scVI Python package (<xref rid="B26" ref-type="bibr">26</xref>). We were not able to include Harmony in the comparison, as the code to predict unmeasured gene expression is not available. During the benchmark, all methods were applied using their default settings, or the settings provided in the accompanying examples or vignettes. Data normalization and scaling were performed using the built-in functions in each package, <italic>NormalizeData</italic> and <italic>ScaleData</italic> functions in Seurat, <italic>normalize</italic> and <italic>scaleNotCenter</italic> functions in Liger, while gimVI implicitly preprocess the data while computing.</p>
    </sec>
    <sec id="SEC2-7">
      <title>Moran's I statistic</title>
      <p>The Moran's I statistic (<xref rid="B27" ref-type="bibr">27</xref>) is a measure of spatial autocorrelation calculated for each spatial gene. The Moran's I values can range from −1 to 1, where a value close to 1 indicates a clear spatial pattern, and a value close to 0 indicates random spatial expression, while a value close to −1 indicated a chess board like pattern. We calculated the Moran's I using the following equation:<disp-formula id="M12"><label>(12)</label><tex-math id="M37">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}I\ = \ \frac{N}{W}\frac{{\mathop \sum \nolimits_i \mathop \sum \nolimits_j {w_{ij}}\ \left( {{x_i} - \ \bar{x}} \right)\left( {{x_j} - \ \bar{x}} \right)}}{{\mathop \sum \nolimits_i {{\left( {{x_i} - \ \bar{x}} \right)}^2}}}\end{equation*}$$\end{document}</tex-math></disp-formula>where <italic>x</italic> is the gene expression array, <inline-formula><tex-math id="M38">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\bar{x}$\end{document}</tex-math></inline-formula> is the mean expression of gene <italic>x</italic>, <italic>N</italic> is the total number of spatial cells, <inline-formula><tex-math id="M39">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${w_{ij}}$\end{document}</tex-math></inline-formula> is a matrix containing spatial weights with zeros on the diagonal, and <italic>W</italic> is the sum of <inline-formula><tex-math id="M40">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${w_{ij}}$\end{document}</tex-math></inline-formula>. We calculated the spatial weights <inline-formula><tex-math id="M41">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}${w_{ij}}$\end{document}</tex-math></inline-formula> using the <italic>XY</italic> coordinates of the spatial cells, for each cell we calculated the kNN using the spatial coordinates (<italic>k</italic> = 4). We assigned <inline-formula><tex-math id="M42">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\ {w_{ij}} = {\rm{ }}1$\end{document}</tex-math></inline-formula> if <italic>j</italic> is in the nearest neighbors of <italic>i</italic>, otherwise <inline-formula><tex-math id="M43">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\ {w_{ij}} = {\rm{ }}0$\end{document}</tex-math></inline-formula>.</p>
    </sec>
    <sec id="SEC2-8">
      <title>Down-sampling</title>
      <p>For the 994 shared genes in the <bold>STARmap_AllenVISp</bold> dataset pair, we first selected the top 50 spatial genes with high Moran's I statistic values to be used as test set. For the remaining 944 genes, we calculated the pairwise Pearson correlation using the scRNA-seq dataset. If the absolute value of the correlation of two genes is larger than 0.7, we removed the gene with the lower variance. After removing highly correlated genes, we sorted the remaining genes according to their expression variance in the scRNA-seq dataset. We selected the top 10, 30, 50, 100, 200 and 500 genes with high variance, these genes were used for alignment of the two datasets and prediction of the expression of the test genes. The prediction performance of these gene sets was compared with using all 944 genes.</p>
      <p>We applied the same down-sampling criteria on the 9,751 shared genes in the <bold>seqFISH_AllenVISp</bold> dataset pair, except for two differences: (i) the 50 spatial genes used as test set were selected as the top predicted genes in the leave-one-gene-out cross validation experiment, (ii) after removing correlated genes, we selected sets of the top 10, 30, 50, 100, 200, 500, 1000, 2000, 5000 and 7000 most variable genes, as well as all 9,701 genes.</p>
    </sec>
    <sec id="SEC2-9">
      <title>Cell-type marker genes</title>
      <p>To evaluate the performance of SpaGE per cell type, we defined sets of marker genes for four major brain cell types: Inhibitory neurons, Excitatory neurons, Astrocytes and Oligodendrocytes. The marker genes of the <bold>osmFISH</bold> dataset were directly obtained from the original paper (<xref rid="B5" ref-type="bibr">5</xref>). For the <bold>STARmap</bold> and <bold>MERFISH</bold> datasets, we used the <italic>FindMarkers</italic> function from the Seurat R package to define the top 20 differentially expressed genes per cell type, comparing one cell type vs the rest using a two-sided Wilcoxon rank sum test and the Bonferroni method for multiple test correction, with min.pct = 0.25 and logfc.threshold = 0.25.</p>
    </sec>
    <sec id="SEC2-10">
      <title>A model to predict trustworthiness of the SpaGE prediction</title>
      <p>To determine whether we can trust a predicted spatial pattern by SpaGE, we trained a logistic regression model that predicts the trustworthiness of the predicted signal from four characteristics of the data: (i) the Moran's I statistic of the predicted spatial gene expression <inline-formula><tex-math id="M44">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$( {pM{I_i}} )$\end{document}</tex-math></inline-formula>, (ii) the mean <italic>μ<sub>i</sub></italic> and (iii) variance <italic>σ<sub>i</sub></italic> of the expression of that gene in the scRNA-seq data and (iv) the percentage of cells expressing that gene in the scRNA-seq data <inline-formula><tex-math id="M45">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$( {{e_i}} )$\end{document}</tex-math></inline-formula>. The trustworthiness, <italic>Y<sub>i</sub></italic>, used to train the model, is determined from the Spearman correlation between the SpaGE-predicted spatial pattern and the measured spatial pattern, i.e. correlations above the median correlation are considered to be trustworthy. This gives the following logistic regression model:<disp-formula><tex-math id="M46">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$$\begin{equation*}{Y_i}\ \sim \ pM{I_i}\ + \ {\mu _i} + \ {\sigma _i}\ + \ {e_i}\end{equation*}$$\end{document}</tex-math></disp-formula></p>
      <p>Note that the inputs to the model can be determined without the need to have access to the measured spatial expression of the gene, and consequently the model can be used to evaluate whether the predicted spatial pattern of expression of an unmeasured spatial gene is to be trusted or not.</p>
    </sec>
  </sec>
  <sec sec-type="results" id="SEC3">
    <title>RESULTS</title>
    <sec id="SEC3-1">
      <title>SpaGE overview</title>
      <p>We developed SpaGE, a platform that enhances the spatial transcriptomics data by predicting the expression of unmeasured genes from a dissociated scRNA-seq data from the same tissue (Figure <xref ref-type="fig" rid="F1">1</xref>). Based on the set of shared genes, we align both datasets using the domain adaptation method PRECISE (<xref rid="B20" ref-type="bibr">20</xref>), to account for technical differences as well as gene detection sensitivity differences. PRECISE geometrically aligns linear latent factors computed on each dataset and finds gene combinations expressed in both datasets. These gene combinations thus define a common latent space and can be used to jointly project both datasets. Next, in this common latent space, we use the kNN algorithm to define the neighborhood of each cell in the spatial data from the scRNA-seq cells. These neighboring scRNA-seq cells are then used to predict the expression of spatially unmeasured genes. Finally, we end up with the full gene expression profile of each cell in the spatial data.</p>
      <fig id="F1" orientation="portrait" position="float">
        <label>Figure 1.</label>
        <caption>
          <p><bold>SpaGE pipeline</bold>. SpaGE takes as input two datasets, a scRNA-seq dataset and a spatial transcriptomics dataset measured from the same tissue. SpaGE uses gene combinations of equal significance in both datasets to predict spatial locations of unmeasured genes. Using PRECISE, SpaGE finds directions that are important for both datasets, by making use of a geometrical alignment of the independent <italic>PCs</italic> to produce the <italic>PVs</italic>. SpaGE aligns both datasets by projecting on the <italic>PVs</italic> of the reference dataset. Using the aligned datasets, SpaGE applies kNN prediction to define new gene expression patterns for spatially unmeasured genes, predicted from the dissociated scRNA-seq data. Each spatial cell can be enhanced by having the expression of the whole transcriptome.</p>
        </caption>
        <graphic xlink:href="gkaa740fig1"/>
      </fig>
      <p>The alignment step is the most crucial step in the pipeline of SpaGE. For this purpose, we use PRECISE, a domain adaptation method previously proposed to predict the drug response of human tumors based on pre-clinical models such as cell lines and mouse models. We adapted PRECISE to the task of integrating the spatial data with the scRNA-seq data by defining the common aligned subspace between both datasets (Figure <xref ref-type="fig" rid="F1">1</xref>). PRECISE takes as input the expression matrix of both datasets, having the same set of (overlapping) genes but measured differently and within different cells. As we are aiming to fit each spatial cell to the most similar scRNA-seq cells, we may refer to the spatial dataset as the ‘query’ and the scRNA-seq dataset as the ‘reference’. First, PRECISE obtains a lower dimensional space for each dataset separately using a linear dimensionality reduction method, such as Principal Component Analysis (PCA). Next, the two independent sets of principal components (<italic>PCs</italic>) are aligned by applying a singular value decomposition. We align the two sets of principal components using the singular vectors to obtain the aligned components, named principal vectors (<italic>PVs</italic>). These <italic>PVs</italic> are sorted in decreasing order based on their similarity between the reference and the query datasets. This allows us to filter out dissimilar or noisy signals, by discarding <italic>PVs</italic> with relatively low similarity, thus keeping only the common latent space (Methods). The principal vectors of the reference dataset <inline-formula><tex-math id="M47">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$( {P{V_r}} )$\end{document}</tex-math></inline-formula> are considered as the aligned latent space. We project both datasets on <inline-formula><tex-math id="M48">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$P{V_r}$\end{document}</tex-math></inline-formula> to obtain the new aligned versions used for the kNN prediction.</p>
      <p>We performed SpaGE on six dataset pairs from different regions in the mouse brain, varying in the number of cells and the number of spatially measured genes, summarized in Table <xref rid="tbl1" ref-type="table">1</xref>. To show the alignment performance, we calculated the cosine similarity between the <italic>PCs</italic> and the <italic>PVs</italic>, i.e. before and after the alignment. Across all six dataset pairs, we observed that indeed the relation between the <italic>PCs</italic> is not one-to-one, as these <italic>PCs</italic> are obtained from two different datasets (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S1 and S2</xref>). However, after alignment using PRECISE, the diagonal cosine similarity between the <italic>PVs</italic> is maximized showing a one-to-one relationship between the <italic>PVs</italic> of both datasets. <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S1A</xref> shows the diagonal cosine similarity before and after PRECISE (i.e. between <italic>PCs</italic> and <italic>PVs</italic>) across all dataset pairs, showing a relatively large increase in similarity after the alignment using PRECISE. As we used only the informative <italic>PVs</italic>, the final number of <italic>PVs</italic> varied across datasets (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref>) and, as a result, the amount of explained variance for each dataset varied, from ∼6% for the <bold>seqFISH+</bold> dataset to ∼94% for the <bold>osmFISH</bold> dataset.</p>
      <p>Another interesting feature of SpaGE is the ability to interpret the most contributing genes defining the latent integration space (Methods). In general, these genes are highly variable and in most cases are related to cell type differences. A good example is the integration of the <bold>osmFISH_Zeisel</bold> dataset pair, in which the top six contributing genes are <italic>Tmem2</italic>, <italic>Mrc1</italic>, <italic>Kcnip2</italic>, <italic>Foxj1</italic>, <italic>Apln</italic> and <italic>Syt6</italic>. These genes are related to six different cell categories previously defined in the <bold>osmFISH</bold> paper (<xref rid="B5" ref-type="bibr">5</xref>): Oligodendrocytes, Immune cells, Inhibitory neurons, Ventricle, Vasculature and Excitatory neurons, respectively.</p>
      <p>We further illustrate the quality of the alignment by examining the overlap in the top contributing genes for the <italic>PCs</italic> (before PRECISE) and the <italic>PVs</italic> (after PRECISE). Using the <bold>STARmap_AllenVISp</bold> dataset pair, we obtained the top 50 contributing genes for the <italic>PCs</italic> of the <bold>STARmap</bold> data and the <italic>PCs</italic> of the <bold>AllenVISp</bold> data. These two sets shared only 2 genes out of 50. After alignment, the shared genes, between the top 50 contributing genes for the <italic>PVs</italic> of the <bold>STARmap</bold> data and the <italic>PVs</italic> of the <bold>AllenVISp</bold> data, increased to 12 genes. Also, we applied GO enrichment on these top contributing gene sets in each case using PANTHER (<ext-link ext-link-type="uri" xlink:href="http://pantherdb.org/">http://pantherdb.org/</ext-link>, Fisher exact test with Bonferroni multiple test correction). The <bold>STARmap</bold><italic>PCs</italic> and the <bold>AllenVISp</bold><italic>PCs</italic> had 9 enriched biological processes each, sharing 3 processes in common (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>). While the <bold>STARmap</bold><italic>PVs</italic> and the <bold>AllenVISp</bold><italic>PVs</italic> had 27 and 41 enriched biological processes, respectively, sharing 12 processes in common. Interestingly many of them related are to regulation processes, such as regulation of biological process, cell population proliferation, metabolic processes, cell motility, locomotion and cellular component movement.</p>
    </sec>
    <sec id="SEC3-2">
      <title>SpaGE outperforms state-of-the-art methods on the STARmap dataset</title>
      <p>Using the first dataset pair <bold>STARmap_AllenVISp</bold>, we applied SpaGE to integrate both datasets and predict unmeasured spatial gene expression patterns. In order to evaluate the prediction, we performed a leave-one-gene-out cross validation (Methods). The <bold>STARmap_AllenVISp</bold> dataset pair shares 994 genes. In each cross-validation fold, one gene is left out and the remaining 993 genes are used as input for SpaGE to predict the spatial expression pattern of the left-out gene. We evaluated the prediction performance by calculating the Spearman correlation between the original measured spatially distributed values and the predicted values of the left-out gene. We performed the same leave-one-gene-out cross validation using Seurat, Liger and gimVI, to benchmark the performance of SpaGE. Results show a significant improvement in performance for SpaGE compared to all three methods (<italic>P</italic>-value &lt; 0.05, two-sided paired Wilcoxon rank sum test), with a median Spearman correlation of 0.125 compared to 0.083, 0.067 and 0.035 for Seurat, Liger and gimVI, respectively (Figure <xref ref-type="fig" rid="F2">2A</xref>).</p>
      <fig id="F2" orientation="portrait" position="float">
        <label>Figure 2.</label>
        <caption>
          <p><bold>Prediction performance comparison for the STARmap_AllenVISp dataset pair</bold>. (<bold>A</bold>) Boxplots showing the Spearman correlations for the leave-one-gene-out cross validation experiment for each method. The blue lines show the median correlation across all genes with a better performance for SpaGE. The green dots show the correlation values for individual genes. The <italic>P</italic>-values show the significant difference between all correlation values of SpaGE and each other method, using a paired Wilcoxon rank-sum test. (<bold>B−D</bold>) Detailed performance comparison between SpaGE and (<bold>B</bold>) Seurat, (<bold>C</bold>) Liger, (<bold>D</bold>) gimVI. These scatter plots show the correlation value of each gene across two methods. The solid black line is the <italic>y</italic> = <italic>x</italic> line, the dashed lines show the zero correlation. Points are colored according to the Moran's I statistic of each gene. All scatter plots show that the majority of the genes are skewed above the <italic>y</italic> = <italic>x</italic> line, showing an overall better performance of SpaGE over other methods. (<bold>E</bold>) Predicted expression of known spatially patterned genes in the <bold>STARmap</bold> dataset. Each row corresponds to a single gene having a clear spatial pattern. First column from the left shows the measured spatial gene expression in the <bold>STARmap</bold> dataset, while other columns show the corresponding predicted expression pattern by SpaGE, Seurat, Liger and gimVI, using the leave-one-gene-out cross validation experiment. Prediction is performed using the <bold>AllenVISp</bold> dataset.</p>
        </caption>
        <graphic xlink:href="gkaa740fig2"/>
      </fig>
      <p>Further, we compared the Spearman correlation of SpaGE versus the state-of-the-art methods per gene, to obtain a detailed evaluation. Results show better performance of SpaGE across the majority of genes, but not all (Figure <xref ref-type="fig" rid="F2">2</xref>B−D). Next, we visually compared a few genes that had high correlations for each method. For the top three predicted genes of SpaGE (<italic>Pcsk2</italic>, <italic>Pgm2l1</italic> and <italic>Egr1</italic>), Seurat obtained a good prediction as well, as these three genes are in the top 10 predicted genes of Seurat. Liger failed to predict <italic>Egr1</italic>, while gimVI failed to predict <italic>Pgm2l1</italic> and <italic>Egr1</italic> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S3A</xref>). We further looked for examples where other methods obtained higher correlations than SpaGE, excluding the top 10 predicted genes by SpaGE. Compared to Seurat, SpaGE similarly predicted the expression of <italic>Arpp19</italic>, but predicted relatively higher contrast patterns for <italic>Pcp4</italic> and <italic>Arc</italic> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S3B</xref>). Compared to Liger, SpaGE similarly predicted the expression of <italic>Mobp</italic>, higher contrast pattern for <italic>Hpcal4</italic>, and better predicted the spatial pattern of <italic>Tsnax</italic> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S3C</xref>). Compared to gimVI, SpaGE predicted a lower contrast pattern for <italic>Arx</italic>, a higher contrast pattern for <italic>Snurf</italic>, but failed to reproduce the measured spatial pattern for <italic>Bcl6</italic> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S3D</xref>). Remarkably, the predicted spatial patterns of SpaGE, for all three genes, are more in agreement with the data from the Allen Brain Atlas, suggesting that these genes were not accurately measured in the <bold>STARmap</bold> dataset.</p>
      <p>Although the correlation values are in general low, SpaGE is capable of accurately reconstructing genes with clear spatial pattern in the brain. Figure <xref ref-type="fig" rid="F2">2E</xref> shows a set of genes known to have spatial patterns (previously reported by Seurat, Liger and gimVI). In this set of genes, Seurat and Liger are performing well, except that Liger produced a lower contrast expression pattern in some cases (e.g. <italic>Lamp5</italic> and <italic>Bsg</italic>). gimVI produced good prediction for <italic>Lamp5</italic>, however, gimVI was not able to predict the correct gene patterns for the other genes.</p>
      <p>To obtain a better understanding and interpretation of these correlation values, we evaluated the effect of the kNN algorithm on the prediction performance. To do so, we divided the <bold>AllenVISp</bold> dataset into two stratified folds ensuring an equal composition of cell types. We used one-fold to predict genes in the other fold using the shared genes. Note that this does not require an alignment (PRECISE), so we can test the influence of the kNN regression. We applied a leave-one-gene-out cross validation using the same set of 994 shared genes of the <bold>STARmap_AllenVISp</bold> dataset pair, which resulted in a median Spearman correlation of 0.551 (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S4A</xref>). While the performance is clearly better compared to that of SpaGE using the <bold>STARmap_AllenVISp</bold> dataset pair (median Spearman correlation = 0.125), it shows that the kNN regression is partially responsible for reduced correlation values.</p>
      <p>To investigate the influence of the correlation metric, we tested also the Pearson and Kendall correlation measures, which showed that the highest correlation values are obtained when using the Spearman correlation (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S4B</xref>). Next, we were interested how well SpaGE could predict when there was no difference between measurement modalities (here, spatial and scRNA-seq). Therefore, we used SpaGE to integrate the <bold>Zeisel</bold> and <bold>AllenSSp</bold> datasets, representing two scRNA-seq measured datasets from the same brain region. Using the leave-one-gene-out cross validation and the same shared genes of the <bold>STARmap_AllenVISp</bold> dataset pair, we obtained a median Spearman correlation of 0.303 (query: <bold>Zeisel</bold>, reference: <bold>AllenSSp</bold>) and 0.331 (query: <bold>AllenSSp</bold>, reference: <bold>Zeisel</bold>) (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S4B</xref>). These correlation values suggest that the observed correlation values obtained when applying SpaGE on spatial and scRNA-seq datasets are not as low as they appear.</p>
      <p>Additionally, although it is important to accurately predict the expression of all genes, genes with distinct spatial patterns are more important to accurately predict compared to non- or randomly expressed genes. To quantify the existence of spatial patterns, we calculate the Moran's I statistic of each gene using the original <bold>STARmap</bold> spatial data (Methods). We compared the prediction performance of each gene with the corresponding Moran's I value. For SpaGE, Seurat and Liger, we observed a positive relationship between the prediction performance and the Moran's I values, i.e. genes with spatial patterns are better predicted (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S5A−C</xref>). On the other hand, gimVI performed worse on genes with high Moran's I statistic (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S5D</xref>).</p>
      <p>Further, we evaluated the prediction performance of all methods using a more challenging cross validation setup. Compared to the (traditional) leave-one-gene-out setup, the left-out gene is predicted using less shared genes in this set up, i.e. we removed the (100) most correlated genes with the left-out gene from the training set (Methods). This more challenging evaluation did result in comparable prediction performance to the leave-one-gene-out setup, with roughly the same differences and ranking across all methods (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S6A</xref>). In addition, we evaluated how well a gene can be predicted when using less shared genes in general. First, we selected a fixed test set of 50 genes, next we down-sampled the remaining set of 944 shared genes in a guided manner (Methods). For down-sampled shared genes sets of 10, 30, 50, 100, 200, 500 and all 944 genes, SpaGE performance always increases with the number of shared genes as expected (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S6B</xref>).</p>
    </sec>
    <sec id="SEC3-3">
      <title>SpaGE predicts unmeasured spatial gene patterns that are independently validated</title>
      <p>After validating SpaGE to accurately predict the spatially measured genes, we applied SpaGE to predict new unmeasured genes for the spatial data, with the aim to define novel spatial gene patterns. We illustrate SpaGE’s capability of such task using the <bold>STARmap_AllenVISp</bold> dataset pair. First, during the leave-one-gene-out cross validation, SpaGE was able to produce the correct spatial pattern for <italic>Rorb</italic>, <italic>Syt6</italic> and <italic>Tbr1</italic> (Figure <xref ref-type="fig" rid="F3">3</xref>). These three genes were originally under-expressed, possibly due technical noise or low gene detection sensitivity in the <bold>STARmap</bold> dataset. Our predictions using SpaGE are in agreement with the highly sensitive cyclic smFISH dataset (<bold>osmFISH</bold> (<xref rid="B5" ref-type="bibr">5</xref>)) measured from the mouse somatosensory cortex, a similar brain region in terms of layering structure to the visual cortex measured by the <bold>STARmap</bold> dataset. Further, using SpaGE, we were able to obtain novel spatial gene patterns for five genes not originally measured by the <bold>STARmap</bold> dataset, showing clear patterns through the cortical layers (Figure <xref ref-type="fig" rid="F4">4</xref>). These predicted patterns are supported by the Allen Brain Atlas <italic>in-situ</italic> hybridization (ISH).</p>
      <fig id="F3" orientation="portrait" position="float">
        <label>Figure 3.</label>
        <caption>
          <p><bold>SpaGE accurately predicted the expression of <italic>Rorb</italic>, <italic>Syt6</italic> and <italic>Tbr1</italic> in agreement with the osmFISH data</bold>. These three genes (shown in rows) were wrongly measured in the original <bold>STARmap</bold> data (shown in the left column). Using the <bold>STARmap_AllenVISp</bold> dataset pair, SpaGE was able to reconstruct the correct spatial gene expression patterns (middle column). These predicted patterns are in agreement with the measured gene expression patterns measure by the <bold>osmFISH</bold> dataset (right column), a highly sensitive single-molecule technology.</p>
        </caption>
        <graphic xlink:href="gkaa740fig3"/>
      </fig>
      <fig id="F4" orientation="portrait" position="float">
        <label>Figure 4.</label>
        <caption>
          <p><bold>Novel gene expression patterns for five genes not originally measured by the STARmap dataset, validated using the Allen Brain Atlas <italic>in-situ</italic> hybridization ISH</bold>. The left column shows the predicted spatial patterns using SpaGE for these five genes (shown in rows). The middle column shows the Allen Brain Atlas ISH data for each gene, stating the image ID on top of each tissue section. The red rectangle highlights the corresponding brain region measured by the <bold>STARmap</bold> dataset. The right column shows a zoomed-in view of the region highlighted using this red rectangle, showing an agreement with the expression patterns predicted by SpaGE.</p>
        </caption>
        <graphic xlink:href="gkaa740fig4"/>
      </fig>
      <p>To quantitatively evaluate the predicted spatial patterns for non-measured genes, we trained a logistic regression model to estimate whether a predicted spatial gene expression can be trusted or not (Methods). We used three statistical features from the scRNA-seq data, in addition to the Moran's I statistic of the <italic>predicted</italic> spatial pattern. When training this model, we used the Spearman correlation between the SpaGE-predicted spatial pattern and the measured spatial pattern to determine whether a gene can be trusted or not, i.e. we assumed that correlations above the median correlation are trustworthy. Using the 994 shared genes of the <bold>STARmap_AllenVISp</bold> dataset pair, we obtained an average accuracy of 0.71 for a stratified 2-fold cross validation. Next, we trained the model using all genes and applied it to the estimated gene patterns in Figures <xref ref-type="fig" rid="F3">3</xref> and <xref ref-type="fig" rid="F4">4</xref>. This model judged the predicted patterns of <italic>Rorb</italic>, <italic>Tbr1</italic>, <italic>Tesc</italic>, <italic>Pvlr3</italic> and <italic>Rora</italic>, trustworthy, and the patterns for <italic>Syt6</italic>, <italic>Chst8</italic> and <italic>Cdh24</italic> were not. Interestingly, when inspecting the model's coefficients we found that the Moran's I statistic of the predicted spatial pattern had the largest contribution.</p>
    </sec>
    <sec id="SEC3-4">
      <title>SpaGE predictions improve with deeply sequenced reference dataset</title>
      <p>We wanted to test the effect of changing the reference scRNA-seq data on the spatial gene expression prediction. Here, we used the <bold>osmFISH</bold> dataset which represents a different challenge compared to the <bold>STARmap</bold> dataset. On one hand, the <bold>osmFISH</bold> dataset has a relatively higher gene detection sensitivity, but on the other hand, the <bold>osmFISH</bold> dataset includes only 33 genes. First, we evaluated the <bold>osmFISH_Zeisel</bold> dataset pair, in which we integrated the <bold>osmFISH</bold> dataset with a reference scRNA-seq dataset from the same lab (<xref rid="B24" ref-type="bibr">24</xref>). We performed leave-one-gene-out cross validation similar to the <bold>STARmap</bold> dataset. Compared to other methods, SpaGE has significantly better performance (<italic>P</italic>-value &lt;0.05, two-sided paired Wilcoxon rank sum test), with a median Spearman correlation of 0.203 compared to 0.007, 0.090 and 0.133 for Seurat, Liger and gimVI, respectively (Figure <xref ref-type="fig" rid="F5">5A</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S7A</xref>). For a more detailed comparison per gene: SpaGE is performing better on the majority of genes compared to Liger and gimVI, while compared to Seurat, SpaGE has better performance across all genes (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S7B−D</xref>). We further investigated the relation between the prediction performance and the Moran's I statistic of the originally measured genes. Similar to the <bold>STARmap</bold> data, for SpaGE and Seurat, we found a positive relationship, i.e. the performance is higher for genes with distinct spatial patterns. However, Liger and gimVI have a negative relationship (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S8</xref>).</p>
      <fig id="F5" orientation="portrait" position="float">
        <label>Figure 5.</label>
        <caption>
          <p><bold>Prediction performance comparison for the osmFISH dataset using different reference scRNA-seq datasets</bold>. (<bold>A</bold>) Boxplots showing the Spearman correlations for the leave-one-gene-out cross validation experiment for each method using four different scRNA-seq datasets, <bold>Zeisel</bold>, <bold>AllenVISp</bold>, <bold>AllenSSp</bold> and <bold>AllenSSp_Downsampled</bold>. The median correlations shows a better performance for SpaGE in all dataset pairs. The black dots show the correlation values for individual genes. The <italic>P</italic>-values are obtained using a paired Wilcoxon rank-sum test. SpaGE showed a performance improvement when using the <bold>AllenVISp</bold> over the <bold>Zeisel</bold> data. Although the median correlation is the same, the overall correlation range did improve. Also, gimVI clearly benefits from using the <bold>AllenVISp</bold> and the <bold>AllenSSp</bold> datasets over the <bold>Zeisel</bold> dataset. All methods have decreased performance when using the <bold>AllenSSp_Downsampled</bold> data compared to the original <bold>AllenSSp</bold> data. (<bold>B</bold>) Predicted expression of known spatially patterned genes in the <bold>osmFISH</bold> dataset using different reference scRNA-seq datasets. Each row corresponds to a single gene having a clear spatial pattern. First column from the left shows the measured spatial gene expression in the <bold>osmFISH</bold> dataset, while the second, third and fourth columns show the corresponding predicted expression pattern by SpaGE using <bold>Zeisel</bold>, <bold>AllenVISp</bold> and <bold>AllenSSp</bold> datasets, respectively. Changing from <bold>Zeisel</bold> to <bold>AllenVISp</bold> (deeply sequenced data) improved the prediction, while matching the brain region using the <bold>AllenSSp</bold> improved the prediction further.</p>
        </caption>
        <graphic xlink:href="gkaa740fig5"/>
      </fig>
      <p>Next, we tested the performance of all methods using the <bold>AllenVISp</bold> dataset as reference for the <bold>osmFISH</bold> dataset, similar to the <bold>STARmap</bold> dataset. For the <bold>osmFISH_AllenVISp</bold> dataset pair, we observed similar conclusions where SpaGE has significantly better performance compared to other methods, with a median Spearman correlation of 0.203 compared to 0.014, 0.082 and 0.162 for Seurat, Liger and gimVI, respectively (Figure <xref ref-type="fig" rid="F5">5A</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S9A</xref>). SpaGE has better performance across all genes compared to Seurat and Liger, while gimVI is performing better on a few genes (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S9B−D</xref>). All four methods have a positive relationship between their prediction performance and the Moran's I statistic of the measured genes (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S10</xref>). These results show how the reference dataset can affect the prediction. Compared to the <bold>Zeisel</bold> dataset, the <bold>AllenVISp</bold> is more deeply sequenced data, with the average number of detected transcripts per cell being ∼140× more than the <bold>Zeisel</bold> dataset (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S11A, B</xref>). However, not all methods benefit from this, as for Seurat and Liger, the prediction performance using the <bold>AllenVISp</bold> or the <bold>Zeisel</bold> datasets is quite similar (Figure <xref ref-type="fig" rid="F5">5A</xref>). On the other hand, SpaGE and gimVI get an increase in performance across all genes, although the median correlation for SpaGE remains the same. Similar to the <bold>STARmap</bold> dataset, we tested the performance of the kNN regression within the <bold>AllenVISp</bold> dataset only (excluding the alignment procedure), when using only the 33 genes of the <bold>osmFISH</bold> dataset. In this case, we obtained a median correlation of 0.289 (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S4A</xref>), when predicting the expression of genes in the scRNA-seq data from one-fold to the other, which is slightly higher than SpaGE (0.203) predicting <bold>osmFISH</bold> patterns. This result shows that the alignment of the spatial and scRNA-seq data using SpaGE is performing well, as the overall performance is comparable with predictions within the same dataset.</p>
      <p>While the <bold>AllenVISp</bold> is a deeply sequenced reference dataset, it has been measured from a different brain region than the <bold>osmFISH</bold> dataset (Table <xref rid="tbl1" ref-type="table">1</xref>). Therefore, we decided to use a third reference dataset, <bold>AllenSSp</bold>, which has roughly the same sequencing depth as the <bold>AllenVISp</bold> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S11B, C</xref>) but is measured from the somatosensory cortex, similar to the <bold>osmFISH</bold> dataset. We evaluated the prediction performance of all four tools for the new dataset pair <bold>osmFISH_AllenSSp</bold>. SpaGE obtained a better performance with a median Spearman correlation of 0.199 compared to 0.006 and 0.077 for Seurat and Liger, respectively, while gimVI has similar performance to SpaGE with a median Spearman correlation of 0.199 (Figure <xref ref-type="fig" rid="F5">5A</xref>, <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S12A</xref>). SpaGE has a better performance across almost all genes compared to Seurat and Liger, while gimVI performed better than SpaGE for nearly half the genes (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S12B–D</xref>). SpaGE, Liger and gimVI have positive relationship between the prediction performance and Moran's I statistic. However, Seurat has a negative relationship (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S13</xref>).</p>
      <p>Several sources of variation do exist between the <bold>Allen</bold> datasets and the <bold>Zeisel</bold> dataset; besides the sequencing depth, these datasets are, for example, generated in different labs and using different sequencing protocols. To separately test the effect of the sequencing depth of the reference scRNA-seq data on the prediction performance, we downsampled the <bold>AllenSSp</bold> dataset to a comparable number of transcripts per cell as the <bold>Zeisel</bold> dataset, using the scuttle R package. Compared to the original <bold>AllenSSp</bold> dataset, we obtained lower prediction performance across all methods when using the downsampled dataset (Figure <xref ref-type="fig" rid="F5">5A</xref>), clearly showing that a deeply sequenced reference dataset produces a better prediction. Interestingly, compared to the <bold>Zeisel</bold> dataset, the median performance using the downsampled <bold>AllenSSp</bold> dataset was lower for SpaGE, Seurat and Liger, but higher for gimVI.</p>
      <p>Changing the brain region did not affect the overall performance of SpaGE (Figure <xref ref-type="fig" rid="F5">5A</xref>), however, the prediction of genes with known patterns did improve (Figure <xref ref-type="fig" rid="F5">5B</xref>). When we visually inspect these genes, we can clearly observe that the predicted spatial pattern improved when the reference dataset had a higher sequencing depth, or was obtained from a similar tissue. <italic>Rorb</italic> and <italic>Tbr1</italic> are clear examples, where the prediction using <bold>Zeisel</bold> was almost missing the correct pattern, this became clearer using the <bold>AllenVISp</bold> having a greater sequencing depth. Changing to a matching tissue adds further improves the predicted patterns of these genes (<bold>AllenSSp</bold>). Eventually, all five genes (<italic>Lamp5</italic>, <italic>Kcnip2</italic>, <italic>Rorb</italic>, <italic>Tbr1</italic> and <italic>Syt6</italic>) are more accurately predicted using the <bold>AllenSSp</bold> dataset. Moreover, we used the <bold>AllenSSp</bold> reference dataset to predict the spatial expression of 10 genes not originally measured by the <bold>osmFISH</bold> dataset, with clear patterns through the cortical layers (Figure <xref ref-type="fig" rid="F6">6</xref>). These predicted patterns are in agreement with the Allen Brain Atlas <italic>in-situ</italic> hybridization (ISH).</p>
      <fig id="F6" orientation="portrait" position="float">
        <label>Figure 6.</label>
        <caption>
          <p><bold>Novel gene expression patterns for 10 genes not originally measured by the osmFISH dataset, validated using the Allen Brain Atlas <italic>in-situ</italic> hybridization ISH</bold>. The left column shows the predicted spatial patterns using SpaGE for these 10 genes (shown in rows). The right column shows the Allen Brain Atlas ISH expression for each gene, stating the image ID next to the tissue section, showing an agreement with the expression patterns predicted by SpaGE. These genes show clear expression to specific cortical layers (<italic>Pvrl3</italic> and <italic>Wfs1</italic>: layer 2/3; <italic>Cux2</italic>, <italic>Tmem215</italic> and <italic>Adam33</italic>: layer 2/3 and layer 4; <italic>Rspo1</italic>: layer 4; <italic>Tesc</italic>: layer 2/3 and layer 6; <italic>Tox</italic>: layer 5; <italic>Foxp2</italic> and <italic>Tle4</italic>: layer 6).</p>
        </caption>
        <graphic xlink:href="gkaa740fig6"/>
      </fig>
    </sec>
    <sec id="SEC3-5">
      <title>SpaGE is scalable to large spatial datasets</title>
      <p>So far, SpaGE showed good prediction performance in the leave-one-gene-out predictions, and was also able to predict correct spatial patterns of unmeasured genes within the spatial transcriptomic datasets. All these results were, however, obtained using a relatively small spatial datasets including only a few thousand cells (<bold>STARmap</bold> and <bold>osmFISH</bold>). This opens the question of how does SpaGE scale to large spatial datasets, comparable to the datasets measured nowadays. To assess the scalability of SpaGE, we used a large <bold>MERFISH</bold> dataset with &gt;60,000 cells measured from the mouse brain pre-optic region, and integrated it with the corresponding scRNA-seq dataset published in the same study by <bold>Moffit</bold><italic>et al.</italic> (<xref rid="B4" ref-type="bibr">4</xref>). The <bold>MERFISH_Moffit</bold> dataset pair shares 153 genes on which we applied the same leave-one-gene-out cross validation using all four methods. Similar to the previous results, SpaGE significantly outperformed all other methods (<italic>P</italic>-value &lt; 0.05, two-sided paired Wilcoxon rank sum test) with a median Spearman correlation of 0.275 compared to 0.258, 0.027 and 0.140 for Seurat, Liger and gimVI, respectively (Figure <xref ref-type="fig" rid="F7">7A</xref>). Per gene comparisons shows a clear advantage of SpaGE versus Liger and gimVI, but more comparable performance with Seurat (Figure <xref ref-type="fig" rid="F7">7B</xref>–<xref ref-type="fig" rid="F7">D</xref>). The reported <italic>P</italic>-values are quite significant, however, it is important to note that the <italic>P</italic>-values are inflated due to the large sample size, which is also the case for the <bold>STARmap</bold> dataset.</p>
      <fig id="F7" orientation="portrait" position="float">
        <label>Figure 7.</label>
        <caption>
          <p><bold>Prediction performance comparison for the MERFISH_Moffit dataset pair</bold>. (<bold>A</bold>) Boxplots showing the Spearman correlations for the leave-one-gene-out cross validation experiment for each method. The blue lines show the median correlation across all genes with a better performance for SpaGE. The green dots show the correlation values for individual genes. The <italic>P</italic>-values show the significant difference between all correlation values of SpaGE and each other method, using a paired Wilcoxon rank-sum test. (<bold>B–D</bold>) Detailed performance comparison between SpaGE and (<bold>B</bold>) Seurat, (<bold>C</bold>) Liger, (<bold>D</bold>) gimVI. These scatter plots show the correlation value of each gene across two methods. The solid black line is the <italic>y</italic> = <italic>x</italic> line, the dashed lines show the zero correlation. All scatter plots show that the majority of the genes are skewed above the <italic>y</italic> = <italic>x</italic> line, showing an overall better performance of SpaGE over other methods. (<bold>E</bold>) Boxplots showing the prediction performance of SpaGE for cell type marker genes compared to the overall performance across all genes. (<bold>F</bold>) scatter plot showing the average computation time (log-scaled) per gene versus the peak memory usage. Methods are represented with different colors and dataset pairs are represented with different symbols. Points of the same method are highlighted for clarity.</p>
        </caption>
        <graphic xlink:href="gkaa740fig7"/>
      </fig>
      <p>Next to the overall performance across all genes, we evaluated the performance of SpaGE to predict marker genes of four major brain cell types: inhibitory neurons, excitatory neurons, astrocytes and oligodendrocytes (Methods). We observed that SpaGE had higher prediction performance for cell type marker genes compared to the overall performance across all genes (Figure <xref ref-type="fig" rid="F7">7E</xref>). Similar conclusion can be observed for the <bold>STARmap</bold> dataset (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S14A</xref>), however, this is not the case for the <bold>osmFISH</bold> dataset because almost all 33 genes were cell type marker genes (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S14B</xref>). Additionally, the ranking of the prediction performance across cell types is related to the cell type proportions observed in the data. For instance, the <bold>MERFISH</bold> dataset has approximately 38% inhibitory neurons, 18% excitatory neurons, 15% oligodendrocytes and 13% astrocytes, for which the median correlation per cell type is 0.587, 0.551, 0.402 and 0.398, respectively (Figure <xref ref-type="fig" rid="F7">7E</xref>). Compared to the pre-optic region, the cortex contains more excitatory neurons than inhibitory. This is directly reflected in the prediction performance of inhibitory and excitatory marker genes, where the latter have higher performance for the cortical datasets <bold>STARmap</bold> and <bold>osmFISH</bold> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S14</xref>).</p>
      <p>Further, we compared the computation times of all four methods across all five dataset pairs. All experiments were run on a Linux HPC server but limited to a single CPU core, with 256GB of memory, to be able to compare runtimes. For all methods, the calculated computation time includes the integration and the prediction time. Overall SpaGE has the lowest average computation time per gene, across all five dataset pairs (Figure <xref ref-type="fig" rid="F7">7F</xref>). For the large <bold>MERFISH</bold> dataset, SpaGE has a clear advantage compared to the other methods as the average computation time of SpaGE is ∼30×, 63× and 45× faster than Seurat, Liger and gimVI, respectively. In terms of memory, SpaGE has the lowest memory usage across all five dataset pairs, while Seurat and Liger consumed memory the most (Figure <xref ref-type="fig" rid="F7">7F</xref>). Combined, these results show an overall advantage of SpaGE over other methods for larger datasets with higher prediction performance, lower computation time and less memory requirement.</p>
    </sec>
    <sec id="SEC3-6">
      <title>Increasing the number of shared genes does not always improve the prediction</title>
      <p>To investigate whether the performance improves when having many more spatially measured genes, we tested SpaGE when applying it to the <bold>seqFISH+</bold> spatial dataset that measures up to 10,000 genes simultaneously. Using the <bold>seqFISH_AllenVISp</bold> dataset pair, we applied SpaGE using the leave-one-gene-out cross validation setup to predict the spatial expression of 9,751 shared genes. SpaGE produced a median Spearman correlation of 0.154, a minimum correlation of -0.170 and a maximum correlation of 0.716. This result is comparable to the other tested dataset pairs, showing robust performance of SpaGE.</p>
      <p>However, with ∼10,000 spatial genes, we expected a better performance as there are many more shared genes with which matching cells can be found in the scRNA-seq data. To further substantiate this, we compared the prediction performance of 494 overlapping genes between the <bold>seqFISH_AllenVISp</bold> and the <bold>STARmap_AllenVISp</bold> dataset pairs, both having the same scRNA-seq reference data. The performance when using the <bold>seqFISH+</bold> data, having ∼10x more shared genes, was significantly higher than when using the <bold>STARmap</bold> data (<italic>P</italic>-value &lt; 0.05, two-sided paired Wilcoxon rank sum test) (Figure <xref ref-type="fig" rid="F8">8A</xref>). A detailed comparison per gene shows that the majority of the genes are indeed better predicted in the <bold>seqFISH+</bold> dataset (Figure <xref ref-type="fig" rid="F8">8B</xref>). However, when comparing the 21 overlapping genes between the <bold>seqFISH_AllenVISp</bold> and the <bold>osmFISH_AllenVISp</bold> dataset pairs, we obtained a contradicting result. The performance when using the <bold>osmFISH</bold> data (only 33 shared genes) was higher than when we used the <bold>seqFISH+</bold> data, for almost all 21 genes for which we could make this comparison (Figure <xref ref-type="fig" rid="F8">8C</xref>, <xref ref-type="fig" rid="F8">D</xref>).</p>
      <fig id="F8" orientation="portrait" position="float">
        <label>Figure 8.</label>
        <caption>
          <p><bold>Prediction performance of SpaGE for the seqFISH_AllenVISp dataset pair</bold>. (<bold>A,C</bold>) Boxplots comparing the prediction performance of SpaGE for the shared genes between the <bold>seqFISH</bold> and the (<bold>A</bold>) <bold>STARmap</bold>, (<bold>C</bold>) <bold>osmFISH</bold> datasets, using the same <bold>AllenVISp</bold> dataset as reference during prediction. The blue lines show the median correlation across all genes. The green dots show the correlation values for individual genes. The <italic>P</italic>-value is obtained using a paired Wilcoxon rank-sum test. (<bold>B, D</bold>) Detailed performance comparison between <bold>seqFISH</bold> and (<bold>B</bold>) <bold>STARmap</bold>, (<bold>D</bold>) <bold>osmFISH</bold>. These scatter plots show the correlation value of each gene across two datasets. The solid black line is the <italic>y</italic> = <italic>x</italic> line, the dashed lines show the zero correlation. (<bold>E</bold>) Boxplots showing the prediction performance of a test set of 50 genes, in terms of Spearman Rank correlations, using downsampled sets of 10, 30, 50, 100, 200, 500, 1000, 2000, 5000 and 7000 shared genes compared to using all 9,701 genes in the <bold>seqFISH_AllenVISp</bold> dataset pair.</p>
        </caption>
        <graphic xlink:href="gkaa740fig8"/>
      </fig>
      <p>This opens the question whether having more measured spatial genes (and thus shared genes) is always beneficial to predict the spatial patterns of non-measured genes. To answer that, we performed a downsampling experiment similar to what we did with the <bold>STARmap</bold> data (Methods). We fixed 50 genes as test set and downsampled the remaining genes to sets of the top 10, 30, 50, 100, 200, 500, 1000, 2000, 5000, 7000 and 9,701 (all) highly varying genes as shared genes. The best prediction performance of SpaGE was obtained using 5000 genes, after which the performance decreased (Figure <xref ref-type="fig" rid="F8">8E</xref>). Apparently, having more genes includes more and more lowly varying, and thus noisy, genes into the matching process, which turns out to confuse the matching process and consequently lower the prediction performance.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="SEC4">
    <title>DISCUSSION</title>
    <p>We demonstrated the ability of SpaGE to enhance spatial transcriptomics data by predicting the expression of unmeasured genes based on scRNA-seq data collected from the same tissue. The ability of SpaGE to produce accurate gene expression prediction highly depends on the alignment part performed using PRECISE, which rotates the principal components of each dataset to produce principal vectors with high one-to-one similarity. Projecting the datasets to the latent space spanned by these principal vectors produces a proper alignment, making a simple kNN prediction sufficient to achieve accurate gene expression estimation.</p>
    <p>During the alignment, SpaGE ignores principal vectors with low similarity which excludes uncommon and/or noisy signals. Despite the clear differences in the amount of explained variance for each dataset pair by the final set of principal vectors, SpaGE was able to capture the common sources of variation and produce good predictions of the spatial gene expressions across all dataset pairs. SpaGE captured ∼6% of the variance for the <bold>seqFISH+</bold> dataset that measures ∼10,000 genes spatially, but the majority of which are lowly variable in the mouse cortex, thus not contain enough information to contribute to the integration. On the contrary, SpaGE captured ∼94% of the variance for the <bold>osmFISH</bold> dataset, which contains 33 known marker genes for various cell types in the mouse somatosensory cortex. Almost all these genes are highly variable and contain useful information for the integration.</p>
    <p>We benchmarked SpaGE against three state-of-the-art methods for multi-omics data integration, using five different dataset pairs. These dataset pairs represent different challenges to the integration and prediction task, as they differ in gene detection sensitivity level and the number of spatially measured genes, which are the basis for the alignment. Increasing the number of shared genes should, in principle, eases the integration task and produces better predictions of spatial patterns of unmeasured genes. However, this is not always the case, as shown by the <bold>seqFISH+</bold> data, where adding more genes eventually also adds genes that have a relatively low variance, and thus are more probably noisy genes. This turns out to negatively influence the matching process and consequently decrease the prediction performance. Apparently, there is an optimum on the number of genes that need to be spatially measured when we want to predict spatial patterns of unmeasured genes. On the other hand, when measuring the spatial patterns measured for ∼10,000 genes, it might not be necessary to predict spatial patterns of unmeasured genes as the initially spatially measured genes already cover most of the transcriptome of interest. Further, imaging-based spatial transcriptomic methods, with high gene detection sensitivity, may also improve the integration and prediction, as they are able to capture the majority of the genes even the ones with relatively low expression. On the other hand, integrating this high sensitivity data with scRNA-seq, which has lower sensitivity, can be more challenging. That is because the differences in gene expression are higher compared to integrating a sequencing-based spatial data with scRNA-seq data, both having comparable sensitivity.</p>
    <p>Across all tested dataset pairs, SpaGE outperformed all methods producing better predictions for the majority of the genes. However, for few genes, SpaGE had lower prediction performance than other methods. Seurat produced good gene predictions for the <bold>STARmap</bold> and the <bold>MERFISH</bold> datasets, with similar predictions to SpaGE. However, Seurat had overall the lowest performance for the <bold>osmFISH</bold> dataset, with correlation close to 0, which shows that the performance of Seurat heavily decreased when there are very few shared genes, such as in the <bold>osmFISH</bold> dataset (33 genes). This problem is even more pronounced for Liger, as it performed relatively well for the <bold>STARmap</bold> dataset producing good gene predictions, but has a decreased performance for both the <bold>osmFISH</bold> (33 genes) and the <bold>MERFISH</bold> (155 genes) datasets. On the other hand, gimVI performed relatively well for the <bold>osmFISH</bold> and the <bold>MERFISH</bold> datasets. However, gimVI had overall the lowest performance for the <bold>STARmap</bold> dataset, with inaccurate predictions for genes with spatial patterns such as <italic>Cux2</italic> and <italic>Plp1</italic>. This suggests that gimVI works well with imaging-based technologies having high gene detection sensitivity, but not with the sequencing-based technologies.</p>
    <p>Next to the overall best performance, SpaGE is an interpretable algorithm as it allows to find the genes driving the correspondence between the datasets. The principal vectors, used to align the datasets to a latent space, show the contribution of each gene in defining this new latent space. Further, SpaGE is scalable to large spatial data with significantly lower computation time and memory requirement compared to the other methods, as shown on the <bold>MERFISH</bold> dataset having more than 60,000 cells measured spatially. Moreover, SpaGE is a flexible pipeline. Here we used PCA as the initial independent dimensionality reduction algorithm. However, this step can be replaced by any linear dimensionality reduction method.</p>
    <p>SpaGE showed high prediction performance for cell type marker genes compared to the overall performance across all genes. These marker genes are often highly variable genes with clear spatial expression patterns. For example, <italic>Cux2</italic> and <italic>Lamp5</italic> represent two excitatory neurons marker genes with clear spatial patterns in the mouse cortex, which were well predicted by SpaGE. We also showed that the cell type proportions directly affect the prediction of the corresponding marker genes. However, the prediction of a marker gene is, in the first place, directly related to the existence of the corresponding cell type across both spatial and scRNA-seq datasets. For example, it is not possible to correctly predict the spatial expression of an astrocyte marker gene, if one or both datasets do not contain any astrocytes. In other words, it is better to measure both spatial and scRNA-seq datasets from the same sample, as we have seen in the <bold>MERFISH_Moffit</bold> dataset pair. However, datasets emerging from different samples but from matching tissue can still produce good spatial gene expression predictions if their cell type compositions are preserved.</p>
    <p>We used the Spearman Rank correlation to quantitatively evaluate the predicted gene expressions. The overall evaluation showed relatively low correlations across all methods and all dataset pairs. These low correlations express the difficulty of the problem, as the predicted gene expressions are obtained from a different type of data. Given the low observed correlations, we developed a model that expresses whether we can trust a SpaGE-predicted spatial expression or not, which helps a user of SpaGE to interpret the correlations, improving the practicality of SpaGE. However, the Spearman correlation is not the optimal evaluation metric, as it does not always reflect the spatially predicted patterns, i.e. visual inspection showed good predictions for genes with known spatial pattern in the mouse cortex, while the correlation values were less than 0.2.</p>
  </sec>
  <sec sec-type="conclusions" id="SEC5">
    <title>CONCLUSION</title>
    <p>SpaGE presents a robust, scalable, interpretable and flexible method for predicting spatial gene expression patterns. SpaGE uses domain adaptation to align the spatial transcriptomics and the scRNA-seq datasets to a common space, in which unmeasured spatial gene expressions can be predicted. SpaGE is less complex and much faster when compared to other approaches and generalizes better across datasets and technologies.</p>
  </sec>
  <sec sec-type="data-availability" id="SEC6">
    <title>DATA AVAILABILITY</title>
    <p>The implementation code of SpaGE, as well as the benchmarking code, is available in the GitHub repository, at <ext-link ext-link-type="uri" xlink:href="https://github.com/tabdelaal/SpaGE">https://github.com/tabdelaal/SpaGE</ext-link>. The code is released under MIT license. All datasets used are publicly available data, for convenience datasets can be downloaded from Zenodo (<ext-link ext-link-type="doi" xlink:href="10.5281/zenodo.3967291">https://doi.org/10.5281/zenodo.3967291</ext-link>).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>gkaa740_Supplemental_File</label>
      <media xlink:href="gkaa740_supplemental_file.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec id="SEC7">
    <title>SUPPLEMENTARY DATA</title>
    <p><ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/nar/article-lookup/doi/10.1093/nar/gkaa740#supplementary-data">Supplementary Data</ext-link> are available at NAR Online.</p>
  </sec>
  <sec id="SEC8">
    <title>FUNDING</title>
    <p>European Commission of a H2020 MSCA award [675743] (ISPIC); European Union's H2020 research and innovation programme under the MSCA grant agreement [861190 (PAVE)]; NWO TTW project 3DOMICS [NWO: 17126]; ZonMw TOP grant COMPUTE CANCER [40-00812-98-16012]; the collaboration project TIMID [LSHM18057-SGF] financed by the PPP allowance made available by Top Sector Life Sciences &amp; Health (LSH) to Samenwekende Gezondheidsfondsen (SGF) to stimulate public-private partnerships and co-financing by health foundations that are part of the SGF. Partial funding for open access charge: TU Delft Open Access Fund.</p>
    <p><italic>Conflict of interest statement</italic>. None declared.</p>
  </sec>
  <ref-list id="REF1">
    <title>REFERENCES</title>
    <ref id="B1">
      <label>1.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Han</surname><given-names>X.</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Zhou</surname><given-names>Y.</given-names></name>, <name name-style="western"><surname>Fei</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Sun</surname><given-names>H.</given-names></name>, <name name-style="western"><surname>Lai</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Saadatpour</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Zhou</surname><given-names>Z.</given-names></name>, <name name-style="western"><surname>Chen</surname><given-names>H.</given-names></name>, <name name-style="western"><surname>Ye</surname><given-names>F.</given-names></name><etal>et al</etal>.</person-group><article-title>Mapping the mouse cell atlas by Microwell-Seq</article-title>. <source>Cell</source>. <year>2018</year>; <volume>172</volume>:<fpage>1091</fpage>–<lpage>1107</lpage>.<pub-id pub-id-type="pmid">29474909</pub-id></mixed-citation>
    </ref>
    <ref id="B2">
      <label>2.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cao</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Spielmann</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Qiu</surname><given-names>X.</given-names></name>, <name name-style="western"><surname>Huang</surname><given-names>X.</given-names></name>, <name name-style="western"><surname>Ibrahim</surname><given-names>D.M.</given-names></name>, <name name-style="western"><surname>Hill</surname><given-names>A.J.</given-names></name>, <name name-style="western"><surname>Zhang</surname><given-names>F.</given-names></name>, <name name-style="western"><surname>Mundlos</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Christiansen</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Steemers</surname><given-names>F.J.</given-names></name><etal>et al</etal>.</person-group><article-title>The single-cell transcriptional landscape of mammalian organogenesis</article-title>. <source>Nature</source>. <year>2019</year>; <volume>566</volume>:<fpage>496</fpage>–<lpage>502</lpage>.<pub-id pub-id-type="pmid">30787437</pub-id></mixed-citation>
    </ref>
    <ref id="B3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zeisel</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Hochgerner</surname><given-names>H.</given-names></name>, <name name-style="western"><surname>Lönnerberg</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Johnsson</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Memic</surname><given-names>F.</given-names></name>, <name name-style="western"><surname>van der Zwan</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Häring</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Braun</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Borm</surname><given-names>L.E.</given-names></name>, <name name-style="western"><surname>La Manno</surname><given-names>G.</given-names></name><etal>et al</etal>.</person-group><article-title>Molecular architecture of the mouse nervous system</article-title>. <source>Cell</source>. <year>2018</year>; <volume>174</volume>:<fpage>999</fpage>–<lpage>1014</lpage>.<pub-id pub-id-type="pmid">30096314</pub-id></mixed-citation>
    </ref>
    <ref id="B4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Moffitt</surname><given-names>J.R.</given-names></name>, <name name-style="western"><surname>Bambah-Mukku</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Eichhorn</surname><given-names>S.W.</given-names></name>, <name name-style="western"><surname>Vaughn</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Shekhar</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Perez</surname><given-names>J.D.</given-names></name>, <name name-style="western"><surname>Rubinstein</surname><given-names>N.D.</given-names></name>, <name name-style="western"><surname>Hao</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Regev</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Dulac</surname><given-names>C.</given-names></name><etal>et al</etal>.</person-group><article-title>Molecular, spatial, and functional single-cell profiling of the hypothalamic preoptic region</article-title>. <source>Science</source>. <year>2018</year>; <volume>362</volume>:<fpage>eaau5324</fpage>.<pub-id pub-id-type="pmid">30385464</pub-id></mixed-citation>
    </ref>
    <ref id="B5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Codeluppi</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Borm</surname><given-names>L.E.</given-names></name>, <name name-style="western"><surname>Zeisel</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>La Manno</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>van Lunteren</surname><given-names>J.A.</given-names></name>, <name name-style="western"><surname>Svensson</surname><given-names>C.I.</given-names></name>, <name name-style="western"><surname>Linnarsson</surname><given-names>S.</given-names></name></person-group><article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>. <source>Nat. Methods</source>. <year>2018</year>; <volume>15</volume>:<fpage>932</fpage>–<lpage>935</lpage>.<pub-id pub-id-type="pmid">30377364</pub-id></mixed-citation>
    </ref>
    <ref id="B6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chen</surname><given-names>K.H.</given-names></name>, <name name-style="western"><surname>Boettiger</surname><given-names>A.N.</given-names></name>, <name name-style="western"><surname>Moffitt</surname><given-names>J.R.</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Zhuang</surname><given-names>X.</given-names></name></person-group><article-title>Spatially resolved, highly multiplexed RNA profiling in single cells</article-title>. <source>Science</source>. <year>2015</year>; <volume>348</volume>:<fpage>aaa6090</fpage>.<pub-id pub-id-type="pmid">25858977</pub-id></mixed-citation>
    </ref>
    <ref id="B7">
      <label>7.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Eng</surname><given-names>C.H.L.</given-names></name>, <name name-style="western"><surname>Lawson</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Zhu</surname><given-names>Q.</given-names></name>, <name name-style="western"><surname>Dries</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Koulena</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>Takei</surname><given-names>Y.</given-names></name>, <name name-style="western"><surname>Yun</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Cronin</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Karp</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Yuan</surname><given-names>G.C.</given-names></name><etal>et al</etal>.</person-group><article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH+</article-title>. <source>Nature</source>. <year>2019</year>; <volume>568</volume>:<fpage>235</fpage>–<lpage>239</lpage>.<pub-id pub-id-type="pmid">30911168</pub-id></mixed-citation>
    </ref>
    <ref id="B8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>X.</given-names></name>, <name name-style="western"><surname>Allen</surname><given-names>W.E.</given-names></name>, <name name-style="western"><surname>Wright</surname><given-names>M.A.</given-names></name>, <name name-style="western"><surname>Sylwestrak</surname><given-names>E.L.</given-names></name>, <name name-style="western"><surname>Samusik</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>Vesuna</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Evans</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Liu</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Ramakrishnan</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Liu</surname><given-names>J.</given-names></name><etal>et al</etal>.</person-group><article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>. <source>Science</source>. <year>2018</year>; <volume>361</volume>:<fpage>eaat5691</fpage>.<pub-id pub-id-type="pmid">29930089</pub-id></mixed-citation>
    </ref>
    <ref id="B9">
      <label>9.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rodriques</surname><given-names>S.G.</given-names></name>, <name name-style="western"><surname>Stickels</surname><given-names>R.R.</given-names></name>, <name name-style="western"><surname>Goeva</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Martin</surname><given-names>C.A.</given-names></name>, <name name-style="western"><surname>Murray</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Vanderburg</surname><given-names>C.R.</given-names></name>, <name name-style="western"><surname>Welch</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Chen</surname><given-names>L.M.</given-names></name>, <name name-style="western"><surname>Chen</surname><given-names>F.</given-names></name>, <name name-style="western"><surname>Macosko</surname><given-names>E.Z.</given-names></name></person-group><article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>. <source>Science</source>. <year>2019</year>; <volume>363</volume>:<fpage>1463</fpage>–<lpage>1467</lpage>.<pub-id pub-id-type="pmid">30923225</pub-id></mixed-citation>
    </ref>
    <ref id="B10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Xia</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Fan</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Emanuel</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Hao</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Zhuang</surname><given-names>X.</given-names></name></person-group><article-title>Spatial transcriptome profiling by MERFISH reveals subcellular RNA compartmentalization and cell cycle-dependent gene expression</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A.</source><year>2019</year>; <volume>116</volume>:<fpage>19490</fpage>–<lpage>19499</lpage>.<pub-id pub-id-type="pmid">31501331</pub-id></mixed-citation>
    </ref>
    <ref id="B11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Stuart</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Integrative single-cell analysis</article-title>. <source>Nat. Rev. Genet.</source><year>2019</year>; <volume>20</volume>:<fpage>257</fpage>–<lpage>272</lpage>.<pub-id pub-id-type="pmid">30696980</pub-id></mixed-citation>
    </ref>
    <ref id="B12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Satija</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Farrell</surname><given-names>J.A.</given-names></name>, <name name-style="western"><surname>Gennert</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Schier</surname><given-names>A.F.</given-names></name>, <name name-style="western"><surname>Regev</surname><given-names>A.</given-names></name></person-group><article-title>Spatial reconstruction of single-cell gene expression data</article-title>. <source>Nat. Biotechnol.</source><year>2015</year>; <volume>33</volume>:<fpage>495</fpage>–<lpage>502</lpage>.<pub-id pub-id-type="pmid">25867923</pub-id></mixed-citation>
    </ref>
    <ref id="B13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Achim</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Pettit</surname><given-names>J.B.</given-names></name>, <name name-style="western"><surname>Saraiva</surname><given-names>L.R.</given-names></name>, <name name-style="western"><surname>Gavriouchkina</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Larsson</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Arendt</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Marioni</surname><given-names>J.C.</given-names></name></person-group><article-title>High-throughput spatial mapping of single-cell RNA-seq data to tissue of origin</article-title>. <source>Nat. Biotechnol.</source><year>2015</year>; <volume>33</volume>:<fpage>503</fpage>–<lpage>509</lpage>.<pub-id pub-id-type="pmid">25867922</pub-id></mixed-citation>
    </ref>
    <ref id="B14">
      <label>14.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Nitzan</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Karaiskos</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>Friedman</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>Rajewsky</surname><given-names>N.</given-names></name></person-group><article-title>Gene expression cartography</article-title>. <source>Nature</source>. <year>2019</year>; <volume>576</volume>:<fpage>132</fpage>–<lpage>137</lpage>.<pub-id pub-id-type="pmid">31748748</pub-id></mixed-citation>
    </ref>
    <ref id="B15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Stuart</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Butler</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Hoffman</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Hafemeister</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Papalexi</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Mauck</surname><given-names>W.M.</given-names></name>, <name name-style="western"><surname>Hao</surname><given-names>Y.</given-names></name>, <name name-style="western"><surname>Stoeckius</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Smibert</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Comprehensive integration of Single-Cell data</article-title>. <source>Cell</source>. <year>2019</year>; <volume>177</volume>:<fpage>1888</fpage>–<lpage>1902</lpage>.<pub-id pub-id-type="pmid">31178118</pub-id></mixed-citation>
    </ref>
    <ref id="B16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Welch</surname><given-names>J.D.</given-names></name>, <name name-style="western"><surname>Kozareva</surname><given-names>V.</given-names></name>, <name name-style="western"><surname>Ferreira</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Vanderburg</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Martin</surname><given-names>C.</given-names></name>, <name name-style="western"><surname>Macosko</surname><given-names>E.Z.</given-names></name></person-group><article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>. <source>Cell</source>. <year>2019</year>; <volume>177</volume>:<fpage>1873</fpage>–<lpage>1887</lpage>.<pub-id pub-id-type="pmid">31178122</pub-id></mixed-citation>
    </ref>
    <ref id="B17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Korsunsky</surname><given-names>I.</given-names></name>, <name name-style="western"><surname>Millard</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>Fan</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Slowikowski</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Zhang</surname><given-names>F.</given-names></name>, <name name-style="western"><surname>Wei</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Baglaenko</surname><given-names>Y.</given-names></name>, <name name-style="western"><surname>Brenner</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Loh</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Raychaudhuri</surname><given-names>S.</given-names></name></person-group><article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>. <source>Nat. Methods</source>. <year>2019</year>; <volume>16</volume>:<fpage>1289</fpage>–<lpage>1296</lpage>.<pub-id pub-id-type="pmid">31740819</pub-id></mixed-citation>
    </ref>
    <ref id="B18">
      <label>18.</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Lopez</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Nazaret</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Langevin</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Samaran</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Regier</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Jordan</surname><given-names>M.I.</given-names></name>, <name name-style="western"><surname>Yosef</surname><given-names>N.</given-names></name></person-group><article-title>A joint model of unpaired data from scRNA-seq and spatial transcriptomics for imputing missing gene expression measurements</article-title>. <year>2019</year>; <comment>arXiv doi:</comment><comment>06 May 2019, preprint: not peer reviewed</comment><uri xlink:href="https://www.arxiv.org/abs/1905.02269">https://arxiv.org/abs/1905.02269</uri>.</mixed-citation>
    </ref>
    <ref id="B19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tran</surname><given-names>H.T.N.</given-names></name>, <name name-style="western"><surname>Ang</surname><given-names>K.S.</given-names></name>, <name name-style="western"><surname>Chevrier</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Zhang</surname><given-names>X.</given-names></name>, <name name-style="western"><surname>Lee</surname><given-names>N.Y.S.</given-names></name>, <name name-style="western"><surname>Goh</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Chen</surname><given-names>J.</given-names></name></person-group><article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>. <source>Genome Biol.</source><year>2020</year>; <volume>21</volume>:<fpage>12</fpage>.<pub-id pub-id-type="pmid">31948481</pub-id></mixed-citation>
    </ref>
    <ref id="B20">
      <label>20.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Mourragui</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Loog</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Van De Wiel</surname><given-names>M.A.</given-names></name>, <name name-style="western"><surname>Reinders</surname><given-names>M.J.T.</given-names></name>, <name name-style="western"><surname>Wessels</surname><given-names>L.F.A.</given-names></name></person-group><article-title>PRECISE: A domain adaptation approach to transfer predictors of drug response from pre-clinical models to tumors</article-title>. <source>Bioinformatics</source>. <year>2019</year>; <volume>35</volume>:<fpage>i510</fpage>–<lpage>i519</lpage>.<pub-id pub-id-type="pmid">31510654</pub-id></mixed-citation>
    </ref>
    <ref id="B21">
      <label>21.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Gene</surname><given-names>H.G</given-names></name>, <name name-style="western"><surname>Van Loan</surname><given-names>C.F.</given-names></name></person-group><source>Matrix Computations</source>. <year>2013</year>; <edition>4th edn</edition><publisher-name>Johns Hopkins University Press</publisher-name>.</mixed-citation>
    </ref>
    <ref id="B22">
      <label>22.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tasic</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Yao</surname><given-names>Z.</given-names></name>, <name name-style="western"><surname>Graybuck</surname><given-names>L.T.</given-names></name>, <name name-style="western"><surname>Smith</surname><given-names>K.A.</given-names></name>, <name name-style="western"><surname>Nguyen</surname><given-names>T.N.</given-names></name>, <name name-style="western"><surname>Bertagnolli</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Goldy</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Garren</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Economo</surname><given-names>M.N.</given-names></name>, <name name-style="western"><surname>Viswanathan</surname><given-names>S.</given-names></name><etal>et al</etal>.</person-group><article-title>Shared and distinct transcriptomic cell types across neocortical areas</article-title>. <source>Nature</source>. <year>2018</year>; <volume>563</volume>:<fpage>72</fpage>–<lpage>78</lpage>.<pub-id pub-id-type="pmid">30382198</pub-id></mixed-citation>
    </ref>
    <ref id="B23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chatterjee</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Sullivan</surname><given-names>H.A.</given-names></name>, <name name-style="western"><surname>MacLennan</surname><given-names>B.J.</given-names></name>, <name name-style="western"><surname>Xu</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Hou</surname><given-names>Y.Y.</given-names></name>, <name name-style="western"><surname>Lavin</surname><given-names>T.K.</given-names></name>, <name name-style="western"><surname>Lea</surname><given-names>N.E.</given-names></name>, <name name-style="western"><surname>Michalski</surname><given-names>J.E.</given-names></name>, <name name-style="western"><surname>Babcock</surname><given-names>K.R.</given-names></name>, <name name-style="western"><surname>Dietrich</surname><given-names>S.</given-names></name><etal>et al</etal>.</person-group><article-title>Nontoxic, double-deletion-mutant rabies viral vectors for retrograde targeting of projection neurons</article-title>. <source>Nat. Neurosci.</source><year>2018</year>; <volume>21</volume>:<fpage>638</fpage>–<lpage>646</lpage>.<pub-id pub-id-type="pmid">29507411</pub-id></mixed-citation>
    </ref>
    <ref id="B24">
      <label>24.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zeisel</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Môz-Manchado</surname><given-names>A.B.</given-names></name>, <name name-style="western"><surname>Codeluppi</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Lönnerberg</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Manno</surname><given-names>G.La</given-names></name>, <name name-style="western"><surname>Juréus</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Marques</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Munguba</surname><given-names>H.</given-names></name>, <name name-style="western"><surname>He</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Betsholtz</surname><given-names>C.</given-names></name><etal>et al</etal>.</person-group><article-title>Cell types in the mouse cortex and hippocampus revealed by single-cell RNA-seq</article-title>. <source>Science</source>. <year>2015</year>; <volume>347</volume>:<fpage>1138</fpage>–<lpage>1142</lpage>.<pub-id pub-id-type="pmid">25700174</pub-id></mixed-citation>
    </ref>
    <ref id="B25">
      <label>25.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Virtanen</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Gommers</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Oliphant</surname><given-names>T.E.</given-names></name>, <name name-style="western"><surname>Haberland</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Reddy</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Cournapeau</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Burovski</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Peterson</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Weckesser</surname><given-names>W.</given-names></name>, <name name-style="western"><surname>Bright</surname><given-names>J.</given-names></name><etal>et al</etal>.</person-group><article-title>SciPy 1.0: fundamental algorithms for scientific computing in Python</article-title>. <source>Nat. Methods</source>. <year>2020</year>; <volume>17</volume>:<fpage>261</fpage>–<lpage>272</lpage>.<pub-id pub-id-type="pmid">32015543</pub-id></mixed-citation>
    </ref>
    <ref id="B26">
      <label>26.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lopez</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Regier</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Cole</surname><given-names>M.B.</given-names></name>, <name name-style="western"><surname>Jordan</surname><given-names>M.I.</given-names></name>, <name name-style="western"><surname>Yosef</surname><given-names>N.</given-names></name></person-group><article-title>Deep generative modeling for single-cell transcriptomics</article-title>. <source>Nat. Methods</source>. <year>2018</year>; <volume>15</volume>:<fpage>1053</fpage>–<lpage>1058</lpage>.<pub-id pub-id-type="pmid">30504886</pub-id></mixed-citation>
    </ref>
    <ref id="B27">
      <label>27.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Li</surname><given-names>H.</given-names></name>, <name name-style="western"><surname>Calder</surname><given-names>C.A.</given-names></name>, <name name-style="western"><surname>Cressie</surname><given-names>N.</given-names></name></person-group><article-title>Beyond Moran's I: testing for spatial dependence based on the spatial autoregressive model</article-title>. <source>Geogr. Anal.</source><year>2007</year>; <volume>39</volume>:<fpage>357</fpage>–<lpage>375</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
