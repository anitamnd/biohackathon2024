<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Neuroinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Neuroinformatics</journal-id>
    <journal-title-group>
      <journal-title>Neuroinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1539-2791</issn>
    <issn pub-type="epub">1559-0089</issn>
    <publisher>
      <publisher-name>Springer US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7498500</article-id>
    <article-id pub-id-type="publisher-id">9458</article-id>
    <article-id pub-id-type="doi">10.1007/s12021-020-09458-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>FEMfuns: A Volume Conduction Modeling Pipeline that Includes Resistive, Capacitive or Dispersive Tissue and Electrodes</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Vermaas</surname>
          <given-names>M.</given-names>
        </name>
        <address>
          <email>m.vermaas@science.ru.nl</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Piastra</surname>
          <given-names>M. C.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Oostendorp</surname>
          <given-names>T. F.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ramsey</surname>
          <given-names>N. F.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tiesinga</surname>
          <given-names>P. H. E.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.5590.9</institution-id><institution-id institution-id-type="ISNI">0000000122931605</institution-id><institution>Department of Neuroinformatics, Donders Institute for Brain, Cognition and Behaviour, </institution><institution>Radboud University Nijmegen, </institution></institution-wrap>Nijmegen, the Netherlands </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.5590.9</institution-id><institution-id institution-id-type="ISNI">0000000122931605</institution-id><institution>Radboud University Nijmegen Medical Centre, </institution><institution>Cognitive Neuroscience, Donders Institute for Brain, Cognition and Behaviour, </institution></institution-wrap>Nijmegen, The Netherlands </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.7692.a</institution-id><institution-id institution-id-type="ISNI">0000000090126352</institution-id><institution>Department of Neurology and Neurosurgery, Brain Center Rudolf Magnus, </institution><institution>University Medical Center Utrecht, </institution></institution-wrap>Utrecht, The Netherlands </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>4</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>18</day>
      <month>4</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2020</year>
    </pub-date>
    <volume>18</volume>
    <issue>4</issue>
    <fpage>569</fpage>
    <lpage>580</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Applications such as brain computer interfaces require recordings of relevant neuronal population activity with high precision, for example, with electrocorticography (ECoG) grids. In order to achieve this, both the placement of the electrode grid on the cortex and the electrode properties, such as the electrode size and material, need to be optimized. For this purpose, it is essential to have a reliable tool that is able to simulate the extracellular potential, i.e., to solve the so-called ECoG forward problem, and to incorporate the properties of the electrodes explicitly in the model. In this study, this need is addressed by introducing the first open-source pipeline, FEMfuns (finite element method for useful neuroscience simulations), that allows neuroscientists to solve the forward problem in a variety of different geometrical domains, including different types of source models and electrode properties, such as resistive and capacitive materials. FEMfuns is based on the finite element method (FEM) implemented in FEniCS and includes the geometry tessellation, several electrode-electrolyte implementations and adaptive refinement options. The Python code of the pipeline is available under the GNU General Public License version 3 at <ext-link ext-link-type="uri" xlink:href="https://github.com/meronvermaas/FEMfuns">https://github.com/meronvermaas/FEMfuns</ext-link>. We tested our pipeline with several geometries and source configurations such as a dipolar source in a multi-layer sphere model and a five-compartment realistically-shaped head model. Furthermore, we describe the main scripts in the pipeline, illustrating its flexible and versatile use. Provided with a sufficiently fine tessellation, the numerical solution of the forward problem approximates the analytical solution. Furthermore, we show dispersive material and interface effects in line with previous literature. Our results indicate substantial capacitive and dispersive effects due to the electrode-electrolyte interface when using stimulating electrodes. The results demonstrate that the pipeline presented in this paper is an accurate and flexible tool to simulate signals generated on electrode grids by the spatiotemporal electrical activity patterns produced by sources and thereby allows the user to optimize grids for brain computer interfaces including exploration of alternative electrode materials/properties.</p>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Computational modeling</kwd>
      <kwd>Finite element method</kwd>
      <kwd>Electrical double layer</kwd>
      <kwd>Dispersive tissue</kwd>
      <kwd>Complete electrode model</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100003958</institution-id>
            <institution>Stichting voor de Technische Wetenschappen</institution>
          </institution-wrap>
        </funding-source>
        <award-id>14906</award-id>
        <principal-award-recipient>
          <name>
            <surname>Ramsey</surname>
            <given-names>N. F.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Science+Business Media, LLC, part of Springer Nature 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Introduction</title>
    <p id="Par2">Stimulating and recording the brain by means of electrodes provides a versatile method to deepen our understanding of neural networks and their role in cognitive processes. Reconstructing the spatio-temporal distribution of neural current sources underlying electrophysiological data, such as electroencephalography (EEG) and electrocorticography (ECoG), assists in studying neural processes. Estimating the sources corresponds to solving the forward- and inverse problem.</p>
    <p id="Par3">The forward problem assumes a known source and solves for the electric potential in the brain. The inverse problem consists of estimating the source configuration underlying the recorded potential. The inverse problem requires solving the forward problem first and consequently the accuracy of the estimated sources will depend on the accuracy of the solution of the forward problem.</p>
    <p id="Par4">The Finite Element Method (FEM) is a suitable numerical method to solve the forward problem; it can incorporate the complex geometry of the head and allows for anisotropic conductivities, for example, to account for the laminar structure of cortex (Goto et al. <xref ref-type="bibr" rid="CR16">2010</xref>). FEM has been used to quantify various volume conduction effects, such as the influence of skull anisotropy (Marin et al. <xref ref-type="bibr" rid="CR34">1998</xref>), tissue inhomogeneities and anisotropies (Butson et al. <xref ref-type="bibr" rid="CR8">2007</xref>), and dispersive tissue properties (Grant and Lowery <xref ref-type="bibr" rid="CR17">2010</xref>).</p>
    <p id="Par5">A realistic description of the geometry and correct values of the electrical parameters of the biological tissues are essential to ensure an accurate forward model. The electrical conductivity and relative permittivity of biological tissues vary with frequency (i.e., they are dispersive, Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>; Miceli et al. <xref ref-type="bibr" rid="CR35">2017</xref>). However, volume conductor models used in bio-electricity generally consider only resistive currents, which is consistent with the so-called quasi-static approximation of Maxwell’s equations (Plonsey and Heppner <xref ref-type="bibr" rid="CR47">1967</xref>; Nunez and Srinivasan <xref ref-type="bibr" rid="CR41">2006</xref>), and capacitive, inductive and propagation effects are assumed to be negligible (Miceli et al. <xref ref-type="bibr" rid="CR35">2017</xref>). Whether the extracellular medium can be regarded as purely ohmic remains a topic of discussion (Gomes et al. <xref ref-type="bibr" rid="CR15">2016</xref>; Bédard and Destexhe <xref ref-type="bibr" rid="CR5">2017</xref>; Miceli et al. <xref ref-type="bibr" rid="CR35">2017</xref>; Logothetis et al. <xref ref-type="bibr" rid="CR31">2007</xref>).</p>
    <p id="Par6">A limited number of studies have addressed the effect of the presence of electrodes on the forward solution (Joucla and Yvert <xref ref-type="bibr" rid="CR26">2009</xref>; Butson and McIntyre <xref ref-type="bibr" rid="CR7">2005</xref>; Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>; Grant and Lowery <xref ref-type="bibr" rid="CR17">2010</xref>). The electric properties of electrodes are typically non-linear because of the properties of the current density distribution along its surface (Neuman <xref ref-type="bibr" rid="CR39">1998</xref>). In particular, when an electrode is immersed in an electrolyte, the charge carrier between the two materials changes from electronic in the metal to ionic in the electrolyte. As a result an electrical double layer forms on the external surface of the electrode where, in recording electrodes, a mix of faradaic (ohmic) and non-faradaic (capacitive) currents occurs depending on the magnitude of the potential difference across the interface (Richardot and McAdams <xref ref-type="bibr" rid="CR49">2002</xref>).</p>
    <p id="Par7">These ohmic and capacitive currents across the electrode have been implemented in FEM studies in a variety of set-ups, e.g., imposing faradaic currents (Joucla and Yvert <xref ref-type="bibr" rid="CR26">2009</xref>), non-faradaic currents (Butson and McIntyre <xref ref-type="bibr" rid="CR7">2005</xref>) or a parallel combination of the two (Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>; Grant and Lowery <xref ref-type="bibr" rid="CR17">2010</xref>). Models of recording electrodes, such as EEG, generally assume a simple point electrode model, while only a handful studies considers EEG forward models including the effect of electrode size and shunting (Ollikainen et al. <xref ref-type="bibr" rid="CR43">2000</xref>; Pursiainen et al. <xref ref-type="bibr" rid="CR48">2017</xref>).</p>
    <p id="Par8">In this study, we describe the workflow and capabilities of a volume conduction modeling pipeline FEMfuns (FEM for useful neuroscience simulations). The goal of this pipeline is to provide a Python-based framework centered around a general FEM toolbox, i.e., FEniCS (Alnæs et al. <xref ref-type="bibr" rid="CR1">2015</xref>; Logg and Wells <xref ref-type="bibr" rid="CR29">2010</xref>), to make forward models available, easily exploitable and adjustable for the neuroscience community. The volume conductor in FEMfuns can be described by resistive, capacitive and dispersive material properties. Furthermore, electrode interface effects can be flexibly added and the accuracy of the forward solution is described.</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <p id="Par9">In this work we conducted three different studies with the goal of demonstrating the capabilities of our FEMfuns pipeline. In all the studies Lagrangian FEM (Vorwerk et al. <xref ref-type="bibr" rid="CR56">2018</xref>) was applied to simulate the electric potential generated in a volume conductor by a known source. Both an internal dipolar source and an externally induced stimulating electrode are implemented. This can be useful considering the fact that the sensitivity of detecting bioelectric signals and the distribution in electrical stimulation are interchangeable (Malmivuo and Plonsey <xref ref-type="bibr" rid="CR33">1995</xref>), due to the reciprocity theorem (Helmholtz <xref ref-type="bibr" rid="CR21">1853</xref>; Rush and Driscoll <xref ref-type="bibr" rid="CR51">1969</xref>; Hu <xref ref-type="bibr" rid="CR23">2001</xref>).</p>
    <sec id="Sec3">
      <title>Forward Model</title>
      <p id="Par10">The electric potential <italic>φ</italic> generated in the brain can be computed through the quasistatic approximation of Maxwell’s equations (Plonsey and Heppner <xref ref-type="bibr" rid="CR47">1967</xref>). In our work, we considered two representations of the volume conductor, namely a purely resistive model and one that includes capacitive tissue properties. In the resistive version with primary current density <bold><italic>J</italic></bold><sub><italic>p</italic></sub> (current produced by neuronal activity, e.g. a dipole, or from stimulating electrodes), ohmic currents are described in medium Ω with conductivity <italic>σ</italic> through the following equation:
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  -\nabla\cdot(\sigma \nabla \varphi) = \nabla\cdot\boldsymbol{\mathrm{J}}_{p}, \quad\text{in } {\Omega}. $$\end{document}</tex-math><mml:math id="M2"><mml:mo>−</mml:mo><mml:mo>∇</mml:mo><mml:mo>⋅</mml:mo><mml:mo>(</mml:mo><mml:mi>σ</mml:mi><mml:mo>∇</mml:mo><mml:mi>φ</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mo>∇</mml:mo><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mstyle mathvariant="bold-italic"><mml:mi mathvariant="normal">J</mml:mi></mml:mstyle></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">Ω</mml:mi><mml:mn>.</mml:mn></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par11">When taking into account the capacitive tissue properties, the quasi-static approximation of Maxwell’s equations does not hold anymore and the following frequency-dependent Poisson equation (Plonsey and Heppner <xref ref-type="bibr" rid="CR47">1967</xref>) has to be considered instead:
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  -\nabla\cdot([\sigma(\omega) + j\omega\varepsilon_{0}\varepsilon_{r}(\omega)]\nabla \varphi) = \nabla\cdot\boldsymbol{\mathrm{J}}_{p}, \quad \text{in } {\Omega}, $$\end{document}</tex-math><mml:math id="M4"><mml:mo>−</mml:mo><mml:mo>∇</mml:mo><mml:mo>⋅</mml:mo><mml:mo>(</mml:mo><mml:mo>[</mml:mo><mml:mi>σ</mml:mi><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:mi>j</mml:mi><mml:mi>ω</mml:mi><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo><mml:mo>]</mml:mo><mml:mo>∇</mml:mo><mml:mi>φ</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mo>∇</mml:mo><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mstyle mathvariant="bold-italic"><mml:mi mathvariant="normal">J</mml:mi></mml:mstyle></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">Ω</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>where <italic>j</italic> is the imaginary unit, <italic>ω</italic> = 2<italic>π</italic><italic>f</italic> is the angular frequency of the source, <italic>ε</italic><sub>0</sub> is the permittivity in vacuum (8.85 × 10<sup>− 12</sup><italic>F</italic>/<italic>m</italic>) and <italic>ε</italic><sub><italic>r</italic></sub> is the relative permittivity. In case of a stimulating pulse or periodic currents generated by synchronous oscillations of neuronal circuits, a fast Fourier transform (FFT) is performed on the time series of the source. Then, the FEM is solved for each frequency separately and the signal in the tissue is reconstituted using the inverse FFT. This FEM-Fourier approach is comparable to several previous FEM studies (Butson and McIntyre <xref ref-type="bibr" rid="CR7">2005</xref>; Grant and Lowery <xref ref-type="bibr" rid="CR17">2010</xref>; Tracey and Williams <xref ref-type="bibr" rid="CR53">2011</xref>). It is essential to ensure the correct relationship between the real and imaginary part of an immittance, which is given by the Kramers-Kronig transforms (Van Gemert <xref ref-type="bibr" rid="CR54">1972</xref>; Bechhoefer <xref ref-type="bibr" rid="CR4">2011</xref>; Miceli et al. <xref ref-type="bibr" rid="CR35">2017</xref>; Bédard and Destexhe <xref ref-type="bibr" rid="CR6">2018</xref>). Both the medium (Van Gemert <xref ref-type="bibr" rid="CR54">1972</xref>; Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>) and the electrode interface impedance (Van Meirhaeghe et al. <xref ref-type="bibr" rid="CR55">1976</xref>; Macdonald and Urquidi-Macdonald <xref ref-type="bibr" rid="CR32">1990</xref>; Richardot and McAdams <xref ref-type="bibr" rid="CR49">2002</xref>) values we use satisfy the Kramers-Kronig relationship.</p>
      <p id="Par12">In both the resistive (<xref rid="Equ1" ref-type="">1</xref>) and capacitive (<xref rid="Equ2" ref-type="">2</xref>) scenario, a homogeneous Neumann boundary condition (BC) is applied on the exterior boundary <italic>∂</italic>Ω,
<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  \sigma\nabla \varphi \cdot \boldsymbol{n} = 0, \text{ on } \partial{\Omega}, $$\end{document}</tex-math><mml:math id="M6"><mml:mi>σ</mml:mi><mml:mo>∇</mml:mo><mml:mi>φ</mml:mi><mml:mo>⋅</mml:mo><mml:mi mathvariant="bold-italic">n</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.3em"/><mml:mtext>on</mml:mtext><mml:mspace width="0.3em"/><mml:mi>∂</mml:mi><mml:mi mathvariant="normal">Ω</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>where <bold><italic>n</italic></bold> is the unit outer normal vector on <italic>∂</italic>Ω.</p>
    </sec>
    <sec id="Sec4">
      <title>The Finite Element Method for Solving the Forward Problem</title>
      <p id="Par13">Lagrangian FEM was used to solve the Poisson (<xref rid="Equ1" ref-type="">1</xref>) (Logg et al. <xref ref-type="bibr" rid="CR30">2012</xref>; Larson and Bengzon <xref ref-type="bibr" rid="CR28">2013</xref>; Langtangen and Mardal <xref ref-type="bibr" rid="CR27">2016</xref>). The first step consists of deriving the so-called weak formulation of the elliptic partial differential equation (<xref rid="Equ1" ref-type="">1</xref>) (Langtangen and Mardal <xref ref-type="bibr" rid="CR27">2016</xref>):
<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  a(u,v) = L(v), \forall u,v \text{ in } V \in H^{1}({\Omega}), $$\end{document}</tex-math><mml:math id="M8"><mml:mi>a</mml:mi><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mo>∀</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mspace width="0.3em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.3em"/><mml:mi>V</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:mi mathvariant="normal">Ω</mml:mi><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  \text{where } a(u,v) = {\int}_{{\Omega}} \sigma \nabla u \cdot \nabla v \text{ d}x $$\end{document}</tex-math><mml:math id="M10"><mml:mtext>where</mml:mtext><mml:mspace width="0.3em"/><mml:mi>a</mml:mi><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:mi>σ</mml:mi><mml:mo>∇</mml:mo><mml:mi>u</mml:mi><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:mi>v</mml:mi><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  \text{and } L(v) = {\int}_{{\Omega}} f v \text{ d}x, $$\end{document}</tex-math><mml:math id="M12"><mml:mtext>and</mml:mtext><mml:mspace width="0.3em"/><mml:mi>L</mml:mi><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:mi>f</mml:mi><mml:mi>v</mml:mi><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula>where <italic>H</italic><sup>1</sup> is the first-order Sobolev space. The weak form can be heuristically derived by multiplication with a test function <italic>v</italic> ∈ <italic>V</italic> and subsequent partial integration. Reorganization of some terms and applying the homogeneous Neumann BC leads to (<xref rid="Equ5" ref-type="">5</xref>) and (<xref rid="Equ6" ref-type="">6</xref>).</p>
      <p id="Par14">In the second step, (<xref rid="Equ4" ref-type="">4</xref>) is discretized yielding the following linear system:
<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  A u = b, $$\end{document}</tex-math><mml:math id="M14"><mml:mi>A</mml:mi><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula>with <inline-formula id="IEq1"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$A_{ij} = {\int \limits }_{\Omega } \sigma \nabla \varphi _i \cdot \nabla \varphi _j \text { d}x$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:mi>σ</mml:mi><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq1.gif"/></alternatives></inline-formula> and <inline-formula id="IEq2"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$b_{i} = {\int \limits }_{{\Omega }} f \varphi _{i} \text { d}x$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:mi>f</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq2.gif"/></alternatives></inline-formula>, and {<italic>φ</italic><sub><italic>i</italic></sub>}<sub><italic>i</italic></sub> a set of basis functions.</p>
      <p id="Par15">Next, the linear system (<xref rid="Equ7" ref-type="">7</xref>) is solved and the finite dimensional solution <inline-formula id="IEq3"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$u = {\sum }_{j} u_{j} \varphi _{j}$\end{document}</tex-math><mml:math id="M20"><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq3.gif"/></alternatives></inline-formula> is found.</p>
      <p id="Par16">In order to solve (<xref rid="Equ2" ref-type="">2</xref>) with FEM, we had to deal with complex numbers (i.e., admittivity <italic>y</italic>), whose direct use was not yet implemented in FEniCS. In particular, we assembled complex numbers in a representation using real-valued coupled-PDEs. Starting from the strong formulation in the complex function space, i.e.,
<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  -\nabla\cdot\left( \left( y_{r}+j y_{j}\right) \nabla \left( \varphi_{r}+j \varphi_{j}\right)\right) = f_{r}+jf_{j} \quad\text{in } {\Omega}, $$\end{document}</tex-math><mml:math id="M22"><mml:mo>−</mml:mo><mml:mo>∇</mml:mo><mml:mo>⋅</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>j</mml:mi><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∇</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>j</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>j</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="1em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.3em"/><mml:mi mathvariant="normal">Ω</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula>we split trial functions, test functions and the admittivity tensor into a real and imaginary part, <italic>u</italic> = <italic>u</italic><sub><italic>r</italic></sub> + <italic>j</italic><italic>u</italic><sub><italic>j</italic></sub>, <italic>v</italic> = <italic>v</italic><sub><italic>r</italic></sub> + <italic>j</italic><italic>v</italic><sub><italic>j</italic></sub> and <italic>y</italic> = <italic>y</italic><sub><italic>r</italic></sub> + <italic>j</italic><italic>y</italic><sub><italic>j</italic></sub>, respectively, therefore considering the mixed space <italic>W</italic> = <italic>V</italic> × <italic>V</italic>. This results in a matrix doubled in linear size, composed of four blocks of the matrix created for the real version.</p>
      <p id="Par17">The weak form can again be derived by multiplying with the test function followed by partial integration, which for the left hand side gives a real part:
<disp-formula id="Equa"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \begin{array}{@{}rcl@{}} a_{r}(u, v) &amp;=&amp; {\int}_{{\Omega}} (y_{r} \nabla v_{r} \cdot\nabla u_{r}) - (y_{r} \nabla v_{j} \cdot\nabla u_{j})\\ &amp;&amp;- (y_{j} \nabla v_{r} \cdot\nabla u_{j}) - (y_{j} \nabla v_{j} \cdot \nabla u_{r}) \text{ d}x \end{array} $$\end{document}</tex-math><mml:math id="M24"><mml:mtable class="eqnarray" columnalign="right center left"><mml:mtr><mml:mtd class="eqnarray-1"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo></mml:mtd><mml:mtd class="eqnarray-2"><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="eqnarray-3"><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"/><mml:mtd class="eqnarray-3"><mml:mo>−</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12021_2020_9458_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>and an imaginary part:
<disp-formula id="Equb"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \begin{array}{@{}rcl@{}} a_{j}(u, v) &amp;=&amp; {\int}_{{\Omega}} (-y_{i} \nabla v_{j} \cdot\nabla u_{j}) + (y_{r} \nabla v_{j} \cdot\nabla u_{r})\\ &amp;&amp;+ (y_{j} \nabla v_{r} \cdot\nabla u_{r}) + (y_{r} \nabla v_{r} \cdot\nabla u_{j}) \text{ d}x \end{array} $$\end{document}</tex-math><mml:math id="M26"><mml:mtable class="eqnarray" columnalign="right center left"><mml:mtr><mml:mtd class="eqnarray-1"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo></mml:mtd><mml:mtd class="eqnarray-2"><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="eqnarray-3"><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"/><mml:mtd class="eqnarray-3"><mml:mo>+</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12021_2020_9458_Article_Equb.gif" position="anchor"/></alternatives></disp-formula>Without an imaginary source, the right hand side weak form contains real part <inline-formula id="IEq4"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$L_{r}(v) = {\int \limits }_{{\Omega }} f_{r} v_{r} \text { d}x$\end{document}</tex-math><mml:math id="M28"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq4.gif"/></alternatives></inline-formula> and imaginary part <inline-formula id="IEq5"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$L_{j}(v) ={\int \limits }_{{\Omega }} f_{r} v_{j} \text { d}x$\end{document}</tex-math><mml:math id="M30"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>x</mml:mi></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq5.gif"/></alternatives></inline-formula>.</p>
      <sec id="Sec5">
        <title>Electrode-Electrolyte Interface</title>
        <p id="Par18">There are several ways to approximate the impedance that results from the electrode-electrolyte interface (Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>; Joucla and Yvert <xref ref-type="bibr" rid="CR26">2009</xref>). When recording or stimulating with an electrode, ideally no electrochemical reactions occur and hence all currents are capacitive. This regime can be modeled with a capacitance and an infinite transfer resistance at the (non-faradaic) interface of a stimulating or recording electrode. Richardot and McAdams (<xref ref-type="bibr" rid="CR49">2002</xref>) empirically find that a standard capacitor does not describe the non-faradaic impedance accurately. This requires a pseudocapacitive constant phase angle impedance <italic>Z</italic><sub><italic>C</italic><italic>P</italic><italic>A</italic></sub>:
<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  Z_{CPA} = K(j\omega)^{-\upbeta}, $$\end{document}</tex-math><mml:math id="M32"><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mi>P</mml:mi><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="normal">β</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula>where <italic>K</italic> = 1.57Ω<italic>m</italic><sup>2</sup><italic>s</italic><sup>−β</sup> and β = 0.91 are physical constants (Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>; Richardot and McAdams <xref ref-type="bibr" rid="CR49">2002</xref>).</p>
        <p id="Par19">Joucla and Yvert (<xref ref-type="bibr" rid="CR26">2009</xref>) estimated the electrode-electrolyte interface impedance by fitting their FEM solutions to experimental data. In their model, the interface currents are described with faradaic reactions using a thin-layer approximation with a real valued surface admittance <italic>y</italic><sub><italic>k</italic></sub> (<italic>S</italic>/<italic>m</italic><sup>2</sup>) expressed by the so-called Robin BC applied at the <italic>k</italic>-th electrode:
<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  -\sigma{\partial \varphi\over\partial \text{n}} = y_{k}(\varphi-\varphi_{\text{metal}_{k}}), \text{on }{\Gamma}_{{~}_{\mathrm{R}}}^{k},\quad k=0,1, \ldots $$\end{document}</tex-math><mml:math id="M34"><mml:mo>−</mml:mo><mml:mi>σ</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mtext>n</mml:mtext></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>φ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mtext>on</mml:mtext><mml:mspace width="0.3em"/><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mspace width="0.3em"/></mml:mrow><mml:mrow><mml:mi mathvariant="normal">R</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq6"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\varphi _{\text {metal}_{k}}$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq6.gif"/></alternatives></inline-formula> is the electrical potential of the <italic>k</italic>-th electrode, <inline-formula id="IEq7"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}${\Gamma }_{{~}_{\mathrm {R}}}^{k}$\end{document}</tex-math><mml:math id="M38"><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mspace width="0.3em"/></mml:mrow><mml:mrow><mml:mi mathvariant="normal">R</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq7.gif"/></alternatives></inline-formula> is its boundary.</p>
        <p id="Par20">Cantrell et al. and Grant and Lowery considered a constant phase angle impedance (<xref rid="Equ9" ref-type="">9</xref>) and a charge transfer resistance set up in parallel. The double layer (Helmholtz <xref ref-type="bibr" rid="CR22">1879</xref>) is assumed to be 1 nm thick and the overpotential-independent charge transfer resistance can be described with the gas constant <italic>R</italic>, temperature <italic>T</italic>, number of electrons per molecule <italic>n</italic>, Faraday’s constant <italic>F</italic> and the exchange current <italic>I</italic><sub>0</sub>. The appropriate values for these parameters are discussed in detail in Cantrell et al. (<xref ref-type="bibr" rid="CR9">2007</xref>). The charge transfer resistance <italic>R</italic><sub><italic>C</italic><italic>T</italic></sub> (Ohm) is defined in terms of these variables:
<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  R_{CT} = \frac{RT}{nFI_{0}}. $$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac class="tfrac"><mml:mrow><mml:mi>R</mml:mi><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>F</mml:mi><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mn>.</mml:mn></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par21">In our approach, we used Robin boundary conditions (<xref rid="Equ10" ref-type="">10</xref>) to describe the interface, with its surface admittance <italic>y</italic><sub><italic>k</italic></sub> described by the pseudocapacitance (<xref rid="Equ9" ref-type="">9</xref>) and charge transfer resistance (<xref rid="Equ11" ref-type="">11</xref>) set up in parallel. Depending on the chosen <italic>y</italic><sub><italic>k</italic></sub>, the interface processes can be described as faradaic, non-faradaic or a combination of the two.</p>
        <p id="Par22">In the case of recording electrodes, (<xref rid="Equ10" ref-type="">10</xref>) needs to be used self-consistently, since for each electrode the value of <italic>φ</italic><sub>metal</sub> is unknown. We use the Lagrange multiplier method (Hansbo et al. <xref ref-type="bibr" rid="CR20">2005</xref>; Hansbo <xref ref-type="bibr" rid="CR19">2006</xref>; Amdouni et al. <xref ref-type="bibr" rid="CR2">2012</xref>) to impose <italic>φ</italic><sub>metal</sub> as the surface integral over the electrode in Eq. <xref rid="Equ10" ref-type="">10</xref>:
<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$  \varphi_{\text{metal}} = \frac{1}{S}{\int}_{S} \varphi \text{ d}S. $$\end{document}</tex-math><mml:math id="M42"><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mi>φ</mml:mi><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>S</mml:mi><mml:mn>.</mml:mn></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
      <sec id="Sec6">
        <title>Interface Weak Form</title>
        <p id="Par23">The weak form of the Robin BCs (<xref rid="Equ10" ref-type="">10</xref>) is found multiplying trial function <italic>u</italic> by the test function <italic>v</italic> and integrating over the boundary:
<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ -{\int}_{\partial{\Omega}} \sigma\frac{\partial \varphi}{\partial n}v \text{ d}s = \sum\limits_{k}{\int}_{{{\Gamma}_{R}^{k}}}y_{k}(\varphi-\varphi_{\text{metal}_{k}}) \text{ d}s. $$\end{document}</tex-math><mml:math id="M44"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:msub><mml:mi>σ</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:mfrac><mml:mi>v</mml:mi><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>∑</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>φ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi><mml:mn>.</mml:mn></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par24">To allow for complex numbers, similarly to the capacitive Poisson (<xref rid="Equ2" ref-type="">2</xref>), the test and trial functions are split in real and imaginary parts. The surface admittance <italic>y</italic><sub><italic>k</italic></sub> is split into interface conductivity <italic>g</italic> and interface susceptivity <italic>b</italic>, i.e. <italic>y</italic><sub><italic>k</italic></sub> = <italic>g</italic> + <italic>i</italic><italic>b</italic>. Now the Robin BC can be written as:
<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \begin{array}{@{}rcl@{}} {\int}_{{{\Gamma}_{R}^{k}}}y_{k}(u-\varphi_{\text{metal}_{k}})v \text{ d}s &amp;=&amp; {\int}_{{{\Gamma}_{R}^{k}}}(g+jb)((u_{r}+ju_{i})\\ &amp;&amp;-\varphi_{\text{metal}_{k}})(v_{r}+j v_{i} ) \text{ d}s \end{array} $$\end{document}</tex-math><mml:math id="M46"><mml:mtable class="eqnarray" columnalign="right center left"><mml:mtr><mml:mtd class="eqnarray-1"><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>v</mml:mi><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi></mml:mtd><mml:mtd class="eqnarray-2"><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="eqnarray-3"><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>j</mml:mi><mml:mi>b</mml:mi><mml:mo>)</mml:mo><mml:mo>(</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>j</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"/><mml:mtd class="eqnarray-3"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>j</mml:mi><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par25">Expanding this equation yield to the real part and imaginary parts:
<disp-formula id="Equ15"><label>15</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \begin{array}{@{}rcl@{}} &amp;&amp;\text{Real: }{\int}_{{{\Gamma}_{R}^{k}}}(g u_{r} v_{r} - g u_{i} v_{i} - b u_{i} v_{r} - b u_{r} v_{i}) \text{ d}s\\ &amp;&amp;+ {\int}_{{{\Gamma}_{R}^{k}}}(b \varphi_{\text{metal}_{k}} v_{i} -g \varphi_{\text{metal}_{k}} v_{r}) \text{ d}s \end{array} $$\end{document}</tex-math><mml:math id="M48"><mml:mtable class="eqnarray" columnalign="right center left"><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"/><mml:mtd class="eqnarray-3"><mml:mtext>Real:</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"/><mml:mtd class="eqnarray-3"><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mspace width="0.3em"/><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ15.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ16"><label>16</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \begin{array}{@{}rcl@{}} &amp;&amp;\text{Imaginary: } {\int}_{{{\Gamma}_{R}^{k}}}(g u_{i} v_{r} + g u_{r} v_{i} + b u_{r} v_{r} - b u_{i} v_{i}) \text{d}s\\ &amp;&amp;- {\int}_{{{\Gamma}_{R}^{k}}}(g \varphi_{\text{metal}_{k}} v_{i} + b \varphi_{\text{metal}_{k}} v_{r}) \text{d}s \end{array} $$\end{document}</tex-math><mml:math id="M50"><mml:mtable class="eqnarray" columnalign="right center left"><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"/><mml:mtd class="eqnarray-3"><mml:mtext>Imaginary:</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="eqnarray-1"/><mml:mtd class="eqnarray-2"/><mml:mtd class="eqnarray-3"><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ16.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par26">The variational formulation <italic>a</italic>(<italic>u</italic>,<italic>v</italic>) = <italic>L</italic>(<italic>v</italic>) needs all integrals depending on the trial function <italic>u</italic> on the left hand side (<italic>a</italic>(<italic>u</italic>,<italic>v</italic>)) and the remaining integrals on the right hand side (<italic>L</italic>(<italic>v</italic>)). Thus, the real and imaginary integrals from the Robin BC are split into two parts, with subscripts <italic>i</italic> and <italic>r</italic> indicating the imaginary and real parts, respectively:
<disp-formula id="Equ17"><label>17</label><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ a_{r}(u, v) = \sum\limits_{k} {\int}_{{{\Gamma}_{R}^{k}}} (g u_{r} v_{r} - g u_{i} v_{i} - b u_{i} v_{r} - b u_{r} v_{i}) \text{d}s, $$\end{document}</tex-math><mml:math id="M52"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>∑</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ17.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ18"><label>18</label><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ a_{i}(u, v) = \sum\limits_{k} {\int}_{{{\Gamma}_{R}^{k}}} (g u_{i} v_{r} + g u_{r} v_{i} + b u_{r} v_{r} - b u_{i} v_{i}) \text{d}s, $$\end{document}</tex-math><mml:math id="M54"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>∑</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ18.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ19"><label>19</label><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ L_{r}(v) = \sum\limits_{k} {\int}_{{{\Gamma}_{R}^{k}}} (g \varphi_{\text{metal}_{k}} v_{r} - b \varphi_{\text{metal}_{k}} v_{i}) \text{d}s, $$\end{document}</tex-math><mml:math id="M56"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>∑</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ19.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ20"><label>20</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ L_{i}(v) = \sum\limits_{k} {\int}_{{{\Gamma}_{R}^{k}}} (g \varphi_{\text{metal}_{k}} v_{i} + b \varphi_{\text{metal}_{k}} v_{r}) \text{d}s. $$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>∑</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">Γ</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>b</mml:mi><mml:msub><mml:mrow><mml:mi>φ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>metal</mml:mtext></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi><mml:mn>.</mml:mn></mml:math><graphic xlink:href="12021_2020_9458_Article_Equ20.gif" position="anchor"/></alternatives></disp-formula></p>
      </sec>
    </sec>
    <sec id="Sec7">
      <title>Geometrical Models</title>
      <p id="Par27">In this study, three different geometries were used.</p>
      <p id="Par28">A four-layered sphere model (M1, Fig. <xref rid="Fig1" ref-type="fig">1</xref>a) representing the human head containing brain, cerebrospinal fluid (CSF), skull and scalp. The radii of the spheres are 9.0 cm, 8.5 cm, 8.0 cm and 7.9 cm, respectively (De Munck et al. <xref ref-type="bibr" rid="CR10">1993</xref>; Bauer et al. <xref ref-type="bibr" rid="CR3">2015</xref>; Naess et al. <xref ref-type="bibr" rid="CR37">2017</xref>). The mesh consists of about 12 million tetrahedra with a smallest inradius of 26 <italic>μ</italic> m and a largest of 0.5 cm. The script to generate the mesh used in this paper has been described in Naess et al. (<xref ref-type="bibr" rid="CR37">2017</xref>).
<fig id="Fig1"><label>Fig. 1</label><caption><p>Geometrical models M1-M3. <bold>a</bold> Four-sphere head model (Naess et al. <xref ref-type="bibr" rid="CR37">2017</xref>), where the layers represent the different conductivities of the brain, CSF, skull and scalp compartments. <bold>b</bold> Bottom view of an experimental MEA set-up (Joucla and Yvert <xref ref-type="bibr" rid="CR26">2009</xref>) with a 200 <italic>μ</italic> m thick square slab of brain in the middle. The remainder of the cylinder is filled with Ringer’s solution (in blue). In the bottom right corner of the cylinder, the external cylindrical ground electrode (in purple) is positioned. On the tissue surface (in yellow) 60 distributed conical recording electrodes (in grey) and one square stimulating electrode (in red) are placed. Other square electrodes were not used for stimulation. The top panel displays a magnified region containing 8 recording and the stimulating electrode. <bold>c</bold> Realistic head model (Thielscher et al. <xref ref-type="bibr" rid="CR52">2015</xref>), segmented in scalp (red), skull (yellow), CSF (green), grey (light blue) and white matter (blue)</p></caption><graphic xlink:href="12021_2020_9458_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par29">The second geometric model (M2, Fig. <xref rid="Fig1" ref-type="fig">1</xref>b) corresponds to a multi-electrode array (MEA) set-up used in Joucla and Yvert (<xref ref-type="bibr" rid="CR26">2009</xref>). The volume consists of a cylinder (diameter: 19mm, height: 5mm) filled with Ringer’s solution and a rectangular slab of neuronal tissue with dimensions similar to an embryonic mouse hindbrain-spinal cord. The MEA was positioned at the bottom of the tissue, with 60 conical recording electrodes (base diameter: 80 <italic>μ</italic> m, height: 80 <italic>μ</italic> m). The stimulating electrode was modeled as a rectangular surface (width: 60 <italic>μ</italic> m, length: 250 <italic>μ</italic> m) on the same MEA (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b, inset in upper panel). An external cylindrical ground electrode (diameter: 2 mm, height: 4.3 mm) was represented by a cavity in the Ringer’s solution subdomain (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b, purple cylinder positioned in the lower right region). We used the mesh that was generated by Joucla and Yvert using FEMLAB 3.1a (COMSOL AB, Stockholm, Sweden). It consists of 63,214 tetrahedra.
</p>
      <p id="Par30">The third geometry is a realistic head model (M3, Fig. <xref rid="Fig1" ref-type="fig">1</xref>c) segmented in scalp, skull, CSF, grey and white matter (Ernie, provided in SimNIBS, Thielscher et al. <xref ref-type="bibr" rid="CR52">2015</xref>). For the grey and white matter, anisotropic conductivities estimated in SimNIBS (Thielscher et al. <xref ref-type="bibr" rid="CR52">2015</xref>) were used during the FEM calculations. The mesh contains approximately 4.2 × 10<sup>6</sup> tetrahedra, where the inradius of each tetrahedra is below 1 mm.</p>
    </sec>
    <sec id="Sec8">
      <title>Simulation Set-Ups</title>
      <p id="Par31">The FEM simulations are performed using the open-source program FEniCS (Alnæs et al. <xref ref-type="bibr" rid="CR1">2015</xref>; Logg and Wells <xref ref-type="bibr" rid="CR29">2010</xref>). All simulations were done with Lagrange finite elements using the PETSc Krylov Solver with either the Conjugate Gradient method or generalized minimal residual method (GMRES) to solve the linear systems. Note however that a variety of other solvers is available.
</p>
      <p id="Par32">Study 1: The linear system was numerically solved in the four-sphere head model (M1) using an average zero reference and compared to the analytical solution (Naess et al. <xref ref-type="bibr" rid="CR37">2017</xref>). The dielectric parameters <italic>σ</italic> and <italic>ε</italic><sub><italic>r</italic></sub> of the four layers were calculated using the four-term Cole-Cole expression (Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>) at 10 MHz (Table <xref rid="Tab1" ref-type="table">1</xref>). This frequency serves as an example and other frequencies yield comparable results. Furthermore, since there is no agreement on the correct dispersive dielectric parameters (Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>; Miceli et al. <xref ref-type="bibr" rid="CR35">2017</xref>; Wagner et al. <xref ref-type="bibr" rid="CR57">2014</xref>), the values in this paper serve as an example. We solved the capacitive Poisson (<xref rid="Equ2" ref-type="">2</xref>) with the homogeneous Neumann BC (<xref rid="Equ3" ref-type="">3</xref>) on the outer surface. Dipoles were positioned at depths from 1 mm to 5 mm under the grey matter surface and oriented radially, tangentially or at a 45-degree angle. Dipoles were approximated with a positive and negative monopole of magnitude 100 <italic>μ</italic> A, at 1 mm distance from each other. Relative Differences (<inline-formula id="IEq8"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$RD = \frac {1}{N}{\sum }_{i=1}^{N} \frac {|\phi _{i} - \psi _{i}|}{{\max \limits } {|\psi |}}$\end{document}</tex-math><mml:math id="M60"><mml:mi>R</mml:mi><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msubsup><mml:mfrac class="tfrac"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi><mml:mo>|</mml:mo><mml:mi>ψ</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="12021_2020_9458_Article_IEq8.gif"/></alternatives></inline-formula>), where <italic>ϕ</italic><sub><italic>i</italic></sub> is the numerical solution at location i, <italic>ψ</italic><sub><italic>i</italic></sub> the analytical solution and <italic>N</italic> the number of locations, were calculated on the surface between brain tissue and CSF at 32,400 evenly distributed locations to compare the analytical and numerical solutions. These locations on the brain surface represent ECoG point-electrodes.
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Isotropic conductivities and mean conductivities of the anisotropic white and grey matter (left column) (Opitz et al. <xref ref-type="bibr" rid="CR45">2011</xref>)</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Name</th><th align="left"><italic>σ</italic> (S/m)</th><th align="left"><italic>σ</italic> (S/m) 10MHz</th><th align="left"><italic>ε</italic><sub><italic>r</italic></sub> 10MHz</th></tr></thead><tbody><tr><td align="left">Grey</td><td align="left">0.276</td><td align="left">.29</td><td align="left">320</td></tr><tr><td align="left">White</td><td align="left">0.126</td><td align="left">.16</td><td align="left">176</td></tr><tr><td align="left">CSF</td><td align="left">1.654</td><td align="left">2</td><td align="left">109</td></tr><tr><td align="left">Skull</td><td align="left">0.010</td><td align="left">.04</td><td align="left">36.8</td></tr><tr><td align="left">Scalp</td><td align="left">0.465</td><td align="left">.2</td><td align="left">362</td></tr></tbody></table><table-wrap-foot><p>Dielectric properties for tissues at 10MHz calculated using the four-term Cole-Cole expression (Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>). This frequency serves as an example and other frequencies yield comparable results. The frequency of biopotentials and stimulating electrodes is generally below 10 kHz</p></table-wrap-foot></table-wrap></p>
      <p id="Par33">Study 2: The capacitive Poisson (<xref rid="Equ2" ref-type="">2</xref>) was solved in M2, taking into account four combinations of capacitive dispersive material effects: a) capacitive tissue and a capacitive electrode interface surface admittance, b) capacitive tissue and a pseudocapacitance electrode interface surface admittance, c) dispersive tissue and a capacitive electrode interface surface admittance, d) dispersive tissue and a pseudocapacitance electrode interface surface admittance. A 200 <italic>μ</italic> s rectangular pulse was applied by the stimulating electrodes and decomposed in 50,001 frequencies (between 0 and 1/(2 dt) Hz, where dt is 10 <italic>μ</italic> s). In the dispersive case, the conductivity and permittivity values of the tissue and Ringer’s solution were calculated for each frequency using the four-term Cole-Cole equation (Eq (8), Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>). For the capacitive case, the conductivity and permittivity values were calculated using the four-term Cole-Cole equation at the average frequency of the pulse FFT. The ground and stimulating electrode surface admittance was implemented as a Robin BC (<xref rid="Equ10" ref-type="">10</xref>). The pseudocapacitive case consisted of an equivalent impedance of a pseudocapacitance ((<xref rid="Equ9" ref-type="">9</xref>)) and a charge transfer resistance ((<xref rid="Equ11" ref-type="">11</xref>)) set up in parallel (Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>). The capacitive electrode case used the capacitance and resistance of the parallel pseudocapacitive circuit at the average frequency of the pulse FFT. Note that the capacitive reactance of the electrode remains dependent on frequency.
</p>
      <p id="Par34">Study 3: As a proof of principle, Eq. (<xref rid="Equ1" ref-type="">1</xref>) with BC (<xref rid="Equ3" ref-type="">3</xref>) was solved in a realistic head model (M3). Tissue properties (Table <xref rid="Tab1" ref-type="table">1</xref> first column) were resistive and anisotropic. The dipole was tangentially and radially oriented with regard to the average normal of one of the electrodes at a distance of 1 mm.</p>
    </sec>
    <sec id="Sec9">
      <title>Implementation</title>
      <p id="Par35">The workflow of the simulation pipeline FEMfuns for the potential is visualized in a schematic overview (Fig. <xref rid="Fig2" ref-type="fig">2</xref>) and has the following steps:
<list list-type="order"><list-item><p id="Par36">Create the mesh (top yellow boxes in Fig. <xref rid="Fig2" ref-type="fig">2</xref>)
<list list-type="alpha-lower"><list-item><p id="Par37">Define the different materials into separate subdomains and mark interfacial regions as boundaries</p></list-item><list-item><p id="Par38">Convert geometry to FEniCS format</p></list-item></list></p></list-item><list-item><p id="Par39">Choose simulation parameters for the (Parameters module in Fig. <xref rid="Fig2" ref-type="fig">2</xref>):
<list list-type="alpha-lower"><list-item><p id="Par40">Type and location of source (e.g. electrode, monopole, dipole)</p></list-item><list-item><p id="Par41">Capacitive/resistive/dispersive tissue (Table <xref rid="Tab1" ref-type="table">1</xref>)</p></list-item><list-item><p id="Par42">Electrode-tissue interface (<xref rid="Equ10" ref-type="">10</xref>)</p></list-item></list></p></list-item><list-item><p id="Par43">Create FEM simulation class instance (FEM_simulation in Fig. <xref rid="Fig2" ref-type="fig">2</xref>)</p></list-item><list-item><p id="Par44">Run simulation (main in Fig. <xref rid="Fig2" ref-type="fig">2</xref>)</p></list-item><list-item><p id="Par45">Visualize</p></list-item><list-item><p id="Par46">Compare to analytical solutions (when possible)</p></list-item></list><fig id="Fig2"><label>Fig. 2</label><caption><p>Sketch of the FEniCS pipeline (workflow goes from top to bottom). Red background indicates Python classes, green background the (main) output of the respective class. Purple background indicates functions in a class, blue the (main) output of the function and yellow indicates steps outside Python/FEniCS</p></caption><graphic xlink:href="12021_2020_9458_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par47">Since only simple geometries can be created within FEniCS, other tools like gmsh (Geuzaine and Remacle <xref ref-type="bibr" rid="CR13">2008</xref>) or integrated realistic head models (Thielscher et al. <xref ref-type="bibr" rid="CR52">2015</xref>) should be considered for the generation of a tetrahedral mesh. The steps performed outside Python/FEniCS environment are indicated in yellow in Fig. <xref rid="Fig2" ref-type="fig">2</xref>. In this study we used both gmsh (Geuzaine and Remacle <xref ref-type="bibr" rid="CR13">2008</xref>) and SimNIBS (Thielscher et al. <xref ref-type="bibr" rid="CR52">2015</xref>). After creating the mesh, parameters regarding the materials, sources and electrodes need to be set (Fig. <xref rid="Fig2" ref-type="fig">2</xref>, in red are the Python classes and their use and in green the main output is shown). A subsection of the mesh can be cut out, creating a new smaller mesh. This is useful when solving for the potential in a whole head is not necessary (e.g. when using microelectrodes close to the source). The FEM_simulation class contains functions (indicated in pink, in blue is its main output) which set-up and solve the linear system. Dipole locations can be calculated (source_locations) based on distance and orientation with respect to an electrode, as well as inter-dipole distances. A procedure for mesh refinement in a region of interest is implemented, for example to study convergence, where a minimum cell inradius can be set. The stiffness matrix <italic>A</italic><sub><italic>i</italic><italic>j</italic></sub> is computed in FEniCS with the main function. Based on the parameters that are chosen, resistive, dispersive or capacitive properties are used in the FEM calculation when calling main. In the frequency dependent analysis, a square pulse, alpha function or sine wave can be used as the activity waveform (e.g., make_pulse). Alternatively, a custom combination of frequencies can be given as input as well.</p>
      <p id="Par48">The Python code to obtain potentials from stimulating or recording electrodes, with three examples comparable to study 1-3, is available under the GNU General Public License version 3 at <ext-link ext-link-type="uri" xlink:href="https://github.com/meronvermaas/FEMfuns">https://github.com/meronvermaas/FEMfuns</ext-link>.</p>
    </sec>
  </sec>
  <sec id="Sec10">
    <title>Results</title>
    <sec id="Sec11">
      <title>Study 1: Validation</title>
      <p id="Par49">In study 1 we validated the accuracy of the numerical simulation in a four-sphere model with resistive and capacitive material properties (<xref rid="Equ2" ref-type="">2</xref>) by comparing it with the analytical solution. Numerical and analytical potentials were compared on the outer surface of the sphere representing the cortical surface, which is comparable to an ECoG grid location. These observation points are close to the dipolar source (human cortical thickness is at most 5 mm), with the distances between the dipole and the surface ranging from 1 mm to 5 mm. The analytical solution adopted in this comparison consists of a series expansion (Naess et al. <xref ref-type="bibr" rid="CR37">2017</xref>) with 1000 terms. Only the conductivity in the analytical solution was changed into the admittivity, containing a real (conductance) and imaginary (susceptance) part. We computed the relative difference (RD) in the frequency domain at 10 MHz and visualized the results in Fig. <xref rid="Fig3" ref-type="fig">3</xref>. The RD values are typically small (below 0.04), whereas dipoles very close to the brain surface display the largest RDs. This is visible for the radial dipole in particular.
<fig id="Fig3"><label>Fig. 3</label><caption><p>Relative difference (RD) of ECoG potentials calculated with the four-sphere model for a radial, tangential, and 45-degree dipole. Both capacitive and resisitive electrical properties of the tissue are taken into account via Eq. (<xref rid="Equ2" ref-type="">2</xref>). The depth of the dipole below the cortical surface is varied (x-axis), error values are calculated at the surface of the grey matter</p></caption><graphic xlink:href="12021_2020_9458_Fig3_HTML" id="MO3"/></fig></p>
    </sec>
    <sec id="Sec12">
      <title>Study 2: Dispersive Electrode and Tissue Implementation</title>
      <p id="Par50">The effect of capacitive and dispersive materials under voltage-controlled stimulation was investigated in this study and the results are visualized in Fig. <xref rid="Fig4" ref-type="fig">4</xref>. The applied square pulse is shown in blue. The line in red shows the voltage waveform at a vertex on the inside of the interface when the dielectric properties of the tissue are dispersive (conductivity <italic>σ</italic>(<italic>ω</italic>) and relative permittivity <italic>𝜖</italic><sub><italic>r</italic></sub>(<italic>ω</italic>)) and the electrode interface is pseudocapacitive (a parallel pseudo-capacitance and charge transfer resistance). Dispersive tissue and a parallel RC electrode interface are shown in green, capacitive tissue and pseudocapacitive electrode interface in purple and capacitive tissue and RC electrode interface in light blue.
<fig id="Fig4"><label>Fig. 4</label><caption><p>Waveform potential at a stimulating electrode vertex. Frequency decomposition of a stimulating square pulse allows to infer the effect of dispersive material (Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>). The dielectric properties of the electrode-electrolyte interface are calculated with a parallel pseudocapacitive component and resistance (Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>) or a capacitive component and resistance at the average frequency of the FFT. The original pulse and pulses at a vertex at the interface of the stimulating electrode are plotted and the combinations of electrode interface and tissue properties are indicated in the legend</p></caption><graphic xlink:href="12021_2020_9458_Fig4_HTML" id="MO4"/></fig></p>
      <p id="Par51">From Fig. <xref rid="Fig4" ref-type="fig">4</xref> we notice that the voltage waveform at a vertex on the inside of the interface is deformed due to capacitive effects. The deformation of the potential at the vertex on the inside of the interface can mainly be explained by the time constant of the circuit representing the electrode interface. The two curves with a pseudocapacitive interface are overlapping (green and light blue curves), as well as the curves with an RC electrode interface (red and purple curves). Thus, in this geometry, the effect of the dispersive compared to capacitive tissue properties is negligible. Note the oscillations due to the Gibbs phenomenon which are minimized by increasing the padding around the pulse and the sampling frequency (Gibbs <xref ref-type="bibr" rid="CR14">1898</xref>). These results indicate substantial capacitive and dispersive effects due to the electrode-electrolyte interface when using stimulating electrodes.</p>
    </sec>
    <sec id="Sec13">
      <title>Study 3: Realistic Head Model</title>
      <p id="Par52">As a proof of concept, in the last example we solved (<xref rid="Equ1" ref-type="">1</xref>) in a realistic head model with anisotropic resistive material properties. A radial dipole was positioned at 1 mm below the surface of one of the electrodes and the resulting potential distribution is shown in Fig. <xref rid="Fig5" ref-type="fig">5</xref>. In Fig. <xref rid="Fig5" ref-type="fig">5</xref>a the potential distribution resulting from a tangential dipole is displayed on the cortical surface. The transition from the positive to the negative potential can be observed clearly on the cortical surface. Figure <xref rid="Fig5" ref-type="fig">5</xref>b illustrates the potential distribution of a radial dipole on the cortical surface. The different polarity of the gyrus and the sulcus due to the relative angle of the surface with the dipole can be observed.
<fig id="Fig5"><label>Fig. 5</label><caption><p>Grey matter region of potentials calculated in a realistic head model, with a tangential dipole left and radial dipole right. The dipole is placed 1 mm below the grey matter surface and the colormap is normalized</p></caption><graphic xlink:href="12021_2020_9458_Fig5_HTML" id="MO5"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec14">
    <title>Discussion</title>
    <p id="Par53">The purpose of this paper is to describe and introduce a Python-based framework centered around FEniCS for FEM forward calculations in electrophysiological recordings. We developed FEM scripts which allow neuroscientists to compute both resistive and frequency dependent capacitive material properties. Using three geometries, we show examples of the use of the FEMfuns pipeline. The main novelty that is presented here is the possibility to easily include electrode and capacitive material effects.</p>
    <p id="Par54">In study 1, we looked at dipole positions at several depths in a four-sphere head model and visualized the error at the surface directly on top of the brain, where ECoG grids are positioned (results in Fig. <xref rid="Fig3" ref-type="fig">3</xref>). The accuracy of the <italic>capacitive</italic> Poisson (<xref rid="Equ2" ref-type="">2</xref>) was calculated, which expands on the original approach where the <italic>resistive</italic> Poisson (<xref rid="Equ1" ref-type="">1</xref>) is solved on top of the scalp (Naess et al. <xref ref-type="bibr" rid="CR37">2017</xref>). With a tetrahedron inradius of 26 <italic>μ</italic> m at the region of interest, accurate numerical estimates were achieved with relative error values below 0.04. The RDs for dipoles very close to the brain surface are the highest. The two monopoles that were used to approximate a dipole need to be sufficiently close to each other. If the distance between the dipole and the recording location is much larger than the distance between the monopoles, the dipole will be more accurately approximated. Overall, these results demonstrate that dispersion effects can be accurately modeled.</p>
    <p id="Par55">Electrode effects have been studied extensively in stimulation studies (Robinson <xref ref-type="bibr" rid="CR50">1968</xref>; Butson and McIntyre <xref ref-type="bibr" rid="CR7">2005</xref>; Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>; Grant and Lowery <xref ref-type="bibr" rid="CR17">2010</xref>). Because of the reciprocity theorem, stimulating electrodes are useful models for recording electrodes as well. Non-linear behavior of the electrode-electrolyte interface is expected at high frequencies and at low frequencies provided that the applied signal amplitude is high (Richardot and McAdams <xref ref-type="bibr" rid="CR49">2002</xref>). Recording electrodes are unlikely to show major non-linear effects because the charge transfer resistance, Eq. (<xref rid="Equ11" ref-type="">11</xref>), dominates the interface impedance.
</p>
    <p id="Par56">In study 2, dispersion effects of the electrode interface (Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>) and the tissue properties (Gabriel et al. <xref ref-type="bibr" rid="CR12">1996</xref>) were examined in the stimulating electrode configuration (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). The shape of the simulated voltage waveforms is comparable with dispersion effects reported in the literature (Butson and McIntyre <xref ref-type="bibr" rid="CR7">2005</xref>; Grant and Lowery <xref ref-type="bibr" rid="CR17">2010</xref>). As the driving potential amplitude and frequency increase, the dispersion effect becomes more noticeable (Cantrell et al. <xref ref-type="bibr" rid="CR9">2007</xref>). The interface impedance acts as a high-pass filter in study 2 (i.e., the interface time constant is short compared to the time period of the input waveform) (Irwin and Nelms <xref ref-type="bibr" rid="CR24">2010</xref>). Thus, the charging and discharging of the capacitance is faster than the change of the input waveform.</p>
    <p id="Par57">In our example, due to the small surface area of the recording electrodes, the interface impedance is high (e.g., 400 kΩ at 100 Hz and 6 kΩ at 10000 Hz, using the pseudocapacitive interface impedance). This resulted in negligible interface (capacitive or dispersive) effects of the recording electrodes and it is in line with previous literature which shows minimal effect of the recording electrode (Moulin et al. <xref ref-type="bibr" rid="CR36">2008</xref>; Joucla and Yvert <xref ref-type="bibr" rid="CR26">2009</xref>; Nelson and Pouget <xref ref-type="bibr" rid="CR38">2010</xref>). However, if larger electrodes are used, interface effects due to the recording electrode can be observed (Ollikainen et al. <xref ref-type="bibr" rid="CR43">2000</xref>; Pursiainen et al. <xref ref-type="bibr" rid="CR48">2017</xref>).</p>
    <p id="Par58">As a proof of principle (study 3), the forward solution was computed in a realistic head model with radial and tangential dipoles. The four-sphere model simulations demonstrated that numerical errors are negligible if tessellation is sufficiently fine. With no analytical solution available in the realistic head-model, convergence can be checked using adaptive refinement while monitoring percent change between the solutions.</p>
    <p id="Par59">Other open-source pipelines for solving the EEG and/or the magnetoencephalography (MEG) forward problems with FEM, or simulating electric stimulations are available (Hagen et al. <xref ref-type="bibr" rid="CR18">2018</xref>; Neymotin et al. <xref ref-type="bibr" rid="CR40">2019</xref>). Fieldtrip (Oostenveld et al. <xref ref-type="bibr" rid="CR44">2011</xref>), for example, is a MATLAB software toolbox for MEG, EEG, iEEG and NIRS analysis, that includes functions aiming at solving the EEG forward problem with FEM. Fieldtrip internally calls the C++ open source library called SIMBIO (Vorwerk et al. <xref ref-type="bibr" rid="CR56">2018</xref>, <ext-link ext-link-type="uri" xlink:href="https://www.mrt.uni-jena.de/simbio/">https://www.mrt.uni-jena.de/simbio/</ext-link>). To the best of our knowledge, in Fieldtrip it is not possible to simulate electrical stimulation and neither is it possible to easily change the properties of the electrodes. Another open-access tool dealing with solving partial differential equations in neuroscience is duneuro (Nüßing et al. <xref ref-type="bibr" rid="CR42">2019</xref>). Duneuro is an open-source C++ software library based on the DUNE library and its main features include solving the EEG (Engwer et al. <xref ref-type="bibr" rid="CR11">2017</xref>) and MEG (Piastra et al. <xref ref-type="bibr" rid="CR46">2018</xref>) forward problem and providing simulations for brain stimulation. There are Python and MATLAB wrappers which extend the usability of the software to a broader audience. In the present implementation of duneuro, neither the capacitive model nor the electric properties of the electrodes are incorporated in the workflow. A further example of open-source tools dealing with simulations in neuroscience is SimNIBS (Windhoff et al. <xref ref-type="bibr" rid="CR58">2013</xref>), whose aim is to provide an easy-to-use pipeline for conducting brain simulations with FEM in realistically shaped head models. SimNIBS is limited to brain simulations and it is not flexible for adjusting the type of electrode or adding capacitive material properties.</p>
    <p id="Par60">The main limitations of the pipeline concern mesh generation, which currently needs to be done in external software such as FSL (Jenkinson et al. <xref ref-type="bibr" rid="CR25">2012</xref>) or gmsh. Segmentation of the different head materials was not addressed in the current study. Furthermore, currently only tetrahedral mesh elements can be used in FEniCS. While they can fit the complex geometry of the brain better, it requires several non-trivial steps to convert the hexahedral voxels of an anatomical MRI.</p>
    <p id="Par61">A further limitation concerns the time needed for running the simulations. Depending on the geometry, tissue type and electrode implementation, the linear system that needs to be solved can become very large. In this study, the calculation time was around 1.5 hours per simulation for the four-sphere model (M1), 6 s per simulation in the FEM-Fourier example (M2), and under 2 minutes in the realistic head model with anisotropic tissue properties (M3) running on a Intel(R) Xeon(R) CPU E5-2640 v3 @ 2.60GHz processor. Furthermore, to achieve the desired convergence rate and accuracy, the solver, preconditioner, number of iterations and/or convergence tolerance need to be adjusted. For example, when using capacitive tissue, the Conjugate Gradient method will not converge, while GMRES will.</p>
    <p id="Par62">A further advantage of the FEMfuns pipeline, is that it is easy to control factors affecting the convergence. Furthermore, a variety of families (e.g., Discontinuous Lagrange, Nedelec, Raviart-Thomas) and degrees (linear, quadratic or higher) of elements are supported in FEniCS. This means that the pipeline can also be used in combination with neuron simulation software to provide extracellular potentials.</p>
    <p id="Par63">The results of this study have shown the first open-source, easy-to-use and flexible pipeline, allowing for the simulation of multiple material compartments in volume conductor models with as many compartments as needed (e.g., an arbitrary amount of electrode volumes can be used). Resistive, capacitive and dispersive tissue properties can be used and different types of electrode are implemented. Furthermore, the Python code can be easily adjusted and extended to meet the users needs.</p>
  </sec>
  <sec id="Sec15">
    <title>Information Sharing Statement</title>
    <p id="Par64">The FEMfuns code for using the new methods is publicly available at <ext-link ext-link-type="uri" xlink:href="https://github.com/meronvermaas/FEMfuns">https://github.com/meronvermaas/FEMfuns</ext-link> and is licensed under the General Public License (GPL) v3. Documentation is provided at github, for support please contact the first author.</p>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We are grateful to Robert Oostenveld and Torbjørn Ness for their useful help, advice and suggestions. This work is part of the perspective programme NeuroCIMT with project number 14906, which is financed by the Dutch Research Council (NWO).</p>
  </ack>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alnæs</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Blechta</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hake</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Johansson</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Kehlet</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Logg</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Richardson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Ring</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Rognes</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Wells</surname>
            <given-names>GN</given-names>
          </name>
        </person-group>
        <article-title>The fenics project version 1.5</article-title>
        <source>Archive of Numerical Software</source>
        <year>2015</year>
        <volume>3</volume>
        <issue>100</issue>
        <fpage>9</fpage>
        <lpage>23</lpage>
      </element-citation>
    </ref>
    <ref id="CR2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amdouni</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hild</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Lleras</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Moakher</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Renard</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>A stabilized lagrange multiplier method for the enriched finite-element approximation of contact problems of cracked elastic bodies</article-title>
        <source>ESAIM: Mathematical Modelling and Numerical Analysis</source>
        <year>2012</year>
        <volume>46</volume>
        <issue>4</issue>
        <fpage>813</fpage>
        <lpage>839</lpage>
      </element-citation>
    </ref>
    <ref id="CR3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bauer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pursiainen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Vorwerk</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Köstler</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Wolters</surname>
            <given-names>CH</given-names>
          </name>
        </person-group>
        <article-title>Comparison study for whitney (raviart–thomas)-type source models in finite-element-method-based eeg forward modeling</article-title>
        <source>IEEE Transactions on Biomedical Engineering</source>
        <year>2015</year>
        <volume>62</volume>
        <issue>11</issue>
        <fpage>2648</fpage>
        <lpage>2656</lpage>
        <?supplied-pmid 26054057?>
        <pub-id pub-id-type="pmid">26054057</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bechhoefer</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Kramers–Kronig, bode, and the meaning of zero</article-title>
        <source>American Journal of Physics</source>
        <year>2011</year>
        <volume>79</volume>
        <issue>10</issue>
        <fpage>1053</fpage>
        <lpage>1059</lpage>
      </element-citation>
    </ref>
    <ref id="CR5">
      <mixed-citation publication-type="other">Bédard, C, &amp; Destexhe, A. (2017). Is the extracellular impedance high and non-resistive in cerebral cortex?.</mixed-citation>
    </ref>
    <ref id="CR6">
      <mixed-citation publication-type="other">Bédard, C, &amp; Destexhe, A. (2018). Kramers-kronig relations and the properties of conductivity and permittivity in heterogeneous media. arXiv:<ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/180100461">https://arxiv.org/abs/180100461</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butson</surname>
            <given-names>CR</given-names>
          </name>
          <name>
            <surname>McIntyre</surname>
            <given-names>CC</given-names>
          </name>
        </person-group>
        <article-title>Tissue and electrode capacitance reduce neural activation volumes during deep brain stimulation</article-title>
        <source>Clinical Neurophysiology</source>
        <year>2005</year>
        <volume>116</volume>
        <issue>10</issue>
        <fpage>2490</fpage>
        <lpage>2500</lpage>
        <?supplied-pmid 16125463?>
        <pub-id pub-id-type="pmid">16125463</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butson</surname>
            <given-names>CR</given-names>
          </name>
          <name>
            <surname>Cooper</surname>
            <given-names>SE</given-names>
          </name>
          <name>
            <surname>Henderson</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>McIntyre</surname>
            <given-names>CC</given-names>
          </name>
        </person-group>
        <article-title>Patient-specific analysis of the volume of tissue activated during deep brain stimulation</article-title>
        <source>NeuroImage</source>
        <year>2007</year>
        <volume>34</volume>
        <issue>2</issue>
        <fpage>661</fpage>
        <lpage>670</lpage>
        <?supplied-pmid 17113789?>
        <pub-id pub-id-type="pmid">17113789</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cantrell</surname>
            <given-names>DR</given-names>
          </name>
          <name>
            <surname>Inayat</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Taflove</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ruoff</surname>
            <given-names>RS</given-names>
          </name>
          <name>
            <surname>Troy</surname>
            <given-names>JB</given-names>
          </name>
        </person-group>
        <article-title>Incorporation of the electrode–electrolyte interface into finite-element models of metal microelectrodes</article-title>
        <source>Journal of Neural Engineering</source>
        <year>2007</year>
        <volume>5</volume>
        <issue>1</issue>
        <fpage>54</fpage>
        <?supplied-pmid 18310811?>
        <pub-id pub-id-type="pmid">18310811</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>De Munck</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Peters</surname>
            <given-names>MJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A fast method to compute the potential in the multisphere model</article-title>
        <source>IEEE Transactions on Biomedical Engineering</source>
        <year>1993</year>
        <volume>40</volume>
        <issue>11</issue>
        <fpage>1166</fpage>
        <lpage>1174</lpage>
        <?supplied-pmid 8307601?>
        <pub-id pub-id-type="pmid">8307601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Engwer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Vorwerk</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ludewig</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Wolters</surname>
            <given-names>CH</given-names>
          </name>
        </person-group>
        <article-title>A discontinuous galerkin method to solve the eeg forward problem using the subtraction approach</article-title>
        <source>SIAM Journal on Scientific Computing</source>
        <year>2017</year>
        <volume>39</volume>
        <issue>1</issue>
        <fpage>B138</fpage>
        <lpage>B164</lpage>
      </element-citation>
    </ref>
    <ref id="CR12">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gabriel</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lau</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gabriel</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>The dielectric properties of biological tissues: Iii. Parametric models for the dielectric spectrum of tissues</article-title>
        <source>Physics in Medicine And Biology</source>
        <year>1996</year>
        <volume>41</volume>
        <issue>11</issue>
        <fpage>2271</fpage>
        <?supplied-pmid 8938026?>
        <pub-id pub-id-type="pmid">8938026</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <mixed-citation publication-type="other">Geuzaine, C., &amp; Remacle, J. (2008). Gmsh: a three-dimensional finite element mesh generator with built-in pre-and post-processing facilities, version 2.2. 4.</mixed-citation>
    </ref>
    <ref id="CR14">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gibbs</surname>
            <given-names>JW</given-names>
          </name>
        </person-group>
        <article-title>Fourier’s series</article-title>
        <source>Nature</source>
        <year>1898</year>
        <volume>59</volume>
        <issue>1522</issue>
        <fpage>200</fpage>
      </element-citation>
    </ref>
    <ref id="CR15">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gomes</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Bédard</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Valtcheva</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Nelson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Khokhlova</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Pouget</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Venance</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Bal</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Destexhe</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Intracellular impedance measurements reveal non-ohmic properties of the extracellular medium around neurons</article-title>
        <source>Biophysical Journal</source>
        <year>2016</year>
        <volume>110</volume>
        <issue>1</issue>
        <fpage>234</fpage>
        <lpage>246</lpage>
        <?supplied-pmid 26745426?>
        <pub-id pub-id-type="pmid">26745426</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Goto</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Hatanaka</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Ogawa</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Sumiyoshi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Riera</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Kawashima</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>An evaluation of the conductivity profile in the somatosensory barrel cortex of wistar rats</article-title>
        <source>Journal of Neurophysiology</source>
        <year>2010</year>
        <volume>104</volume>
        <issue>6</issue>
        <fpage>3388</fpage>
        <lpage>3412</lpage>
        <?supplied-pmid 20810682?>
        <pub-id pub-id-type="pmid">20810682</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grant</surname>
            <given-names>PF</given-names>
          </name>
          <name>
            <surname>Lowery</surname>
            <given-names>MM</given-names>
          </name>
        </person-group>
        <article-title>Effect of dispersive conductivity and permittivity in volume conductor models of deep brain stimulation</article-title>
        <source>IEEE Transactions on Biomedical Engineering</source>
        <year>2010</year>
        <volume>57</volume>
        <issue>10</issue>
        <fpage>2386</fpage>
        <lpage>2393</lpage>
        <?supplied-pmid 20595081?>
        <pub-id pub-id-type="pmid">20595081</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hagen</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Næss</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Ness</surname>
            <given-names>TV</given-names>
          </name>
          <name>
            <surname>Einevoll</surname>
            <given-names>GT</given-names>
          </name>
        </person-group>
        <article-title>Multimodal modeling of neural network activity: computing lfp, ecog, eeg and meg signals with lfpy 2.0</article-title>
        <source>Frontiers in Neuroinformatics</source>
        <year>2018</year>
        <volume>12</volume>
        <fpage>92</fpage>
        <?supplied-pmid 30618697?>
        <pub-id pub-id-type="pmid">30618697</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Hansbo</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <source>Beyond the elements of finite elements: general principles for solid and fluid mechanics applications. Lecture notes</source>
        <year>2006</year>
        <publisher-loc>Sweden</publisher-loc>
        <publisher-name>Chalmers University of Technology</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR20">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hansbo</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Lovadina</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Perugia</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Sangalli</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>A lagrange multiplier method for the finite element solution of elliptic interface problems using non-matching meshes</article-title>
        <source>Numerische Mathematik</source>
        <year>2005</year>
        <volume>100</volume>
        <issue>1</issue>
        <fpage>91</fpage>
        <lpage>115</lpage>
      </element-citation>
    </ref>
    <ref id="CR21">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Helmholtz</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <article-title>Ueber einige gesetze der verteilung elektrischer ströme in körperlichen leitern, mit anwendung auf die thierisch-elektrischen versuche (schluss.)</article-title>
        <source>Annalen der Physik</source>
        <year>1853</year>
        <volume>165</volume>
        <issue>7</issue>
        <fpage>353</fpage>
        <lpage>377</lpage>
      </element-citation>
    </ref>
    <ref id="CR22">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Helmholtz</surname>
            <given-names>HV</given-names>
          </name>
        </person-group>
        <article-title>Studien über electrische grenzschichten</article-title>
        <source>Annalen der Physik</source>
        <year>1879</year>
        <volume>243</volume>
        <issue>7</issue>
        <fpage>337</fpage>
        <lpage>382</lpage>
      </element-citation>
    </ref>
    <ref id="CR23">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>BYK</given-names>
          </name>
        </person-group>
        <article-title>Solving boundary-value electrostatics problems using green’s reciprocity theorem</article-title>
        <source>American Journal of Physics</source>
        <year>2001</year>
        <volume>69</volume>
        <issue>12</issue>
        <fpage>1280</fpage>
        <lpage>1282</lpage>
      </element-citation>
    </ref>
    <ref id="CR24">
      <mixed-citation publication-type="other">Irwin, J.D., &amp; Nelms, R.M. (2010). <italic>Basic engineering circuit analysis</italic> (Vol. 900). Wiley.</mixed-citation>
    </ref>
    <ref id="CR25">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jenkinson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Beckmann</surname>
            <given-names>CF</given-names>
          </name>
          <name>
            <surname>Behrens</surname>
            <given-names>TE</given-names>
          </name>
          <name>
            <surname>Woolrich</surname>
            <given-names>MW</given-names>
          </name>
          <name>
            <surname>Smith</surname>
            <given-names>SM</given-names>
          </name>
        </person-group>
        <source>Neuroimage</source>
        <year>2012</year>
        <volume>62</volume>
        <issue>2</issue>
        <fpage>782</fpage>
        <lpage>790</lpage>
        <?supplied-pmid 21979382?>
        <pub-id pub-id-type="pmid">21979382</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Joucla</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Yvert</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Improved focalization of electrical microstimulation using microelectrode arrays: a modeling study</article-title>
        <source>PloS one</source>
        <year>2009</year>
        <volume>4</volume>
        <issue>3</issue>
        <fpage>e4828</fpage>
        <?supplied-pmid 19279677?>
        <pub-id pub-id-type="pmid">19279677</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <mixed-citation publication-type="other">Langtangen, H.P., &amp; Mardal, K.A. (2016). Introduction to numerical methods for variational problems.</mixed-citation>
    </ref>
    <ref id="CR28">
      <mixed-citation publication-type="other">Larson, M.G., &amp; Bengzon, F. (2013). <italic>The finite element method: theory, implementation, and applications</italic> (Vol. 10). Springer Science &amp; Business Media.</mixed-citation>
    </ref>
    <ref id="CR29">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Logg</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wells</surname>
            <given-names>GN</given-names>
          </name>
        </person-group>
        <article-title>Dolfin: automated finite element computing</article-title>
        <source>ACM Transactions on Mathematical Software (TOMS)</source>
        <year>2010</year>
        <volume>37</volume>
        <issue>2</issue>
        <fpage>20</fpage>
      </element-citation>
    </ref>
    <ref id="CR30">
      <mixed-citation publication-type="other">Logg, A, Mardal, K.A., &amp; Wells, G. (2012). <italic>Automated solution of differential equations by the finite element method: the FEniCS book</italic> (Vol. 84). Springer Science &amp; Business Media.</mixed-citation>
    </ref>
    <ref id="CR31">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Logothetis</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Kayser</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Oeltermann</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>In vivo measurement of cortical impedance spectrum in monkeys: implications for signal propagation</article-title>
        <source>Neuron</source>
        <year>2007</year>
        <volume>55</volume>
        <issue>5</issue>
        <fpage>809</fpage>
        <lpage>823</lpage>
        <?supplied-pmid 17785187?>
        <pub-id pub-id-type="pmid">17785187</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Macdonald</surname>
            <given-names>DD</given-names>
          </name>
          <name>
            <surname>Urquidi-Macdonald</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Kramers-kronig transformation of constant phase impedances</article-title>
        <source>Journal of The Electrochemical Society</source>
        <year>1990</year>
        <volume>137</volume>
        <issue>2</issue>
        <fpage>515</fpage>
        <lpage>517</lpage>
      </element-citation>
    </ref>
    <ref id="CR33">
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Malmivuo</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Plonsey</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>Bioelectromagnetism: principles and applications of bioelectric and biomagnetic fields</source>
        <year>1995</year>
        <publisher-loc>USA</publisher-loc>
        <publisher-name>Oxford University Press</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR34">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marin</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Guerin</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Baillet</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Garnero</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Meunier</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Influence of skull anisotropy for the forward and inverse problem in eeg: simulation studies using fem on realistic head models</article-title>
        <source>Human Brain Mapping</source>
        <year>1998</year>
        <volume>6</volume>
        <issue>4</issue>
        <fpage>250</fpage>
        <lpage>269</lpage>
        <?supplied-pmid 9704264?>
        <pub-id pub-id-type="pmid">9704264</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <mixed-citation publication-type="other">Miceli, S, Ness, T.V., Einevoll, G.T., &amp; Schubert, D. (2017). Impedance spectrum in cortical tissue: implications for propagation of lfp signals on the microscopic level. <italic>eNeuro, 4</italic>(1).</mixed-citation>
    </ref>
    <ref id="CR36">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moulin</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Glière</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Barbier</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Joucla</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Yvert</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Mailley</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Guillemaud</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>A new 3-d finite-element model based on thin-film approximation for microelectrode array recording of extracellular action potential</article-title>
        <source>IEEE Transactions on Biomedical Engineering</source>
        <year>2008</year>
        <volume>55</volume>
        <issue>2</issue>
        <fpage>683</fpage>
        <lpage>692</lpage>
        <?supplied-pmid 18270005?>
        <pub-id pub-id-type="pmid">18270005</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <mixed-citation publication-type="other">Naess, S, Chintaluri, C, Ness, TB, Dale, AM, Einevoll, GT, &amp; Wojcik, DK. (2017). Four-sphere head model for eeg signals revisited. bioRxiv p 124875.</mixed-citation>
    </ref>
    <ref id="CR38">
      <mixed-citation publication-type="other">Nelson, MJ, &amp; Pouget, P. (2010). Do electrode properties create a problem in interpreting local field potential recordings?</mixed-citation>
    </ref>
    <ref id="CR39">
      <mixed-citation publication-type="other">Neuman, M.R. (1998). Biopotential amplifiers. <italic>Medical Instrumentation: Application and Design</italic>, 292–296.</mixed-citation>
    </ref>
    <ref id="CR40">
      <mixed-citation publication-type="other">Neymotin, SA, Daniels, DS, Caldwell, B, McDougal, RA, Carnevale, NT, Jas, M, Moore, CI, Hines, ML, Hämäläinen, M, &amp; Jones, SR. (2019). Human neocortical neurosolver (hnn): a new software tool for interpreting the cellular and network origin of human meg/eeg data. bioRxiv p 740597.</mixed-citation>
    </ref>
    <ref id="CR41">
      <mixed-citation publication-type="other">Nunez, PL, &amp; Srinivasan, R. (2006). <italic>Electric fields of the brain: the neurophysics of EEG</italic>. Oxford University Press.</mixed-citation>
    </ref>
    <ref id="CR42">
      <mixed-citation publication-type="other">Nüßing, A, Piastra, MC, Schrader, S, Miinalainen, T, Brinck, H, Wolters, CH, &amp; Engwer, C. (2019). duneuro-a software toolbox for forward modeling in neuroscience. arXiv:<ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/190102874">https://arxiv.org/abs/190102874</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR43">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ollikainen</surname>
            <given-names>JO</given-names>
          </name>
          <name>
            <surname>Vauhkonen</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Karjalainen</surname>
            <given-names>PA</given-names>
          </name>
          <name>
            <surname>Kaipio</surname>
            <given-names>JP</given-names>
          </name>
        </person-group>
        <article-title>Effects of electrode properties on eeg measurements and a related inverse problem</article-title>
        <source>Medical Engineering &amp; Physics</source>
        <year>2000</year>
        <volume>22</volume>
        <issue>8</issue>
        <fpage>535</fpage>
        <lpage>545</lpage>
        <pub-id pub-id-type="pmid">11182578</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oostenveld</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Fries</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Maris</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Schoffelen</surname>
            <given-names>JM</given-names>
          </name>
        </person-group>
        <article-title>Fieldtrip: open source software for advanced analysis of meg, eeg, and invasive electrophysiological data</article-title>
        <source>Computational Intelligence and Neuroscience</source>
        <year>2011</year>
        <volume>2011</volume>
        <fpage>1</fpage>
        <pub-id pub-id-type="pmid">21837235</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Opitz</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Windhoff</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Heidemann</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Turner</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Thielscher</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>How the brain tissue shapes the electric field induced by transcranial magnetic stimulation</article-title>
        <source>NeuroImage</source>
        <year>2011</year>
        <volume>58</volume>
        <issue>3</issue>
        <fpage>849</fpage>
        <lpage>859</lpage>
        <?supplied-pmid 21749927?>
        <pub-id pub-id-type="pmid">21749927</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Piastra</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Nüßing</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Vorwerk</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bornfleth</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Oostenveld</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Engwer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Wolters</surname>
            <given-names>CH</given-names>
          </name>
        </person-group>
        <article-title>The discontinuous galerkin finite element method for solving the meg and the combined meg/eeg forward problem</article-title>
        <source>Frontiers in Neuroscience</source>
        <year>2018</year>
        <volume>12</volume>
        <fpage>30</fpage>
        <?supplied-pmid 29456487?>
        <pub-id pub-id-type="pmid">29456487</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Plonsey</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Heppner</surname>
            <given-names>DB</given-names>
          </name>
        </person-group>
        <article-title>Considerations of quasi-stationarity in electrophysiological systems</article-title>
        <source>Bulletin of Mathematical Biology</source>
        <year>1967</year>
        <volume>29</volume>
        <issue>4</issue>
        <fpage>657</fpage>
        <lpage>664</lpage>
      </element-citation>
    </ref>
    <ref id="CR48">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pursiainen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lew</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Wolters</surname>
            <given-names>CH</given-names>
          </name>
        </person-group>
        <article-title>Forward and inverse effects of the complete electrode model in neonatal eeg</article-title>
        <source>Journal of Neurophysiology</source>
        <year>2017</year>
        <volume>117</volume>
        <issue>3</issue>
        <fpage>876</fpage>
        <lpage>884</lpage>
        <?supplied-pmid 27852731?>
        <pub-id pub-id-type="pmid">27852731</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Richardot</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>McAdams</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Harmonic analysis of low-frequency bioelectrode behavior</article-title>
        <source>IEEE Transactions on Medical Imaging</source>
        <year>2002</year>
        <volume>21</volume>
        <issue>6</issue>
        <fpage>604</fpage>
        <lpage>612</lpage>
        <?supplied-pmid 12166856?>
        <pub-id pub-id-type="pmid">12166856</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Robinson</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>The electrical properties of metal microelectrodes</article-title>
        <source>Proceedings of the IEEE</source>
        <year>1968</year>
        <volume>56</volume>
        <issue>6</issue>
        <fpage>1065</fpage>
        <lpage>1071</lpage>
      </element-citation>
    </ref>
    <ref id="CR51">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rush</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Driscoll</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Eeg electrode sensitivity-an application of reciprocity</article-title>
        <source>IEEE Transactions on Biomedical Engineering</source>
        <year>1969</year>
        <volume>1</volume>
        <fpage>15</fpage>
        <lpage>22</lpage>
      </element-citation>
    </ref>
    <ref id="CR52">
      <mixed-citation publication-type="other">Thielscher, A, Antunes, A, &amp; Saturnino, GB. (2015). Field modeling for transcranial magnetic stimulation: a useful tool to understand the physiological effects of tms?. In <italic>2015 37th Annual international conference of the IEEE engineering in medicine and biology society (EMBC)</italic> (pp. 222–225): IEEE.</mixed-citation>
    </ref>
    <ref id="CR53">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tracey</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Computationally efficient bioelectric field modeling and effects of frequency-dependent tissue capacitance</article-title>
        <source>Journal of Neural Engineering</source>
        <year>2011</year>
        <volume>8</volume>
        <issue>3</issue>
        <fpage>036,017</fpage>
      </element-citation>
    </ref>
    <ref id="CR54">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Van Gemert</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>A note on the cole—cole dielectric permittivity equation in connnection with causality</article-title>
        <source>Chemical Physics Letters</source>
        <year>1972</year>
        <volume>14</volume>
        <issue>5</issue>
        <fpage>606</fpage>
        <lpage>608</lpage>
      </element-citation>
    </ref>
    <ref id="CR55">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Van Meirhaeghe</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Dutoit</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Cardon</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Gomes</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>On the application of the kramers-kronig relations to problems concerning the frequency dependence of electrode impedance</article-title>
        <source>Electrochimica Acta</source>
        <year>1976</year>
        <volume>21</volume>
        <issue>1</issue>
        <fpage>39</fpage>
        <lpage>43</lpage>
      </element-citation>
    </ref>
    <ref id="CR56">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vorwerk</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Oostenveld</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Piastra</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Magyari</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Wolters</surname>
            <given-names>CH</given-names>
          </name>
        </person-group>
        <article-title>The fieldtrip-simbio pipeline for eeg forward solutions</article-title>
        <source>Biomedical Engineering Online</source>
        <year>2018</year>
        <volume>17</volume>
        <issue>1</issue>
        <fpage>37</fpage>
        <?supplied-pmid 29580236?>
        <pub-id pub-id-type="pmid">29580236</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wagner</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Eden</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Rushmore</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Russo</surname>
            <given-names>CJ</given-names>
          </name>
          <name>
            <surname>Dipietro</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Fregni</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Simon</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rotman</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Pitskel</surname>
            <given-names>NB</given-names>
          </name>
          <name>
            <surname>Ramos-Estebanez</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Impact of brain tissue filtering on neurostimulation fields: a modeling study</article-title>
        <source>NeuroImage</source>
        <year>2014</year>
        <volume>85</volume>
        <fpage>1048</fpage>
        <lpage>1057</lpage>
        <?supplied-pmid 23850466?>
        <pub-id pub-id-type="pmid">23850466</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Windhoff</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Opitz</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Thielscher</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Electric field calculations in brain stimulation based on finite elements: an optimized processing pipeline for the generation and usage of accurate individual head models</article-title>
        <source>Human Brain Mapping</source>
        <year>2013</year>
        <volume>34</volume>
        <issue>4</issue>
        <fpage>923</fpage>
        <lpage>935</lpage>
        <?supplied-pmid 22109746?>
        <pub-id pub-id-type="pmid">22109746</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
