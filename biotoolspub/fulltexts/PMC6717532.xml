<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6717532</article-id>
    <article-id pub-id-type="pmid">31406384</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-019-0511-y</article-id>
    <article-id pub-id-type="manuscript">nihpa1534332</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BindSpace decodes transcription factor binding signals by large-scale sequence embedding</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Yuan</surname>
          <given-names>Han</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kshirsagar</surname>
          <given-names>Meghana</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zamparo</surname>
          <given-names>Lee</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lu</surname>
          <given-names>Yuheng</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Leslie</surname>
          <given-names>Christina S.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref rid="CR1" ref-type="corresp">*</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Computational and Systems Biology Program, Memorial Sloan Kettering Cancer Center, New York, NY 10065</aff>
    <aff id="A2"><label>2</label>Tri-Institutional Training Program in Computational Biology and Medicine, New York, NY 10065</aff>
    <author-notes>
      <fn fn-type="con" id="FN1">
        <p id="P1">Author Contributions</p>
        <p id="P2">H.Y. developed and implemented the model, performed all computational experiments, and co-wrote the manuscript. M.K. helped to perform quality control, initial benchmarking, visualization, and formulation of evaluations. L.Z. advised on quality control and experimented with alternative embedding ideas. Y.L. helped with visualization and advised on analyses. C.S.L. supervised the research, contributed to the model design, and co-wrote the manuscript. All authors discussed the results and contributed to the final manuscript.</p>
      </fn>
      <corresp id="CR1"><label>*</label> Correspondence: <email>cleslie@cbio.mskcc.org</email></corresp>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>13</day>
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>8</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>9</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>2</month>
      <year>2020</year>
    </pub-date>
    <volume>16</volume>
    <issue>9</issue>
    <fpage>858</fpage>
    <lpage>861</lpage>
    <!--elocation-id from pubmed: 10.1038/s41592-019-0511-y-->
    <permissions>
      <license>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<uri xlink:type="simple" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</uri></license-p>
      </license>
    </permissions>
    <abstract id="ABS1">
      <p id="P3">Decoding transcription factor (TF) binding signals in genomic DNA is a fundamental problem. Here we present a prediction model called BindSpace that learns to embed DNA sequences and TF class/family labels into the same space. By training on binding data for hundreds of TFs and embedding over 1M DNA sequences, BindSpace achieves state-of-the-art multiclass binding prediction performance, <italic>in vitro</italic> and <italic>in vivo</italic>, and can distinguish signals of closely related TFs.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P4">Direct measurement of genome-wide transcription factor (TF) occupancy for all expressed factors in a cell type of interest is generally infeasible. Therefore, computational prediction of TF binding to cognate sites at relevant loci – e.g. regions of accessible chromatin or active histone marks – is critically important. Large-scale <italic>in vitro</italic> TF binding experiments<sup><xref rid="R1" ref-type="bibr">1</xref>,<xref rid="R2" ref-type="bibr">2</xref>,<xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R5" ref-type="bibr">5</xref></sup> provide copious data for training binding models. However, each experiment is typically summarized as a position-specific weight matrix (PWM), yielding near-identical PWMs for closely related TFs. Previous supervised methods can accurately discriminate between bound and unbound sequences of individual TFs<sup><xref rid="R6" ref-type="bibr">6</xref>–<xref rid="R9" ref-type="bibr">9</xref></sup> but do not address the multiclass problem of distinguishing between TFs with similar binding signals.</p>
  <p id="P5">Here we present BindSpace, a novel multiclass method to jointly learn binding models for hundreds of TFs assayed by HT-SELEX by embedding their bound/unbound DNA sequences and TF labels into a common high-dimensional space. We adapted an embedding framework called StarSpace<sup><xref rid="R10" ref-type="bibr">10</xref></sup> from natural language processing. StarSpace learns to embed words into a semantic space, inducing an embedding of documents, where words with similar meanings embed close to each other (<xref rid="S1" ref-type="sec">Methods</xref><bold>)</bold>. For multiclass problems, class labels (e.g. ‘sports’, ‘politics’) are embedded in the same space, and StarSpace optimizes both word and label embeddings by training on labeled documents, pushing documents towards their true labels and away from incorrect labels. In BindSpace, <italic>k</italic>-mers are analogous to words and DNA sequences to documents, while TFs and TF families serve as class labels (<xref rid="F1" ref-type="fig">Fig. 1a</xref>). BindSpace learns <italic>k</italic>-mer and label embeddings so that probes embed close to the labels of TFs that bind them and away from other labels (&gt;<xref rid="F1" ref-type="fig">Fig. 1b</xref>, <xref rid="S1" ref-type="sec">Methods</xref>). For <italic>in vitro</italic> or <italic>in vivo</italic> TF binding prediction, a test DNA sequence is embedded in BindSpace and assigned the closest TF label. In computational biology, semantic embedding of sequences was previously used for remote protein homology detection<sup><xref rid="R11" ref-type="bibr">11</xref></sup> and recently proposed for TF binding<sup><xref rid="R12" ref-type="bibr">12</xref></sup>.</p>
  <p id="P6">To train BindSpace, we combined HT-SELEX binding experiments for 461 mouse and human TFs from previous large-scale studies<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R8" ref-type="bibr">8</xref></sup>. We applied rigorous quality control (<xref rid="S1" ref-type="sec">Methods</xref>) to obtain 270 experiments for 243 transcription factors for our training set, enabling improved performance (<xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>). The top 2000 enriched probes from each experiment were used as positive examples, yielding over 500K positive training sequences. We randomly sampled universal negatives from HT-SELEX probe libraries and non-accessible genomic regions to obtain ~500K negative training sequences (<xref rid="S1" ref-type="sec">Methods</xref>). Each sequence is represented as a bag of 8-mers containing up to two consecutive wild cards, and each bag is associated with both a TF label (e.g. HOXA2) and TF family label (e.g. Homeodomain) or with a universal negative label. We used two thirds of the HT-SELEX data for training and one third for testing and performed 5-fold cross validation on the training data for hyperparameter tuning (<xref rid="S1" ref-type="sec">Methods</xref>).</p>
  <p id="P7">BindSpace learns a model where TFs with similar binding specificity are close to each other and their training examples in the embedding space, while more distinct TFs are farther away. Visualizing the embedding space in 2D using t-SNE (<xref rid="S1" ref-type="sec">Methods</xref>) shows the clustering of probes with their TF labels and family labels (<xref rid="F2" ref-type="fig">Fig. 2a</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1a</xref>). The model also learns family substructure such as in the bZIP family (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1b</xref>), where human and mouse orthologs embed close to each other (Jdp2 and JDP2, Hlf and HLF, Dbp and DBP), as do C/EBP TFs. To visualize the binding information encoded by TF labels, we embedded 10-mers in BindSpace and aligned the 10-mers nearest to each label (<xref rid="S1" ref-type="sec">Methods</xref>), often yielding informative sequence logos (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 2</xref>). We also identified the 200 most closely embedded 8-mers for all TF labels (<xref rid="SD3" ref-type="supplementary-material">Supplementary Table 1</xref>).</p>
  <p id="P8">We first evaluated our model on held-out HT-SELEX test data and compared against FIMO PWM scoring using published HT-SELEX PWMs curated using a semi-automated algorithm<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R13" ref-type="bibr">13</xref></sup>; no probe data was held out for estimating these PWMs, presumably giving the PWM-based method an advantage. Nonetheless, BindSpace significantly outperforms PWM-based prediction as evaluated by F1 (<italic>P</italic> &lt; 2.94e-37, one-sided Wilcoxon signed rank test, <xref rid="F2" ref-type="fig">Fig. 2b</xref>). BindSpace also outperforms one-versus-all LASSO classifiers, trained using the same 8-mer features, and DeepBind, a deep learning method trained on HT-SELEX data<sup><xref rid="R14" ref-type="bibr">14</xref></sup> (<italic>P</italic> &lt; 4.80e-27, <italic>P</italic> &lt; 1.26e-34, respectively, <xref rid="F2" ref-type="fig">Fig. 2b</xref>). To optimize performance for binary one-vs-all evaluation metrics like auPR and auROC that rely on accurate rankings, we developed BindSpace+, where we train regularized logistic classifiers on top of the BindSpace representation of probe data (<xref rid="S1" ref-type="sec">Methods</xref>). BindSpace+ outperforms all competing methods on held-out HT-SELEX data for one-vs-all prediction as evaluated by auPR (<xref rid="F2" ref-type="fig">Fig. 2b</xref>).</p>
  <p id="P9">Additional comparisons provide insight into BindSpace’s performance advantage (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3</xref>): binary trained LASSO models outperform PWMs, suggesting an advantage from the <italic>k</italic>-mer representation, consistent with previous studies<sup><xref rid="R7" ref-type="bibr">7</xref></sup>; one-versus-all LASSO classifiers outperform binary LASSO classifiers, showing an advantage from multiclass training; and BindSpace outperforms one-versus-all LASSO, implying that multiclass training by embedding is superior to standard one-versus-all. Comparing confusion matrices within each TF family across the prediction methods highlights the multiclass performance advantage of BindSpace, although some paralogs, such as the C/EBP subfamily, remain difficult to distinguish (<xref rid="F2" ref-type="fig">Fig. 2c</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref><bold>)</bold>.</p>
  <p id="P10">We next evaluated BindSpace on independent PBM data sets to confirm that we could distinguish TFs within the same family across <italic>in vitro</italic> platforms. We first downloaded raw PBM intensity data for the BAR15A data set<sup><xref rid="R15" ref-type="bibr">15</xref></sup>, identified 14 homeodomains that overlap with BindSpace, and predicted the binding affinity of these TFs to the top intensity probes from these PBM experiments using BindSpace (<xref rid="S1" ref-type="sec">Methods</xref>). For 8 of the 14 TFs, the PBM intensity correlated best with the BindSpace model for the same TF (compared to 7/14 TFs for LASSO and PWMs, 6/14 TFs for DeepBind), even for paralogs such as POU3F4, POU4F3 and POU6F2 where DeepBind has difficulty (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 5</xref>). Additional analyses on homeodomains in BAR15A, ETS factors from EMBO<sup><xref rid="R16" ref-type="bibr">16</xref></sup>, POU and PRRX paralogs from Cell08<sup><xref rid="R17" ref-type="bibr">17</xref></sup>, and recent gcPBM data from Shen <italic>et al.</italic><sup><xref rid="R9" ref-type="bibr">9</xref></sup> for Ets1 and Elk1 confirm BindSpace’s advantage for distinguishing between PBM probe data for TFs in the same family compared to other methods (<xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
  <p id="P11">BindSpace also accurately identified TF binding sites and distinguished between sites of related TFs <italic>in vivo</italic>. For the standard task of distinguishing TF binding sites from flanking sequences or dinucleotide shuffled positive sequences, we used ENCODE ChIP-seq for 39 TFs represented in our model. BindSpace significantly outperformed PWM scoring, LASSO classifiers, and DeepBind for distinguishing the top 5,000 peaks from flanking regions or dinucleotide shuffled sequences by F1 score (<xref rid="S1" ref-type="sec">Methods</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 6</xref>). BindSpace+ had good performance but came only in second place in ChIP-seq versus background sequence tasks evaluated with auROC: PWM was the winner for peaks-vs-flanks, DeepBind for peaks-vs-shuffled-sequences (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 6</xref>). For the more practical task of predicting TF binding versus non-binding at chromatin accessible regions in a given cell type, we processed publicly available ATAC-seq data and used ENCODE ChIP-seq data for 17 TFs in K562 and 11 TFs in GM12878 that had sufficient overlap with ATAC-seq peaks (<xref rid="S1" ref-type="sec">Methods</xref>). BindSpace significantly outperformed all competing methods in discriminating bound vs unbound ATAC-seq peaks on K562 by F1 score, and significantly outperformed LASSO on GM12878, while its performance advantage over PWM and DeepBind was not significant on this smaller number of TFs (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 6</xref>). There was no significant difference between methods in ranking TF-occupied ATAC-seq peaks from unoccupied peaks as evaluated by auPR (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 7</xref>).</p>
  <p id="P12">BindSpace is most noteworthy for its ability to distinguish between the binding of TFs in the same family <italic>in vivo</italic>. We found 115 ENCODE ChIP-seq experiments for TFs represented in BindSpace, including 20 pairs of high quality experiments for paralogous TFs assayed in the same cell type (<xref rid="S1" ref-type="sec">Methods</xref>). For each pair of paralogs TF1 and TF2, we took only peaks unique to TF1 or TF2 and required each method to predict whether the peak was bound by TF1, TF2, or neither. BindSpace outperformed all other methods by F1 score, and BindSpace+ outperformed PWM and DeepBind while tying LASSO when evaluated by auROC (<xref rid="F3" ref-type="fig">Fig. 3a</xref>). To assess multilabel prediction, we next combined all peaks for CEBPB and CEBPG HepG2 ChIP-seq data and annotated each peak as bound only by CEBPB, bound only by CEBPG, or bound by both. For each method, we compared CEBPB and CEBPG prediction scores across groups and indicated predicted labels by Venn diagram (<xref rid="F3" ref-type="fig">Fig. 3b</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8</xref>). Both BindSpace and PWMs could distinguish between the binding of CEBPB and CEBPG on peaks specific to one TF, but BindSpace has much less bias on commonly bound peaks. LASSO and DeepBind had weaker performance at this task, with DeepBind systematically overpredicting CEBPG binding sites. For the paralogs NR2F6 and NR2F1 in HepG2, BindSpace was the only method that could distinguish between NR2F6 and NR2F1 specific peaks (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 9</xref>).</p>
  <p id="P13">We also performed multiclass classification on the top 10,000 ChIP-seq peaks across ENCODE experiments to test if we could distinguish binding of the ChIP-ed TF from TFs in the same family. Examining BindSpace predictions for bZIP ChIP-seq in HepG2, BindSpace successfully ranked the ChIP-ed TF above other family members in 5 out of 7 cases (<xref rid="F3" ref-type="fig">Fig. 3c</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 10</xref>), compared to 3 out of 7 cases for PWM scoring and LASSO and 2 out of 7 cases for DeepBind. We also restricted to peaks uniquely bound by a single ChIP-ed bZIP TF to compare BindSpace (by F1) and BindSpace+ (by one-vs-all auPR) against other methods for a straightforward multiclass prediction assessment. These results were inconclusive, giving a statistical tie with competing methods due to the small number of TFs, but analysis of confusion matrices again confirmed that BindSpace and BindSpace+ had better calibrated scores (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 11</xref>). Therefore, while other methods can perform well in binary prediction tasks, their predictions are not well calibrated across TFs, leading to confusion between TFs in the same family. While we focus here on multiclass evaluation, note that BindSpace can detect multiple TF binding sites within an ATAC-seq peak for multi-label prediction (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 12</xref>, <xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
  <p id="P14">BindSpace is a powerful and scalable machine learning approach to leverage massive <italic>in vitro</italic> binding data sets to decode TF binding signals in DNA sequences. By solving the underlying “many-class” classification problem through a joint embedding space for sequences and TF class labels, BindSpace is often able to distinguish between the binding preferences of closely related TFs, both <italic>in vitro</italic> and <italic>in vivo</italic>. A systematic evaluation across diverse binding prediction tasks (<xref rid="SD4" ref-type="supplementary-material">Supplementary Table 2</xref>) supports BindSpace’s state-of-the-art performance. Extensions to improve accuracy and completeness include incorporating longer <italic>k</italic>-mers into the vocabulary and other <italic>in vitro</italic> binding platforms in training; preliminary experiments point to the utility of these ideas (<xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>). Finally, we expect that the BindSpace embedding will provide a useful feature representation on which to build more sophisticated models, such as deep learning models, for regulatory genomics.</p>
  <sec id="S1">
    <title>Online Methods</title>
    <sec id="S2">
      <title>HT-SELEX quality control</title>
      <p id="P15">We used public HT-SELEX data sets to train BindSpace and one-vs-all LASSO TF binding specificity models. We combined the HT-SELEX data sequenced in 2013 (ENA accession: ERP001824) and the 2017 re-sequenced libraries (ENA accession: ERP016411), which together include 547 experiments for 461 human or mouse TFs<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R8" ref-type="bibr">8</xref></sup>.</p>
      <p id="P16">To perform quality control, we computed an enrichment score for every 8mer in probes selected at each cycle of an experiment relative to the initial library (cycle 0), as in a previous study<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. We first estimated the frequency of every 8-mer in cycle 0 using a fifth-order Markov model<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. Then, for cycle i, we computed the enrichment score for each 8-mer as the i-th root of (frequency in cycle i)/(estimated frequency in cycle 0).</p>
      <p id="P17">For each experiment, we then performed quality control filtering based on the following procedure:</p>
      <list list-type="order" id="L2">
        <list-item>
          <p id="P18">For experiments with 14bp or 20bp probes, cycle 4 was used to derive enriched probes.</p>
        </list-item>
        <list-item>
          <p id="P19">For experiments with 30bp and 40bp probes, one of cycle 4, 5 or 6 was used to derive enriched probes, because more cycles of selection are required to enrich for longer probes.</p>
        </list-item>
        <list-item>
          <p id="P20">Experiments were excluded if the Spearman correlation of 8-mer enrichment scores between cycle 3 and cycle 4 was below 0.8. (The correlation distribution between cycle 3 and cycle 4 for all experiments and examples of poorer correlation are shown in <xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
        </list-item>
        <list-item>
          <p id="P21">Experiments were excluded if the selected cycle did not have good probe enrichment or diversity (fewer than 500 probes with frequency &gt; 10).</p>
        </list-item>
        <list-item>
          <p id="P22">For the remaining experiments, we removed low complexity probes with a DUST score &lt; 2, where DUST is the BLAST low-complexity masking algorithm<sup><xref rid="R19" ref-type="bibr">19</xref></sup>. This is based on our observation that some HT-SELEX experiments have non-specific enrichment for low complexity sequences.</p>
        </list-item>
        <list-item>
          <p id="P23">For remaining experiments with 14bp or 20bp probes, we selected the top 2000 enriched probes (frequency &gt; 10) based on enrichment score. We chose 2000 enriched probes per TF for training based on the observation that further increasing the size of the training data does not improve overall multiclass classification performance while reducing performance for TFs with fewer enriched probes.</p>
        </list-item>
        <list-item>
          <p id="P24">For remaining experiments with 30bp or 40bp probes, we counted the frequency of unique 20bp sequences, and selected the top 2000 enriched 20bp probes based on enrichment score.</p>
        </list-item>
        <list-item>
          <p id="P25">Finally, experiments where the most frequent 8-mer in the top 2000 probes occurred less than 100 times were removed. This final filter is applied to remove any experiments where the top probes do not enrich for any consensus binding sites (<xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
        </list-item>
      </list>
      <p id="P26">After quality control, we ended up with 270 high quality experiments covering 243 TFs. 143 of these experiments overlapped with those selected by quality control in a previous study<sup><xref rid="R8" ref-type="bibr">8</xref></sup>. To show that our filtering steps improved overall data quality, we measured consistency between replicate experiments or experiments of orthologous TFs. Consistency between experiment A and B was defined as the percentage overlap between the top 100 enriched 8-mers in the respective experiments. We found that after removing low quality experiments and probes, we significantly improved overall data quality (<italic>P</italic> &lt; 0.009, rank sum test, <xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
    </sec>
    <sec id="S3">
      <title>Data preprocessing</title>
      <p id="P27">The top 2000 enriched probes from each of the 270 experiments that passed quality control were used as examples to train our model. All non-unique probes were removed, and each of the remaining (unique) probes was associated with a TF label and a TF family label. Because 20bp probes have very high diversity, we only had a very small number of non-unique probes (<xref rid="SD5" ref-type="supplementary-material">Supplementary Table 3</xref>). TF family information was obtained from <ext-link ext-link-type="uri" xlink:href="http://cisbp.ccbr.utoronto.ca/bulk.php">http://cisbp.ccbr.utoronto.ca</ext-link>. Overall we had a total of 505,194 TF-associated probes.</p>
      <p id="P28">We then randomly selected 252,597 sequences from probes that only present in initial cycles (random negative sequences), and 252,597 20bp sequences from inaccessible region of the genome in K562 cell lines (genomic negative sequences). We included genomic negatives during training in order to learn to distinguish between TF binding sites and genomic background. After filtering out duplicated sequences, we obtained a total of 505,086 unique negative probes, each of which was associated with a universal negative label.</p>
    </sec>
    <sec id="S4">
      <title>Training BindSpace</title>
      <p id="P29">Each HT-SELEX probe input sequence <italic>s</italic><sub><italic>i</italic></sub> is represented by a bag of 8-mers with up to 2 consecutive wildcards (where the wildcard symbol ‘N’ matches any nucleotide). A particular 8-mer is considered a token of <italic>s</italic><sub><italic>i</italic></sub> if it occurs in either <italic>s</italic><sub><italic>i</italic></sub> or reverse complement of <italic>s</italic><sub><italic>i</italic></sub>. The total vocabulary of 8-mers with up to 2 consecutive wildcards has a size of 112,800. For a pair of reverse complement 8-mers, only one of the two is included in the vocabulary, similar to the representation used in the SeqGL algorithm<sup><xref rid="R7" ref-type="bibr">7</xref></sup>.</p>
      <p id="P30">BindSpace is an instantiation of StarSpace, a machine learning algorithm that can be used for a wide range of supervised learning problems. Training examples to StarSpace are structured as left hand side (LHS)-right hand side (RHS) pairs. In BindSpace, the LHS of the <italic>i</italic><sup>th</sup> input is a DNA probe represented by its constituent <italic>k</italic>-mers <inline-formula><mml:math display="inline" id="M1" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> , and the RHS consists of the labels associated with this probe <inline-formula><mml:math display="inline" id="M2" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> Most probes have two labels, a TF label and family label. For training examples that come from universal negatives or from TFs with unknown family, no family label is assigned.</p>
    </sec>
    <sec id="S5">
      <title>Overview of StarSpace algorithm</title>
      <p id="P31">We used the StarSpace default training mode (mode 0) to learn an embedding for a total of 113,074 entities – namely, 112,800 <italic>k</italic>-mers, 243 TF labels, 1 universal negative label, and 30 TF family labels – into a vector space <inline-formula><mml:math display="inline" id="M3" overflow="scroll"><mml:mrow><mml:msup><mml:mi>ℝ</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, where <italic>d</italic> is the dimension of the embedding space. In BindSpace, we use <italic>d</italic> = 300</p>
      <p id="P32">To explain the embedding of the <italic>i</italic><sup>th</sup> training example and the associated loss used in training, let us denote the embedded vectors of <italic>k</italic>-mers <inline-formula><mml:math display="inline" id="M4" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as <inline-formula><mml:math display="inline" id="M5" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and the embedded vectors of labels <inline-formula><mml:math display="inline" id="M6" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> as <inline-formula><mml:math display="inline" id="M7" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where all the vectors <italic>w</italic><sub><italic>i,j</italic></sub>,<italic>j</italic> = 1,…, <italic>m</italic><sub><italic>i</italic></sub> and <italic>l</italic><sub><italic>i,k</italic></sub>,<italic>k</italic> = 1,…,<italic>n</italic><sub><italic>i</italic></sub>, are in<inline-formula><mml:math display="inline" id="M8" overflow="scroll"><mml:mrow><mml:msup><mml:mi>ℝ</mml:mi><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>.</p>
      <p id="P33">The embedding of the LHS of the <italic>i</italic><sup>th</sup> example is induced by the embedding of all constituent <italic>k</italic>-mers as follows (this can also be considered to be the embedding for the corresponding training probe):
<disp-formula id="FD1"><mml:math display="block" id="M9" overflow="scroll"><mml:mrow><mml:mi>l</mml:mi><mml:mi>h</mml:mi><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi></mml:msubsup></mml:mrow></mml:mfrac><mml:mstyle><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p>
      <p id="P34">Here <italic>p</italic> = 0.5 by default.</p>
      <p id="P35">Similarly, the embedding of the RHS of the example is induced by the embedding of all its associated labels:
<disp-formula id="FD2"><mml:math display="block" id="M10" overflow="scroll"><mml:mrow><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi></mml:msubsup></mml:mrow></mml:mfrac><mml:mstyle><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p>
      <p id="P36">To compute the loss associated with this example, we randomly sample <italic>K</italic> examples with labels different from example <italic>i</italic> and compute the RHS associated with each:
<disp-formula id="FD3"><mml:math display="block" id="M11" overflow="scroll"><mml:mrow><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msubsup><mml:mi>n</mml:mi><mml:mi>k</mml:mi><mml:mi>p</mml:mi></mml:msubsup></mml:mrow></mml:mfrac><mml:mstyle><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p>
      <p id="P37">Here <italic>l</italic><sub><italic>kj</italic></sub> is the embedding of the <italic>j</italic><sup>th</sup> label of negative sample <italic>k</italic>.</p>
      <p id="P38">To compute the loss, StarSpace allows for a choice of hinge or softmax and a choice of dot and cosine similarity. We found that hinge loss and dot similarity work best for our data. Thus, the loss function for a given positive example with one random negative would be:
<disp-formula id="FD4"><mml:math display="block" id="M12" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mi>r</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi> </mml:mi><mml:mi mathvariant="normal">margin</mml:mi><mml:mi> </mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>h</mml:mi><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mi>h</mml:mi><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p id="P39">We used a default value of 0.05 as the margin. Therefore, a loss is incurred unless the similarity of the LHS embedding for the <italic>i</italic>th example <italic>lhs</italic><sub><italic>i</italic></sub>, to the embedding of its RHS <italic>rhsP</italic><sub><italic>i</italic></sub>, exceeds the similarity of <italic>lhs</italic><sub><italic>i</italic></sub> to the embedding of the ‘wrong’ RHS by a margin. The total loss associated with example <italic>i</italic> using <italic>K</italic> negative samples is:
<disp-formula id="FD5"><mml:math display="block" id="M13" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mi>r</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>K</mml:mi></mml:mfrac><mml:mstyle><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi> </mml:mi><mml:mi mathvariant="normal">margin</mml:mi><mml:mi> </mml:mi><mml:mo>−</mml:mo><mml:mi>l</mml:mi><mml:mi>h</mml:mi><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mi>h</mml:mi><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mi>r</mml:mi><mml:mi>h</mml:mi><mml:mi>s</mml:mi><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p id="P40">Subsequently, <italic>k</italic>-mer embeddings <inline-formula><mml:math display="inline" id="M14" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, positive label embeddings <inline-formula><mml:math display="inline" id="M15" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, and negative label embeddings <inline-formula><mml:math display="inline" id="M16" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are all updated based on the gradient of this loss using Adagrad algorithm.</p>
      <p id="P41">We split the whole data set into 2/3 for training and 1/3 for testing with stratified sampling, i.e., each TF class was split into 2/3 for training and 1/3 for testing. We performed 5-fold cross-validation on training data for hyperparameter tuning, and cross-validation performance was measured by average F1 score for all TFs. We then evaluated the performance on test data and compared against other methods. We found that the cross-validation performance no longer improved after 50 epochs, and therefore we stop training at that point.</p>
      <p id="P42">Finally, we learned a comprehensive BindSpace model with the same hyperparameter settings using all HT-SELEX data. The visualizations and <italic>in vitro</italic> and <italic>in vivo</italic> validation were performed using this model.</p>
    </sec>
    <sec id="S6">
      <title>Hyperparameter tuning</title>
      <p id="P43">The hyperparameters we considered in the StarSpace algorithm included: loss, similarity, learning rate, embedding dimension, maximum number of negatives in a batch update, and dropout rate. Preliminary analysis on a small number of examples (15 classes) showed that hinge loss and dot similarity gave the best performance on DNA sequence data.</p>
      <p id="P44">We sampled 20 sets of hyperparameters from: learning rate = (0.01, 0.05, 0.1, 0.2), dimension = (50, 100, 150, 200), maxNegSamples = (3, 5, 10, 15), and dropout rate = (0, 0.001, 0.01, 0.1). We compared the cross-validation performance of each of these 20 sets by F1 score for each TF class.</p>
      <p id="P45">Taking the sampled hyperparameter set with best performance (mean F1 score), we then varied each hyperparameter individually while keeping the rest constant. We measured the performance change with respect to the change in each hyperparameter, again by cross-validation performance on training data measured by F1 score for each TF. Based on this analysis, the final hyperparameters that gave the best cross-validation performance were: learning rate = 0.2, dimension = 300, maxNegSamples = 15, dropout rate = 0. We also found that the performance reaches convergence after 50 epochs.</p>
    </sec>
    <sec id="S7">
      <title>Making predictions with BindSpace</title>
      <sec id="S8">
        <title>Binary thresholding.</title>
        <p id="P46">BindSpace predicts similarity scores of a new test example to all class labels. Multiclass prediction can be made based on which label has the highest similarity to the test example. However, when we need to make multi-label predictions (allow a sequence to be positive for more than one TF), we need to determine a threshold for each label. Therefore, we computed the similarity of each label to all training examples not belonging to this class to generate an empirical null distribution of similarity score. For a new test example, if the similarity score significantly achieves <italic>P</italic> &lt; 0.05 relative to this null distribution, we consider the test example to be positive; otherwise, we consider it to be negative.</p>
      </sec>
      <sec id="S9">
        <title>In vivo evaluation.</title>
        <p id="P47">When evaluating on ChIP-seq or ATAC-seq data, instead of having 20bp probes, we have 150bp or 300bp genomic sequences, respectively. In order to predict on these large genomic regions, we bin into 20bp windows, embed each window into BindSpace, and determine similarity to TF class labels. Then the similarity score of a TF to a given peak is the maximum similarity score over all 20bp windows. However, when predictions on 20bp bins are considered, BindSpace and BindSpace+ retain the resolution to identify multiple binding sites within an ATAC-seq peak (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 12</xref>).</p>
      </sec>
    </sec>
    <sec id="S10">
      <title>Training BindSpace+</title>
      <p id="P48">Since BindSpace is trained as a multi-class classifier, with prediction based on proximity of embedded sequences to &gt;200 model vectors in a high dimensional latent space, it is not optimized for binary classification tasks as evaluated by auPR or auROC, which rely on accurate one-vs-all or positive-vs-negative <italic>rankings</italic> rather than class assignments. To adapt BindSpace to this binary prediction setting, we trained the BindSpace+ model as follows. We used the previous BindSpace representation of <italic>k</italic>-mers and induced representation of 20bp DNA sequences, but we did not use the model vectors for the labels. Instead, we embedded all training examples into BindSpace’s 300 dimensional latent space using the previously learned representation and then trained a one-versus-all logistic classifier with ridge regularization for each TF using the BindSpace representation. For prediction on held-out HT-SELEX probes, we trained BindSpace+ logistic classifiers in one-vs-the-rest fashion. For <italic>in vivo</italic> binary prediction tasks, we trained BindSpace+ models for each TF on positive probes vs randomly sampled negative probes.</p>
    </sec>
    <sec id="S11">
      <title>PWM-based predictions</title>
      <p id="P49">The PWM models we use are from ‘Jolma2013.meme’, downloaded from <ext-link ext-link-type="uri" xlink:href="http://meme-suite.org/db/motifs">http://meme-suite.org/db/motifs</ext-link>. They were generated by Jolma <italic>et al.</italic> using a semi-automatic algorithm from the same HT-SELEX data set<sup><xref rid="R5" ref-type="bibr">5</xref></sup>. We used FIMO with default settings to predict PWM hits<sup><xref rid="R13" ref-type="bibr">13</xref></sup>. For binary prediction problems, rather than using the default <italic>P</italic> &lt; 1e-4 threshold, we allowed the full range of <italic>P</italic> values in order to rank all examples. For multiclass prediction problems, if none of the PWMs satisfied <italic>P</italic> &lt; 1e-4, we predicted the sequence to be a universal negative; otherwise we predicted the TF label based on the most significant PWM.</p>
    </sec>
    <sec id="S12">
      <title>LASSO one-versus-all multiclass predictions</title>
      <p id="P50">We used the R package <italic>glmnet</italic> to train a LASSO logistic regression classifier for each TF in a one-versus-all setting in order to make multiclass predictions<sup><xref rid="R20" ref-type="bibr">20</xref></sup>. During training, for each TF, we considered the 2000 enriched probes as positives and sampled 20,000 sequences from the rest of the training data as negatives. We represented training sequences using 8-mers features with up to 2 consecutive wildcards. We performed feature selection by computing a binomial Z-score for every 8-mer feature based on its enrichment in positive versus negative training examples and chose the top scoring 10,000 8-mers. For testing, we predicted the class of a given test example by assigning it to the TF model that gave highest posterior probability, or assigning it to be a universal negative if all of the models predicted a posterior &lt; 0.5. We can also make multi-label prediction by allowing a given sequence to be positive for multiple TFs if the posterior &gt; 0.5 for multiple classifiers.</p>
    </sec>
    <sec id="S13">
      <title>Binary LASSO predictions</title>
      <p id="P51">We used the R package <italic>glmnet</italic> to train a LASSO logistic regression classifier for each TF in a binary setting. During training, for each TF, we considered the 2000 enriched probes as positives, and randomly sampled 10,000 sequences from cycle 0 of the same experiment as negatives. Training sequences were represented using 8-mer features with up to 2 consecutive wildcards. Feature selection was performed the same way as previously describe for LASSO one-versus-all.</p>
    </sec>
    <sec id="S14">
      <title>DeepBind predictions</title>
      <p id="P52">The DeepBind program and models were downloaded from <ext-link ext-link-type="uri" xlink:href="http://tools.genes.toronto.edu/deepbind/">http://tools.genes.toronto.edu/deepbind/</ext-link>. We only used the DeepBind models trained on HT-SELEX data. For making binary decisions, we set the threshold at 0.9 after logistic transform of raw DeepBind scores.</p>
    </sec>
    <sec id="S15">
      <title>Visualization</title>
      <p id="P53">We visualized the top 50 probes of each HT-SELEX experiment, TF labels, and TF family labels in a 2D space using an efficient Barnes-Hut implementation of t-SNE<sup><xref rid="R21" ref-type="bibr">21</xref>,<xref rid="R22" ref-type="bibr">22</xref></sup>. To do so, we first computed a similarity matrix of these points (13,500 probes and 274 labels) by dot product. Then we converted this similarity matrix to a dissimilarity matrix and used the R package <italic>Rtsne</italic> with default settings to project these points to 2D, where the dissimilarity is approximated by Euclidean distance<sup><xref rid="R23" ref-type="bibr">23</xref></sup>.</p>
    </sec>
    <sec id="S16">
      <title>Sequence logos for BindSpace TFs</title>
      <p id="P54">We embed all 10-mer sequences into BindSpace. For each TF, we sort all 10-mers by their similarity to the TF label in BindSpace (by dot similarity) and used top 200 10-mers (where for reverse complement sequence pairs, only one of the two sequences is included) to generate a PWM. The directions (orientations) of these 200 10-mers are then corrected by “mafft --adjustdirectionaccurately”, and a sequence logo is generated by the “seqlogo” program.</p>
    </sec>
    <sec id="S17">
      <title>BindSpace correlation with PBM data</title>
      <p id="P55">We downloaded the original PBM intensity data of ‘BAR15A’, ‘EMBO10’, and ‘Cell08’ from Uniprobe (<ext-link ext-link-type="uri" xlink:href="http://the_brain.bwh.harvard.edu/uniprobe/downloads.php">http://the_brain.bwh.harvard.edu/uniprobe/downloads.php</ext-link>).</p>
      <p id="P56">BAR15A contains PBM data for 41 TFs, 15 of which overlap with TFs in BindSpace (1 C2H2 zinc finger, 14 homeodomains). For each TF, we took the top 5000 PBM probes with highest intensity and predicted the binding affinity of 14 homeodomain TFs to these 36bp probes using each of BindSpace, PWM, LASSO and DeepBind. Finally we computed Spearman correlations between true probe intensities with BindSpace predicted intensities for the 14 TFs.</p>
      <p id="P57">For TFs in BAR15A POU family, TFs in BAR15A PAX family, TFs in EMBO10 ETS family, TFs in Cell08 POU family and Cell08 PRRX paralogous TFs, instead of considering only the top 5000 PBM probes with highest affinity, we plotted the Spearman correlation of predicted affinity versus true PBM intensity as a function of number of top probes and compared between all methods.</p>
    </sec>
    <sec id="S18">
      <title>BindSpace analysis of gcPBM data</title>
      <p id="P58">We downloaded gcPBM array for Ets1 and Elk1 from GEO (GSE97793). Negative control probes, ELK1 preferential and ETS1 preferential probes were as annotated by Shen <italic>et al</italic>.<sup><xref rid="R9" ref-type="bibr">9</xref></sup> We looked at all Elk1/Ets1 preferential probes and compared between BindSpace, PWM, LASSO and DeepBind for their ability to distinguish between Elk1/Ets1 preferential probes (<xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
      <p id="P59">We performed an additional multilabel analysis considering the true label of each probe to be one of: Elk1 preferential, Ets1 preferential or common (non-specific). Using each of BindSpace, PWM, LASSO or DeepBind methods, we predicted each probe to be ELK1 specific (ELK1 score &gt; ETS1 score and ELK1 score &gt; cutoff), ETS1 specific (ETS1 score &gt; ELK1 score and ETS1 score &gt; cutoff) or low affinity (ELK1 score &lt; cutoff and ETS1 score &lt; cutoff). See previous description for empirical thresholds for predicting low affinity probes for each method.</p>
    </sec>
    <sec id="S19">
      <title>ENCODE ChIP-seq</title>
      <p id="P60">Conservative and optimal IDR thresholded ‘narrowpeak’ files of ENCODE ChIP-seq data were downloaded from the ENCODE portal (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/">https://www.encodeproject.org/</ext-link>) for five major cell lines: GM12878, K562, A549, H1-hESC and HepG2, covering a total of 329 different TFs.</p>
    </sec>
    <sec id="S20">
      <title>ATAC-seq data processing</title>
      <p id="P61">K562 ATAC-seq raw reads were obtained from GSE76224<sup><xref rid="R24" ref-type="bibr">24</xref></sup>. We combined records SRR3822969 and SRR3822972 to create replicate 1. We combined the other two records to create replicate 2. GM12878 ATAC-seq raw reads were obtained from GSE47753<sup><xref rid="R25" ref-type="bibr">25</xref></sup>. We used only the samples generated from 50k cells. Because replicate 1 is much more deeply sequenced then rest of the replicates, we combined replicates 2, 3, 4 to obtain replicate 2.</p>
      <p id="P62">We followed the ENCODE ATAC-seq processing pipeline (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/atac-seq/">https://www.encodeproject.org/atac-seq/</ext-link>) for processing K562 and GM12878 ATAC-seq data. For each of the ATAC-seq samples, we trimmed the raw fastq files of adapters with Trimmomatic with default settings. We then aligned to the hg19 genome using Bowtie2 with default settings. After that we removed duplicate reads and adjusted for Tn5 shifts. Peak calling was performed for each replicate using macs2 with --nomodel --shift −37 --extsize 73. Finally, IDR was performed with the idr package and reproducible peaks were called with an IDR cutoff of 0.05. There were a total of 17,271 reproducible peaks in K562 and a total of 76,218 reproducible peaks in GM12878. For both K562 and GM12878, we only evaluated on the top 10,000 peaks with highest accessibility.</p>
    </sec>
    <sec id="S21">
      <title>ChIP-seq peaks versus flanks evaluation</title>
      <p id="P63">For this task, we used all available ENCODE TF ChIP-seq data in cell lines, which included a total of 329 different TFs, including 39 represented in BindSpace. For each TF covered by BindSpace, we selected a single experiment that gave the most reproducible peaks, selected the top 5000 peaks with highest IDR score, and took the 150bp region around each peak summit as positive examples. Negative examples (flanks) were taken 300 bp upstream of positive examples. Overlapping regions and sequences containing Ns are removed. For each TF data set of ChIP-seq peaks and flanks, we made binary predictions based on their similarity to the corresponding TF label in BindSpace and measured performance by F1 score. We then compared with predictions made by FIMO scoring using the ‘Jolma2013’ PWMs, LASSO and DeepBind.</p>
    </sec>
    <sec id="S22">
      <title>ATAC-seq binding versus non-binding evaluation</title>
      <p id="P64">All ATAC-seq peaks were trimmed to 300bp centered at the peak summit. All TF ChIP-seq peaks were resized to 150bp centered at the peak summit. If an ATAC-seq peak overlaps with a resized TF ChIP-seq peak, we consider that ATAC-seq peak to be bound by the corresponding TF; otherwise, it is unbound by the TF. For this evaluation, we removed any TFs that were bound to &lt; 10% of the ATAC-seq peaks.</p>
    </sec>
    <sec id="S23">
      <title>Paralogous TF ChIP-seq evaluation</title>
      <list list-type="order" id="L4">
        <list-item>
          <p id="P65">There are 20 pairs of ENCODE ChIP-seq experiments for paralogous TFs in the same cell type with more than 5k peaks in each experiment using a conservative IDR threshold. We evaluated BindSpace, PWM, LASSO, and DeepBind for their ability to distinguish between these paralogous TF ChIP-seq peaks. For each pair of ChIP-seq experiments for paralogous TFs, we took top 100 peaks unique to TF1 or TF2 from each ChIP-seq experiment. Each method was required to predict TF1 (when TF1 score &gt; TF2 score and TF1 score &gt; cutoff), TF2 (when TF2 score &gt; TF1 score and TF2 score &gt; cutoff), or neither (when TF1 score &lt; cutoff and TF2 score &lt; cutoff). With various performance metrics (precision, recall, F1), we reported the average performance of TF1 and TF2. We also reported the average of TF1 auPR on ranking TF1 peaks above TF2 peaks and TF2 auPR for ranking TF2 peaks above TF1 peaks.</p>
        </list-item>
        <list-item>
          <p id="P66">For two example paralogous pairs (HepG2 CEBPB versus CEBPG, HepG2 NR2F6 versus NR2F1), we evaluated the performance by showing the predicted score distributions for BindSpace, PWM, LASSO and DeepBind in a similar way that we evaluated gcPBM data. We split the union of ChIP-seq peaks of paralogous TFs into three groups: TF1 specific, TF2 specific, or common. Using each of BindSpace, PWM, LASSO or DeepBind methods, we predicted each peak to be TF1 specific (TF1 score &gt; TF2 score and TF1 score &gt; cutoff), TF2 specific (TF2 score &gt; TF1 score and TF2 score &gt; cutoff) or low affinity (TF1 score &lt; cutoff and TF2 score &lt; cutoff) and visualized the distribution of scores and class assignments in each of the three groups.</p>
        </list-item>
      </list>
    </sec>
    <sec id="S24">
      <title>ChIP-seq multiclass evaluation</title>
      <p id="P67">We resized all ChIP-seq to be 150bp around summit. For each experiment, we took the top 10,000 peaks with most significant IDR and performed multiclass classification of each peak using BindSpace, FIMO PWM scoring, LASSO or DeepBind using TFs in the same family. We evaluated performance by determining the percentage of the top 10,000 peaks that were correctly classified.</p>
    </sec>
    <sec id="S25">
      <title>Inclusion of 10-mer features</title>
      <p id="P68">In order to understand whether the choice of 8-mers as our feature set limited our capability to capture long DNA binding signals like CTCF, we trained a new BindSpace model by adding some 10-mer features. Specifically, in addition to 8-mers with wildcards, we picked the top 200 enriched 10-mers from each HT-SELEX experiment, giving a total of 51,380 unique exact match 10-mers. We added these 10-mer features into our vocabulary, which expanded our vocabulary by about 50%. We trained a BindSpace model with the same hyperparamters as previously determined and compared the performance with regular BindSpace on held-out HT-SELEX probes (<xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
    </sec>
    <sec id="S26">
      <title>Comparison with <italic>k</italic>-mer modules</title>
      <p id="P69">We downloaded <italic>k-</italic>mer modules from Mariani <italic>et al.</italic> 2017<sup><xref rid="R26" ref-type="bibr">26</xref></sup>. We assigned each module to a TF family if a representative TF of that module has a (human/mouse) family assignment in CIS-BP. In this way, 92 out of the 108 modules could be identified with a total of 22 families represented in BindSpace. We embedded all 92 modules to BindSpace and measured their similarity to all TF family labels (<xref rid="SD2" ref-type="supplementary-material">Supplementary Note</xref>).</p>
    </sec>
    <sec id="S27">
      <title>Statistics</title>
      <p id="P70">We used Wilcoxon signed rank test for pairwise performance comparison between methods.</p>
    </sec>
    <sec sec-type="data-availability" id="S28">
      <title>Data availability</title>
      <p id="P71">We used only public datasets in this study. Each dataset can be accessed in the original publication referenced.</p>
    </sec>
    <sec id="S29">
      <title>Code availability</title>
      <p id="P72">Open source code for BindSpace as well as the trained BindSpace model are freely available for download (<ext-link ext-link-type="uri" xlink:href="https://bitbucket.org/hy395/selex_embed">https://bitbucket.org/hy395/selex_embed</ext-link> for source code for training BindSpace; <ext-link ext-link-type="uri" xlink:href="https://bitbucket.org/hy395/bindspace">https://bitbucket.org/hy395/bindspace</ext-link> for R package to make predictions with the trained model).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM1">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>1</label>
      <media xlink:href="NIHMS1534332-supplement-1.doc" orientation="portrait" xlink:type="simple" id="d36e1704" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>2</label>
      <media xlink:href="NIHMS1534332-supplement-2.docx" orientation="portrait" xlink:type="simple" id="d36e1708" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>3</label>
      <media xlink:href="NIHMS1534332-supplement-3.txt" orientation="portrait" xlink:type="simple" id="d36e1712" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>4</label>
      <media xlink:href="NIHMS1534332-supplement-4.xlsx" orientation="portrait" xlink:type="simple" id="d36e1716" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD5">
      <label>5</label>
      <media xlink:href="NIHMS1534332-supplement-5.txt" orientation="portrait" xlink:type="simple" id="d36e1720" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD6">
      <label>6</label>
      <media xlink:href="NIHMS1534332-supplement-6.pdf" orientation="portrait" xlink:type="simple" id="d36e1724" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S30">
    <title>Acknowledgements</title>
    <p id="P73">We thank Jason Weston for suggesting the StarSpace algorithm and providing access to his code. We also thank William Stafford Noble, Jeffrey Bilmes, and Jacob Schreiber for helpful comments on the project. This work was supported by NIH/NHGRI U01 award HG009395. Support for H.Y. was also provided by the Tri-Institutional Training Program in Computational Biology and Medicine.</p>
  </ack>
  <fn-group>
    <fn fn-type="COI-statement" id="FN3">
      <p id="P74">Competing Financial Interests</p>
      <p id="P75">We declare no competing financial interest.</p>
    </fn>
  </fn-group>
  <ref-list>
    <title>References</title>
    <ref id="R1">
      <label>1.</label>
      <mixed-citation publication-type="journal"><name><surname>Berger</surname><given-names>MF</given-names></name><etal/><article-title>Compact, universal DNA microarrays to comprehensively determine transcription-factor binding site specificities</article-title>. <source>Nat. Biotechnol</source><volume>24</volume>, <fpage>1429</fpage>–<lpage>1435</lpage> (<year>2006</year>).<pub-id pub-id-type="pmid">16998473</pub-id></mixed-citation>
    </ref>
    <ref id="R2">
      <label>2.</label>
      <mixed-citation publication-type="journal"><name><surname>Warren</surname><given-names>CL</given-names></name><etal/><article-title>Defining the sequence-recognition profile of DNA-binding molecules</article-title>. <source>Proc. Natl. Acad. Sci</source><volume>103</volume>, <fpage>867</fpage>–<lpage>872</lpage> (<year>2006</year>).<pub-id pub-id-type="pmid">16418267</pub-id></mixed-citation>
    </ref>
    <ref id="R3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><name><surname>Gordân</surname><given-names>R</given-names></name><etal/><article-title>Genomic Regions Flanking E-Box Binding Sites Influence DNA Binding Specificity of bHLH Transcription Factors through DNA Shape</article-title>. <source>Cell Rep</source>. <volume>3</volume>, (<year>2013</year>).</mixed-citation>
    </ref>
    <ref id="R4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><name><surname>Maerkl</surname><given-names>SJ</given-names></name> &amp; <name><surname>Quake</surname><given-names>SR</given-names></name>
<article-title>A systems approach to measuring the binding energy landscapes of transcription factors</article-title>. <source>Science</source> (<issue>80-.</issue>). <volume>315</volume>, <fpage>233</fpage>–<lpage>237</lpage> (<year>2007</year>).<pub-id pub-id-type="pmid">17218526</pub-id></mixed-citation>
    </ref>
    <ref id="R5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><name><surname>Jolma</surname><given-names>A</given-names></name><etal/><article-title>DNA-binding specificities of human transcription factors</article-title>. <source>Cell</source><volume>152</volume>, <fpage>327</fpage>–<lpage>339</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23332764</pub-id></mixed-citation>
    </ref>
    <ref id="R6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><name><surname>Ghandi</surname><given-names>M</given-names></name>, <name><surname>Lee</surname><given-names>D</given-names></name>, <name><surname>Mohammad-Noori</surname><given-names>M</given-names></name> &amp; <name><surname>Beer</surname><given-names>MA</given-names></name>
<article-title>Enhanced Regulatory Sequence Prediction Using Gapped k-mer Features</article-title>. <source>PLoS Comput. Biol</source>
<volume>10</volume>, (<year>2014</year>).</mixed-citation>
    </ref>
    <ref id="R7">
      <label>7.</label>
      <mixed-citation publication-type="journal"><name><surname>Setty</surname><given-names>M</given-names></name> &amp; <name><surname>Leslie</surname><given-names>CS</given-names></name>
<article-title>SeqGL Identifies Context-Dependent Binding Signals in Genome-Wide Regulatory Element Maps</article-title>. <source>PLOS Comput. Biol</source>
<volume>11</volume>, <fpage>e1004271</fpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26016777</pub-id></mixed-citation>
    </ref>
    <ref id="R8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><name><surname>Yang</surname><given-names>L</given-names></name><etal/><article-title>Transcription factor family‐specific DNA shape readout revealed by quantitative specificity models</article-title>. <source>Mol. Syst. Biol</source><volume>13</volume>, <fpage>1</fpage>–<lpage>14</lpage> (<year>2017</year>).</mixed-citation>
    </ref>
    <ref id="R9">
      <label>9.</label>
      <mixed-citation publication-type="journal"><name><surname>Shen</surname><given-names>N</given-names></name><etal/><article-title>Divergence in DNA Specificity among Paralogous Transcription Factors Contributes to Their Differential In Vivo Binding</article-title>. <source>Cell Syst</source>. <volume>6</volume>, <fpage>470</fpage>–<lpage>483</lpage>.<comment>e8</comment> (<year>2018</year>).<pub-id pub-id-type="pmid">29605182</pub-id></mixed-citation>
    </ref>
    <ref id="R10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><name><surname>Wu</surname><given-names>L</given-names></name><etal/><source>StarSpace: Embed All The Things! in <italic>AAAI</italic></source> (<year>2018</year>).</mixed-citation>
    </ref>
    <ref id="R11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><name><surname>Melvin</surname><given-names>I</given-names></name>, <name><surname>Weston</surname><given-names>J</given-names></name>, <name><surname>Noble</surname><given-names>WS</given-names></name> &amp; <name><surname>Leslie</surname><given-names>C</given-names></name>
<article-title>Detecting remote evolutionary relationships among proteins by large-scale semantic embedding</article-title>. <source>PLoS Comput. Biol</source>
<volume>7</volume>, (<year>2011</year>).</mixed-citation>
    </ref>
    <ref id="R12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><name><surname>Dai</surname><given-names>H</given-names></name><etal/><source>Sequence2Vec : A novel embedding approach for modeling transcription factor binding affinity landscape</source>. <fpage>1</fpage>–<lpage>9</lpage> (<year>2017</year>).</mixed-citation>
    </ref>
    <ref id="R13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><name><surname>Grant</surname><given-names>CE</given-names></name>, <name><surname>Bailey</surname><given-names>TL</given-names></name> &amp; <name><surname>Noble</surname><given-names>WS</given-names></name>
<article-title>FIMO: Scanning for occurrences of a given motif</article-title>. <source>Bioinformatics</source>
<volume>27</volume>, <fpage>1017</fpage>–<lpage>1018</lpage> (<year>2011</year>).<pub-id pub-id-type="pmid">21330290</pub-id></mixed-citation>
    </ref>
    <ref id="R14">
      <label>14.</label>
      <mixed-citation publication-type="journal"><name><surname>Alipanahi</surname><given-names>B</given-names></name>, <name><surname>Delong</surname><given-names>A</given-names></name>, <name><surname>Weirauch</surname><given-names>MT</given-names></name> &amp; <name><surname>Frey</surname><given-names>BJ</given-names></name>
<article-title>Predicting the sequence specificities of DNA- and RNA-binding proteins by deep learning</article-title>. <source>Nat Biotechnol</source>
<volume>33</volume>, <fpage>831</fpage>–<lpage>838</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26213851</pub-id></mixed-citation>
    </ref>
    <ref id="R15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><name><surname>Barrera</surname><given-names>LA</given-names></name><etal/><article-title>Survey of variation in human transcription factors reveals prevalent DNA binding changes</article-title>. <source>Science</source> (<issue>80-.</issue> ). <volume>351</volume>, <fpage>1450</fpage>–<lpage>1454</lpage> (<year>2016</year>).<pub-id pub-id-type="pmid">27013732</pub-id></mixed-citation>
    </ref>
    <ref id="R16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><name><surname>Wei</surname><given-names>GH</given-names></name><etal/><article-title>Genome-wide analysis of ETS-family DNA-binding in vitro and in vivo</article-title>. <source>EMBO J</source>. <volume>29</volume>, <fpage>2147</fpage>–<lpage>2160</lpage> (<year>2010</year>).<pub-id pub-id-type="pmid">20517297</pub-id></mixed-citation>
    </ref>
    <ref id="R17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><name><surname>Berger</surname><given-names>MF</given-names></name><etal/><article-title>Variation in Homeodomain DNA Binding Revealed by High-Resolution Analysis of Sequence Preferences</article-title>. <source>Cell</source><volume>133</volume>, <fpage>1266</fpage>–<lpage>1276</lpage> (<year>2008</year>).<pub-id pub-id-type="pmid">18585359</pub-id></mixed-citation>
    </ref>
    <ref id="R18">
      <label>18.</label>
      <mixed-citation publication-type="journal"><name><surname>Slattery</surname><given-names>M</given-names></name><etal/><article-title>Cofactor binding evokes latent differences in DNA binding specificity between hox proteins</article-title>. <source>Cell</source><volume>147</volume>, <fpage>1270</fpage>–<lpage>1282</lpage> (<year>2011</year>).<pub-id pub-id-type="pmid">22153072</pub-id></mixed-citation>
    </ref>
    <ref id="R19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><name><surname>Morgulis</surname><given-names>A</given-names></name>, <name><surname>Gertz</surname><given-names>EM</given-names></name>, <name><surname>Schäffer</surname><given-names>AA</given-names></name> &amp; <name><surname>Agarwala</surname><given-names>R</given-names></name>
<article-title>A Fast and Symmetric DUST Implementation to Mask Low-Complexity DNA Sequences</article-title>. <source>J. Comput. Biol</source>
<volume>13</volume>, <fpage>1028</fpage>–<lpage>1040</lpage> (<year>2006</year>).<pub-id pub-id-type="pmid">16796549</pub-id></mixed-citation>
    </ref>
    <ref id="R20">
      <label>20.</label>
      <mixed-citation publication-type="journal"><name><surname>Simon</surname><given-names>N</given-names></name>, <name><surname>Friedman</surname><given-names>J</given-names></name>, <name><surname>Hastie</surname><given-names>T</given-names></name> &amp; <name><surname>Tibshirani</surname><given-names>R</given-names></name>
<article-title>Regularization Paths for Cox’s Proportional Hazards Model via Coordinate Descent</article-title>. <source>J. Stat. Softw</source>
<volume>39</volume>, (<year>2011</year>).</mixed-citation>
    </ref>
    <ref id="R21">
      <label>21.</label>
      <mixed-citation publication-type="journal"><name><surname>Van Der Maaten</surname><given-names>L</given-names></name> &amp; <name><surname>Hinton</surname><given-names>G</given-names></name>
<article-title>Visualizing Data using t-SNE</article-title>. <source>J. Mach. Learn. Res</source>
<volume>9</volume>, <fpage>2579</fpage>–<lpage>2605</lpage> (<year>2008</year>).</mixed-citation>
    </ref>
    <ref id="R22">
      <label>22.</label>
      <mixed-citation publication-type="journal"><name><surname>van der Maaten</surname><given-names>L</given-names></name><article-title>Accelerating t-SNE using Tree-Based Algorithms</article-title>. <source>J. Mach. Learn. Res</source><volume>15</volume>, <fpage>3221</fpage>–<lpage>3245</lpage> (<year>2014</year>).</mixed-citation>
    </ref>
    <ref id="R23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><name><surname>Krijthe</surname><given-names>JH</given-names></name><source>{Rtsne}: T-Distributed Stochastic Neighbor Embedding using Barnes-Hut Implementation</source>. (<year>2015</year>).</mixed-citation>
    </ref>
    <ref id="R24">
      <label>24.</label>
      <mixed-citation publication-type="journal"><name><surname>Litzenburger</surname><given-names>UM</given-names></name><etal/><article-title>Single-cell epigenomic variability reveals functional cancer heterogeneity</article-title>. <source>Genome Biol</source>. <volume>18</volume>, (<year>2017</year>).</mixed-citation>
    </ref>
    <ref id="R25">
      <label>25.</label>
      <mixed-citation publication-type="journal"><name><surname>Buenrostro</surname><given-names>JD</given-names></name>, <name><surname>Giresi</surname><given-names>PG</given-names></name>, <name><surname>Zaba</surname><given-names>LC</given-names></name>, <name><surname>Chang</surname><given-names>HY</given-names></name> &amp; <name><surname>Greenleaf</surname><given-names>WJ</given-names></name>
<article-title>Transposition of native chromatin for fast and sensitive epigenomic profiling of open chromatin, DNA-binding proteins and nucleosome position</article-title>. <source>Nat. Methods</source>
<volume>10</volume>, <fpage>1213</fpage>–<lpage>8</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">24097267</pub-id></mixed-citation>
    </ref>
    <ref id="R26">
      <label>26.</label>
      <mixed-citation publication-type="journal"><name><surname>Mariani</surname><given-names>L</given-names></name>, <name><surname>Weinand</surname><given-names>K</given-names></name>, <name><surname>Vedenko</surname><given-names>A</given-names></name>, <name><surname>Barrera</surname><given-names>LA</given-names></name> &amp; <name><surname>Bulyk</surname><given-names>ML</given-names></name>
<article-title>Identification of Human Lineage-Specific Transcriptional Coregulators Enabled by a Glossary of Binding Modules and Tunable Genomic Backgrounds</article-title>. <source>Cell Syst</source>. <volume>5</volume>, <fpage>187</fpage>–<lpage>201</lpage>.<comment>e7</comment> (<year>2017</year>).<pub-id pub-id-type="pmid">28957653</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1.</label>
    <caption>
      <title>A schematic overview of BindSpace.</title>
      <p id="P77">BindSpace is an embedding approach that jointly learns binding models for hundreds of TFs.</p>
      <p id="P78"><bold>(a)</bold> Enriched DNA probes for TF HT-SELEX experiments are represented as bags of <italic>k</italic>-mers, namely 8-mers with up to two consecutive wildcards (a wildcard represents any of the 4 nucleotides).</p>
      <p id="P79"><bold>(b)</bold> BindSpace learns an embedding of <italic>k</italic>-mers (grey dots), DNA probes (colored dots), TF labels (colored squares), and TF family labels (black triangles) in the same high-dimensional space. The embedding of a probe sequence is determined by the embedding of its constituent <italic>k</italic>-mers. Unbound HT-SELEX probes and inaccessible genomic sequences serve as universal negative examples.</p>
    </caption>
    <graphic xlink:href="nihms-1534332-f0001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2.</label>
    <caption>
      <title>BindSpace accurately predicts TF binding and distinguishes between TF family members <italic>in vitro</italic>.</title>
      <p id="P81"><bold>(a)</bold> t-SNE visualization of the embedding space. Colored points represent embedding of enriched probes from HT-SELEX experiments (n=50 probes from each experiment). Black points represent embedding of TF family labels for 13 major families (families with more than three members). A full t-SNE visualization of all TF labels as well as TF family labels is shown in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>.</p>
      <p id="P82"><bold>(b)</bold> Left: multiclass prediction performance of BindSpace, PWM, one-versus-all LASSO and DeepBind methods on held-out HT-SELEX probes evaluated by F1 score (n=243 HT-SELEX TFs, one-sided Wilcoxon signed rank test). Right: prediction performance of BindSpace+, PWM, one-versus-all LASSO and DeepBind on held-out HT-SELEX probes evaluated by one-versus-all auPR per TF (n=243 HT-SELEX TFs, one-sided Wilcoxon signed rank test). Boxplots show median, upper and lower quartiles, and highest and lowest values excluding outliers.</p>
      <p id="P83"><bold>(c)</bold> Multiclass prediction performance of PWM scoring (left) and BindSpace (right) as shown by confusion matrices normalized by class support for the bZIP family. Rows are true labels, and columns are predicted labels. For comparison between BindSpace, PWM, LASSO and DeepBind on 13 major TF families, also see <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4</xref> and <xref rid="SD2" ref-type="supplementary-material">Supplementary Note SN1</xref>–<xref rid="SD2" ref-type="supplementary-material">2</xref>.</p>
    </caption>
    <graphic xlink:href="nihms-1534332-f0002"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3.</label>
    <caption>
      <title>BindSpace predicts binding of TFs and distinguishes between paralogous TF binding sites <italic>in vivo</italic>.</title>
      <p id="P85"><bold>(a)</bold> Left: performance of BindSpace, PWM, LASSO and DeepBind on distinguishing ChIP-seq peaks of ENCODE paralogous TF pairs as measured by F1 score averaged over TF1 and TF2 of each pair (n=20, one-sided Wilcoxon signed rank test). Right: performance of BindSpace+, PWM, LASSO, and DeepBind on distinguishing ChIP-seq peaks of ENCODE paralogous TF pairs as evaluated by auROC averaged over TF1 and TF2 of each pair (n=20, one-sided Wilcoxon signed rank test). Boxplots show median, upper and lower quartiles, and highest and lowest values excluding outliers.</p>
      <p id="P86"><bold>(b)</bold> BindSpace performance on distinguishing CEBPB specific peaks versus CEBPG specific peaks in HepG2. From left to right, we show the predicted affinities on CEBPB specific peaks (predicted CEBPB score significantly higher than predicted CEBPG score, <italic>P</italic> = 2.1e-56, n = 3045), CEBPG specific peaks (predicted CEBPG score significantly higher than predicted CEBPB score, <italic>P</italic> = 2.14e-40, n = 2583), and common peaks in the scatter plots (no significant different, <italic>P</italic> = 0.317 when alternative is CEBPB&gt;CEBPG, <italic>P</italic> = 0.683 when alternative is CEBPB&lt;CEBPG, n = 5248), one-sided Wilcoxon signed-rank test. Each probe is assigned to be CEBPB specific (red), CEBPG specific (blue) or low affinity (gray). Pie charts show the proportion of peaks predicted to be CEBPB specific versus CEBPG specific in each group. (For performance of PWM, LASSO and DeepBind, see <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8</xref>)</p>
      <p id="P87"><bold>(c)</bold> Multiclass classification performance of BindSpace, PWM, LASSO and DeepBind for three bZIP TFs in the HepG2 cell line. For each plot, we performed multiclass classification using BindSpace on the top 10,000 peaks for bZIP TF ChIP-seq and show the proportion of predicted labels for each model. Experiments where the ChIP-ed TF is predicted more frequent than other members in the same family are indicated by *. See <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 10</xref> for a comparison of all bZIP family members in HepG2 cell line.</p>
    </caption>
    <graphic xlink:href="nihms-1534332-f0003"/>
  </fig>
</floats-group>
