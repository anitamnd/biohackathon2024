<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS Comput. Biol</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">ploscomp</journal-id>
    <journal-title-group>
      <journal-title>PLoS Computational Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1553-734X</issn>
    <issn pub-type="epub">1553-7358</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6396939</article-id>
    <article-id pub-id-type="pmid">30779737</article-id>
    <article-id pub-id-type="publisher-id">PCOMPBIOL-D-18-00533</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1006731</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Plant Genomics</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Bioengineering</subject>
          <subj-group>
            <subject>Biotechnology</subject>
            <subj-group>
              <subject>Plant Biotechnology</subject>
              <subj-group>
                <subject>Plant Genomics</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Engineering and Technology</subject>
        <subj-group>
          <subject>Bioengineering</subject>
          <subj-group>
            <subject>Biotechnology</subject>
            <subj-group>
              <subject>Plant Biotechnology</subject>
              <subj-group>
                <subject>Plant Genomics</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Plant Science</subject>
          <subj-group>
            <subject>Plant Biotechnology</subject>
            <subj-group>
              <subject>Plant Genomics</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Plant Genetics</subject>
            <subj-group>
              <subject>Plant Genomics</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Plant Science</subject>
          <subj-group>
            <subject>Plant Genetics</subject>
            <subj-group>
              <subject>Plant Genomics</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and life sciences</subject>
        <subj-group>
          <subject>Biochemistry</subject>
          <subj-group>
            <subject>Proteins</subject>
            <subj-group>
              <subject>DNA-binding proteins</subject>
              <subj-group>
                <subject>Transcription Factors</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Gene Expression</subject>
            <subj-group>
              <subject>Gene Regulation</subject>
              <subj-group>
                <subject>Transcription Factors</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Biochemistry</subject>
          <subj-group>
            <subject>Proteins</subject>
            <subj-group>
              <subject>Regulatory Proteins</subject>
              <subj-group>
                <subject>Transcription Factors</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Database and Informatics Methods</subject>
          <subj-group>
            <subject>Bioinformatics</subject>
            <subj-group>
              <subject>Sequence Analysis</subject>
              <subj-group>
                <subject>Sequence Motif Analysis</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Computational Biology</subject>
          <subj-group>
            <subject>Genome Analysis</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Genome Analysis</subject>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Heredity</subject>
            <subj-group>
              <subject>Genetic Mapping</subject>
              <subj-group>
                <subject>Haplotypes</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Database and Informatics Methods</subject>
          <subj-group>
            <subject>Bioinformatics</subject>
            <subj-group>
              <subject>Sequence Analysis</subject>
              <subj-group>
                <subject>Sequence Alignment</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Animal Studies</subject>
          <subj-group>
            <subject>Experimental Organism Systems</subject>
            <subj-group>
              <subject>Model Organisms</subject>
              <subj-group>
                <subject>Arabidopsis Thaliana</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Model Organisms</subject>
          <subj-group>
            <subject>Arabidopsis Thaliana</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Organisms</subject>
          <subj-group>
            <subject>Eukaryota</subject>
            <subj-group>
              <subject>Plants</subject>
              <subj-group>
                <subject>Brassica</subject>
                <subj-group>
                  <subject>Arabidopsis Thaliana</subject>
                </subj-group>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Research and Analysis Methods</subject>
        <subj-group>
          <subject>Animal Studies</subject>
          <subj-group>
            <subject>Experimental Organism Systems</subject>
            <subj-group>
              <subject>Plant and Algal Models</subject>
              <subj-group>
                <subject>Arabidopsis Thaliana</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v3">
        <subject>Biology and Life Sciences</subject>
        <subj-group>
          <subject>Genetics</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Animal Genomics</subject>
              <subj-group>
                <subject>Invertebrate Genomics</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Graph Peak Caller: Calling ChIP-seq peaks on graph-based reference genomes</article-title>
      <alt-title alt-title-type="running-head">Graph Peak Caller</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-8941-942X</contrib-id>
        <name>
          <surname>Grytten</surname>
          <given-names>Ivar</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Project administration</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – original draft</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor001">*</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Rand</surname>
          <given-names>Knut D.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Investigation</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Project administration</role>
        <role content-type="http://credit.casrai.org/">Software</role>
        <role content-type="http://credit.casrai.org/">Validation</role>
        <role content-type="http://credit.casrai.org/">Visualization</role>
        <role content-type="http://credit.casrai.org/">Writing – original draft</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-5539-0999</contrib-id>
        <name>
          <surname>Nederbragt</surname>
          <given-names>Alexander J.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="aff003">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-8198-1426</contrib-id>
        <name>
          <surname>Storvik</surname>
          <given-names>Geir O.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Formal analysis</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Glad</surname>
          <given-names>Ingrid K.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Formal analysis</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff002">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sandve</surname>
          <given-names>Geir K.</given-names>
        </name>
        <role content-type="http://credit.casrai.org/">Conceptualization</role>
        <role content-type="http://credit.casrai.org/">Methodology</role>
        <role content-type="http://credit.casrai.org/">Supervision</role>
        <role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
        <xref ref-type="aff" rid="aff001">
          <sup>1</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>Department of informatics, University of Oslo, Oslo, Norway</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Department of Mathematics, University of Oslo, Oslo, Norway</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Department of Biosciences, University of Oslo, Oslo, Norway</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>McHardy</surname>
          <given-names>Alice Carolyn</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Helmholtz-Zentrum fur Infektionsforschung GmbH, GERMANY</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>ivargry@ifi.uio.no</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>2</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>19</day>
      <month>2</month>
      <year>2019</year>
    </pub-date>
    <volume>15</volume>
    <issue>2</issue>
    <elocation-id>e1006731</elocation-id>
    <history>
      <date date-type="received">
        <day>6</day>
        <month>4</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>12</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2019 Grytten et al</copyright-statement>
      <copyright-year>2019</copyright-year>
      <copyright-holder>Grytten et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pcbi.1006731.pdf"/>
    <abstract>
      <p>Graph-based representations are considered to be the future for reference genomes, as they allow integrated representation of the steadily increasing data on individual variation. Currently available tools allow <italic>de novo</italic> assembly of graph-based reference genomes, alignment of new read sets to the graph representation as well as certain analyses like variant calling and haplotyping. We here present a first method for calling ChIP-Seq peaks on read data aligned to a graph-based reference genome. The method is a graph generalization of the peak caller MACS2, and is implemented in an open source tool, <italic>Graph Peak Caller</italic>. By using the existing tool <italic>vg</italic> to build a pan-genome of <italic>Arabidopsis thaliana</italic>, we validate our approach by showing that Graph Peak Caller with a pan-genome reference graph can trace variants within peaks that are not part of the linear reference genome, and find peaks that in general are more motif-enriched than those found by MACS2.</p>
    </abstract>
    <abstract abstract-type="summary">
      <title>Author summary</title>
      <p>The expression of genes is a tightly regulated process. A key regulatory mechanism is the modulation of transcription by a class of proteins called transcription factors that bind to DNA in the spatial proximity of regulated genes. Determining the binding locations of transcription factors for specific cell types and settings is thus a key step in understanding the dynamics of normal cells as well as disease states. Binding sites for a given transcription factor are typically obtained through an experimental technique called CHiP-seq, in which DNA binding locations are obtained by sequencing DNA fragments attached to the transcription factor and aligning these sequences to a reference genome. A computational technique known as <italic>peak calling</italic> is then used to separate signal from noise and predict where the protein binds. Current peak callers are based on linear reference genomes that do not contain known genetic variants from the population. They thus potentially miss cases where proteins bind to such alternative genome sequences. Recently, a new type of reference genomes based on graph representations have become popular, as they are able to also incorporate alternative genome sequences. We here present <italic>Graph Peak Caller</italic>, the first peak caller that is able to exploit such graph representations for the detection of transcription factor binding locations. Using a graph-based reference genome for <italic>Arabidopsis thaliana</italic>, we show that our peak caller can lead to better detection of transcription factor binding locations as compared to a similar existing peak caller that uses a linear reference genome representation.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution>Centre for Computational Inference in Evolutionary Life Science, Faculty of Mathematics and Natural Sciences (CELS), University of Oslo, Oslo, Norway</institution>
        </funding-source>
      </award-group>
      <funding-statement>This work was supported by the Centre for Computational Inference in Evolutionary Life Science (CELS), but otherwise received no specific grant from any funding agency in the public, commercial, or not-for-profit sectors. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="5"/>
      <table-count count="1"/>
      <page-count count="13"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>PLOS Publication Stage</meta-name>
        <meta-value>vor-update-to-uncorrected-proof</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>Publication Update</meta-name>
        <meta-value>2019-03-01</meta-value>
      </custom-meta>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>All files are available from the Genomic Hyperbrowser at <ext-link ext-link-type="uri" xlink:href="https://hyperbrowser.uio.no/graph-peak-caller/static/graph_peak_caller_data.html">https://hyperbrowser.uio.no/graph-peak-caller/static/graph_peak_caller_data.html</ext-link>.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>All files are available from the Genomic Hyperbrowser at <ext-link ext-link-type="uri" xlink:href="https://hyperbrowser.uio.no/graph-peak-caller/static/graph_peak_caller_data.html">https://hyperbrowser.uio.no/graph-peak-caller/static/graph_peak_caller_data.html</ext-link>.</p>
  </notes>
</front>
<body>
  <disp-quote>
    <p>This is a <italic>PLOS Computational Biology</italic> Methods paper.</p>
  </disp-quote>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>Transcription factors are known to play a key role in gene regulation, and detecting regions associated with transcription factor binding is an important step in understanding their function. The most common technique used to detect transcription factor binding sites is <italic>ChIP-seq</italic>, combining chromatin immunoprecipitation (ChIP) assays with sequencing (seq). A ChiP-seq experiment involves obtaining DNA <italic>fragments</italic> that bind to the transcription factor of interest and sequencing arbitrary ends of these fragments, yielding short reads. Obtaining putative binding regions from these reads is done using computational techniques known collectively as performing <italic>peak calling</italic>. Several <italic>peak callers</italic>, programs to perform peak calling, have been developed for this purpose, for example MACS2 [<xref rid="pcbi.1006731.ref001" ref-type="bibr">1</xref>] and SPP [<xref rid="pcbi.1006731.ref002" ref-type="bibr">2</xref>] [<xref rid="pcbi.1006731.ref003" ref-type="bibr">3</xref>]. Common for all current peak callers is that they take reads mapped to a <italic>linear</italic> reference genome, such as GRCh38, as input.</p>
    <p>Graph-based reference genomes offer a way to include known variants within a population in the reference structure [<xref rid="pcbi.1006731.ref004" ref-type="bibr">4</xref>]. The software package <italic>vg</italic> supports mapping reads to a graph-based reference genome with potentially increased accuracy [<xref rid="pcbi.1006731.ref005" ref-type="bibr">5</xref>, <xref rid="pcbi.1006731.ref006" ref-type="bibr">6</xref>] as compared to mapping reads to a standard linear reference genome using tools like BWA [<xref rid="pcbi.1006731.ref007" ref-type="bibr">7</xref>] or Bowtie [<xref rid="pcbi.1006731.ref008" ref-type="bibr">8</xref>]. Several types of genomic analyses, such as variant calling and haplotyping, can now be performed using graph-based references [<xref rid="pcbi.1006731.ref005" ref-type="bibr">5</xref>, <xref rid="pcbi.1006731.ref006" ref-type="bibr">6</xref>]. However, no tool currently exists for performing peak calling on graph-based references.</p>
  </sec>
  <sec sec-type="results" id="sec002">
    <title>Results</title>
    <p>We present <italic>Graph Peak Caller</italic>, a first method for detecting transcription factor binding events from ChIP-seq reads mapped to a graph-based reference genome. Graph Peak Caller is based on the same principles used by MACS2 (see <xref ref-type="fig" rid="pcbi.1006731.g001">Fig 1</xref> for an overview), and is able to call peaks with or without a set of control alignments. For the case of a graph that merely reflects a linear reference genome, our peak-caller produces the same results as MACS2. As input, it supports alignments in the Graph Alignment/Map format (GAM) from <italic>vg</italic>, as well as reads represented as genomic intervals using the Offset Based Graph Python package [<xref rid="pcbi.1006731.ref009" ref-type="bibr">9</xref>]. Graph Peak Caller can be run from the command line, and is also available through Galaxy at <ext-link ext-link-type="uri" xlink:href="https://hyperbrowser.uio.no/graph-peak-caller">https://hyperbrowser.uio.no/graph-peak-caller</ext-link>. In the Github repository at <ext-link ext-link-type="uri" xlink:href="http://github.com/uio-bmi/graph_peak_caller">http://github.com/uio-bmi/graph_peak_caller</ext-link>, we provide a simple tutorial on how to use <italic>vg</italic> and Graph Peak Caller to go from raw ChIP-seq reads to peaks.</p>
    <fig id="pcbi.1006731.g001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1006731.g001</object-id>
      <label>Fig 1</label>
      <caption>
        <title>Overview of how Graph Peak Caller works.</title>
        <p>Example of peak calling on an example graph (nodes in gray, edges in black). After raw reads (a) in the form of input reads (blue) and control reads (red) have been mapped to the graph-based reference genome and filtered based on mapping quality (b), the fragment pileup is created (c) by extending the forward input alignments and reverse input alignments (extensions shown as dotted lines) along all possible paths in their corresponding direction. A background track is created by projecting the alignments resulting from the control reads onto a linear path and calculating a local average of read counts. Then the linear track is projected back to the graph again. The fragment pileup is treated as <italic>counts</italic> and the background track as <italic>rates</italic> in a Poisson-distribution, and p-values are computed for each position for the observed count, given the corresponding rate. Adjusted q-values are computed to control the false discovery rate (d) (figure shows q-scores, which are -<italic>log</italic><sub>10</sub>(<italic>qvalue</italic>)). The q-values are thresholded on a user-defined threshold (default 0.05), resulting in a set of peak candidate areas with gaps between them (e). Small gaps are filled, resulting in a set of peak subgraphs (connected subgraphs)(f). Graph Peak Caller finds a single “maximum path” (g, maximum path in blue) through each peak subgraph by selecting the path that has the highest number of input reads mapped to it.</p>
      </caption>
      <graphic xlink:href="pcbi.1006731.g001"/>
    </fig>
    <p>The output from Graph Peak Caller consists of graph intervals, but the tool is also able to transform these into approximate positions on a linear reference genome (by projecting them to the nearest position on the linear reference genome), making it possible to analyse detected peaks further using existing “linear” approaches. Graph Peak Caller is also able to output peak candidates for differentially expressed peaks.</p>
    <p>To showcase and test Graph Peak Caller, we chose to perform peak calling on <italic>Arabidopsis thaliana</italic>, as the 1001 Genomes Project for <italic>A. thaliana</italic> makes it possible to build a high-quality reference graph with a high density of variants (on average one SNP or indel for every 9 base pairs, compared to one SNP or indel for every 27 base pairs in the human 1000 Genomes Project). This graph is pruned by vg in order to make it possible to create indices for read alignment within reasonable time, reducing the number of variants to on average one variant for every 18 base pairs.</p>
    <p>We called peaks on this graph-based reference genome for <italic>A. thaliana</italic> and compared the results to peaks called on the <italic>Tair10</italic> [<xref rid="pcbi.1006731.ref010" ref-type="bibr">10</xref>] linear reference genome by MACS2 (<xref ref-type="sec" rid="sec006">Methods</xref>). <xref rid="pcbi.1006731.t001" ref-type="table">Table 1</xref> and <xref ref-type="fig" rid="pcbi.1006731.g002">Fig 2</xref> shows an overview of peaks found by Graph Peak Caller and MACS2. Most of the peaks found by one peak caller are also found by the other. Among these, the peaks found by Graph Peak Caller are slightly more enriched for DNA-binding motifs than the peaks found by MACS2 for all transcription factors, except SEP3, where the numbers are the same. <xref ref-type="fig" rid="pcbi.1006731.g003">Fig 3</xref> shows an example of a peak detected on chromosome 1, illustrating how both peak callers find a peak, but only the peak found by Graph Peak Caller has a match against the motif.</p>
    <fig id="pcbi.1006731.g002" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1006731.g002</object-id>
      <label>Fig 2</label>
      <caption>
        <title>Visual overview of all peaks found by Graph Peak Caller and MACS2 on <italic>A. thaliana</italic>.</title>
        <p>Showing the proportions of peaks found by both peak callers and peaks found uniquely by each peak caller. All rectangles are scaled to the proportion between the number of peaks they represent and the number of peaks in the union of the peaks found by both peak callers. The colors denote which peak caller found the peaks, while the hatching denotes which peaks had a motif match. Note that the sequence of a shared peak can differ between peak callers and thus the motif count among the shared peaks differs between the peak callers.</p>
      </caption>
      <graphic xlink:href="pcbi.1006731.g002"/>
    </fig>
    <fig id="pcbi.1006731.g003" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1006731.g003</object-id>
      <label>Fig 3</label>
      <caption>
        <title>Example of a motif match for a peak following a variant not part of the linear reference genome.</title>
        <p>Showing part of the graph-based reference genome for <italic>A. thaliana</italic> on chromosome 1 (top) with the linear reference genome represented by blue nodes (bases). The figure shows a peak found for the ERF115 transcription factor that matches a DNA-binding motif. The peak detected by Graph Peak Caller follows the linear reference genome (blue nodes) except for the first SNP shown (green node), where the peak follows the green G instead of the blue A, making this a significant match against the DNA-binding motif (shown as a sequence logo at the bottom). The peak detected by MACS2 does not have a significant motif match. All alignments intersecting with this binding site are present in a common haplotype among the haplotypes used to build the reference graph (<xref ref-type="supplementary-material" rid="pcbi.1006731.s008">S2 Appendix</xref>).</p>
      </caption>
      <graphic xlink:href="pcbi.1006731.g003"/>
    </fig>
    <table-wrap id="pcbi.1006731.t001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1006731.t001</object-id>
      <label>Table 1</label>
      <caption>
        <title>Overview of peaks reported by Graph Peak Caller and MACS2 on <italic>A. thaliana</italic> for 5 transcription factors (TFs).</title>
        <p><italic>Total</italic> is the total number of peaks reported by the peak caller, <italic>shared</italic> is the number of peaks that overlap with a peak from the other peak caller, and <italic>unique</italic> are peaks reported by one peak caller and not the other. In the categories <italic>shared</italic> and <italic>unique</italic>, both the number of peaks with motif match (the number before the /) and the number of peaks found are shown (percent of peaks with motif match are shown in parentheses). All peaks have been trimmed to 120 base pairs around the peak summit (position in peak with lowest q-value), to make the comparison clearer.</p>
      </caption>
      <alternatives>
        <graphic id="pcbi.1006731.t001g" xlink:href="pcbi.1006731.t001"/>
        <table frame="box" rules="all" border="0">
          <colgroup span="1">
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
            <col align="left" valign="middle" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th align="right" rowspan="1" colspan="1"/>
              <th align="left" colspan="5" rowspan="1">Graph Peak Caller</th>
              <th align="left" colspan="5" rowspan="1">MACS2</th>
            </tr>
            <tr>
              <th align="right" rowspan="1" colspan="1"/>
              <th align="left" rowspan="1" colspan="1">Total</th>
              <th align="left" colspan="2" rowspan="1">Shared</th>
              <th align="left" colspan="2" rowspan="1">Unique</th>
              <th align="left" rowspan="1" colspan="1">Total</th>
              <th align="left" colspan="2" rowspan="1">Shared</th>
              <th align="left" colspan="2" rowspan="1">Unique</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="right" rowspan="1" colspan="1">ERF115</td>
              <td align="left" rowspan="1" colspan="1">24976</td>
              <td align="left" rowspan="1" colspan="1">3121/21364</td>
              <td align="char" char="." rowspan="1" colspan="1">14.61%</td>
              <td align="left" rowspan="1" colspan="1">284/3612</td>
              <td align="char" char="." rowspan="1" colspan="1">7.86%</td>
              <td align="left" rowspan="1" colspan="1">23167</td>
              <td align="left" rowspan="1" colspan="1">3108/21364</td>
              <td align="char" char="." rowspan="1" colspan="1">14.55%</td>
              <td align="left" rowspan="1" colspan="1">214/1803</td>
              <td align="char" char="." rowspan="1" colspan="1">11.87%</td>
            </tr>
            <tr>
              <td align="right" rowspan="1" colspan="1">SEP3</td>
              <td align="left" rowspan="1" colspan="1">14976</td>
              <td align="left" rowspan="1" colspan="1">989/11982</td>
              <td align="char" char="." rowspan="1" colspan="1">8.25%</td>
              <td align="left" rowspan="1" colspan="1">125/2994</td>
              <td align="char" char="." rowspan="1" colspan="1">4.18%</td>
              <td align="left" rowspan="1" colspan="1">15517</td>
              <td align="left" rowspan="1" colspan="1">978/11982</td>
              <td align="char" char="." rowspan="1" colspan="1">8.16%</td>
              <td align="left" rowspan="1" colspan="1">148/3535</td>
              <td align="char" char="." rowspan="1" colspan="1">4.19%</td>
            </tr>
            <tr>
              <td align="right" rowspan="1" colspan="1">AP1</td>
              <td align="left" rowspan="1" colspan="1">16797</td>
              <td align="left" rowspan="1" colspan="1">764/13405</td>
              <td align="char" char="." rowspan="1" colspan="1">5.70%</td>
              <td align="left" rowspan="1" colspan="1">102/3392</td>
              <td align="char" char="." rowspan="1" colspan="1">3.01%</td>
              <td align="left" rowspan="1" colspan="1">17030</td>
              <td align="left" rowspan="1" colspan="1">754/13405</td>
              <td align="char" char="." rowspan="1" colspan="1">5.62%</td>
              <td align="left" rowspan="1" colspan="1">94/3625</td>
              <td align="char" char="." rowspan="1" colspan="1">2.59%</td>
            </tr>
            <tr>
              <td align="right" rowspan="1" colspan="1">SOC1</td>
              <td align="left" rowspan="1" colspan="1">15502</td>
              <td align="left" rowspan="1" colspan="1">1676/14297</td>
              <td align="char" char="." rowspan="1" colspan="1">11.72%</td>
              <td align="left" rowspan="1" colspan="1">116/1205</td>
              <td align="char" char="." rowspan="1" colspan="1">9.63%</td>
              <td align="left" rowspan="1" colspan="1">16407</td>
              <td align="left" rowspan="1" colspan="1">1681/14297</td>
              <td align="char" char="." rowspan="1" colspan="1">11.76%</td>
              <td align="left" rowspan="1" colspan="1">142/2110</td>
              <td align="char" char="." rowspan="1" colspan="1">6.73%</td>
            </tr>
            <tr>
              <td align="right" rowspan="1" colspan="1">PI</td>
              <td align="left" rowspan="1" colspan="1">17518</td>
              <td align="left" rowspan="1" colspan="1">1790/14084</td>
              <td align="char" char="." rowspan="1" colspan="1">12.71%</td>
              <td align="left" rowspan="1" colspan="1">300/3434</td>
              <td align="char" char="." rowspan="1" colspan="1">8.74%</td>
              <td align="left" rowspan="1" colspan="1">16084</td>
              <td align="left" rowspan="1" colspan="1">1793/14084</td>
              <td align="char" char="." rowspan="1" colspan="1">12.73%</td>
              <td align="left" rowspan="1" colspan="1">152/2000</td>
              <td align="char" char="." rowspan="1" colspan="1">7.60%</td>
            </tr>
            <tr>
              <td align="right" rowspan="1" colspan="1">SUM</td>
              <td align="left" rowspan="1" colspan="1">89769</td>
              <td align="left" rowspan="1" colspan="1">8340/75132</td>
              <td align="char" char="." rowspan="1" colspan="1">11.10%</td>
              <td align="left" rowspan="1" colspan="1">927/14637</td>
              <td align="char" char="." rowspan="1" colspan="1">6.33%</td>
              <td align="left" rowspan="1" colspan="1">88205</td>
              <td align="left" rowspan="1" colspan="1">8314/75132</td>
              <td align="char" char="." rowspan="1" colspan="1">11.07%</td>
              <td align="left" rowspan="1" colspan="1">750/13073</td>
              <td align="char" char="." rowspan="1" colspan="1">5.74%</td>
            </tr>
          </tbody>
        </table>
      </alternatives>
    </table-wrap>
    <p>For all transcription factors, except ERF115, the peaks uniquely found by Graph Peak Caller (not overlapping peaks found by MACS2) are more enriched for DNA-binding motifs than the peaks uniquely found by MACS2. In aggregate, the ratios of motif-matches of the uniquely found peaks are 6.33% for Graph Peak Caller and 5.74% for MACS2, yielding a <italic>z</italic>-value for the difference of 2.08 and a <italic>p</italic>-value of 1.9% using a one-sided <italic>z</italic>-test for difference in population proportions [<xref rid="pcbi.1006731.ref011" ref-type="bibr">11</xref>]. For the peaks found by both peak callers, Graph Peak Caller has a few more peaks with with motif match, but the difference is not statistically significant (<italic>p</italic> = 0.42). <xref ref-type="fig" rid="pcbi.1006731.g004">Fig 4</xref> shows one of the cases on chromosome 1 where Graph Peak Caller detects a peak that is not detected by MACS2, due to that the input reads are aligned against an indel that is not part of the linear reference genome.</p>
    <fig id="pcbi.1006731.g004" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1006731.g004</object-id>
      <label>Fig 4</label>
      <caption>
        <title>Example of part of a peak detected by Graph Peak Caller and not by MACS2.</title>
        <p>Showing part of the graph-based reference genome for <italic>A. thaliana</italic> on chromosome 1, containing two SNPs (black/blue) and an indel (red) that are not part of the linear reference genome (blue). From the raw ChIP-seq data for the ERF115 transcription factor (NCBI SRA SRR931836) two reads (shown at the top) align perfectly to the graph-based reference genome and Graph Peak Caller is able to detect a peak in this area. Mapping to the linear reference genome does not give sufficiently high mapping score, and so the peak is missed by MACS2.</p>
      </caption>
      <graphic xlink:href="pcbi.1006731.g004"/>
    </fig>
    <p>The peaks found uniquely by Graph Peak Caller have more than twice the number of basepairs not part of the linear reference genome, compared to the peaks found by Graph Peak Caller that also have been found by MACS2 (<xref ref-type="supplementary-material" rid="pcbi.1006731.s002">S2 Table</xref>). <xref ref-type="fig" rid="pcbi.1006731.g005">Fig 5</xref> shows the proportion of peaks enriched for DNA-binding motifs for the peaks that are uniquely found by each peak caller (for a similar plot including all peaks, see <xref ref-type="supplementary-material" rid="pcbi.1006731.s004">S1 Fig</xref>). As seen in the figure, Graph Peak Caller has a better correspondence between high peak scores and motif enrichment for all transcription factors, except ERF115.</p>
    <fig id="pcbi.1006731.g005" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pcbi.1006731.g005</object-id>
      <label>Fig 5</label>
      <caption>
        <title>DNA-binding motif enrichment plots.</title>
        <p>The proportion of peaks enriched for a DNA-binding motif (Y-axis) when iteratively including more peaks from the set of uniquely found peaks for each peak caller, sorted descending on score (X-axis).</p>
      </caption>
      <graphic xlink:href="pcbi.1006731.g005"/>
    </fig>
    <p>To validate that our peak caller works on other species, we repeated the experiment on similar datasets for <italic>Drosophila melanogaster</italic> and human (see <xref ref-type="supplementary-material" rid="pcbi.1006731.s005">S2 Fig</xref> and <xref ref-type="supplementary-material" rid="pcbi.1006731.s001">S1 Table</xref>). In both cases Graph Peak Caller got a higher ratio of motif-matches on uniquely found peaks, but only statistically significant for <italic>D. melanogaster</italic> (<italic>p</italic><sub>human</sub> = 24.9%, <italic>p</italic><sub>D.melanogaster</sub> = 0.42%).</p>
    <p>We also checked how MACS2 performs when using reads aligned by vg that have been projected to the linear reference genome using <italic>vg surject</italic>, in order to see how MACS2 performs when taking advantage of the improved mapping to a graph-based reference genome. Using these alignments, MACS2 performs better than when using using alignments from BWA, but is still slightly outperformed by Graph Peak Caller on motif matches (<xref ref-type="supplementary-material" rid="pcbi.1006731.s003">S3 Table</xref>).</p>
    <sec id="sec003">
      <title>Alignment bias evaluation</title>
      <p>A problem with using motif enrichment to compare the peaks detected by MACS2 and Graph Peak Caller is that the two peak callers use different sets of alignments. Thus, we checked whether vg tends to align reads to the graph reference genome that more often end up in alignments with motif match than what BWA does. We found no such tendency. In aggregate for the peaks detected on <italic>A. thaliana</italic>, we found on average 0.0208 motif matches per graph alignment, and and on average 0.0214 motif matches per linear reference genome alignment.</p>
      <p>We also checked whether the higher motif match among the peaks detected by Graph Peak Caller might be a result of peaks coming from artificially clustered alignments, something which can be the case if there are complex regions in the graph reference containing the motif. Such regions could allow for many different reads to align to the same place, resulting in high-scoring peaks with motif match. We found that 99.6% of the motif matches among the peaks detected by Graph Peak Caller are consistent with a single haplotype. For the unique peaks detected by Graph Peak Caller, 98.6% of the motif matches were consistent with a single haplotype. For each detected peak, we also checked what percentage of the reads among those aligned to the peak were aligned to one or two haplotypes (allowing for diploidy). In aggregate, we found that 55.6% of the unique peaks detected by Graph Peak Caller had all reads compatible with maximum two haplotypes. We found that the peaks having alignments from more than two haplotypes were more often enriched for motif, which might indicate that peaks coming from mismapped reads to high complexity areas inflate the motif match percentage. However, when we removed those peaks from the analysis, the ratio of motif peaks matching motif among the peaks detected by Graph Peak Caller is still significantly higher than the ratio of peaks matching motif among the peaks detected by MACS2. In addition, the peaks found by MACS2 are also more motif enriched when the vg alignments overlapping those peaks are consistent with more than two haplotypes, indicating that the correspondence between multiple haplotypes and motif enrichment is not solely attributable to mismapping of reads containing motifs to high-complexity regions. The full analysis results of motif enriched alignments and haplotypes can be found in <xref ref-type="supplementary-material" rid="pcbi.1006731.s009">S3 Appendix</xref>.</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec004">
    <title>Discussion</title>
    <p>We have presented a first peak caller for ChIP-seq data mapped to a graph-based reference genome. We have tested our method by calling peaks on a graph-based reference genome for <italic>A. thaliana</italic> and comparing the detected peaks to those found by MACS2 using a linear reference genome of the same species. In the instances where the peak callers find peaks that overlap, Graph Peak Caller is able to find peaks that are more enriched for motifs. This is likely because Graph Peak Caller can trace variants within the peaks that are not part of the linear reference genome. Even if such peaks are also found by MACS2, the specific sequence comprising the DNA-binding motif may not be part of the linear reference.</p>
    <p>Furthermore, Graph Peak Caller has a significantly higher proportion of motif-enriched peaks among its uniquely found peaks, showing that Graph Peak Caller is finding peaks enriched for motifs that MACS2 is not finding. These peaks cover more variations from the linear reference genome compared to the peaks found by both peak callers, and thus seem to be in areas where the advantages of graph-based reference genomes are more pronounced.</p>
    <p>Also, when running MACS2 with vg alignments projected to the linear reference genome, Graph Peak Caller still has a slightly higher ratio of motif matches. This is probably because even though MACS2 in this case finds many of the same peaks as Graph Peak Caller, these peaks are represented on the linear reference genome and will in some cases miss motif match occurrences that cover variants.</p>
    <p>We checked whether the higher motif enrichment among the peaks detected by Graph Peak Caller could be a result of a bias in alignments more often containing motif or alignments clustered to motif enriched areas of the graph, but we found no evidence for such biases.</p>
    <p>Interestingly, Graph Peak Caller performs worse than MACS2 on the transcription factor ERF115. The reason for this is unclear. The ERF115 experiment is different from the rest of the experiments in a number of ways. The motif for ERF115 is GC-rich, in contrast to the motifs for all the other transcription factors as well as the <italic>A. haliana</italic> genome in general, which are all AT-rich. Also, the ERF155 reads come from a <italic>TChAP</italic> experiment, while the reads from the other transcription factors come from a normal ChIP-seq experiment. The ERF115 motif is not present in the JASPAR database and was gathered from a different source than the other transcription factors. However it is unclear how these factors might influence the results for ERF115, and since we have not seen similar behaviour in any other experiment it is difficult to deduce which of the factors, if any, are responsible for the lower motif enrichment.</p>
    <p>We chose to develop Graph Peak Caller by tightly following the principles of MACS2, so we easily could validate our graph-based approach and accurately measure the benefits of doing peak calling on a graph-based reference genome rather than on a linear referencegenome. Having this as a working first approach to graph-based peak calling, it will now be natural and interesting to extend our work by drawing ideas from other peak callers or develop new peak calling principles to further improve graph-based peak calling. Also, Graph Peak Caller currently assumes no known information about the specific paths of the diploid genome of the individual that ChIP-seq data has been collected from. It would be interesting to develop a ChIP-seq pipeline where the path(s) through the reference graph are known (or estimated based on the ChIP-seq data), and compare that approach to Graph Peak Caller.</p>
    <p>There are a few challenges with a graph-based ChIP-seq approach. Mapping to graphs is still in its infancy, and has not yet reached its full potential. Also, both mapping to graph-based reference genomes as well as many of the operations required for doing peak calling, such as expanding input reads, are, in our experience, still a lot slower than existing solutions on linear reference genomes.</p>
    <p>We believe that our peak caller represents an important step towards creating a more comprehensive toolset for functional genomics on graph-based reference genomes, extending the possible applications of graph-based reference genomes and bringing the genomics community an important step closer to widespread adoption of these reference structures.</p>
    <sec id="sec005">
      <title>Conclusion</title>
      <p>We have developed Graph Peak Caller, a tool for performing peak calling from ChIP-seq reads mapped to a graph-based reference genome. Graph Peak Caller is based on the same principles as MACS2. We have validated our approach by using both Graph Peak Caller and MACS2 to call peaks using ChIP-seq datasets on <italic>A. thaliana</italic>, showing that the peaks found by Graph Peak Caller in general are more enriched for DNA-binding motifs than those found by MACS2 on a linear reference genome. Graph Peak Caller is also able to provide candidates for differentially expressed peaks, and together with <italic>vg</italic> it provides a first method for doing peak calling on graph-based reference genomes.</p>
    </sec>
  </sec>
  <sec sec-type="materials|methods" id="sec006">
    <title>Methods</title>
    <sec id="sec007">
      <title>Peak calling</title>
      <p>Our approach to graph-based peak calling is implemented in an open source Python 3 package, <italic>Graph Peak Caller</italic>. Graph Peak Caller was developed by extending the methodologies and concepts from MACS2 to directed acyclic graphs (DAGs). The MACS2 algorithm can be divided into five steps: estimating the fragment length, creating a fragment pileup by extending input reads to match the estimated fragment length, calculating a background track based on local and global average number of reads, calculation of p/q scores based on the fragment pileup and background track, and finding peaks based on thresholded scores. We have adopted each of these steps to work on DAGs. <xref ref-type="fig" rid="pcbi.1006731.g001">Fig 1</xref> illustrates the method on a graph-based reference genome, and the following describes the details of each step.</p>
      <p>Graph Peak Caller uses the linear estimation algorithm from MACS2 to estimate the fragment length <italic>f</italic> by using the linear path through the graph with the highest number of aligned reads as reference. Graph Peak Caller generates <italic>the fragment pileup</italic> by extending each read to the estimated fragment length <italic>f</italic>, and counting the number of extended reads that cover each base pair in the graph. For a single read with length <italic>r</italic>, the extension is done by including all possible paths of length <italic>f</italic> − <italic>r</italic> in the graph that start at the read’s end position, using a breadth first search. The background track is an estimate of the expected number of reads mapping to each position in the reference. This is, for a given position in the reference, estimated by measuring the amount of reads mapping in the “neighbourhood” of that position. The reads can either be the input reads or a set of control reads. On a linear reference genome, the background track is simply estimated by taking the average pileup count in a local window around each base pair. This is less trivial to do on a graph-based reference genome, since the concept of neighborhood is not as well defined. We solve this problem by projecting the graph onto a single linear path where parallel paths are projected to the same position on the linear path. This allows us to perform background track estimation much the same way as MACS2 does, using a linear reference, and then projecting the resulting track back to the graph again. If control reads are used to generate the background track, the background track is scaled with the ratio of control reads to input reads.</p>
      <p>The fragment pileup and background track are then treated as counts and rates in Poisson distributions, and p-values are computed for each position for the observed <italic>count</italic>, given the corresponding <italic>rate</italic>. Since one test is performed for each position in the graph, we compute q-values (adjusted p-values) to control the false discovery rate. The q-values are thresholded at a user specified threshold, yielding a binary track of potential binding regions.</p>
      <p>Graph Peak Caller then removes small gaps (similarly to MACS2) between these potential binding regions. On a graph, this is done by joining regions that are connected by a path shorter than the read length. If a gap consists of several paths, all paths of length shorter than the read length are included in the joined region. Then, the resulting regions are grouped into connected subgraphs, representing areas of potential binding events. The final peaks are selected by finding the path through each subgraph that has the highest number of input reads mapped to it. Similarly to MACS2, peaks that are shorter than the estimated fragment length are removed.</p>
      <p>For each subgraph, Graph Peak Caller can also report an “alternative” peak in addition to the main peak. This is done by using Fimo [<xref rid="pcbi.1006731.ref012" ref-type="bibr">12</xref>] to estimate the exact location within the peak subgraph that matches the binding motif, and looking for an alternative path through this area which is covered by at least one input read. Such alternative peaks can be used to infer differential binding.</p>
    </sec>
    <sec id="sec008">
      <title>Validation and testing</title>
      <p>To test our peak caller, we used <italic>vg</italic> [<xref rid="pcbi.1006731.ref006" ref-type="bibr">6</xref>] to create a whole genome <italic>Arabidopsis thaliana</italic> reference graph by using variants from the 1001 Genomes Project [<xref rid="pcbi.1006731.ref013" ref-type="bibr">13</xref>]. We selected all transcription factors listed in the transcription factor database of <italic>Expresso</italic> [<xref rid="pcbi.1006731.ref014" ref-type="bibr">14</xref>] that also had a motif in the <italic>Jaspar</italic> database of transcription factor binding profiles [<xref rid="pcbi.1006731.ref015" ref-type="bibr">15</xref>], resulting in a set of 5 transcription factors: ERF115, SEP3, AP1, SOC1, and PI. (Two transcription factors, SVP and ATAF1, were omitted due to invalid fastq files. AP2 and AP3 were omitted based on their close relatedness to AP1. Also, PIF3 was omitted since neither the detected binding events by Graph Peak Caller nor MACS2 had any association with the motif we found in the Jaspar database). Raw ChiP-seq reads were downloaded from the NCBI Sequence Read Archive (SRA) (SRA accession numbers in <xref ref-type="supplementary-material" rid="pcbi.1006731.s007">S1 Appendix</xref>) and trimmed using <italic>Trim Galore!</italic> v0.4.4 [<xref rid="pcbi.1006731.ref016" ref-type="bibr">16</xref>] (default parameters). Reads were mapped both to our graph-based reference genome using <italic>vg</italic> and to the <italic>Tair10</italic> [<xref rid="pcbi.1006731.ref010" ref-type="bibr">10</xref>] reference genome using <italic>BWA</italic> v0.7.12 (<monospace>bwa aln</monospace> followed by <monospace>bwa samsse</monospace>, default parameters). In the linear case we filtered out low-quality alignments using <italic>SAMtools</italic> v0.1.19 [<xref rid="pcbi.1006731.ref017" ref-type="bibr">17</xref>] with the command <monospace>samtools view -F 1804 -q 37</monospace>, and for the graph alignments we used <monospace>vg filter -q 37</monospace>. <italic>MACS2</italic> v2.1.0 was used to call peaks on the linear reference genome, using default parameters. We created DNA-binding motif enrichment plots (<xref ref-type="fig" rid="pcbi.1006731.g005">Fig 5</xref>) for each set of detected peaks (URLs to the motif models that were used are in <xref ref-type="supplementary-material" rid="pcbi.1006731.s007">S1 Appendix</xref>). We have created a Docker repository with the <italic>A. thaliana</italic> graph-based reference genome, Graph Peak Caller, <italic>vg</italic> and all other software and scripts used to generate the results in this article. A simple guide on how to re-run the experiments can be found in the wiki in the Github repository for Graph Peak Caller.</p>
      <p>To investigate how MACS2 performed when using vg alignments projected to the linear reference genome, we projected each vg alignment by finding a corresponding start and end position for the alignment on the linear reference genome. Given a start or end position on the graph, the new corresponding position on the linear reference genome was found by finding the shortest distance in the graph going from the original position backwards through the graph to a node shared with the linear reference genome, and then going this distance forward through the graph by following only nodes shared by the linear reference genome.</p>
      <p>The analysis of motif enrichment alignments was performed by extracting the sequences from the alignments to the linear and graph-based reference genomes. We extracted the sequences from the linear alignments by first using Bedtools version 2.26.0 to convert the alignments from BAM to BED format by running <italic>bamtools bamtobed</italic> (default parameters), and then running <italic>bedtools getfasta</italic> (default parameters) on the BED files. We extracted sequences from the graph alignments by running <italic>graph_peak_caller vg_json_alignments_to_fasta</italic> using graphs created by <italic>graph_peak_caller create_ob_graph</italic>. We then ran Fimo with default parameters using these sequences as input.</p>
      <p>The haplotype analysis was performed by finding all alignments overlapping a peak, and finding which variants each alignment contained, then finding the haplotypes from the VCF file that contained each variant. An alignment was decided to be compatible with a haplotype if all the variants included in the alignment were present in the haplotype. A set of alignments was decided to be compatible with two haplotypes if we could find two haplotypes in the vcf such that all the alignments in the set were compatible with at least one of them.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="sec009">
    <title>Supporting information</title>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s001">
      <label>S1 Table</label>
      <caption>
        <title>Overview of peaks detected on human and <italic>D. melanogaster</italic>.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s001.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s002">
      <label>S2 Table</label>
      <caption>
        <title>Average number of base pairs not part of linear reference genome.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s002.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s003">
      <label>S3 Table</label>
      <caption>
        <title>Overview of peaks found on <italic>A. thaliana</italic> when MACS2 is using vg alignments projected to the linear reference genome.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s003.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s004">
      <label>S1 Fig</label>
      <caption>
        <title>DNA-binding motif enrichment plots (as <xref ref-type="fig" rid="pcbi.1006731.g005">Fig 5</xref>) for all peaks detected on <italic>A. thaliana</italic>.</title>
        <p>Contrary to <xref ref-type="fig" rid="pcbi.1006731.g005">Fig 5</xref>, these plots include all peaks found by both peak callers.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s004.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s005">
      <label>S2 Fig</label>
      <caption>
        <title>DNA-binding motif enrichment plots (as <xref ref-type="fig" rid="pcbi.1006731.g005">Fig 5</xref>) for all peaks detected on <italic>D. melanogaster</italic> and human.</title>
        <p>Left plots are proportion of peaks matching motif when all peaks are included. Right plots are proportion of peaks matching motif when only unique peaks found by each peak caller are included.</p>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s005.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s006">
      <label>S3 Fig</label>
      <caption>
        <title>Diagram showing peaks found on <italic>D. melanogaster</italic> and human.</title>
        <p>(TIF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s006.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s007">
      <label>S1 Appendix</label>
      <caption>
        <title>URLs to motifs and accession numbers to data used in experiments.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s007.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s008">
      <label>S2 Appendix</label>
      <caption>
        <title>Reads and alignments behind <xref ref-type="fig" rid="pcbi.1006731.g003">Fig 3</xref>.</title>
        <p>List of fastq IDs and resulting alignment sequences intersecting with the binding site shown in <xref ref-type="fig" rid="pcbi.1006731.g003">Fig 3</xref>, showing that all of these appear in the same haplotype.</p>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s008.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pcbi.1006731.s009">
      <label>S3 Appendix</label>
      <caption>
        <title>Details of haplotype analysis.</title>
        <p>(PDF)</p>
      </caption>
      <media xlink:href="pcbi.1006731.s009.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>The sequence data used for creating the <italic>Arabidopsis thaliana</italic> reference graph were produced by the Weigel laboratory at the Max Planck Institute for Developmental Biology.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pcbi.1006731.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Zhang</surname><given-names>Y</given-names></name>, <name><surname>Liu</surname><given-names>T</given-names></name>, <name><surname>Meyer</surname><given-names>CA</given-names></name>, <name><surname>Eeckhoute</surname><given-names>J</given-names></name>, <name><surname>Johnson</surname><given-names>DS</given-names></name>, <name><surname>Bernstein</surname><given-names>BE</given-names></name>, <name><surname>Nusbaum</surname><given-names>C</given-names></name>, <name><surname>Myers</surname><given-names>RM</given-names></name>, <name><surname>Brown</surname><given-names>M</given-names></name>, <name><surname>Li</surname><given-names>W</given-names></name>, <name><surname>Liu</surname><given-names>XS</given-names></name>. <article-title>Model-based Analysis of ChIP-Seq (MACS)</article-title>. <source>Genome Biology</source>. <year>2008</year><month>11</month>;<volume>9</volume>(<issue>9</issue>):<fpage>R137</fpage><pub-id pub-id-type="doi">10.1186/gb-2008-9-9-r137</pub-id><?supplied-pmid 18798982?><pub-id pub-id-type="pmid">18798982</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Kharchenko</surname><given-names>PV</given-names></name>, <name><surname>Tolstorukov</surname><given-names>MY</given-names></name>, <name><surname>Park</surname><given-names>PJ</given-names></name>. <article-title>Design and Analysis of ChIP-seq Experiments for DNA-binding Proteins</article-title>. <source>Nature Biotechnology</source>. <year>2008</year><month>12</month>;<volume>26</volume>(<issue>12</issue>):<fpage>1351</fpage><pub-id pub-id-type="doi">10.1038/nbt.1508</pub-id><?supplied-pmid 19029915?><pub-id pub-id-type="pmid">19029915</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Wilbanks</surname><given-names>EG</given-names></name>, <name><surname>Facciotti</surname><given-names>MT</given-names></name>. <article-title>Evaluation of Algorithm Performance in ChIP-seq Peak Detection</article-title>. <source>PloS One</source>. <year>2010</year><month>7</month><day>8</day>;<volume>5</volume>(<issue>7</issue>):<fpage>e11471</fpage><pub-id pub-id-type="doi">10.1371/journal.pone.0011471</pub-id><?supplied-pmid 20628599?><pub-id pub-id-type="pmid">20628599</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Paten</surname><given-names>B</given-names></name>, <name><surname>Novak</surname><given-names>AM</given-names></name>, <name><surname>Eizenga</surname><given-names>JM</given-names></name>, <name><surname>Garrison</surname><given-names>E</given-names></name>. <article-title>Genome Graphs and the Evolution of Genome Inference</article-title>. <source>Genome Research</source>. <year>2017</year><month>5</month><day>1</day>;<volume>27</volume>(<issue>5</issue>):<fpage>665</fpage>–<lpage>76</lpage>. <pub-id pub-id-type="doi">10.1101/gr.214155.116</pub-id><?supplied-pmid 28360232?><pub-id pub-id-type="pmid">28360232</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref005">
      <label>5</label>
      <mixed-citation publication-type="other">Novak AM, Hickey G, Garrison E, Blum S, Connelly A, Dilthey A, Eizenga J, Elmohamed MS, Guthrie S, Kahles A, Keenan S. Genome Graphs. bioRxiv. 2017 Jan 1:101378.</mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref006">
      <label>6</label>
      <mixed-citation publication-type="other">Garrison E, Sirén J, Novak AM, Hickey G, Eizenga JM, Dawson ET, Jones W, Lin MF, Paten B, Durbin R. Sequence Variation aware Genome References and Read Mapping with the Variation Graph Toolkit. bioRxiv. 2017 Jan 1:234856.</mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref007">
      <label>7</label>
      <mixed-citation publication-type="other">Li H. Aligning Sequence Reads, clone Sequences and Assembly Contigs with BWA-MEM. arXiv preprint arXiv:1303.3997. 2013 Mar 16.</mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Langmead</surname><given-names>B</given-names></name>, <name><surname>Salzberg</surname><given-names>SL</given-names></name>. <article-title>Fast Gapped-read Alignment with Bowtie 2</article-title>. <source>Nature Methods</source>. <year>2012</year><month>4</month>;<volume>9</volume>(<issue>4</issue>):<fpage>357</fpage><pub-id pub-id-type="doi">10.1038/nmeth.1923</pub-id><?supplied-pmid 22388286?><pub-id pub-id-type="pmid">22388286</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Rand</surname><given-names>KD</given-names></name>, <name><surname>Grytten</surname><given-names>I</given-names></name>, <name><surname>Nederbragt</surname><given-names>AJ</given-names></name>, <name><surname>Storvik</surname><given-names>GO</given-names></name>, <name><surname>Glad</surname><given-names>IK</given-names></name>, <name><surname>Sandve</surname><given-names>GK</given-names></name>. <article-title>Coordinates and Intervals in Graph-based Reference Genomes</article-title>. <source>BMC Bioinformatics</source>. <year>2017</year><month>12</month>;<volume>18</volume>(<issue>1</issue>):<fpage>263</fpage><pub-id pub-id-type="doi">10.1186/s12859-017-1678-9</pub-id><?supplied-pmid 28521770?><pub-id pub-id-type="pmid">28521770</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal">Arabidopsis Genome Initiative. <article-title>Analysis of the Genome Sequence of the flowering Plant Arabidopsis thaliana</article-title>. <source>Nature</source>. <year>2000</year>
<month>12</month>;<volume>408</volume>(<issue>6814</issue>):<fpage>796</fpage>
<pub-id pub-id-type="doi">10.1038/35048692</pub-id>
<?supplied-pmid 11130711?><pub-id pub-id-type="pmid">11130711</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref011">
      <label>11</label>
      <mixed-citation publication-type="book"><name><surname>Devore</surname><given-names>JL</given-names></name>, <name><surname>Berk</surname><given-names>KN</given-names></name>. <source>Modern Mathematical Statistics with Applications</source>. <edition>2nd ed</edition><publisher-loc>New York</publisher-loc>: <publisher-name>Springer-Verlag</publisher-name>; <year>2012</year> p. <fpage>519</fpage>–<lpage>521</lpage></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Grant</surname><given-names>CE</given-names></name>, <name><surname>Bailey</surname><given-names>TL</given-names></name>, <name><surname>Noble</surname><given-names>WS</given-names></name>. <article-title>FIMO: Scanning for Occurrences of a given Motif</article-title>. <source>Bioinformatics</source>. <year>2011</year><month>2</month><day>16</day>;<volume>27</volume>(<issue>7</issue>):<fpage>1017</fpage>–<lpage>8</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btr064</pub-id><?supplied-pmid 21330290?><pub-id pub-id-type="pmid">21330290</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><collab>1000 Genomes Project Consortium</collab>. <article-title>A global Reference for Human genetic Variation</article-title>. <source>Nature</source>. <year>2015</year><month>10</month>;<volume>526</volume>(<issue>7571</issue>):<fpage>68</fpage><pub-id pub-id-type="doi">10.1038/nature15393</pub-id><?supplied-pmid 26432245?><pub-id pub-id-type="pmid">26432245</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Aghamirzaie</surname><given-names>D</given-names></name>, <name><surname>Velmurugan</surname><given-names>KR</given-names></name>, <name><surname>Wu</surname><given-names>S</given-names></name>, <name><surname>Altarawy</surname><given-names>D</given-names></name>, <name><surname>Heath</surname><given-names>LS</given-names></name>, <name><surname>Grene</surname><given-names>R</given-names></name>. <article-title>Expresso: A Database and Web Server for exploring the Interaction of Transcription Factors and their Target Genes in Arabidopsis thaliana using ChIP-Seq peak Data</article-title>. <source>F1000Research</source>. <year>2017</year>;<volume>6</volume><pub-id pub-id-type="doi">10.12688/f1000research.10041.1</pub-id><?supplied-pmid 28529706?><pub-id pub-id-type="pmid">28529706</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Sandelin</surname><given-names>A</given-names></name>, <name><surname>Alkema</surname><given-names>W</given-names></name>, <name><surname>Engström</surname><given-names>P</given-names></name>, <name><surname>Wasserman</surname><given-names>WW</given-names></name>, <name><surname>Lenhard</surname><given-names>B</given-names></name>. <article-title>JASPAR: an open-access database for eukaryotic transcription factor binding profiles</article-title>. <source>Nucleic acids research</source>. <year>2004</year><month>1</month><day>1</day>;<volume>32</volume>:<fpage>D91</fpage>–<lpage>4</lpage>. <pub-id pub-id-type="doi">10.1093/nar/gkh012</pub-id><?supplied-pmid 14681366?><pub-id pub-id-type="pmid">14681366</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref016">
      <label>16</label>
      <mixed-citation publication-type="other">Krueger F. Trim galore. A Wrapper Tool around Cutadapt and FastQC to consistently apply Quality and Adapter trimming to FastQ files. 2015.</mixed-citation>
    </ref>
    <ref id="pcbi.1006731.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>H</given-names></name>, <name><surname>Handsaker</surname><given-names>B</given-names></name>, <name><surname>Wysoker</surname><given-names>A</given-names></name>, <name><surname>Fennell</surname><given-names>T</given-names></name>, <name><surname>Ruan</surname><given-names>J</given-names></name>, <name><surname>Homer</surname><given-names>N</given-names></name>, <name><surname>Marth</surname><given-names>G</given-names></name>, <name><surname>Abecasis</surname><given-names>G</given-names></name>, <name><surname>Durbin</surname><given-names>R</given-names></name>. <article-title>The Sequence Alignment/Map Format and SAMtools</article-title>. <source>Bioinformatics</source>. <year>2009</year><month>8</month><day>15</day>;<volume>25</volume>(<issue>16</issue>):<fpage>2078</fpage>–<lpage>9</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btp352</pub-id><?supplied-pmid 19505943?><pub-id pub-id-type="pmid">19505943</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
