<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinform Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinform Adv</journal-id>
    <journal-id journal-id-type="publisher-id">bioadv</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2635-0041</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9945056</article-id>
    <article-id pub-id-type="doi">10.1093/bioadv/vbad019</article-id>
    <article-id pub-id-type="publisher-id">vbad019</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Application Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Software</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>iSC.MEB: an R package for multi-sample spatial clustering analysis of spatial transcriptomics data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5891-8912</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Xiao</given-names>
        </name>
        <aff><institution>Centre for Quantitative Medicine Health Services &amp; Systems Research, Duke-NUS Medical School</institution>, 169857 Singapore, <country country="SG">Singapore</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-1259-6564</contrib-id>
        <name>
          <surname>Liu</surname>
          <given-names>Wei</given-names>
        </name>
        <aff><institution>Centre for Quantitative Medicine Health Services &amp; Systems Research, Duke-NUS Medical School</institution>, 169857 Singapore, <country country="SG">Singapore</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Song</surname>
          <given-names>Fangda</given-names>
        </name>
        <aff><institution>School of Data Science, The Chinese University of Hong Kong-Shenzhen</institution>, Shenzhen 518172, Guangdong, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-5707-2078</contrib-id>
        <name>
          <surname>Liu</surname>
          <given-names>Jin</given-names>
        </name>
        <aff><institution>Centre for Quantitative Medicine Health Services &amp; Systems Research, Duke-NUS Medical School</institution>, 169857 Singapore, <country country="SG">Singapore</country></aff>
        <aff><institution>School of Data Science, The Chinese University of Hong Kong-Shenzhen</institution>, Shenzhen 518172, Guangdong, <country country="CN">China</country></aff>
        <xref rid="vbad019-cor1" ref-type="corresp"/>
        <!--liujin@cuhk.edu.cn-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Zhang</surname>
          <given-names>Zhang</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="vbad019-cor1">To whom correspondence should be addressed. <email>liujin@cuhk.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-02-17">
      <day>17</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <volume>3</volume>
    <issue>1</issue>
    <elocation-id>vbad019</elocation-id>
    <history>
      <date date-type="received">
        <day>01</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>24</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>29</day>
        <month>1</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>16</day>
        <month>2</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>22</day>
        <month>2</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="vbad019.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>Emerging spatially resolved transcriptomics (SRT) technologies are powerful in measuring gene expression profiles while retaining tissue spatial localization information and typically provide data from multiple tissue sections. We have previously developed the tool SC.MEB—an empirical Bayes approach for SRT data analysis using a hidden Markov random field. Here, we introduce an extension to SC.MEB, denoted as integrated spatial clustering with hidden Markov random field using empirical Bayes (iSC.MEB) that permits the users to simultaneously estimate the batch effect and perform spatial clustering for low-dimensional representations of multiple SRT datasets. We demonstrate that iSC.MEB can provide accurate cell/domain detection results using two SRT datasets.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>iSC.MEB is implemented in an open-source R package, and source code is freely available at <ext-link xlink:href="https://github.com/XiaoZhangryy/iSC.MEB" ext-link-type="uri">https://github.com/XiaoZhangryy/iSC.MEB</ext-link>. Documentation and vignettes are provided on our package website (<ext-link xlink:href="https://xiaozhangryy.github.io/iSC.MEB/index.html" ext-link-type="uri">https://xiaozhangryy.github.io/iSC.MEB/index.html</ext-link>).</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics Advances</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Ministry of Education</institution>
            <institution-id institution-id-type="DOI">10.13039/100009122</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Recently developed spatially resolved transcriptomics (SRT) technologies enable researchers to simultaneously characterize the gene expression profiles and their physical locations with a growing spatial resolution, providing extraordinary opportunities for researchers to investigate the spatial landscape of transcriptomic profiles within solid tissues. Among various analyses and applications using SRT datasets, identifying the cell/domain clusters is an essential analytic step. Several methods have been developed to make use of spatial information to enhance cell/domain type clustering, including a fully Bayesian statistical method, BayesSpace (<xref rid="vbad019-B15" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic>, 2021</xref>), a graph convolutional network approach, SpaGCN (<xref rid="vbad019-B7" ref-type="bibr">Hu <italic toggle="yes">et al.</italic>, 2021</xref>), and an empirical Bayes method using hidden Markov random fields, SC-MEB (<xref rid="vbad019-B14" ref-type="bibr">Yang <italic toggle="yes">et al.</italic>, 2021</xref>). Those methods were primarily designed to perform spatial clustering for SRT datasets from a single slide. When SRT datasets from multiple slides are available, it is desired that different spatial clustering methods are able to remove unwanted variations from batches. Although a recently developed method, BASS (<xref rid="vbad019-B9" ref-type="bibr">Li and Zhou, 2022</xref>), enables multi-sample analysis for SRT data using embeddings aligned from Harmony (<xref rid="vbad019-B8" ref-type="bibr">Korsunsky <italic toggle="yes">et al.</italic>, 2019</xref>), Harmony itself performs data integration in embeddings without any consideration of spatial information.</p>
    <p>To perform the clustering analysis for multiple SRT datasets, we develop iSC.MEB, a flexible, computationally inexpensive, multi-threaded and user-friendly R package that supports multiple SRT datasets integration clustering in a unified step. iSC.MEB was implemented via an efficient expectation (E)–maximization (M) algorithm based on an iterative conditional mode, and selected the number of clusters by modified Bayesian information criterion (<xref rid="vbad019-B13" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2009</xref>). The flexibility of iSC.MEB in modeling spatial dependency is achieved by accounting for local microenvironments of neighboring spots through a CAR model (<xref rid="vbad019-B2" ref-type="bibr">Besag, 1974</xref>) and adjusting the spatial smoothness adaptively. The cell/domain labels and the slide-specific embeddings provided by iSC.MEB can facilitate many downstream analyses.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <sec>
      <title>2.1 Approach</title>
      <p>The iSC.MEB method is designed for integrative clustering analysis on the low-dimensional representations of multiple spatial transcriptomics datasets. A workflow outlining the general steps of the iSC.MEB is provided in <xref rid="vbad019-F1" ref-type="fig">Figure 1</xref>. First, we perform principal component analysis (PCA) on the combined log-transformed expression matrix to obtain the top principal components (PCs). Second, by taking the top PCs as input, we perform the integrative spatial clustering analysis using iSC-MEB that produces the soft cluster assignment as output. Finally, we can perform downstream analysis using the clustering result from the second step.</p>
      <fig position="float" id="vbad019-F1">
        <label>Fig. 1.</label>
        <caption>
          <p>Schematic overview of iSC.MEB. iSC.MEB is a unified hidden MRF model that simultaneously estimates aligned embeddings and cluster labels with consideration of spatial smoothness in both the cluster label and batch effects</p>
        </caption>
        <graphic xlink:href="vbad019f1" position="float"/>
      </fig>
      <p>In iSC.MEB, for the spot <italic toggle="yes">i</italic> comes from tissue <italic toggle="yes">t</italic>, its low-dimensional representation <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is considered to consist of two parts, the cluster-related embedding <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and the batch-related embedding <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. We model the cluster-related part by a two-layer hierarchical probabilistic model. In brief, the first layer specific the conditional distribution of <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> given its unknown label <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. And in the second layer, a Potts model (<xref rid="vbad019-B4" ref-type="bibr">Cuadra <italic toggle="yes">et al.</italic>, 2005</xref>) is adopted to promote spatial smoothness in the cluster label space. In addition, a conditional autoregressive (CAR) model (<xref rid="vbad019-B2" ref-type="bibr">Besag, 1974</xref>) is imposed on the batch-related part to capture the spatial dependence induced by neighboring microenvironments. Please refer to <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref> for details.</p>
      <p>To make the computation tractable, iSC.MEB updates parameter through an ICM-EM algorithm (<xref rid="vbad019-B4" ref-type="bibr">Cuadra <italic toggle="yes">et al.</italic>, 2005</xref>). Assumes the number of clusters, <italic toggle="yes">K</italic>, is known. In the ICM step, we alternate between estimate label <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> by maximizing its posterior given <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold">u</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and estimate the batch-related embedding <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> by maximizing its posterior given <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. Then, in the E step, we derive the evidence lower bound (ELBO) with respect to the pseudo-observed log-likelihood. By taking partial derivatives of the ELBO, we obtain the updated equations in the M step. The smoothness parameter <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is updated via a grid search strategy since there is no closed-form solution for it. The ICM-EM algorithm iterates the ICM step and M step until convergence, resulting in parameter estimate and corresponding log-likelihood. Once the log-likelihoods for a sequence of K are obtained, MBIC is adopted to choose the optimal number of clusters. Further details on the ICM-EM algorithm and the MBIC are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Implementation</title>
      <p>iSC.MEB contains four main functions: ‘CreateISCMEBObject’, ‘runPCA’, ‘CreateNeighbors’ and ‘iSCMEB’. In detail, the user first uses ‘CreateISCMEBObject’ that takes as input a list of Seurat objects (<xref rid="vbad019-B6" ref-type="bibr">Hao <italic toggle="yes">et al.</italic>, 2021</xref>) to perform the preprocessing steps and creates an object that contains all the data needed for subsequent modeling. By interfacing with common data formats and combining tedious preprocessing steps into a single function, our package facilitates integrative clustering analysis for users. ‘runPCA’ generates top PCs with three optional dimension reduction methods: the classical PCA, the approximate PCA (<xref rid="vbad019-B1" ref-type="bibr">Baglama and Reichel, 2005</xref>) and the weighted PCA (<xref rid="vbad019-B5" ref-type="bibr">Hong <italic toggle="yes">et al.</italic>, 2018</xref>). The default method is the approximate PCA to speed up the initial value calculation. ‘CreateNeighbors’ provides a platform-free way to generate an adjacency matrix by position information, which supports the application of our approach to emerging new SRT data. The model is trained in ‘iSCMEB’, with computational core written in C to improve computational efficiency. In addition, to make full use of multi-core computing resources, a parallel strategy is adopted to fit the model with a sequence of the number of clusters, <italic toggle="yes">K</italic>. Finally, our package also provides functions for downstream analysis, such as visualization of clusters and embeddings and combined differential expression analysis.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>We applied iSC.MEB to two real datasets and made comparisons with existing methods of clustering (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3</xref>), including (i) BASS (<xref rid="vbad019-B9" ref-type="bibr">Li and Zhou, 2022</xref>), (ii) SC.MEB (<xref rid="vbad019-B14" ref-type="bibr">Yang <italic toggle="yes">et al.</italic>, 2021</xref>), (iii) BayesSpace (<xref rid="vbad019-B15" ref-type="bibr">Zhao <italic toggle="yes">et al.</italic>, 2021</xref>), (iv) SpaGCN (<xref rid="vbad019-B7" ref-type="bibr">Hu <italic toggle="yes">et al.</italic>, 2021</xref>) and (v) Louvain (<xref rid="vbad019-B3" ref-type="bibr">Blondel <italic toggle="yes">et al.</italic>, 2008</xref>). Among these methods, BASS relies on Harmony to remove batch effects from multiple slides and applies spatial clustering on the aligned embeddings from Harmony, while other methods are used for clustering on a single slide. The manual annotations provided by original studies were taken as ground truth, which allowed us to evaluate the performance of both the accuracy of spatial domain detection and data integration.</p>
    <p>The dorsolateral prefrontal cortex (DLPFC) dataset (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.1</xref>) contains the spatial topography of gene expression from 12 human postmortem DLPFC tissue sections generated by using the 10× Genomics Visium platform (<xref rid="vbad019-B12" ref-type="bibr">Maynard <italic toggle="yes">et al.</italic>, 2021</xref>). The expression count matrix contained 47 681 spatial locations, with 33 538 genes for each spot. <xref rid="vbad019-F2" ref-type="fig">Figure 2</xref> shows the adjusted rand index and normalized mutual information (<xref rid="vbad019-B11" ref-type="bibr">Luecken <italic toggle="yes">et al.</italic>, 2022</xref>), abbreviated as ARI and NMI, respectively, for 12 DLPFC samples. iSC.MEB provided a higher median of ARI and NMI values than all other methods, indicating its superior clustering performance. And in general, multi-sample analysis methods outperformed single-slide analysis methods, demonstrating the benefits of multiple datasets integration to improve clustering accuracy. As shown in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S1</xref>, the speed of iSC.MEB was significantly more efficient than that of BASS and BayesSpace, and comparable to SC.MEB. Both BASS and BayesSpace were implemented by MCMC algorithm, and their high computational cost may limit their application. Louvain and SpaGCN were faster, but their clustering accuracy was inferior. In addition, the integrated ARI and integrated NMI were <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0.48</mml:mn><mml:mo>,</mml:mo><mml:mn>0.57</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for iSC.MEB, showing that iSC.MEB achieves better data integration performance than BASS (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>).</p>
    <fig position="float" id="vbad019-F2">
      <label>Fig. 2.</label>
      <caption>
        <p>Summary of clustering accuracy for DLPFC dataset. ARI and NMI are evaluated by comparing manual annotations against cluster labels from iSC.MEB and benchmarks for each tissue section</p>
      </caption>
      <graphic xlink:href="vbad019f2" position="float"/>
    </fig>
    <p>The embryo dataset (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.2</xref>) contains the high-resolution spatial map from six mouse embryo tissue sections generated by a modified version of the seqFISH (sequential fluorescence <italic toggle="yes">in situ</italic> hybridization) method which allows highly effective cell segmentation (<xref rid="vbad019-B10" ref-type="bibr">Lohoff <italic toggle="yes">et al.</italic>, 2021</xref>). The expression count matrix contained 387 selected target genes for each mRNA spot, and after cell-level quality control, we obtain a total of 51 800 spatial locations. Since the annotation procedure for these embryo datasets was based on Louvain network clustering, we did not compare its clustering performance using Louvain. The ARI values and NMI scores obtained using different methods are shown in <xref rid="vbad019-F3" ref-type="fig">Figure 3</xref>. Clearly, iSC.MEB provided the highest median of ARI and NMI values among all benchmarks. The integrated ARI and integrated NMI for iSC.MEB were <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0.52</mml:mn><mml:mo>,</mml:mo><mml:mn>0.69</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, while those for BASS were <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0.45</mml:mn><mml:mo>,</mml:mo><mml:mn>0.66</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The runtime results demonstrated similar patterns to those obtained on DLPFC dataset (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>).</p>
    <fig position="float" id="vbad019-F3">
      <label>Fig. 3.</label>
      <caption>
        <p>Summary of clustering accuracy for seqFISH dataset. ARI and NMI are evaluated by comparing provided annotations against cluster labels from iSC.MEB and benchmarks for each tissue section</p>
      </caption>
      <graphic xlink:href="vbad019f3" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>We presented an extension to the existing method SC.MEB, denoted as iSC.MEB, which is an efficient R package for integrating low-dimension embeddings from multiple spatial transcriptomics datasets with batch effects. Compared with existing approaches on two real data analyses, iSC.MEB provides more accurate integration results. By applying iSC.MEB, the fitted cluster labels, and aligned embeddings can be applied for downstream analysis, such as trajectory analysis and visualization.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>vbad019_Supplementary_Data</label>
      <media xlink:href="vbad019_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Funding</title>
    <p>This work was supported by AcRF Tier 2 grant [MOET2EP20220-0009] from the Ministry of Education, Singapore and Duke-NUS/Khoo Bridge Funding Award (Duke-NUS-KBrFA/2020/0034).</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>All datasets used in this study are publicly available. These include the twelve human dorsolateral prefrontal cortex Visium datasets (<ext-link xlink:href="https://github.com/LieberInstitute/spatialLIBD" ext-link-type="uri">https://github.com/LieberInstitute/spatialLIBD</ext-link>) and six mouse embryo seqFISH datasets (<ext-link xlink:href="https://content.cruk.cam.ac.uk/jmlab/SpatialMouseAtlas2020/" ext-link-type="uri">https://content.cruk.cam.ac.uk/jmlab/SpatialMouseAtlas2020/</ext-link>).</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="vbad019-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baglama</surname><given-names>J.</given-names></string-name>, <string-name><surname>Reichel</surname><given-names>L.</given-names></string-name></person-group> (<year>2005</year>) <article-title>Augmented implicitly restarted Lanczos bidiagonalization methods</article-title>. <source>SIAM J. Sci. Comput</source>., <volume>27</volume>, <fpage>19</fpage>–<lpage>42</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad019-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Besag</surname><given-names>J.</given-names></string-name></person-group> (<year>1974</year>) <article-title>Spatial interaction and the statistical analysis of lattice systems</article-title>. <source>J. R. Stat. Soc. B</source>, <volume>36</volume>, <fpage>192</fpage>–<lpage>225</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad019-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blondel</surname><given-names>V.</given-names></string-name></person-group><etal>et al</etal> (<year>2008</year>) <article-title>Fast unfolding of communities in large networks</article-title>. <source>J. Stat. Mech.</source>, <volume>2008</volume>, P10008.</mixed-citation>
    </ref>
    <ref id="vbad019-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cuadra</surname><given-names>M.B.</given-names></string-name></person-group><etal>et al</etal> (<year>2005</year>) <article-title>Comparison and validation of tissue modelization and statistical classification methods in T1-weighted MR brain images</article-title>. <source>IEEE Trans. Med. Imaging</source>, <volume>24</volume>, <fpage>1548</fpage>–<lpage>1565</lpage>.<pub-id pub-id-type="pmid">16350916</pub-id></mixed-citation>
    </ref>
    <ref id="vbad019-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Hong</surname><given-names>D.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) Optimally weighted PCA for high-dimensional heteroscedastic data. arXiv, arXiv:1810.12862, preprint: not peer reviewed.</mixed-citation>
    </ref>
    <ref id="vbad019-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hao</surname><given-names>Y.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Integrated analysis of multimodal single-cell data</article-title>. <source>Cell</source>, <volume>184</volume>, <fpage>3573</fpage>–<lpage>3587</lpage>.<pub-id pub-id-type="pmid">34062119</pub-id></mixed-citation>
    </ref>
    <ref id="vbad019-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hu</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>SpaGCN: integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>. <source>Nat. Methods</source>, <volume>18</volume>, <fpage>1342</fpage>–<lpage>1351</lpage>.<pub-id pub-id-type="pmid">34711970</pub-id></mixed-citation>
    </ref>
    <ref id="vbad019-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Korsunsky</surname><given-names>I.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title>. <source>Nat. Methods</source>, <volume>16</volume>, <fpage>1289</fpage>–<lpage>1296</lpage>.<pub-id pub-id-type="pmid">31740819</pub-id></mixed-citation>
    </ref>
    <ref id="vbad019-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>Z.</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>X.</given-names></string-name></person-group> (<year>2022</year>) <article-title>BASS: multi-scale and multi-sample analysis enables accurate cell type clustering and spatial domain detection in spatial transcriptomic studies</article-title>. <source>Genome Biol</source>., <volume>23</volume>, 168.</mixed-citation>
    </ref>
    <ref id="vbad019-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lohoff</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Integration of spatial and single-cell transcriptomic data elucidates mouse organogenesis</article-title>. <source>Nat. Biotechnol</source>., <volume>40</volume>, <fpage>74</fpage>–<lpage>85</lpage>.<pub-id pub-id-type="pmid">34489600</pub-id></mixed-citation>
    </ref>
    <ref id="vbad019-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Luecken</surname><given-names>M.D.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>. <source>Nat. Methods</source>, <volume>19</volume>, <fpage>41</fpage>–<lpage>45</lpage>.<pub-id pub-id-type="pmid">34949812</pub-id></mixed-citation>
    </ref>
    <ref id="vbad019-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maynard</surname><given-names>K.R.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>. <source>Nat. Neurosci</source>., <volume>24</volume>, <fpage>425</fpage>–<lpage>436</lpage>.<pub-id pub-id-type="pmid">33558695</pub-id></mixed-citation>
    </ref>
    <ref id="vbad019-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>H.</given-names></string-name></person-group><etal>et al</etal> (<year>2009</year>) <article-title>Shrinkage tuning parameter selection with a diverging number of parameters</article-title>. <source>J. R. Stat. Soc. B</source>, <volume>71</volume>, <fpage>671</fpage>–<lpage>683</lpage>.</mixed-citation>
    </ref>
    <ref id="vbad019-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yang</surname><given-names>Y.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>SC-MEB: spatial clustering with hidden Markov random field using empirical Bayes</article-title>. <source>Brief. Bioinform</source>., <volume>23, 1</volume>.</mixed-citation>
    </ref>
    <ref id="vbad019-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhao</surname><given-names>E.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat. Biotechnol</source>., <volume>39</volume>, <fpage>1375</fpage>–<lpage>1384</lpage>.<pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
