<?all-math-mml yes?>
<?use-mml?>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName nihms2pmcx2.xsl?>
<?ConverterInfo.Version 1?>
<?origin ukpmcpa?>
<?ManuscriptPrefix new?>
<?iso-abbr Nat Biotechnol?>
<?submitter-system ukmss?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 0?>
<?submitter-authority publisher?>
<?submitter-login NPG?>
<?submitter-name Nature Publishing Group?>
<?domain wtpa?>
<?pmc-id-preallocated 7610525?>
<?properties manuscript?>
<?origin ukpmcpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">9604648</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Biotechnol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Biotechnol</journal-id>
    <journal-title-group>
      <journal-title>Nature biotechnology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1087-0156</issn>
    <issn pub-type="epub">1546-1696</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7610525</article-id>
    <article-id pub-id-type="manuscript">ems118049</article-id>
    <article-id pub-id-type="pmid">32690972</article-id>
    <article-id pub-id-type="doi">10.1038/s41587-020-0605-1</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Cell type prioritization in single-cell data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Skinnider</surname>
          <given-names>Michael A.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="author-notes" rid="FN1">*</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Squair</surname>
          <given-names>Jordan W.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
        <xref ref-type="author-notes" rid="FN1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kathe</surname>
          <given-names>Claudia</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="author-notes" rid="FN2">#</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Anderson</surname>
          <given-names>Mark A.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="author-notes" rid="FN2">#</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gautier</surname>
          <given-names>Matthieu</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="author-notes" rid="FN2">#</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Matson</surname>
          <given-names>Kaya J.E.</given-names>
        </name>
        <xref ref-type="aff" rid="A5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Milano</surname>
          <given-names>Marco</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hutson</surname>
          <given-names>Thomas H.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Barraud</surname>
          <given-names>Quentin</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Phillips</surname>
          <given-names>Aaron A.</given-names>
        </name>
        <xref ref-type="aff" rid="A6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Foster</surname>
          <given-names>Leonard J.</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>La Manno</surname>
          <given-names>Gioele</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Levine</surname>
          <given-names>Ariel J.</given-names>
        </name>
        <xref ref-type="aff" rid="A5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Courtine</surname>
          <given-names>Grégoire</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A8">8</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Brain Mind Institute, Faculty of Life Sciences, École Polytechnique Fédérale de Lausanne (EPFL), Lausanne, Switzerland</aff>
    <aff id="A2"><label>2</label>Michael Smith Laboratories, University of British Columbia, Vancouver, British Columbia, Canada</aff>
    <aff id="A3"><label>3</label>NeuroRestore, Department of Clinical Neuroscience, Lausanne University Hospital (CHUV) and University of Lausanne (UNIL), Lausanne, Switzerland</aff>
    <aff id="A4"><label>4</label>International Collaboration on Repair Discoveries (ICORD), University of British Columbia, Vancouver, British Columbia, Canada</aff>
    <aff id="A5"><label>5</label>Spinal Circuits and Plasticity Unit, National Institute of Neurological Disorders and Stroke, Bethesda, MD, USA</aff>
    <aff id="A6"><label>6</label>Departments of Physiology and Pharmacology, Clinical Neurosciences, Cardiac Sciences, Hotchkiss Brain Institute, Libin Cardiovascular Institute of Alberta, Cumming School of Medicine, University of Calgary, Alberta, Canada</aff>
    <aff id="A7"><label>7</label>Department of Biochemistry and Molecular Biology, University of British Columbia, Vancouver, British Columbia, Canada</aff>
    <aff id="A8"><label>8</label>Center for Neuroprosthetics, Faculty of Life Sciences, École Polytechnique Fédérale de Lausanne (EPFL), Lausanne, Switzerland</aff>
    <author-notes>
      <corresp id="CR1">correspondence: <email>gregoire.courtine@epfl.ch</email>, <email>michael.skinnider@msl.ubc.ca</email>, <email>jordan.squair@epfl.ch</email></corresp>
      <fn id="FN1" fn-type="equal">
        <label>*</label>
        <p id="P1">contributed equally to this work</p>
      </fn>
      <fn id="FN2" fn-type="equal">
        <label>#</label>
        <p id="P2">contributed equally to this work</p>
      </fn>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>04</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>1</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>20</day>
      <month>7</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>06</day>
      <month>4</month>
      <year>2021</year>
    </pub-date>
    <volume>39</volume>
    <issue>1</issue>
    <fpage>30</fpage>
    <lpage>34</lpage>
    <permissions>
      <ali:free_to_read xmlns:ali="http://www.niso.org/schemas/ali/1.0/"/>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/">http://www.nature.com/authors/editorial_policies/license.html#terms</ali:license_ref>
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use: <ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P3">We present Augur, a method to prioritize the cell types most responsive to biological perturbations in single-cell data. Augur employs machine-learning framework to quantify the separability of perturbed and unperturbed cells within a high-dimensional space. We validate our method on single-cell RNA-seq, chromatin accessibility, and imaging transcriptomics datasets, and show that Augur outperforms existing methods based on differential gene expression. Augur identified the neural circuits restoring locomotion in mice following spinal cord neurostimulation.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P4">Within a decade, single-cell technologies have scaled from individual cells to entire organisms<sup><xref rid="R1" ref-type="bibr">1</xref>,<xref rid="R2" ref-type="bibr">2</xref></sup>. Investigators are now able to quantify RNA and protein expression, resolve their spatial organization in complex tissues, and dissect their regulation in hundreds of thousands of cells. This exponential increase in scale is enabling a transition from atlasing of healthy tissues to delineating the cell type-specific responses to disease and experimental perturbation<sup><xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R4" ref-type="bibr">4</xref></sup>. This shift requires a parallel analytical transition, from cataloguing the marked molecular differences between cell types to resolving more subtle phenotypic alterations within cell types. Existing tools focus on identifying individual genes or proteins with statistically significant differences between conditions<sup><xref rid="R5" ref-type="bibr">5</xref></sup>. However, inferences at the level of individual analytes are ill-suited to address the broader question of which <italic>cell types</italic> are most responsive to a perturbation in the multidimensional space of single-cell data. Such prioritizations could clarify the contribution of each cell type to organismal phenotypes such as disease state, or identify cellular subpopulations that mediate the response to external stimuli such as drug treatment. Cell type prioritization could also guide downstream investigation, including the selection of experimental systems such as Cre lines or FACS gates to support causal experiments. However, investigators currently lack bespoke tools to identify cell types affected by perturbation.</p>
  <p id="P5">Here, we introduce Augur, a versatile method to prioritize cell types based on their molecular response to a biological perturbation (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). We reasoned that cell types most responsive to a perturbation should be more separable, within the multidimensional space of single-cell measurements, than less affected ones, and that the relative difficulty of this separation would provide a quantitative basis for cell type prioritization. We formalized this difficulty as a classification task, asking how accurately disease or perturbation state could be predicted from highly multidimensional single-cell measurements. For each cell type, Augur withholds a proportion of sample labels, and trains a classifier on the labeled subset. The classifier predictions are compared with the experimental labels, and cell types are prioritized based on the area under the receiver operating characteristic curve (AUC) of these predictions in cross-validation.</p>
  <p id="P6">Because the amount of available training data typically has a strong effect on classifier performance, we anticipated that the uneven relative abundances of cell types in single-cell datasets could confound cell type prioritization. In both simulated data and a compendium of 22 published scRNA-seq datasets, we found that the AUC scaled with the number of cells, as opposed to the perturbation intensity (<xref ref-type="fig" rid="F3">Extended Data Figs. 1a-b</xref> and <xref ref-type="fig" rid="F4">2a-b</xref>). To overcome this confound, Augur repeatedly draws small samples from the dataset, and reports the mean AUC across samples. We found this procedure abolished the dependence on the total number of cells (<xref ref-type="fig" rid="F1">Fig. 1b-c</xref>, <xref ref-type="fig" rid="F3">Extended Data Figs. 1c-d</xref> and <xref ref-type="fig" rid="F4">2b</xref>). Moreover, we established that Augur correctly prioritized cell types subjected to simulated perturbations of known intensities, finding the AUC increased monotonically with both the amount and magnitude of simulated differential expression (<xref ref-type="fig" rid="F1">Fig. 1d</xref> and <xref ref-type="fig" rid="F3">Extended Data Fig. 1e-f</xref>).</p>
  <p id="P7">We compared Augur to previously described approaches that have attempted to prioritize cell types based on the relative number of genes passing a statistical threshold for differential expression (DE)<sup><xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R6" ref-type="bibr">6</xref>–<xref rid="R9" ref-type="bibr">9</xref></sup>. In both simulated and experimental datasets, we found that the number of DE genes was strongly correlated with the number of cells per type (<xref ref-type="fig" rid="F3">Extended Data Figs. 1g-i</xref> and <xref ref-type="fig" rid="F4">2c</xref>), causing abundant cell types with modest transcriptional perturbations to be prioritized over rare but more strongly perturbed cell types (<xref ref-type="fig" rid="F1">Fig. 1e</xref> and <xref ref-type="fig" rid="F3">Extended Data Fig. 1j</xref>). Consequently, we found that in simulated datasets with increasingly uneven cell type proportions, the performance of DE methods declined rapidly (<xref ref-type="fig" rid="F1">Fig. 1f-g</xref> and <xref ref-type="fig" rid="F5">Extended Data Fig. 3a-b</xref>). Importantly, this decline occurred even for cell type distributions that were substantially less uneven than those observed in real scRNA-seq data (<xref ref-type="fig" rid="F5">Extended Data Fig. 3c</xref>). In contrast, Augur prioritized cell types with high accuracy regardless of cell type distributions (r ≥ 0.95; <xref ref-type="fig" rid="F1">Fig. 1f</xref>). In published datasets, we confirmed this bias led DE methods to prioritize highly abundant cell types, even when such prioritizations were biologically unlikely (<xref ref-type="fig" rid="F4">Extended Data Fig. 2d-f</xref>). For instance, DE methods identified oligodendrocytes as most strongly perturbed in Alzheimer’s disease<sup><xref rid="R10" ref-type="bibr">10</xref></sup>, likely due to their relative abundance in the brain (<xref ref-type="fig" rid="F4">Extended Data Fig. 2g-j</xref>).</p>
  <p id="P8">We next applied Augur to published scRNA-seq datasets with a quantitative measure of ground truth in order to evaluate its ability to prioritize cell types exposed to stimuli of known intensity. In homogenous cell populations, Augur detected the expected dose-response relationships in mononuclear phagocytes from four species stimulated with LPS ranging from two to six hours<sup><xref rid="R11" ref-type="bibr">11</xref></sup>, whereas DE methods yielded biologically incongruent results (<xref ref-type="fig" rid="F1">Fig. 1h-i</xref> and <xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 1a</xref>). To evaluate the performance of Augur in a complex tissue, we analyzed a scRNA-seq dataset of PBMCs stimulated with interferon<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, comparing cell type prioritizations to an independent microarray experiment on FACS-purified cells<sup><xref rid="R12" ref-type="bibr">12</xref></sup>. We observed an almost perfect correspondence between Augur and the number of DE genes in this FACS gold standard, whereas single-cell DE methods were uncorrelated with the gold standard (<xref ref-type="fig" rid="F1">Fig. 1j-k</xref> and <xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 1b</xref>).</p>
  <p id="P9">To evaluate the reproducibility of cell type prioritization, we applied Augur to two independent scRNA-seq studies comparing individuals with Alzheimer’s disease and healthy controls<sup><xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R10" ref-type="bibr">10</xref></sup>. Augur produced nearly identical prioritizations, identifying the most profound transcriptional perturbations in neurons and endothelial cells (<xref ref-type="fig" rid="F1">Fig. 1l</xref>). Similarly, we asked whether Augur could prioritize cell types from identical experimental perturbations, but obtained with orthogonal single-cell technologies. We applied Augur to scRNA-seq<sup><xref rid="R7" ref-type="bibr">7</xref></sup> and single-cell imaging transcriptomics (STARmap)<sup><xref rid="R13" ref-type="bibr">13</xref></sup> datasets from the visual cortex after exposure to light. Despite technical differences between the datasets, Augur consistently prioritized excitatory neurons, and even ranked subpopulations of excitatory neurons from specific cortical layers in identical order (<xref ref-type="fig" rid="F5">Extended Data Fig. 3d</xref>). Finally, we applied Augur to single-cell ATAC-seq data from bone marrow-derived cells stimulated with LPS<sup><xref rid="R14" ref-type="bibr">14</xref></sup>, and found that Augur cell type prioritizations mirrored a gold standard from bulk RNA-seq of FACS-sorted cells (<xref ref-type="fig" rid="F1">Fig. 1m</xref>)<sup><xref rid="R15" ref-type="bibr">15</xref></sup>.</p>
  <p id="P10">Augur can flexibly incorporate continuous or multi-class sample labels in addition to conventional treatment versus control designs. We applied Augur to prioritize cell types of the prefrontal cortex based on quantitative measures of amyloid burden, neuritic plaques, and neurofibrillary tangles in individuals with Alzheimer’s disease<sup><xref rid="R3" ref-type="bibr">3</xref></sup>. Cell type prioritizations were strongly correlated to those based on clinical diagnosis, reflecting the pathogenesis of the disease (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 2</xref>). Likewise, Augur can readily be applied to prioritize cell types in datasets with more than two perturbations (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 3</xref>).</p>
  <p id="P11">To apply Augur to single-cell datasets with more complex experimental designs, we devised a test for differential cell type prioritization (<xref ref-type="fig" rid="F6">Extended Data Fig. 4a</xref>). Applying differential prioritization to a single-cell imaging transcriptomics (MERFISH) dataset<sup><xref rid="R16" ref-type="bibr">16</xref></sup>, Augur identified multiple neuron subtypes preferentially activated during parenting in either male or female mice (<xref ref-type="fig" rid="F6">Extended Data Fig. 4b-c</xref>). Similarly, in a scRNA-seq dataset<sup><xref rid="R17" ref-type="bibr">17</xref></sup>, Augur prioritized several neuron subtypes with differential responses to whisker lesioning in Cx3cr1<sup>+/−</sup> and Cx3cr1<sup>−/−</sup> mice (<xref ref-type="fig" rid="F6">Extended Data Fig. 4d</xref>).</p>
  <p id="P12">We also considered whether Augur could be applied directly to single-cell measures of transcriptome dynamics, such as the RNA velocity<sup><xref rid="R18" ref-type="bibr">18</xref></sup>, in order to specifically prioritize cell types undergoing an acute response to a perturbation on the timescale of transcription. We found that both experimental measurements<sup><xref rid="R19" ref-type="bibr">19</xref></sup> and computational inference<sup><xref rid="R18" ref-type="bibr">18</xref></sup> of transcriptional activity consistently captured more information than total RNA abundance in perturbations ranging from 45 min to 4 h in duration (<xref ref-type="fig" rid="F7">Extended Data Fig. 5a-g</xref>). Conversely, we confirmed that transcriptome dynamics did not confer an appreciable information gain to cell type prioritization when the perturbation is chronic (<xref ref-type="fig" rid="F7">Extended Data Fig. 5h-i</xref>).</p>
  <p id="P13">We finally aimed to demonstrate the relevance of Augur to discover new biological mechanisms. We recently showed that targeted epidural spinal stimulation of lumbar segments (TESS), augmented by monoaminergic stimulation<sup><xref rid="R20" ref-type="bibr">20</xref></sup>, restores walking after spinal cord injury in individuals with paralysis<sup><xref rid="R21" ref-type="bibr">21</xref></sup>. However, the neural circuits engaged by this treatment remain enigmatic. We devised an experiment to expose the neuron subtypes recruited by TESS using single-cell transcriptomics (<xref ref-type="fig" rid="F2">Fig. 2a</xref>). Mice received a severe contusion of the thoracic spinal cord that led to permanent paralysis of both legs. In the presence of serotonergic and D1 agonists, TESS immediately enabled walking in paralyzed mice (<xref ref-type="fig" rid="F2">Fig. 2b-c</xref>). We performed single-nucleus RNA-seq of 18,514 nuclei from mice walking for 30 min with TESS and control mice, identifying all the major cell types of the lumbar spinal cord (<xref ref-type="fig" rid="F2">Fig. 2d</xref> and <xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 4</xref>). We then subjected the 6,035 identified neurons to an additional round of clustering. This analysis identified 39 neuron subtypes expressing classical marker genes that were detected across experimental conditions (<xref ref-type="fig" rid="F2">Fig. 2e</xref> and <xref ref-type="fig" rid="F8">Extended Data Fig. 6</xref>).</p>
  <p id="P14">We reasoned that applying Augur directly to the RNA velocity of these neurons could prioritize subtypes that are immediately engaged by the therapy. Previous studies suggested that TESS generates an electrical field that depolarises proprioceptive afferent fibers<sup><xref rid="R22" ref-type="bibr">22</xref></sup>. Consistent with this prediction, Augur robustly prioritized interneurons with the molecular profiles of V2a and V1/V2b neurons, which are known to receive synapses from proprioceptive afferents (<xref ref-type="fig" rid="F2">Fig. 2f</xref> and <xref ref-type="fig" rid="F9">Extended Data Fig. 7</xref>). V2a interneurons have been implicated in left-right alternation<sup><xref rid="R23" ref-type="bibr">23</xref></sup>, whereas V2b interneurons are critical for flexor-extensor alternation<sup><xref rid="R24" ref-type="bibr">24</xref></sup>. Augur also prioritized <italic>Spp1</italic>-positive neurons, typically associated with motoneurons (<xref ref-type="fig" rid="F2">Fig. 2f</xref>). Virus-mediated anatomical tracing in transgenic mice revealed dense synaptic projections from the prioritized interneurons onto motoneurons (<xref ref-type="fig" rid="F2">Fig. 2g</xref>). The induction of immediate early genes in V2a and V1/V2b interneurons (<xref ref-type="fig" rid="F2">Fig. 2h</xref>) confirmed their activation in response to TESS-enabled walking, a finding we verified by <italic>in situ</italic> hybridization (<xref ref-type="fig" rid="F2">Fig. 2i</xref> and <xref ref-type="fig" rid="F10">Extended Data Fig. 8</xref>). In contrast, interneurons not prioritized by Augur showed minimal amounts of <italic>Fos</italic> mRNA (<xref ref-type="fig" rid="F10">Extended Data Fig. 8</xref>). These results illustrate the value of Augur to expose neural circuits underlying complex behaviors.</p>
  <p id="P15">Augur is computationally efficient, requiring a median of 49.7 min and 2.3 GB of RAM to analyze our compendium of 22 scRNA-seq datasets (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 5a-b</xref>). Inherent to the design of Augur is the ability to scale to datasets containing hundreds of thousands or even millions of cells on a laptop (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 5c-d</xref>). Moreover, Augur is robust to sequencing depth and classifier hyperparameters (<xref ref-type="supplementary-material" rid="SD13">Supplementary Figs. 6-7</xref>), and is compatible with both 3’ and full-length sequencing protocols (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 8</xref>). Contrary to single-cell DE methods, Augur incorporates information from both highly and lowly expressed genes (<xref ref-type="fig" rid="F11">Extended Data Fig. 9</xref>). Augur is robust to several forms of batch effect, and computational batch correction can rescue accurate cell type prioritization under highly confounded experimental designs (<xref ref-type="fig" rid="F12">Extended Data Fig. 10</xref>). Conversely, a limitation of Augur is that inferences at the level of cell types aggregate continuous underlying gradients of response intensity within cell populations, in order to achieve accurate cell type prioritization. As an efficient and principled method for cell type prioritization, we envision that Augur will facilitate the interpretation of a growing resource of single-cell data spanning multiple experimental conditions, and help single-cell technologies realize their potential to pinpoint cell types underlying organism-level phenotypes.</p>
  <sec sec-type="methods" id="S1" specific-use="web-only">
    <title>Online Methods</title>
    <sec id="S2">
      <title>Design and implementation of Augur</title>
      <p id="P16">Single-cell technologies increasingly allow investigators to collect datasets that span multiple experimental conditions: for instance, patients with a particular disease compared to healthy controls, animals exposed to a specific behavioral stimulus compared to unstimulated animals, or organisms subject to a particular genetic manipulation and wild-type controls. A number of tools have been developed to identify individual analytes (for instance, genes, proteins, or accessible chromatin regions) that exhibit statistically significant differences between experimental conditions<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R25" ref-type="bibr">25</xref></sup>. However, for many biological questions, the analytical level of interest is not individual differentially abundant features, but rather the specific cell types that are most strongly affected by a stimulus. For instance, investigators may design a single-cell transcriptomics experiment to identify particular cell types in a complex tissue that undergo the most marked transcriptional changes in response to treatment with a drug, in order to clarify its mechanism of action. We refer to the process of ranking cell types based on their molecular response to a biological perturbation as <italic>cell type prioritization</italic>.</p>
      <p id="P17">We designed Augur as a method to prioritize cell types based on their molecular response to a perturbation in highly multidimensional single-cell data. We reasoned that cells undergoing a profound response to a given experimental stimulus should become more separable, in the space of molecular measurements, than cells that remain unaffected by the stimulus. We sought to design a quantitative metric of this separability that would be robust to heteroscedasticity between cell types, and account for the specific biological and technical variability within each cellular subpopulation. Accordingly, Augur quantifies this separability by asking how readily the experimental sample labels associated with each cell (e.g., treatment vs. control) can be predicted from molecular measurements alone. In practice, this is achieved by training a machine-learning model specific to each cell type, to predict the experimental condition from which each individual cell originated. The accuracy of each cell type-specific classifier is evaluated in cross-validation, providing a quantitative basis for cell type prioritization.</p>
      <p id="P18">We reasoned that an ideal method for cell type prioritization would make no assumptions about the distributions of features provided as input, and more broadly, would be agnostic to the particular molecular features provided as input: that is, it would readily incorporate single-cell RNA-seq, proteomics, epigenomics, and imaging transcriptomics datasets, among other modalities. Accordingly, Augur uses a random forest classifier to predict sample labels for each cell type. Random forests have the advantage that they do not make any parametric assumptions about the distribution of the input features, and consequently are robust to both the nature of the molecular measurements themselves, as well as to the specific pre-processing and normalization steps applied to obtain the input features-by-cells matrix.</p>
      <p id="P19">When training machine-learning models, model performance generally improves as the size of the training dataset increases. We anticipated that this well-known phenomenon could present a critical confound to cell type prioritization, because cell types are unevenly represented in most single-cell datasets for both biological and technical reasons. To account for this confound, Augur repeatedly draws small samples of fixed size from each cell-type specific gene expression matrix, and performs cross-validation on these subsampled matrices (by default, 50 subsamples of 20 cells per condition are drawn). Augur then reports the mean cross-validation AUC across many small subsamples. We confirmed that this procedure abolishes the relationship between the number of cells of a particular type and the cross-validation AUC, in both real and simulated datasets (<xref ref-type="fig" rid="F1">Fig. 1b-c</xref> and <xref ref-type="fig" rid="F3">Extended Data Figs. 1</xref>-<xref ref-type="fig" rid="F4">2</xref>).</p>
      <p id="P20">To further improve computational efficiency, Augur incorporates two feature selection steps to minimize the number of analytes provided to the classifier as input. First, for each cell type in turn, Augur removes genes with little cell-to-cell variation within that cell type. This procedure, commonly referred to as highly variable gene identification in the context of single-cell RNA-seq<sup><xref rid="R26" ref-type="bibr">26</xref></sup>, also has the effect of removing noise. To flexibly account for the mean-variance relationship without making assumptions about the form of this relationship, Augur fits a local polynomial regression between the mean and coefficient of variation<sup><xref rid="R27" ref-type="bibr">27</xref>,<xref rid="R28" ref-type="bibr">28</xref></sup> using the ‘loess’ function, and ranks genes based on their residuals in this model. A fixed quantile of the most highly variable genes are retained for each cell type (specified using the ‘var_quantile’ parameter, which defaults to 50% in order to remove only features that show less-than-expected variation based on their mean abundance). Second, for each iteration, a random proportion of features are randomly removed to improve speed and memory usage (specified using the ‘feature_perc’ parameter, which also defaults to 50%). In combination, these steps significantly reduce the size of the matrix that must be taken out of a sparse representation for input to the classifier, from ~20,000 genes to ~5,000 genes in a typical scRNA-seq dataset. To avoid discarding information in datasets where fewer analytes are measured, feature selection is only performed for datasets exceeding a certain minimum number of features (with this cutoff set, by default, to 1,000).</p>
      <sec id="S3">
        <title>Implementation</title>
        <p id="P21">Augur is implemented as an R package, available from <ext-link ext-link-type="uri" xlink:href="https://github.com/neurorestore/Augur">https://github.com/neurorestore/Augur</ext-link> (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 9</xref>). Augur takes as input a features-by-cells (e.g., genes-by-cells for scRNA-seq) matrix, and a data frame containing metadata associated with each cell, minimally including the cell type annotations and sample labels to be predicted. Alternatively, a Seurat<sup><xref rid="R29" ref-type="bibr">29</xref></sup>, monocle3<sup><xref rid="R30" ref-type="bibr">30</xref></sup>, or SingleCellExperiment<sup><xref rid="R31" ref-type="bibr">31</xref></sup> object can be provided as input. To optimize both speed and memory usage, all computations are implemented for sparse matrices, up to the classification procedure itself. Because the feature selection, classification, and cross-validation procedures are independent for each cell type, Augur can readily be parallelized over the cell types in the input dataset, using the ‘mclapply’ package for parallelization, and runs on four cores by default.</p>
      </sec>
      <sec id="S4">
        <title>Multiclass classification and regression</title>
        <p id="P22">Augur quantifies the accuracy by which cell type labels can be predicted from molecular measurements using the area under the receiver operating characteristic curve (AUC), or the macro-averaged AUC in the case of multiclass classification. For experiments in which the perturbation can be interpreted as a continuous or ordinal variable, the classification objective is replaced with a regression task, and the accuracy of the corresponding random forest regression models is quantified using the concordance correlation coefficient (CCC)<sup><xref rid="R32" ref-type="bibr">32</xref></sup>, a measure of both the precision and accuracy of the relationship between predicted and experimental sample labels. By default, Augur returns the mean AUC (or CCC) for each cell type as a summary of cell type classification, but also calculates a larger suite of metrics for each fold of each subsampling iteration, including accuracy, precision, recall, sensitivity, specificity, negative predictive value, and positive predictive value, for users interested in investigating predictions in more detail. Augur also returns the feature importance associated with each input gene (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 11</xref>).</p>
      </sec>
      <sec id="S5">
        <title>Differential prioritization</title>
        <p id="P23">To compare cell type prioritizations between related conditions, we devised a permutation-based test for differential prioritization. In order to obtain a null distribution of AUCs for each cell type that reflected variability associated with number of cells sequenced, read depth, and other technical factors, we permuted sample labels within each cell type, and ran Augur on the permuted dataset. We repeated this permutation procedure 1,000 times. We then compared the observed difference between condition-specific AUCs, ΔAUC<sub>obs</sub>, for each cell type to the difference under permuted sample labels, ΔAUC<sub>rnd</sub>, and calculated permutation p-values<sup><xref rid="R33" ref-type="bibr">33</xref></sup>.</p>
      </sec>
    </sec>
    <sec id="S6">
      <title>Simulations</title>
      <p id="P24">We initially tested Augur on simulated scRNA-seq data, using the ‘Splatter’ R package<sup><xref rid="R34" ref-type="bibr">34</xref></sup>. Initial simulation parameters were estimated from the Kang et al. dataset<sup><xref rid="R4" ref-type="bibr">4</xref></sup> using the ‘splatEstimate’ function, and populations of 100–1,000 cells from two experimental conditions were generated, in increments of 100. We then simulated differential expression in varying proportions of genes (using the ‘de.prob’ parameter), and with varying magnitudes (using the ‘de.facLoc’ parameter). To specifically evaluate the ability of Augur to abolish the relationship between the number of cells in a particular population and the AUC of sample label classification, we compared Augur to cell type prioritization using an identical feature selection and classification procedure, but without drawing small subsamples from the dataset, by setting the ‘n_subsamples’ argument to 0. We additionally implemented a cell type prioritization scheme based on the number of differentially expressed genes between conditions, as previously described<sup><xref rid="R3" ref-type="bibr">3</xref>,<xref rid="R6" ref-type="bibr">6</xref></sup>. Cell types were ranked based on the number of differentially expressed genes using six different tests for differential expression in single-cell transcriptomics datasets (t-test, Wilcoxon rank-sum test, likelihood ratio test<sup><xref rid="R35" ref-type="bibr">35</xref></sup>, logistic regression<sup><xref rid="R36" ref-type="bibr">36</xref></sup>, MAST<sup><xref rid="R37" ref-type="bibr">37</xref></sup>, and a negative binomial generalized linear model), implemented through the Seurat ‘FindMarkers’ function.</p>
      <p id="P25">To evaluate the impact of different scRNA-seq protocols on cell type prioritization, we repeated these simulations with parameters estimated from libraries prepared by Ziegenhain et al.<sup><xref rid="R38" ref-type="bibr">38</xref></sup>, using six prominent scRNA-seq methods (CEL-seq2, Drop-seq, MARS-seq, SCRB-seq, Smart-seq, and Smart-seq2; <xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 8</xref>).</p>
      <p id="P26">To evaluate the impact of mean expression levels on cell type prioritization, we binned genes based on their mean expression into quintiles, then repeated these simulation experiments with either Augur or a representative single-cell test for differential expression, the Wilcoxon rank-sum test, run separately on genes from each quintile (<xref ref-type="fig" rid="F11">Extended Data Fig. 9</xref>). To ensure these two methods were provided with the same genes as input, filtering of lowly variable genes was performed for the entire gene expression matrix, then Augur was subsequently run with no additional feature selection. We additionally confirmed these trends were not an artefact of our simulated datasets by performing an identical differential expression analysis in the Kang et al. dataset<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, again finding that the vast majority of differentially expressed genes were detected within the top 20% of most highly expressed genes..</p>
      <p id="P27">To evaluate the impact of the distribution of cell type proportions on cell type prioritization in complex tissues, we simulated scRNA-seq experiments with eight cell types. These simulated cell types displayed a graded response to perturbation, having between 10% and 80% of their genes differentially expressed in response to the stimulus. The unevenness of the distribution of cell type frequencies, as quantified by the Gini coefficient, was systematically varied. A total of 5,000 cells were simulated, with the number of cells of each type drawn randomly from a gamma distribution such that the distribution of cell type frequencies achieved a prespecified Gini coefficient in the range from 0 to 0.7, in increments of 0.05. The accuracy of cell type prioritization was quantified as the correlation between the AUC, for Augur, or the number of differentially expressed genes, for the six single-cell tests for differential expression described above, and the proportion of differentially expressed genes under the simulation ground truth. To compare these simulations to real scRNA-seq datasets, we calculated the Gini coefficient of cell type frequencies using the ‘reldist’ R package across 22 published studies, as described below, obtaining a mean Gini coefficient of 0.52.</p>
      <p id="P28">Finally, because separability within cell types can arise not only from the cell-intrinsic response to perturbation but also from a number of technical factors, we evaluated the impact of batch effects on cell type prioritization (<xref ref-type="fig" rid="F12">Extended Data Fig. 10</xref>). In simulated populations of 200 cells from two experimental conditions, sequenced in two batches, we simultaneously varied both the proportion of differentially expressed genes and the location parameter for the batch effect factor log-normal distribution (‘batch.facLoc’), fixing the location parameter of the differential expression factor log-normal distribution (‘de.facLoc’) at 0.5, as above. Under the default model in Splatter, technical batch effects are orthogonal to both the magnitude of perturbation-dependent differential expression, and the likelihood that a given cell is observed in either the stimulated or unstimulated condition. Because the separability between conditions is effectively unchanged in this scenario (“scenario #1”), we extended the Splatter package to incorporate confounding between batch and differential expression (“scenario #2”), and between batch and experimental condition (“scenarios #3-5”). Confounding between batch and differential expression is achieved by adjusting the order of operations in Splatter such that differential expression is simulated prior to the application of a batch effect, with the result that the batch effect amplifies the perturbation in one of the two batches. Confounding between batch and condition is achieved by adjusting the proportion of cells from each experimental condition within each batch, such that one batch is more likely to contain cells from the stimulated population. The fork of the Splatter repository implementing confounded batch effects is available from <ext-link ext-link-type="uri" xlink:href="https://github.com/jordansquair/splatter_batch">https://github.com/jordansquair/splatter_batch</ext-link>. Last, we asked whether computational methods for batch effect correction could restore the expected gradient of perturbation response in confounded datasets. Using an exemplary approach, the mutual nearest neighbors method<sup><xref rid="R39" ref-type="bibr">39</xref></sup> as implemented in the ‘batchelor’ R package, we found that computational correction of batch effects restored accurate cell type prioritization. We suggest exploration and, if necessary, computational correction of any batch effects prior to cell type prioritization with Augur.</p>
    </sec>
    <sec id="S7">
      <title>RNA velocity analysis</title>
      <p id="P29">To generate intronic and exonic read count matrices for each dataset, data were downloaded from the SRA and converted to FASTQ format using the SRA toolkit. In the case of inDrops data, annotated BAM files were obtained using dropTag<sup><xref rid="R40" ref-type="bibr">40</xref></sup> with flags -s -S -c. Reads were then aligned to the latest Ensembl release (GRCm38.93), using STAR (v.2.5.3a)<sup><xref rid="R41" ref-type="bibr">41</xref></sup>. For Drop-seq data, files were first converted from FASTQ to BAM format using the Picard function ‘FastqtoSam’. Reads were then aligned to the latest Ensembl release using the Drop-seq toolkit (<ext-link ext-link-type="uri" xlink:href="https://github.com/broadinstitute/Drop-seq">https://github.com/broadinstitute/Drop-seq</ext-link>). Next, count matrices of exonic and intronic reads were obtained using dropEst with flags -m -V -L eEBA -F. Barcodes were filtered to match those present in the processed datasets uploaded to the Gene Expression Omnibus (GEO) for each dataset. RNA velocity was subsequently calculated using the ‘velocyto’ R package<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. Features were first chosen by filtering for genes with a minimum expression value per cell type using the function ‘filter.genes.by.cluster.expression’, with filters adjusted based on the read count distributions for each dataset (GSE102827: exon filter, 0.5, intron filter, 0.1; GSE130597: exon filter, 0.03, intron filter, 0.02; GSE103976, exon filter, 0.05, intron filter, 0.03). We then calculated gene-relative velocity using kNN pooling with k=10 (default) and fit.quantile = 0.01. By default, the function ‘gene.relative.velocity.estimates’ in velocyto.R returns a matrix containing only those features for which accurate estimates of γ and velocity could be obtained. Consequently, we ran Augur without either variable gene or random gene filters, as feature selection had already been performed during the creation of the RNA velocity matrix used as input. To compare AUCs for cell type prioritization on matrices of exonic or total counts, we retained only those genes for which velocity estimates could be calculated, and likewise disabled the variable gene and random gene filters. All other parameters were left as default.</p>
    </sec>
    <sec id="S8">
      <title>Computational benchmarking</title>
      <p id="P30">To quantify the computational resources required for cell type prioritization (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 5</xref>), we ran Augur with default settings on our compendium of 22 scRNA-seq datasets. The R package ‘peakRAM’ was used to monitor peak memory usage, and the base R function ‘system.time’ was used to monitor wall time.</p>
    </sec>
    <sec id="S9">
      <title>Hyperparameter analysis</title>
      <p id="P31">To characterize the robustness of Augur prioritizations to hyperparameters associated with its subsampling or feature selection procedures, the random forest classifier, and the choice of classifier itself, we evaluated the impact of systematically varying each of these parameters (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 6</xref>). We first investigated the impact of the number and size of subsamples from each cell-type-specific gene expression matrix on cell type prioritization, finding the ranks of each cell type stabilized around 50 subsamples. While larger subsample sizes generally yielded more robust ranks, these thresholds also precluded analysis of several cell types represented by fewer cells in existing datasets, and consequently we opted for an inclusive subsample size of 20 cells per experimental condition. Similarly, we ran Augur on gene expression matrices consisting of the top 10–100% of highly variable genes, followed by selection of a random subset of 10–100% of these, but found Augur was generally robust to the features provided as input. (We used the default thresholds of 50% on the variable gene and random selection filters throughout, unless otherwise specified). To assess the robustness of Augur prioritizations to random forest hyperparameters, we varied the number of trees in the forest between 10–1,000, the minimum number of cells required to split an internal node between 2–10, and the number of features sampled per split between 2–500. Finally, to assess the impact of the classifier itself, we implemented L1-penalized logistic regression in Augur using the R package ‘glmnet’, with the optimal value of the regularization parameter λ determined for each iteration using the function ‘cv.glmnet’.</p>
      <p id="P32">The AUC of cell type prioritization ranges from 0 to 1, where an AUC of 0.5 corresponds to the accuracy of a random classifier, and an AUC of 1 represents perfect classification. Cell type prioritization is most effective when the distribution of AUCs spans a wide range, distinguishing cell types that are unaffected by the perturbation from those that are profoundly affected. However, in situations where all cell types are undergoing a profound perturbation response, or when datasets are sequenced very deeply (and thus more information is available to the classifier), many cell types may have an AUC of 1, representing perfect separability. In this case, Augur hyperparameters may be modified in order to purposefully degrade the performance of the classifier, and thereby achieve a broader range in the distribution of AUCs across cell types. Conceptually, this can be thought of as effectively the opposite of the hyperparameter tuning step that would typically be performed during the development of a machine-learning classifier. Importantly, this intervention is feasible because Augur hyperparameters have remarkably little effect on the rank of different cell types: that is, the cell type prioritizations as such (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 6</xref> and <xref ref-type="fig" rid="F9">Extended Data Fig. 7d</xref>). However, although the cell type prioritizations remain consistent, a subset of parameters have a marked effect on the magnitude of the AUCs (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 10</xref>). Empirically, we suggest decreasing the number of trees in the random forest classifier in scenarios where perfect classification can be achieved for many cell types (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 10g</xref>). Alternatively, the number of trees may be increased in scenarios where all AUCs are close to 0.5 (for instance, cells undergoing an exceptionally subtle perturbation, or very sparsely sequenced datasets).</p>
    </sec>
    <sec id="S10">
      <title>Downsampling analysis</title>
      <p id="P33">Motivated by the observation that only a fraction of reads at conventional depths are required to detect transcriptional programs and assign cell types<sup><xref rid="R42" ref-type="bibr">42</xref></sup>, we also evaluated the impact of sequencing depth on Augur cell type prioritizations by downsampling published scRNA-seq datasets to between 5–95% of their original depths (<xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 7</xref>). Reads were downsampled from the processed count matrices using the ‘downsampleMatrix’ function from the ‘DropletUtils’ package<sup><xref rid="R43" ref-type="bibr">43</xref></sup>, with the argument ‘bycol = FALSE’ in order to sample without replacement from all reads in the entire dataset rather than from each cell individually.</p>
    </sec>
    <sec id="S11">
      <title>Preprocessing and analysis of published single-cell datasets</title>
      <p id="P34">Data from a total of 28 published single-cell studies was processed and analyzed with Augur as described in detail in <xref ref-type="supplementary-material" rid="SD13">Supplementary Note 1</xref>. Unless otherwise noted, expression matrices and metadata were stored as Seurat objects, and genes detected in less than three cells were removed.</p>
    </sec>
    <sec id="S12">
      <title>Application of Augur to TESS</title>
      <p id="P35">To experimentally validate the ability of Augur to uncover new biological mechanisms and identify neuron subtypes involved in complex behaviors, we applied Augur to investigate the neural circuits underlying the functional response to targeted epidural electrical stimulation (TESS) following a field-standard contusion spinal cord injury<sup><xref rid="R44" ref-type="bibr">44</xref>,<xref rid="R45" ref-type="bibr">45</xref></sup> using single-nucleus transcriptomics. Details on the animal model, surgical procedures, post-surgical care, electrochemical stimulation, and kinematic analysis are provided in <xref ref-type="supplementary-material" rid="SD13">Supplementary Note 2</xref>.</p>
      <sec id="S13">
        <title>Single-nucleus RNA sequencing</title>
        <p id="P36">Single nucleus dissociation was completed with a modified protocol based on our previous work<sup><xref rid="R46" ref-type="bibr">46</xref></sup>. Briefly, animals were euthanized by isoflurane inhalation and cervical dislocation. The thoracic SCI site was rapidly dissected and frozen on dry ice. Spinal cords were dounced in 500 μl sucrose buffer (0.32 M sucrose, 10 mM HEPES [pH 8.0], 5 mM CaCl2, 3 mM Mg-acetate, 0.1 mM EDTA, 1 mM DTT) and 0.1% Triton X-100 with the Kontes Dounce Tissue Grinder. 2 mL of sucrose buffer was added and filtered through a μm cell strainer. The lysate was subsequently centrifuged at 3200 g for 10 min at 4°C. The supernatant was decanted, and 3 mL of sucrose buffer added to the pellet and incubated for 1 min. The pellet was homogenized using an Ultra-Turrax and 12.5 mL of density buffer (1 M sucrose, 10 mM HEPES [pH 8.0], 3 mM Mg-acetate, 1 mM DTT) was added below the nuclei layer. The tube was centrifuged at 3200 g at 4°C and supernatant immediately poured off. The nuclei on the bottom half of the tube wall were collected with 100 μl PBS with 0.04% BSA and 0.2 U/μl RNase inhibitor. Resuspended nuclei were filtered through a 30 μm strainer. The nuclei suspension was finally adjusted to 1000 nuclei/μl.</p>
      </sec>
      <sec id="S14">
        <title>Library preparation</title>
        <p id="P37">Library preparation was carried out with 10x Genomics Chromium Single Cell Kit Version 2. The nuclei suspension was added to the Chromium RT mix to achieve loading numbers of 5,000. For downstream cDNA synthesis (13 PCR cycles), library preparation and sequencing, the manufacturer’s instructions were followed.</p>
      </sec>
      <sec id="S15">
        <title>Read alignment</title>
        <p id="P38">Reads were aligned to the latest Ensembl release (GRCm38.93), and a matrix of unique molecular identifier (UMI) counts was obtained using CellRanger count. Velocyto<sup><xref rid="R18" ref-type="bibr">18</xref></sup> was subsequently used to obtain count matrices of exonic and intronic reads. Seurat<sup><xref rid="R29" ref-type="bibr">29</xref></sup> was used to calculate quality control metrics, including the number of genes detected, number of UMIs per cell, and % mitochondrial genes in order to filter low-quality cells appropriately (cells with number of genes expressed &lt; 200; cells with % mitochondrial reads &gt; 5%; genes expressed in &lt; 3 cells). The matrix used for downstream analysis consisted of 19,954 genes and 18,514 cells.</p>
      </sec>
      <sec id="S16">
        <title>Clustering and integration</title>
        <p id="P39">To integrate datasets across different experimental conditions, we took advantage of recently developed bioinformatic tools that align datasets from multiple conditions into a unified space<sup><xref rid="R29" ref-type="bibr">29</xref></sup>. Gene expression data was first normalized using regularized negative binomial models<sup><xref rid="R47" ref-type="bibr">47</xref></sup>, then integrated across batches using Seurat<sup><xref rid="R29" ref-type="bibr">29</xref></sup>. Batch effects were regressed out using the ‘latent.vars’ argument. Normalized and integrated gene expression matrices were clustered using Seurat<sup><xref rid="R29" ref-type="bibr">29</xref></sup> to identify cell types in the integrated dataset using a standard workflow, including highly variable gene identification, principal component analysis, nearest-neighbor graph construction, and graph-based community detection. Following the identification of coarse-grained cell types (e.g., ‘neuron’), we identified fine-grained neuron subtypes by sub-clustering major cell types. We used clustering trees<sup><xref rid="R48" ref-type="bibr">48</xref></sup> to guide the decision of the optimal resolution (<xref ref-type="fig" rid="F9">Extended Data Fig. 7a</xref>). Cell types were manually annotated by using differential expression analysis to identify marker genes<sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R29" ref-type="bibr">29</xref></sup>. Putative cell types were assigned on the basis of marker gene expression, guided by previous work<sup><xref rid="R46" ref-type="bibr">46</xref>,<xref rid="R49" ref-type="bibr">49</xref>–<xref rid="R51" ref-type="bibr">51</xref></sup>.</p>
      </sec>
      <sec id="S17">
        <title>RNA velocity</title>
        <p id="P40">RNA velocity was calculated using the ‘velocyto’ R package<sup><xref rid="R18" ref-type="bibr">18</xref></sup>. Velocyto estimates cell velocities from their spliced and unspliced mRNA content. We generated the annotated spliced and unspliced reads using the ‘run10x’ function of the Velocyto command line tool, as described above. We then calculated gene-relative velocity using kNN pooling with k=10 (default).</p>
      </sec>
      <sec id="S18">
        <title>Viral tract tracing</title>
        <p id="P41">All surgeries on mice were performed at EPFL under general anaesthesia with isoflurane in oxygen-enriched air using an operating microscope, and rodent stereotaxic apparatus (David Kopf). To trace the efferent connections of Vsx2 (V2a) neurons AAV-DJ-hSyn Flex mGFP 2 A synaptophysin mRuby (Stanford Vector Core Facility, reference AAV DJ GVVC-AAV-100, titer 1.15E12 genome copies per ml<sup><xref rid="R52" ref-type="bibr">52</xref></sup>) was injected on each side of the cord of Vsx2-Cre mice at the L2 spinal level, 0.25 μl 0.6 mm below the surface at 0.1 μl per minute using glass micropipettes (ground to 50 to 100 μm tips) connected via high-pressure tubing (Kopf) to 10-μl syringes under the control of microinfusion pumps.</p>
      </sec>
      <sec id="S19">
        <title>Immunohistochemistry</title>
        <p id="P42">After terminal anaesthesia by barbiturate overdose, mice were perfused transcardially with 4% paraformaldehyde and spinal cords processed for immunofluorescence as previously described<sup><xref rid="R53" ref-type="bibr">53</xref>,<xref rid="R54" ref-type="bibr">54</xref></sup>. Primary antibodies were: goat anti-choline acetyltransferase (ChAT, 1:50, Millipore, AB144P). Secondary antibodies were: Alexa Fluor 647 Donkey Anti Goat (1:200; Life Technologies, AB32849). Immunofluorescence was imaged digitally using a slide scanner [Olympus VS-120 Slide scanner] or confocal microscope [Zeiss LSM880 + Airy fast module with ZEN 2 Black software (Zeiss, Oberkochen, Germany)]. Images were digitally processed using ImageJ (NIH) or Imaris (Bitplane, v.9.0.0).</p>
      </sec>
      <sec id="S20">
        <title>RNAscope</title>
        <p id="P43">We confirmed the <italic>in situ</italic> localization of cell type markers and the expression of the immediate early gene <italic>Fos</italic> using RNAscope. Briefly, 16 μm cryosections were obtained from fixed-frozen spinal cords of animals undergoing identical experimental procedures. We used these sections to confirm the localization of <italic>Spp1</italic> (cat. no. 435191), <italic>Slc6a5</italic> (cat. no. 409741-C3) <italic>and Vsx2</italic> (cat. no. 438341). We additionally included an analysis of negative controls that were not prioritized by Augur including Cck (cat. no. 402271-C3), Npy (cat. no. 313321), Rorb (cat. no. 444271-C3), Pnoc (cat. no. 437881), Gal (cat. no. 400961-C3), and Trh (cat. no. 436811 neurons). All these cell types have also been validated elsewhere<sup><xref rid="R46" ref-type="bibr">46</xref>,<xref rid="R50" ref-type="bibr">50</xref>,<xref rid="R51" ref-type="bibr">51</xref></sup>. We combined gene markers with <italic>Fos</italic> (cat. no. 316921-C2) to confirm the presence of immediate early gene activation in these cell types<sup><xref rid="R46" ref-type="bibr">46</xref></sup>. To detect the transcripts we used the RNAscope assay for fixed frozen tissue (Advanced Cell Diagnostics)<sup><xref rid="R55" ref-type="bibr">55</xref></sup>. Probes were designed and provided by Advanced Cell Diagnostics, Inc. Staining was performed according to standard procedures, using the RNAscope Fluorescent Multiplex Reagent Kit (cat. no. 323133).</p>
      </sec>
    </sec>
    <sec id="S21">
      <title>Visualization</title>
      <p id="P44">Throughout the manuscript, box plots show the median (horizontal line), interquartile range (hinges) and smallest and largest values no more than 1.5 times the interquartile range (whiskers), and error bars show the standard deviation.</p>
    </sec>
  </sec>
  <sec sec-type="extended-data" id="S22">
    <title>Extended Data</title>
    <fig id="F3" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 1</label>
      <caption>
        <title>Augur overcomes confounding factors to cell type prioritization in simulated cell populations</title>
        <p id="P45"><bold>a-b</bold>, Area under the receiver operating characteristic curve (AUC) of a random forest classifier trained in three-fold cross-validation to distinguish two simulated populations of cells<sup><xref rid="R1" ref-type="bibr">1</xref></sup>, with the total number of cells increasing from <italic>n</italic> = 100 to <italic>n</italic> = 1,000 and the proportion of differentially expressed genes between the two populations varying from 0% to 100%, <bold>a</bold>, or the location parameter of the differential expression factor log-normal distribution varying from 0.1 to 1.0, <bold>b</bold>.</p>
        <p id="P46"><bold>c-d</bold>, As in <bold>a-b</bold>, but with the naive random forest classifier replaced with the subsampling procedure employed by Augur.</p>
        <p id="P47"><bold>e-f</bold>, Relationship between Augur AUC and the proportion of differentially expressed genes, <bold>e</bold>, or the location parameter of the differential expression factor log-normal distribution, <bold>f</bold>, in distinguishing two simulated populations (<italic>n</italic> = 200 cells total). The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown. Inset, two-sided Pearson correlation.</p>
        <p id="P48"><bold>g</bold>, Cell type prioritizations (AUC or number of differentially expressed genes) for a naive random forest classifier, Augur, and an exemplary single-cell differential expression test<sup><xref rid="R2" ref-type="bibr">2</xref></sup>, the Wilcoxon rank-sum test, for two simulated populations of cells with 50% of genes differentially expressed and a log-normal location parameter of 0.5, with the total number of cells increasing from <italic>n</italic> = 100 to <italic>n</italic> = 1,000 cells. Like a naive random forest strategy, the number of differentially expressed genes detected by the Wilcoxon rank-sum test scales linearly with the number of cells. The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown. Dotted lines show linear regression; shaded areas show 95% confidence intervals.</p>
        <p id="P49"><bold>h-i</bold>, Number of differentially expressed genes detected by six tests for single-cell differential gene expression between two simulated populations of cells, with the total number of cells increasing from 100 to 1,000 and the proportion of differentially expressed genes between the two populations varying from 0% to 100%, <bold>h</bold>, or the location parameter of the differential expression factor log-normal distribution varying from 0.1 to 1.0, <bold>i</bold>.</p>
        <p id="P50"><bold>j</bold>, Relationship between number of differentially expressed genes detected by five tests for single-cell differential gene expression and the proportion of differentially expressed genes simulated between the two populations, for simulated populations of between 100 and 1,000 cells (see also <xref ref-type="fig" rid="F1">Fig. 1e</xref>). All single-cell differential expression tests detect a larger number of differentially expressed genes in a large population of cells with modest transcriptional perturbation (20% of genes differentially expressed) than in a smaller population of cells with more profound perturbation (70% of genes differentially expressed).</p>
      </caption>
      <graphic xlink:href="EMS118049-f003"/>
    </fig>
    <fig id="F4" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 2</label>
      <caption>
        <title>Augur overcomes confounding factors to cell type prioritization in a compendium of published single-cell RNA-seq datasets</title>
        <p id="P51"><bold>a</bold>, Overview of <italic>n</italic> = 22 published scRNA-seq datasets comparing two or more experimental conditions, used to verify the relationship between cell type prioritizations from a random forest classifier, Augur, or single-cell differential expression tests. Left, heatmap indicating the species of origin, the sequencing protocol, and whether cells or nuclei were sequenced. Right, properties of each dataset, including the total number of cell types identified in the original studies; the total number of cells sequenced; the number of cells per type (red bars indicate mean); and the mean number of reads for cells of each type.</p>
        <p id="P52"><bold>b</bold>, Pearson correlations between the AUC of each cell type, and the number of cells of that type sequenced, across 22 datasets for Augur, bottom, and a naive random forest classifier without subsampling, top, as shown in <xref ref-type="fig" rid="F2">Fig. 2c</xref>.</p>
        <p id="P53"><bold>c</bold>, Pearson correlations between the number of differentially expressed genes per cell type, at 5% FDR, and the number of cells of that type sequenced, across 22 datasets for six statistical tests for single-cell differential expression.</p>
        <p id="P54"><bold>d</bold>, Number of cells in the top-ranked cell type across 22 datasets for Augur, bottom, and a naive random forest classifier without subsampling, top.</p>
        <p id="P55"><bold>e</bold>, Number of cells in the top-ranked cell type across 22 datasets for six statistical tests for single-cell differential expression.</p>
        <p id="P56"><bold>f</bold>, Jaccard index between the top-ranked 1 to 5 cell types across 22 datasets, comparing Augur and six statistical tests for single-cell differential expression.</p>
        <p id="P57"><bold>g</bold>, Cell type prioritizations in the Grubman et al., 2019<sup><xref rid="R3" ref-type="bibr">3</xref></sup> dataset by Augur and a representative test for single-cell differential expression, the Wilcoxon rank-sum test (“DE”).</p>
        <p id="P58"><bold>h</bold>, Relationship between AUC and number of differentially expressed genes per cell type, at 5% FDR, in the Grubman et al., 2019 dataset. Dotted line shows linear regression.</p>
        <p id="P59"><bold>i</bold>, Relationship between AUC and number of cells sequenced in the Grubman et al., 2019 dataset. Augur cell type prioritizations are uncorrelated with the number of cells per type. Dotted line shows linear regression; inset shows two-sided Pearson correlation.</p>
        <p id="P60"><bold>j</bold>, Relationship between number of differentially expressed genes and number of cells sequenced in the Grubman et al., 2019 dataset. Cell type prioritizations based on the number of differentially expressed genes are strongly correlated with the number of cells per type. Dotted line shows linear regression; inset shows two-sided Pearson correlation.</p>
      </caption>
      <graphic xlink:href="EMS118049-f004"/>
    </fig>
    <fig id="F5" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 3</label>
      <caption>
        <title>Augur overcomes confounding factors to cell type prioritization in simulated tissues and across single-cell modalities</title>
        <p id="P61"><bold>a</bold>, Number of cells within each of eight cell types in a simulated tissue with increasingly unequal cell type proportions, as quantified by the Gini coefficient.</p>
        <p id="P62"><bold>b</bold>, Cell type prioritization in simulated scRNA-seq data from a tissue with 5,000 cells distributed in eight cell types, with 10-80% of genes DE in response to perturbation, and increasingly unequal numbers of cells per type (as quantified by the Gini coefficient). The correlation to simulation ground truth (proportion of DE genes) is shown for five tests for single-cell differential gene expression. The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown. Dashed line shows mean Gini coefficient of cell type frequencies across 22 published scRNA-seq datasets. **, p &lt; 0.01; ***, p &lt; 0.001, two-sided paired t-test.</p>
        <p id="P63"><bold>c</bold>, Inequality of cell type proportions in published scRNA-seq data. Top, Gini coefficient of cell type proportions across 22 published scRNA-seq datasets. Horizontal line and shaded area show the mean and standard deviation of the Gini coefficient across all datasets. Bottom, number of cells of each type across 22 published scRNA-seq datasets.</p>
        <p id="P64"><bold>d</bold>, Comparison of cell type prioritization in independent scRNA-seq and single cell imaging transcriptomics (STARmap) studies of the mouse visual cortex after light exposure. Left, Augur cell type prioritization in the STARmap dataset<sup><xref rid="R4" ref-type="bibr">4</xref></sup>. Bottom, Augur cell type prioritization in the scRNA-seq dataset<sup><xref rid="R5" ref-type="bibr">5</xref></sup>. Center, correspondence between cell types defined in the scRNA-seq and STARmap datasets, quantified as the Spearman correlation coefficient between average profiles for each cell type across 139 genes present in both datasets.</p>
      </caption>
      <graphic xlink:href="EMS118049-f005"/>
    </fig>
    <fig id="F6" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 4</label>
      <caption>
        <title>Differential cell type prioritization in single-cell RNA-seq data</title>
        <p id="P65"><bold>a</bold>, Schematic overview of the permutation-based test for differential prioritization with Augur. First, cell type prioritization is performed within each of two conditions separately, yielding condition-specific AUCs for each cell type. Next, sample labels are randomly permuted within each cell type, and cell type prioritization is performed on shuffled data, yielding a null distribution of AUCs for each cell type and condition. AUCs for matching cell types are compared across conditions to calculate a ‘ΔAUC score’ for each cell type, and a null distribution of ΔAUC scores is calculated using the permuted data. Permutation p-values can then be calculated for each cell type, enabling the identification of statistically significant differences in cell type prioritization between conditions, as well as the condition in which the cell type is more transcriptionally separable.</p>
        <p id="P66"><bold>b</bold>, Neuron subtypes with statistically significant differences in AUC between female and male mice during parenting, in a single-cell imaging transcriptomics experiment employing multiplexed error robust fluorescence in situ hybridization (MERFISH)<sup><xref rid="R6" ref-type="bibr">6</xref></sup> (<italic>n</italic> = 79 subtypes). Eleven subtypes have significantly higher AUCs in female parents, whereas two have significantly higher AUCs in male parents.</p>
        <p id="P67"><bold>c</bold>, Relationship between differential prioritization ΔAUC for parenting between male and female mice, and AUC for sex in naive mice. Several neuronal subtypes preferentially activated during parenting in female mice are also transcriptionally distinct in naive mice, such as the I-32 cluster, which is enriched for aromatase expression, and expresses multiple sex steroid hormone receptors<sup><xref rid="R6" ref-type="bibr">6</xref></sup>.</p>
        <p id="P68"><bold>d</bold>, Neuron subtypes with statistically significant differences in AUC in response to whisker lesioning in Cx3cr1<sup>+/−</sup> as compared to Cx3cr1<sup>−/−</sup> mice, in a single-cell RNA-seq experiment<sup><xref rid="R7" ref-type="bibr">7</xref></sup> (<italic>n</italic> = 28 subtypes). Four subtypes are have significantly higher AUCs in homozygous mice, whereas one subtype has a significantly higher AUC in heterozygous mice.</p>
      </caption>
      <graphic xlink:href="EMS118049-f006"/>
    </fig>
    <fig id="F7" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 5</label>
      <caption>
        <title>Cell type prioritization from transcriptional dynamics in acute experimental perturbations</title>
        <p id="P69"><bold>a</bold>, Left, schematic overview of the scSLAM-seq<sup><xref rid="R8" ref-type="bibr">8</xref></sup> workflow. Cells are exposed to the nucleoside analogue 4-thiouridine (4sU), which is incorporated during transcription and converted to a cytosine analogue by iodoacetamide prior to RNA sequencing. This labeling permits <italic>in silico</italic> deconvolution of RNA molecules transcribed before and after 4sU exposure (‘old’ and ‘new’, respectively), and calculation of the ratio of new to total RNA (NTR), an experimental analogue to the computationally determined ‘RNA velocity’<sup><xref rid="R8" ref-type="bibr">8</xref>,<xref rid="R9" ref-type="bibr">9</xref></sup>. Right, AUCs for mouse fibroblasts exposed to lytic mouse cytomegalovirus (CMV) at 2 h post-infection, calculated by applying Augur to either total RNA or the NTR. The greater separability for the NTR reflects additional information specifically captured by the temporal dynamics of RNA expression in the context of this acute perturbation<sup><xref rid="R8" ref-type="bibr">8</xref></sup>.</p>
        <p id="P70"><bold>b-e</bold>, Cell type prioritization based on exonic reads, total RNA, or RNA velocity for cells of the mouse visual cortex after exposure to light for 1 h, <bold>b-c</bold>, or 4 h, <bold>d-e</bold>, in the <xref rid="R7" ref-type="bibr">Hrvatin et al., 2018</xref> dataset<sup>5</sup>. The AUC is significantly higher for RNA velocity than for either exonic reads (1 h, <italic>n</italic> = 34 cell types, 4 h, <italic>n</italic> = 35 cell types; two-sided paired t-tests: <bold>b</bold>, 1 h, p = 6.9 × 10<sup>-7</sup>; <bold>d</bold>, 4 h, p = 8.2 × 10<sup>-7</sup>) or total RNA (<bold>c</bold>, 1 h, p = 2.8 × 10<sup>-7</sup>; <bold>e</bold>, 4 h, p = 3.0 × 10<sup>-6</sup>), reflecting additional information specifically captured by acute transcriptional dynamics.</p>
        <p id="P71"><bold>f-g</bold>, Cell type prioritization based on exonic reads, total RNA, or RNA velocity in an Act-seq<sup><xref rid="R10" ref-type="bibr">10</xref></sup> dataset, which minimizes transcriptional changes induced by single-cell dissociation. Cell types of the medial amygdala in mice subjected to 45 min of immobilization stress and control mice were profiled by Drop-seq<sup><xref rid="R11" ref-type="bibr">11</xref></sup> after treatment with the transcription inhibitor actinomycin D. The AUC is higher for RNA velocity than for either exonic reads (<bold>f</bold>, p = 0.026, <italic>n</italic> = 6 cell types) or total RNA (<bold>g</bold>, p = 0.053), reflecting the additional information specifically captured by acute transcriptional dynamics, and indicating this is not an artefact related to the transcriptional perturbations known to be induced by conventional dissociation procedures<sup><xref rid="R12" ref-type="bibr">12</xref></sup>.</p>
        <p id="P72"><bold>h-i</bold>, Cell type prioritization based on exonic reads, total RNA, or RNA velocity in a chronic perturbation. Cell types of the lateral hypothalamic area were profiled by Drop-seq<sup><xref rid="R11" ref-type="bibr">11</xref></sup> in mice after 9-16 weeks of maintenance on either high-fat diet or control diet<sup><xref rid="R13" ref-type="bibr">13</xref></sup>. No significant difference in AUCs was observed for RNA velocity compared to either exonic reads (<bold>h</bold>, p = 0.22, <italic>n</italic> = 13 cell types) or total RNA (<bold>i</bold>, p = 0.98), consistent with the time scale of the experimental perturbation.</p>
      </caption>
      <graphic xlink:href="EMS118049-f007"/>
    </fig>
    <fig id="F8" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 6</label>
      <caption>
        <title>Subclustering of single-neuron transcriptomes identifies 39 neuron subtypes in the mouse lumbar spinal cord</title>
        <p id="P73">See also <xref ref-type="fig" rid="F9">Extended Data Fig. 7a</xref>.</p>
        <p id="P74"><bold>a</bold>, Dot plot showing expression of one marker gene per cell type for the 39 neuron subtypes of the mouse lumbar spinal cord.</p>
        <p id="P75"><bold>b</bold>, Neuron subtype detection across experimental conditions (<italic>n</italic> = 6,035 neurons). TESS, targeted electrical epidural stimulation of the lumbar spinal cord.</p>
        <p id="P76"><bold>c</bold>, Proportion of neurons of each subtype detected in each experimental condition.</p>
        <p id="P77"><bold>d</bold>, Neuron subtype detection across experimental replicates (n = 3 mice per condition).</p>
        <p id="P78"><bold>e</bold>, Proportion of neurons of each subtype detected in each experimental replicate.</p>
      </caption>
      <graphic xlink:href="EMS118049-f008"/>
    </fig>
    <fig id="F9" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 7</label>
      <caption>
        <title>Robustness of Augur cell type prioritizations for mouse lumbar spinal cord neurons</title>
        <p id="P79"><bold>a</bold>, Clustering tree<sup><xref rid="R14" ref-type="bibr">14</xref></sup> of mouse spinal cord neurons over seven clustering resolutions, revealing the hierarchical relationships between spinal cord neuron subtypes. Node color reflects AUCs for cell type prioritization in targeted electrical epidural stimulation.</p>
        <p id="P80"><bold>b</bold>, AUCs for each of 37 neuron subtypes represented by at least 20 cells in both control and TESS-treated mice.</p>
        <p id="P81"><bold>c-e</bold>, Robustness of cell type prioritization for neuron subtypes of the mouse lumbar spinal cord.</p>
        <p id="P82"><bold>c</bold>, Impact of systematically withholding cells from each of six replicates (<italic>n</italic> = 3 per group) on cell type prioritization. Left, cell type prioritization with all six replicates, as in <xref ref-type="fig" rid="F2">Fig. 2f</xref>. Grey tiles indicate neuron subtypes that were not represented by at least 20 cells in each condition after removal of cells from an experimental replicate.</p>
        <p id="P83"><bold>d</bold>, Impact of varying Augur parameters, including the number of subsamples and the size of each subsample; random forest-specific hyperparameters (number of trees, minimum split size, number of features sampled per split); and the choice of classifier (random forest, RF; L1-penalized logistic regression, LR) on cell type prioritization. Grey tiles indicate sample sizes larger than the number of cells of that type in the dataset.</p>
        <p id="P84"><bold>e</bold>, Impact of varying RNA velocity parameters, including exonic and intronic expression filters, the number of cells in the k-nearest neighbors pooling, and the extreme quantiles used to fit γ coefficients, on cell type prioritization.</p>
      </caption>
      <graphic xlink:href="EMS118049-f009"/>
    </fig>
    <fig id="F10" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 8</label>
      <caption>
        <title>Absence of colocalization of canonical marker genes for cell types not prioritized by Augur and Fos by RNAscope <italic>in situ</italic> hybridization</title>
        <p id="P85">Schematic indicates imaging location for each marker within the spinal cord. Bottom, proportion of cells expressing Fos from cell types prioritized by Augur (<italic>n</italic> = 3 cell types) or not prioritized by Augur (<italic>n</italic> = 6 cell types). Cell types prioritized by Augur are significantly more likely to express Fos after walking with TESS, compared to controls (p = 0.01, two-sided Fisher’s exact test), whereas cell types not prioritized by Augur do not display a statistically significant difference (p = 0.74). Error bars show standard deviation of the sample proportion.</p>
      </caption>
      <graphic xlink:href="EMS118049-f010"/>
    </fig>
    <fig id="F11" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 9</label>
      <caption>
        <title>Impact of mean gene expression level on cell type prioritization</title>
        <p id="P86">Cell type prioritizations were performed using both Augur and a representative single-cell differential expression method, the Wilcoxon rank-sum test, using the entire transcriptome (left column) or genes divided into five quintiles based on mean expression (right columns). Insets show two-sided Pearson correlations throughout.</p>
        <p id="P87"><bold>a</bold>, Relationship between Augur cell type prioritizations (AUC) and the proportion of differentially expressed genes between two simulated populations of cells (<italic>n</italic> = 200 cells total), as shown in <xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 1e</xref>. The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown.</p>
        <p id="P88"><bold>b</bold>, As in <bold>a</bold>, but with Augur applied to each quintile of gene expression separately. The AUC remains strongly correlated with the ground-truth perturbation intensity, regardless of mean expression levels (r ≥ 0.92).</p>
        <p id="P89"><bold>c</bold>, Relationship between Augur cell type prioritizations (AUC) and the location parameter of the differential expression factor log-normal distribution between two simulated populations of cells (n = 200 cells total), as shown in <xref ref-type="supplementary-material" rid="SD13">Supplementary Fig. 1f</xref>. The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown.</p>
        <p id="P90"><bold>d</bold>, As in <bold>c</bold>, but with Augur applied to each quintile of gene expression separately. The AUC remains strongly correlated with the ground-truth perturbation intensity, regardless of mean expression levels (r ≥ 0.95).</p>
        <p id="P91"><bold>e-f</bold>, As in <bold>a-b</bold>, but showing the number of differentially expressed genes detected by a Wilcoxon rank-sum test at 5% FDR, either across the entire transcriptome, <bold>e</bold>, or within each expression quintile, <bold>f</bold>. No differentially expressed genes are detected at 5% FDR outside of the top expression quintile.</p>
        <p id="P92"><bold>g-h</bold>, As in <bold>c-d</bold>, but showing the number of differentially expressed genes detected by a Wilcoxon rank-sum test at 5% FDR, either across the entire transcriptome, <bold>g</bold>, or within each expression quintile, <bold>h.</bold> No differentially expressed genes are detected at 5% FDR outside of the top expression quintile.</p>
        <p id="P93"><bold>i</bold>, Cell type prioritization in simulated scRNA-seq data from a tissue with 5,000 cells, distributed in eight cell types, with increasingly unequal numbers of cells per type, as quantified by the Gini coefficient and shown in <xref ref-type="fig" rid="F1">Fig. 1f</xref>. The correlation to simulation ground truth (proportion of DE genes) is shown for Augur and a representative test for single-cell DE (Wilcoxon rank-sum test). The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown.</p>
        <p id="P94"><bold>j</bold>, As in <bold>i</bold>, but with both Augur and the Wilcoxon rank-sum test applied to each quintile of gene expression separately.</p>
        <p id="P95"><bold>k</bold>, Pearson correlation between Augur cell type prioritizations (AUC) and simulation ground truth (proportion of DE genes) in simulated scRNA-seq data from tissue with eight cell types, subjected to perturbations of varying intensity, as quantified by the the location parameter of the differential expression factor log-normal distribution. The mean of <italic>n</italic> = 10 independent simulations is shown for each perturbation intensity..</p>
        <p id="P96"><bold>l</bold>, As in <bold>k</bold>, but with Augur applied to each quintile of gene expression separately. Augur incorporates information from lowly expressed genes even in subtle perturbations.</p>
        <p id="P97"><bold>m</bold>, Number of differentially expressed genes detected by a Wilcoxon rank-sum test at 5% FDR for each cell type in the Kang et al. dataset<sup><xref rid="R15" ref-type="bibr">15</xref></sup>, within each expression quintile, confirming the simulations in <bold>a-l</bold> reflect trends in real data.</p>
      </caption>
      <graphic xlink:href="EMS118049-f011"/>
    </fig>
    <fig id="F12" orientation="portrait" position="anchor">
      <label>Extended Data Fig. 10</label>
      <caption>
        <title>Impact of batch effects on cell type prioritization</title>
        <p id="P98">Two populations of cells (<italic>n</italic> = 200 cells total) were simulated, with each condition sequenced in two batches, and varying degrees of perturbation-dependent differential expression and/or technical batch effects were introduced according to five different batch effect scenarios. For each of the five scenarios, the following panels are shown from left to right:</p>
        <p id="P99"><italic>i</italic>, Principal component analysis (PCA) of a representative simulation.</p>
        <p id="P100"><italic>ii</italic>, Correlation between AUC and magnitude of simulated batch effect with 0% of genes differentially expressed in response to perturbation, reflecting the introduction of a spurious difference between conditions where none exists (inset, two-sided Pearson correlation).</p>
        <p id="P101"><italic>iii</italic>, Correlation between AUC and magnitude of simulated batch effect when the random forest classifier is tasked with predicting batch rather than condition (AUC<sub>batch</sub>), confirming the batch effect introduces the expected separability.</p>
        <p id="P102"><italic>iv</italic>, Correlation between proportion of genes differentially expressed in response to perturbation and AUC for simulated populations of cells with no batch effect, and batch effects of three different magnitudes.</p>
        <p id="P103"><italic>v</italic>, Cell type prioritizations in simulated populations of cells with varying perturbation intensity (% DE genes) and batch effect magnitudes.</p>
        <p id="P104"><italic>vi</italic>, As in <italic>i</italic>, but after computational batch effect correction by alignment of mutual nearest neighbors<sup><xref rid="R16" ref-type="bibr">16</xref></sup>.</p>
        <p id="P105"><italic>vii</italic>, As in <italic>v</italic>, but after computational batch effect correction by alignment of mutual nearest neighbors.</p>
        <p id="P106"><bold>a</bold>, Impact of batch effects on cell type prioritization when technical batch is unconfounded with either condition or differential expression.</p>
        <p id="P107"><bold>b</bold>, Impact of batch effects on cell type prioritization when batch #1 is twice as large as batch #2.</p>
        <p id="P108"><bold>c</bold>, Impact of batch effects on cell type prioritization when perturbation-dependent differential expression is stronger in one of the two batches.</p>
        <p id="P109"><bold>d</bold>, Impact of batch effects on cell type prioritization when technical batch is mildly confounded with condition (simulated cells are overrepresented in batch 1 by a factor of 20%).</p>
        <p id="P110"><bold>e</bold>, Impact of batch effects on cell type prioritization when technical batch is moderately confounded with condition (simulated cells are overrepresented in batch 1 by a factor of 50%).</p>
        <p id="P111"><bold>f</bold>, Impact of batch effects on cell type prioritization when technical batch is severely confounded with condition (simulated cells are overrepresented in batch 1 by a factor of 80%).</p>
      </caption>
      <graphic xlink:href="EMS118049-f012"/>
    </fig>
  </sec>
  <sec sec-type="supplementary-material" id="SM">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>Extended Data Figure 1</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_1.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1727" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>Extended Data Figure 2</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_2.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1731" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>Extended Data Figure 3</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_3.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1735" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>Extended Data Figure 4</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_4.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1739" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD5">
      <label>Extended Data Figure 5</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_5.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1743" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD6">
      <label>Extended Data Figure 6</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_6.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1747" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD7">
      <label>Extended Data Figure 7</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_7.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1751" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD8">
      <label>Extended Data Figure 8</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_8.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1755" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD9">
      <label>Extended Data Figure 9</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_9.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1759" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD10">
      <label>Extended Data Figure 10</label>
      <media xlink:href="EMS118049-supplement-Extended_Data_Figure_10.png" mimetype="image" mime-subtype="png" orientation="portrait" id="d40e1763" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD11">
      <label>Inventory of SI</label>
      <media xlink:href="EMS118049-supplement-Inventory_of_SI.docx" mimetype="application" mime-subtype="vnd.openxmlformats-officedocument.wordprocessingml.document" orientation="portrait" id="d40e1768" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD12">
      <label>Source Data</label>
      <media xlink:href="EMS118049-supplement-Source_Data.zip" mimetype="application" mime-subtype="zip" orientation="portrait" id="d40e1772" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD13">
      <label>Supplementary information</label>
      <media xlink:href="EMS118049-supplement-Supplementary_information.pdf" mimetype="application" mime-subtype="pdf" orientation="portrait" id="d40e1776" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S23">
    <title>Acknowledgements</title>
    <p>We thank D. Arneson, D. Avey, R. Mitra, A. Haber, O. Yilmaz, G. Chew, J. Polo, L. Adlung, I. Amit, D. Kim, D. Anderson, M. Basiri, R. Wirka, T. Quertermous, and F. Zhang for providing data and/or cell type annotations. This work was supported by a Consolidator Grant from the European Research Council [ERC-2015-CoG HOW2WALKAGAIN 682999] (to G.C.), the Swiss National Science Foundation (to G.C.; subside 310030_185214 and 310030_192558), Genome Canada and Genome British Columbia (to L.J.F.; project 214PRO), and Wings for Life (to M.A.S.). This work was also supported in part by the Intramural Research Program of the NIH, NINDS (to K.M. and A.L.). This work was enabled in part by the support provided by WestGrid and Compute Canada (to A.A.P. and L.J.F.), and through computational resources and services provided by Advanced Research Computing at the University of British Columbia (to L.J.F.). M.A.S. is supported by the Canadian Institutes of Health Research (CIHR) (Vanier Canada Graduate Scholarship, Michael Smith Foreign Study Supplement), an Izaak Walton Killam Memorial Pre-Doctoral Fellowship, a UBC Four Year Fellowship, a Vancouver Coastal Health–CIHR–UBC MD/PhD Studentship, a Brain Canada Hubert van Tol fellowship and a BCRegMed Collaborative Research Travel Grant. J.W.S. is supported by a CIHR Banting Postdoctoral fellowship.</p>
  </ack>
  <fn-group>
    <fn id="FN3" fn-type="con">
      <p id="P114">
        <bold>Author contributions</bold>
      </p>
      <p id="P115">M.A.S. and J.W.S. contributed equally to this work. M.A.S. and J.W.S. designed and implemented Augur, and performed all computational analyses. M.A.S., J.W.S., and M.G. processed published datasets. J.W.S., C.K., M.A.A., T.H.H., and M.M. performed experimental validation work, including viral tract tracing and RNAscope. C.K., K.J.E.M., and A.J.L. performed nucleus extraction and single-nucleus RNA-seq. M.G. and Q.B. analyzed experimental validation data. A.A.P., L.J.F., G.L.M., and G.C. supervised the work. M.A.S., J.W.S., and G.C. wrote the manuscript. All authors contributed to its editing.</p>
    </fn>
    <fn fn-type="COI-statement" id="FN4">
      <p id="P116">
        <bold>Competing interests</bold>
      </p>
      <p id="P117">G.C. is a founder and shareholder of GTXmedical, a company with no direct relationships with the present work. M.A.S., J.W.S., and G.C. are named as co-inventors on a patent application related to this work.</p>
    </fn>
  </fn-group>
  <sec id="S24" sec-type="data-availability">
    <title>Code availability</title>
    <p id="P112">Augur is available from GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/neurorestore/Augur">https://github.com/neurorestore/Augur</ext-link>) and as <xref ref-type="supplementary-material" rid="SD12">Supplementary Software 1</xref>.</p>
  </sec>
  <sec id="S25" sec-type="data-availability">
    <title>Data availability</title>
    <p id="P113">Raw sequencing data and count matrices have been deposited to the Gene Expression Omnibus (GSE142245).</p>
  </sec>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tang</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>mRNA-Seq whole-transcriptome analysis of a single cell</article-title>
        <source>Nat Methods</source>
        <year>2009</year>
        <volume>6</volume>
        <fpage>377</fpage>
        <lpage>382</lpage>
        <pub-id pub-id-type="pmid">19349980</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cao</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive single-cell transcriptional profiling of a multicellular organism</article-title>
        <source>Science</source>
        <year>2017</year>
        <volume>357</volume>
        <fpage>661</fpage>
        <lpage>667</lpage>
        <pub-id pub-id-type="pmid">28818938</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mathys</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptomic analysis of Alzheimer’s disease</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>570</volume>
        <fpage>332</fpage>
        <lpage>337</lpage>
        <pub-id pub-id-type="pmid">31042697</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kang</surname>
            <given-names>HM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplexed droplet single-cell RNA-sequencing using natural genetic variation</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>89</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="pmid">29227470</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Soneson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Robinson</surname>
            <given-names>MD</given-names>
          </name>
        </person-group>
        <article-title>Bias, robustness and scalability in single-cell differential expression analysis</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>255</fpage>
        <lpage>261</lpage>
        <pub-id pub-id-type="pmid">29481549</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rossi</surname>
            <given-names>MA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Obesity remodels activity and transcriptional state of a lateral hypothalamic brake on feeding</article-title>
        <source>Science</source>
        <year>2019</year>
        <volume>364</volume>
        <fpage>1271</fpage>
        <lpage>1274</lpage>
        <pub-id pub-id-type="pmid">31249056</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hrvatin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analysis of experience-dependent transcriptomic states in the mouse visual cortex</article-title>
        <source>Nat Neurosci</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>120</fpage>
        <lpage>129</lpage>
        <pub-id pub-id-type="pmid">29230054</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Avey</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-Cell RNA-Seq Uncovers a Robust Transcriptional Response to Morphine by Glia</article-title>
        <source>Cell Rep</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>3619</fpage>
        <lpage>3629.e4</lpage>
        <pub-id pub-id-type="pmid">30257220</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Jiang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Single-Cell RNA-Seq Reveals Hypothalamic Cell Diversity</article-title>
        <source>Cell Rep</source>
        <year>2017</year>
        <volume>18</volume>
        <fpage>3227</fpage>
        <lpage>3241</lpage>
        <pub-id pub-id-type="pmid">28355573</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grubman</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell atlas of entorhinal cortex from individuals with Alzheimer’s disease reveals cell-type-specific gene expression regulation</article-title>
        <source>Nat Neurosci</source>
        <year>2019</year>
        <volume>22</volume>
        <fpage>2087</fpage>
        <lpage>2097</lpage>
        <pub-id pub-id-type="pmid">31768052</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hagai</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene expression variability across cells and species shapes innate immunity</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>563</volume>
        <fpage>197</fpage>
        <lpage>202</lpage>
        <pub-id pub-id-type="pmid">30356220</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mostafavi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Parsing the interferon transcriptional network and its disease associations</article-title>
        <source>Cell</source>
        <year>2016</year>
        <volume>164</volume>
        <fpage>564</fpage>
        <lpage>578</lpage>
        <pub-id pub-id-type="pmid">26824662</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>361</volume>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Droplet-based combinatorial indexing for massive-scale single-cell chromatin accessibility</article-title>
        <source>Nat Biotechnol</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>916</fpage>
        <lpage>924</lpage>
        <pub-id pub-id-type="pmid">31235917</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reyes</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplexed enrichment and genomic profiling of peripheral blood cells reveal subset-specific immune signatures</article-title>
        <source>Sci Adv</source>
        <year>2019</year>
        <volume>5</volume>
        <fpage>eaau9223</fpage>
        <pub-id pub-id-type="pmid">30746468</pub-id>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moffitt</surname>
            <given-names>JR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular, spatial, and functional single-cell profiling of the hypothalamic preoptic region</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>362</volume>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gunner</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Sensory lesioning induces microglial synapse elimination via ADAM10 and fractalkine signaling</article-title>
        <source>Nat Neurosci</source>
        <year>2019</year>
        <volume>22</volume>
        <fpage>1075</fpage>
        <lpage>1088</lpage>
        <pub-id pub-id-type="pmid">31209379</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNA velocity of single cells</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>560</volume>
        <fpage>494</fpage>
        <lpage>498</lpage>
        <pub-id pub-id-type="pmid">30089906</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Erhard</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>scSLAM-seq reveals core features of transcription dynamics in single cells</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>571</volume>
        <fpage>419</fpage>
        <lpage>423</lpage>
        <pub-id pub-id-type="pmid">31292545</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Courtine</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transformation of nonfunctional spinal circuits into functional states after the loss of brain input</article-title>
        <source>Nat Neurosci</source>
        <year>2009</year>
        <volume>12</volume>
        <fpage>1333</fpage>
        <lpage>1342</lpage>
        <pub-id pub-id-type="pmid">19767747</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wagner</surname>
            <given-names>FB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Targeted neurotechnology restores walking in humans with spinal cord injury</article-title>
        <source>Nature</source>
        <year>2018</year>
        <volume>563</volume>
        <fpage>65</fpage>
        <lpage>71</lpage>
        <pub-id pub-id-type="pmid">30382197</pub-id>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Formento</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Electrical spinal cord stimulation must preserve proprioception to enable locomotion in humans with spinal cord injury</article-title>
        <source>Nat Neurosci</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>1728</fpage>
        <lpage>1741</lpage>
        <pub-id pub-id-type="pmid">30382196</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Crone</surname>
            <given-names>SA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genetic ablation of V2a ipsilateral interneurons disrupts left-right locomotor coordination in mammalian spinal cord</article-title>
        <source>Neuron</source>
        <year>2008</year>
        <volume>60</volume>
        <fpage>70</fpage>
        <lpage>83</lpage>
        <pub-id pub-id-type="pmid">18940589</pub-id>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>V1 and v2b interneurons secure the alternating flexor-extensor motor activity mice require for limbed locomotion</article-title>
        <source>Neuron</source>
        <year>2014</year>
        <volume>82</volume>
        <fpage>138</fpage>
        <lpage>150</lpage>
        <pub-id pub-id-type="pmid">24698273</pub-id>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Crowell</surname>
            <given-names>HL</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>On the discovery of population-specific state transitions from multi-sample multi-condition single-cell RNA sequencing data</article-title>
        <source>BioRxiv</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1101/713412</pub-id>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yip</surname>
            <given-names>SH</given-names>
          </name>
          <name>
            <surname>Sham</surname>
            <given-names>PC</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Evaluation of tools for highly variable gene discovery from single-cell RNA-seq data</article-title>
        <source>Brief Bioinformatics</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>1583</fpage>
        <lpage>1589</lpage>
        <pub-id pub-id-type="pmid">29481632</pub-id>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brennecke</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Accounting for technical noise in single-cell RNA-seq experiments</article-title>
        <source>Nat Methods</source>
        <year>2013</year>
        <volume>10</volume>
        <fpage>1093</fpage>
        <lpage>1095</lpage>
        <pub-id pub-id-type="pmid">24056876</pub-id>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grün</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kester</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Oudenaarden</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Validation of noise models for single-cell transcriptomics</article-title>
        <source>Nat Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>637</fpage>
        <lpage>640</lpage>
        <pub-id pub-id-type="pmid">24747814</pub-id>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Integration of Single-Cell Data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cao</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The single-cell transcriptional landscape of mammalian organogenesis</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>566</volume>
        <fpage>496</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="pmid">30787437</pub-id>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amezquita</surname>
            <given-names>RA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Orchestrating single-cell analysis with Bioconductor</article-title>
        <source>Nat Methods</source>
        <year>2020</year>
        <volume>17</volume>
        <fpage>137</fpage>
        <lpage>145</lpage>
        <pub-id pub-id-type="pmid">31792435</pub-id>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>LI</given-names>
          </name>
        </person-group>
        <article-title>A concordance correlation coefficient to evaluate reproducibility</article-title>
        <source>Biometrics</source>
        <year>1989</year>
        <volume>45</volume>
        <fpage>255</fpage>
        <lpage>268</lpage>
        <pub-id pub-id-type="pmid">2720055</pub-id>
      </element-citation>
    </ref>
    <ref id="R33">
      <label>33</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Phipson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Smyth</surname>
            <given-names>GK</given-names>
          </name>
        </person-group>
        <article-title>Permutation P-values should never be zero: calculating exact P-values when permutations are randomly drawn</article-title>
        <source>Stat Appl Genet Mol Biol</source>
        <year>2010</year>
        <volume>9</volume>
        <issue>39</issue>
      </element-citation>
    </ref>
    <ref id="R34">
      <label>34</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zappia</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Phipson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Oshlack</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Splatter: simulation of single-cell RNA sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2017</year>
        <volume>18</volume>
        <fpage>174</fpage>
        <pub-id pub-id-type="pmid">28899397</pub-id>
      </element-citation>
    </ref>
    <ref id="R35">
      <label>35</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McDavid</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Data exploration, quality control and testing in single-cell qPCR-based gene expression experiments</article-title>
        <source>Bioinformatics</source>
        <year>2013</year>
        <volume>29</volume>
        <fpage>461</fpage>
        <lpage>467</lpage>
        <pub-id pub-id-type="pmid">23267174</pub-id>
      </element-citation>
    </ref>
    <ref id="R36">
      <label>36</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ntranos</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Yi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Melsted</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>A discriminative learning approach to differential expression analysis for single-cell RNA-seq</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>163</fpage>
        <lpage>166</lpage>
        <pub-id pub-id-type="pmid">30664774</pub-id>
      </element-citation>
    </ref>
    <ref id="R37">
      <label>37</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finak</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2015</year>
        <volume>16</volume>
        <fpage>278</fpage>
        <pub-id pub-id-type="pmid">26653891</pub-id>
      </element-citation>
    </ref>
    <ref id="R38">
      <label>38</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ziegenhain</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comparative Analysis of Single-Cell RNA Sequencing Methods</article-title>
        <source>Mol Cell</source>
        <year>2017</year>
        <volume>65</volume>
        <fpage>631</fpage>
        <lpage>643.e4</lpage>
        <pub-id pub-id-type="pmid">28212749</pub-id>
      </element-citation>
    </ref>
    <ref id="R39">
      <label>39</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haghverdi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>421</fpage>
        <lpage>427</lpage>
        <pub-id pub-id-type="pmid">29608177</pub-id>
      </element-citation>
    </ref>
    <ref id="R40">
      <label>40</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Petukhov</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>dropEst: pipeline for accurate estimation of molecular counts in droplet-based single-cell RNA-seq experiments</article-title>
        <source>Genome Biol</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>78</fpage>
        <pub-id pub-id-type="pmid">29921301</pub-id>
      </element-citation>
    </ref>
    <ref id="R41">
      <label>41</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dobin</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>STAR: ultrafast universal RNA-seq aligner</article-title>
        <source>Bioinformatics</source>
        <year>2013</year>
        <volume>29</volume>
        <fpage>15</fpage>
        <lpage>21</lpage>
        <pub-id pub-id-type="pmid">23104886</pub-id>
      </element-citation>
    </ref>
    <ref id="R42">
      <label>42</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heimberg</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Bhatnagar</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>El-Samad</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Thomson</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Low Dimensionality in Gene Expression Data Enables the Accurate Extraction of Transcriptional Programs from Shallow Sequencing</article-title>
        <source>Cell Syst</source>
        <year>2016</year>
        <volume>2</volume>
        <fpage>239</fpage>
        <lpage>250</lpage>
        <pub-id pub-id-type="pmid">27135536</pub-id>
      </element-citation>
    </ref>
    <ref id="R43">
      <label>43</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Griffiths</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Richard</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Bach</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Detection and removal of barcode swapping in single-cell RNA-seq data</article-title>
        <source>Nat Commun</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>2667</fpage>
        <pub-id pub-id-type="pmid">29991676</pub-id>
      </element-citation>
    </ref>
    <ref id="R44">
      <label>44</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Scheff</surname>
            <given-names>SW</given-names>
          </name>
          <name>
            <surname>Rabchevsky</surname>
            <given-names>AG</given-names>
          </name>
          <name>
            <surname>Fugaccia</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Main</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Lumpp</surname>
            <given-names>JE</given-names>
          </name>
        </person-group>
        <article-title>Experimental modeling of spinal cord injury: characterization of a force-defined injury device</article-title>
        <source>J Neurotrauma</source>
        <year>2003</year>
        <volume>20</volume>
        <fpage>179</fpage>
        <lpage>193</lpage>
        <pub-id pub-id-type="pmid">12675971</pub-id>
      </element-citation>
    </ref>
    <ref id="R45">
      <label>45</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Squair</surname>
            <given-names>JW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated systems analysis reveals conserved gene networks underlying response to spinal cord injury</article-title>
        <source>Elife</source>
        <year>2018</year>
        <volume>7</volume>
      </element-citation>
    </ref>
    <ref id="R46">
      <label>46</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sathyamurthy</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively Parallel Single Nucleus Transcriptional Profiling Defines Spinal Cord Neurons and Their Activity during Behavior</article-title>
        <source>Cell Rep</source>
        <year>2018</year>
        <volume>22</volume>
        <fpage>2216</fpage>
        <lpage>2225</lpage>
        <pub-id pub-id-type="pmid">29466745</pub-id>
      </element-citation>
    </ref>
    <ref id="R47">
      <label>47</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>
        <source>BioRxiv</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1101/576827</pub-id>
      </element-citation>
    </ref>
    <ref id="R48">
      <label>48</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zappia</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Oshlack</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Clustering trees: a visualization for evaluating clusterings at multiple resolutions</article-title>
        <source>Gigascience</source>
        <year>2018</year>
        <volume>7</volume>
      </element-citation>
    </ref>
    <ref id="R49">
      <label>49</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rosenberg</surname>
            <given-names>AB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell profiling of the developing mouse brain and spinal cord with split-pool barcoding</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>360</volume>
        <fpage>176</fpage>
        <lpage>182</lpage>
        <pub-id pub-id-type="pmid">29545511</pub-id>
      </element-citation>
    </ref>
    <ref id="R50">
      <label>50</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Häring</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Neuronal atlas of the dorsal horn defines its architecture and links sensory input to transcriptional cell types</article-title>
        <source>Nat Neurosci</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>869</fpage>
        <lpage>880</lpage>
        <pub-id pub-id-type="pmid">29686262</pub-id>
      </element-citation>
    </ref>
    <ref id="R51">
      <label>51</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular architecture of the mouse nervous system</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>999</fpage>
        <lpage>1014.e22</lpage>
        <pub-id pub-id-type="pmid">30096314</pub-id>
      </element-citation>
    </ref>
    <ref id="R52">
      <label>52</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grimm</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>In vitro and in vivo gene therapy vector evolution via multispecies interbreeding and retargeting of adeno-associated viruses</article-title>
        <source>J Virol</source>
        <year>2008</year>
        <volume>82</volume>
        <fpage>5887</fpage>
        <lpage>5911</lpage>
        <pub-id pub-id-type="pmid">18400866</pub-id>
      </element-citation>
    </ref>
    <ref id="R53">
      <label>53</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anderson</surname>
            <given-names>MA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Astrocyte scar formation aids central nervous system axon regeneration</article-title>
        <source>Nature</source>
        <year>2016</year>
        <volume>532</volume>
        <fpage>195</fpage>
        <lpage>200</lpage>
        <pub-id pub-id-type="pmid">27027288</pub-id>
      </element-citation>
    </ref>
    <ref id="R54">
      <label>54</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Asboth</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cortico-reticulo-spinal circuit reorganization enables functional recovery after severe spinal cord contusion</article-title>
        <source>Nat Neurosci</source>
        <year>2018</year>
        <volume>21</volume>
        <fpage>576</fpage>
        <lpage>588</lpage>
        <pub-id pub-id-type="pmid">29556028</pub-id>
      </element-citation>
    </ref>
    <ref id="R55">
      <label>55</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>RNAscope: a novel in situ RNA analysis platform for formalin-fixed, paraffin-embedded tissues</article-title>
        <source>J Mol Diagn</source>
        <year>2012</year>
        <volume>14</volume>
        <fpage>22</fpage>
        <lpage>29</lpage>
        <pub-id pub-id-type="pmid">22166544</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Fig. 1</label>
    <caption>
      <title>Augur correctly prioritizes cell types in synthetic and experimental single-cell datasets.</title>
      <p><bold>a</bold>, Schematic overview of Augur. <bold>b</bold>, AUCs of Augur and a naive random forest classifier without subsampling in simulated scRNA-seq datasets containing increasing numbers of cells. Cell type prioritizations are confounded by training dataset size for the naive classifier, but Augur abolishes this confounding factor. The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown. Dotted lines show linear regression; shaded areas show 95% confidence intervals. <bold>c</bold>, Pearson correlations between the AUC of each cell type, and the number of cells of that type sequenced, across a compendium of 22 scRNA-seq datasets, for Augur and a naive random forest classifier without subsampling. <bold>d</bold>, Augur AUCs scale monotonically with both the proportion of DE genes and the magnitude of DE in simulated cell populations of <italic>n</italic> = 200 cells. <bold>e</bold>, Relationship between number of DE genes detected by a representative test for single-cell differential gene expression (Wilcoxon rank-sum test), and the proportion of DE genes simulated between the two populations, for simulated populations of between <italic>n</italic> = 100 and <italic>n</italic> = 1,000 cells. <bold>f</bold>, Cell type prioritization in simulated scRNA-seq data from a tissue with 5,000 cells, eight cell types and increasingly unequal numbers of cells per type, as quantified by the Gini coefficient. The Pearson correlation to the simulation ground truth (proportion of DE genes) is shown for Augur and a representative test for single-cell DE (Wilcoxon rank-sum test). The mean and standard deviation of <italic>n</italic> = 10 independent simulations are shown. Dashed line shows mean cell type Gini coefficient across <italic>n</italic> = 22 published scRNA-seq datasets (0.52). **, p &lt; 0.01; ***, p &lt; 0.001, two-sided paired t-test. <bold>g</bold>, Pearson correlation between cell type prioritizations (AUC/number of DE genes) and simulation ground truth for Augur and six tests for single-cell DE in simulated tissues containing eight cell types (<italic>n</italic> = 5,000 cells) with a cell type Gini coefficient of 0.50, approximately equal to the mean of 0.52 in 22 published scRNA-seq datasets. <bold>h</bold>, Cell type prioritizations of bone marrow-derived mononuclear phagocytes from four species stimulated with LPS for between two and six hours for Augur and a representative test for single-cell DE (Wilcoxon rank-sum test). <bold>i</bold>, Pearson correlation between cell type prioritizations and duration of LPS exposure for Augur and six tests for single-cell DE (in the same order as in <bold>g</bold>). Pearson correlations with a two-sided p-value less than 0.05 are shown in orange. <bold>j</bold>, Left, Augur cell type prioritizations mirror the number of DE genes in a microarray dataset of FACS-purified cells (two-sided Pearson correlation, <italic>n</italic> = 6 cell types matching between bulk and single-cell datasets). Right, the number of DE genes detected in the scRNA-seq dataset by a Wilcoxon rank-sum test is uncorrelated with the FACS gold standard. <bold>k</bold>, Pearson correlation between cell type prioritizations and the FACS gold standard for Augur and six tests for single-cell DE (<italic>n</italic> = 6 cell types matching between bulk and single-cell datasets). Pearson correlations with a two-sided p-value less than 0.05 are shown in orange. <bold>l</bold>, Reproducibility of cell type prioritization in two independent studies of Alzheimer’s disease (<italic>n</italic> = 6 cell types matching between single-cell datasets, two-sided Pearson correlation). <bold>m</bold>, Augur cell type prioritizations in a scATAC-seq dataset track with the number of DE genes in an RNA-seq dataset of FACS-purified cells (<italic>n</italic> = 3 cell types matching between bulk and single-cell data).</p>
    </caption>
    <graphic xlink:href="EMS118049-f001"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Fig. 2</label>
    <caption>
      <title>Augur identifies neuron subtypes that enable walking after paralysis.</title>
      <p><bold>a</bold>, Top, single-nucleus RNA-sequencing experimental design to prioritize neuron subtypes recruited by TESS. Middle, chronophotography of mice in the presence or absence of TESS and monoaminergic agonists. Bottom, stick diagram decompositions of right leg movements; leg endpoint trajectory with acceleration at toe-off; activity of extensor and flexor muscles of the ankle. <bold>b</bold>, Principal component analysis (<italic>n</italic> = 3 mice) of gait parameters for each condition (small circles). Large circles show the average per group. <bold>c</bold>, Bar plot shows the average scores on principal component 1 (PC1), which quantify the locomotor performance of paralyzed mice (<italic>n</italic> = 3) and mice walking with TESS (<italic>n</italic> = 3). <bold>d</bold>, Uniform manifold approximation and projection (UMAP) visualization of 18,514 nuclei, revealing the six major cell types of the mouse lumbar spinal cord. <bold>e</bold>, UMAP visualization of 6,035 neurons subjected to an additional round of sub-clustering and the 39 identified neuron subtypes. <bold>f</bold>, UMAP visualization of 6,035 neurons, colored by Augur cell type prioritization (AUC). The seven prioritized neuron subtypes with the highest AUCs are highlighted. <bold>g</bold>, Monosynaptically restricted anterograde tracing in Vsx2-Cre mice reveals V2a interneurons densely innervating motor neurons (ChAT). Similar results were obtained from three independent experiments. <bold>h</bold>, Dot plot showing expression of the immediate early gene Fos in neuron subtypes prioritized by Augur. <bold>i</bold>, Confirmation of colocalization of V2a, V1/V2b, and Spp1 marker genes (Vsx2, Slc6a5, and Spp1 respectively) and Fos by RNAscope <italic>in situ</italic> hybridization. Schematic indicates location of imaging for each marker within the spinal cord to aid specificity. Similar results were obtained from two independent experiments.</p>
    </caption>
    <graphic xlink:href="EMS118049-f002"/>
  </fig>
</floats-group>
