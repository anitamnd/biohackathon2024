<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10868326</article-id>
    <article-id pub-id-type="pmid">38269623</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae042</article-id>
    <article-id pub-id-type="publisher-id">btae042</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>HiPhase: jointly phasing small, structural, and tandem repeat variants from HiFi sequencing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6411-9236</contrib-id>
        <name>
          <surname>Holt</surname>
          <given-names>James M</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
        <xref rid="btae042-cor1" ref-type="corresp"/>
        <!--mholt@pacificbiosciences.com-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-0726-7600</contrib-id>
        <name>
          <surname>Saunders</surname>
          <given-names>Christopher T</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7422-1194</contrib-id>
        <name>
          <surname>Rowell</surname>
          <given-names>William J</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7627-9808</contrib-id>
        <name>
          <surname>Kronenberg</surname>
          <given-names>Zev</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-1183-0432</contrib-id>
        <name>
          <surname>Wenger</surname>
          <given-names>Aaron M</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8965-1253</contrib-id>
        <name>
          <surname>Eberle</surname>
          <given-names>Michael</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Cowen</surname>
          <given-names>Lenore</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae042-cor1">Corresponding author. Computational Biology, PacBio, 1305 O'Brien Drive, Menlo Park, CA 94025, United States. E-mail: <email>mholt@pacificbiosciences.com</email> (J.M.H.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-01-25">
      <day>25</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>25</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>2</issue>
    <elocation-id>btae042</elocation-id>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>5</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>13</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>17</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>07</day>
        <month>2</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae042.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>In diploid organisms, phasing is the problem of assigning the alleles at heterozygous variants to one of two haplotypes. Reads from PacBio HiFi sequencing provide long, accurate observations that can be used as the basis for both calling and phasing variants. HiFi reads also excel at calling larger classes of variation, such as structural or tandem repeat variants. However, current phasing tools typically only phase small variants, leaving larger variants unphased.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We developed HiPhase, a tool that jointly phases SNVs, indels, structural, and tandem repeat variants. The main benefits of HiPhase are (i) dual mode allele assignment for detecting large variants, (ii) a novel application of the A*-algorithm to phasing, and (iii) logic allowing phase blocks to span breaks caused by alignment issues around reference gaps and homozygous deletions. In our assessment, HiPhase produced an average phase block NG50 of 480 kb with 929 switchflip errors and fully phased 93.8% of genes, improving over the current state of the art. Additionally, HiPhase jointly phases SNVs, indels, structural, and tandem repeat variants and includes innate multi-threading, statistics gathering, and concurrent phased alignment output generation.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>HiPhase is available as source code and a pre-compiled Linux binary with a user guide at <ext-link xlink:href="https://github.com/PacificBiosciences/HiPhase" ext-link-type="uri">https://github.com/PacificBiosciences/HiPhase</ext-link>.</p>
      </sec>
    </abstract>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>For human genomics, phasing variants within a gene is a critical aspect of clinical testing for pharmacogenomics (<xref rid="btae042-B2" ref-type="bibr">Caspar <italic toggle="yes">et al.</italic> 2021</xref>), HLA typing (<xref rid="btae042-B9" ref-type="bibr">Mayor <italic toggle="yes">et al.</italic> 2019</xref>), and autosomal recessive conditions (<xref rid="btae042-B13" ref-type="bibr">Tewhey <italic toggle="yes">et al.</italic> 2011</xref>). Additionally, automated tertiary analysis tools can benefit from knowing whether two variants are in <italic toggle="yes">cis</italic> or <italic toggle="yes">trans</italic> within a gene, potentially reducing the time for clinical analysts to reach a molecular diagnosis (<xref rid="btae042-B3" ref-type="bibr">Danecek and McCarthy 2017</xref>). Beyond clinical diagnostics, there are many additional applications of phasing in genomics, many of which are summarized in a review by <xref rid="btae042-B1" ref-type="bibr">Browning and Browning (2011)</xref>.</p>
    <p>Haplotype phasing generally falls into three categories: statistical phasing (<xref rid="btae042-B1" ref-type="bibr">Browning and Browning 2011</xref>), pedigree-based phasing (<xref rid="btae042-B1" ref-type="bibr">Browning and Browning 2011</xref>), and read-backed phasing (<xref rid="btae042-B12" ref-type="bibr">Snyder <italic toggle="yes">et al.</italic> 2015</xref>). For read-backed phasing, each read is mapped to a reference genome and variants are called from the read mappings. The alleles of heterozygous variants are phased into a single diplotype composed of two haplotypes. Once phased, the variants can be fed into various tertiary analysis tools for downstream analyses. In practice, reads that are long and accurate, such as PacBio HiFi reads (<xref rid="btae042-B15" ref-type="bibr">Wenger <italic toggle="yes">et al.</italic> 2019</xref>), include a large number of informative bases (more than one per 1 kb of read length) overlapping heterozygous variants making them ideal for variant calling followed by read-backed phasing.</p>
    <p>For long reads, WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>) is the most prominent read-backed phaser and the <italic toggle="yes">de facto</italic> standard in the field for phasing single-nucleotide variants (SNVs) and short indels. WhatsHap uses a “fixed parameter tractable approach,” meaning that it down-samples the sequencing reads to a fixed coverage value, to phase the heterozygous variants (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). Despite being generally efficient and accurate for phasing a human genome, WhatsHap does have some notable limitations: (i) it down-samples the data in order to run efficiently, potentially biasing the data; (ii) multi-allelic variants (sites with two or more non-reference alleles) are not phased; (iii) it does not span gaps in coverage caused by large deletions or reference gaps; (iv) it is single-threaded, so parallel processing requires some engineering overhead; and (v) it was designed primarily for small variants like SNVs and short indels. Recently, some tools have focused on that last limitation by either overlaying structural variants (insertions and deletions <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mo>≥</mml:mo></mml:math></inline-formula>50 bp) on the WhatsHap phase blocks (<xref rid="btae042-B7" ref-type="bibr">Mahmoud <italic toggle="yes">et al.</italic> 2021</xref>) or jointly phasing SNVs and structural variants, but not short indels (<xref rid="btae042-B6" ref-type="bibr">Lin <italic toggle="yes">et al.</italic> 2022</xref>). To our knowledge, no tool officially supports tandem repeat variants. This creates a notable gap for a tool that jointly phases SNVs, indels, structural, and tandem repeat variants.</p>
    <p>Here, we introduce HiPhase, a new tool that jointly phases SNVs, indels, structural, and tandem repeat variants called from PacBio HiFi sequencing on diploid organisms. HiPhase uses two novel approaches to solve the phasing problem: (i) dual mode allele assignment and (ii) a phasing algorithm based on the A* search algorithm (<xref rid="btae042-B5" ref-type="bibr">Hart <italic toggle="yes">et al.</italic> 1968</xref>). HiPhase offers additional benefits, such as: (i) no down-sampling of the data, (ii) support for multi-allelic variation, (iii) logic to span coverage gaps with supplementary alignments, (iv) innate multi-threading, (v) built-in statistics gathering, and (vi) support for assigning aligned reads to a haplotype (“haplotagging”) while phasing. In our assessment, HiPhase produced an average phase block NG50 of 480 kb with 929 switchflip errors and fully phased 93.8% of genes.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>HiPhase breaks the phasing problem into three major components: phase block generation, allele assignment, and diplotype solving.</p>
    <sec>
      <title>2.1 Phase block generation</title>
      <p>Phase block generation works by identifying pairs of consecutive heterozygous variant calls connected by at least one read mapping. A phase block is initialized by taking the first available variant on a chromosome and creating a single-variant block from it. Then, the next variant is loaded and HiPhase searches for mappings that span both that new variant and the current block. If no mappings span both, the algorithm will then check for supplementary mappings from the new variant into the current block. This supplementary mapping check allows HiPhase to span coverage gaps caused by homozygous deletions and reference gaps. If at least one spanning or supplementary mapping is identified, then, the current phase block is extended to include the variant. Otherwise, the current block is returned as a putative phase block and a new single-variant block is initialized from the new variant. This process repeats until all heterozygous variants on the chromosome are consumed.</p>
      <p>Each putative phase block acts as an isolated sub-problem in the full solution. Because the putative blocks are unconnected by the read mappings at their ends, they represent a lower-bound on the number of phase blocks in the final solution. Importantly, each sub-problem can be solved independently, allowing for allele assignment and diplotype solving to be performed in parallel for each putative phase block. This forms the basis for multi-threading in HiPhase.</p>
    </sec>
    <sec>
      <title>2.2 Allele assignment</title>
      <p>Allele assignment converts all read mappings within a putative phase block into condensed allelic observations, which are chains of reference or alternate alleles corresponding to the observed alleles within a particular read mapping. This simplifies a long-read sequence down to a smaller set of integer values representing alleles that are present within the read. We refer to these assignments as reference or alternate alleles, but HiPhase also allows for ambiguity, unassigned alleles, and multi-allelic variation (two different alternate alleles at one position). Additionally, each observed allele is assigned a “weight” indicating the cost to alter or ignore that allele in the diplotype solving step.</p>
      <p>HiPhase has two modes for allele assignment: local re-alignment and global re-alignment. In brief, local re-alignment assigns alleles and quality based on a small window around each variant position, which is conceptually similar to the allele assignment process of WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). In contrast, global re-alignment will fully re-align the mapping against a local alt-aware reference graph using a graph-aware version of the wavefront algorithm (<xref rid="btae042-B8" ref-type="bibr">Marco-Sola <italic toggle="yes">et al.</italic> 2020</xref>). In general, local re-alignment is a faster process, but it is ill-suited for accurate allele assignment for large structural and tandem repeat variants and even some smaller indels. Global re-alignment tends to be slower but is more accurate when it comes to allele assignment, especially around structural and tandem repeat variants. Finally, HiPhase implements a “dual mode” allele assignment where if global re-alignment is too slow, it will fall back on local re-alignment for the phase block.</p>
      <p>Once all mappings have been converted to a condensed allele representation, HiPhase collapses mappings with the same read name into a single entry. The primary purpose of this step is to create a bridge between supplementary mappings that span a gap in coverage. This allows HiPhase to cross deletion events and reference gaps bridged by split read mappings. If the mappings for one read overlap but have a conflicting allele assignment, then that allele is converted to an ambiguous allele assignment in the collapsed representation. In the end, each read is represented exactly once in the collection of condensed alleles for the phase block.</p>
    </sec>
    <sec>
      <title>2.3 Diplotype solving</title>
      <p>Diplotype solving distills the condensed allelic observations into two representative haplotypes that are expected to complement each other (i.e. where one is the reference allele, the other is the alternate allele). For our purposes, we define the core diplotype solving problem as a slight reformulation of the weighted minimum error correction (wMEC) problem as described previously (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). Given a matrix, where each row corresponds to the condensed allele representation of one read in the phase block, the goal is to find two haplotypes, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, such that the cost of changing each row to exactly match either <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> or <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is minimized. We refer the reader to <xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> (2015)</xref> for greater technical details around this and other formulations of the phasing/wMEC problem.</p>
      <p>HiPhase uses a version of the A* search algorithm (<xref rid="btae042-B5" ref-type="bibr">Hart <italic toggle="yes">et al.</italic> 1968</xref>) to search for the optimal diplotype. In general, A* search algorithms explore a given search space by iteratively expanding the current lowest cost option based on both an observed cost and heuristic cost estimate. In HiPhase, the search space is all possible diplotype solutions modeled as a search tree, and the heuristic is generated by chaining sub-problem solutions. While increased coverage and variant density will increase the run-time of this algorithm, in practice, we find that HiPhase can operate efficiently on the typical 30× human whole genome without down-sampling. Greater details on all HiPhase methods, heuristics, and limitations can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
    <sec>
      <title>2.4 Data</title>
      <p>The following sections outline public resources used in our analysis. Details on and links to each can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
      <sec>
        <title>2.4.1 Benchmark datasets</title>
        <p>For benchmarking phase accuracy, we used publicly available Genome in a Bottle phased variant sets v4.2.1 (GRCh38) for HG001, HG002, and HG005 (<xref rid="btae042-B14" ref-type="bibr">Wagner <italic toggle="yes">et al.</italic> 2022</xref>). We note that these files are limited to human autosomes, and do not provide phasing information for structural variants.</p>
      </sec>
      <sec>
        <title>2.4.2 HiFi sequencing datasets</title>
        <p>We used publicly available whole genome, HiFi sequencing datasets for evaluating HiPhase. Three replicates for the sample HG002 sequenced to ∼30-fold coverage on the Revio system were obtained from <ext-link xlink:href="https://downloads.pacbcloud.com/public/revio/2022Q4/" ext-link-type="uri">https://downloads.pacbcloud.com/public/revio/2022Q4/</ext-link>.</p>
      </sec>
      <sec>
        <title>2.4.3 Pre-processing</title>
        <p>We followed the recommended practices for pre-processing our HiFi datasets through variant calling. In brief, we aligned reads to GRCh38 using <monospace>pbmm2</monospace> and then performed variant calling with DeepVariant with the PacBio model (<xref rid="btae042-B11" ref-type="bibr">Poplin <italic toggle="yes">et al.</italic> 2018</xref>), <monospace>pbsv</monospace>, and TRGT (<xref rid="btae042-B4" ref-type="bibr">Dolzhenko <italic toggle="yes">et al.</italic> 2023</xref>).</p>
      </sec>
    </sec>
    <sec>
      <title>2.5 Phasing metrics</title>
      <p>We measured the quantity of phasing errors with switches and flips (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). To measure phase block length, we calculated NG50 using GRCh38 for reference length. We additionally gathered the total number of phased variants, number of phased structural and tandem repeat variants (HiPhase only), and the percentage of fully phased genes. We note that NG50 and number of phased variants are measured using tool-specific outputs. All analyses were performed across the full autosomes. Further details on how all metrics are defined, calculated, and collected are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
    <sec>
      <title>2.6 Tool descriptions</title>
      <p>We focus our analyses on comparing the current approach for HiFi read-backed phasing, WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>), to our new tool, HiPhase. For WhatsHap, we provide small variants from DeepVariant and instruct the tool to phase both SNVs and indels. For HiPhase, we provide the same DeepVariant VCF file, a structural variant VCF file from <monospace>pbsv</monospace>, and a tandem repeat variant VCF file from TRGT. We set HiPhase to use global re-alignment (see Section 2.2), which is our recommended approach for phasing with structural variants. Additional results for other modes of running both WhatsHap and HiPhase are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>On average, HiPhase generated 480 kb phase block NG50, fully phased 93.8% of genes, and phased 3.1 M variants with only 929 switchflip errors (see <xref rid="btae042-F1" ref-type="fig">Fig. 1</xref>), a rate of 1 error every 3.3 K variants. Additionally, HiPhase generated over 11 K phased structural variants and 68 K phased tandem repeat variants per replicate, a feature that is not present in WhatsHap. Additional analyses with more metrics and samples are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    <fig position="float" id="btae042-F1">
      <label>Figure 1.</label>
      <caption>
        <p>Summary comparison metrics. Each line represents a phase result where the line style corresponds to a HG002 replicate and the color corresponds to the phasing approach (top three blue lines for HiPhase or bottom three red lines for WhatsHap). Each metric axis is oriented such that better results are toward the top (i.e. switches and flips are inverted). In all metrics, results from HiPhase were strictly better than those from WhatsHap</p>
      </caption>
      <graphic xlink:href="btae042f1" position="float"/>
    </fig>
    <p>To our knowledge, HiPhase is the first phasing tool to jointly phase SNVs, indels, structural, and tandem repeat variants. Compared to WhatsHap, HiPhase generated longer phase blocks (480 versus 407 kb) with fewer phasing errors (929 versus 1615 switchflips), phased more total variants (3.05 versus 2.94 million), and fully phased more genes (93.8% versus 87.0%). HiPhase also includes usability features, such as innate multi-threading, statistics gathering, and concurrent phased alignment output generation. In future versions of the tool, we will extend HiPhase into other forms of structural variants, such as inversions and copy number variants.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae042_Supplementary_Data</label>
      <media xlink:href="btae042_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank the anonymous reviewers and early HiPhase testers for their valuable suggestions. They thank Justin Zook for access to an assembly-based draft HG002 benchmark that includes larger structural and tandem repeat variants. They also thank Tim Dunn for updating <monospace>vcfdist</monospace> to support analysis of phased structural and tandem repeat variants from the draft benchmark.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>All authors conceived HiPhase; J.M.H. and C.T.S. developed HiPhase; J.M.H. and W.J.R. analyzed the results; and J.M.H., C.T.S., W.J.R., and M.E. wrote and reviewed the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>All authors are employed by and hold stock in PacBio.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>None declared.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>HiPhase is released as source code and a pre-compiled binary file on GitHub: <ext-link xlink:href="https://github.com/PacificBiosciences/HiPhase" ext-link-type="uri">https://github.com/PacificBiosciences/HiPhase</ext-link>. Additional instructions and use cases are available in the accompanying documentation. Details and links to all benchmark files, sequencing datasets, tool versions, and commands used in this document as well as additional dataset analyses are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae042-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Browning</surname><given-names>SR</given-names></string-name>, <string-name><surname>Browning</surname><given-names>BL.</given-names></string-name></person-group><article-title>Haplotype phasing: existing methods and new developments</article-title>. <source>Nat Rev Genet</source><year>2011</year>;<volume>12</volume>:<fpage>703</fpage>–<lpage>14</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3054</pub-id><pub-id pub-id-type="pmid">21921926</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Caspar</surname><given-names>SM</given-names></string-name>, <string-name><surname>Schneider</surname><given-names>T</given-names></string-name>, <string-name><surname>Stoll</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Potential of whole-genome sequencing-based pharmacogenetic profiling</article-title>. <source>Pharmacogenomics</source><year>2021</year>;<volume>22</volume>:<fpage>177</fpage>–<lpage>90</lpage>. <pub-id pub-id-type="doi">10.2217/pgs-2020-0155</pub-id><pub-id pub-id-type="pmid">33517770</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Danecek</surname><given-names>P</given-names></string-name>, <string-name><surname>McCarthy</surname><given-names>SA.</given-names></string-name></person-group><article-title>BCFtools/csq: haplotype-aware variant consequences</article-title>. <source>Bioinformatics</source><year>2017</year>;<volume>33</volume>:<fpage>2037</fpage>–<lpage>9</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btx100</pub-id><pub-id pub-id-type="pmid">28205675</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B4">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Dolzhenko</surname><given-names>E</given-names></string-name>, <string-name><surname>English</surname><given-names>A</given-names></string-name>, <string-name><surname>Dashnow</surname><given-names>H</given-names></string-name></person-group><etal>et al</etal> Characterization and visualization of tandem repeats at scale. <italic toggle="yes">Nat Biotechnol</italic><year>2024</year>:<fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btae042-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hart</surname><given-names>P</given-names></string-name>, <string-name><surname>Nilsson</surname><given-names>N</given-names></string-name>, <string-name><surname>Raphael</surname><given-names>B.</given-names></string-name></person-group><article-title>A formal basis for the heuristic determination of minimum cost paths</article-title>. <source>IEEE Trans Syst Sci Cyber</source><year>1968</year>;<volume>4</volume>:<fpage>100</fpage>–<lpage>7</lpage>. <pub-id pub-id-type="doi">10.1109/TSSC.1968.300136</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lin</surname><given-names>J-H</given-names></string-name>, <string-name><surname>Chen</surname><given-names>L-C</given-names></string-name>, <string-name><surname>Yu</surname><given-names>S-C</given-names></string-name></person-group><etal>et al</etal><article-title>LongPhase: an ultra-fast chromosome-scale phasing algorithm for small and large variants</article-title>. <source>Bioinformatics</source><year>2022</year>;<volume>38</volume>:<fpage>1816</fpage>–<lpage>22</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btac058</pub-id><pub-id pub-id-type="pmid">35104333</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mahmoud</surname><given-names>M</given-names></string-name>, <string-name><surname>Doddapaneni</surname><given-names>H</given-names></string-name>, <string-name><surname>Timp</surname><given-names>W</given-names></string-name></person-group><etal>et al</etal><article-title>PRINCESS: comprehensive detection of haplotype resolved SNVs, SVs, and methylation</article-title>. <source>Genome Biol</source><year>2021</year>;<volume>22</volume>:<fpage>268</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-021-02486-w</pub-id><pub-id pub-id-type="pmid">34521442</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marco-Sola</surname><given-names>S</given-names></string-name>, <string-name><surname>Moure</surname><given-names>JC</given-names></string-name>, <string-name><surname>Moreto</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Fast gap-affine pairwise alignment using the wavefront algorithm</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>37</volume>:<fpage>456</fpage>–<lpage>63</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa777</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mayor</surname><given-names>NP</given-names></string-name>, <string-name><surname>Hayhurst</surname><given-names>JD</given-names></string-name>, <string-name><surname>Turner</surname><given-names>TR</given-names></string-name></person-group><etal>et al</etal><article-title>Recipients receiving better HLA-matched hematopoietic cell transplantation grafts, uncovered by a novel HLA typing method, have superior survival: a retrospective study</article-title>. <source>Biol Blood Marrow Transplant</source><year>2019</year>;<volume>25</volume>:<fpage>443</fpage>–<lpage>50</lpage>. <pub-id pub-id-type="doi">10.1016/j.bbmt.2018.12.768</pub-id><pub-id pub-id-type="pmid">30935664</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Patterson</surname><given-names>M</given-names></string-name>, <string-name><surname>Marschall</surname><given-names>T</given-names></string-name>, <string-name><surname>Pisanti</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>WhatsHap: weighted haplotype assembly for future-generation sequencing reads</article-title>. <source>J Comput Biol</source><year>2015</year>;<volume>22</volume>:<fpage>498</fpage>–<lpage>509</lpage>. <pub-id pub-id-type="doi">10.1089/cmb.2014.0157</pub-id><pub-id pub-id-type="pmid">25658651</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Poplin</surname><given-names>R</given-names></string-name>, <string-name><surname>Chang</surname><given-names>P-C</given-names></string-name>, <string-name><surname>Alexander</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>A universal SNP and small-indel variant caller using deep neural networks</article-title>. <source>Nat Biotechnol</source><year>2018</year>;<volume>36</volume>:<fpage>983</fpage>–<lpage>7</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4235</pub-id><pub-id pub-id-type="pmid">30247488</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Snyder</surname><given-names>MW</given-names></string-name>, <string-name><surname>Adey</surname><given-names>A</given-names></string-name>, <string-name><surname>Kitzman</surname><given-names>JO</given-names></string-name></person-group><etal>et al</etal><article-title>Haplotype-resolved genome sequencing: experimental methods and applications</article-title>. <source>Nat Rev Genet</source><year>2015</year>;<volume>16</volume>:<fpage>344</fpage>–<lpage>58</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3903</pub-id><pub-id pub-id-type="pmid">25948246</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tewhey</surname><given-names>R</given-names></string-name>, <string-name><surname>Bansal</surname><given-names>V</given-names></string-name>, <string-name><surname>Torkamani</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>The importance of phase information for human genomics</article-title>. <source>Nat Rev Genet</source><year>2011</year>;<volume>12</volume>:<fpage>215</fpage>–<lpage>23</lpage>. <pub-id pub-id-type="doi">10.1038/nrg2950</pub-id><pub-id pub-id-type="pmid">21301473</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wagner</surname><given-names>J</given-names></string-name>, <string-name><surname>Olson</surname><given-names>ND</given-names></string-name>, <string-name><surname>Harris</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>Benchmarking challenging small variants with linked and long reads</article-title>. <source>Cell Genom</source><year>2022</year>;<volume>2</volume>:<fpage>100128</fpage>. <pub-id pub-id-type="doi">10.1016/j.xgen.2022.100128</pub-id><pub-id pub-id-type="pmid">36452119</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wenger</surname><given-names>AM</given-names></string-name>, <string-name><surname>Peluso</surname><given-names>P</given-names></string-name>, <string-name><surname>Rowell</surname><given-names>WJ</given-names></string-name></person-group><etal>et al</etal><article-title>Accurate circular consensus long-read sequencing improves variant detection and assembly of a human genome</article-title>. <source>Nat Biotechnol</source><year>2019</year>;<volume>37</volume>:<fpage>1155</fpage>–<lpage>62</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0217-9</pub-id><pub-id pub-id-type="pmid">31406327</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10868326</article-id>
    <article-id pub-id-type="pmid">38269623</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae042</article-id>
    <article-id pub-id-type="publisher-id">btae042</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>HiPhase: jointly phasing small, structural, and tandem repeat variants from HiFi sequencing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6411-9236</contrib-id>
        <name>
          <surname>Holt</surname>
          <given-names>James M</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
        <xref rid="btae042-cor1" ref-type="corresp"/>
        <!--mholt@pacificbiosciences.com-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-0726-7600</contrib-id>
        <name>
          <surname>Saunders</surname>
          <given-names>Christopher T</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7422-1194</contrib-id>
        <name>
          <surname>Rowell</surname>
          <given-names>William J</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7627-9808</contrib-id>
        <name>
          <surname>Kronenberg</surname>
          <given-names>Zev</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-1183-0432</contrib-id>
        <name>
          <surname>Wenger</surname>
          <given-names>Aaron M</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8965-1253</contrib-id>
        <name>
          <surname>Eberle</surname>
          <given-names>Michael</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Cowen</surname>
          <given-names>Lenore</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae042-cor1">Corresponding author. Computational Biology, PacBio, 1305 O'Brien Drive, Menlo Park, CA 94025, United States. E-mail: <email>mholt@pacificbiosciences.com</email> (J.M.H.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-01-25">
      <day>25</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>25</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>2</issue>
    <elocation-id>btae042</elocation-id>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>5</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>13</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>17</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>07</day>
        <month>2</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae042.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>In diploid organisms, phasing is the problem of assigning the alleles at heterozygous variants to one of two haplotypes. Reads from PacBio HiFi sequencing provide long, accurate observations that can be used as the basis for both calling and phasing variants. HiFi reads also excel at calling larger classes of variation, such as structural or tandem repeat variants. However, current phasing tools typically only phase small variants, leaving larger variants unphased.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We developed HiPhase, a tool that jointly phases SNVs, indels, structural, and tandem repeat variants. The main benefits of HiPhase are (i) dual mode allele assignment for detecting large variants, (ii) a novel application of the A*-algorithm to phasing, and (iii) logic allowing phase blocks to span breaks caused by alignment issues around reference gaps and homozygous deletions. In our assessment, HiPhase produced an average phase block NG50 of 480 kb with 929 switchflip errors and fully phased 93.8% of genes, improving over the current state of the art. Additionally, HiPhase jointly phases SNVs, indels, structural, and tandem repeat variants and includes innate multi-threading, statistics gathering, and concurrent phased alignment output generation.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>HiPhase is available as source code and a pre-compiled Linux binary with a user guide at <ext-link xlink:href="https://github.com/PacificBiosciences/HiPhase" ext-link-type="uri">https://github.com/PacificBiosciences/HiPhase</ext-link>.</p>
      </sec>
    </abstract>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>For human genomics, phasing variants within a gene is a critical aspect of clinical testing for pharmacogenomics (<xref rid="btae042-B2" ref-type="bibr">Caspar <italic toggle="yes">et al.</italic> 2021</xref>), HLA typing (<xref rid="btae042-B9" ref-type="bibr">Mayor <italic toggle="yes">et al.</italic> 2019</xref>), and autosomal recessive conditions (<xref rid="btae042-B13" ref-type="bibr">Tewhey <italic toggle="yes">et al.</italic> 2011</xref>). Additionally, automated tertiary analysis tools can benefit from knowing whether two variants are in <italic toggle="yes">cis</italic> or <italic toggle="yes">trans</italic> within a gene, potentially reducing the time for clinical analysts to reach a molecular diagnosis (<xref rid="btae042-B3" ref-type="bibr">Danecek and McCarthy 2017</xref>). Beyond clinical diagnostics, there are many additional applications of phasing in genomics, many of which are summarized in a review by <xref rid="btae042-B1" ref-type="bibr">Browning and Browning (2011)</xref>.</p>
    <p>Haplotype phasing generally falls into three categories: statistical phasing (<xref rid="btae042-B1" ref-type="bibr">Browning and Browning 2011</xref>), pedigree-based phasing (<xref rid="btae042-B1" ref-type="bibr">Browning and Browning 2011</xref>), and read-backed phasing (<xref rid="btae042-B12" ref-type="bibr">Snyder <italic toggle="yes">et al.</italic> 2015</xref>). For read-backed phasing, each read is mapped to a reference genome and variants are called from the read mappings. The alleles of heterozygous variants are phased into a single diplotype composed of two haplotypes. Once phased, the variants can be fed into various tertiary analysis tools for downstream analyses. In practice, reads that are long and accurate, such as PacBio HiFi reads (<xref rid="btae042-B15" ref-type="bibr">Wenger <italic toggle="yes">et al.</italic> 2019</xref>), include a large number of informative bases (more than one per 1 kb of read length) overlapping heterozygous variants making them ideal for variant calling followed by read-backed phasing.</p>
    <p>For long reads, WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>) is the most prominent read-backed phaser and the <italic toggle="yes">de facto</italic> standard in the field for phasing single-nucleotide variants (SNVs) and short indels. WhatsHap uses a “fixed parameter tractable approach,” meaning that it down-samples the sequencing reads to a fixed coverage value, to phase the heterozygous variants (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). Despite being generally efficient and accurate for phasing a human genome, WhatsHap does have some notable limitations: (i) it down-samples the data in order to run efficiently, potentially biasing the data; (ii) multi-allelic variants (sites with two or more non-reference alleles) are not phased; (iii) it does not span gaps in coverage caused by large deletions or reference gaps; (iv) it is single-threaded, so parallel processing requires some engineering overhead; and (v) it was designed primarily for small variants like SNVs and short indels. Recently, some tools have focused on that last limitation by either overlaying structural variants (insertions and deletions <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mo>≥</mml:mo></mml:math></inline-formula>50 bp) on the WhatsHap phase blocks (<xref rid="btae042-B7" ref-type="bibr">Mahmoud <italic toggle="yes">et al.</italic> 2021</xref>) or jointly phasing SNVs and structural variants, but not short indels (<xref rid="btae042-B6" ref-type="bibr">Lin <italic toggle="yes">et al.</italic> 2022</xref>). To our knowledge, no tool officially supports tandem repeat variants. This creates a notable gap for a tool that jointly phases SNVs, indels, structural, and tandem repeat variants.</p>
    <p>Here, we introduce HiPhase, a new tool that jointly phases SNVs, indels, structural, and tandem repeat variants called from PacBio HiFi sequencing on diploid organisms. HiPhase uses two novel approaches to solve the phasing problem: (i) dual mode allele assignment and (ii) a phasing algorithm based on the A* search algorithm (<xref rid="btae042-B5" ref-type="bibr">Hart <italic toggle="yes">et al.</italic> 1968</xref>). HiPhase offers additional benefits, such as: (i) no down-sampling of the data, (ii) support for multi-allelic variation, (iii) logic to span coverage gaps with supplementary alignments, (iv) innate multi-threading, (v) built-in statistics gathering, and (vi) support for assigning aligned reads to a haplotype (“haplotagging”) while phasing. In our assessment, HiPhase produced an average phase block NG50 of 480 kb with 929 switchflip errors and fully phased 93.8% of genes.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>HiPhase breaks the phasing problem into three major components: phase block generation, allele assignment, and diplotype solving.</p>
    <sec>
      <title>2.1 Phase block generation</title>
      <p>Phase block generation works by identifying pairs of consecutive heterozygous variant calls connected by at least one read mapping. A phase block is initialized by taking the first available variant on a chromosome and creating a single-variant block from it. Then, the next variant is loaded and HiPhase searches for mappings that span both that new variant and the current block. If no mappings span both, the algorithm will then check for supplementary mappings from the new variant into the current block. This supplementary mapping check allows HiPhase to span coverage gaps caused by homozygous deletions and reference gaps. If at least one spanning or supplementary mapping is identified, then, the current phase block is extended to include the variant. Otherwise, the current block is returned as a putative phase block and a new single-variant block is initialized from the new variant. This process repeats until all heterozygous variants on the chromosome are consumed.</p>
      <p>Each putative phase block acts as an isolated sub-problem in the full solution. Because the putative blocks are unconnected by the read mappings at their ends, they represent a lower-bound on the number of phase blocks in the final solution. Importantly, each sub-problem can be solved independently, allowing for allele assignment and diplotype solving to be performed in parallel for each putative phase block. This forms the basis for multi-threading in HiPhase.</p>
    </sec>
    <sec>
      <title>2.2 Allele assignment</title>
      <p>Allele assignment converts all read mappings within a putative phase block into condensed allelic observations, which are chains of reference or alternate alleles corresponding to the observed alleles within a particular read mapping. This simplifies a long-read sequence down to a smaller set of integer values representing alleles that are present within the read. We refer to these assignments as reference or alternate alleles, but HiPhase also allows for ambiguity, unassigned alleles, and multi-allelic variation (two different alternate alleles at one position). Additionally, each observed allele is assigned a “weight” indicating the cost to alter or ignore that allele in the diplotype solving step.</p>
      <p>HiPhase has two modes for allele assignment: local re-alignment and global re-alignment. In brief, local re-alignment assigns alleles and quality based on a small window around each variant position, which is conceptually similar to the allele assignment process of WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). In contrast, global re-alignment will fully re-align the mapping against a local alt-aware reference graph using a graph-aware version of the wavefront algorithm (<xref rid="btae042-B8" ref-type="bibr">Marco-Sola <italic toggle="yes">et al.</italic> 2020</xref>). In general, local re-alignment is a faster process, but it is ill-suited for accurate allele assignment for large structural and tandem repeat variants and even some smaller indels. Global re-alignment tends to be slower but is more accurate when it comes to allele assignment, especially around structural and tandem repeat variants. Finally, HiPhase implements a “dual mode” allele assignment where if global re-alignment is too slow, it will fall back on local re-alignment for the phase block.</p>
      <p>Once all mappings have been converted to a condensed allele representation, HiPhase collapses mappings with the same read name into a single entry. The primary purpose of this step is to create a bridge between supplementary mappings that span a gap in coverage. This allows HiPhase to cross deletion events and reference gaps bridged by split read mappings. If the mappings for one read overlap but have a conflicting allele assignment, then that allele is converted to an ambiguous allele assignment in the collapsed representation. In the end, each read is represented exactly once in the collection of condensed alleles for the phase block.</p>
    </sec>
    <sec>
      <title>2.3 Diplotype solving</title>
      <p>Diplotype solving distills the condensed allelic observations into two representative haplotypes that are expected to complement each other (i.e. where one is the reference allele, the other is the alternate allele). For our purposes, we define the core diplotype solving problem as a slight reformulation of the weighted minimum error correction (wMEC) problem as described previously (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). Given a matrix, where each row corresponds to the condensed allele representation of one read in the phase block, the goal is to find two haplotypes, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, such that the cost of changing each row to exactly match either <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> or <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is minimized. We refer the reader to <xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> (2015)</xref> for greater technical details around this and other formulations of the phasing/wMEC problem.</p>
      <p>HiPhase uses a version of the A* search algorithm (<xref rid="btae042-B5" ref-type="bibr">Hart <italic toggle="yes">et al.</italic> 1968</xref>) to search for the optimal diplotype. In general, A* search algorithms explore a given search space by iteratively expanding the current lowest cost option based on both an observed cost and heuristic cost estimate. In HiPhase, the search space is all possible diplotype solutions modeled as a search tree, and the heuristic is generated by chaining sub-problem solutions. While increased coverage and variant density will increase the run-time of this algorithm, in practice, we find that HiPhase can operate efficiently on the typical 30× human whole genome without down-sampling. Greater details on all HiPhase methods, heuristics, and limitations can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
    <sec>
      <title>2.4 Data</title>
      <p>The following sections outline public resources used in our analysis. Details on and links to each can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
      <sec>
        <title>2.4.1 Benchmark datasets</title>
        <p>For benchmarking phase accuracy, we used publicly available Genome in a Bottle phased variant sets v4.2.1 (GRCh38) for HG001, HG002, and HG005 (<xref rid="btae042-B14" ref-type="bibr">Wagner <italic toggle="yes">et al.</italic> 2022</xref>). We note that these files are limited to human autosomes, and do not provide phasing information for structural variants.</p>
      </sec>
      <sec>
        <title>2.4.2 HiFi sequencing datasets</title>
        <p>We used publicly available whole genome, HiFi sequencing datasets for evaluating HiPhase. Three replicates for the sample HG002 sequenced to ∼30-fold coverage on the Revio system were obtained from <ext-link xlink:href="https://downloads.pacbcloud.com/public/revio/2022Q4/" ext-link-type="uri">https://downloads.pacbcloud.com/public/revio/2022Q4/</ext-link>.</p>
      </sec>
      <sec>
        <title>2.4.3 Pre-processing</title>
        <p>We followed the recommended practices for pre-processing our HiFi datasets through variant calling. In brief, we aligned reads to GRCh38 using <monospace>pbmm2</monospace> and then performed variant calling with DeepVariant with the PacBio model (<xref rid="btae042-B11" ref-type="bibr">Poplin <italic toggle="yes">et al.</italic> 2018</xref>), <monospace>pbsv</monospace>, and TRGT (<xref rid="btae042-B4" ref-type="bibr">Dolzhenko <italic toggle="yes">et al.</italic> 2023</xref>).</p>
      </sec>
    </sec>
    <sec>
      <title>2.5 Phasing metrics</title>
      <p>We measured the quantity of phasing errors with switches and flips (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). To measure phase block length, we calculated NG50 using GRCh38 for reference length. We additionally gathered the total number of phased variants, number of phased structural and tandem repeat variants (HiPhase only), and the percentage of fully phased genes. We note that NG50 and number of phased variants are measured using tool-specific outputs. All analyses were performed across the full autosomes. Further details on how all metrics are defined, calculated, and collected are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
    <sec>
      <title>2.6 Tool descriptions</title>
      <p>We focus our analyses on comparing the current approach for HiFi read-backed phasing, WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>), to our new tool, HiPhase. For WhatsHap, we provide small variants from DeepVariant and instruct the tool to phase both SNVs and indels. For HiPhase, we provide the same DeepVariant VCF file, a structural variant VCF file from <monospace>pbsv</monospace>, and a tandem repeat variant VCF file from TRGT. We set HiPhase to use global re-alignment (see Section 2.2), which is our recommended approach for phasing with structural variants. Additional results for other modes of running both WhatsHap and HiPhase are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>On average, HiPhase generated 480 kb phase block NG50, fully phased 93.8% of genes, and phased 3.1 M variants with only 929 switchflip errors (see <xref rid="btae042-F1" ref-type="fig">Fig. 1</xref>), a rate of 1 error every 3.3 K variants. Additionally, HiPhase generated over 11 K phased structural variants and 68 K phased tandem repeat variants per replicate, a feature that is not present in WhatsHap. Additional analyses with more metrics and samples are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    <fig position="float" id="btae042-F1">
      <label>Figure 1.</label>
      <caption>
        <p>Summary comparison metrics. Each line represents a phase result where the line style corresponds to a HG002 replicate and the color corresponds to the phasing approach (top three blue lines for HiPhase or bottom three red lines for WhatsHap). Each metric axis is oriented such that better results are toward the top (i.e. switches and flips are inverted). In all metrics, results from HiPhase were strictly better than those from WhatsHap</p>
      </caption>
      <graphic xlink:href="btae042f1" position="float"/>
    </fig>
    <p>To our knowledge, HiPhase is the first phasing tool to jointly phase SNVs, indels, structural, and tandem repeat variants. Compared to WhatsHap, HiPhase generated longer phase blocks (480 versus 407 kb) with fewer phasing errors (929 versus 1615 switchflips), phased more total variants (3.05 versus 2.94 million), and fully phased more genes (93.8% versus 87.0%). HiPhase also includes usability features, such as innate multi-threading, statistics gathering, and concurrent phased alignment output generation. In future versions of the tool, we will extend HiPhase into other forms of structural variants, such as inversions and copy number variants.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae042_Supplementary_Data</label>
      <media xlink:href="btae042_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank the anonymous reviewers and early HiPhase testers for their valuable suggestions. They thank Justin Zook for access to an assembly-based draft HG002 benchmark that includes larger structural and tandem repeat variants. They also thank Tim Dunn for updating <monospace>vcfdist</monospace> to support analysis of phased structural and tandem repeat variants from the draft benchmark.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>All authors conceived HiPhase; J.M.H. and C.T.S. developed HiPhase; J.M.H. and W.J.R. analyzed the results; and J.M.H., C.T.S., W.J.R., and M.E. wrote and reviewed the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>All authors are employed by and hold stock in PacBio.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>None declared.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>HiPhase is released as source code and a pre-compiled binary file on GitHub: <ext-link xlink:href="https://github.com/PacificBiosciences/HiPhase" ext-link-type="uri">https://github.com/PacificBiosciences/HiPhase</ext-link>. Additional instructions and use cases are available in the accompanying documentation. Details and links to all benchmark files, sequencing datasets, tool versions, and commands used in this document as well as additional dataset analyses are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae042-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Browning</surname><given-names>SR</given-names></string-name>, <string-name><surname>Browning</surname><given-names>BL.</given-names></string-name></person-group><article-title>Haplotype phasing: existing methods and new developments</article-title>. <source>Nat Rev Genet</source><year>2011</year>;<volume>12</volume>:<fpage>703</fpage>–<lpage>14</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3054</pub-id><pub-id pub-id-type="pmid">21921926</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Caspar</surname><given-names>SM</given-names></string-name>, <string-name><surname>Schneider</surname><given-names>T</given-names></string-name>, <string-name><surname>Stoll</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Potential of whole-genome sequencing-based pharmacogenetic profiling</article-title>. <source>Pharmacogenomics</source><year>2021</year>;<volume>22</volume>:<fpage>177</fpage>–<lpage>90</lpage>. <pub-id pub-id-type="doi">10.2217/pgs-2020-0155</pub-id><pub-id pub-id-type="pmid">33517770</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Danecek</surname><given-names>P</given-names></string-name>, <string-name><surname>McCarthy</surname><given-names>SA.</given-names></string-name></person-group><article-title>BCFtools/csq: haplotype-aware variant consequences</article-title>. <source>Bioinformatics</source><year>2017</year>;<volume>33</volume>:<fpage>2037</fpage>–<lpage>9</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btx100</pub-id><pub-id pub-id-type="pmid">28205675</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B4">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Dolzhenko</surname><given-names>E</given-names></string-name>, <string-name><surname>English</surname><given-names>A</given-names></string-name>, <string-name><surname>Dashnow</surname><given-names>H</given-names></string-name></person-group><etal>et al</etal> Characterization and visualization of tandem repeats at scale. <italic toggle="yes">Nat Biotechnol</italic><year>2024</year>:<fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btae042-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hart</surname><given-names>P</given-names></string-name>, <string-name><surname>Nilsson</surname><given-names>N</given-names></string-name>, <string-name><surname>Raphael</surname><given-names>B.</given-names></string-name></person-group><article-title>A formal basis for the heuristic determination of minimum cost paths</article-title>. <source>IEEE Trans Syst Sci Cyber</source><year>1968</year>;<volume>4</volume>:<fpage>100</fpage>–<lpage>7</lpage>. <pub-id pub-id-type="doi">10.1109/TSSC.1968.300136</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lin</surname><given-names>J-H</given-names></string-name>, <string-name><surname>Chen</surname><given-names>L-C</given-names></string-name>, <string-name><surname>Yu</surname><given-names>S-C</given-names></string-name></person-group><etal>et al</etal><article-title>LongPhase: an ultra-fast chromosome-scale phasing algorithm for small and large variants</article-title>. <source>Bioinformatics</source><year>2022</year>;<volume>38</volume>:<fpage>1816</fpage>–<lpage>22</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btac058</pub-id><pub-id pub-id-type="pmid">35104333</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mahmoud</surname><given-names>M</given-names></string-name>, <string-name><surname>Doddapaneni</surname><given-names>H</given-names></string-name>, <string-name><surname>Timp</surname><given-names>W</given-names></string-name></person-group><etal>et al</etal><article-title>PRINCESS: comprehensive detection of haplotype resolved SNVs, SVs, and methylation</article-title>. <source>Genome Biol</source><year>2021</year>;<volume>22</volume>:<fpage>268</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-021-02486-w</pub-id><pub-id pub-id-type="pmid">34521442</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marco-Sola</surname><given-names>S</given-names></string-name>, <string-name><surname>Moure</surname><given-names>JC</given-names></string-name>, <string-name><surname>Moreto</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Fast gap-affine pairwise alignment using the wavefront algorithm</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>37</volume>:<fpage>456</fpage>–<lpage>63</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa777</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mayor</surname><given-names>NP</given-names></string-name>, <string-name><surname>Hayhurst</surname><given-names>JD</given-names></string-name>, <string-name><surname>Turner</surname><given-names>TR</given-names></string-name></person-group><etal>et al</etal><article-title>Recipients receiving better HLA-matched hematopoietic cell transplantation grafts, uncovered by a novel HLA typing method, have superior survival: a retrospective study</article-title>. <source>Biol Blood Marrow Transplant</source><year>2019</year>;<volume>25</volume>:<fpage>443</fpage>–<lpage>50</lpage>. <pub-id pub-id-type="doi">10.1016/j.bbmt.2018.12.768</pub-id><pub-id pub-id-type="pmid">30935664</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Patterson</surname><given-names>M</given-names></string-name>, <string-name><surname>Marschall</surname><given-names>T</given-names></string-name>, <string-name><surname>Pisanti</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>WhatsHap: weighted haplotype assembly for future-generation sequencing reads</article-title>. <source>J Comput Biol</source><year>2015</year>;<volume>22</volume>:<fpage>498</fpage>–<lpage>509</lpage>. <pub-id pub-id-type="doi">10.1089/cmb.2014.0157</pub-id><pub-id pub-id-type="pmid">25658651</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Poplin</surname><given-names>R</given-names></string-name>, <string-name><surname>Chang</surname><given-names>P-C</given-names></string-name>, <string-name><surname>Alexander</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>A universal SNP and small-indel variant caller using deep neural networks</article-title>. <source>Nat Biotechnol</source><year>2018</year>;<volume>36</volume>:<fpage>983</fpage>–<lpage>7</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4235</pub-id><pub-id pub-id-type="pmid">30247488</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Snyder</surname><given-names>MW</given-names></string-name>, <string-name><surname>Adey</surname><given-names>A</given-names></string-name>, <string-name><surname>Kitzman</surname><given-names>JO</given-names></string-name></person-group><etal>et al</etal><article-title>Haplotype-resolved genome sequencing: experimental methods and applications</article-title>. <source>Nat Rev Genet</source><year>2015</year>;<volume>16</volume>:<fpage>344</fpage>–<lpage>58</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3903</pub-id><pub-id pub-id-type="pmid">25948246</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tewhey</surname><given-names>R</given-names></string-name>, <string-name><surname>Bansal</surname><given-names>V</given-names></string-name>, <string-name><surname>Torkamani</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>The importance of phase information for human genomics</article-title>. <source>Nat Rev Genet</source><year>2011</year>;<volume>12</volume>:<fpage>215</fpage>–<lpage>23</lpage>. <pub-id pub-id-type="doi">10.1038/nrg2950</pub-id><pub-id pub-id-type="pmid">21301473</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wagner</surname><given-names>J</given-names></string-name>, <string-name><surname>Olson</surname><given-names>ND</given-names></string-name>, <string-name><surname>Harris</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>Benchmarking challenging small variants with linked and long reads</article-title>. <source>Cell Genom</source><year>2022</year>;<volume>2</volume>:<fpage>100128</fpage>. <pub-id pub-id-type="doi">10.1016/j.xgen.2022.100128</pub-id><pub-id pub-id-type="pmid">36452119</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wenger</surname><given-names>AM</given-names></string-name>, <string-name><surname>Peluso</surname><given-names>P</given-names></string-name>, <string-name><surname>Rowell</surname><given-names>WJ</given-names></string-name></person-group><etal>et al</etal><article-title>Accurate circular consensus long-read sequencing improves variant detection and assembly of a human genome</article-title>. <source>Nat Biotechnol</source><year>2019</year>;<volume>37</volume>:<fpage>1155</fpage>–<lpage>62</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0217-9</pub-id><pub-id pub-id-type="pmid">31406327</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10868326</article-id>
    <article-id pub-id-type="pmid">38269623</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae042</article-id>
    <article-id pub-id-type="publisher-id">btae042</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>HiPhase: jointly phasing small, structural, and tandem repeat variants from HiFi sequencing</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-6411-9236</contrib-id>
        <name>
          <surname>Holt</surname>
          <given-names>James M</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
        <xref rid="btae042-cor1" ref-type="corresp"/>
        <!--mholt@pacificbiosciences.com-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-0726-7600</contrib-id>
        <name>
          <surname>Saunders</surname>
          <given-names>Christopher T</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7422-1194</contrib-id>
        <name>
          <surname>Rowell</surname>
          <given-names>William J</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7627-9808</contrib-id>
        <name>
          <surname>Kronenberg</surname>
          <given-names>Zev</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-1183-0432</contrib-id>
        <name>
          <surname>Wenger</surname>
          <given-names>Aaron M</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8965-1253</contrib-id>
        <name>
          <surname>Eberle</surname>
          <given-names>Michael</given-names>
        </name>
        <aff><institution>Computational Biology, PacBio</institution>, <addr-line>1305 O’Brien Drive</addr-line>, Menlo Park, CA 94025, <country country="US">United States</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Cowen</surname>
          <given-names>Lenore</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae042-cor1">Corresponding author. Computational Biology, PacBio, 1305 O'Brien Drive, Menlo Park, CA 94025, United States. E-mail: <email>mholt@pacificbiosciences.com</email> (J.M.H.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-01-25">
      <day>25</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>25</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>2</issue>
    <elocation-id>btae042</elocation-id>
    <history>
      <date date-type="received">
        <day>19</day>
        <month>5</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>13</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>17</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>07</day>
        <month>2</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae042.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>In diploid organisms, phasing is the problem of assigning the alleles at heterozygous variants to one of two haplotypes. Reads from PacBio HiFi sequencing provide long, accurate observations that can be used as the basis for both calling and phasing variants. HiFi reads also excel at calling larger classes of variation, such as structural or tandem repeat variants. However, current phasing tools typically only phase small variants, leaving larger variants unphased.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We developed HiPhase, a tool that jointly phases SNVs, indels, structural, and tandem repeat variants. The main benefits of HiPhase are (i) dual mode allele assignment for detecting large variants, (ii) a novel application of the A*-algorithm to phasing, and (iii) logic allowing phase blocks to span breaks caused by alignment issues around reference gaps and homozygous deletions. In our assessment, HiPhase produced an average phase block NG50 of 480 kb with 929 switchflip errors and fully phased 93.8% of genes, improving over the current state of the art. Additionally, HiPhase jointly phases SNVs, indels, structural, and tandem repeat variants and includes innate multi-threading, statistics gathering, and concurrent phased alignment output generation.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>HiPhase is available as source code and a pre-compiled Linux binary with a user guide at <ext-link xlink:href="https://github.com/PacificBiosciences/HiPhase" ext-link-type="uri">https://github.com/PacificBiosciences/HiPhase</ext-link>.</p>
      </sec>
    </abstract>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>For human genomics, phasing variants within a gene is a critical aspect of clinical testing for pharmacogenomics (<xref rid="btae042-B2" ref-type="bibr">Caspar <italic toggle="yes">et al.</italic> 2021</xref>), HLA typing (<xref rid="btae042-B9" ref-type="bibr">Mayor <italic toggle="yes">et al.</italic> 2019</xref>), and autosomal recessive conditions (<xref rid="btae042-B13" ref-type="bibr">Tewhey <italic toggle="yes">et al.</italic> 2011</xref>). Additionally, automated tertiary analysis tools can benefit from knowing whether two variants are in <italic toggle="yes">cis</italic> or <italic toggle="yes">trans</italic> within a gene, potentially reducing the time for clinical analysts to reach a molecular diagnosis (<xref rid="btae042-B3" ref-type="bibr">Danecek and McCarthy 2017</xref>). Beyond clinical diagnostics, there are many additional applications of phasing in genomics, many of which are summarized in a review by <xref rid="btae042-B1" ref-type="bibr">Browning and Browning (2011)</xref>.</p>
    <p>Haplotype phasing generally falls into three categories: statistical phasing (<xref rid="btae042-B1" ref-type="bibr">Browning and Browning 2011</xref>), pedigree-based phasing (<xref rid="btae042-B1" ref-type="bibr">Browning and Browning 2011</xref>), and read-backed phasing (<xref rid="btae042-B12" ref-type="bibr">Snyder <italic toggle="yes">et al.</italic> 2015</xref>). For read-backed phasing, each read is mapped to a reference genome and variants are called from the read mappings. The alleles of heterozygous variants are phased into a single diplotype composed of two haplotypes. Once phased, the variants can be fed into various tertiary analysis tools for downstream analyses. In practice, reads that are long and accurate, such as PacBio HiFi reads (<xref rid="btae042-B15" ref-type="bibr">Wenger <italic toggle="yes">et al.</italic> 2019</xref>), include a large number of informative bases (more than one per 1 kb of read length) overlapping heterozygous variants making them ideal for variant calling followed by read-backed phasing.</p>
    <p>For long reads, WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>) is the most prominent read-backed phaser and the <italic toggle="yes">de facto</italic> standard in the field for phasing single-nucleotide variants (SNVs) and short indels. WhatsHap uses a “fixed parameter tractable approach,” meaning that it down-samples the sequencing reads to a fixed coverage value, to phase the heterozygous variants (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). Despite being generally efficient and accurate for phasing a human genome, WhatsHap does have some notable limitations: (i) it down-samples the data in order to run efficiently, potentially biasing the data; (ii) multi-allelic variants (sites with two or more non-reference alleles) are not phased; (iii) it does not span gaps in coverage caused by large deletions or reference gaps; (iv) it is single-threaded, so parallel processing requires some engineering overhead; and (v) it was designed primarily for small variants like SNVs and short indels. Recently, some tools have focused on that last limitation by either overlaying structural variants (insertions and deletions <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mo>≥</mml:mo></mml:math></inline-formula>50 bp) on the WhatsHap phase blocks (<xref rid="btae042-B7" ref-type="bibr">Mahmoud <italic toggle="yes">et al.</italic> 2021</xref>) or jointly phasing SNVs and structural variants, but not short indels (<xref rid="btae042-B6" ref-type="bibr">Lin <italic toggle="yes">et al.</italic> 2022</xref>). To our knowledge, no tool officially supports tandem repeat variants. This creates a notable gap for a tool that jointly phases SNVs, indels, structural, and tandem repeat variants.</p>
    <p>Here, we introduce HiPhase, a new tool that jointly phases SNVs, indels, structural, and tandem repeat variants called from PacBio HiFi sequencing on diploid organisms. HiPhase uses two novel approaches to solve the phasing problem: (i) dual mode allele assignment and (ii) a phasing algorithm based on the A* search algorithm (<xref rid="btae042-B5" ref-type="bibr">Hart <italic toggle="yes">et al.</italic> 1968</xref>). HiPhase offers additional benefits, such as: (i) no down-sampling of the data, (ii) support for multi-allelic variation, (iii) logic to span coverage gaps with supplementary alignments, (iv) innate multi-threading, (v) built-in statistics gathering, and (vi) support for assigning aligned reads to a haplotype (“haplotagging”) while phasing. In our assessment, HiPhase produced an average phase block NG50 of 480 kb with 929 switchflip errors and fully phased 93.8% of genes.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>HiPhase breaks the phasing problem into three major components: phase block generation, allele assignment, and diplotype solving.</p>
    <sec>
      <title>2.1 Phase block generation</title>
      <p>Phase block generation works by identifying pairs of consecutive heterozygous variant calls connected by at least one read mapping. A phase block is initialized by taking the first available variant on a chromosome and creating a single-variant block from it. Then, the next variant is loaded and HiPhase searches for mappings that span both that new variant and the current block. If no mappings span both, the algorithm will then check for supplementary mappings from the new variant into the current block. This supplementary mapping check allows HiPhase to span coverage gaps caused by homozygous deletions and reference gaps. If at least one spanning or supplementary mapping is identified, then, the current phase block is extended to include the variant. Otherwise, the current block is returned as a putative phase block and a new single-variant block is initialized from the new variant. This process repeats until all heterozygous variants on the chromosome are consumed.</p>
      <p>Each putative phase block acts as an isolated sub-problem in the full solution. Because the putative blocks are unconnected by the read mappings at their ends, they represent a lower-bound on the number of phase blocks in the final solution. Importantly, each sub-problem can be solved independently, allowing for allele assignment and diplotype solving to be performed in parallel for each putative phase block. This forms the basis for multi-threading in HiPhase.</p>
    </sec>
    <sec>
      <title>2.2 Allele assignment</title>
      <p>Allele assignment converts all read mappings within a putative phase block into condensed allelic observations, which are chains of reference or alternate alleles corresponding to the observed alleles within a particular read mapping. This simplifies a long-read sequence down to a smaller set of integer values representing alleles that are present within the read. We refer to these assignments as reference or alternate alleles, but HiPhase also allows for ambiguity, unassigned alleles, and multi-allelic variation (two different alternate alleles at one position). Additionally, each observed allele is assigned a “weight” indicating the cost to alter or ignore that allele in the diplotype solving step.</p>
      <p>HiPhase has two modes for allele assignment: local re-alignment and global re-alignment. In brief, local re-alignment assigns alleles and quality based on a small window around each variant position, which is conceptually similar to the allele assignment process of WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). In contrast, global re-alignment will fully re-align the mapping against a local alt-aware reference graph using a graph-aware version of the wavefront algorithm (<xref rid="btae042-B8" ref-type="bibr">Marco-Sola <italic toggle="yes">et al.</italic> 2020</xref>). In general, local re-alignment is a faster process, but it is ill-suited for accurate allele assignment for large structural and tandem repeat variants and even some smaller indels. Global re-alignment tends to be slower but is more accurate when it comes to allele assignment, especially around structural and tandem repeat variants. Finally, HiPhase implements a “dual mode” allele assignment where if global re-alignment is too slow, it will fall back on local re-alignment for the phase block.</p>
      <p>Once all mappings have been converted to a condensed allele representation, HiPhase collapses mappings with the same read name into a single entry. The primary purpose of this step is to create a bridge between supplementary mappings that span a gap in coverage. This allows HiPhase to cross deletion events and reference gaps bridged by split read mappings. If the mappings for one read overlap but have a conflicting allele assignment, then that allele is converted to an ambiguous allele assignment in the collapsed representation. In the end, each read is represented exactly once in the collection of condensed alleles for the phase block.</p>
    </sec>
    <sec>
      <title>2.3 Diplotype solving</title>
      <p>Diplotype solving distills the condensed allelic observations into two representative haplotypes that are expected to complement each other (i.e. where one is the reference allele, the other is the alternate allele). For our purposes, we define the core diplotype solving problem as a slight reformulation of the weighted minimum error correction (wMEC) problem as described previously (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). Given a matrix, where each row corresponds to the condensed allele representation of one read in the phase block, the goal is to find two haplotypes, <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, such that the cost of changing each row to exactly match either <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> or <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is minimized. We refer the reader to <xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> (2015)</xref> for greater technical details around this and other formulations of the phasing/wMEC problem.</p>
      <p>HiPhase uses a version of the A* search algorithm (<xref rid="btae042-B5" ref-type="bibr">Hart <italic toggle="yes">et al.</italic> 1968</xref>) to search for the optimal diplotype. In general, A* search algorithms explore a given search space by iteratively expanding the current lowest cost option based on both an observed cost and heuristic cost estimate. In HiPhase, the search space is all possible diplotype solutions modeled as a search tree, and the heuristic is generated by chaining sub-problem solutions. While increased coverage and variant density will increase the run-time of this algorithm, in practice, we find that HiPhase can operate efficiently on the typical 30× human whole genome without down-sampling. Greater details on all HiPhase methods, heuristics, and limitations can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
    <sec>
      <title>2.4 Data</title>
      <p>The following sections outline public resources used in our analysis. Details on and links to each can be found in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
      <sec>
        <title>2.4.1 Benchmark datasets</title>
        <p>For benchmarking phase accuracy, we used publicly available Genome in a Bottle phased variant sets v4.2.1 (GRCh38) for HG001, HG002, and HG005 (<xref rid="btae042-B14" ref-type="bibr">Wagner <italic toggle="yes">et al.</italic> 2022</xref>). We note that these files are limited to human autosomes, and do not provide phasing information for structural variants.</p>
      </sec>
      <sec>
        <title>2.4.2 HiFi sequencing datasets</title>
        <p>We used publicly available whole genome, HiFi sequencing datasets for evaluating HiPhase. Three replicates for the sample HG002 sequenced to ∼30-fold coverage on the Revio system were obtained from <ext-link xlink:href="https://downloads.pacbcloud.com/public/revio/2022Q4/" ext-link-type="uri">https://downloads.pacbcloud.com/public/revio/2022Q4/</ext-link>.</p>
      </sec>
      <sec>
        <title>2.4.3 Pre-processing</title>
        <p>We followed the recommended practices for pre-processing our HiFi datasets through variant calling. In brief, we aligned reads to GRCh38 using <monospace>pbmm2</monospace> and then performed variant calling with DeepVariant with the PacBio model (<xref rid="btae042-B11" ref-type="bibr">Poplin <italic toggle="yes">et al.</italic> 2018</xref>), <monospace>pbsv</monospace>, and TRGT (<xref rid="btae042-B4" ref-type="bibr">Dolzhenko <italic toggle="yes">et al.</italic> 2023</xref>).</p>
      </sec>
    </sec>
    <sec>
      <title>2.5 Phasing metrics</title>
      <p>We measured the quantity of phasing errors with switches and flips (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>). To measure phase block length, we calculated NG50 using GRCh38 for reference length. We additionally gathered the total number of phased variants, number of phased structural and tandem repeat variants (HiPhase only), and the percentage of fully phased genes. We note that NG50 and number of phased variants are measured using tool-specific outputs. All analyses were performed across the full autosomes. Further details on how all metrics are defined, calculated, and collected are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
    <sec>
      <title>2.6 Tool descriptions</title>
      <p>We focus our analyses on comparing the current approach for HiFi read-backed phasing, WhatsHap (<xref rid="btae042-B10" ref-type="bibr">Patterson <italic toggle="yes">et al.</italic> 2015</xref>), to our new tool, HiPhase. For WhatsHap, we provide small variants from DeepVariant and instruct the tool to phase both SNVs and indels. For HiPhase, we provide the same DeepVariant VCF file, a structural variant VCF file from <monospace>pbsv</monospace>, and a tandem repeat variant VCF file from TRGT. We set HiPhase to use global re-alignment (see Section 2.2), which is our recommended approach for phasing with structural variants. Additional results for other modes of running both WhatsHap and HiPhase are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>On average, HiPhase generated 480 kb phase block NG50, fully phased 93.8% of genes, and phased 3.1 M variants with only 929 switchflip errors (see <xref rid="btae042-F1" ref-type="fig">Fig. 1</xref>), a rate of 1 error every 3.3 K variants. Additionally, HiPhase generated over 11 K phased structural variants and 68 K phased tandem repeat variants per replicate, a feature that is not present in WhatsHap. Additional analyses with more metrics and samples are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
    <fig position="float" id="btae042-F1">
      <label>Figure 1.</label>
      <caption>
        <p>Summary comparison metrics. Each line represents a phase result where the line style corresponds to a HG002 replicate and the color corresponds to the phasing approach (top three blue lines for HiPhase or bottom three red lines for WhatsHap). Each metric axis is oriented such that better results are toward the top (i.e. switches and flips are inverted). In all metrics, results from HiPhase were strictly better than those from WhatsHap</p>
      </caption>
      <graphic xlink:href="btae042f1" position="float"/>
    </fig>
    <p>To our knowledge, HiPhase is the first phasing tool to jointly phase SNVs, indels, structural, and tandem repeat variants. Compared to WhatsHap, HiPhase generated longer phase blocks (480 versus 407 kb) with fewer phasing errors (929 versus 1615 switchflips), phased more total variants (3.05 versus 2.94 million), and fully phased more genes (93.8% versus 87.0%). HiPhase also includes usability features, such as innate multi-threading, statistics gathering, and concurrent phased alignment output generation. In future versions of the tool, we will extend HiPhase into other forms of structural variants, such as inversions and copy number variants.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae042_Supplementary_Data</label>
      <media xlink:href="btae042_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank the anonymous reviewers and early HiPhase testers for their valuable suggestions. They thank Justin Zook for access to an assembly-based draft HG002 benchmark that includes larger structural and tandem repeat variants. They also thank Tim Dunn for updating <monospace>vcfdist</monospace> to support analysis of phased structural and tandem repeat variants from the draft benchmark.</p>
  </ack>
  <sec>
    <title>Author contributions</title>
    <p>All authors conceived HiPhase; J.M.H. and C.T.S. developed HiPhase; J.M.H. and W.J.R. analyzed the results; and J.M.H., C.T.S., W.J.R., and M.E. wrote and reviewed the manuscript.</p>
  </sec>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>All authors are employed by and hold stock in PacBio.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>None declared.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>HiPhase is released as source code and a pre-compiled binary file on GitHub: <ext-link xlink:href="https://github.com/PacificBiosciences/HiPhase" ext-link-type="uri">https://github.com/PacificBiosciences/HiPhase</ext-link>. Additional instructions and use cases are available in the accompanying documentation. Details and links to all benchmark files, sequencing datasets, tool versions, and commands used in this document as well as additional dataset analyses are available in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Material</xref>.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae042-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Browning</surname><given-names>SR</given-names></string-name>, <string-name><surname>Browning</surname><given-names>BL.</given-names></string-name></person-group><article-title>Haplotype phasing: existing methods and new developments</article-title>. <source>Nat Rev Genet</source><year>2011</year>;<volume>12</volume>:<fpage>703</fpage>–<lpage>14</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3054</pub-id><pub-id pub-id-type="pmid">21921926</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Caspar</surname><given-names>SM</given-names></string-name>, <string-name><surname>Schneider</surname><given-names>T</given-names></string-name>, <string-name><surname>Stoll</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Potential of whole-genome sequencing-based pharmacogenetic profiling</article-title>. <source>Pharmacogenomics</source><year>2021</year>;<volume>22</volume>:<fpage>177</fpage>–<lpage>90</lpage>. <pub-id pub-id-type="doi">10.2217/pgs-2020-0155</pub-id><pub-id pub-id-type="pmid">33517770</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Danecek</surname><given-names>P</given-names></string-name>, <string-name><surname>McCarthy</surname><given-names>SA.</given-names></string-name></person-group><article-title>BCFtools/csq: haplotype-aware variant consequences</article-title>. <source>Bioinformatics</source><year>2017</year>;<volume>33</volume>:<fpage>2037</fpage>–<lpage>9</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btx100</pub-id><pub-id pub-id-type="pmid">28205675</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B4">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Dolzhenko</surname><given-names>E</given-names></string-name>, <string-name><surname>English</surname><given-names>A</given-names></string-name>, <string-name><surname>Dashnow</surname><given-names>H</given-names></string-name></person-group><etal>et al</etal> Characterization and visualization of tandem repeats at scale. <italic toggle="yes">Nat Biotechnol</italic><year>2024</year>:<fpage>1</fpage>–<lpage>9</lpage>.</mixed-citation>
    </ref>
    <ref id="btae042-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hart</surname><given-names>P</given-names></string-name>, <string-name><surname>Nilsson</surname><given-names>N</given-names></string-name>, <string-name><surname>Raphael</surname><given-names>B.</given-names></string-name></person-group><article-title>A formal basis for the heuristic determination of minimum cost paths</article-title>. <source>IEEE Trans Syst Sci Cyber</source><year>1968</year>;<volume>4</volume>:<fpage>100</fpage>–<lpage>7</lpage>. <pub-id pub-id-type="doi">10.1109/TSSC.1968.300136</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lin</surname><given-names>J-H</given-names></string-name>, <string-name><surname>Chen</surname><given-names>L-C</given-names></string-name>, <string-name><surname>Yu</surname><given-names>S-C</given-names></string-name></person-group><etal>et al</etal><article-title>LongPhase: an ultra-fast chromosome-scale phasing algorithm for small and large variants</article-title>. <source>Bioinformatics</source><year>2022</year>;<volume>38</volume>:<fpage>1816</fpage>–<lpage>22</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btac058</pub-id><pub-id pub-id-type="pmid">35104333</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mahmoud</surname><given-names>M</given-names></string-name>, <string-name><surname>Doddapaneni</surname><given-names>H</given-names></string-name>, <string-name><surname>Timp</surname><given-names>W</given-names></string-name></person-group><etal>et al</etal><article-title>PRINCESS: comprehensive detection of haplotype resolved SNVs, SVs, and methylation</article-title>. <source>Genome Biol</source><year>2021</year>;<volume>22</volume>:<fpage>268</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-021-02486-w</pub-id><pub-id pub-id-type="pmid">34521442</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marco-Sola</surname><given-names>S</given-names></string-name>, <string-name><surname>Moure</surname><given-names>JC</given-names></string-name>, <string-name><surname>Moreto</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>Fast gap-affine pairwise alignment using the wavefront algorithm</article-title>. <source>Bioinformatics</source><year>2020</year>;<volume>37</volume>:<fpage>456</fpage>–<lpage>63</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa777</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mayor</surname><given-names>NP</given-names></string-name>, <string-name><surname>Hayhurst</surname><given-names>JD</given-names></string-name>, <string-name><surname>Turner</surname><given-names>TR</given-names></string-name></person-group><etal>et al</etal><article-title>Recipients receiving better HLA-matched hematopoietic cell transplantation grafts, uncovered by a novel HLA typing method, have superior survival: a retrospective study</article-title>. <source>Biol Blood Marrow Transplant</source><year>2019</year>;<volume>25</volume>:<fpage>443</fpage>–<lpage>50</lpage>. <pub-id pub-id-type="doi">10.1016/j.bbmt.2018.12.768</pub-id><pub-id pub-id-type="pmid">30935664</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Patterson</surname><given-names>M</given-names></string-name>, <string-name><surname>Marschall</surname><given-names>T</given-names></string-name>, <string-name><surname>Pisanti</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>WhatsHap: weighted haplotype assembly for future-generation sequencing reads</article-title>. <source>J Comput Biol</source><year>2015</year>;<volume>22</volume>:<fpage>498</fpage>–<lpage>509</lpage>. <pub-id pub-id-type="doi">10.1089/cmb.2014.0157</pub-id><pub-id pub-id-type="pmid">25658651</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Poplin</surname><given-names>R</given-names></string-name>, <string-name><surname>Chang</surname><given-names>P-C</given-names></string-name>, <string-name><surname>Alexander</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>A universal SNP and small-indel variant caller using deep neural networks</article-title>. <source>Nat Biotechnol</source><year>2018</year>;<volume>36</volume>:<fpage>983</fpage>–<lpage>7</lpage>. <pub-id pub-id-type="doi">10.1038/nbt.4235</pub-id><pub-id pub-id-type="pmid">30247488</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Snyder</surname><given-names>MW</given-names></string-name>, <string-name><surname>Adey</surname><given-names>A</given-names></string-name>, <string-name><surname>Kitzman</surname><given-names>JO</given-names></string-name></person-group><etal>et al</etal><article-title>Haplotype-resolved genome sequencing: experimental methods and applications</article-title>. <source>Nat Rev Genet</source><year>2015</year>;<volume>16</volume>:<fpage>344</fpage>–<lpage>58</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3903</pub-id><pub-id pub-id-type="pmid">25948246</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tewhey</surname><given-names>R</given-names></string-name>, <string-name><surname>Bansal</surname><given-names>V</given-names></string-name>, <string-name><surname>Torkamani</surname><given-names>A</given-names></string-name></person-group><etal>et al</etal><article-title>The importance of phase information for human genomics</article-title>. <source>Nat Rev Genet</source><year>2011</year>;<volume>12</volume>:<fpage>215</fpage>–<lpage>23</lpage>. <pub-id pub-id-type="doi">10.1038/nrg2950</pub-id><pub-id pub-id-type="pmid">21301473</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wagner</surname><given-names>J</given-names></string-name>, <string-name><surname>Olson</surname><given-names>ND</given-names></string-name>, <string-name><surname>Harris</surname><given-names>L</given-names></string-name></person-group><etal>et al</etal><article-title>Benchmarking challenging small variants with linked and long reads</article-title>. <source>Cell Genom</source><year>2022</year>;<volume>2</volume>:<fpage>100128</fpage>. <pub-id pub-id-type="doi">10.1016/j.xgen.2022.100128</pub-id><pub-id pub-id-type="pmid">36452119</pub-id></mixed-citation>
    </ref>
    <ref id="btae042-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wenger</surname><given-names>AM</given-names></string-name>, <string-name><surname>Peluso</surname><given-names>P</given-names></string-name>, <string-name><surname>Rowell</surname><given-names>WJ</given-names></string-name></person-group><etal>et al</etal><article-title>Accurate circular consensus long-read sequencing improves variant detection and assembly of a human genome</article-title>. <source>Nat Biotechnol</source><year>2019</year>;<volume>37</volume>:<fpage>1155</fpage>–<lpage>62</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0217-9</pub-id><pub-id pub-id-type="pmid">31406327</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
