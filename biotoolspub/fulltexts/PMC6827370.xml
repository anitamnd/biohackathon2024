<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genetics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genetics</journal-id>
    <journal-id journal-id-type="hwp">genetics</journal-id>
    <journal-id journal-id-type="pmc">genetics</journal-id>
    <journal-id journal-id-type="publisher-id">genetics</journal-id>
    <journal-title-group>
      <journal-title>Genetics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0016-6731</issn>
    <issn pub-type="epub">1943-2631</issn>
    <publisher>
      <publisher-name>Genetics Society of America</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6827370</article-id>
    <article-id pub-id-type="publisher-id">302373</article-id>
    <article-id pub-id-type="doi">10.1534/genetics.119.302373</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Investigations</subject>
        <subj-group>
          <subject>Population and Evolutionary Genetics</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Bayesian Estimation of Population Size Changes by Sampling Tajima’s Trees</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Palacios</surname>
          <given-names>Julia A.</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">*</xref>
        <xref ref-type="aff" rid="aff2">
          <sup>†</sup>
        </xref>
        <xref ref-type="corresp" rid="cor1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Véber</surname>
          <given-names>Amandine</given-names>
        </name>
        <xref ref-type="aff" rid="aff3">
          <sup>‡</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cappello</surname>
          <given-names>Lorenzo</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Zhangyuan</given-names>
        </name>
        <xref ref-type="aff" rid="aff4">
          <sup>§</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wakeley</surname>
          <given-names>John</given-names>
        </name>
        <xref ref-type="aff" rid="aff5">**</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ramachandran</surname>
          <given-names>Sohini</given-names>
        </name>
        <xref ref-type="aff" rid="aff6">
          <sup>††</sup>
        </xref>
        <xref ref-type="aff" rid="aff7">
          <sup>‡‡</sup>
        </xref>
      </contrib>
      <aff id="aff1"><label>*</label>Department of Statistics, Stanford University, California 94305</aff>
      <aff id="aff2"><label>†</label>Department of Biomedical Data Science, Stanford School of Medicine, California 94305</aff>
      <aff id="aff3"><label>‡</label>Centre de Mathématiques Appliquées, École Polytechnique 91128, Le Centre National de la Recherche Scientifique, Palaiseau, France 91767</aff>
      <aff id="aff4"><label>§</label>Department of Computer Science, Stanford University, California 94305</aff>
      <aff id="aff5"><label>**</label>Department of Organismic and Evolutionary Biology, Harvard University, Cambridge, Massachusetts 02138</aff>
      <aff id="aff6"><label>††</label>Center for Computational Molecular Biology, Brown University, Providence, Rhode Island 02912</aff>
      <aff id="aff7"><label>‡‡</label>Department of Ecology and Evolutionary Biology, Brown University, Providence, Rhode Island 02912</aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>1</label>Corresponding author: Stanford School of Medicine and Stanford University, 390 Serra Mall, Palo Alto, CA 94305. E-mail: <email>juliapr@stanford.edu</email></corresp>
    </author-notes>
    <!--Fake ppub date generated by PMC from publisher
					pub-date/@pub-type='epub-ppub' -->
    <pub-date pub-type="ppub">
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>11</day>
      <month>9</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>11</day>
      <month>9</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>213</volume>
    <issue>3</issue>
    <fpage>967</fpage>
    <lpage>986</lpage>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>5</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>06</day>
        <month>9</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2019 by the Genetics Society of America</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="open-access">
        <license-p>Available freely online through the author-supported open access option.</license-p>
      </license>
    </permissions>
    <self-uri xlink:title="pdf" xlink:href="967.pdf"/>
    <abstract>
      <p>The large state space of gene genealogies is a major hurdle for inference methods based on Kingman’s coalescent. Here, we present a new Bayesian approach for inferring past population sizes, which relies on a lower-resolution coalescent process that we refer to as “Tajima’s coalescent.” Tajima’s coalescent has a drastically smaller state space, and hence it is a computationally more efficient model, than the standard Kingman coalescent. We provide a new algorithm for efficient and exact likelihood calculations for data without recombination, which exploits a directed acyclic graph and a correspondingly tailored Markov Chain Monte Carlo method. We compare the performance of our Bayesian Estimation of population size changes by Sampling Tajima’s Trees (BESTT) with a popular implementation of coalescent-based inference in BEAST using simulated and human data. We empirically demonstrate that BESTT can accurately infer effective population sizes, and it further provides an efficient alternative to the Kingman’s coalescent. The algorithms described here are implemented in the R package phylodyn, which is available for download at <ext-link ext-link-type="uri" xlink:href="https://github.com/JuliaPalacios/phylodyn">https://github.com/JuliaPalacios/phylodyn</ext-link>.</p>
    </abstract>
    <kwd-group>
      <kwd>Bayesian nonparametrics</kwd>
      <kwd>coalescent</kwd>
      <kwd>effective population size</kwd>
      <kwd>Tajima coalescent</kwd>
    </kwd-group>
    <counts>
      <fig-count count="13"/>
      <table-count count="2"/>
      <equation-count count="30"/>
      <ref-count count="52"/>
      <page-count count="20"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>MODELING gene genealogies from an alignment of sequences (timed and rooted bifurcating trees reflecting the ancestral relationships among sampled sequences), is a key step in coalescent-based inference of evolutionary parameters such as effective population sizes. In the neutral coalescent model without recombination, observed sequence variation is produced by a stochastic process of mutation acting along the branches of the gene genealogy (<xref rid="bib50" ref-type="bibr">Watterson 1975</xref>; <xref rid="bib24" ref-type="bibr">Kingman 1982a</xref>), which is modeled as a realization of the coalescent point process at a neutral nonrecombining locus. In the coalescent point process, the rate of coalescence (the merging of two lineages into a common ancestor at some time in the past) is a function that varies with time, and it is inversely proportional to the effective population size at time <italic>t</italic>, <inline-formula><mml:math id="me1"><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="bib25" ref-type="bibr">Kingman 1982b</xref>; <xref rid="bib45" ref-type="bibr">Slatkin and Hudson 1991</xref>; <xref rid="bib9" ref-type="bibr">Donnelly and Tavaré 1995</xref>). Our goal is to infer <inline-formula><mml:math id="me2"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, which we will refer to as the “effective population size trajectory.”</p>
  <p>Multiple methods have been developed to infer <inline-formula><mml:math id="me3"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> using the standard coalescent model with or without recombination. Some of these methods infer <inline-formula><mml:math id="me4"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> from summary statistics such as the sample frequency spectrum (SFS) (<xref rid="bib6" ref-type="bibr">Bhaskar <italic>et al.</italic> 2015</xref>; <xref rid="bib49" ref-type="bibr">Terhorst <italic>et al.</italic> 2017</xref>); however, the SFS is not a sufficient statistic for inferring <inline-formula><mml:math id="me5"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (<xref rid="bib40" ref-type="bibr">Sainudiin <italic>et al.</italic> 2011</xref>). Other methods have been proposed that directly use molecular sequence alignments at a completely linked locus, <italic>i.e.</italic>, without recombination (<xref rid="bib17" ref-type="bibr">Griffiths and Tavaré 1996</xref>; <xref rid="bib27" ref-type="bibr">Kuhner and Smith 2007</xref>; <xref rid="bib32" ref-type="bibr">Minin <italic>et al.</italic> 2008</xref>; <xref rid="bib30" ref-type="bibr">Li and Durbin 2011</xref>; <xref rid="bib12" ref-type="bibr">Drummond <italic>et al.</italic> 2012</xref>; <xref rid="bib13" ref-type="bibr">Gill <italic>et al.</italic> 2013</xref>; <xref rid="bib35" ref-type="bibr">Palacios and Minin 2013</xref>). Our approach is of this type. Still other methods account for recombination across larger genomic segments (<xref rid="bib30" ref-type="bibr">Li and Durbin 2011</xref>; <xref rid="bib44" ref-type="bibr">Sheehan <italic>et al.</italic> 2013</xref>; <xref rid="bib42" ref-type="bibr">Schiffels and Durbin 2014</xref>; <xref rid="bib36" ref-type="bibr">Palacios <italic>et al.</italic> 2015</xref>). In spite of their variety, all these methods must contend with two major challenges: (1) choosing a prior distribution or functional form for <inline-formula><mml:math id="me6"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, and (2) integrating over the large hidden state space of genealogies. For example, several previous approaches have assumed exponential growth (<xref rid="bib17" ref-type="bibr">Griffiths and Tavaré 1996</xref>; <xref rid="bib28" ref-type="bibr">Kuhner <italic>et al.</italic> 1998</xref>; <xref rid="bib27" ref-type="bibr">Kuhner and Smith 2007</xref>), in which case the estimation of <inline-formula><mml:math id="me7"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is reduced to the estimation of one or two parameters. In general, the functional form of <inline-formula><mml:math id="me8"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is unknown and needs to be inferred. A commonly used naive nonparametric prior on <inline-formula><mml:math id="me9"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is a piecewise linear or constant function defined on time intervals of constant or varying sizes (<xref rid="bib20" ref-type="bibr">Heled and Drummond 2008</xref>; <xref rid="bib44" ref-type="bibr">Sheehan <italic>et al.</italic> 2013</xref>; <xref rid="bib42" ref-type="bibr">Schiffels and Durbin 2014</xref>). The specification of change points in such time-discretized effective population size trajectories is inherently difficult because it can lead to runaway behavior or large uncertainty in <inline-formula><mml:math id="me10"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. These difficulties can be avoided by the use of Gaussian process priors in a Bayesian nonparametric framework, allowing accurate and precise estimation (<xref rid="bib13" ref-type="bibr">Gill <italic>et al.</italic> 2013</xref>; <xref rid="bib35" ref-type="bibr">Palacios and Minin 2013</xref>; <xref rid="bib29" ref-type="bibr">Lan <italic>et al.</italic> 2015</xref>; <xref rid="bib36" ref-type="bibr">Palacios <italic>et al.</italic> 2015</xref>). More precisely, the autocorrelation modeled with the Gaussian process avoids runaway behavior and large uncertainty in <inline-formula><mml:math id="me11"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
  <p>The second challenge for coalescent-based inference of <inline-formula><mml:math id="me12"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the integration over the hidden state space of genealogies for large sample sizes. Given molecular sequence data <inline-formula><mml:math id="me13"><mml:mi mathvariant="bold">Y</mml:mi></mml:math></inline-formula> at a single nonrecombining locus and a mutation model with parameter <inline-formula><mml:math id="me14"><mml:mo>μ</mml:mo></mml:math></inline-formula>, current methods rely on calculating the marginal likelihood function <inline-formula><mml:math id="me15"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>μ</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> by integrating over all possible coalescence and mutation events. Under the infinite sites mutation model without intralocus recombination (<xref rid="bib50" ref-type="bibr">Watterson 1975</xref>), this integration requires a computationally expensive importance sampling technique or Markov Chain Monte Carlo (MCMC) techniques (<xref rid="bib14" ref-type="bibr">Griffiths and Tavaré 1994a</xref>; <xref rid="bib46" ref-type="bibr">Stephens and Donnelly 2000</xref>; <xref rid="bib21" ref-type="bibr">Hobolth <italic>et al.</italic> 2008</xref>; <xref rid="bib52" ref-type="bibr">Wu 2010</xref>; <xref rid="bib18" ref-type="bibr">Gronau <italic>et al.</italic> 2011</xref>). Moreover, a maximum likelihood estimate of <inline-formula><mml:math id="me16"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> cannot be explicitly obtained; instead, it is obtained by exploring a grid of parameter values (<xref rid="bib48" ref-type="bibr">Tavaré 2004</xref>). For finite sites mutation models, current methods approximate the marginal likelihood function by integrating over all possible genealogies via MCMC methods [Equation 1; <xref rid="bib26" ref-type="bibr">Kuhner (2006)</xref>; <xref rid="bib12" ref-type="bibr">Drummond <italic>et al.</italic> (2012)</xref>]. In both cases, the marginal likelihood may be expressed as<disp-formula id="eq1"><mml:math id="me17"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="italic">∫</mml:mi><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:mi mathvariant="normal">g</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>g</mml:mtext><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math><label>(1)</label></disp-formula>in which Pr<inline-formula><mml:math id="me18"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mo>⋅</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is used to denote both the probability of discrete variables and the density of continuous variables. The integral above involves an <inline-formula><mml:math id="me19"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>-dimensional integral over <inline-formula><mml:math id="me20"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> coalescent times and a sum over all possible tree topologies with <italic>n</italic> leaves. Therefore, these methods require a very large number of MCMC samples, and exploration of the posterior space of genealogies continues to be an active area of research (<xref rid="bib28" ref-type="bibr">Kuhner <italic>et al.</italic> 1998</xref>; <xref rid="bib37" ref-type="bibr">Rannala and Yang 2003</xref>; <xref rid="bib12" ref-type="bibr">Drummond <italic>et al.</italic> 2012</xref>; <xref rid="bib51" ref-type="bibr">Whidden and Matsen 2015</xref>; <xref rid="bib2" ref-type="bibr">Aberer <italic>et al.</italic> 2016</xref>).</p>
  <p>Current methods rely on the Kingman <italic>n</italic>-coalescent process to model the sample’s ancestry. However, the state space of genealogical trees grows superexponentially with the number of samples, making inference computationally challenging for large sample sizes. In this study, we develop a Bayesian nonparametric model that relies on Tajima’s coalescent, a lower-resolution coalescent process with a drastically smaller state space than that of Kingman’s coalescent. In particular, we approximate the posterior distribution <inline-formula><mml:math id="me21"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mi mathvariant="bold">g</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="italic">τ</mml:mi><mml:mo>|</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="me22"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> corresponds to the Tajima’s genealogy of the sample (see <xref ref-type="fig" rid="fig1">Figure 1A</xref> and <italic>Tajima’s genealogies</italic>), <inline-formula><mml:math id="me23"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> has a Gaussian process prior with precision hyperparameter <italic>τ</italic> that influences the smoothness of the resulting trajectory, and mutations occur according to the infinite sites model of <xref rid="bib50" ref-type="bibr">Watterson (1975)</xref>. This results in a new efficient method for inferring <inline-formula><mml:math id="me24"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> called <bold>B</bold>ayesian <bold>E</bold>stimation by <bold>S</bold>ampling <bold>T</bold>ajima’s <bold>T</bold>rees (BESTT), with a drastic reduction in the state space of genealogies. Using simulated data, we show that BESTT can accurately infer effective population size trajectories and that it provides a more efficient alternative than Kingman’s coalescent models.</p>
  <fig id="fig1" fig-type="figure" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>For a sample of size <italic>n</italic>, the number of Tajima’s genealogies is superexponentially fewer compared to the number of Kingman’s genealogies. (A) A Kingman’s genealogy and a Tajima’s genealogy for <inline-formula><mml:math id="me25"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>. A Kingman’s genealogy (left) comprises a vector of coalescent times and the labeled topology; the number of possible labeled topologies for a sample of size <italic>n</italic> is <inline-formula><mml:math id="me26"><mml:mrow><mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>!</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>!</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. A Tajima’s genealogy (right) comprises a vector of coalescent times and a ranked tree shape. In both cases, coalescent events are ranked from 2 at time <inline-formula><mml:math id="me27"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to <italic>n</italic> at time <inline-formula><mml:math id="me28"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Coalescent times are measured from the present (time 0) back into the past. (B) The numbers of labeled topologies and ranked tree shapes (formulas provided in <italic>Tajima’s genealogies</italic>) for different values of the sample size, <italic>n</italic>.</p>
    </caption>
    <graphic xlink:href="967f1"/>
  </fig>
  <p>Next, we start with an overview of BESTT, detail our representation of molecular sequence data, and define the Tajima coalescent process. We then introduce a new augmented representation of sequence data as a directed acyclic graph (DAG). This representation allows us to both calculate the conditional likelihood under the Tajima coalescent model and to sample tree topologies compatible with the observed data. We then provide an algorithm for likelihood calculations and develop an MCMC approach to efficiently explore the state space of unknown parameters. Finally, we compare our method to other methods implemented in Bayesian Evolutionary Analysis Sampling Trees (BEAST) (<xref rid="bib12" ref-type="bibr">Drummond <italic>et al.</italic> 2012</xref>) and estimate the effective population size trajectory from human mitochondrial DNA (mtDNA) data. We close with a discussion of possible extensions, and limitations of the proposed model and implementation.</p>
  <sec sec-type="materials|methods" id="s1">
    <title>Materials and Methods</title>
    <sec id="s2">
      <title>Overview of BESTT</title>
      <p>Our objective in the implementation of BESTT is to estimate the posterior distribution of model parameters by replacing Kingman’s genealogy with Tajima’s genealogy <inline-formula><mml:math id="me29"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. A Tajima’s genealogy does not include labels at the tips (<xref ref-type="fig" rid="fig1">Figure 1</xref>): we do not order individuals in the sample but label only the lineages that are ancestral to at least two individuals (that is, we only label the internal nodes of the genealogy). Replacing Kingman’s genealogy by Tajima’s genealogy in our posterior distribution exponentially reduces the size of the state space of genealogies (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). To compute <inline-formula><mml:math id="me30"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, the conditional likelihood of the data conditioned on a Tajima’s genealogy, we assume the infinite sites model of mutations, and leverage a DAG representation of sequence data and genealogical information. Note that the overall likelihood, Equation 1, will differ only by a combinatorial factor from the corresponding likelihood under the Kingman coalescent. Our DAG represents the data with a gene tree (<xref rid="bib14" ref-type="bibr">Griffiths and Tavaré 1994a</xref>), constructed via a modified version of the perfect phylogeny algorithm of <xref rid="bib19" ref-type="bibr">Gusfield (1991)</xref>. This provides an economical representation of the uncertainty, and conditional independences induced by the model and the observed data.</p>
      <p>Under the infinite sites mutation model, there is a one-to-one correspondence between observed sequence data and the gene tree of the data (<xref rid="bib19" ref-type="bibr">Gusfield 1991</xref>) (<italic>Summarizing sequence data <inline-formula><mml:math id="me31"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:math></inline-formula> as haplotypes and mutation groups</italic> and <italic>Representing <inline-formula><mml:math id="me32"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> as a gene tree</italic>). We further augment the gene tree representation with the allocation of the number of observed mutations along the Tajima’s genealogy to generate a DAG (<italic>An augmented data representation using directed acyclic graphs</italic>). The conditional likelihood <inline-formula><mml:math id="me33"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is then calculated via a recursive algorithm that exploits the auxiliary variables defined in the DAG nodes, marginalizing over all possible mutation allocations (<italic>Computing the conditional likelihood</italic>). We approximate the joint posterior distribution <inline-formula><mml:math id="me34"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">τ</mml:mi><mml:mo>|</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> via an MCMC algorithm using Hamiltonian Monte Carlo for sampling the continuous parameters of the model and a novel Metropolis–Hastings algorithm for sampling the discrete tree space.</p>
    </sec>
    <sec id="s3">
      <title>Summarizing sequence data <inline-formula><mml:math id="me35"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:math></inline-formula> as haplotypes and mutation groups</title>
      <p>Let the data consist of <italic>n</italic> fully linked haploid sequences or alignments of nucleotides at <italic>s</italic> segregating sites sampled from <italic>n</italic> individuals at time <inline-formula><mml:math id="me36"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> (the present). Note that any labels we affix to the individuals are arbitrary in the sense that they will not enter into the calculation of the likelihood. We further assume the infinite sites mutation model of <xref rid="bib50" ref-type="bibr">Watterson (1975)</xref> with mutation parameter <italic>μ</italic> and known ancestral states for each of the sites. Then, we can encode the data into a binary matrix <inline-formula><mml:math id="me37"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:math></inline-formula> of <italic>n</italic> rows and <italic>s</italic> columns with elements <inline-formula><mml:math id="me38"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where 0 indicates the ancestral allele.</p>
      <p>To calculate the Tajima’s conditional likelihood <inline-formula><mml:math id="me39"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we first record each haplotype’s frequency and group repeated columns to form <italic>mutation groups</italic>; a mutation group corresponds to a shared set of mutations in a subset of the sampled individuals. We record the cardinality of each mutation group (<italic>i.e.</italic>, the number of columns that show each mutation group). In <xref ref-type="fig" rid="fig2">Figure 2A</xref>, there are two columns labeled “b,” corresponding to two segregating sites that have the exact same pattern of allelic states across the sample. Further, two individuals carry the derived allele of mutation group b, so in this case the frequency of haplotype 7 and the cardinality of mutation group b are both equal to 2. Likewise, haplotype 4 has frequency 1 and carries five mutations that are split into mutation groups “a,” “f,” and “g” (the latter is not shown in <xref ref-type="fig" rid="fig2">Figure 2A</xref>, but appears in <xref ref-type="fig" rid="fig2">Figure 2B</xref>) of respective cardinalities 1, 3, and 1. We denote the number of haplotypes in the sample as <italic>h</italic>, the number of mutation groups as <italic>m</italic>, and the representation of <inline-formula><mml:math id="me40"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:math></inline-formula> as haplotypes and mutation groups as <inline-formula><mml:math id="me41"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
      <fig id="fig2" fig-type="figure" orientation="portrait" position="float">
        <label>Figure 2</label>
        <caption>
          <p>Data structures employed by our method, Bayesian Estimation of population size changes by Sampling Tajima’s Trees (BESTT), for calculating the conditional likelihood of the data. (A) Compressed data representation <inline-formula><mml:math id="me42"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of <inline-formula><mml:math id="me43"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula> sequences and <inline-formula><mml:math id="me44"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>18</mml:mn></mml:mrow></mml:math></inline-formula> (columns, only the first 10 of which are shown), comprised of nine haplotypes and 13 mutation groups. Rows correspond to haplotypes and each polymorphic site is labeled by its mutation group <inline-formula><mml:math id="me45"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. (B) Gene tree representation of the data in (A). Red numbers indicate the cardinality of each mutation group [number of columns with the same label in (A)]. Black letters indicate the mutation group [column labels in (A)], and black numbers indicate the frequency of the corresponding haplotype. (C) A Tajima’s genealogy compatible with the gene tree in (B). Internal nodes are labeled according to order of coalescent events from the root to the tips. Coalescent event <italic>i</italic> happens at time <inline-formula><mml:math id="me46"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and branches are labeled <inline-formula><mml:math id="me47"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (see <italic>An augmented data representation using directed acyclic graphs</italic> for details). (D) A Directed Acyclic Graph (DAG) representation of the gene tree in (B) together with allocation of mutation groups along the branches of the Tajima’s genealogy in (C). <inline-formula><mml:math id="me48"><mml:mrow><mml:msub><mml:mi mathvariant="script">V</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denotes the set of internal nodes and <inline-formula><mml:math id="me49"><mml:mrow><mml:msub><mml:mi mathvariant="script">V</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> the set of leaf nodes. A detailed description of the DAG is given in <italic>An augmented data representation using directed acyclic graphs</italic>.</p>
        </caption>
        <graphic xlink:href="967f2"/>
      </fig>
    </sec>
    <sec id="s4">
      <title>Representing <inline-formula><mml:math id="me50"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> as a gene tree</title>
      <p><inline-formula><mml:math id="me51"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig2">Figure 2A</xref>) can alternatively be represented as a gene tree or perfect phylogeny (<xref rid="bib19" ref-type="bibr">Gusfield 1991</xref>; <xref rid="bib15" ref-type="bibr">Griffiths and Tavaré 1994b</xref>). This representation relies on our assumption of the infinite sites mutation model in which, if a site mutates once in a given lineage, all descendants of that lineage also have the mutation <italic>and no other individuals carry that mutation</italic>. The gene tree is a graphical representation of the haplotypes (as tips) arranged by their patterns of shared mutations. The haplotype data summarized in <xref ref-type="fig" rid="fig2">Figure 2A</xref> correspond to the gene tree given in <xref ref-type="fig" rid="fig2">Figure 2B</xref>. Details of the correspondence between haplotype data and gene tree are listed below, and an additional example is given in Figure E1 (Appendix E).A <italic>gene tree</italic> for a matrix <inline-formula><mml:math id="me52"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of <italic>h</italic> haplotypes and <italic>m</italic> mutation groups is a rooted tree <inline-formula><mml:math id="me53"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> with <italic>h</italic> leaves and at least <italic>m</italic> edges, such that (<xref ref-type="fig" rid="fig2">Figure 2B</xref>):<list list-type="order" id="L1"><list-item><p>Each row of <inline-formula><mml:math id="me54"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to exactly one leaf of <inline-formula><mml:math id="me55"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula>. The black numbers at leaf nodes in <xref ref-type="fig" rid="fig2">Figure 2B</xref> are the haplotype frequencies.</p></list-item><list-item><p>Each mutation group of <inline-formula><mml:math id="me56"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is represented by exactly one edge of <inline-formula><mml:math id="me57"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula>, which is labeled accordingly (letters in <xref ref-type="fig" rid="fig2">Figure 2, A and B</xref>). The red numbers along edges in <xref ref-type="fig" rid="fig2">Figure 2B</xref> give the cardinality of each mutation group (<italic>i.e.</italic>, the number of segregating sites in this group; see <xref ref-type="fig" rid="fig2">Figure 2A</xref>). Some external edges (edges subtending leaves) may not be labeled, indicating that they do not carry additional mutations to their parent edge. This happens when the other edges emanating from the parent node necessarily correspond to other mutation groups.</p></list-item><list-item><p>Edges are placed in the gene tree in such a way that each “path” from the root to a leaf fully describes a haplotype. Edges corresponding to shared mutations between several haplotypes are closest to the root. For example, in <xref ref-type="fig" rid="fig2">Figure 2B</xref>, haplotype 4 corresponds to the leaf at which one arrives starting from the root and going along edges a, g, and f; in contrast, haplotype 7 corresponds to the leaf at which one arrives going from the root along edge b. Thus, the labels and the numbers associated with the edges along the unique path from the root to a leaf exactly specify a row of <inline-formula><mml:math id="me58"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>.</p></list-item></list>Dan Gusfield’s perfect phylogeny algorithm (<xref rid="bib19" ref-type="bibr">Gusfield 1991</xref>) transforms the sequence data <inline-formula><mml:math id="me59"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> into a gene tree and this transformation is one-to-one. We note that the perfect phylogeny <inline-formula><mml:math id="me60"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> or gene tree is not the same as the genealogy <inline-formula><mml:math id="me61"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle></mml:math></inline-formula>. While a genealogy is a bifurcating tree of individuals of the sample, the gene tree is a multifurcating tree of haplotypes.</p>
    </sec>
    <sec id="s5">
      <title>Tajima’s genealogies</title>
      <p>Our method of computing the probability of the recoded data, <inline-formula><mml:math id="me62"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, uses ranked tree shapes rather than fully labeled histories. We refer to these ranked tree shapes as Tajima’s genealogies but note they have also been called <italic>unlabeled rooted trees</italic> (<xref rid="bib16" ref-type="bibr">Griffiths and Tavaré 1995</xref>) and <italic>evolutionary relationships</italic> (<xref rid="bib47" ref-type="bibr">Tajima 1983</xref>). In Tajima’s genealogies, only the internal nodes are labeled and they are labeled by their order in time. Tajima’s genealogies encode the minimum information needed to compute the probability of data <inline-formula><mml:math id="me63"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, which consists of nested sets of mutations, without any approximations. In <xref ref-type="fig" rid="fig1">Figure 1A</xref> for example, it matters only that mutation group e occurs on a subgroup of the individuals who carry mutation group “a,” and that this is different from the subgroups carrying c, d, and f. No other labels matter because individuals are exchangeable in the population model we assume.</p>
      <p>This represents a dramatic coarsening of tree space compared to the classical leaf-labeled binary trees of Kingman’s coalescent. The number of possible ranked tree shapes for a sample of size <italic>n</italic> corresponds to the <italic>n</italic>-th term of the sequence A000111 of Euler zig-zag numbers (<xref rid="bib8" ref-type="bibr">Disanto and Wiehe 2013</xref>) whereas the number of labeled binary tree topologies is <inline-formula><mml:math id="me64"><mml:mrow><mml:mi>n</mml:mi><mml:mo>!</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>!</mml:mo><mml:mo>/</mml:mo><mml:msup><mml:mn>2</mml:mn><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. As can be seen from <xref ref-type="fig" rid="fig1">Figure 1B</xref>, this provides a much more efficient way to integrate over the key hidden variable, the unknown gene genealogy of the sample, when computing likelihoods.</p>
      <p>We model this hidden variable using the <italic>vintaged and sized coalescent</italic> (<xref rid="bib41" ref-type="bibr">Sainudiin <italic>et al.</italic> 2015</xref>), which corresponds exactly to this coarsening of Kingman’s coalescent. As can be seen in <xref ref-type="fig" rid="fig1">Figure 1A</xref>, we assign vintages/labels 2 through <italic>n</italic> starting at the root of the tree and moving toward the present, so that the node created by the final splitting event, which is also the first coalescence event looking back in the ancestry of the sample, is labeled <italic>n</italic>. We write <inline-formula><mml:math id="me65"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for the time of node <italic>k</italic>, measured from the present back into the past. We set <inline-formula><mml:math id="me66"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> to be the present time. Then during the interval <inline-formula><mml:math id="me67"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> the sample has exactly <italic>k</italic> extant ancestors, for <inline-formula><mml:math id="me68"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <p>The coarsening of the tree topology does not change the law of the times between two coalescence events. Thus, conditional on the effective population size trajectory <inline-formula><mml:math id="me69"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and the time <inline-formula><mml:math id="me70"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> at which the number of ancestors to the sample decreases to <italic>k</italic>, the distribution of the time during which the sample has <italic>k</italic> ancestors is given by<disp-formula id="eq2"><mml:math id="me71"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:msup><mml:mstyle mathsize="140%" displaystyle="true"><mml:mi mathvariant="italic">∫</mml:mi></mml:mstyle><mml:mtext>​</mml:mtext></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mfrac><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math><label>(2)</label></disp-formula>(<xref rid="bib45" ref-type="bibr">Slatkin and Hudson 1991</xref>), where <inline-formula><mml:math id="me72"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>k</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Writing the density at <inline-formula><mml:math id="me73"><mml:mi mathvariant="italic">t</mml:mi><mml:mo>=</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> of the vector of coalescence times as a product of conditional densities, we obtain<disp-formula id="eq3"><mml:math id="me74"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">t</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:munder><mml:mrow><mml:mover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mi>n</mml:mi></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:munder></mml:mrow><mml:mrow/></mml:munder><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math><label>(3)</label></disp-formula>We use a lower triangular matrix denoted <inline-formula><mml:math id="me75"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></inline-formula> to represent Tajima’s genealogies; see Appendix A. The probability of a ranked tree shape was derived independently in <xref rid="bib41" ref-type="bibr">Sainudiin <italic>et al.</italic> (2015)</xref> and <xref rid="bib36" ref-type="bibr">Palacios <italic>et al.</italic> (2015)</xref>. Specifically, for every ranked tree shape <inline-formula><mml:math id="me76"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></inline-formula> with <italic>n</italic> leaves,<disp-formula id="eq4"><mml:math id="me77"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>c</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math><label>(4)</label></disp-formula>where <italic>c</italic> is the number of cherries in <inline-formula><mml:math id="me78"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></inline-formula> (<italic>i.e.</italic>, nodes subtending two leaves; <inline-formula><mml:math id="me79"><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> in Figure A1A). Note that this probability is independent of the effective population size trajectory since the choice of the pair of lineages that coalesce during an event is independent of <inline-formula><mml:math id="me80"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (recall that in Kingman’s coalescent, the coalescing pair is chosen uniformly at random among all possible pairs). Since the distribution of Tajima’s genealogies <inline-formula><mml:math id="me81"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> conditional on <inline-formula><mml:math id="me82"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> can be factored as the product of the probability of the ranked tree shape <inline-formula><mml:math id="me83"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></inline-formula> and the coalescent times density, we arrive at</p>
      <disp-formula id="eq5">
        <mml:math id="me84">
          <mml:mrow>
            <mml:mtext>Pr</mml:mtext>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:msup>
                  <mml:mstyle mathvariant="bold" mathsize="normal">
                    <mml:mi>g</mml:mi>
                  </mml:mstyle>
                  <mml:mi>T</mml:mi>
                </mml:msup>
                <mml:mo>|</mml:mo>
                <mml:msub>
                  <mml:mrow>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:mi>N</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mi>t</mml:mi>
                    <mml:mo>≥</mml:mo>
                    <mml:mn>0</mml:mn>
                  </mml:mrow>
                </mml:msub>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>=</mml:mo>
            <mml:mfrac>
              <mml:mrow>
                <mml:msup>
                  <mml:mn>2</mml:mn>
                  <mml:mrow>
                    <mml:mi>n</mml:mi>
                    <mml:mo>−</mml:mo>
                    <mml:mi>c</mml:mi>
                    <mml:mo>−</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                </mml:msup>
              </mml:mrow>
              <mml:mrow>
                <mml:mrow>
                  <mml:mo>(</mml:mo>
                  <mml:mrow>
                    <mml:mi>n</mml:mi>
                    <mml:mo>−</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mo>)</mml:mo>
                </mml:mrow>
                <mml:mo>!</mml:mo>
              </mml:mrow>
            </mml:mfrac>
            <mml:munder>
              <mml:mrow>
                <mml:mover>
                  <mml:mstyle mathsize="140%" displaystyle="true">
                    <mml:mo>∏</mml:mo>
                  </mml:mstyle>
                  <mml:mi>n</mml:mi>
                </mml:mover>
              </mml:mrow>
              <mml:mrow>
                <mml:mi>k</mml:mi>
                <mml:mo>=</mml:mo>
                <mml:mn>2</mml:mn>
              </mml:mrow>
            </mml:munder>
            <mml:mrow>
              <mml:mo>(</mml:mo>
              <mml:mrow>
                <mml:mfrac>
                  <mml:mrow>
                    <mml:msub>
                      <mml:mi>C</mml:mi>
                      <mml:mi>k</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                  <mml:mrow>
                    <mml:mi>N</mml:mi>
                    <mml:mrow>
                      <mml:mo>(</mml:mo>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mo>)</mml:mo>
                    </mml:mrow>
                  </mml:mrow>
                </mml:mfrac>
                <mml:mtext>exp</mml:mtext>
                <mml:mrow>
                  <mml:mo>[</mml:mo>
                  <mml:mrow>
                    <mml:mo>−</mml:mo>
                    <mml:msubsup>
                      <mml:mrow>
                        <mml:msup>
                          <mml:mstyle mathsize="140%" displaystyle="true">
                            <mml:mi mathvariant="italic">∫</mml:mi>
                          </mml:mstyle>
                          <mml:mtext>​</mml:mtext>
                        </mml:msup>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                            <mml:mo>+</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>t</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                    </mml:msubsup>
                    <mml:mfrac>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>C</mml:mi>
                          <mml:mi>k</mml:mi>
                        </mml:msub>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>N</mml:mi>
                        <mml:mrow>
                          <mml:mo>(</mml:mo>
                          <mml:mi>t</mml:mi>
                          <mml:mo>)</mml:mo>
                        </mml:mrow>
                      </mml:mrow>
                    </mml:mfrac>
                    <mml:mtext> </mml:mtext>
                    <mml:mi>d</mml:mi>
                    <mml:mi>t</mml:mi>
                  </mml:mrow>
                  <mml:mo>]</mml:mo>
                </mml:mrow>
              </mml:mrow>
              <mml:mo>)</mml:mo>
            </mml:mrow>
            <mml:mo>.</mml:mo>
          </mml:mrow>
        </mml:math>
        <label>(5)</label>
      </disp-formula>
    </sec>
    <sec id="s6">
      <title>An augmented data representation using directed acyclic graphs</title>
      <p>A key component of BESTT is the calculation of the conditional likelihood <inline-formula><mml:math id="me85"><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula>. We compute the conditional likelihood recursively over a DAG, <inline-formula><mml:math id="me86"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>. Our DAG exploits the gene tree representation <inline-formula><mml:math id="me87"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> of the data (<xref ref-type="fig" rid="fig2">Figure 2B</xref>), incorporates the branch length information of the Tajima’s genealogy <inline-formula><mml:math id="me88"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>(<xref ref-type="fig" rid="fig2">Figure 2C</xref>), and facilitates the recursive allocation of mutations to the branches of <inline-formula><mml:math id="me89"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. Here, we detail the construction of the DAG.</p>
      <p>We construct the DAG using three pieces of information: the observed gene tree <inline-formula><mml:math id="me90"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula>, a given Tajima’s genealogy <inline-formula><mml:math id="me91"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> and a latent allocation of mutations along the branches of the Tajima’s genealogy (<xref ref-type="fig" rid="fig3">Figure 3</xref>). An allocation refers to a possible mapping (compatible with the data) of the observed numbers of mutations (red numbers in <xref ref-type="fig" rid="fig2">Figure 2B</xref>) to branches in the Tajima’s genealogy. <xref ref-type="fig" rid="fig3">Figure 3A</xref> shows one possible mapping for the Tajima’s genealogy in <xref ref-type="fig" rid="fig2">Figure 2C</xref>; usually this mapping is not unique. Our construction of <inline-formula><mml:math id="me92"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula> enables an efficient recursive consideration of all possible allocations of mutations along <inline-formula><mml:math id="me93"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> when computing the conditional likelihood <inline-formula><mml:math id="me94"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      <fig id="fig3" fig-type="figure" orientation="portrait" position="float">
        <label>Figure 3</label>
        <caption>
          <p>Directed Acyclic Graph (DAG) construction. (A) A Tajima’s genealogy from <xref ref-type="fig" rid="fig2">Figure 2C</xref> with added allocation of mutations shown in red. (B) The corresponding augmented DAG with allocation of mutations. At the root <inline-formula><mml:math id="me95"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, there are no mutations by convention. Node <inline-formula><mml:math id="me96"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> has 16 descendants across three subtrees of <inline-formula><mml:math id="me97"><mml:mrow><mml:mn>7</mml:mn><mml:mo>,</mml:mo><mml:mn>7</mml:mn></mml:mrow></mml:math></inline-formula> and two descendants, corresponding to nodes <inline-formula><mml:math id="me98"><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi> </mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi> </mml:mi><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>. These three subtrees subtend from <inline-formula><mml:math id="me99"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="me100"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mn>14</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, respectively, in <inline-formula><mml:math id="me101"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> (A). Node <inline-formula><mml:math id="me102"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to the tree subtending from <inline-formula><mml:math id="me103"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mn>5</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> of size 7 with <inline-formula><mml:math id="me104"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> mutation along <inline-formula><mml:math id="me105"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mn>5</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and subtends three subtrees from <inline-formula><mml:math id="me106"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>9</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me107"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. Subtrees subtending from <inline-formula><mml:math id="me108"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>9</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are grouped together in leaf node <inline-formula><mml:math id="me109"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> because they both have two descendants and have the same parent node. When leaf nodes represent more than one tree, such as <inline-formula><mml:math id="me110"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> in <xref ref-type="fig" rid="fig4">Figure 4B</xref>, the random variable <inline-formula><mml:math id="me111"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the vector <inline-formula><mml:math id="me112"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> that denotes the number of mutations along the branches that subtends from the tree node <italic>j</italic> that have <inline-formula><mml:math id="me113"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> descendants, and <inline-formula><mml:math id="me114"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the number of edges subtending from <inline-formula><mml:math id="me115"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
        </caption>
        <graphic xlink:href="967f3"/>
      </fig>
      <sec id="s7">
        <title>Constructing the DAG <inline-formula><mml:math id="me116"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>:</title>
        <p>The graph structure of our DAG <inline-formula><mml:math id="me117"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Z</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig2">Figure 2D</xref>) with nodes <inline-formula><mml:math id="me118"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Z</mml:mi></mml:mstyle></mml:math></inline-formula> and edges <italic>E</italic> is constructed from a gene tree <inline-formula><mml:math id="me119"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula>. The number of internal nodes in the DAG <inline-formula><mml:math id="me120"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula> is the same as the number of internal nodes in <inline-formula><mml:math id="me121"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula>. However, sister leaf nodes in <inline-formula><mml:math id="me122"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> with the same number of descendants are grouped together in <inline-formula><mml:math id="me123"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula> and leaf nodes descending from edges with no mutations are treated as singletons grouped together in <inline-formula><mml:math id="me124"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>. For example, the leaves in <xref ref-type="fig" rid="fig2">Figure 2B</xref> subtending from edges <italic>i</italic> and <italic>j</italic> are grouped into <inline-formula><mml:math id="me125"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> in <xref ref-type="fig" rid="fig2">Figure 2D</xref>, as they both have haplotype frequency 2. However, the leaves subtending from the e and f edges are not grouped (and correspond to <inline-formula><mml:math id="me126"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me127"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>9</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> in the DAG <xref ref-type="fig" rid="fig2">Figure 2D</xref>) since they have respective haplotype frequencies 2 and 1. We label the root node of <inline-formula><mml:math id="me128"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula> as <inline-formula><mml:math id="me129"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and increase the index <italic>i</italic> of each node <inline-formula><mml:math id="me130"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> from top to bottom, moving left to right. For <inline-formula><mml:math id="me131"><mml:mrow><mml:mi>i</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula>, we assign a directed edge <inline-formula><mml:math id="me132"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> if the node in <inline-formula><mml:math id="me133"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> corresponding to <inline-formula><mml:math id="me134"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is connected to the node in <inline-formula><mml:math id="me135"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> corresponding to <inline-formula><mml:math id="me136"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. The index set of internal nodes in <inline-formula><mml:math id="me137"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula> is denoted by <inline-formula><mml:math id="me138"><mml:mrow><mml:msub><mml:mi mathvariant="normal">V</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and the index set of leaf nodes is denoted by <inline-formula><mml:math id="me139"><mml:mrow><mml:msub><mml:mi mathvariant="script">V</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
      </sec>
      <sec id="s8">
        <title>Information carried by the nodes in <inline-formula><mml:math id="me140"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>:</title>
        <p>Each node in <inline-formula><mml:math id="me141"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula> represents a vector, <inline-formula><mml:math id="me142"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, which includes number of descendants, number of mutations, and latent allocation of mutations. Although the number of descendants and number of mutations are part of the observed data, the allocation of mutations can be seen as a random variable; for ease of exposition, we use capital letters to denote all three types of information. We define the vector <inline-formula><mml:math id="me143"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> as follows:<disp-formula id="eq"><mml:math id="me144"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi mathvariant="script">V</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mtext> </mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>the root node</mml:mtext></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi mathvariant="script">V</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="me145"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denotes the number of descendants of (<italic>i.e.</italic>, of sampled sequences subtended by) node <inline-formula><mml:math id="me146"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me147"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denotes the number of mutations separating <inline-formula><mml:math id="me148"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> from its parent node, and <inline-formula><mml:math id="me149"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denotes the allocation of mutations along <inline-formula><mml:math id="me150"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> (described in detail below). The number of descendants <inline-formula><mml:math id="me151"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is thus the number of individuals/sequences descending from node <inline-formula><mml:math id="me152"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (this information is part of <inline-formula><mml:math id="me153"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula>). For internal nodes, <inline-formula><mml:math id="me154"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> records the cardinality of a mutation group, represented as a red number along the edge <inline-formula><mml:math id="me155"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of <inline-formula><mml:math id="me156"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> in <xref ref-type="fig" rid="fig2">Figure 2B</xref>, where <italic>i</italic> is the index of the parent node of <inline-formula><mml:math id="me157"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Leaf nodes in <inline-formula><mml:math id="me158"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula> may correspond to more than one leaf node in <inline-formula><mml:math id="me159"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula>, namely any sister nodes with the same number of descendants. In this case, <inline-formula><mml:math id="me160"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is a vector with the cardinalities of the corresponding mutation groups (see for example node <inline-formula><mml:math id="me161"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> in <xref ref-type="fig" rid="fig3">Figure 3B</xref>). To keep the DAG construction simple, we only allow groupings of leaf nodes and not of internal nodes with identical descendants carrying identical numbers of mutations. We note that, in principle, it would be possible to compress the number of internal nodes of the DAG by exploiting all the symmetries observed in the data.</p>
      </sec>
      <sec id="s9">
        <title>Allocation of mutation groups along <inline-formula><mml:math id="me162"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>:</title>
        <p>The latent allocation variables <inline-formula><mml:math id="me163"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> determine a possible correspondence between subtrees in <inline-formula><mml:math id="me164"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> and nodes in <inline-formula><mml:math id="me165"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>; in particular, <inline-formula><mml:math id="me166"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> indicates the branches in <inline-formula><mml:math id="me167"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> that subtend the subtrees corresponding to nodes <inline-formula><mml:math id="me168"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> if <inline-formula><mml:math id="me169"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are child nodes of <inline-formula><mml:math id="me170"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
        <p>Allocations of mutations to branches are usually not unique and computation of the conditional likelihood <inline-formula><mml:math id="me171"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> requires summing over all possible allocations. In <xref ref-type="fig" rid="fig3">Figure 3A</xref> we show one such possible allocation of the mutation groups of the gene tree in <xref ref-type="fig" rid="fig2">Figure 2B</xref> along the Tajima’s genealogy in <xref ref-type="fig" rid="fig2">Figure 2C</xref>. For example, mutation group a in <xref ref-type="fig" rid="fig2">Figure 2B</xref> with cardinality 1 (number in red) is a mutation observed in seven individuals (sum of black numbers of leaves descending from edge marked a). This same mutation group, a, is shown as a red number 1 in <xref ref-type="fig" rid="fig3">Figure 3A</xref> allocated to branch <inline-formula><mml:math id="me172"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mn>5</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. If <inline-formula><mml:math id="me173"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is an internal node, the number of mutations <inline-formula><mml:math id="me174"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is denoted as a vector of length 1. If <inline-formula><mml:math id="me175"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is a leaf node, <inline-formula><mml:math id="me176"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> can be a vector of length &gt;1. Details on notation for allocations can be found in Appendix B.</p>
      </sec>
    </sec>
    <sec id="s10">
      <title>Computing the conditional likelihood</title>
      <p>Under the infinite sites mutation model, mutations are superimposed independently on the branches of <inline-formula><mml:math id="me177"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> as a Poisson process with rate <italic>μ</italic>. To compute <inline-formula><mml:math id="me178"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="script">T</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we marginalize over the latent allocation information in the DAG <inline-formula><mml:math id="me179"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>; that is, we sum over all possible mappings of mutations in <inline-formula><mml:math id="me180"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> to branches in <inline-formula><mml:math id="me181"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> as follows:<disp-formula id="eq___1"><mml:math id="me182"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:munder><mml:mo>…</mml:mo><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="eq___2"><mml:math id="me183"><mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:munder><mml:mo>…</mml:mo><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="eq___3"><mml:math id="me184"><mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:munder><mml:mo>…</mml:mo><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>I</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="me185"><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mi mathvariant="normal">V</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me186"><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mi mathvariant="normal">V</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me187"><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> denotes the index of the parent of node <italic>i</italic> in <inline-formula><mml:math id="me188"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>, and we set <inline-formula><mml:math id="me189"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> because it is assumed that there are no mutations above the root node and the length of the root branch <inline-formula><mml:math id="me190"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>. Writing <inline-formula><mml:math id="me191"><mml:mi mathvariant="normal">ℒ</mml:mi></mml:math></inline-formula> for the tree length of <inline-formula><mml:math id="me192"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> (<italic>i.e.</italic>, the sum of the lengths of all branches of <inline-formula><mml:math id="me193"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>) and factoring out a global factor <inline-formula><mml:math id="me194"><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>μ</mml:mi><mml:mi mathvariant="normal">ℒ</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> (due to the Poisson distribution of mutations across the genealogy) from each of the above products over <inline-formula><mml:math id="me195"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>I</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we have<disp-formula id="eq___4"><mml:math id="me196"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="eq___5"><mml:math id="me197"><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mtext>if </mml:mtext><mml:mo>|</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:munder><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mtext>Π</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:munder><mml:mrow><mml:mover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mi mathvariant="normal">∏</mml:mi></mml:mstyle><mml:mi>k</mml:mi></mml:mover></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mtext>if </mml:mtext><mml:mo>|</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="me198"><mml:mrow><mml:mtext>Π</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the set of all permutations of <inline-formula><mml:math id="me199"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> divided into <inline-formula><mml:math id="me200"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> groups of different sizes. The number of different permutations of the <italic>k</italic> values of <inline-formula><mml:math id="me201"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> divided into <inline-formula><mml:math id="me202"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> groups of sizes <inline-formula><mml:math id="me203"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is<disp-formula id="eq6"><mml:math id="me204"><mml:mrow><mml:mo>|</mml:mo><mml:mtext>Π</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>k</mml:mi><mml:mo>!</mml:mo></mml:mrow><mml:mrow><mml:munderover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:munderover><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math><label>(6)</label></disp-formula>For example, assume that <inline-formula><mml:math id="me205"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me206"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>8</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with branch lengths <inline-formula><mml:math id="me207"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>8</mml:mn></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. In this case, <inline-formula><mml:math id="me208"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> because there will be three branches with two mutations, <inline-formula><mml:math id="me209"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> because there will be one branch with no mutations, and <inline-formula><mml:math id="me210"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> because there will be two branches with three mutations. The number of permutations of <inline-formula><mml:math id="me211"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula> mutations groups divided into <inline-formula><mml:math id="me212"><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> groups with cardinalities <inline-formula><mml:math id="me213"><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> of sizes <inline-formula><mml:math id="me214"><mml:mrow><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> is <inline-formula><mml:math id="me215"><mml:mrow><mml:mn>6</mml:mn><mml:mo>!</mml:mo><mml:mo>/</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn><mml:mo>!</mml:mo><mml:mn>1</mml:mn><mml:mo>!</mml:mo><mml:mn>2</mml:mn><mml:mo>!</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>60</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
      <p>The conditional likelihood <inline-formula><mml:math id="me216"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is calculated via a backtracking algorithm (Appendix C). The algorithm marginalizes the allocations by traversing the DAG from the tips to the root. The pseudocode and an example can be found in Appendix C.</p>
    </sec>
    <sec id="s11">
      <title>The case of unknown ancestral states</title>
      <p>Up to now, we have assumed that the ancestral state was known at every segregating site. The representation of the data <inline-formula><mml:math id="me217"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:math></inline-formula> that we use in this case records the cardinalities of each mutation group and the genealogical relations between these groups, but does not assign labels to the sequences. Hence, in the terminology of <xref rid="bib16" ref-type="bibr">Griffiths and Tavaré (1995)</xref>, our data corresponds to an <italic>unlabeled rooted gene tree</italic>.</p>
      <p>When the ancestral types are not known, the data (now denoted <inline-formula><mml:math id="me218"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mn>0</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>) may be represented as an unlabeled <italic>unrooted</italic> gene tree. By the remark following Equation 1 in <xref rid="bib16" ref-type="bibr">Griffiths and Tavaré (1995)</xref>, if <italic>s</italic> is the number of segregating sites, then there are at most <inline-formula><mml:math id="me219"><mml:mrow><mml:mi>s</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> unlabeled rooted gene trees that correspond to the unrooted gene tree of the observed data <inline-formula><mml:math id="me220"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">ℛ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="bold">Y</mml:mi><mml:mn>0</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. By the law of total probability [see also Equation 10 in <xref rid="bib16" ref-type="bibr">Griffiths and Tavaré (1995)</xref>], the conditional likelihood of <inline-formula><mml:math id="me221"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mn>0</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> can be written as the sum over all compatible unlabeled rooted gene trees <inline-formula><mml:math id="me222"><mml:mrow><mml:msup><mml:mi mathvariant="bold">Y</mml:mi><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> of the probability of <inline-formula><mml:math id="me223"><mml:mrow><mml:msup><mml:mi mathvariant="bold">Y</mml:mi><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> conditionally on <inline-formula><mml:math id="me224"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. That is:<disp-formula id="eq7"><mml:math id="me225"><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="script">R</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup><mml:mrow><mml:mi>P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math><label>(7)</label></disp-formula>where each of the <inline-formula><mml:math id="me226"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> corresponds to a unique unlabeled rooted gene tree compatible with the unrooted gene tree <inline-formula><mml:math id="me227"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mn>0</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me228"><mml:mrow><mml:mi mathvariant="normal">ℛ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="bold">Y</mml:mi><mml:mn>0</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> denotes the number of those unlabeled rooted gene trees. In the following sections, we shall assume that the ancestral type at each site is known.</p>
    </sec>
    <sec id="s12">
      <title>Bayesian inference of the effective population size trajectory</title>
      <p>Our posterior distribution of interest is<disp-formula id="eq8"><mml:math id="me229"><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced><mml:mo>∝</mml:mo><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>|</mml:mo><mml:mi>γ</mml:mi></mml:mrow></mml:mfenced><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi>γ</mml:mi><mml:mo>|</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:mfenced><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math><label>(8)</label></disp-formula>where <inline-formula><mml:math id="me230"><mml:msub><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mtext>log</mml:mtext><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>γ</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mi mathvariant="script">P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">C</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math></inline-formula> has a Gaussian process prior with mean <bold>0</bold> and covariance function <inline-formula><mml:math id="me231"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>C</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref rid="bib38" ref-type="bibr">Rasmussen and Williams 2006</xref>). This specification ensures <inline-formula><mml:math id="me232"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is nonnegative. In our implementation, we assume a regular geometric random walk prior, that is, <inline-formula><mml:math id="me233"><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mtext>log</mml:mtext><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>t</mml:mi><mml:mn>1</mml:mn><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mtext>log</mml:mtext><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>t</mml:mi><mml:mi>B</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> at <italic>B</italic> regularly spaced time points in <inline-formula><mml:math id="me234"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>T</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with<disp-formula id="eq___6"><mml:math id="me235"><mml:mrow><mml:mtext>Cov</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext>Cov</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtext>log</mml:mtext><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mtext>log</mml:mtext><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>t</mml:mi><mml:mi>j</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>τ</mml:mi><mml:mo> </mml:mo><mml:mtext>min</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>t</mml:mi><mml:mi>j</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>The parameter <italic>τ</italic> is a length-scale parameter that controls the degree of smoothness of the random walk. We place a γ prior with parameters <inline-formula><mml:math id="me236"><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn></mml:math></inline-formula> and <inline-formula><mml:math id="me237"><mml:mi>β</mml:mi><mml:mo>=</mml:mo><mml:mn>0.001</mml:mn></mml:math></inline-formula> on <italic>τ</italic>, reflecting our lack of prior information in terms of high variance about the smoothness of the logarithm of the effective population size trajectory.</p>
      <p>We approximate the posterior distribution of model parameters via an MCMC sampling scheme. Model parameters are sampled in blocks within a random scan Metropolis-within-Gibbs framework. Our algorithm initializes with the corresponding Tajima genealogy of the UPGMA estimated tree implemented in phangorn (<xref rid="bib43" ref-type="bibr">Schliep 2011</xref>). Given an initial genealogy, our algorithm initializes <inline-formula><mml:math id="me238"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <italic>τ</italic> with the method of <xref rid="bib34" ref-type="bibr">Palacios and Minin (2012</xref>) implemented in phylodyn (<xref rid="bib23" ref-type="bibr">Karcher <italic>et al.</italic> 2017</xref>). We then proceed to generate: (1) a sample of the vector of effective population sizes and precision parameter as described in <italic>Split Hamiltonian Monte Carlo updates of <inline-formula><mml:math id="me239"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></italic>, (2) a sample of the vector of coalescent times as described in <italic>Hamiltonian Monte Carlo updates of coalescent times</italic> and <italic>Local updates of coalescent times</italic> where we modify a single coalescent time, and (3) a sample of ranked tree shape as described in <italic>Metropolis–Hastings updates for ranked tree shapes</italic> in each iteration. To summarize the effective population size trajectory, we compute the posterior median and 95% credible intervals pointwise at each grid point in <inline-formula><mml:math id="me240"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi>T</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, were <inline-formula><mml:math id="me241"><mml:mover accent="true"><mml:mi>T</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> is the maximum time to the most recent common ancestor sampled.</p>
      <sec id="s13">
        <title>Metropolis–Hastings updates for ranked tree shapes:</title>
        <p>There is a large body of literature on local transition proposal distributions for Kingman’s topologies (<xref rid="bib28" ref-type="bibr">Kuhner <italic>et al.</italic> 1998</xref>; <xref rid="bib37" ref-type="bibr">Rannala and Yang 2003</xref>; <xref rid="bib12" ref-type="bibr">Drummond <italic>et al.</italic> 2012</xref>; <xref rid="bib51" ref-type="bibr">Whidden and Matsen 2015</xref>; <xref rid="bib2" ref-type="bibr">Aberer <italic>et al.</italic> 2016</xref>). In this paper, we adapted the local transition proposal of <xref rid="bib31" ref-type="bibr">Markovtsova <italic>et al.</italic> (2000)</xref> to Tajima’s topologies. We briefly describe the scheme below and provide a pseudocode algorithm in Appendix C (Algorithm 3).</p>
        <p>Given the current state of the chain <inline-formula><mml:math id="me242"><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">t</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula>, we propose a new ranked tree shape <inline-formula><mml:math id="me243"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mtext>*</mml:mtext></mml:msup></mml:mrow></mml:math></inline-formula> in two steps. For step 1, we first sample a coalescent interval <inline-formula><mml:math id="me244"><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> uniformly at random, where <inline-formula><mml:math id="me245"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∼</mml:mo><mml:mtext>U</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Note that we will never select the interval <inline-formula><mml:math id="me246"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> at the top of the tree (see Figure A1A). Given <italic>k</italic>, we focus solely on the coalescent events at times <inline-formula><mml:math id="me247"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me248"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. For step 2, there are two possible scenarios. Case A: the lineage created at time <inline-formula><mml:math id="me249"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, labeled <italic>k</italic>, coalesces at time <inline-formula><mml:math id="me250"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (first row of <xref ref-type="fig" rid="fig4">Figure 4A</xref>). Case B: lineage <italic>k</italic> does not coalesce at time <inline-formula><mml:math id="me251"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). In Case A, we choose a new pair of lineages at random to coalesce at time <inline-formula><mml:math id="me252"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> from the three lineages subtending <italic>k</italic> and <inline-formula><mml:math id="me253"><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (excluding <italic>k</italic>), and we coalesce the remaining lineage with <italic>k</italic> at <inline-formula><mml:math id="me254"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="me255"><mml:mrow><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me256"><mml:mrow><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> in <xref ref-type="fig" rid="fig4">Figure 4</xref>). In Case B, we invert the order of the coalescent events; that is, the two lineages descending from <italic>k</italic> are set to coalesce at time <inline-formula><mml:math id="me257"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and lineages descending from <inline-formula><mml:math id="me258"><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> are set to coalesce at time <inline-formula><mml:math id="me259"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="me260"><mml:mrow><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> a in <xref ref-type="fig" rid="fig4">Figure 4</xref>). Note that the numerical labels <inline-formula><mml:math id="me261"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> are included to clarify the picture: lineages subtending both Case A and Case B can be either labeled (if there is a vintage subtending that lineage) or not (if there is a singleton). The transition probability <inline-formula><mml:math id="me262"><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is given by the product of the probabilities of the two steps. The new ranked tree shape <inline-formula><mml:math id="me263"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> is accepted with probability given by the Metropolis–Hastings ratio defined below:<fig id="fig4" fig-type="figure" orientation="portrait" position="float"><label>Figure 4</label><caption><p>Markov moves for topologies. First row: possible coalescent patterns (Case A or Case B) for a given topology <inline-formula><mml:math id="me264"><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Second row: possible Markov moves in Case A (<inline-formula><mml:math id="me265"><mml:mrow><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me266"><mml:mrow><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula>) and Case B <inline-formula><mml:math id="me267"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>F</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. <italic>k</italic> indexes the coalescent interval sampled. Numerical labels at the tips are added for convenience: conditionally on a given <inline-formula><mml:math id="me268"><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, tips can be labeled (vintage) or not (singleton). Figure is adapted from Figures 2–4 of <xref rid="bib31" ref-type="bibr">Markovtsova <italic>et al.</italic> (2000)</xref>.</p></caption><graphic xlink:href="967f4"/></fig><disp-formula id="eq9"><mml:math id="me269"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>min</mml:mtext><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>*</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">t</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>*</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>*</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">t</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>*</mml:mi></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><label>(9)</label></disp-formula>We note that our proposal can result in the same ranked tree shape. However, we tested alternative proposals that precluded this event and we did not find any notable difference in the overall performance of the MCMC algorithm.</p>
      </sec>
      <sec id="s14">
        <title>Split Hamiltonian Monte Carlo updates of <inline-formula><mml:math id="me270"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>:</title>
        <p>To make efficient joint proposals of <inline-formula><mml:math id="me271"><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:math></inline-formula> and <italic>τ</italic>, we use the Split Hamiltonian Monte Carlo method proposed by <xref rid="bib29" ref-type="bibr">Lan <italic>et al.</italic> (2015)</xref>. Conditioned on <inline-formula><mml:math id="me272"><mml:mrow><mml:msup><mml:mi>g</mml:mi><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, the target density becomes <inline-formula><mml:math id="me273"><mml:mrow><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:mi>γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>|</mml:mo><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This is the same target density implemented in <xref rid="bib23" ref-type="bibr">Karcher <italic>et al.</italic> (2017)</xref> for fixed coalescent times <inline-formula><mml:math id="me274"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula>.</p>
      </sec>
      <sec id="s15">
        <title>Hamiltonian Monte Carlo updates of coalescent times:</title>
        <p>Given the current state <inline-formula><mml:math id="me275"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mi>τ</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we propose a new vector of coalescent times with target density <inline-formula><mml:math id="me276"><mml:mrow><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>′</mml:mo><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>′</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> by numerically simulating a Hamilton system with Hamiltonian<disp-formula id="eq10"><mml:math id="me277"><mml:mrow><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>log</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mtext>log</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>log</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>M</mml:mi><mml:mi>s</mml:mi></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math><label>(10)</label></disp-formula>where <inline-formula><mml:math id="me278"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle></mml:math></inline-formula> is the momentum vector assumed to be normally distributed. The system evolves according to:<disp-formula id="eq___7"><mml:math id="me279"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>s</mml:mi></mml:mstyle></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>∇</mml:mo><mml:mtext>log</mml:mtext><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>log</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="eq11"><mml:math id="me280"><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi mathvariant="bold-italic">t</mml:mi><mml:mi>'</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi mathvariant="bold-italic">M</mml:mi><mml:mi mathvariant="bold-italic">s</mml:mi><mml:mo>.</mml:mo></mml:math><label>(11)</label></disp-formula>We use the <italic>leapfrog</italic> method (<xref rid="bib33" ref-type="bibr">Neal 2011</xref>) with step size ϵ and a <italic>p</italic> Poisson with mean 10 distributed number of steps to simulate the dynamics from time <inline-formula><mml:math id="me281"><mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> to <inline-formula><mml:math id="me282"><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mi>ϵ</mml:mi></mml:math></inline-formula>. Each leapfrog step of size <italic>ϵ</italic> follows the trajectory:<disp-formula id="eq___8"><mml:math id="me283"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>∇</mml:mo><mml:mtext>log</mml:mtext><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mtext>log</mml:mtext><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">'</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow/><mml:mo> </mml:mo></mml:math></disp-formula><disp-formula id="eq___9"><mml:math id="me284"><mml:mi mathvariant="bold-italic">t</mml:mi><mml:msub><mml:mrow><mml:mi>'</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="bold-italic">t</mml:mi><mml:msub><mml:mrow><mml:mi>'</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi><mml:mi mathvariant="bold-italic">M</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msub></mml:math></disp-formula><disp-formula id="eq12"><mml:math id="me285"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>∇</mml:mo><mml:mtext>log</mml:mtext><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mtext>log</mml:mtext><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mi mathvariant="bold">t</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="normal">'</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow/><mml:mo>.</mml:mo></mml:math><label>(12)</label></disp-formula>For our implementation, we set the mass matrix <inline-formula><mml:math id="me286"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>M</mml:mi></mml:mstyle><mml:mo>=</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>I</mml:mi></mml:mstyle></mml:mrow></mml:math></inline-formula>, the identity matrix. We simulate the Hamiltonian dynamics of the logarithm of times to avoid proposals with negative values. Solving the equations of the Hamilton system requires calculating the gradient of the logarithm of the target density with respect to the vector of log coalescent times. The gradient of the log conditional likelihood (score function) is calculated at every marginalization step in the algorithm for the likelihood calculation.</p>
        <p>At the beginning of <italic>Bayesian inference of the effective population size trajectory</italic>, we described how we assume a regular geometric random walk prior on <inline-formula><mml:math id="me287"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> at <italic>B</italic> regularly spaced time points in <inline-formula><mml:math id="me288"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>T</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Ideally, the window size <italic>T</italic> must be at least <inline-formula><mml:math id="me289"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, the time to the most recent common ancestor (TMRCA). However, <inline-formula><mml:math id="me290"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> is not known. Our initial values of coalescent times <inline-formula><mml:math id="me291"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula> are obtained from the UPGMA implementation in phangorn (<xref rid="bib43" ref-type="bibr">Schliep 2011</xref>) with times properly rescaled by the mutation rate, and we set <inline-formula><mml:math id="me292"><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. We initially discretize the time interval <inline-formula><mml:math id="me293"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>T</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> into <italic>B</italic> intervals of length <inline-formula><mml:math id="me294"><mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. As we generate new samples of <inline-formula><mml:math id="me295"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula>, we expand or contract our grid according to the current value of <inline-formula><mml:math id="me296"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> by keeping the grid interval length fixed to <inline-formula><mml:math id="me297"><mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, effectively increasing or decreasing the dimension of <inline-formula><mml:math id="me298"><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:math></inline-formula>.</p>
      </sec>
      <sec id="s16">
        <title>Local updates of coalescent times:</title>
        <p>In addition to Hamiltonian Monte Carlo (HMC) updates of coalescent times, we propose a move of a single coalescent time (excluding the TMRCA <inline-formula><mml:math id="me299"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>) chosen uniformly at random and sampled uniformly in the intercoalescent interval; that is, we choose <inline-formula><mml:math id="me300"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∼</mml:mo><mml:mi>U</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me301"><mml:mrow><mml:msubsup><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup><mml:mo>∼</mml:mo><mml:mi>U</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. This is a symmetric proposal and the corresponding Metropolis–Hastings acceptance probability is<disp-formula id="eq13"><mml:math id="me302"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:msup><mml:mi>t</mml:mi><mml:mtext>*</mml:mtext></mml:msup></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>min</mml:mtext><mml:mrow><mml:mfenced open="{" close="}"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mtext>∗</mml:mtext></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mtext>*</mml:mtext></mml:msup><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math><label>(13)</label></disp-formula>While these updates may seem unnecessary in light of the Hamiltonian updates of coalescence times (<italic>Hamiltonian Monte Carlo updates of coalescent</italic>
<italic>times</italic>), we observed better performance of our MCMC sampler by including this additional proposal. One reason may be our choice of <inline-formula><mml:math id="me303"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>M</mml:mi></mml:mstyle></mml:math></inline-formula> in <italic>Hamiltonian Monte Carlo updates of coalescent</italic>
<italic>times</italic> that does not account for the geometric structure of the posterior distribution of coalescent times. However, a better choice of <inline-formula><mml:math id="me304"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>M</mml:mi></mml:mstyle></mml:math></inline-formula> comes with higher computational burden than a simple local update of coalescent times.</p>
      </sec>
      <sec id="s17">
        <title>Multiple independent loci:</title>
        <p>Thus far, we have assumed our data consist of a single linked locus of <italic>s</italic> segregating sites. We can extend our methodology to <italic>l</italic> independent loci with <inline-formula><mml:math id="me305"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> segregating sites for <inline-formula><mml:math id="me306"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:math></inline-formula>. In this case, our data <inline-formula><mml:math id="me307"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:mstyle><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> consist of <italic>l</italic> aligned sequences with elements <inline-formula><mml:math id="me308"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where 0 indicates the ancestral allele as before. We then jointly estimate the Tajima’s genealogies <inline-formula><mml:math id="me309"><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>l</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>, precision parameter <italic>τ</italic>, and vector of log effective population sizes <inline-formula><mml:math id="me310"><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:math></inline-formula> through their posterior distribution:<disp-formula id="eq14"><mml:math id="me311"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>l</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mi mathvariant="italic">τ</mml:mi><mml:mo>|</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:mstyle><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:mrow><mml:mfenced open="{" close="}"><mml:mrow><mml:munder><mml:mrow><mml:mover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mi>l</mml:mi></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>i</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>|</mml:mo><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi><mml:mo>|</mml:mo><mml:mi mathvariant="italic">τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math><label>(14)</label></disp-formula>In Equation 14, we enforce that all loci follow the same effective population size trajectory but every locus can have its own mutation rate <inline-formula><mml:math id="me312"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
      </sec>
    </sec>
    <sec sec-type="data-availability" id="s18">
      <title>Data availability</title>
      <p>The methods presented in this article are implemented in the open source R package phylodyn (<ext-link ext-link-type="uri" xlink:href="https://github.com/JuliaPalacios/phylodyn">https://github.com/JuliaPalacios/phylodyn</ext-link>). The data files necessary to reproduce both the simulated and real data analyses are provided with the R package.</p>
    </sec>
  </sec>
  <sec sec-type="results" id="s19">
    <title>Results</title>
    <sec id="s20">
      <title>The performance of BESTT in applications to simulated data</title>
      <p>We tested our new method, BESTT, on simulated data under four different demographic scenarios. Note that in this section, <inline-formula><mml:math id="me313"><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is rescaled to the coalescent timescale, meaning that <inline-formula><mml:math id="me314"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> is the pairwise rate of coalescence at time <italic>t</italic> in the past relative to the rate at the present time zero. We simulated genealogies under four different population size trajectories:<list list-type="order" id="L2"><list-item><p>A period of exponential growth followed by constant size:<disp-formula id="eq15"><mml:math id="me315"><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced open="{" close="" separators="|"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext>if </mml:mtext><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn></mml:mrow><mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>exp</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mn>1</mml:mn><mml:mo>–</mml:mo><mml:mn>10</mml:mn><mml:mi>t</mml:mi></mml:mrow></mml:mfenced></mml:mtd><mml:mtd><mml:mtext>if </mml:mtext><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mrow><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mi>∞</mml:mi></mml:mrow><mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><label>(15)</label></disp-formula></p></list-item><list-item><p>A trajector with instantaneous growth:<disp-formula id="eq16"><mml:math id="me316"><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced open="{" close="" separators="|"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext>if </mml:mtext><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0.05</mml:mn></mml:mrow><mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0.05</mml:mn></mml:mtd><mml:mtd><mml:mtext>if </mml:mtext><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>(</mml:mo></mml:mrow><mml:mrow><mml:mn>0.05</mml:mn><mml:mo>,</mml:mo><mml:mi>∞</mml:mi></mml:mrow><mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><label>(16)</label></disp-formula></p></list-item><list-item><p>Exponential growth: <inline-formula><mml:math id="me317"><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mn>25</mml:mn><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>5</mml:mn><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula>.</p></list-item><list-item><p>A constant trajectory: <inline-formula><mml:math id="me318"><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula>.</p></list-item></list>Given a genealogy of length <inline-formula><mml:math id="me319"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="me320"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the intercoalescent length while there are <italic>j</italic> lineages, we drew the total number of mutations (segregating sites) <italic>s</italic> according to a Poisson distribution with parameter <inline-formula><mml:math id="me321"><mml:mrow><mml:mi>μ</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula>. We then placed the mutations uniformly at random along the branches of the genealogy. For each of the <italic>s</italic> mutations, we assigned the mutant type to individuals descending from the branch where the mutation occurred and the ancestral type otherwise.</p>
      <p>We summarize our posterior inference <inline-formula><mml:math id="me322"><mml:mrow><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> by the posterior median and 95% Bayesian credible intervals (BCIs) after 200 thousand iterations, and thinned every 10 iterations with 100 iterations of burn in. Our initial number of change points for <inline-formula><mml:math id="me323"><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was set to 50 over the time interval <inline-formula><mml:math id="me324"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="me325"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> is the initialized time to the most recent common ancestor; however, over the course of MCMC iterations, this number could increase or decrease according to the posterior distribution of <inline-formula><mml:math id="me326"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
      <p>We assess the accuracy and precision of our estimates using the sum of relative errors (SRE)<disp-formula id="eq17"><mml:math id="me327"><mml:mrow><mml:mtext mathvariant="normal">SRE</mml:mtext><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>k</mml:mi></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math><label>(17)</label></disp-formula>where <inline-formula><mml:math id="me328"><mml:mrow><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="italic">ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the estimated effective population size trajectory at time <inline-formula><mml:math id="me329"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Second, we computed the mean relative width (MRW) as<disp-formula id="eq18"><mml:math id="me330"><mml:mrow><mml:mtext mathvariant="normal">MRW</mml:mtext></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mrow><mml:mover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>k</mml:mi></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math><label>(18)</label></disp-formula>where <inline-formula><mml:math id="me331"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> corresponds to the 97.5% upper limit and <inline-formula><mml:math id="me332"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> corresponds to the 2.5% lower limit of the estimated posterior distribution of <inline-formula><mml:math id="me333"><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. In addition, we measured how well the 95% credible intervals cover the truth and compute the envelope measure, <inline-formula><mml:math id="me334"><mml:mrow><mml:mtext mathvariant="normal">ENV</mml:mtext></mml:mrow></mml:math></inline-formula>:<disp-formula id="eq19"><mml:math id="me335"><mml:mrow><mml:mtext mathvariant="normal">ENV</mml:mtext><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>k</mml:mi></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≤</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≤</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>u</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow><mml:mi>k</mml:mi></mml:mfrac></mml:mrow></mml:math><label>(19)</label></disp-formula>We first simulated three data sets of <inline-formula><mml:math id="me336"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> individuals with an average number of 100 segregating sites under different types of population size trajectories: constant, exponential growth, and instantaneous growth. Results are depicted in the first column of <xref ref-type="fig" rid="fig8">Figure 8</xref>. Posterior medians and 95% credible intervals are shown as black curves and gray shaded areas, respectively. The trajectories used to simulate the data are depicted as dashed lines. <xref ref-type="fig" rid="fig8">Figure 8</xref> shows that our BESTT method recovers the constant and exponential growth trajectories very well, but the instantaneous growth scenario is less accurate and with high uncertainty (wide credible intervals). In all three cases, our envelope measure is &gt; 95%. Performance measures on all simulations are summarized in <xref rid="t1" ref-type="table">Table 1</xref>.</p>
      <table-wrap id="t1" orientation="portrait" position="float">
        <label>Table 1</label>
        <caption>
          <title>Empirical measures of performance in the simulations described in the text</title>
        </caption>
        <table frame="void" rules="groups">
          <col width="58.66%" span="1"/>
          <col width="12.16%" span="1"/>
          <col width="14.6%" span="1"/>
          <col width="14.58%" span="1"/>
          <thead>
            <tr>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Simulation</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">% ENV</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">SRE</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">MRW</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Instantaneous growth (<italic>n</italic> = 10,<italic>s</italic> = 31)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">96</td>
              <td valign="top" align="center" rowspan="1" colspan="1">5.87</td>
              <td align="right" valign="top" rowspan="1" colspan="1">124352</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Instantaneous growth (<italic>n</italic> = 10,<italic>s</italic> = 63)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">100</td>
              <td valign="top" align="center" rowspan="1" colspan="1">2.15</td>
              <td align="right" valign="top" rowspan="1" colspan="1">2296</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Instantaneous growth (<italic>n</italic> = 10,<italic>s</italic> = 120)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">98</td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.53</td>
              <td align="right" valign="top" rowspan="1" colspan="1">80</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Instantaneous growth (<italic>n</italic> = 25)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">90</td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.40</td>
              <td align="right" valign="top" rowspan="1" colspan="1">3.43</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Instantaneous growth (<italic>n</italic> = 35)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">92</td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.31</td>
              <td align="right" valign="top" rowspan="1" colspan="1">3.16</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Constant</td>
              <td valign="top" align="center" rowspan="1" colspan="1">100</td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.30</td>
              <td align="right" valign="top" rowspan="1" colspan="1">1.16</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Exponential</td>
              <td valign="top" align="center" rowspan="1" colspan="1">100</td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.35</td>
              <td align="right" valign="top" rowspan="1" colspan="1">5.45</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Exponential and constant (<italic>n</italic> = 10, 1 locus)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">100</td>
              <td valign="top" align="center" rowspan="1" colspan="1">4.31</td>
              <td align="right" valign="top" rowspan="1" colspan="1">22608</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Exponential and constant (<italic>n</italic> = 10, 5 loci)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">100</td>
              <td valign="top" align="center" rowspan="1" colspan="1">2.37</td>
              <td align="right" valign="top" rowspan="1" colspan="1">309.1</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Exponential and constant (<italic>n</italic> = 10, 10 loci)</td>
              <td valign="top" align="center" rowspan="1" colspan="1">100</td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.16</td>
              <td align="right" valign="top" rowspan="1" colspan="1">4.19</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p>% ENV, % envelope measure; MRW, mean relative width; SRE, sum of relative errors.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>We analyzed the effect of increasing the number of segregating sites, the number of samples, and the number of independent genealogies on posterior inference with BESTT. In all three cases, we expect our method to better recover the truth. <xref ref-type="fig" rid="fig5">Figure 5</xref> shows our results on simulated data under a population size trajectory with instantaneous growth (Equation 16) of <inline-formula><mml:math id="me337"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> individuals with 31, 63, and 120 segregating sites. As expected, our method recovers the truth with higher precision (MRW) and accuracy (SRE) when we increase the number of segregating sites. Increasing the number of segregating sites may result in more constraints in the gene tree. For <inline-formula><mml:math id="me338"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, there are 7936 possible ranked tree shapes; however, for the data sets simulated with 31, 63, and 102 segregating sites, there are only <inline-formula><mml:math id="me339"><mml:mrow><mml:mn>2582</mml:mn><mml:mo>±</mml:mo><mml:mn>32</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me340"><mml:mrow><mml:mn>2670</mml:mn><mml:mo>±</mml:mo><mml:mn>34</mml:mn></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="me341"><mml:mrow><mml:mn>556</mml:mn><mml:mo>±</mml:mo><mml:mn>7</mml:mn></mml:mrow></mml:math></inline-formula> ranked tree shapes compatible with their corresponding gene trees. These numbers were estimated by importance sampling (<xref rid="bib7" ref-type="bibr">Cappello and Palacios 2019</xref>).</p>
      <fig id="fig5" fig-type="figure" orientation="portrait" position="float">
        <label>Figure 5</label>
        <caption>
          <p>Varying the number of segregating sites. Posterior inference from simulated data of <inline-formula><mml:math id="me342"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> sequences under a population size trajectory with instantaneous growth (dashed lines). <italic>s</italic> is the number of segregating sites. Posterior medians are depicted as solid black lines and 95% Bayesian credible intervals are depicted by shaded areas.</p>
        </caption>
        <graphic xlink:href="967f5"/>
      </fig>
      <p>As another performance assessment, we simulated data sets from a population size trajectory with instantaneous growth with varying numbers of samples. We simulated data sets with <inline-formula><mml:math id="me343"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, 25, and 35 samples with 215 expected numbers of segregating sites. Our results depicted in <xref ref-type="fig" rid="fig6">Figure 6</xref> show that our method performs better in terms of SRE and MRE when the number of samples increases. Similarly, precision (MRW) and accuracy (SRE) increases when inference is done from a larger number of independent data sets. Finally, <xref ref-type="fig" rid="fig7">Figure 7</xref> shows our results from 1, 5, and 10 data sets simulated from 1, 5, and 10 independent genealogies of 10 individuals with a population size trajectory of growth followed by a constant period (Equation 15). As expected, our method’s performance substantially increases by increasing the number of independent data sets.</p>
      <fig id="fig6" fig-type="figure" orientation="portrait" position="float">
        <label>Figure 6</label>
        <caption>
          <p>Varying the number of samples under a population size trajectory with instantaneous growth. Posterior inference from simulated data of <inline-formula><mml:math id="me344"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>, 25, and 35 sequences under the population size trajectory with instantaneous growth. Shaded areas correspond to 95% credible intervals, solid lines to posterior medians, and dashed lines to the truth.</p>
        </caption>
        <graphic xlink:href="967f6"/>
      </fig>
      <fig id="fig7" fig-type="figure" orientation="portrait" position="float">
        <label>Figure 7</label>
        <caption>
          <p>Multiple independent data sets. Posterior inference from simulated data of <inline-formula><mml:math id="me345"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> sequences under exponential followed by constant trajectory (Equation 15). (A) Inference from a single simulated data set, (B) from five independently simulated data sets, and (C) from 10 independently simulated data sets. Shaded areas correspond to 95% credible intervals, solid black lines show posterior medians, and dashed lines show the simulated truth.</p>
        </caption>
        <graphic xlink:href="967f7"/>
      </fig>
    </sec>
    <sec id="s21">
      <title>Comparison to other methods</title>
      <p>To our knowledge, there is no other method for inferring (variable) effective population size over time from haplotype data that assumes the infinite sites mutation and a nonparametric prior on <inline-formula><mml:math id="me346"><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>; therefore, we cannot directly compare our method to others. Moreover, our method is the only one that explicitly averages over Tajima genealogies instead of Kingman genealogies. BEAST (<xref rid="bib12" ref-type="bibr">Drummond <italic>et al.</italic> 2012</xref>) is a program for analyzing molecular sequences that uses MCMC to average over the Kingman tree space and it is therefore a good reference for comparison to our method. We compared our results to the Extended Bayesian Skyline Plot method (EBSP) (<xref rid="bib20" ref-type="bibr">Heled and Drummond 2008</xref>) and the Skygrid method (<xref rid="bib13" ref-type="bibr">Gill <italic>et al.</italic> 2013</xref>) implemented in BEAST.</p>
      <p>Since the infinite sites mutation model is not implemented in BEAST, we first converted our simulated sequences of 0s and 1s to sequences of nucleotides by sampling <italic>s</italic> ancestral nucleotides uniformly on <inline-formula><mml:math id="me347"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and assigning one of the remaining three types uniformly at random to be the mutant type. This corresponds to a simulation of the Jukes–Cantor mutation model (<xref rid="bib22" ref-type="bibr">Jukes and Cantor 1969</xref>) that is currently implemented in BEAST.</p>
      <p>We compare the results of BESTT to those of BEAST EBSP and Skygrid (<xref rid="bib11" ref-type="bibr">Drummond <italic>et al.</italic> 2005</xref>, <xref rid="bib12" ref-type="bibr">2012</xref>) in <xref ref-type="fig" rid="fig8">Figure 8</xref>. We note that results from BEAST are generated from 10 million iterations and thinned every 1000 iterations, while results from BESTT are generated from 200 thousand iterations.</p>
      <fig id="fig8" fig-type="figure" orientation="portrait" position="float">
        <label>Figure 8</label>
        <caption>
          <p>Bayesian Estimation of population size changes by Sampling Tajima’s Trees (BESTT) and BEAST comparison. Posterior inference from simulated data of <inline-formula><mml:math id="me348"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> sequences under constant, exponential, and instantaneous growth trajectories (rows) obtained from our method BESTT (first column), BEAST Extended Bayesian Skyline Plot (EBSP) (second column), and BEAST Skygrid (third column). Shaded areas correspond to 95% credible intervals, solid black lines show posterior medians, and dashed lines show the simulated truth. In the fourth column, we show the posterior density of the time to the most recent common ancestor (TMRCA) from the three methods: BESTT (black), BEAST EBSP (blue), and BEAST Skygrid (red). The true value of the TMRCA is depicted as a vertical dashed line.</p>
        </caption>
        <graphic xlink:href="967f8"/>
      </fig>
      <p>We compared our point estimates <inline-formula><mml:math id="me349"><mml:mrow><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from all methods to the ground truth for each simulation (<xref rid="t2" ref-type="table">Table 2</xref>). In two cases, BESTT has better envelope than BEAST. For the exponential growth simulation (<xref ref-type="fig" rid="fig8">Figure 8</xref>, second row) the BEAST EBSP result has better SRE and MRW, however, the credible intervals are uneven with very wide intervals at the ends. In all cases, the BEAST Skygrid results have wider credible intervals. For the instantaneous growth simulation (<xref ref-type="fig" rid="fig8">Figure 8</xref>, third row), BEAST EBSP did not generate many simulations beyond the time point 0.06; for this reason, we recomputed the performance statistics for the overlapping time interval <inline-formula><mml:math id="me350"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0.06</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. In this interval, BESTT outperforms both methods implemented in BEAST in terms of envelope and SRE. The last column of <xref ref-type="fig" rid="fig8">Figure 8</xref> shows the posterior distribution of the TMRCA. For the case of constant population size, the true value of the TMRCA is contained in the 95% BCI estimated with BESTT but it is not contained in the 95% BCIs estimated with the two methods implemented in BEAST. In the exponential growth simulation, the true TMRCA is contained in the 95% BCIs estimated with the three methods and the instant growth method; the true TMRCA is not contained in the 95% BCIs of the three methods.</p>
      <table-wrap id="t2" orientation="portrait" position="float">
        <label>Table 2</label>
        <caption>
          <title>Performance comparison between BESTT and BEAST in simulations</title>
        </caption>
        <table frame="void" rules="groups">
          <col width="15.55%" span="1"/>
          <col width="9.96%" span="1"/>
          <col width="7.89%" span="1"/>
          <col width="10.3%" span="1"/>
          <col width="9.96%" span="1"/>
          <col width="7.89%" span="1"/>
          <col width="10.3%" span="1"/>
          <col width="9.96%" span="1"/>
          <col width="7.89%" span="1"/>
          <col width="10.3%" span="1"/>
          <thead>
            <tr>
              <th valign="top" align="left" scope="col" rowspan="1" colspan="1"/>
              <th colspan="3" valign="top" align="center" scope="colgroup" rowspan="1">% ENV</th>
              <th colspan="3" valign="top" align="center" scope="colgroup" rowspan="1">SRE</th>
              <th colspan="3" valign="top" align="center" scope="colgroup" rowspan="1">MRW</th>
            </tr>
            <tr>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Simulation</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">BESTT</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">EBSP</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Skygrid</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">BESTT</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">EBSP</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Skygrid</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">BESTT</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">EBSP</th>
              <th valign="top" align="center" scope="col" rowspan="1" colspan="1">Skygrid</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Constant</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>100</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>100</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>100</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.30</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>0.24</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>0.24</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>1.16</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">1.49</td>
              <td align="right" valign="top" rowspan="1" colspan="1">4.41</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Exponential</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>100</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">97</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>100</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.35</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>0.26</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">0.29</td>
              <td valign="top" align="center" rowspan="1" colspan="1">5.45</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>2.56</bold>
              </td>
              <td align="right" valign="top" rowspan="1" colspan="1">46.13</td>
            </tr>
            <tr>
              <td valign="top" align="justify" scope="row" rowspan="1" colspan="1">Inst. growth</td>
              <td valign="top" align="center" rowspan="1" colspan="1">97</td>
              <td valign="top" align="center" rowspan="1" colspan="1">94</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>100</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>0.61</bold>
              </td>
              <td valign="top" align="center" rowspan="1" colspan="1">2.65</td>
              <td valign="top" align="center" rowspan="1" colspan="1">22.60</td>
              <td valign="top" align="center" rowspan="1" colspan="1">105.60</td>
              <td valign="top" align="center" rowspan="1" colspan="1">
                <bold>14.95</bold>
              </td>
              <td align="right" valign="top" rowspan="1" colspan="1">&gt; 1000</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn>
            <p>BESTT, Bayesian Estimation of population size changes by Sampling Tajima’s Trees; % ENV, % envelope measure; EBSP, Extended Bayesian Skyline Plot; MRW, mean relative width; SRE, sum of relative errors. Bold values indicate best performance.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>We note that BEAST Bayesian Skygrid (<xref rid="bib13" ref-type="bibr">Gill <italic>et al.</italic> 2013</xref>) is a more comparable method to BESTT since it assumes Gaussian process priors on log <inline-formula><mml:math id="me351"><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> like BESTT.</p>
    </sec>
    <sec id="s22">
      <title>Computational performance of BESTT</title>
      <p>BESTT approximates the posterior distribution (a) <inline-formula><mml:math id="me352"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">τ</mml:mi><mml:mo>|</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="me353"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is a Tajima’s genealogy instead of (b) <inline-formula><mml:math id="me354"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">τ</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mtext>*</mml:mtext></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="me355"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle></mml:math></inline-formula> is a Kingman’s genealogy and <inline-formula><mml:math id="me356"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mtext>*</mml:mtext></mml:msup></mml:mrow></mml:math></inline-formula> is the labeled data, to estimate <inline-formula><mml:math id="me357"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. These two posterior distributions are the same when every individual of the sample has its own private mutation group and no shared mutation groups. Otherwise, the number of Tajima’s trees compatible with observed data <inline-formula><mml:math id="me358"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:math></inline-formula>, <italic>i.e.</italic>, Tajima’s trees <inline-formula><mml:math id="me359"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> such that <inline-formula><mml:math id="me360"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, is smaller than the number of Kingman’s trees compatible with observed labeled data <inline-formula><mml:math id="me361"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mtext>*</mml:mtext></mml:msup></mml:mrow></mml:math></inline-formula> (<xref rid="bib7" ref-type="bibr">Cappello and Palacios 2019</xref>). That is, we are required to estimate the posterior of a smaller number of trees. For this reason, we argue that Tajima’s coalescent is a more efficient model than Kingman’s coalescent for estimating the posterior distribution of <inline-formula><mml:math id="me362"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. However, a single conditional likelihood calculation <inline-formula><mml:math id="me363"><mml:mtext>Pr</mml:mtext><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="bold-italic">Y</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">g</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> requires the sum over all possible allocation of mutation groups to branches of <inline-formula><mml:math id="me364"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. Our algorithm only accounts for allocations constrained by the DAG and the ranked tree shape of <inline-formula><mml:math id="me365"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. For the data depicted in <xref ref-type="fig" rid="fig2">Figure 2, A and B</xref> and <inline-formula><mml:math id="me366"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> of <xref ref-type="fig" rid="fig2">Figure 2C</xref>, there are only eight different possible allocation paths of all mutation groups to branches. In Appendix C, we detail how our algorithm finds these paths. The number of paths depends on the number of subtrees with the same family size path in the DAG and in the ranked tree shape. In the best case, our algorithm will find a path in <inline-formula><mml:math id="me367"><mml:mrow><mml:mi>O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="me368"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi></mml:mrow></mml:math></inline-formula> is the number of nodes in the gene tree. In general, the number of allocation paths will be much smaller than the number of labeled trees compatible with a ranked tree shape. In our implementation, we estimate posterior (a) with MCMC. The main difference between our MCMC algorithm and the MCMC algorithm implemented in BEAST is the tree topology sampler. While our MCMC algorithm explores the space of ranked tree shapes with local move proposals of ranked tree shapes, BEAST explores the space of labeled, ranked tree shapes with local move proposals of labeled trees. A formal assessment of the efficiency of our MCMC algorithm and its comparison to the MCMC implementation in BEAST is beyond the scope of this manuscript and subject of future research.</p>
    </sec>
    <sec id="s23">
      <title>Inferring human population demography from mtDNA</title>
      <p>We selected <inline-formula><mml:math id="me369"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>35</mml:mn></mml:mrow></mml:math></inline-formula> samples of mtDNA at random from 107 Yoruban individuals available from the 1000 Genomes Project phase 3 (1000 Genomes Project Consortium <italic>et al.</italic> 2015). We retained the coding region, <inline-formula><mml:math id="me370"><mml:mrow><mml:mn>576</mml:mn><mml:mo>−</mml:mo><mml:mn>16</mml:mn><mml:mo>,</mml:mo><mml:mn>024</mml:mn></mml:mrow></mml:math></inline-formula> bp, according to the rCRS reference of human mtDNA (<xref rid="bib3" ref-type="bibr">Anderson <italic>et al.</italic> 1981</xref>; <xref rid="bib4" ref-type="bibr">Andrews <italic>et al.</italic> 1999</xref>) and removed 38 insertions/deletions. Of the 260 polymorphic sites, we retained 240 sites compatible with the infinite sites mutation model. The final file is available in <ext-link ext-link-type="uri" xlink:href="https://github.com/JuliaPalacios/phylodyn">https://github.com/JuliaPalacios/phylodyn</ext-link>. To encode our data as 0s and 1s, we use the inferred root sequence <bold>RSRS</bold> of <xref rid="bib5" ref-type="bibr">Behar <italic>et al.</italic> (2012)</xref> to define the ancestral type at each site. To rescale our results in units of years, we assumed a mutation rate per site per year of <inline-formula><mml:math id="me371"><mml:mrow><mml:mn>1.3</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> (<xref rid="bib39" ref-type="bibr">Rebolledo-Jaramillo <italic>et al.</italic> 2014</xref>). We compare our results with the Extended Bayesian Skyline method (<xref rid="bib12" ref-type="bibr">Drummond <italic>et al.</italic> 2012</xref>) implemented in BEAST in <xref ref-type="fig" rid="fig9">Figure 9</xref>. When applying BEAST, we assumed the Jukes–Cantor mutation model. Both methods detect an inflection point ∼20 KYA followed by exponential growth. The mean TMRCA inferred for these YRI mtDNA samples with BESTT is ∼170 KYA with a 95% BCI of <inline-formula><mml:math id="me372"><mml:mfenced separators="|"><mml:mrow><mml:mn>142,868</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>207,455</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>, while the mean TMRCA inferred with BEAST is ∼160 KYA with a 95% BCI of <inline-formula><mml:math id="me373"><mml:mfenced separators="|"><mml:mrow><mml:mn>133,239</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>196,900</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>. In Appendix D, we include two more comparisons of BESTT and BEAST.</p>
      <fig id="fig9" fig-type="figure" orientation="portrait" position="float">
        <label>Figure 9</label>
        <caption>
          <p>Posterior inference of female effective population size from 35 mitochondrial DNA (mtDNA) samples from Yoruban individuals in the 1000 Genomes Project using our method Bayesian Estimation of population size changes by Sampling Tajima’s Trees (BESTT) (first plot) and the BEAST Extended Bayesian Skyline Plot (second plot). Posterior median curves are depicted as solid black lines and 95% credible intervals by shaded regions.</p>
        </caption>
        <graphic xlink:href="967f9"/>
      </fig>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s24">
    <title>Discussion</title>
    <p>The size of emergent sequencing data sets prohibits the use of standard coalescent modeling for inferring evolutionary parameters. The main computational bottleneck of coalescent-based inference of evolutionary histories lies in the large cardinality of the hidden state space of genealogies. In the standard Kingman coalescent, a genealogy is a random labeled bifurcating tree that models the set of ancestral relationships of the samples. The genealogy accounts for the correlated structure induced by the shared past history of organisms and explicit modeling of genealogies is fundamental for learning about the past history of organisms. However, the genomic era is producing large data sets that require more efficient approaches that efficiently integrate over the hidden state space of genealogies.</p>
    <p>In this manuscript, we show that a lower-resolution coalescent model on genealogies, Tajima’s coalescent, can be used as an alternative to the standard Kingman coalescent model. In particular, we show that the Tajima coalescent model provides a feasible alternative that integrates over a smaller state space than the standard Kingman model. The main advantage in Tajima’s coalescent is modeling of the ranked tree topology as opposed to the fully labeled tree topology, as in Kingman’s coalescent.</p>
    <p><italic>A priori</italic>, the cardinality of the state space of ranked tree shapes is much smaller than the cardinality of the state space of labeled trees. However, in this manuscript we show that when the Tajima coalescent model is coupled with the infinite sites mutation model, the space of ranked tree shapes is constrained by the data and the reduction on the cardinality of the hidden state space of Tajima’s trees is even more pronounced than expected.</p>
    <p>To leverage the constraints imposed by the data and the infinite sites mutation model, we apply Dan Gusfield’s perfect phylogeny algorithm (<xref rid="bib19" ref-type="bibr">Gusfield 1991</xref>) to represent sequence alignments as a gene tree. We exploit the gene tree representation for conditional likelihood calculations and for exploring the state space of ranked tree shapes.</p>
    <p>For the calculation of the likelihood of the data conditioned on a given Tajima’s genealogy, we augment the gene tree representation of the data with the Tajima’s genealogy and map observed mutations to branches. We define a DAG with the augmented gene tree. This new representation as a DAG allows for calculating the likelihood as a backtracking algorithm that transverses the gene tree from the leaves to the root. Our implementation’s computational bottleneck lies in the likelihood calculation. Given a Tajima’s genealogy, our likelihood algorithm sums over all possible allocations of mutation groups to branches. Although this number is generally much smaller than the number of labeled genealogies, our algorithm can be further optimized. In future studies, we will explore a sum-product type of algorithm for the likelihood calculation. In the present implementation, we are able to infer effective population size trajectories from samples of size <inline-formula><mml:math id="me374"><mml:mrow><mml:mi>n</mml:mi><mml:mo>≈</mml:mo><mml:mn>35</mml:mn></mml:mrow></mml:math></inline-formula> on a regular personal laptop computer within few hours.</p>
    <p>Our statistical framework draws on Bayesian nonparametrics. We place a flexible geometric random walk process prior on the effective population size that allows us to recover population size trajectories with abrupt changes in simulations. The inference procedure proposed in this manuscript relies on MCMC methods with three large Gibbs block updates of: coalescent times, effective population size trajectory, and ranked tree shape topology. We use Hamiltonian Monte Carlo updates for continuous random variables—coalescent times and effective population size—and a Metropolis–Hastings sampler for exploring the space of ranked tree shapes. For exploring the genealogical space, <xref rid="bib31" ref-type="bibr">Markovtsova <italic>et al.</italic> (2000)</xref> suggest a joint local proposal for both coalescent times and topology. Here, we restrict our attention to the topology alone. A future line of research includes the development of a joint local proposal of coalescent times and ranked tree shapes. We also envision that a joint sampler of coalescent times and effective population size trajectories should improve mixing and convergence.</p>
    <p>Our method does not model recombination, population structure, or selection. It assumes completely linked and neutral segments from individuals from a single population, and the infinite sites mutation model. While this model is a good approximation for some human molecular data, it is not appropriate for modeling molecular data from other organisms such as pathogens and viral populations. Finally, haplotype data of many organisms are usually sparse with few unique haplotypes presented at high frequencies. Since our algorithm exploits molecular data at the haplotype level, our proposed method is ideally suited for this scenario where the space of ranked tree shapes is drastically smaller than the space of labeled topologies.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>We acknowledge the developers of R-ape, R-phangorn, and R-phylodyn, which facilitated our implementations, and thank the editor and two anonymous referees whose suggestions considerably improved the manuscript. This research was supported in part by National Institutes of Health grant R01 GM-131404 and funding from the Alfred P. Sloan Foundation to J.A.P, and by National Science Foundation CAREER award DBI-1452622 to S.R. A.V. was supported in part by the Chaire Modélisation Mathématique et Biodiversité program of VEOLIA Environnement, École Polytechnique, Museum National d’Histoire Naturelle, Fondation X. A.V. and J.A.P. were supported by the France-Stanford Center for Interdisciplinary Studies.</p>
  </ack>
  <fn-group>
    <fn id="fn1">
      <p>Communicating editor: G. Coop</p>
    </fn>
  </fn-group>
  <app-group>
    <app>
      <title>Appendix</title>
      <sec id="s25">
        <title>Appendix A: Matrix Representation of a Ranked Tree Shape</title>
        <p>Our algorithms exploit the following encoding of a ranked tree shape by a triangular matrix of size <inline-formula><mml:math id="me375"><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula>, which we denote by <inline-formula><mml:math id="me376"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></inline-formula> (<xref ref-type="fig" rid="figA.1">Figure A1</xref>). Recall that, by convention, <inline-formula><mml:math id="me377"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me378"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo>+</mml:mo><mml:mn>∞</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
        <p>First, we declare that <inline-formula><mml:math id="me379"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> if <inline-formula><mml:math id="me380"><mml:mrow><mml:mi>j</mml:mi><mml:mo>&gt;</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. Next, the number of lineages through time is encoded on the diagonal of <inline-formula><mml:math id="me381"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></inline-formula>: <inline-formula><mml:math id="me382"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> for <italic>i</italic> in <inline-formula><mml:math id="me383"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Finally, for <inline-formula><mml:math id="me384"><mml:mrow><mml:mi>j</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>, the entry <inline-formula><mml:math id="me385"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the number of lineages that do not coalesce in the time interval <inline-formula><mml:math id="me386"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>; in particular, <inline-formula><mml:math id="me387"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and for every <italic>i</italic> in <inline-formula><mml:math id="me388"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me389"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the number of singletons (<italic>i.e.</italic>, external branches that have not coalesced) in the time interval <inline-formula><mml:math id="me390"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="figA.1">Figure A1</xref>). Other statistics of the ranked tree shape can be expressed in terms of the corresponding matrix <inline-formula><mml:math id="me391"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></inline-formula>. Among them, the number <italic>c</italic> of cherries is equal to the number of times that the number of singletons decreases by two between lines <italic>i</italic> and <inline-formula><mml:math id="me392"><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, since such an event means that the coalescence separating these two epochs was that of two external branches. That is,</p>
        <disp-formula id="eq___10">
          <mml:math id="me393">
            <mml:mrow>
              <mml:mi>c</mml:mi>
              <mml:mo>=</mml:mo>
              <mml:munderover>
                <mml:mstyle mathsize="140%" displaystyle="true">
                  <mml:mo>∑</mml:mo>
                </mml:mstyle>
                <mml:mrow>
                  <mml:mi>i</mml:mi>
                  <mml:mo>=</mml:mo>
                  <mml:mn>3</mml:mn>
                </mml:mrow>
                <mml:mi>n</mml:mi>
              </mml:munderover>
              <mml:msub>
                <mml:mn>1</mml:mn>
                <mml:mrow>
                  <mml:mo>{</mml:mo>
                  <mml:msub>
                    <mml:mstyle mathvariant="bold" mathsize="normal">
                      <mml:mi>F</mml:mi>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>i</mml:mi>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>−</mml:mo>
                  <mml:msub>
                    <mml:mstyle mathvariant="bold" mathsize="normal">
                      <mml:mi>F</mml:mi>
                    </mml:mstyle>
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>i</mml:mi>
                      <mml:mo>−</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                  </mml:msub>
                  <mml:mo>=</mml:mo>
                  <mml:mn>2</mml:mn>
                  <mml:mo>}</mml:mo>
                </mml:mrow>
              </mml:msub>
              <mml:mo>.</mml:mo>
            </mml:mrow>
          </mml:math>
        </disp-formula>
      </sec>
      <sec id="s26">
        <title>Appendix B</title>
        <sec id="s27">
          <title>Detailed allocation of mutation groups along <inline-formula><mml:math id="me394"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula></title>
          <p>The latent allocation random variables <inline-formula><mml:math id="me395"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are constrained by the information in the Tajima’s genealogy <inline-formula><mml:math id="me396"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. In a given <inline-formula><mml:math id="me397"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, every subtree is labeled by its ranking from past to present (<xref ref-type="fig" rid="figA.1">Figure A1</xref>). Subtree <italic>i</italic> is subtended by branch <inline-formula><mml:math id="me398"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> with length <inline-formula><mml:math id="me399"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, for <inline-formula><mml:math id="me400"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula>. We will assume that <inline-formula><mml:math id="me401"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, the length of the root branch, is 0. Let <italic>c</italic> be the number of cherries (nodes with two leaves) in <inline-formula><mml:math id="me402"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>; the two branches of a given cherry share the same label <inline-formula><mml:math id="me403"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The actual label of external branches is arbitrary but, for ease of exposition in our figures, we first label the cherries’ branches from left to right by <inline-formula><mml:math id="me404"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>; singleton branches are labeled from left to right by <inline-formula><mml:math id="me405"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mi>c</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). As mentioned before, the length of <inline-formula><mml:math id="me406"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the number of the corresponding sister nodes in <inline-formula><mml:math id="me407"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> that were grouped together in forming node <inline-formula><mml:math id="me408"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. In this case, <inline-formula><mml:math id="me409"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mo>|</mml:mo><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> denotes a collection of <inline-formula><mml:math id="me410"><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> vectors of branch labels in <inline-formula><mml:math id="me411"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> subtending the child node subtrees of node <inline-formula><mml:math id="me412"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="me413"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to the branch subtending from the leftmost child node of <inline-formula><mml:math id="me414"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> on <inline-formula><mml:math id="me415"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="me416"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to the branch subtending from the next child node of <inline-formula><mml:math id="me417"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, etc., and <inline-formula><mml:math id="me418"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mo>|</mml:mo><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to the branch subtending from the rightmost child node of <inline-formula><mml:math id="me419"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> on <inline-formula><mml:math id="me420"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>. Observe that, since we group some of the leaf nodes in <inline-formula><mml:math id="me421"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> into a single node in <inline-formula><mml:math id="me422"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>D</mml:mi></mml:mstyle></mml:math></inline-formula>, any <inline-formula><mml:math id="me423"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> may be a vector of branch labels; for example <inline-formula><mml:math id="me424"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>9</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me425"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> in <xref ref-type="fig" rid="fig3">Figure 3B</xref>.</p>
        </sec>
      </sec>
      <sec id="s28">
        <title>Appendix C</title>
        <sec id="s29">
          <title>Algorithms for conditional likelihood calculation</title>
          <p>The following two algorithms detail the calculation of <inline-formula><mml:math id="me426"><mml:mrow><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>|</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. <inline-formula><mml:math id="me427"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle></mml:math></inline-formula> is encoded in <inline-formula><mml:math id="me428"><mml:mrow><mml:mi>G</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>T</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula>, the observed data as a tree structure. Each node in <inline-formula><mml:math id="me429"><mml:mrow><mml:mi>G</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>T</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> has number of descendants (or lineages) and mutation information attached to it. Tajima’s genealogy <inline-formula><mml:math id="me430"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is encoded as <inline-formula><mml:math id="me431"><mml:mrow><mml:mi>F</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula>, which contains the ranked tree shape <inline-formula><mml:math id="me432"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="me433"><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:math></inline-formula>, which contains the vector of coalescent times <inline-formula><mml:math id="me434"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula> multiplied by the mutation rate <italic>μ</italic>.</p>
          <p><bold>Algorithm 1</bold> Calculate Likelihood<inline-formula><mml:math id="me435"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>F</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>G</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>T</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> procedure</p>
          <list list-type="simple" id="L3">
            <list-item>
              <p><bold>Input:</bold><inline-formula><mml:math id="me436"><mml:mrow><mml:mi>G</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>T</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me437"><mml:mrow><mml:mi>F</mml:mi><mml:mi>P</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula></p>
            </list-item>
            <list-item>
              <p><bold>Output:</bold> Log Likelihood <inline-formula><mml:math id="me438"><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula></p>
            </list-item>
            <list-item>
              <p>1: Initiate <inline-formula><mml:math id="me439"><mml:mrow><mml:mi>p</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:math></inline-formula> to be the set of leaf nodes of <inline-formula><mml:math id="me440"><mml:mrow><mml:mi>G</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>T</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> with at least one descendant. Initiate <inline-formula><mml:math id="me441"><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me442"><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:math></inline-formula> to be zero. Initiate <italic>current_path</italic> to be empty.</p>
            </list-item>
            <list-item>
              <p>2: Call CalcLL_recursive(<italic>LL, index, current_path, Fpath, times, Genetree</italic>).</p>
            </list-item>
            <list-item>
              <p>3: <bold>return</bold>
<inline-formula><mml:math id="me450"><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula></p>
            </list-item>
          </list>
          <p><bold>Algorithm 2</bold> CalcLL_recursive(<inline-formula><mml:math id="me451"><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me452"><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:math></inline-formula>, <italic>current_path</italic>, <inline-formula><mml:math id="me454"><mml:mrow><mml:mi>F</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me455"><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me456"><mml:mrow><mml:mi>G</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula>) procedure<list list-type="simple" id="L4"><list-item><p>1: <bold>if <inline-formula><mml:math id="me457"><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>l</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></bold> {When a complete path node is found} <bold>then</bold></p></list-item><list-item><p>2: <bold>for</bold>
<inline-formula><mml:math id="me458"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> in <inline-formula><mml:math id="me459"><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula>
<bold>do</bold></p></list-item><list-item><p>3: Calculate log likelihood based on <inline-formula><mml:math id="me460"><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:math></inline-formula> and number of mutations of <inline-formula><mml:math id="me461"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> in <italic>current_path</italic>.</p></list-item><list-item><p>4: Accumulate to total log likelihood <inline-formula><mml:math id="me463"><mml:mrow><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p>5: <bold>end for</bold></p></list-item><list-item><p>6: <bold>else</bold></p></list-item><list-item><p>7: <bold>for</bold>
<inline-formula><mml:math id="me464"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> in <inline-formula><mml:math id="me465"><mml:mrow><mml:mi>p</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:math></inline-formula>
<bold>do</bold></p></list-item><list-item><p>8: Check compatibility of the <inline-formula><mml:math id="me466"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula>, according to the given <inline-formula><mml:math id="me467"><mml:mrow><mml:mi>F</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p>9: <bold>if</bold>
<inline-formula><mml:math id="me468"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> is compatible with <inline-formula><mml:math id="me469"><mml:mrow><mml:mi>F</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula>
<bold>then</bold></p></list-item><list-item><p>10: Update <inline-formula><mml:math id="me470"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> by assigning it to the current step in <inline-formula><mml:math id="me471"><mml:mrow><mml:mi>F</mml:mi><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p>11: Update <inline-formula><mml:math id="me472"><mml:mrow><mml:mi>p</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:math></inline-formula>. If a <inline-formula><mml:math id="me473"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> has been mapped entirely, remove <inline-formula><mml:math id="me474"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> from pool, update its parent <inline-formula><mml:math id="me475"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula>, and potentially add parent node to <inline-formula><mml:math id="me476"><mml:mrow><mml:mi>p</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:math></inline-formula> if parent node has not been entirely assigned.</p></list-item><list-item><p>12: Append this <inline-formula><mml:math id="me477"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula> to <italic>current_path</italic></p></list-item><list-item><p>13: Call CalcLL_recursive(<italic>LL, index</italic> + 1, <italic>current_path, Fpath, Genetree</italic>)</p></list-item><list-item><p>14: Restore previous <inline-formula><mml:math id="me484"><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me485"><mml:mrow><mml:mi>p</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:math></inline-formula>, and <italic>current_path</italic></p></list-item><list-item><p>15: <bold>end if</bold></p></list-item><list-item><p>16: <bold>end for</bold></p></list-item><list-item><p>17: <bold>end if</bold></p></list-item></list>To illustrate algorithms 1 and 2, we use our examples of <xref ref-type="fig" rid="fig2">Figure 2</xref> and <xref ref-type="fig" rid="fig3">Figure 3</xref>. Algorithm 1 initiates the <italic>pool</italic> with nodes <inline-formula><mml:math id="me487"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. Then, Algorithm 2 cycles through this list. Assume the first node is <inline-formula><mml:math id="me488"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. This node has <inline-formula><mml:math id="me489"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> descendants and the <italic>ancestry</italic> is <inline-formula><mml:math id="me490"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> with sizes: <inline-formula><mml:math id="me491"><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>3</mml:mn><mml:mo>−</mml:mo><mml:mn>7</mml:mn><mml:mo>−</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>. On the other hand, the first coalescent event (from present to past) labeled 16 in <inline-formula><mml:math id="me492"><mml:mrow><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>g</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig3">Figure 3A</xref>) has ancestry with sizes: <inline-formula><mml:math id="me493"><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>3</mml:mn><mml:mo>−</mml:mo><mml:mn>7</mml:mn><mml:mo>−</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>. Therefore, this node is <italic>compatible</italic>. The node is removed from the pool, its parent node added to the pool, and <inline-formula><mml:math id="me494"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> is assigned to the path. At this time <italic>current_path</italic> = <italic>Z</italic><sub>8</sub> and the <italic>pool</italic> becomes: <inline-formula><mml:math id="me496"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The algorithm then cycles through this list and picks <inline-formula><mml:math id="me497"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. This node has size ancestry <inline-formula><mml:math id="me498"><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>3</mml:mn><mml:mo>−</mml:mo><mml:mn>7</mml:mn><mml:mo>−</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>. On the other hand the second coalescent event labeled 15 has size ancestry: <inline-formula><mml:math id="me499"><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>3</mml:mn><mml:mo>−</mml:mo><mml:mn>5</mml:mn><mml:mo>−</mml:mo><mml:mn>7</mml:mn><mml:mo>−</mml:mo><mml:mn>9</mml:mn><mml:mo>−</mml:mo><mml:mn>16</mml:mn></mml:mrow></mml:math></inline-formula>. Since the node size ancestry is contained in the second coalescent event’s size ancestry, this node is <italic>compatible</italic>. The current path becomes <italic>current_path</italic> = <italic>Z</italic><sub>8</sub> − <italic>Z</italic><sub>10</sub> and the pool becomes <inline-formula><mml:math id="me501"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. We continue this procedure until we reach the path <italic>current_path =</italic> <inline-formula><mml:math id="me502"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
          <p>Once a path is found, the algorithm backtracks the path until there is one compatible node and the path continues to grow. A sequence of backtracking and growing is the following:<list list-type="order" id="L5"><list-item><p><inline-formula><mml:math id="me503"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me504"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me505"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me506"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me507"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me508"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me509"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me510"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me511"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me512"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me513"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me514"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me515"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me516"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me517"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me518"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me519"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p><inline-formula><mml:math id="me520"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>7</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula></p></list-item></list>In the first sequence of steps <inline-formula><mml:math id="me521"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>, the path decreases. This happens because there are no alternative compatible paths at the point when the sequence starts to grow until step 10. At step 10, the algorithm does not find a compatible way to keep growing the path so the algorithm starts to backtrack again until step 12. From steps 12 to 18, the algorithm grows the path until a new complete path has been found. A complete path has the correspondence of coalescent events to nodes in the gene tree. The first element of the path <inline-formula><mml:math id="me522"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>8</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to the coalescent event at time <inline-formula><mml:math id="me523"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>8</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, the second element of the path <inline-formula><mml:math id="me524"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to the second coalescent event at time <inline-formula><mml:math id="me525"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>7</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. The last element of the path is <inline-formula><mml:math id="me526"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> when all sequences coalesce at time <inline-formula><mml:math id="me527"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. In this example, the algorithm finds eight paths. Once the paths are found, the algorithm computes the likelihood and the result is the sum of the likelihoods of the eight paths.</p>
        </sec>
        <sec id="s30">
          <title>Markovian proposal of ranked tree shapes</title>
          <p>The following algorithm generates a new ranked tree shape from a Markovian proposal and outputs the corresponding transition probabilities. This proposal is used in <italic>Metropolis–Hastings updates for ranked tree shapes</italic>.</p>
          <p><bold>Algorithm 3</bold> Transition proposals for ranked tree shapes</p>
          <list list-type="simple" id="L6">
            <list-item>
              <p><bold>Input: <inline-formula><mml:math id="me528"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> Output: <inline-formula><mml:math id="me529"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula></bold>, <inline-formula><mml:math id="me530"><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me531"><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></p>
              <list list-type="simple" id="L7">
                <list-item>
                  <p>1. Set <inline-formula><mml:math id="me532"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula>.</p>
                </list-item>
                <list-item>
                  <p>2. Sample with uniform discrete probability a coalescent event <italic>k</italic> from the set <inline-formula><mml:math id="me533"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> Set <inline-formula><mml:math id="me534"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>.</p>
                </list-item>
                <list-item>
                  <p>3. <bold>If</bold> lineage <italic>k</italic> coalesces at time <inline-formula><mml:math id="me535"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig4">Figure 4</xref>, Case A)</p>
                </list-item>
              </list>
            </list-item>
            <list-item>
              <p><bold>If</bold> the lineages coalescing at time <inline-formula><mml:math id="me536"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are singletons (<xref ref-type="fig" rid="fig4">Figure 4</xref>, Case A, lineages 1 and 2 in <inline-formula><mml:math id="me537"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>)</p>
              <list list-type="alpha-lower" id="L8">
                <list-item>
                  <p>No sampling required to distinguish between two singletons. Set <inline-formula><mml:math id="me538"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
                </list-item>
                <list-item>
                  <p>Update <inline-formula><mml:math id="me539"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula>: merge one singleton with the lineage coalescing at <inline-formula><mml:math id="me540"><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (excluding lineage <italic>k</italic>) in <inline-formula><mml:math id="me541"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, then merge the second singleton at time <inline-formula><mml:math id="me542"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> with lineage <italic>k</italic>.</p>
                </list-item>
                <list-item>
                  <p>Compute the probability <inline-formula><mml:math id="me543"><mml:mrow><mml:mi>q</mml:mi><mml:msub><mml:mo>′</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> of restoring the ordering of <inline-formula><mml:math id="me544"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> to <inline-formula><mml:math id="me545"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
                </list-item>
              </list>
            </list-item>
            <list-item>
              <p>
                <bold>Else</bold>
              </p>
              <list list-type="alpha-lower" id="L9">
                <list-item>
                  <p>Sample one of the lineages coalescing at time <inline-formula><mml:math id="me546"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> with uniform discrete probability. Set <inline-formula><mml:math id="me547"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:math></inline-formula>.</p>
                </list-item>
                <list-item>
                  <p>Update <inline-formula><mml:math id="me548"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula>: merge the sampled lineage with the one coalescing at time <inline-formula><mml:math id="me549"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> in <inline-formula><mml:math id="me550"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. At time <inline-formula><mml:math id="me551"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, merge the lineage not sampled with the new lineage <italic>k</italic>.</p>
                </list-item>
                <list-item>
                  <p>Compute the probability <inline-formula><mml:math id="me552"><mml:mrow><mml:mi>q</mml:mi><mml:msub><mml:mo>′</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> of restoring the ordering of <inline-formula><mml:math id="me553"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> to <inline-formula><mml:math id="me554"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
                </list-item>
              </list>
            </list-item>
            <list-item>
              <p><bold>Else</bold> (<xref ref-type="fig" rid="fig4">Figure 4</xref>, Case B)</p>
            </list-item>
          </list>
          <p>Swap the coalescent events. Lineages descending from <italic>k</italic> are now set to coalesce at time <inline-formula><mml:math id="me555"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and lineages previously descending from <inline-formula><mml:math id="me556"><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> are now set to coalesce at time <inline-formula><mml:math id="me557"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Set <inline-formula><mml:math id="me558"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="me559"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>′</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
          <list list-type="simple" id="L10">
            <list-item>
              <p>4. <inline-formula><mml:math id="me560"><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mtext> </mml:mtext><mml:msub><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="me561"><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi><mml:mtext>*</mml:mtext></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mtext> </mml:mtext><mml:mi>q</mml:mi><mml:msub><mml:mo>′</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
            </list-item>
          </list>
        </sec>
      </sec>
      <sec id="s31">
        <title>Appendix D</title>
        <p>We replicated the BEAST EBSP analysis of the 35 Yoruban individuals from the 1000 Genomes Project phase 3 using the whole mtDNA coding region consisting of 15,409 sites. In both cases, we assumed the Jukes–Cantor mutation model (<xref rid="bib22" ref-type="bibr">Jukes and Cantor, 1969</xref>). <xref ref-type="fig" rid="figD.1">Figure D1</xref> shows the comparison between EBSP inference from the 240 segregating sites retained in <italic>Inferring human population demography from mtDNA</italic> that are compatible with the infinite sites mutation model assumption. In both cases, we recover very similar trajectories.</p>
        <p>In addition, we compared our results with BEAST Bayesian Skyline Plot (BSP) (<xref rid="bib10" ref-type="bibr">Drummond and Rodrigo, 2000</xref>). For our reduced data set of 240 segregating sites, we could not generate valid inference of <inline-formula><mml:math id="me562"><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with Metropolis–Hastings acceptance probability &gt; 0. Instead, we were able to generate results with BEAST BSP from the complete data set of 15,409 sites. The comparison of our method from 240 segregating sites to BEAST BSP from 15,409 sites is depicted in <xref ref-type="fig" rid="figD.2">Figure D2</xref>.</p>
      </sec>
      <sec id="s32">
        <title>Appendix E</title>
        <p>In <xref ref-type="fig" rid="figE.1">Figure E1A</xref>, we show the data from <xref ref-type="fig" rid="fig2">Figure 2A</xref> with an additional haplotype (10) with frequency 1 and an additional column grouped with mutation group h (not shown in the table). In <xref ref-type="fig" rid="figE.1">Figure E1B</xref> we show the corresponding perfect phylogeny. This new perfect phylogeny has a new tip with black label 1 (frequency) subtending from a branch with 0 mutations (red label). The path from the leaf to the root shows that this haplotype has a unique mutation corresponding to mutation group <italic>a</italic>. We note that mutation group labels carry no information. We incorporate the labels in the figure for ease of exposition. Since mutation group h has now multiplicity 2, the branch labeled h has now a red label 2.</p>
        <fig id="figA.1" fig-type="figure" orientation="portrait" position="anchor">
          <label>Figure A1</label>
          <caption>
            <p>Ranked tree shape. Left: Example of a Tajima’s genealogy (redrawn from <xref ref-type="fig" rid="fig1">Figure 1A</xref>) with coalescent events ranked from 2 at time <inline-formula><mml:math id="me563"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to <italic>n</italic> at time <inline-formula><mml:math id="me564"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Right: The corresponding <inline-formula><mml:math id="me565"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> matrix, with <inline-formula><mml:math id="me566"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>, that encodes the ranked tree shape information of the Tajima’s genealogy on the left. <inline-formula><mml:math id="me567"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the number of lineages that do not coalesce in the time interval <inline-formula><mml:math id="me568"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. In particular, <inline-formula><mml:math id="me569"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> for <italic>i</italic> in <inline-formula><mml:math id="me570"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> denotes the number of singletons (external branches that have not coalesced) in the time interval <inline-formula><mml:math id="me571"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
          </caption>
          <graphic xlink:href="967app1"/>
        </fig>
        <fig id="figD.1" fig-type="figure" orientation="portrait" position="anchor">
          <label>Figure D1</label>
          <caption>
            <p>Posterior inference of female effective population size from 35 mtDNA samples from Yoruban individuals in the 1000 Genomes Project using BEAST EBSP (first plot) from all 15,409 sites and the BEAST EBSP (second plot) from the 240 segregating sites retained. In both cases, the mutation model assumed is Jukes Cantor (JC). Posterior median curves are depicted as solid black lines and 95% credible intervals by shaded regions.</p>
          </caption>
          <graphic xlink:href="967app2"/>
        </fig>
        <fig id="figD.2" fig-type="figure" orientation="portrait" position="anchor">
          <label>Figure D2</label>
          <caption>
            <p>Posterior inference of female effective population size from 35 mtDNA samples from Yoruban individuals in the 1000 Genomes Project using our BESTT (first plot) from only 240 segregating sites and the BEAST BSP (second plot) from all the 15,409 sites. Posterior median curves are depicted as solid black lines and 95% credible intervals by shaded regions.</p>
          </caption>
          <graphic xlink:href="967app3"/>
        </fig>
        <fig id="figE.1" fig-type="figure" orientation="portrait" position="anchor">
          <label>Figure E1</label>
          <caption>
            <p>Second example of Perfect Phylogeny. (A). Compressed data representation <inline-formula><mml:math id="me572"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mrow><mml:mi>h</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of <inline-formula><mml:math id="me573"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>17</mml:mn></mml:mrow></mml:math></inline-formula> sequences and <inline-formula><mml:math id="me574"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>19</mml:mn></mml:mrow></mml:math></inline-formula> (columns, only the first 10 of which are shown), comprised of 10 haplotypes and 13 mutation groups. This data table has one more haplotype (10) and one more mutation labeled h than the example of <xref ref-type="fig" rid="fig2">Figure 2</xref>. (B). Gene tree representation of the data in (A). Red numbers indicate the cardinality of each mutation group (number of columns with the same label in (A). Black letters indicate the mutation group (column labels in (A), and black numbers indicate the frequency of the corresponding haplotype.</p>
          </caption>
          <graphic xlink:href="967app4"/>
        </fig>
      </sec>
    </app>
  </app-group>
  <ref-list>
    <title>Literature Cited</title>
    <ref id="bib1">
      <mixed-citation publication-type="journal">1000 Genomes Project Consortium, <person-group person-group-type="author"><name name-style="western"><surname>Auton</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Abecasis</surname><given-names>G. R.</given-names></name>, <name name-style="western"><surname>Altshuler</surname><given-names>D. M</given-names></name>, <name name-style="western"><surname>Durbin</surname><given-names>R. M.</given-names></name><etal/></person-group>, <year>2015</year> <article-title>A global reference for human genetic variation.</article-title>
<source>Nature</source>
<volume>526</volume>: <fpage>68</fpage>–<lpage>74</lpage>. <pub-id pub-id-type="doi">10.1038/nature15393</pub-id><pub-id pub-id-type="pmid">26432245</pub-id></mixed-citation>
    </ref>
    <ref id="bib2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Aberer</surname><given-names>A. J.</given-names></name>, <name name-style="western"><surname>Stamatakis</surname><given-names>A.</given-names></name>, and <name name-style="western"><surname>Ronquist</surname><given-names>F.</given-names></name></person-group>, <year>2016</year> <article-title>An efficient independence sampler for updating branches in Bayesian Markov chain Monte Carlo sampling of phylogenetic trees.</article-title><source>Syst. Biol.</source><volume>65</volume>: <fpage>161</fpage>–<lpage>176</lpage>. <pub-id pub-id-type="doi">10.1093/sysbio/syv051</pub-id><pub-id pub-id-type="pmid">26231183</pub-id></mixed-citation>
    </ref>
    <ref id="bib3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Anderson</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Bankier</surname><given-names>A. T.</given-names></name>, <name name-style="western"><surname>Barrell</surname><given-names>B. G.</given-names></name>, <name name-style="western"><surname>de Bruijn</surname><given-names>M. H.</given-names></name>, <name name-style="western"><surname>Coulson</surname><given-names>A. R.</given-names></name><etal/></person-group>, <year>1981</year> <article-title>Sequence and organization of the human mitochondrial genome.</article-title><source>Nature</source><volume>290</volume>: <fpage>457</fpage>–<lpage>465</lpage>. <pub-id pub-id-type="doi">10.1038/290457a0</pub-id><pub-id pub-id-type="pmid">7219534</pub-id></mixed-citation>
    </ref>
    <ref id="bib4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Andrews</surname><given-names>R. M.</given-names></name>, <name name-style="western"><surname>Kubacka</surname><given-names>I.</given-names></name>, <name name-style="western"><surname>Chinnery</surname><given-names>P. F.</given-names></name>, <name name-style="western"><surname>Lightowlers</surname><given-names>R. N.</given-names></name>, <name name-style="western"><surname>Turnbull</surname><given-names>D. M.</given-names></name><etal/></person-group>, <year>1999</year> <article-title>Reanalysis and revision of the Cambridge reference sequence for human mitochondrial DNA.</article-title><source>Nat. Genet.</source><volume>23</volume>: <fpage>147</fpage><pub-id pub-id-type="doi">10.1038/13779</pub-id><pub-id pub-id-type="pmid">10508508</pub-id></mixed-citation>
    </ref>
    <ref id="bib5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Behar</surname><given-names>D. M.</given-names></name>, <name name-style="western"><surname>Van Oven</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Rosset</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Metspalu</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Loogväli</surname><given-names>E.-L.</given-names></name><etal/></person-group>, <year>2012</year> <article-title>A “Copernican” reassessment of the human mitochondrial DNA tree from its root.</article-title><source>Am. J. Hum. Genet.</source><volume>90</volume>: <fpage>675</fpage>–<lpage>684</lpage>. <pub-id pub-id-type="doi">10.1016/j.ajhg.2012.03.002</pub-id><pub-id pub-id-type="pmid">22482806</pub-id></mixed-citation>
    </ref>
    <ref id="bib6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bhaskar</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>Y. R.</given-names></name>, and <name name-style="western"><surname>Song</surname><given-names>Y. S.</given-names></name></person-group>, <year>2015</year> <article-title>Efficient inference of population size histories and locus-specific mutation rates from large-sample genomic variation data.</article-title><source>Genome Res.</source><volume>25</volume>: <fpage>268</fpage>–<lpage>279</lpage>. <pub-id pub-id-type="doi">10.1101/gr.178756.114</pub-id><pub-id pub-id-type="pmid">25564017</pub-id></mixed-citation>
    </ref>
    <ref id="bib7">
      <mixed-citation publication-type="web"><person-group person-group-type="author"><name name-style="western"><surname>Cappello</surname><given-names>L.</given-names></name>, and <name name-style="western"><surname>Palacios</surname><given-names>J. A.</given-names></name></person-group>, <year>2019</year> <article-title>Sequential importance sampling for multi-resolution Kingman-Tajima coalescent counting.</article-title><source>arXiv</source>. Available at: <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1902.05527">https://arxiv.org/abs/1902.05527</ext-link>.</mixed-citation>
    </ref>
    <ref id="bib8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Disanto</surname><given-names>F.</given-names></name>, and <name name-style="western"><surname>Wiehe</surname><given-names>T.</given-names></name></person-group>, <year>2013</year> <article-title>Exact enumeration of cherries and pitchforks in ranked trees under the coalescent model.</article-title><source>Math. Biosci.</source><volume>242</volume>: <fpage>195</fpage>–<lpage>200</lpage>. <pub-id pub-id-type="doi">10.1016/j.mbs.2013.01.010</pub-id><pub-id pub-id-type="pmid">23396093</pub-id></mixed-citation>
    </ref>
    <ref id="bib9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Donnelly</surname><given-names>P.</given-names></name>, and <name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group>, <year>1995</year> <article-title>Coalescents and genealogical structure under neutrality.</article-title><source>Annu. Rev. Genet.</source><volume>29</volume>: <fpage>401</fpage>–<lpage>421</lpage>. <pub-id pub-id-type="doi">10.1146/annurev.ge.29.120195.002153</pub-id><pub-id pub-id-type="pmid">8825481</pub-id></mixed-citation>
    </ref>
    <ref id="bib10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Drummond</surname><given-names>A.</given-names></name>, and <name name-style="western"><surname>Rodrigo</surname><given-names>A.</given-names></name></person-group>, <year>2000</year> <article-title>Reconstructing genealogies of serial samples under the assumption of a molecular clock using serial-sample UPGMA.</article-title><source>Mol. Biol. Evol.</source><volume>17</volume>: <fpage>1807</fpage>–<lpage>1815</lpage>. <pub-id pub-id-type="doi">10.1093/oxfordjournals.molbev.a026281</pub-id><pub-id pub-id-type="pmid">11110896</pub-id></mixed-citation>
    </ref>
    <ref id="bib11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Drummond</surname><given-names>A. J.</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Shapiro</surname><given-names>B.</given-names></name>, and <name name-style="western"><surname>Pybus</surname><given-names>O. G.</given-names></name></person-group>, <year>2005</year> <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences.</article-title><source>Mol. Biol. Evol.</source><volume>22</volume>: <fpage>1185</fpage>–<lpage>1192</lpage>. <pub-id pub-id-type="doi">10.1093/molbev/msi103</pub-id><pub-id pub-id-type="pmid">15703244</pub-id></mixed-citation>
    </ref>
    <ref id="bib12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Drummond</surname><given-names>A. J.</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>M. A.</given-names></name>, <name name-style="western"><surname>Xie</surname><given-names>D.</given-names></name>, and <name name-style="western"><surname>Rambaut</surname><given-names>A.</given-names></name></person-group>, <year>2012</year> <article-title>Bayesian phylogenetics with BEAUti and the BEAST 1.7.</article-title><source>Mol. Biol. Evol.</source><volume>29</volume>: <fpage>1969</fpage>–<lpage>1973</lpage>. <pub-id pub-id-type="doi">10.1093/molbev/mss075</pub-id><pub-id pub-id-type="pmid">22367748</pub-id></mixed-citation>
    </ref>
    <ref id="bib13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gill</surname><given-names>M. S.</given-names></name>, <name name-style="western"><surname>Lemey</surname><given-names>P.</given-names></name>, <name name-style="western"><surname>Faria</surname><given-names>N. R.</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Shapiro</surname><given-names>B.</given-names></name><etal/></person-group>, <year>2013</year> <article-title>Improving Bayesian population dynamics inference: a coalescent-based model for multiple loci.</article-title><source>Mol. Biol. Evol.</source><volume>30</volume>: <fpage>713</fpage>–<lpage>724</lpage>. <pub-id pub-id-type="doi">10.1093/molbev/mss265</pub-id><pub-id pub-id-type="pmid">23180580</pub-id></mixed-citation>
    </ref>
    <ref id="bib14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Griffiths</surname><given-names>R. C.</given-names></name>, and <name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group>, <year>1994</year><comment>a</comment> <article-title>Simulating probability distributions in the coalescent.</article-title><source>Theor. Popul. Biol.</source><volume>46</volume>: <fpage>131</fpage>–<lpage>159</lpage>. <pub-id pub-id-type="doi">10.1006/tpbi.1994.1023</pub-id></mixed-citation>
    </ref>
    <ref id="bib15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Griffiths</surname><given-names>R. C.</given-names></name>, and <name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group>, <year>1994</year><comment>b</comment> <article-title>Sampling theory for neutral alleles in a varying environment.</article-title><source>Philos. Trans. R. Soc. Lond. B Biol. Sci.</source><volume>344</volume>: <fpage>403</fpage>–<lpage>410</lpage>. <pub-id pub-id-type="doi">10.1098/rstb.1994.0079</pub-id><pub-id pub-id-type="pmid">7800710</pub-id></mixed-citation>
    </ref>
    <ref id="bib16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Griffiths</surname><given-names>R. C.</given-names></name>, and <name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group>, <year>1995</year> <article-title>Unrooted genealogical tree probabilities in the infinitely-many-sites model.</article-title><source>Math. Biosci.</source><volume>127</volume>: <fpage>77</fpage>–<lpage>98</lpage>. <pub-id pub-id-type="doi">10.1016/0025-5564(94)00044-Z</pub-id><pub-id pub-id-type="pmid">7734858</pub-id></mixed-citation>
    </ref>
    <ref id="bib17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Griffiths</surname><given-names>R. C.</given-names></name>, and <name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group>, <year>1996</year> <article-title>Monte Carlo inference methods in population genetics.</article-title><source>Math. Comput. Model.</source><volume>23</volume>: <fpage>141</fpage>–<lpage>158</lpage>. <pub-id pub-id-type="doi">10.1016/0895-7177(96)00046-5</pub-id></mixed-citation>
    </ref>
    <ref id="bib18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gronau</surname><given-names>I.</given-names></name>, <name name-style="western"><surname>Hubisz</surname><given-names>M. J.</given-names></name>, <name name-style="western"><surname>Gulko</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Danko</surname><given-names>C. G.</given-names></name>, and <name name-style="western"><surname>Siepel</surname><given-names>A.</given-names></name></person-group>, <year>2011</year> <article-title>Bayesian inference of ancient human demography from individual genome sequences.</article-title><source>Nat. Genet.</source><volume>43</volume>: <fpage>1031</fpage>–<lpage>1034</lpage>. <pub-id pub-id-type="doi">10.1038/ng.937</pub-id><pub-id pub-id-type="pmid">21926973</pub-id></mixed-citation>
    </ref>
    <ref id="bib19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Gusfield</surname><given-names>D.</given-names></name></person-group>, <year>1991</year> <article-title>Efficient algorithms for inferring evolutionary trees.</article-title><source>Networks</source><volume>21</volume>: <fpage>19</fpage>–<lpage>28</lpage>. <pub-id pub-id-type="doi">10.1002/net.3230210104</pub-id></mixed-citation>
    </ref>
    <ref id="bib20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Heled</surname><given-names>J.</given-names></name>, and <name name-style="western"><surname>Drummond</surname><given-names>A. J.</given-names></name></person-group>, <year>2008</year> <article-title>Bayesian inference of population size history from multiple loci.</article-title><source>BMC Evol. Biol.</source><volume>8</volume>: <lpage>289</lpage>. <pub-id pub-id-type="doi">10.1186/1471-2148-8-289</pub-id></mixed-citation>
    </ref>
    <ref id="bib21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Hobolth</surname><given-names>A.</given-names></name>, <name name-style="western"><surname>Uyenoyama</surname><given-names>M. K.</given-names></name>, and <name name-style="western"><surname>Wiuf</surname><given-names>C.</given-names></name></person-group>, <year>2008</year> <article-title>Importance sampling for the infinite sites model.</article-title><source>Stat. Appl. Genet. Mol. Biol.</source><volume>7</volume>: Article32. <pub-id pub-id-type="doi">10.2202/1544-6115.1400</pub-id></mixed-citation>
    </ref>
    <ref id="bib22">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Jukes</surname><given-names>T. H.</given-names></name>, and <name name-style="western"><surname>Cantor</surname><given-names>R. C.</given-names></name></person-group>, <year>1969</year> <article-title>Evolution of protein molecules,</article-title> pp. <fpage>21</fpage>–<lpage>132</lpage> in <source>Mammalian Protein Metabolism</source>, edited by <person-group person-group-type="editor"><name name-style="western"><surname>Munro</surname><given-names>H. N.</given-names></name></person-group>
<publisher-name>Academic Press</publisher-name>, <publisher-loc>New York</publisher-loc>
<pub-id pub-id-type="doi">10.1016/B978-1-4832-3211-9.50009-7</pub-id></mixed-citation>
    </ref>
    <ref id="bib23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Karcher</surname><given-names>M. D.</given-names></name>, <name name-style="western"><surname>Palacios</surname><given-names>J. A.</given-names></name>, <name name-style="western"><surname>Lan</surname><given-names>S.</given-names></name>, and <name name-style="western"><surname>Minin</surname><given-names>V. N.</given-names></name></person-group>, <year>2017</year> <article-title>phylodyn: an r package for phylodynamic simulation and inference.</article-title><source>Mol. Ecol. Resour.</source><volume>17</volume>: <fpage>96</fpage>–<lpage>100</lpage>. <pub-id pub-id-type="doi">10.1111/1755-0998.12630</pub-id><pub-id pub-id-type="pmid">27801980</pub-id></mixed-citation>
    </ref>
    <ref id="bib24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kingman</surname><given-names>J.</given-names></name></person-group>, <year>1982</year><comment>a</comment> <article-title>The coalescent.</article-title><source>Stochastic Process. Appl.</source><volume>13</volume>: <fpage>235</fpage>–<lpage>248</lpage>. <pub-id pub-id-type="doi">10.1016/0304-4149(82)90011-4</pub-id></mixed-citation>
    </ref>
    <ref id="bib25">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Kingman</surname><given-names>J. F. C.</given-names></name></person-group>, <year>1982</year><comment>b</comment> <article-title>Exchangeability and the evolution of large populations</article-title>, pp. <fpage>97</fpage>–<lpage>112</lpage> in <source>Exchangeability in Probability and Statistics</source>, edited by <person-group person-group-type="editor"><name name-style="western"><surname>Koch</surname><given-names>G.</given-names></name> and <name name-style="western"><surname>Spizzichino</surname><given-names>F.</given-names></name></person-group>
<publisher-name>North-Holland</publisher-name>, <publisher-loc>Amsterdam</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="bib26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kuhner</surname><given-names>M. K.</given-names></name></person-group>, <year>2006</year> <article-title>LAMARC 2.0: maximum likelihood and Bayesian estimation of population parameters.</article-title><source>Bioinformatics</source><volume>22</volume>: <fpage>768</fpage>–<lpage>770</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btk051</pub-id><pub-id pub-id-type="pmid">16410317</pub-id></mixed-citation>
    </ref>
    <ref id="bib27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kuhner</surname><given-names>M. K.</given-names></name>, and <name name-style="western"><surname>Smith</surname><given-names>L.</given-names></name></person-group>, <year>2007</year> <article-title>Comparing likelihood and Bayesian coalescent estimation of population parameters.</article-title><source>Genetics</source><volume>175</volume>: <fpage>155</fpage>–<lpage>165</lpage>. <pub-id pub-id-type="doi">10.1534/genetics.106.056457</pub-id><pub-id pub-id-type="pmid">16510781</pub-id></mixed-citation>
    </ref>
    <ref id="bib28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kuhner</surname><given-names>M. K.</given-names></name>, <name name-style="western"><surname>Yamato</surname><given-names>J.</given-names></name>, and <name name-style="western"><surname>Felsenstein</surname><given-names>J.</given-names></name></person-group>, <year>1998</year> <article-title>Maximum likelihood estimation of population growth rates based on the coalescent.</article-title><source>Genetics</source><volume>149</volume>: <fpage>429</fpage>–<lpage>434</lpage>.<pub-id pub-id-type="pmid">9584114</pub-id></mixed-citation>
    </ref>
    <ref id="bib29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lan</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Palacios</surname><given-names>J. A.</given-names></name>, <name name-style="western"><surname>Karcher</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Minin</surname><given-names>V.</given-names></name>, and <name name-style="western"><surname>Shahbaba</surname><given-names>B.</given-names></name></person-group>, <year>2015</year> <article-title>An efficient Bayesian inference framework for coalescent-based nonparametric phylodynamics.</article-title><source>Bioinformatics</source><volume>31</volume>: <fpage>3282</fpage>–<lpage>3289</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btv378</pub-id><pub-id pub-id-type="pmid">26093147</pub-id></mixed-citation>
    </ref>
    <ref id="bib30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Li</surname><given-names>H.</given-names></name>, and <name name-style="western"><surname>Durbin</surname><given-names>R.</given-names></name></person-group>, <year>2011</year> <article-title>Inference of human population history from individual whole-genome sequences.</article-title><source>Nature</source><volume>475</volume>: <fpage>493</fpage>–<lpage>496</lpage>. <pub-id pub-id-type="doi">10.1038/nature10231</pub-id><pub-id pub-id-type="pmid">21753753</pub-id></mixed-citation>
    </ref>
    <ref id="bib31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Markovtsova</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Marjoram</surname><given-names>P.</given-names></name>, and <name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group>, <year>2000</year> <article-title>The age of a unique event polymorphism.</article-title><source>Genetics</source><volume>156</volume>: <fpage>401</fpage>–<lpage>409</lpage>.<pub-id pub-id-type="pmid">10978303</pub-id></mixed-citation>
    </ref>
    <ref id="bib32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Minin</surname><given-names>V. N.</given-names></name>, <name name-style="western"><surname>Bloomquist</surname><given-names>E. W.</given-names></name>, and <name name-style="western"><surname>Suchard</surname><given-names>M. A.</given-names></name></person-group>, <year>2008</year> <article-title>Smooth skyride through a rough skyline: Bayesian coalescent-based inference of population dynamics.</article-title><source>Mol. Biol. Evol.</source><volume>25</volume>: <fpage>1459</fpage>–<lpage>1471</lpage>. <pub-id pub-id-type="doi">10.1093/molbev/msn090</pub-id><pub-id pub-id-type="pmid">18408232</pub-id></mixed-citation>
    </ref>
    <ref id="bib33">
      <mixed-citation publication-type="book">Neal, R. M., 2011  MCMC using Hamiltonian dynamics, pp.113–162 in <italic>Handbook of Markov Chain Monte Carlo</italic>, edited by S. Brooks, A. Gelman, G. L. Jones, and X.-L. Meng. CRC Press, Boca Raton, FL.</mixed-citation>
    </ref>
    <ref id="bib34">
      <mixed-citation publication-type="confproc">Palacios, J. A., and V. N. Minin, 2012   Integrated nested Laplace approximation for Bayesian nonparametric phylodynamics, pp. 762–735 in <italic>Proceedings of the Twenty-Eighth Conference on Uncertainty in Artificial Intelligence</italic>. Association for Uncertainty in Artificial Intelligence Press, Arlington, VA.</mixed-citation>
    </ref>
    <ref id="bib35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Palacios</surname><given-names>J. A.</given-names></name>, and <name name-style="western"><surname>Minin</surname><given-names>V. N.</given-names></name></person-group>, <year>2013</year> <article-title>Gaussian process-based Bayesian nonparametric inference of population size trajectories from gene genealogies.</article-title><source>Biometrics</source><volume>69</volume>: <fpage>8</fpage>–<lpage>18</lpage>. <pub-id pub-id-type="doi">10.1111/biom.12003</pub-id><pub-id pub-id-type="pmid">23409705</pub-id></mixed-citation>
    </ref>
    <ref id="bib36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Palacios</surname><given-names>J. A.</given-names></name>, <name name-style="western"><surname>Wakeley</surname><given-names>J.</given-names></name>, and <name name-style="western"><surname>Ramachandran</surname><given-names>S.</given-names></name></person-group>, <year>2015</year> <article-title>Bayesian nonparametric inference of population size changes from sequential genealogies.</article-title><source>Genetics</source><volume>201</volume>: <fpage>281</fpage>–<lpage>304</lpage>. <pub-id pub-id-type="doi">10.1534/genetics.115.177980</pub-id><pub-id pub-id-type="pmid">26224734</pub-id></mixed-citation>
    </ref>
    <ref id="bib37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rannala</surname><given-names>B.</given-names></name>, and <name name-style="western"><surname>Yang</surname><given-names>Z.</given-names></name></person-group>, <year>2003</year> <article-title>Bayes estimation of species divergence times and ancestral population sizes using DNA sequences from multiple loci.</article-title><source>Genetics</source><volume>164</volume>: <fpage>1645</fpage>–<lpage>1656</lpage>.<pub-id pub-id-type="pmid">12930768</pub-id></mixed-citation>
    </ref>
    <ref id="bib38">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Rasmussen</surname><given-names>C. E.</given-names></name>, and <name name-style="western"><surname>Williams</surname><given-names>C. K. I.</given-names></name></person-group>, <year>2006</year> <source>Gaussian Processes for Machine Learning</source>. <publisher-name>MIT Press</publisher-name>, <publisher-loc>Cambridge, MA</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="bib39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rebolledo-Jaramillo</surname><given-names>B.</given-names></name>, <name name-style="western"><surname>Su</surname><given-names>M. S.</given-names></name>, <name name-style="western"><surname>Stoler</surname><given-names>N.</given-names></name>, <name name-style="western"><surname>McElhoe</surname><given-names>J. A.</given-names></name>, <name name-style="western"><surname>Dickins</surname><given-names>B.</given-names></name><etal/></person-group>, <year>2014</year> <article-title>Maternal age effect and severe germ-line bottleneck in the inheritance of human mitochondrial DNA.</article-title><source>Proc. Natl. Acad. Sci. USA</source><volume>111</volume>: <fpage>15474</fpage>–<lpage>15479</lpage>. <pub-id pub-id-type="doi">10.1073/pnas.1409328111</pub-id><pub-id pub-id-type="pmid">25313049</pub-id></mixed-citation>
    </ref>
    <ref id="bib40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Sainudiin</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Thornton</surname><given-names>K.</given-names></name>, <name name-style="western"><surname>Harlow</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Booth</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Stillman</surname><given-names>M.</given-names></name><etal/></person-group>, <year>2011</year> <article-title>Experiments with the site frequency spectrum.</article-title><source>Bull. Math. Biol.</source><volume>73</volume>: <fpage>829</fpage>–<lpage>872</lpage>. <pub-id pub-id-type="doi">10.1007/s11538-010-9605-5</pub-id><pub-id pub-id-type="pmid">21181503</pub-id></mixed-citation>
    </ref>
    <ref id="bib41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Sainudiin</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T.</given-names></name>, and <name name-style="western"><surname>Véber</surname><given-names>A.</given-names></name></person-group>, <year>2015</year> <article-title>Finding the best resolution for the Kingman-Tajima coalescent: theory and applications.</article-title><source>J. Math. Biol.</source><volume>70</volume>: <fpage>1207</fpage>–<lpage>1247</lpage>. <pub-id pub-id-type="doi">10.1007/s00285-014-0796-5</pub-id><pub-id pub-id-type="pmid">24825079</pub-id></mixed-citation>
    </ref>
    <ref id="bib42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Schiffels</surname><given-names>S.</given-names></name>, and <name name-style="western"><surname>Durbin</surname><given-names>R.</given-names></name></person-group>, <year>2014</year> <article-title>Inferring human population size and separation history from multiple genome sequences.</article-title><source>Nat. Genet.</source><volume>46</volume>: <fpage>919</fpage>–<lpage>925</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3015</pub-id><pub-id pub-id-type="pmid">24952747</pub-id></mixed-citation>
    </ref>
    <ref id="bib43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Schliep</surname><given-names>K. P.</given-names></name></person-group>, <year>2011</year> <article-title>phangorn: phylogenetic analysis in R.</article-title><source>Bioinformatics</source><volume>27</volume>: <fpage>592</fpage>–<lpage>593</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btq706</pub-id><pub-id pub-id-type="pmid">21169378</pub-id></mixed-citation>
    </ref>
    <ref id="bib44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Sheehan</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Harris</surname><given-names>K.</given-names></name>, and <name name-style="western"><surname>Song</surname><given-names>Y. S.</given-names></name></person-group>, <year>2013</year> <article-title>Estimating variable effective population sizes from multiple genomes: a sequentially Markov conditional sampling distribution approach.</article-title><source>Genetics</source><volume>194</volume>: <fpage>647</fpage>–<lpage>662</lpage>. <pub-id pub-id-type="doi">10.1534/genetics.112.149096</pub-id><pub-id pub-id-type="pmid">23608192</pub-id></mixed-citation>
    </ref>
    <ref id="bib45">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Slatkin</surname><given-names>M.</given-names></name>, and <name name-style="western"><surname>Hudson</surname><given-names>R.</given-names></name></person-group>, <year>1991</year> <article-title>Pairwise comparisons of mitochondrial DNA sequences in stable and exponentially growing populations.</article-title><source>Genetics</source><volume>129</volume>: <fpage>555</fpage>–<lpage>562</lpage>.<pub-id pub-id-type="pmid">1743491</pub-id></mixed-citation>
    </ref>
    <ref id="bib46">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Stephens</surname><given-names>M.</given-names></name>, and <name name-style="western"><surname>Donnelly</surname><given-names>P.</given-names></name></person-group>, <year>2000</year> <article-title>Inference in molecular population genetics.</article-title><source>J. R. Stat. Soc. Series B Stat. Methodol.</source><volume>62</volume>: <fpage>605</fpage>–<lpage>635</lpage>. <pub-id pub-id-type="doi">10.1111/1467-9868.00254</pub-id></mixed-citation>
    </ref>
    <ref id="bib47">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tajima</surname><given-names>F.</given-names></name></person-group>, <year>1983</year> <article-title>Evolutionary relationship of DNA sequences in finite populations.</article-title><source>Genetics</source><volume>105</volume>: <fpage>437</fpage>–<lpage>460</lpage>.<pub-id pub-id-type="pmid">6628982</pub-id></mixed-citation>
    </ref>
    <ref id="bib48">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name name-style="western"><surname>Tavaré</surname><given-names>S.</given-names></name></person-group>, (<year>2004</year>). <article-title>Part I: ancestral inference in population genetics,</article-title> pp <fpage>1</fpage>–<lpage>188</lpage> in <source><italic toggle="yes">Lectures on Probability Theory and Statistics</italic>, <italic toggle="yes">Volume 1837 of Lecture Notes in Mathematics</italic></source>. <publisher-name>Springer-Verlag</publisher-name>, <publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="bib49">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Terhorst</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Kamm</surname><given-names>J. A.</given-names></name>, and <name name-style="western"><surname>Song</surname><given-names>Y. S.</given-names></name></person-group>, <year>2017</year> <article-title>Robust and scalable inference of population history from hundreds of unphased whole genomes.</article-title><source>Nat. Genet.</source><volume>49</volume>: <fpage>303</fpage>–<lpage>309</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3748</pub-id><pub-id pub-id-type="pmid">28024154</pub-id></mixed-citation>
    </ref>
    <ref id="bib50">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Watterson</surname><given-names>G.</given-names></name></person-group>, <year>1975</year> <article-title>On the number of segregating sites in genetical models without recombination.</article-title><source>Theor. Popul. Biol.</source><volume>7</volume>: <fpage>256</fpage>–<lpage>276</lpage>. <pub-id pub-id-type="doi">10.1016/0040-5809(75)90020-9</pub-id><pub-id pub-id-type="pmid">1145509</pub-id></mixed-citation>
    </ref>
    <ref id="bib51">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Whidden</surname><given-names>C.</given-names></name>, and <name name-style="western"><surname>Matsen</surname><given-names>F. A.</given-names><suffix>IV</suffix></name></person-group>, <year>2015</year> <article-title>Quantifying MCMC exploration of phylogenetic tree space.</article-title><source>Syst. Biol.</source><volume>64</volume>: <fpage>472</fpage>–<lpage>491</lpage>. <pub-id pub-id-type="doi">10.1093/sysbio/syv006</pub-id><pub-id pub-id-type="pmid">25631175</pub-id></mixed-citation>
    </ref>
    <ref id="bib52">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wu</surname><given-names>Y.</given-names></name></person-group>, <year>2010</year> <article-title>Exact computation of coalescent likelihood for panmictic and subdivided populations under the infinite sites model.</article-title><source>IEEE/ACM Trans. Comput. Biol. Bioinformatics</source><volume>7</volume>: <fpage>611</fpage>–<lpage>618</lpage>. <pub-id pub-id-type="doi">10.1109/TCBB.2010.2</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
