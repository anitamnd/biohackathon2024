<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Sci Rep</journal-id>
    <journal-id journal-id-type="iso-abbrev">Sci Rep</journal-id>
    <journal-title-group>
      <journal-title>Scientific Reports</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2045-2322</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5715110</article-id>
    <article-id pub-id-type="publisher-id">17204</article-id>
    <article-id pub-id-type="doi">10.1038/s41598-017-17204-5</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>QuPath: Open source software for digital pathology image analysis</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Bankhead</surname>
          <given-names>Peter</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Loughrey</surname>
          <given-names>Maurice B.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fernández</surname>
          <given-names>José A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dombrowski</surname>
          <given-names>Yvonne</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>McArt</surname>
          <given-names>Darragh G.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9160-283X</contrib-id>
        <name>
          <surname>Dunne</surname>
          <given-names>Philip D.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>McQuaid</surname>
          <given-names>Stephen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gray</surname>
          <given-names>Ronan T.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Murray</surname>
          <given-names>Liam J.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Coleman</surname>
          <given-names>Helen G.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>James</surname>
          <given-names>Jacqueline A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Salto-Tellez</surname>
          <given-names>Manuel</given-names>
        </name>
        <address>
          <email>m.salto-tellez@qub.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Hamilton</surname>
          <given-names>Peter W.</given-names>
        </name>
        <address>
          <email>p.hamilton@qub.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0374 7521</institution-id><institution-id institution-id-type="GRID">grid.4777.3</institution-id><institution>Northern Ireland Molecular Pathology Laboratory, Centre for Cancer Research and Cell Biology, Queen’s University Belfast, </institution></institution-wrap>Belfast, Northern Ireland UK </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0000 9565 2378</institution-id><institution-id institution-id-type="GRID">grid.412915.a</institution-id><institution>Tissue Pathology, Belfast Health and Social Care Trust, Belfast, </institution></institution-wrap>Northern Ireland, Northern Ireland UK </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0374 7521</institution-id><institution-id institution-id-type="GRID">grid.4777.3</institution-id><institution>Centre for Experimental Medicine, Queen’s University Belfast, </institution></institution-wrap>Belfast, Northern Ireland UK </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0004 0374 7521</institution-id><institution-id institution-id-type="GRID">grid.4777.3</institution-id><institution>Cancer Epidemiology and Health Services Research Group, Centre for Public Health, Queen’s University Belfast, </institution></institution-wrap>Belfast, Northern Ireland UK </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>4</day>
      <month>12</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>4</day>
      <month>12</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2017</year>
    </pub-date>
    <volume>7</volume>
    <elocation-id>16878</elocation-id>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>7</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>21</day>
        <month>11</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2017</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">QuPath is new bioimage analysis software designed to meet the growing need for a user-friendly, extensible, open-source solution for digital pathology and whole slide image analysis. In addition to offering a comprehensive panel of tumor identification and high-throughput biomarker evaluation tools, QuPath provides researchers with powerful batch-processing and scripting functionality, and an extensible platform with which to develop and share new algorithms to analyze complex tissue images. Furthermore, QuPath’s flexible design makes it suitable for a wide range of additional image analysis applications across biomedical research.</p>
    </abstract>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2017</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par2">The ability to acquire high resolution digital scans of entire microscopic slides with high-resolution whole slide scanners is transforming tissue biomarker and companion diagnostic discovery through digital image analytics, automation, quantitation and objective screening of tissue samples. This area has become widely known as digital pathology<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR2">2</xref></sup>. Whole slide scanners can rapidly generate ultra-large 2D images or z-stacks in which each plane may contain up to 40 GB uncompressed data. Manual subjective scoring of this data by traditional pathologist assessment is no longer sufficient to support large-scale tissue biomarker trials, and cannot ensure the high quality, reproducible, objective analysis essential for reliable clinical correlation and candidate biomarker selection. New and powerful software tools are urgently required to ensure that pathological assessment of tissue is practical, accessible and reliable for biological discovery and the development of clinically-relevant tissue diagnostics.</p>
    <p id="Par3">In recent years, a vibrant ecosystem of open source bioimage analysis software has developed. Led by ImageJ<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, researchers in multiple disciplines can now choose from a selection of powerful tools, such as Fiji<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, Icy<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>, and CellProfiler<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, to perform their image analyses. These open source packages encourage users to engage in further development and sharing of customized analysis solutions in the form of plugins, scripts, pipelines or workflows – enhancing the quality and reproducibility of research, particularly in the fields of microscopy and high content imaging. This template for open-source development of software has provided opportunities for image analysis to add considerably to translational research by enabling the development of the bespoke analytical methods required to address specific and emerging needs, which are often beyond the scope of existing commercial applications<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. However, none of the aforementioned software applications tackle the specific visualization and computational challenges posed by whole slide images (WSI) and very large 2D data. Rather, open source tools for digital pathology to date have comprised libraries to handle digital slide formats (e.g. OpenSlide<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, Bio-Formats<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>), software to crop whole slide images into manageable tiles or perform analysis on such cropped tiles (e.g. SlideToolKit<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>, ImmunoRatio<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>), or web platforms for data management and collaborative analysis (e.g. Cytomine<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>). While each of this makes a valuable contribution, the field continues to lack a commonly-accepted, open software framework for developing and distributing novel digital pathology algorithms in a manner that is immediately accessible for any researcher or pathologist. In practice, this has meant that users without access to expensive commercial solutions have had to either resort to inefficient workarounds (such as image downsampling and cropping) to apply limited quantitative analysis using general open source analysis tools to a subset of their data<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup>, or to rely primarily on laborious manual evaluation of slides, which is known to have high variability and limited reproducibility<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref></sup>. It has also made it more difficult for computational researchers to innovate in algorithm development, and to make state-of-the-art analysis methods widely available<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>.</p>
    <p id="Par4">QuPath (<ext-link ext-link-type="uri" xlink:href="https://qupath.github.io">https://qupath.github.io</ext-link>) has been developed to address these needs by offering the first comprehensive, open source desktop software application specifically designed to analyze and explore whole slide imaging data. At its core is a cross-platform, multithreaded, tile-based whole slide image viewer, which incorporates extensive annotation and visualization tools. On top of this, QuPath offers an array of novel algorithms to provide not only ready-made, user-friendly solutions to common, challenging analysis problems in pathology, but also the building blocks to create custom workflows – and link these together for batch processing with powerful scripting functionality <bold>(</bold>Fig. <xref rid="Fig1" ref-type="fig">1</xref>
<bold>)</bold>. Finally, QuPath enables developers to add their own extensions to solve new challenges and applications, and to exchange data in a streamlined manner with existing tools that otherwise provide limited whole slide support, such as ImageJ and MATLAB.<fig id="Fig1"><label>Figure 1</label><caption><p>Illustration of QuPath’s use and functionality. (<bold>a</bold>) A typical workflow for TMA analysis (here, p53) demonstrates several of QuPath’s main features (left-to-right): Creation of a multi-slide project with automated TMA dearraying, stain estimation, cell detection and feature computation, trainable cell classification, batch processing, and survival analysis. (<bold>b</bold>) QuPath offers a wide range of additional functionality, including support for whole face tissue sections and fluorescence image analysis, data exchange with existing software and platforms (e.g. ImageJ and MATLAB), scriptable data mining, and rapid generation, visualization and export of spatial, morphological and intensity-based features.</p></caption><graphic xlink:href="41598_2017_17204_Fig1_HTML" id="d29e417"/></fig>
</p>
    <p id="Par5">A key feature underpinning QuPath’s functionality, and a major technical distinguishing factor between QuPath and other bioimaging analysis software, is its hierarchical, ‘object-based’ data model. Here, an ‘object’ refers primarily to a structure or region within the image, which may be created and manipulated by either interactive drawing tools (e.g. to annotate a particular region of interest) or automated segmentation commands (e.g. to detect individual nuclei or cells). However, in addition to representing a region of interest, objects can also be of different types (e.g. detection, annotation) and support the assignment of classifications, measurements and links to ‘parent’ and ‘child’ objects in a manner that can be rapidly queried and manipulated using built-in command or scripting. This generic model allows QuPath to represent and display relationships between very large numbers of image objects in an efficient and intuitive manner across gigapixel images, and support the fast and interactive training of object classifiers using machine learning techniques.</p>
    <p id="Par6">A practical example of this is in the evaluation of the presence, localization and intensity of expression of key diagnostic, prognostic and predictive biomarkers in tissue sections. These biomarkers are typically detected using antibodies and chromogenic based detection systems, and are selectively expressed in tumor cells or in other cellular compartments. QuPath’s built-in cell segmentation algorithms can detect potentially millions of cells as objects within a single WSI, in addition to measuring cell morphology and biomarker expression. QuPath further supports the classification of different cell types according to these features, to generate a comprehensive phenotypic description of each cell within the tissue sample. This in turn provides a quantitative cellular map of the entire tissue section, which can be subsequently selected, queried and filtered to mine the image data and uncover morphological subtleties not immediately visible during traditional pathological assessment. All of this can typically be achieved within minutes, without a requirement for specialist hardware.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results and Discussion</title>
    <p id="Par7">To demonstrate some of these capabilities, including its biological and clinical validity, we used QuPath to analyze several image sets derived from surgical resection specimens from a population-based cohort of 660 patients with stage II and stage III colon cancer, diagnosed between 2004–2008 (392 stage II, 268 stage III) and with high-quality curation of clinicopathological information. From representative paraffin-embedded tumor blocks, provided via the Northern Ireland Biobank, whole sections were haematoxylin and eosin-stained in the Northern Ireland Molecular Pathology Laboratory. Tissue microarrays (TMAs) were generated from representative 1 mm diameter tumor cores from each case, sampled in triplicate from the tumor center after annotation.</p>
    <p id="Par8">The aim was to test the performance of QuPath in the context of known and novel biological and clinical data, using cancer immunology and tumor suppressor genes as paradigms. Firstly, we applied QuPath to analyze TMAs immunohistochemically-stained (IHC) for the T cell markers CD3 and CD8. Following digital scanning of the WSI, the initial QuPath setup required importing the images, applying automated ‘dearraying’ to identify tissue cores, manually refining the resulting dearrayed grid, and removing cores unsuitable for analysis. After this step, batch analysis was applied across all TMA slides to identify the tissue within each core and automatically count the number of positive cells per mm<sup>2</sup> tissue based upon a fast peak-finding algorithm after stain separation by color deconvolution<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>, Supplementary Video <xref rid="MOESM2" ref-type="media">1</xref>). Running on a standard Mac Pro (3.5 GHz, 6-Core Intel Xeon E5, 32-GB RAM), this approach required less than 4 minutes for each biomarker to analyze 21 whole slide images, representing a total of &gt;2000 tissue cores per biomarker and counting approximately 1.2 million CD3 positive and 0.6 million CD8 positive cells, while simultaneously exporting low-resolution images of each core both with and without markup for verification. After applying a median cutoff to the exported results, a statistically significant association between disease-specific survival and positive cell density scores was demonstrated for both CD3 and CD8 (log-rank test, p-values 0.006 and 0.007 respectively; Fig. <xref rid="Fig2" ref-type="fig">2a,b</xref>). This recapitulates within our cohort the seminal work of Galon <italic>et al</italic>. in demonstrating the prognostic relevance of adaptive immunity in colorectal cancer<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, while demonstrating a highly-efficient method of investigating similar markers within other cohorts and cancer types.<fig id="Fig2"><label>Figure 2</label><caption><p>Survival analysis of colon cancer cohort based on QuPath automated image analysis. (<bold>a</bold>–<bold>d</bold>) Kaplan Meier survival analysis for biomarker scores of TMAs stained for CD3, CD8, p53 and PD-L1. Median cutoffs are applied in all cases, except p53 where two cutoffs were selected by an experienced pathologist to distinguish between aberrant negative, “wild type” (normal) and aberrant positive groups. Representative images showing an original core and QuPath markup image are included below. (<bold>e</bold>) Kaplan Meier curve showing patient stratification based on median tumor stromal percentage. Representative images show the original images and markup for tumors with a high and low stromal percentage respectively. Green indicates regions classified as stroma, dark red indicates tumor epithelium, while yellow represents other classified tissue or whitespace.</p></caption><graphic xlink:href="41598_2017_17204_Fig2_HTML" id="d29e471"/></fig>
</p>
    <p id="Par9">Next, we used QuPath to evaluate immunohistochemistry for p53 in a second set of TMAs from the same cohort. This required a more sophisticated analysis to encompass the biological understanding and staining pattern of the marker. After applying QuPath’s cell detection algorithm to segment and measure cells within each core, a random trees classifier<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> was interactively trained to enable p53 expression to be scored selectively within the epithelial cell population according to nuclear staining intensity and proportion (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>, Supplementary Video <xref rid="MOESM3" ref-type="media">2</xref>). This analysis showed that aberrant p53 expression (diffuse intense or completely absent immunoreactivity) is associated with significantly poorer unadjusted disease-specific survival when compared with intermediate, ‘wild-type’ expression (p = 0.003 extreme negative/positive vs. intermediate; Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Despite the well-established role of TP53 in colorectal cancer carcinogenesis, results from prognostic studies assessing p53 IHC expression have been inconsistent<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>. However, the extreme negative pattern of aberrant p53 immunoreactivity has only been described relatively recently<sup><xref ref-type="bibr" rid="CR21">21</xref>,<xref ref-type="bibr" rid="CR22">22</xref></sup> and has not been widely assessed in colorectal cancer cohorts. This example therefore emphasises the flexibility of the QuPath open source platform in measuring common IHC markers with variable tumor expression patterns, and demonstrates how the relationship between quantitative cellular analysis and clinical outcome can be robustly assessed.</p>
    <p id="Par10">We then applied QuPath to the analysis of programmed cell death ligand 1 (PD-L1) immunoexpression in the same TMA cohort. PD-L1 immunoexpression is a prognostic marker in a range of cancer types and also a predictor of response to immune checkpoint therapy in some cancers<sup><xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR24">24</xref></sup>. However, there is a lack of consensus on the epitopes of clinical relevance and, more importantly, the optimal scoring systems for evaluation. The approach to analysis was similar in principle to that adopted for p53, however further attention was required because of additional challenges posed by PD-L1 immunostaining. Firstly, staining is cytoplasmic and/or membranous rather than nuclear. Secondly, PD-L1 can be expressed in tumor epithelium, but is more commonly expressed in other tissue compartments, notably within peritumoral stromal inflammatory cells. Although this level of heterogeneity in staining pattern is increasingly being recognised, the clinical importance of distinguishing tumor epithelial from inflammatory cell staining is yet to be fully understood. Sufficient cell classification is therefore required to identify both positively and negatively staining tumor (epithelial) and non-tumor cell populations, in addition to distinguishing true protein expression levels from the various staining artefacts that are inherent with IHC-based tissue analysis. Here, applying QuPath, a cell was classified as positive or negative based on maximal DAB staining intensity, as a surrogate marker of protein expression, within a full cell region approximated by expanding detected nuclei (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>). The percentage of all cells exhibiting PD-L1 positivity was calculated for each TMA core to give a summary PD-L1 score for that core. A median cutoff of 1.46% positive cells was determined from across the cohort to stratify patients, showing higher PD-L1 expression to be significantly associated with improved disease-specific survival in unadjusted analysis (p = 0.004, Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). Additionally, an analysis based on tertiles exhibited a dose-response effect, and separation of the tumor (epithelial) and non-epithelial components suggested that PD-L1 expression in colon cancer tissue is primarily found in the non-epithelial compartment (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4</xref>). These results support the incipient evidence of PD-L1 prognostic value in colorectal cancer reported by ourselves and others in independent cohorts<sup><xref ref-type="bibr" rid="CR24">24</xref>–<xref ref-type="bibr" rid="CR26">26</xref></sup>, and may be of help when used together with tumor microsatellite instability status for patient stratification in consideration of anti-PD-L1 therapy.</p>
    <p id="Par11">Finally, to demonstrate QuPath’s flexibility beyond IHC scoring in TMAs, we applied texture-based analysis to calculate the tumor stromal percentage in whole face representative tumor sections stained with hematoxylin and eosin (H&amp;E) from 312 patients with stage II colon cancer from the same cohort. Several studies have reported that a higher intratumoral stromal percentage correlates with a worse prognosis in patients with stage II and stage III colorectal cancer<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup>. Given highly variable clinical outcomes within stage II disease, there is a particular need for additional prognostic features in this group, to identify those patients most likely to benefit from adjuvant chemotherapy. These studies employed a crude visual estimate of tumor stromal percentage. Applying QuPath’s more fine-grained and reproducible assessment, and a median cutoff for analysis, we found lower disease-specific survival among patients with a high tumor stromal percentage in unadjusted analysis (p = 0.013; Fig. <xref rid="Fig2" ref-type="fig">2e</xref>
<bold>)</bold>, consistent with previous findings<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR28">28</xref></sup>.</p>
    <p id="Par12">In summary, QuPath represents a uniquely comprehensive, user-friendly, open source bioimage analysis platform designed for whole slide images. We have demonstrated that it provides the tools necessary for fast, accurate and reproducible digital pathology analysis across a range of challenging applications. All of the above represent analyses that are cumbersome and time-consuming for pathologists to perform manually, given that they depend upon the accurate visual estimation of proportional staining within large numbers of stained cells, or of proportional composition of complex tissue areas. Accurate assessment is particularly difficult when the clinically relevant cutoff is very low and expression very localized (e.g. PD-L1), requiring detailed examination and precision. Such precise analyses are becoming increasingly necessary and important, both clinically in the era of personalized medicine, and in a research context for high-throughput evaluation of novel biomarkers. By offering an extensible environment for pathologists, biologists, and computer scientists to build highly performant algorithms for image interpretation and analysis, there is potential to drive adoption of quantitative imaging in academic, diagnostic and pharmaceutical research organizations, and to accelerate biomarker discovery in large scale multinational clinical trials. This is an absolute requirement to ensure a return on the global investment made in companion diagnostics for precision medicine.</p>
  </sec>
  <sec id="Sec3" sec-type="materials|methods">
    <title>Materials and Methods</title>
    <sec id="Sec4">
      <title>Cohort</title>
      <p id="Par13">This analysis was based on a population-based cohort of 660 stage II/III colon adenocarcinoma patients, representing 89% of all patients undergoing surgery for stage II/III colon adenocarcinoma in two Healthcare Trusts in Northern Ireland between 2004 and 2008. Patients were sampled and clinical information obtained from the Northern Ireland Cancer Registry. All patients were followed up for occurrence and cause of death via linkage to the Northern Ireland Registrar General’s Office up to 31<sup>st</sup> December 2013. Ethical approval for these linkages was given by ORECNI (REC: 10/NIR02/53). Over ten years (and a mean of 5 years) of clinical follow-up, 46% of patients had died, of which 38% were from CRC-specific causes. Corresponding tumor slides and blocks were retrieved and collated via the Northern Ireland Biobank which has ethical approval to use de-identified tissue samples from the Belfast Health and Social Care Tissue Pathology archive (REC:11/NI/0013).</p>
      <p id="Par14">This study was conducted in accordance to REporting recommendations for tumour MARKer prognostic studies (REMARK)<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. The reporting standards of the current study fulfill these recommendations.</p>
      <p id="Par15">Following slide review, a new section was cut for H&amp;E staining from a single representative tumor block in each case, and the new slides annotated for tissue microarray (TMA) construction. Three representative areas within the tumor center of each block were annotated for targeted coring (by an experienced biomedical scientist and confirmed by expert pathologists, MBL and JAJ). One millimeter diameter tissue cores were extracted from donor blocks and inserted into recipient blocks using a manual tissue arrayer (Estigen, Tartu, Estonia).</p>
    </sec>
    <sec id="Sec5">
      <title>Immunohistochemistry</title>
      <p id="Par16">All IHC was performed in a hybrid laboratory (Northern Ireland Molecular Pathology Laboratory) that has UK Clinical Pathology Accreditation. Internally validated biomarker conditions, which followed UK-NEQAS guidelines (CD3 and CD8) or were based on expected performance from the literature (p53 and PD-L1), were as follows: CD3 (clone 2GV6 Ventana BenchMark; CC1 32 minutes, Optiview detection), CD8 (clone c8/144B, Dako: Leica Bond III, ER2 20 mins, 1/50, polymer detection), p53 (clone DO-7, Dako, ER2 30 mins, 1/100, polymer detection), PD-L1 (clone SP142, Ventana BenchMark, CC1 24 mins, optiview detection).</p>
    </sec>
    <sec id="Sec6">
      <title>Image data acquisition</title>
      <p id="Par17">All TMA slides were scanned using an Aperio ScanScope CS whole slide scanner at 40X magnification, with a resolution of 0.25 μm/pixel. H&amp;E slide scanning was heterogenous: 231 were scanned on the Aperio ScanScope scanner, while 81 were scanned on a Hamamatsu Nanozoomer. The resolution of all images was within the range 0.231–0.253 μm/pixel.</p>
    </sec>
    <sec id="Sec7">
      <title>Software</title>
      <p id="Par18">QuPath was written as a novel, cross-platform Java application. The core software was developed using Java 8, with a user interface written using JavaFX. Whole slide image reading made use of QuPath’s interfaces to the OpenSlide library<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, while the implementations of QuPath’s cell detection and superpixel segmentation commands made use of ImageJ as a library for standard image processing operations<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. The random trees classifier and fast cell counting were implemented using the OpenCV library (<ext-link ext-link-type="uri" xlink:href="http://opencv.org">http://opencv.org</ext-link>). The analysis for this study was performed on a Mac Pro (3.5 GHz, 6-Core Intel Xeon E5, 32-GB RAM).</p>
    </sec>
    <sec id="Sec8">
      <title>Code availability</title>
      <p id="Par19">Source code and documentation for QuPath are available at <ext-link ext-link-type="uri" xlink:href="https://qupath.github.io">https://qupath.github.io</ext-link>.</p>
    </sec>
    <sec id="Sec9">
      <title>Statistical analysis</title>
      <p id="Par20">Survival curves using the Kaplan Meier method were generated and log-rank tests applied using the <italic>TMA data viewer</italic> within QuPath, and independently verified using R (version 3.2.2)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> with the ‘Survival’ package (version 2.38–3)<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. For the calculation of disease-specific survival, deaths from other causes were treated as censored events. Median cutoff values were used in all cases, except for p53 where an experienced pathologist (MBL) selected two biologically-plausible cutoffs (H-scores 10 and 160) to separate extreme positive and extreme negative cases from those with intermediate (‘wild-type’) expression, based upon viewing all TMA cores post-analysis ranked by H-score. Stratification based on tertiles is also provided in the Supplementary Materials for PD-L1.</p>
      <p id="Par21">For TMA analysis, up to three tissue cores were available from each tumor, all selected from the same paraffin block representing the central tumor region. A single patient biomarker score was defined as the median of all available scores for the corresponding patient and biomarker. The median was chosen to aid the robustness of the measurement in a high-throughput setting, and reduce the likelihood of basing the score for any individual patient on an outlier that may have been caused by a tissue or staining artefact.</p>
    </sec>
    <sec id="Sec10">
      <title>Tissue microarray preprocessing</title>
      <p id="Par22">Separate projects were created within QuPath for each biomarker, and the slide images imported to the corresponding projects. QuPath’s automated <italic>TMA dearrayer</italic> was applied in batch over all slides within each project to identify tissue cores. The resulting TMA grid was manually verified and amended where necessary, e.g. to adjust the locations of cores that were outside their expected position, or to remove cores where prominent artefacts were visible. Patient identifiers were then imported into QuPath for each core to assist alignment with survival data later. Additionally, stain vector (i.e. color) and background estimates were applied for each IHC analysis project to improve stain separation within QuPath using color deconvolution<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. This was achieved by selecting a representative area containing an area of background along with examples of strong hematoxylin and DAB staining, and applying QuPath’s <italic>Estimate stain vectors</italic> command to identify stain vectors within this region. The resulting vectors were then used for all images in the project.</p>
    </sec>
    <sec id="Sec11">
      <title>Analysis of CD3 and CD8 IHC</title>
      <p id="Par23">After the initial TMA preprocessing steps described above, analysis of CD3 and CD8 was performed using QuPath’s <italic>Simple tissue detection</italic> and <italic>Fast cell counts</italic> commands. Briefly, tissue was detected within each TMA core by thresholding a downsampled and smoothed image of the core, followed by cleanup of the resulting binary image by morphological operations. Individual cells were identified by separating stains using color deconvolution and identifying peaks in either the hematoxylin channel (CD3) or sum of the hematoxylin and DAB channels (CD8) after smoothing, and assigning these as positive or negative cells based upon the smoothed DAB channel information. The number of positive cells and area detected were used to calculate the average number of positive cells per mm<sup>2</sup>, and these results exported along with markup images showing the detected cells, for visual verification. The detection and export steps were fully automated using a batch processing script.</p>
    </sec>
    <sec id="Sec12">
      <title>Analysis of p53 IHC</title>
      <p id="Par24">Preprocessing steps were applied as described above. QuPath’s <italic>Cell detection</italic> command was then used to identify cells across all cores based upon nuclear staining. This command additionally estimates the full extent of each cell based upon a constrained expansion of the nucleus region, and calculates up to 33 measurements of intensity and morphology, including nucleus area, circularity, staining intensity for hematoxylin and DAB, and nucleus/cell area ratio. Because not all of these measurements are expected to provide independent or useful information with regard to cell classification, a subset of 16 measurements was chosen empirically and supplemented for each cell by measuring the local density of cells, and taking a Gaussian-weighted sum of the corresponding measurements within neighboring cells using QuPath’s <italic>Add smoothed features</italic> command. A two-way random trees classifier was then interactively trained to distinguish tumor epithelial cells from all other detections (comprising non-epithelial cells, necrosis, or any artefacts misidentified as cells) and applied across all slides (see Supplementary Video <xref rid="MOESM3" ref-type="media">2</xref>). Intensity thresholds were set to further subclassify tumor cells as being negative, weak, moderate or strongly positive for p53 staining based upon mean nuclear DAB optical densities. An H-score was calculated for each tissue core by adding 3x% strongly stained tumor nuclei, 2x% moderately stained tumor nuclei, and 1x% weakly stained tumor nuclei<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, giving results in the range 0 (all tumor nuclei negative) to 300 (all tumor nuclei strongly positive).</p>
    </sec>
    <sec id="Sec13">
      <title>Analysis of PD-L1 IHC</title>
      <p id="Par25">The approach to scoring PD-L1 was similar to p53, apart from the following: 1) a three-way random trees classifier was trained to distinguish between epithelial, non-epithelial and ‘other’ detections (including artefacts and necrosis); 2) cells were classified as positive or negative based upon a single intensity threshold applied to the maximum DAB optical density within the full cell area, and 3) summary scores were generated as the percentage of cells classified as positive, with ‘other’ detections removed.</p>
    </sec>
    <sec id="Sec14">
      <title>Analysis of tumor stromal percentage in H&amp;E whole face sections</title>
      <p id="Par26">Representative tumor regions were annotated across all 312 H&amp;E-stained slides by an experienced pathologist (MBL) using QuPath’s manual annotation tools. A script was then applied in batch to automatically identify and set the average background intensity for the red, green and blue channels of each image, which varied markedly according to the scanner used. A second script was then run over all images to apply QuPath’s <italic>SLIC superpixel segmentation</italic> command to subdivide each annotated region into ‘superpixels’ based upon simple linear iterative clustering<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. This script additionally calculated both the average hue for each superpixel along with Haralick texture features<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> from optical density values using QuPath’s <italic>Add intensity features</italic> command. QuPath’s <italic>Add smoothed features</italic> command was also applied to calculate a Gaussian-weighted sum of the features of neighboring superpixels, and append these to the existing features for each superpixel. This provide additional contextual information extending beyond the superpixel itself.</p>
      <p id="Par27">A subset of 40 ‘training’ images was then identified for the pathologist to interactively train a random trees classifier to distinguish between tissue areas comprising tumor epithelium, stroma and ‘other’ (e.g. whitespace, mucin, normal muscle or necrosis). This required drawing around regions containing tissue of each class and annotating these accordingly. During this process, QuPath used all available features to train the classifier in a background process and thereby provide immediate feedback on classification performance. Once the classification was considered adequate across the training images, the classifier was applied to all images within the set and the total area of superpixels for each class was exported. The tumor stromal percentage (TSP) was then calculated as<disp-formula id="Equ1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\rm{TSP}}={\rm{AS}}/({\rm{AE}}+{\rm{AS}})\times 100\, \% $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mi mathvariant="normal">TSP</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">AS</mml:mi><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">AE</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">AS</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mn>100</mml:mn><mml:mspace width=".25em"/><mml:mo>%</mml:mo></mml:math><graphic xlink:href="41598_2017_17204_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>
</p>
      <p id="Par28">where AS represents the total area classified as stroma, and AE represents the total area classified as epithelium.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Electronic supplementary material</title>
    <sec id="Sec15">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41598_2017_17204_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41598_2017_17204_MOESM2_ESM.mov">
            <caption>
              <p>Supplementary Video 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41598_2017_17204_MOESM3_ESM.mov">
            <caption>
              <p>Supplementary Video 2</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Electronic supplementary material</bold>
      </p>
      <p><bold>Supplementary information</bold> accompanies this paper at 10.1038/s41598-017-17204-5.</p>
    </fn>
    <fn>
      <p><bold>Publisher's note:</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>The research leading to these results has received funding from Invest Northern Ireland (RDO0712612 to P.W.H.); Cancer Research UK Accelerator (C11512/A20256 to P.W.H./M.S.-T./J.A.J). The Northern Ireland Molecular Pathology Laboratory is supported by Cancer Research UK, Experimental Cancer Medicine Centre Network, the NI Health and Social Care Research and Development Division, the Sean Crummey Memorial Fund, the Tom Simms Memorial Fund and the Friends of the Cancer Centre (to M.S.-T.). The Northern Ireland Biobank is funded by the Health and Social Care Research and Development Division of the Public Health Agency in Northern Ireland and Cancer Research UK (to J.A.J/P.W.H/S.McQ ref. SPI/5069/14; additional support was received from the Friends of the Cancer Centre (to J.A.J./P.W.H/M.B.L). The cohort was supported by Cancer Research UK (ref. C37703/A15333 and ref. C50104/A17592) and the HSC R&amp;D office of Northern Ireland (ref. EAT/4905/13). The Northern Ireland Cancer Registry is funded by the NI Public Health Agency. We thank Mr Ken Arthur for the construction of the original tissue microarrays used in this study, Ms Victoria Bingham for her work in staining and scanning the slides, and both Dr Roisin O’Neill and the Northern Ireland Cancer Registry for their contributions to the clinical data collation.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author Contributions</title>
    <p>P.B. designed and developed the software. Feedback and testing of the software was provided by J.A.F., Y.D., D.G.M., P.W.H., P.D.D. and M.B.L. Before scanning and image analysis the expected expression of the biomarkers on tissue sections was initially assessed microscopically as fit-for-purpose by a team of experienced histopathologists M.S.-T., S.Mc.Q., J.A.J. Experiments were designed by P.B., M.B.L., M.S.-T. and P.W.H. and performed by P.B. and M.B.L. Data was analyzed by P.B., J.A.F. and H.G.C. Manuscript was written by PB with contributions from all authors.</p>
  </notes>
  <notes notes-type="COI-statement">
    <sec id="FPar1">
      <title>Competing Interests</title>
      <p id="Par29">The authors declare that they have no competing interests.</p>
    </sec>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pantanowitz</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Review of the current state of whole slide imaging in pathology</article-title>
        <source>J. Pathol. Inform.</source>
        <year>2011</year>
        <volume>2</volume>
        <fpage>36</fpage>
        <pub-id pub-id-type="doi">10.4103/2153-3539.83746</pub-id>
        <?supplied-pmid 21886892?>
        <pub-id pub-id-type="pmid">21886892</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hamilton</surname>
            <given-names>PW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Digital pathology and image analysis in tissue biomarker research</article-title>
        <source>Methods</source>
        <year>2014</year>
        <volume>70</volume>
        <fpage>59</fpage>
        <lpage>73</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ymeth.2014.06.015</pub-id>
        <?supplied-pmid 25034370?>
        <pub-id pub-id-type="pmid">25034370</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schneider</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Rasband</surname>
            <given-names>WS</given-names>
          </name>
          <name>
            <surname>Eliceiri</surname>
            <given-names>KW</given-names>
          </name>
        </person-group>
        <article-title>NIH Image to ImageJ: 25 years of image analysis</article-title>
        <source>Nat. Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>671</fpage>
        <lpage>675</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2089</pub-id>
        <?supplied-pmid 22930834?>
        <pub-id pub-id-type="pmid">22930834</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schindelin</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fiji: an open-source platform for biological-image analysis</article-title>
        <source>Nat. Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>676</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2019</pub-id>
        <?supplied-pmid 22743772?>
        <pub-id pub-id-type="pmid">22743772</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>de Chaumont</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Icy: an open bioimage informatics platform for extended reproducible research</article-title>
        <source>Nat. Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>690</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2075</pub-id>
        <?supplied-pmid 22743774?>
        <pub-id pub-id-type="pmid">22743774</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lamprecht</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Sabatini</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Carpenter</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>CellProfiler<sup>TM</sup>: free, versatile software for automated biological image analysis</article-title>
        <source>Biotechniques</source>
        <year>2007</year>
        <volume>42</volume>
        <fpage>71</fpage>
        <lpage>75</lpage>
        <pub-id pub-id-type="doi">10.2144/000112257</pub-id>
        <?supplied-pmid 17269487?>
        <pub-id pub-id-type="pmid">17269487</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Carpenter</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Kamentsky</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Eliceiri</surname>
            <given-names>KW</given-names>
          </name>
        </person-group>
        <article-title>A call for bioimaging software usability</article-title>
        <source>Nat. Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>666</fpage>
        <lpage>70</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2073</pub-id>
        <?supplied-pmid 22743771?>
        <pub-id pub-id-type="pmid">22743771</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satyanarayanan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Goode</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Gilbert</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Harkes</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Jukic</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>OpenSlide: A vendor-neutral software foundation for digital pathology</article-title>
        <source>J. Pathol. Inform.</source>
        <year>2013</year>
        <volume>4</volume>
        <fpage>27</fpage>
        <pub-id pub-id-type="doi">10.4103/2153-3539.119005</pub-id>
        <?supplied-pmid 24244884?>
        <pub-id pub-id-type="pmid">24244884</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Linkert</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metadata matters: access to image data in the real world</article-title>
        <source>J. Cell Biol.</source>
        <year>2010</year>
        <volume>189</volume>
        <fpage>777</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="doi">10.1083/jcb.201004104</pub-id>
        <?supplied-pmid 20513764?>
        <pub-id pub-id-type="pmid">20513764</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nelissen</surname>
            <given-names>BGL</given-names>
          </name>
          <name>
            <surname>van Herwaarden</surname>
            <given-names>Ja</given-names>
          </name>
          <name>
            <surname>Moll</surname>
            <given-names>FL</given-names>
          </name>
          <name>
            <surname>van Diest</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Pasterkamp</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>SlideToolkit: An Assistive Toolset for the Histological Quantification of Whole Slide Images</article-title>
        <source>PLoS One</source>
        <year>2014</year>
        <volume>9</volume>
        <fpage>e110289</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0110289</pub-id>
        <?supplied-pmid 25372389?>
        <pub-id pub-id-type="pmid">25372389</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tuominen</surname>
            <given-names>VJ</given-names>
          </name>
          <name>
            <surname>Ruotoistenmäki</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Viitanen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Jumppanen</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Isola</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>ImmunoRatio: a publicly available web application for quantitative image analysis of estrogen receptor (ER), progesterone receptor (PR), and Ki-67</article-title>
        <source>Breast Cancer Res.</source>
        <year>2010</year>
        <volume>12</volume>
        <fpage>R56</fpage>
        <pub-id pub-id-type="doi">10.1186/bcr2615</pub-id>
        <?supplied-pmid 20663194?>
        <pub-id pub-id-type="pmid">20663194</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marée</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Collaborative analysis of multi-gigapixel imaging data using Cytomine</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <fpage>1395</fpage>
        <lpage>1401</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw013</pub-id>
        <?supplied-pmid 26755625?>
        <pub-id pub-id-type="pmid">26755625</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Deroulers</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Analyzing huge pathology images with open source software</article-title>
        <source>Diagn. Pathol.</source>
        <year>2013</year>
        <volume>8</volume>
        <fpage>92</fpage>
        <pub-id pub-id-type="doi">10.1186/1746-1596-8-92</pub-id>
        <?supplied-pmid 23829479?>
        <pub-id pub-id-type="pmid">23829479</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Hamilton, P. W., Diest, P. J. Van, Williams, R. &amp; Gallagher, A. G. Do we see what we think we see? The complexities of morphological assessment. 285–291, 10.1002/path (2009).</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Polley</surname>
            <given-names>M-YC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An international Ki67 reproducibility study</article-title>
        <source>J. Natl. Cancer Inst.</source>
        <year>2013</year>
        <volume>105</volume>
        <fpage>1897</fpage>
        <lpage>906</lpage>
        <pub-id pub-id-type="doi">10.1093/jnci/djt306</pub-id>
        <?supplied-pmid 24203987?>
        <pub-id pub-id-type="pmid">24203987</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heindl</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Nawaz</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Mapping spatial heterogeneity in the tumor microenvironment: a new era for digital pathology</article-title>
        <source>Lab. Investig.</source>
        <year>2015</year>
        <volume>95</volume>
        <fpage>377</fpage>
        <lpage>384</lpage>
        <pub-id pub-id-type="doi">10.1038/labinvest.2014.155</pub-id>
        <?supplied-pmid 25599534?>
        <pub-id pub-id-type="pmid">25599534</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ruifrok</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Johnston</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Quantification of histochemical staining by color deconvolution</article-title>
        <source>Anal Quant Cytol Histol.</source>
        <year>2001</year>
        <volume>23</volume>
        <fpage>291</fpage>
        <lpage>9</lpage>
        <?supplied-pmid 11531144?>
        <pub-id pub-id-type="pmid">11531144</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Galon</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Type, density, and location of immune cells within human colorectal tumors predict clinical outcome</article-title>
        <source>Science</source>
        <year>2006</year>
        <volume>313</volume>
        <fpage>1960</fpage>
        <lpage>4</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1129139</pub-id>
        <?supplied-pmid 17008531?>
        <pub-id pub-id-type="pmid">17008531</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Breiman</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Random forests</article-title>
        <source>Mach. Learn.</source>
        <year>2001</year>
        <volume>45</volume>
        <fpage>5</fpage>
        <lpage>32</lpage>
        <pub-id pub-id-type="doi">10.1023/A:1010933404324</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Munro</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Lain</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lane</surname>
            <given-names>DP</given-names>
          </name>
        </person-group>
        <article-title>P53 abnormalities and outcomes in colorectal cancer: a systematic review</article-title>
        <source>Br. J. Cancer</source>
        <year>2005</year>
        <volume>92</volume>
        <fpage>434</fpage>
        <lpage>44</lpage>
        <pub-id pub-id-type="doi">10.1038/sj.bjc.6602358</pub-id>
        <?supplied-pmid 15668707?>
        <pub-id pub-id-type="pmid">15668707</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McCluggage</surname>
            <given-names>WG</given-names>
          </name>
          <name>
            <surname>Soslow</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Gilks</surname>
            <given-names>CB</given-names>
          </name>
        </person-group>
        <article-title>Patterns of p53 immunoreactivity in endometrial carcinomas: ‘all or nothing’ staining is of importance</article-title>
        <source>Histopathology</source>
        <year>2011</year>
        <volume>59</volume>
        <fpage>786</fpage>
        <lpage>788</lpage>
        <pub-id pub-id-type="doi">10.1111/j.1365-2559.2011.03907.x</pub-id>
        <?supplied-pmid 21864317?>
        <pub-id pub-id-type="pmid">21864317</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Boyle</surname>
            <given-names>DP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The prognostic significance of the aberrant extremes of p53 immunophenotypes in breast cancer</article-title>
        <source>Histopathology</source>
        <year>2014</year>
        <volume>65</volume>
        <fpage>1</fpage>
        <lpage>13</lpage>
        <pub-id pub-id-type="doi">10.1111/his.12398</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Garon</surname>
            <given-names>EB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Pembrolizumab for the treatment of non-small-cell lung cancer</article-title>
        <source>N. Engl. J. Med.</source>
        <year>2015</year>
        <volume>372</volume>
        <fpage>2018</fpage>
        <lpage>28</lpage>
        <pub-id pub-id-type="doi">10.1056/NEJMoa1501824</pub-id>
        <?supplied-pmid 25891174?>
        <pub-id pub-id-type="pmid">25891174</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Pyo, J.-S., Kang, G. &amp; Kim, J. Y. Prognostic role of PD-L1 in malignant solid tumors: a meta-analysis. <italic>Int. J. Biol. Markers</italic> 0, 10.5301/JBM.2016.16048 (2016).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Dunne, P. D. <italic>et al</italic>. Immune-derived PD-L1 gene expression defines a subgroup of stage II/III colorectal cancer patients with favorable prognosis that may be harmed by adjuvant chemotherapy. <italic>Cancer Immunol. Res</italic>. 1–11, 10.1158/2326-6066.CIR-15-0302 (2016).</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>LH</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Patterns and prognostic relevance of PD-1 and PD-L1 expression in colorectal carcinoma</article-title>
        <source>Mod. Pathol.</source>
        <year>2016</year>
        <volume>29</volume>
        <fpage>1433</fpage>
        <lpage>1442</lpage>
        <pub-id pub-id-type="doi">10.1038/modpathol.2016.139</pub-id>
        <?supplied-pmid 27443512?>
        <pub-id pub-id-type="pmid">27443512</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huijbers</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The proportion of tumor-stroma as a strong prognosticator for stage II and III colon cancer patients: Validation in the victor trial</article-title>
        <source>Ann. Oncol.</source>
        <year>2013</year>
        <volume>24</volume>
        <fpage>179</fpage>
        <lpage>185</lpage>
        <pub-id pub-id-type="doi">10.1093/annonc/mds246</pub-id>
        <?supplied-pmid 22865778?>
        <pub-id pub-id-type="pmid">22865778</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mesker</surname>
            <given-names>WE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The carcinoma-stromal ratio of colon carcinoma is an independent factor for survival compared to lymph node status and tumor stage</article-title>
        <source>Cell Oncol</source>
        <year>2007</year>
        <volume>29</volume>
        <fpage>387</fpage>
        <lpage>398</lpage>
        <?supplied-pmid 17726261?>
        <pub-id pub-id-type="pmid">17726261</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Altman</surname>
            <given-names>DG</given-names>
          </name>
          <name>
            <surname>McShane</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Sauerbrei</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Taube</surname>
            <given-names>SE</given-names>
          </name>
        </person-group>
        <article-title>Reporting Recommendations for Tumour Marker Prognostic studies (REMARK): Explanation and Elaboration</article-title>
        <source>PLOS Med.</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>1</fpage>
        <lpage>32</lpage>
        <pub-id pub-id-type="doi">10.1371/journal.pmed.1001216</pub-id>
        <?supplied-pmid 22629234?>
        <pub-id pub-id-type="pmid">22629234</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">R Core Team. R: A Language and Environment for Statistical Computing. at <ext-link ext-link-type="uri" xlink:href="https://www.r-project.org/">https://www.r-project.org/</ext-link> (2016).</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Therneau, T. M. A Package for Survival Analysis in S. at <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=survival">https://cran.r-project.org/package=survival</ext-link> (2015).</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Goulding</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A new immunohistochemical antibody for the assessment of estrogen receptor status on routine formalin-fixed tissue samples</article-title>
        <source>Hum. Pathol.</source>
        <year>1995</year>
        <volume>26</volume>
        <fpage>291</fpage>
        <lpage>294</lpage>
        <pub-id pub-id-type="doi">10.1016/0046-8177(95)90060-8</pub-id>
        <?supplied-pmid 7890280?>
        <pub-id pub-id-type="pmid">7890280</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Achanta</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SLIC Superpixels Compared to State-of-the-Art SuperpixelMethods</article-title>
        <source>Pattern Anal. Mach. Intell. IEEE Trans.</source>
        <year>2011</year>
        <volume>34</volume>
        <fpage>2274</fpage>
        <lpage>2282</lpage>
        <pub-id pub-id-type="doi">10.1109/TPAMI.2012.120</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haralick</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Shanmugam</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Dinstein</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Textural Features for Image Classification</article-title>
        <source>IEEE Trans. Syst. Man. Cybern</source>
        <year>1973</year>
      </element-citation>
    </ref>
  </ref-list>
</back>
