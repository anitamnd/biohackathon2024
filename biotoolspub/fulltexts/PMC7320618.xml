<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7320618</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btaa249</article-id>
    <article-id pub-id-type="publisher-id">btaa249</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Serpentine: a flexible 2D binning method for differential Hi-C analysis</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Baudry</surname>
          <given-names>Lyam</given-names>
        </name>
        <xref ref-type="aff" rid="btaa249-aff1">b1</xref>
        <xref ref-type="aff" rid="btaa249-aff2">b2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Millot</surname>
          <given-names>Gaël A</given-names>
        </name>
        <xref ref-type="aff" rid="btaa249-aff3">b3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Thierry</surname>
          <given-names>Agnes</given-names>
        </name>
        <xref ref-type="aff" rid="btaa249-aff1">b1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0002-3086-1173</contrib-id>
        <name>
          <surname>Koszul</surname>
          <given-names>Romain</given-names>
        </name>
        <xref ref-type="corresp" rid="btaa249-cor1"/>
        <xref ref-type="aff" rid="btaa249-aff1">b1</xref>
        <!--<email>romain.koszul@pasteur.fr</email>-->
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-3490-0579</contrib-id>
        <name>
          <surname>Scolari</surname>
          <given-names>Vittore F</given-names>
        </name>
        <xref ref-type="corresp" rid="btaa249-cor1"/>
        <xref ref-type="aff" rid="btaa249-aff1">b1</xref>
        <!--<email>romain.koszul@pasteur.fr</email>-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Valencia</surname>
          <given-names>Alfonso</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="btaa249-aff1"><label>b1</label><institution>Institut Pasteur</institution>, Unité Régulation Spatiale des Génomes, UMR3525 CNRS, Paris 75015, <country country="FR">France</country></aff>
    <aff id="btaa249-aff2"><label>b2</label><institution>Sorbonne Université</institution>, Collège Doctoral, Paris 75005, <country country="FR">France</country></aff>
    <aff id="btaa249-aff3"><label>b3</label><institution>Département Biologie Computationnelle</institution>, Hub de Bioinformatique et Biostatistique, Institut Pasteur, USR 3756 CNRS, Paris 75015, <country country="FR">France</country></aff>
    <author-notes>
      <corresp id="btaa249-cor1">To whom correspondence should be addressed. <email>romain.koszul@pasteur.fr</email> or <email>vittore.scolari@curie.fr</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>6</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2020-04-20">
      <day>20</day>
      <month>4</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>4</month>
      <year>2020</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>36</volume>
    <issue>12</issue>
    <fpage>3645</fpage>
    <lpage>3651</lpage>
    <history>
      <date date-type="received">
        <day>25</day>
        <month>4</month>
        <year>2019</year>
      </date>
      <date date-type="rev-recd">
        <day>24</day>
        <month>3</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>17</day>
        <month>4</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btaa249.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Hi-C contact maps reflect the relative contact frequencies between pairs of genomic loci, quantified through deep sequencing. Differential analyses of these maps enable downstream biological interpretations. However, the multi-fractal nature of the chromatin polymer inside the cellular envelope results in contact frequency values spanning several orders of magnitude: contacts between loci pairs separated by large genomic distances are much sparser than closer pairs. The same is true for poorly covered regions, such as repeated sequences. Both distant and poorly covered regions translate into low signal-to-noise ratios. There is no clear consensus to address this limitation.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We present Serpentine, a fast, flexible procedure operating on raw data, which considers the contacts in each region of a contact map. Binning is performed only when necessary on noisy regions, preserving informative ones. This results in high-quality, low-noise contact maps that can be conveniently visualized for rigorous comparative analyses.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>Serpentine is available on the PyPI repository and <ext-link ext-link-type="uri" xlink:href="https://github.com/koszullab/serpentine">https://github.com/koszullab/serpentine</ext-link>; documentation and tutorials are provided at <ext-link ext-link-type="uri" xlink:href="https://serpentine.readthedocs.io/en/latest/">https://serpentine.readthedocs.io/en/latest/</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Research Council</institution>
            <institution-id institution-id-type="DOI">10.13039/100010663</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Horizon 2020 Program</institution>
          </institution-wrap>
        </funding-source>
        <award-id>260822</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Pasteur Roux Cantarini fellowship</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Chromosomal conformation capture experiments (Hi-C) provide a quantitative way to infer the spatial proximity of DNA segments (<xref rid="btaa249-B2" ref-type="bibr">Dekker <italic>et al.</italic>, 2002</xref>; <xref rid="btaa249-B9" ref-type="bibr">Lieberman-Aiden <italic>et al.</italic>, 2009</xref>). Hi-C relies on deep sequencing to detect and quantify contacts between pairs of DNA segments, genome-wide. These contacts are displayed in a contact map, i.e. a table or matrix reporting the number of events between each pair of loci. The rows and columns of this matrix represent DNA segments of the reference genome, of identical size (in bp). Each entry indicates the contact count between two regions (<xref ref-type="fig" rid="btaa249-F1">Fig. 1A</xref>, upper panel). The analyses of contact matrices typically involve a normalization step, as well as the identification of specific patterns reflecting functional folding of the genome (for a comparison of available methods, see <xref rid="btaa249-B3" ref-type="bibr">Forcato <italic>et al.</italic>, 2017</xref>). However, experimental variability may influence data analysis in slight yet irreproducible ways. While this does not affect analyses where robust trends are not altered by noise, the quality suffers in poorly covered regions and/or distant regions, limiting accurate comparisons of biological samples. A variety of approaches, taking into account the contact distribution, have been developed to tackle these limitations (<xref rid="btaa249-B10" ref-type="bibr">Lun and Smyth, 2015</xref>; <xref rid="btaa249-B18" ref-type="bibr">Stansfield <italic>et al.</italic>, 2018</xref>). However, these software packages do not consider sparse information. Another option is to bin pixels (i.e. replace groups of pixels by the value of their sum or mean) by fixed-size squares to increase the signal-to-noise ratio in regions with few or no contacts (<xref rid="btaa249-B8" ref-type="bibr">Lajoie <italic>et al.</italic>, 2015</xref>). This is performed uniformly over the entire map, limiting the overall resolution. The result misses out information on dense regions with sufficient coverage to be observed at a higher resolution, and is often insufficient to observe sparser regions.</p>
    <fig id="btaa249-F1" orientation="portrait" position="float">
      <label>Fig. 1.</label>
      <caption>
        <p>Contact matrix and algorithm. (<bold>A</bold>) Hi-C matrix (<italic>S.cerevisiae</italic> chromosome V). Since contact matrices are symmetric, only one half is shown. Each pixel of the map corresponds to a pair of coordinates of genomic segments (or bins). The color intensity reflects the frequency of contacts. The horizontal blue line corresponds to one of the diagonals of the contact matrix, with <inline-formula id="IE1"><mml:math id="IM1"><mml:mi>i</mml:mi></mml:math></inline-formula> indicating the distance separating the pairs of segments positioned along that diagonal. At high <inline-formula id="IE2"><mml:math id="IM2"><mml:mi>i</mml:mi></mml:math></inline-formula> values, i.e. for DNA segments separated by large distances, the matrix becomes sparse (white pixels). The lower panel shows the mean and <inline-formula id="IE3"><mml:math id="IM3"><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:math></inline-formula> for all diagonals (i.e. <inline-formula id="IE4"><mml:math id="IM4"><mml:mi>i</mml:mi></mml:math></inline-formula> values) of the matrix. The resulting scatter-plot reveals a transition that defines two constants: the <inline-formula id="IE5"><mml:math id="IM5"><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:math></inline-formula> constant <inline-formula id="IE6"><mml:math id="IM6"><mml:msub><mml:mrow><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> (green line, for <inline-formula id="IE7"><mml:math id="IM7"><mml:mo>μ</mml:mo><mml:mo>&gt;</mml:mo><mml:mi>t</mml:mi></mml:math></inline-formula>) and the mean constant <inline-formula id="IE8"><mml:math id="IM8"><mml:mi>t</mml:mi></mml:math></inline-formula> (dotted line, intersection of green line and the Poisson distribution represented by the red line). Dots at the left of <inline-formula id="IE9"><mml:math id="IM9"><mml:mi>t</mml:mi></mml:math></inline-formula> and over <inline-formula id="IE10"><mml:math id="IM10"><mml:msub><mml:mrow><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> are subject to the effect of sparsity. (<bold>B</bold>) Algorithm flowchart of serpentine. See main text for detailed description of the workflow. (Color version of this figure is available at <italic>Bioinformatics</italic> online.)</p>
      </caption>
      <graphic xlink:href="btaa249f1"/>
    </fig>
    <sec>
      <title>1.1 Description of the problem</title>
      <p>Low or noisy signal ratio is intrinsic to Hi-C contact maps and varies depending on the read coverage, i.e. the sequencing depth of the Hi-C libraries. Indeed, because of the polymer nature of chromosomes, the contact frequency between DNA segments decreases with the genomic distance <inline-formula id="IE11"><mml:math id="IM11"><mml:mi>i</mml:mi></mml:math></inline-formula> separating them by multiple orders of magnitude (<xref rid="btaa249-B5" ref-type="bibr">Imakaev <italic>et al.</italic>, 2015</xref>; <xref rid="btaa249-B14" ref-type="bibr">Rippe, 2001</xref>). As a result, adjacent segments interact much more frequently than distant ones, as shown by the curve describing the mean number of contacts at fixed genomic distance <inline-formula id="IE12"><mml:math id="IM12"><mml:mo>μ</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> (<xref rid="btaa249-B11" ref-type="bibr">Mirny, 2011</xref>). The sequencing depth also affects the relative level of variability observed in Hi-C datasets. The coefficient of variation (CV) at fixed genomic distance, <inline-formula id="IE13"><mml:math id="IM13"><mml:mi>C</mml:mi><mml:mi>V</mml:mi><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mo>σ</mml:mo><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mo>μ</mml:mo><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></inline-formula> is a value that at high-enough read coverages reflects the biological variability and locus-specific biases (<xref rid="btaa249-B12" ref-type="bibr">Muller <italic>et al.</italic>, 2018</xref>). Close to the main diagonal of the maps, both the means <inline-formula id="IE14"><mml:math id="IM14"><mml:mo>μ</mml:mo></mml:math></inline-formula> and SDs <inline-formula id="IE15"><mml:math id="IM15"><mml:mo>σ</mml:mo></mml:math></inline-formula> are proportional to the read coverage, resulting in constant CVs: <inline-formula id="IE16"><mml:math id="IM16"><mml:msub><mml:mrow><mml:mi>C</mml:mi><mml:mi>V</mml:mi><mml:mo>=</mml:mo><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> (<xref ref-type="fig" rid="btaa249-F1">Fig. 1A</xref>, right part of the lower panel). The contributions of the statistical noise become measurable as the coverage decrease, notably in positions distant from the main diagonal where the coverage is influenced by random sampling (e.g. PCR-amplification, sequencing). This results in pixel values following a Poisson distribution, thus: <inline-formula id="IE17"><mml:math id="IM17"><mml:mo>σ</mml:mo><mml:mo>=</mml:mo><mml:msqrt><mml:mo>μ</mml:mo></mml:msqrt></mml:math></inline-formula>. At these levels of coverage, the biological variability is overwhelmed by noise and consequently <inline-formula id="IE18"><mml:math id="IM18"><mml:mi>C</mml:mi><mml:mi>V</mml:mi><mml:mo>∝</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="normal">μ</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:math></inline-formula> and <inline-formula id="IE19"><mml:math id="IM19"><mml:mi>C</mml:mi><mml:mi>V</mml:mi><mml:mo>&gt;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>. The transition between low and high-enough coverages can be defined by the threshold <inline-formula id="IE20"><mml:math id="IM20"><mml:mi>t</mml:mi></mml:math></inline-formula> (<xref ref-type="fig" rid="btaa249-F1">Fig. 1A</xref>, dotted line), with <inline-formula id="IE21"><mml:math id="IM21"><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:math></inline-formula>, calculated by the intersection between the lines representing constant and coverage-dependent <inline-formula id="IE22"><mml:math id="IM22"><mml:mi>C</mml:mi><mml:mi>V</mml:mi></mml:math></inline-formula>’s. This divergence signifies that the biological variability is lost due to the sampling process in sparse regions.</p>
    </sec>
    <sec>
      <title>1.2 Overview of the proposed approach</title>
      <p>To overcome the effects of sparse information across the whole contact map, we developed serpentine binning, a normalization- and assumption-free method that only bins low pixel values (i.e. low-covered regions). It ensures that the resulting coverage values for each bin in the final map are all above a certain threshold. Instead of shaping pixel bins according to a fixed, unique rule, like square-pooling, binning now results from random iterations based on the number of contacts. When applied to sparse regions, it unveils patterns hidden in non-binned matrices, emphasizing the detection of contacts between distant genomic regions in a more statistically significant way.</p>
    </sec>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Contact map generation</title>
      <p>Fastq-sequencing files from yeast <italic>Saccharomyces cerevisiae</italic> Hi-C DpnII libraries were recovered from public repositories (<xref rid="btaa249-B13" ref-type="bibr">Patel <italic>et al.</italic>, 2019</xref>; <xref rid="btaa249-B15" ref-type="bibr">Schalbetter <italic>et al.</italic>, 2019</xref>), or generated in the lab (SRA accession numbers SRX7554368 and SRX7554369). Raw contact maps were generated and binned using a custom-made python package (<ext-link ext-link-type="uri" xlink:href="https://github.com/koszullab/hicstuff">https://github.com/koszullab/hicstuff</ext-link>) and the following parameter: <italic>hicstuff pipeline -n -t 28 -e DpnII –filter –aligner=bowtie2</italic>. Alignment of fastq was done using either the SK1 (<xref rid="btaa249-B16" ref-type="bibr">Song <italic>et al.</italic>, 2019</xref>) or S288C reference genomes (<xref rid="btaa249-B20" ref-type="bibr">Yue <italic>et al.</italic>, 2017</xref>), depending on the strain. Alignments were filtered as described in <xref rid="btaa249-B1" ref-type="bibr">Cournac <italic>et al.</italic> (2012)</xref> and binned along 2.5 kb sequences (<italic>hicstuff rebin –binning =2500 bp</italic>). An example of resulting yeast genome intra-chromosomal contact maps is depicted in <xref ref-type="supplementary-material" rid="sup1">Supplementary Figure S1</xref>.</p>
    </sec>
    <sec>
      <title>2.2 Down-sampling of contact maps</title>
      <p>Hicstuff provides the ability to downsample the data through the following command line: <italic>hicstuff subsample –prop x</italic>, where <italic>x</italic> is the proportion of subsampling.</p>
    </sec>
    <sec>
      <title>2.3 Joint serpentine binning</title>
      <p>The serpentine-binning algorithm (<xref ref-type="fig" rid="btaa249-F1">Fig. 1B</xref>) requires two input thresholds <inline-formula id="IE23"><mml:math id="IM23"><mml:mo>θ</mml:mo></mml:math></inline-formula> and<inline-formula id="IE24"><mml:math id="IM24"><mml:mi mathvariant="normal"> </mml:mi><mml:mo>ε</mml:mo></mml:math></inline-formula>, with <inline-formula id="IE25"><mml:math id="IM25"><mml:mo>ε</mml:mo><mml:mo>&lt;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>θ</mml:mo></mml:math></inline-formula>, and two contact maps; typically, an experimental contact map compared to its biological control. The parameters <inline-formula id="IE26"><mml:math id="IM26"><mml:mo>θ</mml:mo></mml:math></inline-formula> and <inline-formula id="IE27"><mml:math id="IM27"><mml:mo>ε</mml:mo></mml:math></inline-formula> correspond to the coverage thresholds, tunable by the user, that control the minimal number of reads present in each serpentine, in, respectively, each or both matrices. Higher <inline-formula id="IE28"><mml:math id="IM28"><mml:mo>θ</mml:mo></mml:math></inline-formula> and<inline-formula id="IE29"><mml:math id="IM29"><mml:mi mathvariant="normal"> </mml:mi><mml:mo>ε</mml:mo></mml:math></inline-formula> values result in more binning. <inline-formula id="IE30"><mml:math id="IM30"><mml:mo>θ</mml:mo></mml:math></inline-formula> and<inline-formula id="IE31"><mml:math id="IM31"><mml:mi mathvariant="normal"> </mml:mi><mml:mo>ε</mml:mo></mml:math></inline-formula> are related to the threshold <inline-formula id="IE32"><mml:math id="IM32"><mml:mi>t</mml:mi></mml:math></inline-formula>, i.e. the settings of <inline-formula id="IE33"><mml:math id="IM33"><mml:mo>θ</mml:mo></mml:math></inline-formula> and<inline-formula id="IE34"><mml:math id="IM34"><mml:mi mathvariant="normal"> </mml:mi><mml:mo>ε</mml:mo></mml:math></inline-formula> and the resulting binning move all the bins from the left side of <inline-formula id="IE35"><mml:math id="IM35"><mml:mi>t</mml:mi></mml:math></inline-formula> (high noise signal ratio; <xref ref-type="fig" rid="btaa249-F1">Fig. 1A</xref> lower panel) toward the right side of <inline-formula id="IE36"><mml:math id="IM36"><mml:mi>t</mml:mi></mml:math></inline-formula> (low-noise signal ratio). A serpentine is then defined as an irregular geometrical bin, i.e. a subset of connected pixels. At the beginning of the binning process, each pixel is a serpentine. One of those serpentines is then randomly chosen. This defines a pair of serpentines, one on each of the two matrices to be compared (pixel A and B in <xref ref-type="fig" rid="btaa249-F1">Fig. 1B</xref>, step 2). If both values of the <italic>two</italic> serpentines are lower than <inline-formula id="IE37"><mml:math id="IM37"><mml:mo>θ</mml:mo></mml:math></inline-formula>, or if a value of <italic>any</italic> serpentine of the pair is lower than <inline-formula id="IE38"><mml:math id="IM38"><mml:mo>ε</mml:mo></mml:math></inline-formula>, then these serpentines are suitable to merge with another serpentine randomly chosen among neighbors (<xref ref-type="fig" rid="btaa249-F1">Fig. 1B</xref>, step 3). The merging takes place identically in both maps, resulting in a pair of larger serpentines (two pixels or sets of pixels instead of one). In each map, the sum of the pixels is attributed to the newly formed serpentine. The same procedure is applied over all serpentines on the contact matrix in a random order. This procedure is repeated until the total number of serpentines remains constant across two iterations, i.e. when the structure cannot evolve further. The resulting contact maps are then binned serpentine-wise, i.e. each pixel value is replaced with the average value of all pixels belonging to its final serpentine. This average value represents the amount of contacts spread over the regions involved. At the end of the binning, all serpentines have collected enough statistics to greatly reduce sampling effects, but the shape of the serpentines is determined by the randomly chosen 2D paths. To avoid this distortion, the full algorithm is run independently <italic>N</italic> (<italic>N</italic> &gt; 4) times. The final binned matrix is the average of the <italic>N</italic> runs. Of note, the serpentine algorithm described here is applied on two contact matrices, but it can be run on more.</p>
    </sec>
    <sec>
      <title>2.4 Mean-deviation plots</title>
      <p>From a couple of matrices <inline-formula id="IE39"><mml:math id="IM39"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE40"><mml:math id="IM40"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, and for each <inline-formula id="IE41"><mml:math id="IM41"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE42"><mml:math id="IM42"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> pixel, of same coordinates, the mean <inline-formula id="IE43"><mml:math id="IM43"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and the ratio <inline-formula id="IE44"><mml:math id="IM44"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are computed. The mean-deviation (MD) plot is a scatter-plot where each dot maps to a pixel coordinates, and have values of log<sub>2</sub><inline-formula id="IE45"><mml:math id="IM45"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (respectively log<sub>2</sub><inline-formula id="IE46"><mml:math id="IM46"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> centered on ratio 1) for the <italic>x</italic>- (respectively y-) axis (<xref ref-type="fig" rid="btaa249-F2">Figs 2 and 3</xref>, right panels).</p>
      <fig id="btaa249-F2" orientation="portrait" position="float">
        <label>Fig. 2.</label>
        <caption>
          <p>Serpentine analysis using biological replicates of asynchronous yeast cultures. Contact maps of chromosome V, ratio heatmaps and MD plots before (<bold>A</bold>) (bin =2.5 kb) and after (<bold>B</bold>), serpentine binning. On the left panels, half of the symmetric matrices are depicted: top right for replicate 1 and bottom left for replicate 2. Center panels show the full symmetric ratio heatmap of the two matrices from the corresponding left panel. See the M&amp;M section for MD plot details</p>
        </caption>
        <graphic xlink:href="btaa249f2"/>
      </fig>
      <fig id="btaa249-F3" orientation="portrait" position="float">
        <label>Fig. 3.</label>
        <caption>
          <p>Serpentine analysis comparing contact maps generated during meiosis. Time course at 0 and 4 h, before (<bold>A</bold>) and after (<bold>B</bold>) serpentine binning, left, right and central panels are the same as in <xref ref-type="fig" rid="btaa249-F2">Figure 2</xref>. (<bold>C</bold>) Serpentine analysis comparing the Rec8 cohesin deletion mutant to control, in a population blocked in pachytene through Ndt80 deletion: before binning, after binning and ratio-maps. The green rectangles along the axis of contact maps correspond to the deposition sites of the cohesin meiotic subunit Rec8. The green lines connect these deposition sites to the diagonal. Green arrow: telomere-telomere contacts. Red arrow: centromere position. Cyan arrow, meiotic loop. (Color version of this figure is available at <italic>Bioinformatics</italic> online.)</p>
        </caption>
        <graphic xlink:href="btaa249f3"/>
      </fig>
    </sec>
    <sec>
      <title>2.5 Generation of ratio heatmaps</title>
      <p>Standard contact maps (<xref ref-type="fig" rid="btaa249-F2">Figs 2A and 3A and C</xref>, left panels) depict raw read counts. Ratio heatmaps (<xref ref-type="fig" rid="btaa249-F2">Figs 2A and 3A</xref>, center panels) were obtained using the log<sub>2</sub> of <inline-formula id="IE47"><mml:math id="IM47"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, with <inline-formula id="IE48"><mml:math id="IM48"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> described above and with <inline-formula id="IE49"><mml:math id="IM49"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="italic">mean</mml:mi><mml:mo>(</mml:mo><mml:mi>y</mml:mi><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mi mathvariant="italic">mean</mml:mi><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula>. Ratios cancel out locus-specific biases. Mask matrices (<xref ref-type="fig" rid="btaa249-F4">Figs 4 and 6</xref>, right panel) were obtained using the HiCcompare R package (<xref rid="btaa249-B18" ref-type="bibr">Stansfield <italic>et al.</italic>, 2018</xref>). Starting from the two raw square contact matrices to be compared, we applied the statistical model using the functions <italic>full2sparse</italic>, <italic>create. hic.table</italic>, <italic>hic.loess</italic> and <italic>hic.compare</italic>. This package provides <italic>P</italic>-value measures that indicate significant <inline-formula id="IE50"><mml:math id="IM50"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> ratios. The corresponding significant coordinates were used to generate an inverted binary mask matrix with significant ratios as transparent pixels and with non-significant ratios as semi-transparent black pixels.</p>
    </sec>
    <sec>
      <title>2.6 Filtering and normalization</title>
      <p>Filtering is performed by removing from the matrices all rows/columns with total coverage &lt;3 SDs below the median row coverage. Normalization is performed by iterative correction (ICE) (<xref rid="btaa249-B4" ref-type="bibr">Imakaev <italic>et al.</italic>, 2012</xref>).</p>
    </sec>
    <sec>
      <title>2.7 Comparison with binless</title>
      <p>Serpentine was compared to binless (<xref rid="btaa249-B17" ref-type="bibr">Spill <italic>et al.</italic>, 2019</xref>) using the data and procedure used as an example in the binless package and accessible at <ext-link ext-link-type="uri" xlink:href="https://github.com/3DGenomes/binless/blob/56c78b3588a708076b9a046759eafa783053aac1/example/rao_HiCall_FOXP1ext_2.3M_optimized_binless_difference.pdf">https://github.com/3DGenomes/binless/blob/56c78b3588a708076b9a046759eafa783053aac1/example/rao_HiCall_FOXP1ext_2.3M_optimized_binless_difference.pdf</ext-link>.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Serpentine attenuates noise in poorly covered regions</title>
      <p>We first tested serpentine binning on two biological Hi-C replicates of asynchronous populations of <italic>S.cerevisiae</italic> (<xref ref-type="fig" rid="btaa249-F2">Fig. 2</xref>). Without serpentine, ratio heatmap unveils strong local variation, with neighboring pixels sometimes presenting opposite log2 ratios, except on the main diagonal (<xref ref-type="fig" rid="btaa249-F2">Fig. 2</xref>, center panel). MD plot confirms that the variation is highest for low mean coverages (right panel). Altogether, these analyses illustrate the substantial sampling noise that can be observed in poorly covered regions when comparing two Hi-C contact maps. Using the mean-CV plot (<xref ref-type="fig" rid="btaa249-F1">Fig. 1A</xref>, lower panel) on both replicates, a mean threshold <inline-formula id="IE51"><mml:math id="IM51"><mml:mi>t</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mo>≈</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>7</mml:mn></mml:math></inline-formula> was computed. From this, we used serpentine parameters <inline-formula id="IE52"><mml:math id="IM52"><mml:mo>θ</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>=</mml:mo><mml:mn>70</mml:mn></mml:math></inline-formula> and <inline-formula id="IE53"><mml:math id="IM53"><mml:mo>ε</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>7</mml:mn></mml:math></inline-formula>. The value of <inline-formula id="IE54"><mml:math id="IM54"><mml:mo>θ</mml:mo><mml:mi mathvariant="normal"> </mml:mi></mml:math></inline-formula>is 10-fold higher than <inline-formula id="IE55"><mml:math id="IM55"><mml:mi>t</mml:mi></mml:math></inline-formula>, in order to strongly fade the noise. Iterations were set to <inline-formula id="IE56"><mml:math id="IM56"><mml:mi>N</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>128</mml:mn></mml:math></inline-formula>. After serpentine binning, the signal-to-noise ratio globally improves (<xref ref-type="fig" rid="btaa249-F2">Fig. 2B</xref>, center panel). The MD plot that diverges to infinite values before binning, assumes a cigar-like shape after, showing the pixels’ values in both maps do not display much differences, as expected from biological replicates. Serpentine binning therefore attenuates the noise present in poorly covered regions without creating aberrant patterns that could be interpreted as biological contacts.</p>
    </sec>
    <sec>
      <title>3.2 Serpentine enhances patterns related to biological structures in yeast meiosis Hi-C maps</title>
      <p>We then tested serpentine binning using highly-covered contact maps generated over prophase I of a <italic>S.cerevisiae</italic> meiotic time course (<xref ref-type="fig" rid="btaa249-F3">Fig. 3</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2</xref>) (<xref rid="btaa249-B15" ref-type="bibr">Schalbetter <italic>et al.</italic>, 2019</xref>). Over progression into prophase, chromosomes first replicate, while undergoing large structural changes, most prominently a loss of centromere clustering (<xref rid="btaa249-B19" ref-type="bibr">Trelles-Sticken <italic>et al.</italic>, 1999</xref>), an increase in compaction (<xref rid="btaa249-B21" ref-type="bibr">Zickler and Kleckner, 1998</xref>), and a loss of telomere–telomere enriched contacts accompanied by vigorous movements (<xref rid="btaa249-B7" ref-type="bibr">Koszul <italic>et al.</italic>, 2008</xref>; <xref rid="btaa249-B6" ref-type="bibr">Koszul and Kleckner, 2009</xref>; <xref rid="btaa249-B19" ref-type="bibr">Trelles-Sticken <italic>et al.</italic>, 1999</xref>). This chromosomal reorganization has been recently studied using Hi-C (<xref rid="btaa249-B12" ref-type="bibr">Muller <italic>et al.</italic>, 2018</xref>; <xref rid="btaa249-B15" ref-type="bibr">Schalbetter <italic>et al.</italic>, 2019</xref>). The ratio of the raw contact maps of pre-meiotic (0 h) cells and cells at 4 h into prophase, when this reorganization has taken place (see <xref rid="btaa249-B12" ref-type="bibr">Muller <italic>et al.</italic>, 2018</xref> for discussion), results in sparse signal (<xref ref-type="fig" rid="btaa249-F3">Fig. 3A</xref>). The MD plot (<xref ref-type="fig" rid="btaa249-F3">Fig. 3A</xref>, right panel) highlights a strong sampling effect (large ratios at small means), as observed for comparison of replicates (<xref ref-type="fig" rid="btaa249-F2">Fig. 2A</xref>). The application of serpentine binning to the two contact maps at 0 and 4 h into meiosis prophase reduces the variability at low coverages observed in the MD plot (<xref ref-type="fig" rid="btaa249-F3">Fig. 3B</xref>, right panel). However, this scatter-plot has a curved shape, which is qualitatively different from the one observed for comparison of replicates (<xref ref-type="fig" rid="btaa249-F2">Fig. 2B</xref>). In addition, the application of serpentine binning improves the <italic>direct</italic> observation of contact patterns on contact maps at all scales (<xref ref-type="fig" rid="btaa249-F3">Fig. 3B</xref>). At shorter distances, the centromere shows enriched contacts with both flanking arms, reflecting the loss of insulation of the pericentromeric region resulting from de-clustering (<xref ref-type="fig" rid="btaa249-F3">Fig. 3B</xref>, red arrow) (<xref rid="btaa249-B12" ref-type="bibr">Muller <italic>et al</italic>, 2018</xref>). At long distances, one can observe a general drop in contacts that most likely reflects the increase in short-range compaction. However, this drop is stronger at telomeres, which probably reflects the loss of trans-telomere contacts resulting from the dynamics movements they initiate at that stage (<xref ref-type="fig" rid="btaa249-F3">Fig. 3B</xref>, green arrow) (<xref rid="btaa249-B7" ref-type="bibr">Koszul <italic>et al.</italic>, 2008</xref>).</p>
      <p>At short- and medium-range distances, a grid-like pattern appears, highlighting discrete positions enriched in contacts. This pattern was strongly enhanced after serpentine binning compared to the raw signal (compare <xref ref-type="fig" rid="btaa249-F3">Fig. 3B</xref>, cyan arrow, with <xref ref-type="fig" rid="btaa249-F3">Fig. 3A</xref>). This pattern reflects the formation of cohesin-dependent loops along the chromosome that promote the increase in compaction [see <xref rid="btaa249-B12" ref-type="bibr">Muller <italic>et al.</italic> (2018)</xref> and <xref rid="btaa249-B15" ref-type="bibr">Schalbetter <italic>et al.</italic> (2019)</xref> for demonstration and discussion]. In agreement with these past works, those clusters clearly overlap visually with genomic sites enriched in the cohesin subunit Rec8 (<xref ref-type="fig" rid="btaa249-F3">Fig. 3B</xref>, green lines) and disappear in a <italic>rec8</italic> mutant (<xref ref-type="fig" rid="btaa249-F3">Fig. 3C</xref>) (cells synchronized and arrested in pachytene through a Ndt80 depletion) (<xref rid="btaa249-B15" ref-type="bibr">Schalbetter <italic>et al.</italic>, 2019</xref>).</p>
      <p>Altogether, these results show that serpentine binning enhances biologically relevant patterns.</p>
    </sec>
    <sec>
      <title>3.3 Serpentine enhances significant structures</title>
      <p>To determine the sensitivity of serpentine, we used HiCcompare before and after binning (<xref rid="btaa249-B18" ref-type="bibr">Stansfield <italic>et al.</italic>, 2018</xref>). Significant pixels provided by HiCcompare were used to generate a semi-transparent mask that highlights the regions of significant ratios when overlaid on top of the ratio-maps (<xref ref-type="fig" rid="btaa249-F4">Fig. 4</xref>). As a negative control, we performed the analysis on biological replicates (<xref ref-type="fig" rid="btaa249-F4">Fig. 4A</xref>). HiCcompare detected ∼3% and zero significant pixel ratios before and after serpentine binning, respectively, confirming that the process attenuates noise in poorly covered regions without generating aberrant patterns. We then applied HiCcompare on ratio of meiotic contact maps at 0 and 4 h (<xref ref-type="fig" rid="btaa249-F4">Fig. 4B</xref>). Before serpentine, HiCcompare pointed at ∼2% of significant pixel ratios, with an enrichment in contacts in the vicinity the diagonal (red pixels) and a drop at the centromere (blue pixels). However, those significant pixels were often intermingled, with no obvious pattern emerging from the mask. On the opposite, the ∼1% pixels highlighted as significant by HiCcompare after serpentine binning correspond to larger clusters positioned into a grid-like pattern, with little intermingling. To determine whether these clusters correspond to biologically relevant features, we repeated the analysis with meiotic, ndt80-arrested cells lacking cohesin-mediated loops (<italic>rec8</italic> mutant, <xref ref-type="fig" rid="btaa249-F4">Fig. 4C</xref>). The application of HiCcompare on the ratio of <italic>rec8</italic> depleted and control cells contact maps shows 4% significant pixel scattered on the raw ratio, reduced to 2% of discrete, larger clusters after serpentine binning. Furthermore, the overlap between the pixels identified by HiCcompare when comparing progression into meiosis (0 versus 4 h) and the absence of cohesin-mediated loops (rec8 versus control) was of 4% for the maps not treated with serpentine and 46% after serpentine binning (compare <xref ref-type="fig" rid="btaa249-F4">Fig. 4B</xref> versus C lower and upper right panels).</p>
      <fig id="btaa249-F4" orientation="portrait" position="float">
        <label>Fig. 4.</label>
        <caption>
          <p>HiCcompare analysis of ratio heatmaps before (bottom left) or after (top right) serpentine binning. Maps and masks obtained using the data from <xref ref-type="fig" rid="btaa249-F2">Figure 2</xref> (<bold>A</bold>) (biological replicates, asynchronous cells) or from <xref ref-type="fig" rid="btaa249-F3">Figure 3</xref> (<bold>B</bold>) (meiosis <italic>t</italic>=0 and 4 h cells) (<bold>C</bold>) (pachytene-arrested cells <italic>rec8</italic>Δ and control). A semi-transparent mask derived from HiCcompare analysis overlays the ratio heatmaps, which highlights the significant ratio determined by HiCcompare (no dark areas)</p>
        </caption>
        <graphic xlink:href="btaa249f4"/>
      </fig>
      <p>These results show that serpentine allows programs, such as HiCcompare, to identify relevant biological signals in contact maps, otherwise difficult to distinguish from the noise.</p>
    </sec>
    <sec>
      <title>3.4 Serpentine attenuates the effects of low-coverage data</title>
      <p>To test the robustness of serpentine binning on poorly covered regions, the counts of contact matrices at <italic>t</italic>=0 and 4 h into meiosis (see <xref ref-type="fig" rid="btaa249-F3">Fig. 3</xref>) were subsampled to mimic various sequencing depths (<xref ref-type="fig" rid="btaa249-F5">Fig. 5</xref>; Materials and methods). As a consequence of down-sampling, the ratio-maps become sparser and sparser before the application of serpentine binning (lower-left part of the matrices). The effect is particularly prominent at long distances from the main diagonal, where coverage is scarce. After serpentine binning (upper-high part of the matrices), matrices display a smoother pattern, while retaining biologically relevant features, i.e. a clear increase in compaction, the presence of loops (though not of all of them), and loss of long-range contacts (<xref ref-type="supplementary-material" rid="sup1">Supplementary Figs S3 and S4</xref>).</p>
      <fig id="btaa249-F5" orientation="portrait" position="float">
        <label>Fig. 5.</label>
        <caption>
          <p>Serpentine analysis on low-coverage data. Same as <xref ref-type="fig" rid="btaa249-F3">Figure 3</xref> middle panels, but using the same data downsampled to reduce the global coverage. The percentage of the total initial count kept after down-sampling is indicated below each panel</p>
        </caption>
        <graphic xlink:href="btaa249f5"/>
      </fig>
      <p>These results show that serpentine can help identify relevant changes otherwise difficult to see in poorly covered contact maps or regions.</p>
    </sec>
    <sec>
      <title>3.5 Evidence of structuration in mouse spermatocytes during meiosis</title>
      <p>To assess for serpentine versatility, we tested the binning on contact maps of mouse spermatocytes undergoing meiosis (<xref ref-type="fig" rid="btaa249-F6">Fig. 6</xref>; raw matrices in <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S5</xref>) (<xref rid="btaa249-B13" ref-type="bibr">Patel <italic>et al.</italic>, 2019</xref>). Changes in contacts intensities were highlighted between cells at the zygotene (a stage of meiotic prophase I) versus premeiosis stages. Notably, in agreement with <xref rid="btaa249-B13" ref-type="bibr">Patel <italic>et al.</italic> (2019)</xref>, the chromatin loops that structure the pre-meiotic (and interphase) chromosomes at short- or medium (&lt;200 kb)-genomic distances vanish upon entry into meiosis. The pattern is clearly visible on the serpentine ratio.</p>
      <fig id="btaa249-F6" orientation="portrait" position="float">
        <label>Fig. 6.</label>
        <caption>
          <p>Serpentine applied to mammalian data from (<xref rid="btaa249-B13" ref-type="bibr">Patel <italic>et al.</italic>, 2019</xref>). Comparison of mouse spermatocytes during zygotene stage of meiosis versus control (mice interphase). Data from mouse chromosome II, region 27 700–29 160 (1.46 Mb, 1 kb bins) are depicted. See the previous figures for details</p>
        </caption>
        <graphic xlink:href="btaa249f6"/>
      </fig>
    </sec>
    <sec>
      <title>3.6 Serpentine performances</title>
      <p>Finally, we benchmarked serpentine binning first by assessing the runtime performance according to matrix complexity (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S6A</xref>). With a total number of two million reads, in a square matrix of order 200×200 pixels, serpentine binning takes ∼10 s on a PC workstation with 64 GB of RAM and Intel Core i7 processor. Runtime increases as <italic>n</italic><sup>2</sup> [complexity O(<italic>n</italic><sup>2</sup>)], where (<italic>n×</italic> <italic>n</italic>) is the order of the input square matrices. We then assessed the runtime performance depending on matrix sparsity (proportion of non-zeros in the contact map, <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S6B</xref>). With a matrix of order 100×100, and a measure of sparsity spanning from 10<sup>−4</sup> to 10<sup>0</sup>, we show that, over 5 independent runs, runtime appears largely independent from this parameter.</p>
      <p>Normalization, notably ICE (<xref rid="btaa249-B4" ref-type="bibr">Imakaev <italic>et al.</italic>, 2012</xref>) and sequential component normalization (SCN) (<xref rid="btaa249-B1" ref-type="bibr">Cournac <italic>et al.</italic>, 2012</xref>) are frequently used to remove locus-specific biases on contact maps. Serpentine binning performed after ICE normalization appears (i) to generate noisier data, (ii) to remove the biological patterns highlighted above (<xref ref-type="fig" rid="btaa249-F3">Fig. 3</xref>), while (iii) adding new signal in the sparse regions (<xref ref-type="fig" rid="btaa249-F7">Fig. 7A</xref>, lower row). Even more notable is the effect of ICE normalization performed after serpentine binning (<xref ref-type="fig" rid="btaa249-F7">Fig. 7A</xref>, upper row); in this case, the appearance of straight lines resembling a checkerboard pattern, visible on both contact maps and the log-ratio map, is artifactual and a consequence of the normalization. Therefore, serpentine is better suited to raw data and does not necessitate prior normalization (see also Discussion).</p>
      <fig id="btaa249-F7" orientation="portrait" position="float">
        <label>Fig. 7.</label>
        <caption>
          <p>Performances. (<bold>A</bold>) Influence of ICE iterative normalization (<xref rid="btaa249-B4" ref-type="bibr">Imakaev <italic>et al.</italic>, 2012</xref>), with or without filtering, on Serpentine outcomes. (<bold>B</bold>) Comparison between log-ratios for binless (left) and serpentine (right), using the binless-provided datasets (IMR90 versus GM12878) for the locus FOXP1 (Chromosome 3, region 7–7.2 Mb)</p>
        </caption>
        <graphic xlink:href="btaa249f7"/>
      </fig>
      <p>We compared serpentine with Binless, an image analysis algorithm that enhances contact patterns in Hi-C maps (<xref rid="btaa249-B17" ref-type="bibr">Spill <italic>et al.</italic>, 2019</xref>). We applied serpentine to a binless dataset comparing contacts in the FOXP1 locus (Chromosome 3, region 7–7.2 Mb) between the IMR90 (fetal lung fibroblast) and GM12878 (B-lymphoblast) human cell lines. We reproduced the published log-ratio map using binless (<xref ref-type="fig" rid="btaa249-F7">Fig. 7B;</xref> URL in Materials and methods). Although Binless uses a very different approach from serpentine, the two methods highlighted the same large-scale patterns. Domains and borders were accurately displayed in both cases and consistent with one another. However, the resolution seemed higher on serpentine ratio-maps, with small-scale patterns clearly distinguishable from the background noise. This would be important when loop-size pattern detection and visualization is required. Overall, we believe that the runtime, absence of normalization pre-processing and high-resolution output of serpentine, will be valuable for contact maps analyses.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>We designed serpentine binning as an intuitive and user-friendly method to highlight differences in contact maps, aggregating statistics in regions of sparsity without diluting regions presenting strong signals independently of coverage. The choice of binning and observation scale is a common problem when visualizing Hi-C data and the most common approach is to perform a simple 2D sum-pooling. We show that serpentine binning removes noise in poorly covered regions without generating aberrant patterns, while enhancing patterns corresponding to biological contacts. Serpentine binning is robust, managing to maintain the emphasis on relevant contacts even in poorly covered datasets or regions.</p>
    <p>Normalizing the data using SCN or ICE <italic>before</italic> serpentine did not improve downstream differential analysis. This is expected. At low coverage, sparse regions in the maps will consist of pixels equal either to 0 or 1. Normalization will transform a pixel =1 into approximately a geometric mean of the coverage of the corresponding row and column. A pixel =0 will remain 0. As a result, the ratio-maps between two matrices obtained that way will contain infinites, not-a-numbers and random values. The application of SCN or ICE will therefore not solve the problem of low statistics of Hi-C data. These algorithms are appropriate when displaying contact maps to cancel loci-specific biases of Hi-C, such as guanine-cytosine content or experimental noise (<xref rid="btaa249-B1" ref-type="bibr">Cournac <italic>et al.</italic>, 2012</xref>). However, generally, when performing ratio-maps over biological conditions, loci-specific biases are the same on both maps; and they cancel each other. As a consequence, SCN or ICE is not required. For all these reasons, we advise against using serpentine after normalization. In addition, after normalization, the meaning of the parameters <inline-formula id="IE57"><mml:math id="IM57"><mml:mo>θ</mml:mo></mml:math></inline-formula> and<inline-formula id="IE58"><mml:math id="IM58"><mml:mi mathvariant="normal"> </mml:mi><mml:mo>ε</mml:mo></mml:math></inline-formula> related to coverage is lost, and we did not find an obvious way to relate the serpentine thresholds input before normalization to the pixel values after normalization. On raw contact maps, those parameters can be chosen by measuring the value of <inline-formula id="IE59"><mml:math id="IM59"><mml:mi>t</mml:mi></mml:math></inline-formula> (<xref ref-type="fig" rid="btaa249-F1">Fig. 1A</xref>). In this article, we adopted a value of <inline-formula id="IE60"><mml:math id="IM60"><mml:mo>θ</mml:mo><mml:mi mathvariant="normal"> </mml:mi></mml:math></inline-formula>10-fold higher than <inline-formula id="IE61"><mml:math id="IM61"><mml:mi>t</mml:mi></mml:math></inline-formula>, and <inline-formula id="IE62"><mml:math id="IM62"><mml:mo>ε</mml:mo></mml:math></inline-formula> equal to <inline-formula id="IE63"><mml:math id="IM63"><mml:mi>t</mml:mi><mml:mo>.</mml:mo></mml:math></inline-formula></p>
    <p>Serpentine binning can be applied on a single matrix. To do so, the user should use the same contact map as both inputs. In that case, the parameter <inline-formula id="IE64"><mml:math id="IM64"><mml:mi>ε</mml:mi></mml:math></inline-formula> will be ignored while <inline-formula id="IE65"><mml:math id="IM65"><mml:mi>θ</mml:mi></mml:math></inline-formula> will play the role of the unique coverage threshold. Binning will be performed until all serpentine bins reach that coverage. However, the interest to use the tool this way (on a single map) is not obvious, as loci-specific biases will remain in the serpentine map. Those biases represent most of the variability of contact maps plotted in <xref ref-type="fig" rid="btaa249-F1">Figure 1A</xref>. As shown in <xref ref-type="fig" rid="btaa249-F7">Figure 7A</xref>, normalization using SCN or ICE <italic>after</italic> serpentine should not be done as it will introduces artifacts, a consequence of the fact that normalization is performed row- and column-wise, and not locally. The normalization algorithm introduces a flow of information between positions that can be far apart on the matrix, but on the same row/column, in a way difficult to control. Canonical binning in fixed-size squares spreads the noise or distorted signals uniformly along the whole fixed-size bin. Serpentine binning prior normalization, on the other hand, would make these artifacts prominent. Artifact are visible also when using SCN or ICE normalization <italic>prior</italic> to serpentine binning, in this case, due to the presence of spikes in lowly covered regions. Spikes are created as a consequence of the division of bins with one or a few aligned reads by a very small normalization factor. Filtering the matrices prior to normalization, in this case, qualitatively helps in reducing the effects of these artifacts, as shown in <xref ref-type="fig" rid="btaa249-F7">Figure 7A</xref>.</p>
    <p>Serpentine is available as an open-access Python package easy to integrate into existing analysis pipelines. Currently, its input consists in relatively dense matrices loaded into memory, with a dataset reasonable upper size being 1500×1500 bins. In the future, this condition may be relaxed by using either sparse structures or by implementing disk-based formats. Sparsity of Hi-C contact maps can also be addressed experimentally through targeted capture protocols that selectively increase the read coverage of regions of interest, reducing complexity (at the expense of genome-wide information).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>btaa249_Supplementary_Data</label>
      <media xlink:href="btaa249_supplementary_data.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank Julien Mozziconacci, and the members of the RSG team especially Axel Cournac and Cyril Matthey-Doret for feedback.</p>
    <sec>
      <title>Funding</title>
      <p>This research was supported by funding from the European Research Council under the Horizon 2020 Program (ERC grant agreement 260822 to R.K.). Vittore Scolari was recipient of the Pasteur Roux Cantarini fellowship.</p>
      <p><italic>Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btaa249-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cournac</surname><given-names>A.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Normalization of a chromosomal contact map</article-title>. <source>BMC Genomics</source>, <volume>13</volume>, <fpage>436</fpage>.<pub-id pub-id-type="pmid">22935139</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Dekker</surname><given-names>J.</given-names></name></person-group><etal>et al</etal> (<year>2002</year>) 
<article-title>Capturing chromosome conformation</article-title>. <source>Science</source>, <volume>295</volume>, <fpage>1306</fpage>–<lpage>1311</lpage>.<pub-id pub-id-type="pmid">11847345</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Forcato</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Comparison of computational methods for Hi-C data analysis</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>679</fpage>–<lpage>685</lpage>.<pub-id pub-id-type="pmid">28604721</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Imakaev</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Iterative correction of Hi-C data reveals hallmarks of chromosome organization</article-title>. <source>Nat. Methods</source>, <volume>9</volume>, <fpage>999</fpage>–<lpage>1003</lpage>.<pub-id pub-id-type="pmid">22941365</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Imakaev</surname><given-names>M.V.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>Modeling chromosomes: beyond pretty pictures</article-title>. <source>FEBS Lett</source>., <volume>589</volume>, <fpage>3031</fpage>–<lpage>3036</lpage>.<pub-id pub-id-type="pmid">26364723</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Koszul</surname><given-names>R.</given-names></name>, <name name-style="western"><surname>Kleckner</surname><given-names>N.</given-names></name></person-group> (<year>2009</year>) 
<article-title>Dynamic chromosome movements during meiosis: a way to eliminate unwanted connections?</article-title><source>Trends Cell Biol</source>., <volume>19</volume>, <fpage>716</fpage>–<lpage>724</lpage>.<pub-id pub-id-type="pmid">19854056</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Koszul</surname><given-names>R.</given-names></name></person-group><etal>et al</etal> (<year>2008</year>) 
<article-title>Meiotic chromosomes move by linkage to dynamic actin cables with transduction of force through the nuclear envelope</article-title>. <source>Cell</source>, <volume>133</volume>, <fpage>1188</fpage>–<lpage>1201</lpage>.<pub-id pub-id-type="pmid">18585353</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lajoie</surname><given-names>B.R.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>The Hitchhiker’s guide to Hi-C analysis: practical guidelines</article-title>. <source>Methods</source>, <volume>72</volume>, <fpage>65</fpage>–<lpage>75</lpage>.<pub-id pub-id-type="pmid">25448293</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lieberman-Aiden</surname><given-names>E.</given-names></name></person-group><etal>et al</etal> (<year>2009</year>) 
<article-title>Comprehensive mapping of long-range interactions reveals folding principles of the human genome</article-title>. <source>Science</source>, <volume>326</volume>, <fpage>289</fpage>–<lpage>293</lpage>.<pub-id pub-id-type="pmid">19815776</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lun</surname><given-names>A.T.L.</given-names></name>, <name name-style="western"><surname>Smyth</surname><given-names>G.K.</given-names></name></person-group> (<year>2015</year>) 
<article-title>diffHic: a Bioconductor package to detect differential genomic interactions in Hi-C data</article-title>. <source>BMC Bioinformatics</source>, <volume>16</volume>, <fpage>258</fpage>.<pub-id pub-id-type="pmid">26283514</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Mirny</surname><given-names>L.A.</given-names></name></person-group> (<year>2011</year>) 
<article-title>The fractal globule as a model of chromatin architecture in the cell</article-title>. <source>Chromosome Res</source>., <volume>19</volume>, <fpage>37</fpage>–<lpage>51</lpage>.<pub-id pub-id-type="pmid">21274616</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Muller</surname><given-names>H.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Characterizing meiotic chromosomes’ structure and pairing using a designer sequence optimized for Hi‐C</article-title>. <source>Mol. Syst. Biol</source>., <volume>14</volume>, <fpage>e8293</fpage>.<pub-id pub-id-type="pmid">30012718</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Patel</surname><given-names>L.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>Dynamic reorganization of the genome shapes the recombination landscape in meiotic prophase</article-title>. <source>Nat. Struct. Mol. Biol</source>., <volume>26</volume>, <fpage>164</fpage>–<lpage>174</lpage>.<pub-id pub-id-type="pmid">30778236</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rippe</surname><given-names>K.</given-names></name></person-group> (<year>2001</year>) 
<article-title>Making contacts on a nucleic acid polymer</article-title>. <source>Trends Biochem. Sci</source>., <volume>26</volume>, <fpage>733</fpage>–<lpage>740</lpage>.<pub-id pub-id-type="pmid">11738597</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Schalbetter</surname><given-names>S.A.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>Principles of meiotic chromosome assembly revealed in <italic>S. cerevisiae</italic></article-title>. <source>Nat. Commun</source>., <volume>10</volume>, <fpage>1</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">30602773</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Song</surname><given-names>G.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>Integrative Meta-Assembly Pipeline (IMAP): chromosome-level genome assembler combining multiple de novo assemblies</article-title>. <source>PLoS One</source>, <volume>14</volume>, <fpage>e0221858</fpage>.<pub-id pub-id-type="pmid">31454399</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Spill</surname><given-names>Y.G.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>Binless normalization of Hi-C data provides significant interaction and difference detection independent of resolution</article-title>. <source>Nat. Commun</source>., <volume>10</volume>, <fpage>1938</fpage>.<pub-id pub-id-type="pmid">31028255</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Stansfield</surname><given-names>J.C.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>HiCcompare: an R-package for joint normalization and comparison of HI-C datasets</article-title>. <source>BMC Bioinformatics</source>, <volume>19</volume>, <fpage>279</fpage>.<pub-id pub-id-type="pmid">30064362</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Trelles-Sticken</surname><given-names>E.</given-names></name></person-group><etal>et al</etal> (<year>1999</year>) 
<article-title>Bouquet formation in budding yeast: initiation of recombination is not required for meiotic telomere clustering</article-title>. <source>J. Cell Sci</source>., <volume>112</volume>, <fpage>651</fpage>–<lpage>658</lpage>.<pub-id pub-id-type="pmid">9973600</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Yue</surname><given-names>J.-X.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Contrasting evolutionary genome dynamics between domesticated and wild yeasts</article-title>. <source>Nat. Genet</source>., <volume>49</volume>, <fpage>913</fpage>–<lpage>924</lpage>.<pub-id pub-id-type="pmid">28416820</pub-id></mixed-citation>
    </ref>
    <ref id="btaa249-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zickler</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Kleckner</surname><given-names>N.</given-names></name></person-group> (<year>1998</year>) 
<article-title>The leptotene-zygotene transition of meiosis</article-title>. <source>Annu. Rev. Genet</source>., <volume>32</volume>, <fpage>619</fpage>–<lpage>697</lpage>.<pub-id pub-id-type="pmid">9928494</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
