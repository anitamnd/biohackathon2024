<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9334349</article-id>
    <article-id pub-id-type="publisher-id">32155</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-022-32155-w</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>TidyMass an object-oriented reproducible analysis framework for LC–MS data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9608-9964</contrib-id>
        <name>
          <surname>Shen</surname>
          <given-names>Xiaotao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Yan</surname>
          <given-names>Hong</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Wang</surname>
          <given-names>Chuchu</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4311-584X</contrib-id>
        <name>
          <surname>Gao</surname>
          <given-names>Peng</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5298-1299</contrib-id>
        <name>
          <surname>Johnson</surname>
          <given-names>Caroline H.</given-names>
        </name>
        <address>
          <email>caroline.johnson@yale.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0784-7987</contrib-id>
        <name>
          <surname>Snyder</surname>
          <given-names>Michael P.</given-names>
        </name>
        <address>
          <email>mpsnyder@stanford.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution>Department of Genetics, </institution><institution>Stanford University School of Medicine, </institution></institution-wrap>Stanford, CA USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.47100.32</institution-id><institution-id institution-id-type="ISNI">0000000419368710</institution-id><institution>Department of Environmental Health Sciences, </institution><institution>Yale School of Public Health, </institution></institution-wrap>New Haven, CT USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.168010.e</institution-id><institution-id institution-id-type="ISNI">0000000419368956</institution-id><institution>Howard Hughes Medical Institute, </institution><institution>Stanford University, </institution></institution-wrap>Stanford, CA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>28</day>
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>28</day>
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <volume>13</volume>
    <elocation-id>4365</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>5</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>7</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Reproducibility, traceability, and transparency have been long-standing issues for metabolomics data analysis. Multiple tools have been developed, but limitations still exist. Here, we present the tidyMass project (<ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/">https://www.tidymass.org/</ext-link>), a comprehensive R-based computational framework that can achieve the traceable, shareable, and reproducible workflow needs of data processing and analysis for LC-MS-based untargeted metabolomics. TidyMass is an ecosystem of R packages that share an underlying design philosophy, grammar, and data structure, which provides a comprehensive, reproducible, and object-oriented computational framework. The modular architecture makes tidyMass a highly flexible and extensible tool, which other users can improve and integrate with other tools to customize their own pipeline.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Reproducibility, traceability, and transparency have been long-standing issues in metabolomics data analysis. Here, the authors present tidyMass, an R-based computational framework that allows designing traceable, shareable, and reproducible data processing and analysis workflows for untargeted metabolomics.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Bioinformatics</kwd>
      <kwd>Mass spectrometry</kwd>
      <kwd>Metabolomics</kwd>
      <kwd>Software</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000057</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Institute of General Medical Sciences (NIGMS)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>1RM1GM141649-01</award-id>
        <principal-award-recipient>
          <name>
            <surname>Snyder</surname>
            <given-names>Michael P.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">To date, liquid chromatography-mass spectrometry (LC-MS)-based untargeted metabolomics has been proven to be an important tool in environmental, nutritional, and biomedical research<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR2">2</xref></sup>. A typical full workflow for LC-MS-based untargeted metabolomics includes sample collection, data acquisition, data analysis, and biological interpretation<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>). Processing and analyzing high-dimensional metabolomics datasets are challenging, requiring the optimization of multiple steps such as raw data processing, data cleaning, data quality control and assessment, metabolite annotation, statistical analysis, and biological function mining<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>.</p>
    <p id="Par4">To overcome the challenges of metabolomics data analysis, the community has developed numerous tools to perform one, or several steps of processing and analyzing untargeted metabolomics data, including MZmine<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>, MS-DIAL<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, XCMS<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, OpenMS<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, Galaxy-M<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, and eMZed<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> for peak picking and grouping, GNPS<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, SIRIUS<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, MetDNA<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, metID<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>, NP analyst<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, and NetID<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> for metabolite annotation, MetFlow<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, metaX<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, MSPrep<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, and MetaboDiff<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> for data cleaning. Furthermore, tools have also been proposed to implement the whole workflow, such as metaboanalystR<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, and XCMS-online<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. However, limitations still exist. Many of the commercial tools are expensive and only work on the associated instrument platform, which is not convenient for all researchers. The online/GUI tools are user-friendly, however, most of them have restrictions for the type of operating system that can be used, which means that they cannot be installed in a cluster or server; most are Linux OS so they cannot utilize computational resources for large-scale datasets<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. The open-source and command-line tools (R or Python) are flexible, however, most of them typically follow limited parts of the whole bioinformatics workflow (i.e. RforMassSpectrometry project<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>) without uniform, specific and traceable structure for data input, resulting in a complicated and time-consuming process to prepare data. Several command-line tools<sup><xref ref-type="bibr" rid="CR18">18</xref>,<xref ref-type="bibr" rid="CR21">21</xref></sup> are aimed to achieve the whole workflow of processing and analysis. However, they do not adopt the modular design concept and do not have an easily used uniform data structure, which makes them difficult to integrate and interoperate with other existing tools (Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">1</xref>). In addition, tools exploited with different design concepts and computational platforms make data sharing and reproducible analysis challenging.</p>
    <p id="Par5">In this work, we propose the tidyMass project, an ecosystem of R packages that share an underlying design philosophy, grammar, and data structure, which provides a comprehensive, reproducible, and object-oriented computational framework. TidyMass was designed on the strength of the following strategies: 1) Cross-platform utility. TidyMass is developed using the R language, so it can be installed on most of the commonly used operating systems, namely Windows, Mac OS, and Linux (Ubuntu and CentOS); 2) Uniformity, shareability, traceability, and reproducibility. A uniform data structure has been developed, specifically designed to store and manage processed metabolomics data and processing parameters, making it possible to trace the prior analysis steps and parameters. It could be used in the entire workflow to make it an object-oriented workflow and easy to share; 3) Flexibility and extensibility. The modular architecture makes tidyMass a highly flexible and extensible tool, that users can choose any part of the project in their pipeline. Additionally, users can also improve and integrate it with their own pipeline easily.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>The design concept of tidyMass</title>
      <p id="Par6">A modular architecture was implemented for the design of the tidyMass project (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>), which means all the functions with the same aims are grouped into one package. For example, all the functions used for metabolite annotation were combined as one package metID<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> in tidyMass. The modular architecture makes tidyMass flexible and extensible, which is popular for R package design<sup><xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR25">25</xref></sup>. Users can choose either package from tidyMass according to their own pipeline. In addition, due to the modular architecture, it is possible to locate any bugs, enabling them to be fixed easily, and it’s possible for the authors/developers to develop new functions/packages, which means that it is extensible.<fig id="Fig1"><label>Fig. 1</label><caption><title>The design concept of tidyMass.</title><p><bold>a</bold> The object-oriented and module architecture of tidyMass. One uniform data structure is used in the whole workflow and all the processing information and arguments are stored here. The functions are grouped into multiple packages based on their aim. <bold>b</bold> Interoperability of tidyMass with other existing tools. The data structures of other tools could be converted to the object of tidyMass and then processed or analyzed using the tidyMass. The object of tidyMass can also be converted to other data structures of other tools, and then processed. Icons used in this figure are from <ext-link ext-link-type="uri" xlink:href="http://www.iconfont.cn/">www.iconfont.cn/</ext-link>.</p></caption><graphic xlink:href="41467_2022_32155_Fig1_HTML" id="d32e453"/></fig></p>
      <p id="Par7">Beyond that, the tidyMass is an object-oriented workflow (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>), that makes the workflow simpler and clearer to use. The uniform data structure (object) is the kernel of tidyMass, which is specifically designed to store and manage processed metabolomics data. All the functions employ a uniform data structure in the whole workflow, which benefits users for the preparation of data that will be inputted with less time required for this step compared to other tools.</p>
      <p id="Par8">The last concept is that tidyMass has high interoperability with other existing tools (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>), which is a crucial feature (numerous powerful tools have been developed in the community). To avoid reinventing the wheel and to enable the utilization of existing tools, we use a uniform data structure in tidyMass that can be converted with other data structures required by other tools, enabling easy integration (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>).</p>
    </sec>
    <sec id="Sec4">
      <title>The uniform data structure “mass_dataset” of tidyMass</title>
      <p id="Par9">We first designed a specific uniform data structure (“mass_dataset”) to efficiently store and manage processed untargeted metabolomics data (Fig. <xref rid="Fig2" ref-type="fig">2</xref>). Several packages in R provide the object-oriented class for efficient manipulation of sequencing data<sup><xref ref-type="bibr" rid="CR26">26</xref>,<xref ref-type="bibr" rid="CR27">27</xref></sup>, and although a similar concept (XCMS3, <ext-link ext-link-type="uri" xlink:href="https://github.com/sneumann/xcms">https://github.com/sneumann/xcms</ext-link>) has been also utilized in the metabolomics field<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, there is no specific uniform data form for the whole processing/analysis workflow for LC-MS-based untargeted metabolomics data. In the “mass_dataset” class, the expression dataset (metabolic feature table), metadata of samples, and variables are included. Additionally, the datasets are automatically synchronous, so when the users operate one component, it will automatically propagate the operations across all corresponding components (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). This makes it easy to manipulate and maintain the consistency of the data. All the functions in tidyMass use the “mass_dataset” as their primary input data format, therefore one data structure can be used for all processing and analysis steps (Fig. <xref rid="Fig3" ref-type="fig">3</xref>). Additionally, the “mass_dataset” class supports popular tools from other packages, in particular tidyverse, which is one of the most widely used tools for data science in the R environment<sup><xref ref-type="bibr" rid="CR28">28</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>). This design makes the code of tidyMass more universal and straightforward, which benefits new users as they do not need to adopt new functions. Furthermore, all the parameters for the processing and analysis are stored in the “mass_data” class object, which makes it feasible to trace the prior steps and parameters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4</xref>). Briefly, the “mass_dataset” class provides a simple way to manage and process metabolomics data (processed data, not raw MS data) which sets the foundation for the highly reproducible, robust, and extendable analytical framework.<fig id="Fig2"><label>Fig. 2</label><caption><title>The “mass_dataset” class and its components.</title><p>The “mass_dataset” class is a uniform data infrastructure, which is specifically designed for representing metabolomics data. Most functions in the tidyMass accept this class as their input data format, and all the parameters for the functions can be stored within. MV: missing value.</p></caption><graphic xlink:href="41467_2022_32155_Fig2_HTML" id="d32e518"/></fig><fig id="Fig3"><label>Fig. 3</label><caption><title>Analysis workflow of tidyMass.</title><p><bold>a</bold> Raw data processing using massConverter and massProcesser. <bold>b</bold> The “mass_dataset” class provides a uniform data structure and object-oriented workflow (in the massDataset package). <bold>c</bold> Data cleaning using massCleaner. <bold>d</bold> Metabolite annotation using metID. <bold>e</bold> Statistical analysis using massStat. <bold>f</bold> Biological function mining using metPath, including pathway analysis and network analysis. Icons used in this figure are from <ext-link ext-link-type="uri" xlink:href="http://www.iconfont.cn/">www.iconfont.cn/</ext-link>.</p></caption><graphic xlink:href="41467_2022_32155_Fig3_HTML" id="d32e552"/></fig></p>
    </sec>
    <sec id="Sec5">
      <title>Interoperability with other tools</title>
      <p id="Par10">To take advantage of existing tools, we developed several functions that can convert the “mass_dataset” class with other data structures required by other tools, thus users can easily integrate tidyMass with other tools in their own pipeline. At present, the XCMS algorithm<sup><xref ref-type="bibr" rid="CR7">7</xref></sup> is only implemented in tidyMass for peak picking and grouping, functions that can convert data formats generated by mzMine and MS-DIAL have been developed, therefore, users can convert the peak picking table from other tools (e.g.: MS-DIAL and mzMine) directly to “mass_dataset” class and then perform subsequent processing using tidyMass. The “SummarizedExperiment” class in the SummarizedExperiment package presents a popular data structure for multiple omics data analysis packages in the R environment, especially for RNA-seq data analysis tools<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>. Some R packages developed for metabolomics also support this data structure, such as the “MetaboAnnotation” package (metabolite annotation) from the RforMassSpectrometry project<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. So users can convert from the “mass_dataset” class to the “SummarizedExperiment” class and then annotate metabolites using the “MetaboAnnotation” package. In addition, the “mass_dataset” class can also be converted to the “mzTab-M” format<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, MetDNA format<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. etc (<ext-link ext-link-type="uri" xlink:href="https://massdataset.tidymass.org/articles/interoperability_with_other_tools.html">https://massdataset.tidymass.org/articles/interoperability_with_other_tools.html</ext-link>), which makes tidyMass own high interoperability with other existing tools.</p>
    </sec>
    <sec id="Sec6">
      <title>The whole workflow of tidyMass</title>
      <p id="Par11">TidyMass provides a set of functions that takes the “mass_dataset” class as the input data format to perform the whole workflow (Fig. <xref rid="Fig3" ref-type="fig">3</xref> and Supplementary Data <xref rid="MOESM3" ref-type="media">1</xref>). Be the similar to the concept of tidyverse<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>, tidyMass does not include all the functions in one package, which is flexible for both users and project managers. TidyMass is a collection of multiple R packages, where the different packages correspond to different steps of the workflow (Fig. <xref rid="Fig3" ref-type="fig">3</xref>). The modular design makes it easy for the user to find appropriate functions, and for developers to debug and extend it<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. Briefly, the workflow begins from the package massConverter, which converts MS raw data from different vendors to other formats (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). MassConverter depends on the docker version of msconvert<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, making it possible to use it on all computational platforms. Therefore, the data conversion step can also be integrated with other processing and analysis steps in one code script, which makes the end-to-end reproducible analysis possible. Next, raw data processing, peak picking and grouping are performed by the massProcesser package which is based on XCMS<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, an object (“mass_dataset” class) is generated for subsequent analysis in this step. Before moving forward to statistical analysis, data cleaning is performed to remove unwanted variation by the massCleaner package<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, which carries out noisy feature and outlier sample removal, missing value imputation, data normalization and integration. In the next step, the metID package performs metabolite annotation using in-house or public databases<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. All the statistical analyses are aimed at finding the potential differentially expressed metabolites using the massStat package<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. Finally, pathway enrichment analysis is implemented to identify biological functions using the metPath package. Notably, in any step of the workflow, the massQC package can be used to assess the data quality. What should be noted is that, due to the modular design and interoperability of tidyMass, users can easily integrate tidyMass with other tools, which means that the users can customize their own processing and analysis pipeline based on tidyMass.</p>
    </sec>
    <sec id="Sec7">
      <title>Reproducible analysis with tidyMass</title>
      <p id="Par12">Data sharing and reproducible analysis are of utmost importance to avoid biased findings<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. Multiple tools offer different parameters, options, and output formats for users. TidyMass is designed to achieve reproducibility and transparency in two aspects. First, the object-oriented class makes it easy to share the data and trace the processing information<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>. Second, with the uniform data structure and modular design, the users can seamlessly combine all the processing and analyzing steps in an integrative manner in one code script (<italic>e.g</italic>., Rmarkdown, notebook). In addition, all the steps are optional, and the order of execution is customizable, which means that the users can create and optimize customized sharable and reproducible pipelines based on their experimental design and aims. Furthermore, as docker technology is more and more popular in reproducible analysis, we also provide a docker version of tidyMass, containing a R/Rstudio environment and all the tidyMass packages, which makes it possible for users to share all code, data, and even analysis environment based on tidyMass.</p>
    </sec>
    <sec id="Sec8">
      <title>Case study</title>
      <p id="Par13">For showing the application of tidyMass processing metabolomics data, we used data from the untargeted LC–MS-based metabolomics analysis of colorectal cancer (CRC) patient tissues to identify metabolites of CRC by sex of the patient<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). First, raw data were converted to the mzML format through ProteoWizard<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>, followed by the massProcesser to extract the metabolic features. Features with more than 20% missing values (MV) in QC samples or more than 50% MVs in all the study groups were considered noisy features and were removed. K-nearest neighbors (KNN) algorithm was applied for MV imputation, and support vector regression (SVR) enabled data normalization using massCleaner (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6</xref>). For metabolite annotation, two in-house databases were constructed using metID, that contain 71 and 55 metabolites in HILIC and RPLC modes, respectively. The databases contain the accurate mass and experimental retention time of metabolites. A public database<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> was also used for metabolite annotation. Finally, the redundant annotations were removed based on the annotation score<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, and 74 metabolites were identified using the in-house database and up to metabolomics standards initiative (MSI) level 2<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. Only the annotations with level 2 were used for subsequent analysis. We then detected the differentially expressed metabolites between tumor tissues compared to normal controls for males and females separately, using massStat (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a; Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>). Furthermore, metPath was used for pathway enrichment. In addition to our previous findings wherein sex-related differences were observed in methionine, pentose phosphate pathway, methionine metabolism and polyamine metabolism<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, we also observed differential enrichment of additional pathways in tumors from female and male patients (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). For example, ferroptosis and bile acid synthesis was only enriched in tumors from male patients (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). Glutathione metabolism, the cAMP signaling pathway, cGMP-PKG signaling pathway were all enriched in tumors from female patients, but not from males. In addition, tidyMass expedited the analytical workflow, making it more straightforward to analyze and reproducible using a code script (Supplementary Data <xref rid="MOESM4" ref-type="media">2</xref> and <xref rid="MOESM5" ref-type="media">3</xref>). A docker image containing the data, code, and analysis environment is also provided for more straightforward reproducible analysis (<ext-link ext-link-type="uri" xlink:href="https://hub.docker.com/r/jaspershen/tidymass-case-study">https://hub.docker.com/r/jaspershen/tidymass-case-study</ext-link>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Biological function mining for the case study.</title><p><bold>a</bold> Volcano plots show the differentially expressed metabolites. <bold>b</bold> Pathway enrichment analysis. Only the pathways that are different between sexes were labeled. Sex differences in <bold>c</bold> methionine and polyamine pathways, and <bold>d</bold> pentose phosphate pathway metabolism. <italic>SAM</italic> S-adenosylmethionine, <italic>SAH</italic> S-adenosylhomocysteine.</p></caption><graphic xlink:href="41467_2022_32155_Fig4_HTML" id="d32e733"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par14">Several command-line tools have been developed so far, however, limitations still exist. As we know, RforMassSpectrometry is a project that is not only designed for metabolomics specificity, but also for proteomics and metabolomics (<ext-link ext-link-type="uri" xlink:href="https://www.rformassspectrometry.org/">https://www.rformassspectrometry.org/</ext-link>) which is designed for fundamental metabolomics data processing and data management (mass spectrometry raw data processing and analysis). There are no functions for data cleaning, statistical analysis, and pathway enrichment. MetaboanalystR<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> is one of the most popular web-based tools for metabolomics in the R version. However, it is not developed based on module design and does not support tidyverse and other tools in R. Additionally, the “mSet” in metaboanalystR cannot store processing history and arguments. We compared tidyMass with other existing tools (Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref> and Supplementary Note <xref rid="MOESM1" ref-type="media">1</xref>) for highlighting the differences between tools, and show the rationale behind the development of our novel computational framework that can support other popular packages in R. In terms of tidyMass development, our aim was to avoid “reinventing the wheel”, instead, we enabled the easy integration of the “mass_dataset” with other specific tools in R. In summary, the tidyMass project is an ecosystem of R packages that share an underlying design philosophy, grammar, and uniform data structure, which provides a comprehensive, transparent, traceable, reproducible, and object-oriented computational framework for LC–MS-based metabolomics data processing and analysis within the R environment. As such, a complete website for tidyMass is publicly available (<ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/">https://www.tidymass.org/</ext-link>). TidyMass can provide great benefit for the metabolomics field, particularly in the two following aspects: (1) Data sharing, tracing, and reproducible analyses. TidyMass provides a specific uniform data structure and a whole object-oriented workflow, including a docker image, making data sharing, tracing, and reproducible analysis more straightforward, providing metabolomics researchers the ability to share and repeat analysis feasibly. In addition, because of the uniform data structure (“mass_dataset” class object) in tidyMass, we can store and track the parameters for each processing/analysis step that has been applied to metadata throughout the analysis. This offers a solution for the poor metadata tracing in the metabolomics data analysis field. (2) Flexibility and extensibility. The object-oriented and modular design concept allows for the easy integration of other tools with tidyMass, therefore making tidyMass flexible and extensible within the metabolomics community. An example that illustrates the functions of the tidyverse can be located here: <ext-link ext-link-type="uri" xlink:href="https://massdataset.tidymass.org/articles/tidyverse_verse">https://massdataset.tidymass.org/articles/tidyverse_verse</ext-link>. However, as a fast-growing field, some widely used metabolomics tools are not wrapped up or supported in tidyMass, it is capable to convert the “mass_dataset” class to more eligible data structures for these tools in the future. Meanwhile, as an open-source tool, tidyMass can be easily implemented into the other pipelines.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>TidyMass project</title>
      <p id="Par15">TidyMass project is an ecosystem of R packages that share an underlying design philosophy, grammar, and data structure, which utilizes the concept of tidyverse<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>. To address the challenges of data sharing, reproducible analysis, and extensibility, we adopted the object-oriented and modular design concepts, which are also leveraged by other tools<sup><xref ref-type="bibr" rid="CR23">23</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
      <sec id="Sec12">
        <title>Object-oriented workflow</title>
        <p id="Par16">In tidyMass, the “mass_dataset” class is designed specifically for storing the metabolomics data and relevant metadata. Most of the functions in all the packages use it as the input data and output format. Based on the “mass_dataset” class and the pipeline function (%&gt;%) from tidyverse, tidyMass provides an object-oriented workflow of data processing and analysis, which is clear and more straightforward.</p>
      </sec>
      <sec id="Sec13">
        <title>Modular design</title>
        <p id="Par17">In tidyMass, different packages correspond to different steps of the whole workflow for LC–MS-based untargeted metabolomics data processing and analysis. The fundamental functions are placed in one package named massTools, therefore all the other packages can call those functions from it. Additionally, other developers can easily call these functions in their pipeline. Currently, nine packages in total are included to perform the whole workflow, from raw data processing to biological function mining, and the many graphic functions allow users to generate publication-quality graphics (<ext-link ext-link-type="uri" xlink:href="https://massdataset.tidymass.org/articles/ggplot_mass_dataset">https://massdataset.tidymass.org/articles/ggplot_mass_dataset</ext-link>). Most of the functions and tools that are widely used are included or supported in tidyMass. For functions/tools that are not yet wrapped, it is simple to implement and integrate them with tidyMass. Finally, one package named “tidymass” was developed to easily install and manage all the packages in the project. For each package, a website with function and package-level help documents and reproducible examples was created to guide new users on how to use it.</p>
      </sec>
      <sec id="Sec14">
        <title>Naming and Coding style</title>
        <p id="Par18">In tidyMass, we strove to provide concise and meaningful names. To make the tidyMass more user-friendly and easier to use, the coding style of tidyMass follows the tidyverse style guide (<ext-link ext-link-type="uri" xlink:href="https://style.tidyverse.org/">https://style.tidyverse.org/</ext-link>). Briefly, all the names of packages in the tidyMass project start from “mass” or “met” and follow a noun to describe their function. Such as “massCleaner” which is used for data cleaning and “massQC” which is used for data quality assessment. The variable and function names follow the snake case naming policy, using only lowercase letters, numbers, and underscores are used to separate words within a name. Generally, all the variable names are nouns, and function names are verbs.</p>
      </sec>
      <sec id="Sec15">
        <title>Help document and tutorials</title>
        <p id="Par19">We provide the function-level, package-level, and pipeline-level help documents and tutorials as a learning guide for tidyMass. For the function-level help document, the users can find it on the “Reference” page on the corresponding website for each package. It is also possible to access them quickly in the R environment using the “?” function. For the package-level and pipeline-level, the websites are created using the “pkgdown” tools for all the packages, the users can find the help document or tutorial on the “Help document” or “Tutorial” page.</p>
      </sec>
      <sec id="Sec16">
        <title>Avoiding reinventing the wheel</title>
        <p id="Par20">When we designed tidyMass, another important rule was that we did not want to create redundant tools which have similar functions to existing tools. For example, when we want to remove variables from “mass_dataset”, the “filter()” function from the dplyr package is more efficient and popular in the R community. We do not need to create a new function to process the “removing features” step. So in tidyMass, we made use of the base or popular functions in R to support “mass_dataset” to operate the same functions (<ext-link ext-link-type="uri" xlink:href="https://massdataset.tidymass.org/articles/tidyverse_verse">https://massdataset.tidymass.org/articles/tidyverse_verse</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://massdataset.tidymass.org/articles/base_function">https://massdataset.tidymass.org/articles/base_function</ext-link>). This design also makes it easier for new users to adopt tidyMass and reduce their study burden, it also means that the tidyMass code is more readable and shareable.</p>
      </sec>
      <sec id="Sec17">
        <title>Deployment and Installation</title>
        <p id="Par21">All the packages in the tidyMass project are open-source and can be accessed publicly. In case the internet is not stable for one code hosting platform, we deployed it in three different code hosting platforms, namely GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/tidymass">https://github.com/tidymass</ext-link>), GitLab (<ext-link ext-link-type="uri" xlink:href="https://gitlab.com/dashboard/projects">https://gitlab.com/dashboard/projects</ext-link>), and Gitee (<ext-link ext-link-type="uri" xlink:href="https://gitee.com/jaspershen/dashboard/projects">https://gitee.com/jaspershen/dashboard/projects</ext-link>). Any changes will be updated on the three platforms at the same time, so the users can access and install them from at least one platform in any situation.</p>
      </sec>
    </sec>
    <sec id="Sec18">
      <title>MassDataset package</title>
      <p id="Par22">The massDataset package is used to provide a uniform data form/structure for LC–MS-based untargeted metabolomics data, relevant metadata, and the corresponding processing parameters (<ext-link ext-link-type="uri" xlink:href="https://massdataset.tidymass.org/">https://massdataset.tidymass.org/</ext-link>). Several packages in R provide the object-oriented class for efficient manipulation of sequencing data<sup><xref ref-type="bibr" rid="CR26">26</xref>,<xref ref-type="bibr" rid="CR27">27</xref></sup>, and although a similar concept (XCMS3, <ext-link ext-link-type="uri" xlink:href="https://github.com/sneumann/xcms">https://github.com/sneumann/xcms</ext-link>) has been also utilized in the metabolomics field<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, there is still no specific uniform data form for the whole processing/analysis workflow for LC–MS-based untargeted metabolomics data. Therefore, the massDataset package and the “mass_dataset” class, were specifically designed to store and manage processed metabolomics data and represent this data as an instance of the main data class. This is a key feature of the tidyMass project, all the subsequent wrapped operation functions use this class as their sole or primary input data form.</p>
      <sec id="Sec19">
        <title>The “mass_dataset” class</title>
        <p id="Par23">The “mass_dataset” is an S4 object in the R environment that contains nine components (Fig. <xref rid="Fig3" ref-type="fig">3</xref>), including (1) expression data (expression_data) is a data frame that represents the abundance of all the metabolic features (peaks) in all samples. Each row is a metabolic feature (peak) and each column is a sample. (2) Sample information (sample_info) is a data frame that represents the metadata of samples. The first column is the sample IDs which should be completely identical to the column names of the expression data. Other columns are the attributes of samples, such as subject ID, sample batch, injection order, etc. (3) Variable information (variable_info) is a data frame that represents the metadata of variables (metabolic features or peaks). The first column is the variable IDs which should be completely identical to the row names of the expression data. Other columns are the attributes of variables, such as m/z, rt and mean intensity, etc. (4) Variable information note (variable_info_note) is a data frame that represents the metadata of variable information. (5) Sample information note (sample_info_note) is a data frame that represents the metadata of sample information. (6) MS<sup>2</sup> spectra (ms2_data) is a list (“ms2_data” class) that is used to store the MS<sup>2</sup> spectra for peaks. For each spectrum, the parent ion information, MS<sup>2</sup> spectrum (a data frame with fragment ion m/z and intensity), and the corresponding peak are stored. (7) Annotation result (annotation_table) is a data frame representing the annotation results for variables. (8) Processing information (process_info) is a list (“tidymass_parameters” class) that is used to store the parameters for each processing/analysis step that has been applied to the “mass_dataset” class. The “mass_dataset” is utilized to store the processed metabolomics data, but not the raw mass spectrometry data. However, the raw data information (for example BPC and TIC) could be found in the massProcesser package. The “Spectra” package from the RforMassSpectrometry project provides a scalable and flexible infrastructure (“Spectra” class object) to represent, retrieve and handle mass spectrometry (MS) data. However, this “Spectra” class is only specifically created to represent the spectra data (MS<sup>2</sup> spectra) of metabolic features. It is not similar to the “mass_dataset” class, which not only can be used to store MS<sup>2</sup> spectra data, but can also be used to store the expression dataset, metadata, and variable information.</p>
      </sec>
      <sec id="Sec20">
        <title>Automatic synchronization of components in the “mass_dataset” class</title>
        <p id="Par24">The components in “mass_dataset” are relevant. For example, the columns of expression data should completely correspond to the rows of sample information, and the rows of expression data should completely correspond to the rows of variable information. When one component in the “mass_dataset” class is modified, other components which are relevant to the changed component will automatically change to keep the consistency of all the components (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). This design makes it easier to modify the datasets and keep them consistent.</p>
      </sec>
      <sec id="Sec21">
        <title>The addition of MS<sup>2</sup> data to the “mass_dataset” class</title>
        <p id="Par25">MS<sup>2</sup> spectra data is important for LC–MS-based untargeted metabolomics data for metabolite annotation. One MS<sup>2</sup> spectrum is defined by the spectrum information (parent ion information) and MS<sup>2</sup> spectrum data frame. The spectrum information records the parent ion m/z, retention time, and other information. The MS<sup>2</sup> spectrum data frame is a matrix with two columns, fragment <italic>m/z</italic>, and intensity. In the massDataset package, the MS<sup>2</sup> spectra data can be added to the “mass_dataset” class using the “mutate_ms2()” function. Briefly, the MS<sup>2</sup> spectra are extracted from the MS<sup>2</sup> data files (mgf format), and then each MS<sup>2</sup> spectrum, it will be assigned to metabolic features based on m/z and retention time matching<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. To organize and process the MS<sup>2</sup> data in the “mass_dataset” class, a class named “ms2_data” is designed.</p>
      </sec>
      <sec id="Sec22">
        <title>Base operation functions for the “mass_dataset” class</title>
        <p id="Par26">Base operation functions have been provided in the massDataset package to process the “mass_dataset” class. The functions can be divided into four classes (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>). (1) The first class of functions is used to extract and output datasets in “mass_dataset”. (2) The second class of functions is used to summarize and explore data. (3) The third class of functions is used to preprocess data. For example, add new information, and remove samples/variables. (4) The fourth class functions are used to combine or merge two “mass_dataset” class objects. To reduce the difficulty and cost of learning, for the functions which are widely used in R for the same aims but in other objects, we wrapped them in massDataset and made the “mass_dataset” class as their input data form. For example, the “filter()” functions from the tidyverse package are widely used in data science to remove eligible variables, so this function is wrapped and users can filter variables from any components in “mass_dataset”.</p>
      </sec>
      <sec id="Sec23">
        <title>The “tidymass_parameter” class</title>
        <p id="Par27">To store the parameters for each step that is applied on the “mass_dataset” class, a <italic>“</italic>tidymass_parameter<italic>”</italic> class was designed in massDataset. Briefly, four slots are in the “tidymass_parameter” class, namely package name, function name, processing time, and parameter list. The parameter is stored as a list, whose items are specific settings, and the names are arguments. The “tidymass_parameter” classes for all the processing/analysis steps are stored in the “process_info” slot of the “mass_dataset” class and ordered by processing time. Thus, it is possible and easy for the users to trace the processing and analysis of this object. This is another key design in the tidyMass project, which provides the fundamentals for reproducible analysis.</p>
      </sec>
    </sec>
    <sec id="Sec24">
      <title>MassConverter package</title>
      <p id="Par28">The massConverter package is used to convert mass spectrometry raw data to different format data (<ext-link ext-link-type="uri" xlink:href="https://massconverter.tidymass.org/">https://massconverter.tidymass.org/</ext-link>). MSconvertGUI is the interactive version of the msconvert tool for converting mass spec data files to various formats, which is widely used in the metabolomics field<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. It also provides the command line version. However, it is software that can only be installed on Windows OS, so cannot be used by Mac OS and Linux users. To achieve a comprehensive reproducible analysis, it is important to do the data converting and record the parameters in the R environment.</p>
      <sec id="Sec25">
        <title>Docker version of msconvert</title>
        <p id="Par29">The team provides a docker version of msconvert (pwiz, <ext-link ext-link-type="uri" xlink:href="https://hub.docker.com/r/chambm/pwiz-skyline-i-agree-to-the-vendor-licenses">https://hub.docker.com/r/chambm/pwiz-skyline-i-agree-to-the-vendor-licenses</ext-link>), so the massConverter package can convert mass spectrometry raw data to different formats. The users need to install docker based on the official website (<ext-link ext-link-type="uri" xlink:href="https://www.docker.com/get-started">https://www.docker.com/get-started</ext-link>). Then they pull the pwiz image by using the “docker_pull_pwiz()” function, which will download the pwiz image from the docker hub, therefore it can be used for converting data.</p>
      </sec>
      <sec id="Sec26">
        <title>Convert data</title>
        <p id="Par30">Many parameters are included in the mass spectrometry data conversion. The “create_msconvert_parameter()” function is used to set the converting parameters. The detailed converting parameters and their meanings can be found in Supplementary Table <xref rid="MOESM1" ref-type="media">2</xref>. After setting the parameters, the “convert_raw_data()” function is used to convert the raw data to other formats. The massConverter package makes it possible to convert the mass spectrometry data using R, and integrate data converting steps with other data processing and analysis in one code file, making the reproducible analysis of metabolomics data more efficient.</p>
      </sec>
    </sec>
    <sec id="Sec27">
      <title>MassProcesser package</title>
      <p id="Par31">The massProcesser package is used for mass spectrometry raw data processing, including peak picking and peak grouping based on the widely used XCMS<sup><xref ref-type="bibr" rid="CR7">7</xref></sup> (<ext-link ext-link-type="uri" xlink:href="https://massprocesser.tidymass.org/">https://massprocesser.tidymass.org/</ext-link>). We have added some new functions to make the results more interpretable. After the processing, a “mass_dataset” class is generated with simple sample information. Then users can add more information directly to it for subsequent processing and analysis using other packages from the tidyMass project. This makes it smoother and more straightforward to combine raw data processing and other processing/analysis steps. In addition, all the graphics from massProcesser, such as “BPC”, “TIC”, and “retention time correction” are generated using the ggplot2 package, which generates high-quality figures for publication. Another important feature of the massProcesser package is that the users can easily extract and score the EIC of all the features and evaluate the quality of features, so can avoid false-positive findings in the subsequent analysis. The raw data processing is optional in the whole workflow, users can use other software/tools to generate peak tables.</p>
    </sec>
    <sec id="Sec28">
      <title>MassCleaner package</title>
      <p id="Par32">The massCleaner package is used to perform the data cleaning of metabolomics data (<ext-link ext-link-type="uri" xlink:href="https://masscleaner.tidymass.org/">https://masscleaner.tidymass.org/</ext-link>). The LC–MS-based untargeted metabolomics data typically contains different types of bias arising from sample preparation and data acquisition (e.g., contamination, drift in signal intensity.), this is the reason to perform data cleaning as an essential step, to remove unwanted variations. It can be divided into different steps, some steps are optional, and the orders can be customized based on the study design and aims.</p>
      <sec id="Sec29">
        <title>Noisy feature removal</title>
        <p id="Par33">The noisy feature removal can be used based on different rules, according to the experimental aims and design. The functions in massDataset and other packages make it simple to perform the noisy feature removal. For example, the users can define the noisy features as the metabolic features that have missing values more than in 20% QC samples or in 50% subject samples. So the “mutate_variable_na_freq()” function can be added to variable information and then remove the noisy features using the “filter()” function from the dplyr package.</p>
      </sec>
      <sec id="Sec30">
        <title>Outlier samples removal</title>
        <p id="Par34">Outlier samples are a recurrent problem, especially when analyzing large cohorts. Detecting and removing the outlier samples are critical to avoid false positive and false negative findings in the subsequent analysis. Different methods have been used to define and detect outlier samples in tidyMass<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>. The first rule is the missing value percentage for each sample<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. If one sample with more than 50% features is missing values, it means that there may be issues in the sample preparation or data acquisition, so those samples are labeled as an outlier. Other methods are also included to detect outlier samples<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. In brief, all the biological subject samples are used for PCA analysis, then the samples whose principal component 1 (PC1) are more than 6 standard deviations away from the mean value will be labeled as outlier samples. To make this method more robust, we also calculate the median instead of the mean value, and MAD (median absolute deviation) instead of the SD (standard variation) because they are more robust estimators. The last method is based on distance. Instead of using the infinite distance, Mahalanobis distance is a multivariate distance based on all variables (principal components) at once. We use a robust version of this distance, which is implemented in packages “robust” and “robustbase” and that is reexported in “bigutilsr”. Once the outliers have been detected by different methods, it is easy for users to remove the samples from the “mass_dataset” class according to their study aims using the “filter()” function.</p>
      </sec>
      <sec id="Sec31">
        <title>Missing value imputation</title>
        <p id="Par35">Missing value imputation should be performed after noisy features and outlier sample removal. In massCleaner, four widely used methods are implemented to perform missing value imputation: (1) K-nearest neighbors (KNN)<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>, (2) Bayesian principal component analysis replacement (BPCA)<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>, (3) svdImpute<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>, (4) random forest imputation (missForest)<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>, (5) zero values, (6) mean values, (7) median values and (8) minimum values. KNN is recommended to impute missing values and set them as default<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>.</p>
      </sec>
      <sec id="Sec32">
        <title>Data normalization and integration</title>
        <p id="Par36">Data normalization and integration are important to remove the unwanted analytical variations occurring in intra- and inter-batch measurements and to integrate multiple batches forming an integral data set for subsequent statistical analysis<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. In the metCleaner package, several methods that are widely used are integrated. The methods can be divided into two different classes. The first class is the sample-wise method, including PQN, median, mean, and total intensity normalization<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. Total intensity normalization means that all the variable intensity is divided by the total intensity of all the variables in one sample. This method sets the total sum of signals to a constant value for each sample. The median and mean normalization have the same concept. However, these approaches could be hampered. For instance, in the case of large mass differences between samples that may lead to different variable extraction efficiencies between samples<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. The second class is the QC sample-based data normalization, including SVR<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>, and LOESS<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. QC samples are typically generated by mixing aliquots of each subject sample and are regularly analyzed during an experimental run to monitor the stability of the analytical platform and are particularly useful for identifying batch effects. For QC-based data normalization, they require that the first and last injections should be QC samples. The data integration method is used to integrate multiple batch data. In the massCleaner function, the QC median, QC mean, subject means, and the subject median for each variable (metabolic feature or peak) can be used as the correction factors for integrating batches<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>.</p>
      </sec>
    </sec>
    <sec id="Sec33">
      <title>MassQC package</title>
      <p id="Par37">The massQC package is used to assess the data quality of LC–MS-based untargeted metabolomics (<ext-link ext-link-type="uri" xlink:href="https://massqc.tidymass.org/">https://massqc.tidymass.org/</ext-link>). The data quality of metabolomics is visually assessed by several aspects. (1) Missing value distribution across samples and/or variables. If one variable (metabolic feature or peak) has more missing values, it means that this variable may be a noisy feature. The same applies to samples that have lots of missing values, it could signify that they are outlier samples that should be removed. (2) RSD (relative standard deviation) for all variables in QC (quality control) samples. Since the QC samples are similar and injected frequently during the data acquisition, the RSD of variables in QC samples can be utilized to evaluate the stability of LC and mass spectrometry. In biomarker discovery, the cutoff is always set as 30%. (3) Intensity of all variables in samples. For QC samples, the median value of the intensity of all variables should be very close. (4) The correlation of QC samples. (5) PCA score plot. The high-quality data assessed by a PCA should show a tight clustering of QC samples relative to the distribution of non-QC samples. In massQC, the users can use the “mass_dataset” as the argument to get the result for each aspect in any step of the whole workflow. In addition, one function named “massqc_report()” can be used to generate an HTML format report including all the results, which is very convenient (<ext-link ext-link-type="uri" xlink:href="https://massqc.tidymass.org/articles/html_qa_report">https://massqc.tidymass.org/articles/html_qa_report</ext-link>).</p>
    </sec>
    <sec id="Sec34">
      <title>MetID package</title>
      <p id="Par38">The metID package is used to perform metabolite annotation based on in-house and available open-source databases (<ext-link ext-link-type="uri" xlink:href="https://metid.tidymass.org/">https://metid.tidymass.org/</ext-link>)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. It combines information from all major databases for comprehensive and streamlined compound annotation. The annotations from metID are assigned confidence levels according to MSI<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> (in-house database, level 1; public MS<sup>2</sup> database, level 2; MS<sup>1</sup> database, level 3). MetID is a flexible, simple, and powerful tool allowing the compound annotation process to be fully automatic and reproducible. What should be noted is that metID<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> was not originally designed for the tidyMass project, so it does not support “mass_dataset”. However, it is simple to integrate with tidyMass, which demonstrates the flexibility and extensibility of tidyMass. To integrate metID with the tidyMass project, a function named “annotate_metabolites_mass_dataset()” has been developed to support the “mass_dataset” class. All the annotation results have been organized as a data frame and assigned to “annotation_table” in the “mass_dataset” class. The annotation parameters (matching parameters, the database used, etc.) are also assigned to processing information. The users can access the annotation table in “mass_dataset” by using the “extract_annotation_result()” function.</p>
    </sec>
    <sec id="Sec35">
      <title>MassStat package</title>
      <p id="Par39">The massStat package is used to perform common statistical analyses within metabolomics analysis (<ext-link ext-link-type="uri" xlink:href="https://massstat.tidymass.org/">https://massstat.tidymass.org/</ext-link>). The massStat package provides efficient tools for the different steps required within the complete data analytics workflow: scaling, univariate analysis, multiple testing correction, multivariate analysis, candidate biomarkers selection, and correlation network analysis.</p>
      <sec id="Sec36">
        <title>Scaling</title>
        <p id="Par40">Scaling is a procedure where each variable is modified by a factor and accounts for the different statistical characteristics of each variable. Without scaling, highly abundant compounds tend to dominate the analysis when variance-dependent techniques such as PCA are used. Now in massStat, three commonly used scaling methods are included. Unit-variance scaling (UV), divides each variable by its standard deviation. Pareto scaling, intermediate between no scaling and UV scaling, divides each variable by the square root of the standard deviation. Range scaling divides each variable by its range in all the samples.</p>
      </sec>
      <sec id="Sec37">
        <title>Univariate analysis</title>
        <p id="Par41">Commonly used univariate analysis tools have been implemented in tidyMass. Student’s t-test (R function t.test), and Wilcoxon signed-rank test (R function wilcox.test). The different multiple testing correction methods from p.adjust are also implemented. The fold change, <italic>p</italic> values, and adjusted p values are directly added to the variable information in “mass_dataset”.</p>
      </sec>
      <sec id="Sec38">
        <title>Correlation, distance, and correlation network</title>
        <p id="Par42">Correlation and distance between samples or variables can be calculated using the “cor_mass_dataset()” and “dist_mass_dataset()” functions. The “margin” argument is provided in both functions which requests the sample or variable correlation/distance matrix. The correlation network is widely used to explore the co-expression and co-regulation metabolites, in massStat, the users can obtain a network data format (from ggraph and tidygraph packages) from the “mass_dataset” class object. Then this object can be used for network analysis and visualization using the powerful network analysis ecosystem, including “ggraph”, “igrpah”, and “tidygraph”.</p>
      </sec>
      <sec id="Sec39">
        <title>Multivariate analysis</title>
        <p id="Par43">It is possible to perform various multivariate analyses, such as PCA, PLS, and PLS-DA. A typical first-pass unsupervised method used in untargeted LC–MS-based metabolomics is PCA. The score scatter plots, where each sample is depicted as a point, reveal how all samples relate to each other. Supervised methods such as PLS, PLS-DA<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>, and clustering are also provided.</p>
      </sec>
    </sec>
    <sec id="Sec40">
      <title>MetPath package</title>
      <p id="Par44">The metPath package enables pathway enrichment analysis for metabolomics (<ext-link ext-link-type="uri" xlink:href="https://metpath.tidymass.org/">https://metpath.tidymass.org/</ext-link>). At present, metPath provides two commonly used metabolic pathways for this analysis, KEGG<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, and SMPDB<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. To organize and manage the pathway database, a class named “pathway_database” was designed in the metPath package, which is used to store and manage the pathway data. Like the “mass_dataset” class, the “pathway_database” class can be operated by the base and tidyverse functions, which makes it easy to process and manage the pathway database. Then the Hypergeometric test or Fisher’s exact test is performed for pathway enrichment. Different visualization methods for enriched pathways are also provided based on ggplot2 to generate high-quality graphics.</p>
    </sec>
    <sec id="Sec41">
      <title>MassTools package</title>
      <p id="Par45">The massTools package provides useful tiny functions for mass spectrometry data processing and analysis (<ext-link ext-link-type="uri" xlink:href="https://masstools.tidymass.org/">https://masstools.tidymass.org/</ext-link>). It is a supporting and base package for the tidyMass project. Some functions are universal and may be used and called by different packages, so they are placed in the massTools package, therefore other packages can directly call those functions anytime and anywhere. For example, the MS<sup>2</sup> spectra matching plot can be used in different places, so it is also placed in the massTools package.</p>
    </sec>
    <sec id="Sec42">
      <title>TidyMass package</title>
      <p id="Par46">The tidyMass package is designed to organize and manage all the packages in the tidyMass project (<ext-link ext-link-type="uri" xlink:href="https://tidymass.tidymass.org/">https://tidymass.tidymass.org/</ext-link>), allowing for easy installation and loading multiple “tidyMass” packages in a single step. In brief, all the other packages in the tidyMass project are set as the dependent packages of it, so the users can install all the packages in the tidyMass project by only installing the tidyMass package. When one or more packages are updated in the tidyMass project, then users can easily check and update them using the tidyMass package. In addition, users can load all the packages into the R environment by only loading the tidyMass package.</p>
    </sec>
    <sec id="Sec43">
      <title>Extend tidyMass project</title>
      <p id="Par47">An increasing number of data processing and analysis tools are being developed within the field of metabolomics. This could be problematic, as the integration of these functions and tools is needed to enable their use in tidyMass. However, the specific and uniform data form (“mass_dataset” class) simplifies the integration of tools that are not wrapped in tidyMass for developers. In fact, in tidyMass, the R base function, tidyverse, and metID package have been integrated with the “mass_dataset” class. In brief, the function should change the “mass_dataset” as its supporting object, and then call the function to process or analyze. A protocol is available to show how to make a function that supports the “mass_dataset” class (<ext-link ext-link-type="uri" xlink:href="https://massdataset.tidymass.org/articles/based_on_mass_dataset">https://massdataset.tidymass.org/articles/based_on_mass_dataset</ext-link>). In addition, it is easy to integrate tidyMass with other pipelines. For example, xcmsrocker is an open-source project (<ext-link ext-link-type="uri" xlink:href="https://github.com/yufree/xcmsrocker">https://github.com/yufree/xcmsrocker</ext-link>) that was created and maintained by Dr. Miao Yu, this project houses various R packages for LC–MS-based metabolomics data processing and analysis, and tidyMass was recently implemented into this project. Another example is the Stanford Data Ocean (<ext-link ext-link-type="uri" xlink:href="https://innovations.stanford.edu/sdo">https://innovations.stanford.edu/sdo</ext-link>), which is a cloud-based computation platform for multi-omics data processing and analysis, and tidyMass is also implemented onto it.</p>
    </sec>
    <sec id="Sec44">
      <title>Data preparation for tidyMass</title>
      <p id="Par48">TidyMass is a flexible pipeline that utilizes the modular design concept, which means that the user can perform a comprehensive and full data processing workflow for metabolomics, or can choose to perform various or multiple steps of the workflow.</p>
      <sec id="Sec45">
        <title>Data preparation for massProcesser</title>
        <p id="Par49">If the users use the massProcesser package for raw data processing, the mzXML (or mzML) data format should be prepared. All the mzXML format files should be placed in different folders according to their class or group. For example, QC samples and blank samples should be placed into folders named “QC” and “Blank” folders, respectively. Biological subject samples can be placed in a folder named “Subject”, or placed into different folders that are named according to the class of samples, for example, “Control” or “Case”.</p>
      </sec>
      <sec id="Sec46">
        <title>Data preparation for other packages</title>
        <p id="Par50">The users can also use other software to perform raw data processing to generate the peak (metabolic feature) table, such as MS-DIAL<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR46">46</xref></sup>, mzMine<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>, etc. Then the data can be prepared and the “create_mass_dataset()” function is used to generate the “mass_dataset” class object. These files are required for the “create_mass_dataset()” class. The first file is “expression_data” which is a matrix to store the abundance for each variable in each sample. The column is a sample, and the row is variable. The second file is “sample_info” which is a matrix to store the metadata of samples. What should be noted is that the first column is sample ID (sample_id) which is completely identical to the column names of expression data. The third file is “variable_info” which is a matrix to store the metadata of variables. The first column is the variable ID (variable_id) which should be completely identical to the row names of expression data. In addition, the second column and third column should be mass-to-charge ratio (m/z) and retention time (rt, the unit is second), respectively, which are specific spectral information for mass spectrometry data.</p>
      </sec>
    </sec>
    <sec id="Sec47">
      <title>Reproducible analysis using tidyMass</title>
      <p id="Par51">One of the most important aims of tidyMass is to improve the reproducible analysis of LC–MS-based untargeted metabolomics data. In tidyMass, the “mass_dataset” class and modular design make it easier for data sharing and reproducible analysis of metabolomics data.</p>
      <sec id="Sec48">
        <title>Data sharing</title>
        <p id="Par52">We have enabled a straightforward method for tidyMass users to share their processed data. After preparing the datasets, a “mass_dataset” class object can be generated using the massDataset package, and then users can share the “mass_dataset” class object with collaborators without the need to share multiple files, which is the typical way of sharing this type of data. Collaborators can load the shared “mass_dataset” class object in the R environment and then directly and easily process it using tidyMass. The users can also output all the components in the “mass_dataset” class to xlsx or csv format, and share one or several files of their choosing.</p>
      </sec>
      <sec id="Sec49">
        <title>Reproducible analysis</title>
        <p id="Par53">We encourage users to share their data (“mass_dataset” class) and tidyMass pipeline with other collaborators or journals using R script or R markdown files. As the data processing and analysis code is written by R (tidyMass pipeline), it is straightforward for collaborators to easily reproduce the analysis and results. The demo data (“mass_dataset” class) and R code (R markdown) for our demo data have been provided on the tidyMass homepage (<ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/start/">https://www.tidymass.org/start/</ext-link>). The demo data and R script of the case study presented are also downloadable on the homepage (<ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/start/demo_data/">https://www.tidymass.org/start/demo_data/</ext-link>).</p>
      </sec>
      <sec id="Sec50">
        <title>Docker image of tidyMass</title>
        <p id="Par54">A docker image of tidyMass named “tidymass” has been deployed on the docker hub (<ext-link ext-link-type="uri" xlink:href="https://hub.docker.com/r/jaspershen/tidymass">https://hub.docker.com/r/jaspershen/tidymass</ext-link>). This docker image was developed based on the rocker image verse (<ext-link ext-link-type="uri" xlink:href="https://hub.docker.com/r/rocker/verse">https://hub.docker.com/r/rocker/verse</ext-link>), which contains a Rstudio and R environment, and installed most of the widely used data science packages, such as tidyverse. We installed all the packages in tidyMass with associated dependent packages, and the demo datasets and code were also implemented. The new docker image was then built and named “tidymass”. The docker version of tidyMass can be used for data analysis by downloading it and then opening the website version Rstudio for data analysis. The “tidymass” image can also be used as a base image for users who want to build a new image to share their analysis environment with other collaborators or reviewers to repeat their analysis and results. A protocol on how to use the docker image of tidyMass is provided on the website of tidyMass (<ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/start/tidymass_docker/">https://www.tidymass.org/start/tidymass_docker/</ext-link>).</p>
      </sec>
    </sec>
    <sec id="Sec51">
      <title>Sample preparation and analytical conditions for the case study</title>
      <p id="Par55">In this study, we only re-analyzed data from a previously published study<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> and no new LC–MS data were produced. All the sample preparation and analytical conditions for the case study can be found in our previous publication<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>.</p>
      <p id="Par56">In brief, 50 ± 1 mg of each tissue was homogenized using 500 μL of UPLC-grade H<sub>2</sub>O. A Cryolys Evolution homogenizer (Bertin Corporation, Rockville, MD, United States) was used with a 2 mL lysing tube (Bertin Corporation) and 1.4 mm ceramic zirconium oxide beads (Bertin Corporation) to homogenize the tissues. Each sample was processed six times for 20 s, at 6000 rpm with 5 s intervals. Dry ice was used to keep the temperature at &lt;10 °C during homogenization. From the homogenized solution, 100 μL was taken and added to 1.5 mL polypropylene microcentrifuge tubes for subsequent metabolite extraction. A volume of 400 μL ice-cold MeOH:ACN (1:1, v/v) was added to each sample as the extraction solvent. The samples were vortexed for 30 s and sonicated for 10 min. To precipitate proteins, the samples were incubated for 2 h at −20 °C, followed by centrifugation at 13,000 rpm (15,000 g) and 4 °C for 15 min. The resulting supernatant was removed and evaporated to dryness for 12 h using a vacuum concentrator (Thermo Fisher Scientific, Waltham, MA, United States). The dry extracts were then reconstituted in 100 µL of ACN:H2O (1:1, v/v), sonicated for 10 min, and centrifuged at 13,000 rpm (15,000 g) and 4 °C for 15 min to remove insoluble debris. The supernatant was transferred to UPLC autosampler vials (Thermo Scientific, MA, United States). A pooled quality control (QC) sample was prepared by mixing 5 μL of extracted solution from each sample into a UPLC autosampler vial. Both HILIC-MS and RPLC–MS approaches were used for comprehensive analysis of the tissue metabolome. A UPLC system (H-Class ACQUITY, Waters Corporation, MA, United States) coupled with a quadrupole time-of-flight (QTOF) mass spectrometer (Xevo G2-XS QTOF, Waters Corporation, MA, United States) was used for MS data acquisition. A Waters ACQUITY UPLC BEH Amide column (particle size, 1.7 μm; 100 mm (length) × 2.1 mm (i.d.)) and Waters ACQUITY UPLC BEH C18 column (particle size, 1.7 μm; 50 mm (length) × 2.1 mm (i.d.)) were used for the UPLC-based separation of metabolites. The column temperature was kept at 25 °C for HILIC–MS analysis and 30 °C for RPLC–MS analysis. The solvent flow rate was 0.5 mL/min, and the sample injection volume was 1 μL. For HILIC-MS analysis, mobile phase A was 25 mM NH4OH and 25 mM NH4OAc in water, while mobile phase B was ACN for both electrospray ionization (ESI) positive and negative mode, respectively. The linear gradient was set as follows: 0–0.5 min: 95% B; 0.5–7 min: 95% B to 65% B; 7–8 min: 65% B to 40% B; 8–9 min: 40% B; 9–9.1 min: 40% B to 95% B; 9.1–12 min: 95% B. For RPLC–MS analysis, the mobile phase A was 0.1% formic acid in H2O, while the mobile phase B was 0.1% formic acid in ACN, respectively for both ESI + and ESI − . The linear gradient was set as follows: 0–1 min: 1% B; 1–8 min: 1% B to 100% B; 8–10 min: 100% B; 10–10.1 min: 100% B to 1% B; 10.1–12 min: 1% B. Pooled samples were analyzed every eight injections during the UPLC–MS analysis to monitor the stability of the data acquisition and used for subsequent data normalization. QTOF-MS scan data (300 ms/scan; mass scan range 50–1000 Da) was initially acquired for each biological sample for metabolite quantification. Then, both DDA (data-dependent acquisition) data (QTOF MS scan time: 50 ms/scan, MSMS scan time 50 ms/scan, collision energy 20 eV, top 5 most intense ions were selected for fragmentation, exclude former target ions (4 s after 2 occurrences)) and MSe data (low energy scan: 200 ms/scan, collision energy 6 eV; high energy scan: 100 ms/scan, collision energy 20 eV, mass scan range 25–1000 Da) were acquired for QC samples to enable metabolite identification. ESI source parameters on the Xevo GS-XS QTOF were set as follows: capillary voltage 1.8 kV, sampling cone 40 V, source temperature 50 °C, desolvation temperature 550 °C, cone gas flow 40 L/Hr, desolvation gas flow 900 L/Hr.</p>
    </sec>
    <sec id="Sec52">
      <title>Reporting summary</title>
      <p id="Par57">Further information on research design is available in the <xref rid="MOESM6" ref-type="media">Nature Research Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec53">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2022_32155_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2022_32155_MOESM2_ESM.docx">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2022_32155_MOESM3_ESM.docx">
            <caption>
              <p>Dataset 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2022_32155_MOESM4_ESM.zip">
            <caption>
              <p>Dataset 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2022_32155_MOESM5_ESM.zip">
            <caption>
              <p>Dataset 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2022_32155_MOESM6_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Xiaotao Shen, Hong Yan, Chuchu Wang.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-022-32155-w.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Dr. Miao Yu for integrating the tidyMass project with the xcmsrocker project and providing advice on the development of the docker image version of tidyMass. We also thank Dr. Amir Bahmani and Kexin Cha for integrating the tidyMass project with the Stanford Data Ocean project. We also thank Dr. Axel Brunger for the advice on the manuscript. C.H.J was supported by the NCI/NIH under Award Number K12CA215110, NIGMS/NIH under Award Number 1RM1GM141649-01, and American Cancer Society Research Scholar Grant 134273-RSG-20-065-01-TBE.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>X.S. and M.P.S. conceived the method and supervised its implementation. X.S. developed the methods, packages, and the docker image. X.S. and C.W. built the websites and wrote the help documents and tutorials. H.Y. provided and prepared the case study data, and H.Y. and X.S. analyzed the case study data. X.S., H.Y., and C.W. prepared the figures. X.S., H.Y., C.W., C.H.J., and M.P.S. wrote the manuscript, and C.H.J., M.S.P., and P.G. improved the manuscript. All authors contributed to the final manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par58"><italic>Nature Communications</italic> thanks Pieter Dorrestein, and the other, anonymous, reviewer for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All the demo data for how to use tidyMass can be accessible on the tidyMass website (<ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/">https://www.tidymass.org/</ext-link>), and it took about 8 h to run the code on Mac OS with 32 GB RAM. For the case study, mass spectrometry raw converted data (mzML) for the case study in this paper is accessible on MetaboLights with <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/metabolights/MTBLS1122/descriptors">MTBLS1122</ext-link> (HILIC positive), <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/metabolights/MTBLS1124/descriptors">MTBLS1124</ext-link> (HILIC negative), <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/metabolights/MTBLS1129/descriptors">MTBLS1129</ext-link> (RPLC positive), and <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/metabolights/MTBLS1130/descriptors">MTBLS1130</ext-link> (RPLC negative). The MS<sup>2</sup> data (mgf) and processed data (“mass_dataset” class) from the massProcesser package are available on the tidyMass project website (<ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/start/case_study/">https://www.tidymass.org/start/case_study/</ext-link>), and the “mass_dataset” objects are provided as Supplementary Data <xref rid="MOESM4" ref-type="media">2</xref>. The in-house library used for metabolite annotation in the case study is provided on the metID website (<ext-link ext-link-type="uri" xlink:href="https://metid.tidymass.org/articles/public_databases.html">https://metid.tidymass.org/articles/public_databases.html</ext-link>). The whole workflow (4 LC–MS mode datasets) took about 10 h on Windows with 32 GB RAM.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>All the source code of the tidyMass project is deployed on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/tidymass">https://github.com/tidymass</ext-link>) and Zenodo (<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/6788322#.Yr9wXuyZMZ8">https://zenodo.org/record/6788322#.Yr9wXuyZMZ8</ext-link><sup><xref ref-type="bibr" rid="CR47">47</xref></sup>). The source code is public under the MIT License; and works on Windows, macOS X, and most Linux distributions. The docker image of tidyMass is hosted on the docker hub (<ext-link ext-link-type="uri" xlink:href="https://hub.docker.com/r/jaspershen/tidymass">https://hub.docker.com/r/jaspershen/tidymass</ext-link>). The code of the case study (Rmarkdown format, <ext-link ext-link-type="uri" xlink:href="https://www.tidymass.org/start/case_study/">https://www.tidymass.org/start/case_study/</ext-link>) is provided as Supplementary Data <xref rid="MOESM5" ref-type="media">3</xref>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par59">M.P.S. is a co-founder and member of the scientific advisory board of Personalis, Qbio, January, SensOmics, Protos, Mirvie, NiMo, Onza, and Oralome. He is also on the scientific advisory board of Danaher, Genapsys, and Jupiter. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wishart</surname>
            <given-names>DS</given-names>
          </name>
        </person-group>
        <article-title>Emerging applications of metabolomics in drug discovery and precision medicine</article-title>
        <source>Nat. Rev. Drug Discov.</source>
        <year>2016</year>
        <volume>15</volume>
        <fpage>473</fpage>
        <lpage>484</lpage>
        <pub-id pub-id-type="doi">10.1038/nrd.2016.32</pub-id>
        <?supplied-pmid 26965202?>
        <pub-id pub-id-type="pmid">26965202</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <mixed-citation publication-type="other">Gao, P. et al. Precision environmental health monitoring by longitudinal exposome and multi-omics profiling. 10.1101/2021.05.05.442855.</mixed-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alseekh</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mass spectrometry-based metabolomics: a guide for annotation, quantification and best reporting practices</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>747</fpage>
        <lpage>756</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01197-1</pub-id>
        <?supplied-pmid 34239102?>
        <pub-id pub-id-type="pmid">34239102</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dunn</surname>
            <given-names>WB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Procedures for large-scale metabolic profiling of serum and plasma using gas chromatography and liquid chromatography coupled to mass spectrometry</article-title>
        <source>Nat. Protoc.</source>
        <year>2011</year>
        <volume>6</volume>
        <fpage>1060</fpage>
        <lpage>1083</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2011.335</pub-id>
        <?supplied-pmid 21720319?>
        <pub-id pub-id-type="pmid">21720319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pluskal</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Castillo</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Villar-Briones</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Oresic</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>MZmine 2: modular framework for processing, visualizing, and analyzing mass spectrometry-based molecular profile data</article-title>
        <source>BMC Bioinforma.</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>395</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-395</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsugawa</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MS-DIAL: data-independent MS/MS deconvolution for comprehensive metabolome analysis</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>523</fpage>
        <lpage>526</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3393</pub-id>
        <?supplied-pmid 25938372?>
        <pub-id pub-id-type="pmid">25938372</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Smith</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Want</surname>
            <given-names>EJ</given-names>
          </name>
          <name>
            <surname>O’Maille</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Abagyan</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Siuzdak</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>XCMS: processing mass spectrometry data for metabolite profiling using nonlinear peak alignment, matching, and identification</article-title>
        <source>Anal. Chem.</source>
        <year>2006</year>
        <volume>78</volume>
        <fpage>779</fpage>
        <lpage>787</lpage>
        <pub-id pub-id-type="doi">10.1021/ac051437y</pub-id>
        <?supplied-pmid 16448051?>
        <pub-id pub-id-type="pmid">16448051</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sturm</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>OpenMS—an open-source software framework for mass spectrometry</article-title>
        <source>BMC Bioinforma.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>163</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-9-163</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Davidson</surname>
            <given-names>RL</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>RJM</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Sharma-Oates</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Viant</surname>
            <given-names>MR</given-names>
          </name>
        </person-group>
        <article-title>Galaxy-M: a Galaxy workflow for processing and analyzing direct infusion and liquid chromatography mass spectrometry-based metabolomics data</article-title>
        <source>Gigascience</source>
        <year>2016</year>
        <volume>5</volume>
        <fpage>10</fpage>
        <pub-id pub-id-type="doi">10.1186/s13742-016-0115-8</pub-id>
        <?supplied-pmid 26913198?>
        <pub-id pub-id-type="pmid">26913198</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiefer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Schmitt</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Vorholt</surname>
            <given-names>JA</given-names>
          </name>
        </person-group>
        <article-title>eMZed: an open source framework in Python for rapid and interactive development of LC/MS data analysis workflows</article-title>
        <source>Bioinformatics</source>
        <year>2013</year>
        <volume>29</volume>
        <fpage>963</fpage>
        <lpage>964</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btt080</pub-id>
        <?supplied-pmid 23418185?>
        <pub-id pub-id-type="pmid">23418185</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Sharing and community curation of mass spectrometry data with Global Natural Products Social Molecular Networking</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2016</year>
        <volume>34</volume>
        <fpage>828</fpage>
        <lpage>837</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3597</pub-id>
        <?supplied-pmid 27504778?>
        <pub-id pub-id-type="pmid">27504778</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dührkop</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SIRIUS 4: a rapid tool for turning tandem mass spectra into metabolite structure information</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>299</fpage>
        <lpage>302</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0344-8</pub-id>
        <?supplied-pmid 30886413?>
        <pub-id pub-id-type="pmid">30886413</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metabolic reaction network-based recursive metabolite annotation for untargeted metabolomics</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1516</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-019-09550-x</pub-id>
        <?supplied-pmid 30944337?>
        <pub-id pub-id-type="pmid">30944337</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Shen, X. et al. <italic>metID:</italic> A R package for automatable compound annotation for LC−MS-based data. 10.1101/2021.05.08.443258.</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>NP Analyst: An Open Online Platform for Compound Activity Mapping</article-title>
        <source>ACS Cent. Sci.</source>
        <year>2022</year>
        <volume>8</volume>
        <fpage>223</fpage>
        <lpage>234</lpage>
        <pub-id pub-id-type="doi">10.1021/acscentsci.1c01108</pub-id>
        <?supplied-pmid 35233454?>
        <pub-id pub-id-type="pmid">35233454</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metabolite discovery through global annotation of untargeted metabolomics data</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1377</fpage>
        <lpage>1385</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01303-3</pub-id>
        <?supplied-pmid 34711973?>
        <pub-id pub-id-type="pmid">34711973</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Z-J</given-names>
          </name>
        </person-group>
        <article-title>MetFlow: an interactive and integrated workflow for metabolomics data cleaning and differential metabolite discovery</article-title>
        <source>Bioinformatics</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>2870</fpage>
        <lpage>2872</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty1066</pub-id>
        <?supplied-pmid 30601938?>
        <pub-id pub-id-type="pmid">30601938</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wen</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Mei</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Zeng</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>metaX: a flexible and comprehensive software for processing metabolomics data</article-title>
        <source>BMC Bioinforma.</source>
        <year>2017</year>
        <volume>18</volume>
        <fpage>183</fpage>
        <pub-id pub-id-type="doi">10.1186/s12859-017-1579-y</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hughes</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MSPrep—Summarization, normalization and diagnostics for processing of mass spectrometry–based metabolomic data</article-title>
        <source>Bioinformatics</source>
        <year>2014</year>
        <volume>30</volume>
        <fpage>133</fpage>
        <lpage>134</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btt589</pub-id>
        <?supplied-pmid 24174567?>
        <pub-id pub-id-type="pmid">24174567</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mock</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MetaboDiff: an R package for differential metabolomic analysis</article-title>
        <source>Bioinformatics</source>
        <year>2018</year>
        <volume>34</volume>
        <fpage>3417</fpage>
        <lpage>3418</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty344</pub-id>
        <?supplied-pmid 29718102?>
        <pub-id pub-id-type="pmid">29718102</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Chong</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Xia</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>MetaboAnalystR 3.0: toward an optimized workflow for global metabolomics</article-title>
        <source>Metabolites</source>
        <year>2020</year>
        <volume>10</volume>
        <fpage>186</fpage>
        <pub-id pub-id-type="doi">10.3390/metabo10050186</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tautenhahn</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Patti</surname>
            <given-names>GJ</given-names>
          </name>
          <name>
            <surname>Rinehart</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Siuzdak</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>XCMS Online: a web-based platform to process untargeted metabolomic data</article-title>
        <source>Anal. Chem.</source>
        <year>2012</year>
        <volume>84</volume>
        <fpage>5035</fpage>
        <lpage>5039</lpage>
        <pub-id pub-id-type="doi">10.1021/ac300698c</pub-id>
        <?supplied-pmid 22533540?>
        <pub-id pub-id-type="pmid">22533540</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rainer</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A Modular and Expandable Ecosystem for Metabolomics Data Annotation in R</article-title>
        <source>Metabolites</source>
        <year>2022</year>
        <volume>12</volume>
        <fpage>173</fpage>
        <pub-id pub-id-type="doi">10.3390/metabo12020173</pub-id>
        <?supplied-pmid 35208247?>
        <pub-id pub-id-type="pmid">35208247</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>metID: an R package for automatable compound annotation for LC−MS-based data</article-title>
        <source>Bioinformatics</source>
        <year>2022</year>
        <volume>38</volume>
        <fpage>568</fpage>
        <lpage>569</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btab583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wickham</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Welcome to the Tidyverse</article-title>
        <source>J. Open Source Softw.</source>
        <year>2019</year>
        <volume>4</volume>
        <fpage>1686</fpage>
        <pub-id pub-id-type="doi">10.21105/joss.01686</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>McMurdie</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>phyloseq: An R Package for Reproducible Interactive Analysis and Graphics of Microbiome Census Data</article-title>
        <source>PLoS One</source>
        <year>2013</year>
        <volume>8</volume>
        <fpage>e61217</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0061217</pub-id>
        <?supplied-pmid 23630581?>
        <pub-id pub-id-type="pmid">23630581</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Sarfraz, I., Asif, M. &amp; Campbell, J. D. ExperimentSubset: An R package to manage subsets of Bioconductor Experiment objects. <italic>Bioinformatics</italic> (2021) 10.1093/bioinformatics/btab179.</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Website</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Welcome to the Tidyverse</article-title>
        <source>J. Open Source Softw.</source>
        <year>2019</year>
        <volume>4</volume>
        <fpage>1686</fpage>
        <pub-id pub-id-type="doi">10.21105/joss.01686</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huber</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Orchestrating high-throughput genomic analysis with Bioconductor</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>115</fpage>
        <lpage>121</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3252</pub-id>
        <?supplied-pmid 25633503?>
        <pub-id pub-id-type="pmid">25633503</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoffmann</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>mzTab-M: A Data Standard for Sharing Quantitative Results in Mass Spectrometry Metabolomics</article-title>
        <source>Anal. Chem.</source>
        <year>2019</year>
        <volume>91</volume>
        <fpage>3302</fpage>
        <lpage>3310</lpage>
        <pub-id pub-id-type="doi">10.1021/acs.analchem.8b04310</pub-id>
        <?supplied-pmid 30688441?>
        <pub-id pub-id-type="pmid">30688441</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chambers</surname>
            <given-names>MC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A cross-platform toolkit for mass spectrometry and proteomics</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2012</year>
        <volume>30</volume>
        <fpage>918</fpage>
        <lpage>920</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2377</pub-id>
        <?supplied-pmid 23051804?>
        <pub-id pub-id-type="pmid">23051804</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Blaise</surname>
            <given-names>BJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Statistical analysis in metabolic phenotyping</article-title>
        <source>Nat. Protoc.</source>
        <year>2021</year>
        <volume>16</volume>
        <fpage>4299</fpage>
        <lpage>4326</lpage>
        <pub-id pub-id-type="doi">10.1038/s41596-021-00579-1</pub-id>
        <?supplied-pmid 34321638?>
        <pub-id pub-id-type="pmid">34321638</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wratten</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Wilm</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Göke</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Reproducible, scalable, and shareable analysis pipelines with bioinformatics workflow managers</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1161</fpage>
        <lpage>1168</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01254-9</pub-id>
        <?supplied-pmid 34556866?>
        <pub-id pub-id-type="pmid">34556866</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cai</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Sex Differences in Colon Cancer Metabolism Reveal A Novel Subphenotype</article-title>
        <source>Sci. Rep.</source>
        <year>2020</year>
        <volume>10</volume>
        <fpage>4905</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-020-61851-0</pub-id>
        <?supplied-pmid 32184446?>
        <pub-id pub-id-type="pmid">32184446</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sumner</surname>
            <given-names>LW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Proposed minimum reporting standards for chemical analysis Chemical Analysis Working Group (CAWG) Metabolomics Standards Initiative (MSI)</article-title>
        <source>Metabolomics</source>
        <year>2007</year>
        <volume>3</volume>
        <fpage>211</fpage>
        <lpage>221</lpage>
        <pub-id pub-id-type="doi">10.1007/s11306-007-0082-2</pub-id>
        <?supplied-pmid 24039616?>
        <pub-id pub-id-type="pmid">24039616</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Cui</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Comparison of methods for the detection of outliers and associated biomarkers in mislabeled omics data</article-title>
        <source>BMC Bioinf.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>357</fpage>
        <pub-id pub-id-type="doi">10.1186/s12859-020-03653-9</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <mixed-citation publication-type="other">BreunigMarkus, M., KriegelHans-Peter, NgRaymond, T. &amp; SanderJörg. L. O. F. <italic>ACM SIGMOD Record</italic> (2000) 10.1145/335191.335388.</mixed-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moorthy</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Mohamad</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Deris</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>A review on missing value imputation algorithms for microarray gene expression data</article-title>
        <source>Curr. Bioinforma.</source>
        <year>2014</year>
        <volume>9</volume>
        <fpage>18</fpage>
        <lpage>22</lpage>
        <pub-id pub-id-type="doi">10.2174/1574893608999140109120957</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Oba</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A Bayesian missing value estimation method for gene expression profile data</article-title>
        <source>Bioinformatics</source>
        <year>2003</year>
        <volume>19</volume>
        <fpage>2088</fpage>
        <lpage>2096</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btg287</pub-id>
        <?supplied-pmid 14594714?>
        <pub-id pub-id-type="pmid">14594714</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Troyanskaya</surname>
            <given-names>O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Missing value estimation methods for DNA microarrays</article-title>
        <source>Bioinformatics</source>
        <year>2001</year>
        <volume>17</volume>
        <fpage>520</fpage>
        <lpage>525</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/17.6.520</pub-id>
        <?supplied-pmid 11395428?>
        <pub-id pub-id-type="pmid">11395428</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stekhoven</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Buhlmann</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>MissForest–non-parametric missing value imputation for mixed-type data</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>112</fpage>
        <lpage>118</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr597</pub-id>
        <?supplied-pmid 22039212?>
        <pub-id pub-id-type="pmid">22039212</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>De Livera</surname>
            <given-names>AM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Statistical methods for handling unwanted variation in metabolomics data</article-title>
        <source>Anal. Chem.</source>
        <year>2015</year>
        <volume>87</volume>
        <fpage>3606</fpage>
        <lpage>3615</lpage>
        <pub-id pub-id-type="doi">10.1021/ac502439y</pub-id>
        <?supplied-pmid 25692814?>
        <pub-id pub-id-type="pmid">25692814</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Shen, X. et al. Normalization and integration of large-scale metabolomics data using support vector regression. <italic>Metabolomics</italic> vol. 12 (2016).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rohart</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Gautier</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Cao</surname>
            <given-names>K-AL</given-names>
          </name>
        </person-group>
        <article-title>mixOmics: An R package for ‘omics feature selection and multiple data integration</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2017</year>
        <volume>13</volume>
        <fpage>e1005752</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1005752</pub-id>
        <?supplied-pmid 29099853?>
        <pub-id pub-id-type="pmid">29099853</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kanehisa</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Goto</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>KEGG: kyoto encyclopedia of genes and genomes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2000</year>
        <volume>28</volume>
        <fpage>27</fpage>
        <lpage>30</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/28.1.27</pub-id>
        <?supplied-pmid 10592173?>
        <pub-id pub-id-type="pmid">10592173</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jewison</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SMPDB 2.0: big improvements to the small molecule pathway database</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2014</year>
        <volume>42</volume>
        <fpage>D478</fpage>
        <lpage>D484</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkt1067</pub-id>
        <?supplied-pmid 24203708?>
        <pub-id pub-id-type="pmid">24203708</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <mixed-citation publication-type="other">Shen, X. TidyMass an object-oriented reproducible analysis framework for LC–MS Data. <italic>Zenodo</italic>10.5281/zenodo.6788322 (2022).</mixed-citation>
    </ref>
  </ref-list>
</back>
