<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6612805</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btz346</article-id>
    <article-id pub-id-type="publisher-id">btz346</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Ismb/Eccb 2019 Conference Proceedings</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genomic Variation Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Alignment-free filtering for cfNA fusion fragments</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Yang</surname>
          <given-names>Xiao</given-names>
        </name>
        <xref ref-type="corresp" rid="btz346-cor1"/>
        <xref ref-type="author-notes" rid="btz346-FM1"/>
        <!--<email>xyang@grail.com</email>-->
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Saito</surname>
          <given-names>Yasushi</given-names>
        </name>
        <xref ref-type="corresp" rid="btz346-cor1"/>
        <xref ref-type="author-notes" rid="btz346-FM1"/>
        <!--<email>ysaito@grail.com</email>-->
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rao</surname>
          <given-names>Arjun</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kim</surname>
          <given-names>Hyunsung John</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Singh</surname>
          <given-names>Pranav</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Scott</surname>
          <given-names>Eric</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Larson</surname>
          <given-names>Matthew</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pan</surname>
          <given-names>Wenying</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Desai</surname>
          <given-names>Mohini</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hubbell</surname>
          <given-names>Earl</given-names>
        </name>
        <xref ref-type="aff" rid="btz346-aff1"/>
      </contrib>
    </contrib-group>
    <aff id="btz346-aff1">Grail, Inc, Menlo Park, CA, USA</aff>
    <author-notes>
      <fn id="btz346-FM1">
        <p>The authors wish it to be known that, in their opinion, the first two authors should be regarded as Joint First Authors.</p>
      </fn>
      <corresp id="btz346-cor1">To whom correspondence should be addressed. <email>xyang@grail.com</email> or <email>ysaito@grail.com</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-07-05">
      <day>05</day>
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>05</day>
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>35</volume>
    <issue>14</issue>
    <fpage>i225</fpage>
    <lpage>i232</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btz346.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Cell-free nucleic acid (cfNA) sequencing data require improvements to existing fusion detection methods along multiple axes: high depth of sequencing, low allele fractions, short fragment lengths and specialized barcodes, such as unique molecular identifiers.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>AF4 was developed to address these challenges. It uses a novel alignment-free kmer-based method to detect candidate fusion fragments with high sensitivity and orders of magnitude faster than existing tools. Candidate fragments are then filtered using a max-cover criterion that significantly reduces spurious matches while retaining authentic fusion fragments. This efficient first stage reduces the data sufficiently that commonly used criteria can process the remaining information, or sophisticated filtering policies that may not scale to the raw reads can be used. AF4 provides both targeted and <italic>de novo</italic> fusion detection modes. We demonstrate both modes in benchmark simulated and real RNA-seq data as well as clinical and cell-line cfNA data.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>AF4 is open sourced, licensed under Apache License 2.0, and is available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/grailbio/bio/tree/master/fusion">https://github.com/grailbio/bio/tree/master/fusion</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">NIH</named-content>
          <named-content content-type="funder-identifier">10.13039/100000002</named-content>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Due to its clinical relevance in cancer, many fusion detection tools have been developed and applied to tissue RNA-seq data (<xref rid="btz346-B8" ref-type="bibr">Kumar <italic>et al.</italic>, 2016</xref>; <xref rid="btz346-B10" ref-type="bibr">Liu <italic>et al.</italic>, 2016</xref>). Fusion detection algorithms usually run in two stages: identification of candidate readpairs or fragments (The term ‘fragment’ refers to physical RNA or DNA molecule; whereas the term ‘readpair’ refers to the sequencing result of a fragment. A single fragment may produce multiple readpairs due to duplicates caused by polymerase chain reaction (PCR) amplification. These terms are used interchangeably in this text.) corresponding to candidate gene fusions and application of a list of empirically defined filtering criteria. The first stage typically makes use of a sequence alignment tool (<xref rid="btz346-B5" ref-type="bibr">Haas <italic>et al.</italic>, 2017</xref>; <xref rid="btz346-B6" ref-type="bibr">Jia <italic>et al.</italic>, 2013</xref>; <xref rid="btz346-B7" ref-type="bibr">Kim and Salzberg, 2011</xref>), which can identify discordant and unmapped readpairs. Some methods further assemble reads into longer contigs for more accurate mapping (<xref rid="btz346-B2" ref-type="bibr">Chen <italic>et al.</italic>, 2012</xref>). This step dominates the runtime and memory usage of the fusion detection process. However, this process can be brittle as readpairs can be misaligned or misidentified as soft-clipping events. Because of this, the aligners must be configured to reduce misclassification due to such alignment artifacts (<xref rid="btz346-B5" ref-type="bibr">Haas <italic>et al.</italic>, 2017</xref>). The second stage for fusion detection typically involves a variety of empirically defined criteria to eliminate spurious fusion events. Such criteria may include discarding fusions involving homologous genes, requiring a minimum number of supporting fragments, and a constraint on minimum genomic distance between genes. Because these rules are not universally applicable, there is no dominant method: instead, criteria are chosen to best match a particular application (<xref rid="btz346-B8" ref-type="bibr">Kumar <italic>et al.</italic>, 2016</xref>).</p>
    <p>Cell-free nucleic acid (cfNA) data serve as an important biosource for non-invasive cancer diagnoses and monitoring (<xref rid="btz346-B3" ref-type="bibr">Donaldson and Park, 2018</xref>). Fusion detection for cfNA sequencing data poses distinct challenges compared to tissue sequencing data. To capture the small amount of nucleic acid fragments from tumor cells, cfNA analyses must sequence fragments orders of magnitude more than those for tissue sequencing. This problem prevents many existing fusion callers from running in reasonable time frame (<xref rid="btz346-B5" ref-type="bibr">Haas <italic>et al.</italic>, 2017</xref>, <xref ref-type="fig" rid="btz346-F4">Fig. 4</xref>). Meanwhile, curtailing the loss of fusion-supporting fragments is critical to maintain sufficient evidence. PCR duplicates become prevalent with high sequencing depth, so fragments are typically tagged with unique molecular identifiers (UMIs), and the system must deduplicate them properly. As many cfNA fragments are shorter than the intended sequencing read length, barcode or primer sequences are incorporated into the 3’ end of reads. Reads that incorporate these extra sequences may be discarded by alignment-based methods; the high abundance of primer or barcode kmers may confound alignment-free methods.</p>
    <p>AF4 addresses these challenges with a two staged approach. In the first stage, this tool conservatively identifies discordant readpairs without relying on alignments. It finds kmers shared with candidate genes, ignoring positions of these kmers in the reference transcriptome altogether. This approach improves upon the sensitivity of alignment-based approaches by avoiding the drawbacks highlighted earlier: split reads are not treated as soft-clipping events and discordant readpairs are not misaligned. AF4 then identifies fusion-supporting readpairs by inferring the most likely gene or pair of genes from which the readpair could be derived. This inference is made solving an optimization problem that maximizes the coverage of a readpair by a gene or gene pair. As a result, spurious fusion-supporting fragments are significantly reduced. The first stage of AF4 runs independently for each readpair, scaling linearly with available computing resources. In the second stage, AF4 runs a common set of filtering strategies, including constraints on the number of unique supporting fragments, the number of fusion partners, gene pairs located in close proximity in the reference, gene homology and the complexity of the subsequence supporting the fusion event. Because of the improved specificity of the first stage—AF4 typically retains 0.0001–0.1% of the original data—users can also apply more expensive methods to further improve performance.</p>
    <p>AF4 supports two modes of operations: target-based and discovery-based (<italic>de novo</italic>) fusion detection. In targeted mode, it is given an explicit list of possible fusion events in the form of a COSMIC database file (<xref rid="btz346-B13" ref-type="bibr">Tate <italic>et al.</italic>, 2019</xref>). In <italic>de novo</italic> mode, it considers all possible pairs of genes listed in the reference transcripts.</p>
    <p>Targeted mode is preferred in many practical applications as fusion databases, such as COSMIC include events that have been typically validated and of known clinical relevance. As the fusion database expands, targeted fusion detection is becoming more sensitive and clinically relevant. We thus expect the targeted mode to be used more widely in practice than <italic>de novo</italic> mode, which is mainly intended for discovery. Although novel fusion discoveries are crucial to expand the knowledge base, such effort may be less relevant to screening or tumor sub-typing purposes for cfNA data; and in practice, the results can contain too many false positives (FPs) to be inspected manually.</p>
    <p>Several alignment-free methods have been recently proposed to reduce runtime and improve sensitivity (<xref rid="btz346-B1" ref-type="bibr">Bray <italic>et al.</italic>, 2016</xref>; <xref rid="btz346-B9" ref-type="bibr">Li <italic>et al.</italic>, 2017</xref>; <xref rid="btz346-B11" ref-type="bibr">Melsted <italic>et al.</italic>, 2017</xref>). For example, ChimeRScope (<xref rid="btz346-B9" ref-type="bibr">Li <italic>et al.</italic>, 2017</xref>) discovers genes a fragment may come from through kmer matching, in a manner similar to AF4. However, its fusion detection mechanism is fairly different: it ranks genes only by the degree at which a gene shares bases with the fragment, ignoring the locations of kmer matches within the fragment. In contrast, AF4 explicitly checks whether a gene pair actually forms a junction and ranks gene pair candidates by their fragment coverage. This mechanism leads to more accurate fusion detection.</p>
    <p>We demonstrate AF4 to be a valuable addition to the existing fusion detection tools by applying it to benchmark simulated and real RNA-seq data with known fusions (<xref rid="btz346-B10" ref-type="bibr">Liu <italic>et al.</italic>, 2016</xref>), clinical cfRNA and cell-line titration cfDNA data. AF4 achieved better <italic>F</italic>-score when compared with ChimeRScope (<xref rid="btz346-B9" ref-type="bibr">Li <italic>et al.</italic>, 2017</xref>) on the simulated RNA-seq data. On cfRNA data, AF4 achieved better sensitivity in both targeted and <italic>de novo</italic> modes than STAR-Fusion (<xref rid="btz346-B5" ref-type="bibr">Haas <italic>et al.</italic>, 2017</xref>) in retaining fusion fragments. However, a direct comparison of specificity cannot be fairly made as both programs can be adjusted for specificity with different thresholds during filtering (Section 3.2). By changing the reference sequences (and with no algorithmic changes), the targeted mode of AF4 was able to identify real fusions in a series cell-line titration cfDNA datasets comparable to Manta (<xref rid="btz346-B10" ref-type="bibr">Liu <italic>et al.</italic>, 2016</xref>), a DNA-seq structural variation detection method. In the tested data, AF4 runs 300× faster than ChimeRscope, 12× faster than STAR-Fusion and 20× faster than Manta.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>The workflow of AF4 is outlined in <xref ref-type="fig" rid="btz346-F1">Figure 1</xref>. There are three components in the workflow: the input component that handles I/O and preprocessing, independent readpair handling in stage one and fusion candidate filtering in stage two.
</p>
    <fig id="btz346-F1" orientation="portrait" position="float">
      <label>Fig. 1.</label>
      <caption>
        <p>An overview of AF4 workflow. Detailed descriptions are given in the main text</p>
      </caption>
      <graphic xlink:href="btz346f1"/>
    </fig>
    <sec>
      <title>2.1 Input</title>
      <p>AF4 takes three inputs:
<list list-type="bullet"><list-item><p>A list of paired FASTQ files, typically Illumina paired-end sequencing data, in compressed format.</p></list-item><list-item><p>A transcriptome FASTA file that lists known transcript sequences. For RNA-seq or cfRNA, we could use the default Gencode transcriptome reference. For analyses in this article, however, we padded 250 intron bases on both 5’ and 3’ regions of every exon in Gencode 26. This reduces FPs that arise from reads spanning intron–exon junctions in unspliced nascent mRNA molecules. For cfDNA, we use the entire genic space including introns.</p></list-item><list-item><p>An optional fusion-gene pair file, used only in targeted mode. We use the COSMIC fusion database (<xref rid="btz346-B13" ref-type="bibr">Tate <italic>et al.</italic>, 2019</xref>, 297 gene pairs to date), plus structural multiplex cfDNA reference standard (<ext-link ext-link-type="uri" xlink:href="http://www.horizondiscovery.com">www.horizondiscovery.com</ext-link>) and additional targets, resulting in a total of 655 fusion gene pairs.</p></list-item></list></p>
    </sec>
    <sec>
      <title>2.2 Intuition</title>
      <p>When a readpair (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>) supports a fusion event involving genes <italic>g</italic><sub>1</sub> and <italic>g</italic><sub>2</sub>, one of the three conditions must hold:
<list list-type="order"><list-item><p><italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> map to different genes but neither <italic>r</italic><sub>1</sub> nor <italic>r</italic><sub>2</sub> spans the fusion junction (<xref ref-type="fig" rid="btz346-F2">Fig. 2a</xref>).
</p></list-item><list-item><p>One of <italic>r</italic><sub>1</sub> or <italic>r</italic><sub>2</sub> spans the fusion junction, and the other is covered by one of the genes (<xref ref-type="fig" rid="btz346-F2">Fig. 2b</xref>).</p></list-item><list-item><p>Both <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> span the fusion junction, which happens when the fragment is short and <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> overlap (<xref ref-type="fig" rid="btz346-F2">Fig. 2c</xref>).</p></list-item></list></p>
      <fig id="btz346-F2" orientation="portrait" position="float">
        <label>Fig. 2.</label>
        <caption>
          <p>Fusion event involving gene pairs (<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>) and readpairs (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>). The green line denotes the fusion transcript derived from genes <italic>g</italic><sub>1</sub> and <italic>g</italic><sub>2</sub> with fusion junction point denoted by <italic>x<sub>b</sub></italic>. (<bold>a</bold>) Neither <italic>r</italic><sub>1</sub> nor <italic>r</italic><sub>2</sub> spans <italic>x<sub>b</sub></italic>, (<bold>b</bold>) <italic>r</italic><sub>1</sub> but not <italic>r</italic><sub>1</sub> spans <italic>x<sub>b</sub></italic> and (<bold>c</bold>) both <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> span <italic>x<sub>b</sub></italic></p>
        </caption>
        <graphic xlink:href="btz346f2"/>
      </fig>
      <p>With these observations, we define readpair (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>) supporting a fusion transcript involving gene pair (<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>) using parameters <italic>α</italic> and <italic>β</italic>.
<list list-type="order"><list-item><p><italic>α</italic> fraction of <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> combined map to <italic>g</italic><sub>1</sub> and <italic>g</italic><sub>2</sub>. In <xref ref-type="fig" rid="btz346-F2">Figure 2</xref>, <inline-formula id="IE1"><mml:math id="IM1"><mml:mrow><mml:mo>α</mml:mo><mml:mo>=</mml:mo><mml:mn>100</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> as the entire <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> map to the fusion transcript. We set <inline-formula id="IE2"><mml:math id="IM2"><mml:mrow><mml:mo>α</mml:mo><mml:mo>=</mml:mo><mml:mn>0.8</mml:mn></mml:mrow></mml:math></inline-formula> by default to account for sequencing errors.</p></list-item><list-item><p><italic>r</italic><sub>1</sub> or <italic>r</italic><sub>2</sub> share a minimum of <italic>β</italic> bases on both sides of the fusion junction point. In <xref ref-type="fig" rid="btz346-F2">Figure 2</xref>, this means on either side of <italic>x<sub>b</sub></italic>, at least <italic>β</italic> bases of <italic>r</italic><sub>1</sub> (<italic>r</italic><sub>2</sub>) map to <italic>g</italic><sub>1</sub> (<italic>g</italic><sub>2</sub>). We set <italic>β</italic> = 25 by default.</p></list-item></list></p>
      <p>Although we used paired-end reads as an illustration, it is easily generalizable to single-end inputs.</p>
    </sec>
    <sec>
      <title>2.3 Stage 1</title>
      <p>AF4 first reads the transcriptome and the optional gene pair files. For every gene implicated in a candidate fusion event, it produces kmers (<italic>k </italic>=<italic> </italic>19 by default) for all possible positions and registers them in a central hash table that maps a kmer to the list of genes that contain the kmer. Then, it drops kmers that map to more than a certain number of genes (by default &gt;2, discussed in Section 4). This policy drops <inline-formula id="IE3"><mml:math id="IM3"><mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>0.1</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> of kmers in both targeted and <italic>de novo</italic> modes. This stage takes 10 s and produces a hash table of size 4GiB in targeted mode, or 1 min and 35GiB in <italic>de novo</italic> mode (hardware specified in Section 3).</p>
      <p>AF4 then reads the FASTQ file pairs to identify a gene or a gene pair that best supports each readpair (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>). This step works independently and in parallel for every readpair. Algorithm 1 describes our method.
</p>
      <p>
        <boxed-text id="btz346-BOX1" position="float" orientation="portrait">
          <label>Algorithm 1.</label>
          <caption>
            <p> Assign (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>) to a candidate fusion event</p>
          </caption>
          <p>1: Drop low-complexity reads.</p>
          <p>2: Find a kmer shared between (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>), stitch and trim overhangs to generate a fragment <italic>f</italic>.</p>
          <p>3: Let <italic>L</italic> be the length of the fragment <italic>f</italic> and <inline-formula id="IE4"><mml:math id="IM4"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> be the set of genes sharing some common kmer with <italic>f</italic>.</p>
          <p>4: <bold>for</bold> Every gene <inline-formula id="IE5"><mml:math id="IM5"><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula><bold>do</bold></p>
          <p>5: <inline-formula id="IE6"><mml:math id="IM6"><mml:mrow><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo></mml:mrow></mml:math></inline-formula> set of positions in <italic>f</italic> covered by <italic>g</italic><sub>1</sub>.</p>
          <p>6: <bold>for</bold> Every gene <inline-formula id="IE7"><mml:math id="IM7"><mml:mrow><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">g</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub><mml:mo>∖</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula><bold>do</bold></p>
          <p>7: <inline-formula id="IE8"><mml:math id="IM8"><mml:mrow><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo></mml:mrow></mml:math></inline-formula> set of positions in <italic>f</italic> covered by <italic>g</italic><sub>2</sub>.</p>
          <p>8: Ignore pair (<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>) if their coverage do not satisfy concurrently the fusion support criteria (Section 2.2).</p>
          <p>9: <bold>for</bold> Every possible junction position <inline-formula id="IE9"><mml:math id="IM9"><mml:mrow><mml:mi>q</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula><bold>do</bold></p>
          <p>10: <inline-formula id="IE10"><mml:math id="IM10"><mml:mrow><mml:mi mathvariant="italic">CC</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∩</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>∪</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∩</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, representing the combined coverage of <italic>g</italic><sub>1</sub> and <italic>g</italic><sub>2</sub> wrt junction <italic>q</italic>.</p>
          <p>11: <bold>end for</bold></p>
          <p>12: <inline-formula id="IE11"><mml:math id="IM11"><mml:mrow><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="italic">CC</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> s.t. <italic>q</italic> is some junction position that maximizes <inline-formula id="IE12"><mml:math id="IM12"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="italic">CC</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
          <p>13: <bold>end for</bold></p>
          <p>14: <bold>end for</bold></p>
          <p>15: <inline-formula id="IE13"><mml:math id="IM13"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> s.t. <italic>g</italic> is the gene that maximizes <inline-formula id="IE14"><mml:math id="IM14"><mml:mrow><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mi>g</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula></p>
          <p>16: <inline-formula id="IE15"><mml:math id="IM15"><mml:mrow><mml:mi>C</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> s.t. (<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>) is a gene pair that maximizes <inline-formula id="IE16"><mml:math id="IM16"><mml:mrow><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
          <p>17: <bold>if</bold><inline-formula id="IE17"><mml:math id="IM17"><mml:mrow><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>&gt;</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>, then assign the fragment to (<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>).</p>
        </boxed-text>
      </p>
      <p>In Line 1, we drop low-complexity readpairs, for which the frequency of any two nucleotides reaches 90% of the sequence length.</p>
      <p>As the library is expected to contain many short molecules, <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> are likely to overlap. In addition, if the molecule is smaller than a read length, <italic>r</italic><sub>1</sub> or <italic>r</italic><sub>2</sub> may further contain bases that are not part of the molecule. Therefore, we stitch <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> into a fragment (Line 2 and <xref ref-type="fig" rid="btz346-F3">Fig. 3</xref>). We produce kmers at all positions for the two reads, then find some common kmer that anchors the suffix–prefix alignment of <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> (<xref ref-type="fig" rid="btz346-F3">Fig. 3a</xref>). If such a kmer is found and the section shared between (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>) has sufficient similarity (e.g. Hamming distance <inline-formula id="IE18"><mml:math id="IM18"><mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>10</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> of the section length), we stitch the two sequences into one. If the <inline-formula id="IE19"><mml:math id="IM19"><mml:mrow><mml:mn>3</mml:mn><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> end of <italic>r</italic><sub>1</sub>/<italic>r</italic><sub>2</sub> extends beyond the <inline-formula id="IE20"><mml:math id="IM20"><mml:mrow><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> end of <italic>r</italic><sub>2</sub>/<italic>r</italic><sub>1</sub> (overhang), <italic>f</italic> becomes the overlapping region (<xref ref-type="fig" rid="btz346-F3">Fig. 3b</xref>). If <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> cannot be stitched, either because they are not overlapping or they have too many sequencing errors, we concatenate the readpair in form <italic>r</italic><sub>1</sub>N<inline-formula id="IE21"><mml:math id="IM21"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> where N is an artificial base distinct from real bases, and <inline-formula id="IE22"><mml:math id="IM22"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> is a reverse complement of <italic>r</italic><sub>2</sub> (<xref ref-type="fig" rid="btz346-F3">Fig. 3c</xref>). The N character prevents generation of kmers.
</p>
      <fig id="btz346-F3" orientation="portrait" position="float">
        <label>Fig. 3.</label>
        <caption>
          <p>Fragment generation by stitching and overhang trimming of readpair (<italic>r</italic><sub>1</sub>, <italic>r</italic><sub>2</sub>). (<bold>a</bold>) <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> are represented as arrows facing each other denoting the forward and reverse complement strands. The green bars denote one of the shared kmers between them, which is an anchor for suffix—prefix alignment. The stitched fragment is a concatenation of prefix of <italic>r</italic><sub>1</sub>, overlap and suffix of <italic>r</italic><sub>2</sub>. (<bold>b</bold>) When <italic>r</italic><sub>1</sub> and/or <italic>r</italic><sub>2</sub> extends beyond the <inline-formula id="IE23"><mml:math id="IM23"><mml:mrow><mml:mn>5</mml:mn><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> region of the other read, the overhang is trimmed, and <italic>f</italic> is the overlap. (<bold>c</bold>) When <italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> cannot be merged, <italic>f</italic> is a concatenation of <italic>r</italic><sub>1</sub> and reverse complement of <italic>r</italic><sub>2</sub></p>
        </caption>
        <graphic xlink:href="btz346f3"/>
      </fig>
      <p>Lines 4–16 detect fusions as described in Section 2.2. The key idea here is to approximate the coverage of fragment <italic>f</italic> by gene <italic>g</italic> without aligning them to a reference. Instead, if the kmer of <italic>f</italic> at position <italic>x</italic> matches <italic>any</italic> kmer of <italic>g</italic>, we assume that <italic>g</italic> covers positions <inline-formula id="IE24"><mml:math id="IM24"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> (<inline-formula id="IE25"><mml:math id="IM25"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> means a half-open range, <inline-formula id="IE26"><mml:math id="IM26"><mml:mrow><mml:mo>{</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>) of <italic>f</italic>. If multiple kmers of <italic>f</italic> match those of <italic>g</italic>, we blindly merge the matched ranges without verifying if these kmers are sequentially aligned on the gene. Next, we pick the pair of genes that provide the most coverage of the fragment, among those that satisfy the fusion criteria defined in Section 2.2.</p>
      <p><xref ref-type="fig" rid="btz346-F4">Figure 4</xref> illustrates this process. <inline-formula id="IE27"><mml:math id="IM27"><mml:mrow><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE28"><mml:math id="IM28"><mml:mrow><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>5</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>5</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>6</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>6</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. A junction in range <inline-formula id="IE29"><mml:math id="IM29"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>5</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> will maximize the combined coverage, thus <inline-formula id="IE30"><mml:math id="IM30"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="italic">CC</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>5</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.
</p>
      <fig id="btz346-F4" orientation="portrait" position="float">
        <label>Fig. 4.</label>
        <caption>
          <p>Computing maximum coverage of fragment <italic>f</italic> for a gene pair (<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>). <italic>g</italic><sub>1</sub> and <italic>g</italic><sub>2</sub> are two genes inferred to cover regions of <italic>f</italic>. <italic>g</italic><sub>1</sub> covers regions <inline-formula id="IE31"><mml:math id="IM31"><mml:mrow><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and <italic>g</italic><sub>2</sub> cover regions <inline-formula id="IE32"><mml:math id="IM32"><mml:mrow><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>5</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. <inline-formula id="IE33"><mml:math id="IM33"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mrow><mml:mo>′</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> are start and end positions of <italic>f</italic> for region <italic>s<sub>i</sub></italic></p>
        </caption>
        <graphic xlink:href="btz346f4"/>
      </fig>
      <p>Algorithm 1 may look expensive since it seems to examine all pairs of genes that share any segment with the fragment. However, in practice it can be implemented efficiently, for the following reasons:
<list list-type="bullet"><list-item><p>given a pair of genes, the best junction point can be computed in time linear to the fragment length—to calculate <inline-formula id="IE34"><mml:math id="IM34"><mml:mrow><mml:mi mathvariant="italic">CC</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, we first sort the regions of each gene in an increasing order of positions from 5’ to 3’ w.r.t. <italic>f</italic>. Then, we only need to consider range boundaries between <italic>g</italic><sub>1</sub> and <italic>g</italic><sub>2</sub>, assuming there’s at most one fusion junction spanned by <italic>f</italic>.</p></list-item><list-item><p>The average number of genes that needs to be examined per fragment is small due to the conditions imposed in Line 8. In targeted mode, fragments match less than one gene on average, so the overhead of this process is negligible. In <italic>de novo</italic> mode, fragments match more genes depending on samples, but we found it still takes less than 5% of the CPU time overall, since this codepath exhibited high memory-access locality. We examine the performance of AF4 in more detail in Section 3.4.</p></list-item></list></p>
    </sec>
    <sec>
      <title>2.4 Stage 2</title>
      <p>Stage one obtained potential candidate fragments and their supporting gene fusion pairs. In stage two, like other fusion detection methods (<xref rid="btz346-B5" ref-type="bibr">Haas <italic>et al.</italic>, 2017</xref>; <xref rid="btz346-B12" ref-type="bibr">Nicorici <italic>et al.</italic>, 2014</xref>), AF4 runs a set of empirically derived methods to remove spurious gene pairs. Given a candidate fragment <italic>f</italic> and the corresponding candidate fusion gene pair (<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>), we run the following filters:</p>
      <p><italic>Low-complexity sequences:</italic> If the subsequences of <italic>f</italic> covered by <italic>g</italic><sub>1</sub> or <italic>g</italic><sub>2</sub> has low complexity, <italic>f</italic> is dropped.</p>
      <p><italic>Nearby genes:</italic> If <italic>g</italic><sub>1</sub> and <italic>g</italic><sub>2</sub> are on the same chromosome and are less than 100 000 bps apart, <italic>f</italic> is dropped. This policy prevents the inference of read-through events or the overlapping genes.</p>
      <p><italic>PCR duplicates:</italic> Fragments with the same UMIs are collapsed into one. To allow for sequencing errors, UMIs that are within two-Hamming distance apart are considered the ‘same’. Unlike other systems that collapse UMIs early in the pipeline, AF4 performs it here, since the first stage processes each readpair independently. After removal of PCR duplicates, any fusion gene pairs supported by &lt;2 distinct fragments are dropped. When the data has no UMIs, we merge highly similar fragments, where by default 95% similarity threshold is used.</p>
      <p><italic>Genes with too many partners:</italic> If a gene <italic>g</italic> appears in too many gene fusion pairs, all fragments that contain <italic>g</italic> are dropped. The default number of maximum gene fusion pairs <italic>g</italic> involved in is set to be 5.</p>
      <p>These criteria are empirically determined and are not always appropriate. AF4 supports reading candidate fragments and gene pairs from a checkpoint file and running dataset specific filtering algorithms quickly.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>AF4 is written in Go (<ext-link ext-link-type="uri" xlink:href="http://www.golang.org">www.golang.org</ext-link>). The experiments were run on an Ubuntu 16.04 machine with Linux 4.4.0, Xeon E5-2690@2.6GHz * 28 (two hyperthreads/core, 56 total CPUs), 256GiB of memory and XFS (en.wikipedia.org/wiki/XFS) on NVMe for storage. In this section, the same default parameter values were used in all cases to avoid overfitting to an individual dataset. The scripts used to generate the results in this section are available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/grailbio/bio/tree/master/fusion/benchmark">https://github.com/grailbio/bio/tree/master/fusion/benchmark</ext-link>.</p>
    <sec>
      <title>3.1 Simulated and real RNA-seq data</title>
      <p>Although AF4 was designed to handle cfNA data, it is applicable directly to RNA-seq data. To demonstrate this, we ran AF4 on widely used datasets in methods comparison (<xref rid="btz346-B10" ref-type="bibr">Liu <italic>et al.</italic>, 2016</xref>). They consist of 15 datasets—three read lengths (50 bp, 75 bp and 100 bp) and five different coverage levels (5×, 20×, 50×, 100× and 200×). Each dataset contains fragments that match 150 possible fusion events.</p>
      <p><xref rid="btz346-T1" ref-type="table">Table 1</xref> shows the results of AF4, STAR-Fusion (<xref rid="btz346-B5" ref-type="bibr">Haas <italic>et al.</italic>, 2017</xref>) and ChimeRScope (<xref rid="btz346-B9" ref-type="bibr">Li <italic>et al.</italic>, 2017</xref>), a recently developed alignment-free method that was shown to have an overall better performance than other methods. The most recent version of STAR-Fusion (v.1.5.0) was obtained from github (github.com/STAR-Fusion/STAR-Fusion/) along with the required reference folder (GRCh38_v27_CTAT_lib_Feb092018). We used the provided docker image to run STAR-Fusion. Note that ChimeRScope only reported 135 out of 150 possible fusion events due to the constraint that ChimeRScope is built on RefSeq annotation but the 15 excluded fusion events were simulated from Ensembl and involved non-coding regions by RefSeq annotation. AF4 reported on all 150 and achieved a higher F-score than ChimeRscope and STAR-Fusion for both targeted (over 0.98) and <italic>de novo</italic> modes (over 0.96). As expected, the <italic>de novo</italic> mode produced higher number of FPs.</p>
      <table-wrap id="btz346-T1" orientation="portrait" position="float">
        <label>Table 1.</label>
        <caption>
          <p>AF4 for simulated datasets (<xref rid="btz346-B10" ref-type="bibr">Liu <italic>et al.</italic>, 2016</xref>)</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="×" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Samples</th>
              <th rowspan="1" colspan="1"/>
              <th colspan="8" rowspan="1">AF4<hr/></th>
              <th rowspan="1" colspan="1">ChimeRScope</th>
              <th rowspan="1" colspan="1">STAR-Fusion</th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th colspan="4" rowspan="1">Targeted<hr/></th>
              <th colspan="4" rowspan="1">
                <italic>De novo</italic>
                <hr/>
              </th>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <th rowspan="1" colspan="1">Length (bp)</th>
              <th rowspan="1" colspan="1">Coverage</th>
              <th rowspan="1" colspan="1">TP</th>
              <th rowspan="1" colspan="1">FP</th>
              <th rowspan="1" colspan="1">FN</th>
              <th rowspan="1" colspan="1"><italic>F</italic>-score</th>
              <th rowspan="1" colspan="1">TP</th>
              <th rowspan="1" colspan="1">FP</th>
              <th rowspan="1" colspan="1">FN</th>
              <th rowspan="1" colspan="1"><italic>F</italic>-score</th>
              <th rowspan="1" colspan="1"><italic>F</italic>-score</th>
              <th rowspan="1" colspan="1"><italic>F</italic>-score</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">50</td>
              <td rowspan="1" colspan="1">5×</td>
              <td rowspan="1" colspan="1">146</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">0.986</td>
              <td rowspan="1" colspan="1">143</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.948</td>
              <td rowspan="1" colspan="1">0.416</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">50</td>
              <td rowspan="1" colspan="1">20×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.954</td>
              <td rowspan="1" colspan="1">0.855</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">50</td>
              <td rowspan="1" colspan="1">50×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.947</td>
              <td rowspan="1" colspan="1">0.867</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">50</td>
              <td rowspan="1" colspan="1">100×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.970</td>
              <td rowspan="1" colspan="1">0.908</td>
              <td rowspan="1" colspan="1">0.868</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">50</td>
              <td rowspan="1" colspan="1">200×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.970</td>
              <td rowspan="1" colspan="1">0.905</td>
              <td rowspan="1" colspan="1">0.875</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">75</td>
              <td rowspan="1" colspan="1">5×</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.980</td>
              <td rowspan="1" colspan="1">141</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">0.966</td>
              <td rowspan="1" colspan="1">0.948</td>
              <td rowspan="1" colspan="1">0.700</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">75</td>
              <td rowspan="1" colspan="1">20×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">143</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.949</td>
              <td rowspan="1" colspan="1">0.865</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">75</td>
              <td rowspan="1" colspan="1">50×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">143</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.957</td>
              <td rowspan="1" colspan="1">0.872</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">75</td>
              <td rowspan="1" colspan="1">100×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.954</td>
              <td rowspan="1" colspan="1">0.875</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">75</td>
              <td rowspan="1" colspan="1">200×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.970</td>
              <td rowspan="1" colspan="1">0.947</td>
              <td rowspan="1" colspan="1">0.875</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">100</td>
              <td rowspan="1" colspan="1">5×</td>
              <td rowspan="1" colspan="1">144</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">6</td>
              <td rowspan="1" colspan="1">0.980</td>
              <td rowspan="1" colspan="1">140</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">10</td>
              <td rowspan="1" colspan="1">0.966</td>
              <td rowspan="1" colspan="1">0.940</td>
              <td rowspan="1" colspan="1">0.692</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">100</td>
              <td rowspan="1" colspan="1">20×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">143</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.957</td>
              <td rowspan="1" colspan="1">0.878</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">100</td>
              <td rowspan="1" colspan="1">50×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">143</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.957</td>
              <td rowspan="1" colspan="1">0.875</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">100</td>
              <td rowspan="1" colspan="1">100×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">143</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.957</td>
              <td rowspan="1" colspan="1">0.872</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">100</td>
              <td rowspan="1" colspan="1">200×</td>
              <td rowspan="1" colspan="1">147</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0.990</td>
              <td rowspan="1" colspan="1">143</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">0.973</td>
              <td rowspan="1" colspan="1">0.957</td>
              <td rowspan="1" colspan="1">0.877</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <p><italic>Note</italic>: Each dataset contains fused reads of 150 gene pairs. In the targeted mode, the names of the 655 target gene pairs (including all 150 target ones) are given in the command line, along with the transcriptome. In the <italic>de novo</italic> mode, only the transcriptome is given.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>We further demonstrate the utility of AF4 using four breast cancer RNA-seq data (<xref rid="btz346-B10" ref-type="bibr">Liu <italic>et al.</italic>, 2016</xref>) in targeted mode, where the real fusion events can be found in <xref rid="btz346-B4" ref-type="bibr">Edgren <italic>et al.</italic>, 2011</xref>, <xref rid="btz346-T1" ref-type="table">Table 1</xref>. Because of the updated annotations of gene names, the genes TMEM49, WDR67 and KIAA0406 have been replaced with VMP1, TBC1D31 and TTI1, respectively. ENSG00000236127 was eliminated from evaluation since no proper annotation replacement was found. Using default parameters, 23 out of 26 total validated fusions have been identified and one Fp gene pair HMGA2/LP was reported. Upon inspection, we found that the two false negative gene pairs DHX35/ITCH and CCDC85C/SETD3 were excluded because of they failed by the ‘Nearby genes’ criterion imposed by AF4 (Section 2.4). The results, using default parameters, have one more true positive prediction than ChimeRScope, which was shown to have better predictions than others alignment-based methods that typically reported 5–20 true positive predictions in these data (<xref rid="btz346-B9" ref-type="bibr">Li <italic>et al.</italic>, 2017</xref>, <xref rid="btz346-T4" ref-type="table">Table 4</xref>).</p>
    </sec>
    <sec>
      <title>3.2 cfRNA data</title>
      <p>We have obtained 40 ml of whole blood collected in Streck tubes, separated into plasma and extracted cfRNA samples from two Stage IV Prostate cancer patients and three healthy controls from Conversant Bio and generated cfRNA sequencing data with UMIs added. For the two cancer patients, it has been determined that TMPRSS2-ETV4 and TMPRSS2-ERG fusion were the most likely real fusion events, because TMPRSS2 fusion are detected in 50% of prostate cancer (<xref rid="btz346-B14" ref-type="bibr">Tomlins <italic>et al.</italic>, 2008</xref>). The three healthy individuals had a primary diagnosis of normal, and therefore, should contain no real fusion events and serve as negative controls.</p>
      <p>We applied AF4 to these data using both the targeted and <italic>de novo</italic> mode using default parameters. We also tested the STAR-Fusion program (<xref rid="btz346-B5" ref-type="bibr">Haas <italic>et al.</italic>, 2017</xref>), which is one of few programs that can work with data of this size in a reasonable runtime.</p>
      <p><xref rid="btz346-T2" ref-type="table">Table 2</xref> shows the results on the inputs of 350 to 450 million readpairs. It contains the runtime, the number of supporting fragments for the fusions (TMPRSS2-ETV4 and TMPRSS2-ERG) in the two prostate cancer patient samples as an indicator of sensitivity and the number of reported fusion events as an indicator of FPs.</p>
      <table-wrap id="btz346-T2" orientation="portrait" position="float">
        <label>Table 2.</label>
        <caption>
          <p>Results of AF4 and STAR-Fusion on cfRNA data</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="2" colspan="1">Samples</th>
              <th rowspan="2" colspan="1">#readpairs (millions)</th>
              <th rowspan="2" colspan="1">Coverage</th>
              <th colspan="6" rowspan="1">Number of TMPRSS2-ETV4/ERG supporting fragments<hr/></th>
              <th colspan="4" rowspan="1">Number of reported fusion events<hr/></th>
            </tr>
            <tr>
              <th colspan="4" align="left" rowspan="1">AF4<hr/></th>
              <th colspan="2" align="left" rowspan="1">STAR-Fusion<hr/></th>
              <th colspan="2" rowspan="1">AF4<hr/></th>
              <th colspan="2" rowspan="1">STAR-Fusion<hr/></th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th colspan="2" align="left" rowspan="1">Targeted<hr/></th>
              <th colspan="2" align="left" rowspan="1">
                <italic>De novo</italic>
                <hr/>
              </th>
              <th colspan="2" rowspan="1"/>
              <th rowspan="1" colspan="1">Targeted</th>
              <th rowspan="1" colspan="1">
                <italic>De novo</italic>
              </th>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
            </tr>
            <tr>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" rowspan="1" colspan="1">Final</th>
              <th align="left" rowspan="1" colspan="1">Prelim</th>
              <th align="left" rowspan="1" colspan="1">Final</th>
              <th align="left" rowspan="1" colspan="1">Prelim</th>
              <th align="left" rowspan="1" colspan="1">Final</th>
              <th align="left" rowspan="1" colspan="1">Prelim</th>
              <th rowspan="1" colspan="1"/>
              <th rowspan="1" colspan="1"/>
              <th align="left" rowspan="1" colspan="1">Final</th>
              <th align="left" rowspan="1" colspan="1">Prelim</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Prc101</td>
              <td rowspan="1" colspan="1">373.8</td>
              <td rowspan="1" colspan="1">29 132</td>
              <td rowspan="1" colspan="1">19</td>
              <td rowspan="1" colspan="1">345</td>
              <td rowspan="1" colspan="1">19</td>
              <td rowspan="1" colspan="1">345</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">31</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">239</td>
              <td rowspan="1" colspan="1">19</td>
              <td rowspan="1" colspan="1">979</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Prc108</td>
              <td rowspan="1" colspan="1">464.5</td>
              <td rowspan="1" colspan="1">36 200</td>
              <td rowspan="1" colspan="1">9</td>
              <td rowspan="1" colspan="1">114</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">116</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">13</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">140</td>
              <td rowspan="1" colspan="1">13</td>
              <td rowspan="1" colspan="1">787</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC118</td>
              <td rowspan="1" colspan="1">399.8</td>
              <td rowspan="1" colspan="1">31 158</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">289</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">930</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC160</td>
              <td rowspan="1" colspan="1">348.9</td>
              <td rowspan="1" colspan="1">27 191</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">303</td>
              <td rowspan="1" colspan="1">21</td>
              <td rowspan="1" colspan="1">254</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC332</td>
              <td rowspan="1" colspan="1">443.2</td>
              <td rowspan="1" colspan="1">34 540</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">350</td>
              <td rowspan="1" colspan="1">18</td>
              <td rowspan="1" colspan="1">840</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn2">
            <p><italic>Note</italic>: The coverage is calculated by the formula #readpairs × 166/2.13, where 2.13 (million bp) is the panel size and 166 (bp) is used as the average fragment length. The middle section of the table shows the number of readpairs that support either the TMPRSS2-ETV4 or the TMPRSS2-ERG fusion event. As these two fusions are not expected in the healthy controls, they are marked by ‘—’. The right most part of the table shows the number of unique fusion events reported.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>For the two real fusions (middle section of <xref rid="btz346-T2" ref-type="table">Table 2</xref>), we report both the preliminary and final results for both programs. Preliminary results of AF4 are the output from the first stage of the program, whereas for STAR-Fusion, there were two preliminary filtered results, one based on FFPM filtering (fusion fragments per million total reads) that relies on the expression value (file with suffix.preliminary.filtered.FFPM) and the other is based on splice information (file with suffix.wSpliceInfo.wAnnot.pass). We used the result reported in the FFPM file in the table. As shown in the table, AF4 identified more fusion-supporting fragments compared to STAR-Fusion in the preliminary output and in most cases much less spurious fusions in both targeted and <italic>de novo</italic> mode. The preliminary results indicate the method’s capability to identify read-pairs derived from real fusion events. Also, the chimeric read counts considered by STAR-Fusion were around 20 and 33 million, respectively, 100 times more than AF4, indicating a higher specificity of AF4. In the final results (after filtering in stage two), AF4 reported both real fusions in targeted mode but missed one in <italic>de novo</italic> mode. Upon inspection, TMPRSS2-ERG was filtered out in the second stage because ERG has more than five partners. On the other hand, STAR-Fusion filtered out both real fusions, likely due to aggressive filtering as indicated by very low number of total reported fusions.</p>
      <p>Note that the parameters of both programs can be tuned to reduce the number of FP fusions, while retaining the real fusions. For example, by raising the minimum number of unique fusions supporting fragments from 2 to 5, AF4 will still retain the real fusions but reduce the number of total reported fusions to be under 10. Nonetheless, we report the results by using the default of both programs to reflect the needs to empirically adjust the parameters of the program to different data type to achieve acceptable performance.</p>
    </sec>
    <sec>
      <title>3.3 cfDNA data</title>
      <p>Fusion detection in DNA-seq data is more challenging. Because fusion junctions may occur within introns, typically over half of existing gene panels are devoted to capture fusions. Computationally, this translates to a larger search space and higher number of FPs. Typically, fusion detection programs intended for RNA-seq data are not directly applicable to DNA-seq data. However, we show the targeted mode of AF4 may be applicable to cfDNA data.</p>
      <p>We have created a proxy for circulating tumor DNA derived from plasma from human subjects by titrating genomic DNA carrying known genetic variations into a well characterized genome in a bottle (GIB) sample (NA12878) at six concentrations and then sheared them. Horizon control HD753 (<ext-link ext-link-type="uri" xlink:href="https://www.horizondiscovery.com/structural-multiplex-reference-standard-hd753">https://www.horizondiscovery.com/structural-multiplex-reference-standard-hd753</ext-link>) was used as the spike in sample, which contains two fusion variants, CCDC6/RET and SLC34A2/ROS1. Titration percentages varied between.001 and.01.</p>
      <p><xref rid="btz346-T3" ref-type="table">Table 3</xref> shows the results for AF4 and Manta (<xref rid="btz346-B10" ref-type="bibr">Liu <italic>et al.</italic>, 2016</xref>), with AF4 running in targeted mode using default parameters. For Manta, raw cfDNA sequencing data were trimmed to remove adapter sequences and aligned using BWA. PCR duplicates were identified using an internal tool that uses the fragment start and end position along the genome, along with the pair of UMIs that are annealed to each end of the read to disambiguate collision events. Aligned and deduplicated reads were then processed by Manta using the command line: ‘python configManta.py –tumorBam –runDir –referenceFasta –generateEvidenceBam –exome’, where hg19 was used as the reference. AF4 achieved comparable or better sensitivity compared to Manta. For Manta outputs, we removed non-fusion related outputs and merged all fusions involving the same two genes. However, the FPs in Manta are too high to be used to confidently call genuine fusion events. By further filtering using the target gene pairs as used by AF4, nearly all FPs were eliminated. This demonstrated that the strategy of targeting clinical relevant fusions is highly effective.</p>
      <table-wrap id="btz346-T3" orientation="portrait" position="float">
        <label>Table 3.</label>
        <caption>
          <p>Results of AF4-targeted mode and Manta on cfDNA titration data for identified fusion events</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="2" colspan="1">Samples (titration)</th>
              <th rowspan="2" colspan="1">readpairs (millions)</th>
              <th rowspan="2" colspan="1">Coverage</th>
              <th colspan="3" rowspan="1">AF4<hr/></th>
              <th colspan="3" rowspan="1">Manta<hr/></th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1">TP</th>
              <th rowspan="1" colspan="1">FP</th>
              <th rowspan="1" colspan="1">FN</th>
              <th rowspan="1" colspan="1">TP</th>
              <th rowspan="1" colspan="1">FP</th>
              <th rowspan="1" colspan="1">FN</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">T1 (0.001)</td>
              <td rowspan="1" colspan="1">1000.9</td>
              <td rowspan="1" colspan="1">78 004</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">13</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">3774</td>
              <td rowspan="1" colspan="1">1</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T2 (0.002)</td>
              <td rowspan="1" colspan="1">938.8</td>
              <td rowspan="1" colspan="1">73 165</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">11</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">2884</td>
              <td rowspan="1" colspan="1">2</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T4 (0.004)</td>
              <td rowspan="1" colspan="1">1141.2</td>
              <td rowspan="1" colspan="1">88 939</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">16</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">2723</td>
              <td rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T7 (0.006)</td>
              <td rowspan="1" colspan="1">998.1</td>
              <td rowspan="1" colspan="1">77 786</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">16</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">2353</td>
              <td rowspan="1" colspan="1">1</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T10 (0.008)</td>
              <td rowspan="1" colspan="1">951.4</td>
              <td rowspan="1" colspan="1">74 147</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">15</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">2455</td>
              <td rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T13 (0.01)</td>
              <td rowspan="1" colspan="1">1033.2</td>
              <td rowspan="1" colspan="1">80 522</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">22</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">2832</td>
              <td rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T14 (0.01)</td>
              <td rowspan="1" colspan="1">1014.2</td>
              <td rowspan="1" colspan="1">79 041</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">17</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">3108</td>
              <td rowspan="1" colspan="1">0</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn3">
            <p><italic>Note</italic>: The coverage is calculated by the formula #readpairs (millions) × 166/2.13, where 2.13 (million bp) is the panel size and 166 (bp) is used as the average fragment length. Some titrations have two to three replicates as shown in the first column.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>Note that due to the large search space and the fact that screening or tumor sub-typing is the main-intended use for cfDNA data, only targeted mode of AF4 is intended to be used for this data type. Although Manta can be used to discover novel fusion events, the excessive number of FPs makes it impractical without additional post-filtering.</p>
    </sec>
    <sec>
      <title>3.4 Performance</title>
      <p><xref rid="btz346-T4" ref-type="table">Table 4</xref> shows the number of fragments retained or dropped by various stages in the AF4 pipeline, using the samples from the previous sections. AF4 yields very few candidate fragments after the first stage—&lt;0.0001% in targeted mode and 0.1% in <italic>de novo</italic> mode. Moreover, the vast majority of the candidates from the first stage are PCR duplicates that can be removed. That leaves just a few candidates, even for very large datasets.</p>
      <table-wrap id="btz346-T4" orientation="portrait" position="float">
        <label>Table 4.</label>
        <caption>
          <p>Efficacy of filtering policies implemented in AF4</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Samples</th>
              <th rowspan="1" colspan="1">Stage one</th>
              <th rowspan="1" colspan="1">Low cmpl seq</th>
              <th rowspan="1" colspan="1">Nearby genes</th>
              <th rowspan="1" colspan="1">PCR dups</th>
              <th rowspan="1" colspan="1">Abund partners</th>
              <th rowspan="1" colspan="1">Final</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">T1</td>
              <td rowspan="1" colspan="1">345</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">243</td>
              <td rowspan="1" colspan="1">66</td>
              <td rowspan="1" colspan="1">35</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T2</td>
              <td rowspan="1" colspan="1">287</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">202</td>
              <td rowspan="1" colspan="1">41</td>
              <td rowspan="1" colspan="1">39</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T4</td>
              <td rowspan="1" colspan="1">709</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">43</td>
              <td rowspan="1" colspan="1">519</td>
              <td rowspan="1" colspan="1">65</td>
              <td rowspan="1" colspan="1">77</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T7</td>
              <td rowspan="1" colspan="1">397</td>
              <td rowspan="1" colspan="1">4</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">302</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">83</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T10</td>
              <td rowspan="1" colspan="1">704</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">571</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">127</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T13</td>
              <td rowspan="1" colspan="1">866</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">717</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">146</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T14</td>
              <td rowspan="1" colspan="1">679</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">3</td>
              <td rowspan="1" colspan="1">559</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">114</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Prc101 (T)</td>
              <td rowspan="1" colspan="1">29 754</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">25 592</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">4162</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Prc101 (D)</td>
              <td rowspan="1" colspan="1">296 113</td>
              <td rowspan="1" colspan="1">1172</td>
              <td rowspan="1" colspan="1">6038</td>
              <td rowspan="1" colspan="1">257 979</td>
              <td rowspan="1" colspan="1">29 838</td>
              <td rowspan="1" colspan="1">1481</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Prc108 (T)</td>
              <td rowspan="1" colspan="1">284</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">28</td>
              <td rowspan="1" colspan="1">203</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">53</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Prc108 (D)</td>
              <td rowspan="1" colspan="1">325 417</td>
              <td rowspan="1" colspan="1">794</td>
              <td rowspan="1" colspan="1">6047</td>
              <td rowspan="1" colspan="1">261 012</td>
              <td rowspan="1" colspan="1">56 199</td>
              <td rowspan="1" colspan="1">1634</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC332 (T)</td>
              <td rowspan="1" colspan="1">64</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">59</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">5</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC332 (D)</td>
              <td rowspan="1" colspan="1">140 189</td>
              <td rowspan="1" colspan="1">407</td>
              <td rowspan="1" colspan="1">3127</td>
              <td rowspan="1" colspan="1">121 074</td>
              <td rowspan="1" colspan="1">14 156</td>
              <td rowspan="1" colspan="1">1681</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC118 (T)</td>
              <td rowspan="1" colspan="1">116</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">111</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">5</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC118 (D)</td>
              <td rowspan="1" colspan="1">449 265</td>
              <td rowspan="1" colspan="1">723</td>
              <td rowspan="1" colspan="1">9030</td>
              <td rowspan="1" colspan="1">420 528</td>
              <td rowspan="1" colspan="1">17 305</td>
              <td rowspan="1" colspan="1">1880</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC160 (T)</td>
              <td rowspan="1" colspan="1">2</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">1</td>
              <td rowspan="1" colspan="1">0</td>
              <td rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC160 (D)</td>
              <td rowspan="1" colspan="1">22 173</td>
              <td rowspan="1" colspan="1">174</td>
              <td rowspan="1" colspan="1">539</td>
              <td rowspan="1" colspan="1">18 658</td>
              <td rowspan="1" colspan="1">1693</td>
              <td rowspan="1" colspan="1">1154</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn4">
            <p><italic>Note</italic>: ‘Stage one’ column shows the number of fusion candidate fragments found in the first stage. Columns ‘Low cmpl seq’ (low-complexity sequences), ‘Nearby genes’, ‘PCR dups’ (PCR duplicates), and ‘Abund partners’ (genes with too many partners) show the number of candidates dropped due to the named policies defined in Section 2.4. ‘Final’ column shows the final number of fusion fragments reported.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p><xref rid="btz346-T5" ref-type="table">Table 5</xref> summarizes the performance of the systems studied in the previous sections. We omitted simulated datasets (Section 3.1) as AF4 takes about 10 s in targeted mode to 60 s in <italic>de novo</italic> mode. We could not run ChimeRScope ourselves due to licensing reasons, but <xref rid="btz346-B9" ref-type="bibr">Li <italic>et al.</italic>, (2017)</xref> reported that its read throughput is of &gt;5000 reads per minute/CPU. Extrapolating, AF4 looks to be 300 times faster than ChimeRScope. AF4 is significantly faster than STAR-Fusion, by 12× to 23×. Its performance is on par with Manta; however, this does not include the time spent generating the alignments which took over 6 h for the samples in our datasets.</p>
      <table-wrap id="btz346-T5" orientation="portrait" position="float">
        <label>Table 5.</label>
        <caption>
          <p>Runtimes of AF4, STAR-Fusion and Manta in seconds (wall-clock time), where the same number of cores were used</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="2" colspan="1">Samples</th>
              <th rowspan="2" align="left" colspan="1">#readpairs (millions)</th>
              <th align="left" rowspan="1" colspan="1">AF4</th>
              <th align="left" rowspan="1" colspan="1">AF4</th>
              <th rowspan="2" align="left" colspan="1">STAR- Fusion</th>
              <th rowspan="2" align="left" colspan="1">Manta</th>
            </tr>
            <tr>
              <th rowspan="1" colspan="1">Targeted</th>
              <th rowspan="1" colspan="1">
                <italic>De novo</italic>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Prc101</td>
              <td rowspan="1" colspan="1">373.8</td>
              <td rowspan="1" colspan="1">362</td>
              <td rowspan="1" colspan="1">481</td>
              <td rowspan="1" colspan="1">8475</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Prc108</td>
              <td rowspan="1" colspan="1">464.5</td>
              <td rowspan="1" colspan="1">340</td>
              <td rowspan="1" colspan="1">462</td>
              <td rowspan="1" colspan="1">16 075</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC118</td>
              <td rowspan="1" colspan="1">399.8</td>
              <td rowspan="1" colspan="1">346</td>
              <td rowspan="1" colspan="1">470</td>
              <td rowspan="1" colspan="1">8801</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC160</td>
              <td rowspan="1" colspan="1">348.9</td>
              <td rowspan="1" colspan="1">373</td>
              <td rowspan="1" colspan="1">381</td>
              <td rowspan="1" colspan="1">7903</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">HC332</td>
              <td rowspan="1" colspan="1">443.2</td>
              <td rowspan="1" colspan="1">382</td>
              <td rowspan="1" colspan="1">391</td>
              <td rowspan="1" colspan="1">12 666</td>
              <td rowspan="1" colspan="1">—</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T1 (0.001)</td>
              <td rowspan="1" colspan="1">1000.9</td>
              <td rowspan="1" colspan="1">1000</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1280</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T2 (0.002)</td>
              <td rowspan="1" colspan="1">938.8</td>
              <td rowspan="1" colspan="1">938</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1160</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T4 (0.004)</td>
              <td rowspan="1" colspan="1">1141.2</td>
              <td rowspan="1" colspan="1">1268</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">2016</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T7 (0.006)</td>
              <td rowspan="1" colspan="1">998.1</td>
              <td rowspan="1" colspan="1">1124</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1160</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T10 (0.008)</td>
              <td rowspan="1" colspan="1">951.4</td>
              <td rowspan="1" colspan="1">1104</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1040</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T13 (0.01)</td>
              <td rowspan="1" colspan="1">1033.2</td>
              <td rowspan="1" colspan="1">1217</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1190</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T14 (0.01)</td>
              <td rowspan="1" colspan="1">1014.2</td>
              <td rowspan="1" colspan="1">1117</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">—</td>
              <td rowspan="1" colspan="1">1490</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn5">
            <p><italic>Note</italic>: Samples are from Sections 3.2 and 3.3. Times for Manta exclude the alignment and de-duplication steps.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>The vast majority of AF4’s runtime is spent in the first stage; the second stage runs in a few seconds for all the datasets. For the first stage, AF4 spends 40–50% of its time in kmer-to-gene-list map lookups. This map is so large that it always causes TLB- and CPU-cache misses, and this operation happens at every position of every fragment.</p>
      <p>Interestingly, the core AF4 algorithms—computing the coverage by genes, examining pairwise combinations of genes, and picking the best fusion—takes an insignificant fraction of time: 0% in targeted mode and 3% in <italic>de novo</italic> mode. In targeted (or <italic>de novo</italic>) mode, one fragment finds on average 0.5 (or 2, respectively) gene that has any kmer in common. Thus, many fragments are dropped without running our main fusion detection code.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>We have originally developed AF4 to efficiently handle cfRNA data but we observed that AF4 could be directly applied to tissue RNA-seq data. Moreover, it is encouraging to see that the targeted mode of AF4 can be used for cfDNA fusion detection: previously, alignment-based algorithms were typically needed to handle DNA-seq data due to the much larger search space.</p>
    <p>Fusion detection methods use varied filtering criteria for different data types. These programs, including AF4, are typically rich in parameters that require tuning. Therefore, AF4 is not intended to fully replace other fusion detection methods, but it would be a valuable addition due to its linear scalability, high sensitivity in retaining relevant fusion fragments, and effective optimization strategy to remove the majority of spurious fragments. Users have an option to use the output of the first stage of AF4 in combination with more sophisticated filtering methods, which should be able to handle a much-reduced data size. It is also worth noting that different data types may have different properties, therefore requiring different parameter settings. Our results showing superiority on these benchmark datasets does not imply that the superior performance will generalize to all other datasets.</p>
    <p>In order to select default parameters for AF4, we identified kmer size and the number of occurrences of the kmer shared across genes in the transcriptome data and identified the reasonable choices of the former to be 17–19 and the latter to be 2–3. With <italic>k </italic>=<italic> </italic>19, the default value, this approach allows efficient coverage computation with negligibly low false-match rate. Both of these parameters can be adjusted: when <italic>k</italic> decreases, the method would be more sensitive in picking up candidate fusion fragments, however, the average number of genes a kmer occurs in would increase. Correspondingly, the number of occurrences of a kmer shared across genes should be increased to avoid of kmers being dropped. The filtering thresholds in the second stage of AF4 would be more relevant to the particular application and users have the option to learn empirically the optimal settings to have a balance between sensitivity and specificity.</p>
    <p>One drawback of AF4 is its difficulty in detection fusion events where single nucleotide polymorphisms (SNPs) exist near a junction, which limits its ability to identify fusion spanning fragments, whereas alignment-based methods would likely be able to identify these fragments by tolerating mismatches. However, based on the design of the method, this can be addressed by generating additional reference sequences by incorporating common SNPs on the exon boundaries without needing to change the program. Some improvements can be built-in further in AF4 such as to include more sophisticated filtering criteria and to incorporate alignment-based strategies in stage two to improve specificity.</p>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgments</title>
    <p>We thank Darya Filippova, Alex Fields, Marius Eriksen, Arash Jamshidi, Alex Aravanis, Nathan Hunkapiller, Ognjen Nikolic and Megan Hall for their valuable suggestions and support of this work.</p>
    <sec>
      <title>Funding</title>
      <p>Grail Inc funded this work. No external grants or NIH grants were used.
</p>
      <p><italic>Conflict of interest</italic>: the authors are employed by Grail, Inc.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btz346-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bray</surname><given-names>N.L.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Near-optimal probabilistic RNA-seq quantification</article-title>. <source>Nat. Biotechnol</source>., <volume>34</volume>, <fpage>525.</fpage><pub-id pub-id-type="pmid">27043002</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chen</surname><given-names>K.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>BreakFusion: targeted assembly-based identification of gene fusions in whole transcriptome paired-end sequencing data</article-title>. <source>Bioinformatics</source>, <volume>28</volume>, <fpage>1923</fpage>–<lpage>1924</lpage>.<pub-id pub-id-type="pmid">22563071</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Donaldson</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Park</surname><given-names>B.H.</given-names></name></person-group> (<year>2018</year>) 
<article-title>Circulating tumor DNA: measurement and clinical utility</article-title>. <source>Ann. Rev. Med</source>., <volume>69</volume>, <fpage>223</fpage>–<lpage>234</lpage>.<pub-id pub-id-type="pmid">28846488</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Edgren</surname><given-names>H.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>Identification of fusion genes in breast cancer by paired-end RNA-sequencing</article-title>. <source>Genome Biol</source>., <volume>12</volume>, <fpage>R6.</fpage><pub-id pub-id-type="pmid">21247443</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Haas</surname><given-names>B.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>). 
<article-title>STAR-Fusion: fast and accurate fusion transcript detection from RNA-seq</article-title>. <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/120295v1">https://www.biorxiv.org/content/10.1101/120295v1</ext-link>.</mixed-citation>
    </ref>
    <ref id="btz346-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jia</surname><given-names>W.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>SOAPfuse: an algorithm for identifying fusion transcripts from paired-end RNA-seq data</article-title>. <source>Genome Biol</source>., <volume>14</volume>, <fpage>R12.</fpage><pub-id pub-id-type="pmid">23409703</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kim</surname><given-names>D.</given-names></name>, <name name-style="western"><surname>Salzberg</surname><given-names>S.L.</given-names></name></person-group> (<year>2011</year>) 
<article-title>TopHat-Fusion: an algorithm for discovery of novel fusion transcripts</article-title>. <source>Genome Biol</source>., <volume>12</volume>, <fpage>R72.</fpage><pub-id pub-id-type="pmid">21835007</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kumar</surname><given-names>S.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Comparative assessment of methods for the fusion transcripts detection from RNA-seq data</article-title>. <source>Sci. Rep</source>., <volume>6</volume>, <fpage>21597</fpage>.<pub-id pub-id-type="pmid">26862001</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Li</surname><given-names>Y.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>ChimeRScope: a novel alignment-free algorithm for fusion transcript prediction using paired-end RNA-seq data</article-title>. <source>Nucleic Acids Res</source>., <volume>45</volume>, <fpage>e120.</fpage><pub-id pub-id-type="pmid">28472320</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Liu</surname><given-names>S.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Comprehensive evaluation of fusion transcript detection algorithms and a meta-caller to combine top performing methods in paired-end RNA-seq data</article-title>. <source>Nucleic Acids Res</source>., <volume>44</volume>, <fpage>e47</fpage>.<pub-id pub-id-type="pmid">26582927</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Melsted</surname><given-names>P.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Fusion detection and quantification by pseudoalignment</article-title>. <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/166322v1">https://www.biorxiv.org/content/10.1101/166322v1</ext-link>.</mixed-citation>
    </ref>
    <ref id="btz346-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Nicorici</surname><given-names>D.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>Fusioncatcher—a tool for finding somatic fusion genes in paired-end RNA-sequencing data</article-title>. <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/011650v1">https://www.biorxiv.org/content/10.1101/011650v1</ext-link>.</mixed-citation>
    </ref>
    <ref id="btz346-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tate</surname><given-names>J.G.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>COSMIC: the catalogue of somatic mutations in cancer</article-title>. <source>Nucleic Acids Res</source>., <volume>47</volume>, <fpage>D941</fpage>–<lpage>D947</lpage>.<pub-id pub-id-type="pmid">30371878</pub-id></mixed-citation>
    </ref>
    <ref id="btz346-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tomlins</surname><given-names>S.A.</given-names></name></person-group><etal>et al</etal> (<year>2008</year>) 
<article-title>Role of the TMPRSS2-ERG gene fusion in prostate cancer</article-title>. <source>Neoplasia</source>, <volume>10</volume>, <fpage>177</fpage>–<lpage>188</lpage>.<pub-id pub-id-type="pmid">18283340</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
