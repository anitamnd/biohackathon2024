<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10868328</article-id>
    <article-id pub-id-type="pmid">38237908</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae008</article-id>
    <article-id pub-id-type="publisher-id">btae008</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scKWARN: Kernel-weighted-average robust normalization for single-cell RNA-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8325-2112</contrib-id>
        <name>
          <surname>Hsu</surname>
          <given-names>Chih-Yuan</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0977-8743</contrib-id>
        <name>
          <surname>Chang</surname>
          <given-names>Chia-Jung</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Department of Biomedical Engineering, National Cheng Kung University</institution>, Tainan 701, <country country="TW">Taiwan</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8892-7078</contrib-id>
        <name>
          <surname>Liu</surname>
          <given-names>Qi</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <xref rid="btae008-cor1" ref-type="corresp"/>
        <!--qi.liu@vumc.org-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Shyr</surname>
          <given-names>Yu</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <xref rid="btae008-cor1" ref-type="corresp"/>
        <!--yu.shyr@vumc.org-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Boeva</surname>
          <given-names>Valentina</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae008-cor1">Corresponding author. Department of Biostatistics, Vanderbilt University Medical Center, Nashville, TN 37203, United States. E-mail: <email>qi.liu@vumc.org</email> (Q.L.); E-mail: <email>yu.shyr@vumc.org</email> (Y.S.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-01-17">
      <day>17</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>2</issue>
    <elocation-id>btae008</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>7</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>05</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>02</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>07</day>
        <month>2</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae008.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Single-cell RNA-seq normalization is an essential step to correct unwanted biases caused by sequencing depth, capture efficiency, dropout, and other technical factors. Existing normalization methods primarily reduce biases arising from sequencing depth by modeling count-depth relationship and/or assuming a specific distribution for read counts. However, these methods may lead to over or under-correction due to presence of technical biases beyond sequencing depth and the restrictive assumption on models and distributions.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We present scKWARN, a <underline>K</underline>ernel <underline>W</underline>eighted <underline>A</underline>verage <underline>R</underline>obust <underline>N</underline>ormalization designed to correct known or hidden technical confounders without assuming specific data distributions or count-depth relationships. scKWARN generates a pseudo expression profile for each cell by borrowing information from its fuzzy technical neighbors through a kernel smoother. It then compares this profile against the reference derived from cells with the same bimodality patterns to determine the normalization factor. As demonstrated in both simulated and real datasets, scKWARN outperforms existing methods in removing a variety of technical biases while preserving true biological heterogeneity.</p>
      </sec>
      <sec id="s3">
        <title>Availability and Implementation</title>
        <p>scKWARN is freely available at <ext-link xlink:href="https://github.com/cyhsuTN/scKWARN" ext-link-type="uri">https://github.com/cyhsuTN/scKWARN</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Institutes of Health</institution>
            <institution-id institution-id-type="DOI">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>P30 CA068485</award-id>
        <award-id>U24 CA163056</award-id>
        <award-id>P50 CA236733</award-id>
        <award-id>P50 CA098131</award-id>
        <award-id>U54 CA163072</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Providing transcriptomes at the resolution of individual cells, single-cell RNA sequencing (scRNAseq) has become a powerful tool for identifying and characterizing cellular heterogeneity and transition states (<xref rid="btae008-B6" ref-type="bibr">Han <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btae008-B8" ref-type="bibr">Lee <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btae008-B14" ref-type="bibr">Shami <italic toggle="yes">et al.</italic> 2020</xref>). However, scRNAseq data have high level of technical noise and sparsity due to complicated and multi-step experimental protocols and tiny amount of starting material per cell, which make the analysis very challenging. Normalization is the first essential step that adjusts the effect of technical biases to make expression comparable across genes and/or cells. Accurate normalization is critical for valid and biologically meaningful downstream analysis.</p>
    <p>There are a number of normalization methods available for bulk RNA-seq data. They generally calculate global scaling factors based on the non-DE assumption, that is, most of genes are not differentially expressed (DE) across experiments. The most commonly used approaches, such as Trimmed Mean of M-values (TMM) in edgeR (<xref rid="btae008-B13" ref-type="bibr">Robinson and Oshlack 2010</xref>), Relative Log Expression (RLE) in DESeq2 (<xref rid="btae008-B9" ref-type="bibr">Love <italic toggle="yes">et al.</italic> 2014</xref>), and Median Ratio Normalization (MRN) (<xref rid="btae008-B11" ref-type="bibr">Maza <italic toggle="yes">et al.</italic> 2013</xref>), achieve great performance. However, they are not applicable in the scRNAseq setting due to its characteristics of excessive number of zeros. The extreme sparsity would result in a geometric mean of zero for RLE and undefined M values for TMM. The unbalanced sizes between rare and abundant cell populations in scRNAseq would partially violate the non-DE assumption and introduce spurious biases.</p>
    <p>Recently, several methods tailored for scRNAseq normalization have emerged. They generally fall into two categories, global and gene-specific scaling factors. Global scaling factors correct cell-specific systematic biases, meaning that genes are normalized by the same constant in each cell. The most straightforward and widely-used approach is RC (relative counts), which divides raw counts by the total number of counts in each cell, then multiplies a constant factor (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019)</xref>. If RNA composition is different across cells, the usage of spike in RNAs instead of library sizes might be better to estimate scale factors, such as BASiCS (<xref rid="btae008-B16" ref-type="bibr">Vallejos <italic toggle="yes">et al.</italic> 2015</xref>), SAMstrt (<xref rid="btae008-B7" ref-type="bibr">Katayama <italic toggle="yes">et al.</italic> 2013</xref>) and Gamma Regression Model (GRM) (<xref rid="btae008-B3" ref-type="bibr">Ding <italic toggle="yes">et al.</italic> 2015</xref>). To reduce the effect of problematic zeros, scran (Lun <italic toggle="yes">et al.</italic> 2016) sums expression across pools of cells by library sizes, normalizes the cell pool against an average reference, and deconvolves the pool-based size factors to yield cell-based factors by a linear system. Assuming single-cell RNAseq data follow the Pareto distribution, PsiNorm (Borella <italic toggle="yes">et al.</italic> 2021) derives a global normalization factor from the Pareto distribution shape parameter that is inversely proportion to the sequencing depth. Unlike global scaling factors, which assume uniform technical biases across all genes in each cell, gene-specific scaling methods acknowledge diverse relationships between expression and technical factors across genes (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>). For example, SCnorm (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>) groups genes by their similarity on count-depth relationships and applies linear quantile regression to determine scale factors within each group. sctransform (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>) utilizes a linear negative binomial regression model to estimate the count-depth relationship for each gene. It predicts expected counts using stable coefficient estimates from a kernel smoother and considers the residuals from the model as normalized expression levels. While these pioneering approaches successfully address noise arising from sequencing depth, their performance relies on the assumption of a faithful linear count-depth relationship and a specific distribution of read counts. The count-depth relationships for specific marker genes, which are highly expressed in one cell type and not expressed in others, can vary significantly across cell populations. Assuming uniform count-depth relationships across cells may introduce artifacts during normalization. Moreover, while sequencing depth is a major source of technical noise, other factors such as amplification bias, capture efficiency, and dropout rates, all contribute to unwanted expression variations, which need to be adjusted as well.</p>
    <p>In this article, we introduce scKWARN, a novel scRNAseq normalization approach without assumption on data distributions or count-depth relationships. scKWARN first generates a pseudo-expression profile for each cell by leveraging information from its fuzzy technical neighbors. It then compares the pseudo profile against a reference derived from cells with the similar bimodality patterns to estimate the normalization factor based on the non-DE assumption. By defining technical neighbors through the similarity of non-zero counts distribution, scKWARN inherently consider any technical factors contributing to unwanted expression variation. Cells with similar bimodality patterns are highly likely to be from the same cell population, ensuring the non-DE assumption remains valid even in the presence of extremely unbalanced cell populations. Simulated and real case studies demonstrated that scKWARN is robust against a variety of technical and biological factors, with its performance independent of data distributions and count-depth relationships.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <p>scKWARN, single-cell Kernel-Weighted-Average Robust Normalization, consists of four steps (<xref rid="btae008-F1" ref-type="fig">Fig. 1</xref> &amp; Pseudocode in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>).</p>
    <fig position="float" id="btae008-F1">
      <label>Figure 1.</label>
      <caption>
        <p>Overview of scKWARN. Cell distances are calculated based on the first principal component of the 25th, 50th, and 75th percentiles of non-zero profiles. The non-zero pseudo profile of each cell is generated by summing weighted expression of its neighbors via a kernel smoother. The normalization factor of each cell is determined by the median ratio of its pseudo profile against its non-zero reference profile.</p>
      </caption>
      <graphic xlink:href="btae008f1" position="float"/>
    </fig>
    <p>The first step is to define technical neighbors, ie, cells that share similar technical factors such as library sizes or dropout rates. This concept is motivated by scran (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>), which pools cells with similar library sizes. Technical similarity is roughly calculated based on the first principal component of the 25th, 50th, and 75th percentiles of non-zero expression in cells. Suppose that scRNAseq data involve <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mi>G</mml:mi></mml:math></inline-formula> genes and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula> cells. <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the read count of gene <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula> in the cell <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>G</mml:mi></mml:math></inline-formula> and <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:math></inline-formula>. <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>g</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="normal"> </mml:mi><mml:mo>&gt;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>G</mml:mi><mml:mo>}</mml:mo></mml:math></inline-formula> is the subset of genes with non-zero counts in cell <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>. <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.25</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.50</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.75</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula> of <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mo>{</mml:mo><mml:mi mathvariant="normal">log</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula> is the three-dimensional vector comprising 25th, 50th, and 75th percentiles of log-transformed non-zero counts in cell <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>. r <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mo>=</mml:mo><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced><mml:mo>=</mml:mo></mml:math></inline-formula> PC1(<inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula>), is the first principal component of <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mi>Q</mml:mi></mml:math></inline-formula>. The technical similarity between cells <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula> and <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mi>j</mml:mi><mml:mi>′</mml:mi></mml:math></inline-formula> is estimated by the distance <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
    <p>The second step is to generate a pseudo gene expression profile for each cell by leveraging information from its technical neighbors using a kernel smoother. In scKWARN, “fuzzy” technical neighbors are defined, indicating no hard boundary to group cells. Instead, scKWARN generates the pseudo profile for non-zero genes in each cell by summing weighted expression of its technical neighbors via a kernel smoother. This approach reduces technical variability among cells, providing a robust estimation. The weight <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> used to calculate the pseudo-profile is both cell- and gene-specific, where <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi>′</mml:mi></mml:msup></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>K</mml:mi><mml:mo>{</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula>, <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mi>K</mml:mi><mml:mo>(</mml:mo><mml:mo>·</mml:mo><mml:mo>)</mml:mo></mml:math></inline-formula> is the Gaussian kernel, and <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the SJ bandwidth (<xref rid="btae008-B15" ref-type="bibr">Sheather and Jones 1991</xref>) data-driven by <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>. <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mi>j</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is the subset of cells with non-zero expression of gene <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula>. The pseudo expression profile for cell <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>, is generated from the kernel-weighted geometric means of non-zero genes of cell <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, where <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>.</p>
    <p>The third step is to build a reference profile for each cell. The reference profile for cell <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, denoted as <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>, where <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mfenced></mml:math></inline-formula>, is defined as the geometric mean of <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> across <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. In other words, for each non-zero gene <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula> in cell <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, the process entails finding the subset of cells expression this gene (<inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>) and calculating the geometric mean of the gene expression across <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. To be noted, <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is built based on non-zero genes in the cell <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, therefore <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is specific for cell <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>.</p>
    <p>The fourth step involves comparing the pseudo profile of each cell to its specific reference to determine the size factor based on the non-DE assumption. scKWARN estimates the normalization factor using a median-ratio strategy, where <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">median</mml:mi><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula>. Rather than all cells sharing the same reference, each cell in scKWARN has its own reference for comparison. These references are calculated from cells with similar cell types. The reference profile for a given cell is calculated from all cells with non-zero genes detected in that cell, meaning that the reference abundances of cell-specific genes are most likely to be derived from cells belonging to the same cell type. Using scRNAseq data generated from five cell lines as an example, reference profiles of cells belonging to the same cell type are grouped together. In other words, cells from the same cell type tend to have similar reference abundances (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). This approach ensures that the non-DE assumption is not violated, even in cases where cell populations are extremely unbalanced.</p>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Performance of scKWARN on simulated data</title>
      <p>The performance of scKWARN was evaluated and compared against five normalization methods: RC, scran, SCnorm, sctransform, and PsiNorm, using three simulated settings. The data were generated following the simulation studies described in scran (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>), SCnorm (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>), and sctransform (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>). In the first two simulation settings, the gene count and sequencing depth followed a linear relationship on the log-scale but with different error distributions: normal (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>) (Simulation I) and negative binomial distributions (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>) (Simulation II), respectively. In the third simulation setting, counts were sampled from a negative binomial distribution without the assumption of count-depth relationship (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>) (Simulation III). All three simulation studies involved 3000 genes for three subpopulations. For each simulation setting, five scenarios were designed by altering library sizes, RNA compositions (the percentage of counts from the most highly expressed genes), capture efficiency (dropout rates, the proportion of zero counts), cell population compositions, and the DE level (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). 100 simulation datasets were generated for each scenario.</p>
      <p>We utilized five metrics to evaluate performance: Bias, Root Mean Square Error (RMSE), Sensitivity, Specificity, and F1 score. These measures assess the preservation of biological variability while mitigating technical noise. MAST was used to identify DE genes (<xref rid="btae008-B4" ref-type="bibr">Finak <italic toggle="yes">et al.</italic> 2015</xref>). In addition to measuring the difference between the true and the estimated log2-fold-change, as Bias does, RMSE also takes into account the variance of this difference. The F1 score provides a balance between precision and recall. As such, our primary focus was on RMSE and F1 score (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). The performance, as measured by Bias, Sensitivity, and Specificity, were illustrated in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S2–S4</xref>.</p>
      <p>scKWARN demonstrated robustness against technical noises introduced by library sizes, RNA composition, capture efficiency, and biological effects of unbalanced cell populations and strong DE level, which obtained the lowest RMSE (<xref rid="btae008-F2" ref-type="fig">Fig. 2</xref>) and the highest F1 scores (<xref rid="btae008-F3" ref-type="fig">Fig. 3</xref>) across all five scenarios in each setting. Furthermore, the performance of scKWARN is independent of model and distribution assumptions, consistently achieving the best results in terms of RMSE and F1 scores across all three settings. In comparison, RC, scran, SCnorm, sctransform, and PsiNorm worked well in specific scenarios and/or settings, but their performances compromised in others (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). RC, as anticipated, was intolerant to RNA composition and dropout biases, resulting in the highest RMSE and the lowest F1 score in these two specific scenarios across all three settings. Scran successfully corrected the effect of sequencing depth but showed limitations when addressing the effect of RNA composition and dropout rates (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). In the simulations II and III, scran exhibited high RMSE values when cell populations were unbalanced and even the highest when strong DE level were added. PsiNorm consistently achieved low RMSE values across all three settings when biases were introduced by RNA composition and dropout rates. However, it showed high RMSE values in the simulation I with the other three scenarios (library size, cell composition, and cell composition+strong DE) and low F1 scores in the simulations II and III. Both SCnorm and sctransform estimate gene-specific scaling factors, and their performances were highly dependent on whether the simulation settings fit their underlying models. SCnorm worked effectively under the linear model with a normal distribution (Simulation I), while sctransform showed good performance under the negative binomial distribution (Simulation II and III). Despite aiming to adjust only the technical bias from sequencing depth by modeling count-depth relationships, they exhibited tolerance against RNA composition and capture efficiency biases. In their appropriate settings, SCnorm and sctransform achieved lower RMSE and higher F1 values than RC and scran. Their success in removing these noises can be attributed to the usage of gene-specific scale factors, where highly and lowly expressed genes are modeled separately. It is noteworthy that scKWARN, a method estimating global scaling factors, outperformed SCnorm and sctransform even in these two scenarios (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). In summary, scKWARN demonstrated robustness against a variety of known technical factors without imposing restrictive assumptions on models or distributions.</p>
      <fig position="float" id="btae008-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Performance comparison in terms of RMSE in three simulation settings with five scenarios. In simulation I and II (the top and middle panels), the gene count and sequencing depth both followed a linear relationship on the log-scale but with different error distributions, normal and negative binomial distributions, respectively. In simulation III (the bottom panel), counts were sampled from a negative binomial distribution without the assumption of count-depth relationship. Five scenarios were designed by altering library sizes, RNA compositions, dropout rates, cell population compositions and the DE level.</p>
        </caption>
        <graphic xlink:href="btae008f2" position="float"/>
      </fig>
      <fig position="float" id="btae008-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Performance comparison on F1 score in three simulation settings with five scenarios. In simulation I and II (the top and middle panels), the gene count and sequencing depth both followed a linear relationship on the log-scale but with different error distributions, normal and negative binomial distributions, respectively. In simulation III (the bottom panel), counts were sampled from a negative binomial distribution without the assumption of count-depth relationship. Five scenarios were designed by altering library sizes, RNA compositions, dropout rates, cell population compositions and the DE level.</p>
        </caption>
        <graphic xlink:href="btae008f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 Performance of scKWARN on real data</title>
      <p>We assessed the performance of scKWARN on two real scRNAseq datasets in terms of preserving biological variability and marker detection (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). The first dataset, PBMC33K, generated by 10x Genomics, comprises 33 148 human peripheral blood mononuclear cells and 32 738 genes. Similar to the simulation, we randomly extracted 1000 B cells and generated two cell populations. For each cell population, a certain percentage of genes were randomly chosen, and each gene was upsized by different factors to introduce varying magnitude of DE. We simulated four scenarios involving two factors: moderate/strong DE and balanced/unbalanced cell populations. In the moderate setting, 10% of genes were chosen randomly to be DE, while in the strong DE scenario, this percentage increased to 25%. The balanced setting involved each cell population having 1000 cells, while the unbalanced setting included one population with 1000 cells and the other with only 100 cells. We compared different normalization strategies based on the F1 score and their ability to recover the true fold change (<xref rid="btae008-F4" ref-type="fig">Fig. 4</xref>). scKWARN achieved the best performance with the highest F1 scores and the lowest RMSE values in all four scenarios, accurately estimating fold changes that closely matched the true values (<xref rid="btae008-F4" ref-type="fig">Fig. 4</xref>). sctransform also exhibited good performance across all settings. Conversely, RC performed poorly, displaying the lowest F1 scores and highest RMSE values, along with a shift between the true and the estimated fold changes. SCnorm, scran, and PsiNorm functioned properly when only moderate DE was present; however, their performance compromised in the presence of strong DE. SCnorm and scran’s performance deteriorated further in scenarios where strong DE and unbalanced cell population coexisted (<xref rid="btae008-F4" ref-type="fig">Fig. 4b</xref>). In addition, SCnorm appeared to over-adjust genes with large magnitude of DE, resulting in an underestimation of fold changes in the balanced setting. We also introduced four scenarios where each gene was downsized by different factors to introduce varying magnitude of DE (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). In these scenarios, both scKWARN and SCnorm consistently outperformed other methods, attaining higher F1 scores and lower RMSE values (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>).</p>
      <fig position="float" id="btae008-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Performance comparison on the PBMC33K dataset with Moderate DE (a) and Strong DE (b) settings. The balanced setting has each cell population of 1000 cells (left panel), while the unbalanced includes one of 1000 and the other of only 100 cells (right panel).</p>
        </caption>
        <graphic xlink:href="btae008f4" position="float"/>
      </fig>
      <p>The second dataset was downloaded from the Gene Expression Omnibus (GEO) database with Accession No. GSE29087, comprising 92 cells (48 mouse embryonic cells and 44 mouse embryonic fibroblasts) and 22 928 genes. After filtering out genes expressed in fewer than 3 cells in either of the two groups, 7896 genes were retained for the differential analysis. Among these 7896 genes, 718, which had been validated through qRT-PCR experiments, were considered as the gold standard DE genes (<xref rid="btae008-B12" ref-type="bibr">Moliner <italic toggle="yes">et al.</italic> 2008</xref>). Since the gold standard genes represent only a subset of true DE genes, as mentioned by (<xref rid="btae008-B17" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> 2019</xref>), we estimated the proportion of the gold standard genes among the top N genes ranked by each method. The performance was compared in three settings: none of the cells downsized, half of the cells downsized, or all cells downsized by random variables from Uniform(0.2, 1). In the original dataset (no downsizing of cells) or when half of the cells were randomly chosen for downsizing, sctransform achieved the highest accuracy in the detection of DE genes, followed by PsiNorm and scKWARN (<xref rid="btae008-F5" ref-type="fig">Fig. 5a and b</xref>). Surprisingly, scran exhibited the lowest proportion, likely attributed to the limited number of cells, which may not be adequate for pooling together to achieve an accurate normalization factor estimation. When all cells were downsized, scKWARN and PsiNorm maintained their performance, while the proportion estimated by sctransform significantly dropped, resulting in the superior performance of scKWARN and PsiNorm over sctransform (<xref rid="btae008-F5" ref-type="fig">Fig. 5c</xref>). This result suggests that scKWARN and PsiNorm demonstrate robustness even in scenarios with a high dropout rate and a small number of cells.</p>
      <fig position="float" id="btae008-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Performance comparison on the GSE29087 dataset. Y axis denotes the proportion of 718 gold standard genes in the top N genes (x axis). The performance was compared in three settings, where none of cells (a), half of the cells (b), or all cells (c) were downsized.</p>
        </caption>
        <graphic xlink:href="btae008f5" position="float"/>
      </fig>
      <p>Furthermore, we assessed the clustering performance of scKWARN using the third dataset, GSE118767, which includes ground truth cell type labels. This dataset, generated by various sequencing platforms, comprises seven datasets from five lung adenocarcinoma cell lines: H1975, H2228, HCC827, H838, and A549. Clustering quality was evaluated using Average Silhouette Width (ASW) and Adjusted Rand Index (ARI) (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). A higher score in these metrics suggests better clustering performance. Additionally, we employed the 1-correlation, where the correlation represents the maximum correlation between PC1 and PC2 of gene expressions and cell sequencing depths (<xref rid="btae008-B2" ref-type="bibr">Borella <italic toggle="yes">et al.</italic> 2021</xref>). A higher score in this context indicates lower correlation and better performance, signifying that normalization successfully eliminates biases introduced by sequencing depths. The average values of ASW, ARI and 1-correlation across the seven datasets were listed in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>. Overall, all normalization methods enhanced clustering performance, yielding higher ASW and ARI values compared to unnormalized data. Among normalization methods, SCnorm exhibited the lowest ASW and ARI values and the second lowest 1-correlation score. This result suggests that normalization methods generally perform well in high-quality data. Subsequently, we simulated five scenarios ranging from well-balanced (1:1:1:1:1) to extremely imbalanced cell compositions (36:1:1:1:1) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>). In balanced settings, sctransform achieved the highest ASW values, while scKWARN and PsiNorm demonstrated higher ASW values as the cell composition became more imbalanced (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>, UMAP and PCA plots in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S7</xref> and <xref rid="sup1" ref-type="supplementary-material">S8</xref>). This trend became more pronounced when the imbalanced cell composition was driven by an increasing number of H838 cells and a decrease in other cell lines (<xref rid="btae008-F6" ref-type="fig">Fig. 6b</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>). All methods yielded higher ARI values than unnormalized data, indicating improved clustering performance (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>). scKWARN consistently achieved the highest 1-correlation scores in all scenarios (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>). SCnorm was not included in these scenarios due to lengthy computational time.</p>
      <fig position="float" id="btae008-F6">
        <label>Figure 6.</label>
        <caption>
          <p>Performance comparison of unnormalized and five normalization methods on the GSE118767 datasets with five scenarios (1–5) where the cell composition changes from balanced (scenario 1) to extremely imbalanced (scenario 5). (a) The imbalanced cell composition was driven by the increasing number of A549 but decreasing of other cell lines. (b) The imbalanced cell composition was driven by the increasing number of H838 but decreasing of other cell lines.</p>
        </caption>
        <graphic xlink:href="btae008f6" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.3 Computational performance</title>
      <p>We compared the computational performance of the six normalization methods using both real and simulated datasets with varying number of genes and cells (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>). As expected, RC and PsiNorm were the fastest due to simple algorithms. scran and scKWARN required more time than RC and PsiNorm. Sctransform and SCnorm, which depend on model fitting, had the longest computational time. SCnorm even failed on some large datasets.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>Accurate normalization is essential for the success of scRNAseq data analysis. An effective normalization method should preserve intrinsic biological features while correcting unwanted biases and be robust against known or hidden technical noises. Here, we introduce scKWARN, a method that does not assume specific data distributions or count-depth relationships. scKWARN has demonstrated improved performance over existing methods in both simulation and real studies. The absence of assumptions about count-depth relationships or read count distributions allows scKWARN to work effectively across diverse settings.</p>
    <p>The key strength of scKWARN lies in its way to construct pseudo-profiles for each cell by leveraging information from its fuzzy technical neighbors. These technical neighbors are approximately defined based on the quantile distribution of non-zero profiles. This approach empowers scKWARN to effectively eliminate noise introduced by hidden or unknown factors that impact non-zero counts distributions. Furthermore, each cell has its own reference profile for comparison, ensuring the robustness of the non-DE assumption even in scenarios with unbalanced cell population sizes, a situation frequently overlooked by existing methods.</p>
    <p>scKWARN utilizes the 25th, 50th, and 75th percentiles of non-zero profiles to define technical neighbors. These three percentiles are commonly employed to represent the location and scale of data, and they are robust against extreme values. This choice allows scKWARN to capture the main features of the data and counteract the effects of differentially expressed genes and highly expressed genes. While other percentiles between the 25th and 75th are feasible and yield similar results in downstream analysis (not shown), lower or higher percentiles, such as the 10th or 90th percentiles, are not recommended due to large variability in the tails of the expression profile. The use of lower/higher percentiles can result in high RMSE values and sensitive outcomes in differential expression analysis.</p>
    <p>scKWARN only employs the first principal component (PC) of the three-dimensional percentile data to identify technical neighbors. This decision was made due to the observation that incorporating additional PCs significantly escalated computational demands without corresponding performance improvements. For instance, employing two PCs (PC1+PC2) led to a 38% increase in computational time compared to using PC1 alone. Nevertheless, scKWARN utilizing PC1+PC2 yielded nearly identical RMSE and F1 scores as the one employing the PC1 alone across the three simulation settings with five different scenarios (<xref rid="sup1" ref-type="supplementary-material">Supplementary Tables S2</xref> and <xref rid="sup1" ref-type="supplementary-material">S3</xref>). The lack of improvement in performance may be attributed to the fact that PC1 already encompasses a substantial amount of variance in the three-dimensional percentile data. For example, PC1 included at least 70% of the variance in the percentile data in those simulations. Moreover, employing additional PCs might even compromise the performance. If more PCs were utilized, there is a greater likelihood of encompassing biological rather than technical variances, introducing potential biases in the determination of technical neighbors.</p>
    <p>scKWARN applies a both cell- and gene-specific weighting approach, which can be further improved for better computational performance by incorporating a cutoff option. This option sets low weights to zero when cell distances exceed the bandwidth by a specified cutoff factor (default cutoff = 2). The inclusion of the cutoff option has resulted in approximately 20% savings in computational time while maintaining consistent performance (<xref rid="sup1" ref-type="supplementary-material">Supplementary Tables S4</xref> and <xref rid="sup1" ref-type="supplementary-material">S5</xref>).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae008_Supplementary_Data</label>
      <media xlink:href="btae008_supplementary_data.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors would like to thank all reviewers for their insightful comments and valuable suggestions.</p>
  </ack>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the National Institutes of Health [P30 CA068485, U24 CA163056, P50 CA236733, P50 CA098131, U54 CA163072, U2C CA233291, P01 CA229123, P01 AI139449, and U54 CA274367].</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data underlying this article are available at <ext-link xlink:href="https://github.com/cyhsuTN/scKWARN" ext-link-type="uri">https://github.com/cyhsuTN/scKWARN</ext-link>.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae008-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bacher</surname><given-names>R</given-names></string-name>, <string-name><surname>Chu</surname><given-names>L-F</given-names></string-name>, <string-name><surname>Leng</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>SCnorm: robust normalization of single-cell RNA-seq data</article-title>. <source>Nat Methods</source><year>2017</year>;<volume>14</volume>:<fpage>584</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">28418000</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Borella</surname><given-names>M</given-names></string-name>, <string-name><surname>Martello</surname><given-names>G</given-names></string-name>, <string-name><surname>Risso</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>PsiNorm: a scalable normalization for single-cell RNA-seq data</article-title>. <source>Bioinformatics</source><year>2021</year>;<volume>38</volume>:<fpage>164</fpage>–<lpage>72</lpage>.<pub-id pub-id-type="pmid">34499096</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ding</surname><given-names>B</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>Y</given-names></string-name></person-group><etal>et al</etal><article-title>Normalization and noise reduction for single cell RNA-seq experiments</article-title>. <source>Bioinformatics</source><year>2015</year>;<volume>31</volume>:<fpage>2225</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">25717193</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Finak</surname><given-names>G</given-names></string-name>, <string-name><surname>McDavid</surname><given-names>A</given-names></string-name>, <string-name><surname>Yajima</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><year>2015</year>;<volume>16</volume>:<fpage>278</fpage>.<pub-id pub-id-type="pmid">26653891</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hafemeister</surname><given-names>C</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R.</given-names></string-name></person-group><article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>296</fpage>.<pub-id pub-id-type="pmid">31870423</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Han</surname><given-names>X</given-names></string-name>, <string-name><surname>Wang</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Y</given-names></string-name></person-group><etal>et al</etal><article-title>Mapping the mouse cell atlas by Microwell-Seq</article-title>. <source>Cell</source><year>2018</year>;<volume>173</volume>:<fpage>1307</fpage>.<pub-id pub-id-type="pmid">29775597</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Katayama</surname><given-names>S</given-names></string-name>, <string-name><surname>Töhönen</surname><given-names>V</given-names></string-name>, <string-name><surname>Linnarsson</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>SAMstrt: statistical test for differential expression in single-cell transcriptome with spike-in normalization</article-title>. <source>Bioinformatics</source><year>2013</year>;<volume>29</volume>:<fpage>2943</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">23995393</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>H-O</given-names></string-name>, <string-name><surname>Hong</surname><given-names>Y</given-names></string-name>, <string-name><surname>Etlioglu</surname><given-names>HE</given-names></string-name></person-group><etal>et al</etal><article-title>Lineage-dependent gene expression programs influence the immune landscape of colorectal cancer</article-title>. <source>Nat Genet</source><year>2020</year>;<volume>52</volume>:<fpage>594</fpage>–<lpage>603</lpage>.<pub-id pub-id-type="pmid">32451460</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Love</surname><given-names>MI</given-names></string-name>, <string-name><surname>Huber</surname><given-names>W</given-names></string-name>, <string-name><surname>Anders</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title>. <source>Genome Biol</source><year>2014</year>;<volume>15</volume>:<fpage>550</fpage>.<pub-id pub-id-type="pmid">25516281</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lun</surname><given-names>AT</given-names></string-name></person-group><string-name><surname>Bach</surname><given-names>K</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>. <article-title>Pooling across cells to normalize single-cell RNA sequencing data with many zero counts</article-title>. <source>Genome Biol</source><year>2016</year>;<volume>17</volume>:<fpage>75</fpage>.<pub-id pub-id-type="pmid">27122128</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maza</surname><given-names>E</given-names></string-name>, <string-name><surname>Frasse</surname><given-names>P</given-names></string-name>, <string-name><surname>Senin</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Comparison of normalization methods for differential gene expression analysis in RNA-Seq experiments: a matter of relative size of studied transcriptomes</article-title>. <source>Commun Integr Biol</source><year>2013</year>;<volume>6</volume>:<fpage>e25849</fpage>.<pub-id pub-id-type="pmid">26442135</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moliner</surname><given-names>A</given-names></string-name>, <string-name><surname>Enfors</surname><given-names>P</given-names></string-name>, <string-name><surname>Ibáñez</surname><given-names>CF</given-names></string-name></person-group><etal>et al</etal><article-title>Mouse embryonic stem cell-derived spheres with distinct neurogenic potentials</article-title>. <source>Stem Cells Dev</source><year>2008</year>;<volume>17</volume>:<fpage>233</fpage>–<lpage>43</lpage>.<pub-id pub-id-type="pmid">18447639</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Robinson</surname><given-names>MD</given-names></string-name>, <string-name><surname>Oshlack</surname><given-names>A.</given-names></string-name></person-group><article-title>A scaling normalization method for differential expression analysis of RNA-seq data</article-title>. <source>Genome Biol</source><year>2010</year>;<volume>11</volume>:<fpage>R25</fpage>.<pub-id pub-id-type="pmid">20196867</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shami</surname><given-names>AN</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>X</given-names></string-name>, <string-name><surname>Munyoki</surname><given-names>SK</given-names></string-name></person-group><etal>et al</etal><article-title>Single-Cell RNA sequencing of human, macaque, and mouse testes uncovers conserved and divergent features of mammalian spermatogenesis</article-title>. <source>Dev Cell</source><year>2020</year>;<volume>54</volume>:<fpage>529</fpage>–<lpage>47.e12</lpage>.<pub-id pub-id-type="pmid">32504559</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sheather</surname><given-names>SJ</given-names></string-name>, <string-name><surname>Jones</surname><given-names>MC.</given-names></string-name></person-group><article-title>A reliable data-based bandwidth selection method for kernel density estimation</article-title>. <source>J R Stat Soc Ser B</source><year>1991</year>;<volume>53</volume>:<fpage>683</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="btae008-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vallejos</surname><given-names>CA</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>, <string-name><surname>Richardson</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>BASiCS: Bayesian analysis of Single-Cell sequencing data</article-title>. <source>PLoS Comput Biol</source><year>2015</year>;<volume>11</volume>:<fpage>e1004333</fpage>.<pub-id pub-id-type="pmid">26107944</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>T</given-names></string-name>, <string-name><surname>Li</surname><given-names>B</given-names></string-name>, <string-name><surname>Nelson</surname><given-names>CE</given-names></string-name></person-group><etal>et al</etal><article-title>Comparative analysis of differential gene expression analysis tools for single-cell RNA sequencing data</article-title>. <source>BMC Bioinformatics</source><year>2019</year>;<volume>20</volume>:<fpage>40</fpage>.<pub-id pub-id-type="pmid">30658573</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10868328</article-id>
    <article-id pub-id-type="pmid">38237908</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae008</article-id>
    <article-id pub-id-type="publisher-id">btae008</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scKWARN: Kernel-weighted-average robust normalization for single-cell RNA-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8325-2112</contrib-id>
        <name>
          <surname>Hsu</surname>
          <given-names>Chih-Yuan</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0977-8743</contrib-id>
        <name>
          <surname>Chang</surname>
          <given-names>Chia-Jung</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Department of Biomedical Engineering, National Cheng Kung University</institution>, Tainan 701, <country country="TW">Taiwan</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8892-7078</contrib-id>
        <name>
          <surname>Liu</surname>
          <given-names>Qi</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <xref rid="btae008-cor1" ref-type="corresp"/>
        <!--qi.liu@vumc.org-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Shyr</surname>
          <given-names>Yu</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <xref rid="btae008-cor1" ref-type="corresp"/>
        <!--yu.shyr@vumc.org-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Boeva</surname>
          <given-names>Valentina</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae008-cor1">Corresponding author. Department of Biostatistics, Vanderbilt University Medical Center, Nashville, TN 37203, United States. E-mail: <email>qi.liu@vumc.org</email> (Q.L.); E-mail: <email>yu.shyr@vumc.org</email> (Y.S.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-01-17">
      <day>17</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>2</issue>
    <elocation-id>btae008</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>7</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>05</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>02</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>07</day>
        <month>2</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae008.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Single-cell RNA-seq normalization is an essential step to correct unwanted biases caused by sequencing depth, capture efficiency, dropout, and other technical factors. Existing normalization methods primarily reduce biases arising from sequencing depth by modeling count-depth relationship and/or assuming a specific distribution for read counts. However, these methods may lead to over or under-correction due to presence of technical biases beyond sequencing depth and the restrictive assumption on models and distributions.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We present scKWARN, a <underline>K</underline>ernel <underline>W</underline>eighted <underline>A</underline>verage <underline>R</underline>obust <underline>N</underline>ormalization designed to correct known or hidden technical confounders without assuming specific data distributions or count-depth relationships. scKWARN generates a pseudo expression profile for each cell by borrowing information from its fuzzy technical neighbors through a kernel smoother. It then compares this profile against the reference derived from cells with the same bimodality patterns to determine the normalization factor. As demonstrated in both simulated and real datasets, scKWARN outperforms existing methods in removing a variety of technical biases while preserving true biological heterogeneity.</p>
      </sec>
      <sec id="s3">
        <title>Availability and Implementation</title>
        <p>scKWARN is freely available at <ext-link xlink:href="https://github.com/cyhsuTN/scKWARN" ext-link-type="uri">https://github.com/cyhsuTN/scKWARN</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Institutes of Health</institution>
            <institution-id institution-id-type="DOI">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>P30 CA068485</award-id>
        <award-id>U24 CA163056</award-id>
        <award-id>P50 CA236733</award-id>
        <award-id>P50 CA098131</award-id>
        <award-id>U54 CA163072</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Providing transcriptomes at the resolution of individual cells, single-cell RNA sequencing (scRNAseq) has become a powerful tool for identifying and characterizing cellular heterogeneity and transition states (<xref rid="btae008-B6" ref-type="bibr">Han <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btae008-B8" ref-type="bibr">Lee <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btae008-B14" ref-type="bibr">Shami <italic toggle="yes">et al.</italic> 2020</xref>). However, scRNAseq data have high level of technical noise and sparsity due to complicated and multi-step experimental protocols and tiny amount of starting material per cell, which make the analysis very challenging. Normalization is the first essential step that adjusts the effect of technical biases to make expression comparable across genes and/or cells. Accurate normalization is critical for valid and biologically meaningful downstream analysis.</p>
    <p>There are a number of normalization methods available for bulk RNA-seq data. They generally calculate global scaling factors based on the non-DE assumption, that is, most of genes are not differentially expressed (DE) across experiments. The most commonly used approaches, such as Trimmed Mean of M-values (TMM) in edgeR (<xref rid="btae008-B13" ref-type="bibr">Robinson and Oshlack 2010</xref>), Relative Log Expression (RLE) in DESeq2 (<xref rid="btae008-B9" ref-type="bibr">Love <italic toggle="yes">et al.</italic> 2014</xref>), and Median Ratio Normalization (MRN) (<xref rid="btae008-B11" ref-type="bibr">Maza <italic toggle="yes">et al.</italic> 2013</xref>), achieve great performance. However, they are not applicable in the scRNAseq setting due to its characteristics of excessive number of zeros. The extreme sparsity would result in a geometric mean of zero for RLE and undefined M values for TMM. The unbalanced sizes between rare and abundant cell populations in scRNAseq would partially violate the non-DE assumption and introduce spurious biases.</p>
    <p>Recently, several methods tailored for scRNAseq normalization have emerged. They generally fall into two categories, global and gene-specific scaling factors. Global scaling factors correct cell-specific systematic biases, meaning that genes are normalized by the same constant in each cell. The most straightforward and widely-used approach is RC (relative counts), which divides raw counts by the total number of counts in each cell, then multiplies a constant factor (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019)</xref>. If RNA composition is different across cells, the usage of spike in RNAs instead of library sizes might be better to estimate scale factors, such as BASiCS (<xref rid="btae008-B16" ref-type="bibr">Vallejos <italic toggle="yes">et al.</italic> 2015</xref>), SAMstrt (<xref rid="btae008-B7" ref-type="bibr">Katayama <italic toggle="yes">et al.</italic> 2013</xref>) and Gamma Regression Model (GRM) (<xref rid="btae008-B3" ref-type="bibr">Ding <italic toggle="yes">et al.</italic> 2015</xref>). To reduce the effect of problematic zeros, scran (Lun <italic toggle="yes">et al.</italic> 2016) sums expression across pools of cells by library sizes, normalizes the cell pool against an average reference, and deconvolves the pool-based size factors to yield cell-based factors by a linear system. Assuming single-cell RNAseq data follow the Pareto distribution, PsiNorm (Borella <italic toggle="yes">et al.</italic> 2021) derives a global normalization factor from the Pareto distribution shape parameter that is inversely proportion to the sequencing depth. Unlike global scaling factors, which assume uniform technical biases across all genes in each cell, gene-specific scaling methods acknowledge diverse relationships between expression and technical factors across genes (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>). For example, SCnorm (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>) groups genes by their similarity on count-depth relationships and applies linear quantile regression to determine scale factors within each group. sctransform (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>) utilizes a linear negative binomial regression model to estimate the count-depth relationship for each gene. It predicts expected counts using stable coefficient estimates from a kernel smoother and considers the residuals from the model as normalized expression levels. While these pioneering approaches successfully address noise arising from sequencing depth, their performance relies on the assumption of a faithful linear count-depth relationship and a specific distribution of read counts. The count-depth relationships for specific marker genes, which are highly expressed in one cell type and not expressed in others, can vary significantly across cell populations. Assuming uniform count-depth relationships across cells may introduce artifacts during normalization. Moreover, while sequencing depth is a major source of technical noise, other factors such as amplification bias, capture efficiency, and dropout rates, all contribute to unwanted expression variations, which need to be adjusted as well.</p>
    <p>In this article, we introduce scKWARN, a novel scRNAseq normalization approach without assumption on data distributions or count-depth relationships. scKWARN first generates a pseudo-expression profile for each cell by leveraging information from its fuzzy technical neighbors. It then compares the pseudo profile against a reference derived from cells with the similar bimodality patterns to estimate the normalization factor based on the non-DE assumption. By defining technical neighbors through the similarity of non-zero counts distribution, scKWARN inherently consider any technical factors contributing to unwanted expression variation. Cells with similar bimodality patterns are highly likely to be from the same cell population, ensuring the non-DE assumption remains valid even in the presence of extremely unbalanced cell populations. Simulated and real case studies demonstrated that scKWARN is robust against a variety of technical and biological factors, with its performance independent of data distributions and count-depth relationships.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <p>scKWARN, single-cell Kernel-Weighted-Average Robust Normalization, consists of four steps (<xref rid="btae008-F1" ref-type="fig">Fig. 1</xref> &amp; Pseudocode in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>).</p>
    <fig position="float" id="btae008-F1">
      <label>Figure 1.</label>
      <caption>
        <p>Overview of scKWARN. Cell distances are calculated based on the first principal component of the 25th, 50th, and 75th percentiles of non-zero profiles. The non-zero pseudo profile of each cell is generated by summing weighted expression of its neighbors via a kernel smoother. The normalization factor of each cell is determined by the median ratio of its pseudo profile against its non-zero reference profile.</p>
      </caption>
      <graphic xlink:href="btae008f1" position="float"/>
    </fig>
    <p>The first step is to define technical neighbors, ie, cells that share similar technical factors such as library sizes or dropout rates. This concept is motivated by scran (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>), which pools cells with similar library sizes. Technical similarity is roughly calculated based on the first principal component of the 25th, 50th, and 75th percentiles of non-zero expression in cells. Suppose that scRNAseq data involve <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mi>G</mml:mi></mml:math></inline-formula> genes and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula> cells. <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the read count of gene <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula> in the cell <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>G</mml:mi></mml:math></inline-formula> and <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:math></inline-formula>. <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>g</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="normal"> </mml:mi><mml:mo>&gt;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>G</mml:mi><mml:mo>}</mml:mo></mml:math></inline-formula> is the subset of genes with non-zero counts in cell <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>. <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.25</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.50</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.75</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula> of <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mo>{</mml:mo><mml:mi mathvariant="normal">log</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula> is the three-dimensional vector comprising 25th, 50th, and 75th percentiles of log-transformed non-zero counts in cell <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>. r <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mo>=</mml:mo><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced><mml:mo>=</mml:mo></mml:math></inline-formula> PC1(<inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula>), is the first principal component of <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mi>Q</mml:mi></mml:math></inline-formula>. The technical similarity between cells <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula> and <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mi>j</mml:mi><mml:mi>′</mml:mi></mml:math></inline-formula> is estimated by the distance <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
    <p>The second step is to generate a pseudo gene expression profile for each cell by leveraging information from its technical neighbors using a kernel smoother. In scKWARN, “fuzzy” technical neighbors are defined, indicating no hard boundary to group cells. Instead, scKWARN generates the pseudo profile for non-zero genes in each cell by summing weighted expression of its technical neighbors via a kernel smoother. This approach reduces technical variability among cells, providing a robust estimation. The weight <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> used to calculate the pseudo-profile is both cell- and gene-specific, where <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi>′</mml:mi></mml:msup></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>K</mml:mi><mml:mo>{</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula>, <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mi>K</mml:mi><mml:mo>(</mml:mo><mml:mo>·</mml:mo><mml:mo>)</mml:mo></mml:math></inline-formula> is the Gaussian kernel, and <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the SJ bandwidth (<xref rid="btae008-B15" ref-type="bibr">Sheather and Jones 1991</xref>) data-driven by <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>. <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mi>j</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is the subset of cells with non-zero expression of gene <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula>. The pseudo expression profile for cell <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>, is generated from the kernel-weighted geometric means of non-zero genes of cell <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, where <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>.</p>
    <p>The third step is to build a reference profile for each cell. The reference profile for cell <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, denoted as <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>, where <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mfenced></mml:math></inline-formula>, is defined as the geometric mean of <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> across <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. In other words, for each non-zero gene <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula> in cell <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, the process entails finding the subset of cells expression this gene (<inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>) and calculating the geometric mean of the gene expression across <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. To be noted, <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is built based on non-zero genes in the cell <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, therefore <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is specific for cell <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>.</p>
    <p>The fourth step involves comparing the pseudo profile of each cell to its specific reference to determine the size factor based on the non-DE assumption. scKWARN estimates the normalization factor using a median-ratio strategy, where <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">median</mml:mi><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula>. Rather than all cells sharing the same reference, each cell in scKWARN has its own reference for comparison. These references are calculated from cells with similar cell types. The reference profile for a given cell is calculated from all cells with non-zero genes detected in that cell, meaning that the reference abundances of cell-specific genes are most likely to be derived from cells belonging to the same cell type. Using scRNAseq data generated from five cell lines as an example, reference profiles of cells belonging to the same cell type are grouped together. In other words, cells from the same cell type tend to have similar reference abundances (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). This approach ensures that the non-DE assumption is not violated, even in cases where cell populations are extremely unbalanced.</p>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Performance of scKWARN on simulated data</title>
      <p>The performance of scKWARN was evaluated and compared against five normalization methods: RC, scran, SCnorm, sctransform, and PsiNorm, using three simulated settings. The data were generated following the simulation studies described in scran (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>), SCnorm (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>), and sctransform (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>). In the first two simulation settings, the gene count and sequencing depth followed a linear relationship on the log-scale but with different error distributions: normal (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>) (Simulation I) and negative binomial distributions (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>) (Simulation II), respectively. In the third simulation setting, counts were sampled from a negative binomial distribution without the assumption of count-depth relationship (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>) (Simulation III). All three simulation studies involved 3000 genes for three subpopulations. For each simulation setting, five scenarios were designed by altering library sizes, RNA compositions (the percentage of counts from the most highly expressed genes), capture efficiency (dropout rates, the proportion of zero counts), cell population compositions, and the DE level (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). 100 simulation datasets were generated for each scenario.</p>
      <p>We utilized five metrics to evaluate performance: Bias, Root Mean Square Error (RMSE), Sensitivity, Specificity, and F1 score. These measures assess the preservation of biological variability while mitigating technical noise. MAST was used to identify DE genes (<xref rid="btae008-B4" ref-type="bibr">Finak <italic toggle="yes">et al.</italic> 2015</xref>). In addition to measuring the difference between the true and the estimated log2-fold-change, as Bias does, RMSE also takes into account the variance of this difference. The F1 score provides a balance between precision and recall. As such, our primary focus was on RMSE and F1 score (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). The performance, as measured by Bias, Sensitivity, and Specificity, were illustrated in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S2–S4</xref>.</p>
      <p>scKWARN demonstrated robustness against technical noises introduced by library sizes, RNA composition, capture efficiency, and biological effects of unbalanced cell populations and strong DE level, which obtained the lowest RMSE (<xref rid="btae008-F2" ref-type="fig">Fig. 2</xref>) and the highest F1 scores (<xref rid="btae008-F3" ref-type="fig">Fig. 3</xref>) across all five scenarios in each setting. Furthermore, the performance of scKWARN is independent of model and distribution assumptions, consistently achieving the best results in terms of RMSE and F1 scores across all three settings. In comparison, RC, scran, SCnorm, sctransform, and PsiNorm worked well in specific scenarios and/or settings, but their performances compromised in others (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). RC, as anticipated, was intolerant to RNA composition and dropout biases, resulting in the highest RMSE and the lowest F1 score in these two specific scenarios across all three settings. Scran successfully corrected the effect of sequencing depth but showed limitations when addressing the effect of RNA composition and dropout rates (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). In the simulations II and III, scran exhibited high RMSE values when cell populations were unbalanced and even the highest when strong DE level were added. PsiNorm consistently achieved low RMSE values across all three settings when biases were introduced by RNA composition and dropout rates. However, it showed high RMSE values in the simulation I with the other three scenarios (library size, cell composition, and cell composition+strong DE) and low F1 scores in the simulations II and III. Both SCnorm and sctransform estimate gene-specific scaling factors, and their performances were highly dependent on whether the simulation settings fit their underlying models. SCnorm worked effectively under the linear model with a normal distribution (Simulation I), while sctransform showed good performance under the negative binomial distribution (Simulation II and III). Despite aiming to adjust only the technical bias from sequencing depth by modeling count-depth relationships, they exhibited tolerance against RNA composition and capture efficiency biases. In their appropriate settings, SCnorm and sctransform achieved lower RMSE and higher F1 values than RC and scran. Their success in removing these noises can be attributed to the usage of gene-specific scale factors, where highly and lowly expressed genes are modeled separately. It is noteworthy that scKWARN, a method estimating global scaling factors, outperformed SCnorm and sctransform even in these two scenarios (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). In summary, scKWARN demonstrated robustness against a variety of known technical factors without imposing restrictive assumptions on models or distributions.</p>
      <fig position="float" id="btae008-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Performance comparison in terms of RMSE in three simulation settings with five scenarios. In simulation I and II (the top and middle panels), the gene count and sequencing depth both followed a linear relationship on the log-scale but with different error distributions, normal and negative binomial distributions, respectively. In simulation III (the bottom panel), counts were sampled from a negative binomial distribution without the assumption of count-depth relationship. Five scenarios were designed by altering library sizes, RNA compositions, dropout rates, cell population compositions and the DE level.</p>
        </caption>
        <graphic xlink:href="btae008f2" position="float"/>
      </fig>
      <fig position="float" id="btae008-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Performance comparison on F1 score in three simulation settings with five scenarios. In simulation I and II (the top and middle panels), the gene count and sequencing depth both followed a linear relationship on the log-scale but with different error distributions, normal and negative binomial distributions, respectively. In simulation III (the bottom panel), counts were sampled from a negative binomial distribution without the assumption of count-depth relationship. Five scenarios were designed by altering library sizes, RNA compositions, dropout rates, cell population compositions and the DE level.</p>
        </caption>
        <graphic xlink:href="btae008f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 Performance of scKWARN on real data</title>
      <p>We assessed the performance of scKWARN on two real scRNAseq datasets in terms of preserving biological variability and marker detection (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). The first dataset, PBMC33K, generated by 10x Genomics, comprises 33 148 human peripheral blood mononuclear cells and 32 738 genes. Similar to the simulation, we randomly extracted 1000 B cells and generated two cell populations. For each cell population, a certain percentage of genes were randomly chosen, and each gene was upsized by different factors to introduce varying magnitude of DE. We simulated four scenarios involving two factors: moderate/strong DE and balanced/unbalanced cell populations. In the moderate setting, 10% of genes were chosen randomly to be DE, while in the strong DE scenario, this percentage increased to 25%. The balanced setting involved each cell population having 1000 cells, while the unbalanced setting included one population with 1000 cells and the other with only 100 cells. We compared different normalization strategies based on the F1 score and their ability to recover the true fold change (<xref rid="btae008-F4" ref-type="fig">Fig. 4</xref>). scKWARN achieved the best performance with the highest F1 scores and the lowest RMSE values in all four scenarios, accurately estimating fold changes that closely matched the true values (<xref rid="btae008-F4" ref-type="fig">Fig. 4</xref>). sctransform also exhibited good performance across all settings. Conversely, RC performed poorly, displaying the lowest F1 scores and highest RMSE values, along with a shift between the true and the estimated fold changes. SCnorm, scran, and PsiNorm functioned properly when only moderate DE was present; however, their performance compromised in the presence of strong DE. SCnorm and scran’s performance deteriorated further in scenarios where strong DE and unbalanced cell population coexisted (<xref rid="btae008-F4" ref-type="fig">Fig. 4b</xref>). In addition, SCnorm appeared to over-adjust genes with large magnitude of DE, resulting in an underestimation of fold changes in the balanced setting. We also introduced four scenarios where each gene was downsized by different factors to introduce varying magnitude of DE (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). In these scenarios, both scKWARN and SCnorm consistently outperformed other methods, attaining higher F1 scores and lower RMSE values (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>).</p>
      <fig position="float" id="btae008-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Performance comparison on the PBMC33K dataset with Moderate DE (a) and Strong DE (b) settings. The balanced setting has each cell population of 1000 cells (left panel), while the unbalanced includes one of 1000 and the other of only 100 cells (right panel).</p>
        </caption>
        <graphic xlink:href="btae008f4" position="float"/>
      </fig>
      <p>The second dataset was downloaded from the Gene Expression Omnibus (GEO) database with Accession No. GSE29087, comprising 92 cells (48 mouse embryonic cells and 44 mouse embryonic fibroblasts) and 22 928 genes. After filtering out genes expressed in fewer than 3 cells in either of the two groups, 7896 genes were retained for the differential analysis. Among these 7896 genes, 718, which had been validated through qRT-PCR experiments, were considered as the gold standard DE genes (<xref rid="btae008-B12" ref-type="bibr">Moliner <italic toggle="yes">et al.</italic> 2008</xref>). Since the gold standard genes represent only a subset of true DE genes, as mentioned by (<xref rid="btae008-B17" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> 2019</xref>), we estimated the proportion of the gold standard genes among the top N genes ranked by each method. The performance was compared in three settings: none of the cells downsized, half of the cells downsized, or all cells downsized by random variables from Uniform(0.2, 1). In the original dataset (no downsizing of cells) or when half of the cells were randomly chosen for downsizing, sctransform achieved the highest accuracy in the detection of DE genes, followed by PsiNorm and scKWARN (<xref rid="btae008-F5" ref-type="fig">Fig. 5a and b</xref>). Surprisingly, scran exhibited the lowest proportion, likely attributed to the limited number of cells, which may not be adequate for pooling together to achieve an accurate normalization factor estimation. When all cells were downsized, scKWARN and PsiNorm maintained their performance, while the proportion estimated by sctransform significantly dropped, resulting in the superior performance of scKWARN and PsiNorm over sctransform (<xref rid="btae008-F5" ref-type="fig">Fig. 5c</xref>). This result suggests that scKWARN and PsiNorm demonstrate robustness even in scenarios with a high dropout rate and a small number of cells.</p>
      <fig position="float" id="btae008-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Performance comparison on the GSE29087 dataset. Y axis denotes the proportion of 718 gold standard genes in the top N genes (x axis). The performance was compared in three settings, where none of cells (a), half of the cells (b), or all cells (c) were downsized.</p>
        </caption>
        <graphic xlink:href="btae008f5" position="float"/>
      </fig>
      <p>Furthermore, we assessed the clustering performance of scKWARN using the third dataset, GSE118767, which includes ground truth cell type labels. This dataset, generated by various sequencing platforms, comprises seven datasets from five lung adenocarcinoma cell lines: H1975, H2228, HCC827, H838, and A549. Clustering quality was evaluated using Average Silhouette Width (ASW) and Adjusted Rand Index (ARI) (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). A higher score in these metrics suggests better clustering performance. Additionally, we employed the 1-correlation, where the correlation represents the maximum correlation between PC1 and PC2 of gene expressions and cell sequencing depths (<xref rid="btae008-B2" ref-type="bibr">Borella <italic toggle="yes">et al.</italic> 2021</xref>). A higher score in this context indicates lower correlation and better performance, signifying that normalization successfully eliminates biases introduced by sequencing depths. The average values of ASW, ARI and 1-correlation across the seven datasets were listed in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>. Overall, all normalization methods enhanced clustering performance, yielding higher ASW and ARI values compared to unnormalized data. Among normalization methods, SCnorm exhibited the lowest ASW and ARI values and the second lowest 1-correlation score. This result suggests that normalization methods generally perform well in high-quality data. Subsequently, we simulated five scenarios ranging from well-balanced (1:1:1:1:1) to extremely imbalanced cell compositions (36:1:1:1:1) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>). In balanced settings, sctransform achieved the highest ASW values, while scKWARN and PsiNorm demonstrated higher ASW values as the cell composition became more imbalanced (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>, UMAP and PCA plots in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S7</xref> and <xref rid="sup1" ref-type="supplementary-material">S8</xref>). This trend became more pronounced when the imbalanced cell composition was driven by an increasing number of H838 cells and a decrease in other cell lines (<xref rid="btae008-F6" ref-type="fig">Fig. 6b</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>). All methods yielded higher ARI values than unnormalized data, indicating improved clustering performance (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>). scKWARN consistently achieved the highest 1-correlation scores in all scenarios (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>). SCnorm was not included in these scenarios due to lengthy computational time.</p>
      <fig position="float" id="btae008-F6">
        <label>Figure 6.</label>
        <caption>
          <p>Performance comparison of unnormalized and five normalization methods on the GSE118767 datasets with five scenarios (1–5) where the cell composition changes from balanced (scenario 1) to extremely imbalanced (scenario 5). (a) The imbalanced cell composition was driven by the increasing number of A549 but decreasing of other cell lines. (b) The imbalanced cell composition was driven by the increasing number of H838 but decreasing of other cell lines.</p>
        </caption>
        <graphic xlink:href="btae008f6" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.3 Computational performance</title>
      <p>We compared the computational performance of the six normalization methods using both real and simulated datasets with varying number of genes and cells (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>). As expected, RC and PsiNorm were the fastest due to simple algorithms. scran and scKWARN required more time than RC and PsiNorm. Sctransform and SCnorm, which depend on model fitting, had the longest computational time. SCnorm even failed on some large datasets.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>Accurate normalization is essential for the success of scRNAseq data analysis. An effective normalization method should preserve intrinsic biological features while correcting unwanted biases and be robust against known or hidden technical noises. Here, we introduce scKWARN, a method that does not assume specific data distributions or count-depth relationships. scKWARN has demonstrated improved performance over existing methods in both simulation and real studies. The absence of assumptions about count-depth relationships or read count distributions allows scKWARN to work effectively across diverse settings.</p>
    <p>The key strength of scKWARN lies in its way to construct pseudo-profiles for each cell by leveraging information from its fuzzy technical neighbors. These technical neighbors are approximately defined based on the quantile distribution of non-zero profiles. This approach empowers scKWARN to effectively eliminate noise introduced by hidden or unknown factors that impact non-zero counts distributions. Furthermore, each cell has its own reference profile for comparison, ensuring the robustness of the non-DE assumption even in scenarios with unbalanced cell population sizes, a situation frequently overlooked by existing methods.</p>
    <p>scKWARN utilizes the 25th, 50th, and 75th percentiles of non-zero profiles to define technical neighbors. These three percentiles are commonly employed to represent the location and scale of data, and they are robust against extreme values. This choice allows scKWARN to capture the main features of the data and counteract the effects of differentially expressed genes and highly expressed genes. While other percentiles between the 25th and 75th are feasible and yield similar results in downstream analysis (not shown), lower or higher percentiles, such as the 10th or 90th percentiles, are not recommended due to large variability in the tails of the expression profile. The use of lower/higher percentiles can result in high RMSE values and sensitive outcomes in differential expression analysis.</p>
    <p>scKWARN only employs the first principal component (PC) of the three-dimensional percentile data to identify technical neighbors. This decision was made due to the observation that incorporating additional PCs significantly escalated computational demands without corresponding performance improvements. For instance, employing two PCs (PC1+PC2) led to a 38% increase in computational time compared to using PC1 alone. Nevertheless, scKWARN utilizing PC1+PC2 yielded nearly identical RMSE and F1 scores as the one employing the PC1 alone across the three simulation settings with five different scenarios (<xref rid="sup1" ref-type="supplementary-material">Supplementary Tables S2</xref> and <xref rid="sup1" ref-type="supplementary-material">S3</xref>). The lack of improvement in performance may be attributed to the fact that PC1 already encompasses a substantial amount of variance in the three-dimensional percentile data. For example, PC1 included at least 70% of the variance in the percentile data in those simulations. Moreover, employing additional PCs might even compromise the performance. If more PCs were utilized, there is a greater likelihood of encompassing biological rather than technical variances, introducing potential biases in the determination of technical neighbors.</p>
    <p>scKWARN applies a both cell- and gene-specific weighting approach, which can be further improved for better computational performance by incorporating a cutoff option. This option sets low weights to zero when cell distances exceed the bandwidth by a specified cutoff factor (default cutoff = 2). The inclusion of the cutoff option has resulted in approximately 20% savings in computational time while maintaining consistent performance (<xref rid="sup1" ref-type="supplementary-material">Supplementary Tables S4</xref> and <xref rid="sup1" ref-type="supplementary-material">S5</xref>).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae008_Supplementary_Data</label>
      <media xlink:href="btae008_supplementary_data.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors would like to thank all reviewers for their insightful comments and valuable suggestions.</p>
  </ack>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the National Institutes of Health [P30 CA068485, U24 CA163056, P50 CA236733, P50 CA098131, U54 CA163072, U2C CA233291, P01 CA229123, P01 AI139449, and U54 CA274367].</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data underlying this article are available at <ext-link xlink:href="https://github.com/cyhsuTN/scKWARN" ext-link-type="uri">https://github.com/cyhsuTN/scKWARN</ext-link>.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae008-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bacher</surname><given-names>R</given-names></string-name>, <string-name><surname>Chu</surname><given-names>L-F</given-names></string-name>, <string-name><surname>Leng</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>SCnorm: robust normalization of single-cell RNA-seq data</article-title>. <source>Nat Methods</source><year>2017</year>;<volume>14</volume>:<fpage>584</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">28418000</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Borella</surname><given-names>M</given-names></string-name>, <string-name><surname>Martello</surname><given-names>G</given-names></string-name>, <string-name><surname>Risso</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>PsiNorm: a scalable normalization for single-cell RNA-seq data</article-title>. <source>Bioinformatics</source><year>2021</year>;<volume>38</volume>:<fpage>164</fpage>–<lpage>72</lpage>.<pub-id pub-id-type="pmid">34499096</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ding</surname><given-names>B</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>Y</given-names></string-name></person-group><etal>et al</etal><article-title>Normalization and noise reduction for single cell RNA-seq experiments</article-title>. <source>Bioinformatics</source><year>2015</year>;<volume>31</volume>:<fpage>2225</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">25717193</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Finak</surname><given-names>G</given-names></string-name>, <string-name><surname>McDavid</surname><given-names>A</given-names></string-name>, <string-name><surname>Yajima</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><year>2015</year>;<volume>16</volume>:<fpage>278</fpage>.<pub-id pub-id-type="pmid">26653891</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hafemeister</surname><given-names>C</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R.</given-names></string-name></person-group><article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>296</fpage>.<pub-id pub-id-type="pmid">31870423</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Han</surname><given-names>X</given-names></string-name>, <string-name><surname>Wang</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Y</given-names></string-name></person-group><etal>et al</etal><article-title>Mapping the mouse cell atlas by Microwell-Seq</article-title>. <source>Cell</source><year>2018</year>;<volume>173</volume>:<fpage>1307</fpage>.<pub-id pub-id-type="pmid">29775597</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Katayama</surname><given-names>S</given-names></string-name>, <string-name><surname>Töhönen</surname><given-names>V</given-names></string-name>, <string-name><surname>Linnarsson</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>SAMstrt: statistical test for differential expression in single-cell transcriptome with spike-in normalization</article-title>. <source>Bioinformatics</source><year>2013</year>;<volume>29</volume>:<fpage>2943</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">23995393</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>H-O</given-names></string-name>, <string-name><surname>Hong</surname><given-names>Y</given-names></string-name>, <string-name><surname>Etlioglu</surname><given-names>HE</given-names></string-name></person-group><etal>et al</etal><article-title>Lineage-dependent gene expression programs influence the immune landscape of colorectal cancer</article-title>. <source>Nat Genet</source><year>2020</year>;<volume>52</volume>:<fpage>594</fpage>–<lpage>603</lpage>.<pub-id pub-id-type="pmid">32451460</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Love</surname><given-names>MI</given-names></string-name>, <string-name><surname>Huber</surname><given-names>W</given-names></string-name>, <string-name><surname>Anders</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title>. <source>Genome Biol</source><year>2014</year>;<volume>15</volume>:<fpage>550</fpage>.<pub-id pub-id-type="pmid">25516281</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lun</surname><given-names>AT</given-names></string-name></person-group><string-name><surname>Bach</surname><given-names>K</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>. <article-title>Pooling across cells to normalize single-cell RNA sequencing data with many zero counts</article-title>. <source>Genome Biol</source><year>2016</year>;<volume>17</volume>:<fpage>75</fpage>.<pub-id pub-id-type="pmid">27122128</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maza</surname><given-names>E</given-names></string-name>, <string-name><surname>Frasse</surname><given-names>P</given-names></string-name>, <string-name><surname>Senin</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Comparison of normalization methods for differential gene expression analysis in RNA-Seq experiments: a matter of relative size of studied transcriptomes</article-title>. <source>Commun Integr Biol</source><year>2013</year>;<volume>6</volume>:<fpage>e25849</fpage>.<pub-id pub-id-type="pmid">26442135</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moliner</surname><given-names>A</given-names></string-name>, <string-name><surname>Enfors</surname><given-names>P</given-names></string-name>, <string-name><surname>Ibáñez</surname><given-names>CF</given-names></string-name></person-group><etal>et al</etal><article-title>Mouse embryonic stem cell-derived spheres with distinct neurogenic potentials</article-title>. <source>Stem Cells Dev</source><year>2008</year>;<volume>17</volume>:<fpage>233</fpage>–<lpage>43</lpage>.<pub-id pub-id-type="pmid">18447639</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Robinson</surname><given-names>MD</given-names></string-name>, <string-name><surname>Oshlack</surname><given-names>A.</given-names></string-name></person-group><article-title>A scaling normalization method for differential expression analysis of RNA-seq data</article-title>. <source>Genome Biol</source><year>2010</year>;<volume>11</volume>:<fpage>R25</fpage>.<pub-id pub-id-type="pmid">20196867</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shami</surname><given-names>AN</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>X</given-names></string-name>, <string-name><surname>Munyoki</surname><given-names>SK</given-names></string-name></person-group><etal>et al</etal><article-title>Single-Cell RNA sequencing of human, macaque, and mouse testes uncovers conserved and divergent features of mammalian spermatogenesis</article-title>. <source>Dev Cell</source><year>2020</year>;<volume>54</volume>:<fpage>529</fpage>–<lpage>47.e12</lpage>.<pub-id pub-id-type="pmid">32504559</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sheather</surname><given-names>SJ</given-names></string-name>, <string-name><surname>Jones</surname><given-names>MC.</given-names></string-name></person-group><article-title>A reliable data-based bandwidth selection method for kernel density estimation</article-title>. <source>J R Stat Soc Ser B</source><year>1991</year>;<volume>53</volume>:<fpage>683</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="btae008-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vallejos</surname><given-names>CA</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>, <string-name><surname>Richardson</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>BASiCS: Bayesian analysis of Single-Cell sequencing data</article-title>. <source>PLoS Comput Biol</source><year>2015</year>;<volume>11</volume>:<fpage>e1004333</fpage>.<pub-id pub-id-type="pmid">26107944</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>T</given-names></string-name>, <string-name><surname>Li</surname><given-names>B</given-names></string-name>, <string-name><surname>Nelson</surname><given-names>CE</given-names></string-name></person-group><etal>et al</etal><article-title>Comparative analysis of differential gene expression analysis tools for single-cell RNA sequencing data</article-title>. <source>BMC Bioinformatics</source><year>2019</year>;<volume>20</volume>:<fpage>40</fpage>.<pub-id pub-id-type="pmid">30658573</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10868328</article-id>
    <article-id pub-id-type="pmid">38237908</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btae008</article-id>
    <article-id pub-id-type="publisher-id">btae008</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scKWARN: Kernel-weighted-average robust normalization for single-cell RNA-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8325-2112</contrib-id>
        <name>
          <surname>Hsu</surname>
          <given-names>Chih-Yuan</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-0977-8743</contrib-id>
        <name>
          <surname>Chang</surname>
          <given-names>Chia-Jung</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Department of Biomedical Engineering, National Cheng Kung University</institution>, Tainan 701, <country country="TW">Taiwan</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-8892-7078</contrib-id>
        <name>
          <surname>Liu</surname>
          <given-names>Qi</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <xref rid="btae008-cor1" ref-type="corresp"/>
        <!--qi.liu@vumc.org-->
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Shyr</surname>
          <given-names>Yu</given-names>
        </name>
        <aff><institution>Department of Biostatistics, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <aff><institution>Center for Quantitative Sciences, Vanderbilt University Medical Center</institution>, Nashville, TN 37203, <country country="US">United States</country></aff>
        <xref rid="btae008-cor1" ref-type="corresp"/>
        <!--yu.shyr@vumc.org-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Boeva</surname>
          <given-names>Valentina</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btae008-cor1">Corresponding author. Department of Biostatistics, Vanderbilt University Medical Center, Nashville, TN 37203, United States. E-mail: <email>qi.liu@vumc.org</email> (Q.L.); E-mail: <email>yu.shyr@vumc.org</email> (Y.S.)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>2</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2024-01-17">
      <day>17</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>17</day>
      <month>1</month>
      <year>2024</year>
    </pub-date>
    <volume>40</volume>
    <issue>2</issue>
    <elocation-id>btae008</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>7</month>
        <year>2023</year>
      </date>
      <date date-type="rev-recd">
        <day>05</day>
        <month>12</month>
        <year>2023</year>
      </date>
      <date date-type="editorial-decision">
        <day>02</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>1</month>
        <year>2024</year>
      </date>
      <date date-type="corrected-typeset">
        <day>07</day>
        <month>2</month>
        <year>2024</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2024. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2024</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btae008.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Single-cell RNA-seq normalization is an essential step to correct unwanted biases caused by sequencing depth, capture efficiency, dropout, and other technical factors. Existing normalization methods primarily reduce biases arising from sequencing depth by modeling count-depth relationship and/or assuming a specific distribution for read counts. However, these methods may lead to over or under-correction due to presence of technical biases beyond sequencing depth and the restrictive assumption on models and distributions.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We present scKWARN, a <underline>K</underline>ernel <underline>W</underline>eighted <underline>A</underline>verage <underline>R</underline>obust <underline>N</underline>ormalization designed to correct known or hidden technical confounders without assuming specific data distributions or count-depth relationships. scKWARN generates a pseudo expression profile for each cell by borrowing information from its fuzzy technical neighbors through a kernel smoother. It then compares this profile against the reference derived from cells with the same bimodality patterns to determine the normalization factor. As demonstrated in both simulated and real datasets, scKWARN outperforms existing methods in removing a variety of technical biases while preserving true biological heterogeneity.</p>
      </sec>
      <sec id="s3">
        <title>Availability and Implementation</title>
        <p>scKWARN is freely available at <ext-link xlink:href="https://github.com/cyhsuTN/scKWARN" ext-link-type="uri">https://github.com/cyhsuTN/scKWARN</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Institutes of Health</institution>
            <institution-id institution-id-type="DOI">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>P30 CA068485</award-id>
        <award-id>U24 CA163056</award-id>
        <award-id>P50 CA236733</award-id>
        <award-id>P50 CA098131</award-id>
        <award-id>U54 CA163072</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Providing transcriptomes at the resolution of individual cells, single-cell RNA sequencing (scRNAseq) has become a powerful tool for identifying and characterizing cellular heterogeneity and transition states (<xref rid="btae008-B6" ref-type="bibr">Han <italic toggle="yes">et al.</italic> 2018</xref>, <xref rid="btae008-B8" ref-type="bibr">Lee <italic toggle="yes">et al.</italic> 2020</xref>, <xref rid="btae008-B14" ref-type="bibr">Shami <italic toggle="yes">et al.</italic> 2020</xref>). However, scRNAseq data have high level of technical noise and sparsity due to complicated and multi-step experimental protocols and tiny amount of starting material per cell, which make the analysis very challenging. Normalization is the first essential step that adjusts the effect of technical biases to make expression comparable across genes and/or cells. Accurate normalization is critical for valid and biologically meaningful downstream analysis.</p>
    <p>There are a number of normalization methods available for bulk RNA-seq data. They generally calculate global scaling factors based on the non-DE assumption, that is, most of genes are not differentially expressed (DE) across experiments. The most commonly used approaches, such as Trimmed Mean of M-values (TMM) in edgeR (<xref rid="btae008-B13" ref-type="bibr">Robinson and Oshlack 2010</xref>), Relative Log Expression (RLE) in DESeq2 (<xref rid="btae008-B9" ref-type="bibr">Love <italic toggle="yes">et al.</italic> 2014</xref>), and Median Ratio Normalization (MRN) (<xref rid="btae008-B11" ref-type="bibr">Maza <italic toggle="yes">et al.</italic> 2013</xref>), achieve great performance. However, they are not applicable in the scRNAseq setting due to its characteristics of excessive number of zeros. The extreme sparsity would result in a geometric mean of zero for RLE and undefined M values for TMM. The unbalanced sizes between rare and abundant cell populations in scRNAseq would partially violate the non-DE assumption and introduce spurious biases.</p>
    <p>Recently, several methods tailored for scRNAseq normalization have emerged. They generally fall into two categories, global and gene-specific scaling factors. Global scaling factors correct cell-specific systematic biases, meaning that genes are normalized by the same constant in each cell. The most straightforward and widely-used approach is RC (relative counts), which divides raw counts by the total number of counts in each cell, then multiplies a constant factor (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019)</xref>. If RNA composition is different across cells, the usage of spike in RNAs instead of library sizes might be better to estimate scale factors, such as BASiCS (<xref rid="btae008-B16" ref-type="bibr">Vallejos <italic toggle="yes">et al.</italic> 2015</xref>), SAMstrt (<xref rid="btae008-B7" ref-type="bibr">Katayama <italic toggle="yes">et al.</italic> 2013</xref>) and Gamma Regression Model (GRM) (<xref rid="btae008-B3" ref-type="bibr">Ding <italic toggle="yes">et al.</italic> 2015</xref>). To reduce the effect of problematic zeros, scran (Lun <italic toggle="yes">et al.</italic> 2016) sums expression across pools of cells by library sizes, normalizes the cell pool against an average reference, and deconvolves the pool-based size factors to yield cell-based factors by a linear system. Assuming single-cell RNAseq data follow the Pareto distribution, PsiNorm (Borella <italic toggle="yes">et al.</italic> 2021) derives a global normalization factor from the Pareto distribution shape parameter that is inversely proportion to the sequencing depth. Unlike global scaling factors, which assume uniform technical biases across all genes in each cell, gene-specific scaling methods acknowledge diverse relationships between expression and technical factors across genes (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>, <xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>). For example, SCnorm (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>) groups genes by their similarity on count-depth relationships and applies linear quantile regression to determine scale factors within each group. sctransform (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>) utilizes a linear negative binomial regression model to estimate the count-depth relationship for each gene. It predicts expected counts using stable coefficient estimates from a kernel smoother and considers the residuals from the model as normalized expression levels. While these pioneering approaches successfully address noise arising from sequencing depth, their performance relies on the assumption of a faithful linear count-depth relationship and a specific distribution of read counts. The count-depth relationships for specific marker genes, which are highly expressed in one cell type and not expressed in others, can vary significantly across cell populations. Assuming uniform count-depth relationships across cells may introduce artifacts during normalization. Moreover, while sequencing depth is a major source of technical noise, other factors such as amplification bias, capture efficiency, and dropout rates, all contribute to unwanted expression variations, which need to be adjusted as well.</p>
    <p>In this article, we introduce scKWARN, a novel scRNAseq normalization approach without assumption on data distributions or count-depth relationships. scKWARN first generates a pseudo-expression profile for each cell by leveraging information from its fuzzy technical neighbors. It then compares the pseudo profile against a reference derived from cells with the similar bimodality patterns to estimate the normalization factor based on the non-DE assumption. By defining technical neighbors through the similarity of non-zero counts distribution, scKWARN inherently consider any technical factors contributing to unwanted expression variation. Cells with similar bimodality patterns are highly likely to be from the same cell population, ensuring the non-DE assumption remains valid even in the presence of extremely unbalanced cell populations. Simulated and real case studies demonstrated that scKWARN is robust against a variety of technical and biological factors, with its performance independent of data distributions and count-depth relationships.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <p>scKWARN, single-cell Kernel-Weighted-Average Robust Normalization, consists of four steps (<xref rid="btae008-F1" ref-type="fig">Fig. 1</xref> &amp; Pseudocode in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>).</p>
    <fig position="float" id="btae008-F1">
      <label>Figure 1.</label>
      <caption>
        <p>Overview of scKWARN. Cell distances are calculated based on the first principal component of the 25th, 50th, and 75th percentiles of non-zero profiles. The non-zero pseudo profile of each cell is generated by summing weighted expression of its neighbors via a kernel smoother. The normalization factor of each cell is determined by the median ratio of its pseudo profile against its non-zero reference profile.</p>
      </caption>
      <graphic xlink:href="btae008f1" position="float"/>
    </fig>
    <p>The first step is to define technical neighbors, ie, cells that share similar technical factors such as library sizes or dropout rates. This concept is motivated by scran (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>), which pools cells with similar library sizes. Technical similarity is roughly calculated based on the first principal component of the 25th, 50th, and 75th percentiles of non-zero expression in cells. Suppose that scRNAseq data involve <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mi>G</mml:mi></mml:math></inline-formula> genes and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi>n</mml:mi></mml:math></inline-formula> cells. <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the read count of gene <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula> in the cell <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>G</mml:mi></mml:math></inline-formula> and <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:math></inline-formula>. <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>g</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="normal"> </mml:mi><mml:mo>&gt;</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>G</mml:mi><mml:mo>}</mml:mo></mml:math></inline-formula> is the subset of genes with non-zero counts in cell <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>. <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.25</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.50</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>0.75</mml:mn><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula> of <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mo>{</mml:mo><mml:mi mathvariant="normal">log</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula> is the three-dimensional vector comprising 25th, 50th, and 75th percentiles of log-transformed non-zero counts in cell <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>. r <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mo>=</mml:mo><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced><mml:mo>=</mml:mo></mml:math></inline-formula> PC1(<inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:math></inline-formula>), is the first principal component of <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mi>Q</mml:mi></mml:math></inline-formula>. The technical similarity between cells <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula> and <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mi>j</mml:mi><mml:mi>′</mml:mi></mml:math></inline-formula> is estimated by the distance <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
    <p>The second step is to generate a pseudo gene expression profile for each cell by leveraging information from its technical neighbors using a kernel smoother. In scKWARN, “fuzzy” technical neighbors are defined, indicating no hard boundary to group cells. Instead, scKWARN generates the pseudo profile for non-zero genes in each cell by summing weighted expression of its technical neighbors via a kernel smoother. This approach reduces technical variability among cells, providing a robust estimation. The weight <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> used to calculate the pseudo-profile is both cell- and gene-specific, where <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi>′</mml:mi></mml:msup></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mi mathvariant="normal">′</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>K</mml:mi><mml:mo>{</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula>, <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mi>K</mml:mi><mml:mo>(</mml:mo><mml:mo>·</mml:mo><mml:mo>)</mml:mo></mml:math></inline-formula> is the Gaussian kernel, and <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the SJ bandwidth (<xref rid="btae008-B15" ref-type="bibr">Sheather and Jones 1991</xref>) data-driven by <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>. <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mi>j</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is the subset of cells with non-zero expression of gene <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula>. The pseudo expression profile for cell <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>, is generated from the kernel-weighted geometric means of non-zero genes of cell <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, where <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mrow><mml:msup><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>.</p>
    <p>The third step is to build a reference profile for each cell. The reference profile for cell <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, denoted as <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>g</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula>, where <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mfenced open="{" close="}" separators="|"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">log</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mfenced></mml:math></inline-formula>, is defined as the geometric mean of <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> across <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. In other words, for each non-zero gene <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mi>g</mml:mi></mml:math></inline-formula> in cell <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, the process entails finding the subset of cells expression this gene (<inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>) and calculating the geometric mean of the gene expression across <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. To be noted, <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is built based on non-zero genes in the cell <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>, therefore <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is specific for cell <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>.</p>
    <p>The fourth step involves comparing the pseudo profile of each cell to its specific reference to determine the size factor based on the non-DE assumption. scKWARN estimates the normalization factor using a median-ratio strategy, where <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="normal">median</mml:mi><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:math></inline-formula>. Rather than all cells sharing the same reference, each cell in scKWARN has its own reference for comparison. These references are calculated from cells with similar cell types. The reference profile for a given cell is calculated from all cells with non-zero genes detected in that cell, meaning that the reference abundances of cell-specific genes are most likely to be derived from cells belonging to the same cell type. Using scRNAseq data generated from five cell lines as an example, reference profiles of cells belonging to the same cell type are grouped together. In other words, cells from the same cell type tend to have similar reference abundances (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). This approach ensures that the non-DE assumption is not violated, even in cases where cell populations are extremely unbalanced.</p>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Performance of scKWARN on simulated data</title>
      <p>The performance of scKWARN was evaluated and compared against five normalization methods: RC, scran, SCnorm, sctransform, and PsiNorm, using three simulated settings. The data were generated following the simulation studies described in scran (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>), SCnorm (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>), and sctransform (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>). In the first two simulation settings, the gene count and sequencing depth followed a linear relationship on the log-scale but with different error distributions: normal (<xref rid="btae008-B1" ref-type="bibr">Bacher <italic toggle="yes">et al.</italic> 2017</xref>) (Simulation I) and negative binomial distributions (<xref rid="btae008-B5" ref-type="bibr">Hafemeister and Satija 2019</xref>) (Simulation II), respectively. In the third simulation setting, counts were sampled from a negative binomial distribution without the assumption of count-depth relationship (<xref rid="btae008-B10" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> 2016</xref>) (Simulation III). All three simulation studies involved 3000 genes for three subpopulations. For each simulation setting, five scenarios were designed by altering library sizes, RNA compositions (the percentage of counts from the most highly expressed genes), capture efficiency (dropout rates, the proportion of zero counts), cell population compositions, and the DE level (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). 100 simulation datasets were generated for each scenario.</p>
      <p>We utilized five metrics to evaluate performance: Bias, Root Mean Square Error (RMSE), Sensitivity, Specificity, and F1 score. These measures assess the preservation of biological variability while mitigating technical noise. MAST was used to identify DE genes (<xref rid="btae008-B4" ref-type="bibr">Finak <italic toggle="yes">et al.</italic> 2015</xref>). In addition to measuring the difference between the true and the estimated log2-fold-change, as Bias does, RMSE also takes into account the variance of this difference. The F1 score provides a balance between precision and recall. As such, our primary focus was on RMSE and F1 score (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). The performance, as measured by Bias, Sensitivity, and Specificity, were illustrated in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S2–S4</xref>.</p>
      <p>scKWARN demonstrated robustness against technical noises introduced by library sizes, RNA composition, capture efficiency, and biological effects of unbalanced cell populations and strong DE level, which obtained the lowest RMSE (<xref rid="btae008-F2" ref-type="fig">Fig. 2</xref>) and the highest F1 scores (<xref rid="btae008-F3" ref-type="fig">Fig. 3</xref>) across all five scenarios in each setting. Furthermore, the performance of scKWARN is independent of model and distribution assumptions, consistently achieving the best results in terms of RMSE and F1 scores across all three settings. In comparison, RC, scran, SCnorm, sctransform, and PsiNorm worked well in specific scenarios and/or settings, but their performances compromised in others (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). RC, as anticipated, was intolerant to RNA composition and dropout biases, resulting in the highest RMSE and the lowest F1 score in these two specific scenarios across all three settings. Scran successfully corrected the effect of sequencing depth but showed limitations when addressing the effect of RNA composition and dropout rates (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). In the simulations II and III, scran exhibited high RMSE values when cell populations were unbalanced and even the highest when strong DE level were added. PsiNorm consistently achieved low RMSE values across all three settings when biases were introduced by RNA composition and dropout rates. However, it showed high RMSE values in the simulation I with the other three scenarios (library size, cell composition, and cell composition+strong DE) and low F1 scores in the simulations II and III. Both SCnorm and sctransform estimate gene-specific scaling factors, and their performances were highly dependent on whether the simulation settings fit their underlying models. SCnorm worked effectively under the linear model with a normal distribution (Simulation I), while sctransform showed good performance under the negative binomial distribution (Simulation II and III). Despite aiming to adjust only the technical bias from sequencing depth by modeling count-depth relationships, they exhibited tolerance against RNA composition and capture efficiency biases. In their appropriate settings, SCnorm and sctransform achieved lower RMSE and higher F1 values than RC and scran. Their success in removing these noises can be attributed to the usage of gene-specific scale factors, where highly and lowly expressed genes are modeled separately. It is noteworthy that scKWARN, a method estimating global scaling factors, outperformed SCnorm and sctransform even in these two scenarios (<xref rid="btae008-F2" ref-type="fig">Figs 2</xref> and <xref rid="btae008-F3" ref-type="fig">3</xref>). In summary, scKWARN demonstrated robustness against a variety of known technical factors without imposing restrictive assumptions on models or distributions.</p>
      <fig position="float" id="btae008-F2">
        <label>Figure 2.</label>
        <caption>
          <p>Performance comparison in terms of RMSE in three simulation settings with five scenarios. In simulation I and II (the top and middle panels), the gene count and sequencing depth both followed a linear relationship on the log-scale but with different error distributions, normal and negative binomial distributions, respectively. In simulation III (the bottom panel), counts were sampled from a negative binomial distribution without the assumption of count-depth relationship. Five scenarios were designed by altering library sizes, RNA compositions, dropout rates, cell population compositions and the DE level.</p>
        </caption>
        <graphic xlink:href="btae008f2" position="float"/>
      </fig>
      <fig position="float" id="btae008-F3">
        <label>Figure 3.</label>
        <caption>
          <p>Performance comparison on F1 score in three simulation settings with five scenarios. In simulation I and II (the top and middle panels), the gene count and sequencing depth both followed a linear relationship on the log-scale but with different error distributions, normal and negative binomial distributions, respectively. In simulation III (the bottom panel), counts were sampled from a negative binomial distribution without the assumption of count-depth relationship. Five scenarios were designed by altering library sizes, RNA compositions, dropout rates, cell population compositions and the DE level.</p>
        </caption>
        <graphic xlink:href="btae008f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.2 Performance of scKWARN on real data</title>
      <p>We assessed the performance of scKWARN on two real scRNAseq datasets in terms of preserving biological variability and marker detection (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). The first dataset, PBMC33K, generated by 10x Genomics, comprises 33 148 human peripheral blood mononuclear cells and 32 738 genes. Similar to the simulation, we randomly extracted 1000 B cells and generated two cell populations. For each cell population, a certain percentage of genes were randomly chosen, and each gene was upsized by different factors to introduce varying magnitude of DE. We simulated four scenarios involving two factors: moderate/strong DE and balanced/unbalanced cell populations. In the moderate setting, 10% of genes were chosen randomly to be DE, while in the strong DE scenario, this percentage increased to 25%. The balanced setting involved each cell population having 1000 cells, while the unbalanced setting included one population with 1000 cells and the other with only 100 cells. We compared different normalization strategies based on the F1 score and their ability to recover the true fold change (<xref rid="btae008-F4" ref-type="fig">Fig. 4</xref>). scKWARN achieved the best performance with the highest F1 scores and the lowest RMSE values in all four scenarios, accurately estimating fold changes that closely matched the true values (<xref rid="btae008-F4" ref-type="fig">Fig. 4</xref>). sctransform also exhibited good performance across all settings. Conversely, RC performed poorly, displaying the lowest F1 scores and highest RMSE values, along with a shift between the true and the estimated fold changes. SCnorm, scran, and PsiNorm functioned properly when only moderate DE was present; however, their performance compromised in the presence of strong DE. SCnorm and scran’s performance deteriorated further in scenarios where strong DE and unbalanced cell population coexisted (<xref rid="btae008-F4" ref-type="fig">Fig. 4b</xref>). In addition, SCnorm appeared to over-adjust genes with large magnitude of DE, resulting in an underestimation of fold changes in the balanced setting. We also introduced four scenarios where each gene was downsized by different factors to introduce varying magnitude of DE (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). In these scenarios, both scKWARN and SCnorm consistently outperformed other methods, attaining higher F1 scores and lower RMSE values (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>).</p>
      <fig position="float" id="btae008-F4">
        <label>Figure 4.</label>
        <caption>
          <p>Performance comparison on the PBMC33K dataset with Moderate DE (a) and Strong DE (b) settings. The balanced setting has each cell population of 1000 cells (left panel), while the unbalanced includes one of 1000 and the other of only 100 cells (right panel).</p>
        </caption>
        <graphic xlink:href="btae008f4" position="float"/>
      </fig>
      <p>The second dataset was downloaded from the Gene Expression Omnibus (GEO) database with Accession No. GSE29087, comprising 92 cells (48 mouse embryonic cells and 44 mouse embryonic fibroblasts) and 22 928 genes. After filtering out genes expressed in fewer than 3 cells in either of the two groups, 7896 genes were retained for the differential analysis. Among these 7896 genes, 718, which had been validated through qRT-PCR experiments, were considered as the gold standard DE genes (<xref rid="btae008-B12" ref-type="bibr">Moliner <italic toggle="yes">et al.</italic> 2008</xref>). Since the gold standard genes represent only a subset of true DE genes, as mentioned by (<xref rid="btae008-B17" ref-type="bibr">Wang <italic toggle="yes">et al.</italic> 2019</xref>), we estimated the proportion of the gold standard genes among the top N genes ranked by each method. The performance was compared in three settings: none of the cells downsized, half of the cells downsized, or all cells downsized by random variables from Uniform(0.2, 1). In the original dataset (no downsizing of cells) or when half of the cells were randomly chosen for downsizing, sctransform achieved the highest accuracy in the detection of DE genes, followed by PsiNorm and scKWARN (<xref rid="btae008-F5" ref-type="fig">Fig. 5a and b</xref>). Surprisingly, scran exhibited the lowest proportion, likely attributed to the limited number of cells, which may not be adequate for pooling together to achieve an accurate normalization factor estimation. When all cells were downsized, scKWARN and PsiNorm maintained their performance, while the proportion estimated by sctransform significantly dropped, resulting in the superior performance of scKWARN and PsiNorm over sctransform (<xref rid="btae008-F5" ref-type="fig">Fig. 5c</xref>). This result suggests that scKWARN and PsiNorm demonstrate robustness even in scenarios with a high dropout rate and a small number of cells.</p>
      <fig position="float" id="btae008-F5">
        <label>Figure 5.</label>
        <caption>
          <p>Performance comparison on the GSE29087 dataset. Y axis denotes the proportion of 718 gold standard genes in the top N genes (x axis). The performance was compared in three settings, where none of cells (a), half of the cells (b), or all cells (c) were downsized.</p>
        </caption>
        <graphic xlink:href="btae008f5" position="float"/>
      </fig>
      <p>Furthermore, we assessed the clustering performance of scKWARN using the third dataset, GSE118767, which includes ground truth cell type labels. This dataset, generated by various sequencing platforms, comprises seven datasets from five lung adenocarcinoma cell lines: H1975, H2228, HCC827, H838, and A549. Clustering quality was evaluated using Average Silhouette Width (ASW) and Adjusted Rand Index (ARI) (Details in <xref rid="sup1" ref-type="supplementary-material">Supplementary Materials</xref>). A higher score in these metrics suggests better clustering performance. Additionally, we employed the 1-correlation, where the correlation represents the maximum correlation between PC1 and PC2 of gene expressions and cell sequencing depths (<xref rid="btae008-B2" ref-type="bibr">Borella <italic toggle="yes">et al.</italic> 2021</xref>). A higher score in this context indicates lower correlation and better performance, signifying that normalization successfully eliminates biases introduced by sequencing depths. The average values of ASW, ARI and 1-correlation across the seven datasets were listed in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>. Overall, all normalization methods enhanced clustering performance, yielding higher ASW and ARI values compared to unnormalized data. Among normalization methods, SCnorm exhibited the lowest ASW and ARI values and the second lowest 1-correlation score. This result suggests that normalization methods generally perform well in high-quality data. Subsequently, we simulated five scenarios ranging from well-balanced (1:1:1:1:1) to extremely imbalanced cell compositions (36:1:1:1:1) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>). In balanced settings, sctransform achieved the highest ASW values, while scKWARN and PsiNorm demonstrated higher ASW values as the cell composition became more imbalanced (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>, UMAP and PCA plots in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S7</xref> and <xref rid="sup1" ref-type="supplementary-material">S8</xref>). This trend became more pronounced when the imbalanced cell composition was driven by an increasing number of H838 cells and a decrease in other cell lines (<xref rid="btae008-F6" ref-type="fig">Fig. 6b</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>). All methods yielded higher ARI values than unnormalized data, indicating improved clustering performance (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>). scKWARN consistently achieved the highest 1-correlation scores in all scenarios (<xref rid="btae008-F6" ref-type="fig">Fig. 6a and b</xref>). SCnorm was not included in these scenarios due to lengthy computational time.</p>
      <fig position="float" id="btae008-F6">
        <label>Figure 6.</label>
        <caption>
          <p>Performance comparison of unnormalized and five normalization methods on the GSE118767 datasets with five scenarios (1–5) where the cell composition changes from balanced (scenario 1) to extremely imbalanced (scenario 5). (a) The imbalanced cell composition was driven by the increasing number of A549 but decreasing of other cell lines. (b) The imbalanced cell composition was driven by the increasing number of H838 but decreasing of other cell lines.</p>
        </caption>
        <graphic xlink:href="btae008f6" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.3 Computational performance</title>
      <p>We compared the computational performance of the six normalization methods using both real and simulated datasets with varying number of genes and cells (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>). As expected, RC and PsiNorm were the fastest due to simple algorithms. scran and scKWARN required more time than RC and PsiNorm. Sctransform and SCnorm, which depend on model fitting, had the longest computational time. SCnorm even failed on some large datasets.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>Accurate normalization is essential for the success of scRNAseq data analysis. An effective normalization method should preserve intrinsic biological features while correcting unwanted biases and be robust against known or hidden technical noises. Here, we introduce scKWARN, a method that does not assume specific data distributions or count-depth relationships. scKWARN has demonstrated improved performance over existing methods in both simulation and real studies. The absence of assumptions about count-depth relationships or read count distributions allows scKWARN to work effectively across diverse settings.</p>
    <p>The key strength of scKWARN lies in its way to construct pseudo-profiles for each cell by leveraging information from its fuzzy technical neighbors. These technical neighbors are approximately defined based on the quantile distribution of non-zero profiles. This approach empowers scKWARN to effectively eliminate noise introduced by hidden or unknown factors that impact non-zero counts distributions. Furthermore, each cell has its own reference profile for comparison, ensuring the robustness of the non-DE assumption even in scenarios with unbalanced cell population sizes, a situation frequently overlooked by existing methods.</p>
    <p>scKWARN utilizes the 25th, 50th, and 75th percentiles of non-zero profiles to define technical neighbors. These three percentiles are commonly employed to represent the location and scale of data, and they are robust against extreme values. This choice allows scKWARN to capture the main features of the data and counteract the effects of differentially expressed genes and highly expressed genes. While other percentiles between the 25th and 75th are feasible and yield similar results in downstream analysis (not shown), lower or higher percentiles, such as the 10th or 90th percentiles, are not recommended due to large variability in the tails of the expression profile. The use of lower/higher percentiles can result in high RMSE values and sensitive outcomes in differential expression analysis.</p>
    <p>scKWARN only employs the first principal component (PC) of the three-dimensional percentile data to identify technical neighbors. This decision was made due to the observation that incorporating additional PCs significantly escalated computational demands without corresponding performance improvements. For instance, employing two PCs (PC1+PC2) led to a 38% increase in computational time compared to using PC1 alone. Nevertheless, scKWARN utilizing PC1+PC2 yielded nearly identical RMSE and F1 scores as the one employing the PC1 alone across the three simulation settings with five different scenarios (<xref rid="sup1" ref-type="supplementary-material">Supplementary Tables S2</xref> and <xref rid="sup1" ref-type="supplementary-material">S3</xref>). The lack of improvement in performance may be attributed to the fact that PC1 already encompasses a substantial amount of variance in the three-dimensional percentile data. For example, PC1 included at least 70% of the variance in the percentile data in those simulations. Moreover, employing additional PCs might even compromise the performance. If more PCs were utilized, there is a greater likelihood of encompassing biological rather than technical variances, introducing potential biases in the determination of technical neighbors.</p>
    <p>scKWARN applies a both cell- and gene-specific weighting approach, which can be further improved for better computational performance by incorporating a cutoff option. This option sets low weights to zero when cell distances exceed the bandwidth by a specified cutoff factor (default cutoff = 2). The inclusion of the cutoff option has resulted in approximately 20% savings in computational time while maintaining consistent performance (<xref rid="sup1" ref-type="supplementary-material">Supplementary Tables S4</xref> and <xref rid="sup1" ref-type="supplementary-material">S5</xref>).</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btae008_Supplementary_Data</label>
      <media xlink:href="btae008_supplementary_data.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors would like to thank all reviewers for their insightful comments and valuable suggestions.</p>
  </ack>
  <sec>
    <title>Supplementary data</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
  </sec>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the National Institutes of Health [P30 CA068485, U24 CA163056, P50 CA236733, P50 CA098131, U54 CA163072, U2C CA233291, P01 CA229123, P01 AI139449, and U54 CA274367].</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The data underlying this article are available at <ext-link xlink:href="https://github.com/cyhsuTN/scKWARN" ext-link-type="uri">https://github.com/cyhsuTN/scKWARN</ext-link>.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btae008-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bacher</surname><given-names>R</given-names></string-name>, <string-name><surname>Chu</surname><given-names>L-F</given-names></string-name>, <string-name><surname>Leng</surname><given-names>N</given-names></string-name></person-group><etal>et al</etal><article-title>SCnorm: robust normalization of single-cell RNA-seq data</article-title>. <source>Nat Methods</source><year>2017</year>;<volume>14</volume>:<fpage>584</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">28418000</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Borella</surname><given-names>M</given-names></string-name>, <string-name><surname>Martello</surname><given-names>G</given-names></string-name>, <string-name><surname>Risso</surname><given-names>D</given-names></string-name></person-group><etal>et al</etal><article-title>PsiNorm: a scalable normalization for single-cell RNA-seq data</article-title>. <source>Bioinformatics</source><year>2021</year>;<volume>38</volume>:<fpage>164</fpage>–<lpage>72</lpage>.<pub-id pub-id-type="pmid">34499096</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ding</surname><given-names>B</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhu</surname><given-names>Y</given-names></string-name></person-group><etal>et al</etal><article-title>Normalization and noise reduction for single cell RNA-seq experiments</article-title>. <source>Bioinformatics</source><year>2015</year>;<volume>31</volume>:<fpage>2225</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">25717193</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Finak</surname><given-names>G</given-names></string-name>, <string-name><surname>McDavid</surname><given-names>A</given-names></string-name>, <string-name><surname>Yajima</surname><given-names>M</given-names></string-name></person-group><etal>et al</etal><article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><year>2015</year>;<volume>16</volume>:<fpage>278</fpage>.<pub-id pub-id-type="pmid">26653891</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hafemeister</surname><given-names>C</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R.</given-names></string-name></person-group><article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>. <source>Genome Biol</source><year>2019</year>;<volume>20</volume>:<fpage>296</fpage>.<pub-id pub-id-type="pmid">31870423</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Han</surname><given-names>X</given-names></string-name>, <string-name><surname>Wang</surname><given-names>R</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Y</given-names></string-name></person-group><etal>et al</etal><article-title>Mapping the mouse cell atlas by Microwell-Seq</article-title>. <source>Cell</source><year>2018</year>;<volume>173</volume>:<fpage>1307</fpage>.<pub-id pub-id-type="pmid">29775597</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Katayama</surname><given-names>S</given-names></string-name>, <string-name><surname>Töhönen</surname><given-names>V</given-names></string-name>, <string-name><surname>Linnarsson</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>SAMstrt: statistical test for differential expression in single-cell transcriptome with spike-in normalization</article-title>. <source>Bioinformatics</source><year>2013</year>;<volume>29</volume>:<fpage>2943</fpage>–<lpage>5</lpage>.<pub-id pub-id-type="pmid">23995393</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>H-O</given-names></string-name>, <string-name><surname>Hong</surname><given-names>Y</given-names></string-name>, <string-name><surname>Etlioglu</surname><given-names>HE</given-names></string-name></person-group><etal>et al</etal><article-title>Lineage-dependent gene expression programs influence the immune landscape of colorectal cancer</article-title>. <source>Nat Genet</source><year>2020</year>;<volume>52</volume>:<fpage>594</fpage>–<lpage>603</lpage>.<pub-id pub-id-type="pmid">32451460</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Love</surname><given-names>MI</given-names></string-name>, <string-name><surname>Huber</surname><given-names>W</given-names></string-name>, <string-name><surname>Anders</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title>. <source>Genome Biol</source><year>2014</year>;<volume>15</volume>:<fpage>550</fpage>.<pub-id pub-id-type="pmid">25516281</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lun</surname><given-names>AT</given-names></string-name></person-group><string-name><surname>Bach</surname><given-names>K</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>. <article-title>Pooling across cells to normalize single-cell RNA sequencing data with many zero counts</article-title>. <source>Genome Biol</source><year>2016</year>;<volume>17</volume>:<fpage>75</fpage>.<pub-id pub-id-type="pmid">27122128</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maza</surname><given-names>E</given-names></string-name>, <string-name><surname>Frasse</surname><given-names>P</given-names></string-name>, <string-name><surname>Senin</surname><given-names>P</given-names></string-name></person-group><etal>et al</etal><article-title>Comparison of normalization methods for differential gene expression analysis in RNA-Seq experiments: a matter of relative size of studied transcriptomes</article-title>. <source>Commun Integr Biol</source><year>2013</year>;<volume>6</volume>:<fpage>e25849</fpage>.<pub-id pub-id-type="pmid">26442135</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moliner</surname><given-names>A</given-names></string-name>, <string-name><surname>Enfors</surname><given-names>P</given-names></string-name>, <string-name><surname>Ibáñez</surname><given-names>CF</given-names></string-name></person-group><etal>et al</etal><article-title>Mouse embryonic stem cell-derived spheres with distinct neurogenic potentials</article-title>. <source>Stem Cells Dev</source><year>2008</year>;<volume>17</volume>:<fpage>233</fpage>–<lpage>43</lpage>.<pub-id pub-id-type="pmid">18447639</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Robinson</surname><given-names>MD</given-names></string-name>, <string-name><surname>Oshlack</surname><given-names>A.</given-names></string-name></person-group><article-title>A scaling normalization method for differential expression analysis of RNA-seq data</article-title>. <source>Genome Biol</source><year>2010</year>;<volume>11</volume>:<fpage>R25</fpage>.<pub-id pub-id-type="pmid">20196867</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shami</surname><given-names>AN</given-names></string-name>, <string-name><surname>Zheng</surname><given-names>X</given-names></string-name>, <string-name><surname>Munyoki</surname><given-names>SK</given-names></string-name></person-group><etal>et al</etal><article-title>Single-Cell RNA sequencing of human, macaque, and mouse testes uncovers conserved and divergent features of mammalian spermatogenesis</article-title>. <source>Dev Cell</source><year>2020</year>;<volume>54</volume>:<fpage>529</fpage>–<lpage>47.e12</lpage>.<pub-id pub-id-type="pmid">32504559</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sheather</surname><given-names>SJ</given-names></string-name>, <string-name><surname>Jones</surname><given-names>MC.</given-names></string-name></person-group><article-title>A reliable data-based bandwidth selection method for kernel density estimation</article-title>. <source>J R Stat Soc Ser B</source><year>1991</year>;<volume>53</volume>:<fpage>683</fpage>–<lpage>90</lpage>.</mixed-citation>
    </ref>
    <ref id="btae008-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vallejos</surname><given-names>CA</given-names></string-name>, <string-name><surname>Marioni</surname><given-names>JC</given-names></string-name>, <string-name><surname>Richardson</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>BASiCS: Bayesian analysis of Single-Cell sequencing data</article-title>. <source>PLoS Comput Biol</source><year>2015</year>;<volume>11</volume>:<fpage>e1004333</fpage>.<pub-id pub-id-type="pmid">26107944</pub-id></mixed-citation>
    </ref>
    <ref id="btae008-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>T</given-names></string-name>, <string-name><surname>Li</surname><given-names>B</given-names></string-name>, <string-name><surname>Nelson</surname><given-names>CE</given-names></string-name></person-group><etal>et al</etal><article-title>Comparative analysis of differential gene expression analysis tools for single-cell RNA sequencing data</article-title>. <source>BMC Bioinformatics</source><year>2019</year>;<volume>20</volume>:<fpage>40</fpage>.<pub-id pub-id-type="pmid">30658573</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
