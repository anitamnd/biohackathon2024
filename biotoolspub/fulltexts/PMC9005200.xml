<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD with OASIS Tables v1.0 20120330//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing-oasis-article1.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName jats-oasis2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">J Biomed Opt</journal-id>
    <journal-id journal-id-type="iso-abbrev">J Biomed Opt</journal-id>
    <journal-id journal-id-type="coden">JBOPFO</journal-id>
    <journal-id journal-id-type="publisher-id">JBO</journal-id>
    <journal-title-group>
      <journal-title>Journal of Biomedical Optics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1083-3668</issn>
    <issn pub-type="epub">1560-2281</issn>
    <publisher>
      <publisher-name>Society of Photo-Optical Instrumentation Engineers</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9005200</article-id>
    <article-id pub-id-type="pmid">35415991</article-id>
    <article-id pub-id-type="doi">10.1117/1.JBO.27.8.083005</article-id>
    <article-id pub-id-type="publisher-manuscript">JBO-210348SSTR</article-id>
    <article-id pub-id-type="publisher-id">210348SSTR</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Special Section Celebrating 30 Years of Open Source Monte Carlo Codes in Biomedical Optics</subject>
      </subj-group>
      <subj-group subj-group-type="SPIE-art-type">
        <subject>Paper</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MCCL: an open-source software application for Monte Carlo simulations of radiative transport</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-5696-160X</contrib-id>
        <name>
          <surname>Hayakawa</surname>
          <given-names>Carole K.</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">a</xref>
        <xref rid="aff2" ref-type="aff">b</xref>
        <xref rid="cor1" ref-type="corresp">*</xref>
        <xref rid="b1" ref-type="bio"/>
        <email>hayakawa@uci.edu</email>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Malenfant</surname>
          <given-names>Lisa</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">b</xref>
        <xref rid="b2" ref-type="bio"/>
        <email>lisa.malenfant@uci.edu</email>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-6069-6527</contrib-id>
        <name>
          <surname>Ranasinghesagara</surname>
          <given-names>Janaka</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">a</xref>
        <xref rid="aff2" ref-type="aff">b</xref>
        <xref rid="b3" ref-type="bio"/>
        <email>jranasin@uci.edu</email>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cuccia</surname>
          <given-names>David J.</given-names>
        </name>
        <xref rid="aff3" ref-type="aff">c</xref>
        <xref rid="b4" ref-type="bio"/>
        <email>dcuccia@modulim.com</email>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Spanier</surname>
          <given-names>Jerome</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">b</xref>
        <xref rid="b5" ref-type="bio"/>
        <email>jspanier@uci.edu</email>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-4781-1049</contrib-id>
        <name>
          <surname>Venugopalan</surname>
          <given-names>Vasan</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">a</xref>
        <xref rid="aff2" ref-type="aff">b</xref>
        <xref rid="cor1" ref-type="corresp">*</xref>
        <xref rid="b6" ref-type="bio"/>
        <email>vvenugop@uci.edu</email>
      </contrib>
      <aff id="aff1"><label>a</label><institution>University of California at Irvine</institution>, Department of Chemical and Biomolecular Engineering, Irvine, California, <country>United States</country></aff>
      <aff id="aff2"><label>b</label><institution>University of California at Irvine, Beckman Laser Institute</institution>, Irvine, California, <country>United States</country></aff>
      <aff id="aff3"><label>c</label><institution>Modulim</institution>, Irvine, California, <country>United States</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor1"><label>*</label>Address all correspondence to Carole K. Hayakawa, <email>hayakawa@uci.edu</email>; Vasan Venugopalan, <email>vvenugop@uci.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>12</day>
      <month>4</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>8</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>12</day>
      <month>4</month>
      <year>2022</year>
    </pub-date>
    <!--PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>.-->
    <volume>27</volume>
    <issue>8</issue>
    <elocation-id>083005</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>11</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>11</day>
        <month>3</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2022 The Authors</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>The Authors</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>Published by SPIE under a Creative Commons Attribution 4.0 International License. Distribution or reproduction of this work in whole or in part requires full attribution of the original publication, including its DOI.</license-p>
      </license>
    </permissions>
    <self-uri xlink:title="pdf" xlink:href="JBO_27_8_083005.pdf"/>
    <abstract>
      <title>Abstract.</title>
      <p>The Monte Carlo Command Line application (MCCL) is an open-source software package that provides Monte Carlo simulations of radiative transport through heterogeneous turbid media. MCCL is available on GitHub through our virtualphotonics.org website, is actively supported, and carries extensive documentation. Here, we describe the main technical capabilities, the overall software architecture, and the operational details of MCCL.</p>
    </abstract>
    <kwd-group>
      <title>Keywords:</title>
      <kwd>Monte Carlo simulation</kwd>
      <kwd>open-source software</kwd>
      <kwd>photon migration</kwd>
      <kwd>diffuse optics</kwd>
    </kwd-group>
    <funding-group>
      <award-group id="sp1">
        <funding-source>National Institutes of Health Biomedical Technology Resource Center</funding-source>
        <award-id>P41-EB015890</award-id>
      </award-group>
      <award-group id="sp2">
        <funding-source>National Institutes of Health Mentored Quantitative Research Career Development Award</funding-source>
        <award-id>K25-EB007309</award-id>
      </award-group>
      <award-group id="sp3">
        <funding-source>National Institutes of Health Short Courses in Computational Biophotonics</funding-source>
        <award-id>R25-GM103818</award-id>
      </award-group>
      <award-group id="sp4">
        <funding-source>National Institutes of Health Exploratory/Developmental Research Grant Award</funding-source>
        <award-id>R21-GM128135</award-id>
      </award-group>
      <award-group id="sp5">
        <funding-source>National Science Foundation Collaborative Research Award</funding-source>
        <award-id>CBET-1805082</award-id>
      </award-group>
    </funding-group>
    <counts>
      <fig-count count="7"/>
      <table-count count="6"/>
      <ref-count count="37"/>
      <page-count count="19"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>running-head</meta-name>
        <meta-value>Hayakawa et al.: MCCL: an open-source software application for Monte Carlo simulations…</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <label>1</label>
    <title>Introduction</title>
    <p>Monte Carlo (MC) methods to provide solutions for the radiative transport equation (RTE) originated at Los Alamos National Lab in 1946. At that time, the intent was to solve nuclear fission problems. The initial code base that was developed has subsequently evolved into the Monte Carlo N-Particle Transport (MCNP<xref rid="r1" ref-type="bibr"><sup>1</sup></xref>) code.<xref rid="r2" ref-type="bibr"><sup>2</sup></xref> Since then, MC simulations of radiative transport have been used to solve problems in biomedical optics. The first paper documenting the use of MC to study light propagation in tissue was published by Wilson and Adam,<xref rid="r3" ref-type="bibr"><sup>3</sup></xref> and this was followed by Prahl et al.<xref rid="r4" ref-type="bibr"><sup>4</sup></xref> which served as a precursor to the seminal 1995 paper by Wang et al.<xref rid="r5" ref-type="bibr"><sup>5</sup></xref> that introduced the open-source MC Command Line application (MCML) code commemorated in this special issue.</p>
    <p>Our development of the MCCL began with C code developed initially by Andy Dunn and Derek Smithies at the Beckman Laser Institute (BLI) at the University of California, Irvine, in 1998. Carole Hayakawa, under the direction of Jerry Spanier, advanced this code base through the development of perturbation and differential MC methods in support of her doctoral thesis.<xref rid="r6" ref-type="bibr"><sup>6</sup></xref><sup>,</sup><xref rid="r7" ref-type="bibr"><sup>7</sup></xref> In 2008, the Virtual Photonics Technology Core (VPTC) was formed within the BLI National Institutes of Health (NIH) P41 Biomedical Technology Research Center (Laser Institute Laser Microbeam and Medical Program) under the leadership of Jerry Spanier and Vasan Venugopalan. The formation of the VPTC motivated the systematic organization of the software with the intent of open-source distribution to the Biomedical Optics community. This effort coincided with a NIH K25 award to Hayakawa to further develop a “Virtual Tissue Simulator for Biomedical Optics.” Soon after David Cuccia saw multiple opportunities to restructure the code to enable: (a) an object-oriented and extensible software platform and (b) organized versioning that would provide a stable code base for students/researchers who may require specialized code modifications for their work. Cuccia and Hayakawa ported the code to C# and the first version of the MCCL was uploaded to CodePlex in 2010. We migrated the code to GitHub (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki</ext-link>) in 2017 where it has been maintained ever since. In 2014, Ranasinghesagara added a diverse set of optical source definitions suited for a variety of applications (see Secs. <xref rid="sec2.7" ref-type="sec">2.7</xref> and <xref rid="sec3.3" ref-type="sec">3.3</xref> for more information). A unique aspect of our open-source code project is our commitment to have professional management of our code and web development, a critical role that Lisa Malenfant has provided since 2010. This ensures that our code has guidelines, naming conventions, documentation, and a web presence that is informative and easy to navigate. From 2013 to 2018, the VPTC led the development and delivery of annual Short Courses in Computational Biophotonics (<ext-link xlink:href="https://education.virtualphotonics.org" ext-link-type="uri">https://education.virtualphotonics.org</ext-link>). In these courses, MCCL played an integral role in the lab exercises to demonstrate the capabilities and characteristics of MC simulations to solve the RTE and illustrate important conceptual aspects of light transport within biological tissues.</p>
    <p>We developed the MCCL to provide the following capabilities: (a) software extensibility to allow easy incorporation of additional source, tissue, and detector options, (b) various optical sources and detectors as well as commonly analyzed tissue structures used in the biomedical optics community, and (c) simulations using foundational MC methods, e.g., those employed by MCNP, and advanced methods, such as perturbation MC. Our objective in this paper is to describe our open-source MC simulation engine, its modular architecture, features, operation, and the ample resources we have provided to support user installation and usage.</p>
  </sec>
  <sec id="sec2">
    <label>2</label>
    <title>Important Features of MCCL</title>
    <p>MCCL is packaged with the Monte Carlo Post Processor (MCPP) and is available for Windows, MacOS, and Linux by downloading the software from the Virtual Photonics GitHub website (<ext-link xlink:href="https://github.com/VirtualPhotonics" ext-link-type="uri">https://github.com/VirtualPhotonics</ext-link>). Directions for downloading a zip file with executables and for cloning and building it from source code are provided on the “wiki” pages of the MCCL GitHub website (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki</ext-link>). For downloading a zip file, there are separate instructions for Linux (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Getting-Started-on-Linux" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Getting-Started-on-Linux</ext-link>), Mac (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Getting-Started-on-Mac" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Getting-Started-on-Mac</ext-link>), and Windows (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Getting-Started-on-Windows" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Getting-Started-on-Windows</ext-link>). All operating systems require .NET 5.0 consistent with the respective system.</p>
    <p>The code is written in C#, an object-oriented, strongly typed language that allows the software to be easily extensible. Moreover, C# is a component-oriented language which means that the code can be written in the form of components that can be interchanged. In particular, our MCCL design permits the use of any combination of sources, tissues, detectors, and MC estimators within a single simulation. Both MCCL and MCPP have been adapted for .NET Core, and therefore cross-platform applications, which allows a single source to generate executables that run on Windows, Mac, and Linux. In addition, MCCL can be executed across multiple CPUs for improved computational efficiency.</p>
    <sec id="sec2.1">
      <label>2.1</label>
      <title>Open-Source</title>
      <p>MCCL and MCPP are both open-source and maintained in a software repository that provides version control for releases including detailed release notes. The software generated by the Virtual Photonics Technology Initiative (VPTI; <ext-link xlink:href="https://virtualphotonics.org" ext-link-type="uri">https://virtualphotonics.org</ext-link>) is hosted on GitHub (<ext-link xlink:href="https://github.com/VirtualPhotonics" ext-link-type="uri">https://github.com/VirtualPhotonics</ext-link>), a website that hosts open-source software. On GitHub, we provide wiki pages that document the software, an issues section where users can communicate with the development team regarding issues with the software, and instructions on how to pull the source code and download the latest executables. Subpages provide information regarding how to edit input files, examples of command line directives, capabilities, and implementation, detail on source definitions, instruction on operating the post-processor and executing inverse solutions, and a frequently asked questions page. We also list all references used in the code.</p>
    </sec>
    <sec id="sec2.2">
      <label>2.2</label>
      <title>Software Interfaces</title>
      <p>A key advantage of the MCCL and MCPP software architecture is C#’s use of classes and interfaces to readily provide extensibility of the software. A software class is a user-defined blueprint or prototype from which objects are created and an interface looks, such as a class, but has no implementation. Interfaces can contain declarations of fields, properties, and methods. These declarations specify a software contract between the interface and any class that implements it. The contract specifies that the class will implement the fields, properties, and methods and their signatures defined in the interface. Once an interface is defined, coding a specific class that implements the interface is clearly defined to readily provide software extensibility. We have designed all our source, tissue, and detector classes with interfaces to simplify future additions. Our most commonly used sources and detectors are listed in tabular form in Sec. <xref rid="sec3.3" ref-type="sec">3.3</xref>. Moreover, the use of interfaces provides for easier code maintenance since the interface contract prevents any future implementations of classes from breaking the code. Some of the interfaces defined for MCCL and MCPP include: the absorption weighting methods, inputs for optical sources, detectors and tissues, and the resulting class implementations. For example, our <monospace>TissueInput</monospace> interface specifies a <monospace>TissueType</monospace> identifier string, an array of tissue <monospace>Regions</monospace>, and a method to create the corresponding tissue, <monospace>CreateTissue</monospace>. Any new tissue class added to the software would implement this interface, and therefore, be required to have code that defines the <monospace>TissueType, Regions</monospace>, and a method <monospace>CreateTissue</monospace>. The use of interfaces allows users to pipeline together a selected source, tissue, and detectors into a simulation requiring little knowledge of code.</p>
    </sec>
    <sec id="sec2.3">
      <label>2.3</label>
      <title>Multiprocessor Capability</title>
      <p>MCCL provides the option to execute simulations in parallel across a specified number of CPUs. This can be invoked using the option “<monospace>cpucount=#</monospace>” in the command line. Usage of the multiprocessor capability requires the selection of a random number seed in each simulation such that the random number sequences on each CPU or thread are independent, i.e., do not overlap. When executing the code on a single CPU, we employ the Mersenne Twister algorithm<xref rid="r8" ref-type="bibr"><sup>8</sup></xref> which generates pseudo-random numbers with period <inline-formula><mml:math id="math1" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>19937</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. When executing on multiple CPUs, the code uses a Dynamic Creator Mersenne Twister<xref rid="r9" ref-type="bibr"><sup>9</sup></xref> which finds substreams of the original Mersenne Twister to ensure that the substreams are independent.</p>
    </sec>
    <sec id="sec2.4">
      <label>2.4</label>
      <title>Tissue Heterogeneities</title>
      <p>MCCL supports MC simulations in layered tissues to model tissue structures such as skin as well as the introduction of inclusions, such as ellipsoids, cubes, and cylinders, with different optical properties to approximate internal structures such as tumors or blood vessels. Our use of analytical functions to define inclusions was inspired by the Los Alamos National Lab MCNP code. The usage of analytic functions to define the boundaries of the heterogeneities provides two key advantages. First, the means to determine whether the photon is inside or outside the heterogeneity can be performed through the evaluation of a quadratic function. Second, the curved surfaces of heterogeneities, such as spheres, ellipsoids, or cylinders are modeled exactly and avoids the “voxelization” errors that can occur when modeling objects with curved surfaces that lead to significant errors in computation of reflectance and transmission across interfaces.<xref rid="r10" ref-type="bibr"><sup>10</sup></xref> A notable drawback of this approach is that heterogeneous tissues defined by a network of tetrahedrons cannot be modeled,<xref rid="r11" ref-type="bibr"><sup>11</sup></xref><named-content content-type="online"><xref rid="r12" ref-type="bibr"/></named-content><named-content content-type="print"><sup>–</sup></named-content><xref rid="r13" ref-type="bibr"><sup>13</sup></xref> and Digital Imaging and Communications in Medicine images cannot be currently imported to define the tissue geometry. However, a key objective in developing MCCL was to develop a modular MC simulation platform that rigorously solves the RTE to support streamlined investigations for a wide variety of simple model problems and can examine the impact of different optical sources, detectors, and/or MC estimators on performance and computational efficiency. MCCL is not intended to serve as a medical imaging tool as there are other code bases that fill that need.</p>
    </sec>
    <sec id="sec2.5">
      <label>2.5</label>
      <title>Variance and Efficiency</title>
      <p>Because MC is a stochastic solution method, the results of all simulations have an associated uncertainty or variance that quantifies their accuracy. In our design of MCCL, we have prioritized direct user access to rigorous metrics for the uncertainty of the simulation output so that they can properly interpret MCCL results. The fundamental metric characterizing the uncertainty of a MC random variable <inline-formula><mml:math id="math2" display="inline" overflow="scroll"><mml:mrow><mml:mi>ξ</mml:mi></mml:mrow></mml:math></inline-formula> is the variance defined as <inline-formula><mml:math id="math3" display="inline" overflow="scroll"><mml:mrow><mml:mi>Var</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ξ</mml:mi><mml:mo>−</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="math4" display="inline" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> is the expected value or mean of <inline-formula><mml:math id="math5" display="inline" overflow="scroll"><mml:mrow><mml:mi>ξ</mml:mi></mml:mrow></mml:math></inline-formula>. This is equivalent to the second central moment of <inline-formula><mml:math id="math6" display="inline" overflow="scroll"><mml:mrow><mml:mi>ξ</mml:mi></mml:mrow></mml:math></inline-formula>. The standard deviation of the random variable <inline-formula><mml:math id="math7" display="inline" overflow="scroll"><mml:mrow><mml:mi>σ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is given by the square root of the variance. Users can generate the standard deviation associated with the tally from each detector by setting “<monospace>TallySecondMoment</monospace>” to “<monospace>true</monospace>” in the input file. A rigorous comparative analysis of the performance of two different MC simulations is provided by a metric called computational efficiency. The computational efficiency <inline-formula><mml:math id="math8" display="inline" overflow="scroll"><mml:mrow><mml:mi>Eff</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> of <inline-formula><mml:math id="math9" display="inline" overflow="scroll"><mml:mrow><mml:mi>ξ</mml:mi></mml:mrow></mml:math></inline-formula> is given by <inline-formula><mml:math id="math10" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>T</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> where <inline-formula><mml:math id="math11" display="inline" overflow="scroll"><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula> is the relative error and <inline-formula><mml:math id="math12" display="inline" overflow="scroll"><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> is the computer run time.<xref rid="r2" ref-type="bibr"><sup>2</sup></xref> The relative error <inline-formula><mml:math id="math13" display="inline" overflow="scroll"><mml:mrow><mml:mi>R</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> in the estimate of <inline-formula><mml:math id="math14" display="inline" overflow="scroll"><mml:mrow><mml:mi>ξ</mml:mi></mml:mrow></mml:math></inline-formula> is given by <inline-formula><mml:math id="math15" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec id="sec2.6">
      <label>2.6</label>
      <title>Absorption Weighting Types</title>
      <p>All MC codes require a method to account for optical absorption. MCCL allows the user to specify the use of Analog, Discrete Absorption Weighting (DAW), or Continuous Absorption Weighting (CAW).<xref rid="r14" ref-type="bibr"><sup>14</sup></xref> The desired weighting method can be selected by setting “<monospace>AbsorptionWeightingType</monospace>” to “<monospace>Analog</monospace>,” “<monospace>Discrete</monospace>,” or “<monospace>Continuous</monospace>.” Each method has advantages and disadvantages depending on the system under investigation.<xref rid="r15" ref-type="bibr"><sup>15</sup></xref> In the Analog method, the photon retains a weight of 1, however, at each scattering event it can be absorbed and terminated with probability <inline-formula><mml:math id="math16" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">/</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Intercollision distances are sampled from the distribution <inline-formula><mml:math id="math17" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> where <inline-formula><mml:math id="math18" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:math></inline-formula> is the track length between collisions. Using this method can lead to infrequent tallies at detectors located distally from the source which result in MC estimates with high variance.<xref rid="r2" ref-type="bibr"><sup>2</sup></xref> DAW and CAW are absorption weighting techniques that reduce the weight of the photon during propagation to account for absorption and disallow termination of the photon until it exits the system. DAW which is widely used in other MC programs including MCML, bases intercollision distances on the distribution <inline-formula><mml:math id="math19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="math20" display="inline" overflow="scroll"><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:math></inline-formula> is the track length, while CAW bases these distances on <inline-formula><mml:math id="math21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.<xref rid="r15" ref-type="bibr"><sup>15</sup></xref> All of these absorption estimators are unbiased so they provide random variables that converge to the solution of the RTE in the limit as <inline-formula><mml:math id="math22" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula> (the number of photons launched) goes to infinity.<xref rid="r14" ref-type="bibr"><sup>14</sup></xref></p>
      <p>Most MC codes in the biomedical community enable the use of DAW and/or CAW, however, none to our knowledge enable Analog<xref rid="r14" ref-type="bibr"><sup>14</sup></xref> processing. In terms of computational efficiency, estimation of <inline-formula><mml:math id="math23" display="inline" overflow="scroll"><mml:mrow><mml:mi>ξ</mml:mi></mml:mrow></mml:math></inline-formula> using an Analog random walk process can provide higher efficiencies compared to DAW and CAW due to the simplicity of the computations involved which result in shorter computer run times. However, for a given problem it is difficult to know in advance which estimator will produce the greatest efficiency.<xref rid="r15" ref-type="bibr"><sup>15</sup></xref></p>
    </sec>
    <sec id="sec2.7">
      <label>2.7</label>
      <title>Sources</title>
      <p>MCCL provides numerous input options that enable the simulation of both external optical sources irradiating the tissue surface or interstitial sources that reside within the tissue volume. The input options provide the flexibility needed to accurately model physical optical sources. MCCL allows the user to define basic sources, such point and line sources, but also surface and volumetric sources, such as surface emitting sources (emitted from flat circular, elliptical, or rectangular surfaces), surface emitting bulk sources (emitted from cylindrical fiber, spherical, cuboidal, or tubular surfaces), and volumetric sources (emitted from the volume of a cube, or tissue region for fluorescence emission). Our extensive selection of optical sources provides the ability to tailor spatial and angular characteristics and is described further in Sec. <xref rid="sec3.3" ref-type="sec">3.3</xref>.</p>
    </sec>
    <sec id="sec2.8">
      <label>2.8</label>
      <title>Detectors</title>
      <p>MCCL provides options for detectors that tally upon the exit of photons from the tissue, i.e., reflectance and transmittance, and detectors that require data associated with the photon trajectory to determine a tally internal to the tissue, i.e., absorbed energy, fluence, radiance, and momentum transfer.<xref rid="r16" ref-type="bibr"><sup>16</sup></xref> The detector spatial bins can be defined in terms of Cartesian and/or cylindrical grid specifications. Angular bins can be custom designed using polar and azimuthal bin specifications. MCCL provides detectors supporting common spatial and/or temporal detection schemes, i.e., spatially resolved (based on source–detector separation), spatial-frequency domain (for spatially modulated sources), temporally resolved, or temporal-frequency domain (for intensity-modulated sources).</p>
      <p>The MC estimators for the spatial-frequency and temporal-frequency domains are generated by forming a complex photon weight from analysis of spatial and temporal Fourier transforms of the RTE. For both domains, modified shortcut methods<xref rid="r17" ref-type="bibr"><sup>17</sup></xref><sup>,</sup><xref rid="r18" ref-type="bibr"><sup>18</sup></xref> are used to provide results for multiple spatial or temporal frequencies derived from a single MC simulation.</p>
    </sec>
    <sec id="sec2.9">
      <label>2.9</label>
      <title>Databases and Photon Biography Postprocessing</title>
      <p>MCCL enables the user to save photon trajectory information into a database that can be post-processed later by the MCPP. For example, the user can specify in the input file for a “<monospace>DiffuseReflectance</monospace>” database to be generated. This database stores the photon exiting position, direction, exiting weight, and time of flight prior to exit for each of the photons exiting the tissue surface.</p>
      <p>Such a database can serve many uses. The user can examine the impact of bin size (angular, spatial, temporal, and spatial/temporal frequency) on the resulting tally and its variance. Moreover, such a database can be postprocessed to obtain other tallies at a fraction of the computational cost compared to an independent MC simulation.</p>
    </sec>
    <sec id="sec2.10">
      <label>2.10</label>
      <title>Perturbation and Differential Monte Carlo</title>
      <p>Perturbation Monte Carlo (pMC) and differential Monte Carlo (dMC) estimates can also be provided by postprocessing a database that compiles the collision locations and length of track segments for each of the detected photons.<xref rid="r19" ref-type="bibr"><sup>19</sup></xref> Perturbation MC enables the user to obtain rigorous estimates of the change in response of any detector for a specified (small) change in the tissue optical properties without the need to run separate MC simulations. This is performed by using the random walks of a simulation based on the baseline tissue optical properties and appropriately re-weighting the random variable using the Radon–Nikodym derivative.<xref rid="r20" ref-type="bibr"><sup>20</sup></xref> The Radon–Nikodym derivative also enables the determination of derivatives<xref rid="r7" ref-type="bibr"><sup>7</sup></xref> of a measured signal relative to changes in the optical properties. This capability provides an efficient means for sensitivity analysis and performing a gradient-based optimization for the resolution of inverse problems.<xref rid="r6" ref-type="bibr"><sup>6</sup></xref><sup>,</sup><xref rid="r7" ref-type="bibr"><sup>7</sup></xref><sup>,</sup><xref rid="r21" ref-type="bibr"><sup>21</sup></xref><named-content content-type="online"><xref rid="r22" ref-type="bibr"/><xref rid="r23" ref-type="bibr"/><xref rid="r24" ref-type="bibr"/><xref rid="r25" ref-type="bibr"/></named-content><named-content content-type="print"><sup>–</sup></named-content><xref rid="r26" ref-type="bibr"><sup>26</sup></xref> The ability to compute pMC and dMC estimates within a MC simulation and use them for sensitivity analyses or inverse solutions represents a unique aspect of our software. Further detail and depiction of our pMC/dMC software design is provided in Sec. <xref rid="sec3.5" ref-type="sec">3.5</xref> with sample results provided in Sec. <xref rid="sec4" ref-type="sec">4</xref>.</p>
    </sec>
  </sec>
  <sec id="sec3">
    <label>3</label>
    <title>Architecture and Usage of MCCL</title>
    <sec id="sec3.1">
      <label>3.1</label>
      <title>Software Architecture</title>
      <p>The MCCL framework provides the user with the ability to (a) specify inputs necessary to define a simulation (Input), (b) execute the simulation (MCCL Engine), and (c) visualize (MATLAB<xref rid="r27" ref-type="bibr"><sup>27</sup></xref>/Octave<xref rid="r28" ref-type="bibr"><sup>28</sup></xref> plots), and/or further analyze (MCPP) simulation results. Specific software interfaces have been designed to provide each of these functionalities. A subset of the functionality provided by these three components is schematically shown as rectangles with dashed lines in <xref rid="f1" ref-type="fig">Fig. 1</xref>. Sample classes that implement these interfaces are shown within some rectangles.</p>
      <fig position="float" id="f1">
        <label>Fig. 1</label>
        <caption>
          <p>Software architecture: dashed lines represent interfaces and example classes that implement the interfaces (see Sec. <xref rid="sec2.2" ref-type="sec">2.2</xref>). (a) Input: user specifications of system under investigation, (b) MCCL Engine: random walk process designated by input including photon weight decay during random walk process via absorption weighting specification, and detector tallies, and (c) Output: visualization of detector results and/or analysis of results.</p>
        </caption>
        <graphic xlink:href="JBO-027-083005-g001" position="float"/>
      </fig>
      <p>The MCCL input file is written in JavaScript Object Notation (JSON) and is read by the MCCL Engine. The input is comprised of three major sections that allow the user to specify the simulation source, tissue, and detectors, each which have interface definitions. Sample input files are shown on our GitHub website Sample Input &amp; Output (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Sample-Input-And-Output" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Sample-Input-And-Output</ext-link>). At the start of the file there is also an “<monospace>OutputName</monospace>” that designates the folder where the results will be written, “<monospace>N</monospace>” the number of photons to launch and “<monospace>Options</monospace>” that specify various options to the simulation. The detectors can be specified on the tissue surface, reflectance, transmittance, emitted radiance, or history detectors that capture internal tallies such as, absorbed energy, radiance, or fluence. The internal tallies are referred to as “history detectors” because they require information from all interactions that each photon experiences along its trajectory.</p>
      <p>The detector output is written to binary files that can be plotted and visualized using MATLAB or Octave and/or saved to a database for further analysis using MCPP (see Sec. <xref rid="sec3.5" ref-type="sec">3.5</xref>). Analysis results include perturbation MC results, e.g., estimation of the perturbed reflectance due to <inline-formula><mml:math id="math24" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and/or <inline-formula><mml:math id="math25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> changes in any/all regions of the tissue <inline-formula><mml:math id="math26" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and differential MC estimates of the derivative of reflectance with respect to <inline-formula><mml:math id="math27" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and/or <inline-formula><mml:math id="math28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math29" display="inline" overflow="scroll"><mml:mrow><mml:mo>∂</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">/</mml:mo><mml:mo>∂</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="math30" display="inline" overflow="scroll"><mml:mrow><mml:mo>∂</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">/</mml:mo><mml:mo>∂</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The pMC and dMC detector results can be generated by specifying them in an MCCL input file or by generating a database and specifying them in an MCPP input file. MATLAB/Octave script files to perform the plotting are provided with the software.</p>
    </sec>
    <sec id="sec3.2">
      <label>3.2</label>
      <title>MCCL Inputs: Options</title>
      <p>The “<monospace>Options</monospace>” section of the input file contains various settings that specify the desired characteristics of executing the transport of photons through the tissue. All settings are described in this section in the order they appear in the input file.</p>
      <p>Setting the “<monospace>Seed</monospace>” to 0 or a greater integer will generate a reproducible stream of random numbers. Setting the seed to <inline-formula><mml:math id="math31" display="inline" overflow="scroll"><mml:mrow><mml:mo form="prefix">−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> will designate a random stream of random numbers each time the simulation is executed.</p>
      <p>The “<monospace>RandomNumberGeneratorType</monospace>” requires the user to specify the “MersenneTwister.”<xref rid="r8" ref-type="bibr"><sup>8</sup></xref></p>
      <p>Setting “<monospace>AbsorptionWeightingType</monospace>” to “<monospace>Analog</monospace>,” “<monospace>Discrete</monospace>,” or “<monospace>Continuous</monospace>” will specify application of Analog, DAW, or CAW random walk processes to account for absorption, respectively.</p>
      <p>The “<monospace>PhaseFunctionType</monospace>” specifies the probability distribution function governing the photon deflection angle for scattering. Currently implemented options are “<monospace>HenyeyGreenstein</monospace>” which is typically used in tissue optics problems<xref rid="r29" ref-type="bibr"><sup>29</sup></xref> or “<monospace>Bidirectional</monospace>,” which can be used to model one-dimensional (1D) slab problems.</p>
      <p>The “<monospace>Databases</monospace>” options provide the ability to save information regarding photon trajectories to enable subsequent analysis/post-processing of the simulated photons. Setting this option to “<monospace>DiffuseReflectance</monospace>” will generate a binary database that includes pertinent photon data such as the exiting location, direction, and weight of the photon. This database can be post-processed in a few seconds to produce any of our reflectance detector estimates (Sec. <xref rid="sec2.8" ref-type="sec">2.8</xref>).</p>
      <p>pMC and dMC estimates are invoked by setting “<monospace>Databases</monospace>” to “<monospace>pMCDiffuseReflectance</monospace>.” This setting is possible only when the “<monospace>AbsorptionWeightingType</monospace>” is set to “<monospace>Discrete</monospace>” or “<monospace>Continuous</monospace>.” In addition to the photon exiting data when using the “<monospace>DiffuseReflectance</monospace>” option, a “<monospace>CollisionInfo</monospace>” database is generated that saves the photon path length and number of collisions in each tissue region. When the “<monospace>AbsorptionWeightingType</monospace>” is set to “<monospace>Continuous</monospace>” and only <inline-formula><mml:math id="math32" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> changes within any tissue region are specified, Beer’s law is then applied to determine the final weight. pMC is utilized in all other cases, i.e., for absorption or scattering perturbations using DAW or scattering perturbation using CAW. pMC and dMC can be used together to solve inverse problems through the use of a gradient-based optimization algorithm.<xref rid="r6" ref-type="bibr"><sup>6</sup></xref><sup>,</sup><xref rid="r7" ref-type="bibr"><sup>7</sup></xref><sup>,</sup><xref rid="r21" ref-type="bibr"><sup>21</sup></xref><named-content content-type="online"><xref rid="r22" ref-type="bibr"/></named-content><named-content content-type="print"><sup>–</sup></named-content><xref rid="r23" ref-type="bibr"><sup>23</sup></xref><sup>,</sup><xref rid="r25" ref-type="bibr"><sup>25</sup></xref><sup>,</sup><xref rid="r26" ref-type="bibr"><sup>26</sup></xref> Further details are provided in Sec. <xref rid="sec4.1" ref-type="sec">4.1</xref>.</p>
      <p>Setting “<monospace>TrackStatistics</monospace>” to true designates that a “<monospace>statistics.txt</monospace>” file will be created at the end of the simulation. This file will list the number of photons that (a) exit the top surface of the tissue, (b) exit the bottom surface of the tissue, (c) are specularly reflected by the tissue surface and do not propagate within the tissue volume. Moreover, if Russian Roulette (RR) is employed by seeing the option “<monospace>RussianRouletteWeightThreshold</monospace>” to a positive, non-zero value, this file will list the number of photons killed by RR. Such statistics can be valuable to diagnose potential problems in the setup of a simulation and/or understand unexpected results. Moreover, conservation of photon weight (energy) can be verified through examination of these numbers.</p>
      <p>The “<monospace>RussianRouletteWeightThreshold</monospace>” specifies the threshold value of the photon weight that invokes RR. Russian Roulette is an unbiased method for reducing the run time of a simulation by killing off photons once their weight falls below a specified threshold with a fair game probability.<xref rid="r2" ref-type="bibr"><sup>2</sup></xref> The rule governing the fair game probability once the photon weight falls below the threshold is to amplify the photon weight by the factor <inline-formula><mml:math id="math33" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> with probability <inline-formula><mml:math id="math34" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:math></inline-formula>, or kill the photon with probability <inline-formula><mml:math id="math35" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>P</mml:mi></mml:mrow></mml:math></inline-formula>. The usage of RR is only possible for MC simulations using either discrete or continuous absorption weighting (Sec. <xref rid="sec2.6" ref-type="sec">2.6</xref>).</p>
      <p>The “<monospace>SimulationIndex</monospace>” identifies the output from the simulation in the case where multiple simulations are running at the same time, e.g., when performing a parameter sweep or when multiple processors are specified (Sec. <xref rid="sec3.4" ref-type="sec">3.4</xref>).</p>
    </sec>
    <sec id="sec3.3">
      <label>3.3</label>
      <title>MCCL Inputs: SourceInput, TissueInput, and DetectorInput</title>
      <p>We offer an extensive list of source, tissue, and detector inputs to MCCL users. The full list of source, tissue, and detector inputs can be found in an online document, “Source, Tissue, Detector Parameters,” in the right-hand menu of our MCCL GitHub wiki (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki</ext-link>). In this section, we describe a subset of the options. <xref rid="t001" ref-type="table">Table 1</xref> gives a partial list of the source options available in MCCL.</p>
      <table-wrap position="float" id="t001">
        <label>Table 1</label>
        <caption>
          <p>Partial list of MCCL source specifications identified by their name and options. The columns refer to the independent variables provided by these sources in terms of source geometry specific definitions, location with optional translation from origin (0,0,0), direction with optional rotation about principal axis, beam rotation about principal axis, polar (<inline-formula><mml:math id="math36" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:math></inline-formula>) or azimuthal (<inline-formula><mml:math id="math37" display="inline" overflow="scroll"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:math></inline-formula>) emission, angle of convergence or divergence (<inline-formula><mml:math id="math38" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:math></inline-formula> conv or div), source profile (Gaussian or flat) and in what region is the source initiated (initial tissue region). Details can be found on our MCCL GitHub wiki.</p>
        </caption>
        <!--OASIS TABLE HERE-->
        <table frame="hsides" rules="groups">
          <colgroup>
            <col/>
            <col align="left"/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
          </colgroup>
          <thead>
            <tr>
              <th valign="top">Source name</th>
              <th align="left" valign="top">Geometry</th>
              <th valign="top">Location: any</th>
              <th valign="top">Location: translate</th>
              <th valign="top">Direction: any</th>
              <th valign="top">Direction: rotate</th>
              <th valign="top">Beam rotation</th>
              <th valign="top"><inline-formula><mml:math id="math39" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:math></inline-formula> emission</th>
              <th valign="top"><inline-formula><mml:math id="math40" display="inline" overflow="scroll"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:math></inline-formula> emission</th>
              <th valign="top"><inline-formula><mml:math id="math41" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi></mml:mrow></mml:math></inline-formula> conv or div</th>
              <th valign="top">Source profile</th>
              <th valign="top">Initial tissue region</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>DirectionalPoint</td>
              <td align="left">Point</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>DirectionalLine</td>
              <td align="left">Length</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>DirectionalCircular</td>
              <td align="left">Ring radii</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>DirectionalElliptical</td>
              <td align="left"><inline-formula><mml:math id="math42" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="math43" display="inline" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> axes</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>DirectionalRectangular</td>
              <td align="left">Length and width</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>CustomPoint</td>
              <td align="left">Point</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>CustomLine</td>
              <td align="left">Length</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>CustomCircular</td>
              <td align="left">Ring radii</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>CustomElliptical</td>
              <td align="left"><inline-formula><mml:math id="math44" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="math45" display="inline" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> axes</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>CustomRectangular</td>
              <td align="left">Length and width</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>CustomVolumetricEllipsoidal</td>
              <td align="left"><inline-formula><mml:math id="math46" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math47" display="inline" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="math48" display="inline" overflow="scroll"><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:math></inline-formula> axes</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>CustomVolumetricCuboidal</td>
              <td align="left">Length, width, and height</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>IsotropicPoint</td>
              <td align="left">Point</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>IsotropicLine</td>
              <td align="left">Length</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>IsotropicVolumetricEllipsoidal</td>
              <td align="left"><inline-formula><mml:math id="math49" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math50" display="inline" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="math51" display="inline" overflow="scroll"><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:math></inline-formula> axes</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>IsotropicVolumetricCuboidal</td>
              <td align="left">Length, width, and height</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>LambertianSurfaceEmittingSpherical</td>
              <td align="left">Radius</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>LambertianSurfaceEmittingCubiodal</td>
              <td align="left">Length, width, and height</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>LambertianSurfaceEmittingTubular</td>
              <td align="left">Radius and height</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>FluorescenceEmissionAOfXAndYAndZ</td>
              <td align="left">
                <inline-formula>
                  <mml:math id="math52" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>A</mml:mi>
                      <mml:mo stretchy="false">(</mml:mo>
                      <mml:mi>x</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>y</mml:mi>
                      <mml:mo>,</mml:mo>
                      <mml:mi>z</mml:mi>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>Details of our various source configurations (e.g., source code, graphical representations, and equations that are used to sample the source) are described in an online document, “Source Definitions,” in the right-hand menu of our MCCL GitHub wiki (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki</ext-link>). <xref rid="f2" ref-type="fig">Figure 2</xref> shows two source models available in MCCL, the external or internal location of the point source and the initial tissue region index.</p>
      <fig position="float" id="f2">
        <label>Fig. 2</label>
        <caption>
          <p>Example source implementations showing 100 initial unit directional vectors emanating from the source for (a) a surface directional circular source (DirectionalCircular) with radius 0.1 mm, converging with angle of 30 deg, and (b) an internal isotropic point source (IsotropicPoint) at depth <inline-formula><mml:math id="math53" display="inline" overflow="scroll"><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mtext>  </mml:mtext><mml:mi>mm</mml:mi></mml:mrow></mml:math></inline-formula>. The principal axis is shown in red and the <inline-formula><mml:math id="math54" display="inline" overflow="scroll"><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> plane is the tissue surface.</p>
        </caption>
        <graphic xlink:href="JBO-027-083005-g002" position="float"/>
      </fig>
      <p>MCCL provides detectors to tally photon propagation as a function of space, time, spatial frequency, and temporal frequency with user control over the range and resolution of the independent variable of interest. <xref rid="t002" ref-type="table">Tables 2</xref> and <xref rid="t003" ref-type="table">3</xref> provide partial lists of the reflectance and history detector options, respectively, available in MCCL. A full list for reflectance, transmittance, and history detectors can be found in an online document, “Source, Tissue, Detector Parameters,” in the right-hand menu of our MCCL GitHub wiki (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki</ext-link>).</p>
      <table-wrap position="float" id="t002">
        <label>Table 2</label>
        <caption>
          <p>Partial list of MCCL reflectance detector specifications identified by their name and options. The columns refer to the independent variables provided by these detectors in space (<inline-formula><mml:math id="math55" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi></mml:mrow></mml:math></inline-formula>), maximum depth (<inline-formula><mml:math id="math56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>max</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>), spatial-frequency (<inline-formula><mml:math id="math57" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>), time (<inline-formula><mml:math id="math58" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>), temporal-frequency (<inline-formula><mml:math id="math59" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:math></inline-formula>), and/or polar, and azimuthal angles (<inline-formula><mml:math id="math60" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow></mml:math></inline-formula>).</p>
        </caption>
        <!--OASIS TABLE HERE-->
        <table frame="hsides" rules="groups">
          <colgroup>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
          </colgroup>
          <thead>
            <tr>
              <th valign="top">Reflectance detector name</th>
              <th valign="top"><inline-formula><mml:math id="math61" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [mm]</th>
              <th valign="top"><inline-formula><mml:math id="math62" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [mm]</th>
              <th valign="top"><inline-formula><mml:math id="math63" display="inline" overflow="scroll"><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mo>∞</mml:mo><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [mm]</th>
              <th valign="top">
                <inline-formula>
                  <mml:math id="math64" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>f</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>x</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mo>∞</mml:mo>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
                <inline-formula>
                  <mml:math id="math65" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mi>mm</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
              <th valign="top"><inline-formula><mml:math id="math66" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [ns]</th>
              <th valign="top"><inline-formula><mml:math id="math67" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [GHz]</th>
              <th valign="top"><inline-formula><mml:math id="math68" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">/</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> [rad]</th>
              <th valign="top"><inline-formula><mml:math id="math69" display="inline" overflow="scroll"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> [rad]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>RDiffuse</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfAngle</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfRho</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfRhoAndAngle</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfRhoAndTime</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfRhoAndOmega</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfRhoAndMaxDepth</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfXAndY</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfXAndYAndMaxDepth</td>
              <td>✓</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfXAndYAndTime</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfXAndYAndThetaAndPhi</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>ROfFx</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfFxAndAngle</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
            </tr>
            <tr>
              <td>ROfFxAndTime</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
            </tr>
            <tr>
              <td>pMCROfRho</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>pMCROfRhoAndTime</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>pMCROfXAndY</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>pMCROfXAndYAndTime</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>pMCROfFx</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>pMCROfFxAndTime</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
            </tr>
            <tr>
              <td>dMCdROfRhoDMua</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>dMCdROfRhoDMus</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <table-wrap position="float" id="t003">
        <label>Table 3</label>
        <caption>
          <p>Partial list of MCCL history detector specifications identified by their name and options. The columns refer to the independent variables provided by these detectors in space (<inline-formula><mml:math id="math70" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi></mml:mrow></mml:math></inline-formula>), spatial-frequency (<inline-formula><mml:math id="math71" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>), time (<inline-formula><mml:math id="math72" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula>), temporal-frequency (<inline-formula><mml:math id="math73" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi></mml:mrow></mml:math></inline-formula>), and/or polar and azimuthal angles (<inline-formula><mml:math id="math74" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow></mml:math></inline-formula>).</p>
        </caption>
        <!--OASIS TABLE HERE-->
        <table frame="hsides" rules="groups">
          <colgroup>
            <col width="1.00*"/>
            <col width="1.00*"/>
            <col width="1.00*"/>
            <col width="1.00*"/>
            <col width="1.00*"/>
            <col width="1.00*"/>
            <col width="1.00*"/>
            <col width="1.00*"/>
            <col width="1.00*"/>
          </colgroup>
          <thead>
            <tr>
              <th valign="top">History detector name</th>
              <th valign="top"><inline-formula><mml:math id="math75" display="inline" overflow="scroll"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [mm]</th>
              <th valign="top"><inline-formula><mml:math id="math76" display="inline" overflow="scroll"><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mo>∞</mml:mo><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [mm]</th>
              <th valign="top"><inline-formula><mml:math id="math77" display="inline" overflow="scroll"><mml:mrow><mml:mi>z</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [mm]</th>
              <th valign="top">
                <inline-formula>
                  <mml:math id="math78" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:msub>
                        <mml:mrow>
                          <mml:mi>f</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mi>x</mml:mi>
                        </mml:mrow>
                      </mml:msub>
                      <mml:mo>∈</mml:mo>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:mn>0</mml:mn>
                      <mml:mo>,</mml:mo>
                      <mml:mo>∞</mml:mo>
                      <mml:mo stretchy="false">)</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
                <inline-formula>
                  <mml:math id="math79" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo stretchy="false">[</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mi>mm</mml:mi>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>1</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                      <mml:mo stretchy="false">]</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
              <th valign="top"><inline-formula><mml:math id="math80" display="inline" overflow="scroll"><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [ns]</th>
              <th valign="top"><inline-formula><mml:math id="math81" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="normal">Ω</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> [GHz]</th>
              <th valign="top"><inline-formula><mml:math id="math82" display="inline" overflow="scroll"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> [rad]</th>
              <th valign="top"><inline-formula><mml:math id="math83" display="inline" overflow="scroll"><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> [rad]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ATotal</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>AOfRhoAndZ</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>AOfXAndYAndZ</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>FluenceOfRhoAndZ</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>FluenceOfRhoAndZAndTime</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>FluenceOfRhoAndZAndOmega</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>FluenceOfXAndYAndZ</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>FluenceOfXAndYAndZAndTime</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>FluenceOfXAndYAndZAndOmega</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>RadianceOfRhoAndZAndAngle</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
            </tr>
            <tr>
              <td>RadianceOfRhoAtZ</td>
              <td>✓</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
            <tr>
              <td>RadianceOfXAndYAndZAndThetaAndPhi</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
            </tr>
            <tr>
              <td>RadianceOfFxAndZAndAngle</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>✓</td>
              <td>—</td>
              <td>—</td>
              <td>✓</td>
              <td>—</td>
            </tr>
            <tr>
              <td>pMCATotal</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
              <td>—</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
    <sec id="sec3.4">
      <label>3.4</label>
      <title>Command Line Options</title>
      <p>Once the downloadable MCCL zip file is extracted, typing command “mc help” (on Mac and Linux systems the command is “./mc help”) will display a list of command line options. Typing:</p>
      <p>
        <monospace>mc geninfiles</monospace>
      </p>
      <p>will generate example input files. Once input files have been generated, typing:</p>
      <p>
        <monospace>mc infile=infile_one_all_detectors.txt</monospace>
      </p>
      <p>will run MCCL with “<monospace>infile_one_all_detectors.txt</monospace>” which provides examples for how to define each of our detector types.</p>
      <p>The command line environment provides the ability for the user to specify multiple MC simulations by defining a parameter sweep of desired inputs. For example, a user may wish to execute a given MC simulation for different combinations of optical properties with a fixed source, tissue, and detector configuration. The option “<monospace>paramsweep=sweepParameter,start,stop,count</monospace>” allows the user run simulations for varying <inline-formula><mml:math id="math84" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math85" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math86" display="inline" overflow="scroll"><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="math87" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula> values in any tissue layer. This is done by substituting the specified values into the input file and running the resulting simulations. The following example runs simulations using the “myinput” input file as the template with the <inline-formula><mml:math id="math88" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> value in layer 1 set to 0.01, 0.02, 0.03, 0.04, or 4 <inline-formula><mml:math id="math89" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> values within the range [0.01 to 0.04]. This single command launches four simulations with results found in folders that use the “<monospace>OutputName</monospace>” specified in the input file and appending the parameter sweep values. For example, setting “<monospace>OutputName</monospace>” to “<monospace>test</monospace>” in the input file</p>
      <p>“<monospace>OutputName</monospace>”: “<monospace>test</monospace>,”</p>
      <p>and using the command:</p>
      <p>
        <monospace>mc infile=myinput paramsweep=mua1,0.01,0.04,4</monospace>
      </p>
      <p>will generate output folders named “<monospace>test_mua_0.01</monospace>,” “<monospace>test_mua_0.02</monospace>,” “<monospace>test_mua_0.03</monospace>,” and “<monospace>test_mua_0.04</monospace>.” A sweep parameter “<monospace>nphot</monospace>” can designate the number of photons to launch</p>
      <p>
        <monospace>mc infile=myinput paramsweep=nphot,1000000,2000000,2</monospace>
      </p>
      <p>will execute two simulations, one with 1 million photons launched and the second with two million.</p>
      <p>Also available are “<monospace>paramsweepdelta</monospace>” that uses a “<monospace>delta</monospace>” as the fourth parameter rather than a count, and “<monospace>paramsweeplist</monospace>” that can be used for values that are not equispaced. Equivalent commands to the paramsweep example using “<monospace>paramsweepdelta</monospace>” or “<monospace>paramsweeplist</monospace>” are:</p>
      <p>
        <monospace>mc infile=myinput paramsweepdelta=mua1,0.01,0.04,0.01</monospace>
      </p>
      <p>
        <monospace>mc infile=myinput paramsweeplist=mua1,4,0.01,0.02,0.03,0.04</monospace>
      </p>
    </sec>
    <sec id="sec3.5">
      <label>3.5</label>
      <title>MCCL Outputs</title>
      <p>The MCCL Engine produces binary files containing the detector tallies that can be plotted with MATLAB or Octave and/or binary database file(s) for further processing or analysis using our MCPP software (<xref rid="f3" ref-type="fig">Fig. 3</xref>). The detector results are placed in a folder designated by the input file value for “<monospace>OutputName</monospace>.” Editing “<monospace>load_results_script.m</monospace>” and defining “<monospace>datanames</monospace>” to be the “<monospace>OutputName</monospace>” will define the file location with the results to be plotted. Executing the “<monospace>load_results_script.m</monospace>” at the MATLAB or Octave prompt will plot all detector results residing in the output folder. If only a subset of the detector results is desired, the list of toggles at the top of the script should be edited. For example, “<monospace>show.ROfRho = 1</monospace>” will provide visualization of only the results corresponding to that single detector. This script calls jsonlab code (<ext-link xlink:href="https://github.com/fangq/jsonlab" ext-link-type="uri">https://github.com/fangq/jsonlab</ext-link>), an open-source MATLAB/Octave JSON encoder and decoder for Windows, Mac, and Linux, that is included with the zip file. If the user desires second moment data for any detector, they can set the “<monospace>TallySecondMoment</monospace>” flag to “<monospace>true</monospace>” for the corresponding detector. The second moment estimates can provide the standard deviation about the mean estimate for the detector. An example showing the screen display when MCCL is executed and the resulting plots, is provided on our MCCL GitHub wiki Sample Input and Output (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Sample-Input-And-Output" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Sample-Input-And-Output</ext-link>).</p>
      <fig position="float" id="f3">
        <label>Fig. 3</label>
        <caption>
          <p>MC postprocessing and inverse solutions: (a) MCPP: has the ability to post-process a database to produce detector estimates and (b) inverse solution uses photon database and estimates of perturbation MC and differential MC within a gradient-based optimization routine to determine optical properties given a set of measurements.</p>
        </caption>
        <graphic xlink:href="JBO-027-083005-g003" position="float"/>
      </fig>
      <p>The database output can be post-processed to produce any specified reflectance or transmittance detector result, perturbation MC reflectance estimates and/or derivatives of these estimates with respect to <inline-formula><mml:math id="math90" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> or <inline-formula><mml:math id="math91" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> to provide sensitivity results. The database can also be used within an inverse solution as shown in <xref rid="f3" ref-type="fig">Fig. 3</xref>. The derivative estimates can be used within a nonlinear gradient optimization algorithm to resolve inverse problems. This algorithm executes a least-squared minimization between specified measurements and perturbation MC reflectance estimates to find tissue optical properties that would provide an MC prediction that best matches the measurement data.</p>
      <p>Bundled with the downloadable MCCL zip file are MATLAB/Octave scripts to run inverse solutions on Linux, Windows, and Mac. Currently, MATLAB interop code to run inverse solutions is available on Windows only. We developed custom scripts that provide inverse solutions using pMC and dMC without using the interop code. Three examples of inverse solutions are provided in “<monospace>mc_inverse.m</monospace>”. The basic steps performed in the script are to: (1) create an input file that will generate a baseline database, (2) run that input file with MCCL, and (3) run an optimization algorithm using MATLAB “<monospace>lsqcurvefit</monospace>” or “<monospace>fminsearch</monospace>” for users that do not have access to the MATLAB Optimization Toolbox or are using Octave. The optimization algorithm requires a script that provides: (a) forward estimates for the updated parameters to be fit determined by pMC, and (b) the Jacobian of those estimates determined by dMC, both of which are generated by post-processing the database from the baseline simulation. A spectral database spreadsheet is included in the zip, “<monospace>SpectralDictionary.xlsx</monospace>”, that provides the spectra for oxyhemoglobin, deoxyhemoglobin,<xref rid="r30" ref-type="bibr"><sup>30</sup></xref> and water.<xref rid="r31" ref-type="bibr"><sup>31</sup></xref> The examples in “<monospace>mc_inverse.m</monospace>” include sample code to generate an inverse solution to (1) find <inline-formula><mml:math id="math92" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="math93" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> given spatially resolved measurements, (2) find absorber concentrations of <inline-formula><mml:math id="math94" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>HbO</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, Hb, and water across 6 wavelengths, and (3) find absorber concentrations of Hb and <inline-formula><mml:math id="math95" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>HbO</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and power law <inline-formula><mml:math id="math96" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mi>A</mml:mi><mml:msup><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> scatterer coefficients <inline-formula><mml:math id="math97" display="inline" overflow="scroll"><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="math98" display="inline" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:math></inline-formula> given four wavelengths.</p>
    </sec>
    <sec id="sec3.6">
      <label>3.6</label>
      <title>Validation and Comparison with MCML</title>
      <p>Validation of our MC simulation engine is difficult because no exact RTE solutions exist for 3D problems. One approach to ensure that the MC simulations provide estimates that solve the RTE, is to derive the estimators from the integral form of the RTE. In previous publications, we have provided formulations for the reflectance estimators that we use in MCCL utilizing either discrete or continuous absorption weighting.<xref rid="r14" ref-type="bibr"><sup>14</sup></xref><sup>,</sup><xref rid="r15" ref-type="bibr"><sup>15</sup></xref></p>
      <p>While an exact RTE solution to a 3D problem is not available, an analytic solution is available for the 1D slab problem with bidirectional scattering.<xref rid="r32" ref-type="bibr"><sup>32</sup></xref> We have embedded unit tests within our software that use Analog and CAW random walk processes with bidirectional scattering to determine the total diffuse reflectance, total absorbance and total diffuse reflectance in a 1D refractive index matched slab. Our unit tests determine the MCCL mean and second moment estimates of these three detectors and verify (a) that the means are within <inline-formula><mml:math id="math99" display="inline" overflow="scroll"><mml:mrow><mml:mn>3</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> of the respective analytic solutions, and (b) that the sum of these three detector tallies to 1. <xref rid="t004" ref-type="table">Table 4</xref> displays the estimates for diffuse reflectance, total absorption, and diffuse transmittance using CAW as <inline-formula><mml:math id="math100" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula> increases, compared to the analytic solution. We specified optical properties <inline-formula><mml:math id="math101" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mi>mm</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math102" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:mi>mm</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math103" display="inline" overflow="scroll"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.8</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="math104" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, and a 5-mm slab thickness. It is noteworthy that when <inline-formula><mml:math id="math105" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula> is increased by a factor of 100, the standard deviation reduces by a factor <inline-formula><mml:math id="math106" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">/</mml:mo><mml:msqrt><mml:mi>N</mml:mi></mml:msqrt><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> providing another decimal digit of accuracy.</p>
      <table-wrap position="float" id="t004">
        <label>Table 4</label>
        <caption>
          <p>Convergence to analytic solution as <inline-formula><mml:math id="math107" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula>, the number of photons launched, increases.</p>
        </caption>
        <!--OASIS TABLE HERE-->
        <table frame="hsides" rules="groups">
          <colgroup>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
          </colgroup>
          <thead>
            <tr>
              <th valign="top"> </th>
              <th valign="top">Analytical</th>
              <th colspan="3" valign="top">
                <inline-formula>
                  <mml:math id="math108" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>MCCL</mml:mi>
                      <mml:mo>±</mml:mo>
                      <mml:mn>1</mml:mn>
                      <mml:mi>σ</mml:mi>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
            </tr>
            <tr>
              <th> </th>
              <th>Solution</th>
              <th>
                <inline-formula>
                  <mml:math id="math109" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>N</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mn>10</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>2</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
              <th>
                <inline-formula>
                  <mml:math id="math110" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>N</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mn>10</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>4</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
              <th>
                <inline-formula>
                  <mml:math id="math111" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>N</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mn>10</mml:mn>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mn>6</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Diffuse reflectance</td>
              <td>0.68818</td>
              <td>
                <inline-formula>
                  <mml:math id="math112" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.69809</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.04365</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math113" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.68569</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.00422</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math114" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.68760</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.00044</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td>Absorption</td>
              <td>0.04780</td>
              <td>
                <inline-formula>
                  <mml:math id="math115" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.04930</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.00535</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math116" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.04771</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.00042</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math117" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.04781</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.00004</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td>Diffuse transmittance</td>
              <td>0.26402</td>
              <td>
                <inline-formula>
                  <mml:math id="math118" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.25262</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.04063</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math119" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.26660</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.00419</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math120" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.26459</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.00042</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>We have also compared simulation results provided by MCCL with those provided by MCML<xref rid="r5" ref-type="bibr"><sup>5</sup></xref> for the case of a two-layer tissue illuminated by an collimated beam source. We compare estimates of specular reflection, total diffuse reflectance, total absorbance, total transmittance, and spatially resolved reflectance and absorbed energy in cylindrical coordinates. To perform this comparison, we used an MCML sample infile that defines a two-layered tissue with optical properties shown in <xref rid="t005" ref-type="table">Table 5</xref>. The number of photons launched by MCCL and MCML is <inline-formula><mml:math id="math121" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. MCML utilizes RR with a threshold of 0.0001. We ran the MCCL simulations with RR with the same threshold and without RR.</p>
      <table-wrap position="float" id="t005">
        <label>Table 5</label>
        <caption>
          <p>Two-layer tissue optical properties used in comparison with MCML. Air is above tissue with <inline-formula><mml:math id="math122" display="inline" overflow="scroll"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1.0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
        </caption>
        <!--OASIS TABLE HERE-->
        <table frame="hsides" rules="groups">
          <colgroup>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
          </colgroup>
          <thead>
            <tr>
              <th valign="top">Layer</th>
              <th valign="top">Thickness (mm)</th>
              <th valign="top"><inline-formula><mml:math id="math123" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (/mm)</th>
              <th valign="top"><inline-formula><mml:math id="math124" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (/mm)</th>
              <th valign="top">
                <inline-formula>
                  <mml:math id="math125" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>g</mml:mi>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
              <th valign="top">
                <inline-formula>
                  <mml:math id="math126" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mi>n</mml:mi>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>0.1</td>
              <td>2</td>
              <td>20</td>
              <td>0.7</td>
              <td>1.3</td>
            </tr>
            <tr>
              <td>2</td>
              <td>
                <inline-formula>
                  <mml:math id="math127" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>∞</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>1</td>
              <td>20</td>
              <td>0.9</td>
              <td>1.4</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p><xref rid="t006" ref-type="table">Table 6</xref> gives the results comparing MCML and MCCL with <inline-formula><mml:math id="math128" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> errors provided for MCCL. <xref rid="f4" ref-type="fig">Figure 4</xref> shows the plots of spatially resolved reflectance in cylindrical coordinates, <inline-formula><mml:math id="math129" display="inline" overflow="scroll"><mml:mrow><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, with <inline-formula><mml:math id="math130" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> errors displayed for MCCL and the relative difference between the two plots. This comparison is documented on our MCCL GitHub wiki (<ext-link xlink:href="https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Validation-And-Comparison-With-MCML" ext-link-type="uri">https://github.com/VirtualPhotonics/Vts.MonteCarlo/wiki/MCCL-Validation-And-Comparison-With-MCML</ext-link>).</p>
      <table-wrap position="float" id="t006">
        <label>Table 6</label>
        <caption>
          <p>Comparison of single valued tallies obtained using MCCL versus MCML.</p>
        </caption>
        <!--OASIS TABLE HERE-->
        <table frame="hsides" rules="groups">
          <colgroup>
            <col/>
            <col/>
            <col/>
            <col/>
          </colgroup>
          <thead>
            <tr>
              <th valign="top">Tally</th>
              <th valign="top">MCML</th>
              <th valign="top">MCCL with <inline-formula><mml:math id="math131" display="inline" overflow="scroll"><mml:mrow><mml:mi>RR</mml:mi><mml:mo>±</mml:mo><mml:mn>1</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula></th>
              <th valign="top">MCCL without <inline-formula><mml:math id="math132" display="inline" overflow="scroll"><mml:mrow><mml:mi>RR</mml:mi><mml:mo>±</mml:mo><mml:mn>1</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Specular reflectance</td>
              <td>0.0170</td>
              <td>
                <inline-formula>
                  <mml:math id="math133" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.0171</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math134" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.0168</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td>Diffuse reflectance</td>
              <td>0.1050</td>
              <td>
                <inline-formula>
                  <mml:math id="math135" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.1049</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.0002</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math136" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.1046</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.0002</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td>Absorption</td>
              <td>0.8780</td>
              <td>
                <inline-formula>
                  <mml:math id="math137" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.8780</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.0002</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td>
                <inline-formula>
                  <mml:math id="math138" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>0.8786</mml:mn>
                      <mml:mo>±</mml:mo>
                      <mml:mn>0.0002</mml:mn>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td>Diffuse transmittance</td>
              <td>0.0</td>
              <td>0.0</td>
              <td>0.0</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <fig position="float" id="f4">
        <label>Fig. 4</label>
        <caption>
          <p>Comparison with MCML: plot of <inline-formula><mml:math id="math139" display="inline" overflow="scroll"><mml:mrow><mml:mi>R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> with RR turned on for both MCML and MCCL. One <inline-formula><mml:math id="math140" display="inline" overflow="scroll"><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> error bars for MCCL are smaller than symbols shown. The relative difference between the two results is plotted below.</p>
        </caption>
        <graphic xlink:href="JBO-027-083005-g004" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec id="sec4">
    <label>4</label>
    <title>Applications of MCCL</title>
    <p>MCCL has been used to solve a variety of problems which include solving inverse problems using perturbation and differential MC, analyzing photon momentum transfer relevant to speckle imaging of flow, and determining the relative efficacy of port wine stain treatment modalities.</p>
    <sec id="sec4.1">
      <label>4.1</label>
      <title>Inverse Solutions across Wavelength Using pMC/dMC</title>
      <p>The “<monospace>mc_inverse.m</monospace>” script described in Sec. <xref rid="sec3.5" ref-type="sec">3.5</xref> provides three examples of inverse solutions. The examples include solutions across wavelength to determine chromophore concentrations and/or scattering coefficients. <xref rid="f5" ref-type="fig">Figure 5</xref> shows the inverse solution results for Example 2 in “<monospace>mc_inverse.m</monospace>.” In this example, the inverse problem examined is the determination of concentrations of Hb, <inline-formula><mml:math id="math141" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>HbO</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="math142" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="normal">H</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi mathvariant="normal">O</mml:mi></mml:mrow></mml:math></inline-formula> given a set of measurements (Meas) at six wavelengths. The simulated measurements of reflectance as a function of wavelength were produced using a collimated source and scaled MC<xref rid="r33" ref-type="bibr"><sup>33</sup></xref> (red x’s). A database based on an initial guess (IG) of Hb (<inline-formula><mml:math id="math143" display="inline" overflow="scroll"><mml:mrow><mml:mn>70</mml:mn><mml:mtext>  </mml:mtext><mml:mi>μ</mml:mi><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:math></inline-formula>), <inline-formula><mml:math id="math144" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>HbO</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="math145" display="inline" overflow="scroll"><mml:mrow><mml:mn>30</mml:mn><mml:mtext>  </mml:mtext><mml:mi>μ</mml:mi><mml:mi mathvariant="normal">M</mml:mi></mml:mrow></mml:math></inline-formula>), and <inline-formula><mml:math id="math146" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="normal">H</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi mathvariant="normal">O</mml:mi></mml:mrow></mml:math></inline-formula> (80% volume fraction) was generated using <inline-formula><mml:math id="math147" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> photons. The algorithm generates derivatives of reflectance with respect to these chromophores to update this guess using a gradient-based optimization that minimizes the difference between the simulated measurements and perturbation MC estimates of the updated concentrations. After running the inverse solution the output at the conclusion of the inverse solution shows the actual concentrations of Hb, <inline-formula><mml:math id="math148" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>HbO</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="math149" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi mathvariant="normal">H</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi mathvariant="normal">O</mml:mi></mml:mrow></mml:math></inline-formula> that were used to generate the simulated measurements (Meas), the IG, and the value of <inline-formula><mml:math id="math150" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi>χ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> at these values, the converged values of concentrations (Conv) and the associated <inline-formula><mml:math id="math151" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi>χ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> value, and the error in the converged value compared to the actual.<xref rid="r34" ref-type="bibr"><sup>34</sup></xref></p>
      <fig position="float" id="f5">
        <label>Fig. 5</label>
        <caption>
          <p>Inverse solution results produced by running mc_inverse.m using <inline-formula><mml:math id="math152" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> photons to determine chromophore concentrations across 6 wavelengths (Example 2 in “mc_inverse.m”).</p>
        </caption>
        <graphic xlink:href="JBO-027-083005-g005" position="float"/>
      </fig>
      <p>
        <monospace>Meas = [72.000 35.000 0.600]</monospace>
      </p>
      <p>
        <monospace>IG = [70.000 30.000 0.800] Chi2=4.946e-06</monospace>
      </p>
      <p>
        <monospace>Conv = [75.468 35.707 0.620] Chi2=2.159e-07</monospace>
      </p>
      <p>
        <monospace>error= [0.048 0.020 0.033]</monospace>
      </p>
      <p>These results show that the simulation of <inline-formula><mml:math id="math153" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> photons and six wavelengths is sufficient to provide an inverse solution using pMC and dMC with estimates of the actual chromophore concentrations with errors of <inline-formula><mml:math id="math154" display="inline" overflow="scroll"><mml:mrow><mml:mo form="prefix">&lt;</mml:mo><mml:mn>5</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec id="sec4.2">
      <label>4.2</label>
      <title>Momentum Transfer Analysis</title>
      <p>A multilayered tissue model was used to study the spectral and depth dependence of speckle contrast.<xref rid="r16" ref-type="bibr"><sup>16</sup></xref><sup>,</sup><xref rid="r35" ref-type="bibr"><sup>35</sup></xref><sup>,</sup><xref rid="r36" ref-type="bibr"><sup>36</sup></xref> Dunn et al.<xref rid="r35" ref-type="bibr"><sup>35</sup></xref> used MC momentum transfer detectors to compare speckleplethysmographic (SPG) with photoplethysmographic (PPG) imaging with <italic>in vivo</italic> measurements. The MC model consisted of a flat source, sufficiently broad to avoid edge effects, illuminating an eight-layer tissue model (epidermis, papillary dermis, upper blood net, reticular dermis, lower blood net, lipid, arterial layer, and lipid) using optical properties at wavelengths 532, 660, and 860 nm, and discrete absorption weighting. Dynamic momentum transfer detectors were utilized that allow the user to specify the blood volume fraction in each tissue region (<monospace>ReflectedDynamicMTOfXAndYAndSubregionHistDetector</monospace>). At each photon collision, the detector uses a uniformly distributed random number and compares it to the blood fraction of the region where the collision occurred to determine if the photon hit blood, and if so, tally to the momentum transfer for that region. MC simulations were executed on systems with the arterial layer expanded due to increased flow speed and contracted to simulate the pulsatility of arteries during systole and diastole, respectively, while compressing the upper and lower blood net layers accordingly to maintain a total thickness of 10 mm. The flow speed was varied within a range consistent with arterioles and capillaries. The MC detector estimates generate a probability distribution of momentum transfer that was used within a theoretical model to calculate speckle contrast using the correlation function. <xref rid="f6" ref-type="fig">Figure 6(a)</xref> shows the SPG and PPG measurements taken from four subjects, and <xref rid="f6" ref-type="fig">Fig. 6(b)</xref> comparison of the <italic>in vivo</italic> estimates with the <italic>in silico</italic> estimates provided by MC, which indicate good agreement.</p>
      <fig position="float" id="f6">
        <label>Fig. 6</label>
        <caption>
          <p>(a) NIR SPG, green SPG, and green PPG amplitude percentages from four subjects and (b) the MC estimates of the amplitude percent ranges (<italic>in silico</italic>) compared to the corresponding values across the subjects. Reprinted with permission from Ref. <xref rid="r35" ref-type="bibr">35</xref> © The Optical Society.</p>
        </caption>
        <graphic xlink:href="JBO-027-083005-g006" position="float"/>
      </fig>
    </sec>
    <sec id="sec4.3">
      <label>4.3</label>
      <title>Tissue Treatment Modality Comparison</title>
      <p>The efficacy of intense pulsed light (IPL) to treat port wine stains using a broadband light spectrum approach compared to single wavelength (595 nm) pulsed dye laser (PDL) irradiation, was studied using MC estimates of absorbed energy in a vessel embedded in the hypodermis.<xref rid="r37" ref-type="bibr"><sup>37</sup></xref> Measurements were taken on an animal with a custom window chamber holder illuminated from the epidermal side with either the IPL or PDL. The MC model consisted of a flat circular source illuminating a four-layer system (skin, hypodermis, water and glass) with a vessel embedded in the hypodermis layer. An absorbed energy detector in Cartesian coordinates (<monospace>AOfXAndYAndZDetector</monospace>) and DAW were specified for the simulations which tallied deposited absorbed energy at each collision within a voxelized grid. For each simulation, <inline-formula><mml:math id="math155" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> photons were launched which ensured that the relative errors were <inline-formula><mml:math id="math156" display="inline" overflow="scroll"><mml:mrow><mml:mo form="prefix">&lt;</mml:mo><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p><xref rid="f7" ref-type="fig">Figure 7(a)</xref> shows the absorbed energy deposition for the wavelengths that comprise the IPL treatment, <xref rid="f7" ref-type="fig">Fig. 7(b)</xref> the PDL versus IPL composite absorbed energy maps, and <xref rid="f7" ref-type="fig">Fig. 7(c)</xref> a line profile along depth (<inline-formula><mml:math id="math157" display="inline" overflow="scroll"><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:math></inline-formula>) with <inline-formula><mml:math id="math158" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> errorbars. These results indicate that the combined total absorbed energy induced by the IPL is higher compared to that of the PDL in the top half of the vessel. This result is consistent with experiments that showed the efficacy of IPL treatments to produce persistent vascular shutdown compared to PDL treatments.</p>
      <fig position="float" id="f7">
        <label>Fig. 7</label>
        <caption>
          <p>(a) Absorbed energy maps of a vessel over 500- to 600-nm range, (b) comparison of PDL and composite IPL, (c) line profile of absorbed energy distribution with <inline-formula><mml:math id="math159" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></inline-formula> error bars. Reprinted with permission from Ref. <xref rid="r37" ref-type="bibr">37</xref> © John Wiley and Sons.</p>
        </caption>
        <graphic xlink:href="JBO-027-083005-g007" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec id="sec5">
    <label>5</label>
    <title>Future Implementations</title>
    <p>All software developed by the Virtual Photonics team is licensed under the MIT License and all repositories are on GitHub. Contributions are welcome. Any issues with our software can be described on the “Issues” tabs. We also have a Google Groups site (<ext-link xlink:href="https://groups.google.com/g/virtual-photonics" ext-link-type="uri">https://groups.google.com/g/virtual-photonics</ext-link>) where anyone can post questions or comments.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>We acknowledge support from the National Institutes of Health (Grant Nos. P41-EB015890, K25-EB007309, R25-GM103818, and R21-GM128135) and the National Science Foundation (Grant No. CBET-1805082).</p>
  </ack>
  <bio id="b1">
    <p><bold>Carole K. Hayakawa</bold> is an assistant project scientist at the University of California, Irvine. She received her BA degree in applied mathematics from the University of California, Berkeley, her MA degree in mathematics from the University of California, Los Angeles, and her PhD in applied mathematics from Claremont Graduate University.</p>
  </bio>
  <bio id="b2">
    <p><bold>Lisa Malenfant</bold> is a specialist at the University of California (UC), Irvine. She received her BSc degree in computing science from Staffordshire University, United Kingdom. She has over 20 years of experience developing and managing web, cloud, and development projects across many industries and disciplines.</p>
  </bio>
  <bio id="b3">
    <p><bold>Janaka Ranasinghesagara</bold> is an associate specialist at the University of California, Irvine. He received his BSc (Eng) degree in electrical engineering from the University of Moratuwa, Sri Lanka, his MS degree in electrical engineering from California State University, Long Beach, and his PhD in biological engineering from the University of Missouri, Columbia. His research interests include modeling light propagation in isotropic and anisotropic tissues in microscopic and mesoscopic scales.</p>
  </bio>
  <bio id="b4">
    <p><bold>David J. Cuccia</bold> is an internationally recognized pioneer and leader in the field of spatial frequency domain imaging (SFDI). He has successfully secured over $6.5 million in SBIR/STTR grants that facilitated the development of Ox-Imager<sup>®</sup> technology, and has six patents to his name, and 40 coauthored SFDI publications.</p>
  </bio>
  <bio id="b5">
    <p><bold>Jerome Spanier</bold> is a faculty researcher at the University of California, Irvine. He completed his BS degree in mathematics at the University of Minnesota, in 1951, and his MS and PhD degrees in mathematics at the University of Chicago, in 1952 and 1955, respectively. Following 16 years in industry, he accepted a professorship at The Claremont Graduate School before moving to UCI in 2000. His research centers on modeling light/tissue interactions using both stochastic and deterministic numerical methods.</p>
  </bio>
  <bio id="b6">
    <p><bold>Vasan Venugopalan</bold> is professor and chair of the Department of Chemical and Biomolecular Engineering at UC Irvine and jointly appointed at the Beckman Laser Institute. He received his undergraduate degree from UC Berkeley and doctoral degree from MIT, both in mechanical engineering. His research interests lie in modeling and computation of light propagation in cells and tissues as well as the integration of pulsed laser microbeams with non-linear microscopy to study cellular mechanotransduction.</p>
  </bio>
  <notes notes-type="conflict-of-interest">
    <title>Disclosures</title>
    <p>The authors have no conflicts of interest.</p>
  </notes>
  <ref-list>
    <title>References</title>
    <ref id="r1">
      <label>1.</label>
      <mixed-citation publication-type="webpage"><person-group person-group-type="editor"><name><surname>Werner</surname><given-names>C. J.</given-names></name></person-group>, Ed., “<article-title>MCNP users manual - code version 6.2</article-title>,” <year>2017</year>, <ext-link xlink:href="https://mcnp.lanl.gov" ext-link-type="uri">https://mcnp.lanl.gov</ext-link> (accessed 22 March 2022).</mixed-citation>
    </ref>
    <ref id="r2">
      <label>2.</label>
      <mixed-citation publication-type="book"><collab>X-5 Monte Carlo Team</collab>, “<article-title>MCNP, a general Monte Carlo N-particle transport code, version 5, report LA-UR-03-1987</article-title>,” Tech. Rep. LA-UR-03-1987, <publisher-name>Los Alamos National Laboratory</publisher-name> (<year>2003</year>).</mixed-citation>
    </ref>
    <ref id="r3">
      <label>3.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilson</surname><given-names>B. C.</given-names></name><name><surname>Adam</surname><given-names>G.</given-names></name></person-group>, “<article-title>A Monte Carlo model for the absorption and flux distributions of light in tissue</article-title>,” <source>Med. Phys.</source>
<volume>10</volume>(<issue>6</issue>), <fpage>824</fpage>–<lpage>830</lpage> (<year>1983</year>).<pub-id pub-id-type="coden">MPHYA6</pub-id><issn>0094-2405</issn><pub-id pub-id-type="doi">10.1118/1.595361</pub-id><pub-id pub-id-type="pmid">6656695</pub-id></mixed-citation>
    </ref>
    <ref id="r4">
      <label>4.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Prahl</surname><given-names>S.</given-names></name><etal>et al.</etal></person-group>, “<article-title>A Monte Carlo model of light propagation in tissue</article-title>,” <source>Proc. SPIE</source>
<volume>10305</volume>, <fpage>1030509</fpage> (<year>1989</year>).<pub-id pub-id-type="coden">PSISDG</pub-id><issn>0277-786X</issn><pub-id pub-id-type="doi">10.1117/12.2283590</pub-id></mixed-citation>
    </ref>
    <ref id="r5">
      <label>5.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>L.</given-names></name><name><surname>Jacques</surname><given-names>S. L.</given-names></name><name><surname>Zheng</surname><given-names>L.</given-names></name></person-group>, “<article-title>MCML-Monte Carlo modeling of light transport in multi-layered tissues</article-title>,” <source>Comput. Methods Programs Biomed.</source>
<volume>47</volume>(<issue>2</issue>), <fpage>131</fpage>–<lpage>146</lpage> (<year>1995</year>).<pub-id pub-id-type="coden">CMPBEK</pub-id><issn>0169-2607</issn><pub-id pub-id-type="doi">10.1016/0169-2607(95)01640-F</pub-id><pub-id pub-id-type="pmid">7587160</pub-id></mixed-citation>
    </ref>
    <ref id="r6">
      <label>6.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hayakawa</surname><given-names>C. K.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Perturbation Monte Carlo methods to solve inverse photon migration problems in heterogeneous tissues</article-title>,” <source>Opt. Lett.</source>
<volume>26</volume>(<issue>17</issue>), <fpage>1335</fpage>–<lpage>1337</lpage> (<year>2001</year>).<pub-id pub-id-type="coden">OPLEDP</pub-id><issn>0146-9592</issn><pub-id pub-id-type="doi">10.1364/OL.26.001335</pub-id><pub-id pub-id-type="pmid">18049600</pub-id></mixed-citation>
    </ref>
    <ref id="r7">
      <label>7.</label>
      <mixed-citation publication-type="thesis"><person-group person-group-type="author"><name><surname>Hayakawa</surname><given-names>C. K.</given-names></name></person-group>, <article-title>Perturbation Monte Carlo methods for the solution of inverse problems</article-title>,” PhD Thesis, <institution>Claremont Graduate University</institution> (<year>2002</year>).</mixed-citation>
    </ref>
    <ref id="r8">
      <label>8.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Matsumoto</surname><given-names>M.</given-names></name><name><surname>Nishimura</surname><given-names>T.</given-names></name></person-group>, “<article-title>Mersenne twister: a 623-dimensionally equidistributed uniform pseudo-random number generator</article-title>,” <source>ACM Trans. Model. Comput. Sci.</source>
<volume>8</volume>(<issue>1</issue>), <fpage>3</fpage>–<lpage>30</lpage> (<year>1998</year>).<pub-id pub-id-type="doi">10.1145/272991.272995</pub-id></mixed-citation>
    </ref>
    <ref id="r9">
      <label>9.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Matsumoto</surname><given-names>M.</given-names></name><name><surname>Nishimura</surname><given-names>T.</given-names></name></person-group>, “<article-title>Dynamic creation of pseudorandom number generators</article-title>,” in <source>Monte Carlo and Quasi-Monte Carlo Methods 1998</source>, <person-group person-group-type="editor"><name><surname>Niederreiter</surname><given-names>H.</given-names></name><name><surname>Spanier</surname><given-names>J.</given-names></name></person-group>, Eds., pp. <fpage>56</fpage>–<lpage>69</lpage>, <publisher-name>Springer</publisher-name>, <publisher-loc>Berlin, Heidelberg</publisher-loc> (<year>1998</year>).</mixed-citation>
    </ref>
    <ref id="r10">
      <label>10.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Binzoni</surname><given-names>T.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Light transport in tissue by 3D Monte Carlo: influece of boundary voxelization</article-title>,” <source>Comput. Methods Programs Biomed.</source>
<volume>89</volume>(<issue>1</issue>), <fpage>14</fpage>–<lpage>23</lpage> (<year>2008</year>).<pub-id pub-id-type="coden">CMPBEK</pub-id><issn>0169-2607</issn><pub-id pub-id-type="doi">10.1016/j.cmpb.2007.10.008</pub-id><pub-id pub-id-type="pmid">18045725</pub-id></mixed-citation>
    </ref>
    <ref id="r11">
      <label>11.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fang</surname><given-names>Q.</given-names></name><name><surname>Boas</surname><given-names>D. A.</given-names></name></person-group>, “<article-title>Monte Carlo simulation of photon migration in 3D turbid media accelerated by graphics processing units</article-title>,” <source>Opt. Express</source>
<volume>17</volume>(<issue>22</issue>), <fpage>20178</fpage>–<lpage>20190</lpage> (<year>2009</year>).<pub-id pub-id-type="coden">OPEXFF</pub-id><issn>1094-4087</issn><pub-id pub-id-type="doi">10.1364/OE.17.020178</pub-id><pub-id pub-id-type="pmid">19997242</pub-id></mixed-citation>
    </ref>
    <ref id="r12">
      <label>12.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shen</surname><given-names>H.</given-names></name><name><surname>Wang</surname><given-names>G.</given-names></name></person-group>, “<article-title>A tetrahedron-based inhomogeneous Monte Carlo optical simulator</article-title>,” <source>Phys. Med. Biol.</source>
<volume>55</volume>(<issue>4</issue>), <fpage>947</fpage>–<lpage>962</lpage> (<year>2010</year>).<pub-id pub-id-type="coden">PHMBA7</pub-id><issn>0031-9155</issn><pub-id pub-id-type="doi">10.1088/0031-9155/55/4/003</pub-id><pub-id pub-id-type="pmid">20090182</pub-id></mixed-citation>
    </ref>
    <ref id="r13">
      <label>13.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fang</surname><given-names>Q.</given-names></name><name><surname>Kaeli</surname><given-names>D.</given-names></name></person-group>, “<article-title>Accelerating mesh-based Monte Carlo method on modern cpu architectures</article-title>,” <source>Biomed. Opt. Express</source>
<volume>3</volume>(<issue>12</issue>), <fpage>3223</fpage>–<lpage>3230</lpage> (<year>2012</year>).<pub-id pub-id-type="coden">BOEICL</pub-id><issn>2156-7085</issn><pub-id pub-id-type="doi">10.1364/BOE.3.003223</pub-id><pub-id pub-id-type="pmid">23243572</pub-id></mixed-citation>
    </ref>
    <ref id="r14">
      <label>14.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Spanier</surname><given-names>J.</given-names></name><name><surname>Gelbard</surname><given-names>E.</given-names></name></person-group>, <source>Monte Carlo Principles and Neutron Transport Problems</source>, Addison-Wesley, 1969, reprinted by <publisher-name>Dover Publications, Inc.</publisher-name>, <publisher-loc>Mineola, New York</publisher-loc> (<year>2008</year>).</mixed-citation>
    </ref>
    <ref id="r15">
      <label>15.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hayakawa</surname><given-names>C. K.</given-names></name><name><surname>Spanier</surname><given-names>J.</given-names></name><name><surname>Venugopalan</surname><given-names>V.</given-names></name></person-group>, “<article-title>Comparative analysis of discrete and continuous absorption weighting estimators used in Monte Carlo simulations of radiative transport in turbid media</article-title>,” <source>J. Opt. Soc. Am. A</source>
<volume>31</volume>(<issue>2</issue>), <fpage>301</fpage>–<lpage>311</lpage> (<year>2014</year>).<pub-id pub-id-type="coden">JOAOD6</pub-id><issn>0740-3232</issn><pub-id pub-id-type="doi">10.1364/JOSAA.31.000301</pub-id></mixed-citation>
    </ref>
    <ref id="r16">
      <label>16.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rice</surname><given-names>T. B.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Quantitative, depth-resolved determination of particle motion using multi-exposure, spatial frequency domain laser speckle imaging</article-title>,” <source>Biomed. Opt. Express</source>
<volume>4</volume>(<issue>12</issue>), <fpage>2880</fpage>–<lpage>2892</lpage> (<year>2013</year>).<pub-id pub-id-type="coden">BOEICL</pub-id><issn>2156-7085</issn><pub-id pub-id-type="doi">10.1364/BOE.4.002880</pub-id><pub-id pub-id-type="pmid">24409388</pub-id></mixed-citation>
    </ref>
    <ref id="r17">
      <label>17.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gardner</surname><given-names>A. R.</given-names></name><name><surname>Venugopalan</surname><given-names>V.</given-names></name></person-group>, “<article-title>Accurate and efficient Monte Carlo solutions to the radiative transport equation in the spatial frequency domain</article-title>,” <source>Optics Lett.</source>
<volume>36</volume>(<issue>12</issue>), <fpage>2269</fpage>–<lpage>71</lpage> (<year>2011</year>).<pub-id pub-id-type="coden">OPLEDP</pub-id><issn>0146-9592</issn><pub-id pub-id-type="doi">10.1364/OL.36.002269</pub-id></mixed-citation>
    </ref>
    <ref id="r18">
      <label>18.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Testorf</surname><given-names>M.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Sampling of time- and frequency-domain signals in Monte Carlo simulations of photon migration</article-title>,” <source>Appl. Opt.</source>
<volume>38</volume>, <fpage>236</fpage>–<lpage>245</lpage> (<year>1999</year>).<pub-id pub-id-type="coden">APOPAI</pub-id><issn>0003-6935</issn><pub-id pub-id-type="doi">10.1364/AO.38.000236</pub-id><pub-id pub-id-type="pmid">18305609</pub-id></mixed-citation>
    </ref>
    <ref id="r19">
      <label>19.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rief</surname><given-names>H.</given-names></name></person-group>, “<article-title>A synopsis of Monte Carlo perturbation algorithms</article-title>,” <source>J. Comput. Phys.</source>
<volume>111</volume>(<issue>1</issue>), <fpage>33</fpage>–<lpage>48</lpage> (<year>1994</year>).<pub-id pub-id-type="coden">JCTPAH</pub-id><issn>0021-9991</issn><pub-id pub-id-type="doi">10.1006/jcph.1994.1041</pub-id></mixed-citation>
    </ref>
    <ref id="r20">
      <label>20.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Billingsley</surname><given-names>P.</given-names></name></person-group>, <source>Probability and Measure</source>, <publisher-name>John Wiley and Sons</publisher-name>, <publisher-loc>New York</publisher-loc> (<year>1979</year>).</mixed-citation>
    </ref>
    <ref id="r21">
      <label>21.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sassaroli</surname><given-names>A.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Monte Carlo procedure for investigating light propagation and imaging of highly scattering media</article-title>,” <source>Appl. Opt.</source>
<volume>37</volume>(<issue>31</issue>), <fpage>7392</fpage>–<lpage>7400</lpage> (<year>1998</year>).<pub-id pub-id-type="coden">APOPAI</pub-id><issn>0003-6935</issn><pub-id pub-id-type="doi">10.1364/AO.37.007392</pub-id><pub-id pub-id-type="pmid">18301573</pub-id></mixed-citation>
    </ref>
    <ref id="r22">
      <label>22.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kumar</surname><given-names>Y. P.</given-names></name><name><surname>Vasu</surname><given-names>R. M.</given-names></name></person-group>, “<article-title>Reconstruction of optical properties of low-scattering tissue using derivative estimated through perturbation Monte-Carlo method</article-title>,” <source>J. Biomed. Opt.</source>
<volume>9</volume>(<issue>5</issue>), <fpage>1002</fpage>–<lpage>1012</lpage> (<year>2004</year>).<pub-id pub-id-type="coden">JBOPFO</pub-id><issn>1083-3668</issn><pub-id pub-id-type="doi">10.1117/1.1778733</pub-id><pub-id pub-id-type="pmid">15447022</pub-id></mixed-citation>
    </ref>
    <ref id="r23">
      <label>23.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yalavarthy</surname><given-names>P. K.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Experimental investigation of perturbation Monte-Carlo based derivative estimation for imaging low-scattering tissue</article-title>,” <source>Opt. Express</source>
<volume>13</volume>(<issue>3</issue>), <fpage>985</fpage>–<lpage>997</lpage> (<year>2005</year>).<pub-id pub-id-type="coden">OPEXFF</pub-id><issn>1094-4087</issn><pub-id pub-id-type="doi">10.1364/OPEX.13.000985</pub-id><pub-id pub-id-type="pmid">19494962</pub-id></mixed-citation>
    </ref>
    <ref id="r24">
      <label>24.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seo</surname><given-names>I.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Perturbation and differential Monte Carlo methods for measurement of optical properties in a layered epithelial tissue model</article-title>,” <source>J. Biomed. Opt.</source>
<volume>12</volume>(<issue>1</issue>), <fpage>014030</fpage> (<year>2007</year>).<pub-id pub-id-type="coden">JBOPFO</pub-id><issn>1083-3668</issn><pub-id pub-id-type="doi">10.1117/1.2697735</pub-id><pub-id pub-id-type="pmid">17343505</pub-id></mixed-citation>
    </ref>
    <ref id="r25">
      <label>25.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>J.</given-names></name><name><surname>Intes</surname><given-names>X.</given-names></name></person-group>, “<article-title>Time-gated perturbation Monte Carlo for whole body functional imaging in small animals</article-title>,” <source>Opt. Express</source>
<volume>17</volume>(<issue>22</issue>), <fpage>19566</fpage>–<lpage>79</lpage> (<year>2009</year>).<pub-id pub-id-type="coden">OPEXFF</pub-id><issn>1094-4087</issn><pub-id pub-id-type="doi">10.1364/OE.17.019566</pub-id><pub-id pub-id-type="pmid">19997176</pub-id></mixed-citation>
    </ref>
    <ref id="r26">
      <label>26.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heiskala</surname><given-names>J.</given-names></name><name><surname>Hiltunen</surname><given-names>P.</given-names></name><name><surname>Nissila</surname><given-names>I.</given-names></name></person-group>, “<article-title>Significance of background optical properties, time-resolved information and optode arrangement in diffuse optical imaging of term neonates</article-title>,” <source>Phys. Med. Bio.</source>
<volume>54</volume>(<issue>3</issue>), <fpage>535</fpage>–<lpage>554</lpage> (<year>2009</year>).<pub-id pub-id-type="coden">PHMBA7</pub-id><issn>0031-9155</issn><pub-id pub-id-type="doi">10.1088/0031-9155/54/3/005</pub-id><pub-id pub-id-type="pmid">19124950</pub-id></mixed-citation>
    </ref>
    <ref id="r27">
      <label>27.</label>
      <mixed-citation publication-type="webpage"><collab>MathWorks</collab>, “<article-title>MATLAB R2019a</article-title>,” <year>2019</year>, <ext-link xlink:href="https://www.mathworks.com/products/matlab.html" ext-link-type="uri">https://www.mathworks.com/products/matlab.html</ext-link> (accessed 22 March 2022).</mixed-citation>
    </ref>
    <ref id="r28">
      <label>28.</label>
      <mixed-citation publication-type="webpage"><collab>GNU</collab>, “<article-title>GNU Octave 5.2.0</article-title>,” <year>2020</year>, <ext-link xlink:href="https://www.gnu.org/software/octave/index" ext-link-type="uri">https://www.gnu.org/software/octave/index</ext-link> (accessed 22 March 2022).</mixed-citation>
    </ref>
    <ref id="r29">
      <label>29.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Henyey</surname><given-names>L. G.</given-names></name><name><surname>Greenstein</surname><given-names>J. L.</given-names></name></person-group>, “<article-title>Diffuse radiation in the galaxy</article-title>,” <source>Astrophys. J.</source>
<volume>93</volume>, <fpage>70</fpage>–<lpage>83</lpage> (<year>1941</year>).<pub-id pub-id-type="coden">ASJOAB</pub-id><issn>0004-637X</issn><pub-id pub-id-type="doi">10.1086/144246</pub-id></mixed-citation>
    </ref>
    <ref id="r30">
      <label>30.</label>
      <mixed-citation publication-type="webpage"><person-group person-group-type="author"><name><surname>Prahl</surname><given-names>S.</given-names></name></person-group>, “<article-title>Tabulated molar extinction coefficient for hemoglobin in water</article-title>,” <year>1998</year>, <ext-link xlink:href="https://omlc.org/spectra/hemoglobin/summary.html" ext-link-type="uri">https://omlc.org/spectra/hemoglobin/summary.html</ext-link> (accessed 22 March 2022).</mixed-citation>
    </ref>
    <ref id="r31">
      <label>31.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hale</surname><given-names>G. M.</given-names></name><name><surname>Querry</surname><given-names>M. R.</given-names></name></person-group>, “<article-title>Optical constants of water in the 200-nm to <inline-formula><mml:math id="math160" display="inline" overflow="scroll"><mml:mrow><mml:mn>200</mml:mn><mml:mtext>-</mml:mtext><mml:mi>μ</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mrow></mml:math></inline-formula> wavelength region</article-title>,” <source>Appl. Opt.</source>
<volume>12</volume>(<issue>3</issue>), <fpage>555</fpage>–<lpage>563</lpage> (<year>1973</year>).<pub-id pub-id-type="coden">APOPAI</pub-id><issn>0003-6935</issn><pub-id pub-id-type="doi">10.1364/AO.12.000555</pub-id><pub-id pub-id-type="pmid">20125343</pub-id></mixed-citation>
    </ref>
    <ref id="r32">
      <label>32.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Welch</surname><given-names>A. J.</given-names></name><name><surname>van Gemert</surname><given-names>M.</given-names></name></person-group>, <source>Optical-Thermal Response of Laser-Irradiated Tissue</source>, <publisher-name>Plenum Press</publisher-name>, <publisher-loc>New York</publisher-loc> (<year>1995</year>).</mixed-citation>
    </ref>
    <ref id="r33">
      <label>33.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martinelli</surname><given-names>M.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Analysis of single Monte Carlo methods for prediction of reflectance from turbid media</article-title>,” <source>Opt. Express</source>
<volume>19</volume>(<issue>20</issue>), <fpage>19627</fpage>–<lpage>42</lpage> (<year>2011</year>).<pub-id pub-id-type="coden">OPEXFF</pub-id><issn>1094-4087</issn><pub-id pub-id-type="doi">10.1364/OE.19.019627</pub-id><pub-id pub-id-type="pmid">21996904</pub-id></mixed-citation>
    </ref>
    <ref id="r34">
      <label>34.</label>
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Press</surname><given-names>W. H.</given-names></name><etal>et al.</etal></person-group>, <source>Numerical Recipes in C: The Art of Scientific Computing</source>, <publisher-name>Cambridge University Press</publisher-name>, <publisher-loc>New York</publisher-loc> (<year>1988</year>).</mixed-citation>
    </ref>
    <ref id="r35">
      <label>35.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dunn</surname><given-names>C.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Comparison of speckleplethysmographic (SPG) and photoplethysmorgraphic (PPG) imaging by Monte Carlo simulations and in vivo measurements</article-title>,” <source>Biomed. Opt. Express</source>
<volume>9</volume>(<issue>9</issue>), <fpage>4306</fpage>–<lpage>16</lpage> (<year>2018</year>).<pub-id pub-id-type="coden">BOEICL</pub-id><issn>2156-7085</issn><pub-id pub-id-type="doi">10.1364/BOE.9.004306</pub-id><pub-id pub-id-type="pmid">30615714</pub-id></mixed-citation>
    </ref>
    <ref id="r36">
      <label>36.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Regan</surname><given-names>C.</given-names></name><name><surname>Hayakawa</surname><given-names>C. K.</given-names></name><name><surname>Choi</surname><given-names>B.</given-names></name></person-group>, “<article-title>Momentum transfer Monte Carlo for the simulation of laser speckle imaging and its application in the skin</article-title>,” <source>Biomed. Opt. Express</source>
<volume>8</volume>(<issue>12</issue>), <fpage>5708</fpage>–<lpage>5723</lpage> (<year>2017</year>).<pub-id pub-id-type="coden">BOEICL</pub-id><issn>2156-7085</issn><pub-id pub-id-type="doi">10.1364/BOE.8.005708</pub-id><pub-id pub-id-type="pmid">29296499</pub-id></mixed-citation>
    </ref>
    <ref id="r37">
      <label>37.</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moy</surname><given-names>W.</given-names></name><etal>et al.</etal></person-group>, “<article-title>Targeted narrowband intense pulsed light on cutaneous vasculature</article-title>,” <source>Lasers Surg. Med.</source>
<volume>47</volume>(<issue>8</issue>), <fpage>651</fpage>–<lpage>657</lpage> (<year>2015</year>).<pub-id pub-id-type="coden">LSMEDI</pub-id><issn>0196-8092</issn><pub-id pub-id-type="doi">10.1002/lsm.22393</pub-id><pub-id pub-id-type="pmid">26227344</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
