<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Acta Crystallogr D Biol Crystallogr</journal-id>
    <journal-id journal-id-type="publisher-id">Acta Cryst. D</journal-id>
    <journal-title-group>
      <journal-title>Acta Crystallographica Section D: Biological Crystallography</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">0907-4449</issn>
    <issn pub-type="epub">1399-0047</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3069751</article-id>
    <article-id pub-id-type="publisher-id">ba5152</article-id>
    <article-id pub-id-type="doi">10.1107/S0907444911001314</article-id>
    <article-id pub-id-type="coden">ABCRE6</article-id>
    <article-id pub-id-type="pii">S0907444911001314</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Papers</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>REFMAC</italic>5 for the refinement of macromolecular crystal structures</article-title>
      <alt-title>Refinement with <italic>REFMAC</italic>5</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Murshudov</surname>
          <given-names>Garib N.</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Skubák</surname>
          <given-names>Pavol</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lebedev</surname>
          <given-names>Andrey A.</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pannu</surname>
          <given-names>Navraj S.</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Steiner</surname>
          <given-names>Roberto A.</given-names>
        </name>
        <xref ref-type="aff" rid="c">c</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nicholls</surname>
          <given-names>Robert A.</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Winn</surname>
          <given-names>Martyn D.</given-names>
        </name>
        <xref ref-type="aff" rid="d">d</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Long</surname>
          <given-names>Fei</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Vagin</surname>
          <given-names>Alexei A.</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <aff id="a"><label>a</label>Structural Biology Laboratory, Department of Chemistry, University of York, Heslington, York YO10 5YW, <country>England</country></aff>
      <aff id="b"><label>b</label>Biophysical Structural Chemistry, Leiden University, PO Box 9502, 2300 RA Leiden, <country>The Netherlands</country></aff>
      <aff id="c"><label>c</label>Randall Division of Cell and Molecular Biophysics, New Hunt’s House, King’s College London, London, <country>England</country></aff>
      <aff id="d"><label>d</label>STFC Daresbury Laboratory, Warrington WA4 4AD, <country>England</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>garib@ysbl.york.ac.uk</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>4</month>
      <year>2011</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>3</month>
      <year>2011</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>18</day>
      <month>3</month>
      <year>2011</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>67</volume>
    <issue>Pt 4</issue>
    <issue-id pub-id-type="publisher-id">d110400</issue-id>
    <fpage>355</fpage>
    <lpage>367</lpage>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>7</month>
        <year>2010</year>
      </date>
      <date date-type="accepted">
        <day>10</day>
        <month>1</month>
        <year>2011</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Murshudov et al. 2011</copyright-statement>
      <copyright-year>2011</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0/uk/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:type="simple" xlink:href="http://dx.doi.org/10.1107/S0907444911001314">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p>The general principles behind the macromolecular crystal structure refinement program <italic>REFMAC</italic>5 are described.</p>
    </abstract>
    <abstract>
      <p>This paper describes various components of the macromolecular crystallographic refinement program <italic>REFMAC</italic>5, which is distributed as part of the <italic>CCP</italic>4 suite. <italic>REFMAC</italic>5 utilizes different likelihood functions depending on the diffraction data employed (amplitudes or intensities), the presence of twinning and the availability of SAD/SIRAS experimental diffraction data. To ensure chemical and structural integrity of the refined model, <italic>REFMAC</italic>5 offers several classes of restraints and choices of model parameterization. Reliable models at resolutions at least as low as 4 Å can be achieved thanks to low-resolution refinement tools such as secondary-structure restraints, restraints to known homologous structures, automatic global and local NCS restraints, ‘jelly-body’ restraints and the use of novel long-range restraints on atomic displacement parameters (ADPs) based on the Kullback–Leibler divergence. <italic>REFMAC</italic>5 additionally offers TLS parameterization and, when high-resolution data are available, fast refinement of anisotropic ADPs. Refinement in the presence of twinning is performed in a fully automated fashion. <italic>REFMAC</italic>5 is a flexible and highly optimized refinement package that is ideally suited for refinement across the entire resolution spectrum encountered in macromolecular crystallography.</p>
    </abstract>
    <kwd-group>
      <kwd><italic>REFMAC</italic>5</kwd>
      <kwd>refinement</kwd>
    </kwd-group>
    <conference>
      <conf-date/>
      <conf-name>Proceedings of the CCP4 study weekend</conf-name>
      <conf-loc/>
    </conference>
  </article-meta>
</front>
<body>
  <sec sec-type="introduction" id="sec1">
    <label>1.</label>
    <title>Introduction</title>
    <p>As a final step in the process of solving a macromolecular crystal (MX) structure, refinement is carried out to maximize the agreement between the model and the X-ray data. Model parameters that are optimized in the refinement process include atomic coordinates, atomic displacement parameters (ADPs), scale factors and, in the presence of twinning, twin fraction(s). Although refinement procedures are typically designed for the final stages of MX analysis, they are also often used to improve partial models and to calculate the ‘best’ electron-density maps for further model (re)building. Refinement protocols are therefore an essential component of model-building pipelines [<italic>ARP</italic>/<italic>wARP</italic> (Perrakis <italic>et al.</italic>, 1999<xref ref-type="bibr" rid="bb48"> ▶</xref>), <italic>SOLVE</italic>/<italic>RESOLVE</italic> (Terwilliger, 2003<xref ref-type="bibr" rid="bb67"> ▶</xref>) and <italic>Buccaneer</italic> (Cowtan, 2006<xref ref-type="bibr" rid="bb13"> ▶</xref>)] and are of paramount importance in guiding manual model updates using molecular-graphics software [<italic>Coot</italic> (Emsley &amp; Cowtan, 2004<xref ref-type="bibr" rid="bb18"> ▶</xref>), <italic>O</italic> (Jones <italic>et al.</italic>, 1991<xref ref-type="bibr" rid="bb28"> ▶</xref>) and <italic>XtalView</italic> (McRee &amp; Israel, 2008<xref ref-type="bibr" rid="bb36"> ▶</xref>)].</p>
    <p>The first software tools for MX refinement appeared in the 1970s. Real-space refinement using torsion-angle parameterization was introduced by Diamond (1971<xref ref-type="bibr" rid="bb17"> ▶</xref>). This was followed a few years later by reciprocal-space algorithms for the refinement of individual atomic parameters with added energy (Jack &amp; Levitt, 1978<xref ref-type="bibr" rid="bb26"> ▶</xref>) and restraints (Konnert, 1976<xref ref-type="bibr" rid="bb29"> ▶</xref>) in order to deliver chemically reasonable models. The energy and restraints approaches differ only in terminology as they use similar information and both can be unified using a Bayesian formalism (Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>). Early programs used the well established statistical technique of least-squares residuals with equal weights on all reflections (Press <italic>et al.</italic>, 1992<xref ref-type="bibr" rid="bb50"> ▶</xref>), with gradients and second derivatives (if needed) calculated directly. This changed when Fourier methods, which were developed for small-molecule structure refinement (Booth, 1946<xref ref-type="bibr" rid="bb5"> ▶</xref>; Cochran, 1948<xref ref-type="bibr" rid="bb11"> ▶</xref>; Cruickshank, 1952<xref ref-type="bibr" rid="bb14"> ▶</xref>, 1956<xref ref-type="bibr" rid="bb15"> ▶</xref>), were formalized for macromolecules (Ten Eyck, 1977<xref ref-type="bibr" rid="bb66"> ▶</xref>; Agarwal, 1978<xref ref-type="bibr" rid="bb2"> ▶</xref>). The use of the FFT for structure-factor and gradient evaluation (Agarwal, 1978<xref ref-type="bibr" rid="bb2"> ▶</xref>) sped up calculations dramatically and the refinement of large molecules using relatively modest computers became realistic. Later, the introduction of molecular dynamics (Brünger, 1991<xref ref-type="bibr" rid="bb8"> ▶</xref>), the generalization of the FFT approach for all space groups (Brünger, 1989<xref ref-type="bibr" rid="bb9"> ▶</xref>) and the development of a modular approach to refinement programs (Tronrud <italic>et al.</italic>, 1987<xref ref-type="bibr" rid="bb71"> ▶</xref>) dramatically changed MX solution procedures. Also, the introduction of the very robust and popular small-molecular refinement program <italic>SHELXL</italic> (Sheldrick, 2008<xref ref-type="bibr" rid="bb55"> ▶</xref>) to the macromolecular community allowed routine analysis of high-resolution MX data, including the refinement of merohedral and non-merohedral twins.</p>
    <p>More sophisticated statistical approaches to MX structure refinement started to emerge in the 1990s. Although the basic formulations and most of the necessary probability distributions used in crystallography were developed in the 1950s and 1960s (Luzzati, 1951<xref ref-type="bibr" rid="bb32"> ▶</xref>; Ramachandran <italic>et al.</italic>, 1963<xref ref-type="bibr" rid="bb52"> ▶</xref>; Srinivasan &amp; Ramachandran, 1965<xref ref-type="bibr" rid="bb61"> ▶</xref>; see also Srinivasan &amp; Parthasarathy, 1976<xref ref-type="bibr" rid="bb60"> ▶</xref>, and references therein), their implementation for MX refinement started in the middle of the 1990s (Pannu &amp; Read, 1996<xref ref-type="bibr" rid="bb47"> ▶</xref>; Bricogne &amp; Irwin, 1996<xref ref-type="bibr" rid="bb7"> ▶</xref>; Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>). It should be emphasized that prior to the application of maximum-likelihood (ML) techniques in MX refinement, the importance of advanced statistical approaches to all stages of MX analysis had been advocated by Bricogne (1997<xref ref-type="bibr" rid="bb6"> ▶</xref>) for two decades. Nowadays, most MX refinement programs offer likelihood targets as an option. Although ML can be very well approximated using the weighted least-squares approach in the very simple case of refinement against structure-factor amplitudes (Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>), ML has the attractive advantage that it is relatively easy (at least theoretically) to generalize for the joint utilization of a variety of sources of observations. For example, it was immediately extended to use experimental phase information (Bricogne, 1997<xref ref-type="bibr" rid="bb6"> ▶</xref>; Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>; Pannu <italic>et al.</italic>, 1998<xref ref-type="bibr" rid="bb46"> ▶</xref>). In the last two decades, there have been many developments of likelihood functions towards the exploitation of all available experimental data for refinement, thus increasing the reliability of the refined model in the final stages of refinement and improving the electron density used in model building in the early stages of MX analysis (Bricogne, 1997<xref ref-type="bibr" rid="bb6"> ▶</xref>; Skubák <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb58"> ▶</xref>, 2009<xref ref-type="bibr" rid="bb57"> ▶</xref>).</p>
    <p>MX crystallography can now take advantage of highly optimized software packages dealing with all of the various stages of structure solution, including refinement. There are several programs available that either are designed to perform refinement or offer refinement as an option. These include <italic>BUSTER</italic>/<italic>TNT</italic> (Blanc <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb4"> ▶</xref>), <italic>CNS</italic> (Brünger <italic>et al.</italic>, 1998<xref ref-type="bibr" rid="bb10"> ▶</xref>), <italic>MAIN</italic> (Turk, 2008<xref ref-type="bibr" rid="bb73"> ▶</xref>), <italic>MOPRO</italic> (Guillot <italic>et al.</italic>, 2001<xref ref-type="bibr" rid="bb20"> ▶</xref>), <italic>phenix.refine</italic> (Adams <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb1"> ▶</xref>), <italic>REFMAC</italic>5 (Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>), <italic>SHELXL</italic> (Sheldrick, 2008<xref ref-type="bibr" rid="bb55"> ▶</xref>) and <italic>TNT</italic> (Tronrud <italic>et al.</italic>, 1987<xref ref-type="bibr" rid="bb71"> ▶</xref>). While <italic>MOPRO</italic> was specifically designed for niche ultrahigh-resolution refinement and is able to model deformation density, all of the other programs can deal with a multitude of MX refinement problems and produce high-quality electron-density maps, although with different emphases and strengths.</p>
    <p>This contribution describes the various components of the macromolecular crystallographic refinement program <italic>REFMAC</italic>5, which is distributed as part of the <italic>CCP</italic>4 suite (Collaborative Computational Project, Number 4, 1994<xref ref-type="bibr" rid="bb12"> ▶</xref>). <italic>REFMAC</italic>5 is a flexible and highly optimized refinement package that is ideally suited for refinement across the entire resolution spectrum that is encountered in macromolecular crystallo­graphy.</p>
  </sec>
  <sec id="sec2">
    <label>2.</label>
    <title>Target functions in <italic>REFMAC</italic>5</title>
    <p>As in all other refinement programs, the target function minimized in <italic>REFMAC</italic>5 has two components: a component utilizing geometry (or prior knowledge) and a component utilizing experimental X-ray knowledge, <disp-formula id="fd1"><graphic xlink:href="d-67-00355-efd1"/></disp-formula>where <italic>f</italic>
            <sub>total</sub> is the total target function to be minimized, con­sisting of functions controlling the geometry of the model and the fit of the model parameters to the experimental data, and <italic>w</italic> is a weight between the relative contributions of these two components. In macromolecular crystallography, the weight is traditionally selected by trial and error. <italic>REFMAC</italic>5 offers automatic weighting, which is based on the fact that both components are the natural logarithm of a probability distribution. However, this ‘automatic’ weight may lead to unreasonable deviations from ideal geometry (either too tight or too relaxed) in some cases, as the ideal geometry is difficult to describe statistically. For these cases, the weight parameter may need to be selected manually to produce more reasonable geometry, <italic>e.g.</italic> such that the root-mean-square deviation of the bond lengths from the ideal values is 0.02 Å and at resolutions lower than 3 Å perhaps even smaller.</p>
    <p>From a Bayesian viewpoint (O’Hagan, 1994<xref ref-type="bibr" rid="bb44"> ▶</xref>), these functions have the following probabilistic interpretation (ignoring constants which are irrelevant for minimization purposes): <disp-formula id="fd2"><graphic xlink:href="d-67-00355-efd2"/></disp-formula>From this point of view, MX refinement is similar to a well known technique in statistical analysis: maximum posterior (MAP) estimation. The model parameters are linked with the experimental data <italic>via f</italic>
            <sub>xray</sub>, <italic>i.e.</italic> likelihood is a mechanism that controls information flow from the experimental data to the derived model. Consequently, it is important to design a likelihood function that allows optimal information transfer from the data to the derived model. <italic>f</italic>
            <sub>geom</sub> ensures that the derived model is consistent with the presumed chemical and structural knowledge. This function plays the role of regularization, reduction of the effective number of parameters and transfer of known information to the new model. If care is not taken, then wrong information may be transferred to the model; removing the effect of such errors may be difficult if possible at all. The design of such functions should be performed using verifiable invariant information and it should be testable and revisable during the refinement and model-building procedures.</p>
    <p>Functions dealing with geometry usually depend only on atomic parameters. We are not aware of any function used in crystallography that deals with the prior geometry probability distributions of overall parameters. A possible reason for the lack of interest in (and necessity of) this type of function may be that, despite popular belief, the statistical problem in crystallo­graphy is sufficiently well defined and that the main problems are those of model parameterization and completion.</p>
    <p>The existing refinement programs differ in the target functions and optimization techniques used to derive model parameters. Most MX programs use likelihood target functions. However, their form, implementations and parameterizations are different. Therefore, it should not come as a surprise if different programs give (slightly) different results in terms of model parameters, electron-density maps and reliability factors (such as <italic>R</italic> and <italic>R</italic>
            <sub>free</sub>).</p>
    <sec id="sec2.1">
      <label>2.1.</label>
      <title>X-ray component</title>
      <p>The X-ray likelihood target functions used in <italic>REFMAC</italic>5 are based on a general multivariate probability distribution of <italic>E</italic> observations given <italic>M</italic> model structure factors. This function is derived from a multivariate complex Gaussian distribution of <italic>N</italic> = <italic>E</italic> + <italic>M</italic> structure factors for acentric reflections and from a multivariate real Gaussian distribution for centric reflections and has the following form: <disp-formula id="fd3"><graphic xlink:href="d-67-00355-efd3"/></disp-formula>where <italic>P</italic> = <italic>P</italic>(|<italic>F</italic>
               <sub>1</sub>|, …, |<italic>F<sub>E</sub></italic>|; <italic>F</italic>
               <sub><italic>E</italic>+1</sub>, …, <italic>F<sub>N</sub></italic>), <italic>F<sub>i</sub></italic> = |<italic>F<sub>i</sub></italic>|exp(ια<italic><sub>i</sub></italic>}, |<italic>F</italic>
               <sub>1</sub>|, …, |<italic>F<sub>E</sub></italic>| denote the observed amplitudes, <italic>F</italic>
               <sub><italic>E</italic>+1</sub>, …, <italic>F<sub>N</sub></italic> are the model structure factors, C<italic><sub>N</sub></italic> is the covariance matrix with the elements of its inverse denoted by <italic>a<sub>ij</sub></italic>, C<italic><sub>M</sub></italic> is the bottom right square submatrix of C<italic><sub>N</sub></italic> of dimension <italic>M</italic> with the elements of its inverse denoted by <italic>c<sub>ij</sub></italic>. We define <italic>c<sub>ij</sub></italic> = 0 for <italic>i</italic> ≤ 0 or <italic>j</italic> ≤ 0. |C<italic><sub>N</sub></italic>| and |C<italic><sub>M</sub></italic>| are the determinants of matrices C<italic><sub>N</sub></italic> and C<italic><sub>M</sub></italic>, <inline-formula><inline-graphic xlink:href="d-67-00355-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> = (α<sub>1</sub>, …, α<sub><italic>E</italic></sub>) is the vector of the unknown phases of the observations that need to be integrated and <inline-formula><inline-graphic xlink:href="d-67-00355-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is a probability distribution expressing any prior knowledge about the phases.</p>
      <p>In the simplest case of one observation, one model and no prior knowledge about phases, the integral in (3)<xref ref-type="disp-formula" rid="fd3"/> can be evaluated analytically. In this case, the function follows a Rice distribution (Bricogne &amp; Irwin, 1996<xref ref-type="bibr" rid="bb7"> ▶</xref>), which is a non-central χ<sup>2</sup> distribution of |<italic>F</italic>
               <sub>o</sub>|<sup>2</sup>/Σ and |<italic>F</italic>
               <sub>o</sub>|<sup>2</sup>/2Σ with non-centrality parameters <italic>D</italic>
               <sup>2</sup>|<italic>F</italic>
               <sub>c</sub>|<sup>2</sup>/Σ and <italic>D</italic>
               <sup>2</sup>|<italic>F</italic>
               <sub>o</sub>|<sup>2</sup>/2Σ with one and two degrees of freedom for centric and acentric reflections, respectively (Stuart &amp; Ord, 2009<xref ref-type="bibr" rid="bb63"> ▶</xref>), <disp-formula id="fd4"><graphic xlink:href="d-67-00355-efd4"/></disp-formula>where <italic>D</italic> in its simplest interpretation is 〈cos(Δ<italic>xs</italic>)〉, a Luzzati error parameter (Luzzati, 1952<xref ref-type="bibr" rid="bb76"> ▶</xref>) expressing errors in the positional parameters of the model, <italic>F</italic>
               <sub>c</sub> is the model structure factor, |<italic>F</italic>
               <sub>o</sub>| is the observed amplitude of the structure factor and Σ is the uncertainty or the second central moment of the distribution. Both Σ and <italic>D</italic> enter the equation as part of the covariance matrices C<italic><sub>N</sub></italic> and C<italic><sub>M</sub></italic> from (3)<xref ref-type="disp-formula" rid="fd3"/>. Σ is a function of the multiplicity of the Miller indices (∊ factor), experimental uncertainties (σ<sub>o</sub>), model completeness and model errors. For simplicity, the following parameterization is used: <disp-formula id="fd5"><graphic xlink:href="d-67-00355-efd5"/></disp-formula>The current version of <italic>REFMAC</italic>5 estimates <italic>D</italic> and Σ<sub>mod</sub> in resolution bins. Working reflections are used for estimation of <italic>D</italic> and free reflections are used for Σ<sub>mod</sub> estimation. Although this simple parameterization works in many cases, it may give misleading results for data from crystals with pseudo translation, OD disorder or modulated crystals in general. Currently, there is no satisfactory implementation of the error model to account for these cases.</p>
    </sec>
    <sec id="sec2.2">
      <label>2.2.</label>
      <title>Incorporation of experimental phase information in model refinement</title>
      <sec id="sec2.2.1">
        <label>2.2.1.</label>
        <title>MLHL likelihood</title>
        <p>MLHL likelihood (Bricogne, 1997<xref ref-type="bibr" rid="bb6"> ▶</xref>; Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>; Pannu <italic>et al.</italic>, 1998<xref ref-type="bibr" rid="bb46"> ▶</xref>) is based on a special case of the probability distribution (3)<xref ref-type="disp-formula" rid="fd3"/> where we have one observation, one model and phase information derived from an experiment available as a prior distribution <italic>P</italic>
                  <sub>pr</sub>(α), <disp-formula id="fd6"><graphic xlink:href="d-67-00355-efd6"/></disp-formula>where <italic>F</italic>
                  <sub>o</sub> = |<italic>F</italic>
                  <sub>o</sub>|exp(ια), <italic>F</italic>
                  <sub>c</sub> = |<italic>F</italic>
                  <sub>c</sub>|exp(ια<sub>c</sub>), α is the unknown phase of the structure factor and α<sub>1</sub> and α<sub>2</sub> are its possible values for a centric reflection. The prior phase probability distribution <italic>P</italic>
                  <sub>pr</sub>(α) is usually represented as a generalized von Mises distribution (Mardia &amp; Jupp, 1999<xref ref-type="bibr" rid="bb34"> ▶</xref>) and is better known in crystallography as a Hendrickson–Lattman distribution (Hendrickson &amp; Lattman, 1970<xref ref-type="bibr" rid="bb21"> ▶</xref>), <disp-formula id="fd7"><graphic xlink:href="d-67-00355-efd7"/></disp-formula>where <italic>A</italic>, <italic>B</italic>, <italic>C</italic> and <italic>D</italic> are coefficients of the Fourier transformation of the logarithm of the phase probability distribution and <italic>N</italic> is the normalization coefficient. The distribution is unimodal when <italic>C</italic> and <italic>D</italic> are zero; otherwise, it is a bimodal distribution that reflects the possible phase uncertainty in experimental phasing. For centric reflections <italic>C</italic> and <italic>D</italic> are zero.</p>
      </sec>
      <sec id="sec2.2.2">
        <label>2.2.2.</label>
        <title>SAD/SIRAS likelihood</title>
        <p>The MLHL likelihood is dependent on the reliability and accuracy of the prior distribution <italic>P</italic>
                  <sub>pr</sub>(α). However, the phase distributions after density modification (or even after phasing), which are usually used as <italic>P</italic>
                  <sub>pr</sub>(α), often suffer from inaccurate estimation of the phase errors. Furthermore, MLHL [as well as any other special case of (3)<xref ref-type="disp-formula" rid="fd3"/> with a non-uniform <italic>P</italic>
                  <sub>pr</sub>(α)] assumes independence of the prior phases from the model phases. These shortcomings can be addressed by using experimental information directly from the experimental data, instead of from the <italic>P</italic>
                  <sub>pr</sub>(α) distributions obtained in previous steps of the structure-solution process. Currently, SAD and SIRAS likelihood functions are implemented in <italic>REFMAC</italic>5.</p>
        <p>The SAD probability distribution (Skubák <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb58"> ▶</xref>) is obtained from (3)<xref ref-type="disp-formula" rid="fd3"/> by setting <italic>E</italic> = 2, <italic>M</italic> = 2, <italic>P</italic>
                  <sub>pr</sub>(α) = constant and |<italic>F</italic>
                  <sub>1</sub>| = |<italic>F</italic>
                  <sub>o</sub>
                  <sup>+</sup>|, |<italic>F</italic>
                  <sub>2</sub>| = |(<italic>F</italic>
                  <sub>o</sub>
                  <sup>−</sup>)*|, <italic>F</italic>
                  <sub>3</sub> = <italic>F</italic>
                  <sub>c</sub>
                  <sup>+</sup>, <italic>F</italic>
                  <sub>4</sub> = (<italic>F</italic>
                  <sub>c</sub>
                  <sup>−</sup>)*, where <italic>F</italic>
                  <sup>+</sup> and <italic>F</italic>
                  <sup>−</sup> are the structure factors of the Friedel pairs. The model structure factors are constructed using the current parameters of the protein, the heavy-atom substructure and the inputted anomalous scattering parameters. Similarly, the SIRAS function (Skubák <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb57"> ▶</xref>) is a special case of (3)<xref ref-type="disp-formula" rid="fd3"/> with <italic>E</italic> = 3, <italic>M</italic> = 3, <italic>P</italic>
                  <sub>pr</sub>(α) = constant and |<italic>F</italic>
                  <sub>1</sub>| = |<italic>F</italic>
                  <sub>o</sub>
                  <italic><sup>N</sup></italic>|, |<italic>F</italic>
                  <sub>2</sub>| = |<italic>F</italic>
                  <sub>o</sub>
                  <sup>+</sup>|, |<italic>F</italic>
                  <sub>3</sub>| = |(<italic>F</italic>
                  <sub>o</sub>
                  <sup>−</sup>)*|, <italic>F</italic>
                  <sub>4</sub> = <italic>F</italic>
                  <sub>c</sub>
                  <italic><sup>N</sup>, F</italic>
                  <sub>5</sub> = <italic>F</italic>
                  <sub>c</sub>
                  <sup>+</sup>, <italic>F</italic>
                  <sub>6</sub> = (<italic>F</italic>
                  <sub>c</sub>
                  <sup>−</sup>)*, where |<italic>F</italic>
                  <sub>1</sub>| and <italic>F</italic>
                  <sub>4</sub> correspond to the observation and the model of the native crystal, respectively, and |<italic>F</italic>
                  <sub>2</sub>|, |<italic>F</italic>
                  <sub>3</sub>|, <italic>F</italic>
                  <sub>5</sub> and <italic>F</italic>
                  <sub>6</sub> refer to the Friedel pair observations and models of the derivative crystal. If any of the <italic>E</italic> observations are symmetrically equivalent, for instance centric Friedel pair intensities, the equation is reduced appropriately so as to only include non-equivalent observations and models.</p>
        <p>The incorporation of prior phase information by the refinement function is especially useful in the early and middle stages of model building and at all stages of structure solution at lower resolutions, owing to the improvement in the observation-to-parameter ratio. The refinement of a well resolved high-resolution structure is often best achieved using the simple Rice function.</p>
        <p>Fig. 1<xref ref-type="fig" rid="fig1"> ▶</xref> shows the effect of various likelihood functions on automatic model building using <italic>ARP</italic>/<italic>wARP</italic> (Perrakis <italic>et al.</italic>, 1999<xref ref-type="bibr" rid="bb48"> ▶</xref>).</p>
      </sec>
    </sec>
    <sec id="sec2.3">
      <label>2.3.</label>
      <title>Twin refinement</title>
      <p>The function used for twin refinement is a generalization of the Rice distribution in the presence of a linear relationship between the observed intensities. This function has the form<disp-formula id="fd8"><graphic xlink:href="d-67-00355-efd8"/></disp-formula>where <italic>N</italic>
               <sub>o</sub> and <italic>N</italic>
               <sub>model</sub> are normalization coefficients. In the first equation, the first term inside the integral, <italic>P</italic>(<italic>I</italic>
               <sub>o</sub>; <italic>F</italic>), represents the probability distribution of observations if ‘ideal’ structure factors are known. Here, all reflections that are twinned and that can be grouped together are included. Models representing the data-collection instrument, if available, could be added to this term. The second term, <italic>P</italic>(<italic>F</italic>; model), represents a probability distribution of the ‘ideal’ structure factors should an atomic model be known for a single crystal. Here, all reflections from the asymmetric unit that contribute to the observed ‘twinned’ intensities are included. If the data were to come from more than one crystal or if, for example, SAD should be used simultaneously with twinning, then this term would need to be modified appropriately. <italic>F</italic>
               <sub>c</sub> is a function of atomic and overall parameter <italic>D</italic>. Overall parameters also include Σ and twin-fraction parameters. <italic>f</italic> represents the way structure factors from the asymmetric unit contribute to the particular ‘twinned’ intensity. The above formula is more symbolic rather than precise; further details of twin refinement will be published elsewhere.</p>
      <p><italic>REFMAC</italic>5 performs the following preparations before starting refinement against twinned data. <list list-type="simple"><list-item><p>(i) Identify potential (pseudo)merohedral twin operators by analyses of cell/space-group combination using the algorithm developed by Lebedev <italic>et al.</italic> (2006<xref ref-type="bibr" rid="bb31"> ▶</xref>).</p></list-item><list-item><p>(ii) Calculate <italic>R</italic>
                        <sub>merge</sub> for each potential twin operator and filter out twin operators for which <italic>R</italic>
                        <sub>merge</sub> is greater than 0.5 or a user-defined value.</p></list-item><list-item><p>(iii) Estimate twin fractions for the remaining twin domains and filter out those with small twin fractions (the default value is 0.05).</p></list-item><list-item><p>(iv) Make sure that the point group and twin operators form a group. Strictly speaking this stage is not necessary, but it makes bookkeeping easy.</p></list-item><list-item><p>(v) Perform twin refinement using the remaining twin operators. Twin fractions are refined at every cycle.</p></list-item></list></p>
      <p>All integrals necessary for evaluation of the minus log-likelihood function and its derivatives with respect to the structure factors are evaluated using the Laplace approximation (McKay, 2003<xref ref-type="bibr" rid="bb35"> ▶</xref>).</p>
    </sec>
    <sec id="sec2.4">
      <label>2.4.</label>
      <title>Modelling bulk-solvent contribution</title>
      <p>Typically, a significant part of a macromolecular crystal is occupied by disordered solvent. Accurate modelling of this part of the crystal is still an unsolved problem of MX. The contribution of bulk solvent to structure factors is strongest at low resolution, although its effect at high resolution is still non-negligible.</p>
      <p>The absence of good models for disordered solvent may be one of the reasons why <italic>R</italic> factors in MX are significantly higher than those in small-molecular crystallography. For small molecules <italic>R</italic> factors can be around 1%, whereas for MX they are rarely less than 10% and more often around 20% or even higher.</p>
      <p><italic>REFMAC</italic>5 uses two types of bulk (disordered) solvent models. One of them is the so-called Babinet’s bulk-solvent model, which is based on the assumption that the only difference between solvent and protein at low resolution is their scale factor (Tronrud, 1997<xref ref-type="bibr" rid="bb72"> ▶</xref>). Here, we use a slight modification of the formulation described by Tronrud (1997<xref ref-type="bibr" rid="bb72"> ▶</xref>) and assume that if protein electron density is convoluted using the Gaussian kernel and multiplied by an appropriate scale factor, then protein and solvent electron densities are equal, <disp-formula id="fd9"><graphic xlink:href="d-67-00355-efd9"/></disp-formula>where * denotes convolution, <inline-formula><inline-graphic xlink:href="d-67-00355-efi3.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> denotes the Fourier transform and <italic>k</italic>
               <sub>babinet</sub> = <italic>k</italic>
               <sub>babinet0</sub>exp(−<italic>B</italic>
               <sub>babinet</sub>|<italic>s</italic>|<sup>2</sup>/4). Here, we used the convolution theorem, which states that the Fourier transform of the convolution of two functions is the product of their Fourier transforms.</p>
      <p>The second bulk-solvent model is derived similarly to that described by Jiang &amp; Brünger (1994<xref ref-type="bibr" rid="bb27"> ▶</xref>). The basic assumption is that disordered solvent atoms are uniformly distributed over the region of the asymmetric unit that is not occupied by the atoms of the modelled part of the crystal structure. The region of the asymmetric unit occupied by the atomic model is masked out. Any holes inside this mask are removed using a cavity-detection algorithm. A constant value is assigned outside this region and the structure factors <italic>F</italic>
               <sub>mask</sub> are calculated using an FFT algorithm. These structure factors, multiplied by appropriate scale factors (estimated during the scaling procedure), are added to those calculated from the atomic model. Additionally, various mask parameters may optionally be optimized.</p>
      <p>One should be careful with bulk-solvent corrections, especially when the atomic model is incomplete. This type of bulk-solvent model may result in smeared-out electron density that may reduce the height of electron density in less-ordered and unmodelled parts of the crystal.</p>
      <p>The final total structure factors with scale and solvent contributions included take the following form: <disp-formula id="fd10"><graphic xlink:href="d-67-00355-efd10"/></disp-formula>where the <italic>k</italic>s are scale factors, <bold>s</bold> is the reciprocal-space vector, |<italic>s</italic>| is the length of this vector, <italic>U</italic>
               <sub>aniso</sub> is the crystallographic anisotropic tensor that obeys crystal symmetry, <italic>F</italic>
               <sub>mask</sub> is the contribution from the mask bulk solvent and <italic>F</italic>
               <sub>protein</sub> is the contribution from the protein part of the crystal. Usually, either mask or Babinet bulk-solvent correction is used. However, sometimes their combination may provide better statistics (lower <italic>R</italic> factors) than either individually.</p>
      <p>The overall parameters of the solvent models, the overall anisotropy and the scale factors are estimated using a least-squares fit of the amplitude of the total structure factors to the observed amplitudes, <disp-formula id="fd11"><graphic xlink:href="d-67-00355-efd11"/></disp-formula>In the case of twin refinement, the following function is used to estimate overall parameters including twin fractions (details of twin refinement will be published elsewhere), <disp-formula id="fd12"><graphic xlink:href="d-67-00355-efd12"/></disp-formula>where <italic>f</italic>(α, <italic>F</italic>) is as defined in (8)<xref ref-type="disp-formula" rid="fd8"/>.</p>
      <p>Both (11)<xref ref-type="disp-formula" rid="fd11"/> and (12)<xref ref-type="disp-formula" rid="fd12"/> are minimized using the Gauss–Newton method with eigenvalue filtering to solve linear equations, which ensures that even very highly correlated parameters can be estimated simultaneously. However, one should be careful in interpretating these parameters as the system is highly correlated.</p>
      <p>Once overall parameters such as the scale factors and twin fractions have been estimated, <italic>REFMAC</italic>5 estimates the overall parameters of one of the abovementioned likelihood functions and evaluates the function and its derivatives with respect to the atomic parameters. A general description of this procedure can be found in Steiner <italic>et al.</italic> (2003<xref ref-type="bibr" rid="bb62"> ▶</xref>).</p>
    </sec>
    <sec id="sec2.5">
      <label>2.5.</label>
      <title>Geometry component</title>
      <p>The function controlling the geometry has several components.<list list-type="simple"><list-item><p>(i) Chemical information about the constituent blocks (<italic>e.g.</italic> amino acids, nucleic acids, ligands) of macromolecules and the covalent links between them.</p></list-item><list-item><p>(ii) Internal consistency of macromolecules (<italic>e.g.</italic> NCS).</p></list-item><list-item><p>(iii) Structural knowledge (known structures, restraints on current interatomic distances, secondary structures).</p></list-item></list>The first component is used by all programs and has been tabulated in an mmCIF dictionary (Vagin <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb74"> ▶</xref>) now used by several programs, including <italic>REFMAC</italic>5, <italic>phenix.refine</italic> (Adams <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb1"> ▶</xref>) and <italic>Coot</italic> (Emsley &amp; Cowtan, 2004<xref ref-type="bibr" rid="bb18"> ▶</xref>). The current version of the dictionary contains around 9000 entries and several hundred covalent-link descriptions. Any new entries may be added using one of several programs, including <italic>Sketcher</italic> (Vagin <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb74"> ▶</xref>) from <italic>CCP</italic>4 (Collaborative Computational Project, Number 4, 1994<xref ref-type="bibr" rid="bb12"> ▶</xref>), <italic>JLigand</italic> (unpublished work), <italic>PRODRG</italic> (Schüttelkopf &amp; van Aalten, 2004<xref ref-type="bibr" rid="bb54"> ▶</xref>) and <italic>phenix.elbow</italic> (Adams <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb1"> ▶</xref>).</p>
      <p>Standard restraints on the covalent structure have the general form<disp-formula id="fd13"><graphic xlink:href="d-67-00355-efd13"/></disp-formula>where <italic>b<sub>m</sub></italic> represents a geometric parameter (<italic>e.g.</italic> bonds, angles, chiralities) calculated from the model and <italic>b<sub>i</sub></italic> is the ideal value of this particular geometric parameter as tabulated in the dictionary.</p>
      <p>Apart from ω (the angle of the peptide bond) and χ (the angles of amino-acid side chains), torsion angles in general are not restrained by default. However, the user can request to restrain a particular torsion angle defined in the dictionary or can define general torsion angles and use them as restraints. In general, it is not clear how to handle the restraint on torsion angles automatically, as these angles may depend on the covalent structure as well as the chemical environment of a particular ligand.</p>
    </sec>
    <sec id="sec2.6">
      <label>2.6.</label>
      <title>Noncrystallographic symmetry restraints</title>
      <sec id="sec2.6.1">
        <label>2.6.1.</label>
        <title>Automatic NCS definition</title>
        <p>Automatic NCS identification in <italic>REFMAC</italic>5 is performed using the following procedure.<list list-type="simple"><list-item><p>(i) Align the sequences of all chains with all chains using the dynamic alignment algorithm (Needleman &amp; Wunsch, 1970<xref ref-type="bibr" rid="bb41"> ▶</xref>).</p></list-item><list-item><p>(ii) Accept the alignment if the number of aligned residues is more than <italic>k</italic> (default 15) residues and the sequence identity for aligned residues is more than α% (default 80%).</p></list-item><list-item><p>(iii) Calculate the global root-mean-square deviation (r.m.s.d.) using all aligned residues.</p></list-item><list-item><p>(iv) Calculate the average local r.m.s.d. using the formula <disp-formula id="fd14"><graphic xlink:href="d-67-00355-efd14"/></disp-formula>where <italic>N</italic> is the number of aligned residues, <italic>j</italic> indexes the aligned residues, <italic>N<sub>j</sub></italic> is the number of corresponding atoms in residue <italic>j</italic>, <italic>n</italic>
                           <sub><italic>j</italic></sub> is the number of atoms in the <italic>i</italic>th group, <italic>r<sub>l</sub></italic> is the vector of differences between corresponding atomic positions and <italic>R<sub>j</sub></italic> and <italic>t<sub>j</sub></italic> are the rotation and translation that give the best superposition between atoms in group <italic>i</italic>. To calculate the r.m.s.d., it is not necessary to calculate the rotation and translation operators explicitly or to apply these transformations to atoms. Rather, it is achieved implicitly using Procrustes analysis, as described, for example, in Mardia &amp; Bibby (1979<xref ref-type="bibr" rid="bb33"> ▶</xref>). When <italic>k</italic> = <italic>N</italic>, the local and global r.m.s.d. coincide.</p></list-item><list-item><p>(v) If the r.m.s.d. is less than β Å (default 2.5 Å), then we consider the chains to be aligned.</p></list-item><list-item><p>(vi) Prepare the list of aligned atoms. If after applying the transformation matrix (calculated using aligned atoms) the neighbours (waters, ligands) of aligned atoms are superimposed, then they are also added to the list of aligned atoms.</p></list-item><list-item><p>(vii) If local NCS is requested, then prepare pairs of corresponding interatomic distances.</p></list-item></list>
               </p>
        <p>Steps (i)–(v) are performed once during each session of refinement. Step (vi) is performed during every cycle of refinement in order to allow conformational changes to occur.</p>
      </sec>
      <sec id="sec2.6.2">
        <label>2.6.2.</label>
        <title>Global NCS</title>
        <p>For global NCS restraints, transformation operators (<italic>R<sub>ij</sub></italic> and <italic>t<sub>ij</sub></italic>) that optimally superpose all NCS-related molecules are estimated and the following residual is added to the total target function,<disp-formula id="fd15"><graphic xlink:href="d-67-00355-efd15"/></disp-formula>where the weight <italic>w</italic> is a user-controllable parameter. Note that the transformation matrices are estimated using <italic>x<sub>i</sub></italic> and <italic>x<sub>j</sub></italic> and thus they are dependent on these parameters. Therefore, in principle the gradient and second-derivative calculations should take this dependence into account, although this dependence is ignored in the current version of <italic>REFMAC</italic>5. Ignoring the contribution of these terms may reduce the rate of convergence, although in practice it does not seem to pose a problem.</p>
      </sec>
      <sec id="sec2.6.3">
        <label>2.6.3.</label>
        <title>Local NCS</title>
        <p>The following function (similar to the implementation in <italic>BUSTER</italic>) is used for local NCS restraints, <disp-formula id="fd16"><graphic xlink:href="d-67-00355-efd16"/></disp-formula>where GM is the Geman–McClure robust estimator function (Geman &amp; McClure, 1987<xref ref-type="bibr" rid="bb19"> ▶</xref>), which can be written<disp-formula id="fd17"><graphic xlink:href="d-67-00355-efd17"/></disp-formula>Fig. 2<xref ref-type="fig" rid="fig2"> ▶</xref> shows that for small values of <italic>r</italic> this function is similar to the usual least-squares function. However, it behaves differently for large <italic>r</italic>: least-square residuals do not allow conformational changes to occur, whereas this type of function is more tolerant to such changes.</p>
      </sec>
      <sec id="sec2.6.4">
        <label>2.6.4.</label>
        <title>External structure restraints</title>
        <p>The interatomic distances within the structure being analysed may be similar to a known (deposited) structure, particularly in localized regions. In cases where it makes sense, this information can be exploited in order to aid the refinement of the target structure. In doing so, the target structure is pulled towards the con­formation adopted by the known structure. The mechanism for generic external restraints described by Mooij <italic>et al.</italic> (2009<xref ref-type="bibr" rid="bb37"> ▶</xref>) is used for external structure restraints.</p>
        <p>In our implementation, structural information from external known structures is utilized by applying restraints to the distances between atom pairs based on a presumed atomic correspondence between the two structures. The following function is used for external structure restraints, <disp-formula id="fd18"><graphic xlink:href="d-67-00355-efd18"/></disp-formula>where the atoms <italic>a<sub>i</sub></italic> belong to the set <italic>A</italic> of atoms for which a correspondence is known, <italic>d<sub>ij</sub></italic> is the distance between the positions of atoms <italic>a<sub>i</sub></italic> and <italic>a<sub>j</sub></italic>, <inline-formula><inline-graphic xlink:href="d-67-00355-efi4.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> is the corresponding distance in the known structure, σ<italic><sub>ij</sub></italic> is the estimated standard deviation of <italic>d<sub>ij</sub></italic> about <inline-formula><inline-graphic xlink:href="d-67-00355-efi4.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and <italic>d</italic>
                  <sub>max</sub> ensures that atom pairs are only restrained within localized regions, allowing insensitivity to global conformational changes. External structure restraints should be weighted differently to the other geometry com­ponents in order to allow the restraint strength to be separately specified. Consequently, a weight <italic>w</italic>
                  <sub>ext</sub> is applied, which should be appropriately chosen depending on the data quality and resolution, the structural similarity between the external known structure and the target, and the choice of <italic>d</italic>
                  <sub>max</sub>. The Geman–McClure function with sensitivity parameter σ<sub>GM</sub> is used to increase robustness to outliers, as with the local NCS restraints.</p>
        <p>Prior information from the external known structure(s) is generated using the software tool <italic>PROSMART</italic>. Specifically, this includes the atomic correspondence <italic>A</italic>, distances <inline-formula><inline-graphic xlink:href="d-67-00355-efi4.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>, standard deviations σ<italic><sub>ij</sub></italic> and the distance cutoff <italic>d</italic>
                  <sub>max</sub>.</p>
        <p>Potential sources of prior structural information include different conformations of the target chain (such as those that may result from using different crystallization conditions or in a different binding state) as well as those from homologous or structurally similar proteins. It is possible to use multiple known structures as prior information. The combination of this information results in modified values of <inline-formula><inline-graphic xlink:href="d-67-00355-efi4.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and σ<italic><sub>ij</sub></italic> as appropriate. This allows a structure to be refined utilizing information from a whole class of similar structures, rather than just a single source. Furthermore, it opens up the future possibility for multi-crystal co-refinement.</p>
        <p>The employed formalism also allows the application of atomic distance restraints to secondary-structure elements (and, in principle, other motifs). Consequently, external restraints may be applied without requiring the prior identification of known structures similar to the target. This is intended to help to refine such motifs towards the expected/presumed local conformation.</p>
        <p>This technique has been found to be particularly useful for low-resolution crystals and in cases where the target structure is unable to be refined to a satisfactory level. When used appropriately, external structure restraints should increase refinement reliability. Consequently, the difference between the <italic>R</italic> and <italic>R</italic>
                  <sub>free</sub> values is expected to decrease in successful cases.</p>
        <p>Fig. 3<xref ref-type="fig" rid="fig3"> ▶</xref> shows the refinement statistics resulting from using external restraints to refine a low-resolution bluetongue virus VP4 enzyme (Sutton <italic>et al.</italic>, 2007<xref ref-type="bibr" rid="bb65"> ▶</xref>). A sequence-identical structure solved at a higher resolution is used as prior information. Refinement statistics are compared after ten refinement cycles with and without using external restraints. Using the external restraints results in a 2.8% improvement in <italic>R</italic>
                  <sub>free</sub>. Furthermore, the difference between the <italic>R</italic> and <italic>R</italic>
                  <sub>free</sub> values is reduced from 11.5 to 4.3%, suggesting greatly increased refinement reliability.</p>
      </sec>
      <sec id="sec2.6.5">
        <label>2.6.5.</label>
        <title>‘Jelly-body’ restraints</title>
        <p>The ratio of the number of observations to the number of adjustable parameters is very small at low resolution. Even after accounting for chemical restraints, this ratio stays very small and refinement in such cases is usually unstable. The danger of overfitting is very high; this is reflected in large differences between the <italic>R</italic> and <italic>R</italic>
                  <sub>free</sub> values. External structure restraints and the use of experimental phase information (described above) provide ways of dealing with this problem. Unfortunately, it is not always possible to find similar structures refined at high resolution (or at least ones that result in a sufficiently successful improvement in refinement statistics) and experimental phase information is not always available or sufficient. Fortunately, statistical techniques exist to deal with this type of problem. Such techniques include ridge regression (Stuart <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb64"> ▶</xref>), the lasso estimation procedure (Tibshirani, 1997<xref ref-type="bibr" rid="bb68"> ▶</xref>) and Bayesian estimation with prior knowledge of parameters (O’Hagan, 1994<xref ref-type="bibr" rid="bb44"> ▶</xref>).</p>
        <p><italic>REFMAC</italic>5 has a regularization function in interatomic distance space that has the form<disp-formula id="fd19"><graphic xlink:href="d-67-00355-efd19"/></disp-formula>for pairs of atoms <italic>i</italic>, <italic>j</italic> from the same chain, with maximum radius <italic>d</italic>
                  <sub>max</sub>, which can be controlled (default 4.25 Å). Note that this term does not contribute to the value of the function or its gradient; it only changes the second derivative, thus changing the search direction. It should be noted that a similar technique has been implemented in <italic>CNS</italic> (Schröder <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb56"> ▶</xref>).</p>
        <p>Note that if all interatomic distances were constrained, then individual atomic refinement would become rigid-body refinement. The effect of ‘jelly-body’ restraints is the implicit parameterization between the rigid body and individual atoms. This technique has strong similarity to elastic network model calculations (Trion, 1996<xref ref-type="bibr" rid="bb69"> ▶</xref>). This simple formula has been found to work surprisingly well.</p>
      </sec>
      <sec id="sec2.6.6">
        <label>2.6.6.</label>
        <title>Atomic displacement parameter restraints</title>
        <p>Unlike positional parameters, where prior knowledge can be designed using basic knowledge of the chemistry of the building blocks of macromolecules and analysis of high-resolution structures, it is not obvious how to design restraints for atomic displace­ment parameters (ADPs). Ideally, restraints should reflect the geometry of the molecules as well as their overall mobility. Various programs use various restraints (Sheldrick, 2008<xref ref-type="bibr" rid="bb55"> ▶</xref>; Adams <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb1"> ▶</xref>; Konnert &amp; Hendrickson, 1980<xref ref-type="bibr" rid="bb30"> ▶</xref>; Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>). In the new version of <italic>REFMAC</italic>5, restraints on ADPs are based on the distances between distributions. If we assume that atoms are represented as Gaussian distributions, then we are able to design restraints based on the distance between such distributions.</p>
        <p>For a given two distributions in three-dimensional space <italic>P</italic>(<italic>x</italic>) and <italic>Q</italic>(<italic>x</italic>), the symmetrized Kullback–Liebler (KL) divergence (McKay, 2003<xref ref-type="bibr" rid="bb35"> ▶</xref>) is defined as follows: <disp-formula id="fd20"><graphic xlink:href="d-67-00355-efd20"/></disp-formula>It can be verified that the symmetrized KL divergence satisfies the conditions of a metric distance in the space of distributions. The KL divergence can also be represented as follows: <disp-formula id="fd21"><graphic xlink:href="d-67-00355-efd21"/></disp-formula>This distance changes more smoothly than the <italic>L</italic>
                  <sub>2</sub> distance between functions and seems to be a useful criterion for the design of approximate probability distributions (McKay, 2003<xref ref-type="bibr" rid="bb35"> ▶</xref>; O’Hagan, 1994<xref ref-type="bibr" rid="bb44"> ▶</xref>).</p>
        <p>When both distributions are Gaussian with mean zero, this distance has an elegant form. Assume that both atoms have Gaussian distribution: <disp-formula id="fd22"><graphic xlink:href="d-67-00355-efd22"/></disp-formula>In this case, the KL divergence becomes <disp-formula id="fd23"><graphic xlink:href="d-67-00355-efd23"/></disp-formula>In the case of isotropic ADPs, KL has an even simpler form: <disp-formula id="fd24"><graphic xlink:href="d-67-00355-efd24"/></disp-formula>
                  <italic>REFMAC</italic>5 uses restraints based on the KL divergence: <disp-formula id="fd25"><graphic xlink:href="d-67-00355-efd25"/></disp-formula>The summation is over all atom pairs with distance less than <italic>r</italic>
                  <sub>max</sub>. The weights depend on the nature of the bonds as well as on the distance between the atoms. If atoms are bonded or angle-related then the weight is larger. However, the weight is smaller if the atoms are not related by covalent bonds. Moreover, if the distance between the atoms is more than 3 Å then the weight decreases as follows: <disp-formula id="fd26"><graphic xlink:href="d-67-00355-efd26"/></disp-formula>where <italic>w</italic>
                  <sub>0,<italic>ij</italic></sub> is the weight for nonbonded atoms that are closer than 3 Å to each other.</p>
      </sec>
      <sec id="sec2.6.7">
        <label>2.6.7.</label>
        <title>Rigid-bond restraints</title>
        <p>For anisotropic atoms there are so-called rigid-bond restraints, based on the idea of rigid-bond tests of anisotropic atoms (Hirshfeld, 1976<xref ref-type="bibr" rid="bb22"> ▶</xref>). The idea is that projections of <italic>U</italic> values on the bond vector joining two atoms should be similar. In other words, if two atoms are bonded then an oscillation across the bond is more likely than an independent oscillation along the bond. Atoms oscillate along the bond in a concerted fashion.</p>
        <p>Rigid-bond restraints are designed as follows. Let us assume that two atoms have positions <italic>x</italic>
                  <sub>1</sub> and <italic>x</italic>
                  <sub>2</sub> and their corresponding ADPs are <italic>U</italic>
                  <sub>1</sub> and <italic>U</italic>
                  <sub>2</sub>;  the unit vector joining these atoms is then calculated, <disp-formula id="fd27"><graphic xlink:href="d-67-00355-efd27"/></disp-formula>The projections of corresponding <italic>U</italic> values on this vector are then calculated as<disp-formula id="fd28"><graphic xlink:href="d-67-00355-efd28"/></disp-formula>Now, using these projections, the KL divergence is formed for all pairs and added to the target function: <disp-formula id="fd29"><graphic xlink:href="d-67-00355-efd29"/></disp-formula>Again, the weights depend on the nature of the bonds between the atoms and the distances between them. Note that if the ADPs of both bonded atoms are isotropic then the rigid-bond restraint is equivalent to the above-described KL restraint.</p>
      </sec>
      <sec id="sec2.6.8">
        <label>2.6.8.</label>
        <title>Sphericity restraints</title>
        <p>To avoid atoms exploding and becoming too elliptical or, even worse, non-elliptical, <italic>REFMAC</italic>5 uses restraints on sphericity. It is a simple restraint: an isotropic equivalent of the anisotropic tensor, <disp-formula id="fdu1"><graphic xlink:href="d-67-00355-efd30"/></disp-formula>where <italic>k</italic> indexes the anisotropic atoms, <italic>i</italic>, <italic>j</italic> are components of the anisotropic tensor and <italic>w<sub>k</sub></italic> are weights for this particular type of restraint. The weights depend on the number of other restraints (KL, rigid bond) on this atom. Atoms that have fewer restraints have stronger weights on sphericity, since these atoms are more likely to be unstable.</p>
        <p>It should be noted that similar restraints on ADPs are used in several other refinement programs (Sheldrick, 2008<xref ref-type="bibr" rid="bb55"> ▶</xref>; Adams <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb1"> ▶</xref>).</p>
      </sec>
    </sec>
  </sec>
  <sec id="sec3">
    <label>3.</label>
    <title>Parameterization</title>
    <sec id="sec3.1">
      <label>3.1.</label>
      <title>General parameters</title>
      <p><italic>REFMAC</italic>5 uses the standard parameterization of molecules in terms of atomic coordinates and isotropic/anisotropic atomic displacement parameters. The refinement of these parameters is performed using an FFT formulation for gradients and approximations for second derivatives. Details of these formulations have been published elsewhere (Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>, 1999<xref ref-type="bibr" rid="bb40"> ▶</xref>; Steiner <italic>et al.</italic>, 2003<xref ref-type="bibr" rid="bb62"> ▶</xref>). Once the gradients and approximate second derivatives have been calculated for these parameters, they are used to calculate the derivatives of derived parameters. Derived parameters include those for rigid-body and TLS refinement.</p>
    </sec>
    <sec id="sec3.2">
      <label>3.2.</label>
      <title>Rigid body</title>
      <p>Rigid-body parameterization is achieved as follows. For each rigid group, transformation operators are defined and new positions are calculated from the starting positions using the formula<disp-formula id="fd30"><graphic xlink:href="d-67-00355-efd31"/></disp-formula>where <italic>R<sub>j</sub></italic> is the rotation matrix, <italic>t</italic>
               <sub>origin</sub> is the centre of mass of the rigid group and <italic>t<sub>j</sub></italic> is the translational component of the transformation. The <italic>x</italic>
               <sub>old</sub> are the starting coordinates of the atoms and <italic>x</italic>
               <sub>new</sub> are their positions after application of the transformation operators. There are six parameters per rigid group, defining the rotation matrix and the translational component. At each cycle of refinement, an eigenvalue-filtering technique is used to avoid potential singularities arising from the shape of the rigid groups. It should be noted that no terms between rigid groups are calculated for the approximate second-derivative matrix. For large rigid groups this does not pose much of a problem. However, for many small rigid groups it may slow down convergence substantially. In any case, it is not recommended to divide molecules into very small rigid groups. For these cases, ‘jelly-body’ refinement should produce better results.</p>
      <p>Once derivatives with respect to the positional parameters have been calculated, those for rigid-body parameters are calculated using the chain rule. The current version of <italic>REFMAC</italic>5 uses an Euler angle parameterization.</p>
    </sec>
    <sec id="sec3.3">
      <label>3.3.</label>
      <title>TLS</title>
      <p>Atomic displacement parameters describe the spread of atomic positions and can be derived from the Fourier transform of a Gaussian probability distribution function for the atomic centre. The atomic displacement parameters are an important part of the model. Traditionally, a single parameter describing isotropic displacements has been used, namely the <italic>B</italic> factor. However, it is well known that atomic displacements are likely to be anisotropic owing to directional bonding and at high resolutions the six parameters per atom of a fully anisotropic model can be refined. TLS refinement is a way of modelling anisotropic displacements using only a few parameters, so that the method can be used at medium and low resolutions. The TLS model was originally proposed for small-molecule crystallography (Schomaker &amp; Trueblood, 1968<xref ref-type="bibr" rid="bb53"> ▶</xref>) and was incorporated into <italic>REFMAC</italic>5 almost ten years ago (Winn <italic>et al.</italic>, 2001<xref ref-type="bibr" rid="bb75"> ▶</xref>).</p>
      <p>The idea behind TLS is to suppose that groups of atoms move as rigid bodies and to constrain the anisotropic displace­ment parameters of these atoms accordingly. The rigid-body motion is described by translation (T), libration (L) and screw (S) tensors, using a total of 20 parameters for each rigid body. Given values for these 20 parameters, anisotropic displacement parameters can be derived for each atom in the group (and this relationship also allows one to calculate derivatives <italic>via</italic> the chain rule). Usually, an extra isotropic displacement parameter (the residual <italic>B</italic> factor) is refined for each atom in addition to the TLS contribution. The sum of these two con­tributions can be output using the supplementary program <italic>TLSANL</italic> (Howlin <italic>et al.</italic>, 1993<xref ref-type="bibr" rid="bb23"> ▶</xref>) or optionally directly from <italic>REFMAC</italic>5.</p>
      <p>TLS groups need to be chosen before refinement and constitute part of the definition of the model for the macromolecule. Groups of atoms should conform to the idea that they move as a quasi-rigid body. Often the choice of one group per chain suffices (or at least serves as a reference calculation) and this is the default in <italic>REFMAC</italic>5. More detailed choices can be made using methods such as <italic>TLSMD</italic> (Painter &amp; Merritt, 2006<xref ref-type="bibr" rid="bb45"> ▶</xref>). By default, <italic>REFMAC</italic>5 also includes waters in the first hydration shell, which it seems reasonable to assume move in concert with the protein chain.</p>
      <p>Fig. 4<xref ref-type="fig" rid="fig4"> ▶</xref> shows the effect of TLS refinement and orientation of libration tensors. In this case, TLS refinement improves <italic>R</italic>/<italic>R</italic>
               <sub>free</sub> and the derived libration tensors make biological sense.</p>
    </sec>
  </sec>
  <sec id="sec4">
    <label>4.</label>
    <title>Optimization</title>
    <p><italic>REFMAC</italic>5 uses the Gauss–Newton method for optimization. For an elegant and comprehensive review on optimization techniques, see Nocedal &amp; Wright (1999<xref ref-type="bibr" rid="bb43"> ▶</xref>). In this method, the exact second derivative is not calculated, but rather approximated to make sure it is always non-negative. Once derivatives or approximations have been calculated, the following linear equation is built, <disp-formula id="fd31"><graphic xlink:href="d-67-00355-efd32"/></disp-formula>where <italic>H</italic> is the approximate second derivative and <italic>G</italic> is the gradient vector. The contribution of most of the geometrical terms are calculated using algorithms designed for quadratic optimization or least-squares fitting (Press <italic>et al.</italic>, 1992<xref ref-type="bibr" rid="bb50"> ▶</xref>). To calculate the contribution from the Geman–McClure terms, the following approximation is used (Huber &amp; Ronchetti, 2009<xref ref-type="bibr" rid="bb24"> ▶</xref>), <disp-formula id="fd32"><graphic xlink:href="d-67-00355-efd33"/></disp-formula>This approximation ensures that <italic>H</italic> stays non-negative and consequently directions calculated as a result of the solution of (32)<xref ref-type="disp-formula" rid="fd32"/> point towards a reduction of the total function.</p>
    <p>The contribution of the X-ray term to the gradient is calculated using FFT algorithms (Murshudov <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb39"> ▶</xref>). The Fisher information matrix, as described by Steiner <italic>et al.</italic> (2003<xref ref-type="bibr" rid="bb62"> ▶</xref>), is used to calculate the contribution of the likelihood functions to the matrix <italic>H</italic>. Tests have demonstrated that using the diagonal elements of the Fisher information matrix and both diagonal and nondiagonal elements of the geometry terms results in a more stable refinement.</p>
    <p>Once all of the terms contributing to <italic>H</italic> and <italic>G</italic> have been calculated, the linear equation (32)<xref ref-type="disp-formula" rid="fd32"/> is solved using preconditioned conjugate-gradient methods (Nocedal &amp; Wright, 1999<xref ref-type="bibr" rid="bb43"> ▶</xref>; Tronrud, 1992<xref ref-type="bibr" rid="bb70"> ▶</xref>). A diagonal matrix formed by the diagonal elements of <italic>H</italic> is used as a preconditioner. This brings parameters with different overall scales (positional and <italic>B</italic> values) onto the same scale and controlling convergence becomes easier.</p>
    <p>If the conjugate-gradient procedure does not converge in <italic>N</italic>
            <sub>maxiter</sub> cycles (the default is 1000), then the diagonal terms of the <italic>H</italic> matrix are increased. Thus, if the matrix is not positive then ridge regression is activated. In the presence of a potential (near-) singularity, <italic>REFMAC</italic>5 uses the following procedure to solve the linear equation.<list list-type="simple"><list-item><p>(i) Define and use preconditioner. At this stage, <italic>H</italic> and <italic>G</italic> are modified. Define the new matrix by <italic>H</italic>
                     <sub>1</sub> and vector by <italic>G</italic>
                     <sub>1</sub>.</p></list-item><list-item><p>(ii) Set γ = 0.</p></list-item><list-item><p>(iii) Define a new matrix: <italic>H</italic>
                     <sub>2</sub> = <italic>H</italic>
                     <sub>1</sub> + γ<italic>I</italic>, where <italic>I</italic> is the identity matrix.</p></list-item><list-item><p>(iv) Solve the equation <italic>H</italic>
                     <sub>2</sub>
                     <italic>p</italic> = −<italic>G</italic>
                     <sub>1</sub> using the conjugate-gradient method for linear equations for sparse and positive-definite matrices (Press <italic>et al.</italic>, 1992<xref ref-type="bibr" rid="bb50"> ▶</xref>). If convergence was achieved in less than <italic>N</italic>
                     <sub>maxiter</sub> iterations, then proceed to the next step. Otherwise, increase γ and go to step (iii).</p></list-item><list-item><p>(v) Decondition the matrix, gradient and shift vectors.</p></list-item><list-item><p>(vi) Apply shifts to the atomic parameters, making sure that the ADPs are positive.</p></list-item><list-item><p>(vii) Calculate the value of the total function.</p></list-item><list-item><p>(viii) If the value of the total function is less than the previous value, then proceed to the next step. Otherwise, reduce the shifts and repeat steps (vi)–(viii).</p></list-item><list-item><p>(ix) Finish the refinement cycle.</p></list-item></list>After application of the shifts, the next cycle of refinement starts.</p>
  </sec>
  <sec sec-type="conclusions" id="sec5">
    <label>5.</label>
    <title>Conclusions</title>
    <p>Refinement is an important step in macromolecular crystal structure elucidation. It is used as a final step in structure solution, as well as as an intermediate step to improve models and obtain improved electron density to facilitate further model rebuilding.</p>
    <p><italic>REFMAC</italic>5 is one of the refinement programs that incorporates various tools to deal with some crystal peculiarities, low-resolution MX structure refinement and high-resolution refinement. There are also tabulated dictionaries of the constituent blocks of macromolecules, cofactors and ligands. The number of dictionary elements now exceeds 9000. There are also tools to deal with new ligands and covalent modifications of ligands and/or proteins.</p>
    <p>Low-resolution MX structure analysis is still a challenging task. There are several outstanding problems that need to be dealt with before we can claim that low-resolution MX analysis is complete. Statistics, image processing and computer science provide general methods for these and related problems. Unfortunately, these techniques cannot be directly applied to MX structure analysis, either because of the huge computer resources needed or because the assumptions used are not applicable to MX.</p>
    <p>In our opinion, the problems of state-of-the-art MX analysis that need urgent attention include the following.<list list-type="simple"><list-item><p>(i) Reparameterization depending on the quality and the amount of experimental data. Some tools implemented in <italic>REFMAC</italic>5 allow partial dealing with this problem. These tools include (<italic>a</italic>) restraining against known homologous structures, (<italic>b</italic>) ‘jelly-body’ restraints or refinement along implicit normal modes, (<italic>c</italic>) long-range ADP restraints based on KL divergence, (<italic>d</italic>) automatic local and global NCS restraints and (<italic>e</italic>) experimental phase-information restraints. However, low-resolution refinement and model (re)building is still not as automatic as for high-resolution structures.</p></list-item><list-item><p>(ii) Statistical methods for peculiar crystals with low signal-to-noise ratio. Some of the implemented tools, such as likelihood-based twin refinement and SAD/SIRAS refinement, help in the analysis of some of the data produced by such crystals. The analysis of data from such peculiar crystals as OD disorder with or without twinning, multiple cells, translocational disorder or modulated crystals in general remains problematic.</p></list-item><list-item><p>(iii) Another important problem is that of limited and noisy data. As a result of resolution cutoff (owing to the survival time of the crystal under X-ray irradiation or otherwise), the resultant electron density usually exhibits noise owing to series termination. If the resolution that the crystal actually diffracts to is the same as the resolution of the data, then series termination is not very serious as the signal dies out towards the limit of the resolution. However, in these cases the electron density becomes blurred, reflecting high mobility of the molecules or crystal disorder. When map sharpening is used, the signal is amplified and series termination becomes a serious problem. To reduce noise, it is necessary to work with the full Fourier transformation. In other words, resolution extension and the prediction of missing reflections becomes an important problem. The dramatic effect of such an approach for density modification at high resolution has been demonstrated by Altomare <italic>et al.</italic> (2008<xref ref-type="bibr" rid="bb3"> ▶</xref>) and Sheldrick (2008<xref ref-type="bibr" rid="bb55"> ▶</xref>). The direct replacement of missing reflections by calculated ones necessarily introduces bias towards model errors and may mask real signal. To avoid this, it is necessary to integrate over the errors in the model parameters (coordinates, <italic>B</italic> values, scale values and twin fractions). However, since the number of parameters is very large (sometimes exceeding 1 000 000), integration using available numerical techniques is not feasible.</p></list-item><list-item><p>(iv) Error estimation. Despite the advances in MX, there have been few attempts to evaluate errors in the estimated parameters. Works attempting to deal with this problem are few and far between (Sheldrick, 2008<xref ref-type="bibr" rid="bb55"> ▶</xref>). To complete MX structure analysis, it is necessary to develop and implement techniques for error estimation. If this is achieved, then incorrect structures could be eliminated while analysing the MX data and building the model. One of the promising approaches to this problem is the Gauss–Markov random field sampling technique (Hue &amp; Held, 2005<xref ref-type="bibr" rid="bb25"> ▶</xref>) using the (approximate) second derivative as a field-defining matrix.</p></list-item><list-item><p>(v) Multicrystal refinement with the simultaneous multicrystal averaging of isomorphous or non-isomorphous crystals is one of the important directions for low-resolution refinement. If it is dealt with properly then the number of structures analysed at low resolution should increase substantially.</p></list-item></list>
         </p>
    <p>Further improvement may consist of a combination of various experimental techniques. For example, the simultaneous treatment of electron-microscopy (EM) and MX data could increase the reliability of EM models and put MX models in the context of larger biological systems.</p>
    <p>The direct use of unmerged data is another direction in which refinement procedures could be developed. If this were achieved, then several long-standing problems could be easier to deal with. Two such problems are the following. (i) In general, the space group of a crystal should be considered as an adjustable parameter. If unmerged data are used, then space-group assumptions could be tested after every few sessions of refinement and model building. (ii) Dealing with the processes in the crystal during data collection requires unmerged data. One of the best-known such problems is radiation damage.</p>
  </sec>
</body>
<back>
  <ack>
    <p>We thank the CCP4 staff and CCP4 Bulletin Board participants for continuous stimulating discussions. We also thank the wider user community. Without their continuous feedback and bug reports, development of programs such as <italic>REFMAC</italic>5 would be impossible. This work was supported by <funding-source>Wellcome Trust</funding-source> Grant <award-id>No.</award-id> 064405/Z/01/A to GNM and FL. AAV was supported by a CCP4 grant, PS and NSP are supported by the Netherlandse Organisatie voor Wetenschappelijk Onderzoek (NWO), and AAL and RAN were supported by a BBSRC grant. CCP4 is supported by BBSRC grant BB/F0202281.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="bb1">
      <mixed-citation publication-type="other">Adams, P. D. <italic>et al.</italic> (2010). <italic>Acta Cryst.</italic> D<bold>66</bold>, 213–221.</mixed-citation>
    </ref>
    <ref id="bb2">
      <mixed-citation publication-type="other">Agarwal, R. C. (1978). <italic>Acta Cryst.</italic> A<bold>34</bold>, 791–809.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Altomare, A., Cuocci, C., Giacovazzo, C., Kamel, G. S., Moliterni, A. &amp; Rizzi, R. (2008). <italic>Acta Cryst.</italic> A<bold>64</bold>, 326–336.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Blanc, E., Roversi, P., Vonrhein, C., Flensburg, C., Lea, S. M. &amp; Bricogne, G. (2004). <italic>Acta Cryst.</italic> D<bold>60</bold>, 2210–2221.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Booth, A. (1946). <italic>Proc. R. Soc. Lond. A Math. Phys. Sci.</italic> 
               <bold>188</bold>, 77–92.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Bricogne, G. (1997).<italic> Methods Enzymol.</italic> 
               <bold>276</bold>, 361–423.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Bricogne, G. &amp; Irwin, J. (1996). <italic>Proceedings of the CCP4 Study Weekend. Macromolecular Refinement</italic>, edited by E. J. Dodson, M. Moore, A. Ralph &amp; S. Bailey, pp. 85–92. Warrington: Daresbury Laboratory.</mixed-citation>
    </ref>
    <ref id="bb8">
      <mixed-citation publication-type="other">Brünger, A. (1991). <italic>Annu. Rev. Phys. Chem.</italic> 
               <bold>42</bold>, 197–223.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Brünger, A. T. (1989). <italic>Acta Cryst.</italic> A<bold>45</bold>, 42–50.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Brünger, A. T., Adams, P. D., Clore, G. M., DeLano, W. L., Gros, P., Grosse-Kunstleve, R. W., Jiang, J.-S., Kuszewski, J., Nilges, M., Pannu, N. S., Read, R. J., Rice, L. M., Simonson, T. &amp; Warren, G. L. (1998). <italic>Acta Cryst.</italic> D<bold>54</bold>, 905–921.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Cochran, W. (1948). <italic>Acta Cryst.</italic> 
               <bold>1</bold>, 138–142.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Collaborative Computational Project, Number 4 (1994). <italic>Acta Cryst.</italic> D<bold>50</bold>, 760–763.</mixed-citation>
    </ref>
    <ref id="bb13">
      <mixed-citation publication-type="other">Cowtan, K. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 1002–1011.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Cruickshank, D. W. J. (1952). <italic>Acta Cryst.</italic> 
               <bold>5</bold>, 511–518.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="other">Cruickshank, D. W. J. (1956). <italic>Acta Cryst.</italic> 
               <bold>9</bold>, 747–753.</mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">DeLano, W. L. (2002). <italic>PyMOL.</italic> http://www.pymol.org.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Diamond, R. (1971). <italic>Acta Cryst.</italic> A<bold>27</bold>, 436–452.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Emsley, P. &amp; Cowtan, K. (2004). <italic>Acta Cryst.</italic> D<bold>60</bold>, 2126–2132.</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Geman, S. &amp; McClure, D. (1987). <italic>Bull. Int. Stat. Inst.</italic> 
               <bold>52</bold>, 5–21.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Guillot, B., Viry, L., Guillot, R., Lecomte, C. &amp; Jelsch, C. (2001). <italic>J. Appl. Cryst.</italic> 
               <bold>34</bold>, 214–223.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">Hendrickson, W. A. &amp; Lattman, E. E. (1970). <italic>Acta Cryst.</italic> B<bold>26</bold>, 136–143.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="other">Hirshfeld, F. L. (1976). <italic>Acta Cryst.</italic> A<bold>32</bold>, 239–244.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">Howlin, B., Butler, S. A., Moss, D. S., Harris, G. W. &amp; Driessen, H. P. C. (1993). <italic>J. Appl. Cryst.</italic> 
               <bold>26</bold>, 622–624.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">Huber, P. J. &amp; Ronchetti, E. M. (2009). <italic>Robust Statistics.</italic> Hoboken: John Wiley &amp; Sons.</mixed-citation>
    </ref>
    <ref id="bb25">
      <mixed-citation publication-type="other">Hue, H. &amp; Held, L. (2005). <italic>Gaussian Markov Random Field Models.</italic> Boca Raton: Chapman &amp; Hall/CRC.</mixed-citation>
    </ref>
    <ref id="bb26">
      <mixed-citation publication-type="other">Jack, A. &amp; Levitt, M. (1978). <italic>Acta Cryst.</italic> A<bold>34</bold>, 931–935.</mixed-citation>
    </ref>
    <ref id="bb27">
      <mixed-citation publication-type="other">Jiang, J.-A. &amp; Brünger, A. (1994). <italic>J. Mol. Biol.</italic> 
               <bold>243</bold>, 100–115.</mixed-citation>
    </ref>
    <ref id="bb28">
      <mixed-citation publication-type="other">Jones, T. A., Zou, J.-Y., Cowan, S. W. &amp; Kjeldgaard, M. (1991). <italic>Acta Cryst.</italic> A<bold>47</bold>, 110–119.</mixed-citation>
    </ref>
    <ref id="bb29">
      <mixed-citation publication-type="other">Konnert, J. H. (1976). <italic>Acta Cryst.</italic> A<bold>32</bold>, 614–617.</mixed-citation>
    </ref>
    <ref id="bb30">
      <mixed-citation publication-type="other">Konnert, J. H. &amp; Hendrickson, W. A. (1980). <italic>Acta Cryst.</italic> A<bold>36</bold>, 344–350.</mixed-citation>
    </ref>
    <ref id="bb31">
      <mixed-citation publication-type="other">Lebedev, A. A., Vagin, A. A. &amp; Murshudov, G. N. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 83–95.</mixed-citation>
    </ref>
    <ref id="bb32">
      <mixed-citation publication-type="other">Luzzati, V. (1951). <italic>Acta Cryst.</italic> 
               <bold>4</bold>, 367–369.</mixed-citation>
    </ref>
    <ref id="bb76">
      <mixed-citation publication-type="other">Luzzati, V. (1952). <italic>Acta Cryst.</italic> 
               <bold>5</bold>, 802–810.</mixed-citation>
    </ref>
    <ref id="bb33">
      <mixed-citation publication-type="other">Mardia, K. V. &amp; Bibby, J. E. (1979). <italic>Multivariate Analysis.</italic> London/San Diego: Academic Press.</mixed-citation>
    </ref>
    <ref id="bb34">
      <mixed-citation publication-type="other">Mardia, K. V. &amp; Jupp, P. E. (1999). <italic>Directional Statistics.</italic> Chichester: John Wiley &amp; Sons.</mixed-citation>
    </ref>
    <ref id="bb35">
      <mixed-citation publication-type="other">McKay, D. J. C. (2003). <italic>Information Theory, Inference and Learning Algorithms.</italic> Cambridge University Press.</mixed-citation>
    </ref>
    <ref id="bb36">
      <mixed-citation publication-type="other">McRee, D. E. &amp; Israel, M. (2008). <italic>J. Struct. Biol.</italic> 
               <bold>163</bold>, 208–213.</mixed-citation>
    </ref>
    <ref id="bb37">
      <mixed-citation publication-type="other">Mooij, W., Cohen, S., Joosten, K., Murshudov, G. &amp; Perrakis, A. (2009). <italic>Structure</italic>, <bold>17</bold>, 183–189.</mixed-citation>
    </ref>
    <ref id="bb38">
      <mixed-citation publication-type="other">Mouilleron, S. &amp; Golinelli-Pimpaneau, B. (2007). <italic>Protein Sci.</italic> 
               <bold>16</bold>, 485–493.</mixed-citation>
    </ref>
    <ref id="bb39">
      <mixed-citation publication-type="other">Murshudov, G. N., Vagin, A. A. &amp; Dodson, E. J. (1997). <italic>Acta Cryst.</italic> D<bold>53</bold>, 240–255.</mixed-citation>
    </ref>
    <ref id="bb40">
      <mixed-citation publication-type="other">Murshudov, G. N., Vagin, A. A., Lebedev, A., Wilson, K. S. &amp; Dodson, E. J. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 247–255.</mixed-citation>
    </ref>
    <ref id="bb41">
      <mixed-citation publication-type="other">Needleman, S. B. &amp; Wunsch, C. D. (1970). <italic>J. Mol. Biol.</italic> 
               <bold>48</bold>, 443–453.</mixed-citation>
    </ref>
    <ref id="bb42">
      <mixed-citation publication-type="other">Ness, S. R., de Graaff, R. A. G., Abrahams, J. P. &amp; Pannu, N. S. (2004). <italic>Structure</italic>, <bold>12</bold>, 1753–1761.</mixed-citation>
    </ref>
    <ref id="bb43">
      <mixed-citation publication-type="other">Nocedal, J. &amp; Wright, S. J. (1999). <italic>Numerical Optimization.</italic> New York: Springer.</mixed-citation>
    </ref>
    <ref id="bb44">
      <mixed-citation publication-type="other">O’Hagan, A. (1994). <italic>Kendal’s Advanced Theory of Statistics</italic>, Vol. 2B, <italic>Bayesian Inference.</italic> London: Hodder Arnold.</mixed-citation>
    </ref>
    <ref id="bb45">
      <mixed-citation publication-type="other">Painter, J. &amp; Merritt, E. A. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 439–450.</mixed-citation>
    </ref>
    <ref id="bb46">
      <mixed-citation publication-type="other">Pannu, N. S., Murshudov, G. N., Dodson, E. J. &amp; Read, R. J. (1998). <italic>Acta Cryst.</italic> D<bold>54</bold>, 1285–1294.</mixed-citation>
    </ref>
    <ref id="bb47">
      <mixed-citation publication-type="other">Pannu, N. S. &amp; Read, R. J. (1996). <italic>Acta Cryst.</italic> A<bold>52</bold>, 659–668.</mixed-citation>
    </ref>
    <ref id="bb48">
      <mixed-citation publication-type="other">Perrakis, A., Morris, S. &amp; Lamzin, V. S. (1999). <italic>Nature Struct. Biol.</italic> 
               <bold>6</bold>, 458–463.</mixed-citation>
    </ref>
    <ref id="bb49">
      <mixed-citation publication-type="other">Potterton, L., McNicholas, S., Krissinel, E., Gruber, J., Cowtan, K., Emsley, P., Murshudov, G. N., Cohen, S., Perrakis, A. &amp; Noble, M. (2004). <italic>Acta Cryst.</italic> D<bold>60</bold>, 2288–2294.</mixed-citation>
    </ref>
    <ref id="bb50">
      <mixed-citation publication-type="other">Press, W. H., Flannery, B. P., Teukolsky, S. A. &amp; Vetterling, W. T. (1992). <italic>Numerical Recipes in FORTRAN.</italic> Cambridge University Press.</mixed-citation>
    </ref>
    <ref id="bb51">
      <mixed-citation publication-type="other">R Development Core Team (2007). <italic>R: A Language and Environment for Statistical Computing.</italic> Vienna: R Foundation for Statistical Computing. http://www.R-project.org.</mixed-citation>
    </ref>
    <ref id="bb52">
      <mixed-citation publication-type="other">Ramachandran, G. N., Srinivasan, R. &amp; Sarma, V. R. (1963). <italic>Acta Cryst.</italic> 
               <bold>16</bold>, 662–666.</mixed-citation>
    </ref>
    <ref id="bb53">
      <mixed-citation publication-type="other">Schomaker, V. &amp; Trueblood, K. N. (1968). <italic>Acta Cryst.</italic> B<bold>24</bold>, 63–76.</mixed-citation>
    </ref>
    <ref id="bb56">
      <mixed-citation publication-type="other">Schröder, G. F., Brünger, A. T. &amp; Levitt, M. (2010). <italic>Nature (London)</italic>, <bold>464</bold>, 1218–1222.</mixed-citation>
    </ref>
    <ref id="bb54">
      <mixed-citation publication-type="other">Schüttelkopf, A. W. &amp; van Aalten, D. M. F. (2004). <italic>Acta Cryst.</italic> D<bold>60</bold>, 1355–1363.</mixed-citation>
    </ref>
    <ref id="bb55">
      <mixed-citation publication-type="other">Sheldrick, G. M. (2008). <italic>Acta Cryst.</italic> A<bold>64</bold>, 112–122.</mixed-citation>
    </ref>
    <ref id="bb58">
      <mixed-citation publication-type="other">Skubák, P., Murshudov, G. N. &amp; Pannu, N. S. (2004). <italic>Acta Cryst.</italic> D<bold>60</bold>, 2196–2201.</mixed-citation>
    </ref>
    <ref id="bb57">
      <mixed-citation publication-type="other">Skubák, P., Murshudov, G. &amp; Pannu, N. S. (2009). <italic>Acta Cryst.</italic> D<bold>65</bold>, 1051–1061.</mixed-citation>
    </ref>
    <ref id="bb59">
      <mixed-citation publication-type="other">Skubák, P., Waterreus, W.-J. &amp; Pannu, N. S. (2010). <italic>Acta Cryst.</italic> D<bold>66</bold>, 783–788.</mixed-citation>
    </ref>
    <ref id="bb60">
      <mixed-citation publication-type="other">Srinivasan, R. &amp; Parthasarathy, S. (1976). <italic>Some Statistical Applications in X-ray Crystallography.</italic> Oxford: Pergamon Press.</mixed-citation>
    </ref>
    <ref id="bb61">
      <mixed-citation publication-type="other">Srinivasan, R. &amp; Ramachandran, G. N. (1965). <italic>Acta Cryst.</italic> 
               <bold>19</bold>, 1008–1014.</mixed-citation>
    </ref>
    <ref id="bb62">
      <mixed-citation publication-type="other">Steiner, R. A., Lebedev, A. A. &amp; Murshudov, G. N. (2003). <italic>Acta Cryst.</italic> D<bold>59</bold>, 2114–2124.</mixed-citation>
    </ref>
    <ref id="bb63">
      <mixed-citation publication-type="other">Stuart, A. &amp; Ord, K. (2009). <italic>Kendall’s Advanced Theory of Statistics</italic>, Vol. 1, <italic>Distribution Theory.</italic> Hoboken: John Wiley &amp; Sons.</mixed-citation>
    </ref>
    <ref id="bb64">
      <mixed-citation publication-type="other">Stuart, A., Ord, K. &amp; Arnold, S. (2009). <italic>Kendall’s Advanced Theory of Statistics</italic>, Vol. 2A, <italic>Classical Inference.</italic> Hoboken: John Wiley &amp; Sons.</mixed-citation>
    </ref>
    <ref id="bb65">
      <mixed-citation publication-type="other">Sutton, G., Grimes, J., Stuart, D. &amp; Roy, P. (2007). <italic>Nature Struct. Mol. Biol.</italic> 
               <bold>14</bold>, 449–451.</mixed-citation>
    </ref>
    <ref id="bb66">
      <mixed-citation publication-type="other">Ten Eyck, L. F. (1977). <italic>Acta Cryst.</italic> A<bold>33</bold>, 486–492.</mixed-citation>
    </ref>
    <ref id="bb67">
      <mixed-citation publication-type="other">Terwilliger, T. C. (2003). <italic>Acta Cryst.</italic> D<bold>59</bold>, 1174–1182.</mixed-citation>
    </ref>
    <ref id="bb68">
      <mixed-citation publication-type="other">Tibshirani, R. J. (1997). <italic>Stat. Med.</italic> 
               <bold>16</bold>, 385–395.</mixed-citation>
    </ref>
    <ref id="bb69">
      <mixed-citation publication-type="other">Trion, M. M. (1996). <italic>Phys. Rev. Lett.</italic> 
               <bold>77</bold>, 1906–1908.</mixed-citation>
    </ref>
    <ref id="bb70">
      <mixed-citation publication-type="other">Tronrud, D. E. (1992). <italic>Acta Cryst.</italic> A<bold>48</bold>, 912–916.</mixed-citation>
    </ref>
    <ref id="bb71">
      <mixed-citation publication-type="other">Tronrud, D. E., Ten Eyck, L. F. &amp; Matthews, B. W. (1987). <italic>Acta Cryst.</italic> A<bold>43</bold>, 489–501.</mixed-citation>
    </ref>
    <ref id="bb72">
      <mixed-citation publication-type="other">Tronrud, G. (1997). <italic>Methods Enzymol.</italic> 
               <bold>277</bold>, 306–319.</mixed-citation>
    </ref>
    <ref id="bb73">
      <mixed-citation publication-type="journal">Turk, D. (2008). <italic>Acta Cryst.</italic> A<bold>64</bold>, C23.</mixed-citation>
    </ref>
    <ref id="bb74">
      <mixed-citation publication-type="other">Vagin, A. A., Steiner, R. A., Lebedev, A. A., Potterton, L., McNicholas, S., Long, F. &amp; Murshudov, G. N. (2004). <italic>Acta Cryst.</italic> D<bold>60</bold>, 2184–2195.</mixed-citation>
    </ref>
    <ref id="bb75">
      <mixed-citation publication-type="other">Winn, M. D., Isupov, M. N. &amp; Murshudov, G. N. (2001). <italic>Acta Cryst.</italic> D<bold>57</bold>, 122–133.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Fraction of the model correctly built by <italic>ARP</italic>/<italic>wARP</italic> v.7.0 iterated with <italic>REFMAC</italic>5 using different target functions. The maps inputted to model building were prepared by <italic>CRANK</italic> (Ness <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb42"> ▶</xref>). The sample consists of 102 data sets described in Skubák <italic>et al.</italic> (2010<xref ref-type="bibr" rid="bb59"> ▶</xref>).</p>
    </caption>
    <graphic xlink:href="d-67-00355-fig1"/>
  </fig>
  <fig id="fig2" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Behaviour of the Geman–McClure function <italic>versus</italic> the quadratic (least-squares) function. For small values of <italic>r</italic> they look similar, whereas for large values of <italic>r</italic> GM is less restrictive than least squares, allowing conformational changes to occur. Black line, GM = <italic>r</italic>
                  <sup>2</sup>/(1 + σ<sup>2</sup>
                  <italic>r</italic>
                  <sup>2</sup>) with σ = 0.5; red line, quadratic function <italic>r</italic>
                  <sup>2</sup>. This figure was produced using the software package <italic>R</italic> (R Development Core Team, 2007<xref ref-type="bibr" rid="bb51"> ▶</xref>).</p>
    </caption>
    <graphic xlink:href="d-67-00355-fig2"/>
  </fig>
  <fig id="fig3" position="float">
    <label>Figure 3</label>
    <caption>
      <p>Superposition of the structures of bluetongue virus VP4 enzyme with PDB entries <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=2jha">2jha</ext-link> (green) and <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=2jhp">2jhp</ext-link> (blue) (Sutton <italic>et al.</italic>, 2007<xref ref-type="bibr" rid="bb65"> ▶</xref>), which were solved at 3.4 and 2.5 Å, respectively. The graph shows the resultant <italic>R</italic> (solid) and <italic>R</italic>
                  <sub>free</sub> (dashed) values from ten iterations of refinement of the low-resolution structure <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=2jha">2jha</ext-link>. Results are shown with (red) and without (black) external restraints, using <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=2jhp">2jhp</ext-link> as prior information. This figure was produced using <italic>PROSMART</italic> to superpose the structures, <italic>PyMOL</italic> (DeLano, 2002<xref ref-type="bibr" rid="bb16"> ▶</xref>) to display the structures and the software package <italic>R</italic> (R Development Core Team, 2007<xref ref-type="bibr" rid="bb51"> ▶</xref>) to generate the graph.</p>
    </caption>
    <graphic xlink:href="d-67-00355-fig3"/>
  </fig>
  <fig id="fig4" position="float">
    <label>Figure 4</label>
    <caption>
      <p>TLS refinement of glucosamine-6-phosphate synthase (Mouilleron &amp; Golinelli-Pimpaneau, 2007<xref ref-type="bibr" rid="bb38"> ▶</xref>). The results for chain <italic>C</italic> are shown, which is separated into two TLS groups. Thermal ellipsoids derived from the TLS refinement are shown for the two groups. Those in red correspond to the ligand Fru6P which is included in the TLS group for the synthase domain. The yellow arrows show the principal axes of the libration tensor for each TLS group. Inclusion of TLS parameters led to a reduction in <italic>R</italic> and <italic>R</italic>
                  <sub>free</sub> of 3.4% and 3.8%, respectively, and could be related to the biological function. The principal axis of the libration tensor was calculated using <italic>TLSANL</italic> (Howlin <italic>et al.</italic>, 1993<xref ref-type="bibr" rid="bb23"> ▶</xref>) and the figure was prepared using <italic>CCP</italic>4<italic>mg</italic> (Potterton <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb49"> ▶</xref>).</p>
    </caption>
    <graphic xlink:href="d-67-00355-fig4"/>
  </fig>
</floats-group>
