<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3389763</article-id>
    <article-id pub-id-type="pmid">22556368</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bts252</article-id>
    <article-id pub-id-type="publisher-id">bts252</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group>
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SINA: Accurate high-throughput multiple sequence alignment of ribosomal RNA genes</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Pruesse</surname>
          <given-names>Elmar</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
        <xref ref-type="corresp" rid="COR1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Peplies</surname>
          <given-names>Jörg</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Glöckner</surname>
          <given-names>Frank Oliver</given-names>
        </name>
        <xref ref-type="aff" rid="AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="AFF1">
          <sup>2</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="AFF1"><sup>1</sup>Max Planck Institute for Marine Microbiology, Microbial Genomics Group, Celsiusstr.1, 28359 Bremen, <sup>2</sup>Jacobs University Bremen, School of Engineering and Sciences, Campusring 1, 28759 Bremen and <sup>3</sup>Ribocon GmbH, 28359 Bremen, Germany</aff>
    <author-notes>
      <corresp id="COR1">* To whom correspondence should be addressed.</corresp>
      <fn>
        <p>Associate Editor: Jonathan Wren</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>7</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>3</day>
      <month>5</month>
      <year>2012</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>3</day>
      <month>5</month>
      <year>2012</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>28</volume>
    <issue>14</issue>
    <fpage>1823</fpage>
    <lpage>1829</lpage>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>9</month>
        <year>2011</year>
      </date>
      <date date-type="rev-recd">
        <day>23</day>
        <month>4</month>
        <year>2012</year>
      </date>
      <date date-type="accepted">
        <day>24</day>
        <month>4</month>
        <year>2012</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2012. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2012</copyright-year>
      <license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/3.0">
        <license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/3.0">http://creativecommons.org/licenses/by-nc/3.0</ext-link>), which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> In the analysis of homologous sequences, computation of multiple sequence alignments (MSAs) has become a bottleneck. This is especially troublesome for marker genes like the ribosomal RNA (rRNA) where already millions of sequences are publicly available and individual studies can easily produce hundreds of thousands of new sequences. Methods have been developed to cope with such numbers, but further improvements are needed to meet accuracy requirements.</p>
      <p><bold>Results:</bold> In this study, we present the SILVA Incremental Aligner (SINA) used to align the rRNA gene databases provided by the SILVA ribosomal RNA project. SINA uses a combination of <italic>k</italic>-mer searching and partial order alignment (POA) to maintain very high alignment accuracy while satisfying high throughput performance demands.</p>
      <p>SINA was evaluated in comparison with the commonly used high throughput MSA programs PyNAST and mothur. The three BRAliBase III benchmark MSAs could be reproduced with 99.3, 97.6 and 96.1 accuracy. A larger benchmark MSA comprising 38 772 sequences could be reproduced with 98.9 and 99.3% accuracy using reference MSAs comprising 1000 and 5000 sequences. SINA was able to achieve higher accuracy than PyNAST and mothur in all performed benchmarks.</p>
      <p><bold>Availability:</bold> Alignment of up to 500 sequences using the latest SILVA SSU/LSU Ref datasets as reference MSA is offered at <ext-link ext-link-type="uri" xlink:href="http://www.arb-silva.de/aligner">http://www.arb-silva.de/aligner</ext-link>. This page also links to Linux binaries, user manual and tutorial. SINA is made available under a personal use license.</p>
      <p>
        <bold>Contact:</bold>
        <email>epruesse@mpi-bremen.de</email>
      </p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="SEC1">
    <title>1 INTRODUCTION</title>
    <p>Multiple sequence alignment (MSA) is a core building block in the analysis of biological sequence data. Phylogenetic tree reconstruction, structure prediction or hidden Markov modeling require MSA to infer residue-level homology or structural or functional identity. The ubiquitous need for MSA computation has made this field an active research topic with over 100 methods published in the past 30 years and numerous review papers discussing their relative merits and deficiencies (<xref ref-type="bibr" rid="B12">Kemena and Notredame, 2009</xref>; <xref ref-type="bibr" rid="B21">Notredame, 2007</xref>; <xref ref-type="bibr" rid="B22">Pei, 2008</xref>).</p>
    <p>The dependency of the subsequent analysis methods on the results of the MSA stage and the drastic effect differing MSAs can cause (<xref ref-type="bibr" rid="B15">Löytynoja and Goldman, 2008</xref>; <xref ref-type="bibr" rid="B17">Morrison and Ellis, 1997</xref>) make alignment accuracy the primary benchmark for novel and improved methods. The task of computing the optimal alignment [as determined by the Sum-of Pairs (SP) score] was shown to be non-deterministic polynomial (NP)-complete (<xref ref-type="bibr" rid="B28">Wang and Jiang, 1994</xref>), and is therefore only feasible for very few sequences. For sets of sequences, comprising several thousand or more sequences, heuristic algorithms are used. The most prevalent algorithms are based on the progressive alignment (<xref ref-type="bibr" rid="B10">Feng and Doolittle, 1987</xref>) technique, which builds the MSA via a series of pairwise alignments of sequences and partial alignments along the branches of a guide tree.</p>
    <p>Sequence data volumes are growing exponentially. This was already observed almost 20 years ago (<xref ref-type="bibr" rid="B24">Rice <italic>et al.</italic>, 1993</xref>), and the effect has not diminished since (<xref ref-type="bibr" rid="B14">Leinonen <italic>et al.</italic>, 2010</xref>). MSA has long been largely unaffected, because the numbers in which homologous gene sequences were available remained low. For many genes, however, this situation is changing. Especially frequently sequenced marker genes, such as the ribosomal RNA, are rapidly becoming available in volumes exceeding the scalability of traditional alignment techniques. In 2007, the first release of the SILVA SSU database contained over 353 366 small subunit rRNA (SSU) gene sequences (<xref ref-type="bibr" rid="B23">Pruesse <italic>et al.</italic>, 2007</xref>). Until September 2011, that database grew more than sevenfold to contain 2 494 582 sequences. The two other large rRNA databases, greengenes (<xref ref-type="bibr" rid="B5">DeSantis <italic>et al.</italic>, 2006a</xref>) and RDP (<xref ref-type="bibr" rid="B4">Cole <italic>et al.</italic>, 2009</xref>), are of similar size (<xref ref-type="bibr" rid="B2">Amaral-Zettler <italic>et al.</italic>, 2008</xref>). The large subunit rRNA (LSU), provided only by SILVA, grew only slightly slower. In 2007, the database contained 46 979 sequences. Currently, it contains almost six times as many sequences (269 498).</p>
    <p>Although each of these databases uses a different tool to compute their alignments, the used methods share one important characteristic: rather than computing an alignment <italic>de novo</italic>, the alignment of each individual sequence is derived from a static reference MSA. The reference MSA implicitly defines a fixed set of alignment columns into which the bases comprising the query sequence are placed. By avoiding mutual comparisons between the sequences considered for inclusion in the final MSA (candidate sequences), the alignment process becomes inherently scalable. Furthermore, the MSA offered by the database provider can be easily extended by database users in the same manner in which the MSA was originally constructed. This, in turn, allows using established alignment-based methods to analyze even large-volume next generation sequencing (NGS) datasets.</p>
    <p>The MSA provided by RDP II is computed using Infernal, which implements a model-based approach using a special form of stochastic context-free grammar (SCFG) termed covariance models (CM). These are similar to Hidden Markov Models (HMM) but are able to capture the co-variations caused by the highly conserved secondary structure of rRNAs (<xref ref-type="bibr" rid="B18">Nawrocki and Eddy, 2008</xref>; <xref ref-type="bibr" rid="B19">Nawrocki <italic>et al.</italic>, 2009</xref>). The Infernal model used by RDP II is computed from a set of several hundred carefully chosen sequences, which were manually aligned to match the well-known secondary structure of the 16S rRNA. The nearest alignment space termination (NAST) method <xref ref-type="bibr" rid="B6">DeSantis <italic>et al.</italic> (2006b</xref>) used by greengenes uses BLAST (<xref ref-type="bibr" rid="B1">Altschul <italic>et al.</italic>, 1990</xref>) to obtain a pairwise alignment between the candidate sequence and the best match in the reference MSA. The alignment is then used to map the candidate sequence into the reference MSA via a series of gap character reintroduction and removal operations. Improved implementations of the same principle have been published as PyNAST (<xref ref-type="bibr" rid="B3">Caporaso <italic>et al.</italic>, 2010</xref>) and as part of mothur (<xref ref-type="bibr" rid="B25">Schloss <italic>et al.</italic>, 2009</xref>). PyNAST uses UCLUST (<xref ref-type="bibr" rid="B9">Edgar, 2010</xref>) instead of BLAST, whereas mothur relies on its own implementations of a <italic>k</italic>-mer search to select the reference sequence and a Needleman–Wunsch type alignment algorithm to perform the pairwise alignment.</p>
    <p>In this study, we describe the SILVA Incremental Aligner (SINA) which is part of the rRNA gene processing pipeline of the SILVA ribosomal databases project.</p>
  </sec>
  <sec id="SEC2">
    <title>2 ALGORITHM</title>
    <p>Our algorithm is based on the assumption that the the sequences contained in the reference MSA are more likely to have a sibling relationship with the candidate sequence than to be direct ancestors or descendants. Because each sibling will have diverged differently from the common ancestor, some parts of the candidate sequence may be resembled most closely by one of the siblings while other parts are more similar to different siblings. Instead of seeking the optimal alignment with a single, best reference sequence (as is done by NAST) or optimizing the SP score between the candidate and all of its siblings, we attempt to align each part of the candidate with the most similar counterpart found in any sibling. To prevent arbitrary alignment in hypervariable regions, we further demand that consecutive “parts” must be joined by at least one mutually aligned, identical base.</p>
    <p>The optimal sequence of parts and the optimal alignment of the candidate with these parts can be found at the same time using dynamic programming. The algorithm used by SINA for this purpose is essentially equivalent to partial order alignment (POA) as described in <xref ref-type="bibr" rid="B13">Lee <italic>et al.</italic> (2002</xref>). The reference MSA is reduced to a directed acyclic graph (DAG) as shown in <xref ref-type="fig" rid="F1">Figure 1</xref>. Each node of the graph represents an evolutionarily unique base. That is, all identical bases sharing a column in the reference MSA are coalesced into one node. Gaps and the order of bases are represented by the graph topology: two nodes are connected exactly if there is a sequence in which the two bases they represent occur consecutively. Thus, there is exactly one path through the graph for each combination of “parts” as defined above. By applying a Needleman–Wunsch (<xref ref-type="bibr" rid="B20">Needleman and Wunsch, 1970</xref>) modified to allow a DAG along one axis we obtain the least costly alignment of the candidate and the corresponding path.
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>The alignment of the selected reference sequences is converted from RC-MSA representation (top) to PO-MSA representation (bottom)</p></caption><graphic xlink:href="bts252f1"/></fig></p>
    <p>The time and space complexity of the alignment stage is decoupled from the size of the entire reference MSA by prefixing a sequence selection stage. This stage chooses a small set of sequences from the results of a heuristic similarity search. The DAG used as alignment template is constructed from these sequences only.</p>
    <p>The fixed-column constraint necessary to allow concatenation of the individually aligned sequences into a joint MSA is maintained during DP alignment using a further modification of the Needleman–Wunsch algorithm.</p>
    <sec id="SEC2.1">
      <title>2.1 Reference sequence selection</title>
      <p>The sequences to be used in building the alignment template are assembled from the result of a <italic>k</italic>-mer sequence search on the reference MSA. SINA does not implement this search itself but uses a component from the ARB software package called the PT server (<xref ref-type="bibr" rid="B16">Ludwig <italic>et al.</italic>, 2004</xref>). The PT server offers several parameters to configure the <italic>k</italic>-mer search, all of which are exposed by the SINA command line interface. These parameters are: (i) the value of <italic>k</italic>. (ii) a number of allowable mismatches at arbitrary positions within each <italic>k</italic>-mer. (iii) a range of alignment columns to which the search for shared <italic>k</italic>-mers is restricted. (iv) a fast mode which searches only for <italic>k</italic>-mers beginning with ‘A’. (v) a ‘non-relative’ mode which computes the fractional <italic>k</italic>-mer count by dividing the number of shared <italic>k</italic>-mers by the query length rather than by the minimum of the lengths of query and matched sequence.</p>
      <p>On basis of the findings in <xref ref-type="bibr" rid="B7">Edgar (2004a</xref>), we apply a logarithmic transformation to obtain a measure in approximately linear relationship with fractional identity. Here, <italic>F</italic> is the fractional <italic>k</italic>-mer count, <italic>L</italic><sub>q</sub> is the length of the query sequence and <italic>Y</italic> is the obtained measure.
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="bts252m1"/></disp-formula></p>
      <p>After executing the search, SINA iterates through the matches in order of descending identity and decides according to the following rules and parameters which sequences are to be kept and passed into the alignment template construction stage. (i) The first <italic>fs-min</italic> sequences are always kept. (ii) Up to <italic>fs-max</italic> sequences are kept if their similarity to the candidate is at least <italic>fs-msc</italic>. (iii) Further sequences of at least <italic>fs-full-len</italic> bases length are kept independent of their match score until the set of selected sequences contains at least <italic>fs-req-full</italic> such sequences. (iv) Further sequences are kept if they cover the start and end of the gene as determined by the alignment positions <italic>gene-start</italic> and <italic>gene-end</italic> until at least <italic>fs-cover-gene</italic> such sequences have been found. The latter two rules are designed to ensure that the outer edges of the alignment are covered even if the reference alignment contains partial sequences.</p>
      <p>As a performance optimization, the candidate sequence is compared to all sequences in the reference set. If it is found to be contained in one of them, the candidate sequence is aligned by simply copying the matching part of the alignment of the reference sequence. An explaining remark is made in the log and the remaining alignment stages are skipped.</p>
    </sec>
    <sec id="SEC2.2">
      <title>2.2 Construction of alignment template</title>
      <p>We use a DAG to represent the selected set of aligned reference sequences. The nodes of this graph correspond to unique base-column combinations in the reference sequences. The nodes are linked by edges if the corresponding bases occur consecutively in any of the reference sequences (<xref ref-type="fig" rid="F1">Fig. 1</xref>). Consider the aligned reference sequences as lists of base-column pairs. Then, for each such sequence, there is a path in the graph comprising an equivalent list of nodes. This type of graph is described as ‘partial order MSA’ (PO-MSA) by <xref ref-type="bibr" rid="B13">Lee <italic>et al.</italic> (2002</xref>). The term expresses that the structure itself only imposes a partial order on the bases comprising the alignment, whereas the traditional ‘row-column MSA’ (RC-MSA) representation imposes a total order. When storing a list of sequence identifiers with each edge, exact conversion between the two representations is possible.</p>
      <p>Our method of constructing a PO-MSA from a RC-MSA and the data stored within the nodes differs slightly from the method described in <xref ref-type="bibr" rid="B13">Lee <italic>et al.</italic> (2002</xref>). We preserve the frequency of the represented base in its column to be used as a weight during the alignment process. Also, we do not construct the PO-MSA by iteratively adding sequences and merging those nodes that represent homologous bases. Instead, we use a scan-line algorithm passing horizontally through the input RC-MSA: For each sequence <italic>S</italic><sub><italic>i</italic></sub> in the RC-MSA the last created node <italic>N</italic><sub><italic>i</italic></sub> is remembered. We then pass through all alignment columns <italic>j</italic>. In each column, one node is created for each non-gap character encountered. For each sequence <italic>S</italic><sub><italic>k</italic></sub> in which the character was encountered, an edge from the last remembered node <italic>N</italic><sub><italic>k</italic></sub> is created to the new node and the new node is remembered as <italic>N</italic><sub><italic>k</italic></sub>. After all columns have been processed, duplicate edges are removed.</p>
    </sec>
    <sec id="SEC2.3">
      <title>2.3 Dynamic programming alignment</title>
      <p>To align a candidate sequence with an alignment template in PO-MSA format, we extend the dynamic programming recursion from the Needleman–Wunsch algorithm. Our extension is similar to that used by POA. In Needleman–Wunsch and its derivative algorithms, two sequences <italic>A</italic> and <italic>B</italic> are aligned by computing a matrix <italic>H</italic> such that the value of <italic>H</italic><sub><italic>i</italic>,<italic>j</italic></sub> is the optimal score for the alignment of the prefixes <italic>A</italic><sub>1</sub>… <italic>A</italic><sub><italic>i</italic></sub> and <italic>B</italic><sub>1</sub>… <italic>B</italic><sub><italic>j</italic></sub> of lengths <italic>i</italic> and <italic>j</italic> of the sequences <italic>A</italic> and <italic>B</italic>. The value of each cell <italic>H</italic><sub><italic>i</italic>,<italic>j</italic></sub> is defined as a function of the scores of the three prefix pairs where either one or both of the prefixes is one item shorter. Given a function <italic>S</italic>(<italic>i</italic>,<italic>j</italic>) defining the matching score for <italic>A</italic><sub><italic>i</italic></sub> and <italic>B</italic><sub><italic>j</italic></sub> and using <italic>g</italic> as the score for a gap, we have:
<disp-formula id="M2"><label>(2)</label><graphic xlink:href="bts252m2"/></disp-formula></p>
      <p>This recursion is generalized to allow using a PO-MSA instead of one of the sequences by replacing the notion of ‘prefix of length <italic>i</italic>’ with ‘path leading up to node <italic>A</italic><sub><italic>i</italic></sub>’. Leaving <italic>B</italic> as a sequence, <italic>H</italic><sub><italic>i</italic>,<italic>j</italic></sub> then becomes the optimal score of the alignment of the prefix of <italic>B</italic> of length <italic>j</italic> with any path in <italic>A</italic> leading to <italic>A</italic><sub><italic>i</italic></sub>. Using <italic>A</italic><sub><italic>p</italic></sub>→<italic>A</italic><sub><italic>i</italic></sub> to denote that an edge from <italic>A</italic><sub><italic>p</italic></sub> to <italic>A</italic><sub><italic>i</italic></sub> exists, we arrive at:
<disp-formula id="M3"><label>(3)</label><graphic xlink:href="bts252m3"/></disp-formula></p>
      <sec id="SEC2.3.1">
        <title>2.3.1 Affine gap penalties</title>
        <p>To support affine gap penalties of the form <italic>g</italic><sub><italic>k</italic></sub>=<italic>g</italic><sub>open</sub>+(<italic>k</italic> − 1)<italic>g</italic><sub>extend</sub>, SINA uses a further extension of this induction, modified in the same way as was shown by Gotoh for the original induction (<xref ref-type="bibr" rid="B11">Gotoh, 1982</xref>):
<disp-formula id="M4"><label>(4)</label><graphic xlink:href="bts252m4"/></disp-formula>
<disp-formula id="M5"><label>(5)</label><graphic xlink:href="bts252m5"/></disp-formula>
<disp-formula id="M6"><label>(6)</label><graphic xlink:href="bts252m6"/></disp-formula></p>
      </sec>
    </sec>
    <sec id="SEC2.4">
      <title>2.4 Scoring</title>
      <p>Although SINA supports the use of arbitrary substitution matrices to define <italic>S</italic>(<italic>i</italic>,<italic>j</italic>), the default is to use 2 as the score for matching bases and -1 for mismatching bases. IUPAC encoded ambiguities are treated as a match if a match is conceivable (i.e., ‘N’ matches anything).</p>
      <p>SINA also implements two methods for weighting <italic>S</italic>(<italic>i</italic>,<italic>j</italic>) according to the variability in the reference MSA: (i) the score is multiplied with the frequency with which the base <italic>A</italic><sub><italic>i</italic></sub> occurs among the selected reference sequences in column <italic>i</italic> according to a configurable scaling factor. (ii) the score is multiplied with a per-column conservation indicator derived from a conservation profile computed within ARB (‘positional variability by parsimony (PVP)’, see <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Supplementary Materials</ext-link>). After POA sequence alignment, the total score is normalized via division by the sum of the weighted rewards for a match in each template column contributing to the alignment.</p>
    </sec>
    <sec id="SEC2.5">
      <title>2.5 Treatment of sequence ends</title>
      <p>SINA uses what is sometimes referred to as ‘overlap’ alignment. Although global alignment allows no unaligned sequence tails and local alignment allows both sequences to have unaligned tails, overlap alignment allows only one unaligned tail at either end. At both ends, either the candidate sequence or the template is aligned until its last base. The cost-free terminal gap is achieved by initializing <italic>H</italic><sub>0,<italic>j</italic></sub> and <italic>H</italic><sub><italic>i</italic>,0</sub> with 0 and choosing the best scoring cell <italic>H</italic><sub><italic>i</italic>,<italic>j</italic></sub> where at least <italic>A</italic><sub><italic>i</italic></sub> or <italic>B</italic><sub><italic>j</italic></sub> has no successor to start the backtracking through the alignment matrix.</p>
      <p>Three policies are provided for dealing with the unaligned sequence tails: (i) The unaligned bases may be omitted from the final alignment. (ii) The unaligned bases may be placed consecutively following the outermost aligned base. (iii) The unaligned bases may be placed at the out-most columns of the MSA.</p>
    </sec>
    <sec id="SEC2.6">
      <title>2.6 Treatment of insertions</title>
      <p>The alignment of the candidate with the PO-MSA yields column positions only for substitution events (matches and mismatches). Although deletions in the candidate with respect to the reference sequences pose no problem, appropriate column positions must be determined for inserted bases. If the number of alignment positions between the two bases enclosing an insertion, that is the size of the gap in the reference alignment, is larger than the insertion, the insertion is placed right-bound in this gap. SINA offers three choices for dealing with insertions that cannot be accommodated by the reference MSA: (i) The insertion may be shortened as required by erasing bases. (ii) The bases surrounding the insertion may be shifted outwards. (iii) A modified DP algorithm may be used that disallows insertions not mappable to the reference MSA.</p>
      <p>Our base shifting algorithm is a greedy search for free alignment positions to the left and right of the insertion which we believe to be equivalent to NAST. If the gap closest to the insertion is of insufficient size, the bases between this gap and the original insertion are included in the insertion and the process repeated until the insertion can be placed.</p>
      <p>As an alternative option, we further extended the DP alignment to observe constrained alignment space by only considering gap open and gap extension events that can be accommodated by the reference MSA. For a node <italic>A</italic><sub><italic>i</italic></sub> in the template DAG, the amount of free columns <italic>f</italic><sub><italic>i</italic></sub> to the right of it is defined as the difference between its alignment position and the lowest alignment position of its immediate successor nodes minus one. Ignoring gap extension, the induction defining <italic>H</italic> becomes:
<disp-formula id="M7"><label>(7)</label><graphic xlink:href="bts252m7"/></disp-formula></p>
      <p>Note that this is equivalent to using a cost function for gaps which assigns an infinite penalty for inserting a gap into the reference alignment. However, the Gotoh optimization for DP alignment with affine gap penalties requires the cost for extending gaps to be monotonically decreasing (<xref ref-type="bibr" rid="B11">Gotoh, 1982</xref>). Nonetheless, we have implemented an analogous extension, aware that the induction we use constitutes a loss of optimality where alignment space is insufficient. <italic>F</italic><sub><italic>i</italic>,<italic>j</italic></sub> is set to <italic>f</italic><sub><italic>i</italic></sub> when <italic>Q</italic><sub><italic>i</italic>,<italic>j</italic></sub> is based on a gap open event and set to <italic>F</italic><sub><italic>i</italic>,<italic>j</italic>−1</sub>−1 if <italic>Q</italic><sub><italic>i</italic>,<italic>j</italic></sub> is based on a gap extension.
<disp-formula id="M8"><label>(8)</label><graphic xlink:href="bts252m8"/></disp-formula>
<disp-formula id="M9"><label>(9)</label><graphic xlink:href="bts252m9"/></disp-formula></p>
    </sec>
  </sec>
  <sec id="SEC3">
    <title>3 IMPLEMENTATION</title>
    <p>SINA has been implemented in C++ making heavy use of generic programming techniques. External components used include several BOOST libraries, the ARB database library and the ARB PT server. ARB and FASTA formats are supported for sequence input and output. Per sequence meta data can be exported via ARB database fields, FASTA headers, FASTA comments or a separate file in comma-separated value (CSV) format. The reference MSA must be in ARB format. Conversion of reference alignments from FASTA to ARB format is possible with SINA</p>
    <sec id="SEC3.1">
      <title>3.1 Reverse complement detection</title>
      <p>If instructed, SINA will execute the <italic>k</italic>-mer search multiple times using the reversed and/or complemented candidate sequence. If an orientation different to the original yields a better best scoring match, the candidate is transformed accordingly.</p>
    </sec>
    <sec id="SEC3.2">
      <title>3.2 Sequence search and classification</title>
      <p>We also implemented a simple search and classify stage. The search uses the alignment (as computed by SINA or by an external tool) to quickly determine fractional identities. Both an exhaustive search and a quick search considering only the best matches from a <italic>k</italic>-mer search can be performed.</p>
      <p>Also, a least common ancestor (LCA) classification can be performed if the searched database contains taxonomy data in materialized path format. LCA classification can be relaxed to allow a percentage of outliers.</p>
    </sec>
    <sec id="SEC3.3">
      <title>3.3 Visualization of alignment differences</title>
      <p>Manual inspection of the alignment differences (resulting, for example, from different tools, changed parameters or modifications to the reference MSA) is supported via a differencing function. This function prints a coloured RC-MSA representation of the sections of the alignment in which the reference alignment and the alignment to be inspected differ. Columns containing only gap characters are removed from this view. The reference sequences used to construct the PO-MSA template are listed together with the new and the original alignment. If the SINA alignment stage was bypassed, the SINA search stage can be used to select suitable sequences for display in combination with the two different alignments of the candidate. Rows are consolidated such that only unique alignments remain.</p>
    </sec>
    <sec id="SEC3.4">
      <title>3.4 Parameter tuning</title>
      <p>The default parameter settings in SINA were tuned for the alignment of SSU rRNA gene sequences. To simplify determining correct parameters for other genes, SINA offers automated evaluation of alignment accuracy using a leave-query-out approach. In this mode, each sequence in the reference alignment is newly aligned (excluding the sequence itself from the set of selected reference sequences), the result compared to the original alignment and the average scores reported. Alignment parameters such as match and mismatch scores, gap penalties or <italic>k</italic>-mer length can then be adjusted to maximize this score.</p>
      <p>To simulate more difficult alignment cases where the candidate sequence is distant to the closest match in the reference MSA, reference sequence selection may be constrained using a maximum identity parameter. The identity of each sequence considered during reference sequence selection with the candidate sequence is computed using their original alignments. Sequences with an identity higher than the configured threshold are discarded and not included in computing the alignment template.</p>
    </sec>
  </sec>
  <sec id="SEC4">
    <title>4 EVALUATION OF SINA</title>
    <p>MSA computation methods are generally validated by quantifying their ability to accurately reproduce benchmark MSAs known to be of high quality. The degree to which a tool was able to reproduce the benchmark MSA is measured by determining the fraction of exactly reproduced alignment columns [CS score (<xref ref-type="bibr" rid="B27">Thompson <italic>et al.</italic>, 2011</xref>)] and the fraction of correctly aligned residue pairs [Q score (<xref ref-type="bibr" rid="B8">Edgar, 2004b</xref>), also called SP-score (<xref ref-type="bibr" rid="B26">Thompson <italic>et al.</italic>, 1999</xref>)]. This measure was used in the evaluation of SINA. However, we expect significantly higher scores than commonly achieved by <italic>de novo</italic> methods (see Discussion).</p>
    <p>For evaluation, we used the three MSAs provided with BRaliBase III (5S rRNA, tRNA and U5) and the manually aligned subsets of the MSAs provided by SILVA (SSU and LSU). The SILVA alignments where chosen because they are the largest manually created alignments available to us. The BRaliBase alignments were chosen to complement the SILVA alignments with test data from a source not affiliated in any way with the authors of this article. The SSU and LSU test data were generated by excluding all sequences in the SILVA databases that were themselves aligned by SINA, leaving only manually aligned sequences from the SILVA seed. This test data are equal to the published subsets of the SILVA seed alignments. The SILVA seed alignments are based on alignments published by the ARB project in 2004. During construction and maintenance of the SILVA seed, sequences were removed if they could not be aligned unambiguously and new sequences added to enhance phylogenetic coverage. All sequences in the seed (and therefore in the test data) were aligned manually by rRNA alignment experts. The alignment itself is guided strongly by the secondary and tertiary structure of the respective rRNA. The SSU and LSU test data are made available at <ext-link ext-link-type="uri" xlink:href="ftp.arb-silva.de/SINA/test_data/">ftp.arb-silva.de/SINA/test_data/</ext-link>.</p>
    <p>We compared SINA with the NAST implementations by mothur and PyNAST. The align.seqs command from mothur (version 1.19.1) was used with default parameters. PyNAST (version 1.1, UCLUST version v1.2.exportedq, cogent version 1.5.0) was used with identity threshold below which it refuses alignment lowered to 0.0001. Minimal reference sequence length was set to 50 for SINA and PyNAST. SINA (version 1.2.8) was also configured with appropriate values for full-length sizes (5S rRNA: 120, tRNA: 80, U5: 80, SSU: 1400, LSU: 2900). The <italic>k</italic>-mer size used by SINA was lowered to eight for the tRNA and U5.</p>
    <p>Three different benchmarks were performed, one using the four smaller MSAs and two using the large SSU MSA. The three benchmarks differ in the way the benchmark MSA is split into the set of sequences to be used as a reference MSA and the set to be used for measuring the alignment accuracy. Because all three tools expect sizable reference MSAs, the benchmark based on the four smaller MSAs follows a ‘leave-query-out’ scheme: every sequence in the benchmark MSA is aligned using all other sequences as reference MSA (benchmark 1). The SSU MSA is large enough to create reference MSAs of different size by randomly sampling sequences. Sampling was repeated 100 times, once using 1000 sequences and once using 5000 sequence. Candidate sequence sets of equal size were sampled from the remaining sequences.</p>
    <p>The typical identity between each candidate and its best matching reference sequence remains very high, even when sampling a reference MSA of only 1000 sequences. To obtain more difficult test cases having lower rates of identity, we constrained the reference sequence selection algorithm to exclude sequences above a cut-off value (see section parameter tuning). Using 21 cut-off values between 50 and 100% at 2.5% intervals (100% being equivalent to leave-query-out benchmarking), we examined the accuracy in relation to the identity of the candidate with the reference. This benchmark was repeated for numerous sets of parameter settings and also used for parameter optimization (benchmark 2).</p>
    <p>Lastly, we repeated benchmark 2 with an alternative alignment template implementation relying on column profiles rather than a PO-MSA for comparison. All other settings including the selection of reference sequences remained identical to the original benchmark 2.</p>
  </sec>
  <sec id="SEC5">
    <title>5 RESULTS</title>
    <p>Table 5 shows that SINA performed better than both mothur and PyNAST for all MSAs used in the leave-query-out benchmarks. Friedman rank tests using the results for each sequence as blocks showed significant <italic>P</italic>-values (2*10<sup>−5</sup>) for all pairs of tools in each data-set except PyNAST vs mothur in the U5 dataset (0.55).
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>Results from leave-query-out benchmarks</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">5S rRNA</th><th rowspan="1" colspan="1">tRNA</th><th rowspan="1" colspan="1">U5</th><th rowspan="1" colspan="1">SILVA LSU</th></tr><tr><th rowspan="1" colspan="1">Dataset sequences</th><th rowspan="1" colspan="1">597 (%)</th><th rowspan="1" colspan="1">1113 (%)</th><th rowspan="1" colspan="1">232 (%)</th><th rowspan="1" colspan="1">1588 (%)</th></tr></thead><tbody><tr><td rowspan="1" colspan="1">PyNAST</td><td rowspan="1" colspan="1">98.6</td><td rowspan="1" colspan="1">96.4</td><td rowspan="1" colspan="1">94.0</td><td rowspan="1" colspan="1">98.9</td></tr><tr><td rowspan="1" colspan="1">mothur</td><td rowspan="1" colspan="1">97.5</td><td rowspan="1" colspan="1">92.1</td><td rowspan="1" colspan="1">93.3</td><td rowspan="1" colspan="1">98.9</td></tr><tr><td rowspan="1" colspan="1">SINA</td><td rowspan="1" colspan="1">99.3</td><td rowspan="1" colspan="1">97.6</td><td rowspan="1" colspan="1">96.1</td><td rowspan="1" colspan="1">99.2</td></tr></tbody></table><table-wrap-foot><fn><p>The reported percentages are the average Q scores. Only sequences aligned by all three tools where considered.</p></fn></table-wrap-foot></table-wrap>
<table-wrap id="T2" position="float"><label>Table 2.</label><caption><p>Results using test data sampled from the SILVA SSU dataset</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1"/><th colspan="2" rowspan="1">All SSU samples</th><th colspan="2" rowspan="1">&lt;80 % Identity</th></tr></thead><tbody><tr><td rowspan="1" colspan="1">Reference size</td><td rowspan="1" colspan="1">1000</td><td rowspan="1" colspan="1">5000</td><td rowspan="1" colspan="1">1000</td><td rowspan="1" colspan="1">5000</td></tr><tr><td rowspan="1" colspan="1">sequences</td><td rowspan="1" colspan="1">100 000</td><td rowspan="1" colspan="1">500 000</td><td rowspan="1" colspan="1">5443</td><td rowspan="1" colspan="1">8811</td></tr><tr><td rowspan="1" colspan="1">mean identity (%)</td><td rowspan="1" colspan="1">92.34</td><td rowspan="1" colspan="1">95.24</td><td rowspan="1" colspan="1">75.71</td><td rowspan="1" colspan="1">75.9</td></tr><tr><td colspan="5" rowspan="1"><hr/></td></tr><tr><td rowspan="1" colspan="1">(PyNAST<sup>1</sup>) (%)</td><td rowspan="1" colspan="1">96.7</td><td rowspan="1" colspan="1">97.6</td><td rowspan="1" colspan="1">90</td><td rowspan="1" colspan="1">89</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">(0.20)</td><td rowspan="1" colspan="1">(0.08)</td><td rowspan="1" colspan="1">(1.7)</td><td rowspan="1" colspan="1">(1.5)</td></tr><tr><td rowspan="1" colspan="1">mothur (%)</td><td rowspan="1" colspan="1">96.6</td><td rowspan="1" colspan="1">97.8</td><td rowspan="1" colspan="1">88</td><td rowspan="1" colspan="1">88</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">(0.23)</td><td rowspan="1" colspan="1">(0.07)</td><td rowspan="1" colspan="1">(2.0)</td><td rowspan="1" colspan="1">(1.3)</td></tr><tr><td rowspan="1" colspan="1">SINA (%)</td><td rowspan="1" colspan="1">98.9</td><td rowspan="1" colspan="1">99.3</td><td rowspan="1" colspan="1">94</td><td rowspan="1" colspan="1">93</td></tr><tr><td rowspan="1" colspan="1"/><td rowspan="1" colspan="1">(0.12)</td><td rowspan="1" colspan="1">(0.03)</td><td rowspan="1" colspan="1">(1.2)</td><td rowspan="1" colspan="1">(1.1)</td></tr></tbody></table><table-wrap-foot><fn><p>The average Q scores shown were obtained by randomly sampling sequences from the SILVA SSU-based test data to create 100 reference MSAs and benchmark sets. This was repeated once with a reference MSA size of 1000 and once with a size of 5000. The SD between Q score averages from each of the 100 reference MSAs is shown in parentheses. The two columns on the right show the results when considering only difficult cases where the candidate sequences have &lt;80% identity with all sequences in the respective reference MSA.</p></fn><fn id="TF1"><p><sup>a</sup> PyNAST failed to align 0.5% of the sequences.</p></fn></table-wrap-foot></table-wrap>
</p>
    <p>Table 5 shows the results for the benchmarks using candidate sequences and reference MSAs sampled from the SSU dataset. We show the average Q scores from all successfully aligned sequences, although this slightly inflates the scores for PyNAST which failed to align all candidate sequences. Lowering the identity threshold below which alignment is refused by PyNAST to 0.0001 reduced the number of failed alignments. However, of the 100 000 sequences aligned using 1 k reference MSAs, PyNAST still failed to align 547. Of the 500 000 sequences aligned using 5 k reference MSAs PyNAST failed to align 2750 sequences. The average Q scores achieved by mothur for the sequences refused by PyNAST were 91.36 and 94.8%, respectively. The average Q scores achieved by SINA for these sequences were 97.45 and 98.46%.</p>
    <p>In addition to the average Q scores, we show the SD between averages computed for each of the 100 samples. The variance between tests is much lower than the differences between tools, indicating that the reported Q score averages are sufficiently robust for comparing the tools. Pearson rank tests using the per sample averages as blocks showed P-values below 2×10<sup>−5</sup> for all pairs of tools except PyNAST versus mothur in the 1 k reference MSA benchmarks.</p>
    <p>The second benchmark showed marked differences in alignment accuracy for varying reference sequence set sizes. The average Q scores rises over all identity thresholds with each increase in the number of reference sequences used. Above 40 sequences, the effect tapers off (<xref ref-type="fig" rid="F2">Fig. 2</xref>, <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Supplementary Fig. S1</ext-link>). The same can be observed for the average fraction of bases that were part of an insertion with respect to the template PO-MSA (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S2</ext-link>). Configuring SINA to use a column profile as alignment template yielded lower accuracy (<xref ref-type="fig" rid="F3">Fig. 3</xref>). Especially, when candidate and reference sequences share a lower fractional identity, alignment accuracy drops significantly. Increasing the reference set size beyond five had a detrimental effect.
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>SINA alignment accuracy decreases almost linearly with the shared fractional identity of candidate and reference when using one reference sequence (red line). Using larger numbers of reference sequences markedly increases accuracy</p></caption><graphic xlink:href="bts252f2"/></fig>
<fig id="F3" position="float"><label>Fig. 3.</label><caption><p>An alternative implementation which used simple column-profiles built from the selected reference sequences showed overall lower accuracy. Increasing the number of reference sequences quickly led to a degradation in accuracy</p></caption><graphic xlink:href="bts252f3"/></fig></p>
    <p>At a reference set size of 40 sequences, and match/mismatch scores of 2 and −1 (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S3</ext-link>), a gap open penalty of 5 and a gap extension penalty of 2 was found to perform best (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S4</ext-link>). Enforcing the inclusion of at least one sequence of at least 1400 bases in the reference set improved results at identity thresholds lower than 0.9 visibly (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S5</ext-link>). Using the modified DP, algorithm to maintain fixed columns gave a slight improvement over using base shifting (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S6</ext-link>). Varying the <italic>k</italic>-mer size had little impact, values between 8 and 10 were found to produce best results (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S7</ext-link>). Using only <italic>k</italic>-mers beginning with ‘A’ resulted in a slight accuracy degradation (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S8</ext-link>). Among the three methods for weighting match/mismatch scores per column using the base frequency in the reference set performed best by far, improving Q scores by almost 0.5% points (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/bts252/DC1">Fig. S9</ext-link>).</p>
    <p>We did not benchmark speed and memory requirements specifically as these depend heavily on sequence length, reference MSA size and parameter settings. In the tests using reference MSAs sampled from the SSU dataset, we observed mothur to align roughly 20 sequences per second per core and SINA to align roughly 2 sequences per second per core. PyNAST was as fast as mothur in the benchmark using a reduced width alignment and matched SINA when using the full 51 000 column MSA. Tests were executed on a non-dedicated heterogeneous cluster comprising current 2, 4 and 8-way servers equipped with Intel and AMD quad core CPUs.</p>
  </sec>
  <sec id="SEC6">
    <title>6 DISCUSSION</title>
    <p>We reported the average Q scores because they are commonly used as accuracy indicator for sequence alignment. However, the values are not directly comparable to results obtained for <italic>de novo</italic> methods as these lack the benefit of a guiding reference alignment. Given a consistent reference alignment, selecting a reference sequence closely resembling the candidate sequence and transferring the alignment positions of the shared segments suffices to perfectly align those shared segments. The identity between the candidate sequences and the available reference sequences should therefore be considered as a baseline when interpreting the results. This also affects the precision with which accuracy can be measured. As can be seen in Table 5, the variance among sampled test cases was extremely low. When considering only those sequences that had an identity with the reference sequences of &lt;80%, variance increased by an order of magnitude. We therefore believe that assessing alignment accuracy to a precision of 0.1% is permissible for the benchmarks we performed.</p>
    <p>In interpreting the results, it may also be more informative to consider error rates, rather than the fraction of correctly aligned bases. For example, PyNAST achieves 98.55% accuracy (Q) on the BRAliBase 5S rRNA dataset, whereas SINA achieves 99.23%. This amounts to error rates of 1.45 and 0.77%, thus SINA placed only half as many bases in the wrong columns. Because sequence alignment is only one of many sources for error in sequence alignment, the permissible margin of error depends on many factors. We can, however, determine an upper bound at which it is more sensible to forgo extension of the reference MSA and instead use a homology search to map candidate sequences to results based solely on the reference MSA. In this case, the error would be equivalent to the distance between candidate and best matching reference because both error and distance are measured as a fraction of differing base positions. The average distance may therefore be used as a point of reference for the permissible error. Methods expecting a MSA as input do not commonly incorporate measures to deal with errors in the MSA. They will also make mutual comparisons between the aligned candidate sequences. Demanding that the error be at least an order of magnitude lower than the distance therefore seems prudent.</p>
    <p>According to the SSU benchmark, the distance between candidates and references averages to 7.66% using 1000 reference sequences and 4.76% using 5000 reference sequences. The same benchmark shows error rates for the NAST-based methods of above 3.37 and 2.19%. In absolute numbers, this means that when using a 5k reference MSA, the candidates and their best matching reference sequences where on average distinguished by 71 positions (according to the original alignment). Thirty-two positions where misaligned by NAST. SINA fares much better. At 0.74% error rate ( or 11 misaligned positions), its error was only a third of that produced by PyNAST and mothur. Although the aforementioned order of magnitude difference between error and distance would demand at most seven misaligned positions, we may have reached the resolution of the benchmark.</p>
    <p>When manually inspecting the positions comprising the error, we found that most cases were related to extensions of homo-polymers, conflicts between primary and secondary structure alignment or inconsistencies in the reference MSA. From the SILVA, rRNA gene datasets and the online SINA alignment service, both of which having been available for several years now, we were able to gather user feedback on these shortcomings. In general, users stated that the changes they made in manually refining the SINA alignment were related to the secondary structure. However, we were unable to collect sufficient problematic sequences in which secondary structure awareness would clearly improve alignment accuracy to build a dataset for benchmarking. We therefore concur with the observation made by Kemena (<xref ref-type="bibr" rid="B12">Kemena and Notredame, 2009</xref>) that much larger, high quality benchmark MSAs are needed, especially for improving and evaluating the accuracy of high throughput MSA methods. Although the dataset extracted from the SILVA SSU Ref database used in the evaluation of SINA is of high quality, it is merely a subset of the SILVA SSU seed. As such, it lacks a representative distribution of distances between sequences and would require further refinement and extension to become a good benchmark. Furthermore, a benchmark MSA explicitly constructed to comprise fewer columns than a correct alignment demands would be required to test the performance of alternative methods for constraining the number of columns. Because we expect that many other genes besides the RNAs will soon become available in numbers surpassing what can be feasibly aligned using <italic>de novo</italic> techniques, we also see a need for advanced interactive tools to support building and curating large MSAs to be used as benchmark or reference MSAs. Once benchmarks of sufficient resolution at high alignment accuracy levels become available, it may be interesting to investigate whether improving the POA based stage in SINA with methods used by <italic>de novo</italic> MSA tools such as Infernal, MUSCLE or MaFFT can further enhance alignment accuracy.</p>
  </sec>
  <sec id="SEC7">
    <title>7 CONCLUSION</title>
    <p>We have shown that combining a <italic>k</italic>-mer distance search with POA incremental MSA to integrate candidate sequences into an existing MSA yields highly accurate results. Using multiple reference sequences as a basis for the alignment of the candidate sequences significantly improves alignment quality. Dynamically selecting a low, fixed number of sequences from which the alignment template is constructed rather than basing the alignment on a global template built from all reference sequences allows the use of very large reference MSAs, lowering the number of bases remaining unaligned because they do not occur in the reference MSA. Furthermore, suboptimal alignment behaviour for groups of novel candidate sequences can be easily corrected by manually optimizing the alignment of one of these sequences and adding it to the reference MSA.</p>
    <p>With SINA, we provide a versatile and flexible tool for accurate high-throughput MSA that has proven its reliability and robustness over several years of testing in the context of the SILVA project.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplementary Data</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_28_14_1823__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="pdf" xlink:href="supp_bts252_sina-supplementary.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>ACKNOWLEDGEMENTS</title>
    <p>The authors thank all those SINA users who have over the past years provided us with invaluable feedback, without which SINA would neither be as accurate nor as robust as it is today. The authors also thank Ralf Westram for his help in interfacing SINA with ARB and his great work on ARB in general and Dr Wolfgang Ludwig for providing us with deep insights into the topics of alignment and rRNA.</p>
    <p><italic>Funding</italic>: This research was funded by the <funding-source>Max Planck Society (MPS)</funding-source>.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
  </ack>
  <ref-list>
    <title>REFERENCES</title>
    <ref id="B1">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Altschul</surname>
            <given-names>S.F.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Basic local alignment search tool</article-title>
        <source>J. Mol. Biol.</source>
        <year>1990</year>
        <volume>215</volume>
        <fpage>403</fpage>
        <lpage>410</lpage>
        <pub-id pub-id-type="pmid">2231712</pub-id>
      </element-citation>
    </ref>
    <ref id="B2">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amaral-Zettler</surname>
            <given-names>L.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Proceedings of the international workshop on Ribosomal RNA technology, April 7-9, 2008, Bremen, Germany</article-title>
        <source>Syst. Appl. Microbio.</source>
        <year>2008</year>
        <volume>31</volume>
        <fpage>258</fpage>
        <lpage>268</lpage>
      </element-citation>
    </ref>
    <ref id="B3">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Caporaso</surname>
            <given-names>J.G.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>PyNAST: a flexible tool for aligning sequences to a template alignment</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>266</fpage>
        <lpage>267</lpage>
        <pub-id pub-id-type="pmid">19914921</pub-id>
      </element-citation>
    </ref>
    <ref id="B4">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cole</surname>
            <given-names>J.R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The Ribosomal Database Project: improved alignments and new tools for rRNA analysis</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2009</year>
        <volume>37</volume>
        <fpage>D141</fpage>
        <lpage>D145</lpage>
        <pub-id pub-id-type="pmid">19004872</pub-id>
      </element-citation>
    </ref>
    <ref id="B5">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>DeSantis</surname>
            <given-names>T.Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Greengenes, a chimera-checked 16S rRNA gene database and workbench compatible with ARB</article-title>
        <source>Appl. Environ. Microbiol.</source>
        <year>2006a</year>
        <volume>72</volume>
        <fpage>5069</fpage>
        <lpage>5072</lpage>
        <pub-id pub-id-type="pmid">16820507</pub-id>
      </element-citation>
    </ref>
    <ref id="B6">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>DeSantis</surname>
            <given-names>T.Z.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>NAST: a multiple sequence alignment server for comparative analysis of 16S rRNA genes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2006b</year>
        <volume>34</volume>
        <fpage>W394</fpage>
        <lpage>W399</lpage>
        <pub-id pub-id-type="pmid">16845035</pub-id>
      </element-citation>
    </ref>
    <ref id="B7">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edgar</surname>
            <given-names>R.C.</given-names>
          </name>
        </person-group>
        <article-title>Local homology recognition and distance measures in linear time using compressed amino acid alphabets</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2004a</year>
        <volume>32</volume>
        <fpage>380</fpage>
        <lpage>385</lpage>
        <pub-id pub-id-type="pmid">14729922</pub-id>
      </element-citation>
    </ref>
    <ref id="B8">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edgar</surname>
            <given-names>R.C.</given-names>
          </name>
        </person-group>
        <article-title>MUSCLE: a multiple sequence alignment method with reduced time and space complexity</article-title>
        <source>BMC Bioinformatics</source>
        <year>2004b</year>
        <volume>5</volume>
        <fpage>113</fpage>
        <pub-id pub-id-type="pmid">15318951</pub-id>
      </element-citation>
    </ref>
    <ref id="B9">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edgar</surname>
            <given-names>R.C.</given-names>
          </name>
        </person-group>
        <article-title>Search and clustering orders of magnitude faster than BLAST</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>2460</fpage>
        <lpage>2461</lpage>
        <pub-id pub-id-type="pmid">20709691</pub-id>
      </element-citation>
    </ref>
    <ref id="B10">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Feng</surname>
            <given-names>D.F.</given-names>
          </name>
          <name>
            <surname>Doolittle</surname>
            <given-names>R.F.</given-names>
          </name>
        </person-group>
        <article-title>Progressive Sequence Alignment as a Prerequisite to Correct Phylogenetic Trees</article-title>
        <source>J. Mol. Evol.</source>
        <year>1987</year>
        <volume>25</volume>
        <fpage>351</fpage>
        <lpage>360</lpage>
        <pub-id pub-id-type="pmid">3118049</pub-id>
      </element-citation>
    </ref>
    <ref id="B11">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gotoh</surname>
            <given-names>O.</given-names>
          </name>
        </person-group>
        <article-title>An improved algorithm for matching biological sequences</article-title>
        <source>J. Mol. Biol.</source>
        <year>1982</year>
        <volume>162</volume>
        <fpage>705</fpage>
        <lpage>8</lpage>
        <pub-id pub-id-type="pmid">7166760</pub-id>
      </element-citation>
    </ref>
    <ref id="B12">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kemena</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Notredame</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Upcoming challenges for multiple sequence alignment methods in the high-throughput era</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>2455</fpage>
        <lpage>2465</lpage>
        <pub-id pub-id-type="pmid">19648142</pub-id>
      </element-citation>
    </ref>
    <ref id="B13">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>C.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiple sequence alignment using partial order graphs</article-title>
        <source>Bioinformatics</source>
        <year>2002</year>
        <volume>18</volume>
        <fpage>452</fpage>
        <lpage>464</lpage>
        <pub-id pub-id-type="pmid">11934745</pub-id>
      </element-citation>
    </ref>
    <ref id="B14">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Leinonen</surname>
            <given-names>R.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improvements to services at the European Nucleotide Archive</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2010</year>
        <volume>38</volume>
        <fpage>D39</fpage>
        <lpage>D45</lpage>
        <pub-id pub-id-type="pmid">19906712</pub-id>
      </element-citation>
    </ref>
    <ref id="B15">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Löytynoja</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Goldman</surname>
            <given-names>N.</given-names>
          </name>
        </person-group>
        <article-title>Phylogeny-aware gap placement prevents errors in sequence alignment and evolutionary analysis</article-title>
        <source>Science</source>
        <year>2008</year>
        <volume>320</volume>
        <fpage>1632</fpage>
        <lpage>1635</lpage>
        <pub-id pub-id-type="pmid">18566285</pub-id>
      </element-citation>
    </ref>
    <ref id="B16">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ludwig</surname>
            <given-names>W.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ARB: a software environment for sequence data</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2004</year>
        <volume>32</volume>
        <fpage>1363</fpage>
        <lpage>1371</lpage>
        <pub-id pub-id-type="pmid">14985472</pub-id>
      </element-citation>
    </ref>
    <ref id="B17">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morrison</surname>
            <given-names>D.A.</given-names>
          </name>
          <name>
            <surname>Ellis</surname>
            <given-names>J.T.</given-names>
          </name>
        </person-group>
        <article-title>Effects of nucleotide sequence alignment on phylogeny estimation: a case study of 18S rDNAs of apicomplexa</article-title>
        <source>Mol. Biol. Evol.</source>
        <year>1997</year>
        <volume>14</volume>
        <fpage>428</fpage>
        <lpage>441</lpage>
        <pub-id pub-id-type="pmid">9100373</pub-id>
      </element-citation>
    </ref>
    <ref id="B18">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nawrocki</surname>
            <given-names>E.P.</given-names>
          </name>
          <name>
            <surname>Eddy</surname>
            <given-names>S.R.</given-names>
          </name>
        </person-group>
        <article-title>Infernal 1.0: RNA sequence analysis with covariance models</article-title>
        <source>BMC Bioinformatics</source>
        <year>2008</year>
        <fpage>2008</fpage>
        <lpage>2008</lpage>
      </element-citation>
    </ref>
    <ref id="B19">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nawrocki</surname>
            <given-names>E.P.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Infernal 1.0: inference of RNA alignments</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>1335</fpage>
        <lpage>1337</lpage>
        <pub-id pub-id-type="pmid">19307242</pub-id>
      </element-citation>
    </ref>
    <ref id="B20">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Needleman</surname>
            <given-names>S.B.</given-names>
          </name>
          <name>
            <surname>Wunsch</surname>
            <given-names>C.D.</given-names>
          </name>
        </person-group>
        <article-title>A general method applicable to the search for similarities in the amino acid sequence of two proteins</article-title>
        <source>J. Mol. Biol.</source>
        <year>1970</year>
        <volume>48</volume>
        <fpage>443</fpage>
        <lpage>453</lpage>
        <pub-id pub-id-type="pmid">5420325</pub-id>
      </element-citation>
    </ref>
    <ref id="B21">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Notredame</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Recent Evolutions of Multiple Sequence Alignment Algorithms</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2007</year>
        <volume>3</volume>
        <fpage>4</fpage>
      </element-citation>
    </ref>
    <ref id="B22">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pei</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>Multiple protein sequence alignment</article-title>
        <source>Current Opinion in Structural Biology</source>
        <year>2008</year>
        <volume>18</volume>
        <fpage>382</fpage>
        <lpage>386</lpage>
        <pub-id pub-id-type="pmid">18485694</pub-id>
      </element-citation>
    </ref>
    <ref id="B23">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pruesse</surname>
            <given-names>E.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SILVA: a comprehensive online resource for quality checked and aligned ribosomal RNA sequence data compatible with ARB</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2007</year>
        <volume>35</volume>
        <fpage>7188</fpage>
        <lpage>7196</lpage>
        <pub-id pub-id-type="pmid">17947321</pub-id>
      </element-citation>
    </ref>
    <ref id="B24">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rice</surname>
            <given-names>C.M.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The EMBL data library</article-title>
        <source>Nucleic Acids Res.</source>
        <year>1993</year>
        <volume>21</volume>
        <fpage>2967</fpage>
        <lpage>71</lpage>
        <pub-id pub-id-type="pmid">8332519</pub-id>
      </element-citation>
    </ref>
    <ref id="B25">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schloss</surname>
            <given-names>P.D.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Introducing mothur: Open-Source, Platform-Independent, Community-Supported Software for Describing and Comparing Microbial Communities</article-title>
        <source>Appl. Environ. Microbiol.</source>
        <year>2009</year>
        <volume>75</volume>
        <fpage>7537</fpage>
        <lpage>7541</lpage>
        <pub-id pub-id-type="pmid">19801464</pub-id>
      </element-citation>
    </ref>
    <ref id="B26">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thompson</surname>
            <given-names>J.D.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BAliBASE: a benchmark alignment database for the evaluation of multiple alignment programs</article-title>
        <source>Bioinformatics</source>
        <year>1999</year>
        <volume>15</volume>
        <fpage>87</fpage>
        <lpage>88</lpage>
        <pub-id pub-id-type="pmid">10068696</pub-id>
      </element-citation>
    </ref>
    <ref id="B27">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thompson</surname>
            <given-names>J.D.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A Comprehensive Benchmark Study of Multiple Sequence Alignment Methods: Current Challenges and Future Perspectives</article-title>
        <source>PLoS One</source>
        <year>2011</year>
        <volume>6</volume>
        <fpage>14</fpage>
      </element-citation>
    </ref>
    <ref id="B28">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Jiang</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>On the complexity of multiple sequence alignment</article-title>
        <source>J. Computat. Biol.</source>
        <year>1994</year>
        <volume>1</volume>
        <fpage>337</fpage>
        <lpage>348</lpage>
      </element-citation>
    </ref>
    <ref id="B29">
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wilm</surname>
            <given-names>A.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>An enhanced RNA alignment benchmark for sequence alignment programs</article-title>
        <source>Algorithms Mol. Biol.</source>
        <year>2006</year>
        <volume>1</volume>
        <fpage>19</fpage>
        <pub-id pub-id-type="pmid">17062125</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
