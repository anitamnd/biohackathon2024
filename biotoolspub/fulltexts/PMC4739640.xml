<?properties open_access?>
<?properties manuscript?>
<?origin nihpa?>
<?iso-abbr Nat. Methods?>
<?submitter-system nihms?>
<?submitter-canonical-name Nature Publishing Group?>
<?submitter-canonical-id NATURE-STRUCTUR?>
<?submitter-userid 8068858?>
<?submitter-authority myNCBI?>
<?submitter-login nature-structure?>
<?submitter-name Nature Publishing Group?>
<?domain nihpa?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-journal-id">101215604</journal-id>
    <journal-id journal-id-type="pubmed-jr-id">32338</journal-id>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat. Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4739640</article-id>
    <article-id pub-id-type="pmid">25822800</article-id>
    <article-id pub-id-type="doi">10.1038/nmeth.3337</article-id>
    <article-id pub-id-type="manuscript">nihpa670442</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Robust enumeration of cell subsets from tissue expression profiles</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Newman</surname>
          <given-names>Aaron M.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref rid="FN2" ref-type="author-notes">9</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Chih Long</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref rid="FN2" ref-type="author-notes">9</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Green</surname>
          <given-names>Michael R.</given-names>
        </name>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gentles</surname>
          <given-names>Andrew J.</given-names>
        </name>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Feng</surname>
          <given-names>Weiguo</given-names>
        </name>
        <xref ref-type="aff" rid="A5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Xu</surname>
          <given-names>Yue</given-names>
        </name>
        <xref ref-type="aff" rid="A6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hoang</surname>
          <given-names>Chuong D.</given-names>
        </name>
        <xref ref-type="aff" rid="A6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Diehn</surname>
          <given-names>Maximilian</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A5">5</xref>
        <xref ref-type="aff" rid="A7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Alizadeh</surname>
          <given-names>Ash A.</given-names>
        </name>
        <xref ref-type="aff" rid="A1">1</xref>
        <xref ref-type="aff" rid="A2">2</xref>
        <xref ref-type="aff" rid="A3">3</xref>
        <xref ref-type="aff" rid="A7">7</xref>
        <xref ref-type="aff" rid="A8">8</xref>
      </contrib>
    </contrib-group>
    <aff id="A1"><label>1</label>Institute for Stem Cell Biology and Regenerative Medicine, Stanford University, Stanford, California, USA</aff>
    <aff id="A2"><label>2</label>Division of Oncology, Department of Medicine, Stanford Cancer Institute, Stanford University, Stanford, California, USA</aff>
    <aff id="A3"><label>3</label>Center for Cancer Systems Biology, Stanford University, Stanford, California, USA</aff>
    <aff id="A4"><label>4</label>Department of Radiology, Stanford University, Stanford, California, USA</aff>
    <aff id="A5"><label>5</label>Department of Radiation Oncology, Stanford University, Stanford, California, USA</aff>
    <aff id="A6"><label>6</label>Division of Thoracic Surgery, Department of Cardiothoracic Surgery, Stanford University, Stanford, California, USA</aff>
    <aff id="A7"><label>7</label>Stanford Cancer Institute, Stanford University, Stanford, California, USA</aff>
    <aff id="A8"><label>8</label>Division of Hematology, Department of Medicine, Stanford Cancer Institute, Stanford University, Stanford, California, USA</aff>
    <author-notes>
      <corresp id="FN1">Correspondence and requests for materials should be addressed to: A.A.A. (<email>arasha@stanford.edu</email>)</corresp>
      <fn id="FN2" fn-type="equal">
        <label>9</label>
        <p>These authors contributed equally.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="nihms-submitted">
      <day>12</day>
      <month>3</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>30</day>
      <month>3</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <month>5</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>03</day>
      <month>2</month>
      <year>2016</year>
    </pub-date>
    <volume>12</volume>
    <issue>5</issue>
    <fpage>453</fpage>
    <lpage>457</lpage>
    <!--elocation-id from pubmed: 10.1038/nmeth.3337-->
    <permissions>
      <license xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">
        <license-p>Users may view, print, copy, and download text and data-mine the content in such documents, for the purposes of academic research, subject always to the full Conditions of use:<ext-link ext-link-type="uri" xlink:href="http://www.nature.com/authors/editorial_policies/license.html#terms">http://www.nature.com/authors/editorial_policies/license.html#terms</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p id="P1">We introduce CIBERSORT, a method for characterizing cell composition of complex tissues from their gene expression profiles. When applied to enumeration of hematopoietic subsets in RNA mixtures from fresh, frozen, and fixed tissues, including solid tumors, CIBERSORT outperformed other methods with respect to noise, unknown mixture content, and closely related cell types. CIBERSORT should enable large-scale analysis of RNA mixtures for cellular biomarkers and therapeutic targets (<ext-link ext-link-type="uri" xlink:href="http://cibersort.stanford.edu">http://cibersort.stanford.edu</ext-link>).</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p id="P2">Changes in cell composition underlie diverse physiological states of metazoans and their complex tissues. For example, in malignant tumors, levels of infiltrating immune cells are associated with tumor growth, cancer progression and patient outcome<sup><xref rid="R1" ref-type="bibr">1</xref>,<xref rid="R2" ref-type="bibr">2</xref></sup>. Common methods for studying cell heterogeneity, such as immunohistochemistry and flow cytometry, rely on a limited repertoire of phenotypic markers, and tissue disaggregation prior to flow cytometry can lead to lost or damaged cells, altering results<sup><xref rid="R3" ref-type="bibr">3</xref></sup>. Recently, computational methods were reported for predicting fractions of multiple cell types in gene expression profiles (GEPs) of admixtures<sup><xref rid="R3" ref-type="bibr">3</xref>–<xref rid="R9" ref-type="bibr">9</xref></sup>. While such methods perform accurately on distinct cell subsets in mixtures with well-defined composition (e.g., blood), they are considerably less effective for mixtures with unknown content and noise (e.g., solid tumors), and for discriminating closely related cell types (e.g., naïve vs. memory B cells). We present <underline>C</underline>ell-type <underline>I</underline>dentification <underline>B</underline>y <underline>E</underline>stimating <underline>R</underline>elative <underline>S</underline>ubsets <underline>O</underline>f <underline>R</underline>NA <underline>T</underline>ranscripts (CIBERSORT), a computational approach that accurately resolves relative fractions of diverse cell subsets in GEPs from complex tissues (<ext-link ext-link-type="uri" xlink:href="http://cibersort.stanford.edu">http://cibersort.stanford.edu</ext-link>).</p>
  <p id="P3">CIBERSORT requires an input matrix of reference gene expression signatures, collectively used to estimate the relative proportions of each cell type of interest. To deconvolve the mixture, we employ a novel application of linear support vector regression (SVR), a machine learning approach highly robust to noise<sup><xref rid="R10" ref-type="bibr">10</xref></sup> (Online Methods and <xref rid="SD1" ref-type="supplementary-material">Supplementary Discussion</xref>). Unlike previous methods, SVR performs a feature selection, in which genes from the signature matrix are adaptively selected to deconvolve a given mixture (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>). An empirically defined global <italic>P</italic> value for the deconvolution is then determined (<xref rid="F1" ref-type="fig">Fig. 1a</xref>).</p>
  <p id="P4">To assess the feasibility of leukocyte deconvolution from bulk tumors, we designed and validated a leukocyte gene signature matrix, termed LM22. It contains 547 genes that distinguish 22 human hematopoietic cell phenotypes, including seven T cell types, naïve and memory B cells, plasma cells, NK cells, and myeloid subsets (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 2</xref>, and Online Methods). Cell subsets can be further grouped into 11 major leukocyte types based on shared lineage (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). To validate the gene signatures in LM22, we applied it to deconvolve external datasets of variably purified leukocyte subsets. CIBERSORT results matched ground truth phenotypes in 93% of these datasets (<xref rid="F1" ref-type="fig">Fig. 1b</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3a</xref>, <xref rid="SD3" ref-type="supplementary-material">Supplementary Table 2</xref>). CIBERSORT also produced results consistent with highly purified T and B cells that we flow-sorted from five human tonsils (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3b</xref>).</p>
  <p id="P5">We next evaluated the CIBERSORT <italic>P</italic> value metric for sensitivity and specificity by using LM22 to deconvolve 3,061 human transcriptomes<sup><xref rid="R11" ref-type="bibr">11</xref></sup>. We first scored expression profiles as ‘positive’ or ‘negative’ depending on the presence or absence of at least one cell type in LM22, respectively. This distinction was considered separately for primary tissue specimens (<italic>n</italic> = 1,425 positive, 376 negative) and transformed cell lines (<italic>n</italic> = 118 positive, 1,142 negative). At a <italic>P</italic> value threshold of ~0.01, CIBERSORT achieved ≥94% sensitivity and ≥95% specificity for distinguishing positive from negative samples (AUC ≥ 0.98; <xref rid="F1" ref-type="fig">Fig. 1c</xref>). Results were similar using an independently derived leukocyte signature matrix<sup><xref rid="R4" ref-type="bibr">4</xref></sup> instead of LM22 (data not shown).</p>
  <p id="P6">We then benchmarked CIBERSORT on idealized mixtures with well-defined composition<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R12" ref-type="bibr">12</xref>,<xref rid="R13" ref-type="bibr">13</xref></sup> (Online Methods), and compared it with six GEP deconvolution methods—linear least squares regression (LLSR)<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, quadratic programming (QP)<sup><xref rid="R5" ref-type="bibr">5</xref></sup>, PERT<sup><xref rid="R6" ref-type="bibr">6</xref></sup>, robust linear regression (RLR), MMAD<sup><xref rid="R7" ref-type="bibr">7</xref></sup> and DSA<sup><xref rid="R8" ref-type="bibr">8</xref></sup> (<xref rid="SD4" ref-type="supplementary-material">Supplementary Table 3</xref>). CIBERSORT, like other methods, achieved accurate results on idealized mixtures (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4a,b</xref>) (<xref rid="F1" ref-type="fig">Fig. 1d</xref>) (<xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>). Consequently, we asked whether CIBERSORT might be useful for immune monitoring, and profiled peripheral blood in patients immediately before and after receiving rituximab monotherapy for Non-Hodgkin’s lymphoma. CIBERSORT analysis of post-treatment peripheral blood mononuclear cells (PBMCs) with LM22 revealed a selective depletion of B cells targeted by rituximab in four patients (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4c</xref>), suggesting utility for leukocyte monitoring during immunotherapy, especially when specimens cannot be immediately processed.</p>
  <p id="P7">To compare CIBERSORT’s technical performance with other methods on mixtures with unknown content, we employed commonly used benchmark datasets consisting of four admixed blood cancer cell lines<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, each with distinct reference profiles (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figs. 5,6</xref> and Online Methods). By combining these mixtures with a colon cancer cell line, we simulated human solid tumors with varying leukocyte infiltration (1% to 100%). We also tested the addition of non-log linear noise to simulate sample handling, stochastic gene expression variation, and platform-to-platform differences. While this simulation framework does not fully reflect biological admixtures of solid tumors, it provided a reasonable model in which unknown content and added noise could be finely tuned and tested.</p>
  <p id="P8">Nearly all methods degraded in performance as a function of signal loss (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 5</xref>, <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>), showing highly reduced accuracy below 50% immune content. Only CIBERSORT accurately resolved known mixture proportions over nearly the entire range of tumor content (up to ~95%) and noise (up to ~70%) (<xref rid="F2" ref-type="fig">Fig. 2a</xref>), exhibiting strong performance on mixtures that diverged considerably from their original compositions (Pearson’s <italic>R</italic> as low as ~0.05; <xref rid="F2" ref-type="fig">Fig. 2b</xref>). Since many solid tumor types are composed of fewer than 50% infiltrating immune cells<sup><xref rid="R14" ref-type="bibr">14</xref></sup>, the parameter range in which CIBERSORT outperformed other methods is highly relevant for bulk tumor analysis.</p>
  <p id="P9">To assess the detection limit of each method for rare cell types in bulk tissues, we created a second synthetic dataset of the same cell lines, but with one blood cell line spiked into random mixtures of the other three blood subsets. CIBERSORT detected cellular fractions down to 0.5% in mixtures containing up to 50% tumor content, and down to 1% in mixtures with over 50% tumor content (<xref rid="F2" ref-type="fig">Fig. 2c</xref>). While all methods overestimated spike-ins with higher tumor content, the effect was least pronounced for CIBERSORT (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 6</xref>). Overestimation was less common in a separate analysis, in which each cell type in LM22 was spiked into random combinations of the remaining 21 subsets over a range of unknown content (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 7</xref>). Overall, CIBERSORT consistently outperformed other methods, substantially in some cases (<xref rid="F2" ref-type="fig">Fig. 2d</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Figs. 5–7</xref>, and <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>).</p>
  <p id="P10">We next investigated CIBERSORT’s discriminatory ability on cell types with correlated GEPs, which can be difficult to resolve in mixtures due to multicollinearity<sup><xref rid="R15" ref-type="bibr">15</xref></sup>. Previous approaches avoid this issue by using cell type-specific marker genes<sup><xref rid="R7" ref-type="bibr">7</xref>,<xref rid="R8" ref-type="bibr">8</xref>,<xref rid="R13" ref-type="bibr">13</xref></sup> or highly distinct GEPs<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R5" ref-type="bibr">5</xref></sup>. In contrast, CIBERSORT does not require cell type-specific expression for every gene, suggesting applicability to diverse cell phenotypes (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8</xref>). In addition, despite performing a feature selection on signature matrix genes (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>), we did not observe any effect of the choice of genes on deconvolution of closely related cell types (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 9</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Results</xref>). When compared to other methods on synthetic mixtures of increasingly correlated cell types, CIBERSORT performed most accurately (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 10</xref>), demonstrating potential for deep deconvolution of many cell subsets<sup><xref rid="R3" ref-type="bibr">3</xref></sup>.</p>
  <p id="P11">Having benchmarked CIBERSORT on simulated mixtures, we next focused on <italic>in vitro</italic> and <italic>in vivo</italic> mixtures of solid tissues, including bulk tumors. We used LM22 for all remaining analyses and restricted our comparative assessments to expression-based methods (RLR, PERT, QP, and LLSR). First, we tested deconvolution stability in a spike series of whole blood added to breast tissue<sup><xref rid="R5" ref-type="bibr">5</xref></sup>. After verifying relative spike-in proportions by comparison with immune-related gene expression (<xref rid="F2" ref-type="fig">Fig. 2e</xref>), we found that CIBERSORT was significantly more consistent than other methods (<italic>P</italic> &lt; 0.02; <italic>n</italic> = 9 samples with &lt;100% blood; paired two-sided Wilcoxon signed rank test; <xref rid="F2" ref-type="fig">Fig. 2e</xref>; <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>). Separately, across independent studies, leukocyte fractions enumerated by CIBERSORT were more similar within a cancer type than across cancers (<xref rid="F2" ref-type="fig">Fig. 2f</xref>). These results indicate that unknown content and lab-specific factors only marginally impact CIBERSORT performance.</p>
  <p id="P12">We next applied CIBERSORT to formalin-fixed, paraffin embedded (FFPE) samples. Using publicly available GEPs of matching FFPE and frozen DLBCL tumors<sup><xref rid="R16" ref-type="bibr">16</xref></sup>, we found that leukocyte fractions estimated by CIBERSORT were significantly correlated across all tumors (<xref rid="F2" ref-type="fig">Fig. 2g</xref>) and were more concordant than other methods (<xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>). Indeed, CIBERSORT results were also significantly correlated in 16 of 18 individual tumors (<italic>P</italic> &lt; 0.05; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 11a</xref>) and in specific cell subsets (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 11b</xref>), implying potential utility for large-scale analysis of cellular composition in FFPE specimens.</p>
  <p id="P13">To evaluate CIBERSORT against ground truth measurements of leukocyte content in solid tissues, we used flow cytometry to enumerate immune subsets in two tissue types: lung specimens obtained during surgical resection of early stage non-small cell lung carcinomas, and disaggregated lymph node biopsies from follicular lymphoma (FL) patients. Whether applied to (i) independent microarray studies of normal lung tissues or (ii) GEPs from 14 paired bulk FL samples, results were significantly correlated with corresponding flow cytometry measurements (<italic>P</italic> ≤ 0.005, <xref rid="F2" ref-type="fig">Fig. 2h,i</xref>, respectively) and in both tissue types, more closely reflected experimental values than previous methods (<xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>).</p>
  <p id="P14">To assess performance on individual cell subsets, we used flow cytometry to enumerate nearly 50% of the phenotypic repertoire of LM22 (10 of 22 cell subsets), and evaluated CIBERSORT’s capability for deep deconvolution in PBMCs and tumor biopsies. Blood samples from 27 adult subjects were profiled for ten phenotypes captured in LM22 (20 subjects were profiled for nine cell types, and seven profiled for FOXP3+ Tregs; <xref rid="SD1" ref-type="supplementary-material">Supplementary Note</xref>). Of these ten phenotypes, half are highly collinear in LM22 (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 2c</xref>) and half have low median frequencies (&lt;5%) in PBMCs (<xref rid="SD1" ref-type="supplementary-material">Supplementary Note</xref>). Despite the diversity of phenotypes analyzed, 90% of distinct leukocyte subsets were significantly correlated between CIBERSORT and flow cytometry (<italic>P</italic> ≤ 0.02; <xref rid="F3" ref-type="fig">Fig. 3a</xref>), including four of five subsets with median fractions below 5% (e.g., Tregs; <xref rid="F3" ref-type="fig">Fig. 3b</xref>). Only gamma delta T cells were not significant (albeit positively correlated; <italic>R</italic> = 0.29), possibly due to technical issues with flow cytometry or the use of a suboptimal reference profile (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3a</xref>). Separately, in FL tumor biopsies, CD4 and CD8 T cells and malignant B cells were each significantly correlated between CIBERSORT and flow cytometry (<italic>P</italic> ≤ 0.02; <xref rid="F3" ref-type="fig">Fig. 3c</xref>).</p>
  <p id="P15">When applied to the same datasets using LM22, other expression-based methods were generally less accurate, and none yielded significant correlations for &gt;50% of analyzed phenotypes (<xref rid="F3" ref-type="fig">Fig. 3d</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Figs. 12,13</xref>, and <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>). Moreover, certain subsets were observed to ‘drop out’ when enumerated by other methods, likely owing to multicollinearity (e.g., naïve CD4 T cell levels estimated by QP and LLSR in PBMCs; <xref rid="F3" ref-type="fig">Fig. 3d</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Figs. 12,13</xref>). Furthermore, for FL tumor biopsies, significant correlations were only achieved by other methods when all leukocyte subsets were evaluated together, not separately (except for CD8 T cells inferred by RLR; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 13</xref>). Potential reasons for these performance differences are discussed in Online Methods and <xref rid="SD1" ref-type="supplementary-material">Supplementary Discussion</xref>. Collectively, these results further demonstrate the advantages of CIBERSORT for deep deconvolution and enumeration of cell subsets in tissues with complex compositions.</p>
  <p id="P16">To summarize, we present CIBERSORT for characterizing cell heterogeneity using RNA mixtures from nearly any tissue. CIBERSORT exhibits substantially improved accuracy for the analysis of mixtures with (i) noise or unknown content and (ii) closely related cell types (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 14</xref>). When applied with statistical filtration, CIBERSORT coupled with LM22 allows for highly sensitive and specific discrimination of human leukocyte subsets. We note that our filtration approach is likely applicable to other signature matrices and other GEP deconvolution methods.</p>
  <p id="P17">The most significant current limitation of CIBERSORT, and indeed all signature gene-based methods, is the fidelity of reference profiles, which could deviate in cells undergoing heterotypic interactions, phenotypic plasticity, or disease-induced dysregulation. Sampling a larger expression space by sorting populations from diverse physiological conditions (e.g., specific tumor-infiltrating immune cells) may mitigate this issue. Second, CIBERSORT currently does not provide <italic>P</italic> values for detection limits of individual cell types. Third, despite a considerably lower estimation bias than other approaches, some cell types were systematically over- or under-estimated by CIBERSORT (see RMSE values in <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>); efforts to address this are underway. Finally, while CIBERSORT was not explicitly tested on RNA-Seq data, the linearity assumptions made by our method are likely to hold, as previously suggested<sup><xref rid="R17" ref-type="bibr">17</xref></sup>.</p>
  <p id="P18">We anticipate that CIBERSORT will prove valuable for analysis of cellular heterogeneity in microarray or RNA-Seq data derived from fresh, frozen, and fixed specimens, thereby complementing methods that require living cells as input.</p>
  <sec id="S1" specific-use="web-only">
    <title>Online Methods</title>
    <sec id="S2">
      <title>Patient samples</title>
      <p id="P19">All patient samples in this study were reviewed and approved by the Stanford Institutional Review Board in accordance with the Declaration of Helsinki. Tonsils were collected as part of routine tonsilectomy procedures at Lucile Packard Children’s Hospital at Stanford University with informed consent for research use, and then mechanically disaggregated before cell suspensions were cryopreserved (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3b</xref>). Peripheral blood mononuclear cells (PBMCs) were isolated from specimens taken before and immediately following four weekly doses of infusional rituximab (375 mg m<sup>−2</sup>) monotherapy for extranodal marginal zone lymphoma (EMZL) in a subject without measurable circulating disease (patient 1 in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4c</xref>). PBMCs were respectively isolated from specimens taken immediately following four cycles and six cycles of RCHOP immunochemotherapy for treatment of DLBCL (patients 2 and 3 in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4c</xref>). PBMCs were also isolated from a subject following four cycles of Rituximab for treatment of FL (patient 4 in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4c</xref>); this subject had ~2% circulating lymphoma cells at diagnosis, which were undetectable by CIBERSORT and flow cytometry following four Rituximab infusions. Specimens of adjacent normal lung tissue were obtained during surgical resection of early stage non-small cell lung tumors (<xref rid="F2" ref-type="fig">Fig. 2h</xref>). Surgical tissue biopsies were obtained from untreated FL patients enrolled in a Phase III clinical trial (NCT00017290<sup><xref rid="R18" ref-type="bibr">18</xref></sup>) (<xref rid="F2" ref-type="fig">Fig. 2i</xref> and <xref rid="F3" ref-type="fig">Fig. 3c</xref>). Lastly, PBMCs were obtained from 20 adults of varying ages receiving influenza immunization (NCT01827462) (<xref rid="F3" ref-type="fig">Fig. 3a</xref>), and from seven adults consisting of patient 4 in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4c</xref> and six healthy subjects (<xref rid="F3" ref-type="fig">Fig. 3b</xref>, which includes patient 4).</p>
    </sec>
    <sec id="S3">
      <title>Flow cytometry</title>
      <p id="P20">Details are provided in the supplement (<xref rid="SD1" ref-type="supplementary-material">Supplementary Note</xref> and <xref rid="SD1" ref-type="supplementary-material">Supplementary Results</xref>).</p>
    </sec>
    <sec id="S4">
      <title>Gene expression profiling</title>
      <p id="P21">Nucleic acids were extracted from tonsil specimens (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 3b</xref>) and PBMCs (patients 1 to 3 in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4c</xref>) using AllPrep DNA/RNA Mini kits (Qiagen). For FL specimens (<xref rid="F2" ref-type="fig">Fig. 2i</xref>, <xref rid="F3" ref-type="fig">Fig. 3c</xref>), total RNA and genomic DNA were prepared and stored using TRIzol and RNeasy Midi Kits (Qiagen). Sufficient nucleic acid was confirmed for 80% of archival FL specimens after quality control assessment of a subset of these patients. Total RNA from FL samples was linearly amplified (3′ IVT Express, Affymetrix) prior to microarray hybridization. For all above samples, total cellular RNA (at least 300 ng) was assessed for yield (NanoDrop 2000, Thermo Scientific), and quality (2100 Bioanalyzer, Agilent), and cRNA was hybridized to HGU133 Plus 2.0 microarrays (Affymetrix) according to the manufacturer’s protocol.</p>
      <p id="P22">Two additional cohorts of PBMCs were analyzed in this study (<xref rid="F3" ref-type="fig">Fig. 3a,b</xref>). For the first cohort (<italic>n</italic> = 20 subjects; <xref rid="F3" ref-type="fig">Fig. 3a</xref>), PBMCs (~1×10<sup>6</sup> viable cells per mL) were collected in 1 mL TRIzol (Invitrogen) and stored at −80 °C until use. Total RNA was isolated according to the TRIzol protocol (Invitrogen). Total RNA yield was assessed using the Thermo Scientific NanoDrop 1000 micro-volume spectrophotometer (absorbance at 260 nm and the ratio of 260/280 and 260/230). RNA integrity was assessed using a Bioanalyzer NANO Lab-on-a-Chip instrument (Agilent). Biotinylated, amplified antisense complementary RNA (cRNA) targets were prepared from 200 to 250 ng of total RNA using the Illumina RNA amplification kit (Life Technologies), and 750 ng of labeled cRNA was hybridized overnight to Human HT-12 V4 BeadChip arrays (Illumina). The arrays were then washed, blocked, stained and scanned on an Illumina BeadStation 500 following the manufacturer’s protocols. GenomeStudio software version 1.9.0 (Illumina) was used to generate signal intensity values from the scans. For the second cohort (<xref rid="F3" ref-type="fig">Fig. 3b</xref>), PBMCs (1.4×10<sup>6</sup> to 4.0×10<sup>6</sup> cells per mL) from six healthy male adults were isolated and prepared as described in <xref rid="SD1" ref-type="supplementary-material">Supplementary Note</xref> and then frozen at −80 °C until use. Total cellular RNA ≥300 ng) was isolated from these six subjects along with viably preserved PBMCs from patient 4 (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4c</xref>) using RNeasy Mini Kit (Qiagen) and assessed for yield (NanoDrop 2000, Thermo Scientific), and quality (2100 Bioanalyzer, Agilent). Total RNA was linearly amplified (3′ IVT Express, Affymetrix), and cRNA was hybridized to HGU133A microarrays (Affymetrix) according to the manufacturer’s protocol.</p>
    </sec>
    <sec id="S5">
      <title>Overview of CIBERSORT</title>
      <sec id="S6">
        <title>Deconvolution model</title>
        <p id="P23">A variety of GEP deconvolution methods have been proposed, most of which model an mRNA mixture <bold>m</bold> by a system of linear equations, corresponding to a weighted sum of cell type-specific GEPs<sup><xref rid="R3" ref-type="bibr">3</xref>–<xref rid="R9" ref-type="bibr">9</xref>,<xref rid="R12" ref-type="bibr">12</xref>,<xref rid="R13" ref-type="bibr">13</xref>,<xref rid="R17" ref-type="bibr">17</xref>,<xref rid="R19" ref-type="bibr">19</xref></sup>. Let <bold>B</bold> denote a GEP signature matrix and let <bold>f</bold> denote a vector consisting of the unknown fractions of each cell type in the mixture. Then the problem of GEP deconvolution can be represented by <bold>m</bold> = <bold>f</bold> x <bold>B</bold>, provided that <bold>B</bold> contains more marker genes than cell types (i.e., the system is overdetermined<sup><xref rid="R4" ref-type="bibr">4</xref></sup>). The preponderance of genes in whole transcriptome studies renders this requirement trivial in practice. If the linearity argument is biologically plausible, as previous studies imply<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R12" ref-type="bibr">12</xref>,<xref rid="R13" ref-type="bibr">13</xref>,<xref rid="R20" ref-type="bibr">20</xref></sup>, then genes with expression profiles enriched in each cell type can be leveraged to impute unknown cell fractions from mixture profiles<sup><xref rid="R5" ref-type="bibr">5</xref></sup>.</p>
      </sec>
      <sec id="S7">
        <title>Signature matrix</title>
        <p id="P24">Matrices of cell-specific expression signatures—termed base or basis matrices in prior studies<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R19" ref-type="bibr">19</xref></sup>—can be obtained by differential expression analysis of purified or enriched cell populations. Gene signature matrices can be made more robust by minimizing an inherent matrix property called the condition number, which measures the stability of the linear system to input variation or noise<sup><xref rid="R4" ref-type="bibr">4</xref>,<xref rid="R5" ref-type="bibr">5</xref></sup>. In this work, we measure signature matrix stability via the 2-norm condition number, calculated with the kappa function in R. The specific steps used to build LM22 are described in ‘LM22 signature matrix’.</p>
        <p id="P25">The process of building a signature matrix represents a type of ‘filter method’, a preprocessing step that removes irrelevant features prior to application of a specific machine learning approach or prediction algorithm<sup><xref rid="R21" ref-type="bibr">21</xref></sup>. Specifically, the use of a signature matrix facilitates (1) faster computational running time owing to the elimination of genes with uniform expression levels across the cell types of interest (e.g., housekeeping genes and unexpressed genes), and (2) a greater signal to noise ratio by preselecting reference profiles that have maximal discriminatory power (as measured by condition number). While several previous expression-based methods rely on feature selection to build a signature matrix for deconvolution (e.g., LLSR and QP), to our knowledge, this is the first work to incorporate an additional round of feature selection to adaptively select genes from an existing signature matrix (detailed below).</p>
      </sec>
      <sec id="S8">
        <title>Support vector regression (SVR)</title>
        <p id="P26">To address limitations of previous methods (<xref rid="SD1" ref-type="supplementary-material">Supplementary Discussion</xref>), we propose a new approach for <underline>C</underline>ell <underline>T</underline>ype <underline>I</underline>dentification <underline>B</underline>y <underline>E</underline>stimating <underline>R</underline>elative <underline>S</underline>amples <underline>O</underline>f <underline>R</underline>NA <underline>T</underline>ranscripts (CIBERSORT). Our strategy is based on a novel application of nu-support vector regression (<italic>ν</italic>-SVR)<sup><xref rid="R10" ref-type="bibr">10</xref></sup>, a machine-learning method that outperformed other approaches in benchmarking experiments (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 14</xref>, <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>). <italic>ν</italic>-SVR is an instance of support vector machine (SVM), a class of optimization methods for binary classification problems, in which a hyperplane is discovered that maximally separates both classes. The support vectors are a subset of the input data that determine hyperplane boundaries. Unlike standard SVM, SVR discovers a hyperplane that fits as many data points as possible (given its objective function<sup><xref rid="R10" ref-type="bibr">10</xref></sup>) within a constant distance, <italic>ε</italic>, thus performing a regression (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>). All data points within <italic>ε</italic> (termed the ‘<italic>ε</italic>-tube’) are ignored (open circles in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>, left panel), whereas all data points lying outside of the <italic>ε</italic>-tube are evaluated according to a linear <italic>ε</italic>-insensitive loss function<sup><xref rid="R10" ref-type="bibr">10</xref></sup>. These outlier data points, referred to as ‘support vectors’ (red circles in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>), define the boundaries of the <italic>ε</italic>-tube and are sufficient to completely specify the linear regression function. In this way, support vectors can provide a sparse solution to the regression in which overfitting is minimized (a type of feature selection). Notably, support vectors represent genes selected from the signature matrix in this work.</p>
        <p id="P27">The primal objective of SVR is to minimize both a loss function and penalty function given a defined set of constraints. The former measures the error associated with fitting the data whereas the latter determines model complexity. More specifically, SVR solves an optimization problem that minimizes the following two quantities<sup><xref rid="R10" ref-type="bibr">10</xref></sup>: (1) a linear <italic>ε</italic>-insensitive loss function, which outperforms other common loss functions (e.g., squared error used in LLSR) in noisy samples<sup><xref rid="R22" ref-type="bibr">22</xref></sup>, and (2) an <italic>L</italic><sub>2</sub>–norm penalty function (the same as that used in ridge regression<sup><xref rid="R23" ref-type="bibr">23</xref></sup>), which penalizes model complexity while minimizing the variance in the weights assigned to highly correlated predictors<sup><xref rid="R24" ref-type="bibr">24</xref>,<xref rid="R25" ref-type="bibr">25</xref></sup> (e.g., closely related cell types), thereby combating multicollinearity. For further details, see ref. <xref rid="R10" ref-type="bibr">10</xref>.</p>
        <p id="P28">Two major types of SVR have been described, <italic>ε</italic>-SVR<sup><xref rid="R26" ref-type="bibr">26</xref></sup> and <italic>ν</italic>-SVR<sup><xref rid="R10" ref-type="bibr">10</xref></sup>, however we applied <italic>ν</italic>-SVR in CIBERSORT since the ν parameter conveniently imparts both an upper bound on training errors and a lower bound on support vectors<sup><xref rid="R10" ref-type="bibr">10</xref></sup>. Higher values of <italic>ν</italic> yield narrower <italic>ε</italic>-tubes and consequently, more support vectors<sup><xref rid="R10" ref-type="bibr">10</xref></sup> (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 1</xref>). For CIBERSORT, <italic>ν</italic>-SVR is applied with a linear kernel to solve for <bold>f</bold>, and the best result from three values of <italic>ν</italic> = {0.25, 0.5, 0.75} is saved, where ‘best’ is defined as the lowest root mean squared error between <bold>m</bold> and the deconvolution result, <bold>f</bold> x <bold>B</bold>. Our current implementation of CIBERSORT executes <italic>ν</italic>-SVR using the ‘svm’ function in the R package, ‘e1071’. Regression coefficients are extracted with the following R command:</p>
        <preformat>
coef &lt;- t(model$coefs) %*% model$SV
</preformat>
        <p id="P32">Negative SVR regression coefficients are subsequently set to zero (as done for LLSR), and the remaining regression coefficients are normalized to sum to 1, yielding a final vector of estimated cell type fractions, <bold>f</bold> (notably, <bold>f</bold> denotes relative, not absolute fractions of each cell type from <bold>B</bold> in <bold>m</bold>). To decrease running time and promote better overall performance, both <bold>B</bold> and <bold>m</bold> are each normalized to zero mean and unit variance prior to running CIBERSORT. As previously suggested for other linear deconvolution methods, CIBERSORT works best on expression values in non-log linear space<sup><xref rid="R20" ref-type="bibr">20</xref></sup>.</p>
        <p id="P33">Taken together, linear <italic>ν</italic>-SVR as implemented by CIBERSORT, uniquely addresses key outstanding issues of gene expression deconvolution (see <xref rid="SD1" ref-type="supplementary-material">Supplementary Discussion</xref>), including (1) robustness to noise and overfitting owing to both a linear loss function<sup><xref rid="R22" ref-type="bibr">22</xref></sup> and feature selection of genes from the signature matrix, and (2) tolerance to multicollinearity via utilization of the <italic>L</italic><sub>2</sub>-norm penalty function<sup><xref rid="R25" ref-type="bibr">25</xref></sup>. Moreover, CIBERSORT does not require cell type-specific expression patterns for every gene, allowing the construction of signature matrices with more cell types and phenotypic states than other methods (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8</xref>).</p>
      </sec>
      <sec id="S9">
        <title>P-value estimation</title>
        <p id="P34">In contrast to previous methods, CIBERSORT produces an empirical <italic>P</italic> value for the deconvolution using Monte Carlo sampling. This approach allows CIBERSORT to test the null hypothesis that no cell types in the signature matrix (e.g., LM22) are present in a given GEP mixture, <bold>m.</bold> For this purpose, we use the Pearson product-moment correlation <italic>R</italic> calculated between <bold>m</bold> and <bold>f</bold> x <bold>B</bold> as the test statistic, though other distance metrics could be used. In order to derive an empirical <italic>P</italic> value, CIBERSORT must first derive a null distribution <italic>R<sup>*</sup></italic>. Because the signature matrix <bold>B</bold> will contain only a small subset of genes <italic>g</italic> compared to the whole transcriptome, <italic>g</italic> expression values are randomly drawn from the parent GEP of <bold>m</bold> to create a random mixture <bold>m</bold><sup>*</sup><italic><sub>i</sub></italic>, such that |<bold>m</bold>| = |<bold>m</bold><sup>*</sup><italic><sub>i</sub></italic>|. CIBERSORT is then run on <bold>m</bold><sup>*</sup><italic><sub>i</sub></italic> to produce a vector of estimated cellular fractions, <bold>f</bold><sup>*</sup><italic><sub>i</sub></italic>. CIBERSORT determines the correlation coefficient <italic>R<sup>*</sup><sub>i</sub></italic> between the random mixture <bold>m</bold><sup>*</sup><italic><sub>i</sub></italic> and the reconstituted mixture, <bold>f</bold><sup>*</sup><italic><sub>i</sub></italic> x <bold>B</bold>. This process is repeated for <italic>I</italic> iterations (=500 in this work) to produce <italic>R<sup>*</sup></italic>.</p>
      </sec>
      <sec id="S10">
        <title>Running time</title>
        <p id="P35">Using three threads to simultaneously process three values of ν (0.25, 0.5, and 0.75), and a 2.3 GHz Intel Core i7 CPU with 8 GB RAM, we clocked CIBERSORT runtime with LM22 at approximately 1.7 sec per mixture sample after an empirical <italic>P</italic> value was calculated. The latter depends on the number of permutations selected, and for 100x, would take ~170 sec, or an additional 2.75 min.</p>
      </sec>
      <sec id="S11">
        <title>Implementation and website</title>
        <p id="P36">CIBERSORT was developed in Java and R with a simple command-line interface for processing gene expression data representing a mixture of different cell types, along with a signature genes file that enumerates the genes that define the signature expression profile for each cell type. Given these data, the tool generates the fractional representations of each cell type present in the mixture and returns it to the website to be rendered as a heat map table and stacked bar plot representations. The application can also produce custom signature gene files when provided with gene expression profiles of reference cell populations and a class comparison table for those populations.</p>
        <p id="P37">The back end website for CIBERSORT was built in PHP. The interactive user interface is powered by the jQuery JavaScript library and various open source libraries (including phpMailer, idiorm, blueimp jQuery-File-Upload, DataTables, phpExcel and mPDF), with the graphical user interface of the website powered by Twitter Bootstrap 2.3.2. The site runs on an Apache server on a virtual machine and stores user and job data in a MySQL database. However, the user has complete control over their data and can delete them at will. The CIBERSORT website is hosted at <ext-link ext-link-type="uri" xlink:href="http://cibersort.stanford.edu">http://cibersort.stanford.edu</ext-link>, and includes datasets used for benchmarking, tutorials for the use of CIBERSORT and preparation of input data, downloadable software and source code, and example files.</p>
      </sec>
    </sec>
    <sec id="S12">
      <title>Other GEP deconvolution methods</title>
      <p id="P38">We compared CIBERSORT results with six GEP deconvolution methods—four that take reference expression profiles as input: linear least squares regression (LLSR)<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, quadratic programming (QP)<sup><xref rid="R5" ref-type="bibr">5</xref></sup>, PERT<sup><xref rid="R6" ref-type="bibr">6</xref></sup>, and robust linear regression (RLR); and two that take genes uniquely expressed in a given cell type as input (i.e., marker genes): MMAD<sup><xref rid="R7" ref-type="bibr">7</xref></sup> and DSA<sup><xref rid="R8" ref-type="bibr">8</xref></sup> (<xref rid="SD4" ref-type="supplementary-material">Supplementary Table 3</xref>). To the best of our knowledge, RLR was first applied to GEP deconvolution in this work. LLSR, QP, RLR and DSA were run in R using ‘stats’ (‘lm’ function), ‘quadprog’, ‘MASS’ (‘rlm’ function, 100 maximum iterations), and ‘DSA’<sup><xref rid="R8" ref-type="bibr">8</xref></sup> packages, respectively. Negative coefficients from LLSR were set to zero to approximate the approach used by Abbas <italic>et al.</italic><sup><xref rid="R4" ref-type="bibr">4</xref></sup>, and QP was run with non-negativity and sum to 1 constraints used by Gong <italic>et al.</italic><sup><xref rid="R5" ref-type="bibr">5</xref>,<xref rid="R17" ref-type="bibr">17</xref></sup>. MMAD and PERT were run in Matlab using author-supplied code<sup><xref rid="R6" ref-type="bibr">6</xref>,<xref rid="R7" ref-type="bibr">7</xref></sup> (PERT was converted from Octave using the Matlab converter, ‘oct2ml’). PERT was assessed using the same signature gene matrices used for the other expression-based methods. MMAD was evaluated using marker genes only, as this approach yielded superior results when compared to expression-based deconvolution (Fig. 3C vs. Fig. 3A in Liebner <italic>et al.</italic><sup><xref rid="R7" ref-type="bibr">7</xref></sup>). However, cell-specific marker genes could not be determined for all cell types in LM22, and therefore, MMAD and DSA were not run on datasets where LM22 was applied. All methods were run in non-log linear space.</p>
    </sec>
    <sec id="S13">
      <title>Microarray datasets and preprocessing</title>
      <p id="P39">Samples profiled on Illumina or Agilent platforms in <xref rid="F1" ref-type="fig">Fig. 1b</xref> (and <xref rid="SD3" ref-type="supplementary-material">Supplementary Table 2</xref>) were downloaded as normalized matrices from public repositories (either NCBI, EBI, or literature; referenced in <xref rid="SD3" ref-type="supplementary-material">Supplementary Table 2</xref>), and probes were converted to HUGO gene symbols using chipset definition files available from the NCBI gene expression omnibus (GEO). Human transcriptome data<sup><xref rid="R11" ref-type="bibr">11</xref></sup> from <xref rid="F1" ref-type="fig">Fig. 1c</xref> were downloaded as RMA-normalized arrays (E-MTAB-62, EBI ArrayExpress). Other Affymetrix arrays were obtained as CEL files, MAS5 normalized using the ‘affy’ package in Bioconductor, mapped to NCBI Entrez gene identifiers using a custom chip definition file (Brainarray version 12.1.0; <ext-link ext-link-type="uri" xlink:href="http://brainarray.mbni.med.umich.edu/Brainarray/">http://brainarray.mbni.med.umich.edu/Brainarray/</ext-link>; also available at <ext-link ext-link-type="uri" xlink:href="http://cibersort.stanford.edu">http://cibersort.stanford.edu</ext-link>), and converted to HUGO gene symbols. The Illumina BeadChip arrays analyzed in <xref rid="F3" ref-type="fig">Fig. 3a</xref> were normalized with limma v3.20.8 (Bioconductor) using ‘normexp’ background correction with negative controls (‘neqc’ function). For non-Affymetrix platforms, genes mapping to &gt;1 probe were collapsed at the gene-level according to the probe with highest mean expression across all samples. All microarray studies were quantile normalized prior to analysis. For normal lung tissues in <xref rid="F2" ref-type="fig">Fig. 2h</xref>, we analyzed GEO datasets, GSE7670<sup><xref rid="R27" ref-type="bibr">27</xref></sup> and GSE10072<sup><xref rid="R28" ref-type="bibr">28</xref></sup>, and for paired frozen and FFPE samples of DLBCL tumors in <xref rid="F2" ref-type="fig">Fig. 2g</xref>, we analyzed GSE18377<sup><xref rid="R16" ref-type="bibr">16</xref></sup>.</p>
    </sec>
    <sec id="S14">
      <title>LM22 signature matrix</title>
      <p id="P40">We obtained GEP data from the public domain for 22 leukocyte subsets profiled on the HGU133A platform (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). Probesets were preprocessed as described above. Significantly differentially expressed genes between each population and all other populations were identified using a two-sided unequal variance t-test. Genes with a q-value &lt; 0.3 (false discovery rate<sup><xref rid="R29" ref-type="bibr">29</xref></sup>) were considered significant.</p>
      <p id="P41">For each leukocyte subset, significant genes were ordered by decreasing fold change compared to other cell subsets, and the top <italic>G</italic> marker genes from each cell subset were combined into a signature matrix <bold>B</bold><italic><sup>G</sup></italic>. We iterated <italic>G</italic> from 50 to 200 across all subsets, and retained the signature matrix with the lowest condition number (condition number = 11.4; <italic>G</italic> = 102; <italic>n</italic> = 547 distinct genes; <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>).</p>
      <p id="P42">To prevent genes expressed on non-hematopoietic cell types from confounding deconvolution results, we also used two gene filtration strategies. First, we identified genes with enriched expression in non-hematopoietic cells or tissues using the Gene Enrichment Profiler, an online compendium of diverse cells and tissues profiled on HGU133A (<ext-link ext-link-type="uri" xlink:href="http://xavierlab2.mgh.harvard.edu/EnrichmentProfiler/">http://xavierlab2.mgh.harvard.edu/EnrichmentProfiler/</ext-link>)<sup><xref rid="R30" ref-type="bibr">30</xref></sup>. Gene Enrichment Profiler calculates an enrichment score (ES) for a given gene in a given cell or tissue type based on the sum of linear model coefficients from all pairwise comparisons of that gene with other samples. For each gene and cell or tissue type with ES &gt; 0, we determined the fraction of non-hematopoietic cell or tissue samples in the Gene Enrichment Profiler database, and excluded genes from the signature matrix with a non-hematopoietic fraction &gt;0.05. As a second filtration step, we omitted all genes from further analysis with a mean log<sub>2</sub> expression level ≥7 in all non-hematopoietic cancer cell lines profiled in the Cancer Cell Line Encyclopedia (CCLE) (pre-normalized gene expression data were extracted from CCLE_Expression_Entrez_2012-09-29.txt, downloaded from the Broad Institute). We termed the final signature matrix ‘LM22’.</p>
      <p id="P43">To validate the gene signatures used to distinguish each leukocyte subset in LM22, we applied CIBERSORT to a variety of external datasets, each containing one purified population also present in the signature matrix. We tested GEPs from three microarray platforms, Affymetrix HGU133A and HGU133 Plus 2.0, and the Illumina Human-6 v2 Expression BeadChip. Affymetrix platforms were normalized and processed the same as described for signature matrix GEPs. The BeadChip dataset was downloaded as a processed normalized matrix from ArrayExpress (E-TABM-633<sup><xref rid="R31" ref-type="bibr">31</xref></sup>), and for genes mapped to more than one probe, the probe with highest mean expression across all samples was further analyzed. For each sample, the population with the highest CIBERSORT-inferred fraction was compared to the known cell type to assess CIBERSORT accuracy (<xref rid="SD3" ref-type="supplementary-material">Supplementary Table 2</xref>).</p>
      <p id="P44">For the analysis presented in <xref rid="F1" ref-type="fig">Fig. 1c</xref>, arrays were grouped into 1,801 primary human specimens, consisting of 1,425 ‘positive’ samples containing at least one mature hematopoietic subset in LM22 and 376 ‘negative’ samples containing incompletely differentiated non-hematopoietic specimens, normal brain tissue (which typically contains microglia, but generally not cell types in LM22), and hematopoietic stem cells and progenitors (not in LM22). Arrays were separately grouped into 1,260 transformed cell lines, divided into 118 ‘positive’ hematopoietic samples and 1,142 ‘negative’ samples, the latter consisting of both non-hematopoietic samples and K562 erythromyeloblastoid cell lines, which are hematopoietic in origin but highly distinct from subsets present in LM22. Poorly annotated arrays were excluded from this analysis. While significance filtering was not applied in comparing CIBERSORT to other methods, we imposed a <italic>P</italic> value cutoff (≤0.01; see <xref rid="F1" ref-type="fig">Fig. 1c</xref>) for deconvolution of bulk tumors (<xref rid="F2" ref-type="fig">Fig. 2f</xref>).</p>
    </sec>
    <sec id="S15">
      <title>Other signature matrices</title>
      <p id="P45">In addition to LM22, custom signature matrices were designed for mixtures of hematopoietic cell lines and neural populations (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4a,b</xref>). In both cases, previously normalized series matrix datasets (GSE11103<sup><xref rid="R4" ref-type="bibr">4</xref></sup> and GSE19380<sup><xref rid="R13" ref-type="bibr">13</xref></sup>) were downloaded from GEO and quantile normalized. Signature matrices were subsequently constructed using the same condition number minimization algorithm described for LM22 (above), omitting non-hematopoietic gene filtration and validation steps. The final signature matrices for GSE11103 and GSE19380 were comprised of 584 probesets (condition number = 1.86) and 280 probesets (condition number = 1.8), respectively. To compare CIBERSORT performance with marker gene-based methods (as in <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>), we defined marker genes from each signature matrix by selecting all genes with at least five-fold higher expression in one cell type compared to the others (as in ref. <xref rid="R7" ref-type="bibr">7</xref>).</p>
    </sec>
    <sec id="S16">
      <title>Statistical analysis</title>
      <p id="P46">Unless stated otherwise, concordance between known and predicted cell type proportions was determined by Pearson correlation coefficient (<italic>R</italic>) and Root Mean Squared Error (RMSE) to measure linear fit and estimation bias, respectively. Importantly, the latter was calculated on cell type proportions represented as percentages. Group comparisons were determined using a two-sided Wilcoxon test, unpaired or paired, as appropriate. All results with <italic>P</italic> &lt; 0.05 were considered significant. Statistical analyses were performed with R and Prism v6.0d (GraphPad Software, Inc.).</p>
    </sec>
    <sec id="S17">
      <title>Analysis of idealized mixtures</title>
      <p id="P47">Unlike complex mixtures, idealized mixtures are defined in this work as having well-defined composition, in which the majority of the mixture can be accounted for by highly distinct (uncorrelated) reference profiles of purified cell types, and the contribution from unknown cell content and noise is minimal. CIBERSORT exhibited comparable performance to other methods on idealized mixtures, such as <italic>in vitro</italic> mixtures of blood cancer cell lines<sup><xref rid="R4" ref-type="bibr">4</xref></sup> and neural cell types<sup><xref rid="R13" ref-type="bibr">13</xref></sup> (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4a,b</xref>), and whole blood<sup><xref rid="R12" ref-type="bibr">12</xref></sup> (<xref rid="F1" ref-type="fig">Fig. 1d</xref>) (<xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>).</p>
    </sec>
    <sec id="S18">
      <title>Analysis of simulated tumors with added noise</title>
      <p id="P48">We benchmarked CIBERSORT against six GEP deconvolution methods (RLR and five others<sup><xref rid="R4" ref-type="bibr">4</xref>–<xref rid="R8" ref-type="bibr">8</xref></sup>) by comparing their results on mixtures with different levels of unknown content (i.e., tumor) and noise. To facilitate a fair comparison, we used previously defined <italic>in vitro</italic> mixtures (<italic>n</italic> = 12) of four blood cell lines (GSE11103), each of which is highly distinct and readily deconvolved (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4a</xref>). To evaluate expression-based methods, we used a signature matrix with nearly 600 distinguishing genes (described above and applied in <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 4a</xref>), whereas for marker-based deconvolution, we selected marker genes as described above (<italic>n</italic> = 500 genes). To simulate tumors with infiltrating leukocytes, we combined the cell line mixtures with defined inputs of a GEP from a colon cancer cell line (HCT116), calculated as the mean of two replicate arrays (GSM269529 and GSM269530; GSE10650). Both GSE11003 and GSE10650 datasets were MAS5 and quantile normalized together prior to analysis. To introduce noise, we added values randomly sampled from the following distribution, 2^<italic>N</italic>(0, <italic>f</italic> × σ), with <italic>f</italic> in the range [0,1) (i.e., <italic>y</italic>-axis in <xref rid="F2" ref-type="fig">Fig. 2a</xref> and <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 5a</xref>), and σ set to the global standard deviation across the original mixtures represented in log<sub>2</sub> space (=11.6). Since GSE11103 consists of four distinct mixtures with three replicates each, we measured the performance of each algorithm over the entire set of 12 mixtures (<italic>R</italic> and RMSE; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 5</xref>, <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>). Moreover, we independently iterated over tumor content (0% to &lt;100%) and noise (<italic>f</italic>, [0,1)) in 30 regularly spaced intervals, such that together, 900 sets of mixtures were analyzed.</p>
    </sec>
    <sec id="S19">
      <title>Analysis of cell subset detection limit</title>
      <p id="P49">We performed two <italic>in silico</italic> experiments to assess the detection limits of different deconvolution algorithms. In the first experiment (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 6</xref>), we used the same cell line GEPs described above to compare CIBERSORT and RLR with five other GEP deconvolution methods<sup><xref rid="R4" ref-type="bibr">4</xref>–<xref rid="R8" ref-type="bibr">8</xref></sup>. We evaluated detection limit using Jurkat cells (spike-in concentrations of 0.5%, 1%, 2.5%, 5%, 7.5%, and 10%), whose reference GEP (median of three replicates in GSE11103) was added into randomly created background mixtures of the other three blood cell lines. Five mixtures were created for each spike-in concentration. Predicted Jurkat fractions were assessed in the presence of differential tumor content, which we simulated by adding HCT116 (described above) in ten even increments, from 0% to 90%. Of note, we also used the same marker or signature genes described for simulated tumors (above). In a second experiment (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 7a</xref>), we compared CIBERSORT with QP<sup><xref rid="R5" ref-type="bibr">5</xref></sup>, LLSR<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, PERT<sup><xref rid="R6" ref-type="bibr">6</xref></sup>, and RLR. We spiked naïve B cell GEPs from the leukocyte signature matrix into four random background mixtures of the remaining 21 leukocyte subsets in the signature matrix. The same background mixtures were used for each spike-in. We also tested the addition of unknown content by adding defined proportions (0 to 90%) of randomly permuted expression values from a naïve B cell reference transcriptome (median expression profile from samples used to build LM22, <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). We then repeated this analysis for each of the remaining leukocyte subsets in LM22 (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 7b</xref>).</p>
    </sec>
    <sec id="S20">
      <title>Analysis of cell type-specific marker genes</title>
      <p id="P50">Cell type-specific marker genes may be difficult if not impossible to ascertain between closely related cell types. As such, we tested whether marker genes expressed by &gt;1 cell type in the signature matrix could still be useful to CIBERSORT, provided that each reference profile in the signature matrix remains unique. We created two artificial signature matrices (containing ten genes and five cell types each) representing opposite extremes: one containing only cell type specific genes (called SM1; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8a</xref>) and the other without any cell type specific genes (called SM2; <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8b</xref>). Of note, unlike signature matrices derived from real expression data, SM1 and SM2 are fully defined and therefore ideally suited for this analysis. Moreover, reference profiles in SM2 are highly inter-correlated, as might be expected for subsets without unique marker genes. We generated random mixing proportions according to a uniform distribution, and combined the cell types in each signature matrix to create ten mixtures. We then added low-level noise by randomly shuffling genes in one of the mixtures and combining 5% of the resulting vector with 95% of each of the ten mixtures. CIBERSORT and DSA were compared using SM1 (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8c</xref>), and CIBERSORT, RLR, QP, LLSR, and PERT were compared using SM2 (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8d,e</xref>). While CIBERSORT performed identically to DSA on SM1, it was substantially more accurate than other methods on SM2, closely approximating its performance on SM1 (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 8d,e</xref>). This analysis demonstrates CIBERSORT’s softer dependency on cell type specific signature matrix genes, an important requirement for deep deconvolution<sup><xref rid="R3" ref-type="bibr">3</xref></sup>.</p>
    </sec>
    <sec id="S21">
      <title>Analysis of multicollinearity</title>
      <p id="P51">We compared CIBERSORT with three signature gene expression-based deconvolution methods, QP<sup><xref rid="R5" ref-type="bibr">5</xref></sup>, LLSR<sup><xref rid="R4" ref-type="bibr">4</xref></sup>, and RLR (this work), for the impact of multicollinearity (i.e., the degree of inter-sample correlation in the signature matrix) on mixtures with unknown content (i.e., parts of the mixture unaccounted for in the signature matrix), and noise added to either <bold>B</bold> or <bold>m</bold>. Random signature matrices were created from 41 naïve B cell signature genes (derived from GSE22886<sup><xref rid="R32" ref-type="bibr">32</xref></sup>) by randomly selecting and permuting <italic>P</italic> gene expression values from the original non-random set of 41 genes, thus maintaining realistic gene expression distributions (<italic>n</italic> = 10 populations). The number of genes <italic>P</italic> was used to control multicollinearity within the signature matrix (higher <italic>P</italic> = less collinear, and vice versa), and for each <italic>P</italic>, ten random signature matrices were generated. Simulated mixtures were created by randomly apportioning populations from the signature matrix. To simulate unknown content (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 10a–c</xref>), three concentrations (5%, 25%, and 50%) of ten additional cell populations were randomly combined and added to each mixture. Non-log linear noise was additively introduced into simulated mixtures (<xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 10d</xref>) by randomly sampling from 2^<italic>N</italic>(0, <italic>j</italic>) (the exponent denotes a normal distribution with mean of zero and standard deviation <italic>j</italic>). Under all conditions tested, CIBERSORT outperformed the other three methods.</p>
    </sec>
    <sec id="S22">
      <title>Analysis of deconvolution consistency</title>
      <p id="P52">We applied LM22 to a publicly available dataset (GSE29832<sup><xref rid="R5" ref-type="bibr">5</xref></sup>) to measure stability of deconvolution results over defined levels of blood admixed with breast tissue. To confirm reported fractions of blood admixed with breast tissue, we compared these proportions with an ‘LM22 normalized immune index’, defined for each sample as the median gene expression value of all genes in LM22 (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>) divided by the median expression level of the transcriptome, and normalized into the range of known leukocyte content across the datasets (<xref rid="F2" ref-type="fig">Fig. 2e</xref>). As a consistency metric, we compared deconvolution results for each sample with results from the sample with highest immune purity (<xref rid="F2" ref-type="fig">Fig. 2e</xref>).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="S23">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="SD1">
      <label>1</label>
      <media xlink:href="NIHMS670442-supplement-1.pdf" orientation="portrait" xlink:type="simple" id="d37e1643" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD2">
      <label>2</label>
      <media xlink:href="NIHMS670442-supplement-2.xlsx" orientation="portrait" xlink:type="simple" id="d37e1647" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD3">
      <label>3</label>
      <media xlink:href="NIHMS670442-supplement-3.xlsx" orientation="portrait" xlink:type="simple" id="d37e1651" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD4">
      <label>4</label>
      <media xlink:href="NIHMS670442-supplement-4.xlsx" orientation="portrait" xlink:type="simple" id="d37e1655" position="anchor"/>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="SD5">
      <label>5</label>
      <media xlink:href="NIHMS670442-supplement-5.xlsx" orientation="portrait" xlink:type="simple" id="d37e1659" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="S24">
    <p>We are grateful to H. Maecker, M. Davis, R. Levy, and the Stanford Human Immune Monitoring Center for assistance with this study. This work was supported by grants from the Doris Duke Charitable Foundation (A.A.A.), the Damon Runyon Cancer Research Foundation (A.A.A.), the B&amp;J Cardan Oncology Research Fund (A.A.A.), the Ludwig Institute for Cancer Research (A.A.A. and M.D.), US National Institutes of Health (NIH) grant U01 CA154969 (A.J.G., W.F., Y.X., C.D.H., and M.D.), NIH grant U19 AI090019, NIH grant 5T32 CA09302-35 (A.M.N.), US Department of Defense grant W81XWH-12-1-0498 (A.M.N.), and a grant from the Siebel Stem Cell Institute and the Thomas and Stacey Siebel Foundation (A.M.N.).</p>
  </ack>
  <fn-group>
    <fn id="FN3">
      <p><bold>Accession codes</bold> Gene expression data from this work have been deposited in the Gene Expression Omnibus with accession code GSE65136.</p>
    </fn>
    <fn id="FN4" fn-type="con">
      <p><bold>Author Contributions</bold> A.M.N. and A.A.A conceived of CIBERSORT, developed strategies for related experiments, analyzed the data and wrote the paper. A.M.N. developed and implemented CIBERSORT. C.L.L. implemented web infrastructure and wrote the paper. M.R.G. performed flow cytometry and gene expression profiling of leukocytes from human tonsils and peripheral blood. A.J.G assisted in the conceptual development of CIBERSORT. W.F., Y.X., C.D.H. and M.D. assisted in the collection and analysis of lung tissue. All authors discussed the results and implications and commented on the manuscript at all stages.</p>
    </fn>
    <fn id="FN5" fn-type="conflict">
      <p>
        <bold>Competing Financial Interests</bold>
      </p>
      <p>The authors declare no competing financial interests.</p>
    </fn>
  </fn-group>
  <ref-list>
    <ref id="R1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hanahan</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Weinberg</surname>
            <given-names>RA</given-names>
          </name>
        </person-group>
        <source>Cell</source>
        <volume>144</volume>
        <fpage>646</fpage>
        <lpage>674</lpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21376230</pub-id>
      </element-citation>
    </ref>
    <ref id="R2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Coussens</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Zitvogel</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Palucka</surname>
            <given-names>AK</given-names>
          </name>
        </person-group>
        <source>Science</source>
        <volume>339</volume>
        <fpage>286</fpage>
        <lpage>291</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23329041</pub-id>
      </element-citation>
    </ref>
    <ref id="R3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen-Orr</surname>
            <given-names>SS</given-names>
          </name>
          <name>
            <surname>Gaujoux</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>Curr Opin Immunol</source>
        <volume>25</volume>
        <fpage>571</fpage>
        <lpage>578</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">24148234</pub-id>
      </element-citation>
    </ref>
    <ref id="R4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abbas</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>Wolslegel</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Seshasayee</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Modrusan</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Clark</surname>
            <given-names>HF</given-names>
          </name>
        </person-group>
        <source>PLoS One</source>
        <volume>4</volume>
        <fpage>e6098</fpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19568420</pub-id>
      </element-citation>
    </ref>
    <ref id="R5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gong</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <source>PLoS One</source>
        <volume>6</volume>
        <fpage>e27156</fpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">22110609</pub-id>
      </element-citation>
    </ref>
    <ref id="R6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qiao</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <source>PLoS Comput Biol</source>
        <volume>8</volume>
        <fpage>e1002838</fpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">23284283</pub-id>
      </element-citation>
    </ref>
    <ref id="R7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liebner</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Parvin</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <source>Bioinformatics</source>
        <volume>30</volume>
        <fpage>682</fpage>
        <lpage>689</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24085566</pub-id>
      </element-citation>
    </ref>
    <ref id="R8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Wan</surname>
            <given-names>YW</given-names>
          </name>
          <name>
            <surname>Pang</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Chow</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <source>BMC Bioinformatics</source>
        <volume>14</volume>
        <fpage>89</fpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23497278</pub-id>
      </element-citation>
    </ref>
    <ref id="R9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zuckerman</surname>
            <given-names>NS</given-names>
          </name>
          <name>
            <surname>Noam</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Goldsmith</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>PP</given-names>
          </name>
        </person-group>
        <source>PLoS Comput Biol</source>
        <volume>9</volume>
        <fpage>e1003189</fpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23990767</pub-id>
      </element-citation>
    </ref>
    <ref id="R10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schölkopf</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Smola</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Williamson</surname>
            <given-names>RC</given-names>
          </name>
          <name>
            <surname>Bartlett</surname>
            <given-names>PL</given-names>
          </name>
        </person-group>
        <source>Neural Comput</source>
        <volume>12</volume>
        <fpage>1207</fpage>
        <lpage>1245</lpage>
        <year>2000</year>
        <pub-id pub-id-type="pmid">10905814</pub-id>
      </element-citation>
    </ref>
    <ref id="R11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lukk</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nat Biotechnol</source>
        <volume>28</volume>
        <fpage>322</fpage>
        <lpage>324</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20379172</pub-id>
      </element-citation>
    </ref>
    <ref id="R12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen-Orr</surname>
            <given-names>SS</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nat Methods</source>
        <volume>7</volume>
        <fpage>287</fpage>
        <lpage>289</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20208531</pub-id>
      </element-citation>
    </ref>
    <ref id="R13">
      <label>13</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuhn</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Thu</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Waldvogel</surname>
            <given-names>HJ</given-names>
          </name>
          <name>
            <surname>Faull</surname>
            <given-names>RLM</given-names>
          </name>
          <name>
            <surname>Luthi-Carter</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>Nat Methods</source>
        <volume>8</volume>
        <fpage>945</fpage>
        <lpage>947</lpage>
        <year>2011</year>
        <pub-id pub-id-type="pmid">21983921</pub-id>
      </element-citation>
    </ref>
    <ref id="R14">
      <label>14</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yoshihara</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Nat Commun</source>
        <volume>4</volume>
        <fpage>2612</fpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">24113773</pub-id>
      </element-citation>
    </ref>
    <ref id="R15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Farrar</surname>
            <given-names>DE</given-names>
          </name>
          <name>
            <surname>Glauber</surname>
            <given-names>RR</given-names>
          </name>
        </person-group>
        <source>Rev Econ Stat</source>
        <volume>49</volume>
        <fpage>92</fpage>
        <lpage>107</lpage>
        <year>1967</year>
      </element-citation>
    </ref>
    <ref id="R16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Burington</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Sci Transl Med</source>
        <volume>3</volume>
        <fpage>74ra22</fpage>
        <year>2011</year>
      </element-citation>
    </ref>
    <ref id="R17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gong</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Szustakowski</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <source>Bioinformatics</source>
        <volume>29</volume>
        <fpage>1083</fpage>
        <lpage>1085</lpage>
        <year>2013</year>
        <pub-id pub-id-type="pmid">23428642</pub-id>
      </element-citation>
    </ref>
    <ref id="R18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Levy</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <source>J Clin Oncol</source>
        <volume>32</volume>
        <fpage>1797</fpage>
        <lpage>1803</lpage>
        <year>2014</year>
        <pub-id pub-id-type="pmid">24799467</pub-id>
      </element-citation>
    </ref>
    <ref id="R19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Nakorchevskiy</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Marcotte</surname>
            <given-names>EM</given-names>
          </name>
        </person-group>
        <source>Proc Natl Acad Sci USA</source>
        <volume>100</volume>
        <fpage>10370</fpage>
        <lpage>10375</lpage>
        <year>2003</year>
        <pub-id pub-id-type="pmid">12934019</pub-id>
      </element-citation>
    </ref>
    <ref id="R20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Z</given-names>
          </name>
        </person-group>
        <source>Nat Methods</source>
        <volume>9</volume>
        <fpage>8</fpage>
        <lpage>9</lpage>
        <year>2012</year>
        <pub-id pub-id-type="pmid">22205510</pub-id>
      </element-citation>
    </ref>
    <ref id="R21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guyon</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Elisseeff</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <source>J Mach Learn Res</source>
        <volume>3</volume>
        <fpage>1157</fpage>
        <lpage>1182</lpage>
        <year>2003</year>
      </element-citation>
    </ref>
    <ref id="R22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cherkassky</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <source>Neural Netw</source>
        <volume>17</volume>
        <fpage>113</fpage>
        <lpage>126</lpage>
        <year>2004</year>
        <pub-id pub-id-type="pmid">14690712</pub-id>
      </element-citation>
    </ref>
    <ref id="R23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoerl</surname>
            <given-names>AE</given-names>
          </name>
          <name>
            <surname>Kennard</surname>
            <given-names>RW</given-names>
          </name>
        </person-group>
        <source>Technometrics</source>
        <volume>12</volume>
        <fpage>55</fpage>
        <lpage>67</lpage>
        <year>1970</year>
      </element-citation>
    </ref>
    <ref id="R24">
      <label>24</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Hastie</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <source>The Elements of Statistical Learning</source>
        <edition>2</edition>
        <publisher-name>Springer-Verlag</publisher-name>
        <year>2009</year>
      </element-citation>
    </ref>
    <ref id="R25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zou</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <source>Statistica Sinica</source>
        <volume>16</volume>
        <fpage>589</fpage>
        <lpage>615</lpage>
        <year>2006</year>
      </element-citation>
    </ref>
    <ref id="R26">
      <label>26</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Drucker</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Burges</surname>
            <given-names>CJC</given-names>
          </name>
          <name>
            <surname>Kaufman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Smola</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Vapnik</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <source>Support Vector Regression Machines</source>
        <volume>9</volume>
        <publisher-name>MIT Press</publisher-name>
        <year>1997</year>
      </element-citation>
    </ref>
    <ref id="R27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Su</surname>
            <given-names>LJ</given-names>
          </name>
          <etal/>
        </person-group>
        <source>BMC Genomics</source>
        <volume>8</volume>
        <fpage>140</fpage>
        <year>2007</year>
        <pub-id pub-id-type="pmid">17540040</pub-id>
      </element-citation>
    </ref>
    <ref id="R28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Landi</surname>
            <given-names>MT</given-names>
          </name>
          <etal/>
        </person-group>
        <source>PLoS One</source>
        <volume>3</volume>
        <fpage>e1651</fpage>
        <year>2008</year>
        <pub-id pub-id-type="pmid">18297132</pub-id>
      </element-citation>
    </ref>
    <ref id="R29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Tibshirani</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <source>Proc Natl Acad Sci USA</source>
        <volume>100</volume>
        <fpage>9440</fpage>
        <lpage>9445</lpage>
        <year>2003</year>
        <pub-id pub-id-type="pmid">12883005</pub-id>
      </element-citation>
    </ref>
    <ref id="R30">
      <label>30</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Benita</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Blood</source>
        <volume>115</volume>
        <fpage>5376</fpage>
        <lpage>5384</lpage>
        <year>2010</year>
        <pub-id pub-id-type="pmid">20410506</pub-id>
      </element-citation>
    </ref>
    <ref id="R31">
      <label>31</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Watkins</surname>
            <given-names>NA</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Blood</source>
        <volume>113</volume>
        <fpage>e1</fpage>
        <lpage>9</lpage>
        <year>2009</year>
        <pub-id pub-id-type="pmid">19228925</pub-id>
      </element-citation>
    </ref>
    <ref id="R32">
      <label>32</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abbas</surname>
            <given-names>AR</given-names>
          </name>
          <etal/>
        </person-group>
        <source>Genes Immun</source>
        <volume>6</volume>
        <fpage>319</fpage>
        <lpage>331</lpage>
        <year>2005</year>
        <pub-id pub-id-type="pmid">15789058</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="F1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Overview of CIBERSORT and application to leukocyte deconvolution. (<bold>a</bold>) Schematic of the approach. (<bold>b</bold>,<bold>c</bold>) Application of a leukocyte signature matrix (LM22) to deconvolution of (<bold>b</bold>) 208 arrays of distinct purified or enriched leukocyte subsets (<xref rid="SD3" ref-type="supplementary-material">Supplementary Table 2</xref>), and (<bold>c</bold>) 3,061 diverse human transcriptomes. Sensitivity (Sn) and specificity (Sp) in <bold>c</bold> are defined in relation to positive and negative groups (Online Methods). AUC, area under the curve. (<bold>d</bold>) CIBERSORT analysis of 24 whole blood samples for lymphocytes, monocytes, and neutrophils compared to measurements by Coulter counter<sup><xref rid="R12" ref-type="bibr">12</xref></sup>. Concordance was measured by Pearson correlation (<italic>R</italic>) and linear regression (dashed line). ‘CIBERSORT fraction’ in <bold>b</bold> denotes the relative fraction assigned to each leukocyte subset by CIBERSORT. Resting and activated subsets in <bold>b</bold> are indicated by + and −, respectively.</p>
    </caption>
    <graphic xlink:href="nihms670442f1"/>
  </fig>
  <fig id="F2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Performance assessment on RNA mixtures from complex tissues. (<bold>a</bold>–<bold>c</bold>) CIBERSORT accuracy for leukocyte subset resolution in simulated tissues, showing (<bold>a</bold>) performance across added tumor content (<italic>x</italic>-axis) and noise (<italic>y</italic>-axis), (<bold>b</bold>) deviation of mixtures in <bold>a</bold> from original values, and (<bold>c</bold>) detection limits of a given cell type as a function of increasing tumor content (<italic>n</italic> = 5 random mixtures for each data point). (<bold>d</bold>) Comparison of six GEP deconvolution methods with CIBERSORT for the analyses shown in <bold>a</bold>–<bold>c</bold> (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figs. 5,6</xref>). (<bold>e</bold>) Analysis of whole blood spiked into breast tissue. Left: Reported blood proportions versus immune-related gene expression (LM22 normalized immune index; Online Methods). Right: Stability of leukocyte deconvolution across methods. (<bold>f</bold>) CIBERSORT consistency across independent studies within and across cancer types (for leukocyte abbreviations, see <xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). (<bold>g</bold>–<bold>i</bold>) CIBERSORT performance compared between (<bold>g</bold>) 18 paired frozen and FFPE DLBCL samples, and compared to flow cytometry analysis of (<bold>h</bold>) 11 normal lung tissues and (<bold>i</bold>) 14 follicular lymphoma tumors. Asterisks in <bold>i</bold> indicate potential outliers from the same patient. Surface markers used for quantitation in <bold>h</bold> and <bold>i</bold> are indicated in parentheses. Results in <bold>e</bold>–<bold>i</bold> were obtained using LM22 and then collapsed into 11 major leukocyte types before analysis (<xref rid="SD2" ref-type="supplementary-material">Supplementary Table 1</xref>). Concordance was determined by Pearson correlation (<italic>R</italic>) and linear regression (dashed lines) in <bold>e</bold> and <bold>g</bold>–<bold>i</bold>. Values in <bold>c</bold> and <bold>h</bold> are presented as medians ± 95% confidence intervals.</p>
    </caption>
    <graphic xlink:href="nihms670442f2"/>
  </fig>
  <fig id="F3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <p>Deep deconvolution and enumeration of individual cell subsets in 41 human subjects. (<bold>a</bold>–<bold>c</bold>) Direct comparison between CIBERSORT and flow cytometry for: (<bold>a</bold>) the indicated eight immune cell subsets in PBMCs from 20 subjects, (<bold>b</bold>) FOXP3+ Tregs in PBMCs from seven subjects, and (<bold>c</bold>) the indicated three immune cell subsets in lymph node biopsies from 14 subjects with follicular lymphoma (FL). Concordance was determined by Pearson correlation (<italic>R</italic>) and linear regression (solid lines). (<bold>d</bold>) Comparison of five expression-based deconvolution methods on the datasets analyzed in <bold>a</bold>–<bold>c</bold>. The shaded gray area denotes deconvolved cell types that significantly correlated with flow cytometry (<italic>P</italic> &lt; 0.05, Pearson correlation). Scatterplots and RMSE values for all methods are provided in the supplement (<xref rid="SD1" ref-type="supplementary-material">Supplementary Figs. 12, 13</xref> and <xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>, respectively). In three instances, correlation coefficients could not be determined; these were assigned a value of zero for inclusion in this panel (<xref rid="SD5" ref-type="supplementary-material">Supplementary Table 4</xref>, <xref rid="SD1" ref-type="supplementary-material">Supplementary Fig. 12</xref>). Data are presented as means ± standard deviations.</p>
    </caption>
    <graphic xlink:href="nihms670442f3"/>
  </fig>
</floats-group>
