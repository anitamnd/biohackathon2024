<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-archivearticle1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS ONE</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3587622</article-id>
    <article-id pub-id-type="pmid">23469199</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-12-34651</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0057521</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v2">
        <subject>Biology</subject>
        <subj-group>
          <subject>Computational Biology</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Genome Analysis Tools</subject>
              <subject>Genome Sequencing</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Sequence Analysis</subject>
          </subj-group>
        </subj-group>
        <subj-group>
          <subject>Genomics</subject>
          <subj-group>
            <subject>Genome Sequencing</subject>
          </subj-group>
        </subj-group>
        <subj-group>
          <subject>Proteomics</subject>
          <subj-group>
            <subject>Sequencing</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v2">
        <subject>Computer Science</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Software Tools</subject>
          </subj-group>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="Discipline-v2">
        <subject>Engineering</subject>
        <subj-group>
          <subject>Software Engineering</subject>
          <subj-group>
            <subject>Software Tools</subject>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>TagGD: Fast and Accurate Software for DNA Tag Generation and Demultiplexing</article-title>
      <alt-title alt-title-type="running-head">TagGD: Software to Generate &amp; Demultiplex DNA Tags</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Costea</surname>
          <given-names>Paul Igor</given-names>
        </name>
        <xref ref-type="aff" rid="aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lundeberg</surname>
          <given-names>Joakim</given-names>
        </name>
        <xref ref-type="aff" rid="aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Akan</surname>
          <given-names>Pelin</given-names>
        </name>
        <xref ref-type="aff" rid="aff1"/>
        <xref ref-type="corresp" rid="cor1">
          <sup>*</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff1">
      <addr-line>KTH – Royal Institute of Technology, Science for Life Laboratory, School of Biotechnology, Solna, Sweden</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Benos</surname>
          <given-names>Panayiotis V.</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>University of Pittsburgh, United States of America</addr-line>
    </aff>
    <author-notes>
      <corresp id="cor1">* E-mail: <email>pelin.akan@scilifelab.se</email></corresp>
      <fn fn-type="COI-statement">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <fn fn-type="con">
        <p>Conceived and designed the experiments: PA. Performed the experiments: PA PIC. Analyzed the data: PA PIC. Contributed reagents/materials/analysis tools: JL. Wrote the paper: PA PIC.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2013</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>4</day>
      <month>3</month>
      <year>2013</year>
    </pub-date>
    <volume>8</volume>
    <issue>3</issue>
    <elocation-id>e57521</elocation-id>
    <history>
      <date date-type="received">
        <day>7</day>
        <month>11</month>
        <year>2012</year>
      </date>
      <date date-type="accepted">
        <day>22</day>
        <month>1</month>
        <year>2013</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2013 Costea et al</copyright-statement>
      <copyright-year>2013</copyright-year>
      <copyright-holder>Costea et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are properly credited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Multiplexing is of vital importance for utilizing the full potential of next generation sequencing technologies. We here report TagGD (DNA-based Tag Generator and Demultiplexor), a fully-customisable, fast and accurate software package that can generate thousands of barcodes satisfying user-defined constraints and can guarantee full demultiplexing accuracy. The barcodes are designed to minimise their interference with the experiment. Insertion, deletion and substitution events are considered when designing and demultiplexing barcodes. 20,000 barcodes of length 18 were designed in 5 minutes and 2 million barcoded Illumina HiSeq-like reads generated with an error rate of 2% were demultiplexed with full accuracy in 5 minutes. We believe that our software meets a central demand in the current high-throughput biology and can be utilised in any field with ample sample abundance. The software is available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/pelinakan/UBD.git">https://github.com/pelinakan/UBD.git</ext-link>).</p>
    </abstract>
    <funding-group>
      <funding-statement>This work was funded by SSF- nanopore (Swedish Foundation for Strategic Research) and EU- digital seq (Digital Sequencing, EU FP7 grant agreement number 222913). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <page-count count="5"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="s1">
    <title>Introduction</title>
    <p>Parallel processing of samples is a powerful method to perform multiple experiments in time and cost-effective manner. Next generation sequencing technologies provide the necessary platform to achieve this <xref rid="pone.0057521-Erlich1" ref-type="bibr">[1]</xref>, <xref rid="pone.0057521-Patwardhan1" ref-type="bibr">[2]</xref>. Given the current developments in sequencing platforms, the scale of multiplexing will grow requiring larger numbers of barcodes due to high sequence throughput <xref rid="pone.0057521-Stahl1" ref-type="bibr">[3]</xref>.</p>
    <p>Generating unique barcodes is challenging in a number of ways. Firstly, barcodes should conform to particular constraints such as length, GC-content, cross-hybridisation with experimental sequences, absence of particular restriction enzymes to minimise their interference with the actual experiment. Secondly, they should be unique enough to allow correct assignment of sequences to their original samples. This can be problematic since there can be errors introduced in the barcodes during both their synthesis and sequencing, resulting in non-unique barcodes. Using longer barcodes could partially solve this issue however they could hamper the sequencing space for the actual sample. Therefore it is imperative to design sufficient number of barcodes with optimal length and maximal distance to each other.</p>
    <p>A framework developed by Xu. al. (DeLOB) can generate large numbers of barcodes that can then be printed on microarrays. However uniqueness of barcodes is based on their cross-hybridization and no demultiplexing step is implemented <xref rid="pone.0057521-Xu1" ref-type="bibr">[4]</xref>. There are a number of available software tools to design and demultiplex DNA barcodes but generation of longer ones (&gt;15mer) is not feasible using these tools <xref rid="pone.0057521-Hamady1" ref-type="bibr">[5]</xref>, <xref rid="pone.0057521-Frank1" ref-type="bibr">[6]</xref>. A recent publication provides a DNA barcode design framework based on Hamming codes, however the design is limited since the sequence uniqueness is determined only by base-changes (Hamming distance) and does not take into account insertion and deletion events <xref rid="pone.0057521-Bystrykh1" ref-type="bibr">[7]</xref>. It is possible to design barcodes that are capable of detecting and correcting errors for optimal demultiplexing <xref rid="pone.0057521-Hamady1" ref-type="bibr">[5]</xref>. A resource is available to generate error-correcting binary codes up to length 30 (corresponding to 15mer DNA barcodes) after which it is challenging to discover such optimal codes <xref rid="pone.0057521-Grassl1" ref-type="bibr">[8]</xref>. Such methods may not provide sufficient number of barcodes especially after applying user-specified constraints.</p>
    <p>We here implemented a software package for designing large numbers of barcodes of virtually any length that can be demultiplexed with full accuracy. We employed Levenshtein distance to discriminate between the barcodes <xref rid="pone.0057521-Levenshtein1" ref-type="bibr">[9]</xref> since insertions and deletions also occur in DNA synthesis and sequencing steps <xref rid="pone.0057521-McDonald1" ref-type="bibr">[10]</xref>, <xref rid="pone.0057521-Shendure1" ref-type="bibr">[11]</xref>.</p>
    <p>TagGD is easy-to-use, fully customizable, memory-efficient, fast software package and can also be run on a desktop computer. The user needs to specify the number and length of the barcode and the uniqueness based on the combined estimated error rate of the platforms that synthesise and sequence the barcodes including the error modality of the platform. Then the software provides the user the unique barcodes that will give the maximal accuracy within the allowed error rate. If the number of barcodes is not sufficient, the user can then either increase the length of the barcode or decrease the error rate. The user can also impose constraints on the barcode sequences using the barcode configuration file. In the demultiplexing step, the software takes FASTQ files and outputs demultiplexed reads in a FASTQ file with the optional third line containing the barcode of the reads.</p>
  </sec>
  <sec sec-type="materials|methods" id="s2">
    <title>Materials and Methods</title>
    <sec id="s2a">
      <title>Design</title>
      <p>First, a random barcode of the desired length and GC content is generated, then it is checked for mono, di or tri-mer repeats, complexity, self-hybridisation, presence of restriction enzyme cut motifs (if required) and edit distance to its reverse complement. It is also hybridised with primers/adapters used in the experiment to prevent its interference. Gibb's free energy and melting temperature of the self-hybridised barcodes were computed using the DNA-fold algorithm <xref rid="pone.0057521-Zuker1" ref-type="bibr">[12]</xref> and sequences with strong secondary structures are discarded. If the barcode passes these filters, it is added to a barcode pool, and its uniqueness is checked. We use Levenshtein distance to measure the distance of two barcodes in the sequence space. We also allow wildcard position at the beginning and end of the barcode to exclude barcodes that cannot be discriminated as a result of an insertion/deletion. This option is called “padding”, when it is set to 0, the set will be resistant to substitution errors but not to insertions/deletions to the same extent. The user is recommended to use the same padding option for demultiplexing that s/he used for barcode design. The generated barcodes are printed in a text file, one line containing each barcode. The edit distance distribution of pairs of barcodes is also written in another file. Almost all parameters of TagGD can be adjusted in the configuration file; an example is included within the software package.</p>
      <p>For demultiplexing, a hash map is built, containing all the k-mers of a given length appearing in all barcodes. This map is filled by searching against with overlapping k-mers of the putative barcode sequence so that each barcode is related to the k-mers it contains. This results in reducing the search space and thus greatly improving the time necessary to identify the best hit. All barcodes that have been found through the map search will be compared to the putative sequence through a semi-global alignment that ensures full overlap with the entire barcode. Also here we employ a parallel strategy due to each barcode mapping being independent. A given number of threads are created which consume the input, and output the computed best mapping. Note that as a result of this, the order of entries is not preserved between input and output. The input and output of the demultiplexer is in FASTQ format, the details of the best-hit barcode are added to the optional third line of the output FASTQ file. TagGD supports paired-end sequencing data.</p>
    </sec>
    <sec id="s2b">
      <title>Implementation</title>
      <p>TagGD is implemented using C++ and parallelised using POSIX Threads and OpenMP <xref rid="pone.0057521-Butenhof1" ref-type="bibr">[13]</xref>, <xref rid="pone.0057521-Dagum1" ref-type="bibr">[14]</xref>. First, random DNA sequences of desired length and GC content are generated. Sequences are then filtered as specified in the previous section to ensure least interference with each other and the experiment.</p>
      <p>Each barcode has to be unique. Because of possible experimental and sequencing errors, barcodes should be far away from each other in sequence space to prevent their false classification. Operations can be substitutions, insertions or deletions. The aim is to find a set of sequences where each has an edit distance greater than the desired threshold to the entire set. Thus, each new sequence that passes all the above filters is checked against the solution set and is accepted only if the edit distance to all previously accepted elements is greater than the imposed limit. As the two operations of filtering and insertion are independent, a worker thread is created to handle the generation of barcodes and push those to a common pool as shown in <xref ref-type="fig" rid="pone-0057521-g001">Figure 1</xref>. The insertion operation imposes a growing cost, scaling with the size of the solution set. Thus a parallelizing strategy is also employed here, where all the available threads are used to concomitantly search through non-overlapping subsets of the solution space. <xref ref-type="table" rid="pone-0057521-t001">Table 1</xref> lists the running times for generating different numbers of barcodes with and without padding option on.</p>
      <fig id="pone-0057521-g001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0057521.g001</object-id>
        <label>Figure 1</label>
        <caption>
          <title>The generation of barcodes along with all the filtering steps are performed concurrently with the execution of the main application.</title>
          <p>Each barcode that passes filtering is added to a pool and generation of more barcodes continues. This pool is in time drained by the main application where the insertion into the solution set takes place.</p>
        </caption>
        <graphic xlink:href="pone.0057521.g001"/>
      </fig>
      <table-wrap id="pone-0057521-t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0057521.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Running times for generating different numbers of barcodes of length 18 with different edit distances and padding.</title>
        </caption>
        <alternatives>
          <graphic id="pone-0057521-t001-1" xlink:href="pone.0057521.t001"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <td align="left" rowspan="1" colspan="1">Padding</td>
                <td align="left" rowspan="1" colspan="1">Edit Distance</td>
                <td align="left" rowspan="1" colspan="1">Number of Barcodes</td>
                <td align="left" rowspan="1" colspan="1">Generation Time</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">3</td>
                <td align="left" rowspan="1" colspan="1">5,000</td>
                <td align="left" rowspan="1" colspan="1">18 seconds</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">4</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">19 seconds</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">3</td>
                <td align="left" rowspan="1" colspan="1">20,000</td>
                <td align="left" rowspan="1" colspan="1">4 minutes</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">4</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">5 minutes</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">3</td>
                <td align="left" rowspan="1" colspan="1">100,000</td>
                <td align="left" rowspan="1" colspan="1">1.5 hours</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">4</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">7 hours</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">3</td>
                <td align="left" rowspan="1" colspan="1">1,000</td>
                <td align="left" rowspan="1" colspan="1">1.4 seconds</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">4</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">2 seconds</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">3</td>
                <td align="left" rowspan="1" colspan="1">5,000</td>
                <td align="left" rowspan="1" colspan="1">16 seconds</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">4</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">46 seconds</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">3</td>
                <td align="left" rowspan="1" colspan="1">10,000</td>
                <td align="left" rowspan="1" colspan="1">1 minute</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">4</td>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">14 minutes</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="nt101">
            <label/>
            <p>Benchmarking was performed on an 8 core 24 Gb machine.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
  </sec>
  <sec id="s3">
    <title>Results</title>
    <sec id="s3a">
      <title>Assuring the uniqueness of the barcodes</title>
      <p>Accuracy of the demultiplexing step depends on the combined error rate of the platform processing the barcodes as well as the nature of the error. We implemented TagGD to generate required number of barcodes within reasonable run times while ensuring maximal accuracy depending on the nature and the rate of the errors. An error introduced within a barcode may cause a situation that the error-containing barcode could have the same edit distance to two or more barcodes in the set, hence cannot be classified (<xref ref-type="fig" rid="pone-0057521-g002">Figure 2A</xref>). Worse case scenario is that if the error containing barcode has a smaller edit distance to another barcode than to its original, which leads to its misclassification (<xref ref-type="fig" rid="pone-0057521-g002">Figure 2B</xref>). In our experience most of the wrongly classified barcodes were due to insertion and deletion errors. Therefore we developed a strategy that deals with the problem of shifting of the barcode within the read due to insertions or deletions. To this end, we included wild card positions (padding) at the start and end of the barcode, resulting in a semi-global alignment strategy when calculating its distance to another barcode. This step ensures exclusion of barcodes that can be converted to another barcode in the set due to positional errors, insertions and deletions. Additionally, to eliminate cases where an error-containing barcode lie in equal distance to two or more barcodes, we recommend setting the minimal edit distance at least more than twice the number of bases expected to be erroneous based on the estimated error rate (<xref ref-type="disp-formula" rid="pone.0057521.e001">Equation 1</xref>).<disp-formula id="pone.0057521.e001"><graphic xlink:href="pone.0057521.e001.jpg" position="anchor" orientation="portrait"/><label>(1)</label></disp-formula>
</p>
      <fig id="pone-0057521-g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0057521.g002</object-id>
        <label>Figure 2</label>
        <caption>
          <title>Let barcode 1 and 2 are the barcodes within the designed unique barcode set and another barcode containing errors introduced during the experiment, and the edges of the triangles represent the Levenshtein edit distance between them.</title>
          <p>A) Barcode 1 can be converted to Barcode 3 with three operations. However two errors introduced either in barcode 1 or 2 can result in a new sequence, which requires same number of operations to transform to either barcode 1 or 2. Therefore, it cannot be classified. B) Barcode 1 is incorrectly synthesised or sequenced in such a way that it now has a smaller edit distance to barcode 2, which leads to its misclassification.</p>
        </caption>
        <graphic xlink:href="pone.0057521.g002"/>
      </fig>
      <p>If most of the errors are expected to be due to substitutions then there is no need to design the barcodes with the padding option on so this can be set to zero. This will ensure to give the user the maximal number of barcodes within the shortest running time with full accuracy as long as <xref ref-type="disp-formula" rid="pone.0057521.e001">equation 1</xref> is satisfied. In other words, the barcodes can have errors as half the number of minimum edit distance in the set and can still be demultiplexed with 100% accuracy (<xref ref-type="table" rid="pone-0057521-t002">Table 2</xref>).</p>
      <table-wrap id="pone-0057521-t002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0057521.t002</object-id>
        <label>Table 2</label>
        <caption>
          <title>20,000 unique barcodes of length 18 were generated with no padding option.</title>
        </caption>
        <alternatives>
          <graphic id="pone-0057521-t002-2" xlink:href="pone.0057521.t002"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <td align="left" rowspan="1" colspan="1">k-mer Length</td>
                <td align="left" rowspan="1" colspan="1">Percentage of reads that are wrongly classified</td>
                <td align="left" rowspan="1" colspan="1">Reads that cannot be uniquely classified</td>
                <td align="left" rowspan="1" colspan="1">Running time (seconds)</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">9</td>
                <td align="left" rowspan="1" colspan="1">0.27% (537)</td>
                <td align="left" rowspan="1" colspan="1">1.7% (3423)</td>
                <td align="left" rowspan="1" colspan="1">1.5</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">0.14% (276)</td>
                <td align="left" rowspan="1" colspan="1">0.38% (760)</td>
                <td align="left" rowspan="1" colspan="1">2.1</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">7</td>
                <td align="left" rowspan="1" colspan="1">0.11% (223)</td>
                <td align="left" rowspan="1" colspan="1">0.13% (267)</td>
                <td align="left" rowspan="1" colspan="1">5.9</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">6</td>
                <td align="left" rowspan="1" colspan="1">0% (0)</td>
                <td align="left" rowspan="1" colspan="1">0% (0)</td>
                <td align="left" rowspan="1" colspan="1">27.8</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="nt102">
            <label/>
            <p>Then 200,000 barcoded reads of length 18 are generated and errors are introduced with 2% probability, only substitutions errors are allowed. With k-mer length of 6, all reads can be demultiplexed correctly in less than half a minute. Benchmarking is performed in an 8-core machine with 24 Gb memory.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>However if the user expects insertion and deletion events, then the padding option must be used and the padding should be equal to the expected number of insertion or deletion events within the read. To ensure full accuracy in the demultiplexing step, <xref ref-type="disp-formula" rid="pone.0057521.e001">equation 1</xref> must still hold but this time errors can be substitutions, insertions or deletions.</p>
    </sec>
    <sec id="s3b">
      <title>Demultiplexing of the barcodes</title>
      <p>Systematic errors, in either the experiment or the sequencing can cause substitutions, insertions or deletions in the sequence. This necessitates an extra step for correctly identifying the sequenced barcode. We have implemented a semi-global aligner, in line with the edit distance definition used in generating the barcodes. It ensures the best match of a given sequence to the set of barcodes. The alignment is quality aware and will discriminate between two equally good mappings (from an edit distance perspective) based on the quality of the bases.</p>
      <p>False negative rate of the demultiplexing depends on the k-mer length. To achieve full accuracy, the k-mer size must be set such that there will be at least one window of size k not containing an erroneous base (<xref ref-type="disp-formula" rid="pone.0057521.e002">Equation 2</xref>). However given the low probability of having all the expected erroneous bases within the barcode, the k-mer size can be increased at a low cost to the accuracy while reducing the running time. To assess the effect of the k-mer length on accuracy, we have designed 10,000 and 20,000 barcodes of length 18 (with or without padding respectively) with a minimum edit distance of 4. We used the default settings (GC content between 45–65%, homopolymer limit 4, self hybridisation temperature 50°C). On these we simulated 200,000 reads with an error rate of 2%. <xref ref-type="table" rid="pone-0057521-t002">Tables 2</xref> and <xref ref-type="table" rid="pone-0057521-t003">3</xref> shows the running times for demultiplexing as well as the specificity relation to k-mer length. The running times scales linearly with the number of reads demultiplexed.<disp-formula id="pone.0057521.e002"><graphic xlink:href="pone.0057521.e002.jpg" position="anchor" orientation="portrait"/><label>(2)</label></disp-formula>
</p>
      <table-wrap id="pone-0057521-t003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0057521.t003</object-id>
        <label>Table 3</label>
        <caption>
          <title>10,000 unique barcodes of length 18 were generated with padding option set to 1.</title>
        </caption>
        <alternatives>
          <graphic id="pone-0057521-t003-3" xlink:href="pone.0057521.t003"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td colspan="3" align="left" rowspan="1">Indexes are mapped back using positional inaccuracy set to 1</td>
                <td colspan="3" align="left" rowspan="1">Indexes are mapped back with no positional inaccuracy</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">k-mer Length</td>
                <td align="left" rowspan="1" colspan="1">% of reads that are wrongly classified</td>
                <td align="left" rowspan="1" colspan="1">% of reads that cannot be uniquely classified</td>
                <td align="left" rowspan="1" colspan="1">Running time (seconds)</td>
                <td align="left" rowspan="1" colspan="1">% of reads that are wrongly classified</td>
                <td align="left" rowspan="1" colspan="1">% of reads that cannot be uniquely classified</td>
                <td align="left" rowspan="1" colspan="1">Running time (seconds)</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">9</td>
                <td align="left" rowspan="1" colspan="1">0.26% (525)</td>
                <td align="left" rowspan="1" colspan="1">1.64% (3280)</td>
                <td align="left" rowspan="1" colspan="1">2</td>
                <td align="left" rowspan="1" colspan="1">0.13% (256)</td>
                <td align="left" rowspan="1" colspan="1">1.84% (3684)</td>
                <td align="left" rowspan="1" colspan="1">1.8</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">8</td>
                <td align="left" rowspan="1" colspan="1">0.13% (266)</td>
                <td align="left" rowspan="1" colspan="1">0.33% (659)</td>
                <td align="left" rowspan="1" colspan="1">2.7</td>
                <td align="left" rowspan="1" colspan="1">0.07% (134)</td>
                <td align="left" rowspan="1" colspan="1">0.49% (981)</td>
                <td align="left" rowspan="1" colspan="1">1.6</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">7</td>
                <td align="left" rowspan="1" colspan="1">0.05% (105)</td>
                <td align="left" rowspan="1" colspan="1">0.05% (96)</td>
                <td align="left" rowspan="1" colspan="1">6.9</td>
                <td align="left" rowspan="1" colspan="1">0.06% (123)</td>
                <td align="left" rowspan="1" colspan="1">0.20% (400)</td>
                <td align="left" rowspan="1" colspan="1">3.7</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">6</td>
                <td align="left" rowspan="1" colspan="1">0% (0)</td>
                <td align="left" rowspan="1" colspan="1">0% (0)</td>
                <td align="left" rowspan="1" colspan="1">27.3</td>
                <td align="left" rowspan="1" colspan="1">0% (7)</td>
                <td align="left" rowspan="1" colspan="1">0% (8)</td>
                <td align="left" rowspan="1" colspan="1">15.5</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="nt103">
            <label/>
            <p>Then 200,000 barcoded reads of length 18 are generated and errors are introduced with 2% probability, substitutions, insertions and deletions are allowed. With k-mer length of 6, all reads can be demultiplexed correctly in less than half a minute, if the user uses positional inaccuracy set to 1 (equal to the padding option used in designing the barcodes). Benchmarking is performed in an 8-core machine with 24 Gb memory.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>The user must provide the starting position of the barcode within the read. We allow for some variation of this site (positional error) considering that insertions or deletions may occur before the barcode location. When setting the positional error during demultiplexing, the user should consider the time cost of this (<xref ref-type="table" rid="pone-0057521-t003">Table 3</xref>) as well as the design step padding. For example, designing with padding zero results in a fully global alignment, which over-estimates the edit distances between barcodes. We suggest the user to set the positional inaccuracy to the padding used in design stage for maximal demultiplexing accuracy. Also note that TagGD supports demultiplexing reads in which the position of the barcode is unknown, by setting the positional error to -1. This will be considerably slower and will result in less accuracy.</p>
    </sec>
  </sec>
  <sec id="s4">
    <title>Discussion</title>
    <p>TagGD is can be downloaded from Github repository and it can be run on Linux and Windows operating systems. We provide user instructions and sample input files to ease to usage of the package (Supplementary Information). We also provide a set of scripts to test the accuracy and speed of the TagGD.</p>
    <p>TagGD can generate large numbers of unique DNA sequences that can be used for various biological applications. We believe that TagGD can be used for any given application that requires indexing of sequences and it is implemented in a flexible way so that it can be adapted for various lengths, sequence content as well as their interference with sequences used in the experiments can be also checked against the index sequences. One may consider sequencing a large number of single cells where each cell is barcoded to provide the necessary transcriptome resolution or generating barcodes for the recently developed massively parallel gene reporter assay <xref rid="pone.0057521-Melnikov1" ref-type="bibr">[15]</xref>. We also provide the algorithm to map back the index sequences with full accuracy as long as the actual error rate of the experiment does not exceed the estimated error rate used for designing the barcodes.</p>
    <p>Barcode design unit of TagGD can be adapted to design multiplex PCR primers or microarray probes for a given genome. This would require replacing the random generation of barcodes step with given sequences from the genome of interest. Additionally demultiplexing unit of TagGD can be adapted to retrieve barcodes for multiplexed sequencing experiments to improve accuracy and speed of sample identity recovery.</p>
  </sec>
</body>
<back>
  <ack>
    <p>We thank Kristoffer Sahlin for his very valuable comments and suggestions for improving the code and discussion of the manuscript.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0057521-Erlich1">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Erlich</surname><given-names>Y</given-names></name>, <name><surname>Chang</surname><given-names>K</given-names></name>, <name><surname>Gordon</surname><given-names>A</given-names></name>, <name><surname>Ronen</surname><given-names>R</given-names></name>, <name><surname>Navon</surname><given-names>O</given-names></name>, <etal>et al</etal> (<year>2009</year>) <article-title>DNA Sudoku – harnessing high-throughput sequencing for multiplexed specimen analysis</article-title>. <source>Genome research</source>
<volume>19</volume>: <fpage>1243</fpage>–<lpage>1253</lpage>.<pub-id pub-id-type="pmid">19447965</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0057521-Patwardhan1">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Patwardhan</surname><given-names>RP</given-names></name>, <name><surname>Hiatt</surname><given-names>JB</given-names></name>, <name><surname>Witten</surname><given-names>DM</given-names></name>, <name><surname>Kim</surname><given-names>MJ</given-names></name>, <name><surname>Smith</surname><given-names>RP</given-names></name>, <etal>et al</etal> (<year>2012</year>) <article-title>Massively parallel functional dissection of mammalian enhancers in vivo</article-title>. <source>Nature biotechnology</source>
<volume>30</volume>: <fpage>265</fpage>–<lpage>270</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0057521-Stahl1">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Stahl</surname><given-names>PL</given-names></name>, <name><surname>Lundeberg</surname><given-names>J</given-names></name> (<year>2012</year>) <article-title>Toward the single-hour high-quality genome</article-title>. <source>Annual review of biochemistry</source>
<volume>81</volume>: <fpage>359</fpage>–<lpage>378</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0057521-Xu1">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Xu</surname><given-names>Q</given-names></name>, <name><surname>Schlabach</surname><given-names>MR</given-names></name>, <name><surname>Hannon</surname><given-names>GJ</given-names></name>, <name><surname>Elledge</surname><given-names>SJ</given-names></name> (<year>2009</year>) <article-title>Design of 240,000 orthogonal 25mer DNA barcode probes</article-title>. <source>Proceedings of the National Academy of Sciences of the United States of America</source>
<volume>106</volume>: <fpage>2289</fpage>–<lpage>2294</lpage>.<pub-id pub-id-type="pmid">19171886</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0057521-Hamady1">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Hamady</surname><given-names>M</given-names></name>, <name><surname>Walker</surname><given-names>JJ</given-names></name>, <name><surname>Harris</surname><given-names>JK</given-names></name>, <name><surname>Gold</surname><given-names>NJ</given-names></name>, <name><surname>Knight</surname><given-names>R</given-names></name> (<year>2008</year>) <article-title>Error-correcting barcoded primers for pyrosequencing hundreds of samples in multiplex</article-title>. <source>Nature methods</source>
<volume>5</volume>: <fpage>235</fpage>–<lpage>237</lpage>.<pub-id pub-id-type="pmid">18264105</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0057521-Frank1">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Frank</surname><given-names>DN</given-names></name> (<year>2009</year>) <article-title>BARCRAWL and BARTAB: software tools for the design and implementation of barcoded primers for highly multiplexed DNA sequencing</article-title>. <source>BMC Bioinformatics</source>
<volume>10</volume>: <fpage>362</fpage>.<pub-id pub-id-type="pmid">19874596</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0057521-Bystrykh1">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Bystrykh</surname><given-names>LV</given-names></name> (<year>2012</year>) <article-title>Generalized DNA barcode design based on Hamming codes</article-title>. <source>PloS one</source>
<volume>7</volume>: <fpage>e36852</fpage>.<pub-id pub-id-type="pmid">22615825</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0057521-Grassl1">
      <label>8</label>
      <mixed-citation publication-type="other">Grassl M (2007) Bounds on the minimum distance of linear codes and quantum codes.</mixed-citation>
    </ref>
    <ref id="pone.0057521-Levenshtein1">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Levenshtein</surname><given-names>VI</given-names></name> (<year>1966</year>) <article-title>Binary Codes Capable of Correcting Deletions, Insertions and Reversals</article-title>. <source>Soviet Physics Doklady</source>
<volume>10</volume>: <fpage>707</fpage>–<lpage>710</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0057521-McDonald1">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>McDonald</surname><given-names>MJ</given-names></name>, <name><surname>Wang</surname><given-names>WC</given-names></name>, <name><surname>Huang</surname><given-names>HD</given-names></name>, <name><surname>Leu</surname><given-names>JY</given-names></name> (<year>2011</year>) <article-title>Clusters of nucleotide substitutions and insertion/deletion mutations are associated with repeat sequences</article-title>. <source>PLoS biology</source>
<volume>9</volume>: <fpage>e1000622</fpage>.<pub-id pub-id-type="pmid">21697975</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0057521-Shendure1">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Shendure</surname><given-names>J</given-names></name>, <name><surname>Ji</surname><given-names>H</given-names></name> (<year>2008</year>) <article-title>Next-generation DNA sequencing</article-title>. <source>Nature biotechnology</source>
<volume>26</volume>: <fpage>1135</fpage>–<lpage>1145</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0057521-Zuker1">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Zuker</surname><given-names>M</given-names></name> (<year>2003</year>) <article-title>Mfold web server for nucleic acid folding and hybridization prediction</article-title>. <source>Nucleic acids research</source>
<volume>31</volume>: <fpage>3406</fpage>–<lpage>3415</lpage>.<pub-id pub-id-type="pmid">12824337</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0057521-Butenhof1">
      <label>13</label>
      <mixed-citation publication-type="other">Butenhof DR (1997) Programming with POSIX threads: Addison-Wesley Longman Publishing Co., Inc. 381 p.</mixed-citation>
    </ref>
    <ref id="pone.0057521-Dagum1">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Dagum</surname><given-names>L</given-names></name>, <name><surname>Menon</surname><given-names>R</given-names></name> (<year>1998</year>) <article-title>OpenMP: An industry standard API for shared-memory programming</article-title>. <source>Ieee Computational Science &amp; Engineering</source>
<volume>5</volume>: <fpage>46</fpage>–<lpage>55</lpage>.</mixed-citation>
    </ref>
    <ref id="pone.0057521-Melnikov1">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Melnikov</surname><given-names>A</given-names></name>, <name><surname>Murugan</surname><given-names>A</given-names></name>, <name><surname>Zhang</surname><given-names>X</given-names></name>, <name><surname>Tesileanu</surname><given-names>T</given-names></name>, <name><surname>Wang</surname><given-names>L</given-names></name>, <etal>et al</etal> (<year>2012</year>) <article-title>Systematic dissection and optimization of inducible enhancers in human cells using a massively parallel reporter assay</article-title>. <source>Nature biotechnology</source>
<volume>30</volume>: <fpage>271</fpage>–<lpage>277</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
