<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9235492</article-id>
    <article-id pub-id-type="pmid">35758796</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac221</article-id>
    <article-id pub-id-type="publisher-id">btac221</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>ISCB/Ismb 2022</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Biomedical Informatics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BITES: balanced individual treatment effect for survival data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Schrod</surname>
          <given-names>S</given-names>
        </name>
        <aff><institution>Department of Medical Bioinformatics, University Medical Center Göttingen</institution>, Göttingen 37077, <country country="DE">Germany</country></aff>
        <xref rid="btac221-cor1" ref-type="corresp"/>
        <!--stefan.schrod@bioinf.med.uni-goettingen.de-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schäfer</surname>
          <given-names>A</given-names>
        </name>
        <aff><institution>Department of Physics, Institute of Theoretical Physics, University of Regensburg</institution>, Regensburg 93051, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Solbrig</surname>
          <given-names>S</given-names>
        </name>
        <aff><institution>Department of Physics, Institute of Theoretical Physics, University of Regensburg</institution>, Regensburg 93051, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lohmayer</surname>
          <given-names>R</given-names>
        </name>
        <aff><institution>Leibniz Institute for Immunotherapy</institution>, Regensburg 93053, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gronwald</surname>
          <given-names>W</given-names>
        </name>
        <aff><institution>Institute of Functional Genomics, University of Regensburg</institution>, Regensburg 93053, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Oefner</surname>
          <given-names>P J</given-names>
        </name>
        <aff><institution>Institute of Functional Genomics, University of Regensburg</institution>, Regensburg 93053, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Beißbarth</surname>
          <given-names>T</given-names>
        </name>
        <aff><institution>Department of Medical Bioinformatics, University Medical Center Göttingen</institution>, Göttingen 37077, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Spang</surname>
          <given-names>R</given-names>
        </name>
        <aff><institution>Department of Statistical Bioinformatics, Institute of Functional Genomics, University of Regensburg</institution>, Regensburg 93053, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zacharias</surname>
          <given-names>H U</given-names>
        </name>
        <aff><institution>Department of Internal Medicine I, University Medical Center Schleswig-Holstein, Campus Kiel</institution>, Kiel 24105, <country country="DE">Germany</country></aff>
        <aff><institution>Institute of Clinical Molecular Biology, Kiel University and University Medical Center Schleswig-Holstein, Campus Kiel</institution>, Kiel 24105, <country country="DE">Germany</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Altenbuchinger</surname>
          <given-names>M</given-names>
        </name>
        <aff><institution>Department of Medical Bioinformatics, University Medical Center Göttingen</institution>, Göttingen 37077, <country country="DE">Germany</country></aff>
        <xref rid="btac221-cor1" ref-type="corresp"/>
        <!--michael.altenbuchinger@bioinf.med.uni-goettingen.de-->
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac221-cor1">To whom correspondence should be addressed. E-mail: <email>stefan.schrod@bioinf.med.uni-goettingen.de</email> or <email>michael.altenbuchinger@bioinf.med.uni-goettingen.de</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-06-27">
      <day>27</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <volume>38</volume>
    <issue>Suppl 1</issue>
    <issue-title>ISCB ISMB 2022 Proceedings</issue-title>
    <fpage>i60</fpage>
    <lpage>i67</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac221.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Estimating the effects of interventions on patient outcome is one of the key aspects of personalized medicine. Their inference is often challenged by the fact that the training data comprises only the outcome for the administered treatment, and not for alternative treatments (the so-called counterfactual outcomes). Several methods were suggested for this scenario based on observational data, i.e. data where the intervention was not applied randomly, for both continuous and binary outcome variables. However, patient outcome is often recorded in terms of time-to-event data, comprising right-censored event times if an event does not occur within the observation period. Albeit their enormous importance, time-to-event data are rarely used for treatment optimization. We suggest an approach named BITES (Balanced Individual Treatment Effect for Survival data), which combines a treatment-specific semi-parametric Cox loss with a treatment-balanced deep neural network; i.e. we regularize differences between treated and non-treated patients using Integral Probability Metrics (IPM).</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We show in simulation studies that this approach outperforms the state of the art. Furthermore, we demonstrate in an application to a cohort of breast cancer patients that hormone treatment can be optimized based on six routine parameters. We successfully validated this finding in an independent cohort.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>We provide BITES as an easy-to-use python implementation including scheduled hyper-parameter optimization (<ext-link xlink:href="https://github.com/sschrod/BITES" ext-link-type="uri">https://github.com/sschrod/BITES</ext-link>). The data underlying this article are available in the CRAN repository at <ext-link xlink:href="https://rdrr.io/cran/survival/man/gbsg.html" ext-link-type="uri">https://rdrr.io/cran/survival/man/gbsg.html</ext-link> and <ext-link xlink:href="https://rdrr.io/cran/survival/man/rotterdam.html" ext-link-type="uri">https://rdrr.io/cran/survival/man/rotterdam.html</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>German Federal Ministry of Education and Research</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>BMBF</institution>
            <institution-id institution-id-type="DOI">10.13039/501100002347</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>01ZX1912A</award-id>
        <award-id>01ZX1912C</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Inferring the effect of interventions on outcomes is relevant in diverse domains, comprising precision medicine and epidemiology (<xref rid="btac221-B20" ref-type="bibr">Frieden, 2017</xref>) or marketing (<xref rid="btac221-B7" ref-type="bibr">Bottou <italic toggle="yes">et al.</italic>, 2013</xref>; <xref rid="btac221-B38" ref-type="bibr">Kohavi <italic toggle="yes">et al.</italic>, 2009</xref>). A fundamental issue of causal reasoning is that potential outcomes are observed only for the applied intervention but not for its alternatives (the counterfactuals). This is particularly true in medicine, where patient’s outcome is only known for the applied (the factual) treatment and not for its alternatives, i.e. the counterfactual outcomes remain hidden. Therapeutic interventions, such as drug treatments or surgeries, are typically made by physicians on the basis of expert consensus guidelines. This process has to take into account both the expected treatment benefit, but also the potential side effects. Estimates of the former can be difficult. For instance, the success of drug treatments in cancer strongly depends on multiple characteristics of the tumor and the patient, and, consequently, the Average Treatment Effect (ATE) estimated from controlled trials does not necessarily hold on the level of individual patients. Thus, an estimate of the Individual Treatment Effect (ITE) is necessary, which has to be inferred from data (<xref rid="btac221-B26" ref-type="bibr">Holland, 1986</xref>). Solving the latter ‘missing data problem’ was attempted repeatedly in the literature using machine learning methods in combination with counterfactual reasoning. There are two naive approaches to this issue: the treatment can be included as a covariate or it can be used to stratify the model development, i.e. individual treatment-specific models are learned (also called T-learner). Potential outcomes can then be estimated by changing the respective treatment covariate or model. These naive approaches are occasionally discussed in performance comparisons, e.g. in <xref rid="btac221-B9" ref-type="bibr">Chapfuwa <italic toggle="yes">et al.</italic>, (2020)</xref> and <xref rid="btac221-B11" ref-type="bibr">Curth <italic toggle="yes">et al.</italic> (2021)</xref>. An alternative approach is to match similar patients between treated and non-treated populations using, e.g. propensity scores (<xref rid="btac221-B56" ref-type="bibr">Rosenbaum and Rubin, 1983</xref>). This directly provides estimates of counterfactual outcomes. However, a central issue in this context is to define appropriate similarity measures, which should ideally also be valid in a high-dimensional variable space (<xref rid="btac221-B36" ref-type="bibr">King and Nielsen, 2019</xref>). Further alternatives are Causal Forests (<xref rid="btac221-B5" ref-type="bibr">Athey <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac221-B4" ref-type="bibr">Athey and Wager, 2019</xref>; <xref rid="btac221-B66" ref-type="bibr">Wager and Athey, 2017</xref>) or deep architectures such as the Treatment-Agnostic Representation Network (TARNet) (<xref rid="btac221-B32" ref-type="bibr">Johansson <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac221-B61" ref-type="bibr">Shalit <italic toggle="yes">et al.</italic>, 2016</xref>). Both methods do not account for treatment selection biases and thus will be biased toward treatment-specific distributions. This issue was recently approached by several groups which balanced the treated and non-treated distributions using model regularization via representations of Integral Probability Metrics (IPM) (<xref rid="btac221-B48" ref-type="bibr">Müller, 1991</xref>). Suggested methods are, e.g. balanced propensity score matching (<xref rid="btac221-B16" ref-type="bibr">Diamond and Sekhon, 2013</xref>; <xref rid="btac221-B43" ref-type="bibr">Li and Fu, 2017</xref>), deep implementations such as the Counterfactual regression Network (CFRNet) (<xref rid="btac221-B32" ref-type="bibr">Johansson <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac221-B61" ref-type="bibr">Shalit <italic toggle="yes">et al.</italic>, 2016</xref>) or the auto-encoder based Deep-Treat (<xref rid="btac221-B3" ref-type="bibr">Atan <italic toggle="yes">et al.</italic>, 2018</xref>). Recently, balancing was incorporated in a Generative Adversarial Net for inference of Individualized Treatment Effects (GANITE) (<xref rid="btac221-B69" ref-type="bibr">Yoon <italic toggle="yes">et al.</italic>, 2018</xref>). Note, learning balanced representations involves a trade-off between predictive power and bias since biased information can be also highly predictive.</p>
    <p>All aforementioned approaches deal with continuous or binary response variables. In medicine, however, patient outcome is often recorded as time-to-event data, i.e. the time until an event occurs. The patient is (right-)censored at the last known follow-up if the event was not observed within the observation period. A plethora of statistical approaches deal with the analysis of time-to-event data (<xref rid="btac221-B47" ref-type="bibr">Martinussen and Scheike, 2006</xref>), of which one of the most popular methods is Cox’s Proportional Hazards (PH) model (<xref rid="btac221-B10" ref-type="bibr">Cox, 1972</xref>). The Cox PH model is a semi-parametric approach for time-to-event data, which models the influence of variables on the baseline hazard. Here, the PH assumption implies an equal baseline hazard for all observations. In fact, the influence of variables can be estimated without any consideration of the baseline hazard function (<xref rid="btac221-B8" ref-type="bibr">Breslow, 1972</xref>; <xref rid="btac221-B10" ref-type="bibr">Cox, 1972</xref>). The Cox PH model is also highly relevant in the context of machine learning. It was adapted to the high-dimensional setting using <italic toggle="yes">l</italic><sub>1</sub> and <italic toggle="yes">l</italic><sub>2</sub> regularization terms (<xref rid="btac221-B65" ref-type="bibr">Tibshirani, 1997</xref>), with applications ranging from the prediction of adverse events in patients with chronic kidney disease (<xref rid="btac221-B70" ref-type="bibr">Zacharias <italic toggle="yes">et al.</italic>, 2021</xref>) to the risk prediction in cancer entities (<xref rid="btac221-B31" ref-type="bibr">Jachimowicz <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac221-B64" ref-type="bibr">Staiger <italic toggle="yes">et al.</italic>, 2020</xref>). The Cox PH model can be also adapted to deep learning architectures, as proposed by (<xref rid="btac221-B35" ref-type="bibr">Katzman <italic toggle="yes">et al.</italic>, 2018</xref>). Alternative machine-learning approaches to model time-to-event data include discrete-time Cox models built on multi-outcome feedforward architectures (<xref rid="btac221-B22" ref-type="bibr">Gensheimer and Narasimhan, 2019</xref>; <xref rid="btac221-B40" ref-type="bibr">Kvamme and Borgan, 2019</xref>; <xref rid="btac221-B41" ref-type="bibr">Lee <italic toggle="yes">et al.</italic>, 2018</xref>) and random survival forests (RSF) (<xref rid="btac221-B4" ref-type="bibr">Athey and Wager, 2019</xref>; <xref rid="btac221-B30" ref-type="bibr">Ishwaran <italic toggle="yes">et al.</italic>, 2008</xref>).</p>
    <p>The prediction of ITEs from time-to-event data has received little attention in the machine learning community, which is surprising considering the enormous practical relevance of the topic. Seminal works are (<xref rid="btac221-B9" ref-type="bibr">Chapfuwa <italic toggle="yes">et al.</italic>, 2020</xref>) and (<xref rid="btac221-B11" ref-type="bibr">Curth <italic toggle="yes">et al.</italic>, 2021</xref>). Most recently, <xref rid="btac221-B11" ref-type="bibr">Curth <italic toggle="yes">et al.</italic> (2021)</xref> suggested to learn discrete-time treatment-specific conditional hazard functions, which were estimated using a deep learning approach. Treatment and control distributions were balanced analogously to <xref rid="btac221-B61" ref-type="bibr">Shalit <italic toggle="yes">et al.</italic> (2016)</xref> using the p-Wasserstein distance (<xref rid="btac221-B34" ref-type="bibr">Kantorovitch, 1958</xref>; <xref rid="btac221-B55" ref-type="bibr">Ramdas <italic toggle="yes">et al.</italic>, 2017</xref>). This approach, named SurvITE, was shown to outperform the current state of the art in simulation studies.</p>
    <p>We propose to combine the loss of the Cox PH model with an IPM regularized deep neural network architecture to balance generating distributions of treated and non-treated patients. We named this approach ‘Balanced Individual Treatment Effect for Survival data’ (BITES). We show that this approach—albeit its apparent simplicity—outcompetes SurvITE as well as alternative state-of-the-art methods. First, we demonstrate the superior performance of BITES in simulation studies where we focus on biased treatment assignments and small sample sizes. Second, we used training data from the Rotterdam Tumour Bank (<xref rid="btac221-B19" ref-type="bibr">Foekens <italic toggle="yes">et al.</italic>, 2000</xref>) to show that BITES can optimize hormone treatment in patients with breast cancer. We validated the latter model using data from a controlled randomized trial of the German Breast Cancer Study Group (GBSG) (<xref rid="btac221-B60" ref-type="bibr">Schumacher <italic toggle="yes">et al.</italic>, 1994</xref>) and analyzed feature importance using SHAP (SHapley Additive exPlanations) values (<xref rid="btac221-B46" ref-type="bibr">Lundberg and Lee, 2017</xref>). We further provide an easy-to-use python implementation of BITES including scheduled hyper-parameter optimization (<ext-link xlink:href="https://github.com/sschrod/BITES" ext-link-type="uri">https://github.com/sschrod/BITES</ext-link>).</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>Patient outcome can be recorded as (right-)censored time-to-event data. First, we will introduce models for such data, i.e. the Cox PH model and recent non-linear adaptations. Second, we will discuss the potential outcome model and how it can be used to model survival. Third, we introduce regularization techniques to account for unbalanced distributions and, finally, we will combine these methods in a deep neural network approach termed BITES to learn treatment recommender systems based on patient survival.</p>
    <sec>
      <title>2.1 Survival data</title>
      <p>Let <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mi mathvariant="script">X</mml:mi></mml:math></inline-formula> be the space of covariates and <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> the space of available treatments. Furthermore, let <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">Y</mml:mi></mml:mrow></mml:math></inline-formula> be the observed survival times and <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">E</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> the corresponding event indicator. Denote sample data of patient <italic toggle="yes">i</italic> by the triplet <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∈</mml:mo><mml:mi mathvariant="script">X</mml:mi><mml:mo>×</mml:mo><mml:mi mathvariant="script">Y</mml:mi><mml:mo>×</mml:mo><mml:mi mathvariant="script">E</mml:mi></mml:mrow></mml:math></inline-formula>. If the patient experiences the event within the observation period, <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> is the time until the event of interest occurs, otherwise <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> is the censoring time. Let the survival times <italic toggle="yes">y</italic> be distributed according to <italic toggle="yes">f</italic>(<italic toggle="yes">y</italic>) with the corresponding cumulated event distribution <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mi>F</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∫</mml:mo><mml:mn>0</mml:mn><mml:mi>y</mml:mi></mml:msubsup><mml:mi>f</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mi mathvariant="normal">d</mml:mi><mml:mi>y</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula>. The survival probability at time <italic toggle="yes">y</italic> is then given by <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>F</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The hazard function is
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mo>λ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">︸</mml:mo></mml:munder><mml:mrow><mml:mtext>hazard rate</mml:mtext></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>and corresponds to the risk of dying at time <italic toggle="yes">y</italic> (<xref rid="btac221-B10" ref-type="bibr">Cox, 1972</xref>), i.e. a greater hazard corresponds to greater risk of failure. Here, the model parameters are given by <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">β</mml:mi></mml:math></inline-formula> and the baseline hazard function is <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>λ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>;</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Note that <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>F</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mi mathvariant="normal">d</mml:mi><mml:mrow><mml:mi mathvariant="normal">d</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mtext>log</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. According to Cox’s PH assumption, all patients share the same baseline hazard function and, importantly, the baseline hazard cancels in maximum likelihood estimates of <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mi mathvariant="bold-italic">β</mml:mi></mml:math></inline-formula>. Thus, time dependence can be eliminated from the individual hazard prediction and rather than learning the exact time to event, Cox regression learns an ordering of hazard rates. At every event time <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>, the set of patients at risk is given by <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="script">Y</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>≥</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The partial log-likelihood of the Cox model (<xref rid="btac221-B8" ref-type="bibr">Breslow, 1972</xref>; <xref rid="btac221-B10" ref-type="bibr">Cox, 1972</xref>) is given by:
<disp-formula id="E2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">β</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>:</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>:</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p><xref rid="btac221-B17" ref-type="bibr">Faraggi and Simon (1995)</xref> suggested to replace the ordinary linear predictor function, <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:math></inline-formula>, by a feedforward neural network with a single outcome node <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and network parameters <italic toggle="yes">θ</italic>. Following this idea, <xref rid="btac221-B35" ref-type="bibr">Katzman <italic toggle="yes">et al.</italic> (2018)</xref> introduced DeepSurv, which showed improved performance compared to the linear case, particularly if non-linear covariate dependencies are present.</p>
    </sec>
    <sec>
      <title>2.2 The counterfactual problem</title>
      <p>The outcome space for multiple treatment options <italic toggle="yes">k</italic> is given by <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">Y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">Y</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo>×</mml:mo><mml:mo>⋯</mml:mo><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">Y</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. For simplicity, we will restrict the discussion to the binary case, <italic toggle="yes">k </italic>=<italic toggle="yes"> </italic>2, with a treated group, <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>1, and a control group, <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>0.</p>
      <p>We consider the problem where only a single <italic toggle="yes">factual</italic> outcome is observed per patient, i.e. the outcomes for all other interventions, also known as the <italic toggle="yes">counterfactuals</italic>, are missing. Hence, the <italic toggle="yes">individual treatment effect</italic> (ITE), defined as
<disp-formula id="E3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mo>τ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>can only be inferred based on potential outcome estimates (<xref rid="btac221-B58" ref-type="bibr">Rubin, 1974</xref>). We will build a recommendation model that assigns treatments to patients with predictions <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:mo>τ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
      <p>Following recent work (<xref rid="btac221-B1" ref-type="bibr">Alaa and van der Schaar, 2017</xref>; <xref rid="btac221-B4" ref-type="bibr">Athey and Wager, 2019</xref>; <xref rid="btac221-B32" ref-type="bibr">Johansson <italic toggle="yes">et al.</italic>, 2016</xref>, <xref rid="btac221-B33" ref-type="bibr">2020</xref>; <xref rid="btac221-B61" ref-type="bibr">Shalit <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac221-B66" ref-type="bibr">Wager and Athey, 2017</xref>; <xref rid="btac221-B68" ref-type="bibr">Yao <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btac221-B69" ref-type="bibr">Yoon <italic toggle="yes">et al.</italic>, 2018</xref>), we make the standard <italic toggle="yes">strong ignorability</italic> assumption, which has been shown to be a sufficient condition to make the ITE identifiable (<xref rid="btac221-B53" ref-type="bibr">Pearl, 2017</xref>; <xref rid="btac221-B61" ref-type="bibr">Shalit <italic toggle="yes">et al.</italic>, 2016</xref>), i.e. it guarantees proper causal dependencies on the interventions. The <italic toggle="yes">strong ignorability</italic> assumption contains the <italic toggle="yes">unconfoundedness</italic> and <italic toggle="yes">overlap</italic> assumptions:</p>
      <statement id="mthst1">
        <p><sc>Theorem</sc> 1 (Unconfoundedness). Covariates <italic toggle="yes">X</italic> do not simultaneously influence the treatment <italic toggle="yes">T</italic> and potential outcomes <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, i.e.
<disp-formula id="E4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo> </mml:mo><mml:mo>⊥</mml:mo><mml:mo>⊥</mml:mo><mml:mo> </mml:mo><mml:mi>T</mml:mi><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      </statement>
      <p>This assumption ensures that the causal effect is not influenced by non-observable causal substructures such as confounding (<xref rid="btac221-B52" ref-type="bibr">Pearl, 2009</xref>). Correcting for confounding bias requires structural causal models, which are ambiguous in general and need to be justified based on domain knowledge (<xref rid="btac221-B51" ref-type="bibr">Pearl, 2008</xref>).</p>
      <statement id="mthst2">
        <p><sc>Theorem</sc> 2 (Overlap). There is a non-zero probability for each patient <italic toggle="yes">i</italic> to receive each of the treatments <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mi>T</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">T</mml:mi></mml:mrow></mml:math></inline-formula>:
<disp-formula id="E5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mn>0</mml:mn><mml:mo>&lt;</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1.</mml:mn></mml:mrow></mml:math></disp-formula></p>
      </statement>
    </sec>
    <sec>
      <title>2.3 Balancing distributions</title>
      <p><italic toggle="yes">Strong ignorability</italic> only removes confounding artifacts. Imbalances of the generating distributions due to biased treatment administration might still be present. Balancing the generating distributions of treated and control group has been shown to be effective both on the covariate space (<xref rid="btac221-B28" ref-type="bibr">Imai and Ratkovic, 2014</xref>) and on latent representations (<xref rid="btac221-B13" ref-type="bibr">D’Amour <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btac221-B27" ref-type="bibr">Huang <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac221-B32" ref-type="bibr">Johansson <italic toggle="yes">et al.</italic>, 2016</xref>, <xref rid="btac221-B33" ref-type="bibr">2020</xref>; <xref rid="btac221-B43" ref-type="bibr">Li and Fu, 2017</xref>; <xref rid="btac221-B45" ref-type="bibr">Lu <italic toggle="yes">et al.</italic>, 2020</xref>; <xref rid="btac221-B61" ref-type="bibr">Shalit <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac221-B68" ref-type="bibr">Yao <italic toggle="yes">et al.</italic>, 2018</xref>). This is either achieved by multi-task models or IPMs. The latter quantify the difference of probability measures <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mi mathvariant="double-struck">P</mml:mi></mml:math></inline-formula> and <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mi mathvariant="double-struck">Q</mml:mi></mml:math></inline-formula> defined on a measurable space <italic toggle="yes">S</italic> by finding a function <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">F</mml:mi></mml:mrow></mml:math></inline-formula> that maximizes (<xref rid="btac221-B48" ref-type="bibr">Müller, 1991</xref>)
<disp-formula id="E6"><label>(6)</label><mml:math id="M6" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mi mathvariant="script">F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>sup</mml:mi></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">F</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="true">|</mml:mo><mml:mrow><mml:mrow><mml:mo>∫</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mo> </mml:mo><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>−</mml:mo><mml:mrow><mml:mo>∫</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mo> </mml:mo><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="double-struck">Q</mml:mi></mml:mrow><mml:mo stretchy="true">|</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Most commonly used are the Maximum Mean Discrepancy (MMD), restricting the function space to reproducing kernel-Hilbert spaces (<xref rid="btac221-B23" ref-type="bibr">Gretton <italic toggle="yes">et al.</italic>, 2012</xref>), or the <italic toggle="yes">p</italic>-Wasserstein distance (<xref rid="btac221-B55" ref-type="bibr">Ramdas <italic toggle="yes">et al.</italic>, 2017</xref>). Both have appealing properties and can be empirically estimated (<xref rid="btac221-B62" ref-type="bibr">Sriperumbudur <italic toggle="yes">et al.</italic>, 2012</xref>). MMD has low sample complexity with a fast rate of convergence, which comes with low computational costs. A potential issue is that gradients vanish for overlapping means (<xref rid="btac221-B18" ref-type="bibr">Feydy <italic toggle="yes">et al.</italic>, 2018</xref>). The <italic toggle="yes">p</italic>-Wasserstein distance, on the other hand, offers more stable gradients even for overlapping means, which comes with higher computational costs, i.e. by solving a linear program. The computational burden can be reduced by entropically smoothing the latter and by using the Sinkhorn divergence,
<disp-formula id="E7"><label>(7)</label><mml:math id="M7" display="block" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">W</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">W</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">W</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">W</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is the smoothed Optimal Transport (OT) loss defined in the following (<xref rid="btac221-B18" ref-type="bibr">Feydy <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btac221-B55" ref-type="bibr">Ramdas <italic toggle="yes">et al.</italic>, 2017</xref>).<statement id="mthst3"><p><sc>Definition</sc> 1 (Smoothed Optimal Transport loss). For <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>∞</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and Borel probability measures <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi></mml:mrow></mml:math></inline-formula> on <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> the entropically smoothed OT loss is
<disp-formula id="E8"><label>(8)</label><mml:math id="M8" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="normal">W</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mi>min</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>π</mml:mo><mml:mo>∈</mml:mo><mml:mo>Γ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>−</mml:mo><mml:mi>Y</mml:mi><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mi>p</mml:mi></mml:msup><mml:mo> </mml:mo><mml:mi mathvariant="normal">d</mml:mi><mml:mo>π</mml:mo><mml:mo>+</mml:mo><mml:mo>ϵ</mml:mo><mml:mtext>KL</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo>π</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>⊗</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>with</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>KL</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo>π</mml:mo><mml:mo>|</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>⊗</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">d</mml:mi><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="double-struck">P</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="double-struck">Q</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi mathvariant="normal">d</mml:mi><mml:mo>π</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>with <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> the set of all joint probability measures whose marginals are <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi></mml:mrow></mml:math></inline-formula> on <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, i.e. for all subsets <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mi>A</mml:mi><mml:mo>⊂</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, we have <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mo>π</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>A</mml:mi><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>A</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:mo>π</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msup><mml:mo>×</mml:mo><mml:mi>A</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>A</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Here, <italic toggle="yes">ϵ</italic> mediates the strength of the Kullback-Leibler divergence.</p></statement></p>
      <p>The Sinkhorn divergence can be efficiently calculated for <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:mo>ϵ</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> (<xref rid="btac221-B12" ref-type="bibr">Cuturi, 2013</xref>). For <italic toggle="yes">p </italic>=<italic toggle="yes"> </italic>2 and <italic toggle="yes">ϵ</italic>  =  0 we can retrieve the quadratic Wasserstein distance and in the limit <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:mo>ϵ</mml:mo><mml:mo>→</mml:mo><mml:mo>+</mml:mo><mml:mo>∞</mml:mo></mml:mrow></mml:math></inline-formula> it becomes the MMD (<xref rid="btac221-B21" ref-type="bibr">Genevay <italic toggle="yes">et al.</italic>, 2017</xref>). BITES tunes <italic toggle="yes">ϵ</italic> to take advantage of the more stable OT gradients to improve the overlap while remaining computationally efficient. In the following, we denote it by <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mtext>IPM</mml:mtext></mml:mrow></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:mo>·</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to highlight the possibility to use any representation of the IPM. A thorough discussion of the Sinkhorn divergence, its theoretical properties, as well as one- and two-dimensional examples can be found in <xref rid="btac221-B18" ref-type="bibr">Feydy <italic toggle="yes">et al.</italic> (2018)</xref>.</p>
    </sec>
    <sec>
      <title>2.4 BITES</title>
      <p><italic toggle="yes">BITES model architecture</italic>: BITES combines survival modeling with counterfactual reasoning, i.e. it facilitates the development of treatment recommender systems using time-to-event data. BITES uses the network architecture shown in <xref rid="btac221-F1" ref-type="fig">Figure 1</xref> with loss function
<disp-formula id="E9"><label>(9)</label><mml:math id="M9" display="block" overflow="scroll"><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mtext>BITES</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>q</mml:mi><mml:msubsup><mml:mrow><mml:mi mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mtext>Cox</mml:mtext></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo>Φ</mml:mo></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mtext>Cox</mml:mtext></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo>Φ</mml:mo></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:mo>α</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mtext>IPM</mml:mtext></mml:mrow></mml:mrow><mml:mo>ϵ</mml:mo><mml:mi>p</mml:mi></mml:msubsup></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo>Φ</mml:mo></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mo>Φ</mml:mo></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>where <italic toggle="yes">q</italic> is the fraction of patients in the control cohort (patients with <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>0) and <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="script">L</mml:mi></mml:mrow><mml:mrow><mml:mtext>Cox</mml:mtext></mml:mrow><mml:mi>T</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> is given by the negative Cox partial log-likelihood of <xref rid="E2" ref-type="disp-formula">Equation 2</xref>, where we parametrize the hazard function <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo>Φ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> according to the network architecture illustrated in <xref rid="btac221-F1" ref-type="fig">Figure 1</xref>. The latent representation <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mo>Φ</mml:mo></mml:math></inline-formula> is regularized by an IPM term to reduce differences between treatment and control distributions of non-confounding variables. Throughout the article, we used the Sinkhorn divergence of the smoothed OT loss with <italic toggle="yes">p </italic>=<italic toggle="yes"> </italic>2 as IPM term. Hence, the parameter <italic toggle="yes">ϵ</italic> in <xref rid="E9" ref-type="disp-formula">Equation 9</xref> calibrates between the quadratic-Wasserstein distance (<italic toggle="yes">ϵ</italic> = 0) and MMD (<inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:mo>ϵ</mml:mo><mml:mo>=</mml:mo><mml:mo>∞</mml:mo></mml:mrow></mml:math></inline-formula>). The total strength of the IPM regularization is adjusted by the hyper-parameter <italic toggle="yes">α</italic>. Models with <italic toggle="yes">α</italic>  =  0 do not balance treatment effects and therefore we denote this method as ‘Individual Treatment Effects for Survival’ (ITES). Models with <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:mo>α</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> will be denoted as ‘Balanced Individual Treatment Effects for Survival’ (BITES). Large <italic toggle="yes">α</italic> values enforce balanced distributions between treatment and control population. Note, there is a trade-off between balancing distributions and model performance since outcome relevant information can be predictive for the treatment. (B)ITES uses the time-dependent ITE for treatment decisions. For the studies shown in this article, we assigned treatments based on the ITE evaluated for a survival probability of 50%, i.e. <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mrow><mml:mo>τ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>0.5</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>0.5</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <fig position="float" id="btac221-F1">
        <label>Fig. 1.</label>
        <caption>
          <p>The BITES network architecture. BITES uses shared deeply connected layers for both treatment options, which are mapped on a latent representation <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mo>Φ</mml:mo></mml:math></inline-formula>. This is regularized by a Sinkhorn divergence to account for imbalances between treatment and control distributions. The factual and counterfactual proportional hazard rates are modeled by two different outcome heads (<italic toggle="yes">h</italic><sub>1</sub> and <italic toggle="yes">h</italic><sub>0</sub>), respectively. These are used to predict the ITE together with the corresponding baseline hazard function. The latter is individually estimated for treatment and control patients</p>
        </caption>
        <graphic xlink:href="btac221f1" position="float"/>
      </fig>
      <p><italic toggle="yes">Implementation</italic>: BITES uses a deep architecture of dense-connected layers which are each followed by a dropout (<xref rid="btac221-B63" ref-type="bibr">Srivastava <italic toggle="yes">et al.</italic>, 2014</xref>) and a batch normalization layer (<xref rid="btac221-B29" ref-type="bibr">Ioffe and Szegedy, 2015</xref>). It uses ReLU activation functions (<xref rid="btac221-B49" ref-type="bibr">Nair and Hinton, 2010</xref>) and is trained using the Adam optimizer (<xref rid="btac221-B37" ref-type="bibr">Kingma and Ba, 2014</xref>). Further, early stopping based on non-decreasing validation loss and weight decay regularizations (<xref rid="btac221-B39" ref-type="bibr">Krogh and Hertz, 1992</xref>) are used to improve generalization. Our implementation is based on the <italic toggle="yes">PyTorch</italic> machine learning library (<xref rid="btac221-B50" ref-type="bibr">Paszke <italic toggle="yes">et al.</italic>, 2019</xref>) and the <italic toggle="yes">pycox</italic> package (<xref rid="btac221-B40" ref-type="bibr">Kvamme and Borgan, 2019</xref>). The Sinkhorn divergence is implemented using the <italic toggle="yes">GeomLoss</italic> package (<xref rid="btac221-B18" ref-type="bibr">Feydy <italic toggle="yes">et al.</italic>, 2018</xref>). We provide an easy-to-use python implementation which includes a hyperparameter optimization using the <italic toggle="yes">ray[tune]</italic> package (<xref rid="btac221-B44" ref-type="bibr">Liaw <italic toggle="yes">et al.</italic>, 2018</xref>) to efficiently distribute model training.</p>
    </sec>
    <sec>
      <title>2.5 Treatment recommender systems</title>
      <p>For comparison, we evaluated several strategies to build treatment recommender systems.</p>
      <p><italic toggle="yes">Cox regression model</italic>: We implemented the Cox regression as T-learner with treatment-specific survival models using <italic toggle="yes">lifelines</italic> (<xref rid="btac221-B15" ref-type="bibr">Davidson-Pilon <italic toggle="yes">et al.</italic>, 2021</xref>). Note, an ordinary Cox regression model which uses both the covariates <inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mi mathvariant="script">X</mml:mi></mml:math></inline-formula> and the treatment variable <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> as predictor variables generally recommends the treatment with the better ATE; a treatment-specific term adds to <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:math></inline-formula> and thus the treatment which reduces the hazard most will be recommended. Therefore, we did not include the latter approach and focus on the Cox T-learner in our analysis.</p>
      <p><italic toggle="yes">DeepSurv</italic>: <xref rid="btac221-B35" ref-type="bibr">Katzman <italic toggle="yes">et al.</italic> (2018)</xref> suggested to provide individual recommendations based on single model predictions using <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mi mathvariant="script">T</mml:mi></mml:math></inline-formula> and <inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mi mathvariant="script">X</mml:mi></mml:math></inline-formula> as covariates based on <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>τ</mml:mo></mml:mrow><mml:mrow><mml:mtext>DS</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mo>θ</mml:mo></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Hence, it uses a treatment independent baseline hazard which could compromise the performance (<xref rid="btac221-B6" ref-type="bibr">Bellera <italic toggle="yes">et al.</italic>, 2010</xref>; <xref rid="btac221-B67" ref-type="bibr">Xue <italic toggle="yes">et al.</italic>, 2013</xref>).</p>
      <p><italic toggle="yes">Treatment-specific DeepSurv models</italic>: To account for treatment-specific differences of baseline hazard functions, we also estimated DeepSurv as a T-learner (T-DeepSurv), i.e. we learned models stratified for treatments. We then evaluated the time-dependent ITE based on the survival function <inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>τ</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi><mml:mo>-</mml:mo><mml:mtext>DS</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p><italic toggle="yes">Treatment-specific Random Survival Forests</italic>: Analogously to the previous approach, we learned treatment-specific RSF (<xref rid="btac221-B5" ref-type="bibr">Athey <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btac221-B30" ref-type="bibr">Ishwaran <italic toggle="yes">et al.</italic>, 2008</xref>) using the implementation of <italic toggle="yes">scikit-survival</italic> (<xref rid="btac221-B54" ref-type="bibr">Pölsterl, 2020</xref>) to estimate the time-dependent ITE.</p>
      <p><italic toggle="yes">SurvITE</italic>: <xref rid="btac221-B11" ref-type="bibr">Curth <italic toggle="yes">et al.</italic> (2021)</xref> suggested to learn discrete-time treatment-specific conditional hazard functions, which were estimated using an individual outcome head for each time interval. (We employed their python implementation available under <ext-link xlink:href="https://github.com/chl8856/survITE" ext-link-type="uri">https://github.com/chl8856/survITE</ext-link>.) We evaluated the time-dependent ITE to assign treatments, as for the latter two methods.</p>
    </sec>
    <sec>
      <title>2.6 Performance measures</title>
      <p>We used different measures to assess the performance of treatment recommendation systems. This comprises both measures for the quantification of prediction performance and of treatment assignment. Discriminative performance was assessed using a time-dependent extension of Harrell’s C-index (<xref rid="btac221-B24" ref-type="bibr">Harrell, 1982</xref>) to account for differing baseline hazards, which evaluates
<disp-formula id="E10"><label>(10)</label><mml:math id="M10" display="block" overflow="scroll"><mml:mtext>Pr</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo><mml:mo>&lt;</mml:mo><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>)</mml:mo><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo>&amp;</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>for all samples <italic toggle="yes">i</italic> and <italic toggle="yes">j</italic> at all event times <inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> (<xref rid="btac221-B2" ref-type="bibr">Antolini <italic toggle="yes">et al.</italic>, 2005</xref>). This reduces to Harrell’s C-index for strictly ordered survival curves. To quantify the performance of treatment recommendations, we used the Precision in Estimation of Heterogeneous Effect (PEHE) score (<xref rid="btac221-B25" ref-type="bibr">Hill, 2011</xref>), which is defined as the difference in residuals between factual and counterfactual outcome:
<disp-formula id="E11"><label>(11)</label><mml:math id="M11" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>ϵ</mml:mo></mml:mrow><mml:mrow><mml:mtext>PEHE</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>−</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Note, the PEHE score can only be calculated if both the factual and counterfactual outcomes are known, which is usually only the case in simulation studies. Therefore, we restricted its application to the latter. There, we further quantified the proportion of correctly assigned ‘best treatments’.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 Simulation studies</title>
      <p>We performed three exemplary simulation studies. First, we simulated a scenario where covariates affect survival only linearly. Second, we simulated data with additional non-linear dependencies, and, finally, we performed a simulation where the treatment assignments were biased by the covariates.</p>
      <p><italic toggle="yes">Linear simulation study</italic>: In analogy to (<xref rid="btac221-B1" ref-type="bibr">Alaa and van der Schaar, 2017</xref>) and (<xref rid="btac221-B41" ref-type="bibr">Lee <italic toggle="yes">et al.</italic>, 2018</xref>), we simulated a 20-dimensional covariate vector <inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">I</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> consisting of two 10-dimensional vectors <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, with corresponding survival times given by
<disp-formula id="E12"><label>(12)</label><mml:math id="M12" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>∼</mml:mo><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>∼</mml:mo><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p>We set the parameters <inline-formula id="IE56"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE57"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>15</mml:mn><mml:mo>,</mml:mo><mml:mn>35</mml:mn><mml:mo>,</mml:mo><mml:mn>55</mml:mn><mml:mo>,</mml:mo><mml:mn>75</mml:mn><mml:mo>,</mml:mo><mml:mn>95</mml:mn><mml:mo>,</mml:mo><mml:mn>115</mml:mn><mml:mo>,</mml:mo><mml:mn>135</mml:mn><mml:mo>,</mml:mo><mml:mn>155</mml:mn><mml:mo>,</mml:mo><mml:mn>175</mml:mn><mml:mo>,</mml:mo><mml:mn>195</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. The first term in the exponent is treatment dependent while the second term affects survival under both treatments identically. This simulation gives an overall positive ATE in <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>64</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> of the patients. Survival times exceeding 10 years were censored to resemble common censoring at the end of a study. Of the remaining samples, 50% were censored at a randomly drawn fraction <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi mathvariant="script">U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> of the true unobserved survival time. Samples were assigned randomly to the treated, <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>1, and control group, <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>0, without treatment administration bias. Finally, we added an error <inline-formula id="IE60"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>∼</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn><mml:mo>·</mml:mo><mml:mi mathvariant="bold-italic">I</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to all covariates. Detailed information about hyper-parameter selection is given in the <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S1</xref>.</p>
      <p><xref rid="btac221-F2" ref-type="fig">Figure 2a</xref> shows the distributions of Harrell’s C-index evaluated on 1000 test samples for 50 consecutive simulation runs. We observed that across all investigated sample sizes (<italic toggle="yes">x</italic>-axis) the T-learner Cox regression showed superior performance, closely followed by ITES and BITES. These three methods performed equally well for the larger sample sizes <italic toggle="yes">n </italic>=<italic toggle="yes"> </italic>1800 and <italic toggle="yes">n </italic>=<italic toggle="yes"> </italic>2400. We further investigated the proportion of correctly assigned treatments, <xref rid="btac221-F2" ref-type="fig">Figure 2a</xref>, and PEHE scores, <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S1</xref>, where we obtained qualitatively similar trends. RSF, DeepSurv and T-DeepSurv showed inferior performance with respect to C-Indices, correctly assigned treatments, and PEHE scores. Results for lower sample sizes can be found in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>. Consistent with previous findings, Cox regression outperformed all competitors closely followed by (B)ITES.</p>
      <fig position="float" id="btac221-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Harrell’s C-index and the fraction of correctly predicted treatments for the linear (<bold>a, d</bold>), non-linear (<bold>b, e</bold>), and treatment biased non-linear (<bold>c, f</bold>) simulations. The boxplots give the distribution for 50 consecutive simulation runs, i.e. for different model initializations, based on the best set of hyper-parameter determined by the validation C-index. Results are shown for different training sample sizes with 1000 fixed test samples for each of the simulations. The dashed horizontal line represents the fraction of patients that benefits for 100% treatment administration</p>
        </caption>
        <graphic xlink:href="btac221f2" position="float"/>
      </fig>
      <p><italic toggle="yes">Non-linear simulation study</italic>: Next, we simulated non-linear treatment-outcome dependencies using the model
<disp-formula id="E13"><label>(13)</label><mml:math id="M13" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>∼</mml:mo><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>∼</mml:mo><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="true">[</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">]</mml:mo></mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>where we set the parameters <inline-formula id="IE61"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE62"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0.5</mml:mn><mml:mo>,</mml:mo><mml:mn>0.9</mml:mn><mml:mo>,</mml:mo><mml:mn>1.3</mml:mn><mml:mo>,</mml:mo><mml:mn>1.7</mml:mn><mml:mo>,</mml:mo><mml:mn>2.1</mml:mn><mml:mo>,</mml:mo><mml:mn>2.5</mml:mn><mml:mo>,</mml:mo><mml:mn>2.9</mml:mn><mml:mo>,</mml:mo><mml:mn>3.3</mml:mn><mml:mo>,</mml:mo><mml:mn>3.7</mml:mn><mml:mo>,</mml:mo><mml:mn>4.1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>. Note, the first term imposes sizable non-linear effects which differ between both treatments. We further scaled the polynomials by <italic toggle="yes">c </italic>=<italic toggle="yes"> </italic>0.01 to yield realistic survival times up to 10 years. This setting gives an overall positive ATE in <inline-formula id="IE63"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>64</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> of the patients.</p>
      <p><xref rid="btac221-F2" ref-type="fig">Figure 2b</xref> gives the performance of the evaluated methods in terms of Harrell’s C-index. We observed that the ordinary Cox regression with linear predictor variables performs worst across all sample sizes, followed by RSF, and SurvITE. Approximately equal performance was observed for the DeepSurv approaches, ITES, and BITES. Among these methods, the treatment-specific DeepSurv models (T-DeepSurv) showed a higher variance across the simulation runs, in particular for the low sample sizes. Next, we studied the corresponding PEHE scores (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>) and the proportion of correctly assigned treatments (<xref rid="btac221-F2" ref-type="fig">Fig. 2e</xref>). We observed, although DeepSurv performed well in terms of C-Indices, that the performance was highly compromised in the latter two measures. In fact, it was not able to outperform the recommendation based on the ATE, i.e. always assigning <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>1, which corresponds to the dashed horizontal line. We further observed that SurvITE performed worst in this scenario with both substantially lower proportions of correctly assigned treatments and higher PEHE scores compared to the other methods. Here, T-DeepSurv, ITES, and BITES performed best, however, the results of the former are inferior compared to ITES and BITES for sample sizes of <italic toggle="yes">n </italic>=<italic toggle="yes"> </italic>600 and <italic toggle="yes">n </italic>=<italic toggle="yes"> </italic>1200. Additional simulations for smaller sample sizes can be found in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>, where we observed that none of the methods is able to outperform the ATE-based recommendation.</p>
      <p><italic toggle="yes">Non-linear simulation study with treatment bias</italic>: Finally, we repeated the non-linear simulation study but now took into account a treatment assignment bias, i.e. the value of one or more covariates is indicative of the applied treatment. To simulate this effect, we assigned the treatment with a 90% probability if the fifths entry of <inline-formula id="IE64"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> or <inline-formula id="IE65"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> was larger than zero. To ensure that the unconfoundedness assumption holds, we set the corresponding entries <inline-formula id="IE66"><mml:math id="IM66" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE67"><mml:math id="IM67" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">γ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to zero. This simulation study yields a positive treatment effect in <inline-formula id="IE68"><mml:math id="IM68" display="inline" overflow="scroll"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>71</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> of the patients (dashed horizontal line in <xref rid="btac221-F2" ref-type="fig">Fig. 2f</xref>).</p>
      <p><xref rid="btac221-F2" ref-type="fig">Figure 2c and f</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S1</xref> show the results in terms of C-index, correctly assigned treatments, and PEHE scores, respectively. Similar to the previous studies, the best performing methods with respect to C-Indices were the two DeepSurv models, ITES and BITES. With respect to correctly assigned treatments and PEHE scores, however, BITES consistently outperformed the other methods for reasonable sample sizes starting from <italic toggle="yes">n </italic>=<italic toggle="yes"> </italic>1200. For <italic toggle="yes">n </italic>=<italic toggle="yes"> </italic>600, none of the methods was able to outperform a model where the treatment is always recommended (dashed line in <xref rid="btac221-F2" ref-type="fig">Fig. 2f</xref>). This was further confirmed for lower sample sizes (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>).</p>
    </sec>
    <sec>
      <title>3.2 Bites optimizes hormone treatment in patients with breast cancer</title>
      <p>We retrieved data of <inline-formula id="IE69"><mml:math id="IM69" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>545</mml:mn></mml:mrow></mml:math></inline-formula> node-positive breast cancer patients from the Rotterdam Tumour Bank (<xref rid="btac221-B19" ref-type="bibr">Foekens <italic toggle="yes">et al.</italic>, 2000</xref>) as provided by <xref rid="btac221-B35" ref-type="bibr">Katzman <italic toggle="yes">et al.</italic> (2018)</xref>. The latter data were preprocessed according to (<xref rid="btac221-B57" ref-type="bibr">Royston and Parmar, 2013</xref>). We used recurrence-free survival (RFS) time, defined as the time from primary surgery to the earlier of disease recurrence or death from any cause, as outcome for the further analysis. The available patient characteristics are age, menopausal status (pre/post), number of cancerous lymph nodes, tumor grade and progesterone and estrogen receptor status. Of these patients, 339 were treated by a combination of chemotherapy and hormone therapy. The remaining patients were treated by chemotherapy only. Note, in this study, the application of hormone treatment was not randomized. In total <inline-formula id="IE70"><mml:math id="IM70" display="inline" overflow="scroll"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>37</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> of the patients were censored.</p>
      <p>We used these data to learn treatment recommender systems in order to predict the ITE of adding hormone therapy to chemotherapy. We performed hyper-parameter tuning as outlined in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3</xref>, and selected the models with the lowest validation loss, respectively.</p>
      <p>Next, we evaluated the performance using test data from the GBSG Trial 2 (<xref rid="btac221-B59" ref-type="bibr">Schmoor <italic toggle="yes">et al.</italic>, 1996</xref>). Excluding cases with missing covariates, it contains 686 individual patients, with <inline-formula id="IE71"><mml:math id="IM71" display="inline" overflow="scroll"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>65</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> randomized hormone treatment assignments. The obtained C-indices are summarized in <xref rid="btac221-T1" ref-type="table">Table 1</xref>. Note, since only the factual outcomes are observable, we could not evaluate the performance with respect to correctly assigned ‘best treatments’ or PEHE scores. However, to substantiate our findings, we stratified our patients into two groups; the group ‘recommended treatment’ contains samples where the recommended treatment coincides with the applied treatment, while the group ‘anti-recommended treatment’ contains the samples where the recommended treatment does not coincide with the applied treatment (following <xref rid="btac221-B35" ref-type="bibr">Katzman <italic toggle="yes">et al.</italic>, 2018</xref>). The corresponding Kaplan–Meier (KM) curves of BITES are shown in <xref rid="btac221-F3" ref-type="fig">Figure 3</xref> with recommended treatment in green and anti-recommended treatment in red. Corresponding results for the other methods are shown in <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S3</xref>. For comparison, KM curves for the treated and control group are shown in blue and orange in <xref rid="btac221-F3" ref-type="fig">Figure 3</xref>. Interestingly, BITES recommends hormone treatment only in 83.4% which resulted in the largest difference in survival based on the recommendations made by BITES (<italic toggle="yes">P </italic>=<italic toggle="yes"> </italic>0.000016). On the other hand, DeepSurv and Cox regression suggest to treat all patients with hormone therapy, closely followed by SurvITE (treatment recommended for 98.1% of patients). The results for all models are summarized in <xref rid="btac221-T1" ref-type="table">Table 1</xref>. Note, the group with BITES recommendation showed a superior survival compared to the treated group and the group with BITES anti-recommendation showed an inferior performance compared to the control group. Both comparisons, however, were not significant in a log-rank test.</p>
      <fig position="float" id="btac221-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>Recurrence-free survival probability for patients grouped according to the respective treatment recommendations of BITES, based on the test data from the GBSG Trial 2. For comparison, we show the KM curves for all hormone treated and untreated (control) patients in blue and orange, respectively (shown without error bars for better visibility)</p>
        </caption>
        <graphic xlink:href="btac221f3" position="float"/>
      </fig>
      <table-wrap position="float" id="btac221-T1">
        <label>Table 1.</label>
        <caption>
          <p>Predictive outcomes on the controlled randomized test set of the RGBSG data obtained by each of the discussed models with minimum validation loss found in a hyper-parameter grid search</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Method</th>
              <th rowspan="1" colspan="1">C-index</th>
              <th rowspan="1" colspan="1"><italic toggle="yes">P</italic>-value</th>
              <th rowspan="1" colspan="1">Fraction <italic toggle="yes">T</italic> = 1</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Cox reg.</td>
              <td rowspan="1" colspan="1">0.471</td>
              <td rowspan="1" colspan="1">0.0034</td>
              <td rowspan="1" colspan="1">100%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">DeepSurv</td>
              <td rowspan="1" colspan="1">0.671</td>
              <td rowspan="1" colspan="1">0.0034</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE72">
                  <mml:math id="IM72" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>100</mml:mn>
                      <mml:mo>%</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">T-DeepSurv</td>
              <td rowspan="1" colspan="1">0.652</td>
              <td rowspan="1" colspan="1">0.2023</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE73">
                  <mml:math id="IM73" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>92.9</mml:mn>
                      <mml:mo>%</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">RSF</td>
              <td rowspan="1" colspan="1">0.675</td>
              <td rowspan="1" colspan="1">0.0013</td>
              <td rowspan="1" colspan="1">82.5%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">SurvITE</td>
              <td rowspan="1" colspan="1">0.631</td>
              <td rowspan="1" colspan="1">0.0039</td>
              <td rowspan="1" colspan="1">98.1%</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">ITES</td>
              <td rowspan="1" colspan="1">
                <bold>0.676</bold>
              </td>
              <td rowspan="1" colspan="1">0.000198</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE74">
                  <mml:math id="IM74" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>75.8</mml:mn>
                      <mml:mo>%</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">BITES</td>
              <td rowspan="1" colspan="1">0.666</td>
              <td rowspan="1" colspan="1">
                <bold>0.000016</bold>
              </td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE75">
                  <mml:math id="IM75" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mn>83.4</mml:mn>
                      <mml:mo>%</mml:mo>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <p>Values in boldface indicate the best performing model with respect to C-index and <italic toggle="yes">P</italic>-value, respectively.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>Finally, we explored feature importance of the BITES model using SHAP values (<xref rid="btac221-B46" ref-type="bibr">Lundberg and Lee, 2017</xref>) with results shown in <xref rid="btac221-F4" ref-type="fig">Figure 4</xref> which correspond to treatment option <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>0 (no hormone treatment) and <italic toggle="yes">T </italic>=<italic toggle="yes"> </italic>1 (hormone treatment), respectively. Here, points correspond to patients and positive (negative) SHAP values on the <italic toggle="yes">x</italic>-axis indicate an increased (decreased) risk of failure. Further, the feature value is illustrated in colors ranging from red to blue, where high values are shown in red and low values in blue. We observed that the number of positive lymph nodes has the strongest impact on survival with SHAP values ranging from <inline-formula id="IE76"><mml:math id="IM76" display="inline" overflow="scroll"><mml:mrow><mml:mo>∼</mml:mo><mml:mo>−</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></inline-formula> to <inline-formula id="IE77"><mml:math id="IM77" display="inline" overflow="scroll"><mml:mrow><mml:mo>∼</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> in the group with and without hormone treatment, where more positive lymph nodes (shown in red) indicate a worse survival. Considering menopausal status, we observed an increased risk of death and recurrence in postmenopausal breast cancer patients that had not received adjuvant hormone treatment (<italic toggle="yes">T</italic> = 0). This effect was substantially mitigated in the hormone-treated group, which is in line with the observation that postmenopausal, more than premenopausal breast cancer patients draw a disease-free survival benefit from extended adjuvant endocrine treatment (<xref rid="btac221-B42" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2018</xref>). However, this does not preclude a survival benefit from hormone treatment for certain premenopausal breast cancer patients as revealed by a comparison of <xref rid="btac221-F4" ref-type="fig">Figure 4a and b</xref>. It is also noteworthy, that high tumor grade (grade 3, shown in red) yielded increased SHAP values of up to 0.5 in the tamoxifen-treated group. This effect was substantially mitigated in the group without hormone treatment. This finding is in line with a recent study by <xref rid="btac221-B14" ref-type="bibr">Dar <italic toggle="yes">et al.</italic> (2021)</xref>, which found a significant tamoxifen treatment benefit only among patients suffering from lower grade tumors, while no benefit was observed for grade 3 tumors. In summary, we observed strong hints that hormone treatment alleviates the negative effect of menopause, and increases the negative effect of high tumor grade on patient survival.</p>
      <fig position="float" id="btac221-F4">
        <label>Fig. 4.</label>
        <caption>
          <p>SHAP (SHapley Additive exPlanations) values for the best selected BITES model on the controlled randomized test samples of the RGBSG data. Red points correspond to high and blue points to low feature values. A positive SHAP value indicates an increased hazard and hence decreased survival chances and vice versa (A color version of this figure appears in the online version of this article)</p>
        </caption>
        <graphic xlink:href="btac221f4" position="float"/>
      </fig>
    </sec>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>We presented BITES, which is a machine learning framework to optimize individual treatment decisions based on time-to-event data. It combines Deep Neural Network counterfactual reasoning with Cox’s PH model. It further enables balancing of treated and non-treated patients using IPM on a latent layer data representation. We demonstrated in simulation studies that BITES outcompetes state-of-the-art methods with respect to prediction performance (Harrell’s C-index), correctly assigned treatments, and PEHE scores. We observed that BITES can effectively capture both linear and non-linear covariate outcome dependencies on both small and large scale observational studies. Moreover, we showed that BITES can be used to optimize hormone treatment in breast cancer patients. Using independent data from the GBSG Trial 2, we observed that BITES treatment recommendations might improve patients’ RFS. In this context, SHAP values were demonstrated to enhance the interpretability and transparency of treatment recommendations.</p>
    <p>Like most recently developed counterfactual tools, BITES depends on the <italic toggle="yes">strong ignorability</italic> assumption. Hence, caution is necessary when analyzing heavily confounded observational data. Future work needs to address more specialized time-to-event models, such as competing event models, and the generalization to multiple treatments and combinations thereof. Both could substantially broaden the scope of applications for BITES.</p>
    <p>In summary, BITES facilitates treatment optimization from time-to-event data. In combination with SHAP values, BITES models can be easily interpreted on the level of individual patients, making them a versatile backbone for treatment recommender systems.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the German Federal Ministry of Education and Research (BMBF) within the framework of the e:Med research and funding concept (grants 01ZX1912A, 01ZX1912C).</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac221_Supplementary_Data</label>
      <media xlink:href="btac221_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac221-B1">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Alaa</surname><given-names>A.M.</given-names></string-name>, <string-name><surname>van der Schaar</surname><given-names>M.</given-names></string-name></person-group> (<year>2017</year>). Bayesian inference of individualized treatment effects using multi-task Gaussian processes. In: <italic toggle="yes">31st Conference on Neural Information Processing Systems, Long Beach, California, USA.</italic></mixed-citation>
    </ref>
    <ref id="btac221-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Antolini</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2005</year>) <article-title>A time-dependent discrimination index for survival data</article-title>. <source>Stat. Med</source>., <volume>24</volume>, <fpage>3927</fpage>–<lpage>3944</lpage>.<pub-id pub-id-type="pmid">16320281</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B3">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Atan</surname><given-names>O.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>). Deep-treat: learning optimal personalized treatments from observational data using neural networks. In: <italic toggle="yes">Proceedings of the AAAI Conference on Artificial Intelligence</italic>, p. <fpage>32</fpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Athey</surname>,<given-names>S.</given-names></string-name> and <string-name><surname>Wager</surname>,<given-names>S.</given-names></string-name></person-group> (<year>2019</year>) <article-title>Estimating treatment effects with causal forests: an application</article-title>. <source>Obs. Stud.</source>, <volume>5</volume>, <fpage>37</fpage>–<lpage>51</lpage>. https://doi.org/<pub-id pub-id-type="doi">10.1353/obs.2019.0001</pub-id>.</mixed-citation>
    </ref>
    <ref id="btac221-B5">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Athey</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>). Generalized random forests. <italic toggle="yes">Ann. Stat</italic>. <bold>47</bold>, <fpage>1148</fpage>–<lpage>1178</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bellera</surname><given-names>C.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) <article-title>Variables with time-varying effects and the Cox model: some statistical concepts illustrated with a prognostic factor study in breast cancer</article-title>. <source>BMC Med. Res. Methodol</source>., <volume>10</volume>, <fpage>20</fpage>.<pub-id pub-id-type="pmid">20233435</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bottou</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) <article-title>Counterfactual reasoning and learning systems: the example of computational advertising</article-title>. <source>J. Mach. Learn. Res</source>., <volume>14</volume>, <fpage>3207</fpage>–<lpage>3260</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Breslow</surname><given-names>N.</given-names></string-name></person-group> (<year>1972</year>) <article-title>Discussion on Professor Cox’s paper</article-title>. <source>J. R. Stat. Soc. Series B (Methodol.)</source>, <bold>52</bold>, <fpage>216</fpage>–<lpage>217</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B9">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Chapfuwa</surname><given-names>P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>). Enabling counterfactual survival analysis with balanced representations. In: <italic toggle="yes">Proceedings of the Conference on Health, Inference, and Learning</italic>, pp. <fpage>133</fpage>–<lpage>145</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cox</surname><given-names>D.R.</given-names></string-name></person-group> (<year>1972</year>) <article-title>Regression models and Life-Tables</article-title>. <source>J. R. Stat. Soc. Series B (Methodol.)</source>, <volume>34</volume>, <fpage>187</fpage>–<lpage>220</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B11">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Curth</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>). SurvITE: learning heterogeneous treatment effects from time-to-event data. <italic toggle="yes">Adv. Neural Inf. Process. Syst</italic>., <bold>34</bold>.</mixed-citation>
    </ref>
    <ref id="btac221-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cuturi</surname><given-names>M.</given-names></string-name></person-group> (<year>2013</year>) <article-title>Sinkhorn distances: lightspeed computation of optimal transport</article-title>. <source>Adv. Neural Inf. Process. Syst.</source>, <volume>26</volume>.</mixed-citation>
    </ref>
    <ref id="btac221-B13">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>D’Amour</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>). Overlap in observational studies with high-dimensional covariates. <italic toggle="yes">J. Econometrics</italic>, <bold>221</bold>, <fpage>644</fpage>–<lpage>654</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dar</surname><given-names>H.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>) <article-title>Assessment of 25-year survival of women with estrogen receptor-positive/erbb2-negative breast cancer treated with and without tamoxifen therapy: a secondary analysis of data from the Stockholm tamoxifen randomized clinical trial</article-title>. <source>JAMA Netw. Open</source>., <volume>4</volume>, <fpage>e2114904</fpage>.<pub-id pub-id-type="pmid">34190995</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B15">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Davidson-Pilon</surname><given-names>C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>). <italic toggle="yes">CamDavidsonPilon/lifelines: 0</italic>.<italic toggle="yes">26</italic>.<italic toggle="yes">0</italic>. Zenodo.</mixed-citation>
    </ref>
    <ref id="btac221-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Diamond</surname><given-names>A.</given-names></string-name>, <string-name><surname>Sekhon</surname><given-names>J.S.</given-names></string-name></person-group> (<year>2013</year>) <article-title>Genetic matching for estimating causal effects: a general multivariate matching method for achieving balance in observational studies</article-title>. <source>Rev. Econ. Stat</source>., <volume>95</volume>, <fpage>932</fpage>–<lpage>945</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Faraggi</surname><given-names>D.</given-names></string-name>, <string-name><surname>Simon</surname><given-names>R.</given-names></string-name></person-group> (<year>1995</year>) <article-title>A neural network model for survival data</article-title>. <source>Stat. Med</source>., <volume>14</volume>, <fpage>73</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">7701159</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B18">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Feydy</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) Interpolating between Optimal Transport and MMD using Sinkhorn Divergences. In: <italic toggle="yes">The 22nd International Conference on Artificial Intelligence and Statistics</italic>, Vol. 22, pp. <fpage>2681</fpage>–<lpage>2690</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Foekens</surname><given-names>J.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2000</year>) <article-title>The urokinase system of plasminogen activation and prognosis in 2780 breast cancer patients</article-title>. <source>Cancer Res</source>., <volume>60</volume>, <fpage>636</fpage>–<lpage>643</lpage>.<pub-id pub-id-type="pmid">10676647</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Frieden</surname><given-names>T.R.</given-names></string-name></person-group> (<year>2017</year>) <article-title>Evidence for health decision making—beyond randomized, controlled trials</article-title>. <source>N Engl. J. Med</source>., <volume>377</volume>, <fpage>465</fpage>–<lpage>475</lpage>.<pub-id pub-id-type="pmid">28767357</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B21">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Genevay</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) Learning generative models with Sinkhorn divergences. In: <italic toggle="yes">International Conference on Artificial Intelligence and Statistics</italic>, pp. <fpage>1608</fpage>–<lpage>1617</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gensheimer</surname><given-names>M.F.</given-names></string-name>, <string-name><surname>Narasimhan</surname><given-names>B.</given-names></string-name></person-group> (<year>2019</year>) <article-title>A scalable discrete-time survival model for neural networks</article-title>. <source>PeerJ</source>, <volume>7</volume>, <fpage>e6257</fpage>.<pub-id pub-id-type="pmid">30701130</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gretton</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>A kernel two-sample test</article-title>. <source>J. Mach. Learn. Res</source>., <volume>13</volume>, <fpage>723</fpage>–<lpage>773</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Harrell</surname><given-names>F.E.</given-names></string-name></person-group> (<year>1982</year>) <article-title>Evaluating the yield of medical tests</article-title>. <source>JAMA</source>, <volume>247</volume>, <fpage>2543</fpage>.<pub-id pub-id-type="pmid">7069920</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hill</surname><given-names>J.L.</given-names></string-name></person-group> (<year>2011</year>) <article-title>Bayesian nonparametric modeling for causal inference</article-title>. <source>J. Comput. Graph. Stat</source>., <volume>20</volume>, <fpage>217</fpage>–<lpage>240</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Holland</surname><given-names>P.W.</given-names></string-name></person-group> (<year>1986</year>) <article-title>Statistics and causal inference</article-title>. <source>J. Am. Stat. Assoc</source>., <volume>81</volume>, <fpage>945</fpage>–<lpage>960</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huang</surname><given-names>C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>Local similarity-aware deep feature embedding</article-title>. <source>Adv. Neural Inf. Process. Syst</source>., <volume>29</volume>.</mixed-citation>
    </ref>
    <ref id="btac221-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Imai</surname><given-names>K.</given-names></string-name>, <string-name><surname>Ratkovic</surname><given-names>M.</given-names></string-name></person-group> (<year>2014</year>) <article-title>Covariate balancing propensity score</article-title>. <source>J. R Stat. Soc. B</source>., <volume>76</volume>, <fpage>243</fpage>–<lpage>263</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B29">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Ioffe</surname><given-names>S.</given-names></string-name>, <string-name><surname>Szegedy</surname><given-names>C.</given-names></string-name></person-group> (<year>2015</year>) Batch normalization: accelerating deep network training by reducing internal covariate shift. In: <italic toggle="yes">International conference on machine learning</italic>, pp. <fpage>448</fpage>–<lpage>456</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ishwaran</surname><given-names>H.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) <article-title>Random survival forests</article-title>. <source>Ann. Appl. Stat</source>., <volume>2</volume>, <fpage>841</fpage>–<lpage>860</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jachimowicz</surname><given-names>R.D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>) <article-title>Gene expression-based outcome prediction in advanced stage classical hodgkin lymphoma treated with BEACOPP</article-title>. <source>Leukemia</source>, <volume>35</volume>, <fpage>3589</fpage>–<lpage>3593</lpage>.<pub-id pub-id-type="pmid">34112956</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B32">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Johansson</surname><given-names>F.D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) Learning representations for counterfactual inference. In: <italic toggle="yes">International conference on machine learning</italic>, pp. <fpage>3020</fpage>–<lpage>3029</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B33">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Johansson</surname><given-names>F.D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) Generalization bounds and representation learning for estimation of potential outcomes and causal effects. arXiv preprint arXiv:2001.07426.</mixed-citation>
    </ref>
    <ref id="btac221-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kantorovitch</surname><given-names>L.</given-names></string-name></person-group> (<year>1958</year>) <article-title>On the translocation of masses</article-title>. <source>Manage. Sci</source>., <volume>5</volume>, <fpage>1</fpage>–<lpage>4</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Katzman</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>DeepSurv: personalized treatment recommender system using a cox proportional hazards deep neural network</article-title>. <source>BMC Med. Res. Methodol</source>., <volume>18</volume>, <fpage>1</fpage>.<pub-id pub-id-type="pmid">29301497</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>King</surname><given-names>G.</given-names></string-name>, <string-name><surname>Nielsen</surname><given-names>R.</given-names></string-name></person-group> (<year>2019</year>) <article-title>Why propensity scores should not be used for matching</article-title>. <source>Polit. Anal</source>., <volume>27</volume>, <fpage>435</fpage>–<lpage>454</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B37">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Kingma</surname><given-names>D.P.</given-names></string-name>, <string-name><surname>Ba</surname><given-names>J.</given-names></string-name></person-group> (<year>2014</year>) Adam: a method for stochastic optimization. arXiv preprint arXiv:1412.6980.</mixed-citation>
    </ref>
    <ref id="btac221-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kohavi</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2009</year>) <article-title>Controlled experiments on the web: survey and practical guide</article-title>. <source>Data Min. Knowl. Disc</source>., <volume>18</volume>, <fpage>140</fpage>–<lpage>181</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B39">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Krogh</surname><given-names>A.</given-names></string-name>, <string-name><surname>Hertz</surname><given-names>J.</given-names></string-name></person-group> (<year>1992</year>) <part-title>A simple weight decay can improve generalization</part-title>. In: Moody,J., Hanson,S. and Lippmann, R.P. (eds.) <italic toggle="yes">Advances in Neural Information Processing Systems</italic>, Vol. 4. Morgan-Kaufmann, San Mateo CA, United States, pp. 950–957. </mixed-citation>
    </ref>
    <ref id="btac221-B40">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Kvamme</surname><given-names>H.</given-names></string-name>, <string-name><surname>Borgan</surname><given-names>Ø.</given-names></string-name></person-group> (<year>2019</year>) Continuous and discrete-time survival prediction with neural networks. <italic toggle="yes">Lifetime Data Anal</italic>., <bold>27</bold>, <fpage>710</fpage>–<lpage>736</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B41">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) DeepHit: a deep learning approach to survival analysis with competing risks. In: <italic toggle="yes">Proceedings of the AAAI conference on artificial intelligence</italic>, p. <fpage>32</fpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Clinical outcomes comparison of 10 years versus 5 years of adjuvant endocrine therapy in patients with early breast cancer</article-title>. <source>BMC Cancer</source>, <volume>18</volume>, <fpage>977</fpage>.<pub-id pub-id-type="pmid">30314452</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>S.</given-names></string-name>, <string-name><surname>Fu</surname><given-names>Y.</given-names></string-name></person-group> (<year>2017</year>) <article-title>Matching on balanced nonlinear representations for treatment effects estimation</article-title>. <source>Adv. Neural Inf. Process. Syst</source>., <volume>30</volume>.</mixed-citation>
    </ref>
    <ref id="btac221-B44">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Liaw</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) Tune: a research platform for distributed model selection and training. arXiv preprint arXiv:1807.05118.</mixed-citation>
    </ref>
    <ref id="btac221-B45">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lu</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Reconsidering generative objectives for counterfactual reasoning</article-title>. <source>Adv. Neural Inf. Process. Syst</source>., <volume>33</volume>, <fpage>21539</fpage>–<lpage>21553</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B46">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Lundberg</surname><given-names>S.</given-names></string-name>, <string-name><surname>Lee</surname><given-names>S.-I.</given-names></string-name></person-group> (<year>2017</year>) A unified approach to interpreting model predictions. <italic toggle="yes">Adv. Neural Inf. Process. Syst.</italic>, <bold>32</bold>.</mixed-citation>
    </ref>
    <ref id="btac221-B47">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Martinussen</surname><given-names>T.</given-names></string-name>, <string-name><surname>Scheike</surname><given-names>T.H.</given-names></string-name></person-group> (<year>2006</year>). <source>Dynamic Regression Models for Survival Data</source>. <publisher-name>Springer</publisher-name>, <publisher-loc>New York, NY</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btac221-B48">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Müller</surname><given-names>A.</given-names></string-name></person-group> (<year>1991</year>) Integral probability metrics and their enerating classes of functions. <italic toggle="yes">Adv. Appl. Probab</italic>., <bold>29</bold>, <fpage>429</fpage>–<lpage>443</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B49">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Nair</surname><given-names>V.</given-names></string-name>, <string-name><surname>Hinton</surname><given-names>G.E.</given-names></string-name></person-group> (<year>2010</year>) Rectified linear units improve restricted Boltzmann machines. In: <italic toggle="yes">International Conference on Machine Learning.</italic></mixed-citation>
    </ref>
    <ref id="btac221-B50">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Paszke</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) PyTorch: an imperative style, high-performance deep learning library. <italic toggle="yes">Adv. Neural Inf. Process. Syst.</italic>, <bold>32</bold>.</mixed-citation>
    </ref>
    <ref id="btac221-B51">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Pearl</surname><given-names>J.</given-names></string-name></person-group> (<year>2008</year>) <source>Causality: Models, Reasoning and Interference</source>, <edition>8. pr edition</edition>. <publisher-name>Cambridge University Press</publisher-name>, <publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btac221-B52">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pearl</surname><given-names>J.</given-names></string-name></person-group> (<year>2009</year>) <article-title>Causal inference in statistics: an overview</article-title>. <source>Statist. Surv</source>., <volume>3</volume>, <fpage>96</fpage>–<lpage>146</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B53">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pearl</surname><given-names>J.</given-names></string-name></person-group> (<year>2017</year>) <article-title>Detecting latent heterogeneity</article-title>. <source>Sociol. Methods Res</source>., <volume>46</volume>, <fpage>370</fpage>–<lpage>389</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B54">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pölsterl</surname><given-names>S.</given-names></string-name></person-group> (<year>2020</year>) <article-title>Scikit-survival: a library for time-to-Event analysis built on top of scikit-learn</article-title>. <source>J. Mach. Learn. Res</source>., <volume>21</volume>, <fpage>1</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">34305477</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B55">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ramdas</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>On Wasserstein two-sample testing and related families of nonparametric tests</article-title>. <source>Entropy</source>, <volume>19</volume>, <fpage>47</fpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B56">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rosenbaum</surname><given-names>P.R.</given-names></string-name>, <string-name><surname>Rubin</surname><given-names>D.B.</given-names></string-name></person-group> (<year>1983</year>) <article-title>The Central role of the propensity score in observational studies for causal effects</article-title>. <source>Biometrilca</source>, <volume>70</volume>, <fpage>41</fpage>–<lpage>55</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B57">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Royston</surname><given-names>P.</given-names></string-name>, <string-name><surname>Parmar</surname><given-names>M.K.B.</given-names></string-name></person-group> (<year>2013</year>) <article-title>Restricted mean survival time: an alternative to the hazard ratio for the design and analysis of randomized trials with a time-to-event outcome</article-title>. <source>BMC Med. Res. Methodol</source>., <volume>13</volume>, <fpage>152</fpage>.<pub-id pub-id-type="pmid">24314264</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B58">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rubin</surname><given-names>D.B.</given-names></string-name></person-group> (<year>1974</year>) <article-title>Estimating causal effects of treatments in randomized and nonrandomized studies</article-title>. <source>J. Educ. Psychol</source>., <volume>66</volume>, <fpage>688</fpage>–<lpage>701</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B59">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schmoor</surname><given-names>C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>1996</year>) <article-title>Randomized and non-randomized patients in clinical trials: experiences with comprehensive cohort studies</article-title>. <source>Stat. Med</source>., <volume>15</volume>, <fpage>263</fpage>–<lpage>271</lpage>.<pub-id pub-id-type="pmid">8643884</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B60">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schumacher</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>1994</year>) <article-title>Randomized 2 x 2 trial evaluating hormonal treatment and the duration of chemotherapy in node-positive breast cancer patients. German breast cancer study group</article-title>. <source>JCO</source>, <volume>12</volume>, <fpage>2086</fpage>–<lpage>2093</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B61">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Shalit</surname><given-names>U.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) Estimating individual treatment effect: generalization bounds and algorithms. In: <italic toggle="yes"><italic toggle="yes">I</italic>nternational Conference on Machine Learning</italic>, pp. <fpage>3076</fpage>–<lpage>3085</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B62">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sriperumbudur</surname><given-names>B.K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>On the empirical estimation of integral probability metrics</article-title>. <source>Electron. J. Stat</source>., <volume>6, 1550–1599.</volume></mixed-citation>
    </ref>
    <ref id="btac221-B63">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Srivastava</surname><given-names>N.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Dropout: a simple way to prevent neural networks from overfitting</article-title>. <source>J. Mach. Learn. Res</source>., <volume>15</volume>, <fpage>1929</fpage>–<lpage>1958</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B64">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Staiger</surname><given-names>A.M.</given-names></string-name></person-group>  <etal>et al</etal>; German High Grade Non-Hodgkin’s Lymphoma Study Group (DSHNHL) (<year>2020</year>) <article-title>A novel lymphoma-associated macrophage interaction signature (LAMIS) provides robust risk prognostication in diffuse large B-cell lymphoma clinical trial cohorts of the DSHNHL</article-title>. <source>Leukemia</source>, <volume>34</volume>, <fpage>543</fpage>–<lpage>552</lpage>.<pub-id pub-id-type="pmid">31530861</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B65">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tibshirani</surname><given-names>R.</given-names></string-name></person-group> (<year>1997</year>) <article-title>The lasso method for variable selection in the cox model</article-title>. <source>Stat. Med</source>., <volume>16</volume>, <fpage>385</fpage>–<lpage>395</lpage>.<pub-id pub-id-type="pmid">9044528</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B66">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wager</surname><given-names>S.</given-names></string-name>, <string-name><surname>Athey</surname><given-names>S.</given-names></string-name></person-group> (<year>2017</year>) Estimation and inference of heterogeneous treatment effects using random forests. <italic toggle="yes">J Am Stat Assoc</italic>, <volume>113</volume>, <fpage>1228</fpage>–<lpage>1242</lpage>.</mixed-citation>
    </ref>
    <ref id="btac221-B67">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xue</surname><given-names>X.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) <article-title>Testing the proportional hazards assumption in case-cohort analysis</article-title>. <source>BMC Med. Res. Methodol</source>., <volume>13</volume>, <fpage>88</fpage>.<pub-id pub-id-type="pmid">23834739</pub-id></mixed-citation>
    </ref>
    <ref id="btac221-B68">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yao</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Representation learning for treatment effect estimation from observational data</article-title>. <source>Adv. Neural Inf. Process. Syst</source>., <volume>31</volume>.</mixed-citation>
    </ref>
    <ref id="btac221-B69">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Yoon</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) GANITE: estimation of individualized treatment effects using generative adversarial nets. In: <italic toggle="yes">International Conference on Learning Representations, Vancouver, BC, Canada.</italic></mixed-citation>
    </ref>
    <ref id="btac221-B70">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zacharias</surname><given-names>H.U.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>) <article-title>A predictive model for progression of CKD to kidney failure based on routine laboratory tests</article-title>. <source>Am. J. Kidney Dis</source>., <volume>79</volume>, <fpage>217</fpage>–<lpage>230.e1</lpage>.<pub-id pub-id-type="pmid">34298143</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
