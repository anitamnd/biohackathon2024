<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8428601</article-id>
    <article-id pub-id-type="pmid">33704427</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btab164</article-id>
    <article-id pub-id-type="publisher-id">btab164</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic toggle="yes">sepal</italic>: identifying transcript profiles with spatial patterns by diffusion-based modeling</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Andersson</surname>
          <given-names>Alma</given-names>
        </name>
        <xref rid="btab164-cor1" ref-type="corresp"/>
        <aff><institution>Department of Gene Technology, Science for Life Laboratory, KTH Royal Institute of Technology</institution>, Stockholm 114 28, <country country="SE">Sweden</country></aff>
        <!--almaan@kth.se-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lundeberg</surname>
          <given-names>Joakim</given-names>
        </name>
        <aff><institution>Department of Gene Technology, Science for Life Laboratory, KTH Royal Institute of Technology</institution>, Stockholm 114 28, <country country="SE">Sweden</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Mathelier</surname>
          <given-names>Anthony</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btab164-cor1">To whom correspondence should be addressed. <email>almaan@kth.se</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>9</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2021-03-11">
      <day>11</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>11</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <volume>37</volume>
    <issue>17</issue>
    <fpage>2644</fpage>
    <lpage>2650</lpage>
    <history>
      <date date-type="received">
        <day>05</day>
        <month>6</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>02</day>
        <month>3</month>
        <year>2021</year>
      </date>
      <date date-type="editorial-decision">
        <day>03</day>
        <month>3</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>08</day>
        <month>3</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btab164.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Collection of spatial signals in large numbers has become a routine task in multiple omics-fields, but parsing of these rich datasets still pose certain challenges. In whole or near-full transcriptome spatial techniques, spurious expression profiles are intermixed with those exhibiting an organized structure. To distinguish profiles with spatial patterns from the background noise, a metric that enables quantification of spatial structure is desirable. Current methods designed for similar purposes tend to be built around a framework of statistical hypothesis testing, hence we were compelled to explore a fundamentally different strategy.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We propose an unexplored approach to analyze spatial transcriptomics data, simulating diffusion of individual transcripts to extract genes with spatial patterns. The method performed as expected when presented with synthetic data. When applied to real data, it identified genes with distinct spatial profiles, involved in key biological processes or characteristic for certain cell types. Compared to existing methods, ours seemed to be less informed by the genes’ expression levels and showed better time performance when run with multiple cores.</p>
      </sec>
      <sec id="s3">
        <title>Availabilityand implementation</title>
        <p>Open-source Python package with a command line interface (CLI), freely available at <ext-link xlink:href="https://github.com/almaan/sepal" ext-link-type="uri">https://github.com/almaan/sepal</ext-link> under an MIT licence. A mirror of the GitHub repository can be found at Zenodo, doi: 10.5281/zenodo.4573237.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>It has become evident in the post-NGS (Next Generation Sequencing) era that biological systems are best understood when studied in their entirety, as the intricate interplay between their constituents is easily lost if these parts are examined in isolation. In the field of transcriptomics this idea, the importance of context, has largely equated to examining the expression of multiple genes simultaneously, either on bulk or single cell level. However, there has been a recent surge in the development of experimental techniques designed to obtain <italic toggle="yes">spatial</italic> gene expression data, completely redefining the meaning of context. Armed with these techniques researchers are no longer limited to only quantifying expression levels, but may also relate them to each other in the spatial space. Different approaches to obtain spatial gene expression data have been presented: some, like ISS (In Situ Sequencing), rely on predesigned probes or gene panels; others aim for unbiased sampling from the whole transcriptome, for example by capture of polyadenylated mRNA molecules as in Visium, Spatial Transcriptomics (ST) and Slide-seq (<xref rid="btab164-B5" ref-type="bibr">Ke <italic toggle="yes">et al.</italic>, 2013</xref>; <xref rid="btab164-B14" ref-type="bibr">Rodriques <italic toggle="yes">et al.</italic>, 2019</xref>; Ståhl <xref rid="btab164-B16" ref-type="bibr"><italic toggle="yes">et al.</italic>, 2016</xref>). One benefit of targeting the whole transcription landscape is how a more representative portrait of the system’s state is obtained. Still, with a less specific set of targets, additional noise is unavoidably introduced into the data. Techniques designed to capture the full transcriptome may therefore be considered as better suited for exploratory analysis compared to those with <italic toggle="yes">a priori</italic> target selection, but also demand more elaborate processing to distill significant signals from the background noise.</p>
    <p>For this reason, gene expression profiles that possess distinct spatial patterns are of particular interest when attempting to chart the biological processes and pathways present within a tissue using transcriptome-wide techniques; structured spatial organization is unlikely to arise spontaneously, rather it implies presence of an underlying mechanism driving the system toward the observed configuration. Motivated by this, we have developed a method designed to analyze full transcriptome spatial data and extract gene expression profiles that exhibit distinct spatial patterns.</p>
    <p>Humans can intuitively detect deviances or features with captivating characteristics in spatial data; the challenge lies in translating such intuition into an automated and unbiased method suitable for computational analysis. To start, spatial patterns are diverse and do not follow a single well-defined distribution. In addition, most experimental techniques do not collect data continuously from the spatial domain, but sample from this space with varying sparsity; meaning that the complete spatial expression profiles are rarely observed. To address these issues, existing methods have either used non-parametric tests based on permutation of data (Trendsceek) or tried to model the generative process producing the spatial data to then determine whether a spatial effect is present (SpatialDE and SPARK) (<xref rid="btab164-B2" ref-type="bibr">Edsgärd <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btab164-B17" ref-type="bibr">Sun <italic toggle="yes">et al.</italic>, 2020</xref>; Svensson <xref rid="btab164-B18" ref-type="bibr"><italic toggle="yes">et al.</italic>, 2018</xref>).</p>
    <p>In this study, we seek to explore a different strategy not centered around hypothesis testing, with the intention to present complementary insights to those offered by other methods. Thus, we abstain from any attempt to infer or characterize the exact distributions from which the observed data originates, instead, we seek to assess the degree of randomness exhibited by each transcript profile and rank them accordingly. Upon doing so, we consider transcripts with a spatially random distribution as antipodes to those with distinct spatial patterns. To locate where on the spectrum between random and structured that a certain gene expression profile is positioned, we simulate diffusion of transcripts in the spatial domain and measure the time until convergence. The profiles are then ranked by this value, with the rationale being that transcripts with a random spatial distribution will reach a homogeneous state faster than those with a structured formation. To elaborate slightly on this idea; if transcripts of a certain gene (theoretically) were let to diffuse freely within a tissue, more time would be required to even out the concentration gradients present in a structured pattern compared to a more uniform state. This reasoning links the degree of structure among transcripts to the time it takes the system to reach a homogeneous configuration, and also implies a positive correlation between the two. Hence, by measuring the diffusion time in our simulated system we would be able to infer how structured or ‘non-random’ the expression pattern in question is. This, to our knowledge, is an unexplored strategy for identification of spatial gene expression patterns.</p>
    <p>After the gene expression profiles have been ranked, we suggest a procedure to group them into pattern families, where members of the same pattern family exhibit similar spatial organization. This assortment encompass the construction of an eigenpattern space onto which the gene expression profiles are projected and then hierarchically grouped.</p>
    <p>While this study mainly focuses on array-based spatial transcriptomics techniques such as ST and Visium, we also show how our method can be generalized to platforms where the spatial positions of observations do not adhere to a fixed arrangement (like that of an array), but vary between experiments. We refer to data collected from these platforms as <italic toggle="yes">unstructured</italic>, since distances between observations and their relative positions are random and do not adhere to a pre-defined structure. Examples of platforms producing unstructured data are: Slide-seq, MERFISH and SeqFISH (<xref rid="btab164-B1" ref-type="bibr">Asp <italic toggle="yes">et al.</italic>, 2020</xref>).</p>
    <p>The method we propose has been implemented in Python and is provided as an open-source tool named <italic toggle="yes">sepal</italic> (<bold>s</bold>patial <bold>e</bold>xpression <bold>pa</bold>ttern <bold>l</bold>ocator), hosted on GitHub (<ext-link xlink:href="https://github.com/almaan/sepal" ext-link-type="uri">https://github.com/almaan/sepal</ext-link>). Our implementation offers CPU parallelization, but is not designed for GPU acceleration. Means for visualization and generation of pattern families are provided by an analysis module in <italic toggle="yes">sepal</italic>.</p>
    <p>Focusing on individual transcripts, <italic toggle="yes">sepal</italic> facilitates informative analysis of large spatial transcriptomics datasets while producing results where the biological, interpretable, components are preserved.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Terminology</title>
      <p>We will abandon the use of ‘gene expression profile’ in favor of the stipulative term <italic toggle="yes">transcript profile</italic>; this is to emphasize that the profiles represent a spatial arrangement of individual transcripts associated with a given gene.</p>
    </sec>
    <sec>
      <title>2.2 Standard model</title>
      <p>First, let (Ω) denote the area defined by a tissue specimen. If expression values are collected from this tissue using a structured grid, we could consider this grid as a partitioning or discretization (<italic toggle="yes">S</italic>) of the domain Ω. When referring to members (the grid points) of <italic toggle="yes">S</italic>, we use <italic toggle="yes">s</italic>. Every point <italic toggle="yes">s</italic> has a set of neighbors (<inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mi>P</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>) defined as:
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mi>P</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi mathvariant="bold-italic">q</mml:mi><mml:mo>:</mml:mo><mml:mi mathvariant="bold-italic">q</mml:mi><mml:mo>∈</mml:mo><mml:mi>S</mml:mi><mml:mo>,</mml:mo><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>q</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mi>P</mml:mi></mml:msub><mml:mo>}</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">d<sub>P</sub></italic> depends on the experimental platform (<italic toggle="yes">P</italic>), the platform also dictates the maximal number of members (<italic toggle="yes">M<sub>P</sub></italic>) that a neighbor set may have. A grid point <italic toggle="yes">s</italic> with <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mi>P</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mi>P</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is called saturated, all other points are referred to as unsaturated. Together the saturated points make up the inner points (<italic toggle="yes">S<sub>i</sub></italic>), the remaining set of unsaturated points are referred to as the boundary points (<italic toggle="yes">S<sub>b</sub></italic>).</p>
      <p>Next, we let the function <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> be defined over Ω, representing the observed expression values (number of transcripts) of a certain gene (<italic toggle="yes">g</italic>) at spatial location (<italic toggle="yes">x</italic>, <italic toggle="yes">y</italic>) and time <italic toggle="yes">t</italic>.</p>
      <p>We may then use Fick’s second law to obtain an expression for diffusion within the tissue, resulting in:
<disp-formula id="E2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi>D</mml:mi><mml:mo>Δ</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">D</italic> is the diffusion coefficient and Δ the Laplacian. The time point <italic toggle="yes">t </italic>=<italic toggle="yes"> </italic>0 represents the initial state of the system, here the observed—and unperturbed—values. The exact form of <italic toggle="yes">u</italic> is unknown, and thus equally the value of <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Fortunately, we can approximate the Laplacian numerically. On a regular rectilinear grid this approximation is taken as (excluding the time variable for brevity):
<disp-formula id="E3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>≈</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo stretchy="false">[</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mo>+</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:mi>h</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mn>4</mml:mn><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p>For hexagonal grids, like those of the Visium arrays, we use a different approximation scheme presented in the work of L. Kantrovich and B. Krylov (<xref rid="btab164-B4" ref-type="bibr">Kantorovich, 2018</xref>). For an exact specification of the supported grids and specifications of their associated numerical methods, see Supplementary S2.1.</p>
      <p>After the Laplacian has been approximated with <xref rid="E3" ref-type="disp-formula">Eq. 3</xref>, the system is propagated in time using the dynamics of <xref rid="E2" ref-type="disp-formula">Eq.2</xref>, effectively simulating diffusion of transcripts within the tissue, that is:
<disp-formula id="E4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>D</mml:mi><mml:mo>Δ</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Here, <italic toggle="yes">dt</italic> represents a small step in time. Values at the boundary (<inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo>∂</mml:mo><mml:mo>Ω</mml:mo></mml:mrow></mml:math></inline-formula>) of the domain (Ω), are updated by letting the Laplacian of a boundary point be equal to that of its nearest inner point.</p>
      <p>Furthermore, for any subset <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo><mml:mo>⊆</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:math></inline-formula>, we define the entropy (<inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>) as:
<disp-formula id="E5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:munder><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>u</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>·</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>u</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
 <disp-formula id="E6"><label>(6)</label><mml:math id="M6" display="block" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>u</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mi>S</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:munder><mml:mi>u</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>The system is considered converged when the average change in entropy, taken over the set of inner points (<italic toggle="yes">S<sub>i</sub></italic>), between two consecutive time steps is below a certain threshold (<italic toggle="yes">ϵ</italic>). The time at which convergence occurs is referred to as the <italic toggle="yes">diffusion time</italic> (<italic toggle="yes">t<sub>d</sub></italic>), hence:
<disp-formula id="E7"><label>(7)</label><mml:math id="M7" display="block" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>&lt;</mml:mo><mml:mo>ϵ</mml:mo><mml:mo>×</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi mathvariant="normal">i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>The diffusion time serves as the metric by which we rank transcript profiles; high diffusion times are indicative of an organized spatial distribution. When presented, diffusion times are minmax normalized (subtraction of the smallest value and division by the range), meaning the largest value for any sample will be 1 and the smallest 0.</p>
    </sec>
    <sec>
      <title>2.3 Normalization</title>
      <p>Unless stated otherwise, expression vectors with raw values (<inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>) of a given gene <italic toggle="yes">g</italic> are converted into normalized values (<inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>). This occurs by first applying a log (base 2) transformation with a pseudocount <italic toggle="yes">c</italic>, to emphasize relative changes in the expression rather than absolute ones. The log transformed values are then mapped to the unit interval (<inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>) through division with the vector’s largest element:
<disp-formula id="E8"><label>(8)</label><mml:math id="M8" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">y</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>g</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mi>g</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
 <disp-formula id="E9"><label>(9)</label><mml:math id="M9" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>g</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>max</mml:mi><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">y</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>g</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:mfrac><mml:mo>×</mml:mo><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mi>g</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>The <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mi>max</mml:mi></mml:mrow></mml:math></inline-formula> functions are both applied elementwise. The recommended value for <italic toggle="yes">c</italic> is 2, as this is more robust toward sparse non-structured transcript profiles than 1, but the user is free to choose any positive number in our implementation. The default pseudocount is set to 2, in contrast to the common value of 1; this is to dampen the negative effects the presence of sparse transcript profiles may have on the results. Sparse profiles, having few non-zero observations, tend to require a long time to reach a homogeneous state (i.e. to converge) despite the lack of any initial non-random spatial structure, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S2</xref>.5. This is due to the artificially large gradients, that are introduced when most non-zero observations are surrounded by zero observations, an issue that becomes less prominent with a larger pseudocount.</p>
    </sec>
    <sec>
      <title>2.4 Selection of top profiles</title>
      <p>Our method assigns a rank to each transcript profile and by design do not operate with notions of significance or similar metrics. As a consequence, no dichotomization into groups of profiles with or without spatial patterns occurs. Still if such a partition is desired—e.g. for downstream analysis—we recommend the user to inspect the top-ranked profiles and set a suitable rank-cutoff (e.g. top 100) based on this. We have also implemented a simple heuristic approach that automatically will select a number of transcript profiles with distinct spatial patterns, as might be desirable in a larger analysis workflow, for more details see Supplementary S2.2. The heuristic is designed to be conservative, rather excluding profiles that exhibit some spatial structure than including those with weak or no spatial pattern.</p>
    </sec>
    <sec>
      <title>2.5 Pattern families</title>
      <p>Once a set of transcript profiles with organized patterns have been identified, we may ask which biological processes that drive these formations, i.e. what makes transcripts organize as observed. top-ranked transcript profiles could be examined individually, but to provide a more holistic representation of the results we suggest a procedure to group transcript profiles into different groups where elements display similar spatial structures. We will refer to these groups as <italic toggle="yes">pattern families</italic>. If the pattern families are subjected to functional enrichment analysis the biological processes associated with them, and indirectly the spatial structure they adhere to, may be identified. The procedure we suggest draws inspiration from the use of eigenfaces in facial recognition applications (<xref rid="btab164-B20" ref-type="bibr">Turk and Pentland, 1991</xref>).</p>
      <p>First, <italic toggle="yes">T</italic> top genes (w.r.t. diffusion time) are selected, a cutoff implemented to prevent profiles with spurious spatial distributions from convoluting the analysis. We normalize expression levels within a capture location by the sum of all observations in said location (library size normalization). Next, principal component analysis (PCA) is applied to the selected top transcript profiles, from this the <italic toggle="yes">k</italic> components that explain <italic toggle="yes">p</italic> percent of the variance—computed from the eigenvalues—are used as basis vectors for a <italic toggle="yes">k</italic>-dimensional subspace.</p>
      <p>The extracted basis vectors could be considered as <italic toggle="yes">eigenpatterns</italic>, from which the spatial transcript profiles can be assembled. In a final step, the transcript profiles are projected onto the eigenpattern subspace (spanned by the top principal components) and assorted into <italic toggle="yes">k</italic> families by agglomerative clustering, see Supplementary Section S2.3. We let the angle between the projections figure as our metric of distance. Hence, the similarity in composition of eigenpatterns is what determines the relation between expression profiles, and as a consequence, the members of each family. Representative motifs for the families are obtained by combining the eigenpatterns according to the average loadings (contributions) among the members.</p>
    </sec>
    <sec>
      <title>2.6 Synthetic data</title>
      <p>We devised two procedures to construct sets of synthetic spatial transcriptomics data, used in the assessment of our method’s performance. We refer to products from each approach as <italic toggle="yes">mixed</italic> and <italic toggle="yes">ablation</italic> sets respectively; the former being a mixture of profiles with different spatial patterns together with randomly shuffled variants of these, while the latter consist of gradually perturbed versions of a single profile.</p>
      <sec>
        <title>2.6.1 Mixed sets</title>
        <p>Let <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mi mathvariant="script">P</mml:mi></mml:math></inline-formula> be a set of spatial expression data, where each member represents the observed expression from a given gene over <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>S</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> locations. If all members of <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mi mathvariant="script">P</mml:mi></mml:math></inline-formula> exhibit a spatial pattern, it’s suitable as a <italic toggle="yes">seed</italic> to generate a larger mixed set <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mi mathvariant="script">W</mml:mi></mml:math></inline-formula>. The mixed set is constructed by the following procedure: Each expression vector in <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mi mathvariant="script">P</mml:mi></mml:math></inline-formula> (<inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>) will be multiplied with a multiplier (<italic toggle="yes">m<sub>j</sub></italic>) to augment different expression levels (<bold><italic toggle="yes">w</italic></bold>) followed by a permutation (rearrangement), a procedure repeated <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mtext>offspring</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> times. Since element <italic toggle="yes">s</italic> of <bold><italic toggle="yes">w</italic></bold> is associated to the coordinate pair (<italic toggle="yes">x<sub>s</sub></italic>, <italic toggle="yes">y<sub>s</sub></italic>), the permutation effectively reorganizes the expression signals in space, what we refer to as <italic toggle="yes">shuffling</italic>. Furthermore, if <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="script">P</mml:mi></mml:mrow></mml:math></inline-formula> was used to generate <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="script">W</mml:mi></mml:mrow></mml:math></inline-formula>, we denote <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> as a parent profile and consider <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> its ‘offspring’. Mixed sets are useful to assess a method’s ability to distinguish transcript profiles with clear spatial structure from those of more random character. Any method that identifies spatial expression patterns should rank the offsprings as less spatially structured than their parent patterns.</p>
        <p>
          <boxed-text id="btab164-BOX1" position="float">
            <sec>
              <title><bold>Algorithm 1:</bold> Assembly of mixed set</title>
              <p>Let <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mi mathvariant="script">M</mml:mi></mml:math></inline-formula> be a set of (positive) multiples;</p>
              <p>Let the vector <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> represent the <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula> member of <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mi mathvariant="script">P</mml:mi></mml:math></inline-formula>;</p>
              <p>Let the mutltiple <italic toggle="yes">m<sub>j</sub></italic> represent the <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:mi>j</mml:mi><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:math></inline-formula> member of <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mi mathvariant="script">M</mml:mi></mml:math></inline-formula>;</p>
              <p>Let <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mi mathvariant="script">W</mml:mi></mml:math></inline-formula> = <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mo>∅</mml:mo></mml:math></inline-formula>;</p>
              <p><bold>for</bold>  <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>←</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>  <bold>to</bold>  <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">P</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>  <bold>do</bold>  <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">W</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="script">W</mml:mi><mml:mo>∪</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>; <bold>for</bold>  <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:mi>j</mml:mi><mml:mo>←</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>  <bold>to</bold>  <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi mathvariant="script">M</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>  <bold>do</bold> <bold>for</bold>  <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>←</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>  <bold>to</bold>  <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">offspring</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>  <bold>do</bold>  <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>*</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> Randomly Shuffle <bold><italic toggle="yes">w</italic></bold>;
<disp-formula id="E10"><mml:math id="M10" display="block" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">W</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="script">W</mml:mi><mml:mo>∪</mml:mo><mml:mo>{</mml:mo><mml:mi mathvariant="bold-italic">w</mml:mi><mml:mo>};</mml:mo></mml:mrow></mml:math></disp-formula></p>
              <p>  <bold>end</bold> <bold>end end</bold></p>
            </sec>
          </boxed-text>
        </p>
      </sec>
      <sec>
        <title>2.6.2 Ablation sets</title>
        <p>In contrast to the mixed sets, which utilize multiple spatial patterns during construction, each ablation set originates from a single transcript profile. This profile is gradually perturbed by shuffling an increased number of observations, forming a sequence of expression data with an innate internal rank w.r.t spatial structure. While the mixed sets offer insights into how methods treat a collection of different spatial patterns in the presence of profiles with no structure, the ablation sets allow us to gauge whether a method can differentiate between different degrees of spatial structure. To clarify, methods devised to rank or identify spatial patterns should ideally assign higher ranks or more significant values to members of the set with a low amount of deformation (few shuffled observations).</p>
      </sec>
      <sec>
        <title>2.6.3 Seeding sets</title>
        <p>Two different approaches were used to construct seeding sets, one image-based and the other utilizing simulation of Turing patterns. The image-based method takes a black and white image as input, where white regions represent areas of elevated expression (forming a spatial pattern). The second method generates (Turing) patterns by propagating a dynamic system in time, using random initial values, see Supplementary Section S2.4. By using these two seeding sets we aim to demonstrate our method’s performance both with profiles that we have crafted and subjectively consider as structured, as well as those produced by a stochastic process.</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>Our method was first applied to synthetic data to confirm expected performance, followed by analysis of real data. The mode of visualization is the same for all sets of data, real and synthetic; a capture location is plotted with the expression levels indicated by facecolor. The signal values are log transformed (base 2) with pseudocount 2, consistent with the normalization applied upon analysis. See Supplementary Section S4 for analysis parameters. Colors are scaled internally within each profile, to emphasize spatial structures.</p>
    <sec>
      <title>3.1 Synthetic data</title>
      <p>Two mixed sets of synthetic data were constructed, <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. Ten hand-drawn black and white images were used to generate the seeding set (<inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>) for <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S3</xref>.1. For <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, the seeding set (<inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>) consisted of 10 simulated Turing patterns, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S8</xref>. For both sets, we let <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mtext>offspring</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="script">M</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>0.5</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. Thus, each mixed set consisted of 100 transcript profiles, with 10 of these exhibiting distinct spatial structure. Parameters for Turing pattern generation and images used to construct <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are found in Supplementary Section S3.</p>
      <p>For both sets (<inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>), the 10 parent expression profiles with true spatial patterns were assigned higher rank by our method than all of the offsprings, each event having a probability of <inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>10</mml:mn><mml:mo>!</mml:mo><mml:mn>90</mml:mn><mml:mo>!</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mn>100</mml:mn><mml:mo>!</mml:mo><mml:mo>≈</mml:mo><mml:mn>5.78</mml:mn><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>14</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> to occur by chance. Parts of the results are illustrated in <xref rid="btab164-F1" ref-type="fig">Figure 1</xref> where the top 25 expression profiles are given for each set, see Supplementary Figures S9 and S10 for complete results.</p>
      <fig position="float" id="btab164-F1">
        <label>Fig. 1.</label>
        <caption>
          <p>Top: The mixed sets <inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> (Mixed 1) and <inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">W</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> (Mixed 2) sorted by each member’s diffusion time (order indicated in rightmost picture). Only the top 25 synthetic transcript profiles are shown. Bottom: Ablation sets <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE55"><mml:math id="IM55" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> sorted by diffusion times. Normalized diffusion times are given as <italic toggle="yes">t<sub>d</sub></italic>. Bottom bar indicates the number of shuffled capture locations, i.e. the extent of the perturbation</p>
        </caption>
        <graphic xlink:href="btab164f1" position="float"/>
      </fig>
      <p>We also generated 10 ablation sets (<inline-formula id="IE56"><mml:math id="IM56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to <inline-formula id="IE57"><mml:math id="IM57" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>), one from each of the spatial patterns in <inline-formula id="IE58"><mml:math id="IM58" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">P</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. These ablation sets have 4 different degrees of perturbation—the number of shuffled observations at each stage being <inline-formula id="IE59"><mml:math id="IM59" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>100</mml:mn><mml:mo>,</mml:mo><mml:mn>500</mml:mn><mml:mo>,</mml:mo><mml:mn>900</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>. For all 10 sets, members were ranked in the correct order, an event with a probability of <inline-formula id="IE60"><mml:math id="IM60" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>4</mml:mn><mml:mo>!</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:msup><mml:mo>≈</mml:mo><mml:mn>1.58</mml:mn><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>14</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> to occur by chance. Results from three of the ablation sets (<inline-formula id="IE61"><mml:math id="IM61" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to <inline-formula id="IE62"><mml:math id="IM62" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>), are presented in <xref rid="btab164-F1" ref-type="fig">Figure 1</xref>. See Supplementary Figures S11 and S12 for complete results. Raw synthetic data and results are found in <xref rid="sup1" ref-type="supplementary-material">Supplementary Data</xref> S1.</p>
    </sec>
    <sec>
      <title>3.2 Real data</title>
      <p>We applied the method to real spatial transcriptomics data from five different types of tissue: mouse olfactory bulb or MOB (1k ST array), mouse brain (Visium), human lymph node (Visium), human melanoma (1k ST array) and mouse cerebellum (Slide-seq). Results from the Slide-seq data are available in Supplementary Section S5.8, illustrating how the method can be generalized to unstructured spatial data. Ribosomal and mitochondrial filtering was used in all analyses (see Supplementary Section S4.1), additional basic quality filtering was also applied to the expression data (see Supplementary Sections S1 and S4).</p>
      <p><xref rid="btab164-F2" ref-type="fig">Figure 2</xref> shows excerpts from the top 20 ranked transcript profiles, taken from each sample. Visualization of the top ranked profiles for all analyzed samples are available in Supplementary, complete results for all real sets are found in <xref rid="sup1" ref-type="supplementary-material">Supplementary Data</xref> S1. When the trancription profiles were examined along the ‘ranking-gradient’ (from top-ranked to bottom ranked) they clearly showed an increasingly random character, see <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S13</xref> for an example.</p>
      <fig position="float" id="btab164-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Excerpts from the set of top 20 ranked transcript profiles of each sample. Normalized diffusion times are given as <italic toggle="yes">t<sub>d</sub></italic>. H&amp;E-images (Hematoxylin and Eosine) of each sample are provided as references. transcript profiles are represented by coloring the spatial location according to the normalized expression levels; low values are black, high values are bright. Annotated pattern families for the melanoma sample (blue dashed box) are presented with three members of each family. We include the pathologist’s annotations from the original paper, where black: melanoma, red: stroma and yellow: lymphoid tissue</p>
        </caption>
        <graphic xlink:href="btab164f2" position="float"/>
      </fig>
      <p>We were interested in whether the top-ranked transcript profiles had any biological relevance, and therefore decided to examine some of them more thoroughly. As expected, we found that these profiles often represented marker genes of certain cell types, or genes involved in important biological pathways. To exemplify: <italic toggle="yes">Prokr2</italic> is indicative of immature interneurons that have migrated from the subventricular zone to the olfactory bulb (<xref rid="btab164-B11" ref-type="bibr">Puverel <italic toggle="yes">et al.</italic>, 2009</xref>; Wen <xref rid="btab164-B22" ref-type="bibr"><italic toggle="yes">et al.</italic>, 2019</xref>); <italic toggle="yes">Omp</italic> is a marker gene for olfactory sensory neurons (<xref rid="btab164-B15" ref-type="bibr">Shiao <italic toggle="yes">et al.</italic>, 2012</xref>); <italic toggle="yes">Pmch</italic> is a marker gene for a small population of neurons populating the lateral hypotalamic area of mice, observed to have influence on the animal’s behavior (<xref rid="btab164-B9" ref-type="bibr">Mickelsen <italic toggle="yes">et al.</italic>, 2019</xref>); <italic toggle="yes">Slc30a3</italic> encodes a zinc transporter protein (ZNT3) found in zinc-secreting neurons and, in addition to other pathways, is involved in communication between granule and pyramidal cells (<xref rid="btab164-B3" ref-type="bibr">Henze <italic toggle="yes">et al.</italic>, 2000</xref>; <xref rid="btab164-B8" ref-type="bibr">Linkous <italic toggle="yes">et al.</italic>, 2008</xref>); <italic toggle="yes">CXCL13</italic> is a chemokine targeting B-cells, and is known to be essential for the formation of lymph nodes (<xref rid="btab164-B21" ref-type="bibr">van de Pavert <italic toggle="yes">et al.</italic>, 2009</xref>); <italic toggle="yes">CR2</italic> encodes a receptor that partake in the complement system, and is known to be expressed by follicular dendritic cells located in lymph nodes (<xref rid="btab164-B7" ref-type="bibr">Kranich and Krautler, 2016</xref>).The set of top-ranked transcript profiles in the mouse brain was compared to those listed as highly variable by a common variance metric, see Supplementary Section S5.5.1. Several of the top 100 highest ranked profiles, exhibiting distinct spatial structures, were absent from the set of 1000 most variable ones, demonstrating the value of using ‘spatially-aware’ methods.</p>
      <p>Several of the top-ranked transcript profiles in the melanoma sample appear to be associated with the disease, but were not mentioned in the original publication (<xref rid="btab164-B19" ref-type="bibr">Thrane <italic toggle="yes">et al.</italic>, 2018</xref>). Examples of such genes are: <italic toggle="yes">RNASET2</italic>, a known tumor antagonist in melanoma (<xref rid="btab164-B10" ref-type="bibr">Monti <italic toggle="yes">et al.</italic>, 2008</xref>); and <italic toggle="yes">FCRL1</italic>, encoding a glycoprotein linked to the disease’s progression (<xref rid="btab164-B6" ref-type="bibr">Koh <italic toggle="yes">et al.</italic>, 2012</xref>). Both these genes were abundant in regions annotated as lymphoid tissue. In comparison, transcripts of <italic toggle="yes">MLANA</italic> [an established marker of melanoma with prognostic properties (<xref rid="btab164-B13" ref-type="bibr">Reid <italic toggle="yes">et al.</italic>, 2013</xref>)], were more prevalent in the cancerous region.</p>
      <p>To further assess which biological processes that could be ascribed to the patterns we observed, the 150 transcript profiles with highest rank in the melanoma sample were assorted into pattern families. A total of four pattern families were identified and subjected to functional enrichment analysis; using <italic toggle="yes">g: Profiler</italic> and querying against the GO: BP (Gene Ontology, Biological Processes) database (<xref rid="btab164-B12" ref-type="bibr">Raudvere <italic toggle="yes">et al.</italic>, 2019</xref>). The complete list of enriched processes can be found in Supplementary S5.7 together with visualization of the four families and their representative motifs. Family 1 was enriched for multiple processes related to cell growth and differentiation; this in conjunction with multiple genes in the family being directly associated to melanoma led us to annotate it as ‘melanoma related’. This is also in concordance with the annotations provided by the pathologist (given in the original publication). Family 2 and 4 were enriched for immune response related pathways; the former had more general processes of cell activation (lymphocyte and leukocyte) and regulation associated with it, while specific immunoglobulin related processes were listed for the latter; we annotated both these as immune response related families (with identifiers I and II respectively). Family 3 was enriched for collagen constituents, processes involved in collagen organization, and platlet activation, hence its annotation as ‘ECM (Extracellular Matrix) related’. Evidently, not every biological process present in the tissue sample can be expected to have an associated spatial pattern, but this approach illustrates how certain functionality can be linked to spatial patterns we observe in the data.</p>
      <p>The landscape of methods to find expression profiles with spatial patterns may be sparsely populated, but alternative methods to ours do exists. Two examples of such methods are SpatialDE and SPARK (<xref rid="btab164-B17" ref-type="bibr">Sun <italic toggle="yes">et al.</italic>, 2020</xref>; Svensson <xref rid="btab164-B18" ref-type="bibr"><italic toggle="yes">et al.</italic>, 2018</xref>); which both rely on hypothesis testing to produce sets of genes with statistically significant spatial patterns. Thus, we were interested in how our approach compared to these alternative and fundamentally different methods. The MOB sample included in our study, was also examined in the publication of SpatialDE as well as that of SPARK, hence it was a natural choice for the comparison. The result from applying SpatialDE to this particular sample was downloaded from its associated GitHub repository. Similarly for SPARK, code to reproduce the MOB analysis was available at its repository; we executed these scripts without any modifications (see Supplementary S4.4). For the alternative methods we used statistical significance as a rank metric; the more significant, the higher the rank. The top 20 ranked expression profiles from each method were inspected (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S26 and S27</xref>), by doing so we noted that all methods successfully presented transcript profiles with organized spatial patterns. However, the top profiles of SpatialDE and SPARK both included genes that were relatively homogeneously expressed over the tissue (e.g. <italic toggle="yes">Apoe, Sparcl1</italic> and <italic toggle="yes">Glul</italic>), not present among the top transcript profiles of our method. Next, aware of how genes with high expression levels tend to overlap with those exhibiting structured spatial arrangement, we asked how prevalent this phenomena was in the result from respective method. This is of relevance because; if expression levels is what informs the ranking, the identified expression profiles could just as well be obtained from sorting the genes w.r.t to expression levels. We addressed this question by computing the Spearman (<italic toggle="yes">ρ</italic>) correlation between the metric by which profiles were ranked and the total observed counts of the genes, see Supplementary Section S4.4. The magnitude (absolute value) of the correlation was lowest in our method (<inline-formula id="IE63"><mml:math id="IM63" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mo>ρ</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mn>0.1399</mml:mn></mml:mrow></mml:math></inline-formula>), about half that of SPARK (<inline-formula id="IE64"><mml:math id="IM64" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mo>ρ</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mn>0.2576</mml:mn></mml:mrow></mml:math></inline-formula>) and somewhat lower than SpatialDE (<inline-formula id="IE65"><mml:math id="IM65" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mo>ρ</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mn>0.1877</mml:mn></mml:mrow></mml:math></inline-formula>), see <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S4</xref>. This suggests that our method is less dependent on expression levels when ranking transcript profiles compared to alternative methods.</p>
      <p>To better understand what qualitatively differentiates our method from the others, we examined transcript profiles uniquely identified in respective method as well as those listed by both SPARK and SpatialDE but not ours, see Supplementary Figs. S29–S32. What can be discerned from this analysis is how our method favors transcript profiles with a pronounced contrast between pattern and background, an immediate consequence of its design. This allows it to detect irregular and ‘thin’ patterns that the other methods might overlook (e.g. <italic toggle="yes">Sox11</italic>), but also makes it less appropriate for cases where small discrepancies between pattern and background is expected (e.g. <italic toggle="yes">Calm2</italic> and <italic toggle="yes">Synpr</italic>).</p>
      <p>We also compared performance (with respect to runtime) of the three aforementioned methods using 1–4 CPU cores. When analyzing the MOB sample, our method was faster than both SpatialDE and SPARK in all instances except one; being when a single core was used, in this case SpatialDE completed the analysis faster than <italic toggle="yes">sepal</italic>, for more details see Supplementary Section S5.10.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>We have developed a theoretical model for unsupervised identification of transcript profiles that exhibit spatial patterns, in response to the emerging need to separate relevant spatial signals from noise. The model is implemented in Python and released as an open-source tool, <italic toggle="yes">sepal</italic>, with support for data originating from multiple platforms and modules for additional analysis. We base the method on numerical simulation of transcripts diffusing within the tissue, using Fick’s second law. Like any method that operates with patterns of individual transcript profiles, ours do not require interpretation of abstract entities such as clusters or factors. Still, the diffusion-based approach we present stands in contrast to previous methods, where characterization of the spatial distribution and hypothesis testing tend to figure as core concepts. In short, we present a novel theoretical framework with high interpretability that enables unsupervised exploratory examination of large sets of data. The method performed well on multiple synthetic and real datasets. Spatial expression patterns were ranked higher than all their related random patterns (as desired), both when generated from hand-drawn images as well as simulated Turing patterns. Members of the 10 ablation sets—where we perform a gradual deformation of structured spatial transcript profiles—were also ranked in the expected order. Analysis of real data from different tissue types and techniques, resulted in a set of transcript profiles with clear spatial patterns and biological relevance. Our method is an important complement to techniques where analysis relies on more abstract or coarse entities such as factors and clusters, since attention is brought to genes with structured spatial arrangements which otherwise might be overlooked. When compared to other existing methods designed for the same purpose, ours were equally capable of finding expression profiles with spatial patterns, but seems to be less driven by the extent to which a gene is expressed and rather by its spatial organization. A procedure to group genes with similar spatial expression profiles into pattern families is also suggested and included as an analysis module in our implementation. Aggregating profiles into pattern families and subjecting them to enrichment analysis may lead to functional annotation of spatial regions, as illustrated by our study of the melanoma sample, and understanding of how certain biological pathways propagate through the tissue. Previous methods have also grouped genes by clustering them based on expression levels, however these do not make use of the intermediary space of eigenpatterns that we propose. Since <italic toggle="yes">sepal</italic> operates by ranking profiles, the presence of a few dominant patterns may quench other, less strong, but still relevant patterns. We see such tendencies in the mouse brain sample, where several of the top transcript profiles share a similar structure. Sorting the expression profiles into patterns families can to some extent mitigate this issue, but it is an inherent feature of the method’s design that should be acknowledged. While the method has been developed for and demonstrated with gene expression data, it could in theory be generalized to any type of data where measurements or inferred values are associated with given spatial positions; one relevant example of this being cell type identities. We consider the initial exploratory phases spatial transcriptomics studies as those where <italic toggle="yes">sepal</italic> can bring most value; guiding the user toward genes worth pursuing for further analysis. <italic toggle="yes">sepal</italic> is available as a Python package at GitHub (<ext-link xlink:href="https://github.com/almaan/sepal" ext-link-type="uri">https://github.com/almaan/sepal</ext-link>), together with documentation, tutorials and all scripts used to produce the material in this paper.</p>
    <p><italic toggle="yes">Financial Support</italic>: none declared.</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btab164_Supplementary_Data</label>
      <media xlink:href="btab164_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>A.A. wrote the manuscript, developed the method and implemented it in code; J.L. supervised the work. The authors thank Lovisa Franzén, Phil Ewels, Kim Thrane and Pelin Sahlén all who provided insightful comments and feedback on the manuscript, they were immensely grateful for this. Appreciation is also directed toward the reviewers who scrutinized the manuscript carefully and gave valuable feedback. Finally, this work was enabled by support from the Knut and Alice Wallenberg (KAW) Foundation, Erling-Persson Family Foundation, the Swedish Cancer Society, Foundation for Strategic Research (SSF), Science for Life Laboratory and the Swedish Research Council.</p>
    <p><italic toggle="yes">Conflict of Interest:</italic> A.A. and J.L. are scientific consultants for 10x Genomics Inc., providing spatially barcoded slides.</p>
    <sec sec-type="data-availability">
      <title>Data availability</title>
      <p>All data used in this manuscript is publicly available, and we refer to the original publications/sources for further instructions on how to access the original data sets. We also provide processed data sets in the (to this manuscript) associated GitHub repository, <ext-link xlink:href="https://github.com/almaan/sepal" ext-link-type="uri">https://github.com/almaan/sepal</ext-link>, where the synthetic data used for evalauation is included as well.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btab164-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Asp</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) 
<article-title>Spatially resolved transcriptomes—next generation tools for tissue exploration</article-title>. <source>BioEssays</source>, <volume>42</volume>, <fpage>1900221</fpage>.</mixed-citation>
    </ref>
    <ref id="btab164-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Edsgärd</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) 
<article-title>Identification of spatial expression trends in single-cell gene expression data</article-title>. <source>Neuron</source>, <volume>15</volume>, <fpage>339</fpage>–<lpage>342</lpage>.</mixed-citation>
    </ref>
    <ref id="btab164-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Henze</surname><given-names>D.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2000</year>) 
<article-title>The multifarious hippocampal mossy fiber pathway: a review</article-title>. <source>Neuroscience</source>, <volume>98</volume>, <fpage>407</fpage>–<lpage>427</lpage>.<pub-id pub-id-type="pmid">10869836</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B4">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Kantorovich</surname><given-names>L.V.</given-names></string-name></person-group> (<year>2018</year>) <source>Approximate Methods of Higher Analysis</source>. 
<publisher-name>Dover Publications, Inc</publisher-name>., 
<publisher-loc>Garden City, NY</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btab164-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ke</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) 
<article-title>In situ sequencing for RNA analysis in preserved tissue and cells</article-title>. <source>Nat. Methods</source>, <volume>10</volume>, <fpage>857</fpage>–<lpage>860</lpage>.<pub-id pub-id-type="pmid">23852452</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Koh</surname><given-names>S.S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) 
<article-title>Differential gene expression profiling of primary cutaneous melanoma and sentinel lymph node metastases</article-title>. <source>Mod. Pathol</source>., <volume>25</volume>, <fpage>828</fpage>–<lpage>837</lpage>.<pub-id pub-id-type="pmid">22411186</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kranich</surname><given-names>J.</given-names></string-name>, <string-name><surname>Krautler</surname><given-names>N.J.</given-names></string-name></person-group> (<year>2016</year>) 
<article-title>How follicular dendritic cells shape the b-cell antigenome</article-title>. <source>eCollection</source>, <volume>7</volume>, <fpage>225</fpage>.</mixed-citation>
    </ref>
    <ref id="btab164-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Linkous</surname><given-names>D.H.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) 
<article-title>Evidence that the ZNT3 protein controls the total amount of elemental zinc in synaptic vesicles</article-title>. <source>J. Histochem. Cytochem</source>., <volume>56</volume>, <fpage>3</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">17712179</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mickelsen</surname><given-names>L.E.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) 
<article-title>Single-cell transcriptomic analysis of the lateral hypothalamic area reveals molecularly distinct populations of inhibitory and excitatory neurons</article-title>. <source>Nat. Neurosci</source>., <volume>22</volume>, <fpage>642</fpage>–<lpage>656</lpage>.<pub-id pub-id-type="pmid">30858605</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Monti</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>) 
<article-title>RNASET2 as a tumor antagonizing gene in a melanoma cancer model</article-title>. <source>Oncol. Res</source>., <volume>17</volume>, <fpage>69</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">18543608</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Puverel</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2009</year>) 
<article-title>Prokineticin receptor 2 expression identifies migrating neuroblasts and their subventricular zone transient-amplifying progenitors in adult mice</article-title>. <source>J. Comparative Neurol</source>., <volume>512</volume>, <fpage>232</fpage>–<lpage>242</lpage>.</mixed-citation>
    </ref>
    <ref id="btab164-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Raudvere</surname><given-names>U.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) 
<article-title>g:profiler: a web server for functional enrichment analysis and conversions of gene lists (2019 update)</article-title>. <source>Nucleic Acids Res</source>., <volume>47</volume>, <fpage>W191</fpage>–<lpage>W198</lpage>.<pub-id pub-id-type="pmid">31066453</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Reid</surname><given-names>A.L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) 
<article-title>Markers of circulating tumour cells in the peripheral blood of patients with melanoma correlate with disease recurrence and progression</article-title>. <source>Br. J. Dermatol</source>., <volume>168</volume>, <fpage>85</fpage>–<lpage>92</lpage>.<pub-id pub-id-type="pmid">23013138</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rodriques</surname><given-names>S.G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) 
<article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>. <source>Science</source>, <volume>363</volume>, <fpage>1463</fpage>–<lpage>1467</lpage>.<pub-id pub-id-type="pmid">30923225</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shiao</surname><given-names>M.-S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) 
<article-title>Transcriptomes of mouse olfactory epithelium reveal sexual differences in odorant detection</article-title>. <source>Genome Biol. Evol</source>., <volume>4</volume>, <fpage>703</fpage>–<lpage>712</lpage>.<pub-id pub-id-type="pmid">22511034</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ståhl</surname><given-names>P.L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) 
<article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>. <source>Science</source>, <volume>353</volume>, <fpage>78</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">27365449</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sun</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) 
<article-title>Statistical analysis of spatial expression patterns for spatially resolved transcriptomic studies</article-title>. <source>Nat. Methods</source>, <volume>17</volume>, <fpage>193</fpage>–<lpage>200</lpage>.<pub-id pub-id-type="pmid">31988518</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Svensson</surname><given-names>V.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) 
<article-title>SpatialDE: identification of spatially variable genes</article-title>. <source>Nat. Methods</source>, <volume>15</volume>, <fpage>343</fpage>–<lpage>346</lpage>.<pub-id pub-id-type="pmid">29553579</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B19">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Thrane</surname><given-names>K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) 
<article-title>Spatially resolved transcriptomics enables dissection of genetic heterogeneity in stage III cutaneous malignant melanoma</article-title>.<italic toggle="yes">Cancer Res</italic>., <bold>78</bold>, 5970-5979</mixed-citation>
    </ref>
    <ref id="btab164-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Turk</surname><given-names>M.</given-names></string-name>, <string-name><surname>Pentland</surname><given-names>A.</given-names></string-name></person-group> (<year>1991</year>) 
<article-title>Eigenfaces for recognition</article-title>. <source>J. Cognitive Neurosci</source>., <volume>3</volume>, <fpage>71</fpage>–<lpage>86</lpage>.</mixed-citation>
    </ref>
    <ref id="btab164-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>van de Pavert</surname><given-names>S.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2009</year>) 
<article-title>Chemokine CXCL13 is essential for lymph node initiation and is induced by retinoic acid and neuronal stimulation</article-title>. <source>Nat. Immunol</source>., <volume>10</volume>, <fpage>1193</fpage>–<lpage>1199</lpage>.<pub-id pub-id-type="pmid">19783990</pub-id></mixed-citation>
    </ref>
    <ref id="btab164-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wen</surname><given-names>Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) 
<article-title>The PROK2/PROKR2 signaling pathway is required for the migration of most olfactory bulb interneurons</article-title>. <source>J. Comput. Neurol</source>., <volume>527</volume>, <fpage>2931</fpage>–<lpage>2947</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
