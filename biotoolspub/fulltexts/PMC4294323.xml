<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Acta Crystallogr C Struct Chem</journal-id>
    <journal-id journal-id-type="iso-abbrev">Acta Crystallogr C Struct Chem</journal-id>
    <journal-id journal-id-type="publisher-id">Acta Cryst. C</journal-id>
    <journal-title-group>
      <journal-title>Acta Crystallographica. Section C, Structural Chemistry</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2053-2296</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4294323</article-id>
    <article-id pub-id-type="pmid">25567568</article-id>
    <article-id pub-id-type="publisher-id">fa3356</article-id>
    <article-id pub-id-type="doi">10.1107/S2053229614024218</article-id>
    <article-id pub-id-type="coden">ACSCGG</article-id>
    <article-id pub-id-type="pii">S2053229614024218</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Feature Articles</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Crystal structure refinement with <italic>SHELXL</italic>
</article-title>
      <alt-title>
        <italic>SHELXL</italic>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Sheldrick</surname>
          <given-names>George M.</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <aff id="a"><label>a</label>Department of Structural Chemistry, Georg-August Universität Göttingen, Tammannstraße 4, Göttingen 37077, <country>Germany</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>gsheldr@shelx.uni-ac.gwdg.de</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>1</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>01</day>
      <month>1</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>01</day>
      <month>1</month>
      <year>2015</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>71</volume>
    <issue>Pt 1</issue>
    <issue-id pub-id-type="publisher-id">c150100</issue-id>
    <fpage>3</fpage>
    <lpage>8</lpage>
    <history>
      <date date-type="received">
        <day>21</day>
        <month>10</month>
        <year>2014</year>
      </date>
      <date date-type="accepted">
        <day>02</day>
        <month>11</month>
        <year>2014</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© G. M. Sheldrick 2015</copyright-statement>
      <copyright-year>2015</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0/uk/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution Licence, which permits
unrestricted use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:type="simple" xlink:href="http://dx.doi.org/10.1107/S2053229614024218">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p>New features added to the refinement program <italic>SHELXL</italic> since 2008 are described and explained.</p>
    </abstract>
    <abstract>
      <p>The improvements in the crystal structure refinement program <italic>SHELXL</italic> have been closely coupled with the development and increasing importance of the CIF (Crystallographic Information Framework) format for validating and archiving crystal structures. An important simplification is that now only one file in CIF format (for convenience, referred to simply as ‘a CIF’) containing embedded reflection data and <italic>SHELXL</italic> instructions is needed for a complete structure archive; the program <italic>SHREDCIF</italic> can be used to extract the <monospace>.hkl</monospace> and <monospace>.ins</monospace> files required for further refinement with <italic>SHELXL</italic>. Recent developments in <italic>SHELXL</italic> facilitate refinement against neutron diffraction data, the treatment of H atoms, the determination of absolute structure, the input of partial structure factors and the refinement of twinned and disordered structures. <italic>SHELXL</italic> is available free to academics for the Windows, Linux and Mac OS X operating systems, and is particularly suitable for multiple-core processors.</p>
    </abstract>
    <kwd-group>
      <kwd>
        <italic>SHELXL</italic>
      </kwd>
      <kwd>crystal structure refinement</kwd>
      <kwd>X-ray and neutron diffraction</kwd>
      <kwd>SHREDCIF</kwd>
    </kwd-group>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <title>Introduction   </title>
    <p>The first version of <italic>SHELX</italic> dates back to about 1970 and, after extensive testing, it was first released in 1976. Since then the program system has been developed continuously. The early history has been described by Sheldrick (2008<xref ref-type="bibr" rid="bb19"> ▶</xref>). The present paper is intended to explain the philosophical and crystallographic background to developments between 2008 and 2015 in <italic>SHELXL</italic>, the program in the <italic>SHELX</italic> system responsible for crystal structure refinement. Although <italic>SHELXL</italic> may also be used for the refinement of macromolecular structures against high-resolution data, most of the new developments have concentrated on the refinement of chemical structures, such as those published in <italic>Section C</italic> of <italic>Acta Crystallographica</italic>. Readers not familiar with <italic>SHELX</italic> may find it useful to look at Sheldrick (2008<xref ref-type="bibr" rid="bb19"> ▶</xref>) before reading this paper.</p>
    <p>A major change since 2008 is that the distribution is performed <italic>via</italic> the <italic>SHELX</italic> homepage (<ext-link ext-link-type="uri" xlink:href="http://shelx.uni-ac.gwdg.de/SHELX/">http://shelx.uni-ac.gwdg.de/SHELX/</ext-link>), which also provides a great deal of documentation, tutorials and other useful information. The programs are updated more frequently than in the past and the list of recent changes should be consulted regularly to see if it is necessary to download a new version. The homepage also contains a list of registered users (but not their email addresses); currently there are over 8000 spread over more than 80 countries. <italic>SHELX</italic> workshops are announced on the homepage, and many of the talks given at these workshops may be downloaded there. <italic>SHELXL</italic> is compiled with the Intel ifort FORTRAN compiler using the statically linked MKL library, and is available free to academics for the 32- or 64-bit Windows, 32- or 64-bit Linux and 64-bit Mac OS X operating systems. Multithreading is achieved using <italic>OpenMP</italic> along the lines suggested by Diederichs (2000<xref ref-type="bibr" rid="bb5"> ▶</xref>), and the program is particularly suitable for multiple-core processors.</p>
  </sec>
  <sec id="sec2">
    <title><italic>SHELXL</italic> and CIF format   </title>
    <sec id="sec2.1">
      <title>The importance of depositing crystallographic data   </title>
      <p>Although the IUCr journals have led the way in insisting that experimental crystallographic data should be deposited, several leading chemical journals still only require the deposition of a CIF (Hall <italic>et al.</italic>, 1991<xref ref-type="bibr" rid="bb10"> ▶</xref>) containing just the results of the crystal structure determination and not the X-ray or neutron reflection data used to determine the structure. In this respect, biological crystallographers are more advanced. The PDB (Protein Data Bank; Berman, 2008<xref ref-type="bibr" rid="bb1"> ▶</xref>) has required the deposition of reflection data since February 2008 and virtually all journals that report biological crystal structures, including high-profile journals such as <italic>Nature</italic> and <italic>Science,</italic> require a PDB ID for the structure. This has already had a considerable impact. For example, it has led to the retraction of several structures in which the data do not support the claim that a particular ligand was bound to a protein.</p>
      <p>One very recent example of the use of such deposited data (Köpfer <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb14"> ▶</xref>) can be mentioned here, since it involved the use of <italic>SHELXL</italic> to refine occupancies and obtain standard uncertainties for them. For over 50 years, the accepted model (Hodgkin &amp; Keynes, 1955<xref ref-type="bibr" rid="bb11"> ▶</xref>) for the potassium channel present in many living systems was that it involved the transport of both potassium ions and water molecules, based on the argument that adjacent binding sites could not be occupied by K<sup>+</sup> cations because they would repel one another, and so the intermediate sites must be occupied by water molecules. Several protein crystal structures were refined at modest resolution with alternating potassium ions and water molecules in the channel and appeared to support this model. However, to the authors’ credit, they deposited their reflection data, including the Friedel pairs, although that was not then obligatory. When sophisticated molecular dynamics (MD) calculations showed that only a model with adjacent K<sup>+</sup> cations could account, by a sort of knock-on effect, for the very high potassium permeability observed, it was necessary to reinvestigate the structure using the deposited X-ray reflection data. Both the occupancy refinements with <italic>SHELXL</italic> and the analysis of the anomalous data with <italic>SHELXD</italic> (Schneider &amp; Sheldrick, 2002<xref ref-type="bibr" rid="bb18"> ▶</xref>) and <italic>ANODE</italic> (Thorn &amp; Sheldrick, 2011<xref ref-type="bibr" rid="bb26"> ▶</xref>) showed conclusively that the four connected potassium sites are almost fully occupied, as predicted by the MD calculations.</p>
    </sec>
    <sec id="sec2.2">
      <title>Archiving crystallographic data   </title>
      <p>To make the deposition and archiving of reflection data as simple as possible, the CIF written by <italic>SHELXL</italic> now includes the <monospace>.hkl</monospace> reflection data file, embedded as CIF text:</p>
      <p>
        <monospace>_shelx_hkl_file</monospace>
      </p>
      <p>
        <monospace>;</monospace>
      </p>
      <p>
        <monospace>... reflection data in SHELX HKLF 2, 3, 4 or 5 format ...</monospace>
      </p>
      <p>
        <monospace>;</monospace>
      </p>
      <p>
        <monospace>_shelx_hkl_checksum 12345</monospace>
      </p>
      <p>The checksum provides a check that the data have not been corrupted accidentally. The <monospace>.res</monospace> results file from the refinement and the <monospace>.fab</monospace> file (see below), if used in the refinement, are embedded into the CIF in the same way. The <italic>SHELX</italic> program <italic>SHREDCIF</italic> may be used to extract these files from the CIF archive and rename the <monospace>.res</monospace> file to <monospace>.ins</monospace>, for example to perform further refinements with <italic>SHELXL</italic>. The intention is that such CIFs containing embedded data should become standard for deposition and archiving. It is particularly convenient that only one file is needed. CIF identifiers beginning with <monospace>_shelx_</monospace> are reserved for use by the <italic>SHELX</italic> programs, but of course other program authors may use a similar construction for embedding the reflection data <italic>etc</italic>. Users who do not wish to preserve their carefully measured data for posterity in this way have criticized the embedding of the reflection data on the grounds that (<italic>a</italic>) the resulting CIF is too large for submission with a paper for publication and that (<italic>b</italic>) certain CIF-processing programs take a long time to read such a CIF and may even choke in the attempt. However, it should be noted that (<italic>a</italic>) the figures submitted with a paper often involve larger files and (<italic>b</italic>) <italic>SHREDCIF</italic> can usually read and dismember such a CIF in less than one second! To generate a CIF without intensity data for other purposes, <italic>e.g.</italic> for input to a molecular graphics program, the keyword <monospace>NOHKL</monospace> may be used in the <italic>SHELXL</italic>
<monospace>ACTA</monospace> instruction.</p>
      <p>It is difficult to understand why several leading chemical journals still only require the deposition of the atom co­ordinates, <italic>etc.,</italic> but not the reflection data, especially now that the Cambridge Structural Database (CSD; Allen, 2002<xref ref-type="bibr" rid="bb27"> ▶</xref>) accepts the new CIFs and strongly encourages deposition of the reflection data. A simple solution would be for journals to require a confirmation that the full data have been deposited with the CSD (Bruno &amp; Groom, 2014<xref ref-type="bibr" rid="bb2"> ▶</xref>) or COD (Gražulis <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb8"> ▶</xref>), analogous to the way in which the PDB requires deposition of the structural and reflection data before issuing a PDB ID.</p>
    </sec>
    <sec id="sec2.3">
      <title>Including CIF items at the end of the <monospace>.hkl</monospace> file   </title>
      <p>Since <italic>SHELX76</italic>, the reflection data have been read until a reflection with indices 0,0,0 or a blank line (or card) or the end of the file was encountered. The rest of the file was never read by the <italic>SHELX</italic> programs. This means that additional data specific to that data set, such as details of the data collection and processing, may conveniently be appended to the <monospace>.hkl</monospace> file, which is a much safer way of preserving them than putting them in a separate file. For example, the Bruker scaling program <italic>SADABS</italic> (Krause <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb15"> ▶</xref>) now appends CIF format items such as those shown below to the <monospace>.hkl</monospace> file that it outputs:</p>
      <p>
        <monospace>_exptl_absorpt_process_details ‘SADABS 2014/4’</monospace>
      </p>
      <p>
        <monospace>_exptl_absorpt_correction_type multi-scan</monospace>
      </p>
      <p>
        <monospace>_exptl_absorpt_correction_T_max 0.7489</monospace>
      </p>
      <p>
        <monospace>_exptl_absorpt_correction_T_min 0.7208</monospace>
      </p>
      <p>
        <monospace>_exptl_special_details</monospace>
      </p>
      <p>
        <monospace>;</monospace>
      </p>
      <p>
        <monospace>The following wavelength and cell were deduced by SADABS from the direction cosines etc. They are given here for emergency use only:</monospace>
      </p>
      <p>
        <monospace>CELL 0.71072 6.100 18.294 20.604 90.006 89.992 90.000</monospace>
      </p>
      <p>
        <monospace>;</monospace>
      </p>
      <p><italic>SHELXL</italic> uses the CIF items found at the end of the <monospace>.hkl</monospace> file to replace items to which it would otherwise have given the value ‘?’. It ignores all other items. So in this example, the first four CIF items find their way (left justified) into the output CIF, but although <monospace>_exptl_special_details</monospace> is legal for a CIF it is not included as a CIF item because this CIF identifier would not otherwise have been output. However, it is still included in the <monospace>.cif</monospace> file as part of the embedded <monospace>.hkl</monospace> file, so that the information is not lost. Unfortunately, because of a fundamental CIF design weakness (the same character ‘;’ is used for both the beginning and end of a text item; it would have been better to have used a different terminator such as ‘:’), <italic>SHELXL</italic> has to replace ‘;’ in this example by ‘)’ when embedding the <monospace>.hkl</monospace> file, and <italic>SHREDCIF</italic> repairs the damage by turning a leading ‘)’ in an otherwise blank line back to ‘;’. In this example, the cell following <monospace>_exptl_special_details</monospace> is not the same as in the <monospace>CELL</monospace> instruction used in the <monospace>.ins</monospace> file, because there is a reorientation matrix in the <monospace>HKLF 4</monospace> instruction to transform the indices to the conventional <italic>P</italic>2<sub>1</sub>2<sub>1</sub>2 setting for the space group. However, it is still useful to preserve it in case the <monospace>.hkl</monospace> file becomes orphaned.</p>
    </sec>
  </sec>
  <sec id="sec3">
    <title>Refinement against neutron diffraction data and special facilities for H atoms   </title>
    <p>The new features in <italic>SHELXL</italic> for refinement against neutron data have been discussed recently by Gruene <italic>et al.</italic> (2014<xref ref-type="bibr" rid="bb9"> ▶</xref>). If a <monospace>NEUT</monospace> instruction is placed before <monospace>SFAC</monospace>, neutron scattering factors are employed, and the default bond lengths to H or D atoms are lengthened to correspond to internuclear distances rather than the distances appropriate for refinement against X-ray data. Whereas for X-rays H and D are treated specially, for neutrons they are treated as normal atoms. The <monospace>HFIX</monospace> and <monospace>AFIX</monospace> instructions may still be used to generate starting positions for H and D atoms, but it is recommended to use geometric restraints rather than a riding model for their refinement against neutron data. This is particularly important when anti-bumping restraints are applied; they work much better for a restrained than for a riding-model refinement of the H and D atoms against neutron data.</p>
    <sec id="sec3.1">
      <title>Chiral volume restraints for refinement against neutron data   </title>
      <p>The chiral volume restraint <monospace>CHIV</monospace>, which is often used for macromolecular refinement, is interpreted as follows if <monospace>NEUT</monospace> is set. If three atoms other than H or D are bonded to the atom in question, the H and D atoms are ignored and the <monospace>CHIV</monospace> restraint operates in the same way as for a refinement against X-ray data. If there are exactly three bonded atoms including H and D, the latter are used in the restraint. Thus, <monospace>CHIV 0 N1</monospace> could be used to restrain a terminal –NH<sub>2</sub> group to be planar, and <monospace>CHIV</monospace> with a nonzero target value could be used to make it nonplanar.</p>
    </sec>
    <sec id="sec3.2">
      <title>Anisotropic refinement of H and D atoms against neutron data   </title>
      <p>Since the neutron scattering factors for H, and especially for D, are of a similar order of magnitude to those for other atoms, H and D also need to be refined anisotropically for refinement against neutron data. Unfortunately, this results in about twice as many parameters as for a standard refinement against X-ray data, and the number of data available may well be less than for an X-ray refinement, so further restraints such as the new <monospace>RIGU</monospace> rigid-bond restraint (Thorn <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb25"> ▶</xref>) may be required.</p>
      <p>The <monospace>RIGU</monospace> restraints require that the relative motion of bonded atoms is at right angles to the bond joining them. This sets up three restraints per atom pair, one of which is equivalent to the classical rigid-bond restraint <monospace>DELU</monospace>. <monospace>RIGU</monospace> is very generally applicable and it is almost always safe to add a <monospace>RIGU</monospace> instruction without further parameters to the <monospace>.ins</monospace> file. The resulting displacement ellipsoid plots tend to appear chemically more reasonable than those from an unrestrained refinement and there is usually little change in the final <italic>R</italic> factors.</p>
      <p>The following example, using data from Lübben <italic>et al.</italic> (2014<xref ref-type="bibr" rid="bb16"> ▶</xref>), is a little different, because it involves the anisotropic refinement of all atoms, including H atoms, using <italic>SHELXL</italic> against neutron diffraction data collected at 9 K. The <monospace>.ins</monospace> file was the same as that used for refinement against X-ray data, except that: (i) a <monospace>NEUT</monospace> instruction was placed before <monospace>SFAC</monospace>, so that neutron scattering lengths were used instead of X-ray scattering factors; (ii) instead of using a riding model for the refinement of the H atoms, <monospace>SADI</monospace> (equal distance) restraints were applied to the O—H bonds in the water molecule, the C—H bonds in the CH<sub>2</sub> and CH<sub>3</sub> groups, and the H⋯H distances within the CH<sub>3</sub> group; and (iii) a much larger value was obtained for the extinction parameter (<monospace>EXTI</monospace>).</p>
      <p>Close inspection of the atomic displacement ellipsoids in Fig. 1<xref ref-type="fig" rid="fig1"> ▶</xref>(<italic>a</italic>) shows that the assumption that the relative motion of the H atoms is at right angles to the bonds holds well, even for the unrestrained refinement. The refinement with tight <monospace>RIGU</monospace> restraints (<monospace>RIGU 0.0001</monospace>) for the bonded atoms (Fig. 1<xref ref-type="fig" rid="fig1"> ▶</xref>
<italic>b</italic>) looks very similar, but the H-atom displacement ellipsoids are aligned so that their smallest principal axes are even closer to the bond directions, as required when the motion is at right angles to the bonds. However, Fig. 1<xref ref-type="fig" rid="fig1"> ▶</xref>(<italic>b</italic>) also reveals a small weakness of the rigid-bond assumption: the H-atom displace­ment ellipsoids appear to be slightly squashed in the direction of the bond. This is probably because the amplitude of the zero-point motion along the bond is larger for the H atom than for the atom to which it is bonded, because of the smaller mass of the former, but the rigid-bond restraint tries to make them equal. As a result, the <italic>R</italic>
<sub>1</sub> value is slightly higher for the <monospace>RIGU</monospace>-restrained refinement (0.0342 rather than 0.0304). This effect is only observable here because of the extremely low temperature (9 K) and the high-quality data; at higher temperatures, the <monospace>RIGU</monospace> restraints can be very useful to stabilize the anisotropic refinement of H and other atoms against neutron data.</p>
      <p>Fig. 1<xref ref-type="fig" rid="fig1"> ▶</xref> also exhibits much larger atomic displacement ellipsoids for the H atoms than for the remaining atoms. At such low temperatures, the frequently made assumption that the isotropic displacement parameters of the atoms can be set to 1.2 or 1.5 times the equivalent isotropic <italic>U</italic> values of the atoms to which they are bonded is clearly not justified. However, at temperatures above about 100 K it has been shown that this assumption is less seriously flawed (Lübben <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb16"> ▶</xref>). Capelli <italic>et al.</italic> (2014<xref ref-type="bibr" rid="bb3"> ▶</xref>) recently showed that Hirshfeld atom refinement provides a much more accurate way of deriving anisotropic displacement parameters for H atoms from X-ray data.</p>
    </sec>
    <sec id="sec3.3">
      <title>Other new facilities for H atoms and CF<sub>3</sub> groups   </title>
      <p>Except where the <monospace>NEUT</monospace> instruction is used, both H and D are now treated as special in the input syntax. This is useful when both are present, <italic>e.g.</italic> when the crystals came from an NMR tube containing a deuterated solvent. The <monospace>AFIX</monospace> instructions for CH<sub>3</sub> groups may now also be used to set up CF<sub>3</sub> groups, but it is better to refine these as rigid groups or with distance restraints (<monospace>DFIX</monospace> or <monospace>SADI</monospace>) than by applying a riding model, because the latter can be unstable.</p>
      <p>An <monospace>HTAB</monospace> instruction without any parameters instructs the program to find possible hydrogen bonds. These now include C—H⋯O interactions when the C atom is directly or in­directly attached to an electronegative atom (Taylor &amp; Kennard, 1982<xref ref-type="bibr" rid="bb23"> ▶</xref>). Such weak interactions involving H atoms attached to peptide C<sub>α</sub> atoms are common in protein structures (Desiraju &amp; Steiner, 1999<xref ref-type="bibr" rid="bb4"> ▶</xref>). The resulting full <monospace>HTAB</monospace> and <monospace>EQIV</monospace> instructions are appended after the <monospace>END</monospace> instruction of the <monospace>.res</monospace> file and need to be (selectively) transferred to the beginning of the <monospace>.ins</monospace> file, so that they will be included in the CIF generated by the next refinement. This facilitates the generation of tables of hydrogen bonds, and helps to prevent hydrogen bonds involving symmetry-equivalent atoms from being overlooked.</p>
    </sec>
  </sec>
  <sec id="sec4">
    <title>Absolute structure determination   </title>
    <p>In the distant past, it was often assumed that it was necessary to include a heavy atom, <italic>e.g.</italic> by making a rubidium salt or bromobenzoate derivative, in order to obtain a reliable absolute structure, for instance to establish which enantiomer of a chiral molecule was correct. Since then, experimental and computational methods have made such progress that the absolute structure can often even be determined with Mo <italic>K</italic>α radiation when the heaviest atom is oxygen (Escudero-Adán <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb6"> ▶</xref>). When the 2008 <italic>SHELX</italic> paper was written, the method of choice to determine the absolute structure was to refine the Flack parameter (Flack, 1983<xref ref-type="bibr" rid="bb7"> ▶</xref>) as one of the parameters in a full-matrix refinement. Since then it has become clear that this led to a substantial overestimation of the standard uncertainty of the Flack parameter, and that post-refinement methods using either a Bayesian approach (Hooft <italic>et al.</italic>, 2008<xref ref-type="bibr" rid="bb12"> ▶</xref>) or quotients or differences of the Friedel opposites as observations (Parsons <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb17"> ▶</xref>) give more reasonable estimates of the Flack parameter, and especially its standard uncertainty. This led to the IUCr/<italic>checkCIF</italic> requirement that Friedel opposites should not be merged in the deposited data. For small-molecule refinements with <italic>SHELXL</italic>, the input <monospace>.hkl</monospace> file should contain the unmerged data. This enables the program to produce a more complete output CIF and to estimate the Flack parameter using the Parsons quotient method for all noncentrosymmetric structures. This approach works well even for twinned structures. For structure refinement, the reflections are, by default, merged according to the point group of the crystal structure (<monospace>MERG 2</monospace> in <italic>SHELXL</italic> notation). In the relatively rare cases that result in an intermediate value of the Flack parameter with a small standard uncertainty, in order to obtain the most accurate calculated intensities and hence difference density, it is still necessary to refine the Flack parameter by the full-matrix method (<monospace>TWIN</monospace>/<monospace>BASF</monospace>). However, a Flack parameter of 0.5 with a small standard uncertainty is a warning sign that the true space group might be centrosymmetric!</p>
  </sec>
  <sec id="sec5">
    <title>Estimates of standard uncertainties   </title>
    <p>One side effect of the inclusion of Friedel opposites is that there will be nearly twice as many data for the refinement of a noncentrosymmetric structure, which, using the usual least-squares algebra, would lead to a reduction in the estimated standard uncertainties of all parameters by a factor of nearly 2<sup>1/2</sup>. <italic>SHELXL</italic> now uses the number of unique reflections as defined by the Laue group, rather than the number of observations, in the formula used to estimate the standard uncertainties (Spek, 2012<xref ref-type="bibr" rid="bb21"> ▶</xref>). It could be argued that all reflection intensities are independent measurements, and this was approximately true for unscaled data from point detectors before the introduction of focusing optics. However, it is now standard practice to scale the data so that equivalent reflections (usually including Friedel opposites) become more equal, in order to correct for absorption and differences in the effective crystal volume irradiated, and then the equivalent reflections can no longer be regarded as independent observations. In some cases, this change may result in a modest increase in the estimated standard uncertainties, but these were generally underestimated anyway (Taylor &amp; Kennard, 1986<xref ref-type="bibr" rid="bb24"> ▶</xref>). The new method of estimating standard uncertainties also applies to twinned structures, where some <italic>SHELXL97</italic> users were required by referees to throw away some of their carefully measured data so that the number of observations would be equal to the number of unique reflections. Now all the experimental data may be used and the estimated standard uncertainties should be more realistic. With <italic>SHELXL97</italic>, it was necessary to use the third least-squares parameter to correct the estimated standard uncertainties; this is not required anymore (except for ‘SQUEEZEd’ structures).</p>
  </sec>
  <sec id="sec6">
    <title>Input of partial structure factors   </title>
    <p>The new <monospace>ABIN</monospace> instruction was primarily designed to facilitate the use of the SQUEEZE facility (Spek, 2015<xref ref-type="bibr" rid="bb22"> ▶</xref>) in the program <italic>PLATON</italic> (Spek, 2009<xref ref-type="bibr" rid="bb20"> ▶</xref>), but it can also be used to input a bulk solvent model for a macromolecule. <italic>PLATON</italic> calculates the partial structure factors corresponding to a blob of un­modelled difference density and writes them to the <monospace>.fab</monospace> file. The <monospace>ABIN</monospace> instruction causes <italic>h</italic>, <italic>k</italic>, <italic>l</italic>, <italic>A</italic> and <italic>B</italic> to be read from the <monospace>.fab</monospace> file, where <italic>A</italic> and <italic>B</italic> are the real and imaginary components, respectively, of a partial structure factor. These reflections are read in free format (one reflection per line) and may be in any order. Duplicates, systematic absences and reflections outside the resolution limits for refinement are ignored. Symmetry equivalents are generated automatically. At least one symmetry equivalent (according to the point group) of each reflection present in the <monospace>.hkl</monospace> file, including all reflections in all twin components if the structure is twinned, should be present in the <monospace>.fab</monospace> file. For twinned structures, it is necessary first to use the new <monospace>LIST 8</monospace> instruction (see below) to generate detwinned data for input to <italic>PLATON</italic>. The <italic>A</italic> and <italic>B</italic> values refer to the untwinned structure, but in the case of a twinned structure, after applying the appropriate symmetry trans­formations, they are added to the calculated structure factors for all twin components.</p>
    <p><monospace>ABIN</monospace> takes two free variable numbers (Sheldrick, 2008<xref ref-type="bibr" rid="bb19"> ▶</xref>) <italic>n</italic>
<sub>1</sub> and <italic>n</italic>
<sub>2</sub> as parameters. The <italic>A</italic> and <italic>B</italic> values read from the <monospace>.fab</monospace> file are multiplied by <italic>k</italic>exp[−8π<sup>2</sup>
<italic>U</italic>sin<sup>2</sup>θ/λ<sup>2</sup>], where <italic>k</italic> is the value of free variable <italic>n</italic>
<sub>1</sub> and <italic>U</italic> is the value of free variable <italic>n</italic>
<sub>2</sub>. These two optional parameters may be needed when the partial structure factors come from a bulk solvent model of a macromolecule, but are probably not needed for use with SQUEEZE. SQUEEZE should only be used where it is not possible to model the disordered solvent by normal methods, <italic>e.g.</italic> when there is a continuous ribbon of diffuse difference density along one of the unit-cell axes. Partial structure factors and <monospace>ABIN</monospace> should always be used in preference to the old procedure of modifying the input <monospace>.hkl</monospace> file, which made it impossible to remodel the disordered density should a better method become available.</p>
  </sec>
  <sec id="sec7">
    <title>Extending the <monospace>PART</monospace> number concept   </title>
    <p>The use of <monospace>PART</monospace> numbers, introduced in <italic>SHELXL93</italic>, has proved invaluable in the refinement of disordered structures. Two atoms are considered to be bonded if they have the same <monospace>PART</monospace> number or if one of them is in <monospace>PART 0</monospace>. The resulting connectivity table is used for the generation of H atoms (<monospace>HFIX</monospace> and <monospace>AFIX</monospace>), for setting up restraints such as <monospace>DELU</monospace>, <monospace>SIMU</monospace>, <monospace>RIGU</monospace>, <monospace>CHIV</monospace>, <monospace>BUMP</monospace> and <monospace>SAME</monospace>, and for generating tables of geometric parameters (<monospace>BOND</monospace>, <monospace>CONF</monospace>, <monospace>HTAB</monospace>). Usually, most of the atoms are in <monospace>PART 0</monospace>, but, for example, a molecule or side chain dis­ordered over three positions could use <monospace>PART 1</monospace>, <monospace>PART 2</monospace> and <monospace>PART 3</monospace>. If the <monospace>PART</monospace> number is negative, bonds are not generated to symmetry-equivalent atoms. It should be noted that positive <monospace>PART</monospace> numbers 1, 2, 3 <italic>etc.</italic> correspond to the alternative location indicators <italic>A</italic>, <italic>B</italic>, <italic>C</italic>
<italic>etc.</italic> in PDB format. However, this notation is difficult to use when there is a disorder within a disorder. A <monospace>BIND</monospace> instruction that specifies two numbers may now be used to get around this problem. For example, <monospace>BIND 2 4</monospace> means that, in addition to the usual <monospace>PART</monospace> rules, atoms in <monospace>PART 2</monospace> may also bond to atoms in <monospace>PART 4</monospace>. Negative <monospace>PART</monospace> numbers are allowed in the <monospace>BIND</monospace> instruction.</p>
    <p>As an example, consider an <italic>n</italic>-butyl substituent coordinated through atom C1 that splits into two disorder components at C2. Atom C1 is then in <monospace>PART 0</monospace>, C2<italic>A</italic>, C3<italic>A</italic> and C4<italic>A</italic> in <monospace>PART 1</monospace>, and C2<italic>B</italic>, C3<italic>B</italic> and C4<italic>B</italic> in <monospace>PART 2</monospace>. Atom C1 is bonded to both C2<italic>A</italic> and C2<italic>B</italic> but, because these two atoms have different <monospace>PART</monospace> numbers, H atoms will be generated correctly using the <monospace>HFIX</monospace> instruction. However, if there is a further disorder starting at atom C3<italic>B</italic>, this cannot be handled easily by <italic>SHELX97</italic>. Atoms C3<italic>B</italic> and C4<italic>B</italic> can be split into C3<italic>B</italic>′ and C4<italic>B</italic>′ in <monospace>PART 3</monospace> and into C3<italic>B</italic>′′ and C4<italic>B</italic>′′ in <monospace>PART 4</monospace>, but then atoms C3<italic>B</italic>′ and C3<italic>B</italic>′′ are not bonded to C2<italic>B</italic> because they have different nonzero <monospace>PART</monospace> numbers. Extra bonds could have been inserted into the connectivity table with:</p>
    <p>
      <monospace>BIND C2B C3B’</monospace>
    </p>
    <p>
      <monospace>BIND C2B C3B”</monospace>
    </p>
    <p>but then <monospace>HFIX</monospace> or <monospace>AFIX</monospace> would still not generate the correct H atoms, because they need to refer to the <monospace>PART</monospace> numbers of the neighbouring atoms too. However, the alternative</p>
    <p>
      <monospace>BIND 2 3</monospace>
    </p>
    <p>
      <monospace>BIND 2 4</monospace>
    </p>
    <p>now enables the H atoms to be generated correctly. Since <italic>SHELXL</italic> allows atoms to have the same names if they have different <monospace>PART</monospace> numbers, atoms C3<italic>A</italic>, C3<italic>B</italic>′ and C3<italic>B</italic>′′ could all be labelled C3 in this example. This would simplify the naming of the H atoms, but might confuse non-<italic>SHELX</italic> programs that read the <monospace>.res</monospace> file. As with almost every disorder, the use of <monospace>RIGU</monospace> is strongly recommended here.</p>
  </sec>
  <sec id="sec8">
    <title>Other new features in <italic>SHELXL</italic>   </title>
    <p>One of the most common cases of instability in crystal structure refinements is when the atomic displacement parameters refine to appreciably negative values. The new <monospace>XNPD</monospace> instruction may be used to combat this. When an isotropic displace­ment parameter, or a principal component of an anisotropic displacement parameter, refines to a value less than (<italic>e.g.</italic> more negative) the value specified with the <monospace>XNPD</monospace> instruction, it is replaced by that value, and the displacement parameters <italic>U</italic>
<sub>iso</sub> or <italic>U</italic>
<sup><italic>ij</italic></sup> are recalculated. Thus, the default setting of <monospace>XNPD -0.001</monospace> avoids the risk of the refinement becoming unstable, but still leads to nonpositive definite (NPD) atoms being recognized and reported. For problematic cases, it may be desirable to set <monospace>XNPD</monospace> to a small positive value. However, it should then first be checked that the negative value was not caused by an error in the input file, <italic>e.g.</italic> an incorrect element type or site-occupation factor.</p>
    <p>The new <monospace>LIST 8</monospace> option writes <italic>h</italic>, <italic>k</italic>, <italic>l</italic>, <italic>F</italic>
<sub>o</sub>
<sup>2</sup>, σ(<italic>F</italic>
<sub>o</sub>
<sup>2</sup>), <italic>F</italic>
<sub>c</sub>
<sup>2</sup>, ϕ (phase angle in degrees), <italic>d</italic> spacing in ångström (Å) and 1/(<italic>w</italic>
<sup>1/2</sup>) in CIF format to the <monospace>.fcf</monospace> file, where <italic>w</italic> is the weight derived from the weighting scheme and used in the refinement. For weak reflections, 1/(<italic>w</italic>
<sup>1/2</sup>) should be only a little larger than σ(<italic>F</italic>
<sub>o</sub>
<sup>2</sup>). This list is on an absolute scale and is detwinned, merged (according to the point group of the crystal structure) and sorted, but without eliminating the anomalous contributions (except in the calculation of ϕ, so that the corresponding electron density is real). This option is essential for applying the SQUEEZE option in <italic>PLATON</italic> to twinned structures, but also has other uses.</p>
    <p><monospace>RTAB D2CG</monospace> followed by atom names may be used to calculate the distance between the first named atom and the unweighted centroid of the remaining atoms, together with its standard uncertainty. This can be used to calculate distances to ring centroids, for example.</p>
    <p>As in <italic>SHELXL97</italic>, ‘+filename’ may be used to insert further instructions whilst reading the <monospace>.ins</monospace> file. These instructions are not echoed to the <monospace>.res</monospace> file. The new ‘++filename’ may be used to insert instructions that should be echoed to the <monospace>.res</monospace> file. The ‘+filename’ instruction itself is echoed to the <monospace>.res</monospace> file but ‘++filename’ is not. These instructions are useful for reading in long lists of restraints, <italic>etc</italic>.</p>
    <p>Although the <monospace>SAME</monospace> instruction for generating distance restraints is very convenient, especially when combined with the use of residues (<monospace>RESI</monospace>) so that the same atom names may be used when there are several chemically identical solvent molecules, it is less convenient when some of those solvent molecules are disordered, for example, tetrahydrofuran (THF), with one atom either above or below the plane of the other four. A <monospace>SADI</monospace> instruction with no parameters now causes <monospace>SADI</monospace> (similar distance) restraints to be generated from all the <monospace>SAME</monospace> instructions. These appear after the <monospace>END</monospace> instruction in the <monospace>.res</monospace> file. They can be moved to the start of the new <monospace>.ins</monospace> file, and edited and extended to give fine control over the refinement of such disorders.</p>
    <p>The <monospace>TWIN</monospace> instruction no longer requires integer matrix elements. The matrix is used to generate the indices of the reflections of the twin components, and if they differ by more than 0.1 from integers they are ignored. This enables the refinement of rhombohedral obverse/reverse twins, and is also useful for pseudomerohedral twins in which some of the reflections of a minor twin domain overlap nearly perfectly with reflections of the major domain and have to be taken into account, and other reflections of the minor domain do not overlap and can be ignored. If the twin components are more equal, the <monospace>HKLF 5</monospace> format reflection data may be a better approach.</p>
    <p>Details of further changes since 2008 may be found on the <italic>SHELX</italic> homepage (<ext-link ext-link-type="uri" xlink:href="http://shelx.uni-ac.gwdg.de/SHELX/">http://shelx.uni-ac.gwdg.de/SHELX/</ext-link>).</p>
  </sec>
  <sec id="sec9">
    <title>Conclusions   </title>
    <p>This account of changes and extensions to <italic>SHELXL</italic> since 2008 is testimony to the continuous development of the structure refinement techniques that is still taking place. In that time, CIF has advanced to become the standard for the deposition and archiving of crystallographic data, and this is reflected in many of the changes in <italic>SHELXL</italic>. The <monospace>.ins</monospace> and <monospace>.hkl</monospace> files used for input to <italic>SHELXL</italic> have remained, with very minor exceptions for which there were good reasons, upwards compatible since <italic>SHELX76</italic>. Another reason why <italic>SHELX</italic> has remained popular over many generations of computer hardware is its strict ‘no dependencies’ philosophy: no external programs, libraries (such as DLLs) or environment variables are required to run any of the <italic>SHELX</italic> programs (except <italic>SHELXLE</italic>).</p>
  </sec>
</body>
<back>
  <ack>
    <p>The author is very grateful to many <italic>SHELX</italic> users for patiently reporting bugs and suggesting improvements, and in particular to Ton Spek, Regine Herbst-Irmer, Tony Linden, Tim Gruene and Birger Dittrich for many useful discussions. He thanks the Volkswagen-Stiftung and the state of Niedersachsen for the award of a Niedersachsen (Emeritus) Professorship.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="bb27">
      <mixed-citation publication-type="other">Allen, F. H. (2002). <italic>Acta Cryst.</italic> B<bold>58</bold>, 380–388.</mixed-citation>
    </ref>
    <ref id="bb1">
      <mixed-citation publication-type="other">Berman, H. M. (2008). <italic>Acta Cryst.</italic> A<bold>64</bold>, 88–95.</mixed-citation>
    </ref>
    <ref id="bb2">
      <mixed-citation publication-type="other">Bruno, I. J. &amp; Groom, C. R. (2014). <italic>J. Comput. Aided Mol. Des.</italic>
<bold>28</bold>, 1015–1022.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Capelli, S. C., Bürgi, H.-B., Dittrich, B., Grabowsky, S. &amp; Jayatilaka, D. (2014). <italic>IUCrJ</italic>, <bold>1</bold>, 361–379.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Desiraju, G. R. &amp; Steiner, T. (1999). <italic>The Weak Hydrogen Bond</italic>, pp. 350–363. Oxford University Press and IUCr.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Diederichs, K. (2000). <italic>J. Appl. Cryst.</italic>
<bold>33</bold>, 1154–1161.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Escudero-Adán, E. C., Benet-Buchholz, J. &amp; Ballester, P. (2014). <italic>Acta Cryst.</italic> B<bold>70</bold>, 660–668.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Flack, H. D. (1983). <italic>Acta Cryst.</italic> A<bold>39</bold>, 876–881.</mixed-citation>
    </ref>
    <ref id="bb8">
      <mixed-citation publication-type="other">Gražulis, S., Daškevič, A., Merkys, A., Chateigner, D., Lutterotti, L., Quirós, M., Serebryanaya, N. R., Moeck, P., Downs, R. T. &amp; Le Bail, A. (2012). <italic>Nucleic Acids Res.</italic>
<bold>40</bold>, D420–D427.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Gruene, T., Hahn, H. W., Luebben, A. V., Meilleur, F. &amp; Sheldrick, G. M. (2014). <italic>J. Appl. Cryst.</italic>
<bold>47</bold>, 462–466.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Hall, S. R., Allen, F. H. &amp; Brown, I. D. (1991). <italic>Acta Cryst.</italic> A<bold>47</bold>, 655–685.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Hodgkin, A. L. &amp; Keynes, R. D. (1955). <italic>J. Physiol.</italic>
<bold>128</bold>, 61–88.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Hooft, R. W. W., Straver, L. H. &amp; Spek, A. L. (2008). <italic>J. Appl. Cryst.</italic>
<bold>41</bold>, 96–103.</mixed-citation>
    </ref>
    <ref id="bb13">
      <mixed-citation publication-type="other">Hübschle, C. B., Sheldrick, G. M. &amp; Dittrich, B. (2011). <italic>J. Appl. Cryst.</italic>
<bold>44</bold>, 1281–1284.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Köpfer, D. A., Song, C., Gruene, T., Sheldrick, G. M., Zachariae, U. &amp; de Groot, B. L. (2014). <italic>Science</italic>, <bold>346</bold>, 352–355.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="journal">Krause, L., Herbst-Irmer, R., Sheldrick, G. M. &amp; Stalke, D. (2015). <italic>J. Appl. Cryst.</italic>
<bold>48</bold>. In the press.</mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">Lübben, J., Volkmann, C., Grabowsky, S., Edwards, A., Morgenroth, W., Fabbiani, F. P. A., Sheldrick, G. M. &amp; Dittrich, B. (2014). <italic>Acta Cryst.</italic> A<bold>70</bold>, 309–316.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Parsons, S., Flack, H. D. &amp; Wagner, T. (2013). <italic>Acta Cryst.</italic> B<bold>69</bold>, 249–259.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Schneider, T. R. &amp; Sheldrick, G. M. (2002). <italic>Acta Cryst.</italic> D<bold>58</bold>, 1772–1779.</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Sheldrick, G. M. (2008). <italic>Acta Cryst.</italic> A<bold>64</bold>, 112–122.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Spek, A. L. (2009). <italic>Acta Cryst.</italic> D<bold>65</bold>, 148–155.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">Spek, A. L. (2012). Private communication.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="journal">Spek, A. L. (2015). <italic>Acta Cryst.</italic> C<bold>71</bold>, 9–18.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">Taylor, R. &amp; Kennard, O. (1982). <italic>J. Am. Chem. Soc.</italic>
<bold>104</bold>, 5063–5070.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">Taylor, R. &amp; Kennard, O. (1986). <italic>Acta Cryst.</italic> B<bold>42</bold>, 112–120.</mixed-citation>
    </ref>
    <ref id="bb25">
      <mixed-citation publication-type="other">Thorn, A., Dittrich, B. &amp; Sheldrick, G. M. (2012). <italic>Acta Cryst.</italic> A<bold>68</bold>, 448–451.</mixed-citation>
    </ref>
    <ref id="bb26">
      <mixed-citation publication-type="other">Thorn, A. &amp; Sheldrick, G. M. (2011). <italic>J. Appl. Cryst.</italic>
<bold>44</bold>, 1285–1287.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Displacement ellipsoid style plot, drawn using <italic>SHELXLE</italic> (Hübschle <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb13"> ▶</xref>), of <italic>N</italic>-acetyl-4-hydroxy-<sc>l</sc>-proline monohydrate, (<italic>a</italic>) without and (<italic>b</italic>) with the application of <monospace>RIGU</monospace> restraints to the anisotropic displacement parameters. Both the orientations of the 50% probability displacement ellipsoids and the <italic>R</italic>
<sub>1</sub> values are very similar in the two cases, justifying the use of these restraints for the anisotropic refinement of H atoms against neutron data. When <monospace>RIGU</monospace> restraints are applied, the smallest principal component of the anisotropic displacement ellipsoid is aligned even more closely with the bond direction. Note that the common assumption that the isotropic <italic>U</italic> values of the H atoms can be set to 1.2 or 1.5 times the equivalent isotropic <italic>U</italic> values of the atoms to which they are attached would be most inappropriate for this structure determined at 9 K.</p>
    </caption>
    <graphic xlink:href="c-71-00003-fig1"/>
  </fig>
</floats-group>
