<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-id journal-id-type="hwp">bioinfo</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">4481846</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btv117</article-id>
    <article-id pub-id-type="publisher-id">btv117</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>hiHMM: Bayesian non-parametric joint inference of chromatin state maps</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Sohn</surname>
          <given-names>Kyung-Ah</given-names>
        </name>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>1</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>3</sup>
        </xref>
        <xref ref-type="author-notes" rid="btv117-FN1">
          <sup>†</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ho</surname>
          <given-names>Joshua W. K.</given-names>
        </name>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>4</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>5</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>6</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>7</sup>
        </xref>
        <xref ref-type="author-notes" rid="btv117-FN1">
          <sup>†</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Djordjevic</surname>
          <given-names>Djordje</given-names>
        </name>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>4</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>5</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jeong</surname>
          <given-names>Hyun-hwan</given-names>
        </name>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Park</surname>
          <given-names>Peter J.</given-names>
        </name>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>6</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>7</sup>
        </xref>
        <xref ref-type="corresp" rid="btv117-COR1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kim</surname>
          <given-names>Ju Han</given-names>
        </name>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>2</sup>
        </xref>
        <xref ref-type="aff" rid="btv117-AFF1">
          <sup>3</sup>
        </xref>
        <xref ref-type="corresp" rid="btv117-COR1">*</xref>
      </contrib>
      <aff id="btv117-AFF1"><sup>1</sup>Department of Information and Computer Engineering, Ajou University, Suwon 443-749, South Korea, <sup>2</sup>Seoul National University Biomedical Informatics (SNUBI), Division of Biomedical Informatics, Seoul National University College of Medicine, Seoul 110799, Korea, <sup>3</sup>Systems Biomedical Informatics Research Center, Seoul National University, Seoul 110799, Korea, <sup>4</sup>Victor Chang Cardiac Research Institute, Sydney, NSW 2010, Australia, <sup>5</sup>The University of New South Wales, Sydney, NSW 2052, Australia, <sup>6</sup>Center for Biomedical Informatics, Harvard Medical School, Boston, MA 02115, USA and <sup>7</sup>Division of Genetics, Department of Medicine, Brigham and Women’s Hospital, Harvard Medical School, Boston, MA 02115, USA</aff>
    </contrib-group>
    <author-notes>
      <corresp id="btv117-COR1">*To whom correspondence should be addressed.</corresp>
      <fn id="btv117-FN1">
        <p><sup>†</sup>The authors wish it to be known that, in their opinion, the first two authors should be regarded as Joint First Authors.</p>
      </fn>
      <fn id="btv117-FN2">
        <p>Associate Editor: Alfonso Valencia</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>7</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>2</month>
      <year>2015</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>2</month>
      <year>2015</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. -->
    <volume>31</volume>
    <issue>13</issue>
    <fpage>2066</fpage>
    <lpage>2074</lpage>
    <history>
      <date date-type="received">
        <day>17</day>
        <month>2</month>
        <year>2014</year>
      </date>
      <date date-type="rev-recd">
        <day>29</day>
        <month>1</month>
        <year>2015</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>2</month>
        <year>2015</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2015. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2015</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/" license-type="creative-commons">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation:</bold> Genome-wide mapping of chromatin states is essential for defining regulatory elements and inferring their activities in eukaryotic genomes. A number of hidden Markov model (HMM)-based methods have been developed to infer chromatin state maps from genome-wide histone modification data for an individual genome. To perform a principled comparison of evolutionarily distant epigenomes, we must consider species-specific biases such as differences in genome size, strength of signal enrichment and co-occurrence patterns of histone modifications.</p>
      <p><bold>Results:</bold> Here, we present a new Bayesian non-parametric method called hierarchically linked infinite HMM (hiHMM) to jointly infer chromatin state maps in multiple genomes (different species, cell types and developmental stages) using genome-wide histone modification data. This flexible framework provides a new way to learn a consistent definition of chromatin states across multiple genomes, thus facilitating a direct comparison among them. We demonstrate the utility of this method using synthetic data as well as multiple modENCODE ChIP-seq datasets.</p>
      <p><bold>Conclusion:</bold> The hierarchical and Bayesian non-parametric formulation in our approach is an important extension to the current set of methodologies for comparative chromatin landscape analysis.</p>
      <p><bold>Availability and implementation:</bold> Source codes are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/kasohn/hiHMM">https://github.com/kasohn/hiHMM</ext-link>. Chromatin data are available at <ext-link ext-link-type="uri" xlink:href="http://encode-x.med.harvard.edu/data_sets/chromatin/">http://encode-x.med.harvard.edu/data_sets/chromatin/</ext-link>.</p>
      <p><bold>Contact:</bold><email>peter_park@harvard.edu</email> or <email>juhan@snu.ac.kr</email></p>
      <p><bold>Supplementary information:</bold><ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online.</p>
    </abstract>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Readout of genetic information in eukaryotic genomes is mediated by the dynamic chromatin environment, which regulates DNA accessibility for the gene expression machinery through chromatin compaction, associated histone modifications and incorporation of histone variants. Chromatin immunoprecipitation experiments followed by genome-wide microarray (ChIP-chip) or sequencing (ChIP-seq) have revealed that distinct genomic regulatory regions are associated with different covalent modifications of histone proteins across various organisms (<xref rid="btv117-B21" ref-type="bibr">Kharchenko <italic>et al</italic>., 2011</xref>; <xref rid="btv117-B23" ref-type="bibr">Liu <italic>et al</italic>., 2011</xref>; <xref rid="btv117-B24" ref-type="bibr">Mikkelsen <italic>et al</italic>., 2007</xref>; <xref rid="btv117-B25" ref-type="bibr">Park, 2009</xref>; <xref rid="btv117-B27" ref-type="bibr">Roudier <italic>et al</italic>., 2011</xref>). For example, H3K4me3 (trimethylation of histone H3 at residue lysine 4) marks active promoters, H3K4me1 marks enhancers, H3K36me3 marks transcribed gene bodies, H3K27me3 marks polycomb-repressed regions and H3K9me3 marks heterochromatin. Although there are theoretically up to <inline-formula><mml:math id="MM1"><mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> possible combinations of <italic>n</italic> histone modifications at any given locus in the genome, in practice we only observe a small number of distinct dominant combinations, thus giving rise to the concept of chromatin states (<xref rid="btv117-B8" ref-type="bibr">Ernst and Kellis, 2010</xref>; <xref rid="btv117-B12" ref-type="bibr">Filion <italic>et al</italic>., 2010</xref>; <xref rid="btv117-B14" ref-type="bibr">Heintzman <italic>et al</italic>., 2009</xref>; <xref rid="btv117-B17" ref-type="bibr">Hon <italic>et al</italic>., 2008</xref>; <xref rid="btv117-B21" ref-type="bibr">Kharchenko <italic>et al</italic>., 2011</xref>; <xref rid="btv117-B23" ref-type="bibr">Liu <italic>et al</italic>., 2011</xref>; <xref rid="btv117-B24" ref-type="bibr">Mikkelsen <italic>et al</italic>., 2007</xref>; <xref rid="btv117-B27" ref-type="bibr">Roudier <italic>et al</italic>., 2011</xref>), in which each state consists of a combination of histone modifications.</p>
    <p>A key idea underlying chromatin state analysis is to computationally identify the number and composition of chromatin states in the genome based on multiple genome-wide profiles of histone modifications and to annotate the genome with these chromatin states. These states were found to be strongly correlated with various functional genomic features such as promoters, actively transcribing gene bodies, enhancers and heterochromatins. Although many chromatin states are common across different cell types or organisms, there are indeed clear examples of cell-type-specific chromatin states consisting of unique co-occurrence of histone modifications. The H3K4me3/H3K27me3 bivalent promoter state that is prevalent in embryonic stem cells but mostly absent from terminally differentiated cells is such an example (<xref rid="btv117-B4" ref-type="bibr">Bernstein <italic>et al</italic>., 2006</xref>). Investigating co-occurrence of multiple histone marks facilitates the differentiation of more subtle features in chromatin state, such as identifying tissue-specific strong and weak enhancer regions (<xref rid="btv117-B10" ref-type="bibr">Ernst <italic>et al</italic>., 2011</xref>) and changes in co-occurrence patterns between evolutionarily distant species (<xref rid="btv117-B15" ref-type="bibr">Ho <italic>et al</italic>., 2014</xref>). Therefore, a chromatin state map is a powerful means to infer potential genome function in a systematic and automated fashion. In conjunction with transcriptomic, DNase I and transcription factor binding data, chromatin state analysis was used to infer putative biochemical functions to a large fraction of the non-coding genomic regions (<xref rid="btv117-B7" ref-type="bibr">ENCODE Project Consortium, 2012</xref>).</p>
    <p>Various machine learning algorithms, such as ChromHMM (<xref rid="btv117-B9" ref-type="bibr">Ernst and Kellis, 2012</xref>), Segway (<xref rid="btv117-B16" ref-type="bibr">Hoffman <italic>et al</italic>., 2012</xref>), TreeHMM (<xref rid="btv117-B5" ref-type="bibr">Biesinger <italic>et al</italic>., 2013</xref>) and tiered HMM (<xref rid="btv117-B22" ref-type="bibr">Larson <italic>et al</italic>., 2013</xref>), have been developed to generate such maps to facilitate cell type-specific genome annotations in a systematic and automated fashion. All of them are based on probabilistic graphical models such as the hidden Markov model (HMM) and dynamic Bayesian network. One essential task for these algorithms is to learn the prominent combination of histone modifications. Similar to any clustering problem, it is often difficult to identify a reasonable number of combinations that can adequately capture the major variation in the data. One possibility is to estimate the adequate number of states by performing exploratory analysis such as the principal component analysis (<xref rid="btv117-B20" ref-type="bibr">Julienne <italic>et al</italic>., 2013</xref>). Another common approach is to run the HMM learning multiple times with varying state numbers and identify the best fitting model using measures such as the Bayesian Information Criterion. The inferred states do not necessarily have a one-to-one correspondence with distinct functional regions in the chromatin, but they do give a very good data-driven description of the chromatin that can act as a starting point for further bioinformatics and experimental analysis (<xref rid="btv117-B1" ref-type="bibr">Baker, 2011</xref>). Therefore, it is still of great interest to develop principled methods for identifying chromatin states within and across multiple genomes.</p>
    <p>The cross-species chromatin state comparison problem was motivated by a recent model organism encyclopedia of DNA elements (modENDCODE) project that aims to systematically compare chromatin organization in <italic>Homo sapiens</italic> (human), <italic>Drosophila melanogaster</italic> (fly) and <italic>Caenorhabditis elegans</italic> (worm) (<xref rid="btv117-B15" ref-type="bibr">Ho <italic>et al</italic>., 2014</xref>). A naïve approach to this problem would be to compute the state map for each organism separately and then try to compare them afterward. However, this causes significant problems for interpretation because what was defined as an enhancer state in one organism is likely not identical with that from another organism. In the other extreme, we could simply concatenate the three genomes into one and infer states, but then the inferred result would be highly biased by the species with the largest genome size or by other species-specific biases in the ChIP-seq signals. Similar problems exist when comparing multiple developmental stages or cell types in the same organism. In essence, we require a method that allows the information of the state definition to be shared across multiple genomes while retaining the ability for each genome to have its own chromatin state definition.</p>
    <p>In the context of that project, we developed a novel Bayesian non-parametric method, called hierarchically linked infinite HMM (hiHMM), to infer chromatin state maps across multiple genomes simultaneously. The application of hiHMM in the human/fly/worm cross-species comparison setting indicates that the chromatin state segmentations in individual organisms generated by hiHMM are highly comparable to the maps generated by ChromHMM (<xref rid="btv117-B8" ref-type="bibr">Ernst and Kellis, 2010</xref>, <xref rid="btv117-B9" ref-type="bibr">2012</xref>) and Segway (<xref rid="btv117-B16" ref-type="bibr">Hoffman <italic>et al</italic>., 2012</xref>)—two widely used chromatin state segmentation algorithms (<xref rid="btv117-B15" ref-type="bibr">Ho <italic>et al</italic>., 2014</xref>). Furthermore, hiHMM is designed to address species-specific confounding factors such as variations in ChIP signal strength, genome size and co-occurrence patterns. In this article, we will present the method in detail as well as demonstrating the utility of this method using a variety of simulated and real data.</p>
  </sec>
  <sec>
    <title>2 Materials and Methods</title>
    <sec>
      <title>2.1 Statistical model for joint chromatin state inference</title>
      <p>To address the problem of inferring consistent chromatin state definition across multiple related genomes, we employ an infinite HMM (iHMM) (<xref rid="btv117-B2" ref-type="bibr">Beal <italic>et al</italic>., 2002</xref>), a non-parametric extension of a finite state HMM, as a base model and extend it to model data from multiple conditions. For ease of model description, we consider the problem of chromatin state segmentation on <italic>multi-species</italic> histone modification data, in which case multiple conditions correspond to multiple species. The same statistical model can be used to describe data from different types of conditions such as multiple developmental stages or cell types.</p>
      <sec>
        <title>2.1.1 Background on chromatin state segmentation using HMM</title>
        <p>We begin our model description by introducing the traditional HMM for single species data. Let <inline-formula><mml:math id="MM2"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Y</mml:mi></mml:mstyle><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> be an <italic>m</italic> × <italic>T</italic> matrix for histone modification data for <italic>m</italic> chromatin marks measured at <italic>T</italic> contiguous locations along the genome. Each <inline-formula><mml:math id="MM3"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mi>m</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> corresponds to the observation data at genomic location <italic>t</italic>. In a traditional HMM assuming <italic>K</italic> hidden states, each genomic location <italic>t</italic> is associated with a hidden chromatin state <inline-formula><mml:math id="MM4"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> from which the observation data <inline-formula><mml:math id="MM5"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is generated. We assume that <inline-formula><mml:math id="MM6"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> follows a multivariate Gaussian distribution conditioned on its hidden state <italic>s<sub>t</sub></italic> such that <inline-formula><mml:math id="MM7"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for <inline-formula><mml:math id="MM8"><mml:mrow><mml:msub><mml:mi mathvariant="bold">µ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mi>m</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM9"><mml:mrow><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> for <inline-formula><mml:math id="MM10"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>. The parameter <inline-formula><mml:math id="MM11"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> corresponds to the mean signal strengths from state <italic>k</italic> for <italic>m</italic> marks. The transition probabilities between hidden states are defined by the transition matrix <inline-formula><mml:math id="MM12"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>π</mml:mi></mml:mstyle><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi><mml:mrow><mml:mi>K</mml:mi><mml:mo>×</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> such that <inline-formula><mml:math id="MM13"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The segmentation by the chromatin states then can be naturally obtained from the hidden state sequence <inline-formula><mml:math id="MM14"><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The hidden state sequence can be inferred by the Viterbi algorithm (<xref rid="btv117-B13" ref-type="bibr">Forney, 1973</xref>).</p>
      </sec>
      <sec>
        <title>2.1.2 Extension to hiHMM</title>
        <p>To obtain a consistent state definition for principled comparison of chromatin states between multiple species, we propose to model the multi-species data by using an iHMM as a base model for each species data and then by coupling species-specific iHMM parameters together, so that state definition can be shared across species.</p>
        <p>Under an iHMM (<xref rid="btv117-B2" ref-type="bibr">Beal <italic>et al</italic>., 2002</xref>; <xref rid="btv117-B29" ref-type="bibr">Teh <italic>et al</italic>., 2006</xref>), an infinite number of hidden states is assumed <italic>a priori</italic>, and then the number of hidden states is inferred by posterior inference from given data. An infinite dimensional transition matrix <inline-formula><mml:math id="MM15"><mml:mi>π</mml:mi></mml:math></inline-formula> and an infinite number of emission parameters of <inline-formula><mml:math id="MM16"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM17"><mml:mrow><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for <inline-formula><mml:math id="MM18"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>…</mml:mn></mml:mrow></mml:math></inline-formula> are defined as follows. Each row <inline-formula><mml:math id="MM19"><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> of the transition matrix follows the so-called Dirichlet process (DP), which defines a probability distribution on a countably infinite dimensional space of <inline-formula><mml:math id="MM20"><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> (<xref rid="btv117-B6" ref-type="bibr">Blackwell and MacQueen, 1973</xref>; <xref rid="btv117-B11" ref-type="bibr">Ferguson, 1973</xref>). Formally, we have <inline-formula><mml:math id="MM21"><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>D</mml:mi><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> where β is the base measure (‘mean’ of the DP) and α<sub>0</sub> is a scale parameter controlling the concentration around the base measure. To couple each row of the transition matrix, so that the state definition can be shared across rows, a common base measure β of another DP is used, which we denote <inline-formula><mml:math id="MM22"><mml:mrow><mml:mi>β</mml:mi><mml:mo>∼</mml:mo><mml:mi>G</mml:mi><mml:mi>E</mml:mi><mml:mi>M</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>γ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for a hyper-parameter γ under a stick-breaking process [for more details, refer to <xref rid="btv117-B29" ref-type="bibr">Teh <italic>et al</italic>. (2006)</xref>]. For each state <italic>k</italic>, the emission parameter <inline-formula><mml:math id="MM23"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is sampled from a prior probability <italic>H</italic><italic>,</italic> which we assume to be a normal distribution <inline-formula><mml:math id="MM24"><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>), where <inline-formula><mml:math id="MM25"><mml:mrow><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> is the initial covariance matrix.</p>
        <p>In addition to the flexibility of allowing an infinite number of states a priori, an iHMM has the advantage that it naturally extends to a more general model in which multiple iHMMs can be coupled together. Suppose we have chromatin data from multiple, say <italic>C</italic>, species. Let <inline-formula><mml:math id="MM26"><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:mi>C</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> denote the species indicator. Random variables <inline-formula><mml:math id="MM27"><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM28"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> represent the hidden state and the observation data, respectively, at locus <italic>t</italic> in species <italic>c</italic>. We associate each species data with its own transition matrix <inline-formula><mml:math id="MM29"><mml:mrow><mml:msup><mml:mi>π</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, such that each row of <inline-formula><mml:math id="MM30"><mml:mrow><mml:msup><mml:mi>π</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> follows the same DP across different rows and different species. Two versions of emission parameters are considered—one that assumes a species-specific emission matrix (Model 1) and the other assuming a common emission matrix across species (Model 2). The generative model for Model 1 can be formulated as follows:
<disp-formula><mml:math id="MM31"><mml:mrow><mml:mi>β</mml:mi><mml:mo>∼</mml:mo><mml:mi>G</mml:mi><mml:mi>E</mml:mi><mml:mi>M</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>γ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula><mml:math id="MM32"><mml:mrow><mml:msubsup><mml:mi>π</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∼</mml:mo><mml:mi>D</mml:mi><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>β</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula><mml:math id="MM33"><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">|</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∼</mml:mo><mml:msubsup><mml:mi>π</mml:mi><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></disp-formula>
<disp-formula id="btv117-M1"><label>(1)</label><mml:math id="MM34"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∼</mml:mo><mml:mi>H</mml:mi><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="btv117-M2"><label>(2)</label><mml:math id="MM35"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">|</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mi mathvariant="bold">Σ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>
For simplicity, we may assume <inline-formula><mml:math id="MM36"><mml:mrow><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM37"><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow></mml:math></inline-formula> for real-valued <inline-formula><mml:math id="MM38"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM39"><mml:mrow><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> and an identity matrix <inline-formula><mml:math id="MM40"><mml:mi mathvariant="double-struck">I</mml:mi></mml:math></inline-formula>. The formulation for Model 2 is similar to the equations above except that <xref ref-type="disp-formula" rid="btv117-M1">Equations (1)</xref> and <xref ref-type="disp-formula" rid="btv117-M2">(2)</xref> are replaced by:
<disp-formula><mml:math id="MM41"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mi>k</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">Σ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula><mml:math id="MM42"><mml:mrow><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>y</mml:mi></mml:mstyle><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">|</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>µ</mml:mi></mml:mstyle><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">Σ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>
Note that the parameters are more tightly coupled in Model 2 than in Model 1 in which species-specific parameters are weakly coupled through a prior. We denote the proposed model as a hiHMM. A similar formulation that extends an iHMM to handle multi-population data was first introduced with application to the local ancestry estimation problem (<xref rid="btv117-B28" ref-type="bibr">Sohn <italic>et al</italic>., 2012</xref>) but with a different emission model and for a different data type.</p>
      </sec>
      <sec>
        <title>2.1.3 Explicit control for self-transition probability</title>
        <p>Dependencies among neighboring genomic locations may be better reflected by introducing an explicit self-transition probability. To implement this idea, we modify the transition probability as follows:
<disp-formula><mml:math id="MM43"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>1</mml:mn></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>π</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></disp-formula>
where <inline-formula><mml:math id="MM44"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> denotes the self-transition probability in species <italic>c</italic>, and <inline-formula><mml:math id="MM45"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>1</mml:mn></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> if <italic>k</italic> = <italic>j</italic> and 0 otherwise. We expect this model to prevent the excessive transitions between locations and to help accommodate different genome sizes and the resulting self-transition probabilities between species. The graphical representation for the final model is shown in <xref ref-type="fig" rid="btv117-F1">Figure 1</xref>.
<fig id="btv117-F1" position="float"><label>Fig. 1.</label><caption><p>Graphical representation of hiHMM models 1 and 2</p></caption><graphic xlink:href="btv117f1p"/></fig>
</p>
      </sec>
      <sec>
        <title>2.1.4 Posterior inference</title>
        <p>We employ a dynamic-programming technique called Beam sampling (<xref rid="btv117-B30" ref-type="bibr">Van Gael <italic>et al</italic>., 2008</xref>) for efficient posterior inference dealing with an infinite number of hidden states. It adaptively changes the number of states over iterations, so at each iteration, it tries to increase the state space, and based on the new parameters with increased number of states, the hidden state sequence is sampled. Then we check whether there is a hidden state having no association. We remove those states from our state space. On the basis of this new hidden state sequence, we re-sample HMM parameters. We repeat this until <italic>L<sub>i</sub></italic>, the mean of the last <italic>m</italic> posterior samples at <italic>i</italic>th iteration, converges. That is, the convergence criteria is <inline-formula><mml:math id="MM46"><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mo>/</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>1.0</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. The other iHMM parameters and the self-transition probabilities are inferred by Gibbs sampling.</p>
      </sec>
      <sec>
        <title>2.1.5 Parameter initialization</title>
        <p>Like most HMM-based learning methods, using good initial parameters is important in obtaining good learning outcome. To obtain reasonable initial emission and transition matrices, we first concatenate all genomes together and perform a <italic>k</italic>-mean clustering step. This also encourages coupling of emission matrices in different species in case of Model 1.</p>
      </sec>
    </sec>
    <sec>
      <title>2.2 Simulations</title>
      <sec>
        <title>2.2.1 Simulation scenarios</title>
        <p>We first demonstrate the main benefit of the proposed models on simulated datasets. The simulation scenarios are mainly motivated by a recent modENCODE project that compares the chromatin organization in human, fly and worm to reveal common and species-specific chromatin states (<xref rid="btv117-B15" ref-type="bibr">Ho <italic>et al</italic>., 2014</xref>). We simulated histone modification data with <italic>M</italic> = 8 marks from <italic>C</italic> = 3 species (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S1</ext-link>). The transition matrix and the emission parameters are simulated under various scenarios below. Non-zero elements in the emission matrix correspond to the enriched marks. At each parameter setting, a hidden state sequence and the corresponding observation sequence of length <italic>T</italic> is generated under the standard HMM model per species, and this is repeated 50 times.</p>
        <p>We describe the default simulation setting for the HMM parameters first. For each state <italic>k</italic> among the assumed <italic>K</italic> hidden states, one or two histone marks are randomly chosen to have non-zero signal for all the species. The average signal strength <italic>s<sub>km</sub></italic> of each enriched mark <italic>m</italic> in state <italic>k</italic> is randomly sampled from uniform distribution <italic>U</italic>(1, 4) for <inline-formula><mml:math id="MM47"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and from <inline-formula><mml:math id="MM48"><mml:mrow><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0.05</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for <italic>k</italic> = <italic>K</italic> to simulate a chromatin state with low signal. As the dynamic range of ChIP-seq signal may not be identical across species due to technical differences, we further incorporate a discrepancy parameter ρ, such that the signal strength for the mark in species <italic>c</italic> is defined as <inline-formula><mml:math id="MM49"><mml:mrow><mml:msubsup><mml:mi>µ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> if <italic>c</italic> = 1 and <inline-formula><mml:math id="MM50"><mml:mrow><mml:msubsup><mml:mi>µ</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mi>ρ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> for <inline-formula><mml:math id="MM51"><mml:mrow><mml:mi>c</mml:mi><mml:mo>≥</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>. We keep ρ relatively small compared with the average signal strength in <italic>U</italic>(1, 4); <inline-formula><mml:math id="MM52"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula> in most scenarios below except for one scenario to examine the performance behavior with respect to ρ. Finally, we set one state as species specific by making one of the enriched marks at the state as un-enriched (i.e. signal strength of zero) for species <inline-formula><mml:math id="MM53"><mml:mrow><mml:mi>c</mml:mi><mml:mo>≥</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>. The transition parameter is defined as <inline-formula><mml:math id="MM54"><mml:mrow><mml:msup><mml:mi>π</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msub><mml:mi mathvariant="double-struck">I</mml:mi><mml:mi>K</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>π</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="MM55"><mml:mrow><mml:msubsup><mml:mi>π</mml:mi><mml:mn>0</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="MM56"><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> is a random sparse matrix with 30% of randomly uniformly distributed non-zero elements and constant across species and <inline-formula><mml:math id="MM57"><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is a random sparse matrix with 10% of non-zero elements, which are species-specifically sampled. We normalize each row of <inline-formula><mml:math id="MM58"><mml:mrow><mml:msup><mml:mi>π</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> to have row-sum of one. <inline-formula><mml:math id="MM59"><mml:mrow><mml:msub><mml:mi mathvariant="double-struck">I</mml:mi><mml:mi>K</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is an identity matrix of size <italic>K</italic> × <italic>K</italic>. We fix <italic>K</italic> at 10.<statement><title>Scenario I</title><p>We examine the effect of different genome size. The following three settings are considered in which either the genome size <italic>T</italic> or the self-transition probability <italic>p</italic><sub>0</sub> varies between species. We fix ρ at 0.1.
<list list-type="bullet"><list-item><p>Scenario I-1: The same genome size of <inline-formula><mml:math id="MM60"><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2000</mml:mn><mml:mo>,</mml:mo><mml:mn>2000</mml:mn><mml:mo>,</mml:mo><mml:mn>2000</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, for each of the three species, and the same average self-transition probability <inline-formula><mml:math id="MM61"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0.9</mml:mn><mml:mo>,</mml:mo><mml:mn>0.9</mml:mn><mml:mo>,</mml:mo><mml:mn>0.9</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p>Scenario I-2: Different genome size of <inline-formula><mml:math id="MM62"><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2000</mml:mn><mml:mo>,</mml:mo><mml:mn>5000</mml:mn><mml:mo>,</mml:mo><mml:mn>10000</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and the same self-transition probability <inline-formula><mml:math id="MM63"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0.9</mml:mn><mml:mo>,</mml:mo><mml:mn>0.9</mml:mn><mml:mo>,</mml:mo><mml:mn>0.9</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p></list-item><list-item><p>Scenario I-3: Different genome size <inline-formula><mml:math id="MM64"><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2000</mml:mn><mml:mo>,</mml:mo><mml:mn>5000</mml:mn><mml:mo>,</mml:mo><mml:mn>10000</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and different self-transition probability <inline-formula><mml:math id="MM65"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0.7</mml:mn><mml:mo>,</mml:mo><mml:mn>0.8</mml:mn><mml:mo>,</mml:mo><mml:mn>0.9</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p></list-item></list></p></statement><statement><title>Scenario II</title><p>We study the effect of different ChIP-seq signal strength across species. We vary ρ from 0.1 to 0.5 by step size of 0.2. The genome size and the self-transition probability were the same as those in scenario I-1 in which the genome size and the self-transition probabilities are the same across species.</p></statement><statement><title>Scenario III</title><p>The effect of the number of species-specific states is studied in this scenario. We vary the number of species-specific states <italic>n</italic> from 0 to 2. The other parameters were the same as in scenario I-1.</p></statement></p>
      </sec>
      <sec>
        <title>2.2.2 Performance comparison</title>
        <p>We compare the hiHMM Model 1 (hiHMM1) and Model 2 (hiHMM2) with an iHMM combined with the self-transition model introduced in section 2.1.3 (iHMM+p0) that assumes a common emission matrix and a common transition matrix for all species, the iHMM without such additional self-transition model (iHMM), so that transition probabilities are defined as <inline-formula><mml:math id="MM66"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mi>π</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and the existing methods of ChromHMM and Segway. In hiHMM 1 and hiHMM2, we set the initial number of states <italic>K</italic><sub>0</sub> as 7, the variance parameters of <inline-formula><mml:math id="MM67"><mml:mrow><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="MM68"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. The traditional HMMs with <italic>K</italic> = 10, 13, 16 states are also compared for which a Matlab toolbox for HMM written by <italic>K</italic>. Murphy was used in its default setting (<ext-link ext-link-type="uri" xlink:href="http://www.cs.ubc.ca/murphyk/Software/HMM/hmm.html"><monospace>http://www.cs.ubc.ca/murphyk/Software/HMM/hmm.html</monospace></ext-link>) except that the full covariance matrix is assumed. In all cases other than hiHMM1 and hiHMM2, genomes from different species were concatenated as one sequence and used as input.</p>
        <p>The segmentation performance is compared in two main aspects: the accuracy of clustering genomic loci by hidden state labels and the segment boundary detection accuracy. We use the adjusted Rand Index (RI) for the former, and the <italic>F</italic>-measure computed from precision and recall for the latter. RI (<xref rid="btv117-B26" ref-type="bibr">Rand, 1971</xref>) is a traditional measure for clustering accuracy and considers the number of pairs of samples whose labels are correctly assigned, that is the number of pairs that are in the same (or different) cluster (i.e. the same hidden state) both under the ground truth and under the estimated labels. The adjusted RI is the normalized difference of the RI and its expected value under the null hypothesis, so that the expected value of two random partitions becomes zero (<xref rid="btv117-B19" ref-type="bibr">Hubert and Arabie, 1985</xref>).</p>
        <p>For segment boundary detection accuracy, precision is defined as the number of true boundaries among detected boundaries divided by the total number of detected boundaries, and recall is the number of true boundaries among detected boundaries divided by the total number of true boundaries. <italic>F</italic> measure is the harmonic mean of precision and recall, that is, <inline-formula><mml:math id="MM69"><mml:mrow><mml:mi>F</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mtext>(precision·recall</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>precision+recall</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      </sec>
    </sec>
    <sec>
      <title>2.3 Real data applications</title>
      <sec>
        <title>2.3.1 Running hiHMM on fly and worm ChIP-seq data</title>
        <p>The fly (genome assembly version dm3) and worm (genome assembly version WS220) ChIP-seq and RNA-seq data were generated by modENCODE consortia. All input-normalized ChIP-seq signal tracks were downloaded from the ENCODE-X interactive faceted browser: <ext-link ext-link-type="uri" xlink:href="http://encode-x.med.harvard.edu/data_sets/chromatin/">http://encode-x.med.harvard.edu/data_sets/chromatin/</ext-link>. The original fly and worm ChIP-seq data were in 10-bp resolution. All tracks were re-binned to 100 bp resolution by taking the mean of 10 consecutive bins. Data from multiple histone modifications were concatenated as columns into a tab-delimited format. Bins that overlapped unmappable regions were removed (mappability regions were downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/comparative/chromatin/#mappability">https://www.encodeproject.org/comparative/chromatin/#mappability</ext-link>).</p>
        <p>hiHMM was run in Matlab with default parameters: 200 burn-in iterations, which means the first 200 samples, are discarded during iterations for posterior inference and then 10 consecutive posterior samples are collected to produce the final Maximum-A-Posterior output. For each comparison, all available histone modification profiles produced by ChIP-seq experiments that are common across the targeted species and cell types were used (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Table S1</ext-link>). Chromatin states were trained on representative fly chromosomes 2 L, 2LHet, X and XHet and worm chromosomes II, III and X, as per the modENCODE study (<xref rid="btv117-B15" ref-type="bibr">Ho <italic>et al</italic>., 2014</xref>). Our prior experience suggests that training with all or only this representative subset of chromosomes in these organisms make very little difference in terms of the resulting chromatin state definition. Nonetheless, the hiHMM program is scalable to analyze all the chromosomes—which would be useful for exploring any previously uncharacterized chromatin landscapes.</p>
        <p>Emission matrices from hiHMM output were examined and states were named based on chromatin state definitions in previous studies as well as overlap with expressed or unexpressed genes (<xref rid="btv117-B10" ref-type="bibr">Ernst <italic>et al</italic>., 2011</xref>; <xref rid="btv117-B21" ref-type="bibr">Kharchenko <italic>et al</italic>., 2011</xref>) (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Figs. S2</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">S3</ext-link>). A custom R script is used to rename the states and re-introduce unmappable regions as State 0.</p>
      </sec>
      <sec>
        <title>2.3.2 Chromatin state statistics</title>
        <p>Genomic coverage was calculated as the percentage of the mappable genome that is occupied by each state, at the bin level. Expression odds ratio was calculated as the ratio of the number of expressed versus silent genes that overlapped with each chromatin state, divided by the genome-wide ratio of the number of expressed versus silent genes. A gene was considered expressed if its mRNA expression levels were &gt;1 RPKM (Reads Per Kilobase per Million mapped reads). Gene body overlap was calculated as the percentage of bins annotated to each chromatin state that occur between the transcription start site (TSS) and transcription end site (TES) of an annotated gene.</p>
      </sec>
      <sec>
        <title>2.3.3 Meta-gene chromatin state enrichment profile</title>
        <p>A meta-gene matrix was constructed from all annotated protein coding genes that were at least 1300 bp in length and do not overlap another gene within 500 bp of its TSS or TES. Protein-coding gene annotation was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/comparative/transcriptome/">https://www.encodeproject.org/comparative/transcriptome/</ext-link>. We further excluded genes that occurred within 1000 bp of a chromosome start or end. The meta-gene matrix contains the chromatin state annotations of each ‘representative’ gene extending to 500 bp upstream of the TSS and 500 bp downstream of the TES. Enrichment profiles are presented as heatmaps where the color indicates the percentage of genes that have been annotated with that particular chromatin state at that relative genomic position. Meta-gene profiles of expressed and silent genes were computed separately.</p>
      </sec>
      <sec>
        <title>2.3.4 Inter-sample chromatin state co-occurrence</title>
        <p>Fold change was calculated as the observed number of bins that transitioned between any two chromatin state annotations divided by the expected number. The expected number was the mean number of bin transitions between those two states in 1000 Monte Carlo simulations with a randomized chromatin state assignment, preserving the relative genomic coverage of each state. Fold change was truncated between one and five for simplified visualization and interpretation.</p>
      </sec>
      <sec>
        <title>2.3.5 Co-occurrence matrices</title>
        <p>Co-occurrence of genomic chromatin state annotation between experiments was calculated as the number of bins that were annotated as a particular chromatin state combination in two experiments divided by the total number of bins annotated to those states in the respective experiments. This gives a value between 0 and 1, which is presented in a heatmap.</p>
      </sec>
      <sec>
        <title>2.3.6 Gene ontology enrichment of target genes in a region</title>
        <p>Official gene symbols for all genes that overlapped with the selected regions were submitted to the DAVID bioinformatics tool (<xref rid="btv117-B18" ref-type="bibr">Huang <italic>et al</italic>., 2009</xref>). The Benjamini adjusted <italic>P</italic> value (<xref rid="btv117-B3" ref-type="bibr">Benjamini and Hochberg, 1995</xref>) of the 10 most significant gene ontology (GO) biological process results are presented for each analysis.</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>3 Result</title>
    <sec>
      <title>3.1 Simulation study</title>
      <sec>
        <title>3.1.1. An illustrative example</title>
        <p>We compare the true simulated emission matrices and the estimated ones by each algorithm on an example dataset with <italic>K</italic> = 10 chromatin states model (<xref ref-type="fig" rid="btv117-F2">Fig. 2</xref>). The true model contains two species-specific states (State 5 and State 9) that have species-specific mark combinations. Therefore, the actual number of distinct chromatin states across all the species can be viewed as 12. The genome size <italic>T</italic> was 2000, 5000 and 10 000 for each of the three species.
<fig id="btv117-F2" position="float"><label>Fig. 2.</label><caption><p>An illustrative example using a toy simulated dataset. The heatmaps show the emission parameters of the ground truth with <italic>K</italic> = 10 chromatin states in three species (top panel) and the hiHMM and HMM estimated parameters. As State 5 (green box) and State 9 (cyan box) have different combinations of enriched marks between species, the number of distinct chromatin states across all the species is 12. Model 1 recovers the correct number of states and the enriched marks. Model 2 recovered one of the two species-specific state but missed the species-1-specific State 5. The standard HMMs miss three states even when a large <italic>K</italic> is assumed</p></caption><graphic xlink:href="btv117f2p"/></fig>
</p>
        <p>As shown in <xref ref-type="fig" rid="btv117-F2">Figure 2</xref>, Model 1 recovers the correct number of hidden states and the correct mark combination. Model 2 recovers one species-specific state correctly (State 9 in a cyan box <xref ref-type="fig" rid="btv117-F2">Fig. 2</xref>), but it misses the mark combination of the species-1-specific State 5 (green box in <xref ref-type="fig" rid="btv117-F2">Fig. 2</xref>), possibly due to the shorter genome length of species 1, resulting in lower overall representation of the state during joint learning. Instead, two states corresponding to State 1 are recovered with slightly different signal strengths. This appears to happen because the average signal strength is not identical between species. In contrast, Model 1 correctly recovers all the states as it allows species-specific emission matrix that can have different signal strength.</p>
        <p>The standard HMMs fail to recover species-specific states even when a large <italic>K</italic> of 16 was assumed. For example, although the signal of the second mark in State 5 for species 1 is relatively strong, standard HMMs either miss the state completely (the case of <italic>K</italic> = 10) or the recovered signal is very weak (cases of <italic>K</italic> = 13, 16). Again, this seems to be because of the shorter genome size of species 1 and its relatively low coverage. Moreover, State 9 in species 2 is completely missing in all cases of <italic>K</italic> = 10, 13, 16 possibly because it is specific to species 2 and its coverage is very low (1.7%). In summary, a standard HMM fails to recover the correct states, likely due to the existence of species-specific states, different genome size and possibly different ChIP-seq signal range.</p>
      </sec>
      <sec>
        <title>3.1.2 Comparison of segmentation accuracy</title>
        <p>The overall performance over 50 simulated datasets per parameter setting across scenarios is compared in terms of the adjusted RI between the true state labels and the estimated ones, and the segment boundary detection accuracy of <italic>F</italic>-measure. <xref ref-type="fig" rid="btv117-F3">Figure 3</xref> shows boxplots for the accuracy of each algorithm (<xref ref-type="fig" rid="btv117-F3">Fig. 3</xref>A: scenario I, B: scenario II, C: scenario III).
<fig id="btv117-F3" position="float"><label>Fig. 3.</label><caption><p>Performance comparison on simulated datasets based on three aspects: (<bold>A</bold>) the effect of different genome size (scenario I), (<bold>B</bold>) the effect of different ChIP-seq signal strength between species (scenario II) and (<bold>C</bold>) the effect of the number of species-specific states (scenario III). The plots in the top row show the <italic>F</italic>-measure for the segment boundary detection, and the plots in the bottom row show the clustering accuracy by segment labels in terms of adjusted RI. Note that iHMM+p0 and iHMM correspond to the plain iHMM combined with or without the self-transition model introduced in Section 2.1.3, respectively</p></caption><graphic xlink:href="btv117f3p"/></fig>
</p>
        <p>Both Model 1 (hiHMM1) and Model 2 (hiHMM2) perform superior or comparable to the other algorithms across all the scenarios. HMM with <italic>K </italic>= 13 or 16 in which the assumed number of states is larger than the true number of states consistently perform the worst especially in terms of <italic>F</italic>-measure for the boundary detection accuracy. The traditional HMMs and ChromHMM tend to over-segment the genome and produce a large number of false-positive segment boundaries, resulting in low precision. When comparing hiHMM1 and hiHMM2, their performances are comparable overall in both aspects. When the signal strength variation ρ is low, hiHMM2 outperforms hiHMM1 in terms of clustering accuracy (e.g. <italic>P</italic> value of 0.02 from a paired <italic>t</italic>-test in case of scenario II-1), but as the discrepancy increases, hiHMM1 significantly outperforms hiHMM2 with a <italic>P</italic> value &lt; <inline-formula><mml:math id="MM70"><mml:mrow><mml:mn>2.2</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mn>16</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="btv117-F3">Fig. 3</xref>B). We find that the performance change of each algorithm is the most dominant in scenario II for which the signal strength variation ρ is changed.</p>
        <p>Regarding computation time, hiHMM1 or hiHMM2 each took less than 2 min on average per simulation dataset (scenario I-1) in a single Intel(R) Xeon(R) CPU E5-2650 (8-core, 2.00 GHz) with 32 GB RAM (DDR3, 1600 MHz) and CentOS 6.4 (64-bit architecture), which is shorter than that from Segway (around 3 ∼ 4 min) but longer than that from ChromHMM (&lt;1 min).</p>
      </sec>
    </sec>
    <sec>
      <title>3.2 Real data analysis</title>
      <sec sec-type="cases">
        <title>3.2.1 Case study 1: hiHMM identifies species-specific chromatin states in fly and worm</title>
        <p>The analogous developmental stage of stage 3 larva (L3) in fly and worm was selected for this cross-species chromatin state analysis. hiHMM was run using 25 starting states with Models 1 and 2 on the combined data and 30 starting states using Model 2 to capture more species-specific states.</p>
        <p>Chromatin state analysis of fly L3 versus worm L3 shows both shared and unique patterns of chromatin mark co-occurrence between the two species (<xref ref-type="fig" rid="btv117-F4">Fig. 4</xref>A). We found 25 states that grouped into six categories: promoters, enhancers, gene body, heterochromatin, repressed and low signal. Most states are conserved and have similar compositions but with some clear differences. Fly promoter states (red) show a distinct lack of H3K23ac when compared with worm (green highlight in <xref ref-type="fig" rid="btv117-F4">Fig. 4</xref>A). Conversely, worm promoter states lack H3K79me1 when compared with fly (BLACK highlight in <xref ref-type="fig" rid="btv117-F4">Fig. 4</xref>A). Genic and transcription states (green) in fly show enrichment of H4K16ac, H3K79me1 and H4K20me1, all of which are largely absent in the same states in worm (orange highlight in <xref ref-type="fig" rid="btv117-F4">Fig. 4</xref>A). H4K8ac, on the other hand, is enriched in these states in worm but completely absent in fly (yellow highlight in <xref ref-type="fig" rid="btv117-F4">Fig. 4</xref>A). Further differences are visible in the repressed (purple) and heterochromatin (black) states. In fly, there is a clear differentiation of repressive histone modifications between the two state classes, whereas the marks consistently co-occur in worm (purple highlight in <xref ref-type="fig" rid="btv117-F4">Fig. 4</xref>A). To verify that these differences were representative of the data and not simply training errors, we examined the data in a genome browser and visually confirmed the differences (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Figs. S4–S6</ext-link>).
<fig id="btv117-F4" position="float"><label>Fig. 4.</label><caption><p>Cross-species chromatin state analysis. (<bold>A</bold>) ChIP signal matrix showing the average observed histone modification profiles for each of 25 states inferred by the hiHMM algorithm (Model 1) in fly and worm. Species-specific differences are highlighted. (<bold>B</bold>) Percentage of genome covered by the state (coverage), relative enrichment of expressed genes per state (expression odds ratio) and the percentage of state annotations that occur between the TSS and TES of annotated genes (gene body overlap)</p></caption><graphic xlink:href="btv117f4p"/></fig>
</p>
        <p>To compare the performance of hiHMM Model 1s and 2, we also learned a shared chromatin state definition using Model 2 (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S7</ext-link>). Increasing the number of states from 25 to 30 allowed for the identification of a greater number of species-specific states, apparent from an absence of the state (0 genomic coverage) in one species (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S8</ext-link>). When examining the state co-occurrence matrix between the two models, there are obvious anomalies in species-specific states 10 and 12 (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S9</ext-link>).</p>
      </sec>
      <sec sec-type="cases">
        <title>3.2.2 Case study 2: hiHMM identifies developmental stage-specific loci in fly</title>
        <p>Three fly developmental stages were chosen for chromatin state comparison: late embryo (EL), third instar larvae (L3) and adult head (AH). hiHMM was run on the combined datasets using 25 starting states with Models 1 and 2.</p>
        <p>Jointly learned average ChIP signal matrices for three developmental stages in fly show that the majority of observed histone modification combinations and their genomic occurrence remain stable during development (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Figs. S10</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">S11</ext-link>). H3K79me1, however, shows a marked reduction in enrichment in active states in AH compared with EL and L3 stages (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S12</ext-link>). Although this difference is interesting, it is secondary to our ensuing analysis of differential state co-occurrence during development. Examining the co-occurrence between Models 1 and 2 shows a very high level of concordance, so we continue the analysis using the shared chromatin state definition learned by Model 2 (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S13</ext-link>).</p>
        <p>Using these chromatin state maps, we implemented an unbiased approach for identifying developmentally regulated genes from chromatin state co-occurrence between two developmental stages—EL and AH—in fly (<xref ref-type="fig" rid="btv117-F5">Fig. 5</xref>). In total, 1659 genes from regions that transitioned from an active (promoter, enhancer, gene) state in EL to an inactive (repressed, heterochromatin, low signal) state in AH (<xref ref-type="fig" rid="btv117-F5">Fig. 5</xref>C, top right) were strongly enriched for multiple developmental GO terms, including ‘Respiratory system development’ (<italic>P</italic> value 1.66 × 10<sup>−</sup><sup>8</sup>) (<xref ref-type="fig" rid="btv117-F5">Fig. 5</xref>D). Similarly, 1889 genes that changed from inactive in EL to active in AH (<xref ref-type="fig" rid="btv117-F5">Fig. 5</xref>C, bottom left) were strongly enriched for terms expected from a fully developed organism, including ‘Transmission of nerve impulse’ (<italic>P</italic> value 1.48 × 10<sup>−</sup><sup>7</sup>). These transitions in developmental regulation are clearly visible in a genome browser when the chromatin state tracks are visualized (<xref ref-type="fig" rid="btv117-F5">Fig. 5</xref>E).
<fig id="btv117-F5" position="float"><label>Fig. 5.</label><caption><p>Chromatin state characterization and analysis across developmental stages in fly. (<bold>A</bold>) ChIP signal matrix showing the average observed histone modification profiles for each of 25 states jointly inferred by the hiHMM algorithm (Model 2) for three stages of fly development: late embryo (EL), stage 3 larvae (L3) and adult head (AH). (<bold>B</bold>) Percentage of genome covered by the state (coverage), relative enrichment of expressed genes per state (expression odds ratio) and the percentage of state annotations that occur between the TSS and TES of annotated genes (gene body overlap). (<bold>C</bold>) Chromatin state co-occurrence between two developmental stages in fly (EL and AH). The observed versus expected fold change of the co-occurrence of each state in EL and each state in AH is shown. On the basis of this analysis, we selected significantly over represented co-occurrence regions to investigate and characterize the genes involved through gene set enrichment analyses. (<bold>D</bold>) Genome browser views of representative genes Ubx and Oamb with three stage chromatin states. These genes were identified through chromatin state co-occurrence analysis as having different chromatin states in EL and AH. (<bold>E</bold>) The top 10 GO biological processes enriched in the genes that are within regions of the genome that changed from an active state in EL to a repressive state it AH (top panel) or vice versa (bottom panel)</p></caption><graphic xlink:href="btv117f5p"/></fig>
</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>The main innovation of our approach is that it provides a flexible framework to enable information sharing between multiple HMMs. The main difficulty of joint analysis of related datasets is how to obtain a consistent state definition or the mapping between a set of states defined in one species and the one in another species. If one were to apply iHMM separately on each of the datasets, we face the problem of mapping state definitions between species. The proposed hiHMM solves this problem by assuming a common state space definition across all the datasets. It is one of the main advantages of using the non-parametric model based on the so-called hierarchical DP, which is the core component of iHMM. Under a hierarchical DP prior for data from multiple groups, each group is associated with a group-specific DP and then those DPs share a common base measure that is another DP. This is the major mechanism how the atoms from each DP can be shared across groups. Model 1 couples the state definition more loosely than Model 2 since in Model 1 information is shared via the prior only, whereas Model 2 explicitly employs a shared emission matrix.</p>
    <p>One distinguishing feature of hiHMM is that we can jointly infer emission values for genomes of differing lengths without the dominating influence of a longer genome on the result or the need to perform compensatory subsampling during training. This is a major limitation of existing methods that concatenate multiple samples for joint learning that is overcome using hiHMM.</p>
    <p>Similar to Segway or the HMM approach of <xref rid="btv117-B21" ref-type="bibr">Kharchenko <italic>et al</italic>. (2011)</xref>, hiHMM directly models continuous ChIP signal values and therefore alleviate the need of selecting a binary threshold cutoff. We observe that this feature is potentially important for differentiating within a class of similar states, highlighted by the interesting and diverse characteristics we observe in low signal states (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S4</ext-link>).</p>
    <p>Both our simulated and real data analyses show that the advantages of Model 1 become more evident when the data discrepancy across different conditions is large, for example, in the case of multiple species data. In terms of revealing interesting biology, the ability to infer sample-specific emission matrix parameters (as in Model 1) allows for intuitive and detailed comparison of chromatin mark combinations between different species or cell types. This is evident from our 25 state analyses in fly versus worm in case study 1. In addition to the finding that fly and worm have different chromatin modifications compositions in heterochromatin, here we observed several previously unreported differences between the two species as described above, most notably the relative depletion of H3K23ac and enrichment of H3K79me1 in fly promoter states, as well as multiple differences in the transcription states. Model 1 was also useful in identifying the unexpected changes in the distribution of H3K79me1 during fly development. Many of these observations were not possible in previous studies that did not include these marks in their comparison (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Fig. S14</ext-link>), and they may suggest different mechanisms of genetic regulation between the two species.</p>
    <p>Jointly learned and shared emission matrix parameters (as generated by Model 2) provide an easily interpretable platform on which to compare multiple samples from the same genome without the confounding factor of different state definitions. Additionally, Model 2 enjoys better statistical properties such as faster convergence and shorter running time, so Model 2 would be a better choice when the discrepancy between genomes is expected to be relatively small as in the case of different developmental stages or environmental conditions in a single species.</p>
    <p>By applying hiHMM to this newly compiled dataset, we were able to identify two previously uncharacterized chromatin states that we have named ‘Repressed’ states in the fly development analysis (states 17 and 18 in <xref ref-type="fig" rid="btv117-F4">Fig. 4</xref>A). These two states combined constitute roughly 18% of the fly genome and are almost exclusively characterized by marks that were not profiled in previous studies, and so these states were missed.</p>
    <p>Although hiHMM allows learning the optimal number of states from the data in principle, the likelihood surface of the model over the used parameter space is quite flat. Therefore, similar posterior probability value can be obtained through different parameter value combinations, and this makes the recovery of the correct number of states still challenging. For systematic analysis of this issue, we examined the effect on the accuracy and the number of inferred states of three hyper-parameters: the initial number of states <italic>K</italic><sub>0</sub> and the two variance parameters: <inline-formula><mml:math id="MM71"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> in the prior distribution for the emission matrix and <inline-formula><mml:math id="MM72"><mml:mrow><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> for generating the observation signal given the hidden state and the emission matrix (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">Supplementary Figs. S15</ext-link> and <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/lookup/suppl/doi:10.1093/bioinformatics/btv117/-/DC1">S16</ext-link> for Model 1 and Model 2, respectively). The smaller <inline-formula><mml:math id="MM73"><mml:mrow><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> produced better segmentation accuracy, which is expected as the variance in the emission model should be small enough to assign the observation signal to the correct state. Assuming proper normalization by variance, <inline-formula><mml:math id="MM74"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> seems to produce the best result. The number of inferred states depended on all the three parameters but most significantly by <inline-formula><mml:math id="MM75"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula>. We see that <inline-formula><mml:math id="MM76"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> should be large enough to compactly capture the varying signals from enriched marks as the prior mean for the emission matrix is zero. For large <inline-formula><mml:math id="MM77"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> (&gt;2), the number of inferred states becomes less affected by other parameters. The deviation from the initial number of states to the inferred number is also mostly determined by <inline-formula><mml:math id="MM78"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> but not significantly by others. It appears to be a good practice to set <inline-formula><mml:math id="MM79"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>0</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> to be around the mean signal strength of the enriched marks. The initial number of states should be selected close to the true number of states. Automatic estimation of these hyper-parameters would need further investigation in our future work.</p>
    <p>Another important issue is to get a reasonably good initial state assignment, which encourages consistent state-definition across species. This issue is especially critical with hiHMM1 in which the species-specific models are loosely connected. Our current joint initialization scheme of concatenating different genomes as one and applying <italic>k</italic>-means clustering works reasonably well, but this would be investigated further in our future study.</p>
    <p>In this article, we demonstrated a variety of features of hiHMM that makes it useful for cross-sample joint chromatin state inference. We have devised two models of hiHMM, each having advantages and limitations of interpretation and inference. The flexibility of using both learning models allows for a more comprehensive analysis during different applications and experimental designs.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="PMC_1" content-type="local-data">
      <caption>
        <title>Supplementary Data</title>
      </caption>
      <media mimetype="text" mime-subtype="html" xlink:href="supp_31_13_2066__index.html"/>
      <media xlink:role="associated-file" mimetype="application" mime-subtype="msword" xlink:href="supp_btv117_Supplementary_2015_01_26.docx"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Jia Deng for assistance with analyzing the simulation data and Vinita Deshpande for contributing to the software package.</p>
  </ack>
  <sec>
    <title>Funding</title>
    <p>This project was supported by an <funding-source>NHGRI</funding-source> grant <award-id>U01HG004258</award-id>, a <funding-source>Human Frontier Science Program (HFSP)</funding-source> grant <award-id>RGY0084/2014</award-id>, Basic Science Research Program through the <funding-source>National Research Foundation of Korea (NRF)</funding-source> funded by the <funding-source>Ministry of Science, ICT and Future Planning (MSIP)</funding-source> (<award-id>2010-0028631</award-id> &amp; <award-id>2014R1A1A3051169</award-id>).</p>
    <p><italic>Conflict</italic><italic>of</italic><italic>Interest</italic>: none declared.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="btv117-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baker</surname><given-names>M.</given-names></name></person-group> (<year>2011</year>) <article-title>Making sense of chromatin states</article-title>. <source>Nat. Methods</source><italic>,</italic>
<volume>8</volume>, <fpage>717</fpage>–<lpage>722</lpage>.<pub-id pub-id-type="pmid">21878916</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B2">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Beal</surname><given-names>M.J.</given-names></name><etal/></person-group> (<year>2002</year>) <article-title>The infinite hidden Markov model</article-title>. In: <person-group person-group-type="editor"><name><surname>Dietterich</surname><given-names>T.G.</given-names></name><etal/></person-group> (eds), <source>Advances in Neural Information Processing Systems</source><italic>.</italic>
<volume>Vol. 14</volume>, pp. <fpage>577</fpage>–<lpage>584</lpage>. <publisher-name>MIT Press</publisher-name>, <publisher-loc>Cambridge, MA, USA</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="btv117-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benjamini</surname><given-names>Y.</given-names></name><name><surname>Hochberg</surname><given-names>Y.</given-names></name></person-group> (<year>1995</year>) <article-title>Controlling the false discovery rate: a practical and powerful approach to multiple testing</article-title>. <source>J. R. Stat. Soc. B</source><italic>,</italic>
<volume>57</volume>, <fpage>289</fpage>–<lpage>300</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bernstein</surname><given-names>B.E.</given-names></name><etal/></person-group><italic>.</italic> (<year>2006</year>) <article-title>A bivalent chromatin structure marks key developmental genes in embryonic stem cells</article-title>. <source>Cell</source><italic>,</italic>
<volume>125</volume>, <fpage>315</fpage>–<lpage>326</lpage>.<pub-id pub-id-type="pmid">16630819</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Biesinger</surname><given-names>J.</given-names></name><etal/></person-group><italic>.</italic> (<year>2013</year>) <article-title>Discovering and mapping chromatin states using a tree hidden Markov model</article-title>. <source>BMC Bioinformatics</source><italic>,</italic>
<volume>14</volume>(<issue>Suppl. 5</issue>), <fpage>S4</fpage>.<pub-id pub-id-type="pmid">23734743</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blackwell</surname><given-names>D.</given-names></name><name><surname>MacQueen</surname><given-names>J.B.</given-names></name></person-group> (<year>1973</year>) <article-title>Ferguson distributions via polya urn schemes</article-title>. <source>Ann. Stat.</source><italic>,</italic>
<volume>1</volume>, <fpage>209</fpage>–<lpage>400</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B7">
      <mixed-citation publication-type="journal"><collab>ENCODE Project Consortium</collab> (<year>2012</year>) <article-title>An integrated encyclopedia of DNA elements in the human genome</article-title>. <source>Nature</source><italic>,</italic>
<volume>489</volume>, <fpage>57</fpage>–<lpage>74</lpage>.<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ernst</surname><given-names>J.</given-names></name><name><surname>Kellis</surname><given-names>M.</given-names></name></person-group> (<year>2010</year>) <article-title>Discovery and characterization of chromatin states for systematic annotation of the human genome</article-title>. <source>Nat. Biotechnol.</source><italic>,</italic>
<volume>28</volume>, <fpage>817</fpage>–<lpage>825</lpage>.<pub-id pub-id-type="pmid">20657582</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ernst</surname><given-names>J.</given-names></name><name><surname>Kellis</surname><given-names>M.</given-names></name></person-group> (<year>2012</year>) <article-title>ChromHMM: automating chromatin-state discovery and characterization</article-title>. <source>Nat. Methods</source><italic>,</italic>
<volume>9</volume>, <fpage>215</fpage>–<lpage>216</lpage>.<pub-id pub-id-type="pmid">22373907</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ernst</surname><given-names>J.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>Mapping and analysis of chromatin state dynamics in nine human cell types</article-title>. <source>Nature</source><italic>,</italic>
<volume>473</volume>, <fpage>43</fpage>–<lpage>49</lpage>.<pub-id pub-id-type="pmid">21441907</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ferguson</surname><given-names>T.S.</given-names></name></person-group> (<year>1973</year>) <article-title>A Bayesian analysis of some nonparametric problems</article-title>. <source>Ann. Stat.</source><italic>,</italic>
<volume>1</volume>, <fpage>209</fpage>–<lpage>400</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Filion</surname><given-names>G.J.</given-names></name><etal/></person-group> (<year>2010</year>) <article-title>Systematic protein location mapping reveals five principal chromatin types in drosophila cells</article-title>. <source>Cell</source><italic>,</italic>
<volume>143</volume>, <fpage>212</fpage>–<lpage>224</lpage>.<pub-id pub-id-type="pmid">20888037</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B13">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Forney</surname><given-names>G.D.</given-names></name></person-group> (<year>1973</year>) <article-title>The viterbi algorithm</article-title>. In: <person-group person-group-type="editor"><name><surname>Rowe</surname><given-names>J.E.</given-names></name><etal/></person-group> (eds), <source><italic>Proceedings of the IEEE, Vol. 61, IEEE, </italic>.</source> pp. <fpage>268</fpage>–<lpage>278</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heintzman</surname><given-names>N.D.</given-names></name><etal/></person-group> (<year>2009</year>) <article-title>Histone modifications at human enhancers reflect global cell-type-specific gene expression</article-title>. <source>Nature</source><italic>,</italic>
<volume>459</volume>, <fpage>108</fpage>–<lpage>112</lpage>.<pub-id pub-id-type="pmid">19295514</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ho</surname><given-names>J.W.K.</given-names></name><etal/></person-group> (<year>2014</year>) <article-title>Comparative analysis of metazoan chromatin organization</article-title>. <source>Nature</source><italic>,</italic>
<volume>512</volume>, <fpage>449</fpage>–<lpage>452</lpage>.<pub-id pub-id-type="pmid">25164756</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoffman</surname><given-names>M.M.</given-names></name><etal/></person-group> (<year>2012</year>) <article-title>Unsupervised pattern discovery in human chromatin structure through genomic segmentation</article-title>. <source>Nat. Methods</source><italic>,</italic>
<volume>9</volume>, <fpage>473</fpage>–<lpage>476</lpage>.<pub-id pub-id-type="pmid">22426492</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hon</surname><given-names>G.</given-names></name><etal/></person-group> (<year>2008</year>) <article-title>ChromaSig: a probabilistic approach to finding common chromatin signatures in the human genome</article-title>. <source>PLoS Comput. Biol.</source><italic>,</italic>
<volume>4</volume>, <fpage>e1000201</fpage>.<pub-id pub-id-type="pmid">18927605</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huang</surname><given-names>D.W.</given-names></name><etal/></person-group> (<year>2009</year>) <article-title>Bioinformatics enrichment tools: paths toward the comprehensive functional analysis of large gene lists</article-title>. <source>Nucleic Acids Res.</source><italic>,</italic>
<volume>37</volume>, <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">19033363</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hubert</surname><given-names>L.</given-names></name><name><surname>Arabie</surname><given-names>P.</given-names></name></person-group> (<year>1985</year>) <article-title>Comparing partitions</article-title>. <source>J. Classification</source><italic>,</italic>
<volume>2</volume>, <fpage>193</fpage>–<lpage>218</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Julienne</surname><given-names>H.</given-names></name><etal/></person-group> (<year>2013</year>) <article-title>Human genome replication proceeds through four chromatin states</article-title>. <source>PLoS Comput. Biol.</source><italic>,</italic>
<volume>9</volume>, <lpage>e1003233</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kharchenko</surname><given-names>P.V.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>Comprehensive analysis of the chromatin landscape in <italic>Drosophila melanogaster</italic></article-title>. <source>Nature</source><italic>,</italic>
<volume>471</volume>, <fpage>480</fpage>–<lpage>485</lpage>.<pub-id pub-id-type="pmid">21179089</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Larson</surname><given-names>J.L.</given-names></name><etal/></person-group> (<year>2013</year>) <article-title>A tiered hidden Markov model characterizes multi-scale chromatin states</article-title>. <source>Genomics</source><italic>,</italic>
<volume>102</volume>, <fpage>1</fpage>–<lpage>7</lpage>.<pub-id pub-id-type="pmid">23570996</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>T.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>Broad chromosomal domains of histone modification patterns in <italic>C</italic></article-title><italic>.</italic>
<source><italic>elegans</italic>. <italic>Genome Res.</italic></source><italic>,</italic>
<volume>21</volume>, <fpage>227</fpage>–<lpage>236</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mikkelsen</surname><given-names>T.S.</given-names></name><etal/></person-group> (<year>2007</year>) <article-title>Genome-wide maps of chromatin state in pluripotent and lineage-committed cells</article-title>. <source>Nature</source><italic>,</italic>
<volume>448</volume>, <fpage>553</fpage>–<lpage>560</lpage>.<pub-id pub-id-type="pmid">17603471</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Park</surname><given-names>P.J.</given-names></name></person-group> (<year>2009</year>) <article-title>ChIP-seq: advantages and challenges of a maturing technology</article-title>. <source>Nat. Rev. Genet.</source><italic>,</italic>
<volume>10</volume>, <fpage>669</fpage>–<lpage>680</lpage>.<pub-id pub-id-type="pmid">19736561</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rand</surname><given-names>W.M.</given-names></name></person-group> (<year>1971</year>) <article-title>Objective criteria for the evaluation of clustering methods</article-title>. <source>J. Am. Stat. Assoc.</source><italic>,</italic>
<volume>66</volume>, <fpage>846</fpage>–<lpage>850</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roudier</surname><given-names>F.</given-names></name><etal/></person-group> (<year>2011</year>) <article-title>Integrative epigenomic mapping defines four main chromatin states in <italic>Arabidopsis</italic>: organization of the <italic>Arabidopsis</italic> epigenome</article-title>. <source>EMBO J.</source><italic>,</italic>
<volume>30</volume>, <fpage>1928</fpage>–<lpage>1938</lpage>.<pub-id pub-id-type="pmid">21487388</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sohn</surname><given-names>K.-A.</given-names></name><etal/></person-group> (<year>2012</year>) <article-title>Robust estimation of local genetic ancestry in admixed populations using a nonparametric Bayesian approach</article-title>. <source>Genetics</source><italic>,</italic>
<volume>191</volume>, <fpage>1295</fpage>–<lpage>1308</lpage>.<pub-id pub-id-type="pmid">22649082</pub-id></mixed-citation>
    </ref>
    <ref id="btv117-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Teh</surname><given-names>Y.W.</given-names></name><etal/></person-group> (<year>2006</year>) <article-title>Hierarchical Dirichlet processes</article-title>. <source>J. Am. Stat. Assoc.</source><italic>,</italic>
<volume>101</volume>, <fpage>1566</fpage>–<lpage>1581</lpage>.</mixed-citation>
    </ref>
    <ref id="btv117-B30">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Van Gael</surname><given-names>J.</given-names></name><etal/></person-group> (<year>2008</year>) <article-title>Beam sampling for the infinite hidden Markov model</article-title>. In: <person-group person-group-type="editor"><name><surname>Cohen</surname><given-names>W.W.</given-names></name><etal/></person-group> (eds), <source>Proceedings of the 25th International Conference on Machine Learning</source><italic>.</italic>
<publisher-name>ACM</publisher-name>, <publisher-loc>New York, NY, USA</publisher-loc>, pp. <fpage>1088</fpage>–<lpage>1095</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
