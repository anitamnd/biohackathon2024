<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9048667</article-id>
    <article-id pub-id-type="pmid">35238331</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac132</article-id>
    <article-id pub-id-type="publisher-id">btac132</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Systems Biology</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MultiBaC: an R package to remove batch effects in multi-omic experiments</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Ugidos</surname>
          <given-names>Manuel</given-names>
        </name>
        <aff><institution>Gene Expression and RNA Metabolism Laboratory, Instituto de Biomedicina de Valencia, Consejo Superior de Investigaciones Científicas</institution>, Valencia 46010, <country country="ES">Spain</country></aff>
        <aff><institution>Multivariate Statistical Engineering Group, Department of Applied Statistics, Operations Research and Quality, Universitat Politècnica de València</institution>, Valencia 46022, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Nueda</surname>
          <given-names>María José</given-names>
        </name>
        <aff><institution>Department of Mathematics, Universidad de Alicante</institution>, Alicante 03690, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Prats-Montalbán</surname>
          <given-names>José M</given-names>
        </name>
        <aff><institution>Multivariate Statistical Engineering Group, Department of Applied Statistics, Operations Research and Quality, Universitat Politècnica de València</institution>, Valencia 46022, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ferrer</surname>
          <given-names>Alberto</given-names>
        </name>
        <aff><institution>Multivariate Statistical Engineering Group, Department of Applied Statistics, Operations Research and Quality, Universitat Politècnica de València</institution>, Valencia 46022, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Conesa</surname>
          <given-names>Ana</given-names>
        </name>
        <xref rid="btac132-cor1" ref-type="corresp"/>
        <!--ana.conesa@csic.es-->
        <aff><institution>Institute for Integrative Systems Biology, Consejo Superior de Investigaciones Científicas</institution>, Valencia 46980, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-5346-1407</contrib-id>
        <name>
          <surname>Tarazona</surname>
          <given-names>Sonia</given-names>
        </name>
        <xref rid="btac132-cor1" ref-type="corresp"/>
        <!--sotacam@eio.upv.es-->
        <aff><institution>Multivariate Statistical Engineering Group, Department of Applied Statistics, Operations Research and Quality, Universitat Politècnica de València</institution>, Valencia 46022, <country country="ES">Spain</country></aff>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Birol</surname>
          <given-names>Inanc</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac132-cor1">To whom correspondence should be addressed. <email>sotacam@eio.upv.es</email> or <email>ana.conesa@csic.es</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>5</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-03-03">
      <day>03</day>
      <month>3</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>03</day>
      <month>3</month>
      <year>2022</year>
    </pub-date>
    <volume>38</volume>
    <issue>9</issue>
    <fpage>2657</fpage>
    <lpage>2658</lpage>
    <history>
      <date date-type="received">
        <day>05</day>
        <month>11</month>
        <year>2021</year>
      </date>
      <date date-type="rev-recd">
        <day>19</day>
        <month>1</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>25</day>
        <month>2</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>01</day>
        <month>3</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>11</day>
        <month>3</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution-NonCommercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">https://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac132.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Batch effects in omics datasets are usually a source of technical noise that masks the biological signal and hampers data analysis. Batch effect removal has been widely addressed for individual omics technologies. However, multi-omic datasets may combine data obtained in different batches where omics type and batch are often confounded. Moreover, systematic biases may be introduced without notice during data acquisition, which creates a hidden batch effect. Current methods fail to address batch effect correction in these cases.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this article, we introduce the MultiBaC R package, a tool for batch effect removal in multi-omics and hidden batch effect scenarios. The package includes a diversity of graphical outputs for model validation and assessment of the batch effect correction.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>MultiBaC package is available on Bioconductor (<ext-link xlink:href="https://www.bioconductor.org/packages/release/bioc/html/MultiBaC.html" ext-link-type="uri">https://www.bioconductor.org/packages/release/bioc/html/MultiBaC.html</ext-link>) and GitHub (<ext-link xlink:href="https://github.com/ConesaLab/MultiBaC.git" ext-link-type="uri">https://github.com/ConesaLab/MultiBaC.git</ext-link>). The data underlying this article are available in Gene Expression Omnibus repository (accession numbers GSE11521, GSE1002, GSE56622 and GSE43747).</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Generalitat Valenciana through PROMETEO grants program for excellence research groups [PROMETEO</institution>
          </institution-wrap>
        </funding-source>
        <award-id>2016/093</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Spanish MICINN</institution>
          </institution-wrap>
        </funding-source>
        <award-id>PID2020-119537RB-I00</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="2"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>While omic platforms are widely accessible, data generation from a large number of samples and/or assays is still costly. For large data collections, sample acquisition may be distributed in time and space or complemented with data already available at public repositories. This results in datasets that are affected by a technical variability component associated to each acquisition event, i.e. the batch effect. Batch effects may represent the major source of variability in the combined omic dataset and compromise the detection of the underlying biological signal by standard methods (<xref rid="btac132-B1" ref-type="bibr">Kupfer <italic toggle="yes">et al.</italic>, 2012</xref>).</p>
    <p>Several Batch Effect Correction Algorithms (BECAs) have been proposed which are available as R packages (<xref rid="btac132-B2" ref-type="bibr">Leek <italic toggle="yes">et al.</italic>, 2012</xref>; <xref rid="btac132-B4" ref-type="bibr">Risso <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btac132-B5" ref-type="bibr">Ritchie <italic toggle="yes">et al.</italic>, 2015</xref>). Usually, BECAs require adequate experimental designs where the batch is known and not confounded with the effects of interest (treatment, dose, time point, etc.). However, there are few BECAs providing data corrected for systematic noise coming from an unknown source. This may happen when laboratory practices introduce an un-noticed bias that affects a subset of samples. While this variability behaves as a batch effect, it is not identified as such and therefore is invisible to many traditional BECAs. Another scenario not yet covered by BECAs is multi-omic experiments. When multi-omic datasets are created by combining different omics modalities obtained asynchronously, batch effects are confounded with the ‘omic type effect’, what hampers their removal from the data.</p>
    <p>Here, we introduce the MultiBaC R package (<xref rid="btac132-F1" ref-type="fig">Fig. 1</xref>), a general tool for batch effect removal in omic data that successfully addresses these difficult cases. The MultiBaC R package integrates two different batch effect correction methods: ARSyN, a flexible approach for the correction of systematic biases in single omic datasets for both declared (batches) or hidden sources of technical noise (<xref rid="btac132-B3" ref-type="bibr">Nueda <italic toggle="yes">et al.</italic>, 2012</xref>), and MultiBaC, the first batch effect correction algorithm for multi-omic data (<xref rid="btac132-B7" ref-type="bibr">Ugidos <italic toggle="yes">et al.</italic>, 2020</xref>). The MultiBaC R package is available at Bioconductor.</p>
    <fig position="float" id="btac132-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Overview of BECAs in MultiBaC R package</p>
      </caption>
      <graphic xlink:href="btac132f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S1</xref> depicts the general scheme of ARSyNbac and MultiBaC algorithms. Basically, ARSyNbac uses ANOVA to decompose the omics signal into experimental variables and residual noise. Should the source of unwanted variation be known, the method estimates the batch effect and removes it from data. When the source of batch effect is unknown, the residual noise is analyzed by PCA to detect any systematic component which is subsequently removed from the data. It is also possible to simultaneously correct the data for both types of noise. MultiBaC operates when a multi-omic dataset is created by combining multi-omic data from different laboratories provided one omic type is shared across labs (common omic). Partial Least Squares Regression (PLS) is used to model and predict the non-common omic data as a function of the common omic type, which allows the subsequent combination of complete multi-omic data structures and removal of batch effects with ARSyNbac.</p>
  </sec>
  <sec>
    <title>3 Implementation</title>
    <p>The MultiBaC R package organizes all the input and output data in a <italic toggle="yes">MultiAssayExperiment</italic> object, a type of Bioconductor container for multi-omic studies. The createMbac() function in MultiBaC package creates a <italic toggle="yes">MultiAssayExperiment</italic> object for each batch from the original matrices, and generates an <italic toggle="yes">mbac</italic> data structure, a S3 list class of <italic toggle="yes">MultiAssayExperiment</italic> objects to be used as input by ARSyNbac() or MultiBaC() functions. The resulting batch effect corrected matrices are also added to the <italic toggle="yes">mbac</italic> structure and several plots can be generated to validate PCA or PLS models applied by MultiBaC (<xref rid="btac132-F2" ref-type="fig">Fig. 2a–c</xref>), and to assess the batch effect magnitude (<xref rid="btac132-F2" ref-type="fig">Fig. 2d</xref>) or the correction performance (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref>). A reduced version of a yeast multi-omic dataset described in (<xref rid="btac132-B7" ref-type="bibr">Ugidos <italic toggle="yes">et al.</italic>, 2020</xref>) is included in the package. More details about the package can be found in the Bioconductor vignette and <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.</p>
    <fig position="float" id="btac132-F2">
      <label>Fig. 2.</label>
      <caption>
        <p>Usage of MultiBaC method on the complete yeast multiomics dataset. (<bold>a</bold>) Q2 plot shows the number of PLS components needed to reach a good predictive ability. (<bold>b</bold>) Explained variance plot shows the number of components retained by the ARSyN model. (<bold>c</bold>) Inner relation plot checks the requirement of linearity between X and Y PLS components. (<bold>d</bold>) Distribution of the magnitude of batch effects</p>
      </caption>
      <graphic xlink:href="btac132f2" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>4 Results and discussion</title>
    <p><xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.1</xref> summarizes and discusses the qualitative comparison of methods included in the MultiBaC package to the most popular BECAs. Briefly, in the single-omic case, limma and ComBat cannot handle the unknown batches situation. ARSyN, RUV and SVA can estimate such noise effects, but SVA does not provide a corrected dataset and instead returns surrogate variables to be included in differential expression models. ARSyNbac can easily and simultaneously correct for both known and unknown sources of noise. To the best of our knowledge, MultiBaC is the only BECA for correcting multi-omic batch effects.</p>
    <p>The ARSyN algorithm performance for noise reduction mode was validated on both real and simulated data in (<xref rid="btac132-B3" ref-type="bibr">Nueda <italic toggle="yes">et al.</italic>, 2012</xref>) but not provided in a publicly available R package. The known batch option is a straightforward adaptation of the original ARSyN methodology. A very simple implementation of these two ARSyN versions was first included in the NOISeq R package (<xref rid="btac132-B6" ref-type="bibr">Tarazona <italic toggle="yes">et al.</italic>, 2015</xref>) and now their functionality has been quite improved in the ARSyNbac function, with simultaneous correction of unwanted effects from both known or unknown sources, performance plots and more flexible options for PCA models. <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.2</xref> shows that ARSyNbac overperforms other popular BECAs listed in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>.</p>
    <p>The MultiBaC strategy has been also extensively validated in <xref rid="btac132-B7" ref-type="bibr">Ugidos <italic toggle="yes">et al.</italic> (2020)</xref>. <xref rid="btac132-F2" ref-type="fig">Figure 2</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S2</xref> shows how MultiBaC successfully removes batch effects when four yeast omics types (RNA-seq, GRO-seq, RIBO-seq and PAR-clip) (<xref rid="btac132-B7" ref-type="bibr">Ugidos <italic toggle="yes">et al.</italic>, 2020</xref>), obtained in different labs, are combined. MultiBaC returns a harmonized multi-omics dataset ready to be used in downstream analyses aiming to infer regulatory patterns across omics layers.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was funded by the Generalitat Valenciana through PROMETEO grants program for excellence research groups [PROMETEO 2016/093] and by the Spanish MICINN [PID2020-119537RB-I00]. Funding for open access charge: Universitat Politècnica de València.</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac132_Supplementary_Data</label>
      <media xlink:href="btac132_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac132-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kupfer</surname><given-names>P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>Batch correction of microarray data substantially improves the identification of genes differentially expressed in rheumatoid arthritis and osteoarthritis</article-title>. <source>BMC Med. Genomics</source>, <volume>5</volume>, <fpage>1</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">22221319</pub-id></mixed-citation>
    </ref>
    <ref id="btac132-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Leek</surname><given-names>J.T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>The SVA package for removing batch effects and other unwanted variation in high-throughput experiments</article-title>. <source>Bioinformatics</source>, <volume>28</volume>, <fpage>882</fpage>–<lpage>883</lpage>.<pub-id pub-id-type="pmid">22257669</pub-id></mixed-citation>
    </ref>
    <ref id="btac132-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nueda</surname><given-names>M.J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>ARSyN: a method for the identification and removal of systematic noise in multifactorial time course microarray experiments</article-title>. <source>Biostatistics</source>, <volume>13</volume>, <fpage>553</fpage>–<lpage>566</lpage>.<pub-id pub-id-type="pmid">22085896</pub-id></mixed-citation>
    </ref>
    <ref id="btac132-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Risso</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Normalization of RNA-seq data using factor analysis of control genes or samples</article-title>. <source>Nat. Biotechnol</source>., <volume>32</volume>, <fpage>896</fpage>–<lpage>902</lpage>.<pub-id pub-id-type="pmid">25150836</pub-id></mixed-citation>
    </ref>
    <ref id="btac132-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ritchie</surname><given-names>M.E.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>limma powers differential expression analyses for RNA-sequencing and microarray studies</article-title>. <source>NAR</source>, <volume>43</volume>, <fpage>e47</fpage>.<pub-id pub-id-type="pmid">25605792</pub-id></mixed-citation>
    </ref>
    <ref id="btac132-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tarazona</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>Data quality aware analysis of differential expression in RNA-seq with NOISeq R/Bioc package</article-title>. <source>NAR</source>, <volume>43</volume>, <fpage>e140</fpage>.<pub-id pub-id-type="pmid">26184878</pub-id></mixed-citation>
    </ref>
    <ref id="btac132-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ugidos</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>MultiBaC: strategy to remove batch effects between different omic data types</article-title>. <source>Stat. Methods Med. Res</source>., <volume>29</volume>, <fpage>2851</fpage>–<lpage>2864</lpage>.<pub-id pub-id-type="pmid">32131696</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
