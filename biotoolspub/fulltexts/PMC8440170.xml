<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Methods</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Methods</journal-id>
    <journal-title-group>
      <journal-title>Nature Methods</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1548-7091</issn>
    <issn pub-type="epub">1548-7105</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8440170</article-id>
    <article-id pub-id-type="pmid">34446921</article-id>
    <article-id pub-id-type="publisher-id">1231</article-id>
    <article-id pub-id-type="doi">10.1038/s41592-021-01231-2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Brief Communication</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SnapHiC: a computational pipeline to identify chromatin loops from single-cell Hi-C data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Yu</surname>
          <given-names>Miao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1822-0928</contrib-id>
        <name>
          <surname>Abnousi</surname>
          <given-names>Armen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9618-637X</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Yanxiao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Guoqiang</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lee</surname>
          <given-names>Lindsay</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Ziyin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fang</surname>
          <given-names>Rongxin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lagler</surname>
          <given-names>Taylor M.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5977-1617</contrib-id>
        <name>
          <surname>Yang</surname>
          <given-names>Yuchen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wen</surname>
          <given-names>Jia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8324-2803</contrib-id>
        <name>
          <surname>Sun</surname>
          <given-names>Quan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Yun</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
        <xref ref-type="aff" rid="Aff9">9</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5435-1127</contrib-id>
        <name>
          <surname>Ren</surname>
          <given-names>Bing</given-names>
        </name>
        <address>
          <email>biren@health.ucsd.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff10">10</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0987-2916</contrib-id>
        <name>
          <surname>Hu</surname>
          <given-names>Ming</given-names>
        </name>
        <address>
          <email>hum@ccf.org</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.8547.e</institution-id><institution-id institution-id-type="ISNI">0000 0001 0125 2443</institution-id><institution>State Key Laboratory of Genetic Engineering, School of Life Sciences, </institution><institution>Fudan University, </institution></institution-wrap>Shanghai, China </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.1052.6</institution-id><institution-id institution-id-type="ISNI">0000000097371625</institution-id><institution>Ludwig Institute for Cancer Research, </institution></institution-wrap>La Jolla, CA USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.239578.2</institution-id><institution-id institution-id-type="ISNI">0000 0001 0675 4725</institution-id><institution>Department of Quantitative Health Sciences, Lerner Research Institute, </institution><institution>Cleveland Clinic Foundation, </institution></institution-wrap>Cleveland, OH USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution>Howard Hughes Medical Institute, Department of Chemistry and Chemical Biology, </institution><institution>Harvard University, </institution></institution-wrap>Cambridge, MA USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.410711.2</institution-id><institution-id institution-id-type="ISNI">0000 0001 1034 1720</institution-id><institution>Department of Biostatistics, </institution><institution>University of North Carolina, </institution></institution-wrap>Chapel Hill, NC USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.410711.2</institution-id><institution-id institution-id-type="ISNI">0000 0001 1034 1720</institution-id><institution>Department of Pathology and Laboratory Medicine, </institution><institution>University of North Carolina, </institution></institution-wrap>Chapel Hill, NC USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.410711.2</institution-id><institution-id institution-id-type="ISNI">0000 0001 1034 1720</institution-id><institution>McAllister Heart Institute, </institution><institution>University of North Carolina, </institution></institution-wrap>Chapel Hill, NC USA </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="GRID">grid.410711.2</institution-id><institution-id institution-id-type="ISNI">0000 0001 1034 1720</institution-id><institution>Department of Genetics, </institution><institution>University of North Carolina, </institution></institution-wrap>Chapel Hill, NC USA </aff>
      <aff id="Aff9"><label>9</label><institution-wrap><institution-id institution-id-type="GRID">grid.410711.2</institution-id><institution-id institution-id-type="ISNI">0000 0001 1034 1720</institution-id><institution>Department of Computer Science, </institution><institution>University of North Carolina, </institution></institution-wrap>Chapel Hill, NC USA </aff>
      <aff id="Aff10"><label>10</label><institution-wrap><institution-id institution-id-type="GRID">grid.266100.3</institution-id><institution-id institution-id-type="ISNI">0000 0001 2107 4242</institution-id><institution>Center for Epigenomics, Department of Cellular and Molecular Medicine, </institution><institution>University of California, San Diego, </institution></institution-wrap>La Jolla, CA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>26</day>
      <month>8</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>26</day>
      <month>8</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2021</year>
    </pub-date>
    <volume>18</volume>
    <issue>9</issue>
    <fpage>1056</fpage>
    <lpage>1059</lpage>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>12</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>6</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s), under exclusive licence to Springer Nature America, Inc. 2021</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Single-cell Hi-C (scHi-C) analysis has been increasingly used to map chromatin architecture in diverse tissue contexts, but computational tools to define chromatin loops at high resolution from scHi-C data are still lacking. Here, we describe Single-Nucleus Analysis Pipeline for Hi-C (SnapHiC), a method that can identify chromatin loops at high resolution and accuracy from scHi-C data. Using scHi-C data from 742 mouse embryonic stem cells, we benchmark SnapHiC against a number of computational tools developed for mapping chromatin loops and interactions from bulk Hi-C. We further demonstrate its use by analyzing single-nucleus methyl-3C-seq data from 2,869 human prefrontal cortical cells, which uncovers cell type-specific chromatin loops and predicts putative target genes for noncoding sequence variants associated with neuropsychiatric disorders. Our results indicate that SnapHiC could facilitate the analysis of cell type-specific chromatin architecture and gene regulatory programs in complex tissues.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">SnapHiC offers a computational tool for improving detection of chromatin loops from single-cell Hi-C data.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational models</kwd>
      <kwd>Chromatin</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000002</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>UM1HG011585</award-id>
        <award-id>U01DA052713</award-id>
        <award-id>R01GM105785</award-id>
        <award-id>P50HD103573</award-id>
        <award-id>U54DK107977</award-id>
        <award-id>UM1HG011585</award-id>
        <principal-award-recipient>
          <name>
            <surname>Li</surname>
            <given-names>Yun</given-names>
          </name>
          <name>
            <surname>Ren</surname>
            <given-names>Bing</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>Ming</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s), under exclusive licence to Springer Nature America, Inc. 2021</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Main</title>
    <p id="Par3">Single-cell Hi-C (scHi-C) technologies have been developed to map chromatin architecture in individual cells, enabling the measure of spatial proximity between transcriptional regulatory elements in a cell type-specific manner<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref></sup>. However, due to the lack of tools tailored for scHi-C data, identifying loops from scHi-C data mainly relies on applying methods developed for bulk Hi-C<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR5">5</xref></sup> to the aggregated scHi-C data of the same cell type. Due to the extreme sparsity of scHi-C data, such a strategy would require a large number of cells (&gt;500–1,000), which is both cost prohibitive and impractical for rare cell types. To overcome these issues, we developed Single-Nucleus Analysis Pipeline for Hi-C (SnapHiC), a computational framework customized for scHi-C data to identify chromatin loops at high resolution and accuracy from a small number of cells.</p>
    <p id="Par4">SnapHiC (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>) first imputes intrachromosomal contact probability between pairs of 10-kilobase (kb) bins in each cell with the random walk with restart (RWR) algorithm<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. Next, it normalizes the imputed contact probability based on linear genomic distances. SnapHiC then applies paired <italic>t</italic>-test to the matrices of normalized contact probability of all cells to identify candidate bin pairs (or loop candidates) with higher-than-expected contact probability in a population of cells. To minimize false positives, SnapHiC considers a bin pair as a loop candidate only when its normalized contact probability is significantly higher than expected by chance based on both global and local background. Finally, SnapHiC groups the loop candidates into clusters<sup><xref ref-type="bibr" rid="CR7">7</xref></sup> and identifies the summit(s) within each cluster. In SnapHiC, individual cells are treated as independent datasets instead of being aggregated into pseudo bulk data. Therefore, the variability of contact frequency within the cell population can be estimated to boost the statistical power in loop detection, especially when the number of cells is low.<fig id="Fig1"><label>Fig. 1</label><caption><title>SnapHiC reveals chromatin loops at high resolution and accuracy.</title><p><bold>a</bold>, Overview of the SnapHiC workflow. <bold>b</bold>, The number of chromatin loops at 10-kb resolution identified by SnapHiC and HiCCUPS (with default or optimal parameters) from different numbers of mES cells. <bold>c</bold>, F1 score of SnapHiC- and HiCCUPS-identified loops (with default or optimal parameters) from different numbers of mES cells. In <bold>b</bold>,<bold>c</bold>, the dots and the error bars represent the mean values and the standard deviations calculated across six randomly sampled subsets, respectively.</p><p><xref rid="MOESM4" ref-type="media">Source data</xref></p></caption><graphic xlink:href="41592_2021_1231_Fig1_HTML" id="d32e531"/></fig></p>
    <p id="Par5">We first benchmarked the performance of SnapHiC against a commonly used loop detection method for bulk Hi-C data, HiCCUPS<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. We applied SnapHiC to the published scHi-C data<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> generated from mouse embryonic stem (mES) cells. Besides the full set of 742 cells, we also randomly subsampled 10, 25, 50, 75, 100, 200, 300, 400, 500, 600 and 700 cells from this dataset, and determined 10-kb-resolution intrachromosomal loops within the 100 kb–1 Mb range. For each subsampling, we also pooled the scHi-C data and identified chromatin loops at 10-kb resolution using HiCCUPS with both default and ‘optimal’ parameters for sparse data (<xref rid="MOESM1" ref-type="media">Supplementary Note</xref> and Extended Data Fig. <xref rid="Fig3" ref-type="fig">1</xref>). For each subsampling dataset, SnapHiC found substantially more loops than HiCCUPS, suggesting SnapHiC has a much higher sensitivity than HiCCUPS (Fig. <xref rid="Fig1" ref-type="fig">1b</xref> and Supplementary Table <xref rid="MOESM3" ref-type="media">1</xref>). Even from 75 cells, SnapHiC identified 1,050–1,420 loops, whereas HiCCUPS found only 0–2 loops with default parameters and 3–10 loops with optimal parameters. Additionally, HiCCUPS-identified loops tended to be a subset of SnapHiC-identified loops (Extended Data Fig. <xref rid="Fig4" ref-type="fig">2a</xref>). Moreover, SnapHiC achieved higher reproducibility. From two replication datasets with 371 cells each, reproducibility was 50.8% for SnapHiC versus 38.7% for HiCCUPS with default parameters (paired <italic>t</italic>-test two-sided <italic>P</italic> = 7.86 × 10<sup>−8</sup>), while 50.8% for SnapHiC versus 39.7% for HiCCUPS with optimal parameters (paired <italic>t</italic>-test two-sided <italic>P</italic> = 9.90 × 10<sup>−11</sup>).</p>
    <p id="Par6">We used the F1 score, the harmonic mean of the precision and recall rates, to evaluate the overall performance of each method. To calculate the F1 score, we combined the chromatin loops identified by HiCCUPS from bulk in situ Hi-C data<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, with long-range interactions identified by MAPS (model-based analysis of long-range chromatin interactions from PLAC-seq (proximity ligation-assisted ChIP–seq (chromatin immunoprecipitation assays with sequencing)) and HiChIP experiments) from H3K4me3 PLAC-seq data<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, cohesin<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and H3K27ac HiChIP data<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>, all from mES cells. At each subsampling of scHi-C data, SnapHiC consistently attained a greater F1 score than HiCCUPS (Fig. <xref rid="Fig1" ref-type="fig">1c</xref> and Extended Data Fig. <xref rid="Fig4" ref-type="fig">2b,c</xref>). The reliability of SnapHiC-identified loops was supported by two lines of evidence: (1) significant focal enrichment at anchors of loops identified from at least 25 cells was observed from aggregate peak analysis (APA) plots using aggregated contact matrices of 742 cells (Extended Data Fig. <xref rid="Fig5" ref-type="fig">3</xref>) and (2) for SnapHiC-identified loops with CTCF (CCCTC-binding factor) binding on both anchors, there was a clear preference in convergent orientation—ranging from 63.6% to 78.7% when at least 50 cells are used (Supplementary Table <xref rid="MOESM3" ref-type="media">2</xref>), as predicted by the loop extrusion model<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR12">12</xref></sup>. The advantages of SnapHiC were more obvious when the number of cells profiled is limited. As illustrated in Extended Data Fig. <xref rid="Fig6" ref-type="fig">4</xref>, SnapHiC detected previously verified long-range interactions at <italic>Sox2</italic>, <italic>Wnt6</italic> and <italic>Mtnr1a</italic> loci<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR14">14</xref></sup> from scHi-C data of as few as 75 cells, whereas HiCCUPS required at least 200–600 cells to detect the same loops.</p>
    <p id="Par7">We next compared the performance of SnapHiC with three additional methods designed to identify long-range interactions from bulk Hi-C-FastHiC<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>, FitHiC2 (ref. <sup><xref ref-type="bibr" rid="CR5">5</xref></sup>) and HiC-ACT<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> (<xref rid="MOESM1" ref-type="media">Supplementary Note</xref>). Considering their default thresholds may not be optimal for the sparse scHi-C data, we also tested different thresholds for each method. Results on different numbers of mES cells demonstrated that SnapHiC consistently identified more loops and achieved greater F1 scores than the other methods, with higher recall rates and equivalent or slightly lower precision rates (Extended Data Fig. <xref rid="Fig7" ref-type="fig">5</xref>). For the three loci examined above (Extended Data Fig. <xref rid="Fig6" ref-type="fig">4</xref>), SnapHiC also detected the known long-range interactions with much fewer cells than the other methods (Extended Data Fig. <xref rid="Fig8" ref-type="fig">6</xref>). Taken together, our results suggested that SnapHiC can identify loops from a small number of cells with high sensitivity and accuracy.</p>
    <p id="Par8">To demonstrate the use of SnapHiC on complex tissues, we applied it to the published single-nucleus methyl-3C-seq (sn-m3C-seq) data<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> generated from human prefrontal cortex, which simultaneously profiled DNA methylome and chromatin organization from the same cells. In this study, 14 major cell types were classified from single-cell methylome data based on cell type-specific CG and non-CG methylation patterns (Extended Data Fig. <xref rid="Fig9" ref-type="fig">7a</xref>). We applied SnapHiC to the Hi-C component of each cell within the 14 cell clusters, and identified roughly 817–27,379 loops at 10-kb resolution (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). Consistent with our observation on mES cells, SnapHiC identified more chromatin loops than tools developed for bulk Hi-C (Extended Data Fig. <xref rid="Fig9" ref-type="fig">7b</xref>) and yielded the highest F1 score on all cell types except for the oligodendrocytes (Extended Data Fig. <xref rid="Fig10" ref-type="fig">8</xref> and Supplementary Table <xref rid="MOESM3" ref-type="media">3</xref>), which had comparable sequencing depth to routine bulk Hi-C data after aggregating (roughly 278 million intrachromosomal reads &gt;20 kb, 1,038 cells).<fig id="Fig2"><label>Fig. 2</label><caption><title>Application of SnapHiC to sn-m3C-seq data from human prefrontal cortex uncovered chromatin loops in diverse brain cell types.</title><p><bold>a</bold>, Scatter plot showing the numbers of cells and SnapHiC-identified loops in each of the 14 major cell types identified in human prefrontal cortex in Lee et al.<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. ODC, oligodendrocyte. Astro, astrocyte. MG, microglia. OPC, oligodendrocyte progenitor cell. Endo, endothelial cell. L2/3, L4, L5 and L6 denote excitatory neuron subtypes located in different cortical layers. Pvalb and Sst, medial ganglionic eminence-derived inhibitory subtypes. Ndnf and Vip, CGE-derived inhibitory subtypes. NN1, nonneuronal cell type 1. <bold>b</bold>, Boxplot of ATAC-seq log<sub>2</sub>(CPM+1) value (left), H3K27ac ChIP–seq log<sub>2</sub>(CPM+1) value (middle) and RNA-seq log<sub>2</sub>(FPKM+1) value (right) at Astro-specific, MG-specific, ODC-specific and L2/3-specific SnapHiC loops. For each set of SnapHiC loops, the values are calculated using ATAC-seq/H3K27ac ChIP–seq/RNA-seq data generated from astrocyte, microglia, oligodendrocytes and neurons, respectively (<xref rid="Sec2" ref-type="sec">Methods</xref>). ***<italic>P</italic> &lt; 2.2 × 10<sup>−16</sup>, two-sided <italic>P</italic> values by the paired Wilcoxon signed-rank test. In each box, the upper edge, horizontal center line and lower edge represent the 75th percentile, median and 25th percentile, respectively. The upper whiskers represent the 75th percentile + 1.5× the interquartile range (IQR). The lower whiskers represent the minimum values (0). Data points with a value above the 75th percentile + 1.5× the IQR are outliers and reported as dots. <bold>c</bold>, SnapHiC-identified loops from astrocyte and microglia around gene <italic>APOE</italic>. There is no loop identified in this genomic region from oligodendrocytes or L2/3 excitatory neurons, so no corresponding tracks are shown. Two astrocyte-specific loops linking the <italic>APOE</italic> promoter (highlighted in gray) and the active enhancers in astrocyte (highlighted in pink) containing two Alzheimer’s disease (AD) -associated GWAS SNPs are marked by black arrows. Only <italic>APOE</italic> transcription start site-distal Alzheimer’s disease-associated GWAS SNPs are shown in the figures (residing in the region chr19: 45,440,000–45,630,000).</p><p><xref rid="MOESM5" ref-type="media">Source data</xref></p></caption><graphic xlink:href="41592_2021_1231_Fig2_HTML" id="d32e741"/></fig></p>
    <p id="Par9">The accuracy and sensitivity of the above SnapHiC-identified loops were supported by two lines of evidence. First, APA analysis confirmed SnapHiC-identified loops show significant enrichment compared to their local background on the aggregated contact matrices (Extended Data Fig. <xref rid="Fig11" ref-type="fig">9</xref>). Second, anchors of SnapHiC-identified loops displayed corresponding cell type-specific chromatin accessibility, histone acetylation and gene expression in four distinct cell types: astrocytes, L2/3 excitatory neurons, oligodendrocytes and microglia, where assay for transposase-accessible chromatin using sequencing (ATAC-seq), H3K27ac ChIP–seq and RNA sequencing (RNA-seq) data are available<sup><xref ref-type="bibr" rid="CR17">17</xref>,<xref ref-type="bibr" rid="CR18">18</xref></sup>. To minimize the effect of cell number variation on the performance of SnapHiC, we randomly selected the same number of cells (<italic>N</italic> = 261) from astrocytes, oligodendrocytes and microglia to match the number of cells from L2/3 excitatory neurons, and applied SnapHiC to identify loops from these subsampled data. We found that most chromatin loops were cell type-specific (Supplementary Table <xref rid="MOESM3" ref-type="media">4</xref>), and the anchors of cell type-specific loops showed significantly higher ATAC-seq and H3K27ac ChIP–seq signals in the matched cell type compared to those in different cell types (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). The genes whose promoters linked to cell type-specific loops also showed significantly higher expression levels in the matched cell type (Fig. <xref rid="Fig2" ref-type="fig">2b</xref> and Supplementary Table <xref rid="MOESM3" ref-type="media">5</xref>). Moreover, they were associated with gene ontology terms<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> related to cell type-specific biological processes (Extended Data Fig. <xref rid="Fig12" ref-type="fig">10a</xref>). Taken together, our results indicated that SnapHiC can detect chromatin loops reliably from scHi-C data in complex tissues.</p>
    <p id="Par10">Furthermore, we assigned candidate target genes to noncoding genome-wide association study (GWAS) single nucleotide polymorphisms (SNPs) based on the loops identified in specific cell types. We first collected 3,471 unique GWAS SNPs associated with seven neuropsychiatric disorders and traits that resided within the active enhancers of astrocytes, neurons, microglia or oligodendrocytes<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> (Supplementary Table <xref rid="MOESM3" ref-type="media">6</xref>). Using SnapHiC-identified loops from the matching cell types (L2/3 excitatory neurons to represent neurons), we defined 788 SNP-gene linkages, connecting 445 disease-associated SNPs to 189 genes (Supplementary Table <xref rid="MOESM3" ref-type="media">7</xref>). The list included several known disease genes, such as <italic>INPP5D</italic> (Alzheimer’s disease), <italic>RAB27B</italic> (major depressive disorder, MDD), <italic>SORL1</italic> (Alzheimer’s disease) and <italic>ZNF184</italic> (MDD and schizophrenia). Figure <xref rid="Fig2" ref-type="fig">2c</xref> and Extended Data Fig. <xref rid="Fig12" ref-type="fig">10b</xref> showed an illustrative example of gene <italic>APOE</italic>, which was specifically expressed in astrocyte. Two astrocyte-specific loops connected the transcription start site of <italic>APOE</italic> to two active enhancers containing Alzheimer’s disease-associated GWAS SNPs (rs112481437 and rs138137383) in astrocyte. Our results indicated that <italic>APOE</italic> was the putative target gene of these two GWAS SNPs specifically in astrocytes.</p>
    <p id="Par11">In summary, we describe SnapHiC, a method to identify chromatin loops at high resolution and accuracy from sparse scHi-C datasets. Reanalyses of published scHi-C data from mES cells demonstrate that SnapHiC greatly boosts the statistical power in loop detection. Application of SnapHiC to sn-m3C-seq data from human prefrontal cortical cells reveals cell type-specific loops, which can predict putative target genes of noncoding GWAS SNPs. SnapHiC has the potential to facilitate the study of cell type-specific chromatin spatial organization in complex tissues.</p>
  </sec>
  <sec id="Sec2">
    <title>Methods</title>
    <sec id="Sec3">
      <title>Single-cell Hi-C (scHi-C) data processing</title>
      <p id="Par12">For scHi-C data from mES cells<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>, we downloaded the raw fastq files of all diploid serum cells. We first aligned scHi-C read pairs to mm10 genome with BWA-MEM with the ‘-5’ option, to report the most 5′ end alignment as the primary alignment, and the ‘-P’ option to perform the Smith–Waterman algorithm to rescue chimeric reads. We only used primary alignments in the next steps. We then deduplicated read pairs with the Picard tool to keep only one read pair at the exact same position. We further applied two filtering steps to remove duplications: (1) we split each chromosome into consecutive nonoverlapping 1-kb bins and only kept one contact for each 1-kb bin pair, and (2) we removed 1-kb bins that contact with more than ten other 1-kb bins, since they are likely mapping artifacts. The number of contacts per cell for all 1,175 cells has a bimodal distribution, and therefore only the top 742 cells with &gt;150,000 contacts per cell were selected for downstream analysis.</p>
    </sec>
    <sec id="Sec4">
      <title>Single-nucleus methyl-3C-seq (sn-m3C-seq) data processing</title>
      <p id="Par13">For sn-m3C-seq data from human prefrontal cortex, we performed data processing using reference genome hg19 as described in the previous study<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Afterward, we applied the same filtering steps to remove duplications as described in the <xref rid="Sec3" ref-type="sec">Single-cell Hi-C (scHi-C) data processing</xref> section. Again, the number of contacts per cell for all 4,238 cells showed a bimodal distribution and the top 2,869 cells with &gt;150,000 contacts per cell were used for downstream analysis. The method for clustering and cell type annotation for these 2,869 cells was the same as previously described<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>.</p>
    </sec>
    <sec id="Sec5">
      <title>SnapHiC algorithm</title>
      <sec id="Sec6">
        <title>Step A. Contact probability imputation using the RWR algorithm</title>
        <p id="Par14">We first partitioned each autosome into 10-kb bins and dichotomized contact for each 10-kb bin pair (binary contact matrix with 1 indicating nonzero contact and 0 otherwise). Next, we modeled each autosome as an unweighted graph, where each 10-kb bin is one node and each nonzero contact between any two 10-kb bins is one edge. We also added edges to all adjacent 10-kb bins. We then implemented the RWR algorithm<sup><xref ref-type="bibr" rid="CR6">6</xref></sup> with a restart probability of 0.05 to impute the contact probability between all intrachromosomal 10-kb bin pairs. We used the Python ‘NetworkX’ package to construct the graph and adopted the ‘linalg.solve’ function in the Python ‘SciPy’ package to solve the linear equation in the RWR algorithm. The systematic biases in imputed contact probabilities in scHi-C data are negligible, and thus normalization against effective fragment size, GC content or mappability is not needed (<xref rid="MOESM1" ref-type="media">Supplementary Note</xref>).</p>
      </sec>
      <sec id="Sec7">
        <title>Step B. Contact probability normalization based on one-dimensional (1D) genomic distance</title>
        <p id="Par15">Since the contact probability between any two genomic loci is dependent on their 1D genomic distance, normalization of the imputed contact probability against 1D genomic distance is needed before loop calling. To achieve this, we first removed bin pairs residing in the first 50 kb or the last 50 kb of each chromosome, which often have unusually high imputed contact probability due to the edge effect of the RWR algorithm. We then stratified all 10-kb bin pairs by their 1D genomic distance. Specifically, let <italic>x</italic><sub><italic>ij</italic></sub> represent the contact probability between bin <italic>i</italic> and bin <italic>j</italic>. Define set <italic>A</italic><sub><italic>d</italic></sub> as all bin pairs (<italic>i</italic>,<italic>j</italic>) with the 1D genomic distance <italic>d</italic>. For simplicity, we only considered bin pairs (<italic>i</italic>,<italic>j</italic>) in the upper triangle of the contact matrix where <italic>i</italic> &lt; <italic>j</italic>. We removed the top 1% bin pairs in <italic>A</italic><sub><italic>d</italic></sub> with the highest contact probability, and then computed the mean <italic>μ</italic><sub><italic>d</italic></sub> and the standard deviation <italic>σ</italic><sub><italic>d</italic></sub> of the contact probability using the remaining bin pairs in <italic>A</italic><sub><italic>d</italic></sub>. We further calculated the normalized contact probability (that is, <italic>z</italic> score), defined as <italic>z</italic><sub><italic>ij</italic></sub> = (<italic>x</italic><sub><italic>ij</italic></sub> − <italic>μ</italic><sub><italic>d</italic></sub>)/<italic>σ</italic><sub><italic>d</italic></sub>, for all bin pairs in <italic>A</italic><sub><italic>d</italic></sub>. For single cells with very few contacts, the imputed contact probabilities <italic>x</italic><sub><italic>ij</italic></sub> at a specific 1D genomic distance <italic>d</italic> are close to zero, leading to very small standard deviation <italic>σ</italic><sub><italic>d</italic></sub> and numerical errors in the <italic>z</italic> score transformation. To avoid this issue, when <italic>σ</italic><sub><italic>d</italic></sub> is less than 10<sup>−6</sup>, we defined <italic>z</italic><sub><italic>ij</italic></sub> = 0 for all bin pairs in <italic>A</italic><sub><italic>d</italic></sub>. After the calculation described above, bin pair (<italic>i</italic>,<italic>j</italic>) with higher normalized contact probability <italic>z</italic><sub><italic>ij</italic></sub> suggests that bin <italic>i</italic> and bin <italic>j</italic> are more likely to interact with each other than other loci pairs.</p>
      </sec>
      <sec id="Sec8">
        <title>Step C. Identification of loop candidates</title>
        <p id="Par16">To minimize false positives in loop calling results, we defined a bin pair as a loop candidate only if it shows a higher contact probability compared to both its global and local background. Specifically, we required the loop candidate to satisfy the following criteria:<list list-type="order"><list-item><p id="Par17">Its average normalized contact probability from all single cells is greater than 0 (that is, with respect to global background).</p></list-item><list-item><p id="Par18">More than 10% of single cells have normalized contact probability above 1.96 (that is, <italic>z</italic> score &gt;1.96, corresponding to a <italic>z</italic>-test two-sided <italic>P</italic> value &lt;0.05, with respect to global background).</p></list-item><list-item><p id="Par19">For each 10-kb bin pair (<italic>i</italic>,<italic>j</italic>), we defined its local neighborhood as all 10-kb bin pairs (<italic>m</italic>,<italic>n</italic>) such that 30 kb ≤ max{<italic>d</italic>(<italic>i</italic>,<italic>m</italic>), <italic>d</italic>(<italic>j</italic>,<italic>n</italic>)} ≤ 50 kb (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>), where <italic>d</italic>(<italic>i</italic>,<italic>m</italic>) is the 1D genomic distance between the center of bin <italic>i</italic> and the center of bin <italic>m</italic>. Here we did not consider the bin pairs within 20 kb of bin pair (<italic>i</italic>,<italic>j</italic>) as part of its local neighborhood because they can be part of the same loop cluster centered at bin pair (<italic>i</italic>,<italic>j</italic>). We then compared the normalized contact probability at bin pair (<italic>i</italic>,<italic>j</italic>) with the mean of the normalized contact probability of all ninety-six 10-kb bin pairs within its local neighborhood region, and applied the paired <italic>t</italic>-test across all single cells to obtain a <italic>P</italic> value. We further converted <italic>P</italic> values into false discovery rates (FDRs) using the Benjamini–Hochberg procedure, again stratified by 1D genomic distance. A loop candidate must have FDR &lt; 10% and <italic>t</italic>-statistics greater than three in the paired <italic>t</italic>-test (that is, with respect to local background).</p></list-item><list-item><p id="Par20">Motivated by the HiCCUPS algorithm<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, we also required each loop candidate to have at least 33% higher average normalized contact frequency than its circle, donut and lower left background and 20% higher average normalized contact frequency than its horizontal and vertical background (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>) (that is, with respect to local background).</p></list-item><list-item><p id="Par21">Finally, we removed loop candidates with either end having low mappability score (≤0.8), or overlapping with the ENCODE blacklist regions (<ext-link ext-link-type="uri" xlink:href="http://mitra.stanford.edu/kundaje/akundaje/release/blacklists/mm10-mouse/mm10.blacklist.bed.gz">http://mitra.stanford.edu/kundaje/akundaje/release/blacklists/mm10-mouse/mm10.blacklist.bed.gz</ext-link> for mm10 and <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/files/ENCFF001TDO/">https://www.encodeproject.org/files/ENCFF001TDO/</ext-link> for hg19). The sequence mappability for each 10-kb bin is calculated based on our previous study<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>; it can be downloaded from <ext-link ext-link-type="uri" xlink:href="http://enhancer.sdsc.edu/yunjiang/resources/genomic_features/">http://enhancer.sdsc.edu/yunjiang/resources/genomic_features/</ext-link>.</p></list-item></list></p>
      </sec>
      <sec id="Sec9">
        <title>Step D. Clustering of loop candidates and identifying the summit(s) as final outputs</title>
        <p id="Par22">For each loop candidate (<italic>i</italic>,<italic>j</italic>), we defined its surrounding area as all 10-kb bin pairs (<italic>m</italic>,<italic>n</italic>) such that max {<italic>d</italic>(<italic>i</italic>,<italic>m</italic>), <italic>d</italic>(<italic>j</italic>,<italic>n</italic>)} ≤ 20 kb, where <italic>d</italic>(<italic>i</italic>,<italic>m</italic>) is the 1D genomic distance between the center of bin <italic>i</italic> and the center of bin <italic>m</italic>. We defined a loop candidate as a singleton if there is no other loop candidate within its surrounding area, and removed all singletons from the downstream analysis since the singletons are likely to be false positives.</p>
        <p id="Par23">To group the remaining nonsingleton loop candidates into clusters, we adopted the Rodriguez and Laio’s algorithm<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. Specifically, for each loop candidate (<italic>i</italic>,<italic>j</italic>), we first counted the number of loop candidates in its adjacent neighborhood regions: (<italic>m</italic>,<italic>n</italic>): max {<italic>d</italic>(<italic>i</italic>,<italic>m</italic>)},<italic>d</italic>(<italic>j</italic>,<italic>n</italic>) ≤ 10 kb, and defined this number as its local density <italic>ρ</italic>(<italic>i</italic>,<italic>j</italic>). Next, we calculated the minimum Euclidean distance between the loop candidate (<italic>i</italic>,<italic>j</italic>) and any other loop candidate with higher local density on the same chromosome, defined as <italic>δ</italic>(<italic>i</italic>,<italic>j</italic>):<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta \left( {i,j} \right) = \mathop {{\min }}\limits_{\left( {m,n} \right):\rho \left( {m,n} \right) &gt; \rho (i,j)} \sqrt {\left( {i - m} \right)^2 + \left( {j - n} \right)^2} .$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi>δ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced><mml:mo>:</mml:mo><mml:mi>ρ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced><mml:mo>&gt;</mml:mo><mml:mi>ρ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt><mml:mo>.</mml:mo></mml:mrow></mml:math><graphic xlink:href="41592_2021_1231_Article_Equa.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par24">If a loop candidate (<italic>i</italic>,<italic>j</italic>) has the highest local density (that is, <italic>ρ</italic>(<italic>i</italic>,<italic>j</italic>) = 9), <italic>δ</italic>(<italic>i</italic>,<italic>j</italic>) is defined as:<disp-formula id="Equb"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta \left( {i,j} \right) = \mathop {{\max }}\limits_{(m,n)} \sqrt {\left( {i - m} \right)^2 + \left( {j - n} \right)^2} .$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mi>δ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt><mml:mo>.</mml:mo></mml:mrow></mml:math><graphic xlink:href="41592_2021_1231_Article_Equb.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par25">We then selected loop candidates that have high local density <italic>ρ</italic>, and are relatively far away from other loop candidates with higher local density, that is, high <italic>δ</italic>, as loop cluster centers. To achieve this, let <italic>ρ</italic><sub>max</sub> and <italic>δ</italic><sub>max</sub> represent the maximal value of <italic>ρ</italic> and <italic>δ</italic> of all loop candidates on each chromosome, respectively. We defined <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho ^{\prime} \left( {i,j} \right) = \rho \left( {i,j} \right)/\rho _{\mathrm{max}}$$\end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:msup><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>ρ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="41592_2021_1231_Article_IEq1.gif"/></alternatives></inline-formula> and <inline-formula id="IEq2"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta ^{\prime} \left( {i,j} \right) = \delta \left( {i,j} \right)/\delta _{\mathrm{max}}$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:msup><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>δ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="41592_2021_1231_Article_IEq2.gif"/></alternatives></inline-formula> such that both <inline-formula id="IEq3"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\rho ^{\prime} \left( {i,j} \right)$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:msup><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="41592_2021_1231_Article_IEq3.gif"/></alternatives></inline-formula> and <inline-formula id="IEq4"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta ^{\prime} \left( {i,j} \right)$$\end{document}</tex-math><mml:math id="M12"><mml:mrow><mml:msup><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="41592_2021_1231_Article_IEq4.gif"/></alternatives></inline-formula> are within range [0,1]. We then defined <inline-formula id="IEq5"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\eta \left( {i,j} \right) = \rho ^{\prime} \left( {i,j} \right) \times \delta ^{\prime} \left( {i,j} \right)$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:mi>η</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="41592_2021_1231_Article_IEq5.gif"/></alternatives></inline-formula>, ordered all loop candidates by their <italic>η</italic> in the descending order and plotted the rank of <italic>η</italic> against the value of <italic>η</italic>. In this plot, we selected the reflection point such that the slope at the reflection point is one. All loop candidates with <italic>η</italic> larger than <italic>η</italic> at the reflection point were chosen to be the loop cluster centers. After finding the loop cluster centers, we assigned each remaining loop candidate to the same loop cluster as its nearest neighbor with a higher local density <italic>ρ</italic>.</p>
        <p id="Par26">Within each loop cluster, we defined the loop candidate with the lowest FDR as the first summit of the cluster. For the first summit (<italic>i</italic>, <italic>j</italic>), we defined its surrounding area as all 10-kb bin pairs (<italic>m</italic>,<italic>n</italic>) such that max{<italic>d</italic>(<italic>i</italic>,<italic>m</italic>),<italic>d</italic>(<italic>j</italic>,<italic>n</italic>)} ≤ 20 kb, and removed all loop candidates within its surrounding area. Next, we selected the loop candidate with the lowest FDR among the remaining ones (if there is any) as the second summit of this cluster. We then removed all loop candidates within the surrounding area of the second summit in the same way as we did for the first summit, and searched for the third summit (if there is any) with the lowest FDR among the remaining loop candidates. Such a procedure was iterated until there were no loop candidates left in this cluster. Note that one loop cluster may contain multiple summits. The SnapHiC algorithm outputs a file containing the summit(s) of each loop cluster as its final chromatin loop list.</p>
        <p id="Par27">Details about the justification of the thresholds implemented in SnapHiC can be found in <xref rid="MOESM1" ref-type="media">Supplementary Note</xref> and Supplementary Figs. <xref rid="MOESM1" ref-type="media">2</xref> and <xref rid="MOESM1" ref-type="media">3</xref>.</p>
      </sec>
    </sec>
    <sec id="Sec10">
      <title>Identification of chromatin loops with SnapHiC</title>
      <p id="Par28">We applied SnapHiC to scHi-C data from 10, 25, 50, 75, 100, 200, 300, 400, 500, 600, 700 and 742 mES cells and each of the 14 cell clusters from sn-m3C-seq data of human prefrontal cortex to call chromatin loops at 10-kb resolution between the 100 kb and 1 Mb region on autosomal chromosomes.</p>
      <p id="Par29">We did not take bin pairs within 100 kb into consideration because they do not have complete information in their local neighborhood (refer to <xref rid="Sec5" ref-type="sec">SnapHiC algorithm</xref>). We also evaluated the performance of SnapHiC beyond 1 Mb 1D genomic distance or at a different resolution; the results are summarized in the <xref rid="MOESM1" ref-type="media">Supplementary Note</xref>.</p>
    </sec>
    <sec id="Sec11">
      <title>Visualization of scHi-C and sn-m3C-seq data using percentage (%) of outlier cells matrix</title>
      <p id="Par30">Due to the sparsity of the raw count matrix of scHi-C data, the SnapHiC-identified loops can be visualized by the percentage of the outlier cells matrix. Specifically, we first computed the percentage of outlier cells (that is, cells with normalized contact probability &gt;1.96), and then took the integer ceiling of 100 × (% of outlier cells) to create a count matrix. We then used the Juicer<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> software to convert the count matrix into a .hic file and visualize it in Juicebox<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>.</p>
    </sec>
    <sec id="Sec12">
      <title>Generation of aggregated contact matrix for scHi-C and sn-m3C-seq data</title>
      <p id="Par31">We pooled contacts from single cells of interest to create the aggregated contact matrix in .hic format using Juicer with KR normalization<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. Only intrachromosomal contacts &gt;2 kb away were used.</p>
    </sec>
    <sec id="Sec13">
      <title>Identification of loops/interactions using HiCCUPS, FastHiC, FitHiC2 and HiC-ACT from aggregated contact matrix</title>
      <p id="Par32">We applied the HiCCUPS<sup><xref ref-type="bibr" rid="CR4">4</xref></sup> to the aggregated contact matrix after pooling the contacts from single cells of interest and calling loops at 10-kb resolution with the two sets of parameters: (1) default parameter: ‘-ignore_sparsity -r 10000 -k KR -f.1 -p 2 -i 5 -t 0.02,1.5,1.75,2 -d 20000’ and (2) optimal parameter: ‘-ignore_sparsity -r 10000 -k KR -f .1 -p 4 -i 15 -t 0.4,1.5,1.75,2 -d 20000’.</p>
      <p id="Par33">We applied FitHiC2 (ref. <sup><xref ref-type="bibr" rid="CR5">5</xref></sup>), FastHiC<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> and HiC-ACT<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, with the default setting to the aggregated contact matrix after pooling the contacts from single cells of interest at 10-kb bin resolution. We also tested different significance thresholds to accommodate the sparse scHi-C data: FDR &lt; 1%, &lt;5% and &lt;10% for FitHiC2; the posterior probability of significant interactions &gt;0.9, &gt;0.99 and &gt;0.999 for FastHiC and the local neighborhood smoothed <italic>P</italic> values &lt;10<sup>−6</sup>, &lt;10<sup>−</sup><sup>7</sup> and &lt;10<sup>−</sup><sup>8</sup> for HiC-ACT. After getting the raw output, we further removed significant chromatin interactions supported by fewer than six reads to minimize false positives. We then applied the same algorithm implemented in SnapHiC (Step D in <xref rid="Sec5" ref-type="sec">SnapHiC algorithm</xref>) to identify their summits.</p>
      <p id="Par34">To ensure a fair comparison with SnapHiC-identified loops, we further filtered the above identified loops/interactions by selecting the intrachromosomal ones within 1D genomic distance roughly 100 kb–1 Mb and removing the loops whose anchor bins had low mappability (≤0.8) or overlapped with the ENCODE blacklist regions.</p>
    </sec>
    <sec id="Sec14">
      <title>Definition of loop overlap</title>
      <p id="Par35">Let bin pair (<italic>i</italic>,<italic>j</italic>) represent a loop in set <italic>A</italic>. We define that it overlaps with a loop in set <italic>B</italic>, if and only if there exists a loop (<italic>m</italic>,<italic>n</italic>) in set <italic>B</italic> such that max(<italic>d</italic><sub><italic>im</italic></sub>, <italic>d</italic><sub><italic>jn</italic></sub>) ≤ 20 kb, where <italic>d</italic><sub><italic>im</italic></sub> is the 1D genomic distance between the middle base pair of bin <italic>i</italic> and the middle base pair of bin <italic>m</italic>.</p>
    </sec>
    <sec id="Sec15">
      <title>Subsampling of scHi-C and sn-m3C-seq data</title>
      <p id="Par36">For scHi-C data from mES cells, we randomly permuted the order of all 742 cells that passing our quality control six times, and selected the first 10, 25, 50, 75, 100, 200, 300, 400, 500, 600 and 700 cells from all 742 cells to create a series of subsampled datasets.</p>
      <p id="Par37">For sc-m3C-seq data from human prefrontal cortex, we randomly permuted the order of all 338 astrocytes, 323 microglia and 1,038 oligodendrocytes and selected the first 261 cells to create the subsampled datasets for astrocytes, microglia and oligodendrocytes, respectively.</p>
    </sec>
    <sec id="Sec16">
      <title>Reproducibility of SnapHiC- and HiCCUPS-identified loops</title>
      <p id="Par38">Suppose we have two sets of loop list A and B. Let <italic>P</italic><sub>A</sub> represent the proportion of loops in set A overlapped with loops in set B (<xref rid="Sec14" ref-type="sec">Definition of loop overlap</xref>) and let <italic>P</italic><sub>B</sub> represent the proportion of loops in set B overlapped with loops in set A. We used (<italic>P</italic><sub>A</sub> + <italic>P</italic><sub>B</sub>)/2 to measure the reproducibility of loops in the two sets.</p>
      <p id="Par39">To assess the reproducibility of SnapHiC and HiCCUPS, we first randomly split all 742 mES cells into two groups where each group consists of 371 cells, and then applied SnapHiC and HiCCUPS to identify loops for each group. The reproducibility of SnapHiC- and HiCCUPS-identified loops between two sets of 371 cells was calculated as described above. We repeated such random splitting and loop calling analysis ten times, and reported the mean of reproducibility of SnapHiC and HiCCUPS-identified loops. We further used the paired <italic>t</italic>-test to evaluate the statistical significance of the difference in reproducibility between the methods.</p>
    </sec>
    <sec id="Sec17">
      <title>Generation of the reference loop/interaction lists for calculation of precision, recall and F1 score</title>
      <p id="Par40">For mES cells, the HiCCUPS loops at 10-kb resolution from bulk in situ Hi-C data were called as previously described<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> using the pooled datasets of all four biological replicates from the Bonev et al. study<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. MAPS<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> was applied to H3K4me3 PLAC-seq data<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>, cohesin HiChIP data<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and H3K27ac HiChIP data<sup><xref ref-type="bibr" rid="CR11">11</xref></sup> to call significant intrachromosomal interactions at 10-kb resolution within 1 Mb. We combined the above four lists and further filtered by removing interactions where anchor bins had low mappability (≤0.8) or overlapped with the ENCODE blacklist regions to create the final reference loop list.</p>
      <p id="Par41">For oligodendrocytes, microglia and eight neuronal subtypes from human prefrontal cortex, we used MAPS-identified interactions from H3K4me3 PLAC-seq data of purified oligodendrocytes, microglia and neurons as their reference list, respectively<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. We first filtered the list by selecting loops with 1D genomic distance roughly 100 kb–1 Mb and removing loops where anchor bins had low mappability (≤0.8) or overlapped with the ENCODE blacklist regions. We further selected the loops in which at least one end contains active promoters of the corresponding cell type to create the final reference interaction list.</p>
    </sec>
    <sec id="Sec18">
      <title>Calculation of precision, recall and F1 score</title>
      <p id="Par42">Let <italic>N</italic> represent the number of loops in the reference loop list for the cell type of interest. Suppose method A identifies <italic>M</italic> loops from the same cell type, and <italic>m</italic> of them overlapped with loops in the reference loop list (<xref rid="Sec14" ref-type="sec">Definition of loop overlap</xref>). The precision is calculated as <italic>m</italic>/<italic>M</italic>. Suppose among all <italic>N</italic> loops in the reference loop list, <italic>n</italic> loops overlapped with method A-identified loops. The recall is calculated as <italic>n</italic>/<italic>N</italic>. Notably, <italic>m</italic> and <italic>n</italic> may not be equal since we allow up to a 20-kb gap between two overlapped loops. The F1 score is the harmonic mean of the precision and recall and is calculated as below:<disp-formula id="Equc"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mathrm{F1}}\,{\mathrm{score}} = 2 \times \frac{{{\mathrm{Precision}} \times {\mathrm{Recall}}}}{{{\mathrm{Precision}} + {\mathrm{Recall}}}} = 2 \times \frac{{m/M \times n/N}}{{m/M + n/N}}.$$\end{document}</tex-math><mml:math id="M16"><mml:mrow><mml:mi mathvariant="normal">F1</mml:mi><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">score</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Precision</mml:mi><mml:mo>×</mml:mo><mml:mi mathvariant="normal">Recall</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Precision</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">Recall</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mfrac><mml:mrow><mml:mi>m</mml:mi><mml:mo>/</mml:mo><mml:mi>M</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>/</mml:mo><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math><graphic xlink:href="41592_2021_1231_Article_Equc.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par43">For mES cells, we used all SnapHiC-, HiCCUPS-, FastHiC-, FitHiC2- or HiC-ACT-identified loops/interactions for the above calculation. For oligodendrocytes, microglia and eight neuronal subtypes, we only selected the SnapHiC-, HiCCUPS-, FastHiC-, FitHiC2- or HiC-ACT-identified loops/interactions in which at least one end contains active promoters of the corresponding cell type for this calculation, since the available reference loop lists are called from H3K4me3 PLAC-seq data, which can only detect interactions centered at promoter regions.</p>
    </sec>
    <sec id="Sec19">
      <title>APA</title>
      <p id="Par44">We used the Juicer<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> software with the command ‘java -jar juicer_tools_1.19.02.jar apa -r 10000 -k KR -u input.hic loops.txt APA’ to perform the APA. We reported ‘P2LL’ (also known as the APA score) and ‘ZscoreLL’ to evaluate the enrichment of SnapHiC-identified loops with respect to the lower left background.</p>
    </sec>
    <sec id="Sec20">
      <title>CTCF motif orientation analysis</title>
      <p id="Par45">We obtained the CTCF ChIP–seq peaks of mES cells from Kubo et al.<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> and used FIMO<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> with default parameters and the CTCF motif (MA0139.1) from the JASPAR<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> database to search for CTCF sequence motifs among CTCF ChIP–seq peaks. We then selected a subset of testable SnapHiC-identified loops in which both ends contain either a single CTCF motif or multiple CTCF motifs in the same direction and calculated the proportion of convergent, tandem and divergent CTCF motif pairs among all testable loops.</p>
    </sec>
    <sec id="Sec21">
      <title>Visualization of CTCF and H3K27ac ChIP–seq data from mES cells</title>
      <p id="Par46">We downloaded the signal tracks from the ENCODE portal (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/">https://www.encodeproject.org/</ext-link>) with the following identifiers: <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/search/?searchTerm=ENCFF230RNU">ENCFF230RNU</ext-link> (for H3K27ac) and <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/search/?searchTerm=ENCFF069PTO">ENCFF069PTO</ext-link> (for CTCF) for Extended Data Fig. <xref rid="Fig6" ref-type="fig">4a</xref>.</p>
    </sec>
    <sec id="Sec22">
      <title>Definition of cell type-specific SnapHiC loops</title>
      <p id="Par47">We used the SnapHiC loops identified from subsampled astrocytes, microglia and oligodendrocytes datasets and L2/3 excitatory neurons (all with 261 cells) to define cell type-specific loops. We defined a loop identified from one cell type as cell type-specific, if it did not overlap (<xref rid="Sec14" ref-type="sec">Definition of loop overlap</xref>) with loops identified from any of the other three cell types.</p>
    </sec>
    <sec id="Sec23">
      <title>Processing of ATAC-seq and H3K27ac ChIP–seq data from four brain cell types</title>
      <p id="Par48">The ATAC-seq and H3K27ac ChIP–seq data from human astrocytes, oligodendrocytes, microglia and neurons are from Nott et al.<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> and are processed with ENCODE ATAC-seq and ChIP–seq pipelines as previously described<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>. The normalized bigwig tracks with reads per kilobase of a transcript, per million mapped reads as the <italic>y</italic> axis are generated for visualization in Fig. <xref rid="Fig2" ref-type="fig">2b</xref>.</p>
    </sec>
    <sec id="Sec24">
      <title>Processing of RNA-seq from four brain cell types</title>
      <p id="Par49">The RNA-seq data from human astrocytes, oligodendrocytes, microglia and neurons were acquired from Zhang et al.<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. The alignment and quantification are performed with pipeline: <ext-link ext-link-type="uri" xlink:href="https://github.com/ren-lab/rnaseq-pipeline">https://github.com/ren-lab/rnaseq-pipeline</ext-link>. Briefly, we first aligned RNA-seq raw reads to hg19. Next, we used Gencode GTF gencode.v19.annotation.gtf for hg19 with STAR following the ‘ENCODE’ options outlined in the STAR manual (<ext-link ext-link-type="uri" xlink:href="https://physiology.med.cornell.edu/faculty/skrabanek/lab/angsd/lecture_notes/STARmanual.pdf">https://physiology.med.cornell.edu/faculty/skrabanek/lab/angsd/lecture_notes/STARmanual.pdf</ext-link>). We then used Picard (<ext-link ext-link-type="uri" xlink:href="http://broadinstitute.github.io/picard/">http://broadinstitute.github.io/picard/</ext-link>) to remove PCR duplicates. We also generated the normalized bigwig tracks with reads per kilobase of a transcript, per million mapped reads as the <italic>y</italic> axis for visualization in Fig. <xref rid="Fig2" ref-type="fig">2b</xref>.</p>
    </sec>
    <sec id="Sec25">
      <title>Enrichment analysis of ATAC-seq or H3K27ac ChIP–seq signals at cell type-specific loops</title>
      <p id="Par50">To quantify the intensity of ATAC-seq or H3K27ac ChIP–seq signals at cell type-specific loops in the cell type of interest, we first calculated reads per million (CPM) values in each 10-kb anchor of the cell type-specific loops using ATAC-seq or H3K27ac ChIP–seq data from the cell type of interest. To minimize the background noise, we only considered the reads falling into the ATAC-seq or H3K27ac ChIP–seq peak regions defined in the cell type of interest but not all the reads in the entire 10-kb bin. If there are multiple ATAC-seq or H3K27ac ChIP–seq peaks in the same 10-kb bin, we then added up the CPM values and took the sum as the value for that 10-kb bin. Since each loop has two anchors, we took their average CPM to represent the intensity of ATAC-seq or H3K27ac ChIP–seq signal for that loop in the cell type of interest. Last, we applied the paired Wilcoxon signed-rank test on log<sub>2</sub>(CPM+1) values from different combinations of cell types of interest and the cell type-specific loop sets to test whether there is a significant difference.</p>
    </sec>
    <sec id="Sec26">
      <title>Gene expression analysis at cell type-specific loops</title>
      <p id="Par51">We obtained the fragments per kilobase of transcript per million mapped reads (FPKM) values of each protein-coding gene in human astrocytes, neurons, microglia and oligodendrocytes from Supplementary Table <xref rid="MOESM3" ref-type="media">4</xref> provided in Zhang et al. (Col P-U for astrocytes, Col AB for neurons, Col AC-AG for oligodendrocytes and Col AH-AJ for microglia in the ‘Human data only’ tab)<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. For each gene, we took the average of FPKM across biological replicates of the same cell type. For the selected genes where promoters overlapped with cell type-specific loops, we applied the Wilcoxon signed-rank test to evaluate whether they were highly expressed in the matched cell type.</p>
    </sec>
    <sec id="Sec27">
      <title>Selection of GWAS SNPs associated with neuropsychiatric disorders and traits</title>
      <p id="Par52">We first collected 30,262 genome-wide significant (<italic>P</italic> &lt; 5 × 10<sup>−8</sup>) noncoding GWAS SNPs associated with neuropsychiatric disorders and traits. We considered seven neuropsychiatric disorders, including Alzheimer’s disease<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, attention deficit hyperactivity disorder<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>, autism spectrum disorder<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>, bipolar disorder<sup><xref ref-type="bibr" rid="CR29">29</xref></sup>, intelligence quotient<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>, MDD<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> and schizophrenia<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, resulting in a total of 28,099 unique GWAS SNPs (Supplementary Table <xref rid="MOESM3" ref-type="media">6</xref>). We then overlapped these GWAS SNPs with active enhancers of astrocytes, neurons, microglia or oligodendrocytes defined in the previous study<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> and this resulted in 3,639 SNP-disease associations (3,471 unique GWAS SNPs) for analysis (Supplementary Table <xref rid="MOESM3" ref-type="media">6</xref>).</p>
    </sec>
    <sec id="Sec28">
      <title>Reporting Summary</title>
      <p id="Par53">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Research Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec id="Sec29" sec-type="materials|methods">
    <title>Online content</title>
    <p id="Par54">Any methods, additional references, Nature Research reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at 10.1038/s41592-021-01231-2.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <p>
      <supplementary-material content-type="local-data" id="MOESM1">
        <media xlink:href="41592_2021_1231_MOESM1_ESM.pdf">
          <label>Supplementary Information</label>
          <caption>
            <p>Supplementary Figs. 1–4 and Note.</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM2">
        <media xlink:href="41592_2021_1231_MOESM2_ESM.pdf">
          <caption>
            <p>Reporting Summary</p>
          </caption>
        </media>
      </supplementary-material>
      <supplementary-material content-type="local-data" id="MOESM3">
        <media xlink:href="41592_2021_1231_MOESM3_ESM.xlsx">
          <caption>
            <p>Supplementary Tables 1–7.</p>
          </caption>
        </media>
      </supplementary-material>
    </p>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec30">
        <title>Extended data</title>
        <p id="Par58">
          <fig id="Fig3">
            <label>Extended Data Fig. 1</label>
            <caption>
              <title>Optimization of HiCCUPS parameters using aggregated scHi-C data of the 742 mES cells.</title>
              <p>The number of loops within 100Kb to 1 Mb range (<bold>a</bold>), precision rate (<bold>b</bold>), recall rate (<bold>c</bold>) and F1 score (<bold>d</bold>) for HiCCUPS loops running with different parameters. Default parameter: -f .1 -p 2 -i 5 -t 0.02,1.5,1.75,2 -d 20000. Related to <xref rid="MOESM1" ref-type="media">Supplementary Note</xref>.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig3_ESM" id="d32e2443"/>
          </fig>
        </p>
        <p id="Par59">
          <fig id="Fig4">
            <label>Extended Data Fig. 2</label>
            <caption>
              <title>Comparison of SnapHiC- and HiCCUPS-identified loops from mES cells.</title>
              <p><bold>a</bold>, Venn diagram of overlaps between SnapHiC- and HiCCUPS-identified loops (with default or optimal parameters) from 742 mES cells. <bold>b</bold>, <bold>c</bold>, Line plots showing the performance of SnapHiC and HiCCUPS applied to different number of mES cells (N=10, 25, 50, 75, 100, 200, 300, 400, 500, 600, 700 and 742). The dots represent the mean values of precision rate (<bold>b</bold>) and recall rate (<bold>c</bold>) across six randomly sampled subsets of mES cells from the 742 cells that passed our quality control (see details in Methods), respectively (except for N=742). The error bar represents the standard deviation calculated across six randomly sampled subsets. These values are also used to calculate the F1 score in Fig. <xref rid="Fig1" ref-type="fig">1c</xref>. If the lower bound of confidence interval (mean-sd) is less than 0, it is set as 0. For precision, recall and F1-score, if the upper bound of confidence interval (mean+sd) is greater 1, it is set as 1.</p>
              <p>
                <xref rid="MOESM6" ref-type="media">Source data</xref>
              </p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig4_ESM" id="d32e2479"/>
          </fig>
        </p>
        <p id="Par60">
          <fig id="Fig5">
            <label>Extended Data Fig. 3</label>
            <caption>
              <title>SnapHiC-identified loops from different sub-sampling of mES cells showed significant enrichment over their local backgrounds.</title>
              <p>Aggregate peak analysis (APA) of SnapHiC-identified loops from different sub-sampling of mES cells examined on aggregated scHi-C contact matrix of 742 cells.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig5_ESM" id="d32e2493"/>
          </fig>
        </p>
        <p id="Par61">
          <fig id="Fig6">
            <label>Extended Data Fig. 4</label>
            <caption>
              <title>Performance of SnapHiC and HiCCUPS at <italic>Sox2</italic>, <italic>Wnt6</italic> and <italic>Mtnr1a</italic> loci.</title>
              <p><bold>a</bold>, (Top) Chromatin loops around <italic>Sox2</italic> (left), <italic>Wnt6</italic> (middle), and <italic>Mtnr1a</italic> (right) gene identified from 100 mES cells using SnapHiC at 10 kb resolution. The black arrow points to the interactions verified in the previous publications<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR14">14</xref></sup> with CRISPR/Cas9 deletion or 3C-qPCR. (Bottom) Comparison of the performance of SnapHiC and HiCCUPS (applied on aggregated scHi-C data with default or optimal parameters) from different number of mES cells at these three regions. If the previously verified interaction (black arrow) is recaptured, it is labeled as ‘Y’; otherwise, it is labeled as ‘N’. <bold>b</bold>, From left to right: aggregated scHi-C contact matrix of 100 mES cells, aggregated scHi-C contact matrix of 742 mES cells, bulk in situ Hi-C contact matrix from mES cells (replicate 1 from Bonev et al. study<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>) and % of outlier cells matrix of 100 mES cells at 10 kb resolution; from top to bottom: <italic>Sox2</italic> locus, <italic>Wnt6</italic> locus, and <italic>Mtnr1a</italic> locus. Black squares represent the SnapHiC-identified loops from 100 mES cells, which are shown in (a) as purple arcs. For comparison, the HiCCUPS-identified loops from the deepest available bulk in situ Hi-C data of mES cells (combining all four replicates from Bonev et al. study<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>) are marked as blue squares.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig6_ESM" id="d32e2555"/>
          </fig>
        </p>
        <p id="Par62">
          <fig id="Fig7">
            <label>Extended Data Fig. 5</label>
            <caption>
              <title>Comparison of the performance of SnapHiC with FastHiC, FitHiC2 and HiC-ACT.</title>
              <p>The performance of FastHiC <bold>a</bold>, FitHiC2 <bold>b,﻿</bold> and HiC-ACT <bold>c</bold>,﻿ on different numbers of mES cells (N=10, 25, 50, 75, 100, 200, 300, 400, 500, 600, 700 and 742), comparing with SnapHiC. The dots represent the mean values of the numbers of loops/interactions, precision rate, recall rate and F1 score of six randomly sampled subsets of mES cells from the 742 cells that passed our quality control, respectively (except for N=742). The error bar represents the standard deviation calculated across six randomly sampled subsets. For FastHiC (<bold>a</bold>), the posterior probability of being significant interactions &gt;0.999 is commonly used; two more lenient thresholds &gt;0.99 and &gt;0.9 were tested considering the sparsity of single cell Hi-C data. For FitHiC2 (<bold>﻿b</bold>), FDR&lt;0.01 is commonly used; two more lenient thresholds &lt;0.05 and &lt;0.1 were tested considering the sparsity of single cell Hi-C data. For HiC-ACT (<bold>c</bold>), smoothed p-value &lt;1e-8 is commonly used; two more lenient thresholds &lt;1e-7 and &lt;1e-6 were tested considering the sparsity of single cell Hi-C data. The HiC-ACT p-values are calculated based on one-sided aggregated Cauchy test. In <bold>a</bold>, <bold>﻿b</bold> and <bold>﻿c</bold>, if the lower bound of confidence interval (mean-sd) is less than 0, it is set as 0. For precision rate, recall rate and F1-score, if the upper bound of confidence interval (mean+sd) is greater 1, it is set as 1.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig7_ESM" id="d32e2597"/>
          </fig>
        </p>
        <p id="Par63">
          <fig id="Fig8">
            <label>Extended Data Fig. 6</label>
            <caption>
              <title>Comparison of the performance of SnapHiC with HiCCUPS, FastHiC, FitHiC2 and HiC-ACT at <italic>Sox2</italic>, <italic>Wnt6</italic> and <italic>Mtnr1a</italic> loci.</title>
              <p>If the previously verified interaction (black arrow in Extended Data Fig. <xref rid="Fig6" ref-type="fig">4a</xref>) is recaptured, it is labeled as ‘Y’; otherwise, it is labeled as ‘N’.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig8_ESM" id="d32e2623"/>
          </fig>
        </p>
        <p id="Par64">
          <fig id="Fig9">
            <label>Extended Data Fig. 7</label>
            <caption>
              <title>Identification of loops/interactions using sn-m3C-seq data generated from human prefrontal cortex by different methods.</title>
              <p><bold>a</bold>, t-SNE visualization of 14 major cell types identified in human prefrontal cortex in Lee et al. study<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> based on cell-type-specific CG and non-CG methylation patterns. ODC: oligodendrocyte. Astro: astrocyte. MG: microglia. OPC: oligodendrocyte progenitor cell. Endo: endothelial cell. L2/3, L4, L5 and L6: excitatory neuron subtypes located in different cortical layers. Pvalb and Sst: medial ganglionic eminence-derived inhibitory subtypes. Ndnf and Vip: CGE-derived inhibitory subtypes. NN1: non-neuronal cell type 1. <bold>b</bold>, The number of loops/interactions identified from each of the 14 cell types by SnapHiC, HiCCUPS, FitHiC2, FastHiC and HiC-ACT.</p>
              <p>
                <xref rid="MOESM7" ref-type="media">Source data</xref>
              </p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig9_ESM" id="d32e2651"/>
          </fig>
        </p>
        <p id="Par65">
          <fig id="Fig10">
            <label>Extended Data Fig. 8</label>
            <caption>
              <title>F1 score of SnapHiC-, HiCCUPS-, FitHiC2-, FastHiC- and HiC-ACT-identified loops/interactions for ten cell clusters from human prefrontal cortex.</title>
              <p>The F1 scores are calculated for oligodendrocytes (ODC), microglia (MG), and eight neuronal subtypes (L2/3, L4, L5, L6, Sst, Vip, Ndnf and Pvalb) using promoter-centered chromatin interactions previously identified from H3K4me3 PLAC-seq data<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> of purified oligodendrocytes, microglia, astrocytes and neurons, respectively.</p>
              <p>
                <xref rid="MOESM8" ref-type="media">Source data</xref>
              </p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig10_ESM" id="d32e2674"/>
          </fig>
        </p>
        <p id="Par66">
          <fig id="Fig11">
            <label>Extended Data Fig. 9</label>
            <caption>
              <title>SnapHiC-identified loops from each of the 14 cell clusters identified from sn-m3C-seq data of the human prefrontal cortex show significant enrichment over their local background.</title>
              <p>Aggregate peak analysis (APA) of SnapHiC-identified loops for each of the 14 cell types demonstrated in Extended Data Fig. <xref rid="Fig9" ref-type="fig">7a</xref> examined on the aggregated contact matrices from the matching cell types.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig11_ESM" id="d32e2691"/>
          </fig>
        </p>
        <p id="Par67">
          <fig id="Fig12">
            <label>Extended Data Fig. 10</label>
            <caption>
              <title>Application of SnapHiC to identify loops in specific cell types.</title>
              <p><bold>a</bold>, Top seven enriched gene ontology (GO) terms of genes associated with Astro-specific, MG-specific, ODC-specific and L2/3-specific SnapHiC loops. The p-values are calculated based on the accumulative hypergeometric distribution. <bold>b</bold>, Matrix of the percentage of cells with significantly higher normalized contact frequency (percentage of outlier cells with normalized contact frequency&gt;1.96) for 261 astrocytes around APOE gene. The two SnapHiC-identified loops from astrocyte are marked by black squares and their labels matched the numbers shown in Fig. <xref rid="Fig2" ref-type="fig">2c</xref>.</p>
            </caption>
            <graphic position="anchor" xlink:href="41592_2021_1231_Fig12_ESM" id="d32e2713"/>
          </fig>
        </p>
      </sec>
      <sec id="Sec32">
        <title>Source data</title>
        <p id="Par69">
          <media position="anchor" xlink:href="41592_2021_1231_MOESM4_ESM.xlsx" id="MOESM4">
            <label>Source Data Fig. 1</label>
            <caption>
              <p>SnapHiC-identified loops from different numbers of mES cells (<italic>N</italic> = 10, 25, 50, 75, 100, 200, 300, 400, 500, 600, 700, 742). For <italic>N</italic> = 10, 25, 50, 75, 100, 200, 300, 400, 500, 600, 700, loop calling was repeated six times on the subsampling datasets randomly selected from the 742 cells that passed our quality control. The tab name indicates the subsampling index (that is, ‘Permu0’, ‘Permu1’, ‘Permu2’, ‘Permu3’, ‘Permu4’, ‘Permu5’) and the number of cells used (that is, ‘10’, ‘25’, ‘50’, ‘75’, ‘100’, ‘200’, ‘300’, ‘400’, ‘500’, ‘600’, ‘700’, ‘742’).</p>
            </caption>
          </media>
          <media position="anchor" xlink:href="41592_2021_1231_MOESM5_ESM.xlsx" id="MOESM5">
            <label>Source Data Fig. 2</label>
            <caption>
              <p>SnapHiC-identified loops from astrocytes, microglia and oligodendrocytes after subsampling (261 cells for each cell type) and the cell-type-specific loops from astrocytes, microglia, oligodendrocytes and L2/3 excitatory neurons after subsampling.</p>
            </caption>
          </media>
          <media position="anchor" xlink:href="41592_2021_1231_MOESM6_ESM.xlsx" id="MOESM6">
            <label>Source Data Extended Data Fig. 2</label>
            <caption>
              <p>HiCCUPS-identified loops from bulk in situ Hi-C data, MAPS-identified significant interactions from H3K4me3 PLAC-seq, cohesin HiChIP and H3K27ac HiChIP data from mES cells, which are used as the reference list after pooling to calculate precision rate, recall rate and the F1 score for loops/interactions identified from mES cells.</p>
            </caption>
          </media>
          <media position="anchor" xlink:href="41592_2021_1231_MOESM7_ESM.xlsx" id="MOESM7">
            <label>Source Data Extended Data Fig. 7</label>
            <caption>
              <p>SnapHiC-identified loops from each of the 14 different cell types in human prefrontal cortex. The tab name indicates the cell type.</p>
            </caption>
          </media>
          <media position="anchor" xlink:href="41592_2021_1231_MOESM8_ESM.xlsx" id="MOESM8">
            <label>Source Data Extended Data Fig. 8</label>
            <caption>
              <p>MAPS-identified interaction lists of human microglia (MG), oligodendrocytes (ODC) and neurons from the Nott. et al. study, which are used to calculate precision rate, recall rate and the F1 score for MG, ODC and eight neuronal subtypes (L2/3, L4, L5, L6, Sst, Vip, Ndnf and Pvalb), respectively.</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Peer review information</bold><italic>Nature Methods</italic> thanks Silvio Bicciato and the other, anonymous, reviewers for their contribution to the peer review of this work. Editor recognition statement: Lei Tang was the primary editor on this article and managed its editorial process and peer review in collaboration with the rest of the editorial team.</p>
    </fn>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Miao Yu, Armen Abnousi.</p>
    </fn>
    <fn>
      <p>These authors jointly supervised this work: Bing Ren, Ming Hu.</p>
    </fn>
  </fn-group>
  <sec>
    <sec id="FPar1">
      <title>Extended data</title>
      <p id="Par55">is available for this paper at 10.1038/s41592-021-01231-2.</p>
    </sec>
    <sec id="FPar2" sec-type="supplementary-material">
      <title>Supplementary information</title>
      <p id="Par56">The online version contains supplementary material available at 10.1038/s41592-021-01231-2.</p>
    </sec>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank 4D Nucleome consortium investigators for comments and suggestions on the early version of this work. This study was funded by grant nos. U54DK107977 and UM1HG011585 (to B.R. and M.H.), and U01DA052713, R01GM105785 and P50HD103573 (to Y.L.).</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>This study was conceived and designed by M.H. and B.R. Data analysis was conducted by M.H., M.Y., A.A., Y.Z., G.L., L.L., Z.C., R.F., T.M.L, Y.Y., J.W., Q.S. and Y.L. The SnapHiC software package was developed by A.A. and M.H. The paper was written by M.H., M.Y. and B.R. with input from all authors.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The scHi-C data from mES cells were downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94489">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE94489</ext-link>. The sn-m3C-seq data from human prefrontal cortex were downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130711">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE130711</ext-link>. The ATAC-seq and H3K27ac ChIP–seq data from human astrocytes, oligodendrocytes, microglia and neurons were downloaded from dbGap (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/study.cgi?study_id=phs001373.v2.p2">https://www.ncbi.nlm.nih.gov/projects/gap/cgi-bin/study.cgi?study_id=phs001373.v2.p2</ext-link>). The RNA-seq data from human astrocytes, oligodendrocytes, microglia and neurons were downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE73721">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE73721</ext-link>. The signal tracks of CTCF and H3K27ac ChIP–seq data for mES cells (Extended Data Fig. <xref rid="Fig6" ref-type="fig">4a</xref>) were downloaded from the ENCODE portal (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/">https://www.encodeproject.org/</ext-link>) with the following identifiers: <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/search/?searchTerm=ENCFF230RNU">ENCFF230RNU</ext-link> (for H3K27ac) and <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/search/?searchTerm=ENCFF069PTO">ENCFF069PTO</ext-link> (for CTCF). The hg19 and mm10 reference genomes were downloaded from <ext-link ext-link-type="uri" xlink:href="https://hgdownload.soe.ucsc.edu/goldenPath/hg19/bigZips/hg19.fa.gz">https://hgdownload.soe.ucsc.edu/goldenPath/hg19/bigZips/hg19.fa.gz</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://hgdownload.soe.ucsc.edu/goldenPath/mm10/bigZips/mm10.fa.gz">https://hgdownload.soe.ucsc.edu/goldenPath/mm10/bigZips/mm10.fa.gz</ext-link>, respectively. The full lists of interactions/loops identified by different methods are provided as source data. <xref rid="Sec32" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The SnapHiC software package with a detailed user tutorial and sample input and output files can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/HuMingLab/SnapHiC">https://github.com/HuMingLab/SnapHiC</ext-link>.</p>
  </notes>
  <notes id="FPar3" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par57">B.R. is a cofounder and shareholder of Arima Genomics, Inc. and Epigenome Technologies, Inc. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nagano</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell-cycle dynamics of chromosomal organization at single-cell resolution</article-title>
        <source>Nature</source>
        <year>2017</year>
        <volume>547</volume>
        <fpage>61</fpage>
        <lpage>67</lpage>
        <pub-id pub-id-type="doi">10.1038/nature23001</pub-id>
        <pub-id pub-id-type="pmid">28682332</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Joint profiling of DNA methylation and chromatin architecture in single cells</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>991</fpage>
        <lpage>993</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0502-z</pub-id>
        <pub-id pub-id-type="pmid">31384045</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>DS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous profiling of 3D genome structure and DNA methylation in single human cells</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>999</fpage>
        <lpage>1006</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0547-z</pub-id>
        <pub-id pub-id-type="pmid">31501549</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rao</surname>
            <given-names>SSP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A 3D map of the human genome at kilobase resolution reveals principles of chromatin looping</article-title>
        <source>Cell</source>
        <year>2014</year>
        <volume>159</volume>
        <fpage>1665</fpage>
        <lpage>1680</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2014.11.021</pub-id>
        <pub-id pub-id-type="pmid">25497547</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaul</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bhattacharyya</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Ay</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Identifying statistically significant chromatin contacts from Hi-C data with FitHiC2</article-title>
        <source>Nat. Protoc.</source>
        <year>2020</year>
        <volume>15</volume>
        <fpage>991</fpage>
        <lpage>1012</lpage>
        <pub-id pub-id-type="doi">10.1038/s41596-019-0273-0</pub-id>
        <pub-id pub-id-type="pmid">31980751</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhou</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust single-cell Hi-C clustering by convolution- and random-walk-based imputation</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>14011</fpage>
        <lpage>14018</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1901423116</pub-id>
        <pub-id pub-id-type="pmid">31235599</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriguez</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Laio</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Clustering by fast search and find of density peaks</article-title>
        <source>Science</source>
        <year>2014</year>
        <volume>344</volume>
        <fpage>1492</fpage>
        <lpage>1496</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1242072</pub-id>
        <pub-id pub-id-type="pmid">24970081</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bonev</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiscale 3D genome rewiring during mouse neural development</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>171</volume>
        <fpage>557</fpage>
        <lpage>572.e524</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2017.09.043</pub-id>
        <pub-id pub-id-type="pmid">29053968</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <mixed-citation publication-type="other">Juric, I. et al. MAPS: model-based analysis of long-range chromatin interactions from PLAC-seq and HiChIP experiments. <italic>PLoS Comput. Biol.</italic>10.1371/journal.pcbi.1006982 (2019).</mixed-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mumbach</surname>
            <given-names>MR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>HiChIP: efficient and sensitive analysis of protein-directed genome architecture</article-title>
        <source>Nat. Methods</source>
        <year>2016</year>
        <volume>13</volume>
        <fpage>919</fpage>
        <lpage>922</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3999</pub-id>
        <pub-id pub-id-type="pmid">27643841</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mumbach</surname>
            <given-names>MR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Enhancer connectome in primary human cells identifies target genes of disease-associated DNA elements</article-title>
        <source>Nat. Genet.</source>
        <year>2017</year>
        <volume>49</volume>
        <fpage>1602</fpage>
        <lpage>1612</lpage>
        <pub-id pub-id-type="doi">10.1038/ng.3963</pub-id>
        <pub-id pub-id-type="pmid">28945252</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fudenberg</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Formation of chromosomal domains by loop extrusion</article-title>
        <source>Cell Rep.</source>
        <year>2016</year>
        <volume>15</volume>
        <fpage>2038</fpage>
        <lpage>2049</lpage>
        <pub-id pub-id-type="doi">10.1016/j.celrep.2016.04.085</pub-id>
        <pub-id pub-id-type="pmid">27210764</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CRISPR reveals a distal super-enhancer required for Sox2 expression in mouse embryonic stem cells</article-title>
        <source>PLoS ONE</source>
        <year>2014</year>
        <volume>9</volume>
        <fpage>e114485</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0114485</pub-id>
        <pub-id pub-id-type="pmid">25486255</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schoenfelder</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The pluripotent regulatory circuitry connecting promoters to their long-range interacting elements</article-title>
        <source>Genome Res</source>
        <year>2015</year>
        <volume>25</volume>
        <fpage>582</fpage>
        <lpage>597</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.185272.114</pub-id>
        <pub-id pub-id-type="pmid">25752748</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>FastHiC: a fast and accurate algorithm to detect long-range chromosomal interactions from Hi-C data</article-title>
        <source>Bioinforma</source>
        <year>2016</year>
        <volume>32</volume>
        <fpage>2692</fpage>
        <lpage>2695</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw240</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lagler</surname>
            <given-names>TM</given-names>
          </name>
          <name>
            <surname>Abnousi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>HiC-ACT: improved detection of chromatin interactions from Hi-C data via aggregated Cauchy test</article-title>
        <source>Am. J. Hum. Genet.</source>
        <year>2021</year>
        <volume>108</volume>
        <fpage>257</fpage>
        <lpage>268</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ajhg.2021.01.009</pub-id>
        <pub-id pub-id-type="pmid">33545029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nott</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Brain cell type-specific enhancer-promoter interactome maps and disease-risk association</article-title>
        <source>Science</source>
        <year>2019</year>
        <volume>366</volume>
        <fpage>1134</fpage>
        <lpage>1139</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aay0793</pub-id>
        <pub-id pub-id-type="pmid">31727856</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Purification and characterization of progenitor and mature human astrocytes reveals transcriptional and functional differences with mouse</article-title>
        <source>Neuron</source>
        <year>2016</year>
        <volume>89</volume>
        <fpage>37</fpage>
        <lpage>53</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2015.11.013</pub-id>
        <pub-id pub-id-type="pmid">26687838</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhou</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metascape provides a biologist-oriented resource for the analysis of systems-level datasets</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1523</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-019-09234-6</pub-id>
        <pub-id pub-id-type="pmid">30944313</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>HiCNorm: removing biases in Hi-C data via Poisson regression</article-title>
        <source>Bioinforma</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>3131</fpage>
        <lpage>3133</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts570</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durand</surname>
            <given-names>NC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Juicer provides a one-click system for analyzing loop-resolution Hi-C experiments</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>95</fpage>
        <lpage>98</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2016.07.002</pub-id>
        <pub-id pub-id-type="pmid">27467249</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Durand</surname>
            <given-names>NC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Juicebox provides a visualization system for Hi-C contact maps with unlimited zoom</article-title>
        <source>Cell Syst.</source>
        <year>2016</year>
        <volume>3</volume>
        <fpage>99</fpage>
        <lpage>101</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2015.07.012</pub-id>
        <pub-id pub-id-type="pmid">27467250</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kubo</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Promoter-proximal CTCF binding promotes distal enhancer-dependent gene activation</article-title>
        <source>Nat. Struct. Mol. Biol.</source>
        <year>2021</year>
        <volume>28</volume>
        <fpage>152</fpage>
        <lpage>161</lpage>
        <pub-id pub-id-type="doi">10.1038/s41594-020-00539-5</pub-id>
        <pub-id pub-id-type="pmid">33398174</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grant</surname>
            <given-names>CE</given-names>
          </name>
          <name>
            <surname>Bailey</surname>
            <given-names>TL</given-names>
          </name>
          <name>
            <surname>Noble</surname>
            <given-names>WS</given-names>
          </name>
        </person-group>
        <article-title>FIMO: scanning for occurrences of a given motif</article-title>
        <source>Bioinforma</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1017</fpage>
        <lpage>1018</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr064</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Khan</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>JASPAR 2018: update of the open-access database of transcription factor binding profiles and its web framework</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2018</year>
        <volume>46</volume>
        <fpage>D260</fpage>
        <lpage>d266</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkx1126</pub-id>
        <pub-id pub-id-type="pmid">29140473</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jansen</surname>
            <given-names>IE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-wide meta-analysis identifies new loci and functional pathways influencing Alzheimer’s disease risk</article-title>
        <source>Nat. Genet.</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>404</fpage>
        <lpage>413</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-018-0311-9</pub-id>
        <pub-id pub-id-type="pmid">30617256</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Demontis</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Discovery of the first genome-wide significant risk loci for attention deficit/hyperactivity disorder</article-title>
        <source>Nat. Genet.</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>63</fpage>
        <lpage>75</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-018-0269-7</pub-id>
        <pub-id pub-id-type="pmid">30478444</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grove</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of common genetic risk variants for autism spectrum disorder</article-title>
        <source>Nat. Genet.</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>431</fpage>
        <lpage>444</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-019-0344-8</pub-id>
        <pub-id pub-id-type="pmid">30804558</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stahl</surname>
            <given-names>EA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-wide association study identifies 30 loci associated with bipolar disorder</article-title>
        <source>Nat. Genet.</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>793</fpage>
        <lpage>803</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-019-0397-8</pub-id>
        <pub-id pub-id-type="pmid">31043756</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Savage</surname>
            <given-names>JE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-wide association meta-analysis in 269,867 individuals identifies new genetic and functional links to intelligence</article-title>
        <source>Nat. Genet.</source>
        <year>2018</year>
        <volume>50</volume>
        <fpage>912</fpage>
        <lpage>919</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-018-0152-6</pub-id>
        <pub-id pub-id-type="pmid">29942086</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Howard</surname>
            <given-names>DM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genome-wide meta-analysis of depression identifies 102 independent variants and highlights the importance of the prefrontal brain regions</article-title>
        <source>Nat. Neurosci.</source>
        <year>2019</year>
        <volume>22</volume>
        <fpage>343</fpage>
        <lpage>352</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-018-0326-7</pub-id>
        <pub-id pub-id-type="pmid">30718901</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pardinas</surname>
            <given-names>AF</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Common schizophrenia alleles are enriched in mutation-intolerant genes and in regions under strong background selection</article-title>
        <source>Nat. Genet.</source>
        <year>2018</year>
        <volume>50</volume>
        <fpage>381</fpage>
        <lpage>389</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-018-0059-2</pub-id>
        <pub-id pub-id-type="pmid">29483656</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
