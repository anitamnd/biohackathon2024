<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10164163</article-id>
    <article-id pub-id-type="pmid">37149682</article-id>
    <article-id pub-id-type="publisher-id">38333</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-38333-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MetaTiME integrates single-cell gene expression to characterize the meta-components of the tumor immune microenvironment</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7453-6188</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Yi</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1328-7197</contrib-id>
        <name>
          <surname>Xiang</surname>
          <given-names>Guanjue</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jiang</surname>
          <given-names>Alva Yijia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lynch</surname>
          <given-names>Allen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zeng</surname>
          <given-names>Zexian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7573-3768</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Chenfei</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Wubing</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2440-2015</contrib-id>
        <name>
          <surname>Fan</surname>
          <given-names>Jingyu</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kang</surname>
          <given-names>Jiajinlong</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gu</surname>
          <given-names>Shengqing Stan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Changxin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Boning</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Liu</surname>
          <given-names>X. Shirley</given-names>
        </name>
        <address>
          <email>xsliu.res@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8213-1658</contrib-id>
        <name>
          <surname>Brown</surname>
          <given-names>Myles</given-names>
        </name>
        <address>
          <email>myles_brown@dfci.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8321-2839</contrib-id>
        <name>
          <surname>Meyer</surname>
          <given-names>Clifford A.</given-names>
        </name>
        <address>
          <email>cliff_meyer@ds.dfci.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Department of Data Science, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution>Department of Biostatistics, </institution><institution>Harvard T.H. Chan School of Public Health, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Department of Medical Oncology, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Center for Functional Cancer Epigenetics, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>6</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>6</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>2634</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>26</day>
        <month>4</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Recent advances in single-cell RNA sequencing have shown heterogeneous cell types and gene expression states in the non-cancerous cells in tumors. The integration of multiple scRNA-seq datasets across tumors can indicate common cell types and states in the tumor microenvironment (TME). We develop a data driven framework, MetaTiME, to overcome the limitations in resolution and consistency that result from manual labelling using known gene markers. Using millions of TME single cells, MetaTiME learns meta-components that encode independent components of gene expression observed across cancer types. The meta-components are biologically interpretable as cell types, cell states, and signaling activities. By projecting onto the MetaTiME space, we provide a tool to annotate cell states and signature continuums for TME scRNA-seq data. Leveraging epigenetics data, MetaTiME reveals critical transcriptional regulators for the cell states. Overall, MetaTiME learns data-driven meta-components that depict cellular states and gene regulators for tumor immunity and cancer immunotherapy.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Integration and comparison of multiple single cell sequencing datasets can be used to compare different studies. Here the authors propose MetaTiME which compares the gene expression of single cells from the tumour microenvironment across different tumours and uses transportable labels and metacomponents to annotate cell types and states.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data integration</kwd>
      <kwd>Software</kwd>
      <kwd>Classification and taxonomy</kwd>
      <kwd>Tumour immunology</kwd>
      <kwd>Cancer microenvironment</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000054</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>P01CA163222</award-id>
        <award-id>R01HG011139</award-id>
        <award-id>U24CA237617</award-id>
        <principal-award-recipient>
          <name>
            <surname>Meyer</surname>
            <given-names>Clifford A.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Recent advances in cancer research have implicated the integral function of the tumor microenvironment (TME) in tumor progression and therapy responses<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup>. Understanding interactions between cancer cells and the non-cancer compartments, including immune cells, fibroblasts, and endothelial cells, has shown potential targets for cancer immunotherapy. Specifically, single-cell RNA-sequencing (scRNA-Seq) applied on multiple patient tumors has enabled the high-resolution identification of TME constituents that interfere with the elimination of cancer cells. For example, exhausted tumor-infiltrating lymphocytes (TILs)<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>, and certain tumor-associated macrophages subtypes<sup><xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR11">11</xref></sup>, have been associated with tumor development. However, the definition of cell types and cell states in tumor scRNA analyses still relies on manual labeling by experts using known exclusive biomarkers following unsupervised clustering<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup>, which lacks consistency and varies between different cohorts.</p>
    <p id="Par4">As single-cell data accumulate, integrating a large collection of cells from multiple cohorts can help unify the definition of cell types and states to facilitate the automatic annotation of new scRNA-seq data<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref></sup>. One approach to cell annotation is to use predefined biomarker lists. However, these biomarkers might not cover domain-specific cellular states, for example, well-defined immune cell markers derived from blood immune cells may not fully cover the TME disease context<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>. Moreover, although cell type definitions in reference databases such as CIBERSORT, Azimuth, and Human Primary Cell Atlas<sup><xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup> can be useful, the granularity of these definitions varies between databases. Several efforts integrating pan-cancer scRNA data have revealed subtypes in the TME through the manual annotation of clusters using a shortlist of exclusive gene markers<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR19">19</xref>,<xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
    <p id="Par5">Another approach is to map a dataset containing unannotated cell states onto an annotated reference. Methods to obtain such representations include canonical correlation analysis (CCA)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, adjusted principal components (Harmony)<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, or generative deep learning models using variational autoencoders (scVI)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. These methods use dimension reduction onto a common latent space to align cells with similar states between datasets, without ascribing meaning to the latent space representations. An alternative data driven approach is to identify low dimensional latent space representations in which a biological meaning can be ascribed to each latent dimension. Several matrix factorization algorithms have been developed to represent high dimensional data in a low-dimensional space with interpretable components, including non-negative matrix factorization (NMF)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and independent component analysis (ICA)<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
    <p id="Par6">Here we develop a computational framework for mapping millions of single cells from multiple cohorts onto a comprehensive and interpretable latent space, learnt from the data. The framework, MetaTiME (Meta-components of the Tumor immune MicroEnvironment), identifies reproducible low-dimensional meta-components that reflect independent components of gene expression variation across cohorts and cancer types. MetaTiME adopts ICA for dimensional reduction to maximize the mutual independence among components. We use MetaTiME to obtain meta-components (MeCs) from 1.7 million single cells across 79 tumor datasets. These MeCs represent the TME landscape along 86 data-driven transcriptional directions mirroring lineage-specific cell states and signaling activities. Furthermore, we develop a MetaTiME toolkit for using the MeCs to annotate cellular states and signature continuums in tumor scRNA datasets, and to reveal differential signatures across immunotherapy responses. Finally, by incorporating transcription factor binding data, MetaTiME identifies and prioritizes putative transcriptional regulators that may modulate tumor immunity.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>MetaTiME as a general framework to discover consensus transcriptomic programs</title>
      <p id="Par7">The MetaTiME framework consists of three stages: meta-component (MeC) discovery, interpretation of MeCs, and application of cell state annotations (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). The MeC discovery stage detects repeatable sources of variation from multiple single-cell measurements sharing similar cellular properties. The MeC interpretation step involves a one-time curation effort using biomarker databases, pathway information and Cistrome DB chromatin profiling data<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. In the third step, users map MeCs onto their new tumor scRNA-seq datasets using MetaTiME application tools, to obtain annotated cell states and signature continuums.<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of MetaTiME.</title><p>MetaTiME integrates 1.7 million single cells to learn common transcriptional programs in the tumor microenvironment (TME). <bold>a</bold> Steps for Meta-components (MeCs) discovery. For each scRNA dataset, the expression matrix of TME cells is decomposed into a loading matrix (red) and an independent component (IC) matrix through independent component analysis (ICA). The ICs represent mutually independent sources of transcriptional variation. ICs from each dataset are concatenated and clustered into groups of ICs with high similarity, representing transcriptional programs shared across TME. MeCs are then calculated as averaged profiles of ICs from each cluster. Each MeC is interpretable, representing gene signatures of cell type, cell states, or signaling pathway activities. <bold>b</bold> Left: MetaTiME provides 86 functionally annotated MeCs that depict the TME transcriptional landscape. They are grouped into six lineage-related categories and one category reflecting signaling activities, each using a background color corresponding to the lineage. Middle: the MetaTiME annotation tool facilitates automatic annotation of cell states for new tumor scRNA data. Right: candidate regulators of each MeC are prioritized by combining MeC gene weights with epigenetics data. MeC: meta-components, TME: tumor microenvironment, ICA: independent component analysis, MeC: meta-component, TF: transcription factor.</p></caption><graphic xlink:href="41467_2023_38333_Fig1_HTML" id="d32e506"/></fig></p>
      <p id="Par8">To train MeCs for the TME context, we collected and curated 2,157,387 cells from 76 studies ranging across 27 cancer types, using publicly available tumor scRNA-Seq data mostly from TISCH<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. After removing the TISCH annotated malignant cells using MAESTRO<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, 102,703 stromal cells and 1,617,110 immune cells were retained for downstream training (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). The 76 studies were further partitioned according to cancer type, resulting in 93 datasets, including 7 datasets with immune checkpoint blockade (ICB) treatment and 3 10x Genomics provided datasets representing peripheral blood mononuclear cells (PBMC) sampled from healthy donors.</p>
      <p id="Par9">In the MeC discovery stage, MetaTiME first decomposes the log-transformed expression matrix of each single dataset using Independent Component Analysis (ICA)<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>. We adopted ICA to maximize mutual independence among gene expression components. In simulations ICA performed slightly better than Non-negative Matrix Factorization (NMF) in simulated single-cell data with pre-embedded transcriptional signatures (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). The feature weight distribution of each Independent Component (IC) also enables normalization of the gene contribution scores for measuring similarity among components. MetaTiME then applies two transformations to the IC vectors, <italic>z</italic>-weight normalization and skewness alignment, to ensure the scales of gene representation scores are comparable among components (<bold>Methods</bold>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>). Next, MetaTiME filters ICs to retain ones that are reproducible across multiple cohorts (the minimum Pearson correlation with any other IC ≥3). These are passed to the Louvain graph clustering algorithm to merge IC groups into MeCs (<bold>Methods</bold>). Lastly, MetaTiME computes averaged profiles of gene <italic>z</italic>-weights within each IC cluster, yielding 86 MeCs trained for the TME (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>, Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). The number of MeCs was automatically determined by simultaneously optimizing granularity and independence in IC clustering (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>). Importantly, the MeC clustering does not depend on cohort source (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>, cohort source of component), and is robust during leave-one-out testing in which the MeCs are learnt with a single cohort left out of the analysis (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). The leave-one-out MeCs are highly correlated with the MeCs learnt on the complete data (mean maximum correlation = 0.988), and the numbers of components are similar (mean leave-one-out MeC number = 84.64, full-set MeC number = 86). This integration after decomposition approach overcomes batch effects, which are often a challenge in single cell RNA-seq data analysis. Moreover, we implemented the standard approach in which cluster-wise signatures are obtained by batch effect removal, clustering, and differential expression analysis (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>). Limited by server computing memory, the maximum number of datasets we could integrate in this way was 21, and the cluster-wise signatures display a lower level of specificity in the test data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b,c</xref>). Therefore, the MetaTiME approach allows for the effective integration of large numbers of single cell datasets, which will become increasingly important as data accumulates.<fig id="Fig2"><label>Fig. 2</label><caption><title>MetaTiME meta-components are biologically interpretable with top genes.</title><p><bold>a</bold> Heatmap of top ten most recurrent clusters of MeCs showing normalized gene weights. <bold>b</bold> Biological characterization of each MeC with top genes. To facilitate biological interpretation, MeCs are categorized into six lineage-associated classes (B cells, T cells for CD4T, CD8T and NK cells, dendritic cells, monocyte and macrophages, other myeloid cell types, and stroma cells) and one signaling pathway-associated class. <bold>c</bold> Examples of T cell related MeCs with top 20 genes with largest weights. <bold>d</bold> Gene contribution of known lineage-related biomarkers for each MeC, and correlation with known immune markers from Azimuth. In the top dot plot, size and color represents log-scaled MeC <italic>z</italic>-weights of each gene in each MeC. In the bottom dot plot, size and color represents the maximum correlation coefficient between MeC and Azimuth defined marker genes per cell type. MeC meta-component, DC dendritic cell, Mono/Mac monocytes and macrophages. Each MeC and gene is shaded with a background color corresponding to the lineage category. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig2_HTML" id="d32e594"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>MetaTiME defines interpretable meta-components</title>
      <p id="Par10">In principle, each MeC represents one independent source of transcriptional variation commonly present in the TME. We investigated top ranked genes in MeCs and found MeCs are highly interpretable, reflecting common biological processes in the TME. For instance, the MeC derived from the largest IC cluster is highly enriched in interferon response genes, such as <italic>ISG15</italic>, <italic>IFI6</italic>, <italic>LY6E</italic>, and <italic>MX1</italic>, indicating that the underlying interferon response is among the most common source of transcriptional variation shared across tumor samples and cohorts (Fig. <xref rid="Fig2" ref-type="fig">2a, b</xref>). Intriguingly, top genes of each MeC are enriched in known biomarkers or regulators. For example, several T cell-related MeCs identify different gene modules co-expressed in T cells reflecting activation of different T-cell related processes (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>, Source Data <xref rid="MOESM8" ref-type="media">1</xref>). MeC-65, T cell co-signaling, features T cell receptors in co-stimulatory and co-inhibitory pathways<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>, such as <italic>TNFRSF4</italic> (OX40), <italic>TNFRSF18</italic> (GITR) <italic>TNFRSF9</italic> (4-1BB), and <italic>ICOS</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, left). MeC-40, CXCL13 + exhausted CD8 T cell, features receptors characterizing the exhausted CD8 T cell state<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, including <italic>HAVCR2</italic> (TIM3), <italic>LAG3</italic>, <italic>TIGIT</italic>, and <italic>PDCD1</italic> (PD1) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>, Source Data <xref rid="MOESM8" ref-type="media">2</xref>), each being potential ICB targets<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. In addition, this MeC is characterized by a high level of <italic>CXCL13</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, second panel), a cytokine mediating immune cell trafficking to tertiary lymphoid structures<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. In contrast, a related MeC representing T cell co-signaling receptors in regulatory CD4T cells (Treg) has a different ranking, including <italic>TNFRSF18</italic>, <italic>TNFRSF4</italic>, <italic>TIGIT, TNFRSF1B</italic>, <italic>CTLA4</italic>, <italic>CD27</italic> among the top 20 genes, along with the regulatory T cell-specific marker <italic>FOXP3</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, right, Source Data <xref rid="MOESM8" ref-type="media">1</xref>). Though ICB has been an extremely successful therapy for some patients, it has not yet had an impact on the majority of patients<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. Investigating the top members in the MeCs involving T cell receptor pathways may help identify new ICB targets.</p>
    </sec>
    <sec id="Sec5">
      <title>MetaTiME depicts the functional landscape of transcriptomic variation and cell states in the tumor microenvironment</title>
      <p id="Par11">We provided functional annotations of all MeCs by examining top <italic>z</italic>-weight genes and compared these with functional gene sets, such as immune cell type markers<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR18">18</xref></sup> and gene ontology databases<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. We found that 86 MeCs clearly mirror gene expression patterns corresponding to cell types, cell states and signaling pathway activities, depicting a landscape of non-cancer cell states in the TME (Fig. <xref rid="Fig2" ref-type="fig">2</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC annotation). The top genes of the cell type MeCs match well-known lineage-specific markers<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR18">18</xref></sup>. Examples include <italic>CD74</italic>, <italic>CD79A</italic>, <italic>MS4A1</italic> for B cells (MeC-18, B cell), <italic>CD3D</italic>, <italic>CD8A</italic>, <italic>CD8B</italic> for T cells (MeC-32, <italic>CD3</italic> + CD8 T cell), and <italic>LYZ</italic>, <italic>VCAN</italic>, <italic>S100A9</italic> for CD14 + Monocytes (MeC-17, CD14 monocyte) (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Fig. <xref rid="Fig2" ref-type="fig">2d</xref>, Source Data <xref rid="MOESM8" ref-type="media">3</xref>). The majority of MeCs define high resolution lineage-specific cell states (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). Taking the B cell lineage as an example, multiple MeCs harbor genes specific to B cell developmental stages<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>, ranging from a progenitor B cell state (<italic>CD69</italic> and <italic>PAX5</italic> in MeC-50, <italic>PAX5</italic> B cell), to a mature B cell state (<italic>CD79A</italic> in MeC-18, B cell), an antibody-secreting plasma cell state (<italic>XBP1</italic> in MeC-4, plasma B cell; <italic>JCHAIN</italic> in MeC-77, <italic>JCHAIN</italic> + plasma B cell), and immunoglobulin secretion states (IGK and IGH in MeC-30, immunoglobin kappa B cell; IGL and IGH in MeC-50, immunoglobin lambda B cell) (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). Lastly, like the interferon responsive MeC mentioned above, we found a subset of MeCs that are more accurately interpreted as signaling pathways because their top genes are more related to pathways or molecular functions than to cell identities.</p>
      <p id="Par12">We organized the 86 annotated MeCs into six cell lineage-focused categories and one signaling pathway-focused category (Fig. <xref rid="Fig2" ref-type="fig">2a,b</xref> and Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC annotation, MeC enrichment). Among these, there are 6 B lineage-related MeCs for B cells; 20 T cell lineage MeCs covering CD8 T cells, CD4 T cells, and natural killer (NK) cells; 4 dendritic cell (DC) lineage MeCs; 12 monocyte and macrophage-related MeCs; 3 platelet, erythrocyte, and mast cell MeCs; 6 stromal cell-related MeCs for fibroblasts, myofibroblasts and endothelial cells; and 35 MeCs in the signaling category (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). We demonstrated that the MeCs are of high specificity, visualizing the log-scaled <italic>z</italic>-weights of known cell subtype markers and pathway biomarkers (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). Correlating MeCs with the comprehensive immune cell type database Azimuth<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> validated the lineage-specificity of several MeCs, while most MeCs reflect cell states that appear specific to the tumor context (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>MetaTiME annotates cell states and signature continuums when applied to the tumor microenvironment single-cell data</title>
      <p id="Par13">As MetaTiME MeCs provides a highly interpretable basis for the TME in single cells, we provided a toolkit to discover MeC signature continuums and enriched cell states in scRNA-seq TME data (code deposited in <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>). The MetaTiME annotation toolkit takes as input the scRNA-seq expression matrix after depth normalization and log transformation, maps each single cell onto the pre-trained MeC space, and annotates the most highly enriched cell states for pre-defined cell clusters. The cell clusters are by default calculated using graph clustering with high resolution after an optional batch effect correction with Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. We demonstrate the application of MetaTiME on basal cell carcinoma (BCC) single-cells from Yost et al.<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. These test cells were excluded from the MetaTiME training stage. MetaTiME annotates the enriched cell states (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>) highlighting gradients of exhausted CD8 T cells and follicular helper T cells (Tfh) (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). The most enriched cell states consistently match the manual labelling from the original study with improved resolution (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>) and highly express corresponding markers (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>, Source Data <xref rid="MOESM8" ref-type="media">4</xref>). In addition, compared to Seurat’s<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> automated CIBERSORT marker-based annotations (14 cell types, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>), MetaTiME provides higher resolution (38 cell states, Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). Other automatic annotation gene panels were also tested, including the human primary cell atlas (HPCA) panel and Blueprint-ENCODE panel used in SingleR<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, where macrophages and plasma cells appear to be mislabeled as subclusters within T cell clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8b, c</xref>). Interestingly, the MetaTiME annotation not only indicates the CD8 T cell and CD4 T cell subtypes, but also splits cells further into cell states with polarized expression in proliferation, cytotoxicity, exhaustion level, heat stress, co-signaling pathways, and so on. (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8a</xref>). The B cell group is further partitioned into distinct B cell developmental states including a B cell cluster with cell cycle and MYC activities (Fig. <xref rid="Fig3" ref-type="fig">3a,b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>), which possibly represent germinal center (GC) B cells undergoing active expansion and maturation<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>.<fig id="Fig3"><label>Fig. 3</label><caption><title>MetaTiME annotates cell states with high resolution on tumor microenvironment single-cell data.</title><p><bold>a</bold> MetaTiME cell state annotation of cell clusters in a basal cell carcinoma scRNA dataset based on top enriched MeCs. <bold>b</bold> Manual annotation labels by experts from the original study shown on the same UMAP space. <bold>c</bold> Signature continuums of four MeCs representing the mature dendritic cell state, the CXCL13-secreting exhausted T cell state, the CXCL13-secreting T follicular helper cell state, and the IL1B pathway-activated macrophage state. <bold>d</bold> Marker gene expression for each annotated cell cluster as in (<bold>a</bold>)<bold>. e</bold> Bar plot showing cell state composition of tumor microenvironment for tumor scRNA dataset cell states. The proportion of cell states from the same MeC category are aggregated. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig3_HTML" id="d32e946"/></fig></p>
      <p id="Par14">We thus re-annotated all tumor scRNA cohorts using MetaTiME and investigated the distribution of cell state compositions across cancer cohorts. As shown in Fig. <xref rid="Fig3" ref-type="fig">3e</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>, tumors are highly heterogenous and the TME cellular composition is only partially determined by cancer type (Source Data <xref rid="MOESM8" ref-type="media">5</xref>–<xref rid="MOESM8" ref-type="media">6</xref>). For example, Cholangiocarcinoma (CHOL) is highly enriched in stromal cells including collagen-secreting fibroblast, as expected<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, while other samples including ovarian cancer (OV), pancreatic adenocarcinoma (PAAD), and multiple myeloma (MM) are also stromal-rich. Furthermore, tumors with high infiltration of the MeC-12, <italic>GZMK</italic> + <italic>CCL5</italic> + CD8 T cell state, include multiple tumor types including bladder cancer, breast cancer, and skin cancer, suggesting that immune infiltration is sample-dependent and that cancer treatments should be personalized<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>.</p>
    </sec>
    <sec id="Sec7">
      <title>Differential MetaTiME analysis detects alterations of transcriptional programs in immunotherapy</title>
      <p id="Par15">Single-cell data derived from ICB trials is invaluable for identifying cell types associated with ICB treatment or response<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. However, the detection of differential cell type abundances in ICB cohorts has been challenging due to the heterogeneity of cell type proportions and to the limited numbers of patients in each cohort<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>. We compared differences in MeC signatures instead of cell count proportions, to understand immune responses during ICB. We analyzed two ICB cohorts, a basal cell carcinoma (BCC) cohort with samples from pre- or post-ICB treatment<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, and a bladder cancer (BLCA) cohort with samples from ICB responders and non-responders<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. We applied MetaTiME for per-cluster cell state annotation and per-cell MeC signature evaluation. For each cell state cluster, we tested all MeC signatures passing significance (average <italic>z</italic>-weight ≥2) between conditions using the two-sided t-test. We plotted cluster-wise signatures in the significance – effect size scatterplot to highlight the most significant differential MeCs (<bold>Methods</bold>). In a comparison of pre- and post-ICB treatment, we observed higher expression of cytotoxic T cell and B cell MeCs in the post-ICB samples. Moreover, several monocyte and macrophage states are also suppressed after ICB treatment (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, Source Data <xref rid="MOESM8" ref-type="media">7</xref>). Notably, the <italic>IL1B</italic>-positive macrophage signature is also found to be elevated in non-responders compared to responders in the BLCA ICB cohort (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>, Source Data <xref rid="MOESM8" ref-type="media">8</xref>). Since activation of the IL1B pathway is a known regulator of inflammatory processes<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>, we sought to investigate whether the <italic>IL1B</italic>-positive macrophage signature is associated with tumor survival prognosis in bulk RNA-seq data from The Cancer Genome Atlas Program (TCGA). We evaluated TCGA tumors using the averaged expression of the top 20 genes from MeC-42, M_Macrophage-IL1-NFKB, which ranks first in elevated MeCs in non-responders (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). We found that higher expression of the <italic>IL1B</italic> signature is associated with lower survival rate in multiple cancer types, especially in Low Grade Glioma (LGG) and in Kidney renal cell carcinoma (KIRC) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). This suggests the macrophage state with IL1B pathway activation is associated with poor prognosis and lower ICB efficacy.<fig id="Fig4"><label>Fig. 4</label><caption><title>Differential signature analysis and delineated macrophage states in TME.</title><p><bold>a</bold> Differential MeC signature testing for enriched cell states comparing pre- and post- immunotherapy conditions in basal cell carcinoma (BCC) with two-sided <italic>t</italic>-test. <italic>X</italic>-axis: Difference of mean signature scores between post- and pre-immunotherapy conditions. <italic>Y</italic>-axis: -log(p-value) from two-sided <italic>t</italic>-test. The significant cluster-wise differential signature is marked as “EnrichedMeC@ClusterName”; when the enriched MeC is the same as cluster name, the signature is marked “ClusterName”. Red dots, differentially increased signature; size of the dots is proportionally to the mean signature score of cells from the post-immunotherapy condition in the cluster. Blue dots, differentially repressed signature; size of the dots is proportionally to the mean signature score of cells from the pre-immunotherapy condition in the cluster. <bold>b</bold> Differential signature testing for enriched cell states comparing non-responders and responders from pre-treatment condition in bladder carcinoma (BLCA) with two-sided <italic>t</italic>-test. Red dots, differentially increased signature; size of the dots is proportionally to the mean signature score of cells from the responder condition in the cluster. Blue dots, differentially repressed signature; size of the dots is proportionally to the mean signature score of cells from the non-responder condition in the cluster. <bold>c</bold> Model of monocytes and macrophage states in tumor and their metabolic differences. <bold>d</bold> Top pathways enriched in different macrophage MeCs, with adjusted hypergeometric tested <italic>p</italic>-value from Enrichr. BCC basal cell carcinoma, BLCA bladder carcinoma. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig4_HTML" id="d32e1076"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>MetaTiME delineates myeloid cells in different metabolic states</title>
      <p id="Par16">As specific myeloid cell states have been associated with cancer survival and treatment response, we sought to systematically characterize MeCs related to monocytes and macrophages. Although the canonical definition of M1 and M2 macrophages is derived from cytokine polarized macrophages in vitro<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>, MetaTiME’s myeloid-related MeCs represent a more complex framework for understanding tumor-infiltrating macrophages. MetaTiME’s 12 monocyte and macrophage related MeCs can be summarized into six central monocyte or macrophage states for the TME, after merging similar states such as MeC-42, IL1-NFkB Macrophage and MeC-45, IL1- JUN Macrophage, due to similarity among top genes (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). Monocytes are classified as two categories, CD14 + and CD16 + . For macrophages, four MeCs define common states of intra-tumor macrophages: <italic>C1Q</italic> + , SPP<italic>1</italic> + , lipid-rich, and <italic>IL1B</italic> + macrophages, and two MeCs, representing interferon and MHC-II signaling pathways, are less frequently observed among macrophages (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). In comparison, previous studies defined different tumor associated macrophages in terms of manually selected representative genes after clustering myeloid cells. For example, Cheng et al.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> defined several tumor associated macrophage types including <italic>ISG15</italic> + , SPP<italic>1</italic> + , <italic>INHBA</italic> + , <italic>VCAN</italic> + , <italic>NLRP3</italic> + , and <italic>FN1</italic> + macrophages, while Bi et al.<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> defined <italic>CXCL10</italic>-high, <italic>GPNMB</italic>-high, <italic>FOLR2</italic>-high, <italic>VSIR</italic>-high, and cycling macrophages for advanced renal cell carcinoma (ccRCC). We find that the MetaTiME-defined macrophage MeCs reflect co-expression relationships with the selected marker genes. For example, macrophage markers from Bi et al. rank high in several macrophage-related MeCs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11</xref>), and the expression pattern of the marker genes picked by Bi et al. (<italic>CXCL10</italic>, <italic>GPNMB</italic>, <italic>VSIR</italic>, <italic>FOLR2</italic>, Cycling marker <italic>MKI67</italic>) correspond to several MeCs (MeC-0, interferon response; MeC-37, <italic>PPARG</italic> + lipid-rich macrophage; MeC-58, MHCII-high, and MeC-49, <italic>RNASE1</italic> + , <italic>C1Q</italic> + macrophage) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11</xref>). However, MetaTiME reveals additional distinct components such as the SPP<italic>1</italic> + and <italic>C1Q</italic> + MeCs, which were detected as separate myeloid types in the Cheng et al. multi-cohort study (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12</xref>). While the manual reconciliation of cell types from multi-cohort scRNA data shows many marker genes to be consistent with the top genes in the MetaTiME MeCs, the myeloid cell population is not neatly partitioned into cell clusters and might be better represented in terms of expression signature continuums. For example, when mapping myeloid MeCs onto the kidney myeloid cells, the <italic>IL1B</italic> + MeC signature (MeC-42, MeC-45) is distributed across the M09_Macro_IL1B cluster as well as the CD14 monocyte cluster (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12</xref>).</p>
      <p id="Par17">To investigate functional differences among the different macrophage states, we applied gene set enrichment (GSEA)<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> analysis using the top MeC genes (<bold>Methods</bold>). Interestingly, the different macrophage states have different metabolic preferences (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>, Source Data <xref rid="MOESM8" ref-type="media">9</xref>). Glucose metabolism and the glycosylation pathway are highly active in SPP<italic>1</italic> + macrophages, while lysosome and phagosome activity are the most highly enriched in <italic>C1Q</italic> + macrophages. Lysosome and cholesterol metabolism, including PPARG signaling, are enriched in the lipid-rich state. The inflammatory IL1B and NFkB pathways are highly active in <italic>IL1B</italic> + macrophages. Several macrophage states are related to cell signaling. SPP<italic>1</italic> for example, encodes Osteopontin, which has been found to foster an environment that promotes cancer metastasis<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. The <italic>C1Q</italic> + MeC features <italic>C1QA</italic>, <italic>C1QB</italic>, and <italic>C1QC</italic>, members of the family of complement molecules that could have dual functions in chronic inflammation<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. The <italic>IL1B</italic> + meta-components features cytokines co-expressed with <italic>IL1B</italic>, including <italic>CXCL8</italic>, <italic>CXCL2</italic>, and <italic>CXCL3</italic>, all of which can interact with other cells in the TME by binding to cytokine receptors<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>Incorporation of epigenetic data prioritizes transcriptional regulators of tumor immunity</title>
      <p id="Par18">We next investigated the transcription factors (TFs) that regulate the MeCs, hypothesizing that the co-expression of genes in a subset of MeCs is determined through TF regulatory events. Our group previously developed the Cistrome Data Browser and Lisa to predict transcriptional regulators of gene sets based on chromatin immunoprecipitation with sequencing (ChIP-seq) data<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>. Thus, we used Lisa to predict the TFs that regulate the top genes of each MeC, and compared these Lisa regulatory prediction scores with the MeC <italic>z</italic>-weights across TFs (Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>). We found that, for many MeCs, the same TFs were predicted to be both regulators of the MeC and were highly expressed in the MeC itself, indicating an autoregulatory control scheme. Often, however, TFs that were predicted by Lisa to be MeC regulators were not represented by high MeC <italic>z</italic>-weights, and TFs with high MeC <italic>z</italic>-weight were not always found to have high Lisa scores (Fig. <xref rid="Fig5" ref-type="fig">5</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC regulators). TFs predicted by Lisa but not represented by high MeC <italic>z</italic>-weight could be the result of TF activities being regulated through non-transcriptional mechanisms<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> or multiple TFs in a family having similar binding patterns but only a subset being the regulators<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. TFs that have high MeC <italic>z</italic>-weights but low Lisa scores are most likely not well represented in the relevant cell types in available ChIP-seq data. In MeC-0, interferon response, <italic>STAT1</italic> is highly represented in the MeC <italic>z</italic>-weight and Lisa ranks <italic>STAT1</italic> as the top regulator, consistent with <italic>STAT1</italic> being known as the master regulator of the interferon response (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). Several lineage-defining TFs display the autoregulatory pattern, including <italic>TCF4</italic> in plasmacytoid dendritic cells (pDC) (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>) and <italic>XBP1</italic> in B plasma cells (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref><bold>:</bold> MeC regulators<bold>)</bold>. The macrophage related MeCs are regulated by myeloid lineage TFs like CEBPB, and TFs related to immune stimulus responses, including NFkB complex TFs. In MeC-37, lipid-rich macrophage, although PPARG ranks among the top Lisa-predicted regulators (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>), <italic>PPARG</italic> expression is not highly represented as a MeC <italic>z</italic>-weight. In this MeC, the top co-expressed genes are indeed enriched in the PPARG signaling pathway (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>); this result can be accounted for by PPARG being regulated through its ligands, which include a variety of lipophilic acids<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>.<fig id="Fig5"><label>Fig. 5</label><caption><title>MetaTiME prioritizes tumor immunity transcriptional regulators.</title><p>For selected MeCs, TFs are prioritized by their MeC expression representation and Lisa, ChIP-seq based, regulatory potentials. <italic>X</italic>-axis: gene <italic>z</italic>-weight of the TF for the current MeC. <italic>Y</italic>-axis: Lisa-based regulatory potential significance for top genes in the current MeC. Orange factors: MeC regulators prioritized based on both MeC gene weights and Lisa regulatory potential significance. Green factors: TFs highly weighted in MeCs and not in Lisa analysis. Blue factors: TFs with high Lisa regulatory potential and not highly weighted in MeCs. <bold>a</bold> TFs prioritized for three MeCs in the signaling category. <bold>b</bold> TFs prioritized for three MeCs in the dendritic cell category. <bold>c</bold> TFs prioritized for three MeCs representing different macrophage states. <bold>d</bold> TFs prioritized for three MeCs representing different T cell states. TF transcription factor, MeC meta-component. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig5_HTML" id="d32e1392"/></fig></p>
      <p id="Par19">We found glucocorticoid receptor (GR) signaling to be implicated in the regulation of MeC-20, <italic>CXCL13</italic> + Tfh, with GR being most highly ranked TF in both MeC and Lisa scores (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Top genes in MeC-20, <italic>CXCL13</italic> + Tfh, include several direct target genes of GR, including <italic>SRGN</italic> and <italic>FKBP5</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13b</xref>). We investigated whether the <italic>CXCL13</italic> cytokine itself could be a direct target of GR in <italic>CXCL13</italic> secreting Tfh cells. Since GR ChIP-seq data is not available for the exact Tfh cell state, we collected GR ChIP-seq data from several other cell types. Direct binding of GR is observed at the <italic>CXCL13</italic> gene promoter and nearby the gene locus at putative enhancers, which are conserved across multiple cell lines (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13a</xref>), including the B cell line Nalm6, the monocyte cell line THP1, and cancer cell lines. Moreover, in another CXCL13 secreting cell state, MeC-40, <italic>CXCL13</italic> + exhausted CD8 T cell, GR is also highly ranked in both Lisa and MeC scores (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Thus, we hypothesize that GR is likely to be a transcriptional driver of the CXCL13-secreting cell states in exhausted CD8 T cells<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> as well as in CD4 T follicular helper T cells. Thus, the GR pathway could be a candidate target in tumor immunity modulation.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par20">We developed the MetaTiME (Meta-components of the tumor immune Microenvironment) framework and performed a large-scale and pan-cancer integration of tumor single cell datasets using ICA to optimize information independence among components<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. We identified 86 interpretable meta-components (MeCs) that describe common aspects of TME gene expression variation across multiple tumors.</p>
    <p id="Par21">The MetaTiME MeCs serve as comprehensive transcriptional signatures that depict a functional landscape of TME transcriptional programs and cell states. For monocytes and macrophages, the related MeCs showed heterogeneity and plasticity of tumor-associated macrophages (TAMs). We thus propose that TAMs, especially for solid tumors, should be classified based on the major states with different metabolic preferences instead of the canonical M1 and M2 classification<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Similar states that do not fit well into the M1 versus M2 classification scheme were also observed in previous studies analyzing myeloid cells in the TME, where single cells were clustered and labeled using differential markers<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR43">43</xref></sup>. Cheng et al.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> defined several TAM types by clustering myeloid cells separately for each study and naming the TAMs with manually selected top marker, chosen based on consistency across cohorts. Similarly, Bi et al.<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> defined TAM types by harmonizing patients and naming the TAMs with top genes in each cluster for an advanced renal cell carcinoma (ccRCC) cohort. Cell type definitions in the previous studies were based on representative genes, which were chosen differently in the respective studies. We propose that the MetaTiME derived monocyte and macrophage MeCs could be used to define macrophage states and functional co-expressed gene modules more consistently for the TME. Reexamining the marker genes from the previous studies: <italic>NLRP3</italic> is highly ranked in MeC-42, <italic>IL1B</italic> + macrophage; in fact, the NLRP3 inflammasome mediates interleukin-1β production. <italic>GPNMB</italic> is weighted among the top 20 genes in both MeC-19, Macrophage-C1Q and MeC-26, Macrophage-SPP1; it encodes a membrane glycoprotein which is typically highly expressed in macrophages. <italic>FOLR2</italic> is ranked 29th in MeC-19, Macrophage-C1Q, indicating this macrophage state also encodes a high folate-activated pathway. Finally, MeC-36, Macrophage-SPP1-C1Q, features an intermediate state with both SPP<italic>1</italic> and <italic>C1QA</italic>, indicating the plasticity and mixed nature of pathways activated in TAMs that could not be defined using exclusive markers. Thus, the myeloid MeCs may provide a consistent definition of TAM states corresponding to different metabolic processes.</p>
    <p id="Par22">MetaTiME provides a toolkit for analyzing independent TME scRNA-seq datasets by mapping gene expression onto the MeC space. The outputs include signature continuums and the most highly enriched cell states. Recent useful single-cell dataset integration algorithms such as Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> and scArches<sup><xref ref-type="bibr" rid="CR52">52</xref></sup> infer a joint low-dimensional representation among data. In these approaches the shared space is re-computed every time a new dataset is incorporated. The MetaTiME strategy builds upon previous approaches that transfer latent representations from large datasets, but provides a stable and interpretable representation specialized for the TME.</p>
    <p id="Par23">By leveraging ChIP-seq data, MetaTiME implicates critical transcriptional regulators in tumor immunity. In many cases, we found the joint consideration of MeC-specific co-expression patterns and TF binding enrichments shows the functions of TFs in defining cellular states and gene expression programs. MetaTiME captured multiple known TFs critical to tumor immunity and could serve as immune modulation targets; this includes <italic>TOX</italic> in MeC-40, <italic>CXCL13</italic>-secreting exhausted CD8 T cell, a recently discovered regulator of T cell exhaustion<sup><xref ref-type="bibr" rid="CR53">53</xref></sup> (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). The MeCs further implicated the glucocorticoid receptor pathway in the regulation of several T cell states. Glucocorticoids are a class of steroid hormones essential to the modulation of multiple biological processes, including immune related ones<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, although the function of the GR pathway in different immune cell types is not fully understood. Since GR is broadly expressed in many cell types, and is regulated through ligand binding, differential analysis of GR expression is unlikely to fully capture GR regulation in single-cell data analysis. Though GR ChIP-seq is not available in the contexts of the relevant T cell states, GR ChIP-seq in other cell lines demonstrate robust binding nearby the top gene <italic>CXCL13</italic>. CXCL13 is crucial to T follicular helper cell communication with germinal center B cells, through interaction with its receptor CXCR5<sup><xref ref-type="bibr" rid="CR54">54</xref>,<xref ref-type="bibr" rid="CR55">55</xref></sup>.</p>
    <p id="Par24">Overall, MetaTiME depicts the functional landscape of transcriptomic variation and cell states in the tumor microenvironment. It provides a computational framework to facilitate the elucidation of the identity and function of cells in the TME in future studies and will facilitate the identification of potential new therapeutic targets for immune modulation.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Tumor single-cell RNA-seq data collection and processing</title>
      <p id="Par25">For an extensive collection of single cells from tumor microenvironment, we utilized the public tumor scRNA-seq collection, TISCH<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. The TISCH collection uniformly processed each dataset with MAESTRO<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> and isolated non-malignant environmental cells from malignant cells. Overall, we collected 2,157,387 cells from 76 studies ranging 27 cancer types. The MAESTRO annotation was labeled using CIBERSORT gene panels<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> followed by curation, enabling selection of 1,719,813 tumor micro-environment cells, including 1,617,110 immune cells and 102,703 stromal cells, were retained for integrative analysis in this study. For studies with data measured from multiple cancer types, cells different cancer types were split into independent datasets, resulting in 93 datasets; it includes 3 PBMC datasets from healthy donors from 10X Genomics as baseline and 7 datasets with ICB treatment.</p>
      <p id="Par26">For an unsupervised component analysis, each dataset was re-analyzed. For datasets with raw count matrices available, gene expression was normalized towards per-cell read depth 10,000 followed by log transformation. For datasets with only TPM or FPKM values available, including Smart-seq data or studies with only normalized matrix available, gene expression underwent log transformation. Cells were filtered based on minimum library size 1000, gene number 500, and maximum mitochondrial read proportion 5%.</p>
    </sec>
    <sec id="Sec13">
      <title>Decomposing individual studies and denoising low-dimensional components</title>
      <p id="Par27">We then decomposed the expression matrix of each scRNA-seq dataset using fastICA<sup><xref ref-type="bibr" rid="CR51">51</xref></sup> into an independent component (IC) vector matrix and a projection weight matrix. We tested different values for the number of components (<italic>k</italic>) and chose <italic>k</italic> to be 100 uniformly for each dataset, given it could cover more variations than the number of cell types in the TME, which is around twenty. We applied two denoising approaches to handle sparsity and potentially noisy ICs. First, we performed a <italic>z</italic> -score transformation of the gene loadings in the component, scaling all gene loading values by the standard deviation of each IC. The gene loadings indicate the degree of contribution to the component as a metagene from each gene, and we observed that most genes contribute neutrally to the metagene. Thus, genes with significant contributions are selected using the two-standard deviation threshold from either the positive or the negative side. Second, we aligned the positive skewness of components (using scipy.stats.skewtest<sup><xref ref-type="bibr" rid="CR56">56</xref></sup>) since the sign of an independent component is randomly assigned in fastICA optimization. We observed that asymmetrically extreme gene loading values highlight genes representative of the component’s function; thus, we computed each component’s skewness statistics and flipped the sign of component loadings if the skewness is negative. We excluded genes with a low contribution (gene weight not passing two standard deviations) to any reproducible components and kept 6623 genes with potentials in driving the reproducible components. The post-decomposition steps ensured the attitude and sign of gene weights are comparable across cohorts, depicting degree of contribution from each gene in the genome-wide background.</p>
    </sec>
    <sec id="Sec14">
      <title>Meta-component calling and functional annotation</title>
      <p id="Par28">We then aim to discover reproducible patterns from all components from each dataset. We evaluated similarity between pairs of components using cosine distance and retained a set of 1043 candidate reproducible components from 69 datasets, each with a minimum Pearson correlation coefficient 0.3 with at least one different IC. We then clustered ICs using Louvain clustering, a graph-based community detection algorithm where the resolution parameter controls segmentation granularity. Clusters with at least five ICs were retained as reproducible IC clusters. The number of clusters is determined by optimizing both Silhouette’s score for optimal within-cluster similarity compared to inter-cluster similarity and number of reproducible clusters. The final resolution parameter was chosen to be 1.25 resulting in 86 clusters for meta-component (MeC) calling. The consensus gene <italic>z</italic>-weights in each MeC were then calculated by averaging ICs in each cluster. Genes of outlier <italic>z</italic>-weights passing two standard deviations were highlighted as significant, and the ones with positive largest <italic>z</italic>-weights were considered representative of the MeC.</p>
      <p id="Par29">MetaTiME MeCs were assigned curated annotation by matching top <italic>z</italic>-weighted genes to functional biological information including cell type markers, pathway databases from GSEA and Enrichr through GSEApy, cell types expressing top MeC genes, and high-rank transcription factors. In detail, GSEA enrichment analyses utilized the top 100 highest <italic>z</italic>-weighted genes and TF database was obtained from AnimalTFDB<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. The pathway database from Enrichr utilized WikiPathways, BioPlanet, MSigDB_Hallmarks, GO_Biological_pathway, GO_Molecular_function, GO_Biological_process. KEGG, and Reactome. GSEA was also performed using the <italic>z</italic>-weight rank of all genes<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>. The 86 MeCs were first ordered by MeC cluster size, then organized into seven functional categories with six lineage-related categories and one signaling category.</p>
    </sec>
    <sec id="Sec15">
      <title>Simulating multi-cohort single-cell RNA data with expression programs</title>
      <p id="Par30">To benchmark dimensional reduction methods, we built upon previous effort from Kotliar et al.<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> to use the scsim package to simulate multiple count matrices with built-in transcriptional programs. In principle, the built-in gene expression programs (GEP) were sampled as random scaling factors on a subset of genes mimicking overexpression or suppression of a pathway. For testing whether a higher number of cohorts facilitate GEP recovery, we simulated 20 single-cell datasets and tested usage of 5 cohorts, 10 cohorts, and 20 cohorts. Each dataset was embedded with a subset of 14 pre-defined GEPs, since the real tumor scRNA data may not cover every possible cell type or gene program in every dataset. The 14 GEPs contain 13 cell type-specific programs with distinct cell type-specific genes, and one signaling gene expression program that is randomly active in multiple cell types. Two low-dimensional reduction method are benchmarked using simulated scRNA data: independent component analysis (ICA) and non-negative matrix factorization (NMF). Decomposition was performed on each single cohort separately, and meta-component calling was done as similar in MetaTiME: components are filtered, clustered into meta-components, followed by averaging gene <italic>z</italic>-weights per cluster as predicted gene expression programs (GEP). The predicted GEPs were compared with pre-defined True GEPs using Pearson correlation. Overall, both ICA and NMF can recover GEPs, while the ICA-based GEPs are more mutually independent and performs slightly better. Since the GEP recovered in the 20 cohorts case matched true GEP better than 5 cohorts and 10 cohorts, the increased number of cohorts also improves GEP recovery. Thus, we chose ICA for component integration and use all available datasets for GEP discovery for tumor microenvironmental cells.</p>
    </sec>
    <sec id="Sec16">
      <title>MeC calling robustness with leave-one-out testing</title>
      <p id="Par31">MetaTiME’s robustness was examined by re-calling MeCs after leaving one dataset out and calculate the Pearson correlation between the left out dataset MeCs and the full-set MeCs. The leave-one-out analysis was first performed by removing the SCC cells from the Yost et al. dataset, which was shown as an example of MetaTiME annotation. Each dataset in the MeC pool was left out to call new MeCs using the same parameters, resolution = 1.25 and min_cluster_size = 5. We used two metrics to check the similarity of each leave-one-out experiments compared to the full set. The first metric is the mean maximum correlation between leave-one-out and the full set. This is calculated by taking the maximum correlation, row-wise and column-wise in the correlation heatmap, and then taking the average. The second metric is the number of MeCs.</p>
    </sec>
    <sec id="Sec17">
      <title>Comparing MeCs, signatures by post-embedding integration, to signatures by cluster-wise differential expression</title>
      <p id="Par32">We compared MetaTiME MeCs to the standard approach that extracts signatures after integrating cells across datasets. The standard approach to obtain cluster-wise signatures is to perform dataset harmonization, cell clustering, and cluster-wise differential expression analysis. When performing dataset integration, we first used CCA to include as many datasets as possible given our maximum memory available in our computing resource (150GB). The maximum number of datasets integrated by CCA is 10 when using datasets ranked by the number of TME cells. We then used scanpy to achieve the successful integration of 21 datasets. The integrated cells are harmonized with Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> and clustered, followed by differential expression analysis using the Wilcoxon test to extract cluster-wise signatures. The signatures are in the format of gene vector of log fold change, and named as “Cluster DE signatures”. To control the confounding effect of signature numbers, the resolution of clustering is chosen to reach 90 clusters, a similar number with the number of full-set MeCs which is 86. Then, we compared MetaTiME MeCs to the Cluster DE signature projected onto a test dataset. We used same BCC cells as the test cells that are never seen in the training step from either method. To reflect how variable the projected scores are across cells, we grouped cells from the test BCC data into 25 clusters with Leiden clustering. The heatmap of the cluster-wise signature mapping is plotted to observe how specific each type of score is across cell groups. We further used cross-cluster entropy to quantify the information content of scores relative to clusters in the test dataset.</p>
    </sec>
    <sec id="Sec18">
      <title>The MetaTiME annotator for analyzing new tumor scRNA-seq data</title>
      <p id="Par33">MetaTiME provides an analytical toolkit for annotating cell states and signature activities for tumor scRNA-seq data (<ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>). The scRNA-seq data is first processed following standard procedures, which includes cell depth normalization, <italic>log</italic>-transformation, batch effect removal using Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, neighboring graph construction, graph clustering, and UMAP embedding for visualization. Specifically, the clustering step uses an over-clustering strategy, which sets a high-resolution parameter (default 8) that generates a larger number of clusters and help reveal fine structures among the cells. Then, the MetaTiME annotator tool takes as input a single log-transformed expression matrix for TME cells from the dataset. The outputs include both per-cell MetaTiME MeC signature scores and per-cluster enriched MeC state. For the per-cell score, MetaTiME projects each cell onto the MeC space by calculating the dot product between the expression vector and the <italic>z</italic>-weight vector of each MeC, using genes passing the significant <italic>z</italic>-weight criterion (<italic>z</italic>-weight ≥2). The projection matrix is then scaled across all cells to ensure normally distributed scores within each MeC, outputting the cell-by-MeC score matrix. Meanwhile, the UMAP view of the projection score shows the signature gradient across the cells positioned by similarity. Lastly, the cluster-wise MeC enrichment results are also generated. The per-cluster MeC enrichment score is calculated by averaging profile of cells along each MeC; MeCs with mean score passing the significant cutoff (2 in the <italic>z</italic>-weight scale) are called as the set of enriched MeCs. Each cluster may enrich multiple number of MeCs, and the top enriched MeC with highest score is used in UMAP visualization.</p>
    </sec>
    <sec id="Sec19">
      <title>Differential MeC signature analysis</title>
      <p id="Par34">For tumor scRNA-seq data with different conditions, a differential signature analysis can be carried out following MetaTiME annotation, which provides enriched MeCs for each cluster and names each cluster with the top enriched MeC. Thus, for each cell cluster, the MeC signature strength can be compared across conditions, for all enriched MeC in the current cluster. In details, a simple <italic>t</italic>-test or Wilcoxon rank-sum test is adopted to compare MeC scores of cells in one condition with another. The effect size of MeC scores were calculated by the difference between cell means from the two conditions in comparison. To plot the cluster-specific differential signature plot, the signatures are marked using “EnrichedMeC@ClusterName”, where the “ClusterName” is the top first enriched MeC used as cell state as current cluster. When “EnrichedMeC” is the same as the “ClusterName”, only “ClusterName” is marked on the Significance-Effect size plot.</p>
    </sec>
    <sec id="Sec20">
      <title>Incorporation of epigenetic data using Lisa</title>
      <p id="Par35">Our group previously developed Lisa that predicts the influence of TFs on a set of genes. Lisa models public chromatin accessibility and TF binding profiles to score TFs in gene regulation from an epigenetic perspective. We developed Lisa2 that improves on running speed and pipeline integration, which is applied on each MeC to score TFs in regulation potential on top 100 high <italic>z</italic>-weighted genes. The impact scores of TFs are thus from two sources: MeC <italic>z</italic>-weights for expression representation, and Lisa scores for binding potential, as in Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>. The TFs are grouped into three classes, TFs highly ranked based on both MeC gene weights and Lisa significance, TFs representative only in MeC, and TFs based on binding information only. In Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>, we marked TFs from different classes in different columns. Significant TFs based on both MeC and Lisa (MeC <italic>z</italic>-weight ≥2), Lisa score -log (<italic>p</italic>-value) ≥2 are marked in the column TF_MeCLisa_top_1; furthermore, the TFs ranking among top 40 (aggregated rank of MeC and Lisa) compared to all genes are further marked in the column TF_MeCLisa_top. TFs ranking among top 10 only in MeC <italic>z</italic>-weight are in the column TF_MeC_top, and TFs ranking among top 10 only in Lisa score are in the column TF_Lisa_top.</p>
    </sec>
    <sec id="Sec21">
      <title>Reporting summary</title>
      <p id="Par36">Further information on research design is available in the <xref rid="MOESM7" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec22">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_38333_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_38333_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_38333_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_38333_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_38333_MOESM5_ESM.xlsx">
            <caption>
              <p>Supplementary Data 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_38333_MOESM6_ESM.xlsx">
            <caption>
              <p>Supplementary Data 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2023_38333_MOESM7_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec23">
        <title>Source data</title>
        <p id="Par40">
          <media position="anchor" xlink:href="41467_2023_38333_MOESM8_ESM.xlsx" id="MOESM8">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-38333-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>The results appearing here are supported by grants NIH grants P01CA163222(CM), U24CA237617(CM,MB), and R01CA234018(MB). We acknowledge all authors of the original tumor single-cell studies that generated publicly available data. The results appearing here are in part based upon the data generated by the TCGA Research Network (<ext-link ext-link-type="uri" xlink:href="http://cancergenome.nih.gov/">http://cancergenome.nih.gov/</ext-link>).</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>C.M., M.B., S.L., Y.Z. designed the study and were major contributor in editing the manuscript. C.M., M.B., S.L. supervised the study. Y.Z. analyzed and interpreted the data and was a major contributor in writing the manuscript. Y.J., G.X., C. Wan, Z.Z., A.L., W.Z., J.F., J.K. contributed to the data analysis. C. Wang, Z.Z., Y.Z., Y.J., S.G., B.Z. contributed to the data collection and analysis. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par37"><italic>Nature Communications</italic> thanks Andrew Adey, Markus List and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The processed datasets used in this study are available in Zenodo under accession code <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7410180">7410180</ext-link> The pretrained meta-components for tumor microenvironment in the Github repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>. The single-cell RNA-seq data used in this study are available in the TISCH database (<ext-link ext-link-type="uri" xlink:href="http://tisch1.comp-genomics.org">http://tisch1.comp-genomics.org</ext-link>). The list of public datasets used in this study is available in Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref> and also from GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE154763">GSE154763</ext-link> and Single Cell Portal under accession code <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1288/tumor-and-immune-reprogramming-during-immunotherapy-in-advanced-renal-cell-carcinoma">SCP1288</ext-link>. The gene list analytical data used in this study are available in AnimalTFDB v3.0 (<ext-link ext-link-type="uri" xlink:href="http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/">http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/</ext-link>), TCGA (<ext-link ext-link-type="uri" xlink:href="https://portal.gdc.cancer.gov">https://portal.gdc.cancer.gov</ext-link>), and Azimuth (<ext-link ext-link-type="uri" xlink:href="https://azimuth.hubmapconsortium.org">https://azimuth.hubmapconsortium.org</ext-link>). The ChIP-seq data used in this study are available from GEO (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/">https://www.ncbi.nlm.nih.gov/geo/</ext-link>) under accession IDs <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM604651">GSM604651</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637309">GSM1637309</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1607526">GSM1607526</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2661793">GSM2661793</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2735378">GSM2735378</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2871705">GSM2871705</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637306">GSM1637306</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637307">GSM1637307</ext-link>, and from ENCODE (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/">https://www.encodeproject.org/</ext-link>) under accession ID <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/experiments/ENCSR919OXR/">ENCSR919OXR</ext-link>. <xref rid="Sec23" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>MetaTiME is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>, and also available at Zhang Y et al., “MetaTiME Integrates Single-cell Gene Expression to Characterize the Meta-components of the Tumor Immune Microenvironment”, MetaTiME, 10.5281/zenodo.7734062, 2023.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par38">MB is a consultant to and receives sponsored research support from Novartis. MB serves on the SAB of H3 Biomedicine, Kronos Bio, FibroGen, and GV20 Therapeutics. X.S.L conducted the work while being on the faculty at DFCI, and is currently a board member and CEO of GV20 Therapeutics. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>XS</given-names>
          </name>
          <name>
            <surname>Mardis</surname>
            <given-names>ER</given-names>
          </name>
        </person-group>
        <article-title>Applications of immunogenomics to cancer</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>168</volume>
        <fpage>600</fpage>
        <lpage>612</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2017.01.014</pub-id>
        <?supplied-pmid 28187283?>
        <pub-id pub-id-type="pmid">28187283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jin</surname>
            <given-names>MZ</given-names>
          </name>
          <name>
            <surname>Jin</surname>
            <given-names>WL</given-names>
          </name>
        </person-group>
        <article-title>The updated landscape of tumor microenvironment and drug repurposing</article-title>
        <source>Signal Transduct. Target. Ther.</source>
        <year>2020</year>
        <volume>5</volume>
        <fpage>166</fpage>
        <pub-id pub-id-type="doi">10.1038/s41392-020-00280-x</pub-id>
        <?supplied-pmid 32843638?>
        <pub-id pub-id-type="pmid">32843638</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Penter</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Local and systemic effects of immune checkpoint blockade on relapsed myeloid malignancies following allogeneic hematopoietic stem cell transplantation</article-title>
        <source>Blood</source>
        <year>2020</year>
        <volume>136</volume>
        <fpage>34</fpage>
        <lpage>35</lpage>
        <pub-id pub-id-type="doi">10.1182/blood-2020-139487</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cancer-associated genetic variant Rs3903072 modulates immune cells in the tumor microenvironment</article-title>
        <source>Front. Genet.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>754</fpage>
        <pub-id pub-id-type="doi">10.3389/fgene.2019.00754</pub-id>
        <?supplied-pmid 31507631?>
        <pub-id pub-id-type="pmid">31507631</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gu</surname>
            <given-names>SS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Therapeutically increasing MHC-I expression potentiates immune checkpoint blockade</article-title>
        <source>Cancer Disco.</source>
        <year>2021</year>
        <volume>11</volume>
        <fpage>1524</fpage>
        <lpage>1541</lpage>
        <pub-id pub-id-type="doi">10.1158/2159-8290.CD-20-0812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeng</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TISMO: syngeneic mouse tumor database to model tumor immunity and immunotherapy response</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>D1391</fpage>
        <lpage>D1397</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab804</pub-id>
        <?supplied-pmid 34534350?>
        <pub-id pub-id-type="pmid">34534350</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Signatures of T cell dysfunction and exclusion predict cancer immunotherapy response</article-title>
        <source>Nat. Med.</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>1550</fpage>
        <lpage>1558</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-018-0136-1</pub-id>
        <?supplied-pmid 30127393?>
        <pub-id pub-id-type="pmid">30127393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yost</surname>
            <given-names>KE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal replacement of tumor-specific T cells following PD-1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2019</year>
        <volume>25</volume>
        <fpage>1251</fpage>
        <lpage>1259</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-019-0522-3</pub-id>
        <?supplied-pmid 31359002?>
        <pub-id pub-id-type="pmid">31359002</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analyses inform mechanisms of myeloid-targeted therapies in colon cancer</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>181</volume>
        <fpage>442</fpage>
        <lpage>459.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2020.03.048</pub-id>
        <?supplied-pmid 32302573?>
        <pub-id pub-id-type="pmid">32302573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cheng</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A pan-cancer single-cell transcriptional atlas of tumor infiltrating myeloid cells</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>792</fpage>
        <lpage>809.e23</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.01.010</pub-id>
        <?supplied-pmid 33545035?>
        <pub-id pub-id-type="pmid">33545035</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>In vivo CRISPR screens identify the E3 ligase Cop1 as a modulator of macrophage infiltration and cancer immunotherapy target</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>5357</fpage>
        <lpage>5374.e22</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.09.006</pub-id>
        <?supplied-pmid 34582788?>
        <pub-id pub-id-type="pmid">34582788</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>SZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell and spatially resolved atlas of human breast cancers</article-title>
        <source>Nat. Genet.</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>1334</fpage>
        <lpage>1347</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-021-00911-1</pub-id>
        <?supplied-pmid 34493872?>
        <pub-id pub-id-type="pmid">34493872</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell tumor immune atlas for precision oncology</article-title>
        <source>Genome Res.</source>
        <year>2021</year>
        <volume>31</volume>
        <fpage>1913</fpage>
        <lpage>1926</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.273300.120</pub-id>
        <?supplied-pmid 34548323?>
        <pub-id pub-id-type="pmid">34548323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aran</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage</article-title>
        <source>Nat. Immunol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>163</fpage>
        <lpage>172</lpage>
        <pub-id pub-id-type="doi">10.1038/s41590-018-0276-y</pub-id>
        <?supplied-pmid 30643263?>
        <pub-id pub-id-type="pmid">30643263</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrative analyses of single-cell transcriptome and regulome using MAESTRO</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>198</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02116-x</pub-id>
        <?supplied-pmid 32767996?>
        <pub-id pub-id-type="pmid">32767996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Newman</surname>
            <given-names>AM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust enumeration of cell subsets from tissue expression profiles</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>453</fpage>
        <lpage>457</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3337</pub-id>
        <?supplied-pmid 25822800?>
        <pub-id pub-id-type="pmid">25822800</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andreatta</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Interpretation of T cell states from single-cell transcriptomics data using reference atlases</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>1</fpage>
        <lpage>19</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-23324-4</pub-id>
        <pub-id pub-id-type="pmid">33397941</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Pan-cancer single-cell landscape of tumor-infiltrating T cells</article-title>
        <source>Sci. (80-.)</source>
        <year>2021</year>
        <volume>374</volume>
        <fpage>abe6474</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abe6474</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pelka</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially organized multicellular immune hubs in human colorectal cancer</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>4734</fpage>
        <lpage>4752.e20</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.08.003</pub-id>
        <?supplied-pmid 34450029?>
        <pub-id pub-id-type="pmid">34450029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyvarinen</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Fast and robust fixed-point algorithms for independent component analysis</article-title>
        <source>IEEE Trans. Neural Netw.</source>
        <year>1999</year>
        <volume>10</volume>
        <fpage>626</fpage>
        <lpage>634</lpage>
        <pub-id pub-id-type="doi">10.1109/72.761722</pub-id>
        <?supplied-pmid 18252563?>
        <pub-id pub-id-type="pmid">18252563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Independent component analysis based gene co-expression network inference (ICAnet) to decipher functional modules for better single-cell clustering and batch integration</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>E54</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab089</pub-id>
        <?supplied-pmid 33619563?>
        <pub-id pub-id-type="pmid">33619563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cistrome data browser: expanded datasets and new tools for gene regulatory analysis</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D729</fpage>
        <lpage>D735</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky1094</pub-id>
        <?supplied-pmid 30462313?>
        <pub-id pub-id-type="pmid">30462313</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TISCH: a comprehensive web resource enabling interactive single-cell transcriptome visualization of tumor microenvironment</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>D1420</fpage>
        <lpage>D1430</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkaa1020</pub-id>
        <?supplied-pmid 33179754?>
        <pub-id pub-id-type="pmid">33179754</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wykes</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Lewin</surname>
            <given-names>SR</given-names>
          </name>
        </person-group>
        <article-title>Immune checkpoint blockade in infectious diseases</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>91</fpage>
        <lpage>104</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2017.112</pub-id>
        <?supplied-pmid 28990586?>
        <pub-id pub-id-type="pmid">28990586</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Vignali</surname>
            <given-names>DAA</given-names>
          </name>
        </person-group>
        <article-title>Co-stimulatory and co-inhibitory pathways in autoimmunity</article-title>
        <source>Immunity</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>1034</fpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2016.04.017</pub-id>
        <?supplied-pmid 27192568?>
        <pub-id pub-id-type="pmid">27192568</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Novel immune checkpoint targets: moving beyond PD-1 and CTLA-4</article-title>
        <source>Mol. Cancer</source>
        <year>2019</year>
        <volume>18</volume>
        <fpage>155</fpage>
        <pub-id pub-id-type="doi">10.1186/s12943-019-1091-2</pub-id>
        <?supplied-pmid 31690319?>
        <pub-id pub-id-type="pmid">31690319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thommen</surname>
            <given-names>DS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A transcriptionally and functionally distinct PD-1+ CD8+ T cell pool with predictive potential in non-small-cell lung cancer treated with PD-1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>994</fpage>
        <lpage>1004</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-018-0057-z</pub-id>
        <?supplied-pmid 29892065?>
        <pub-id pub-id-type="pmid">29892065</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chowell</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improved prediction of immune checkpoint blockade efficacy across multiple cancer types</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>499</fpage>
        <lpage>506</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01070-8</pub-id>
        <?supplied-pmid 34725502?>
        <pub-id pub-id-type="pmid">34725502</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Subramanian</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>15545</fpage>
        <lpage>15550</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id>
        <?supplied-pmid 16199517?>
        <pub-id pub-id-type="pmid">16199517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morgan</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Tergaonkar</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <article-title>Unraveling B cell trajectories at single cell resolution</article-title>
        <source>Trends Immunol.</source>
        <year>2022</year>
        <volume>43</volume>
        <fpage>210</fpage>
        <lpage>229</lpage>
        <pub-id pub-id-type="doi">10.1016/j.it.2022.01.003</pub-id>
        <?supplied-pmid 35090788?>
        <pub-id pub-id-type="pmid">35090788</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finkin</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hartweger</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Oliveira</surname>
            <given-names>TY</given-names>
          </name>
          <name>
            <surname>Kara</surname>
            <given-names>EE</given-names>
          </name>
          <name>
            <surname>Nussenzweig</surname>
            <given-names>MC</given-names>
          </name>
        </person-group>
        <article-title>Protein amounts of the MYC transcription factor determine germinal center B cell division capacity</article-title>
        <source>Immunity</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>324</fpage>
        <lpage>336.e5</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2019.06.013</pub-id>
        <?supplied-pmid 31350178?>
        <pub-id pub-id-type="pmid">31350178</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vaquero</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Aoudjehane</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Fouassier</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Cancer-associated fibroblasts in cholangiocarcinoma</article-title>
        <source>Curr. Opin. Gastroenterol.</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>63</fpage>
        <lpage>69</lpage>
        <pub-id pub-id-type="doi">10.1097/MOG.0000000000000609</pub-id>
        <?supplied-pmid 31934895?>
        <pub-id pub-id-type="pmid">31934895</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luca</surname>
            <given-names>BA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Atlas of clinically distinct cell states and ecosystems across human solid tumors</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>5482</fpage>
        <lpage>5496.e28</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.09.014</pub-id>
        <?supplied-pmid 34597583?>
        <pub-id pub-id-type="pmid">34597583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Detection of differentially abundant cell subpopulations in scRNA-seq data</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2021</year>
        <volume>118</volume>
        <fpage>e2100293118</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.2100293118</pub-id>
        <?supplied-pmid 34001664?>
        <pub-id pub-id-type="pmid">34001664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yuen</surname>
            <given-names>KC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High systemic and tumor-associated IL-8 correlates with reduced clinical benefit of PD-L1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2020</year>
        <volume>26</volume>
        <fpage>693</fpage>
        <lpage>698</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-020-0860-1</pub-id>
        <?supplied-pmid 32405063?>
        <pub-id pub-id-type="pmid">32405063</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaplanov</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Blocking IL-1β reverses the immunosuppression in mouse breast cancer and synergizes with anti-PD-1 for tumor abrogation</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>1361</fpage>
        <lpage>1369</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1812266115</pub-id>
        <?supplied-pmid 30545915?>
        <pub-id pub-id-type="pmid">30545915</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duan</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Targeting macrophages in cancer immunotherapy</article-title>
        <source>Signal Transduct. Target. Ther.</source>
        <year>2021</year>
        <volume>6</volume>
        <fpage>127</fpage>
        <pub-id pub-id-type="doi">10.1038/s41392-021-00506-6</pub-id>
        <?supplied-pmid 33767177?>
        <pub-id pub-id-type="pmid">33767177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bi</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tumor and immune reprogramming during immunotherapy in advanced renal cell carcinoma</article-title>
        <source>Cancer Cell</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>649</fpage>
        <lpage>661.e5</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ccell.2021.02.015</pub-id>
        <?supplied-pmid 33711272?>
        <pub-id pub-id-type="pmid">33711272</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The role of osteopontin in the progression of solid organ tumour</article-title>
        <source>Cell Death Dis.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>356</fpage>
        <pub-id pub-id-type="doi">10.1038/s41419-018-0391-6</pub-id>
        <?supplied-pmid 29500465?>
        <pub-id pub-id-type="pmid">29500465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spivia</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Magno</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Le</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Fraser</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Complement protein C1q promotes macrophage anti-inflammatory M2-like polarization during the clearance of atherogenic lipoproteins</article-title>
        <source>Inflamm. Res.</source>
        <year>2014</year>
        <volume>63</volume>
        <fpage>885</fpage>
        <lpage>893</lpage>
        <pub-id pub-id-type="doi">10.1007/s00011-014-0762-0</pub-id>
        <?supplied-pmid 25091012?>
        <pub-id pub-id-type="pmid">25091012</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The CXCL8-CXCR1/2 pathways in cancer</article-title>
        <source>Cytokine Growth Factor Rev.</source>
        <year>2016</year>
        <volume>31</volume>
        <fpage>61</fpage>
        <lpage>71</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cytogfr.2016.08.002</pub-id>
        <?supplied-pmid 27578214?>
        <pub-id pub-id-type="pmid">27578214</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lisa: inferring transcriptional regulators through integrative modeling of public chromatin accessibility and ChIP-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>32</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1934-6</pub-id>
        <?supplied-pmid 32033573?>
        <pub-id pub-id-type="pmid">32033573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peters</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Shah</surname>
            <given-names>YM</given-names>
          </name>
          <name>
            <surname>Gonzalez</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>The role of peroxisome proliferator-activated receptors in carcinogenesis and chemoprevention</article-title>
        <source>Nat. Rev. Cancer</source>
        <year>2012</year>
        <volume>12</volume>
        <fpage>181</fpage>
        <lpage>195</lpage>
        <pub-id pub-id-type="doi">10.1038/nrc3214</pub-id>
        <?supplied-pmid 22318237?>
        <pub-id pub-id-type="pmid">22318237</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AnimalTFDB 3.0: a comprehensive resource for annotation and prediction of animal transcription factors</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D33</fpage>
        <lpage>D38</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky822</pub-id>
        <?supplied-pmid 30204897?>
        <pub-id pub-id-type="pmid">30204897</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dysfunctional CD8 T cells form a proliferative, dynamically regulated compartment within human melanoma</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <fpage>775</fpage>
        <lpage>789.e18</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.11.043</pub-id>
        <?supplied-pmid 30595452?>
        <pub-id pub-id-type="pmid">30595452</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyvärinen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Oja</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Independent component analysis: algorithms and applications</article-title>
        <source>Neural Netw.</source>
        <year>2000</year>
        <volume>13</volume>
        <fpage>411</fpage>
        <lpage>430</lpage>
        <pub-id pub-id-type="doi">10.1016/S0893-6080(00)00026-5</pub-id>
        <?supplied-pmid 10946390?>
        <pub-id pub-id-type="pmid">10946390</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping single-cell data to reference atlases by transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>121</fpage>
        <lpage>130</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01001-7</pub-id>
        <?supplied-pmid 34462589?>
        <pub-id pub-id-type="pmid">34462589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Khan</surname>
            <given-names>O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TOX transcriptionally and epigenetically programs CD8+ T cell exhaustion</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>571</volume>
        <fpage>211</fpage>
        <lpage>218</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1325-x</pub-id>
        <?supplied-pmid 31207603?>
        <pub-id pub-id-type="pmid">31207603</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ohandjo</surname>
            <given-names>AQ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome network analysis identifies CXCL13-CXCR5 signaling modules in the prostate tumor immune microenvironment</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>14963</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-46491-3</pub-id>
        <?supplied-pmid 31628349?>
        <pub-id pub-id-type="pmid">31628349</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Havenar-Daughton</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CXCL13 is a plasma biomarker of germinal center activity</article-title>
        <source>Proc. Natl. Acad. Sci. Usa.</source>
        <year>2016</year>
        <volume>113</volume>
        <fpage>2702</fpage>
        <lpage>2707</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1520112113</pub-id>
        <?supplied-pmid 26908875?>
        <pub-id pub-id-type="pmid">26908875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>D’Agostino</surname>
            <given-names>RB</given-names>
          </name>
          <name>
            <surname>Belanger</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>D’Agostino</surname>
            <given-names>RB</given-names>
          </name>
        </person-group>
        <article-title>A suggestion for using powerful and informative tests of normality</article-title>
        <source>Am. Stat.</source>
        <year>1990</year>
        <volume>44</volume>
        <fpage>316</fpage>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>LG</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>QY</given-names>
          </name>
        </person-group>
        <article-title>ClusterProfiler: an R package for comparing biological themes among gene clusters</article-title>
        <source>Omi. A J. Integr. Biol.</source>
        <year>2012</year>
        <volume>16</volume>
        <fpage>284</fpage>
        <lpage>287</lpage>
        <pub-id pub-id-type="doi">10.1089/omi.2011.0118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kotliar</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identifying gene expression programs of cell-type identity and cellular activity with single-cell RNA-Seq</article-title>
        <source>Elife</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>1</fpage>
        <lpage>26</lpage>
        <pub-id pub-id-type="doi">10.7554/eLife.43803</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10164163</article-id>
    <article-id pub-id-type="pmid">37149682</article-id>
    <article-id pub-id-type="publisher-id">38333</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-38333-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MetaTiME integrates single-cell gene expression to characterize the meta-components of the tumor immune microenvironment</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7453-6188</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Yi</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1328-7197</contrib-id>
        <name>
          <surname>Xiang</surname>
          <given-names>Guanjue</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jiang</surname>
          <given-names>Alva Yijia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lynch</surname>
          <given-names>Allen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zeng</surname>
          <given-names>Zexian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7573-3768</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Chenfei</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Wubing</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2440-2015</contrib-id>
        <name>
          <surname>Fan</surname>
          <given-names>Jingyu</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kang</surname>
          <given-names>Jiajinlong</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gu</surname>
          <given-names>Shengqing Stan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Changxin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Boning</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Liu</surname>
          <given-names>X. Shirley</given-names>
        </name>
        <address>
          <email>xsliu.res@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8213-1658</contrib-id>
        <name>
          <surname>Brown</surname>
          <given-names>Myles</given-names>
        </name>
        <address>
          <email>myles_brown@dfci.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8321-2839</contrib-id>
        <name>
          <surname>Meyer</surname>
          <given-names>Clifford A.</given-names>
        </name>
        <address>
          <email>cliff_meyer@ds.dfci.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Department of Data Science, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution>Department of Biostatistics, </institution><institution>Harvard T.H. Chan School of Public Health, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Department of Medical Oncology, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Center for Functional Cancer Epigenetics, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>6</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>6</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>2634</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>26</day>
        <month>4</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Recent advances in single-cell RNA sequencing have shown heterogeneous cell types and gene expression states in the non-cancerous cells in tumors. The integration of multiple scRNA-seq datasets across tumors can indicate common cell types and states in the tumor microenvironment (TME). We develop a data driven framework, MetaTiME, to overcome the limitations in resolution and consistency that result from manual labelling using known gene markers. Using millions of TME single cells, MetaTiME learns meta-components that encode independent components of gene expression observed across cancer types. The meta-components are biologically interpretable as cell types, cell states, and signaling activities. By projecting onto the MetaTiME space, we provide a tool to annotate cell states and signature continuums for TME scRNA-seq data. Leveraging epigenetics data, MetaTiME reveals critical transcriptional regulators for the cell states. Overall, MetaTiME learns data-driven meta-components that depict cellular states and gene regulators for tumor immunity and cancer immunotherapy.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Integration and comparison of multiple single cell sequencing datasets can be used to compare different studies. Here the authors propose MetaTiME which compares the gene expression of single cells from the tumour microenvironment across different tumours and uses transportable labels and metacomponents to annotate cell types and states.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data integration</kwd>
      <kwd>Software</kwd>
      <kwd>Classification and taxonomy</kwd>
      <kwd>Tumour immunology</kwd>
      <kwd>Cancer microenvironment</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000054</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>P01CA163222</award-id>
        <award-id>R01HG011139</award-id>
        <award-id>U24CA237617</award-id>
        <principal-award-recipient>
          <name>
            <surname>Meyer</surname>
            <given-names>Clifford A.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Recent advances in cancer research have implicated the integral function of the tumor microenvironment (TME) in tumor progression and therapy responses<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup>. Understanding interactions between cancer cells and the non-cancer compartments, including immune cells, fibroblasts, and endothelial cells, has shown potential targets for cancer immunotherapy. Specifically, single-cell RNA-sequencing (scRNA-Seq) applied on multiple patient tumors has enabled the high-resolution identification of TME constituents that interfere with the elimination of cancer cells. For example, exhausted tumor-infiltrating lymphocytes (TILs)<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>, and certain tumor-associated macrophages subtypes<sup><xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR11">11</xref></sup>, have been associated with tumor development. However, the definition of cell types and cell states in tumor scRNA analyses still relies on manual labeling by experts using known exclusive biomarkers following unsupervised clustering<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup>, which lacks consistency and varies between different cohorts.</p>
    <p id="Par4">As single-cell data accumulate, integrating a large collection of cells from multiple cohorts can help unify the definition of cell types and states to facilitate the automatic annotation of new scRNA-seq data<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref></sup>. One approach to cell annotation is to use predefined biomarker lists. However, these biomarkers might not cover domain-specific cellular states, for example, well-defined immune cell markers derived from blood immune cells may not fully cover the TME disease context<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>. Moreover, although cell type definitions in reference databases such as CIBERSORT, Azimuth, and Human Primary Cell Atlas<sup><xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup> can be useful, the granularity of these definitions varies between databases. Several efforts integrating pan-cancer scRNA data have revealed subtypes in the TME through the manual annotation of clusters using a shortlist of exclusive gene markers<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR19">19</xref>,<xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
    <p id="Par5">Another approach is to map a dataset containing unannotated cell states onto an annotated reference. Methods to obtain such representations include canonical correlation analysis (CCA)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, adjusted principal components (Harmony)<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, or generative deep learning models using variational autoencoders (scVI)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. These methods use dimension reduction onto a common latent space to align cells with similar states between datasets, without ascribing meaning to the latent space representations. An alternative data driven approach is to identify low dimensional latent space representations in which a biological meaning can be ascribed to each latent dimension. Several matrix factorization algorithms have been developed to represent high dimensional data in a low-dimensional space with interpretable components, including non-negative matrix factorization (NMF)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and independent component analysis (ICA)<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
    <p id="Par6">Here we develop a computational framework for mapping millions of single cells from multiple cohorts onto a comprehensive and interpretable latent space, learnt from the data. The framework, MetaTiME (Meta-components of the Tumor immune MicroEnvironment), identifies reproducible low-dimensional meta-components that reflect independent components of gene expression variation across cohorts and cancer types. MetaTiME adopts ICA for dimensional reduction to maximize the mutual independence among components. We use MetaTiME to obtain meta-components (MeCs) from 1.7 million single cells across 79 tumor datasets. These MeCs represent the TME landscape along 86 data-driven transcriptional directions mirroring lineage-specific cell states and signaling activities. Furthermore, we develop a MetaTiME toolkit for using the MeCs to annotate cellular states and signature continuums in tumor scRNA datasets, and to reveal differential signatures across immunotherapy responses. Finally, by incorporating transcription factor binding data, MetaTiME identifies and prioritizes putative transcriptional regulators that may modulate tumor immunity.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>MetaTiME as a general framework to discover consensus transcriptomic programs</title>
      <p id="Par7">The MetaTiME framework consists of three stages: meta-component (MeC) discovery, interpretation of MeCs, and application of cell state annotations (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). The MeC discovery stage detects repeatable sources of variation from multiple single-cell measurements sharing similar cellular properties. The MeC interpretation step involves a one-time curation effort using biomarker databases, pathway information and Cistrome DB chromatin profiling data<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. In the third step, users map MeCs onto their new tumor scRNA-seq datasets using MetaTiME application tools, to obtain annotated cell states and signature continuums.<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of MetaTiME.</title><p>MetaTiME integrates 1.7 million single cells to learn common transcriptional programs in the tumor microenvironment (TME). <bold>a</bold> Steps for Meta-components (MeCs) discovery. For each scRNA dataset, the expression matrix of TME cells is decomposed into a loading matrix (red) and an independent component (IC) matrix through independent component analysis (ICA). The ICs represent mutually independent sources of transcriptional variation. ICs from each dataset are concatenated and clustered into groups of ICs with high similarity, representing transcriptional programs shared across TME. MeCs are then calculated as averaged profiles of ICs from each cluster. Each MeC is interpretable, representing gene signatures of cell type, cell states, or signaling pathway activities. <bold>b</bold> Left: MetaTiME provides 86 functionally annotated MeCs that depict the TME transcriptional landscape. They are grouped into six lineage-related categories and one category reflecting signaling activities, each using a background color corresponding to the lineage. Middle: the MetaTiME annotation tool facilitates automatic annotation of cell states for new tumor scRNA data. Right: candidate regulators of each MeC are prioritized by combining MeC gene weights with epigenetics data. MeC: meta-components, TME: tumor microenvironment, ICA: independent component analysis, MeC: meta-component, TF: transcription factor.</p></caption><graphic xlink:href="41467_2023_38333_Fig1_HTML" id="d32e506"/></fig></p>
      <p id="Par8">To train MeCs for the TME context, we collected and curated 2,157,387 cells from 76 studies ranging across 27 cancer types, using publicly available tumor scRNA-Seq data mostly from TISCH<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. After removing the TISCH annotated malignant cells using MAESTRO<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, 102,703 stromal cells and 1,617,110 immune cells were retained for downstream training (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). The 76 studies were further partitioned according to cancer type, resulting in 93 datasets, including 7 datasets with immune checkpoint blockade (ICB) treatment and 3 10x Genomics provided datasets representing peripheral blood mononuclear cells (PBMC) sampled from healthy donors.</p>
      <p id="Par9">In the MeC discovery stage, MetaTiME first decomposes the log-transformed expression matrix of each single dataset using Independent Component Analysis (ICA)<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>. We adopted ICA to maximize mutual independence among gene expression components. In simulations ICA performed slightly better than Non-negative Matrix Factorization (NMF) in simulated single-cell data with pre-embedded transcriptional signatures (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). The feature weight distribution of each Independent Component (IC) also enables normalization of the gene contribution scores for measuring similarity among components. MetaTiME then applies two transformations to the IC vectors, <italic>z</italic>-weight normalization and skewness alignment, to ensure the scales of gene representation scores are comparable among components (<bold>Methods</bold>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>). Next, MetaTiME filters ICs to retain ones that are reproducible across multiple cohorts (the minimum Pearson correlation with any other IC ≥3). These are passed to the Louvain graph clustering algorithm to merge IC groups into MeCs (<bold>Methods</bold>). Lastly, MetaTiME computes averaged profiles of gene <italic>z</italic>-weights within each IC cluster, yielding 86 MeCs trained for the TME (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>, Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). The number of MeCs was automatically determined by simultaneously optimizing granularity and independence in IC clustering (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>). Importantly, the MeC clustering does not depend on cohort source (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>, cohort source of component), and is robust during leave-one-out testing in which the MeCs are learnt with a single cohort left out of the analysis (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). The leave-one-out MeCs are highly correlated with the MeCs learnt on the complete data (mean maximum correlation = 0.988), and the numbers of components are similar (mean leave-one-out MeC number = 84.64, full-set MeC number = 86). This integration after decomposition approach overcomes batch effects, which are often a challenge in single cell RNA-seq data analysis. Moreover, we implemented the standard approach in which cluster-wise signatures are obtained by batch effect removal, clustering, and differential expression analysis (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>). Limited by server computing memory, the maximum number of datasets we could integrate in this way was 21, and the cluster-wise signatures display a lower level of specificity in the test data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b,c</xref>). Therefore, the MetaTiME approach allows for the effective integration of large numbers of single cell datasets, which will become increasingly important as data accumulates.<fig id="Fig2"><label>Fig. 2</label><caption><title>MetaTiME meta-components are biologically interpretable with top genes.</title><p><bold>a</bold> Heatmap of top ten most recurrent clusters of MeCs showing normalized gene weights. <bold>b</bold> Biological characterization of each MeC with top genes. To facilitate biological interpretation, MeCs are categorized into six lineage-associated classes (B cells, T cells for CD4T, CD8T and NK cells, dendritic cells, monocyte and macrophages, other myeloid cell types, and stroma cells) and one signaling pathway-associated class. <bold>c</bold> Examples of T cell related MeCs with top 20 genes with largest weights. <bold>d</bold> Gene contribution of known lineage-related biomarkers for each MeC, and correlation with known immune markers from Azimuth. In the top dot plot, size and color represents log-scaled MeC <italic>z</italic>-weights of each gene in each MeC. In the bottom dot plot, size and color represents the maximum correlation coefficient between MeC and Azimuth defined marker genes per cell type. MeC meta-component, DC dendritic cell, Mono/Mac monocytes and macrophages. Each MeC and gene is shaded with a background color corresponding to the lineage category. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig2_HTML" id="d32e594"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>MetaTiME defines interpretable meta-components</title>
      <p id="Par10">In principle, each MeC represents one independent source of transcriptional variation commonly present in the TME. We investigated top ranked genes in MeCs and found MeCs are highly interpretable, reflecting common biological processes in the TME. For instance, the MeC derived from the largest IC cluster is highly enriched in interferon response genes, such as <italic>ISG15</italic>, <italic>IFI6</italic>, <italic>LY6E</italic>, and <italic>MX1</italic>, indicating that the underlying interferon response is among the most common source of transcriptional variation shared across tumor samples and cohorts (Fig. <xref rid="Fig2" ref-type="fig">2a, b</xref>). Intriguingly, top genes of each MeC are enriched in known biomarkers or regulators. For example, several T cell-related MeCs identify different gene modules co-expressed in T cells reflecting activation of different T-cell related processes (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>, Source Data <xref rid="MOESM8" ref-type="media">1</xref>). MeC-65, T cell co-signaling, features T cell receptors in co-stimulatory and co-inhibitory pathways<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>, such as <italic>TNFRSF4</italic> (OX40), <italic>TNFRSF18</italic> (GITR) <italic>TNFRSF9</italic> (4-1BB), and <italic>ICOS</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, left). MeC-40, CXCL13 + exhausted CD8 T cell, features receptors characterizing the exhausted CD8 T cell state<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, including <italic>HAVCR2</italic> (TIM3), <italic>LAG3</italic>, <italic>TIGIT</italic>, and <italic>PDCD1</italic> (PD1) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>, Source Data <xref rid="MOESM8" ref-type="media">2</xref>), each being potential ICB targets<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. In addition, this MeC is characterized by a high level of <italic>CXCL13</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, second panel), a cytokine mediating immune cell trafficking to tertiary lymphoid structures<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. In contrast, a related MeC representing T cell co-signaling receptors in regulatory CD4T cells (Treg) has a different ranking, including <italic>TNFRSF18</italic>, <italic>TNFRSF4</italic>, <italic>TIGIT, TNFRSF1B</italic>, <italic>CTLA4</italic>, <italic>CD27</italic> among the top 20 genes, along with the regulatory T cell-specific marker <italic>FOXP3</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, right, Source Data <xref rid="MOESM8" ref-type="media">1</xref>). Though ICB has been an extremely successful therapy for some patients, it has not yet had an impact on the majority of patients<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. Investigating the top members in the MeCs involving T cell receptor pathways may help identify new ICB targets.</p>
    </sec>
    <sec id="Sec5">
      <title>MetaTiME depicts the functional landscape of transcriptomic variation and cell states in the tumor microenvironment</title>
      <p id="Par11">We provided functional annotations of all MeCs by examining top <italic>z</italic>-weight genes and compared these with functional gene sets, such as immune cell type markers<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR18">18</xref></sup> and gene ontology databases<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. We found that 86 MeCs clearly mirror gene expression patterns corresponding to cell types, cell states and signaling pathway activities, depicting a landscape of non-cancer cell states in the TME (Fig. <xref rid="Fig2" ref-type="fig">2</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC annotation). The top genes of the cell type MeCs match well-known lineage-specific markers<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR18">18</xref></sup>. Examples include <italic>CD74</italic>, <italic>CD79A</italic>, <italic>MS4A1</italic> for B cells (MeC-18, B cell), <italic>CD3D</italic>, <italic>CD8A</italic>, <italic>CD8B</italic> for T cells (MeC-32, <italic>CD3</italic> + CD8 T cell), and <italic>LYZ</italic>, <italic>VCAN</italic>, <italic>S100A9</italic> for CD14 + Monocytes (MeC-17, CD14 monocyte) (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Fig. <xref rid="Fig2" ref-type="fig">2d</xref>, Source Data <xref rid="MOESM8" ref-type="media">3</xref>). The majority of MeCs define high resolution lineage-specific cell states (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). Taking the B cell lineage as an example, multiple MeCs harbor genes specific to B cell developmental stages<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>, ranging from a progenitor B cell state (<italic>CD69</italic> and <italic>PAX5</italic> in MeC-50, <italic>PAX5</italic> B cell), to a mature B cell state (<italic>CD79A</italic> in MeC-18, B cell), an antibody-secreting plasma cell state (<italic>XBP1</italic> in MeC-4, plasma B cell; <italic>JCHAIN</italic> in MeC-77, <italic>JCHAIN</italic> + plasma B cell), and immunoglobulin secretion states (IGK and IGH in MeC-30, immunoglobin kappa B cell; IGL and IGH in MeC-50, immunoglobin lambda B cell) (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). Lastly, like the interferon responsive MeC mentioned above, we found a subset of MeCs that are more accurately interpreted as signaling pathways because their top genes are more related to pathways or molecular functions than to cell identities.</p>
      <p id="Par12">We organized the 86 annotated MeCs into six cell lineage-focused categories and one signaling pathway-focused category (Fig. <xref rid="Fig2" ref-type="fig">2a,b</xref> and Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC annotation, MeC enrichment). Among these, there are 6 B lineage-related MeCs for B cells; 20 T cell lineage MeCs covering CD8 T cells, CD4 T cells, and natural killer (NK) cells; 4 dendritic cell (DC) lineage MeCs; 12 monocyte and macrophage-related MeCs; 3 platelet, erythrocyte, and mast cell MeCs; 6 stromal cell-related MeCs for fibroblasts, myofibroblasts and endothelial cells; and 35 MeCs in the signaling category (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). We demonstrated that the MeCs are of high specificity, visualizing the log-scaled <italic>z</italic>-weights of known cell subtype markers and pathway biomarkers (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). Correlating MeCs with the comprehensive immune cell type database Azimuth<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> validated the lineage-specificity of several MeCs, while most MeCs reflect cell states that appear specific to the tumor context (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>MetaTiME annotates cell states and signature continuums when applied to the tumor microenvironment single-cell data</title>
      <p id="Par13">As MetaTiME MeCs provides a highly interpretable basis for the TME in single cells, we provided a toolkit to discover MeC signature continuums and enriched cell states in scRNA-seq TME data (code deposited in <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>). The MetaTiME annotation toolkit takes as input the scRNA-seq expression matrix after depth normalization and log transformation, maps each single cell onto the pre-trained MeC space, and annotates the most highly enriched cell states for pre-defined cell clusters. The cell clusters are by default calculated using graph clustering with high resolution after an optional batch effect correction with Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. We demonstrate the application of MetaTiME on basal cell carcinoma (BCC) single-cells from Yost et al.<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. These test cells were excluded from the MetaTiME training stage. MetaTiME annotates the enriched cell states (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>) highlighting gradients of exhausted CD8 T cells and follicular helper T cells (Tfh) (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). The most enriched cell states consistently match the manual labelling from the original study with improved resolution (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>) and highly express corresponding markers (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>, Source Data <xref rid="MOESM8" ref-type="media">4</xref>). In addition, compared to Seurat’s<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> automated CIBERSORT marker-based annotations (14 cell types, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>), MetaTiME provides higher resolution (38 cell states, Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). Other automatic annotation gene panels were also tested, including the human primary cell atlas (HPCA) panel and Blueprint-ENCODE panel used in SingleR<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, where macrophages and plasma cells appear to be mislabeled as subclusters within T cell clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8b, c</xref>). Interestingly, the MetaTiME annotation not only indicates the CD8 T cell and CD4 T cell subtypes, but also splits cells further into cell states with polarized expression in proliferation, cytotoxicity, exhaustion level, heat stress, co-signaling pathways, and so on. (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8a</xref>). The B cell group is further partitioned into distinct B cell developmental states including a B cell cluster with cell cycle and MYC activities (Fig. <xref rid="Fig3" ref-type="fig">3a,b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>), which possibly represent germinal center (GC) B cells undergoing active expansion and maturation<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>.<fig id="Fig3"><label>Fig. 3</label><caption><title>MetaTiME annotates cell states with high resolution on tumor microenvironment single-cell data.</title><p><bold>a</bold> MetaTiME cell state annotation of cell clusters in a basal cell carcinoma scRNA dataset based on top enriched MeCs. <bold>b</bold> Manual annotation labels by experts from the original study shown on the same UMAP space. <bold>c</bold> Signature continuums of four MeCs representing the mature dendritic cell state, the CXCL13-secreting exhausted T cell state, the CXCL13-secreting T follicular helper cell state, and the IL1B pathway-activated macrophage state. <bold>d</bold> Marker gene expression for each annotated cell cluster as in (<bold>a</bold>)<bold>. e</bold> Bar plot showing cell state composition of tumor microenvironment for tumor scRNA dataset cell states. The proportion of cell states from the same MeC category are aggregated. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig3_HTML" id="d32e946"/></fig></p>
      <p id="Par14">We thus re-annotated all tumor scRNA cohorts using MetaTiME and investigated the distribution of cell state compositions across cancer cohorts. As shown in Fig. <xref rid="Fig3" ref-type="fig">3e</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>, tumors are highly heterogenous and the TME cellular composition is only partially determined by cancer type (Source Data <xref rid="MOESM8" ref-type="media">5</xref>–<xref rid="MOESM8" ref-type="media">6</xref>). For example, Cholangiocarcinoma (CHOL) is highly enriched in stromal cells including collagen-secreting fibroblast, as expected<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, while other samples including ovarian cancer (OV), pancreatic adenocarcinoma (PAAD), and multiple myeloma (MM) are also stromal-rich. Furthermore, tumors with high infiltration of the MeC-12, <italic>GZMK</italic> + <italic>CCL5</italic> + CD8 T cell state, include multiple tumor types including bladder cancer, breast cancer, and skin cancer, suggesting that immune infiltration is sample-dependent and that cancer treatments should be personalized<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>.</p>
    </sec>
    <sec id="Sec7">
      <title>Differential MetaTiME analysis detects alterations of transcriptional programs in immunotherapy</title>
      <p id="Par15">Single-cell data derived from ICB trials is invaluable for identifying cell types associated with ICB treatment or response<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. However, the detection of differential cell type abundances in ICB cohorts has been challenging due to the heterogeneity of cell type proportions and to the limited numbers of patients in each cohort<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>. We compared differences in MeC signatures instead of cell count proportions, to understand immune responses during ICB. We analyzed two ICB cohorts, a basal cell carcinoma (BCC) cohort with samples from pre- or post-ICB treatment<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, and a bladder cancer (BLCA) cohort with samples from ICB responders and non-responders<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. We applied MetaTiME for per-cluster cell state annotation and per-cell MeC signature evaluation. For each cell state cluster, we tested all MeC signatures passing significance (average <italic>z</italic>-weight ≥2) between conditions using the two-sided t-test. We plotted cluster-wise signatures in the significance – effect size scatterplot to highlight the most significant differential MeCs (<bold>Methods</bold>). In a comparison of pre- and post-ICB treatment, we observed higher expression of cytotoxic T cell and B cell MeCs in the post-ICB samples. Moreover, several monocyte and macrophage states are also suppressed after ICB treatment (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, Source Data <xref rid="MOESM8" ref-type="media">7</xref>). Notably, the <italic>IL1B</italic>-positive macrophage signature is also found to be elevated in non-responders compared to responders in the BLCA ICB cohort (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>, Source Data <xref rid="MOESM8" ref-type="media">8</xref>). Since activation of the IL1B pathway is a known regulator of inflammatory processes<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>, we sought to investigate whether the <italic>IL1B</italic>-positive macrophage signature is associated with tumor survival prognosis in bulk RNA-seq data from The Cancer Genome Atlas Program (TCGA). We evaluated TCGA tumors using the averaged expression of the top 20 genes from MeC-42, M_Macrophage-IL1-NFKB, which ranks first in elevated MeCs in non-responders (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). We found that higher expression of the <italic>IL1B</italic> signature is associated with lower survival rate in multiple cancer types, especially in Low Grade Glioma (LGG) and in Kidney renal cell carcinoma (KIRC) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). This suggests the macrophage state with IL1B pathway activation is associated with poor prognosis and lower ICB efficacy.<fig id="Fig4"><label>Fig. 4</label><caption><title>Differential signature analysis and delineated macrophage states in TME.</title><p><bold>a</bold> Differential MeC signature testing for enriched cell states comparing pre- and post- immunotherapy conditions in basal cell carcinoma (BCC) with two-sided <italic>t</italic>-test. <italic>X</italic>-axis: Difference of mean signature scores between post- and pre-immunotherapy conditions. <italic>Y</italic>-axis: -log(p-value) from two-sided <italic>t</italic>-test. The significant cluster-wise differential signature is marked as “EnrichedMeC@ClusterName”; when the enriched MeC is the same as cluster name, the signature is marked “ClusterName”. Red dots, differentially increased signature; size of the dots is proportionally to the mean signature score of cells from the post-immunotherapy condition in the cluster. Blue dots, differentially repressed signature; size of the dots is proportionally to the mean signature score of cells from the pre-immunotherapy condition in the cluster. <bold>b</bold> Differential signature testing for enriched cell states comparing non-responders and responders from pre-treatment condition in bladder carcinoma (BLCA) with two-sided <italic>t</italic>-test. Red dots, differentially increased signature; size of the dots is proportionally to the mean signature score of cells from the responder condition in the cluster. Blue dots, differentially repressed signature; size of the dots is proportionally to the mean signature score of cells from the non-responder condition in the cluster. <bold>c</bold> Model of monocytes and macrophage states in tumor and their metabolic differences. <bold>d</bold> Top pathways enriched in different macrophage MeCs, with adjusted hypergeometric tested <italic>p</italic>-value from Enrichr. BCC basal cell carcinoma, BLCA bladder carcinoma. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig4_HTML" id="d32e1076"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>MetaTiME delineates myeloid cells in different metabolic states</title>
      <p id="Par16">As specific myeloid cell states have been associated with cancer survival and treatment response, we sought to systematically characterize MeCs related to monocytes and macrophages. Although the canonical definition of M1 and M2 macrophages is derived from cytokine polarized macrophages in vitro<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>, MetaTiME’s myeloid-related MeCs represent a more complex framework for understanding tumor-infiltrating macrophages. MetaTiME’s 12 monocyte and macrophage related MeCs can be summarized into six central monocyte or macrophage states for the TME, after merging similar states such as MeC-42, IL1-NFkB Macrophage and MeC-45, IL1- JUN Macrophage, due to similarity among top genes (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). Monocytes are classified as two categories, CD14 + and CD16 + . For macrophages, four MeCs define common states of intra-tumor macrophages: <italic>C1Q</italic> + , SPP<italic>1</italic> + , lipid-rich, and <italic>IL1B</italic> + macrophages, and two MeCs, representing interferon and MHC-II signaling pathways, are less frequently observed among macrophages (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). In comparison, previous studies defined different tumor associated macrophages in terms of manually selected representative genes after clustering myeloid cells. For example, Cheng et al.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> defined several tumor associated macrophage types including <italic>ISG15</italic> + , SPP<italic>1</italic> + , <italic>INHBA</italic> + , <italic>VCAN</italic> + , <italic>NLRP3</italic> + , and <italic>FN1</italic> + macrophages, while Bi et al.<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> defined <italic>CXCL10</italic>-high, <italic>GPNMB</italic>-high, <italic>FOLR2</italic>-high, <italic>VSIR</italic>-high, and cycling macrophages for advanced renal cell carcinoma (ccRCC). We find that the MetaTiME-defined macrophage MeCs reflect co-expression relationships with the selected marker genes. For example, macrophage markers from Bi et al. rank high in several macrophage-related MeCs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11</xref>), and the expression pattern of the marker genes picked by Bi et al. (<italic>CXCL10</italic>, <italic>GPNMB</italic>, <italic>VSIR</italic>, <italic>FOLR2</italic>, Cycling marker <italic>MKI67</italic>) correspond to several MeCs (MeC-0, interferon response; MeC-37, <italic>PPARG</italic> + lipid-rich macrophage; MeC-58, MHCII-high, and MeC-49, <italic>RNASE1</italic> + , <italic>C1Q</italic> + macrophage) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11</xref>). However, MetaTiME reveals additional distinct components such as the SPP<italic>1</italic> + and <italic>C1Q</italic> + MeCs, which were detected as separate myeloid types in the Cheng et al. multi-cohort study (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12</xref>). While the manual reconciliation of cell types from multi-cohort scRNA data shows many marker genes to be consistent with the top genes in the MetaTiME MeCs, the myeloid cell population is not neatly partitioned into cell clusters and might be better represented in terms of expression signature continuums. For example, when mapping myeloid MeCs onto the kidney myeloid cells, the <italic>IL1B</italic> + MeC signature (MeC-42, MeC-45) is distributed across the M09_Macro_IL1B cluster as well as the CD14 monocyte cluster (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12</xref>).</p>
      <p id="Par17">To investigate functional differences among the different macrophage states, we applied gene set enrichment (GSEA)<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> analysis using the top MeC genes (<bold>Methods</bold>). Interestingly, the different macrophage states have different metabolic preferences (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>, Source Data <xref rid="MOESM8" ref-type="media">9</xref>). Glucose metabolism and the glycosylation pathway are highly active in SPP<italic>1</italic> + macrophages, while lysosome and phagosome activity are the most highly enriched in <italic>C1Q</italic> + macrophages. Lysosome and cholesterol metabolism, including PPARG signaling, are enriched in the lipid-rich state. The inflammatory IL1B and NFkB pathways are highly active in <italic>IL1B</italic> + macrophages. Several macrophage states are related to cell signaling. SPP<italic>1</italic> for example, encodes Osteopontin, which has been found to foster an environment that promotes cancer metastasis<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. The <italic>C1Q</italic> + MeC features <italic>C1QA</italic>, <italic>C1QB</italic>, and <italic>C1QC</italic>, members of the family of complement molecules that could have dual functions in chronic inflammation<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. The <italic>IL1B</italic> + meta-components features cytokines co-expressed with <italic>IL1B</italic>, including <italic>CXCL8</italic>, <italic>CXCL2</italic>, and <italic>CXCL3</italic>, all of which can interact with other cells in the TME by binding to cytokine receptors<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>Incorporation of epigenetic data prioritizes transcriptional regulators of tumor immunity</title>
      <p id="Par18">We next investigated the transcription factors (TFs) that regulate the MeCs, hypothesizing that the co-expression of genes in a subset of MeCs is determined through TF regulatory events. Our group previously developed the Cistrome Data Browser and Lisa to predict transcriptional regulators of gene sets based on chromatin immunoprecipitation with sequencing (ChIP-seq) data<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>. Thus, we used Lisa to predict the TFs that regulate the top genes of each MeC, and compared these Lisa regulatory prediction scores with the MeC <italic>z</italic>-weights across TFs (Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>). We found that, for many MeCs, the same TFs were predicted to be both regulators of the MeC and were highly expressed in the MeC itself, indicating an autoregulatory control scheme. Often, however, TFs that were predicted by Lisa to be MeC regulators were not represented by high MeC <italic>z</italic>-weights, and TFs with high MeC <italic>z</italic>-weight were not always found to have high Lisa scores (Fig. <xref rid="Fig5" ref-type="fig">5</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC regulators). TFs predicted by Lisa but not represented by high MeC <italic>z</italic>-weight could be the result of TF activities being regulated through non-transcriptional mechanisms<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> or multiple TFs in a family having similar binding patterns but only a subset being the regulators<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. TFs that have high MeC <italic>z</italic>-weights but low Lisa scores are most likely not well represented in the relevant cell types in available ChIP-seq data. In MeC-0, interferon response, <italic>STAT1</italic> is highly represented in the MeC <italic>z</italic>-weight and Lisa ranks <italic>STAT1</italic> as the top regulator, consistent with <italic>STAT1</italic> being known as the master regulator of the interferon response (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). Several lineage-defining TFs display the autoregulatory pattern, including <italic>TCF4</italic> in plasmacytoid dendritic cells (pDC) (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>) and <italic>XBP1</italic> in B plasma cells (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref><bold>:</bold> MeC regulators<bold>)</bold>. The macrophage related MeCs are regulated by myeloid lineage TFs like CEBPB, and TFs related to immune stimulus responses, including NFkB complex TFs. In MeC-37, lipid-rich macrophage, although PPARG ranks among the top Lisa-predicted regulators (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>), <italic>PPARG</italic> expression is not highly represented as a MeC <italic>z</italic>-weight. In this MeC, the top co-expressed genes are indeed enriched in the PPARG signaling pathway (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>); this result can be accounted for by PPARG being regulated through its ligands, which include a variety of lipophilic acids<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>.<fig id="Fig5"><label>Fig. 5</label><caption><title>MetaTiME prioritizes tumor immunity transcriptional regulators.</title><p>For selected MeCs, TFs are prioritized by their MeC expression representation and Lisa, ChIP-seq based, regulatory potentials. <italic>X</italic>-axis: gene <italic>z</italic>-weight of the TF for the current MeC. <italic>Y</italic>-axis: Lisa-based regulatory potential significance for top genes in the current MeC. Orange factors: MeC regulators prioritized based on both MeC gene weights and Lisa regulatory potential significance. Green factors: TFs highly weighted in MeCs and not in Lisa analysis. Blue factors: TFs with high Lisa regulatory potential and not highly weighted in MeCs. <bold>a</bold> TFs prioritized for three MeCs in the signaling category. <bold>b</bold> TFs prioritized for three MeCs in the dendritic cell category. <bold>c</bold> TFs prioritized for three MeCs representing different macrophage states. <bold>d</bold> TFs prioritized for three MeCs representing different T cell states. TF transcription factor, MeC meta-component. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig5_HTML" id="d32e1392"/></fig></p>
      <p id="Par19">We found glucocorticoid receptor (GR) signaling to be implicated in the regulation of MeC-20, <italic>CXCL13</italic> + Tfh, with GR being most highly ranked TF in both MeC and Lisa scores (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Top genes in MeC-20, <italic>CXCL13</italic> + Tfh, include several direct target genes of GR, including <italic>SRGN</italic> and <italic>FKBP5</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13b</xref>). We investigated whether the <italic>CXCL13</italic> cytokine itself could be a direct target of GR in <italic>CXCL13</italic> secreting Tfh cells. Since GR ChIP-seq data is not available for the exact Tfh cell state, we collected GR ChIP-seq data from several other cell types. Direct binding of GR is observed at the <italic>CXCL13</italic> gene promoter and nearby the gene locus at putative enhancers, which are conserved across multiple cell lines (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13a</xref>), including the B cell line Nalm6, the monocyte cell line THP1, and cancer cell lines. Moreover, in another CXCL13 secreting cell state, MeC-40, <italic>CXCL13</italic> + exhausted CD8 T cell, GR is also highly ranked in both Lisa and MeC scores (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Thus, we hypothesize that GR is likely to be a transcriptional driver of the CXCL13-secreting cell states in exhausted CD8 T cells<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> as well as in CD4 T follicular helper T cells. Thus, the GR pathway could be a candidate target in tumor immunity modulation.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par20">We developed the MetaTiME (Meta-components of the tumor immune Microenvironment) framework and performed a large-scale and pan-cancer integration of tumor single cell datasets using ICA to optimize information independence among components<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. We identified 86 interpretable meta-components (MeCs) that describe common aspects of TME gene expression variation across multiple tumors.</p>
    <p id="Par21">The MetaTiME MeCs serve as comprehensive transcriptional signatures that depict a functional landscape of TME transcriptional programs and cell states. For monocytes and macrophages, the related MeCs showed heterogeneity and plasticity of tumor-associated macrophages (TAMs). We thus propose that TAMs, especially for solid tumors, should be classified based on the major states with different metabolic preferences instead of the canonical M1 and M2 classification<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Similar states that do not fit well into the M1 versus M2 classification scheme were also observed in previous studies analyzing myeloid cells in the TME, where single cells were clustered and labeled using differential markers<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR43">43</xref></sup>. Cheng et al.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> defined several TAM types by clustering myeloid cells separately for each study and naming the TAMs with manually selected top marker, chosen based on consistency across cohorts. Similarly, Bi et al.<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> defined TAM types by harmonizing patients and naming the TAMs with top genes in each cluster for an advanced renal cell carcinoma (ccRCC) cohort. Cell type definitions in the previous studies were based on representative genes, which were chosen differently in the respective studies. We propose that the MetaTiME derived monocyte and macrophage MeCs could be used to define macrophage states and functional co-expressed gene modules more consistently for the TME. Reexamining the marker genes from the previous studies: <italic>NLRP3</italic> is highly ranked in MeC-42, <italic>IL1B</italic> + macrophage; in fact, the NLRP3 inflammasome mediates interleukin-1β production. <italic>GPNMB</italic> is weighted among the top 20 genes in both MeC-19, Macrophage-C1Q and MeC-26, Macrophage-SPP1; it encodes a membrane glycoprotein which is typically highly expressed in macrophages. <italic>FOLR2</italic> is ranked 29th in MeC-19, Macrophage-C1Q, indicating this macrophage state also encodes a high folate-activated pathway. Finally, MeC-36, Macrophage-SPP1-C1Q, features an intermediate state with both SPP<italic>1</italic> and <italic>C1QA</italic>, indicating the plasticity and mixed nature of pathways activated in TAMs that could not be defined using exclusive markers. Thus, the myeloid MeCs may provide a consistent definition of TAM states corresponding to different metabolic processes.</p>
    <p id="Par22">MetaTiME provides a toolkit for analyzing independent TME scRNA-seq datasets by mapping gene expression onto the MeC space. The outputs include signature continuums and the most highly enriched cell states. Recent useful single-cell dataset integration algorithms such as Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> and scArches<sup><xref ref-type="bibr" rid="CR52">52</xref></sup> infer a joint low-dimensional representation among data. In these approaches the shared space is re-computed every time a new dataset is incorporated. The MetaTiME strategy builds upon previous approaches that transfer latent representations from large datasets, but provides a stable and interpretable representation specialized for the TME.</p>
    <p id="Par23">By leveraging ChIP-seq data, MetaTiME implicates critical transcriptional regulators in tumor immunity. In many cases, we found the joint consideration of MeC-specific co-expression patterns and TF binding enrichments shows the functions of TFs in defining cellular states and gene expression programs. MetaTiME captured multiple known TFs critical to tumor immunity and could serve as immune modulation targets; this includes <italic>TOX</italic> in MeC-40, <italic>CXCL13</italic>-secreting exhausted CD8 T cell, a recently discovered regulator of T cell exhaustion<sup><xref ref-type="bibr" rid="CR53">53</xref></sup> (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). The MeCs further implicated the glucocorticoid receptor pathway in the regulation of several T cell states. Glucocorticoids are a class of steroid hormones essential to the modulation of multiple biological processes, including immune related ones<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, although the function of the GR pathway in different immune cell types is not fully understood. Since GR is broadly expressed in many cell types, and is regulated through ligand binding, differential analysis of GR expression is unlikely to fully capture GR regulation in single-cell data analysis. Though GR ChIP-seq is not available in the contexts of the relevant T cell states, GR ChIP-seq in other cell lines demonstrate robust binding nearby the top gene <italic>CXCL13</italic>. CXCL13 is crucial to T follicular helper cell communication with germinal center B cells, through interaction with its receptor CXCR5<sup><xref ref-type="bibr" rid="CR54">54</xref>,<xref ref-type="bibr" rid="CR55">55</xref></sup>.</p>
    <p id="Par24">Overall, MetaTiME depicts the functional landscape of transcriptomic variation and cell states in the tumor microenvironment. It provides a computational framework to facilitate the elucidation of the identity and function of cells in the TME in future studies and will facilitate the identification of potential new therapeutic targets for immune modulation.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Tumor single-cell RNA-seq data collection and processing</title>
      <p id="Par25">For an extensive collection of single cells from tumor microenvironment, we utilized the public tumor scRNA-seq collection, TISCH<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. The TISCH collection uniformly processed each dataset with MAESTRO<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> and isolated non-malignant environmental cells from malignant cells. Overall, we collected 2,157,387 cells from 76 studies ranging 27 cancer types. The MAESTRO annotation was labeled using CIBERSORT gene panels<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> followed by curation, enabling selection of 1,719,813 tumor micro-environment cells, including 1,617,110 immune cells and 102,703 stromal cells, were retained for integrative analysis in this study. For studies with data measured from multiple cancer types, cells different cancer types were split into independent datasets, resulting in 93 datasets; it includes 3 PBMC datasets from healthy donors from 10X Genomics as baseline and 7 datasets with ICB treatment.</p>
      <p id="Par26">For an unsupervised component analysis, each dataset was re-analyzed. For datasets with raw count matrices available, gene expression was normalized towards per-cell read depth 10,000 followed by log transformation. For datasets with only TPM or FPKM values available, including Smart-seq data or studies with only normalized matrix available, gene expression underwent log transformation. Cells were filtered based on minimum library size 1000, gene number 500, and maximum mitochondrial read proportion 5%.</p>
    </sec>
    <sec id="Sec13">
      <title>Decomposing individual studies and denoising low-dimensional components</title>
      <p id="Par27">We then decomposed the expression matrix of each scRNA-seq dataset using fastICA<sup><xref ref-type="bibr" rid="CR51">51</xref></sup> into an independent component (IC) vector matrix and a projection weight matrix. We tested different values for the number of components (<italic>k</italic>) and chose <italic>k</italic> to be 100 uniformly for each dataset, given it could cover more variations than the number of cell types in the TME, which is around twenty. We applied two denoising approaches to handle sparsity and potentially noisy ICs. First, we performed a <italic>z</italic> -score transformation of the gene loadings in the component, scaling all gene loading values by the standard deviation of each IC. The gene loadings indicate the degree of contribution to the component as a metagene from each gene, and we observed that most genes contribute neutrally to the metagene. Thus, genes with significant contributions are selected using the two-standard deviation threshold from either the positive or the negative side. Second, we aligned the positive skewness of components (using scipy.stats.skewtest<sup><xref ref-type="bibr" rid="CR56">56</xref></sup>) since the sign of an independent component is randomly assigned in fastICA optimization. We observed that asymmetrically extreme gene loading values highlight genes representative of the component’s function; thus, we computed each component’s skewness statistics and flipped the sign of component loadings if the skewness is negative. We excluded genes with a low contribution (gene weight not passing two standard deviations) to any reproducible components and kept 6623 genes with potentials in driving the reproducible components. The post-decomposition steps ensured the attitude and sign of gene weights are comparable across cohorts, depicting degree of contribution from each gene in the genome-wide background.</p>
    </sec>
    <sec id="Sec14">
      <title>Meta-component calling and functional annotation</title>
      <p id="Par28">We then aim to discover reproducible patterns from all components from each dataset. We evaluated similarity between pairs of components using cosine distance and retained a set of 1043 candidate reproducible components from 69 datasets, each with a minimum Pearson correlation coefficient 0.3 with at least one different IC. We then clustered ICs using Louvain clustering, a graph-based community detection algorithm where the resolution parameter controls segmentation granularity. Clusters with at least five ICs were retained as reproducible IC clusters. The number of clusters is determined by optimizing both Silhouette’s score for optimal within-cluster similarity compared to inter-cluster similarity and number of reproducible clusters. The final resolution parameter was chosen to be 1.25 resulting in 86 clusters for meta-component (MeC) calling. The consensus gene <italic>z</italic>-weights in each MeC were then calculated by averaging ICs in each cluster. Genes of outlier <italic>z</italic>-weights passing two standard deviations were highlighted as significant, and the ones with positive largest <italic>z</italic>-weights were considered representative of the MeC.</p>
      <p id="Par29">MetaTiME MeCs were assigned curated annotation by matching top <italic>z</italic>-weighted genes to functional biological information including cell type markers, pathway databases from GSEA and Enrichr through GSEApy, cell types expressing top MeC genes, and high-rank transcription factors. In detail, GSEA enrichment analyses utilized the top 100 highest <italic>z</italic>-weighted genes and TF database was obtained from AnimalTFDB<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. The pathway database from Enrichr utilized WikiPathways, BioPlanet, MSigDB_Hallmarks, GO_Biological_pathway, GO_Molecular_function, GO_Biological_process. KEGG, and Reactome. GSEA was also performed using the <italic>z</italic>-weight rank of all genes<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>. The 86 MeCs were first ordered by MeC cluster size, then organized into seven functional categories with six lineage-related categories and one signaling category.</p>
    </sec>
    <sec id="Sec15">
      <title>Simulating multi-cohort single-cell RNA data with expression programs</title>
      <p id="Par30">To benchmark dimensional reduction methods, we built upon previous effort from Kotliar et al.<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> to use the scsim package to simulate multiple count matrices with built-in transcriptional programs. In principle, the built-in gene expression programs (GEP) were sampled as random scaling factors on a subset of genes mimicking overexpression or suppression of a pathway. For testing whether a higher number of cohorts facilitate GEP recovery, we simulated 20 single-cell datasets and tested usage of 5 cohorts, 10 cohorts, and 20 cohorts. Each dataset was embedded with a subset of 14 pre-defined GEPs, since the real tumor scRNA data may not cover every possible cell type or gene program in every dataset. The 14 GEPs contain 13 cell type-specific programs with distinct cell type-specific genes, and one signaling gene expression program that is randomly active in multiple cell types. Two low-dimensional reduction method are benchmarked using simulated scRNA data: independent component analysis (ICA) and non-negative matrix factorization (NMF). Decomposition was performed on each single cohort separately, and meta-component calling was done as similar in MetaTiME: components are filtered, clustered into meta-components, followed by averaging gene <italic>z</italic>-weights per cluster as predicted gene expression programs (GEP). The predicted GEPs were compared with pre-defined True GEPs using Pearson correlation. Overall, both ICA and NMF can recover GEPs, while the ICA-based GEPs are more mutually independent and performs slightly better. Since the GEP recovered in the 20 cohorts case matched true GEP better than 5 cohorts and 10 cohorts, the increased number of cohorts also improves GEP recovery. Thus, we chose ICA for component integration and use all available datasets for GEP discovery for tumor microenvironmental cells.</p>
    </sec>
    <sec id="Sec16">
      <title>MeC calling robustness with leave-one-out testing</title>
      <p id="Par31">MetaTiME’s robustness was examined by re-calling MeCs after leaving one dataset out and calculate the Pearson correlation between the left out dataset MeCs and the full-set MeCs. The leave-one-out analysis was first performed by removing the SCC cells from the Yost et al. dataset, which was shown as an example of MetaTiME annotation. Each dataset in the MeC pool was left out to call new MeCs using the same parameters, resolution = 1.25 and min_cluster_size = 5. We used two metrics to check the similarity of each leave-one-out experiments compared to the full set. The first metric is the mean maximum correlation between leave-one-out and the full set. This is calculated by taking the maximum correlation, row-wise and column-wise in the correlation heatmap, and then taking the average. The second metric is the number of MeCs.</p>
    </sec>
    <sec id="Sec17">
      <title>Comparing MeCs, signatures by post-embedding integration, to signatures by cluster-wise differential expression</title>
      <p id="Par32">We compared MetaTiME MeCs to the standard approach that extracts signatures after integrating cells across datasets. The standard approach to obtain cluster-wise signatures is to perform dataset harmonization, cell clustering, and cluster-wise differential expression analysis. When performing dataset integration, we first used CCA to include as many datasets as possible given our maximum memory available in our computing resource (150GB). The maximum number of datasets integrated by CCA is 10 when using datasets ranked by the number of TME cells. We then used scanpy to achieve the successful integration of 21 datasets. The integrated cells are harmonized with Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> and clustered, followed by differential expression analysis using the Wilcoxon test to extract cluster-wise signatures. The signatures are in the format of gene vector of log fold change, and named as “Cluster DE signatures”. To control the confounding effect of signature numbers, the resolution of clustering is chosen to reach 90 clusters, a similar number with the number of full-set MeCs which is 86. Then, we compared MetaTiME MeCs to the Cluster DE signature projected onto a test dataset. We used same BCC cells as the test cells that are never seen in the training step from either method. To reflect how variable the projected scores are across cells, we grouped cells from the test BCC data into 25 clusters with Leiden clustering. The heatmap of the cluster-wise signature mapping is plotted to observe how specific each type of score is across cell groups. We further used cross-cluster entropy to quantify the information content of scores relative to clusters in the test dataset.</p>
    </sec>
    <sec id="Sec18">
      <title>The MetaTiME annotator for analyzing new tumor scRNA-seq data</title>
      <p id="Par33">MetaTiME provides an analytical toolkit for annotating cell states and signature activities for tumor scRNA-seq data (<ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>). The scRNA-seq data is first processed following standard procedures, which includes cell depth normalization, <italic>log</italic>-transformation, batch effect removal using Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, neighboring graph construction, graph clustering, and UMAP embedding for visualization. Specifically, the clustering step uses an over-clustering strategy, which sets a high-resolution parameter (default 8) that generates a larger number of clusters and help reveal fine structures among the cells. Then, the MetaTiME annotator tool takes as input a single log-transformed expression matrix for TME cells from the dataset. The outputs include both per-cell MetaTiME MeC signature scores and per-cluster enriched MeC state. For the per-cell score, MetaTiME projects each cell onto the MeC space by calculating the dot product between the expression vector and the <italic>z</italic>-weight vector of each MeC, using genes passing the significant <italic>z</italic>-weight criterion (<italic>z</italic>-weight ≥2). The projection matrix is then scaled across all cells to ensure normally distributed scores within each MeC, outputting the cell-by-MeC score matrix. Meanwhile, the UMAP view of the projection score shows the signature gradient across the cells positioned by similarity. Lastly, the cluster-wise MeC enrichment results are also generated. The per-cluster MeC enrichment score is calculated by averaging profile of cells along each MeC; MeCs with mean score passing the significant cutoff (2 in the <italic>z</italic>-weight scale) are called as the set of enriched MeCs. Each cluster may enrich multiple number of MeCs, and the top enriched MeC with highest score is used in UMAP visualization.</p>
    </sec>
    <sec id="Sec19">
      <title>Differential MeC signature analysis</title>
      <p id="Par34">For tumor scRNA-seq data with different conditions, a differential signature analysis can be carried out following MetaTiME annotation, which provides enriched MeCs for each cluster and names each cluster with the top enriched MeC. Thus, for each cell cluster, the MeC signature strength can be compared across conditions, for all enriched MeC in the current cluster. In details, a simple <italic>t</italic>-test or Wilcoxon rank-sum test is adopted to compare MeC scores of cells in one condition with another. The effect size of MeC scores were calculated by the difference between cell means from the two conditions in comparison. To plot the cluster-specific differential signature plot, the signatures are marked using “EnrichedMeC@ClusterName”, where the “ClusterName” is the top first enriched MeC used as cell state as current cluster. When “EnrichedMeC” is the same as the “ClusterName”, only “ClusterName” is marked on the Significance-Effect size plot.</p>
    </sec>
    <sec id="Sec20">
      <title>Incorporation of epigenetic data using Lisa</title>
      <p id="Par35">Our group previously developed Lisa that predicts the influence of TFs on a set of genes. Lisa models public chromatin accessibility and TF binding profiles to score TFs in gene regulation from an epigenetic perspective. We developed Lisa2 that improves on running speed and pipeline integration, which is applied on each MeC to score TFs in regulation potential on top 100 high <italic>z</italic>-weighted genes. The impact scores of TFs are thus from two sources: MeC <italic>z</italic>-weights for expression representation, and Lisa scores for binding potential, as in Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>. The TFs are grouped into three classes, TFs highly ranked based on both MeC gene weights and Lisa significance, TFs representative only in MeC, and TFs based on binding information only. In Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>, we marked TFs from different classes in different columns. Significant TFs based on both MeC and Lisa (MeC <italic>z</italic>-weight ≥2), Lisa score -log (<italic>p</italic>-value) ≥2 are marked in the column TF_MeCLisa_top_1; furthermore, the TFs ranking among top 40 (aggregated rank of MeC and Lisa) compared to all genes are further marked in the column TF_MeCLisa_top. TFs ranking among top 10 only in MeC <italic>z</italic>-weight are in the column TF_MeC_top, and TFs ranking among top 10 only in Lisa score are in the column TF_Lisa_top.</p>
    </sec>
    <sec id="Sec21">
      <title>Reporting summary</title>
      <p id="Par36">Further information on research design is available in the <xref rid="MOESM7" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec22">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_38333_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_38333_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_38333_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_38333_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_38333_MOESM5_ESM.xlsx">
            <caption>
              <p>Supplementary Data 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_38333_MOESM6_ESM.xlsx">
            <caption>
              <p>Supplementary Data 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2023_38333_MOESM7_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec23">
        <title>Source data</title>
        <p id="Par40">
          <media position="anchor" xlink:href="41467_2023_38333_MOESM8_ESM.xlsx" id="MOESM8">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-38333-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>The results appearing here are supported by grants NIH grants P01CA163222(CM), U24CA237617(CM,MB), and R01CA234018(MB). We acknowledge all authors of the original tumor single-cell studies that generated publicly available data. The results appearing here are in part based upon the data generated by the TCGA Research Network (<ext-link ext-link-type="uri" xlink:href="http://cancergenome.nih.gov/">http://cancergenome.nih.gov/</ext-link>).</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>C.M., M.B., S.L., Y.Z. designed the study and were major contributor in editing the manuscript. C.M., M.B., S.L. supervised the study. Y.Z. analyzed and interpreted the data and was a major contributor in writing the manuscript. Y.J., G.X., C. Wan, Z.Z., A.L., W.Z., J.F., J.K. contributed to the data analysis. C. Wang, Z.Z., Y.Z., Y.J., S.G., B.Z. contributed to the data collection and analysis. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par37"><italic>Nature Communications</italic> thanks Andrew Adey, Markus List and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The processed datasets used in this study are available in Zenodo under accession code <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7410180">7410180</ext-link> The pretrained meta-components for tumor microenvironment in the Github repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>. The single-cell RNA-seq data used in this study are available in the TISCH database (<ext-link ext-link-type="uri" xlink:href="http://tisch1.comp-genomics.org">http://tisch1.comp-genomics.org</ext-link>). The list of public datasets used in this study is available in Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref> and also from GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE154763">GSE154763</ext-link> and Single Cell Portal under accession code <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1288/tumor-and-immune-reprogramming-during-immunotherapy-in-advanced-renal-cell-carcinoma">SCP1288</ext-link>. The gene list analytical data used in this study are available in AnimalTFDB v3.0 (<ext-link ext-link-type="uri" xlink:href="http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/">http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/</ext-link>), TCGA (<ext-link ext-link-type="uri" xlink:href="https://portal.gdc.cancer.gov">https://portal.gdc.cancer.gov</ext-link>), and Azimuth (<ext-link ext-link-type="uri" xlink:href="https://azimuth.hubmapconsortium.org">https://azimuth.hubmapconsortium.org</ext-link>). The ChIP-seq data used in this study are available from GEO (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/">https://www.ncbi.nlm.nih.gov/geo/</ext-link>) under accession IDs <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM604651">GSM604651</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637309">GSM1637309</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1607526">GSM1607526</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2661793">GSM2661793</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2735378">GSM2735378</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2871705">GSM2871705</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637306">GSM1637306</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637307">GSM1637307</ext-link>, and from ENCODE (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/">https://www.encodeproject.org/</ext-link>) under accession ID <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/experiments/ENCSR919OXR/">ENCSR919OXR</ext-link>. <xref rid="Sec23" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>MetaTiME is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>, and also available at Zhang Y et al., “MetaTiME Integrates Single-cell Gene Expression to Characterize the Meta-components of the Tumor Immune Microenvironment”, MetaTiME, 10.5281/zenodo.7734062, 2023.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par38">MB is a consultant to and receives sponsored research support from Novartis. MB serves on the SAB of H3 Biomedicine, Kronos Bio, FibroGen, and GV20 Therapeutics. X.S.L conducted the work while being on the faculty at DFCI, and is currently a board member and CEO of GV20 Therapeutics. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>XS</given-names>
          </name>
          <name>
            <surname>Mardis</surname>
            <given-names>ER</given-names>
          </name>
        </person-group>
        <article-title>Applications of immunogenomics to cancer</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>168</volume>
        <fpage>600</fpage>
        <lpage>612</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2017.01.014</pub-id>
        <?supplied-pmid 28187283?>
        <pub-id pub-id-type="pmid">28187283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jin</surname>
            <given-names>MZ</given-names>
          </name>
          <name>
            <surname>Jin</surname>
            <given-names>WL</given-names>
          </name>
        </person-group>
        <article-title>The updated landscape of tumor microenvironment and drug repurposing</article-title>
        <source>Signal Transduct. Target. Ther.</source>
        <year>2020</year>
        <volume>5</volume>
        <fpage>166</fpage>
        <pub-id pub-id-type="doi">10.1038/s41392-020-00280-x</pub-id>
        <?supplied-pmid 32843638?>
        <pub-id pub-id-type="pmid">32843638</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Penter</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Local and systemic effects of immune checkpoint blockade on relapsed myeloid malignancies following allogeneic hematopoietic stem cell transplantation</article-title>
        <source>Blood</source>
        <year>2020</year>
        <volume>136</volume>
        <fpage>34</fpage>
        <lpage>35</lpage>
        <pub-id pub-id-type="doi">10.1182/blood-2020-139487</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cancer-associated genetic variant Rs3903072 modulates immune cells in the tumor microenvironment</article-title>
        <source>Front. Genet.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>754</fpage>
        <pub-id pub-id-type="doi">10.3389/fgene.2019.00754</pub-id>
        <?supplied-pmid 31507631?>
        <pub-id pub-id-type="pmid">31507631</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gu</surname>
            <given-names>SS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Therapeutically increasing MHC-I expression potentiates immune checkpoint blockade</article-title>
        <source>Cancer Disco.</source>
        <year>2021</year>
        <volume>11</volume>
        <fpage>1524</fpage>
        <lpage>1541</lpage>
        <pub-id pub-id-type="doi">10.1158/2159-8290.CD-20-0812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeng</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TISMO: syngeneic mouse tumor database to model tumor immunity and immunotherapy response</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>D1391</fpage>
        <lpage>D1397</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab804</pub-id>
        <?supplied-pmid 34534350?>
        <pub-id pub-id-type="pmid">34534350</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Signatures of T cell dysfunction and exclusion predict cancer immunotherapy response</article-title>
        <source>Nat. Med.</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>1550</fpage>
        <lpage>1558</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-018-0136-1</pub-id>
        <?supplied-pmid 30127393?>
        <pub-id pub-id-type="pmid">30127393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yost</surname>
            <given-names>KE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal replacement of tumor-specific T cells following PD-1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2019</year>
        <volume>25</volume>
        <fpage>1251</fpage>
        <lpage>1259</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-019-0522-3</pub-id>
        <?supplied-pmid 31359002?>
        <pub-id pub-id-type="pmid">31359002</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analyses inform mechanisms of myeloid-targeted therapies in colon cancer</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>181</volume>
        <fpage>442</fpage>
        <lpage>459.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2020.03.048</pub-id>
        <?supplied-pmid 32302573?>
        <pub-id pub-id-type="pmid">32302573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cheng</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A pan-cancer single-cell transcriptional atlas of tumor infiltrating myeloid cells</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>792</fpage>
        <lpage>809.e23</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.01.010</pub-id>
        <?supplied-pmid 33545035?>
        <pub-id pub-id-type="pmid">33545035</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>In vivo CRISPR screens identify the E3 ligase Cop1 as a modulator of macrophage infiltration and cancer immunotherapy target</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>5357</fpage>
        <lpage>5374.e22</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.09.006</pub-id>
        <?supplied-pmid 34582788?>
        <pub-id pub-id-type="pmid">34582788</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>SZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell and spatially resolved atlas of human breast cancers</article-title>
        <source>Nat. Genet.</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>1334</fpage>
        <lpage>1347</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-021-00911-1</pub-id>
        <?supplied-pmid 34493872?>
        <pub-id pub-id-type="pmid">34493872</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell tumor immune atlas for precision oncology</article-title>
        <source>Genome Res.</source>
        <year>2021</year>
        <volume>31</volume>
        <fpage>1913</fpage>
        <lpage>1926</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.273300.120</pub-id>
        <?supplied-pmid 34548323?>
        <pub-id pub-id-type="pmid">34548323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aran</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage</article-title>
        <source>Nat. Immunol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>163</fpage>
        <lpage>172</lpage>
        <pub-id pub-id-type="doi">10.1038/s41590-018-0276-y</pub-id>
        <?supplied-pmid 30643263?>
        <pub-id pub-id-type="pmid">30643263</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrative analyses of single-cell transcriptome and regulome using MAESTRO</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>198</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02116-x</pub-id>
        <?supplied-pmid 32767996?>
        <pub-id pub-id-type="pmid">32767996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Newman</surname>
            <given-names>AM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust enumeration of cell subsets from tissue expression profiles</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>453</fpage>
        <lpage>457</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3337</pub-id>
        <?supplied-pmid 25822800?>
        <pub-id pub-id-type="pmid">25822800</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andreatta</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Interpretation of T cell states from single-cell transcriptomics data using reference atlases</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>1</fpage>
        <lpage>19</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-23324-4</pub-id>
        <pub-id pub-id-type="pmid">33397941</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Pan-cancer single-cell landscape of tumor-infiltrating T cells</article-title>
        <source>Sci. (80-.)</source>
        <year>2021</year>
        <volume>374</volume>
        <fpage>abe6474</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abe6474</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pelka</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially organized multicellular immune hubs in human colorectal cancer</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>4734</fpage>
        <lpage>4752.e20</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.08.003</pub-id>
        <?supplied-pmid 34450029?>
        <pub-id pub-id-type="pmid">34450029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyvarinen</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Fast and robust fixed-point algorithms for independent component analysis</article-title>
        <source>IEEE Trans. Neural Netw.</source>
        <year>1999</year>
        <volume>10</volume>
        <fpage>626</fpage>
        <lpage>634</lpage>
        <pub-id pub-id-type="doi">10.1109/72.761722</pub-id>
        <?supplied-pmid 18252563?>
        <pub-id pub-id-type="pmid">18252563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Independent component analysis based gene co-expression network inference (ICAnet) to decipher functional modules for better single-cell clustering and batch integration</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>E54</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab089</pub-id>
        <?supplied-pmid 33619563?>
        <pub-id pub-id-type="pmid">33619563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cistrome data browser: expanded datasets and new tools for gene regulatory analysis</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D729</fpage>
        <lpage>D735</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky1094</pub-id>
        <?supplied-pmid 30462313?>
        <pub-id pub-id-type="pmid">30462313</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TISCH: a comprehensive web resource enabling interactive single-cell transcriptome visualization of tumor microenvironment</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>D1420</fpage>
        <lpage>D1430</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkaa1020</pub-id>
        <?supplied-pmid 33179754?>
        <pub-id pub-id-type="pmid">33179754</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wykes</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Lewin</surname>
            <given-names>SR</given-names>
          </name>
        </person-group>
        <article-title>Immune checkpoint blockade in infectious diseases</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>91</fpage>
        <lpage>104</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2017.112</pub-id>
        <?supplied-pmid 28990586?>
        <pub-id pub-id-type="pmid">28990586</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Vignali</surname>
            <given-names>DAA</given-names>
          </name>
        </person-group>
        <article-title>Co-stimulatory and co-inhibitory pathways in autoimmunity</article-title>
        <source>Immunity</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>1034</fpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2016.04.017</pub-id>
        <?supplied-pmid 27192568?>
        <pub-id pub-id-type="pmid">27192568</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Novel immune checkpoint targets: moving beyond PD-1 and CTLA-4</article-title>
        <source>Mol. Cancer</source>
        <year>2019</year>
        <volume>18</volume>
        <fpage>155</fpage>
        <pub-id pub-id-type="doi">10.1186/s12943-019-1091-2</pub-id>
        <?supplied-pmid 31690319?>
        <pub-id pub-id-type="pmid">31690319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thommen</surname>
            <given-names>DS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A transcriptionally and functionally distinct PD-1+ CD8+ T cell pool with predictive potential in non-small-cell lung cancer treated with PD-1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>994</fpage>
        <lpage>1004</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-018-0057-z</pub-id>
        <?supplied-pmid 29892065?>
        <pub-id pub-id-type="pmid">29892065</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chowell</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improved prediction of immune checkpoint blockade efficacy across multiple cancer types</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>499</fpage>
        <lpage>506</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01070-8</pub-id>
        <?supplied-pmid 34725502?>
        <pub-id pub-id-type="pmid">34725502</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Subramanian</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>15545</fpage>
        <lpage>15550</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id>
        <?supplied-pmid 16199517?>
        <pub-id pub-id-type="pmid">16199517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morgan</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Tergaonkar</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <article-title>Unraveling B cell trajectories at single cell resolution</article-title>
        <source>Trends Immunol.</source>
        <year>2022</year>
        <volume>43</volume>
        <fpage>210</fpage>
        <lpage>229</lpage>
        <pub-id pub-id-type="doi">10.1016/j.it.2022.01.003</pub-id>
        <?supplied-pmid 35090788?>
        <pub-id pub-id-type="pmid">35090788</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finkin</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hartweger</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Oliveira</surname>
            <given-names>TY</given-names>
          </name>
          <name>
            <surname>Kara</surname>
            <given-names>EE</given-names>
          </name>
          <name>
            <surname>Nussenzweig</surname>
            <given-names>MC</given-names>
          </name>
        </person-group>
        <article-title>Protein amounts of the MYC transcription factor determine germinal center B cell division capacity</article-title>
        <source>Immunity</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>324</fpage>
        <lpage>336.e5</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2019.06.013</pub-id>
        <?supplied-pmid 31350178?>
        <pub-id pub-id-type="pmid">31350178</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vaquero</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Aoudjehane</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Fouassier</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Cancer-associated fibroblasts in cholangiocarcinoma</article-title>
        <source>Curr. Opin. Gastroenterol.</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>63</fpage>
        <lpage>69</lpage>
        <pub-id pub-id-type="doi">10.1097/MOG.0000000000000609</pub-id>
        <?supplied-pmid 31934895?>
        <pub-id pub-id-type="pmid">31934895</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luca</surname>
            <given-names>BA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Atlas of clinically distinct cell states and ecosystems across human solid tumors</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>5482</fpage>
        <lpage>5496.e28</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.09.014</pub-id>
        <?supplied-pmid 34597583?>
        <pub-id pub-id-type="pmid">34597583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Detection of differentially abundant cell subpopulations in scRNA-seq data</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2021</year>
        <volume>118</volume>
        <fpage>e2100293118</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.2100293118</pub-id>
        <?supplied-pmid 34001664?>
        <pub-id pub-id-type="pmid">34001664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yuen</surname>
            <given-names>KC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High systemic and tumor-associated IL-8 correlates with reduced clinical benefit of PD-L1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2020</year>
        <volume>26</volume>
        <fpage>693</fpage>
        <lpage>698</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-020-0860-1</pub-id>
        <?supplied-pmid 32405063?>
        <pub-id pub-id-type="pmid">32405063</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaplanov</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Blocking IL-1β reverses the immunosuppression in mouse breast cancer and synergizes with anti-PD-1 for tumor abrogation</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>1361</fpage>
        <lpage>1369</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1812266115</pub-id>
        <?supplied-pmid 30545915?>
        <pub-id pub-id-type="pmid">30545915</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duan</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Targeting macrophages in cancer immunotherapy</article-title>
        <source>Signal Transduct. Target. Ther.</source>
        <year>2021</year>
        <volume>6</volume>
        <fpage>127</fpage>
        <pub-id pub-id-type="doi">10.1038/s41392-021-00506-6</pub-id>
        <?supplied-pmid 33767177?>
        <pub-id pub-id-type="pmid">33767177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bi</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tumor and immune reprogramming during immunotherapy in advanced renal cell carcinoma</article-title>
        <source>Cancer Cell</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>649</fpage>
        <lpage>661.e5</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ccell.2021.02.015</pub-id>
        <?supplied-pmid 33711272?>
        <pub-id pub-id-type="pmid">33711272</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The role of osteopontin in the progression of solid organ tumour</article-title>
        <source>Cell Death Dis.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>356</fpage>
        <pub-id pub-id-type="doi">10.1038/s41419-018-0391-6</pub-id>
        <?supplied-pmid 29500465?>
        <pub-id pub-id-type="pmid">29500465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spivia</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Magno</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Le</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Fraser</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Complement protein C1q promotes macrophage anti-inflammatory M2-like polarization during the clearance of atherogenic lipoproteins</article-title>
        <source>Inflamm. Res.</source>
        <year>2014</year>
        <volume>63</volume>
        <fpage>885</fpage>
        <lpage>893</lpage>
        <pub-id pub-id-type="doi">10.1007/s00011-014-0762-0</pub-id>
        <?supplied-pmid 25091012?>
        <pub-id pub-id-type="pmid">25091012</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The CXCL8-CXCR1/2 pathways in cancer</article-title>
        <source>Cytokine Growth Factor Rev.</source>
        <year>2016</year>
        <volume>31</volume>
        <fpage>61</fpage>
        <lpage>71</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cytogfr.2016.08.002</pub-id>
        <?supplied-pmid 27578214?>
        <pub-id pub-id-type="pmid">27578214</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lisa: inferring transcriptional regulators through integrative modeling of public chromatin accessibility and ChIP-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>32</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1934-6</pub-id>
        <?supplied-pmid 32033573?>
        <pub-id pub-id-type="pmid">32033573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peters</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Shah</surname>
            <given-names>YM</given-names>
          </name>
          <name>
            <surname>Gonzalez</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>The role of peroxisome proliferator-activated receptors in carcinogenesis and chemoprevention</article-title>
        <source>Nat. Rev. Cancer</source>
        <year>2012</year>
        <volume>12</volume>
        <fpage>181</fpage>
        <lpage>195</lpage>
        <pub-id pub-id-type="doi">10.1038/nrc3214</pub-id>
        <?supplied-pmid 22318237?>
        <pub-id pub-id-type="pmid">22318237</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AnimalTFDB 3.0: a comprehensive resource for annotation and prediction of animal transcription factors</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D33</fpage>
        <lpage>D38</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky822</pub-id>
        <?supplied-pmid 30204897?>
        <pub-id pub-id-type="pmid">30204897</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dysfunctional CD8 T cells form a proliferative, dynamically regulated compartment within human melanoma</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <fpage>775</fpage>
        <lpage>789.e18</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.11.043</pub-id>
        <?supplied-pmid 30595452?>
        <pub-id pub-id-type="pmid">30595452</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyvärinen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Oja</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Independent component analysis: algorithms and applications</article-title>
        <source>Neural Netw.</source>
        <year>2000</year>
        <volume>13</volume>
        <fpage>411</fpage>
        <lpage>430</lpage>
        <pub-id pub-id-type="doi">10.1016/S0893-6080(00)00026-5</pub-id>
        <?supplied-pmid 10946390?>
        <pub-id pub-id-type="pmid">10946390</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping single-cell data to reference atlases by transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>121</fpage>
        <lpage>130</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01001-7</pub-id>
        <?supplied-pmid 34462589?>
        <pub-id pub-id-type="pmid">34462589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Khan</surname>
            <given-names>O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TOX transcriptionally and epigenetically programs CD8+ T cell exhaustion</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>571</volume>
        <fpage>211</fpage>
        <lpage>218</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1325-x</pub-id>
        <?supplied-pmid 31207603?>
        <pub-id pub-id-type="pmid">31207603</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ohandjo</surname>
            <given-names>AQ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome network analysis identifies CXCL13-CXCR5 signaling modules in the prostate tumor immune microenvironment</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>14963</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-46491-3</pub-id>
        <?supplied-pmid 31628349?>
        <pub-id pub-id-type="pmid">31628349</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Havenar-Daughton</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CXCL13 is a plasma biomarker of germinal center activity</article-title>
        <source>Proc. Natl. Acad. Sci. Usa.</source>
        <year>2016</year>
        <volume>113</volume>
        <fpage>2702</fpage>
        <lpage>2707</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1520112113</pub-id>
        <?supplied-pmid 26908875?>
        <pub-id pub-id-type="pmid">26908875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>D’Agostino</surname>
            <given-names>RB</given-names>
          </name>
          <name>
            <surname>Belanger</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>D’Agostino</surname>
            <given-names>RB</given-names>
          </name>
        </person-group>
        <article-title>A suggestion for using powerful and informative tests of normality</article-title>
        <source>Am. Stat.</source>
        <year>1990</year>
        <volume>44</volume>
        <fpage>316</fpage>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>LG</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>QY</given-names>
          </name>
        </person-group>
        <article-title>ClusterProfiler: an R package for comparing biological themes among gene clusters</article-title>
        <source>Omi. A J. Integr. Biol.</source>
        <year>2012</year>
        <volume>16</volume>
        <fpage>284</fpage>
        <lpage>287</lpage>
        <pub-id pub-id-type="doi">10.1089/omi.2011.0118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kotliar</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identifying gene expression programs of cell-type identity and cellular activity with single-cell RNA-Seq</article-title>
        <source>Elife</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>1</fpage>
        <lpage>26</lpage>
        <pub-id pub-id-type="doi">10.7554/eLife.43803</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10164163</article-id>
    <article-id pub-id-type="pmid">37149682</article-id>
    <article-id pub-id-type="publisher-id">38333</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-38333-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MetaTiME integrates single-cell gene expression to characterize the meta-components of the tumor immune microenvironment</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7453-6188</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Yi</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1328-7197</contrib-id>
        <name>
          <surname>Xiang</surname>
          <given-names>Guanjue</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jiang</surname>
          <given-names>Alva Yijia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lynch</surname>
          <given-names>Allen</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zeng</surname>
          <given-names>Zexian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7573-3768</contrib-id>
        <name>
          <surname>Wang</surname>
          <given-names>Chenfei</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Wubing</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2440-2015</contrib-id>
        <name>
          <surname>Fan</surname>
          <given-names>Jingyu</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kang</surname>
          <given-names>Jiajinlong</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gu</surname>
          <given-names>Shengqing Stan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wan</surname>
          <given-names>Changxin</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Boning</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Liu</surname>
          <given-names>X. Shirley</given-names>
        </name>
        <address>
          <email>xsliu.res@gmail.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8213-1658</contrib-id>
        <name>
          <surname>Brown</surname>
          <given-names>Myles</given-names>
        </name>
        <address>
          <email>myles_brown@dfci.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8321-2839</contrib-id>
        <name>
          <surname>Meyer</surname>
          <given-names>Clifford A.</given-names>
        </name>
        <address>
          <email>cliff_meyer@ds.dfci.harvard.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Department of Data Science, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution>Department of Biostatistics, </institution><institution>Harvard T.H. Chan School of Public Health, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Department of Medical Oncology, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA 02215 USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Center for Functional Cancer Epigenetics, </institution><institution>Dana-Farber Cancer Institute, </institution></institution-wrap>Boston, MA USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>6</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>6</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>2634</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>26</day>
        <month>4</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Recent advances in single-cell RNA sequencing have shown heterogeneous cell types and gene expression states in the non-cancerous cells in tumors. The integration of multiple scRNA-seq datasets across tumors can indicate common cell types and states in the tumor microenvironment (TME). We develop a data driven framework, MetaTiME, to overcome the limitations in resolution and consistency that result from manual labelling using known gene markers. Using millions of TME single cells, MetaTiME learns meta-components that encode independent components of gene expression observed across cancer types. The meta-components are biologically interpretable as cell types, cell states, and signaling activities. By projecting onto the MetaTiME space, we provide a tool to annotate cell states and signature continuums for TME scRNA-seq data. Leveraging epigenetics data, MetaTiME reveals critical transcriptional regulators for the cell states. Overall, MetaTiME learns data-driven meta-components that depict cellular states and gene regulators for tumor immunity and cancer immunotherapy.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Integration and comparison of multiple single cell sequencing datasets can be used to compare different studies. Here the authors propose MetaTiME which compares the gene expression of single cells from the tumour microenvironment across different tumours and uses transportable labels and metacomponents to annotate cell types and states.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Data integration</kwd>
      <kwd>Software</kwd>
      <kwd>Classification and taxonomy</kwd>
      <kwd>Tumour immunology</kwd>
      <kwd>Cancer microenvironment</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000054</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>P01CA163222</award-id>
        <award-id>R01HG011139</award-id>
        <award-id>U24CA237617</award-id>
        <principal-award-recipient>
          <name>
            <surname>Meyer</surname>
            <given-names>Clifford A.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Recent advances in cancer research have implicated the integral function of the tumor microenvironment (TME) in tumor progression and therapy responses<sup><xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup>. Understanding interactions between cancer cells and the non-cancer compartments, including immune cells, fibroblasts, and endothelial cells, has shown potential targets for cancer immunotherapy. Specifically, single-cell RNA-sequencing (scRNA-Seq) applied on multiple patient tumors has enabled the high-resolution identification of TME constituents that interfere with the elimination of cancer cells. For example, exhausted tumor-infiltrating lymphocytes (TILs)<sup><xref ref-type="bibr" rid="CR4">4</xref>,<xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>, and certain tumor-associated macrophages subtypes<sup><xref ref-type="bibr" rid="CR9">9</xref>–<xref ref-type="bibr" rid="CR11">11</xref></sup>, have been associated with tumor development. However, the definition of cell types and cell states in tumor scRNA analyses still relies on manual labeling by experts using known exclusive biomarkers following unsupervised clustering<sup><xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR13">13</xref></sup>, which lacks consistency and varies between different cohorts.</p>
    <p id="Par4">As single-cell data accumulate, integrating a large collection of cells from multiple cohorts can help unify the definition of cell types and states to facilitate the automatic annotation of new scRNA-seq data<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref></sup>. One approach to cell annotation is to use predefined biomarker lists. However, these biomarkers might not cover domain-specific cellular states, for example, well-defined immune cell markers derived from blood immune cells may not fully cover the TME disease context<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>. Moreover, although cell type definitions in reference databases such as CIBERSORT, Azimuth, and Human Primary Cell Atlas<sup><xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR18">18</xref></sup> can be useful, the granularity of these definitions varies between databases. Several efforts integrating pan-cancer scRNA data have revealed subtypes in the TME through the manual annotation of clusters using a shortlist of exclusive gene markers<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR19">19</xref>,<xref ref-type="bibr" rid="CR20">20</xref></sup>.</p>
    <p id="Par5">Another approach is to map a dataset containing unannotated cell states onto an annotated reference. Methods to obtain such representations include canonical correlation analysis (CCA)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, adjusted principal components (Harmony)<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, or generative deep learning models using variational autoencoders (scVI)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. These methods use dimension reduction onto a common latent space to align cells with similar states between datasets, without ascribing meaning to the latent space representations. An alternative data driven approach is to identify low dimensional latent space representations in which a biological meaning can be ascribed to each latent dimension. Several matrix factorization algorithms have been developed to represent high dimensional data in a low-dimensional space with interpretable components, including non-negative matrix factorization (NMF)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and independent component analysis (ICA)<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup>.</p>
    <p id="Par6">Here we develop a computational framework for mapping millions of single cells from multiple cohorts onto a comprehensive and interpretable latent space, learnt from the data. The framework, MetaTiME (Meta-components of the Tumor immune MicroEnvironment), identifies reproducible low-dimensional meta-components that reflect independent components of gene expression variation across cohorts and cancer types. MetaTiME adopts ICA for dimensional reduction to maximize the mutual independence among components. We use MetaTiME to obtain meta-components (MeCs) from 1.7 million single cells across 79 tumor datasets. These MeCs represent the TME landscape along 86 data-driven transcriptional directions mirroring lineage-specific cell states and signaling activities. Furthermore, we develop a MetaTiME toolkit for using the MeCs to annotate cellular states and signature continuums in tumor scRNA datasets, and to reveal differential signatures across immunotherapy responses. Finally, by incorporating transcription factor binding data, MetaTiME identifies and prioritizes putative transcriptional regulators that may modulate tumor immunity.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>MetaTiME as a general framework to discover consensus transcriptomic programs</title>
      <p id="Par7">The MetaTiME framework consists of three stages: meta-component (MeC) discovery, interpretation of MeCs, and application of cell state annotations (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). The MeC discovery stage detects repeatable sources of variation from multiple single-cell measurements sharing similar cellular properties. The MeC interpretation step involves a one-time curation effort using biomarker databases, pathway information and Cistrome DB chromatin profiling data<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. In the third step, users map MeCs onto their new tumor scRNA-seq datasets using MetaTiME application tools, to obtain annotated cell states and signature continuums.<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of MetaTiME.</title><p>MetaTiME integrates 1.7 million single cells to learn common transcriptional programs in the tumor microenvironment (TME). <bold>a</bold> Steps for Meta-components (MeCs) discovery. For each scRNA dataset, the expression matrix of TME cells is decomposed into a loading matrix (red) and an independent component (IC) matrix through independent component analysis (ICA). The ICs represent mutually independent sources of transcriptional variation. ICs from each dataset are concatenated and clustered into groups of ICs with high similarity, representing transcriptional programs shared across TME. MeCs are then calculated as averaged profiles of ICs from each cluster. Each MeC is interpretable, representing gene signatures of cell type, cell states, or signaling pathway activities. <bold>b</bold> Left: MetaTiME provides 86 functionally annotated MeCs that depict the TME transcriptional landscape. They are grouped into six lineage-related categories and one category reflecting signaling activities, each using a background color corresponding to the lineage. Middle: the MetaTiME annotation tool facilitates automatic annotation of cell states for new tumor scRNA data. Right: candidate regulators of each MeC are prioritized by combining MeC gene weights with epigenetics data. MeC: meta-components, TME: tumor microenvironment, ICA: independent component analysis, MeC: meta-component, TF: transcription factor.</p></caption><graphic xlink:href="41467_2023_38333_Fig1_HTML" id="d32e506"/></fig></p>
      <p id="Par8">To train MeCs for the TME context, we collected and curated 2,157,387 cells from 76 studies ranging across 27 cancer types, using publicly available tumor scRNA-Seq data mostly from TISCH<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. After removing the TISCH annotated malignant cells using MAESTRO<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, 102,703 stromal cells and 1,617,110 immune cells were retained for downstream training (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1</xref>, Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref>). The 76 studies were further partitioned according to cancer type, resulting in 93 datasets, including 7 datasets with immune checkpoint blockade (ICB) treatment and 3 10x Genomics provided datasets representing peripheral blood mononuclear cells (PBMC) sampled from healthy donors.</p>
      <p id="Par9">In the MeC discovery stage, MetaTiME first decomposes the log-transformed expression matrix of each single dataset using Independent Component Analysis (ICA)<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>. We adopted ICA to maximize mutual independence among gene expression components. In simulations ICA performed slightly better than Non-negative Matrix Factorization (NMF) in simulated single-cell data with pre-embedded transcriptional signatures (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). The feature weight distribution of each Independent Component (IC) also enables normalization of the gene contribution scores for measuring similarity among components. MetaTiME then applies two transformations to the IC vectors, <italic>z</italic>-weight normalization and skewness alignment, to ensure the scales of gene representation scores are comparable among components (<bold>Methods</bold>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a</xref>). Next, MetaTiME filters ICs to retain ones that are reproducible across multiple cohorts (the minimum Pearson correlation with any other IC ≥3). These are passed to the Louvain graph clustering algorithm to merge IC groups into MeCs (<bold>Methods</bold>). Lastly, MetaTiME computes averaged profiles of gene <italic>z</italic>-weights within each IC cluster, yielding 86 MeCs trained for the TME (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>, Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). The number of MeCs was automatically determined by simultaneously optimizing granularity and independence in IC clustering (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3b</xref>). Importantly, the MeC clustering does not depend on cohort source (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a</xref>, cohort source of component), and is robust during leave-one-out testing in which the MeCs are learnt with a single cohort left out of the analysis (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>). The leave-one-out MeCs are highly correlated with the MeCs learnt on the complete data (mean maximum correlation = 0.988), and the numbers of components are similar (mean leave-one-out MeC number = 84.64, full-set MeC number = 86). This integration after decomposition approach overcomes batch effects, which are often a challenge in single cell RNA-seq data analysis. Moreover, we implemented the standard approach in which cluster-wise signatures are obtained by batch effect removal, clustering, and differential expression analysis (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>). Limited by server computing memory, the maximum number of datasets we could integrate in this way was 21, and the cluster-wise signatures display a lower level of specificity in the test data (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b,c</xref>). Therefore, the MetaTiME approach allows for the effective integration of large numbers of single cell datasets, which will become increasingly important as data accumulates.<fig id="Fig2"><label>Fig. 2</label><caption><title>MetaTiME meta-components are biologically interpretable with top genes.</title><p><bold>a</bold> Heatmap of top ten most recurrent clusters of MeCs showing normalized gene weights. <bold>b</bold> Biological characterization of each MeC with top genes. To facilitate biological interpretation, MeCs are categorized into six lineage-associated classes (B cells, T cells for CD4T, CD8T and NK cells, dendritic cells, monocyte and macrophages, other myeloid cell types, and stroma cells) and one signaling pathway-associated class. <bold>c</bold> Examples of T cell related MeCs with top 20 genes with largest weights. <bold>d</bold> Gene contribution of known lineage-related biomarkers for each MeC, and correlation with known immune markers from Azimuth. In the top dot plot, size and color represents log-scaled MeC <italic>z</italic>-weights of each gene in each MeC. In the bottom dot plot, size and color represents the maximum correlation coefficient between MeC and Azimuth defined marker genes per cell type. MeC meta-component, DC dendritic cell, Mono/Mac monocytes and macrophages. Each MeC and gene is shaded with a background color corresponding to the lineage category. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig2_HTML" id="d32e594"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>MetaTiME defines interpretable meta-components</title>
      <p id="Par10">In principle, each MeC represents one independent source of transcriptional variation commonly present in the TME. We investigated top ranked genes in MeCs and found MeCs are highly interpretable, reflecting common biological processes in the TME. For instance, the MeC derived from the largest IC cluster is highly enriched in interferon response genes, such as <italic>ISG15</italic>, <italic>IFI6</italic>, <italic>LY6E</italic>, and <italic>MX1</italic>, indicating that the underlying interferon response is among the most common source of transcriptional variation shared across tumor samples and cohorts (Fig. <xref rid="Fig2" ref-type="fig">2a, b</xref>). Intriguingly, top genes of each MeC are enriched in known biomarkers or regulators. For example, several T cell-related MeCs identify different gene modules co-expressed in T cells reflecting activation of different T-cell related processes (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>, Source Data <xref rid="MOESM8" ref-type="media">1</xref>). MeC-65, T cell co-signaling, features T cell receptors in co-stimulatory and co-inhibitory pathways<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup>, such as <italic>TNFRSF4</italic> (OX40), <italic>TNFRSF18</italic> (GITR) <italic>TNFRSF9</italic> (4-1BB), and <italic>ICOS</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, left). MeC-40, CXCL13 + exhausted CD8 T cell, features receptors characterizing the exhausted CD8 T cell state<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, including <italic>HAVCR2</italic> (TIM3), <italic>LAG3</italic>, <italic>TIGIT</italic>, and <italic>PDCD1</italic> (PD1) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>, Source Data <xref rid="MOESM8" ref-type="media">2</xref>), each being potential ICB targets<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. In addition, this MeC is characterized by a high level of <italic>CXCL13</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, second panel), a cytokine mediating immune cell trafficking to tertiary lymphoid structures<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. In contrast, a related MeC representing T cell co-signaling receptors in regulatory CD4T cells (Treg) has a different ranking, including <italic>TNFRSF18</italic>, <italic>TNFRSF4</italic>, <italic>TIGIT, TNFRSF1B</italic>, <italic>CTLA4</italic>, <italic>CD27</italic> among the top 20 genes, along with the regulatory T cell-specific marker <italic>FOXP3</italic> (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>, right, Source Data <xref rid="MOESM8" ref-type="media">1</xref>). Though ICB has been an extremely successful therapy for some patients, it has not yet had an impact on the majority of patients<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. Investigating the top members in the MeCs involving T cell receptor pathways may help identify new ICB targets.</p>
    </sec>
    <sec id="Sec5">
      <title>MetaTiME depicts the functional landscape of transcriptomic variation and cell states in the tumor microenvironment</title>
      <p id="Par11">We provided functional annotations of all MeCs by examining top <italic>z</italic>-weight genes and compared these with functional gene sets, such as immune cell type markers<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR18">18</xref></sup> and gene ontology databases<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. We found that 86 MeCs clearly mirror gene expression patterns corresponding to cell types, cell states and signaling pathway activities, depicting a landscape of non-cancer cell states in the TME (Fig. <xref rid="Fig2" ref-type="fig">2</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC annotation). The top genes of the cell type MeCs match well-known lineage-specific markers<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR18">18</xref></sup>. Examples include <italic>CD74</italic>, <italic>CD79A</italic>, <italic>MS4A1</italic> for B cells (MeC-18, B cell), <italic>CD3D</italic>, <italic>CD8A</italic>, <italic>CD8B</italic> for T cells (MeC-32, <italic>CD3</italic> + CD8 T cell), and <italic>LYZ</italic>, <italic>VCAN</italic>, <italic>S100A9</italic> for CD14 + Monocytes (MeC-17, CD14 monocyte) (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Fig. <xref rid="Fig2" ref-type="fig">2d</xref>, Source Data <xref rid="MOESM8" ref-type="media">3</xref>). The majority of MeCs define high resolution lineage-specific cell states (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>). Taking the B cell lineage as an example, multiple MeCs harbor genes specific to B cell developmental stages<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>, ranging from a progenitor B cell state (<italic>CD69</italic> and <italic>PAX5</italic> in MeC-50, <italic>PAX5</italic> B cell), to a mature B cell state (<italic>CD79A</italic> in MeC-18, B cell), an antibody-secreting plasma cell state (<italic>XBP1</italic> in MeC-4, plasma B cell; <italic>JCHAIN</italic> in MeC-77, <italic>JCHAIN</italic> + plasma B cell), and immunoglobulin secretion states (IGK and IGH in MeC-30, immunoglobin kappa B cell; IGL and IGH in MeC-50, immunoglobin lambda B cell) (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). Lastly, like the interferon responsive MeC mentioned above, we found a subset of MeCs that are more accurately interpreted as signaling pathways because their top genes are more related to pathways or molecular functions than to cell identities.</p>
      <p id="Par12">We organized the 86 annotated MeCs into six cell lineage-focused categories and one signaling pathway-focused category (Fig. <xref rid="Fig2" ref-type="fig">2a,b</xref> and Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC annotation, MeC enrichment). Among these, there are 6 B lineage-related MeCs for B cells; 20 T cell lineage MeCs covering CD8 T cells, CD4 T cells, and natural killer (NK) cells; 4 dendritic cell (DC) lineage MeCs; 12 monocyte and macrophage-related MeCs; 3 platelet, erythrocyte, and mast cell MeCs; 6 stromal cell-related MeCs for fibroblasts, myofibroblasts and endothelial cells; and 35 MeCs in the signaling category (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). We demonstrated that the MeCs are of high specificity, visualizing the log-scaled <italic>z</italic>-weights of known cell subtype markers and pathway biomarkers (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). Correlating MeCs with the comprehensive immune cell type database Azimuth<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> validated the lineage-specificity of several MeCs, while most MeCs reflect cell states that appear specific to the tumor context (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4b</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>MetaTiME annotates cell states and signature continuums when applied to the tumor microenvironment single-cell data</title>
      <p id="Par13">As MetaTiME MeCs provides a highly interpretable basis for the TME in single cells, we provided a toolkit to discover MeC signature continuums and enriched cell states in scRNA-seq TME data (code deposited in <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>). The MetaTiME annotation toolkit takes as input the scRNA-seq expression matrix after depth normalization and log transformation, maps each single cell onto the pre-trained MeC space, and annotates the most highly enriched cell states for pre-defined cell clusters. The cell clusters are by default calculated using graph clustering with high resolution after an optional batch effect correction with Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. We demonstrate the application of MetaTiME on basal cell carcinoma (BCC) single-cells from Yost et al.<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. These test cells were excluded from the MetaTiME training stage. MetaTiME annotates the enriched cell states (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>) highlighting gradients of exhausted CD8 T cells and follicular helper T cells (Tfh) (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>). The most enriched cell states consistently match the manual labelling from the original study with improved resolution (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>) and highly express corresponding markers (Fig. <xref rid="Fig3" ref-type="fig">3d</xref>, Source Data <xref rid="MOESM8" ref-type="media">4</xref>). In addition, compared to Seurat’s<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> automated CIBERSORT marker-based annotations (14 cell types, Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref>), MetaTiME provides higher resolution (38 cell states, Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). Other automatic annotation gene panels were also tested, including the human primary cell atlas (HPCA) panel and Blueprint-ENCODE panel used in SingleR<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, where macrophages and plasma cells appear to be mislabeled as subclusters within T cell clusters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8b, c</xref>). Interestingly, the MetaTiME annotation not only indicates the CD8 T cell and CD4 T cell subtypes, but also splits cells further into cell states with polarized expression in proliferation, cytotoxicity, exhaustion level, heat stress, co-signaling pathways, and so on. (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8a</xref>). The B cell group is further partitioned into distinct B cell developmental states including a B cell cluster with cell cycle and MYC activities (Fig. <xref rid="Fig3" ref-type="fig">3a,b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>), which possibly represent germinal center (GC) B cells undergoing active expansion and maturation<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>.<fig id="Fig3"><label>Fig. 3</label><caption><title>MetaTiME annotates cell states with high resolution on tumor microenvironment single-cell data.</title><p><bold>a</bold> MetaTiME cell state annotation of cell clusters in a basal cell carcinoma scRNA dataset based on top enriched MeCs. <bold>b</bold> Manual annotation labels by experts from the original study shown on the same UMAP space. <bold>c</bold> Signature continuums of four MeCs representing the mature dendritic cell state, the CXCL13-secreting exhausted T cell state, the CXCL13-secreting T follicular helper cell state, and the IL1B pathway-activated macrophage state. <bold>d</bold> Marker gene expression for each annotated cell cluster as in (<bold>a</bold>)<bold>. e</bold> Bar plot showing cell state composition of tumor microenvironment for tumor scRNA dataset cell states. The proportion of cell states from the same MeC category are aggregated. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig3_HTML" id="d32e946"/></fig></p>
      <p id="Par14">We thus re-annotated all tumor scRNA cohorts using MetaTiME and investigated the distribution of cell state compositions across cancer cohorts. As shown in Fig. <xref rid="Fig3" ref-type="fig">3e</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">9</xref>, tumors are highly heterogenous and the TME cellular composition is only partially determined by cancer type (Source Data <xref rid="MOESM8" ref-type="media">5</xref>–<xref rid="MOESM8" ref-type="media">6</xref>). For example, Cholangiocarcinoma (CHOL) is highly enriched in stromal cells including collagen-secreting fibroblast, as expected<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, while other samples including ovarian cancer (OV), pancreatic adenocarcinoma (PAAD), and multiple myeloma (MM) are also stromal-rich. Furthermore, tumors with high infiltration of the MeC-12, <italic>GZMK</italic> + <italic>CCL5</italic> + CD8 T cell state, include multiple tumor types including bladder cancer, breast cancer, and skin cancer, suggesting that immune infiltration is sample-dependent and that cancer treatments should be personalized<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>.</p>
    </sec>
    <sec id="Sec7">
      <title>Differential MetaTiME analysis detects alterations of transcriptional programs in immunotherapy</title>
      <p id="Par15">Single-cell data derived from ICB trials is invaluable for identifying cell types associated with ICB treatment or response<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. However, the detection of differential cell type abundances in ICB cohorts has been challenging due to the heterogeneity of cell type proportions and to the limited numbers of patients in each cohort<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>. We compared differences in MeC signatures instead of cell count proportions, to understand immune responses during ICB. We analyzed two ICB cohorts, a basal cell carcinoma (BCC) cohort with samples from pre- or post-ICB treatment<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, and a bladder cancer (BLCA) cohort with samples from ICB responders and non-responders<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>. We applied MetaTiME for per-cluster cell state annotation and per-cell MeC signature evaluation. For each cell state cluster, we tested all MeC signatures passing significance (average <italic>z</italic>-weight ≥2) between conditions using the two-sided t-test. We plotted cluster-wise signatures in the significance – effect size scatterplot to highlight the most significant differential MeCs (<bold>Methods</bold>). In a comparison of pre- and post-ICB treatment, we observed higher expression of cytotoxic T cell and B cell MeCs in the post-ICB samples. Moreover, several monocyte and macrophage states are also suppressed after ICB treatment (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, Source Data <xref rid="MOESM8" ref-type="media">7</xref>). Notably, the <italic>IL1B</italic>-positive macrophage signature is also found to be elevated in non-responders compared to responders in the BLCA ICB cohort (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>, Source Data <xref rid="MOESM8" ref-type="media">8</xref>). Since activation of the IL1B pathway is a known regulator of inflammatory processes<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>, we sought to investigate whether the <italic>IL1B</italic>-positive macrophage signature is associated with tumor survival prognosis in bulk RNA-seq data from The Cancer Genome Atlas Program (TCGA). We evaluated TCGA tumors using the averaged expression of the top 20 genes from MeC-42, M_Macrophage-IL1-NFKB, which ranks first in elevated MeCs in non-responders (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). We found that higher expression of the <italic>IL1B</italic> signature is associated with lower survival rate in multiple cancer types, especially in Low Grade Glioma (LGG) and in Kidney renal cell carcinoma (KIRC) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">10</xref>). This suggests the macrophage state with IL1B pathway activation is associated with poor prognosis and lower ICB efficacy.<fig id="Fig4"><label>Fig. 4</label><caption><title>Differential signature analysis and delineated macrophage states in TME.</title><p><bold>a</bold> Differential MeC signature testing for enriched cell states comparing pre- and post- immunotherapy conditions in basal cell carcinoma (BCC) with two-sided <italic>t</italic>-test. <italic>X</italic>-axis: Difference of mean signature scores between post- and pre-immunotherapy conditions. <italic>Y</italic>-axis: -log(p-value) from two-sided <italic>t</italic>-test. The significant cluster-wise differential signature is marked as “EnrichedMeC@ClusterName”; when the enriched MeC is the same as cluster name, the signature is marked “ClusterName”. Red dots, differentially increased signature; size of the dots is proportionally to the mean signature score of cells from the post-immunotherapy condition in the cluster. Blue dots, differentially repressed signature; size of the dots is proportionally to the mean signature score of cells from the pre-immunotherapy condition in the cluster. <bold>b</bold> Differential signature testing for enriched cell states comparing non-responders and responders from pre-treatment condition in bladder carcinoma (BLCA) with two-sided <italic>t</italic>-test. Red dots, differentially increased signature; size of the dots is proportionally to the mean signature score of cells from the responder condition in the cluster. Blue dots, differentially repressed signature; size of the dots is proportionally to the mean signature score of cells from the non-responder condition in the cluster. <bold>c</bold> Model of monocytes and macrophage states in tumor and their metabolic differences. <bold>d</bold> Top pathways enriched in different macrophage MeCs, with adjusted hypergeometric tested <italic>p</italic>-value from Enrichr. BCC basal cell carcinoma, BLCA bladder carcinoma. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig4_HTML" id="d32e1076"/></fig></p>
    </sec>
    <sec id="Sec8">
      <title>MetaTiME delineates myeloid cells in different metabolic states</title>
      <p id="Par16">As specific myeloid cell states have been associated with cancer survival and treatment response, we sought to systematically characterize MeCs related to monocytes and macrophages. Although the canonical definition of M1 and M2 macrophages is derived from cytokine polarized macrophages in vitro<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>, MetaTiME’s myeloid-related MeCs represent a more complex framework for understanding tumor-infiltrating macrophages. MetaTiME’s 12 monocyte and macrophage related MeCs can be summarized into six central monocyte or macrophage states for the TME, after merging similar states such as MeC-42, IL1-NFkB Macrophage and MeC-45, IL1- JUN Macrophage, due to similarity among top genes (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). Monocytes are classified as two categories, CD14 + and CD16 + . For macrophages, four MeCs define common states of intra-tumor macrophages: <italic>C1Q</italic> + , SPP<italic>1</italic> + , lipid-rich, and <italic>IL1B</italic> + macrophages, and two MeCs, representing interferon and MHC-II signaling pathways, are less frequently observed among macrophages (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). In comparison, previous studies defined different tumor associated macrophages in terms of manually selected representative genes after clustering myeloid cells. For example, Cheng et al.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> defined several tumor associated macrophage types including <italic>ISG15</italic> + , SPP<italic>1</italic> + , <italic>INHBA</italic> + , <italic>VCAN</italic> + , <italic>NLRP3</italic> + , and <italic>FN1</italic> + macrophages, while Bi et al.<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> defined <italic>CXCL10</italic>-high, <italic>GPNMB</italic>-high, <italic>FOLR2</italic>-high, <italic>VSIR</italic>-high, and cycling macrophages for advanced renal cell carcinoma (ccRCC). We find that the MetaTiME-defined macrophage MeCs reflect co-expression relationships with the selected marker genes. For example, macrophage markers from Bi et al. rank high in several macrophage-related MeCs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11</xref>), and the expression pattern of the marker genes picked by Bi et al. (<italic>CXCL10</italic>, <italic>GPNMB</italic>, <italic>VSIR</italic>, <italic>FOLR2</italic>, Cycling marker <italic>MKI67</italic>) correspond to several MeCs (MeC-0, interferon response; MeC-37, <italic>PPARG</italic> + lipid-rich macrophage; MeC-58, MHCII-high, and MeC-49, <italic>RNASE1</italic> + , <italic>C1Q</italic> + macrophage) (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11</xref>). However, MetaTiME reveals additional distinct components such as the SPP<italic>1</italic> + and <italic>C1Q</italic> + MeCs, which were detected as separate myeloid types in the Cheng et al. multi-cohort study (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12</xref>). While the manual reconciliation of cell types from multi-cohort scRNA data shows many marker genes to be consistent with the top genes in the MetaTiME MeCs, the myeloid cell population is not neatly partitioned into cell clusters and might be better represented in terms of expression signature continuums. For example, when mapping myeloid MeCs onto the kidney myeloid cells, the <italic>IL1B</italic> + MeC signature (MeC-42, MeC-45) is distributed across the M09_Macro_IL1B cluster as well as the CD14 monocyte cluster (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12</xref>).</p>
      <p id="Par17">To investigate functional differences among the different macrophage states, we applied gene set enrichment (GSEA)<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> analysis using the top MeC genes (<bold>Methods</bold>). Interestingly, the different macrophage states have different metabolic preferences (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>, Source Data <xref rid="MOESM8" ref-type="media">9</xref>). Glucose metabolism and the glycosylation pathway are highly active in SPP<italic>1</italic> + macrophages, while lysosome and phagosome activity are the most highly enriched in <italic>C1Q</italic> + macrophages. Lysosome and cholesterol metabolism, including PPARG signaling, are enriched in the lipid-rich state. The inflammatory IL1B and NFkB pathways are highly active in <italic>IL1B</italic> + macrophages. Several macrophage states are related to cell signaling. SPP<italic>1</italic> for example, encodes Osteopontin, which has been found to foster an environment that promotes cancer metastasis<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>. The <italic>C1Q</italic> + MeC features <italic>C1QA</italic>, <italic>C1QB</italic>, and <italic>C1QC</italic>, members of the family of complement molecules that could have dual functions in chronic inflammation<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. The <italic>IL1B</italic> + meta-components features cytokines co-expressed with <italic>IL1B</italic>, including <italic>CXCL8</italic>, <italic>CXCL2</italic>, and <italic>CXCL3</italic>, all of which can interact with other cells in the TME by binding to cytokine receptors<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).</p>
    </sec>
    <sec id="Sec9">
      <title>Incorporation of epigenetic data prioritizes transcriptional regulators of tumor immunity</title>
      <p id="Par18">We next investigated the transcription factors (TFs) that regulate the MeCs, hypothesizing that the co-expression of genes in a subset of MeCs is determined through TF regulatory events. Our group previously developed the Cistrome Data Browser and Lisa to predict transcriptional regulators of gene sets based on chromatin immunoprecipitation with sequencing (ChIP-seq) data<sup><xref ref-type="bibr" rid="CR27">27</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>. Thus, we used Lisa to predict the TFs that regulate the top genes of each MeC, and compared these Lisa regulatory prediction scores with the MeC <italic>z</italic>-weights across TFs (Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>). We found that, for many MeCs, the same TFs were predicted to be both regulators of the MeC and were highly expressed in the MeC itself, indicating an autoregulatory control scheme. Often, however, TFs that were predicted by Lisa to be MeC regulators were not represented by high MeC <italic>z</italic>-weights, and TFs with high MeC <italic>z</italic>-weight were not always found to have high Lisa scores (Fig. <xref rid="Fig5" ref-type="fig">5</xref>, Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>: MeC regulators). TFs predicted by Lisa but not represented by high MeC <italic>z</italic>-weight could be the result of TF activities being regulated through non-transcriptional mechanisms<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> or multiple TFs in a family having similar binding patterns but only a subset being the regulators<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. TFs that have high MeC <italic>z</italic>-weights but low Lisa scores are most likely not well represented in the relevant cell types in available ChIP-seq data. In MeC-0, interferon response, <italic>STAT1</italic> is highly represented in the MeC <italic>z</italic>-weight and Lisa ranks <italic>STAT1</italic> as the top regulator, consistent with <italic>STAT1</italic> being known as the master regulator of the interferon response (Fig. <xref rid="Fig5" ref-type="fig">5a</xref>). Several lineage-defining TFs display the autoregulatory pattern, including <italic>TCF4</italic> in plasmacytoid dendritic cells (pDC) (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>) and <italic>XBP1</italic> in B plasma cells (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref><bold>:</bold> MeC regulators<bold>)</bold>. The macrophage related MeCs are regulated by myeloid lineage TFs like CEBPB, and TFs related to immune stimulus responses, including NFkB complex TFs. In MeC-37, lipid-rich macrophage, although PPARG ranks among the top Lisa-predicted regulators (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>), <italic>PPARG</italic> expression is not highly represented as a MeC <italic>z</italic>-weight. In this MeC, the top co-expressed genes are indeed enriched in the PPARG signaling pathway (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>); this result can be accounted for by PPARG being regulated through its ligands, which include a variety of lipophilic acids<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>.<fig id="Fig5"><label>Fig. 5</label><caption><title>MetaTiME prioritizes tumor immunity transcriptional regulators.</title><p>For selected MeCs, TFs are prioritized by their MeC expression representation and Lisa, ChIP-seq based, regulatory potentials. <italic>X</italic>-axis: gene <italic>z</italic>-weight of the TF for the current MeC. <italic>Y</italic>-axis: Lisa-based regulatory potential significance for top genes in the current MeC. Orange factors: MeC regulators prioritized based on both MeC gene weights and Lisa regulatory potential significance. Green factors: TFs highly weighted in MeCs and not in Lisa analysis. Blue factors: TFs with high Lisa regulatory potential and not highly weighted in MeCs. <bold>a</bold> TFs prioritized for three MeCs in the signaling category. <bold>b</bold> TFs prioritized for three MeCs in the dendritic cell category. <bold>c</bold> TFs prioritized for three MeCs representing different macrophage states. <bold>d</bold> TFs prioritized for three MeCs representing different T cell states. TF transcription factor, MeC meta-component. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_38333_Fig5_HTML" id="d32e1392"/></fig></p>
      <p id="Par19">We found glucocorticoid receptor (GR) signaling to be implicated in the regulation of MeC-20, <italic>CXCL13</italic> + Tfh, with GR being most highly ranked TF in both MeC and Lisa scores (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Top genes in MeC-20, <italic>CXCL13</italic> + Tfh, include several direct target genes of GR, including <italic>SRGN</italic> and <italic>FKBP5</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13b</xref>). We investigated whether the <italic>CXCL13</italic> cytokine itself could be a direct target of GR in <italic>CXCL13</italic> secreting Tfh cells. Since GR ChIP-seq data is not available for the exact Tfh cell state, we collected GR ChIP-seq data from several other cell types. Direct binding of GR is observed at the <italic>CXCL13</italic> gene promoter and nearby the gene locus at putative enhancers, which are conserved across multiple cell lines (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13a</xref>), including the B cell line Nalm6, the monocyte cell line THP1, and cancer cell lines. Moreover, in another CXCL13 secreting cell state, MeC-40, <italic>CXCL13</italic> + exhausted CD8 T cell, GR is also highly ranked in both Lisa and MeC scores (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>). Thus, we hypothesize that GR is likely to be a transcriptional driver of the CXCL13-secreting cell states in exhausted CD8 T cells<sup><xref ref-type="bibr" rid="CR50">50</xref></sup> as well as in CD4 T follicular helper T cells. Thus, the GR pathway could be a candidate target in tumor immunity modulation.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par20">We developed the MetaTiME (Meta-components of the tumor immune Microenvironment) framework and performed a large-scale and pan-cancer integration of tumor single cell datasets using ICA to optimize information independence among components<sup><xref ref-type="bibr" rid="CR51">51</xref></sup>. We identified 86 interpretable meta-components (MeCs) that describe common aspects of TME gene expression variation across multiple tumors.</p>
    <p id="Par21">The MetaTiME MeCs serve as comprehensive transcriptional signatures that depict a functional landscape of TME transcriptional programs and cell states. For monocytes and macrophages, the related MeCs showed heterogeneity and plasticity of tumor-associated macrophages (TAMs). We thus propose that TAMs, especially for solid tumors, should be classified based on the major states with different metabolic preferences instead of the canonical M1 and M2 classification<sup><xref ref-type="bibr" rid="CR42">42</xref></sup>. Similar states that do not fit well into the M1 versus M2 classification scheme were also observed in previous studies analyzing myeloid cells in the TME, where single cells were clustered and labeled using differential markers<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR12">12</xref>,<xref ref-type="bibr" rid="CR43">43</xref></sup>. Cheng et al.<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> defined several TAM types by clustering myeloid cells separately for each study and naming the TAMs with manually selected top marker, chosen based on consistency across cohorts. Similarly, Bi et al.<sup><xref ref-type="bibr" rid="CR43">43</xref></sup> defined TAM types by harmonizing patients and naming the TAMs with top genes in each cluster for an advanced renal cell carcinoma (ccRCC) cohort. Cell type definitions in the previous studies were based on representative genes, which were chosen differently in the respective studies. We propose that the MetaTiME derived monocyte and macrophage MeCs could be used to define macrophage states and functional co-expressed gene modules more consistently for the TME. Reexamining the marker genes from the previous studies: <italic>NLRP3</italic> is highly ranked in MeC-42, <italic>IL1B</italic> + macrophage; in fact, the NLRP3 inflammasome mediates interleukin-1β production. <italic>GPNMB</italic> is weighted among the top 20 genes in both MeC-19, Macrophage-C1Q and MeC-26, Macrophage-SPP1; it encodes a membrane glycoprotein which is typically highly expressed in macrophages. <italic>FOLR2</italic> is ranked 29th in MeC-19, Macrophage-C1Q, indicating this macrophage state also encodes a high folate-activated pathway. Finally, MeC-36, Macrophage-SPP1-C1Q, features an intermediate state with both SPP<italic>1</italic> and <italic>C1QA</italic>, indicating the plasticity and mixed nature of pathways activated in TAMs that could not be defined using exclusive markers. Thus, the myeloid MeCs may provide a consistent definition of TAM states corresponding to different metabolic processes.</p>
    <p id="Par22">MetaTiME provides a toolkit for analyzing independent TME scRNA-seq datasets by mapping gene expression onto the MeC space. The outputs include signature continuums and the most highly enriched cell states. Recent useful single-cell dataset integration algorithms such as Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> and scArches<sup><xref ref-type="bibr" rid="CR52">52</xref></sup> infer a joint low-dimensional representation among data. In these approaches the shared space is re-computed every time a new dataset is incorporated. The MetaTiME strategy builds upon previous approaches that transfer latent representations from large datasets, but provides a stable and interpretable representation specialized for the TME.</p>
    <p id="Par23">By leveraging ChIP-seq data, MetaTiME implicates critical transcriptional regulators in tumor immunity. In many cases, we found the joint consideration of MeC-specific co-expression patterns and TF binding enrichments shows the functions of TFs in defining cellular states and gene expression programs. MetaTiME captured multiple known TFs critical to tumor immunity and could serve as immune modulation targets; this includes <italic>TOX</italic> in MeC-40, <italic>CXCL13</italic>-secreting exhausted CD8 T cell, a recently discovered regulator of T cell exhaustion<sup><xref ref-type="bibr" rid="CR53">53</xref></sup> (Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>). The MeCs further implicated the glucocorticoid receptor pathway in the regulation of several T cell states. Glucocorticoids are a class of steroid hormones essential to the modulation of multiple biological processes, including immune related ones<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>, although the function of the GR pathway in different immune cell types is not fully understood. Since GR is broadly expressed in many cell types, and is regulated through ligand binding, differential analysis of GR expression is unlikely to fully capture GR regulation in single-cell data analysis. Though GR ChIP-seq is not available in the contexts of the relevant T cell states, GR ChIP-seq in other cell lines demonstrate robust binding nearby the top gene <italic>CXCL13</italic>. CXCL13 is crucial to T follicular helper cell communication with germinal center B cells, through interaction with its receptor CXCR5<sup><xref ref-type="bibr" rid="CR54">54</xref>,<xref ref-type="bibr" rid="CR55">55</xref></sup>.</p>
    <p id="Par24">Overall, MetaTiME depicts the functional landscape of transcriptomic variation and cell states in the tumor microenvironment. It provides a computational framework to facilitate the elucidation of the identity and function of cells in the TME in future studies and will facilitate the identification of potential new therapeutic targets for immune modulation.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Tumor single-cell RNA-seq data collection and processing</title>
      <p id="Par25">For an extensive collection of single cells from tumor microenvironment, we utilized the public tumor scRNA-seq collection, TISCH<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. The TISCH collection uniformly processed each dataset with MAESTRO<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> and isolated non-malignant environmental cells from malignant cells. Overall, we collected 2,157,387 cells from 76 studies ranging 27 cancer types. The MAESTRO annotation was labeled using CIBERSORT gene panels<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> followed by curation, enabling selection of 1,719,813 tumor micro-environment cells, including 1,617,110 immune cells and 102,703 stromal cells, were retained for integrative analysis in this study. For studies with data measured from multiple cancer types, cells different cancer types were split into independent datasets, resulting in 93 datasets; it includes 3 PBMC datasets from healthy donors from 10X Genomics as baseline and 7 datasets with ICB treatment.</p>
      <p id="Par26">For an unsupervised component analysis, each dataset was re-analyzed. For datasets with raw count matrices available, gene expression was normalized towards per-cell read depth 10,000 followed by log transformation. For datasets with only TPM or FPKM values available, including Smart-seq data or studies with only normalized matrix available, gene expression underwent log transformation. Cells were filtered based on minimum library size 1000, gene number 500, and maximum mitochondrial read proportion 5%.</p>
    </sec>
    <sec id="Sec13">
      <title>Decomposing individual studies and denoising low-dimensional components</title>
      <p id="Par27">We then decomposed the expression matrix of each scRNA-seq dataset using fastICA<sup><xref ref-type="bibr" rid="CR51">51</xref></sup> into an independent component (IC) vector matrix and a projection weight matrix. We tested different values for the number of components (<italic>k</italic>) and chose <italic>k</italic> to be 100 uniformly for each dataset, given it could cover more variations than the number of cell types in the TME, which is around twenty. We applied two denoising approaches to handle sparsity and potentially noisy ICs. First, we performed a <italic>z</italic> -score transformation of the gene loadings in the component, scaling all gene loading values by the standard deviation of each IC. The gene loadings indicate the degree of contribution to the component as a metagene from each gene, and we observed that most genes contribute neutrally to the metagene. Thus, genes with significant contributions are selected using the two-standard deviation threshold from either the positive or the negative side. Second, we aligned the positive skewness of components (using scipy.stats.skewtest<sup><xref ref-type="bibr" rid="CR56">56</xref></sup>) since the sign of an independent component is randomly assigned in fastICA optimization. We observed that asymmetrically extreme gene loading values highlight genes representative of the component’s function; thus, we computed each component’s skewness statistics and flipped the sign of component loadings if the skewness is negative. We excluded genes with a low contribution (gene weight not passing two standard deviations) to any reproducible components and kept 6623 genes with potentials in driving the reproducible components. The post-decomposition steps ensured the attitude and sign of gene weights are comparable across cohorts, depicting degree of contribution from each gene in the genome-wide background.</p>
    </sec>
    <sec id="Sec14">
      <title>Meta-component calling and functional annotation</title>
      <p id="Par28">We then aim to discover reproducible patterns from all components from each dataset. We evaluated similarity between pairs of components using cosine distance and retained a set of 1043 candidate reproducible components from 69 datasets, each with a minimum Pearson correlation coefficient 0.3 with at least one different IC. We then clustered ICs using Louvain clustering, a graph-based community detection algorithm where the resolution parameter controls segmentation granularity. Clusters with at least five ICs were retained as reproducible IC clusters. The number of clusters is determined by optimizing both Silhouette’s score for optimal within-cluster similarity compared to inter-cluster similarity and number of reproducible clusters. The final resolution parameter was chosen to be 1.25 resulting in 86 clusters for meta-component (MeC) calling. The consensus gene <italic>z</italic>-weights in each MeC were then calculated by averaging ICs in each cluster. Genes of outlier <italic>z</italic>-weights passing two standard deviations were highlighted as significant, and the ones with positive largest <italic>z</italic>-weights were considered representative of the MeC.</p>
      <p id="Par29">MetaTiME MeCs were assigned curated annotation by matching top <italic>z</italic>-weighted genes to functional biological information including cell type markers, pathway databases from GSEA and Enrichr through GSEApy, cell types expressing top MeC genes, and high-rank transcription factors. In detail, GSEA enrichment analyses utilized the top 100 highest <italic>z</italic>-weighted genes and TF database was obtained from AnimalTFDB<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>. The pathway database from Enrichr utilized WikiPathways, BioPlanet, MSigDB_Hallmarks, GO_Biological_pathway, GO_Molecular_function, GO_Biological_process. KEGG, and Reactome. GSEA was also performed using the <italic>z</italic>-weight rank of all genes<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>. The 86 MeCs were first ordered by MeC cluster size, then organized into seven functional categories with six lineage-related categories and one signaling category.</p>
    </sec>
    <sec id="Sec15">
      <title>Simulating multi-cohort single-cell RNA data with expression programs</title>
      <p id="Par30">To benchmark dimensional reduction methods, we built upon previous effort from Kotliar et al.<sup><xref ref-type="bibr" rid="CR58">58</xref></sup> to use the scsim package to simulate multiple count matrices with built-in transcriptional programs. In principle, the built-in gene expression programs (GEP) were sampled as random scaling factors on a subset of genes mimicking overexpression or suppression of a pathway. For testing whether a higher number of cohorts facilitate GEP recovery, we simulated 20 single-cell datasets and tested usage of 5 cohorts, 10 cohorts, and 20 cohorts. Each dataset was embedded with a subset of 14 pre-defined GEPs, since the real tumor scRNA data may not cover every possible cell type or gene program in every dataset. The 14 GEPs contain 13 cell type-specific programs with distinct cell type-specific genes, and one signaling gene expression program that is randomly active in multiple cell types. Two low-dimensional reduction method are benchmarked using simulated scRNA data: independent component analysis (ICA) and non-negative matrix factorization (NMF). Decomposition was performed on each single cohort separately, and meta-component calling was done as similar in MetaTiME: components are filtered, clustered into meta-components, followed by averaging gene <italic>z</italic>-weights per cluster as predicted gene expression programs (GEP). The predicted GEPs were compared with pre-defined True GEPs using Pearson correlation. Overall, both ICA and NMF can recover GEPs, while the ICA-based GEPs are more mutually independent and performs slightly better. Since the GEP recovered in the 20 cohorts case matched true GEP better than 5 cohorts and 10 cohorts, the increased number of cohorts also improves GEP recovery. Thus, we chose ICA for component integration and use all available datasets for GEP discovery for tumor microenvironmental cells.</p>
    </sec>
    <sec id="Sec16">
      <title>MeC calling robustness with leave-one-out testing</title>
      <p id="Par31">MetaTiME’s robustness was examined by re-calling MeCs after leaving one dataset out and calculate the Pearson correlation between the left out dataset MeCs and the full-set MeCs. The leave-one-out analysis was first performed by removing the SCC cells from the Yost et al. dataset, which was shown as an example of MetaTiME annotation. Each dataset in the MeC pool was left out to call new MeCs using the same parameters, resolution = 1.25 and min_cluster_size = 5. We used two metrics to check the similarity of each leave-one-out experiments compared to the full set. The first metric is the mean maximum correlation between leave-one-out and the full set. This is calculated by taking the maximum correlation, row-wise and column-wise in the correlation heatmap, and then taking the average. The second metric is the number of MeCs.</p>
    </sec>
    <sec id="Sec17">
      <title>Comparing MeCs, signatures by post-embedding integration, to signatures by cluster-wise differential expression</title>
      <p id="Par32">We compared MetaTiME MeCs to the standard approach that extracts signatures after integrating cells across datasets. The standard approach to obtain cluster-wise signatures is to perform dataset harmonization, cell clustering, and cluster-wise differential expression analysis. When performing dataset integration, we first used CCA to include as many datasets as possible given our maximum memory available in our computing resource (150GB). The maximum number of datasets integrated by CCA is 10 when using datasets ranked by the number of TME cells. We then used scanpy to achieve the successful integration of 21 datasets. The integrated cells are harmonized with Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> and clustered, followed by differential expression analysis using the Wilcoxon test to extract cluster-wise signatures. The signatures are in the format of gene vector of log fold change, and named as “Cluster DE signatures”. To control the confounding effect of signature numbers, the resolution of clustering is chosen to reach 90 clusters, a similar number with the number of full-set MeCs which is 86. Then, we compared MetaTiME MeCs to the Cluster DE signature projected onto a test dataset. We used same BCC cells as the test cells that are never seen in the training step from either method. To reflect how variable the projected scores are across cells, we grouped cells from the test BCC data into 25 clusters with Leiden clustering. The heatmap of the cluster-wise signature mapping is plotted to observe how specific each type of score is across cell groups. We further used cross-cluster entropy to quantify the information content of scores relative to clusters in the test dataset.</p>
    </sec>
    <sec id="Sec18">
      <title>The MetaTiME annotator for analyzing new tumor scRNA-seq data</title>
      <p id="Par33">MetaTiME provides an analytical toolkit for annotating cell states and signature activities for tumor scRNA-seq data (<ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>). The scRNA-seq data is first processed following standard procedures, which includes cell depth normalization, <italic>log</italic>-transformation, batch effect removal using Harmony<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, neighboring graph construction, graph clustering, and UMAP embedding for visualization. Specifically, the clustering step uses an over-clustering strategy, which sets a high-resolution parameter (default 8) that generates a larger number of clusters and help reveal fine structures among the cells. Then, the MetaTiME annotator tool takes as input a single log-transformed expression matrix for TME cells from the dataset. The outputs include both per-cell MetaTiME MeC signature scores and per-cluster enriched MeC state. For the per-cell score, MetaTiME projects each cell onto the MeC space by calculating the dot product between the expression vector and the <italic>z</italic>-weight vector of each MeC, using genes passing the significant <italic>z</italic>-weight criterion (<italic>z</italic>-weight ≥2). The projection matrix is then scaled across all cells to ensure normally distributed scores within each MeC, outputting the cell-by-MeC score matrix. Meanwhile, the UMAP view of the projection score shows the signature gradient across the cells positioned by similarity. Lastly, the cluster-wise MeC enrichment results are also generated. The per-cluster MeC enrichment score is calculated by averaging profile of cells along each MeC; MeCs with mean score passing the significant cutoff (2 in the <italic>z</italic>-weight scale) are called as the set of enriched MeCs. Each cluster may enrich multiple number of MeCs, and the top enriched MeC with highest score is used in UMAP visualization.</p>
    </sec>
    <sec id="Sec19">
      <title>Differential MeC signature analysis</title>
      <p id="Par34">For tumor scRNA-seq data with different conditions, a differential signature analysis can be carried out following MetaTiME annotation, which provides enriched MeCs for each cluster and names each cluster with the top enriched MeC. Thus, for each cell cluster, the MeC signature strength can be compared across conditions, for all enriched MeC in the current cluster. In details, a simple <italic>t</italic>-test or Wilcoxon rank-sum test is adopted to compare MeC scores of cells in one condition with another. The effect size of MeC scores were calculated by the difference between cell means from the two conditions in comparison. To plot the cluster-specific differential signature plot, the signatures are marked using “EnrichedMeC@ClusterName”, where the “ClusterName” is the top first enriched MeC used as cell state as current cluster. When “EnrichedMeC” is the same as the “ClusterName”, only “ClusterName” is marked on the Significance-Effect size plot.</p>
    </sec>
    <sec id="Sec20">
      <title>Incorporation of epigenetic data using Lisa</title>
      <p id="Par35">Our group previously developed Lisa that predicts the influence of TFs on a set of genes. Lisa models public chromatin accessibility and TF binding profiles to score TFs in gene regulation from an epigenetic perspective. We developed Lisa2 that improves on running speed and pipeline integration, which is applied on each MeC to score TFs in regulation potential on top 100 high <italic>z</italic>-weighted genes. The impact scores of TFs are thus from two sources: MeC <italic>z</italic>-weights for expression representation, and Lisa scores for binding potential, as in Supplementary Data <xref rid="MOESM6" ref-type="media">3</xref>. The TFs are grouped into three classes, TFs highly ranked based on both MeC gene weights and Lisa significance, TFs representative only in MeC, and TFs based on binding information only. In Supplementary Data <xref rid="MOESM5" ref-type="media">2</xref>, we marked TFs from different classes in different columns. Significant TFs based on both MeC and Lisa (MeC <italic>z</italic>-weight ≥2), Lisa score -log (<italic>p</italic>-value) ≥2 are marked in the column TF_MeCLisa_top_1; furthermore, the TFs ranking among top 40 (aggregated rank of MeC and Lisa) compared to all genes are further marked in the column TF_MeCLisa_top. TFs ranking among top 10 only in MeC <italic>z</italic>-weight are in the column TF_MeC_top, and TFs ranking among top 10 only in Lisa score are in the column TF_Lisa_top.</p>
    </sec>
    <sec id="Sec21">
      <title>Reporting summary</title>
      <p id="Par36">Further information on research design is available in the <xref rid="MOESM7" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec22">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_38333_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_38333_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_38333_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_38333_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Data 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_38333_MOESM5_ESM.xlsx">
            <caption>
              <p>Supplementary Data 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_38333_MOESM6_ESM.xlsx">
            <caption>
              <p>Supplementary Data 3</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM7">
          <media xlink:href="41467_2023_38333_MOESM7_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec23">
        <title>Source data</title>
        <p id="Par40">
          <media position="anchor" xlink:href="41467_2023_38333_MOESM8_ESM.xlsx" id="MOESM8">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-38333-8.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>The results appearing here are supported by grants NIH grants P01CA163222(CM), U24CA237617(CM,MB), and R01CA234018(MB). We acknowledge all authors of the original tumor single-cell studies that generated publicly available data. The results appearing here are in part based upon the data generated by the TCGA Research Network (<ext-link ext-link-type="uri" xlink:href="http://cancergenome.nih.gov/">http://cancergenome.nih.gov/</ext-link>).</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>C.M., M.B., S.L., Y.Z. designed the study and were major contributor in editing the manuscript. C.M., M.B., S.L. supervised the study. Y.Z. analyzed and interpreted the data and was a major contributor in writing the manuscript. Y.J., G.X., C. Wan, Z.Z., A.L., W.Z., J.F., J.K. contributed to the data analysis. C. Wang, Z.Z., Y.Z., Y.J., S.G., B.Z. contributed to the data collection and analysis. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par37"><italic>Nature Communications</italic> thanks Andrew Adey, Markus List and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. A peer review file is available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The processed datasets used in this study are available in Zenodo under accession code <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7410180">7410180</ext-link> The pretrained meta-components for tumor microenvironment in the Github repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>. The single-cell RNA-seq data used in this study are available in the TISCH database (<ext-link ext-link-type="uri" xlink:href="http://tisch1.comp-genomics.org">http://tisch1.comp-genomics.org</ext-link>). The list of public datasets used in this study is available in Supplementary Data <xref rid="MOESM4" ref-type="media">1</xref> and also from GEO under accession code <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE154763">GSE154763</ext-link> and Single Cell Portal under accession code <ext-link ext-link-type="uri" xlink:href="https://singlecell.broadinstitute.org/single_cell/study/SCP1288/tumor-and-immune-reprogramming-during-immunotherapy-in-advanced-renal-cell-carcinoma">SCP1288</ext-link>. The gene list analytical data used in this study are available in AnimalTFDB v3.0 (<ext-link ext-link-type="uri" xlink:href="http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/">http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/</ext-link>), TCGA (<ext-link ext-link-type="uri" xlink:href="https://portal.gdc.cancer.gov">https://portal.gdc.cancer.gov</ext-link>), and Azimuth (<ext-link ext-link-type="uri" xlink:href="https://azimuth.hubmapconsortium.org">https://azimuth.hubmapconsortium.org</ext-link>). The ChIP-seq data used in this study are available from GEO (<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/">https://www.ncbi.nlm.nih.gov/geo/</ext-link>) under accession IDs <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM604651">GSM604651</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637309">GSM1637309</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1607526">GSM1607526</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2661793">GSM2661793</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2735378">GSM2735378</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM2871705">GSM2871705</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637306">GSM1637306</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1637307">GSM1637307</ext-link>, and from ENCODE (<ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/">https://www.encodeproject.org/</ext-link>) under accession ID <ext-link ext-link-type="uri" xlink:href="https://www.encodeproject.org/experiments/ENCSR919OXR/">ENCSR919OXR</ext-link>. <xref rid="Sec23" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>MetaTiME is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/yi-zhang/MetaTiME">https://github.com/yi-zhang/MetaTiME</ext-link>, and also available at Zhang Y et al., “MetaTiME Integrates Single-cell Gene Expression to Characterize the Meta-components of the Tumor Immune Microenvironment”, MetaTiME, 10.5281/zenodo.7734062, 2023.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par38">MB is a consultant to and receives sponsored research support from Novartis. MB serves on the SAB of H3 Biomedicine, Kronos Bio, FibroGen, and GV20 Therapeutics. X.S.L conducted the work while being on the faculty at DFCI, and is currently a board member and CEO of GV20 Therapeutics. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>XS</given-names>
          </name>
          <name>
            <surname>Mardis</surname>
            <given-names>ER</given-names>
          </name>
        </person-group>
        <article-title>Applications of immunogenomics to cancer</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>168</volume>
        <fpage>600</fpage>
        <lpage>612</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2017.01.014</pub-id>
        <?supplied-pmid 28187283?>
        <pub-id pub-id-type="pmid">28187283</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jin</surname>
            <given-names>MZ</given-names>
          </name>
          <name>
            <surname>Jin</surname>
            <given-names>WL</given-names>
          </name>
        </person-group>
        <article-title>The updated landscape of tumor microenvironment and drug repurposing</article-title>
        <source>Signal Transduct. Target. Ther.</source>
        <year>2020</year>
        <volume>5</volume>
        <fpage>166</fpage>
        <pub-id pub-id-type="doi">10.1038/s41392-020-00280-x</pub-id>
        <?supplied-pmid 32843638?>
        <pub-id pub-id-type="pmid">32843638</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Penter</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Local and systemic effects of immune checkpoint blockade on relapsed myeloid malignancies following allogeneic hematopoietic stem cell transplantation</article-title>
        <source>Blood</source>
        <year>2020</year>
        <volume>136</volume>
        <fpage>34</fpage>
        <lpage>35</lpage>
        <pub-id pub-id-type="doi">10.1182/blood-2020-139487</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cancer-associated genetic variant Rs3903072 modulates immune cells in the tumor microenvironment</article-title>
        <source>Front. Genet.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>754</fpage>
        <pub-id pub-id-type="doi">10.3389/fgene.2019.00754</pub-id>
        <?supplied-pmid 31507631?>
        <pub-id pub-id-type="pmid">31507631</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gu</surname>
            <given-names>SS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Therapeutically increasing MHC-I expression potentiates immune checkpoint blockade</article-title>
        <source>Cancer Disco.</source>
        <year>2021</year>
        <volume>11</volume>
        <fpage>1524</fpage>
        <lpage>1541</lpage>
        <pub-id pub-id-type="doi">10.1158/2159-8290.CD-20-0812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeng</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TISMO: syngeneic mouse tumor database to model tumor immunity and immunotherapy response</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>D1391</fpage>
        <lpage>D1397</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab804</pub-id>
        <?supplied-pmid 34534350?>
        <pub-id pub-id-type="pmid">34534350</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Signatures of T cell dysfunction and exclusion predict cancer immunotherapy response</article-title>
        <source>Nat. Med.</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>1550</fpage>
        <lpage>1558</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-018-0136-1</pub-id>
        <?supplied-pmid 30127393?>
        <pub-id pub-id-type="pmid">30127393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yost</surname>
            <given-names>KE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal replacement of tumor-specific T cells following PD-1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2019</year>
        <volume>25</volume>
        <fpage>1251</fpage>
        <lpage>1259</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-019-0522-3</pub-id>
        <?supplied-pmid 31359002?>
        <pub-id pub-id-type="pmid">31359002</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analyses inform mechanisms of myeloid-targeted therapies in colon cancer</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>181</volume>
        <fpage>442</fpage>
        <lpage>459.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2020.03.048</pub-id>
        <?supplied-pmid 32302573?>
        <pub-id pub-id-type="pmid">32302573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cheng</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A pan-cancer single-cell transcriptional atlas of tumor infiltrating myeloid cells</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>792</fpage>
        <lpage>809.e23</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.01.010</pub-id>
        <?supplied-pmid 33545035?>
        <pub-id pub-id-type="pmid">33545035</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>In vivo CRISPR screens identify the E3 ligase Cop1 as a modulator of macrophage infiltration and cancer immunotherapy target</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>5357</fpage>
        <lpage>5374.e22</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.09.006</pub-id>
        <?supplied-pmid 34582788?>
        <pub-id pub-id-type="pmid">34582788</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>SZ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell and spatially resolved atlas of human breast cancers</article-title>
        <source>Nat. Genet.</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>1334</fpage>
        <lpage>1347</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-021-00911-1</pub-id>
        <?supplied-pmid 34493872?>
        <pub-id pub-id-type="pmid">34493872</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell tumor immune atlas for precision oncology</article-title>
        <source>Genome Res.</source>
        <year>2021</year>
        <volume>31</volume>
        <fpage>1913</fpage>
        <lpage>1926</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.273300.120</pub-id>
        <?supplied-pmid 34548323?>
        <pub-id pub-id-type="pmid">34548323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aran</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage</article-title>
        <source>Nat. Immunol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>163</fpage>
        <lpage>172</lpage>
        <pub-id pub-id-type="doi">10.1038/s41590-018-0276-y</pub-id>
        <?supplied-pmid 30643263?>
        <pub-id pub-id-type="pmid">30643263</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrative analyses of single-cell transcriptome and regulome using MAESTRO</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>198</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-02116-x</pub-id>
        <?supplied-pmid 32767996?>
        <pub-id pub-id-type="pmid">32767996</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Newman</surname>
            <given-names>AM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Robust enumeration of cell subsets from tissue expression profiles</article-title>
        <source>Nat. Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>453</fpage>
        <lpage>457</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3337</pub-id>
        <?supplied-pmid 25822800?>
        <pub-id pub-id-type="pmid">25822800</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Andreatta</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Interpretation of T cell states from single-cell transcriptomics data using reference atlases</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>1</fpage>
        <lpage>19</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-021-23324-4</pub-id>
        <pub-id pub-id-type="pmid">33397941</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Pan-cancer single-cell landscape of tumor-infiltrating T cells</article-title>
        <source>Sci. (80-.)</source>
        <year>2021</year>
        <volume>374</volume>
        <fpage>abe6474</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abe6474</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pelka</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially organized multicellular immune hubs in human colorectal cancer</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>4734</fpage>
        <lpage>4752.e20</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.08.003</pub-id>
        <?supplied-pmid 34450029?>
        <pub-id pub-id-type="pmid">34450029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyvarinen</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Fast and robust fixed-point algorithms for independent component analysis</article-title>
        <source>IEEE Trans. Neural Netw.</source>
        <year>1999</year>
        <volume>10</volume>
        <fpage>626</fpage>
        <lpage>634</lpage>
        <pub-id pub-id-type="doi">10.1109/72.761722</pub-id>
        <?supplied-pmid 18252563?>
        <pub-id pub-id-type="pmid">18252563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Independent component analysis based gene co-expression network inference (ICAnet) to decipher functional modules for better single-cell clustering and batch integration</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>E54</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab089</pub-id>
        <?supplied-pmid 33619563?>
        <pub-id pub-id-type="pmid">33619563</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cistrome data browser: expanded datasets and new tools for gene regulatory analysis</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D729</fpage>
        <lpage>D735</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky1094</pub-id>
        <?supplied-pmid 30462313?>
        <pub-id pub-id-type="pmid">30462313</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TISCH: a comprehensive web resource enabling interactive single-cell transcriptome visualization of tumor microenvironment</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2021</year>
        <volume>49</volume>
        <fpage>D1420</fpage>
        <lpage>D1430</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkaa1020</pub-id>
        <?supplied-pmid 33179754?>
        <pub-id pub-id-type="pmid">33179754</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wykes</surname>
            <given-names>MN</given-names>
          </name>
          <name>
            <surname>Lewin</surname>
            <given-names>SR</given-names>
          </name>
        </person-group>
        <article-title>Immune checkpoint blockade in infectious diseases</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>91</fpage>
        <lpage>104</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2017.112</pub-id>
        <?supplied-pmid 28990586?>
        <pub-id pub-id-type="pmid">28990586</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Vignali</surname>
            <given-names>DAA</given-names>
          </name>
        </person-group>
        <article-title>Co-stimulatory and co-inhibitory pathways in autoimmunity</article-title>
        <source>Immunity</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>1034</fpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2016.04.017</pub-id>
        <?supplied-pmid 27192568?>
        <pub-id pub-id-type="pmid">27192568</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Novel immune checkpoint targets: moving beyond PD-1 and CTLA-4</article-title>
        <source>Mol. Cancer</source>
        <year>2019</year>
        <volume>18</volume>
        <fpage>155</fpage>
        <pub-id pub-id-type="doi">10.1186/s12943-019-1091-2</pub-id>
        <?supplied-pmid 31690319?>
        <pub-id pub-id-type="pmid">31690319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Thommen</surname>
            <given-names>DS</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A transcriptionally and functionally distinct PD-1+ CD8+ T cell pool with predictive potential in non-small-cell lung cancer treated with PD-1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2018</year>
        <volume>24</volume>
        <fpage>994</fpage>
        <lpage>1004</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-018-0057-z</pub-id>
        <?supplied-pmid 29892065?>
        <pub-id pub-id-type="pmid">29892065</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chowell</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improved prediction of immune checkpoint blockade efficacy across multiple cancer types</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>499</fpage>
        <lpage>506</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01070-8</pub-id>
        <?supplied-pmid 34725502?>
        <pub-id pub-id-type="pmid">34725502</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Subramanian</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>15545</fpage>
        <lpage>15550</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id>
        <?supplied-pmid 16199517?>
        <pub-id pub-id-type="pmid">16199517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Morgan</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Tergaonkar</surname>
            <given-names>V</given-names>
          </name>
        </person-group>
        <article-title>Unraveling B cell trajectories at single cell resolution</article-title>
        <source>Trends Immunol.</source>
        <year>2022</year>
        <volume>43</volume>
        <fpage>210</fpage>
        <lpage>229</lpage>
        <pub-id pub-id-type="doi">10.1016/j.it.2022.01.003</pub-id>
        <?supplied-pmid 35090788?>
        <pub-id pub-id-type="pmid">35090788</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finkin</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hartweger</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Oliveira</surname>
            <given-names>TY</given-names>
          </name>
          <name>
            <surname>Kara</surname>
            <given-names>EE</given-names>
          </name>
          <name>
            <surname>Nussenzweig</surname>
            <given-names>MC</given-names>
          </name>
        </person-group>
        <article-title>Protein amounts of the MYC transcription factor determine germinal center B cell division capacity</article-title>
        <source>Immunity</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>324</fpage>
        <lpage>336.e5</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2019.06.013</pub-id>
        <?supplied-pmid 31350178?>
        <pub-id pub-id-type="pmid">31350178</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vaquero</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Aoudjehane</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Fouassier</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Cancer-associated fibroblasts in cholangiocarcinoma</article-title>
        <source>Curr. Opin. Gastroenterol.</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>63</fpage>
        <lpage>69</lpage>
        <pub-id pub-id-type="doi">10.1097/MOG.0000000000000609</pub-id>
        <?supplied-pmid 31934895?>
        <pub-id pub-id-type="pmid">31934895</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luca</surname>
            <given-names>BA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Atlas of clinically distinct cell states and ecosystems across human solid tumors</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>5482</fpage>
        <lpage>5496.e28</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.09.014</pub-id>
        <?supplied-pmid 34597583?>
        <pub-id pub-id-type="pmid">34597583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Detection of differentially abundant cell subpopulations in scRNA-seq data</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2021</year>
        <volume>118</volume>
        <fpage>e2100293118</fpage>
        <pub-id pub-id-type="doi">10.1073/pnas.2100293118</pub-id>
        <?supplied-pmid 34001664?>
        <pub-id pub-id-type="pmid">34001664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yuen</surname>
            <given-names>KC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High systemic and tumor-associated IL-8 correlates with reduced clinical benefit of PD-L1 blockade</article-title>
        <source>Nat. Med.</source>
        <year>2020</year>
        <volume>26</volume>
        <fpage>693</fpage>
        <lpage>698</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-020-0860-1</pub-id>
        <?supplied-pmid 32405063?>
        <pub-id pub-id-type="pmid">32405063</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaplanov</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Blocking IL-1β reverses the immunosuppression in mouse breast cancer and synergizes with anti-PD-1 for tumor abrogation</article-title>
        <source>Proc. Natl. Acad. Sci. USA.</source>
        <year>2019</year>
        <volume>116</volume>
        <fpage>1361</fpage>
        <lpage>1369</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1812266115</pub-id>
        <?supplied-pmid 30545915?>
        <pub-id pub-id-type="pmid">30545915</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duan</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Targeting macrophages in cancer immunotherapy</article-title>
        <source>Signal Transduct. Target. Ther.</source>
        <year>2021</year>
        <volume>6</volume>
        <fpage>127</fpage>
        <pub-id pub-id-type="doi">10.1038/s41392-021-00506-6</pub-id>
        <?supplied-pmid 33767177?>
        <pub-id pub-id-type="pmid">33767177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bi</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Tumor and immune reprogramming during immunotherapy in advanced renal cell carcinoma</article-title>
        <source>Cancer Cell</source>
        <year>2021</year>
        <volume>39</volume>
        <fpage>649</fpage>
        <lpage>661.e5</lpage>
        <pub-id pub-id-type="doi">10.1016/j.ccell.2021.02.015</pub-id>
        <?supplied-pmid 33711272?>
        <pub-id pub-id-type="pmid">33711272</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The role of osteopontin in the progression of solid organ tumour</article-title>
        <source>Cell Death Dis.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>356</fpage>
        <pub-id pub-id-type="doi">10.1038/s41419-018-0391-6</pub-id>
        <?supplied-pmid 29500465?>
        <pub-id pub-id-type="pmid">29500465</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spivia</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Magno</surname>
            <given-names>PS</given-names>
          </name>
          <name>
            <surname>Le</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Fraser</surname>
            <given-names>DA</given-names>
          </name>
        </person-group>
        <article-title>Complement protein C1q promotes macrophage anti-inflammatory M2-like polarization during the clearance of atherogenic lipoproteins</article-title>
        <source>Inflamm. Res.</source>
        <year>2014</year>
        <volume>63</volume>
        <fpage>885</fpage>
        <lpage>893</lpage>
        <pub-id pub-id-type="doi">10.1007/s00011-014-0762-0</pub-id>
        <?supplied-pmid 25091012?>
        <pub-id pub-id-type="pmid">25091012</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liu</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The CXCL8-CXCR1/2 pathways in cancer</article-title>
        <source>Cytokine Growth Factor Rev.</source>
        <year>2016</year>
        <volume>31</volume>
        <fpage>61</fpage>
        <lpage>71</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cytogfr.2016.08.002</pub-id>
        <?supplied-pmid 27578214?>
        <pub-id pub-id-type="pmid">27578214</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qin</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lisa: inferring transcriptional regulators through integrative modeling of public chromatin accessibility and ChIP-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>32</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-020-1934-6</pub-id>
        <?supplied-pmid 32033573?>
        <pub-id pub-id-type="pmid">32033573</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peters</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Shah</surname>
            <given-names>YM</given-names>
          </name>
          <name>
            <surname>Gonzalez</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>The role of peroxisome proliferator-activated receptors in carcinogenesis and chemoprevention</article-title>
        <source>Nat. Rev. Cancer</source>
        <year>2012</year>
        <volume>12</volume>
        <fpage>181</fpage>
        <lpage>195</lpage>
        <pub-id pub-id-type="doi">10.1038/nrc3214</pub-id>
        <?supplied-pmid 22318237?>
        <pub-id pub-id-type="pmid">22318237</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AnimalTFDB 3.0: a comprehensive resource for annotation and prediction of animal transcription factors</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>D33</fpage>
        <lpage>D38</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky822</pub-id>
        <?supplied-pmid 30204897?>
        <pub-id pub-id-type="pmid">30204897</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dysfunctional CD8 T cells form a proliferative, dynamically regulated compartment within human melanoma</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>176</volume>
        <fpage>775</fpage>
        <lpage>789.e18</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.11.043</pub-id>
        <?supplied-pmid 30595452?>
        <pub-id pub-id-type="pmid">30595452</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hyvärinen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Oja</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Independent component analysis: algorithms and applications</article-title>
        <source>Neural Netw.</source>
        <year>2000</year>
        <volume>13</volume>
        <fpage>411</fpage>
        <lpage>430</lpage>
        <pub-id pub-id-type="doi">10.1016/S0893-6080(00)00026-5</pub-id>
        <?supplied-pmid 10946390?>
        <pub-id pub-id-type="pmid">10946390</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lotfollahi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping single-cell data to reference atlases by transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>121</fpage>
        <lpage>130</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01001-7</pub-id>
        <?supplied-pmid 34462589?>
        <pub-id pub-id-type="pmid">34462589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Khan</surname>
            <given-names>O</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TOX transcriptionally and epigenetically programs CD8+ T cell exhaustion</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>571</volume>
        <fpage>211</fpage>
        <lpage>218</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1325-x</pub-id>
        <?supplied-pmid 31207603?>
        <pub-id pub-id-type="pmid">31207603</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ohandjo</surname>
            <given-names>AQ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome network analysis identifies CXCL13-CXCR5 signaling modules in the prostate tumor immune microenvironment</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>14963</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-46491-3</pub-id>
        <?supplied-pmid 31628349?>
        <pub-id pub-id-type="pmid">31628349</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Havenar-Daughton</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CXCL13 is a plasma biomarker of germinal center activity</article-title>
        <source>Proc. Natl. Acad. Sci. Usa.</source>
        <year>2016</year>
        <volume>113</volume>
        <fpage>2702</fpage>
        <lpage>2707</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1520112113</pub-id>
        <?supplied-pmid 26908875?>
        <pub-id pub-id-type="pmid">26908875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>D’Agostino</surname>
            <given-names>RB</given-names>
          </name>
          <name>
            <surname>Belanger</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>D’Agostino</surname>
            <given-names>RB</given-names>
          </name>
        </person-group>
        <article-title>A suggestion for using powerful and informative tests of normality</article-title>
        <source>Am. Stat.</source>
        <year>1990</year>
        <volume>44</volume>
        <fpage>316</fpage>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>LG</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>QY</given-names>
          </name>
        </person-group>
        <article-title>ClusterProfiler: an R package for comparing biological themes among gene clusters</article-title>
        <source>Omi. A J. Integr. Biol.</source>
        <year>2012</year>
        <volume>16</volume>
        <fpage>284</fpage>
        <lpage>287</lpage>
        <pub-id pub-id-type="doi">10.1089/omi.2011.0118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kotliar</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identifying gene expression programs of cell-type identity and cellular activity with single-cell RNA-Seq</article-title>
        <source>Elife</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>1</fpage>
        <lpage>26</lpage>
        <pub-id pub-id-type="doi">10.7554/eLife.43803</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
