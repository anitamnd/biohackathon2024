<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 39.96?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?subarticle pcbi.1010633.r001?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS Comput Biol</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-title-group>
      <journal-title>PLOS Computational Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1553-734X</issn>
    <issn pub-type="epub">1553-7358</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, CA USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9632902</article-id>
    <article-id pub-id-type="pmid">36279274</article-id>
    <article-id pub-id-type="publisher-id">PCOMPBIOL-D-22-00025</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Engineering indel and substitution variants of diverse and ancient enzymes using Graphical Representation of Ancestral Sequence Predictions (GRASP)</article-title>
      <alt-title alt-title-type="running-head">Engineering indel and substitution variants</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0487-2629</contrib-id>
        <name>
          <surname>Foley</surname>
          <given-names>Gabriel</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/conceptualization/">Conceptualization</role>
        <role content-type="http://credit.niso.org/contributor-roles/data-curation/">Data curation</role>
        <role content-type="http://credit.niso.org/contributor-roles/formal-analysis/">Formal analysis</role>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/resources/">Resources</role>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-1331-8192</contrib-id>
        <name>
          <surname>Mora</surname>
          <given-names>Ariane</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-6270-8413</contrib-id>
        <name>
          <surname>Ross</surname>
          <given-names>Connie M.</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8457-2134</contrib-id>
        <name>
          <surname>Bottoms</surname>
          <given-names>Scott</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <xref rid="aff002" ref-type="aff">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-8889-2343</contrib-id>
        <name>
          <surname>Sützl</surname>
          <given-names>Leander</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/data-curation/">Data curation</role>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff003" ref-type="aff">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lamprecht</surname>
          <given-names>Marnie L.</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-4919-1448</contrib-id>
        <name>
          <surname>Zaugg</surname>
          <given-names>Julian</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Essebier</surname>
          <given-names>Alexandra</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Balderson</surname>
          <given-names>Brad</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-1300-6116</contrib-id>
        <name>
          <surname>Newell</surname>
          <given-names>Rhys</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3545-6692</contrib-id>
        <name>
          <surname>Thomson</surname>
          <given-names>Raine E. S.</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kobe</surname>
          <given-names>Bostjan</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff004" ref-type="aff">
          <sup>4</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Barnard</surname>
          <given-names>Ross T.</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Guddat</surname>
          <given-names>Luke</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Schenk</surname>
          <given-names>Gerhard</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff005" ref-type="aff">
          <sup>5</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Carsten</surname>
          <given-names>Jörg</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <xref rid="aff006" ref-type="aff">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gumulya</surname>
          <given-names>Yosephine</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rost</surname>
          <given-names>Burkhard</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff007" ref-type="aff">
          <sup>7</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-8722-8176</contrib-id>
        <name>
          <surname>Haltrich</surname>
          <given-names>Dietmar</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff003" ref-type="aff">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sieber</surname>
          <given-names>Volker</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff002" ref-type="aff">
          <sup>2</sup>
        </xref>
        <xref rid="aff006" ref-type="aff">
          <sup>6</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Gillam</surname>
          <given-names>Elizabeth M. J.</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/conceptualization/">Conceptualization</role>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/validation/">Validation</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="cor001" ref-type="corresp">*</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3548-268X</contrib-id>
        <name>
          <surname>Bodén</surname>
          <given-names>Mikael</given-names>
        </name>
        <role content-type="http://credit.niso.org/contributor-roles/conceptualization/">Conceptualization</role>
        <role content-type="http://credit.niso.org/contributor-roles/data-curation/">Data curation</role>
        <role content-type="http://credit.niso.org/contributor-roles/formal-analysis/">Formal analysis</role>
        <role content-type="http://credit.niso.org/contributor-roles/funding-acquisition/">Funding acquisition</role>
        <role content-type="http://credit.niso.org/contributor-roles/investigation/">Investigation</role>
        <role content-type="http://credit.niso.org/contributor-roles/methodology/">Methodology</role>
        <role content-type="http://credit.niso.org/contributor-roles/project-administration/">Project administration</role>
        <role content-type="http://credit.niso.org/contributor-roles/resources/">Resources</role>
        <role content-type="http://credit.niso.org/contributor-roles/software/">Software</role>
        <role content-type="http://credit.niso.org/contributor-roles/supervision/">Supervision</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing – original draft</role>
        <role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing – review &amp; editing</role>
        <xref rid="aff001" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="cor001" ref-type="corresp">*</xref>
      </contrib>
    </contrib-group>
    <aff id="aff001">
      <label>1</label>
      <addr-line>School of Chemistry and Molecular Biosciences, The University of Queensland, Brisbane, Australia</addr-line>
    </aff>
    <aff id="aff002">
      <label>2</label>
      <addr-line>Campus Straubing for Biotechnology and Sustainability, Technische Universität München, Straubing, Germany</addr-line>
    </aff>
    <aff id="aff003">
      <label>3</label>
      <addr-line>Institut für Lebensmitteltechnologie, Universität für Bodenkultur Wien, Vienna, Austria</addr-line>
    </aff>
    <aff id="aff004">
      <label>4</label>
      <addr-line>Institute for Molecular Bioscience and Australian Infectious Diseases Research Centre, The University of Queensland, Brisbane, Australia</addr-line>
    </aff>
    <aff id="aff005">
      <label>5</label>
      <addr-line>Sustainable Minerals Institute, The University of Queensland, Brisbane, Australia</addr-line>
    </aff>
    <aff id="aff006">
      <label>6</label>
      <addr-line>Zentralinstitut für Katalyseforschung, Technische Universität München, Munich, Germany</addr-line>
    </aff>
    <aff id="aff007">
      <label>7</label>
      <addr-line>Fakultät für Informatik, Technische Universität München, Munich, Germany</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Elofsson</surname>
          <given-names>Arne</given-names>
        </name>
        <role>Editor</role>
        <xref rid="edit1" ref-type="aff"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Stockholm University: Stockholms Universitet, SWEDEN</addr-line>
    </aff>
    <author-notes>
      <fn fn-type="COI-statement" id="coi001">
        <p>The authors have declared that no competing interests exist.</p>
      </fn>
      <corresp id="cor001">* E-mail: <email>m.boden@uq.edu.au</email> (MB); <email>e.gillam@uq.edu.au</email> (EMJG)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>10</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>24</day>
      <month>10</month>
      <year>2022</year>
    </pub-date>
    <volume>18</volume>
    <issue>10</issue>
    <elocation-id>e1010633</elocation-id>
    <history>
      <date date-type="received">
        <day>7</day>
        <month>1</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>10</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2022 Foley et al</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>Foley et al</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="pcbi.1010633.pdf"/>
    <abstract>
      <p>Ancestral sequence reconstruction is a technique that is gaining widespread use in molecular evolution studies and protein engineering. Accurate reconstruction requires the ability to handle appropriately large numbers of sequences, as well as insertion and deletion (indel) events, but available approaches exhibit limitations. To address these limitations, we developed Graphical Representation of Ancestral Sequence Predictions (GRASP), which efficiently implements maximum likelihood methods to enable the inference of ancestors of families with more than 10,000 members. GRASP implements partial order graphs (POGs) to represent and infer insertion and deletion events across ancestors, enabling the identification of building blocks for protein engineering.</p>
      <p>To validate the capacity to engineer novel proteins from realistic data, we predicted ancestor sequences across three distinct enzyme families: glucose-methanol-choline (GMC) oxidoreductases, cytochromes P450, and dihydroxy/sugar acid dehydratases (DHAD). All tested ancestors demonstrated enzymatic activity. Our study demonstrates the ability of GRASP (1) to support large data sets over 10,000 sequences and (2) to employ insertions and deletions to identify building blocks for engineering biologically active ancestors, by exploring variation over evolutionary time.</p>
    </abstract>
    <abstract abstract-type="summary">
      <title>Author summary</title>
      <p>Massive sequencing projects expose the extent of natural, genetic diversity. Here, we describe a method with capacity to perform ancestor sequence reconstruction from data sets in excess of 10,000 sequences, poised to recover <italic toggle="yes">ancestral</italic> diversity, including the evolutionary events that determine present-time biological function and structure.</p>
      <p>We introduce a novel strategy for suggesting “insertion-deletion variants” that are distinct from, but can be explored alongside, substitution variants for creating ancestral libraries. We demonstrate how insertions and deletions can be used as building blocks to form “hybrid ancestors”; based on this strategy, we synthesise ancestor variants, with varying enzymatic activities, for wide-ranging applications in the biotechnology sector.</p>
    </abstract>
    <funding-group>
      <award-group id="award001">
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100000923</institution-id>
            <institution>Australian Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>120101772</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3548-268X</contrib-id>
          <name>
            <surname>Bodén</surname>
            <given-names>Mikael</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award002">
        <funding-source>
          <institution>Australian Research Council</institution>
        </funding-source>
        <award-id>160100865</award-id>
        <principal-award-recipient>
          <contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3548-268X</contrib-id>
          <name>
            <surname>Bodén</surname>
            <given-names>Mikael</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award003">
        <funding-source>
          <institution>Australian Research Council</institution>
        </funding-source>
        <award-id>210101802</award-id>
        <principal-award-recipient>
          <name>
            <surname>Schenk</surname>
            <given-names>Gerhard</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <award-group id="award004">
        <funding-source>
          <institution>Australian Research Council</institution>
        </funding-source>
        <award-id>FL180100109</award-id>
        <principal-award-recipient>
          <name>
            <surname>Kobe</surname>
            <given-names>Bostjan</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
      <funding-statement>This work has been supported by the Australian Research Council (ARC; arc.gov.au) Discovery Project grants 210101802 to GS, LG and MB, 160100865 to MB, EG, BK and BR and 120101772 to MB and EG. BK is an ARC Laureate Fellow (FL180100109). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <fig-count count="6"/>
      <table-count count="0"/>
      <page-count count="35"/>
    </counts>
    <custom-meta-group>
      <custom-meta>
        <meta-name>PLOS Publication Stage</meta-name>
        <meta-value>vor-update-to-uncorrected-proof</meta-value>
      </custom-meta>
      <custom-meta>
        <meta-name>Publication Update</meta-name>
        <meta-value>2022-11-03</meta-value>
      </custom-meta>
      <custom-meta id="data-availability">
        <meta-name>Data Availability</meta-name>
        <meta-value>Data sets for CYP2U, DHAD, KARI, and GDH-GOx reconstructions are available from <ext-link xlink:href="https://github.com/bodenlab/GRASP-resources" ext-link-type="uri">https://github.com/bodenlab/GRASP-resources</ext-link>. All different data sets within each family are included, representing a range of different sequence identities and sizes (<xref rid="pcbi.1010633.s017" ref-type="supplementary-material">S17 Fig</xref>). Included are the original FASTA files, phylogenetic trees, sets of ancestors, and phylogenetic trees with labelled ancestral nodes. The full set of ancestors from each joint reconstruction is provided, except for GDH-GOx, where the single nominated marginal reconstruction at N320 is provided.</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
  <notes>
    <title>Data Availability</title>
    <p>Data sets for CYP2U, DHAD, KARI, and GDH-GOx reconstructions are available from <ext-link xlink:href="https://github.com/bodenlab/GRASP-resources" ext-link-type="uri">https://github.com/bodenlab/GRASP-resources</ext-link>. All different data sets within each family are included, representing a range of different sequence identities and sizes (<xref rid="pcbi.1010633.s017" ref-type="supplementary-material">S17 Fig</xref>). Included are the original FASTA files, phylogenetic trees, sets of ancestors, and phylogenetic trees with labelled ancestral nodes. The full set of ancestors from each joint reconstruction is provided, except for GDH-GOx, where the single nominated marginal reconstruction at N320 is provided.</p>
  </notes>
</front>
<body>
  <disp-quote>
    <p>This is a <italic toggle="yes">PLOS Computational Biology</italic> Methods paper.</p>
  </disp-quote>
  <sec sec-type="intro" id="sec001">
    <title>Introduction</title>
    <p>Sequencing technology is driving the identification of the <italic toggle="yes">extant</italic> (modern) portion of the universe of biological sequences [<xref rid="pcbi.1010633.ref001" ref-type="bibr">1</xref>–<xref rid="pcbi.1010633.ref003" ref-type="bibr">3</xref>]. With this increased coverage of natural diversity we are now better placed than ever before to leverage ancestral sequence reconstruction (ASR) to recover the <italic toggle="yes">ancestral</italic> portion and trace the evolutionary events that have determined biological function and structure [<xref rid="pcbi.1010633.ref004" ref-type="bibr">4</xref>, <xref rid="pcbi.1010633.ref005" ref-type="bibr">5</xref>]. This is especially useful for protein engineering; the evolutionary record reveals essential cues for the discovery and engineering of new enzymes. The resurrection of ancestral enzymes can be used to generate enzymes with novel properties that can be exploited in biocatalysis [<xref rid="pcbi.1010633.ref006" ref-type="bibr">6</xref>–<xref rid="pcbi.1010633.ref010" ref-type="bibr">10</xref>].</p>
    <p>The ability to perform ASR on large-scale data has been limited by the available methodology and accompanying technology. A recent review highlighted 12 studies from the past decade that each sought to evaluate sources of ambiguity in ancestral inferences [<xref rid="pcbi.1010633.ref011" ref-type="bibr">11</xref>]. Data set sizes within these studies ranged from 21 to 456 sequences, with an average of 168 sequences. Current methods for performing ASR have reached practical upper limits on data set size which constrains our ability to adequately represent and accurately analyse enzymes that have been evolving for billions of years. We have therefore developed the tool Graphical Representation of Ancestral Sequence Predictions (GRASP) to take advantage of the rapidly expanding databases of known protein sequences and the information from biological diversity that can be mined from large protein families.</p>
    <p>However, the challenge does not end with scaling-up processing capacity. Remote homologs that form part of large protein families are likely to have resulted from numerous evolutionary events, the order of which is often difficult to infer, and confounds current phylogenetic analysis techniques; insertion and deletion (indel) events introduce dependencies between positions in sequence that make their history difficult to access at greater scale [<xref rid="pcbi.1010633.ref012" ref-type="bibr">12</xref>, <xref rid="pcbi.1010633.ref013" ref-type="bibr">13</xref>]. In practice, their presence has been shown to decrease alignment accuracy unless appropriately handled [<xref rid="pcbi.1010633.ref014" ref-type="bibr">14</xref>, <xref rid="pcbi.1010633.ref015" ref-type="bibr">15</xref>]. Lee et al. [<xref rid="pcbi.1010633.ref016" ref-type="bibr">16</xref>] demonstrated how a partial order graph (POG) can be used to represent and support the alignment of widely different sequences. The risk of aligning sequence fragments with different evolutionary origins motivated us to use the POG data structure to enable the separation of distinct sources of sequence diversity at evolutionary branch points.</p>
    <p>The premise of our study was that a substantial increase in the scope of ASR will provide (a) a rich resource for evolutionary studies, and (b) valuable guidance for protein engineering, given the demonstrated usefulness of ancestral enzymes as robust templates for directed evolution [<xref rid="pcbi.1010633.ref008" ref-type="bibr">8</xref>]. Accordingly, our method was designed with a view to identifying substitutions, insertions, and deletions that may be combined to form sequence configurations inspired by, but not necessarily present in, either extant or inferred ancestral sequences. Recent advances in protein engineering have shown this to be an effective way of surveying sequence space and here we applied similar approaches explicitly to ancestors [<xref rid="pcbi.1010633.ref017" ref-type="bibr">17</xref>]. In particular, we sought to evaluate if inferred sequences and positions of indels can be used as building blocks to engineer biologically active ancestors. This, in turn, demands that we first identify a practical approach for their inference, in parallel with substitutions.</p>
    <p>In brief, this paper demonstrates the capacity of an approach based on POGs and maximum likelihood inference to perform ASR of large protein families and assist in the design of novel biocatalysts. Specifically, we explored the impact of quantity, diversity, and taxonomic context of input sequences on predicted sequences as well as resurrected structures and functions. Critically, we evaluated the prospect of re-purposing indel events inferred from the evolutionary record to compose and resurrect “hybrid” ancestors.</p>
    <p>Experimentally, we resurrected ancestral proteins from three families (exemplifying various degrees of sequence number, functional diversity, and sequence similarity) and evaluated these in terms of their structure and function. First, the glucose-methanol-choline (GMC) oxidoreductases represent a super-family of enzymes with varying biological functions and industrial applications; we focused on the enzymes glucose dehydrogenase (GDH, EC 1.1.5.9) and glucose oxidase (GOx, EC 1.1.2.4) [<xref rid="pcbi.1010633.ref018" ref-type="bibr">18</xref>]. Second, members of cytochrome P450 subfamily 2 (CYP2) play a key role in drug and xenobiotic metabolism in metazoans [<xref rid="pcbi.1010633.ref019" ref-type="bibr">19</xref>]. Here we concentrated on the CYP2U subfamily and two closely-related subfamilies, CYP2R, and CYP2D. Thirdly, the IlvD/ED dehydratase family includes dihydroxy-acid dehydratase (EC 4.2.1.9) and several sugar acid dehydratases all containing iron-sulfur-clusters across a broad taxonomic scope [<xref rid="pcbi.1010633.ref020" ref-type="bibr">20</xref>]. We refer to this family as DHAD. It is present in bacteria, archaea, fungi, algae, and in some plants. We also evaluated the large-scale inference of, but did not resurrect, the ketol-acid reductoisomerase (KARI) family, which includes enzymes in the branched-chain amino acid biosynthetic pathway (similar to DHAD) present in bacteria, fungi, and plants. We focused on KARI class I for a large-scale inference, and class II for a comparison between existing tools, having previously successfully resurrected ancestors of class II enzymes [<xref rid="pcbi.1010633.ref008" ref-type="bibr">8</xref>].</p>
  </sec>
  <sec sec-type="results" id="sec002">
    <title>Results</title>
    <sec id="sec003">
      <title>GRASP infers partially ordered ancestor graphs, representing substitutions, insertions, and deletions</title>
      <p>GRASP implements maximum likelihood for inference of ancestor states within trees, which in turn are graphical models [<xref rid="pcbi.1010633.ref021" ref-type="bibr">21</xref>]. It uses efficient algorithms developed for Bayesian networks [<xref rid="pcbi.1010633.ref022" ref-type="bibr">22</xref>] to process volumes of data that are unprecedented in the field of ASR.</p>
      <p>Unlike other reconstruction methods, GRASP uses POGs to represent sequence content, including insertions and deletions, to allow for (1) inference and visualisation of indel events across ancestors, and (2) representation of candidate ancestors as alternative paths through an ancestor POG, as described in Methods and illustrated in <xref rid="pcbi.1010633.g001" ref-type="fig">Fig 1</xref>.</p>
      <fig position="float" id="pcbi.1010633.g001">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1010633.g001</object-id>
        <label>Fig 1</label>
        <caption>
          <title>Phylogenetic tree showing a reconstruction of fungal GDH and GOx sequences decorated with illustrations of key concepts used within GRASP.</title>
          <p><bold>A</bold>, Two extant POGs (<italic toggle="yes">j</italic> indicates extant sequence number) mapped to an ancestral POG. Each extant POG has a single path through strictly ordered sequence positions (<italic toggle="yes">i</italic> indicates position). Ancestral states are influenced by all sequences, which explains why <italic toggle="yes">i</italic> = 608 is inferred as glycine, despite glycine not appearing in either sequence <italic toggle="yes">j</italic> = 359 or 360. <bold>B</bold>, Three ancestor POGs showing most probable assignments from a joint reconstruction at positions <italic toggle="yes">i</italic> ∈ {315, …, 327} for nodes N7, N8, and N9. GRASP supports the simultaneous viewing of multiple ancestors from a joint reconstruction, enabling a direct comparison at different time points. <bold>C</bold>, A single ancestor POG showing inferred marginal distributions at positions <italic toggle="yes">i</italic> ∈ {243, …, 254} for node N320. For marginal reconstructions, nodes are coloured according to their posterior probabilities and can be queried to view histograms of these underlying distributions, as is done for position <italic toggle="yes">i</italic> = 244. The marginal reconstruction from (c) was used to reconstruct the inferred ancestor (N320) as well as an alternative ancestor in which a single amino acid (N320_Y244E) was altered based on posterior probabilities from the marginal distribution that resulted in increased thermal stability (<xref rid="pcbi.1010633.s001" ref-type="supplementary-material">S1 Table</xref>).</p>
        </caption>
        <graphic xlink:href="pcbi.1010633.g001" position="float"/>
      </fig>
      <p>GRASP infers ancestor POGs from an input POG that represents a set of aligned homologous sequences and an input phylogenetic tree describing their evolutionary relationships. It does this in three stages that are designed to deconvolute sources of sequence variation.</p>
      <list list-type="order">
        <list-item>
          <p>A history of indel events is inferred by either maximum likelihood or maximum parsimony and mapped onto the tree to determine which positions contain actual sequence content (<xref rid="pcbi.1010633.g001" ref-type="fig">Fig 1A</xref>).</p>
        </list-item>
        <list-item>
          <p>For each ancestral position, the most probable character (to explain those observed at the leaves) is assigned to each phylogenetic branch point when performing a <italic toggle="yes">joint reconstruction</italic> (<xref rid="pcbi.1010633.g001" ref-type="fig">Fig 1B</xref>). Alternatively, for each position at a nominated branch point, the probability distribution over all possible characters is inferred when performing a <italic toggle="yes">marginal reconstruction</italic> (<xref rid="pcbi.1010633.g001" ref-type="fig">Fig 1C</xref>).</p>
        </list-item>
        <list-item>
          <p>Edges are drawn to represent <italic toggle="yes">all</italic> inferred combinations of indels to form an ancestor POG with nodes that can form a valid sequence with inferred content; a preferred path through the POG is then inferred, nominating a single, best supported sequence.</p>
        </list-item>
      </list>
      <p>For GDH and GOx, we used GRASP to identify potential substitution variants through analysis of inferred distributions via marginal reconstruction. Marginal reconstruction is frequently performed to account for uncertainties in reconstructed sequences, suggest alternative or variant ancestors, and explore properties such as thermal stability or substrate preference in inferred variants (<xref rid="pcbi.1010633.g001" ref-type="fig">Fig 1C</xref>, <xref rid="pcbi.1010633.s001" ref-type="supplementary-material">S1 Table</xref>).</p>
    </sec>
    <sec id="sec004">
      <title>GRASP implements novel options for inferring indel histories</title>
      <p>Insertions and deletions at branch points introduce a major source of variation in sequence. Not all reconstruction tools model indels, but several consider each sequence position independently and infer “gaps” in ancestors through parsimony (PAML/LAZARUS [<xref rid="pcbi.1010633.ref023" ref-type="bibr">23</xref>]) or by probability based on the presence of gaps in descendants (GASP [<xref rid="pcbi.1010633.ref024" ref-type="bibr">24</xref>], FireProt<sup>ASR</sup> [<xref rid="pcbi.1010633.ref025" ref-type="bibr">25</xref>]). By referencing extant and ancestor sequences in a multiple sequence alignment, extended gaps are accounted for by simple indel coding (SIC) that regards deletions as equivalent if they start and end at the same positions [<xref rid="pcbi.1010633.ref026" ref-type="bibr">26</xref>]. This in turn means that gaps have a binary state; they are either present or absent in a sequence. When gaps are considered relative to another, a third option “inapplicable” applies to a gap that is “contained” by another, thereby allowing preferences to be followed when multiple gap states are possible. It is therefore possible to encode a set of deletions by SIC and infer the optimal presence of each deletion independently at evolutionary branch points by parsimony or maximum likelihood (FastML [<xref rid="pcbi.1010633.ref027" ref-type="bibr">27</xref>]).</p>
      <p>GRASP implements three methods for encoding patterns of insertions and deletions from the set of input sequences: position-specific (PS) encoding, SIC, and a novel method that considers indels as edges in a POG, which we refer to as bi-directional edge (BE) encoding. Similar to SIC, BE encodes indels by their start and end positions in a multiple sequence alignment. However, BE does not treat indels with either shared start <italic toggle="yes">or</italic> shared end positions independently when viewed from the alignment. Indeed, BE allows the inference to differentiate between deletions that start at the same position but end at different positions (forward direction) as well as to differentiate deletions that end at the same position but start at different positions (backward direction). From the point of the resulting (unaligned) ancestor sequence, GRASP basically determines (for each site) the best neighbours both to its right and its left. Every indel event can then be designated as absent from the ancestor or present, and deemed to be optimal in one, both, or neither direction.</p>
      <p>GRASP implements both parsimony and maximum likelihood to infer indel histories based on any of the three encodings, giving six indel inference options (PS-P, PS-ML, SIC-P, SIC-ML, BE-P, and BE-ML). For all options, GRASP represents ancestors as POGs, which can be used to identify the most supported path, which in turn is a contiguous sequence.</p>
    </sec>
    <sec id="sec005">
      <title>Bi-directional edge methods return fewer unique indel events</title>
      <p>It is not obvious to what extent predicted indel variants differ at ancestral branch points in a given evolutionary tree, based on the choice of encoding and inference method. Moreover, given the unavailability of historical data, we are limited to evaluating the accuracy of predicted indel events on simulated data. We used INDELible [<xref rid="pcbi.1010633.ref028" ref-type="bibr">28</xref>] to generate indel histories at four indel rates (rate of indel events relative to substitution events) and for four taxon sizes (number of extant sequences within each data set), which resulted in phylogenetic trees and sequences with identified gaps at all branch points and leaves.</p>
      <p>These parameters gave alignments with an overall percentage of gaps that were either comparable to or contained more gaps than the non-simulated data within this study (<xref rid="pcbi.1010633.s002" ref-type="supplementary-material">S1</xref> and <xref rid="pcbi.1010633.s003" ref-type="supplementary-material">S2</xref> Figs).</p>
      <p>In each run, these gapped sequences form an alignment where all positions are guaranteed to be homologous regardless of the number of indel events (<xref rid="pcbi.1010633.s004" ref-type="supplementary-material">S3 Fig</xref>). The combination of tree and alignment from INDELible allows indel events (defined by start and end position) to be tracked and retrieved from branch points to measure the accuracy of the reconstruction at different rates and taxon sizes. We defined accuracy as the percentage of correctly recovered indel events (by position and branch point). The simulation of each setting was repeated to render different data sets to determine the variance explained by random factors.</p>
      <p>All six indel inference options recovered the correct length of ancestor sequence at the root, for each taxon size and indel rate, across every replicate. Accuracy was consistent and variance decreased as taxon size increased for a given indel rate, and accuracy decreased as the indel rate increased (<xref rid="pcbi.1010633.g002" ref-type="fig">Fig 2A</xref>). The number of indels that were consistently identified or consistently missed by all methods stayed constant as taxon size increased for a given indel rate. As the indel rate increased, the number of consistently identified and consistently missed indels decreased and increased, respectively (<xref rid="pcbi.1010633.g002" ref-type="fig">Fig 2B</xref>).</p>
      <fig position="float" id="pcbi.1010633.g002">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1010633.g002</object-id>
        <label>Fig 2</label>
        <caption>
          <title>Results of indel evaluation of each of GRASP’s indel methods across 1) simulated data where the correct alignment and correct tree are supplied and 2) simulated data where a realigned alignment and correct tree are supplied across four indel rates (0.001, 0.005, 0.01, 0.03) and four taxon sizes (100, 250, 500, 750).</title>
          <p><bold>A</bold>, Number of correct indels identified by each method for each taxon size for each indel rate (<italic toggle="yes">N</italic> = 5). <bold>B</bold>, Number of indels uniformly identified by all methods or uniformly missed by all methods for each taxon size for each indel rate (<italic toggle="yes">N</italic> = 5). <bold>C</bold>, Number of indels uniquely identified by each indel method at four taxon sizes at indel rate 0.03, organised by indel type and size (<italic toggle="yes">N</italic> = 5).</p>
        </caption>
        <graphic xlink:href="pcbi.1010633.g002" position="float"/>
      </fig>
      <p>As all methods performed comparatively and to simulate more challenging and realistic scenarios, we realigned the sequences generated by INDELible with MAFFT; we then used this realigned data with the original trees to generate additional sets of ancestors. In this scenario, we could no longer directly measure accuracy because the re-aligned sequences probably implied indels with different start and end positions. We therefore evaluated the effect of indel rate and taxon size on the sequence length at root and qualitative differences in the sets of indels identified by each indel inference method. This in turn would enable us to understand which indel inference method offers the broadest support in the pursuit of indel variants for engineering applications.</p>
      <p>Under the realigned conditions at the highest indel rate, SIC returned root ancestors with longer sequence length regardless of the inference method or taxon size (<xref rid="pcbi.1010633.s005" ref-type="supplementary-material">S4(A) Fig</xref>). There was substantial overlap in indels predicted by each method. That said, BE methods identified fewer <italic toggle="yes">unique</italic> indels than PS or SIC methods (see <xref rid="pcbi.1010633.s005" ref-type="supplementary-material">S4(B) Fig</xref> for an example replicate from the largest taxa size with the highest indel rate). The number of unique events predicted by all methods increased with both indel rate and taxon size, but BE methods tended to identify fewer. Moreover, BE was more often in agreement with at least <italic toggle="yes">one</italic> other method, compared to either SIC or PS. PS methods and SIC-P returned higher numbers of unique one-residue indels and SIC methods returned higher numbers of unique indels of length greater than three (<xref rid="pcbi.1010633.g002" ref-type="fig">Fig 2C</xref> and <xref rid="pcbi.1010633.s006" ref-type="supplementary-material">S5 Fig</xref>). Unlike BE, SIC focuses on the representation of gaps rather than the edges that make up a sequence. SIC assumes that the starting point is a linear sequence, on which gaps are superimposed. SIC does not inherently resolve conflicts between multiple, partially overlapping indels, which are independently predicted at each branch point. POGs do not explicitly represent gaps, allowing predicted, conflicted indels to be separated. The conversion to a linear sequence involves choices that benefit from considering the evolutionary context and can be ascertained across multiple branch points in the phylogenetic tree.</p>
      <p>FastML implements SIC and offers both maximum parsimony and maximum likelihood inference, the latter with a gene loss/gain model.</p>
      <p>We used parsimony inference to ensure that the implementations were comparable, noting that FastML presents a single state for each indel (independent of all other indels) as evident by the ancestor sequence. The flexibility of ancestor POGs enables GRASP to present both presence and absence of indel when both are deemed optimal (still independent of all other indels).</p>
      <p>While FastML infers sequences and GRASP infers POGs, we tested at each branch point if the POG contained a valid path for the sequence predicted by FastML. For INDELible trees with 50 extants and 50 positions, even at the highest indel rates, SIC-predicted POGs contained the corresponding FastML prediction. At 100 extants and longer sequences, a small number of deviations occurred, which we expect are due to restrictions imposed by mapping inferred encodings to a valid POG.</p>
      <p>Unexpectedly, the indel tests with known alignments where ancestral indel events could be tracked precisely showed little difference between encoding and inference method. With non-curated alignments, there is a greater difference between methods. To next evaluate if insertions and deletions can be used as building blocks to engineer biologically active ancestors, we opted to use the BE encoding, which was better at capturing what the others also captured while containing less outlier indels; we opted for parsimony inference, which seemed to perform comparably to maximum likelihood but was generally quicker.</p>
    </sec>
    <sec id="sec006">
      <title>Indel variation can be used to create hybrid ancestors</title>
      <p>The insertion or deletion of sequence blocks is well established as a means by which natural proteins evolve new functions. However, previous attempts to use insertions and deletions in protein engineering have been confounded by the fact that indels frequently compromise protein integrity. The location of the insertion or deletion determines its tolerability, but suitable locations are not necessarily evident from the structure and even less so from the sequence alone.</p>
      <p>We hypothesised that indel events suggest plausible blocks of sequence content that could be included or excluded in identified ancestors as a novel approach to creating ancestral variants, orthogonal to substitution. GRASP utilises the history of indel events to predict modular blocks of content capable of being removed from ancestors in which they occur or inserted into ancestors that never contained these modules. In doing this, GRASP fundamentally extends the nature and practical application of modulating variation within ancestors and is capable of identifying modular insertions that are well tolerated and can affect properties such as thermal stability and substrate specificity. The ability to manipulate both of these properties is desirable for protein engineering.</p>
      <p>We used GRASP to identify two distinct lineage-specific insertions within the CYP2U/CYP2R/CYP2D data set (LSEE, LLSPP), occurring at nodes N5 and N51 (<xref rid="pcbi.1010633.g003" ref-type="fig">Fig 3</xref>). We synthesised the inferred ancestors N5 and N51, as well as a more ancient ancestor, N2, that did not contain either insertion. We removed the insertion LSEE from N5 at sequence position 153 (N5_153dLSEE) and removed the insertion LLSPP from N51 at sequence position 27 (N51_27dLLSPP). We then separately inserted them into N2 at the equivalent sequence positions 152 (N2_152iLSEE) and 27 (N2_27iLLSPP). Similarly, we tested two variants of the N1 CYP2U ancestor. One form contained a CYP2U-specific insertion of 19 amino acids (N1), and in the other this insertion was removed to resemble the CYP2R and CYP2D sequences (N1_18dIPP…RR).</p>
      <fig position="float" id="pcbi.1010633.g003">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1010633.g003</object-id>
        <label>Fig 3</label>
        <caption>
          <title>A, Phylogenetic tree showing positions of CYP2U/CYP2R/CYP2D ancestors chosen for synthesis and evaluation.</title>
          <p>Coloured boxes indicate the content that was removed from correspondingly coloured ancestral nodes (N51, N5, and N1) and, in the case of the N51 and N5 insertions, preemptively inserted into N2. <bold>B</bold>, Amino acid sequences surrounding and including the insertion or deletion of the content at each ancestor. Numbers under sequences indicate the position numbers of the start and end columns represented in the alignment. <bold>C</bold>, Thermal stability assays for each ancestor with and without inserted content. Data are means +/- SEM, <italic toggle="yes">N</italic> = 2, ns indicates a not significant result. <bold>D, E</bold>, Activity assays for the substrates luciferin CEE and luciferin ME-EGE for each ancestor with and without inserted content. Membranes from cells expressing only human CPR are included as a negative control. Different symbols indicate different experimental repeats, performed in triplicate, lines indicate mean and standard deviation, and p-values were determined by a two-tailed Student’s <italic toggle="yes">t</italic>-test. No data points were excluded.</p>
        </caption>
        <graphic xlink:href="pcbi.1010633.g003" position="float"/>
      </fig>
      <p>All ancestral proteins inferred via this process were heterologously expressed in <italic toggle="yes">Escherichia coli</italic> and characterised. They were shown to express at similar levels and form intact haem-thiolate linkages as indicated by the characteristic spectral peak at 450 nm in the Fe(II).CO vs. Fe(II) difference spectrum (<xref rid="pcbi.1010633.s007" ref-type="supplementary-material">S6 Fig</xref>), indicative of a properly folded cytochrome P450 enzyme. All were catalytically active towards at least one substrate, when tested with three different P450-Glo luminogenic probe substrates, luciferins MultiCYP, ME-EGE, and CEE. Therefore, the presence or absence of these lineage-specific insertions was not essential for the protein folding, cofactor binding, or interaction with the cytochrome P450 reductase. However, it was observed that the lineage-specific insertions did alter the substrate selectivity of the otherwise identical ancestors.</p>
      <p>Both N5 and N51 were active towards both luciferins CEE and ME-EGE, while N2 was only active towards luciferin ME-EGE. Loss of the insertion LLSPP from N51 reduced its activity towards luciferin CEE, and the corresponding gain of the LLSPP insertion in the N2 ancestor increased its activity towards luciferin CEE. Neither loss of the insertion LSEE from N5 nor gain of the insertion LSEE in N2 had an effect on luciferin CEE dealkylase activity. The presence of the LSEE insertion in the N2 and N5 ancestors increased both ancestors’ activity towards luciferin ME-EGE. Inclusion of the LLSPP insertion did not have a consistent effect on activity towards luciferin ME-EGE, whereas inclusion increased activity towards ME-EGE in N2, but not in N51. The N1 ancestor was only active towards luciferin MultiCYP, but N1_18dIPP…RR was slightly active towards all three pro-luciferin substrates, suggesting this insertion may also alter the selectivity of the ancestor.</p>
      <p>The LLSPP insertion also modulated the thermal stability of the ancestors; the insertion produced a small but statistically significant increase in the thermal stability in both the N2 and N51 ancestors, compared to their variants lacking this insertion (<xref rid="pcbi.1010633.g003" ref-type="fig">Fig 3C</xref>). This effect was not seen for the LSEE insertion (<xref rid="pcbi.1010633.g003" ref-type="fig">Fig 3C</xref>), suggesting that these effects are protein and sequence specific.</p>
      <p>The major alpha helices in the cytochrome P450 fold are named sequentially from A-L, following the protein backbone [<xref rid="pcbi.1010633.ref029" ref-type="bibr">29</xref>]. Both insertions discussed here occur within loops in either the AA loop (LLSPP insertion) or the D-E loop (LSEE insertion) of CYP2U. The AA loop occurs near the N-terminal region of the protein and is thought to be involved with protein-membrane interactions. The D-E loop is a surface loop and is not located near the structurally important regions, such as the haem binding pocket, the CPR-interaction interface and the putative substrate entry channel [<xref rid="pcbi.1010633.ref030" ref-type="bibr">30</xref>, <xref rid="pcbi.1010633.ref031" ref-type="bibr">31</xref>]. Both the AA’ loop and the D-E loop are both surface loops positioned on the distal side of the haem cofactor but while the AA’ loop is located near the transmembrane helix and is expected to be partially embedded in the membrane, the D-E loop is structurally distant from the AA’ loop [<xref rid="pcbi.1010633.ref030" ref-type="bibr">30</xref>, <xref rid="pcbi.1010633.ref031" ref-type="bibr">31</xref>] (<xref rid="pcbi.1010633.s008" ref-type="supplementary-material">S7(A) Fig</xref>).</p>
      <p>The effects of these ancestral insertions were investigated using models generated using AlphaFold2 run via ColabFold. [<xref rid="pcbi.1010633.ref032" ref-type="bibr">32</xref>, <xref rid="pcbi.1010633.ref033" ref-type="bibr">33</xref>] (<xref rid="pcbi.1010633.s008" ref-type="supplementary-material">S7(B) Fig</xref>). However, due to poor confidence in the AA’ loop region prediction (<xref rid="pcbi.1010633.s008" ref-type="supplementary-material">S7(C)–S7(E) Fig</xref>), the structural models did not yield any additional insights into a role of loop truncation in CYP2U thermal stability. Similarly, only minor changes to the D-E loop were observed for the ancestors bearing the LSEE insertion (<xref rid="pcbi.1010633.s008" ref-type="supplementary-material">S7(F) Fig</xref>).</p>
      <p>Finally, we considered whether the indels in CYP2U ancestors resulted from changes to the intron/exon boundaries in the CYP2U1 gene but were unable to find strong evidence either for or against this hypothesis.</p>
    </sec>
    <sec id="sec007">
      <title>Using more sequences reduces variance in inferred ancestral sequences</title>
      <p>GRASP is able to process large numbers of sequences (i.e., greater than 10,000), which is necessary to capture the true diversity of the sequence space. Intuitively, more data equates to better coverage (and resolution) of the biological sequence space. If this saturation of data is based on true homology, the level of variance is reduced in inferred ancestral states relative to reconstructions from less data. This intuition has been shown to be supported in experiments on smaller data sets [<xref rid="pcbi.1010633.ref034" ref-type="bibr">34</xref>]. Here, we generalise this assertion for a much larger data set that contains the added complexity of obscured homology, due to a greater presence of indel events.</p>
      <p>Indel handling is critical for ASR, yet routinely problematic, and the accurate management of indel events is essential to decide on the extent of sequence content to include for any particular ancestor [<xref rid="pcbi.1010633.ref014" ref-type="bibr">14</xref>]. As data set sizes grow, the number of columns in a sequence alignment, or positions in a POG, increases substantially and the indel histories may appear more complicated. Therefore, increasing the number of sequences does not necessarily lead to inferences of increasingly invariant ancestral sequences.</p>
      <p>Evidence that ancestors are constrained to a specific invariant form as the number of sequences increases must be combined with evidence that this form is viable and not a sequence that has been converged upon arbitrarily. To test the effect of increasing data set size on ancestral inference, we assembled sequence data sets for the DHAD and CYP2U protein families via increments of sequence data (see <xref rid="sec010" ref-type="sec">Methods</xref>) and compared the ancestral inferences for each data set size (<xref rid="pcbi.1010633.g004" ref-type="fig">Fig 4A–4D</xref>), ranging from 1,612 to 9,112 sequences for DHAD and between 165 and 595 sequences for CYP2U. The DHAD data sets were increased by adding sequences from across the DHAD taxonomic space, while the CYP2U data sets were increased by adding sequences from sister groups CYP2R and CYP2D while retaining the same number of CYP2U sequences at each point. For the DHAD data set we also performed a sparse reconstruction of 585 sequences, containing primarily reviewed Swiss-Prot sequences.</p>
      <fig position="float" id="pcbi.1010633.g004">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1010633.g004</object-id>
        <label>Fig 4</label>
        <caption>
          <title>A, Phylogenetic trees of the smallest and largest DHAD data sets after producing 14 randomly sampled data sets in 500 sequence increments, added to our base data set of 1,612 sequences and reaching a maximum size of 9,112 sequences.</title>
          <p><bold>B</bold>, Heat maps of the fractional distances between ancestor sequences generated from different DHAD data set sizes, representing the same (principal) three branch points. <bold>C</bold>, Phylogenetic trees of the smallest and largest data sets after increasing CYP2U sequences via addition of homologous subfamilies, starting with 165 CYP2U sequences then growing to 359 sequences and reaching a maximum of 595 sequences via addition of sequences from CYP2R and CYP2D, respectively. <bold>D</bold>, Heat maps of the fractional distances between ancestor sequences resulting from different CYP2U data set sizes representing the same two branch points. Ancestors from the N4/N5 equivalent branch points across the three data set sizes had 98% identity, which cannot be discerned visually. <bold>E</bold>, Heat map of the average fractional distance of 50 randomly selected ancestors between the KARI I data sets, ranging from 1,176 to 11,756 sequences.</p>
        </caption>
        <graphic xlink:href="pcbi.1010633.g004" position="float"/>
      </fig>
      <p>With GRASP, we observed that as data set size increased, the predicted ancestor sequences approached invariant forms in terms of amino acid sequence at equivalent phylogenetic nodes between different tree sizes. To further illustrate these trends, we inferred KARI ancestors in regular increments ranging from 1,176 sequences to 11,756 sequences. These ancestors also converged towards invariant forms with the addition of more sequences (<xref rid="pcbi.1010633.g004" ref-type="fig">Fig 4E</xref>). While the number of positions in the input sequence alignment generally increased with coverage, the length of the ancestor sequences was not correlated with the number of input sequences (<xref rid="pcbi.1010633.s009" ref-type="supplementary-material">S8 Fig</xref>).</p>
      <p>GRASP was able to complete the reconstruction of the largest data sets in this study within 7 hours for DHAD (9,112 sequences, 1,381 positions in alignment) and within 6 hours for KARI (11,756 sequences, 667 positions) (<xref rid="pcbi.1010633.s010" ref-type="supplementary-material">S9 Fig</xref>).</p>
      <p>Ancestral proteins inferred from the smallest and largest data sets for both DHAD and CYP2U were all active towards expected substrates, despite differences in ancestral sequence identity between the two extremes of data set size (DHAD 75%, CYP2U 80% sequence identity). All DHAD ancestors displayed enzymatic activity to D-gluconate. We observed that three DHAD ancestral proteins from the smallest data set had thermal shift profiles comparable to those of the three ancestors that were located in equivalent tree positions in the largest data set (<xref rid="pcbi.1010633.s011" ref-type="supplementary-material">S10 Fig</xref>). For two of the three DHAD reference ancestors, the melting points in the proteins from the larger reconstruction were increased by approximately 5°C relative to their counterparts from the smaller data set (<xref rid="pcbi.1010633.s011" ref-type="supplementary-material">S10 Fig</xref>). Likewise, the inclusion of the sister clades for the CYP2U reconstruction increased the thermal stability of the CYP2U whole-subfamily ancestors inferred from each set (165, 359, and 595 sequences) and these ancestors were all shown to be active towards the substrate, luciferin MultiCYP (<xref rid="pcbi.1010633.s012" ref-type="supplementary-material">S11 Fig</xref>).</p>
    </sec>
    <sec id="sec008">
      <title>On smaller data sets, GRASP’s predictions are consistent with the predictions of existing methods</title>
      <p>We compared GRASP against two alternative ASR tools, selected due to their dominant use in the literature: FastML [<xref rid="pcbi.1010633.ref035" ref-type="bibr">35</xref>] and the aaml program from the Phylogenetic Analysis by Maximum Likelihood (PAML) package [<xref rid="pcbi.1010633.ref036" ref-type="bibr">36</xref>]. We were able to produce ancestral proteins from reconstructions produced by GRASP, FastML, and PAML on a CYP2U/CYP2R data set comprising 359 sequences. To compare between indel inference methods again, we noted that GRASP (BE) and FastML (SIC) returned the same indel composition at their root ancestors and this pattern was overlaid onto the prediction from PAML, which was run without gap inference. The oldest CYP2U ancestors had ∼95% sequence identity and, regardless of the tool used, ancestral proteins expressed at similar levels in <italic toggle="yes">E. coli</italic>, displayed characteristic cytochrome P450 spectra and activities towards the luciferin MultiCYP substrate, and had similar thermal stabilities (<xref rid="pcbi.1010633.s013" ref-type="supplementary-material">S12 Fig</xref>).</p>
      <p>To make statements about the accuracy of ancestral predictions is problematic as the historically correct and complete evolutionary record is unavailable. To sidestep this issue, we first applied each tool and configuration to generate multiple predictions of the <italic toggle="yes">same</italic> principal ancestor branch point based on successively smaller subsets of a given sequence family. Secondly, we performed two tests asking: (a) between tools, how similar is the prediction of one tool to those of the others; and (b) how similar is the prediction of one tool from the sub-sampled data to a better-sampled ancestor, predicted from the <italic toggle="yes">complete</italic> family? We reasoned that a better method would be one which tended to agree with the majority of others, and one that with <italic toggle="yes">less</italic> data tended to agree with a prediction based on <italic toggle="yes">more</italic> data (assuming that more data help to improve a prediction).</p>
      <p>A large alignment of 1,682 sequences (KARI class II, adapted from Gumulya et al. [<xref rid="pcbi.1010633.ref008" ref-type="bibr">8</xref>]) and the corresponding phylogenetic tree were divided into sub-groups and used to assess the effect of tool, data set size, and reconstruction parameters on ancestral inference (see <xref rid="sec010" ref-type="sec">Methods</xref> for details). We sought to corroborate any trends using a second independent data set (CYP2 with 975 sequences).</p>
      <p>Test (a) measured similarity between ancestors inferred using a given set of tool parameters and group size (<xref rid="pcbi.1010633.g005" ref-type="fig">Fig 5A</xref> and <xref rid="pcbi.1010633.s014" ref-type="supplementary-material">S13A Fig</xref>); specifically, we observed fractional distances <italic toggle="yes">D</italic>/<italic toggle="yes">L</italic> (where <italic toggle="yes">D</italic> is the number of substitutions, of <italic toggle="yes">L</italic> non-gapped, homologous positions) between sequences predicted for each condition tested. Test (b) measured similarity in terms of fractional distances between ancestor predictions of an individual tool (with a given set of parameters and group sample size) and a better-sampled ancestor using all available data (<xref rid="pcbi.1010633.g005" ref-type="fig">Fig 5B</xref> and <xref rid="pcbi.1010633.s014" ref-type="supplementary-material">S13B Fig</xref>). The better-sampled ancestor for the comparison in (b) was predicted by GRASP, because a data set of this size could not be completed by FastML or PAML. A series of statistical tests were performed. First, ANOVA was used to evaluate whether the choice of tool, data set size, and rate parameter setting were factors in determining how similar a predicted ancestor sequence (grouped by tool/size/rate setting) was to those predicted by alternative tools with the same setting (test a) and to those generated from the complete data set (test b). A <italic toggle="yes">t</italic>-test was then used to identify the pairs of labels (on groups) that best explained the observed differences (<xref rid="pcbi.1010633.s015" ref-type="supplementary-material">S14 Fig</xref> and <xref rid="pcbi.1010633.s016" ref-type="supplementary-material">S15 Fig</xref>).</p>
      <fig position="float" id="pcbi.1010633.g005">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1010633.g005</object-id>
        <label>Fig 5</label>
        <caption>
          <title>Tool comparison on KARI data.</title>
          <p><bold>A</bold>, Average fractional distance between tools, calculated as pairwise fractional distances for each ancestral prediction for a given tool against all other ancestral predictions of other tools using 5 groups of 336 or 337 sequences, 10 groups of 168 or 169 sequences, or 20 groups of 84 or 85 sequences. Parameter choices are joint (J) vs. marginal (M) reconstruction and fixed vs. variable evolutionary rates (FastML and PAML only). <bold>B</bold>, Average fractional distance between a better-sampled ancestor inferred by GRASP using 1,682 sequences and each tool / parameter combination at 5, 10, and 20 groups. <bold>C</bold>, Run times of GRASP and FastML at 5 and 10 groups; PAML was omitted due to long run times. Run times for all tools at 10 and 20 groups are shown in <xref rid="pcbi.1010633.s017" ref-type="supplementary-material">S16 Fig</xref>.</p>
        </caption>
        <graphic xlink:href="pcbi.1010633.g005" position="float"/>
      </fig>
      <p>While GRASP can perform character inference via variable evolutionary rates when estimated externally, we opted to use the default uniform rate. Both FastML and PAML estimate position-specific rates internally, so we set out to understand the impact of rate setting. When comparing predictions between tools (test a) or between tool and better-sampled ancestor (test b), both the choice of tool and data set size separately and consistently explained the observed differences in distances; however the rate setting did not.</p>
      <p>The choice of tool mattered for both types of comparisons across the two data sets. GRASP and FastML predictions were generally more similar in terms of mean pairwise fractional distance, both relative to the better-sampled ancestor and relative to the ancestors predicted by PAML. Indeed, greater sequence numbers generally reduced distances between tools and the distances between a tool’s predictions and the ancestor based on the complete data set.</p>
      <p>We also calculated the time taken for all tools to complete the reconstructions with a run time cut-off of 48 hours (<xref rid="pcbi.1010633.s017" ref-type="supplementary-material">S16 Fig</xref>) and highlighted the time taken for GRASP and FastML to complete the two larger data set sizes (<xref rid="pcbi.1010633.g005" ref-type="fig">Fig 5C</xref>).</p>
    </sec>
  </sec>
  <sec sec-type="conclusions" id="sec009">
    <title>Discussion</title>
    <p>Increasing the scale at which ASR can be performed means that greater sequence and functional diversity can be explored and more complicated phylogenetic relationships can be evaluated [<xref rid="pcbi.1010633.ref011" ref-type="bibr">11</xref>]. Incorporating data from sister clades and remote homologs can allow ancestors to be inferred with greater robustness at greater evolutionary distances. We substantiated these points computationally and experimentally by resurrecting twenty ancestral variants across three enzyme families, all of which were shown to be catalytically active.</p>
    <p>At greater scale, ASR will increasingly require judgements to be made as to whether ancestors contain an insertion or deletion present in only some of the multiple descendent branches of a phylogenetic tree. The presence of these events may pinpoint loop remodelling events [<xref rid="pcbi.1010633.ref037" ref-type="bibr">37</xref>] or other conformational diversity in the family. The evolution of conformational diversity may promote entirely new functions and provide a source of variation that protein engineers can exploit [<xref rid="pcbi.1010633.ref009" ref-type="bibr">9</xref>, <xref rid="pcbi.1010633.ref010" ref-type="bibr">10</xref>].</p>
    <p>At the core of our approach is the POG data structure, originally proposed to facilitate multiple sequence alignment [<xref rid="pcbi.1010633.ref038" ref-type="bibr">38</xref>, <xref rid="pcbi.1010633.ref039" ref-type="bibr">39</xref>]. We developed inference methods to directly use the POG data structure to pinpoint likely phylogenetic positions for indel events from homologs placed in an alignment. It effectively delineates sequence content at all internal nodes of a given phylogenetic tree, and collectively enables the evolutionary relationships between all branch points to be traced. As a consequence, evolutionary events that are isolated to specific clades, and alignment ambiguities that are difficult to resolve at a single branch point, can be disentangled across time. In contrast to current approaches based on gapped sequence representations, POGs enable the identification of all supported indel histories across a reconstructed family. In GRASP, edges that are partially supported but are not chosen to form the preferred ancestral sequence still appear as alternative paths through the POG; multiple branch points can be inspected and contrasted at once. GRASP thus provides a framework to delete, reintroduce, or preemptively include indel variation that supports both exploring sequence space and creating new function.</p>
    <p>Hybrid ancestors represent a novel class of variant that can be identified readily and resurrected through the partitioning of indel events onto individual edges within a POG. The identification of alternative indels, each compatible with a given ancestor (or nearby ancestors) can be used to test alternative hypotheses about the progression of evolutionary events where there is uncertainty in the inferred evolutionary history. In addition, combinations of compatible indels can be sampled in order to engineer novel sequences by including or removing blocks of sequence content. Strikingly, given the substantial impact that indel events are likely to have on any protein sequence, coupled with the divergence between chosen ancestral sequences, all hybrid ancestors we reconstructed were functional.</p>
    <p>With CYP2U as an example, we showed that hybrid ancestors folded to form holoenzymes that are catalytically active when tested <italic toggle="yes">in vitro</italic> and are capable of interacting with the native human reductase. Additionally, with CYP2U, we showed that inclusion of these modular blocks allowed for increased thermal stability and altered substrate preference. We stress that we are not attributing the increased stability or interaction with a specific substrate solely to the identified insertion. Rather, GRASP identified blocks of content that are likely to be tolerated at positions at which such changes have occurred during natural evolution, despite any effect they have on folding and function of these ancestral proteins. Due to the complex nature of protein folding and epistasis, these blocks will not always behave in predictable ways and effects will depend on the ancestral sequence and sequence context into which they are being inserted.</p>
    <p>The identification of modular insertions altered the substrate selectivity, not unlike how substitution variants identified by marginal reconstruction have in previous studies [<xref rid="pcbi.1010633.ref008" ref-type="bibr">8</xref>]. This study provides a proof-of-concept that indel histories can suggest a form of variation that protein engineers can use that is orthogonal to varying specific amino acids. We foresee this as being of practical use for (1) altering function through the addition and removal of discrete, evolutionarily-defined building blocks to engineer variants with altered catalytic and physical properties (e.g. thermal stability) and (2) exploring alternative ancestors where there is ambiguity in the true phylogenetic position of an indel.</p>
    <p>There are multiple options available for predicting indel events, and on simulated data they perform equally well. Bi-directional edge methods, which consider indels in the context of other possible choices, allow more opportunities to decide between alternative pathways and provide better ways to represent ambiguity when equally parsimonious or equally likely scenarios exist. This may prove beneficial to the protein engineer, who may have access to secondary data to guide their selection for applied purposes, including knowledge of structure or residue interaction.</p>
    <p>ASR has been used extensively in recent years [<xref rid="pcbi.1010633.ref004" ref-type="bibr">4</xref>, <xref rid="pcbi.1010633.ref009" ref-type="bibr">9</xref>, <xref rid="pcbi.1010633.ref011" ref-type="bibr">11</xref>] and it is important to understand the relative performance of different tools, and to recognise proven principles that underpin successful methods. We note that FastML is in broad agreement with GRASP, with predictions made by FastML showing closer evolutionary distances to predictions made by GRASP than to those generated by PAML. We also demonstrated that incorporating more sequence data resulted in smaller fractional distances between inferred ancestors, regardless of the tool used.</p>
    <p>Based on the analyses of KARI and DHAD, we demonstrated that despite an increase in diversity, ancestral sequences converge towards invariant forms when using data sets with almost 10,000 sequences. Ancestral sequences generated from smaller data sets exhibit greater variation in ancestral sequence identity relative to the ancestral sequences from larger data sets. This supports the notion that greater representation of a family provides a constraint for the ancestor, i.e. that robust reconstructions are best achieved when available sequence data is exploited to the fullest extent.</p>
  </sec>
  <sec sec-type="materials|methods" id="sec010">
    <title>Methods</title>
  </sec>
  <sec id="sec011">
    <title>GRASP implementation</title>
    <p>The three main stages of GRASP are (1) to construct an indel history for every position in the alignment, (2) to infer character states for each ancestor, for all positions relevant to it (subject to step 1), and (3) to form a POG for each ancestor by linking all inferred character states (subject to steps 1 and 2) and optionally suggesting one path to generate a single sequence.</p>
    <p>GRASP infers ancestor character states from a set of <italic toggle="yes">M</italic> input sequences <inline-formula id="pcbi.1010633.e001"><alternatives><graphic xlink:href="pcbi.1010633.e001.jpg" id="pcbi.1010633.e001g" position="anchor"/><mml:math id="M1" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="bold">S</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>:</mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">J</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pcbi.1010633.e002"><alternatives><graphic xlink:href="pcbi.1010633.e002.jpg" id="pcbi.1010633.e002g" position="anchor"/><mml:math id="M2" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">J</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>; <bold>S</bold> has <italic toggle="yes">N</italic> aligned positions, indexed with <inline-formula id="pcbi.1010633.e004"><alternatives><graphic xlink:href="pcbi.1010633.e004.jpg" id="pcbi.1010633.e004g" position="anchor"/><mml:math id="M4" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, where <inline-formula id="pcbi.1010633.e005"><alternatives><graphic xlink:href="pcbi.1010633.e005.jpg" id="pcbi.1010633.e005g" position="anchor"/><mml:math id="M5" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">I</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. In classical sequence alignments, positions without sequence content are padded, often shown as ‘–’; we use <inline-formula id="pcbi.1010633.e006"><alternatives><graphic xlink:href="pcbi.1010633.e006.jpg" id="pcbi.1010633.e006g" position="anchor"/><mml:math id="M6" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi mathvariant="double-struck">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>⊆</mml:mo><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> to index positions in sequence <italic toggle="yes">j</italic> with actual sequence content, <italic toggle="yes">S</italic><sub><italic toggle="yes">ji</italic></sub> = <italic toggle="yes">x</italic> where <inline-formula id="pcbi.1010633.e007"><alternatives><graphic xlink:href="pcbi.1010633.e007.jpg" id="pcbi.1010633.e007g" position="anchor"/><mml:math id="M7" display="inline" overflow="scroll"><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> when <inline-formula id="pcbi.1010633.e008"><alternatives><graphic xlink:href="pcbi.1010633.e008.jpg" id="pcbi.1010633.e008g" position="anchor"/><mml:math id="M8" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1010633.e009"><alternatives><graphic xlink:href="pcbi.1010633.e009.jpg" id="pcbi.1010633.e009g" position="anchor"/><mml:math id="M9" display="inline" overflow="scroll"><mml:mi mathvariant="script">A</mml:mi></mml:math></alternatives></inline-formula> is the set of amino acids. Later, it will be convenient to refer to <inline-formula id="pcbi.1010633.e010"><alternatives><graphic xlink:href="pcbi.1010633.e010.jpg" id="pcbi.1010633.e010g" position="anchor"/><mml:math id="M10" display="inline" overflow="scroll"><mml:msup><mml:mi mathvariant="double-struck">J</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>, which indexes all sequences <italic toggle="yes">with content</italic> at position <italic toggle="yes">i</italic>.</p>
    <p>Inference is based on a given phylogenetic tree <italic toggle="yes">T</italic> with a nominated root, that has <italic toggle="yes">M</italic> − 1 branch points (if bifurcating, fewer when multifurcating) indexed by <inline-formula id="pcbi.1010633.e011"><alternatives><graphic xlink:href="pcbi.1010633.e011.jpg" id="pcbi.1010633.e011g" position="anchor"/><mml:math id="M11" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">K</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mi>M</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>; we designate the index <italic toggle="yes">k</italic> = <italic toggle="yes">M</italic> + 1 for the root of the tree, by convention also labelled “N0” (followed by “N1”, “N2”, … enumerated per depth-first in many tools including GRASP). The superset of extant and ancestor sequences (matched to POGs) is indexed by <inline-formula id="pcbi.1010633.e012"><alternatives><graphic xlink:href="pcbi.1010633.e012.jpg" id="pcbi.1010633.e012g" position="anchor"/><mml:math id="M12" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">Z</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">J</mml:mi><mml:mo>∪</mml:mo><mml:mi mathvariant="double-struck">K</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. The topology of <italic toggle="yes">T</italic> defines parent-child relationships, <inline-formula id="pcbi.1010633.e013"><alternatives><graphic xlink:href="pcbi.1010633.e013.jpg" id="pcbi.1010633.e013g" position="anchor"/><mml:math id="M13" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi mathvariant="double-struck">Z</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>⊆</mml:mo><mml:mi mathvariant="double-struck">Z</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> indexes the ancestral descendants of an ancestor <italic toggle="yes">k</italic>; conversely, we define a function <italic toggle="yes">κ</italic>(<italic toggle="yes">k</italic>′) = <italic toggle="yes">k</italic>″ to indicate that <italic toggle="yes">k</italic>″ is the direct ancestor of <italic toggle="yes">k</italic>′, where <inline-formula id="pcbi.1010633.e014"><alternatives><graphic xlink:href="pcbi.1010633.e014.jpg" id="pcbi.1010633.e014g" position="anchor"/><mml:math id="M14" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">Z</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>.</p>
    <p>Character states are inferred with an evolutionary model (in the form of an instantaneous rate matrix, indexed by <inline-formula id="pcbi.1010633.e015"><alternatives><graphic xlink:href="pcbi.1010633.e015.jpg" id="pcbi.1010633.e015g" position="anchor"/><mml:math id="M15" display="inline" overflow="scroll"><mml:mi mathvariant="script">A</mml:mi></mml:math></alternatives></inline-formula>) and maximum likelihood [<xref rid="pcbi.1010633.ref040" ref-type="bibr">40</xref>]. Inference is implemented via a Bayesian network that shares the topology of a position-specific tree, which is <italic toggle="yes">T</italic> minus the ancestors without content at the position. The position-specific trees are constructed by an indel inference method (in turn informed by an indel encoding). While GRASP implements a number of different encodings, our focus below is on bi-directional edge encoding, which is new.</p>
    <p>Below, we first define key data structures, then we distinguish between: (a) the handling of <italic toggle="yes">where</italic> homologous positions are placed relative to one another in the trace of ancestral sequences via POGs; and (b) the principles by which homologous positions in extant sequences are used to determine ancestral character states at branch points in the phylogenetic tree. The principles under (b) are unremarkable in themselves, but key benefits are achieved by using them in the ancestor POG from (a). For succinctness, we describe this procedure as it applies to a bifurcating tree; however, the same principles extend seamlessly to multifurcating trees.</p>
    <sec id="sec012">
      <title>Representing sequence content as a partial order graph (POG)</title>
      <p>A POG is a directed acyclic graph whose elements are ordered relative to other elements; a strict ordering is enforced <italic toggle="yes">within</italic> a subset of elements, but not always <italic toggle="yes">between</italic> subsets. When an order is imposed among elements, the relationship must be reflexive, anti-symmetric, and transitive [<xref rid="pcbi.1010633.ref016" ref-type="bibr">16</xref>]. A growing body of work in sequence alignment has demonstrated the flexibility that POGs offer for detecting and representing homologous sequence elements during alignment [<xref rid="pcbi.1010633.ref038" ref-type="bibr">38</xref>, <xref rid="pcbi.1010633.ref039" ref-type="bibr">39</xref>, <xref rid="pcbi.1010633.ref041" ref-type="bibr">41</xref>]. We take advantage of the flexibility of POGs when projecting homologous elements back in time; they represent deletions and insertions by edges that exclude or include alternative character subsets allowing for optional histories by offering multiple paths at ancestral branch points.</p>
      <p>Formally, a POG is defined by a set of (up to) <italic toggle="yes">N</italic> nodes that are indexed by <inline-formula id="pcbi.1010633.e016"><alternatives><graphic xlink:href="pcbi.1010633.e016.jpg" id="pcbi.1010633.e016g" position="anchor"/><mml:math id="M16" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. The indices are determined by performing a topological sort on the “input POG” (see below); this gives at least one linear and complete ordering (out of several possible).</p>
      <p>Nodes are connected by a set of directed edges, which is conveniently represented by a so-called adjacency matrix <bold>E</bold>, where <bold>E</bold>(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) is set to 1 if there is an edge from <italic toggle="yes">a</italic> to <italic toggle="yes">b</italic>, and otherwise 0; <italic toggle="yes">a</italic> is topologically <italic toggle="yes">before</italic>
<italic toggle="yes">b</italic>, meaning that a <italic toggle="yes">uni-directional</italic> graph can be represented by above-diagonal elements in <bold>E</bold>.</p>
      <p>We introduce an extended index-set <inline-formula id="pcbi.1010633.e017"><alternatives><graphic xlink:href="pcbi.1010633.e017.jpg" id="pcbi.1010633.e017g" position="anchor"/><mml:math id="M17" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="double-struck">I</mml:mi><mml:mo>*</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> for rows and columns in <bold>E</bold>, with 0 and <italic toggle="yes">N</italic> + 1 to start and terminate the POG, so <inline-formula id="pcbi.1010633.e018"><alternatives><graphic xlink:href="pcbi.1010633.e018.jpg" id="pcbi.1010633.e018g" position="anchor"/><mml:math id="M18" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">I</mml:mi><mml:mo>*</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1010633.e019"><alternatives><graphic xlink:href="pcbi.1010633.e019.jpg" id="pcbi.1010633.e019g" position="anchor"/><mml:math id="M19" display="inline" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">I</mml:mi><mml:mo>*</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</p>
      <p>We define <italic toggle="yes">next</italic>(<bold>E</bold>, <italic toggle="yes">a</italic>) = {<italic toggle="yes">b</italic>: <bold>E</bold>(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) &gt; 0} and <italic toggle="yes">prev</italic>(<bold>E</bold>, <italic toggle="yes">b</italic>) = {<italic toggle="yes">a</italic>: <bold>E</bold>(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) &gt; 0} to refer to sets of nodes that occur after and before a node with a given index, respectively. <italic toggle="yes">next</italic>(<bold>E</bold>, 0) would thus give all possible start indices, and <italic toggle="yes">prev</italic>(<bold>E</bold>, <italic toggle="yes">N</italic> + 1) all terminating indices.</p>
      <p>Moreover, we define <italic toggle="yes">path</italic>(<bold>E</bold>) to return all indices in <inline-formula id="pcbi.1010633.e020"><alternatives><graphic xlink:href="pcbi.1010633.e020.jpg" id="pcbi.1010633.e020g" position="anchor"/><mml:math id="M20" display="inline" overflow="scroll"><mml:mi mathvariant="double-struck">I</mml:mi></mml:math></alternatives></inline-formula> that can be accessed from 0 and <italic toggle="yes">N</italic> + 1, via recursive application of <italic toggle="yes">next</italic> and <italic toggle="yes">prev</italic>, respectively.</p>
      <p>We distinguish between three types of POGs, the first two are determined directly from <bold>S</bold>, and the third by inference. All POGs share the node index <inline-formula id="pcbi.1010633.e021"><alternatives><graphic xlink:href="pcbi.1010633.e021.jpg" id="pcbi.1010633.e021g" position="anchor"/><mml:math id="M21" display="inline" overflow="scroll"><mml:mi mathvariant="double-struck">I</mml:mi></mml:math></alternatives></inline-formula>, which allows character states to be mapped across extant sequences and ancestors (illustrated in <xref rid="pcbi.1010633.g001" ref-type="fig">Fig 1</xref>).</p>
      <list list-type="bullet">
        <list-item>
          <p>An “extant POG”, is defined by a set of edges <bold>E</bold><sup>(<italic toggle="yes">j</italic>)</sup> specific to an extant sequence <italic toggle="yes">S</italic><sub><italic toggle="yes">j</italic></sub>, where <inline-formula id="pcbi.1010633.e022"><alternatives><graphic xlink:href="pcbi.1010633.e022.jpg" id="pcbi.1010633.e022g" position="anchor"/><mml:math id="M22" display="inline" overflow="scroll"><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">J</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. <italic toggle="yes">path</italic>(<bold>E</bold><sup>(<italic toggle="yes">j</italic>)</sup>) recovers the indices in <inline-formula id="pcbi.1010633.e023"><alternatives><graphic xlink:href="pcbi.1010633.e023.jpg" id="pcbi.1010633.e023g" position="anchor"/><mml:math id="M23" display="inline" overflow="scroll"><mml:msup><mml:mi mathvariant="double-struck">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>; <bold>E</bold><sup>(<italic toggle="yes">j</italic>)</sup> forms a single path of “character” nodes <italic toggle="yes">X</italic><sub><italic toggle="yes">ji</italic></sub> = <italic toggle="yes">S</italic><sub><italic toggle="yes">ji</italic></sub> where <inline-formula id="pcbi.1010633.e024"><alternatives><graphic xlink:href="pcbi.1010633.e024.jpg" id="pcbi.1010633.e024g" position="anchor"/><mml:math id="M24" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>.</p>
        </list-item>
        <list-item>
          <p>An “input POG”, denoted <inline-formula id="pcbi.1010633.e025"><alternatives><graphic xlink:href="pcbi.1010633.e025.jpg" id="pcbi.1010633.e025g" position="anchor"/><mml:math id="M25" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">E</mml:mi><mml:mo>*</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">J</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi mathvariant="bold">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> represents the joint set of edges collected from extant sequences. The presence of an edge between <italic toggle="yes">a</italic> and <italic toggle="yes">b</italic> is indicated by <bold>E</bold>*(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) &gt; 0.</p>
        </list-item>
        <list-item>
          <p>An “ancestor POG”, is inferred to have a set of edges <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup> where <inline-formula id="pcbi.1010633.e026"><alternatives><graphic xlink:href="pcbi.1010633.e026.jpg" id="pcbi.1010633.e026g" position="anchor"/><mml:math id="M26" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">K</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. It links a series of nodes <italic toggle="yes">Y</italic><sub><italic toggle="yes">ki</italic></sub> where <inline-formula id="pcbi.1010633.e027"><alternatives><graphic xlink:href="pcbi.1010633.e027.jpg" id="pcbi.1010633.e027g" position="anchor"/><mml:math id="M27" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">I</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>; each node either identifies a character state, or defines a probability distribution over character states. The latter is referred to as a “distribution” node. Once the POG for ancestor <italic toggle="yes">k</italic> is inferred, <italic toggle="yes">path</italic>(<bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup>) recovers its valid indices <inline-formula id="pcbi.1010633.e028"><alternatives><graphic xlink:href="pcbi.1010633.e028.jpg" id="pcbi.1010633.e028g" position="anchor"/><mml:math id="M28" display="inline" overflow="scroll"><mml:msup><mml:mi mathvariant="double-struck">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>;</p>
          <p>as discussed in the next section, we use the below-diagonal elements to represent the state of support for <italic toggle="yes">bi-directional</italic> edges.</p>
        </list-item>
      </list>
    </sec>
    <sec id="sec013">
      <title>Inference of ancestral states, insertions, and deletions</title>
      <p>The phylogenetic tree with a nominated root and the collection of extant POGs serve as input to inference. GRASP supports two types of inference:</p>
      <list list-type="bullet">
        <list-item>
          <p>marginal reconstruction at a specified ancestral branch point in the phylogenetic tree; as a result of inference, the nominated ancestor POG will contain distribution nodes that represent the marginal distributions of character states.</p>
        </list-item>
        <list-item>
          <p>joint reconstruction of all ancestral branch points; all ancestor POGs will contain character nodes that represent the most likely character states.</p>
        </list-item>
      </list>
      <sec id="sec014">
        <title>Inferring insertions and deletions at ancestor branch points</title>
        <p><bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup> defines all possible paths that can form a valid sequence at the branch point <italic toggle="yes">k</italic> and therefore determines if a character state needs to be inferred at any given position. This section describes how <italic toggle="yes">bi-directional edge</italic> encoding refers to <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup> and recovers <inline-formula id="pcbi.1010633.e029"><alternatives><graphic xlink:href="pcbi.1010633.e029.jpg" id="pcbi.1010633.e029g" position="anchor"/><mml:math id="M29" display="inline" overflow="scroll"><mml:msup><mml:mi mathvariant="double-struck">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></alternatives></inline-formula> (valid positions in ancestor <italic toggle="yes">k</italic>) by implication. The principle is illustrated by example in <xref rid="pcbi.1010633.g006" ref-type="fig">Fig 6</xref>.</p>
        <fig position="float" id="pcbi.1010633.g006">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1010633.g006</object-id>
          <label>Fig 6</label>
          <caption>
            <title>A tree with five extant sequences and ancestors with bi-directional and uni-directional support for different edges shown.</title>
            <p><bold>A</bold>, Input POG and the matrix E* (recovering all edges under consideration for ancestors). Red squares refer to all edges involving position 5 (occupied by W in all sequences). Non-zero entries in the red squares identify indices for 2 and 4, as well as the end terminus. <bold>B</bold>, Ancestor POGs (labelled N0-N3) are shown at branch points as inferred by bi-directional edge parsimony. Solid arrows indicate bi-directional support; dashed arrows indicate uni-directional support. For uni-directional edges, the direction of support is shown by the direction of the arrow. The N1 ancestor is annotated to illustrate the relationship between indices in an ancestral matrix and the edges in the resulting ancestor POGs. The (<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) and (<italic toggle="yes">b</italic>, <italic toggle="yes">a</italic>) indices are highlighted for select positions—for example, (4,5) and (5,4) are the forwards support from index 4—5 and backwards support from index 5—4 (green boxes and green edge in N1) showing that the edge from 4—5 is supported in both directions. The edge from 2—5 is supported going forward but not backward (blue boxes and blue edge in N1). Other edges forward from index 2 are maximally parsimonious in the forward direction at N1, such as 2—3 and 2—4, but only the support for 4 is reciprocated (purple boxes and purple edges in N1) recovering a “preferred” path from 2 to 4 to 5 in N1. <bold>C</bold>, Extant POGs, with position indices.</p>
          </caption>
          <graphic xlink:href="pcbi.1010633.g006" position="float"/>
        </fig>
        <p>GRASP enumerates all edges in <bold>E</bold>* and infers <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup> at each ancestor <italic toggle="yes">k</italic> by either <italic toggle="yes">maximum parsimony</italic> or <italic toggle="yes">maximum likelihood</italic>. This inference involves solving multiple independent optimisation problems, avoiding scalability issues of earlier approaches [<xref rid="pcbi.1010633.ref012" ref-type="bibr">12</xref>, <xref rid="pcbi.1010633.ref013" ref-type="bibr">13</xref>]. GRASP assigns scores (for parsimony) or probabilities (for maximum likelihood) to (combinations of) edges leaving and edges entering each reference position <italic toggle="yes">i</italic>. In other words, the goal is to infer for each position in an ancestor the best left and right neighbours. In the simplest case, a position in an ancestor has a single left neighbour and single right neighbour and this resolves to a linear sequence. In cases where a position has more than two neighbours, we benefit from representing these alternative neighbours as paths in a POG. This means that each edge is in fact evaluated twice: once in the forward direction, once in the backward direction. To formally distinguish the two evaluations, we refer to (<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) and (<italic toggle="yes">b</italic>, <italic toggle="yes">a</italic>), where <italic toggle="yes">a</italic> and <italic toggle="yes">b</italic> are topologically sorted position indices; in other words, the diagonal of the adjacency matrix distinguishes forward from backward edges.</p>
        <p><italic toggle="yes">Bi-directional edge parsimony</italic> finds the edges at all ancestors that imply the lowest cost <italic toggle="yes">across</italic> the tree; the total cost is seen at the root node (<italic toggle="yes">k</italic> = <italic toggle="yes">M</italic> + 1). To trace the changes implied by the cost at the root, i.e. to determine what edge is preferred at each branch point, <xref rid="pcbi.1010633.e036" ref-type="disp-formula">Eq 3</xref> defines a score <inline-formula id="pcbi.1010633.e031"><alternatives><graphic xlink:href="pcbi.1010633.e031.jpg" id="pcbi.1010633.e031g" position="anchor"/><mml:math id="M31" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> for each edge (<italic toggle="yes">forward</italic> from <italic toggle="yes">a</italic> to <italic toggle="yes">b</italic>) at an ancestor <italic toggle="yes">k</italic>, which in turn depends on its children, recursively. That edge is scored for the same ancestor a second time <inline-formula id="pcbi.1010633.e032"><alternatives><graphic xlink:href="pcbi.1010633.e032.jpg" id="pcbi.1010633.e032g" position="anchor"/><mml:math id="M32" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> (<italic toggle="yes">backward</italic> from <italic toggle="yes">b</italic> to <italic toggle="yes">a</italic>) (<xref rid="pcbi.1010633.e037" ref-type="disp-formula">Eq 4</xref>; <xref rid="pcbi.1010633.g006" ref-type="fig">Fig 6</xref>). For each position and direction, the edges to choose between are available in <bold>E</bold>*; this number varies widely between positions and the direction considered.</p>
        <p>As per standard parsimony, traversing the branch relative to an ancestor, the score of an edge depends on what edges are selected in the descendant branch points: retaining the edge is cost-free, whereas changing to a different edge will cost 1 (<xref rid="pcbi.1010633.e038" ref-type="disp-formula">5</xref>). The recursion ends at each extant sequence, at which a choice is made between an edge that either exists (as indicated by <bold>E</bold><sup>(<italic toggle="yes">j</italic>)</sup>(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) = 1) or does not exist (<bold>E</bold><sup>(<italic toggle="yes">j</italic>)</sup>(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) = 0). Taking the negative logarithm of this gives either 0 or ∞, forcing the selection of the edge extracted from the extant sequence (Eqs <xref rid="pcbi.1010633.e036" ref-type="disp-formula">3</xref> and <xref rid="pcbi.1010633.e037" ref-type="disp-formula">4</xref>). Edge choices that lead to the best parsimony score at the top-most branch point are traced back and recorded at each branch point <italic toggle="yes">k</italic> in <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup>; considering direction, <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup>(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) = 1 if (<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) forms part of the optimal trace; likewise, <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup>(<italic toggle="yes">b</italic>, <italic toggle="yes">a</italic>) = 1 if (<italic toggle="yes">b</italic>, <italic toggle="yes">a</italic>) is chosen, utilising either side of the diagonal of the matrix. For an ancestor <italic toggle="yes">k</italic>, its POG includes an edge (<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) if <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup>(<italic toggle="yes">a</italic>, <italic toggle="yes">b</italic>) + <bold>E</bold><sup>(<italic toggle="yes">k</italic>)</sup>(<italic toggle="yes">b</italic>, <italic toggle="yes">a</italic>) &gt; 0; if the sum is 2, that edge is <italic toggle="yes">bi-directionally parsimonious</italic>, implying preference when identifying ancestor sequences (<xref rid="pcbi.1010633.g006" ref-type="fig">Fig 6</xref>).
<disp-formula id="pcbi.1010633.e034"><alternatives><graphic xlink:href="pcbi.1010633.e034.jpg" id="pcbi.1010633.e034g" position="anchor"/><mml:math id="M34" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="2pt"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">E</mml:mi><mml:mo>*</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1)</label></disp-formula>
<disp-formula id="pcbi.1010633.e035"><alternatives><graphic xlink:href="pcbi.1010633.e035.jpg" id="pcbi.1010633.e035g" position="anchor"/><mml:math id="M35" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:munder><mml:mrow><mml:mtext>arg</mml:mtext><mml:mspace width="2pt"/><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>v</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">E</mml:mi><mml:mo>*</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2)</label></disp-formula>
<disp-formula id="pcbi.1010633.e036"><alternatives><graphic xlink:href="pcbi.1010633.e036.jpg" id="pcbi.1010633.e036g" position="anchor"/><mml:math id="M36" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:msup><mml:mi mathvariant="double-struck">Z</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:munderover><mml:munder><mml:mtext>min</mml:mtext><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">E</mml:mi><mml:mo>*</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:mo>Δ</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">K</mml:mi></mml:mrow><mml:mspace width="4pt"/><mml:mtext>(</mml:mtext><mml:mi>c</mml:mi><mml:mspace width="4pt"/><mml:mtext>is</mml:mtext><mml:mspace width="4pt"/><mml:mtext>ancestor)</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mo>-</mml:mo><mml:mtext>ln</mml:mtext><mml:mspace width="2pt"/><mml:msup><mml:mrow><mml:mi mathvariant="bold">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>c</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>otherwise</mml:mtext><mml:mspace width="4pt"/><mml:mtext>(</mml:mtext><mml:mi>c</mml:mi><mml:mspace width="4pt"/><mml:mtext>is</mml:mtext><mml:mspace width="4pt"/><mml:mtext>extant)</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(3)</label></disp-formula>
<disp-formula id="pcbi.1010633.e037"><alternatives><graphic xlink:href="pcbi.1010633.e037.jpg" id="pcbi.1010633.e037g" position="anchor"/><mml:math id="M37" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:msup><mml:mi mathvariant="double-struck">Z</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:munderover><mml:munder><mml:mtext>min</mml:mtext><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>v</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">E</mml:mi><mml:mo>*</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:munder><mml:mo>Δ</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>v</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">K</mml:mi></mml:mrow><mml:mspace width="4pt"/><mml:mtext>(</mml:mtext><mml:mi>c</mml:mi><mml:mspace width="4pt"/><mml:mtext>is</mml:mtext><mml:mspace width="4pt"/><mml:mtext>ancestor)</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mo>-</mml:mo><mml:mtext>ln</mml:mtext><mml:mspace width="2pt"/><mml:msup><mml:mrow><mml:mi mathvariant="bold">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>c</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>otherwise</mml:mtext><mml:mspace width="4pt"/><mml:mtext>(</mml:mtext><mml:mi>c</mml:mi><mml:mspace width="4pt"/><mml:mtext>is</mml:mtext><mml:mspace width="4pt"/><mml:mtext>extant)</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(4)</label></disp-formula>
<disp-formula id="pcbi.1010633.e038"><alternatives><graphic xlink:href="pcbi.1010633.e038.jpg" id="pcbi.1010633.e038g" position="anchor"/><mml:math id="M38" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>Δ</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mspace width="4pt"/><mml:mtext>(no</mml:mtext><mml:mspace width="4pt"/><mml:mtext>change)</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>otherwise</mml:mtext><mml:mspace width="4pt"/><mml:mtext>(different</mml:mtext><mml:mspace width="4pt"/><mml:mtext>edge)</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(5)</label></disp-formula></p>
        <p>The equations define the implementation of bi-directional edge parsimony in GRASP, but one special case warrants attention; when one or more extant sequences is missing the reference position (<italic toggle="yes">a</italic> in <xref rid="pcbi.1010633.e036" ref-type="disp-formula">Eq 3</xref> or <italic toggle="yes">b</italic> in <xref rid="pcbi.1010633.e037" ref-type="disp-formula">Eq 4</xref>) a “no edge” state can be added to the total set of edges considered and thus compete with normal edges at ancestors. This option is currently available through the command line implementation of GRASP. To enhance readability, we have refrained from including it in the equations and matrices. The legacy approach (used for all experimentally validated predictions in this manuscript) is to (a) exclude the reference position at ancestors for which <italic toggle="yes">all</italic> extants are missing, and (b) infer a value for all remaining ancestors selected from those seen in other extants.</p>
        <p>For <italic toggle="yes">maximum likelihood</italic>, like parsimony, each edge is evaluated twice, for each ancestor. Again, like parsimony, this is framed as two inferences for each reference position <italic toggle="yes">i</italic>: a choice between all edges leading forward from <italic toggle="yes">i</italic> and a choice between all edges backward from <italic toggle="yes">i</italic>. Given that the number of edges that are considered jointly varies, we apply uniform evolutionary models with a congruent number of states, following the principle of Jukes-Cantor. Inference determines the combination of states, across all ancestors, that has the greatest joint probability, following the maximum likelihood approach described in the next subsection for character states, which are similarly set at the leaves of the tree. As with parsimony, we need to consider the special case that arises from extant sequence that exclude characters at the reference position; again, a special “no edge” option competes with the edges that are indeed found in other extants at the same position. We note also that edges are attached to multiple positions and therefore branch lengths dictate how quickly they change, even when position-specific rates are available.</p>
        <p>Both maximum parsimony and maximum likelihood optimise the selection of edges that have, independently, the same source or the same target, so there is no guarantee that there is a complete path through the POG where all edges are bi-directionally supported; however, in practice this turns out to be mostly the case.</p>
      </sec>
      <sec id="sec015">
        <title>Inferring the character state of ancestor nodes</title>
        <p>For GRASP to infer character states and operate efficiently, we make several standard assumptions. First, we assume that each sequence position, <italic toggle="yes">i</italic>, can be modelled independently [<xref rid="pcbi.1010633.ref040" ref-type="bibr">40</xref>]. Second, we assume that character substitutions depend only on the state of the immediate ancestor [<xref rid="pcbi.1010633.ref040" ref-type="bibr">40</xref>].</p>
        <p>GRASP itself does not estimate position-specific evolutionary rates [<xref rid="pcbi.1010633.ref042" ref-type="bibr">42</xref>, <xref rid="pcbi.1010633.ref043" ref-type="bibr">43</xref>] but can use rates that are inferred jointly with the phylogenetic tree inference by tools such as IQ-TREE 2 [<xref rid="pcbi.1010633.ref044" ref-type="bibr">44</xref>]. In the absence of position-specific rates, GRASP assumes a fixed rate and that the tree is consistent with that.</p>
        <p>The topology of the phylogenetic tree maps to a character tree for each position, subject to the position <inline-formula id="pcbi.1010633.e039"><alternatives><graphic xlink:href="pcbi.1010633.e039.jpg" id="pcbi.1010633.e039g" position="anchor"/><mml:math id="M39" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> in an ancestor <italic toggle="yes">k</italic> forming part of a valid sequence; for later, we define a transposition of that mapping as <inline-formula id="pcbi.1010633.e040"><alternatives><graphic xlink:href="pcbi.1010633.e040.jpg" id="pcbi.1010633.e040g" position="anchor"/><mml:math id="M40" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, i.e. the subset of ancestors that have character content for a position <italic toggle="yes">i</italic>.</p>
        <p>Each position-specific character tree maps to a directed Bayesian network, which is parameterised to reflect evolutionary distances (additively) at each branch, from the provided phylogenetic tree. The network is created with “observable” variables, instantiated to the characters in extant sequences <italic toggle="yes">X</italic><sub><italic toggle="yes">ji</italic></sub> = <italic toggle="yes">x</italic>. “Non-observable” variables in the Bayesian network correspond to the ancestors <italic toggle="yes">Y</italic><sub><italic toggle="yes">ki</italic></sub> where <inline-formula id="pcbi.1010633.e041"><alternatives><graphic xlink:href="pcbi.1010633.e041.jpg" id="pcbi.1010633.e041g" position="anchor"/><mml:math id="M41" display="inline" overflow="scroll"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>; how the character state or distribution for <italic toggle="yes">Y</italic><sub><italic toggle="yes">ki</italic></sub> is inferred is described below.</p>
        <p>A Bayesian network node is a conditional probability <italic toggle="yes">P</italic>(<italic toggle="yes">X</italic><sub><italic toggle="yes">ji</italic></sub>|<italic toggle="yes">Y</italic><sub><italic toggle="yes">κ</italic>(<italic toggle="yes">j</italic>)<italic toggle="yes">i</italic></sub>, <italic toggle="yes">d</italic><sub><italic toggle="yes">j</italic></sub>) or <italic toggle="yes">P</italic>(<italic toggle="yes">Y</italic><sub><italic toggle="yes">ki</italic></sub>|<italic toggle="yes">Y</italic><sub><italic toggle="yes">κ</italic>(<italic toggle="yes">k</italic>)<italic toggle="yes">i</italic></sub>, <italic toggle="yes">d</italic><sub><italic toggle="yes">k</italic></sub>), for <inline-formula id="pcbi.1010633.e042"><alternatives><graphic xlink:href="pcbi.1010633.e042.jpg" id="pcbi.1010633.e042g" position="anchor"/><mml:math id="M42" display="inline" overflow="scroll"><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">J</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1010633.e043"><alternatives><graphic xlink:href="pcbi.1010633.e043.jpg" id="pcbi.1010633.e043g" position="anchor"/><mml:math id="M43" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and is parameterised by their respective distances (<italic toggle="yes">d</italic><sub><italic toggle="yes">j</italic></sub> or <italic toggle="yes">d</italic><sub><italic toggle="yes">k</italic></sub>; which refer to their closest ancestor branch point, <italic toggle="yes">κ</italic>(<italic toggle="yes">j</italic>) or <italic toggle="yes">κ</italic>(<italic toggle="yes">k</italic>), respectively).</p>
        <p>The matrix of conditional probabilities is <italic toggle="yes">e</italic><sup><italic toggle="yes">Q</italic>(<italic toggle="yes">d</italic>)</sup> where <italic toggle="yes">Q</italic> is the instantaneous rate matrix given by the evolutionary model. GRASP supports all popular models [<xref rid="pcbi.1010633.ref045" ref-type="bibr">45</xref>–<xref rid="pcbi.1010633.ref048" ref-type="bibr">48</xref>]. Inference of the joint ancestral character state at a position <italic toggle="yes">i</italic> is then defined by:
<disp-formula id="pcbi.1010633.e044"><alternatives><graphic xlink:href="pcbi.1010633.e044.jpg" id="pcbi.1010633.e044g" position="anchor"/><mml:math id="M44" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>}</mml:mo></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">J</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mo>}</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>)</mml:mo><mml:mo>∝</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">J</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>κ</mml:mi><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>κ</mml:mi><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(6)</label></disp-formula>
where <italic toggle="yes">T</italic> is the tree with distances for all branches. The implementation uses an adaptation of variable elimination [<xref rid="pcbi.1010633.ref022" ref-type="bibr">22</xref>, <xref rid="pcbi.1010633.ref049" ref-type="bibr">49</xref>], which decomposes the inference into an efficient series of products, given the hierarchical topology of the tree. Ancestral states are determined by the highest <italic toggle="yes">joint probability</italic> across all non-observed variables (all ancestors, all positions). From the above, GRASP is also capable of inferring the <italic toggle="yes">marginal probability distribution</italic> for each position in a given ancestor, by summing out all other non-observed variables. All inferences are exact (not approximated). GRASP can make use of position-specific, relative evolutionary rates, which are estimated by external tools.</p>
        <p>Finally, GRASP facilitates an approach of exploring plausible alternative amino acids at sites with high Shannon entropy, by selecting residues that show a relatively high posterior probability in a marginal reconstruction [<xref rid="pcbi.1010633.ref008" ref-type="bibr">8</xref>]. Mutations can be introduced at these positions to test the robustness of predictions and to create alternative ancestors. GRASP extends this method, providing the ability to prioritise mutations that best capture inferred probability distributions by minimising the expected relative entropy.</p>
      </sec>
    </sec>
    <sec id="sec016">
      <title>Identifying a single, preferred ancestor sequence</title>
      <p>Not uncommonly, multiple indel histories are equally parsimonious or the preferred edge in one direction is not preferred in the other, implying that several ancestor candidate sequences can be identified by traversing an ancestor POG; however, in some applications it is necessary to nominate a single sequence.</p>
      <p>To determine a “preferred” path through an ancestor POG, we first define a subset of extant sequences <inline-formula id="pcbi.1010633.e045"><alternatives><graphic xlink:href="pcbi.1010633.e045.jpg" id="pcbi.1010633.e045g" position="anchor"/><mml:math id="M45" display="inline" overflow="scroll"><mml:msup><mml:mi mathvariant="double-struck">J</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></alternatives></inline-formula> that are in the subtree under a given ancestor, <italic toggle="yes">k</italic>. To express preference between multiple edges, we calculate the proportion of extant sequences that contain a particular edge (see <xref rid="pcbi.1010633.e030" ref-type="disp-formula">Eq 7</xref>).
<disp-formula id="pcbi.1010633.e030"><alternatives><graphic xlink:href="pcbi.1010633.e030.jpg" id="pcbi.1010633.e030g" position="anchor"/><mml:math id="M30" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi mathvariant="double-struck">J</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:msup><mml:mi mathvariant="double-struck">J</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(7)</label></disp-formula></p>
      <sec id="sec017">
        <title>Identifying the preferred path</title>
        <p>Like a Markov chain, GRASP uses weights (<xref rid="pcbi.1010633.e030" ref-type="disp-formula">Eq 7</xref>) to represent transition probabilities and can use these to find the most probable path, enforcing a preference for bi-directional edges.</p>
        <p>As an alternate option, GRASP also implements the A* algorithm [<xref rid="pcbi.1010633.ref050" ref-type="bibr">50</xref>] to determine the selection of edges in a POG that jointly minimises the cost, travelling from the N- to the C-terminus. Here, the cost assigned to an edge is given by <xref rid="pcbi.1010633.e033" ref-type="disp-formula">Eq 8</xref>.
<disp-formula id="pcbi.1010633.e033"><alternatives><graphic xlink:href="pcbi.1010633.e033.jpg" id="pcbi.1010633.e033g" position="anchor"/><mml:math id="M33" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>η</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>·</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>·</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:mo>-</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(8)</label></disp-formula>
<italic toggle="yes">η</italic> is defined in <xref rid="pcbi.1010633.e003" ref-type="disp-formula">Eq 9</xref> and imposes a preference for bi-directional edges; a uni-directional edge is only chosen in the absence of bi-directional edges to complete the traversal. The exception is the edge to the first node, and the edge from the last node, where bi-directionality is disregarded. The impact of the weight is normalised by the number of positions skipped by a given edge, <italic toggle="yes">b</italic> − <italic toggle="yes">a</italic>. This ensures that each complete ancestral sequence is scored evenly, regardless of the number of edges it takes to form.
<disp-formula id="pcbi.1010633.e003"><alternatives><graphic xlink:href="pcbi.1010633.e003.jpg" id="pcbi.1010633.e003g" position="anchor"/><mml:math id="M3" display="block" overflow="scroll"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>η</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mi>N</mml:mi></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">E</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mtext>,</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi>a</mml:mi><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mspace width="4pt"/><mml:mtext>and</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi>b</mml:mi><mml:mo>≠</mml:mo><mml:mi>N</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable><mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(9)</label></disp-formula></p>
      </sec>
    </sec>
  </sec>
  <sec id="sec018">
    <title>GRASP, FastML, and PAML comparison method</title>
    <p>The following procedure was used to evaluate each of the tools: (1) the input multiple sequence alignment was randomly divided into <italic toggle="yes">G</italic> groups of alignments with approximately equal numbers of sequences, where <italic toggle="yes">G</italic> ∈ {5, 10, 20}; (2) for each sub-alignment, the input phylogenetic tree constructed from the full alignment was pruned to remove sequences not in the sub-alignment. To represent the same principal ancestor across all groups, as well as to maintain a valid tree, branches in the original phylogenetic tree with removed sequences were collapsed and branch distances added together; (3) sub-alignments and corresponding pruned trees were therefore pared-down representatives of the same family and used as input to each of the ASR tools; (4) the process was repeated until 20 ancestral sequences had been generated for each configuration, e.g., when <italic toggle="yes">G</italic> = 5 the process is repeated four times. This procedure therefore results in sequences that belong to multiple groups across replicates for <italic toggle="yes">G</italic> = 5 and <italic toggle="yes">G</italic> = 10.</p>
    <p>The JTT evolutionary rate model [<xref rid="pcbi.1010633.ref046" ref-type="bibr">46</xref>] was used for all inferences and variable rates were calculated from a discrete gamma distribution with eight categories. To remove confounding effects of different strategies for dealing with gaps, we removed any column that contained a deletion, leaving 455 and 242 columns in the KARI and CYP2 multiple sequence alignments, respectively.</p>
  </sec>
  <sec id="sec019">
    <title>Indel inference comparison method</title>
    <p>INDELible was used to generate indel histories that followed a Zipfian distribution with an alpha value of 1.7 [<xref rid="pcbi.1010633.ref051" ref-type="bibr">51</xref>], maximum indel length of 10, LG substitution model, with all trees set to have an evolutionary depth of 1 and an original ancestral sequence length of 300 amino across four indel rates (relative to substitution rate) of 0.001, 0.005, 0.01, and 0.03 across four taxon sizes of 100, 250, 500, and 750 extant sequences. Any entirely empty columns in the alignment of extants (i.e., where there was character content in an ancestor that was completely absent across all extant sequences) were removed from both the extant and ancestral alignments.</p>
    <p>The known alignments and trees were provided to GRASP and each of the indel inference methods used to predict a set of ancestral sequences. The ancestral alignments from each method as well as the true history as generated by INDELible were used to generate sets of indels defined by the specific branch and start and end position of the indel event.</p>
    <p>The unaligned extant sequences were then also aligned by MAFFT (FFT-NS-2) and the analysis re-performed with realigned alignments and known trees provided to GRASP.</p>
    <sec id="sec020">
      <title>Tool availability</title>
      <p>GRASP is freely accessible via a web server at <ext-link xlink:href="http://grasp.scmb.uq.edu.au" ext-link-type="uri">http://grasp.scmb.uq.edu.au</ext-link>. The online service allows users to upload their own data sets and predict ancestors. The results are presented to allow exploration of ancestral POGs and their states via an interactive phylogenetic tree. Numerous other functions are available including annotation of trees with taxonomy and user specified terms, inspection of probability distributions for the identification of mutations for alternative ancestors, and sharing of entire reconstructions. A tutorial, user guide, and several example reconstructions are also available from the web site.</p>
      <p>Additional information and a suite of tools to assist in the application of GRASP are available at <ext-link xlink:href="https://bodenlab.github.io/GRASP-suite" ext-link-type="uri">https://bodenlab.github.io/GRASP-suite</ext-link>. An implementation of bi-directional edge parsimony indel inference that considers gaps as missing data rather than explicitly encoding gaps as an additional “no edge” state is available through the web server. All other indel inference methods as well as the option to either consider gaps as missing data or additional states are available through a separate command line version. The implementation in Java and a web application are available from the same site. The software is available under the GNU General Public License v3.0.</p>
    </sec>
  </sec>
  <sec id="sec021">
    <title>GDH-GOx experimental methods</title>
    <sec id="sec022">
      <title>GDH-GOx ancestral inference</title>
      <p>Starting from an aligned data set and phylogenetic tree previously established by Sützl et al. [<xref rid="pcbi.1010633.ref018" ref-type="bibr">18</xref>] for the GDH-GOx cluster, only the four major clades (GOx, GDH I, GDH II, and GDH III) were selected, together with the second small GDH III clade. All sequences with &gt;800 amino acids as well as manually selected sequences showing large insertions were removed from the selection, resulting in 399 sequences. This sequence selection was aligned by MAFFT v7.271 G-INS-i [<xref rid="pcbi.1010633.ref052" ref-type="bibr">52</xref>] and the alignment trimmed for positions with &gt;99% gaps by trimAl v1.2 [<xref rid="pcbi.1010633.ref053" ref-type="bibr">53</xref>]. The alignment was pruned using Gblocks 0.91b [<xref rid="pcbi.1010633.ref054" ref-type="bibr">54</xref>] with a less stringent block selection and the phylogenetic tree was inferred by PhyML [<xref rid="pcbi.1010633.ref055" ref-type="bibr">55</xref>] using default settings, with subtree pruning and regrafting to optimise tree topology, smart model selection, and aLRT SH-like branch support calculated. The tree was rooted on the midpoint. The full alignment, trimmed by trimAl and with a trimmed N- and C-termini but not pruned by Gblocks was used to perform a marginal reconstruction of ancestral nodes with the LG evolutionary rate model [<xref rid="pcbi.1010633.ref048" ref-type="bibr">48</xref>], with indels inferred using bi-directional edge parsimony.</p>
    </sec>
    <sec id="sec023">
      <title>GDH-GOx synthesis and cloning</title>
      <p>The N- and C-terminal sequences not present in the ancestral sequences were replaced by the equivalent amino acid sequences of GOx from <italic toggle="yes">Aspergillus niger</italic>, MQTLLVSSLVVSLAAALPHYIRSNGIEASLLTDPKDVSGRT and ASMQ, respectively. Resulting ancestral genes were codon-optimised for <italic toggle="yes">Komagataella phaffii</italic> (formerly <italic toggle="yes">Pichia pastoris</italic>) expression, ordered from BioCat GmbH, and cloned into the expression vector pPICZ A together with an added polyhistidine tag (6 x His). Constructs were linearized with <italic toggle="yes">Pvu</italic>II and transformed into <italic toggle="yes">K. phaffiii</italic> via electroporation.</p>
    </sec>
    <sec id="sec024">
      <title>GDH-GOx expression</title>
      <p>Ancestral and extant GOx and GDH genes were expressed in <italic toggle="yes">K. phaffiii</italic> under the AOX1 promoter with methanol induction. Routine cultivations and selection of the transformed cells were done in liquid YPD medium supplemented with zeocin (100 mg/L) at 30°C and 130 rpm. Expression was done in shake flasks at 30°C and 130 rpm on modified BMMY medium (20 g/L peptone from casein, 10 g/L yeast extract, 100 mM potassium phosphate buffer pH 6.0, 10 g/L (NH<sub>4</sub>)<sub>2</sub>SO<sub>4</sub>, 3.4 g/L yeast nitrogen base (without amino acids and (NH<sub>4</sub>)<sub>2</sub>SO<sub>4</sub>), and 0.4 mg/L biotin) containing 12 g/L sorbitol and 2% methanol. After centrifugation at 6,000 x <italic toggle="yes">g</italic> and 4°C for 30 minutes, supernatants were loaded onto a 5 mL HisTrap column (GE Healthcare) equilibrated with binding buffer (50 mM potassium phosphate buffer pH 6.5, 500 mM NaCl, and 20 mM imidazole) and washed for at least 10 column volumes. Proteins were eluted using a linear gradient from 20 to 500 mM imidazole (50 mM potassium phosphate buffer pH 6.5, 500 mM NaCl and 500 mM imidazole). Manually collected fractions were concentrated and desalted (50 mM phosphate buffer pH 6.5) in Vivaspin 20 tubes (Sartorius) with 30,000 Da molecular mass cut-off.</p>
    </sec>
    <sec id="sec025">
      <title>GDH-GOx activity assays</title>
      <p>Both GDH and GOx activity were measured spectrophotometrically at 30°C on a UV/Vis spectrophotometer (Lambda 35, Perkin Elmer), using appropriately diluted enzyme solution, 20 mM D-glucose, and the respective electron acceptor in 50 mM potassium phosphate buffer pH 6.5. The electron acceptors 1,4-benzoquinone (BQ) and ferrocenium-hexafluorophosphate (FcPF6) were used at 0.5 and 0.2 mM, and their reduction was followed at 290 and 300 nm, respectively. Reduction of the electron acceptor oxygen was measured using the peroxidase-coupled 2,2’-azino-bis(3-ethylbenzothiazoline-6-sulphonic acid) (ABTS) assay [<xref rid="pcbi.1010633.ref056" ref-type="bibr">56</xref>], following the reduction of 0.1 mM ABTS at 420 nm.</p>
    </sec>
    <sec id="sec026">
      <title>GDH-GOx thermal stability assays</title>
      <p>The thermal stability of GDH-GOx enzymes was assessed by differential scanning calorimetry conducted on a PEAQ-DSC automated instrument (Malvern Panalytical). All enzyme samples were diluted to 5 μM (∼ 0.33 mg/ml) in 50 mM potassium phosphate buffer pH 6.5, and scanned from 2090°C with a scan rate of 60°C/h and feedback set to high. Instrument blanks were recorded using buffer only and rescans were measured for all samples. Data analysis was performed using the MicroCal PEAQ-DSC software V.1.22. The background signal was subtracted using rescans whenever applicable or buffer blanks otherwise, the baseline was fitted using the spline method, and peaks were fitted with a non-two-state model.</p>
    </sec>
  </sec>
  <sec id="sec027">
    <title>DHAD experimental methods</title>
    <sec id="sec028">
      <title>DHAD ancestral inference</title>
      <p>A <italic toggle="yes">minimal</italic> 585-sequence set was created, consisting of members annotated with family Ilvd/Edd” in UniProt, and excluding sequence fragments (as defined by UniProt). Most sequences were from Swiss-Prot, with several TrEMBL entries added due to function and structural data being available. A <italic toggle="yes">baseline</italic> data set of 1,612 sequences was created from the minimal data set, ensuring that 19 nominated enzymes with experimental data (functional and/or structural) were included, as well as members of their UniRef90 clusters. A <italic toggle="yes">background</italic> data set of 8,221 sequences included annotated members from the broadest assortment of species, only filtered to be non-redundant at 90% identity (using UniRef90). All three data sets were checked for the aligned location of two motifs (CDK and PCN/PGH/SAH with provision for a substitution) that are associated with the active site [<xref rid="pcbi.1010633.ref057" ref-type="bibr">57</xref>]; sequences that did not exhibit these motifs were removed.</p>
      <p>The background data set was then repeatedly and independently sampled to extend the baseline data set to up to 9,112 sequences. At each size increment of 500 sequences an alignment was created using Clustal Omega [<xref rid="pcbi.1010633.ref058" ref-type="bibr">58</xref>], and a phylogenetic tree was inferred using FastTree [<xref rid="pcbi.1010633.ref059" ref-type="bibr">59</xref>] and rooted using phosphogluconate dehydratase as an outgroup. Despite differences in alignments and phylogenetic trees at each data size increment, we were able to map any ancestor in a smaller tree to an ancestor in a larger tree by maximising shared inclusions and exclusions of member proteins of the ancestral subtrees. Joint reconstruction was performed with indels inferred with bi-directional edge parsimony and the JTT evolutionary model [<xref rid="pcbi.1010633.ref046" ref-type="bibr">46</xref>].</p>
    </sec>
    <sec id="sec029">
      <title>DHAD synthesis and cloning</title>
      <p>The inferred DHAD ancestral genes N1, N423, and N560 from the 585 data set, and the equivalent nodes N9, N1442, and N1443 from the 9,112 data set were optimised for <italic toggle="yes">E. coli</italic> expression and synthesised by Twist Bioscience and ATG:biosynthetics GmbH, respectively. After amplification, the purified DNA fragments were digested with <italic toggle="yes">Sap</italic>I, then ligated into a modified pET26 vector (p7XNH3) [<xref rid="pcbi.1010633.ref060" ref-type="bibr">60</xref>].</p>
    </sec>
    <sec id="sec030">
      <title>DHAD expression</title>
      <p>Expression of the DHAD genes was performed in shaking flasks. <italic toggle="yes">E. coli</italic> BL21 (DE3) cells transformed with the p7XNH3 plasmid and the appropriate inserted gene fragment were grown as an overnight pre-culture in lysogeny broth supplemented with kanamycin (100 μg/ml), and then inoculated 1:50 into auto-induction ZP-5052 medium [<xref rid="pcbi.1010633.ref061" ref-type="bibr">61</xref>] supplemented with kanamycin (100 μg/ml). These cultures were incubated at 90 rpm and 37°C for 3 hours and then overnight at 18°C in a horizontal orbital shaking incubator. Cells were disrupted by sonication in binding buffer (50 mM potassium phosphate buffer, 500 mM NaCl, 10% glycerol, and 20 mM imidazole) at pH 8.0. Cell debris was pelleted by centrifugation. Proteins were purified using an ÄKTA Purifier FPLC system and a HisTrap HP Nickel column (GE Healthcare). Filtered samples were loaded onto the column and washed with binding buffer. The His-tagged proteins were then eluted with elution buffer (50 mM potassium phosphate buffer, 500 mM NaCl, 10% glycerol, and 500 mM imidazole) at pH 8.0. Desalting of the enzymes was carried out using HEPES buffer pH 7.0.</p>
    </sec>
    <sec id="sec031">
      <title>DHAD activity assays</title>
      <p>DHAD activity was analysed by HPLC of an assay mixture containing the respective DHAD, 25 mM HEPES buffer pH 7.0, 5 mM MgSO<sub>4</sub>, and 25 mM of sodium D-gluconate, and incubated at 30°C. Samples were taken every few hours for 3 days. The enzyme was removed by ultrafiltration (PES 10 kDa MWCO, VWR) and the samples were stored at -20°C until analysed by HPLC. HPLC measurements were performed on an Ultimate-3000 HPLC system (Dionex), equipped with an auto-sampler and diode-array detector. D-gluconate and products were separated by using a Metrosep A supp10–250/40 column (250 mm, particle size 4.6 μm, Metrohm) at 65°C by isocratic elution with 12 mM ammonium bicarbonate at pH 10, followed by a washing step with 30 mM sodium carbonate at pH 10.4 and a flow rate of 0.2 ml/min. Each sample injection volume was 10 μl. System peak calibration was performed using external standards of the known compounds.</p>
    </sec>
  </sec>
  <sec id="sec032">
    <title>CYP2U experimental methods</title>
    <sec id="sec033">
      <title>CYP2U ancestral inference</title>
      <p>Five candidate CYP2U proteins were chosen, one each from <italic toggle="yes">Andrias davidianus, Python bivittatus, Marmota marmota, Poecilia reticulata</italic>, and <italic toggle="yes">Amazona aestiva</italic>. A BLASTp search of each of the candidates was conducted, excluding hits from plants (taxonomic id:3193) or fungi (taxonomic id:4751) (E-Value = 0.00001). Sequences from the BLASTp search were retained if they had at least 55% sequence identity to the original candidate sequence. This procedure was also repeated retaining sequences with at least 50% sequence identity, however, the additional sequences from this lower bound were all removed at later stages of curation, indicating that 55% was an appropriate level of identity to identify CYP2U subfamily sequences. Sequences from the BLASTp searches were collated and duplicate, identical sequences were removed. Manual curation was performed to remove sequences below 400 amino acids in length or containing unidentified amino acids. Sequences were aligned using MAFFT (L-INS-i) with default parameters [<xref rid="pcbi.1010633.ref052" ref-type="bibr">52</xref>]. Removal of sequences with indel events over 20 amino acids (suggestive of incorrect annotation of splice sites) was completed in an iterative manner by first identifying which sequence had the longest indel over 20 amino acids, removing it and realigning the remaining sequences, and then continuing until no sequence had an indel over 20 amino acids. Sequences were manually inspected and any sequences with apparent frameshift mutations were removed. Sequences were mapped back to their exon structure and removed if they had more than two exons difference to the accepted number of five exons for CYP2U sequences, indicative of poor sequence quality or poor sequence annotation.</p>
      <p>Sequences missing the conserved cysteine residue characteristic of cytochrome P450 enzymes were removed. Similar procedures were used to generate the CYP2R and CYP2D subfamily alignments, then the full set of all three subfamilies was combined and realigned in MAFFT to generate the largest data set. Phylogenetic trees were inferred using RAxML [<xref rid="pcbi.1010633.ref062" ref-type="bibr">62</xref>]. A CYP2R <italic toggle="yes">Latimeria chalumnae</italic> sequence (XP_005989762.1) was manually shifted on the phylogenetic tree to better represent the known phylogeny [<xref rid="pcbi.1010633.ref063" ref-type="bibr">63</xref>], while retaining each sequence’s overall evolutionary distance to the root. Joint reconstruction was performed with indels inferred with bi-directional edge parsimony and the JTT evolutionary rate model [<xref rid="pcbi.1010633.ref046" ref-type="bibr">46</xref>].</p>
    </sec>
    <sec id="sec034">
      <title>CYP2U synthesis and cloning</title>
      <p>The amino acid sequences of CYP2U ancestors were inferred starting from the conserved PPGP motif, which signifies the junction between the transmembrane anchor and the catalytic domain. For expression of the resurrected ancestors in bacteria, this region was replaced with an N-terminal sequence (MAKKTSSKGKL), which is known to improve expression yields of microsomal P450s in bacteria [<xref rid="pcbi.1010633.ref064" ref-type="bibr">64</xref>] and had been used to express human CYP2U1 in <italic toggle="yes">E. coli</italic> [<xref rid="pcbi.1010633.ref065" ref-type="bibr">65</xref>]. To enable purification, a flexible ST linker followed by a polyhistidine tag (6 x His) was added to the C-termini of the sequences. All ancestor sequences were codon-optimised for <italic toggle="yes">E. coli</italic> expression, and the N-termini were optimised initially using mRNA optimiser [<xref rid="pcbi.1010633.ref066" ref-type="bibr">66</xref>] and subsequently manually until the predicted free energy of secondary structure formation was greater than -15 kJ/mol. The genes were synthesised as GeneStrings (GeneArt, Invitrogen) designed with 60 bp 5 and 3 end extensions complementary to the pCW vector, cloned by Gibson assembly, and then sequence-verified by dideoxy sequencing (Australian Genome Research Facility). Correct inserts were subcloned into a bicistronic pCW vector upstream of the open reading frame for the human cytochrome P450 reductase (hCPR) using the <italic toggle="yes">Nde</italic>I and <italic toggle="yes">Xba</italic>I sites.</p>
    </sec>
    <sec id="sec035">
      <title>CYP2U expression</title>
      <p>DH5<italic toggle="yes">α</italic> F IQ <italic toggle="yes">E. coli</italic> cells carrying the pGro7 plasmid were transformed with pCW vectors containing the relevant P450 and CPR genes or the empty vector (pCW controls”), and selected using chloramphenicol (20 g/ml) and ampicillin (100 g/ml). Single colonies were used to inoculate overnight cultures in lysogeny broth with antibiotics, as above. Batch cultures were grown at 25°C, 180 rpm in 500 ml flasks containing 50 ml terrific broth supplemented with trace elements, 1 mM thiamine, and antibiotics. Cultures were induced after 5 hours with 1 mM IPTG and 4 mg/ml L-arabinose, and supplemented with 500 mM delta-aminolaevulinic acid. Cultures were grown for a further 43 hours before harvesting by centrifugation at 6,000 x <italic toggle="yes">g</italic> for 10 minutes. <italic toggle="yes">E. coli</italic> pellets were weighed and resuspended in 2 ml/g (wet weight) sonication buffer (100 mM potassium phosphate buffer pH 7.4, containing 20% (w/v) glycerol, 6 mM magnesium acetate, 1 mM PMSF, and a protease inhibitor cocktail (Sigma-Aldrich)). Cells were lysed using a Constant Systems OneShot cell disruptor followed by centrifugation at 10,000 x <italic toggle="yes">g</italic> for 20 minutes. The supernatant was centrifuged at 180,000 x <italic toggle="yes">g</italic> for 1 hour and the pellet was resuspended in TES buffer (100 mM Tris acetate, 500 mM sucrose, and 0.5 mM EDTA pH 7.6) using a Potter-Elvehjem homogeniser. The P450 concentration was determined in intact cells and membranes using Fe(II).CO vs. Fe(II) difference spectroscopy [<xref rid="pcbi.1010633.ref067" ref-type="bibr">67</xref>].</p>
    </sec>
    <sec id="sec036">
      <title>CYP2U activity assays</title>
      <p>P450 (0.02 <italic toggle="yes">μ</italic>M), added in membranes prepared from bacteria coexpressing hCPR, was premixed with 50 <italic toggle="yes">μ</italic>M luciferin CEE or luciferin ME-EGE (Promega) in 100 mM potassium phosphate pH 7.4, and incubated at 37°C for 10 minutes. Reactions were initiated by addition of the NADPH-regenerating system (NGS; 0.25 mM NADP<sup>+</sup>, 10 mM glucose-6-phosphate, and 0.5 U/ml glucose-6-phosphate dehydrogenase), and incubated with gentle shaking at 37°C for 30 minutes. An equal volume of the luciferin detection reagent was added, and reactions were incubated for a further 20 minutes at room temperature. Luminescence was measured using a CLARIOstar multimodal plate reader (BMG Labtech).</p>
    </sec>
    <sec id="sec037">
      <title>CYP2U thermal stability assays</title>
      <p>Ancestors were expressed in <italic toggle="yes">E. coli</italic> as described above and cell pellets were resuspended in whole cell spectral assay buffer (WCAB; 100 mM potassium phosphate, 20 mM D-glucose, and 6 mM magnesium acetate pH 7.4) to one eighth of the original culture volume. The resuspended cultures, distributed into tubes in 200 <italic toggle="yes">μ</italic>L volumes, were incubated at a range of temperatures (25–80°C, in 5°C increments) for 60 minutes, followed by a 5 minute recovery at 4°C and equilibration at 25°C. The remaining P450 content was measured in intact cells using the method of Johnston et al. [<xref rid="pcbi.1010633.ref067" ref-type="bibr">67</xref>]. The proportion of total P450 content compared to the unheated control (25°C) was plotted against temperature and the <sup>60</sup>T<sub>50</sub> value was calculated by fitting the data to a variable slope (4-parameter) dose response curve in GraphPad Prism 8.0.</p>
    </sec>
  </sec>
  <sec id="sec038">
    <title>KARI experimental methods</title>
    <sec id="sec039">
      <title>KARI ancestral inference</title>
      <p>We created two separate data sets representing KARI class I and class II, respectively. The sequence alignment for class II was taken directly from Gumulya et al. [<xref rid="pcbi.1010633.ref008" ref-type="bibr">8</xref>] and used to compare tools. Class I sequences were compiled by searching for both reviewed and unreviewed proteins in UniProt, designated as bacterial and belonging to the family (26,485 sequences). We removed all fragments and sequences above the length of 400 to exclude obvious cases of class II enzymes. The sequence set was redundancy-reduced with CD-HIT at 99% [<xref rid="pcbi.1010633.ref068" ref-type="bibr">68</xref>], resulting in 11,920 sequences, from which 57 sequences were manually removed by observing a C-terminal knotted domain, indicative of class II. After aligning all sequences with Clustal Omega [<xref rid="pcbi.1010633.ref058" ref-type="bibr">58</xref>], several sequences appeared poorly aligned, mostly due to unique but substantial truncation or elongation.</p>
      <p>To objectively identify such outliers, we determined the proportion of gaps in each column (number of sequences with gaps in given column / number of sequences), and used this to calculate the Shannon entropy for a given sequence at each position (entropy of either gap or amino acid, as found at the position). The position-specific entropies were then summed across each aligned sequence, for all sequences. This demarcated approximately the top 1% of sequences due to their atypical gap patterns, which we decided to remove, resulting in a final set of 11,756 sequences.</p>
      <p>Phylogenetic tree inference was carried out using FastTree [<xref rid="pcbi.1010633.ref059" ref-type="bibr">59</xref>].</p>
      <p>The KARI class I data sets were created by decreasing their size from 11,756 via 10 regular decrements reaching a minimum representation of 1,176 sequences. For each subset, sequences were randomly removed and the alignment was recalculated independently. For each alignment, a new tree was calculated, and rooted using KARI sequences in Aquificae and Thermotogae as an outgroup. For each subset, we computed reconstructions for 50 randomly chosen ancestor nodes (mapped across each tree as described for the DHAD data sets). Joint reconstruction was performed with indels inferred with bi-directional edge parsimony and the JTT evolutionary model [<xref rid="pcbi.1010633.ref046" ref-type="bibr">46</xref>].</p>
    </sec>
  </sec>
  <sec id="sec040" sec-type="supplementary-material">
    <title>Supporting information</title>
    <supplementary-material id="pcbi.1010633.s001" position="float" content-type="local-data">
      <label>S1 Table</label>
      <caption>
        <title>Comparison of thermal transitions.</title>
        <p>Differential scanning calorimetry of an extant glucose oxidase from <italic toggle="yes">Aspergillus niger</italic>, the ancestor inferred at node N320, and the ancestor inferred at node N320 with a single amino acid change, based on marginal distributions.</p>
        <p>(XLSX)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s001.xlsx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s002" position="float" content-type="local-data">
      <label>S1 Fig</label>
      <caption>
        <title>Percentages of gaps in sequence alignments.</title>
        <p>Percentage of positions across every sequence in a given alignment that contains a gap character, for the nine data sets, the simulated data from INDELible, and the simulated data from INDELible as realigned by MAFFT. Simulated data is shown for 500 extant sequences at indel rates of 0.001, 0.005, 0.01, and 0.03.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s002.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s003" position="float" content-type="local-data">
      <label>S2 Fig</label>
      <caption>
        <title>Distributions of contiguous gap lengths within alignments.</title>
        <p><bold>A</bold>, CYP2U, DHAD, KARI, and GDH-GOx datasets. <bold>B</bold>, The simulated data from INDELible. <bold>C</bold>, The simulated data from INDELible as realigned by MAFFT. Simulated data is shown for 500 extant sequences at indel rates of 0.001, 0.005, 0.01, and 0.03. Note that truncations of sequence content are also counted in these distributions.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s003.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s004" position="float" content-type="local-data">
      <label>S3 Fig</label>
      <caption>
        <title>Overview images of the alignments generated for the four indel rates used in the simulated indel evaluation.</title>
        <p>Each alignment is the true alignment simulated by INDELible for 250 extant sequences with an indel rate of either 0.001, 0.005, 0.01, or 0.03.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s004.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s005" position="float" content-type="local-data">
      <label>S4 Fig</label>
      <caption>
        <title>Evaluation of indels with realigned data.</title>
        <p><bold>A</bold>, Root length generated from realigned data at four taxon sizes at an indel rate of 0.03 (n = 5). <bold>B</bold>, Venn diagram showing the overlap of specific indels identified by each method at taxon size 750 and an indel rate of 0.03. Total numbers of indels are shown in the largest Venn diagram and subsets of this data according to indel type and indel size are shown in the smaller Venn diagrams. Not all intersections are shown (<italic toggle="yes">N</italic> = 1).</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s005.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s006" position="float" content-type="local-data">
      <label>S5 Fig</label>
      <caption>
        <title>Number of indels uniquely identified by each indel method.</title>
        <p>At four taxon sizes at two indel rates (0.005 and 0.01), organised by indel type and size (<italic toggle="yes">N</italic> = 5). Note the change in range of the y-axis between indel rates.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s006.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s007" position="float" content-type="local-data">
      <label>S6 Fig</label>
      <caption>
        <title>Expression of CYP2U hybrid ancestors.</title>
        <p><bold>A</bold>, Fe(II) vs. Fe(II).CO difference spectra for CYP2U ancestors in <italic toggle="yes">E. coli</italic> membranes. <bold>B</bold>, Expression level of CYP2U ancestors in <italic toggle="yes">E. coli</italic> cultures, quantified using Fe(II) vs. Fe(II).CO difference spectroscopy. Data are means +/- SEM, <italic toggle="yes">N</italic> = 3.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s007.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s008" position="float" content-type="local-data">
      <label>S7 Fig</label>
      <caption>
        <title>AlphaFold2 models of CYP2U ancestral and extant proteins.</title>
        <p><bold>A</bold>, AlphaFold2 model of human CYP2U1. The AA’ loop is shown in red, the D-E loop is shown in blue, and the haem cofactor is shown in pink. <bold>B</bold>, Structural alignment of the AlphaFold2 models for human CYP2U1 (beige) and CYP2U_N1 (black) with the human PDB structure for CYP2R1 (green), which is the closest relative of CYP2U1 with an experimental structure. CYP2R1, like all other CYP2s, lacks the AA’ loop extension found in CYP2U proteins. The haem cofactor is depicted in red. <bold>C</bold>, AlphaFold2 structure for human CYP2U1 showing the low model confidence for the AA’ loop extension. <bold>D</bold>, Structural alignment of the AlphaFold2 models for all the CYP2U ancestors and three extant CYP2U proteins (human CYP2U1, mouse CYP2U1, zebrafish CYP2U1), showing the differences in the predicted positioning of the AA’ loop extension. The haem cofactor is shown in red. <bold>E</bold>, Structural alignment of the AlphaFold2 models for the CYP2U_N1 ancestors with and without the AA’ loop insertion. Aside from the AA’ loop, no substantial structural differences are observed between these structures. <bold>F</bold>, Structural alignment of the AlphaFold2 models for all the CYP2U ancestors and three extant CYP2U proteins (human CYP2U1, mouse CYP2U1, zebrafish CYP2U1), showing the elongation of the D-helix and D-E loop in the zebrafish CYP2U1 (blue) and CYP2U_N5 (grey) with LSEE insertion.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s008.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s009" position="float" content-type="local-data">
      <label>S8 Fig</label>
      <caption>
        <title>Predicted ancestor sequence lengths are unaffected by size of reconstruction.</title>
        <p>Mean and standard deviation of the lengths of 50 ancestor sequences mapped are plotted for different reconstructions and data set sizes for DHAD and KARI.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s009.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s010" position="float" content-type="local-data">
      <label>S9 Fig</label>
      <caption>
        <title>Run times for the DHAD and KARI enzyme families as data set size increases.</title>
        <p>Reconstructions were performed using GRASP running on 64 GB RAM, 5 threads on 2x 2.6 GHz 14C Xeon VM.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s010.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s011" position="float" content-type="local-data">
      <label>S10 Fig</label>
      <caption>
        <title>Thermal shift assays for DHAD ancestors.</title>
        <p>There is an increase in temperature between equivalent ancestral nodes N423 (585 data set size) and N1442 (9,112 data set size), and equivalent ancestral nodes N560 (585 data set size) and N1443 (9,112 data set size).</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s011.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s012" position="float" content-type="local-data">
      <label>S11 Fig</label>
      <caption>
        <title>Thermal stability and activity for the CYP2U, CYP2U/CYP2R, and CYP2U/CYP2R/CYP2D ancestors with luciferin MultiCYP.</title>
        <p><bold>A</bold>, Comparison of T<sub>50</sub> values after a 60 minute incubation at a range of temperatures (25–80°C). Data are means +/- SEM, <italic toggle="yes">N</italic> = 2. <bold>B</bold>, Turnover of luciferin MultiCYP by CYP2U ancestors in <italic toggle="yes">E. coli</italic> membranes, also containing human CPR, after 30 minutes at 37°C. Membranes from cells expressing only human CPR are included as a negative control. Data are means +/- SEM, <italic toggle="yes">N</italic> = 3. The two graphs represent two independent experiments with two independent levels of human CPR activity recorded.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s012.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s013" position="float" content-type="local-data">
      <label>S12 Fig</label>
      <caption>
        <title>Comparison between ancestors generated using GRASP, FastML, and PAML.</title>
        <p><bold>A</bold>, Expression level of CYP2U ancestors in <italic toggle="yes">E. coli</italic> cultures quantified using Fe(II) vs. Fe(II).CO difference spectroscopy. Data are means +/- SEM, <italic toggle="yes">N</italic> = 3. <bold>B</bold>, Fe(II) vs. Fe(II).CO difference spectra for ancestors generated using GRASP, FastML, and PAML in <italic toggle="yes">E. coli</italic> membranes. <bold>C</bold>, Turnover of luciferin MultiCYP by CYP2U ancestors in <italic toggle="yes">E. coli</italic> membranes, also containing human CPR, after 30 minutes at 37°C. Membranes from cells expressing only human CPR are included as a negative control. Data are means +/- SEM, <italic toggle="yes">N</italic> = 3. <bold>D</bold>, Comparison of T<sub>50</sub> values after a 60 minute incubation at a range of temperatures (25–80°C) for ancestors generated using GRASP, FastML, and PAML. Data are means +/- SEM, <italic toggle="yes">N</italic> = 2.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s013.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s014" position="float" content-type="local-data">
      <label>S13 Fig</label>
      <caption>
        <title>Tool comparison using CYP2 data.</title>
        <p><bold>A</bold>, Average fractional distance between tools, calculated as pairwise fractional distances for each ancestral prediction for a given tool against all other ancestral predictions of other tools at 5 groups of 195 sequences, 10 groups of 97 or 98 sequences, and 20 groups of 48 or 49 sequences. Parameter combinations are joint (J) and marginal (M) reconstruction; and fixed or variable evolutionary rates (FastML and PAML only). <bold>B</bold>, Average fractional distance between a better-sampled ancestor inferred by GRASP using 975 sequences and each tool / parameter combination at 5, 10, and 20 groups.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s014.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s015" position="float" content-type="local-data">
      <label>S14 Fig</label>
      <caption>
        <title>Statistical evaluation of determinants of ancestor prediction performance using 1,682 KARI sequences.</title>
        <p><bold>A</bold>, Between tool distances grouped by tool within data set size. <bold>B</bold>, Distance to better-sampled ancestor grouped by tool within data set size. <bold>C</bold>, Distance to better-sampled ancestor grouped by size within tool. <bold>D</bold>, Distance to better-sampled ancestor grouped by rate parameter within data set size. PAML was excluded for the largest data set size; variable rates were not used for the largest data set size. All p-values were determined by a two-tailed Student’s <italic toggle="yes">t</italic>-test. Only significant comparisons are shown (* means <italic toggle="yes">p</italic> &lt; 0.05, ** means <italic toggle="yes">p</italic> &lt; 0.01, *** means <italic toggle="yes">p</italic> &lt; 0.001, **** means at limits of precision of test). All parameter settings are from <xref rid="pcbi.1010633.g005" ref-type="fig">Fig 5</xref>.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s015.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s016" position="float" content-type="local-data">
      <label>S15 Fig</label>
      <caption>
        <title>Statistical evaluation of determinants of ancestor prediction performance using 975 CYP2 sequences.</title>
        <p><bold>A</bold>, Between tool distances grouped by tool within data set size. <bold>B</bold>, Distance to better-sampled ancestor grouped by tool within data set size. <bold>C</bold>, Distance to better-sampled ancestor grouped by size within tool. <bold>D</bold>, Distance to better-sampled ancestor grouped by rate parameter within data set size. All p-values were determined by a two-tailed Student’s <italic toggle="yes">t</italic>-test. Only significant comparisons are shown (* means <italic toggle="yes">p</italic> &lt; 0.05, ** means <italic toggle="yes">p</italic> &lt; 0.01, *** means <italic toggle="yes">p</italic> &lt; 0.001, **** means at limits of precision of test). All parameter settings are from <xref rid="pcbi.1010633.s014" ref-type="supplementary-material">S13 Fig</xref>.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s016.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s017" position="float" content-type="local-data">
      <label>S16 Fig</label>
      <caption>
        <title>Run times of GRASP, FastML, and PAML at different parameter combinations and group sizes on the KARI data set.</title>
        <p>Parameter combinations are joint and marginal reconstruction; and fixed or variable evolutionary rates (FastML and PAML only).</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s017.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="pcbi.1010633.s018" position="float" content-type="local-data">
      <label>S17 Fig</label>
      <caption>
        <title>Mean sequence identity between extant sequences and a selected ancestral node.</title>
        <p>Positions to compare are identified from the multiple sequence alignment for each data set. The selected ancestral sequence is N0, the root node, from a joint reconstruction for each data set except for GDH-GOx, in which the marginal reconstruction of N320 is the selected ancestral sequence.</p>
        <p>(EPS)</p>
      </caption>
      <media xlink:href="pcbi.1010633.s018.eps">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>We thank Broder Rühmann who helped prepare data for the manuscript.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pcbi.1010633.ref001">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Land</surname><given-names>M</given-names></name>, <name><surname>Hauser</surname><given-names>L</given-names></name>, <name><surname>Jun</surname><given-names>SR</given-names></name>, <name><surname>Nookaew</surname><given-names>I</given-names></name>, <name><surname>Leuze</surname><given-names>MR</given-names></name>, <name><surname>Ahn</surname><given-names>TH</given-names></name>, <etal>et al</etal>. <article-title>Insights from 20 Years of Bacterial Genome Sequencing</article-title>. <source>Functional &amp; Integrative Genomics</source>. <year>2015</year>;<volume>15</volume>(<issue>2</issue>):<fpage>141</fpage>–<lpage>161</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/s10142-015-0433-4</pub-id><pub-id pub-id-type="pmid">25722247</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref002">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Lewin</surname><given-names>HA</given-names></name>, <name><surname>Robinson</surname><given-names>GE</given-names></name>, <name><surname>Kress</surname><given-names>WJ</given-names></name>, <name><surname>Baker</surname><given-names>WJ</given-names></name>, <name><surname>Coddington</surname><given-names>J</given-names></name>, <name><surname>Crandall</surname><given-names>KA</given-names></name>, <etal>et al</etal>. <article-title>Earth BioGenome Project: Sequencing Life for the Future of Life</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2018</year>;<volume>115</volume>(<issue>17</issue>):<fpage>4325</fpage>–<lpage>4333</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1073/pnas.1720115115</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref003">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Gregory</surname><given-names>AC</given-names></name>, <name><surname>Zayed</surname><given-names>AA</given-names></name>, <name><surname>Conceição-Neto</surname><given-names>N</given-names></name>, <name><surname>Temperton</surname><given-names>B</given-names></name>, <name><surname>Bolduc</surname><given-names>B</given-names></name>, <name><surname>Alberti</surname><given-names>A</given-names></name>, <etal>et al</etal>. <article-title>Marine DNA Viral Macro- and Microdiversity from Pole to Pole</article-title>. <source>Cell</source>. <year>2019</year>;<volume>177</volume>(<issue>5</issue>):<fpage>1109</fpage>–<lpage>1123</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.cell.2019.03.040</pub-id><pub-id pub-id-type="pmid">31031001</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref004">
      <label>4</label>
      <mixed-citation publication-type="journal"><name><surname>Hochberg</surname><given-names>GKA</given-names></name>, <name><surname>Thornton</surname><given-names>JW</given-names></name>. <article-title>Reconstructing Ancient Proteins to Understand the Causes of Structure and Function</article-title>. <source>Annual Review of Biophysics</source>. <year>2017</year>;<volume>46</volume>:<fpage>247</fpage>–<lpage>269</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1146/annurev-biophys-070816-033631</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref005">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Selberg</surname><given-names>AGA</given-names></name>, <name><surname>Gaucher</surname><given-names>EA</given-names></name>, <name><surname>Liberles</surname><given-names>DA</given-names></name>. <article-title>Ancestral Sequence Reconstruction: From Chemical Paleogenetics to Maximum Likelihood Algorithms and Beyond</article-title>. <source>Journal of Molecular Evolution</source>. <year>2021</year>;<volume>89</volume>(<issue>3</issue>):<fpage>157</fpage>–<lpage>164</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/s00239-021-09993-1</pub-id><pub-id pub-id-type="pmid">33486547</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref006">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Bar-Rogovsky</surname><given-names>H</given-names></name>, <name><surname>Stern</surname><given-names>A</given-names></name>, <name><surname>Penn</surname><given-names>O</given-names></name>, <name><surname>Kobl</surname><given-names>I</given-names></name>, <name><surname>Pupko</surname><given-names>T</given-names></name>, <name><surname>Tawfik</surname><given-names>DS</given-names></name>. <article-title>Assessing the Prediction Fidelity of Ancestral Reconstruction by a Library Approach</article-title>. <source>Protein Engineering, Design &amp; Selection</source>. <year>2015</year>;<volume>28</volume>(<issue>11</issue>):<fpage>507</fpage>–<lpage>518</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/protein/gzv038</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref007">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Sugrue</surname><given-names>E</given-names></name>, <name><surname>Scott</surname><given-names>C</given-names></name>, <name><surname>Jackson</surname><given-names>CJ</given-names></name>. <article-title>Constrained Evolution of a Bispecific Enzyme: Lessons for Biocatalyst Design</article-title>. <source>Organic &amp; Biomolecular Chemistry</source>. <year>2017</year>;<volume>15</volume>(<issue>4</issue>):<fpage>937</fpage>–<lpage>946</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1039/C6OB02355J</pub-id><pub-id pub-id-type="pmid">28054091</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref008">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Gumulya</surname><given-names>Y</given-names></name>, <name><surname>Baek</surname><given-names>JM</given-names></name>, <name><surname>Wun</surname><given-names>SJ</given-names></name>, <name><surname>Thomson</surname><given-names>RES</given-names></name>, <name><surname>Harris</surname><given-names>KL</given-names></name>, <name><surname>Hunter</surname><given-names>DJB</given-names></name>, <etal>et al</etal>. <article-title>Engineering Highly Functional Thermostable Proteins Using Ancestral Sequence Reconstruction</article-title>. <source>Nature Catalysis</source>. <year>2018</year>;<volume>1</volume>(<issue>11</issue>):<fpage>878</fpage>–<lpage>888</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/s41929-018-0159-5</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref009">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Trudeau</surname><given-names>DL</given-names></name>, <name><surname>Tawfik</surname><given-names>DS</given-names></name>. <article-title>Protein Engineers Turned Evolutionists—the Quest for the Optimal Starting Point</article-title>. <source>Current Opinion in Biotechnology</source>. <year>2019</year>;<volume>60</volume>:<fpage>46</fpage>–<lpage>52</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.copbio.2018.12.002</pub-id><pub-id pub-id-type="pmid">30611116</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref010">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Spence</surname><given-names>MA</given-names></name>, <name><surname>Kaczmarski</surname><given-names>JA</given-names></name>, <name><surname>Saunders</surname><given-names>JW</given-names></name>, <name><surname>Jackson</surname><given-names>CJ</given-names></name>. <article-title>Ancestral Sequence Reconstruction for Protein Engineers</article-title>. <source>Current Opinion in Structural Biology</source>. <year>2021</year>;<volume>69</volume>:<fpage>131</fpage>–<lpage>141</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.sbi.2021.04.001</pub-id><pub-id pub-id-type="pmid">34023793</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref011">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Garcia</surname><given-names>AK</given-names></name>, <name><surname>Kaçar</surname><given-names>B</given-names></name>. <article-title>How to Resurrect Ancestral Proteins as Proxies for Ancient Biogeochemistry</article-title>. <source>Free Radical Biology and Medicine</source>. <year>2019</year>;<volume>140</volume>:<fpage>260</fpage>–<lpage>269</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.freeradbiomed.2019.03.033</pub-id><pub-id pub-id-type="pmid">30951835</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref012">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Diallo</surname><given-names>AB</given-names></name>, <name><surname>Makarenkov</surname><given-names>V</given-names></name>, <name><surname>Blanchette</surname><given-names>M</given-names></name>. <article-title>Exact and Heuristic Algorithms for the Indel Maximum Likelihood Problem</article-title>. <source>Journal of Computational Biology</source>. <year>2007</year>;<volume>14</volume>(<issue>4</issue>):<fpage>446</fpage>–<lpage>461</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1089/cmb.2007.A006</pub-id><pub-id pub-id-type="pmid">17572023</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref013">
      <label>13</label>
      <mixed-citation publication-type="journal"><name><surname>Snir</surname><given-names>S</given-names></name>, <name><surname>Pachter</surname><given-names>L</given-names></name>. <article-title>Tracing the Most Parsimonious Indel History</article-title>. <source>Journal of Computational Biology</source>. <year>2011</year>;<volume>18</volume>(<issue>8</issue>):<fpage>967</fpage>–<lpage>986</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1089/cmb.2010.0325</pub-id><pub-id pub-id-type="pmid">21728862</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref014">
      <label>14</label>
      <mixed-citation publication-type="journal"><name><surname>Vialle</surname><given-names>RA</given-names></name>, <name><surname>Tamuri</surname><given-names>AU</given-names></name>, <name><surname>Goldman</surname><given-names>N</given-names></name>. <article-title>Alignment Modulates Ancestral Sequence Reconstruction Accuracy</article-title>. <source>Molecular Biology and Evolution</source>. <year>2018</year>;<volume>35</volume>(<issue>7</issue>):<fpage>1783</fpage>–<lpage>1797</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/msy055</pub-id><pub-id pub-id-type="pmid">29618097</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref015">
      <label>15</label>
      <mixed-citation publication-type="journal"><name><surname>Aadland</surname><given-names>K</given-names></name>, <name><surname>Kolaczkowski</surname><given-names>B</given-names></name>. <article-title>Alignment-Integrated Reconstruction of Ancestral Sequences Improves Accuracy</article-title>. <source>Genome Biology and Evolution</source>. <year>2020</year>;<volume>12</volume>(<issue>9</issue>):<fpage>1549</fpage>–<lpage>1565</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/gbe/evaa164</pub-id><pub-id pub-id-type="pmid">32785673</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref016">
      <label>16</label>
      <mixed-citation publication-type="journal"><name><surname>Lee</surname><given-names>C</given-names></name>, <name><surname>Grasso</surname><given-names>C</given-names></name>, <name><surname>Sharlow</surname><given-names>MF</given-names></name>. <article-title>Multiple Sequence Alignment Using Partial Order Graphs</article-title>. <source>Bioinformatics</source>. <year>2002</year>;<volume>18</volume>(<issue>3</issue>):<fpage>452</fpage>–<lpage>464</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/18.3.452</pub-id><pub-id pub-id-type="pmid">11934745</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref017">
      <label>17</label>
      <mixed-citation publication-type="journal"><name><surname>Emond</surname><given-names>S</given-names></name>, <name><surname>Petek</surname><given-names>M</given-names></name>, <name><surname>Kay</surname><given-names>EJ</given-names></name>, <name><surname>Heames</surname><given-names>B</given-names></name>, <name><surname>Devenish</surname><given-names>SRA</given-names></name>, <name><surname>Tokuriki</surname><given-names>N</given-names></name>, <etal>et al</etal>. <article-title>Accessing Unexplored Regions of Sequence Space in Directed Enzyme Evolution via Insertion/Deletion Mutagenesis</article-title>. <source>Nature Communications</source>. <year>2020</year>;<volume>11</volume>(<issue>1</issue>):<fpage>3469</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/s41467-020-17061-3</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref018">
      <label>18</label>
      <mixed-citation publication-type="journal"><name><surname>Sützl</surname><given-names>L</given-names></name>, <name><surname>Foley</surname><given-names>G</given-names></name>, <name><surname>Gillam</surname><given-names>EMJ</given-names></name>, <name><surname>Bodén</surname><given-names>M</given-names></name>, <name><surname>Haltrich</surname><given-names>D</given-names></name>. <article-title>The GMC Superfamily of Oxidoreductases Revisited: Analysis and Evolution of Fungal GMC Oxidoreductases</article-title>. <source>Biotechnology for Biofuels</source>. <year>2019</year>;<volume>12</volume>(<issue>1</issue>):<fpage>118</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1186/s13068-019-1457-0</pub-id><pub-id pub-id-type="pmid">31168323</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref019">
      <label>19</label>
      <mixed-citation publication-type="journal"><name><surname>Kirischian</surname><given-names>N</given-names></name>, <name><surname>McArthur</surname><given-names>AG</given-names></name>, <name><surname>Jesuthasan</surname><given-names>C</given-names></name>, <name><surname>Krattenmacher</surname><given-names>B</given-names></name>, <name><surname>Wilson</surname><given-names>JY</given-names></name>. <article-title>Phylogenetic and Functional Analysis of the Vertebrate Cytochrome P450 2 Family</article-title>. <source>Journal of Molecular Evolution</source>. <year>2011</year>;<volume>72</volume>(<issue>1</issue>):<fpage>56</fpage>–<lpage>71</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/s00239-010-9402-7</pub-id><pub-id pub-id-type="pmid">21116621</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref020">
      <label>20</label>
      <mixed-citation publication-type="journal"><name><surname>Gao</surname><given-names>H</given-names></name>, <name><surname>Azam</surname><given-names>T</given-names></name>, <name><surname>Randeniya</surname><given-names>S</given-names></name>, <name><surname>Couturier</surname><given-names>J</given-names></name>, <name><surname>Rouhier</surname><given-names>N</given-names></name>, <name><surname>Johnson</surname><given-names>MK</given-names></name>. <article-title>Function and Maturation of the Fe-S Center in Dihydroxyacid Dehydratase from Arabidopsis</article-title>. <source>The Journal of Biological Chemistry</source>. <year>2018</year>;<volume>293</volume>(<issue>12</issue>):<fpage>4422</fpage>–<lpage>4433</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1074/jbc.RA117.001592</pub-id><pub-id pub-id-type="pmid">29425096</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref021">
      <label>21</label>
      <mixed-citation publication-type="book"><name><surname>Baldi</surname><given-names>P</given-names></name>, <name><surname>Brunak</surname><given-names>S</given-names></name>. <source>Bioinformatics: The Machine Learning Approach</source>. <publisher-name>The MIT Press</publisher-name>; <year>2001</year>.</mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref022">
      <label>22</label>
      <mixed-citation publication-type="book"><name><surname>Koller</surname><given-names>D</given-names></name>, <name><surname>Friedman</surname><given-names>N</given-names></name>. <source>Probabilistic Graphical Models</source>. <publisher-name>The MIT Press</publisher-name>; <year>2009</year>.</mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref023">
      <label>23</label>
      <mixed-citation publication-type="journal"><name><surname>Hanson-Smith</surname><given-names>V</given-names></name>, <name><surname>Kolaczkowski</surname><given-names>B</given-names></name>, <name><surname>Thornton</surname><given-names>JW</given-names></name>. <article-title>Robustness of Ancestral Sequence Reconstruction to Phylogenetic Uncertainty</article-title>. <source>Molecular Biology and Evolution</source>. <year>2010</year>;<volume>27</volume>(<issue>9</issue>):<fpage>1988</fpage>–<lpage>1999</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/msq081</pub-id><pub-id pub-id-type="pmid">20368266</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref024">
      <label>24</label>
      <mixed-citation publication-type="journal"><name><surname>Edwards</surname><given-names>RJ</given-names></name>, <name><surname>Shields</surname><given-names>DC</given-names></name>. <article-title>GASP: Gapped Ancestral Sequence Prediction for Proteins</article-title>. <source>BMC Bioinformatics</source>. <year>2004</year>;<volume>5</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>10</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1186/1471-2105-1-1</pub-id><pub-id pub-id-type="pmid">14706121</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref025">
      <label>25</label>
      <mixed-citation publication-type="journal"><name><surname>Musil</surname><given-names>M</given-names></name>, <name><surname>Khan</surname><given-names>RT</given-names></name>, <name><surname>Beier</surname><given-names>A</given-names></name>, <name><surname>Stourac</surname><given-names>J</given-names></name>, <name><surname>Konegger</surname><given-names>H</given-names></name>, <name><surname>Damborsky</surname><given-names>J</given-names></name>, <etal>et al</etal>. <article-title>FireProtASR: A Web Server for Fully Automated Ancestral Sequence Reconstruction</article-title>. <source>Briefings in Bioinformatics</source>. <year>2021</year>;<volume>22</volume>(<issue>4</issue>):<fpage>bbaa337</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bib/bbaa337</pub-id><pub-id pub-id-type="pmid">33346815</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref026">
      <label>26</label>
      <mixed-citation publication-type="journal"><name><surname>Simmons</surname><given-names>MP</given-names></name>, <name><surname>Ochoterena</surname><given-names>H</given-names></name>. <article-title>Gaps as Characters in Sequence-Based Phylogenetic Analyses</article-title>. <source>Systematic Biology</source>. <year>2000</year>;<volume>49</volume>(<issue>2</issue>):<fpage>369</fpage>–<lpage>381</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1080/10635159950173889</pub-id><pub-id pub-id-type="pmid">12118412</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref027">
      <label>27</label>
      <mixed-citation publication-type="journal"><name><surname>Pupko</surname><given-names>T</given-names></name>, <name><surname>Pe’er</surname><given-names>I</given-names></name>, <name><surname>Hasegawa</surname><given-names>M</given-names></name>, <name><surname>Graur</surname><given-names>D</given-names></name>, <name><surname>Friedman</surname><given-names>N</given-names></name>. <article-title>A Branch-and-Bound Algorithm for the Inference of Ancestral Amino-Acid Sequences When the Replacement Rate Varies among Sites: Application to the Evolution of Five Gene Families</article-title>. <source>Bioinformatics</source>. <year>2002</year>;<volume>18</volume>(<issue>8</issue>):<fpage>1116</fpage>–<lpage>1123</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/18.8.1116</pub-id><pub-id pub-id-type="pmid">12176835</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref028">
      <label>28</label>
      <mixed-citation publication-type="journal"><name><surname>Fletcher</surname><given-names>W</given-names></name>, <name><surname>Yang</surname><given-names>Z</given-names></name>. <article-title>INDELible: A Flexible Simulator of Biological Sequence Evolution</article-title>. <source>Molecular Biology and Evolution</source>. <year>2009</year>;<volume>26</volume>(<issue>8</issue>):<fpage>1879</fpage>–<lpage>1888</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/msp098</pub-id><pub-id pub-id-type="pmid">19423664</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref029">
      <label>29</label>
      <mixed-citation publication-type="journal"><name><surname>Poulos</surname><given-names>TL</given-names></name>, <name><surname>Finzel</surname><given-names>BC</given-names></name>, <name><surname>Howard</surname><given-names>AJ</given-names></name>. <article-title>High-resolution crystal structure of cytochrome P450cam</article-title>. <source>Journal of Molecular Biology</source>. <year>1987</year>;<volume>195</volume>(<issue>3</issue>):<fpage>687</fpage>–<lpage>700</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/0022-2836(87)90190-2</pub-id><pub-id pub-id-type="pmid">3656428</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref030">
      <label>30</label>
      <mixed-citation publication-type="journal"><name><surname>Ducassou</surname><given-names>L</given-names></name>, <name><surname>Jonasson</surname><given-names>G</given-names></name>, <name><surname>Dhers</surname><given-names>L</given-names></name>, <name><surname>Pietrancosta</surname><given-names>N</given-names></name>, <name><surname>Ramassamy</surname><given-names>B</given-names></name>, <name><surname>Xu-Li</surname><given-names>Y</given-names></name>, <etal>et al</etal>. <article-title>Expression in yeast, new substrates, and construction of a first 3D model of human orphan cytochrome P450 2U1: Interpretation of substrate hydroxylation regioselectivity from docking studies</article-title>. <source>Biochimica et Biophysica Acta (BBA)—General Subjects</source>. <year>2015</year>;<volume>1850</volume>(<issue>7</issue>):<fpage>1426</fpage>–<lpage>1437</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.bbagen.2015.03.014</pub-id><pub-id pub-id-type="pmid">25857771</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref031">
      <label>31</label>
      <mixed-citation publication-type="journal"><name><surname>Ducassou</surname><given-names>L</given-names></name>, <name><surname>Dhers</surname><given-names>L</given-names></name>, <name><surname>Jonasson</surname><given-names>G</given-names></name>, <name><surname>Pietrancosta</surname><given-names>N</given-names></name>, <name><surname>Boucher</surname><given-names>JL</given-names></name>, <name><surname>Mansuy</surname><given-names>D</given-names></name>, <etal>et al</etal>. <article-title>Membrane-bound human orphan cytochrome P450 2U1: Sequence singularities, construction of a full 3D model, and substrate docking</article-title>. <source>Biochimie</source>. <year>2017</year>;<volume>140</volume>:<fpage>166</fpage>–<lpage>175</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.biochi.2017.07.007</pub-id><pub-id pub-id-type="pmid">28743672</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref032">
      <label>32</label>
      <mixed-citation publication-type="journal"><name><surname>Jumper</surname><given-names>J</given-names></name>, <name><surname>Evans</surname><given-names>R</given-names></name>, <name><surname>Pritzel</surname><given-names>A</given-names></name>, <name><surname>Green</surname><given-names>T</given-names></name>, <name><surname>Figurnov</surname><given-names>M</given-names></name>, <name><surname>Ronneberger</surname><given-names>O</given-names></name>, <etal>et al</etal>. <article-title>Highly accurate protein structure prediction with AlphaFold</article-title>. <source>Nature</source>. <year>2022</year>;<volume>596</volume>(<issue>7873</issue>):<fpage>583</fpage>–<lpage>589</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/s41586-021-03819-2</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref033">
      <label>33</label>
      <mixed-citation publication-type="journal"><name><surname>Mirdita</surname><given-names>M</given-names></name>, <name><surname>Schütze</surname><given-names>K</given-names></name>, <name><surname>Moriwaki</surname><given-names>Y</given-names></name>, <name><surname>Heo</surname><given-names>L</given-names></name>, <name><surname>Ovchinnikov</surname><given-names>S</given-names></name>, <name><surname>Steinegger</surname><given-names>M</given-names></name>. <article-title>ColabFold: making protein folding accessible to all</article-title>. <source>Nature Methods</source>. <year>2022</year>;<volume>19</volume>(<issue>6</issue>):<fpage>679</fpage>–<lpage>682</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/s41592-022-01488-1</pub-id><pub-id pub-id-type="pmid">35637307</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref034">
      <label>34</label>
      <mixed-citation publication-type="journal"><name><surname>Koshi</surname><given-names>JM</given-names></name>, <name><surname>Goldstein</surname><given-names>RA</given-names></name>. <article-title>Probabilistic Reconstruction of Ancestral Protein Sequences</article-title>. <source>Journal of Molecular Evolution</source>. <year>1996</year>;<volume>42</volume>(<issue>2</issue>):<fpage>313</fpage>–<lpage>320</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/BF02198858</pub-id><pub-id pub-id-type="pmid">8919883</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref035">
      <label>35</label>
      <mixed-citation publication-type="journal"><name><surname>Ashkenazy</surname><given-names>H</given-names></name>, <name><surname>Penn</surname><given-names>O</given-names></name>, <name><surname>Doron-Faigenboim</surname><given-names>A</given-names></name>, <name><surname>Cohen</surname><given-names>O</given-names></name>, <name><surname>Cannarozzi</surname><given-names>G</given-names></name>, <name><surname>Zomer</surname><given-names>O</given-names></name>, <etal>et al</etal>. <article-title>FastML: A Web Server for Probabilistic Reconstruction of Ancestral Sequences</article-title>. <source>Nucleic Acids Research</source>. <year>2012</year>;<volume>40</volume>(<issue>Web Server issue</issue>):<fpage>W580</fpage>–<lpage>W584</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/nar/gks498</pub-id><pub-id pub-id-type="pmid">22661579</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref036">
      <label>36</label>
      <mixed-citation publication-type="journal"><name><surname>Yang</surname><given-names>Z</given-names></name>. <article-title>PAML 4: Phylogenetic Analysis by Maximum Likelihood</article-title>. <source>Molecular Biology and Evolution</source>. <year>2007</year>;<volume>24</volume>(<issue>8</issue>):<fpage>1586</fpage>–<lpage>1591</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/msm088</pub-id><pub-id pub-id-type="pmid">17483113</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref037">
      <label>37</label>
      <mixed-citation publication-type="journal"><name><surname>Afriat-Jurnou</surname><given-names>L</given-names></name>, <name><surname>Jackson</surname><given-names>CJ</given-names></name>, <name><surname>Tawfik</surname><given-names>DS</given-names></name>. <article-title>Reconstructing a Missing Link in the Evolution of a Recently Diverged Phosphotriesterase by Active-Site Loop Remodeling</article-title>. <source>Biochemistry</source>. <year>2012</year>;<volume>51</volume>(<issue>31</issue>):<fpage>6047</fpage>–<lpage>6055</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/bi300694t</pub-id><pub-id pub-id-type="pmid">22809311</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref038">
      <label>38</label>
      <mixed-citation publication-type="journal"><name><surname>Grasso</surname><given-names>C</given-names></name>, <name><surname>Lee</surname><given-names>C</given-names></name>. <article-title>Combining Partial Order Alignment and Progressive Multiple Sequence Alignment Increases Alignment Speed and Scalability to Very Large Alignment Problems</article-title>. <source>Bioinformatics</source>. <year>2004</year>;<volume>20</volume>(<issue>10</issue>):<fpage>1546</fpage>–<lpage>1556</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/bth126</pub-id><pub-id pub-id-type="pmid">14962922</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref039">
      <label>39</label>
      <mixed-citation publication-type="journal"><name><surname>Löytynoja</surname><given-names>A</given-names></name>, <name><surname>Goldman</surname><given-names>N</given-names></name>. <article-title>An Algorithm for Progressive Multiple Alignment of Sequences with Insertions</article-title>. <source>Proceedings of the National Academy of Sciences of the United States of America</source>. <year>2005</year>;<volume>102</volume>(<issue>30</issue>):<fpage>10557</fpage>–<lpage>10562</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1073/pnas.0409137102</pub-id><pub-id pub-id-type="pmid">16000407</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref040">
      <label>40</label>
      <mixed-citation publication-type="journal"><name><surname>Felsenstein</surname><given-names>J</given-names></name>. <article-title>Evolutionary Trees from DNA Sequences: A Maximum Likelihood Approach</article-title>. <source>Journal of Molecular Evolution</source>. <year>1981</year>;<volume>17</volume>(<issue>6</issue>):<fpage>368</fpage>–<lpage>376</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/BF01734359</pub-id><pub-id pub-id-type="pmid">7288891</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref041">
      <label>41</label>
      <mixed-citation publication-type="journal"><name><surname>Löytynoja</surname><given-names>A</given-names></name>, <name><surname>Vilella</surname><given-names>AJ</given-names></name>, <name><surname>Goldman</surname><given-names>N</given-names></name>. <article-title>Accurate Extension of Multiple Sequence Alignments Using a Phylogeny-Aware Graph Algorithm</article-title>. <source>Bioinformatics</source>. <year>2012</year>;<volume>28</volume>(<issue>13</issue>):<fpage>1684</fpage>–<lpage>1691</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/bts198</pub-id><pub-id pub-id-type="pmid">22531217</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref042">
      <label>42</label>
      <mixed-citation publication-type="journal"><name><surname>Yang</surname><given-names>Z</given-names></name>. <article-title>Maximum Likelihood Phylogenetic Estimation from DNA Sequences with Variable Rates over Sites: Approximate Methods</article-title>. <source>Journal of Molecular Evolution</source>. <year>1994</year>;<volume>39</volume>(<issue>3</issue>):<fpage>306</fpage>–<lpage>314</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/BF00160154</pub-id><pub-id pub-id-type="pmid">7932792</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref043">
      <label>43</label>
      <mixed-citation publication-type="journal"><name><surname>Felsenstein</surname><given-names>J</given-names></name>. <article-title>Taking Variation of Evolutionary Rates between Sites into Account in Inferring Phylogenies</article-title>. <source>Journal of Molecular Evolution</source>. <year>2001</year>;<volume>53</volume>(<issue>4-5</issue>):<fpage>447</fpage>–<lpage>455</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/s002390010234</pub-id><pub-id pub-id-type="pmid">11675604</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref044">
      <label>44</label>
      <mixed-citation publication-type="journal"><name><surname>Minh</surname><given-names>BQ</given-names></name>, <name><surname>Schmidt</surname><given-names>HA</given-names></name>, <name><surname>Chernomor</surname><given-names>O</given-names></name>, <name><surname>Schrempf</surname><given-names>D</given-names></name>, <name><surname>Woodhams</surname><given-names>MD</given-names></name>, <name><surname>von Haeseler</surname><given-names>A</given-names></name>, <etal>et al</etal>. <article-title>IQ-TREE 2: New Models and Efficient Methods for Phylogenetic Inference in the Genomic Era</article-title>. <source>Molecular Biology and Evolution</source>. <year>2020</year>;<volume>37</volume>(<issue>5</issue>):<fpage>1530</fpage>–<lpage>1534</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/msaa015</pub-id><pub-id pub-id-type="pmid">32011700</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref045">
      <label>45</label>
      <mixed-citation publication-type="journal"><name><surname>Dayhoff</surname><given-names>MO</given-names></name>, <name><surname>Schwartz</surname><given-names>RM</given-names></name>, <name><surname>Orcutt</surname><given-names>BC</given-names></name>. <article-title>A Model of Evolutionary Change in Proteins. In: Atlas of Protein Sequence and Structure</article-title>. <source>National Biomedical Research Foundation</source>; <year>1978</year>. p. <fpage>345</fpage>–<lpage>352</lpage>.</mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref046">
      <label>46</label>
      <mixed-citation publication-type="journal"><name><surname>Jones</surname><given-names>DT</given-names></name>, <name><surname>Taylor</surname><given-names>WR</given-names></name>, <name><surname>Thornton</surname><given-names>JM</given-names></name>. <article-title>The Rapid Generation of Mutation Data Matrices from Protein Sequences</article-title>. <source>Computer Applications in the Biosciences</source>. <year>1992</year>;<volume>8</volume>(<issue>3</issue>):<fpage>275</fpage>–<lpage>282</lpage>.<pub-id pub-id-type="pmid">1633570</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref047">
      <label>47</label>
      <mixed-citation publication-type="journal"><name><surname>Whelan</surname><given-names>S</given-names></name>, <name><surname>Goldman</surname><given-names>N</given-names></name>. <article-title>A General Empirical Model of Protein Evolution Derived from Multiple Protein Families Using a Maximum-Likelihood Approach</article-title>. <source>Molecular Biology and Evolution</source>. <year>2001</year>;<volume>18</volume>(<issue>5</issue>):<fpage>691</fpage>–<lpage>699</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/oxfordjournals.molbev.a003851</pub-id><pub-id pub-id-type="pmid">11319253</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref048">
      <label>48</label>
      <mixed-citation publication-type="journal"><name><surname>Le</surname><given-names>SQ</given-names></name>, <name><surname>Gascuel</surname><given-names>O</given-names></name>. <article-title>An Improved General Amino Acid Replacement Matrix</article-title>. <source>Molecular Biology and Evolution</source>. <year>2008</year>;<volume>25</volume>(<issue>7</issue>):<fpage>1307</fpage>–<lpage>1320</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/msn067</pub-id><pub-id pub-id-type="pmid">18367465</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref049">
      <label>49</label>
      <mixed-citation publication-type="journal"><name><surname>Dechter</surname><given-names>R</given-names></name>. <article-title>Bucket Elimination: A Unifying Framework for Reasoning</article-title>. <source>Artificial Intelligence</source>. <year>1999</year>;<volume>113</volume>(<issue>1</issue>):<fpage>41</fpage>–<lpage>85</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/S0004-3702(99)00059-4</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref050">
      <label>50</label>
      <mixed-citation publication-type="journal"><name><surname>Hart</surname><given-names>PE</given-names></name>, <name><surname>Nilsson</surname><given-names>NJ</given-names></name>, <name><surname>Raphael</surname><given-names>B</given-names></name>. <article-title>A Formal Basis for the Heuristic Determination of Minimum Cost Paths</article-title>. <source>IEEE Transactions on Systems Science and Cybernetics</source>. <year>1968</year>;<volume>4</volume>(<issue>2</issue>):<fpage>100</fpage>–<lpage>107</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1109/TSSC.1968.300136</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref051">
      <label>51</label>
      <mixed-citation publication-type="journal"><name><surname>Benner</surname><given-names>SA</given-names></name>, <name><surname>Cohen</surname><given-names>MA</given-names></name>, <name><surname>Gonnet</surname><given-names>GH</given-names></name>. <article-title>Empirical and Structural Models for Insertions and Deletions in the Divergent Evolution of Proteins</article-title>. <source>Journal of Molecular Biology</source>. <year>1993</year>;<volume>229</volume>(<issue>4</issue>):<fpage>1065</fpage>–<lpage>1082</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1006/jmbi.1993.1105</pub-id><pub-id pub-id-type="pmid">8445636</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref052">
      <label>52</label>
      <mixed-citation publication-type="journal"><name><surname>Katoh</surname><given-names>K</given-names></name>, <name><surname>Standley</surname><given-names>DM</given-names></name>. <article-title>MAFFT Multiple Sequence Alignment Software Version 7: Improvements in Performance and Usability</article-title>. <source>Molecular Biology and Evolution</source>. <year>2013</year>;<volume>30</volume>(<issue>4</issue>):<fpage>772</fpage>–<lpage>780</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/mst010</pub-id><pub-id pub-id-type="pmid">23329690</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref053">
      <label>53</label>
      <mixed-citation publication-type="journal"><name><surname>Capella-Gutiérrez</surname><given-names>S</given-names></name>, <name><surname>Silla-Martínez</surname><given-names>JM</given-names></name>, <name><surname>Gabaldón</surname><given-names>T</given-names></name>. <article-title>trimAl: A Tool for Automated Alignment Trimming in Large-Scale Phylogenetic Analyses</article-title>. <source>Bioinformatics</source>. <year>2009</year>;<volume>25</volume>(<issue>15</issue>):<fpage>1972</fpage>–<lpage>1973</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/btp348</pub-id><pub-id pub-id-type="pmid">19505945</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref054">
      <label>54</label>
      <mixed-citation publication-type="journal"><name><surname>Talavera</surname><given-names>G</given-names></name>, <name><surname>Castresana</surname><given-names>J</given-names></name>. <article-title>Improvement of Phylogenies after Removing Divergent and Ambiguously Aligned Blocks from Protein Sequence Alignments</article-title>. <source>Systematic Biology</source>. <year>2007</year>;<volume>56</volume>(<issue>4</issue>):<fpage>564</fpage>–<lpage>577</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1080/10635150701472164</pub-id><pub-id pub-id-type="pmid">17654362</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref055">
      <label>55</label>
      <mixed-citation publication-type="journal"><name><surname>Guindon</surname><given-names>S</given-names></name>, <name><surname>Dufayard</surname><given-names>JF</given-names></name>, <name><surname>Lefort</surname><given-names>V</given-names></name>, <name><surname>Anisimova</surname><given-names>M</given-names></name>, <name><surname>Hordijk</surname><given-names>W</given-names></name>, <name><surname>Gascuel</surname><given-names>O</given-names></name>. <article-title>New Algorithms and Methods to Estimate Maximum-Likelihood Phylogenies: Assessing the Performance of PhyML 3.0</article-title>. <source>Systematic Biology</source>. <year>2010</year>;<volume>59</volume>(<issue>3</issue>):<fpage>307</fpage>–<lpage>321</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/sysbio/syq010</pub-id><pub-id pub-id-type="pmid">20525638</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref056">
      <label>56</label>
      <mixed-citation publication-type="journal"><name><surname>Spadiut</surname><given-names>O</given-names></name>, <name><surname>Leitner</surname><given-names>C</given-names></name>, <name><surname>Salaheddin</surname><given-names>C</given-names></name>, <name><surname>Varga</surname><given-names>B</given-names></name>, <name><surname>Vertessy</surname><given-names>BG</given-names></name>, <name><surname>Tan</surname><given-names>TC</given-names></name>, <etal>et al</etal>. <article-title>Improving Thermostability and Catalytic Activity of Pyranose 2-Oxidase from Trametes Multicolor by Rational and Semi-Rational Design</article-title>. <source>The FEBS Journal</source>. <year>2009</year>;<volume>276</volume>(<issue>3</issue>):<fpage>776</fpage>–<lpage>792</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1111/j.1742-4658.2008.06823.x</pub-id><pub-id pub-id-type="pmid">19143837</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref057">
      <label>57</label>
      <mixed-citation publication-type="journal"><name><surname>Rahman</surname><given-names>MM</given-names></name>, <name><surname>Andberg</surname><given-names>M</given-names></name>, <name><surname>Thangaraj</surname><given-names>SK</given-names></name>, <name><surname>Parkkinen</surname><given-names>T</given-names></name>, <name><surname>Penttilä</surname><given-names>M</given-names></name>, <name><surname>Jänis</surname><given-names>J</given-names></name>, <etal>et al</etal>. <article-title>The Crystal Structure of a Bacterial L-Arabinonate Dehydratase Contains a [2Fe-2S] Cluster</article-title>. <source>ACS Chemical Biology</source>. <year>2017</year>;<volume>12</volume>(<issue>7</issue>):<fpage>1919</fpage>–<lpage>1927</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/acschembio.7b00304</pub-id><pub-id pub-id-type="pmid">28574691</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref058">
      <label>58</label>
      <mixed-citation publication-type="journal"><name><surname>Sievers</surname><given-names>F</given-names></name>, <name><surname>Higgins</surname><given-names>DG</given-names></name>. <article-title>Clustal Omega for Making Accurate Alignments of Many Protein Sequences</article-title>. <source>Protein Science: A Publication of the Protein Society</source>. <year>2018</year>;<volume>27</volume>(<issue>1</issue>):<fpage>135</fpage>–<lpage>145</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1002/pro.3290</pub-id><pub-id pub-id-type="pmid">28884485</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref059">
      <label>59</label>
      <mixed-citation publication-type="journal"><name><surname>Price</surname><given-names>MN</given-names></name>, <name><surname>Dehal</surname><given-names>PS</given-names></name>, <name><surname>Arkin</surname><given-names>AP</given-names></name>. <article-title>FastTree: Computing Large Minimum Evolution Trees with Profiles Instead of a Distance Matrix</article-title>. <source>Molecular Biology and Evolution</source>. <year>2009</year>;<volume>26</volume>(<issue>7</issue>):<fpage>1641</fpage>–<lpage>1650</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/molbev/msp077</pub-id><pub-id pub-id-type="pmid">19377059</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref060">
      <label>60</label>
      <mixed-citation publication-type="journal"><name><surname>Geertsma</surname><given-names>ER</given-names></name>, <name><surname>Dutzler</surname><given-names>R</given-names></name>. <article-title>A Versatile and Efficient High-Throughput Cloning Tool for Structural Biology</article-title>. <source>Biochemistry</source>. <year>2011</year>;<volume>50</volume>(<issue>15</issue>):<fpage>3272</fpage>–<lpage>3278</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1021/bi200178z</pub-id><pub-id pub-id-type="pmid">21410291</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref061">
      <label>61</label>
      <mixed-citation publication-type="journal"><name><surname>Studier</surname><given-names>FW</given-names></name>. <article-title>Protein Production by Auto-Induction in High Density Shaking Cultures</article-title>. <source>Protein Expression and Purification</source>. <year>2005</year>;<volume>41</volume>(<issue>1</issue>):<fpage>207</fpage>–<lpage>234</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.pep.2005.01.016</pub-id><pub-id pub-id-type="pmid">15915565</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref062">
      <label>62</label>
      <mixed-citation publication-type="journal"><name><surname>Stamatakis</surname><given-names>A</given-names></name>. <article-title>RAxML Version 8: A Tool for Phylogenetic Analysis and Post-Analysis of Large Phylogenies</article-title>. <source>Bioinformatics</source>. <year>2014</year>;<volume>30</volume>(<issue>9</issue>):<fpage>1312</fpage>–<lpage>1313</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/btu033</pub-id><pub-id pub-id-type="pmid">24451623</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref063">
      <label>63</label>
      <mixed-citation publication-type="journal"><name><surname>Amemiya</surname><given-names>CT</given-names></name>, <name><surname>Alföldi</surname><given-names>J</given-names></name>, <name><surname>Lee</surname><given-names>AP</given-names></name>, <name><surname>Fan</surname><given-names>S</given-names></name>, <name><surname>Philippe</surname><given-names>H</given-names></name>, <name><surname>MacCallum</surname><given-names>I</given-names></name>, <etal>et al</etal>. <article-title>Analysis of the African Coelacanth Genome Sheds Light on Tetrapod Evolution</article-title>. <source>Nature</source>. <year>2013</year>;<volume>496</volume>(<issue>7445</issue>):<fpage>311</fpage>–<lpage>316</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/nature12027</pub-id><pub-id pub-id-type="pmid">23598338</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref064">
      <label>64</label>
      <mixed-citation publication-type="journal"><name><surname>von Wachenfeldt</surname><given-names>C</given-names></name>, <name><surname>Richardson</surname><given-names>TH</given-names></name>, <name><surname>Cosme</surname><given-names>J</given-names></name>, <name><surname>Johnson</surname><given-names>EF</given-names></name>. <article-title>Microsomal P450 2C3 Is Expressed as a Soluble Dimer in Escherichia Coli Following Modifications of Its N-terminus</article-title>. <source>Archives of Biochemistry and Biophysics</source>. <year>1997</year>;<volume>339</volume>(<issue>1</issue>):<fpage>107</fpage>–<lpage>114</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1006/abbi.1996.9859</pub-id><pub-id pub-id-type="pmid">9056240</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref065">
      <label>65</label>
      <mixed-citation publication-type="journal"><name><surname>Siller</surname><given-names>M</given-names></name>, <name><surname>Goyal</surname><given-names>S</given-names></name>, <name><surname>Yoshimoto</surname><given-names>FK</given-names></name>, <name><surname>Xiao</surname><given-names>Y</given-names></name>, <name><surname>Wei</surname><given-names>S</given-names></name>, <name><surname>Guengerich</surname><given-names>FP</given-names></name>. <article-title>Oxidation of Endogenous N-arachidonoylserotonin by Human Cytochrome P450 2U1</article-title>. <source>The Journal of Biological Chemistry</source>. <year>2014</year>;<volume>289</volume>(<issue>15</issue>):<fpage>10476</fpage>–<lpage>10487</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1074/jbc.M114.550004</pub-id><pub-id pub-id-type="pmid">24563460</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref066">
      <label>66</label>
      <mixed-citation publication-type="journal"><name><surname>Gaspar</surname><given-names>P</given-names></name>, <name><surname>Moura</surname><given-names>G</given-names></name>, <name><surname>Santos</surname><given-names>MAS</given-names></name>, <name><surname>Oliveira</surname><given-names>JL</given-names></name>. <article-title>mRNA Secondary Structure Optimization Using a Correlated Stem–Loop Prediction</article-title>. <source>Nucleic Acids Research</source>. <year>2013</year>;<volume>41</volume>(<issue>6</issue>):<fpage>e73</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/nar/gks1473</pub-id><pub-id pub-id-type="pmid">23325845</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref067">
      <label>67</label>
      <mixed-citation publication-type="journal"><name><surname>Johnston</surname><given-names>WA</given-names></name>, <name><surname>Huang</surname><given-names>W</given-names></name>, <name><surname>De Voss</surname><given-names>JJ</given-names></name>, <name><surname>Hayes</surname><given-names>MA</given-names></name>, <name><surname>Gillam</surname><given-names>EMJ</given-names></name>. <article-title>Quantitative Whole-Cell Cytochrome P450 Measurement Suitable for High-Throughput Application</article-title>. <source>Journal of Biomolecular Screening</source>. <year>2008</year>;<volume>13</volume>(<issue>2</issue>):<fpage>135</fpage>–<lpage>141</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1177/1087057107312780</pub-id><pub-id pub-id-type="pmid">18216397</pub-id></mixed-citation>
    </ref>
    <ref id="pcbi.1010633.ref068">
      <label>68</label>
      <mixed-citation publication-type="journal"><name><surname>Huang</surname><given-names>Y</given-names></name>, <name><surname>Niu</surname><given-names>B</given-names></name>, <name><surname>Gao</surname><given-names>Y</given-names></name>, <name><surname>Fu</surname><given-names>L</given-names></name>, <name><surname>Li</surname><given-names>W</given-names></name>. <article-title>CD-HIT Suite: A Web Server for Clustering and Comparing Biological Sequences</article-title>. <source>Bioinformatics</source>. <year>2010</year>;<volume>26</volume>(<issue>5</issue>):<fpage>680</fpage>–<lpage>682</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1093/bioinformatics/btq003</pub-id><pub-id pub-id-type="pmid">20053844</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<sub-article article-type="aggregated-review-documents" id="pcbi.1010633.r001" specific-use="decision-letter">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r001</article-id>
    <title-group>
      <article-title>Decision Letter 0</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Elofsson</surname>
          <given-names>Arne</given-names>
        </name>
        <role>Section Editor</role>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Punta</surname>
          <given-names>Marco</given-names>
        </name>
        <role>Academic Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2022 Elofsson, Punta</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>Elofsson, Punta</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj001" related-article-type="reviewed-article"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>0</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">14 Apr 2022</named-content>
    </p>
    <p>Dear Dr. Boden,</p>
    <p>Thank you very much for submitting your manuscript "Engineering indel and substitution variants of diverse and ancient enzymes using Graphical Representation of Ancestral Sequence Predictions (GRASP)" for consideration at PLOS Computational Biology.</p>
    <p>As with all papers reviewed by the journal, your manuscript was reviewed by members of the editorial board and by several independent reviewers. In light of the reviews (below this email), we would like to invite the resubmission of a significantly-revised version that takes into account the reviewers' comments.</p>
    <p>Besides addressing all other comments from the reviewers, please make every effort to render the algorithm at the basis of your method clear and understandable. </p>
    <p>We cannot make any decision about publication until we have seen the revised manuscript and your response to the reviewers' comments. Your revised manuscript is also likely to be sent to reviewers for further evaluation.</p>
    <p>When you are ready to resubmit, please upload the following:</p>
    <p>[1] A letter containing a detailed list of your responses to the review comments and a description of the changes you have made in the manuscript. Please note while forming your response, if your article is accepted, you may have the opportunity to make the peer review history publicly available. The record will include editor decision letters (with reviews) and your responses to reviewer comments. If eligible, we will contact you to opt in or out.</p>
    <p>[2] Two versions of the revised manuscript: one with either highlights or tracked changes denoting where the text has been changed; the other a clean version (uploaded as the manuscript file).</p>
    <p>Important additional instructions are given below your reviewer comments.</p>
    <p>Please prepare and submit your revised manuscript within 60 days. If you anticipate any delay, please let us know the expected resubmission date by replying to this email. Please note that revised manuscripts received after the 60-day due date may require evaluation and peer review similar to newly submitted manuscripts.</p>
    <p>Thank you again for your submission. We hope that our editorial process has been constructive so far, and we welcome your feedback at any time. Please don't hesitate to contact us if you have any questions or comments.</p>
    <p>Sincerely,</p>
    <p>Marco Punta</p>
    <p>Associate Editor</p>
    <p>PLOS Computational Biology</p>
    <p>Arne Elofsson</p>
    <p>Deputy Editor</p>
    <p>PLOS Computational Biology</p>
    <p>***********************</p>
    <p>Reviewer's Responses to Questions</p>
    <p>
      <bold>Comments to the Authors:</bold>
    </p>
    <p>
      <bold>Please note here if the review is uploaded as an attachment.</bold>
    </p>
    <p>Reviewer #1: This study aims to provide a new way to treat indel events for ancestral sequence reconstruction. This is an important problem for this field and better methods would be very welcome. Unfortunately I am in no position to evaluate this manuscript. I could not follow the mathematical descriptions of what this method does exactly. This is not meant as a judgment of the authors' work; this reviewer was simply to stupid to understand the method. I would suggest, however, that the authors describe the method in the main text and accompany it with figures that explain how it works. As it stands, the new method is only described in the methods section.</p>
    <p>Reviewer #2: This paper introduces a program called GRASP, which performs Indel estimation in ancestral sequence estimation, shows its applications, and attempts to demonstrate the usefulness of this program. Ancestral sequence reconstructions have become widely used in the research fields of molecular evolutionary biology and protein engineering. In this context, the accurate estimation of indels is important for the creation of proteins that actually have the "correct" structure and functionality to be analyzed based on the estimated sequence.</p>
    <p>　GRASP, presented in this paper, can infer ancestral sequences including Indel in six different ways, given an alignment and phylogenetic tree. It is important that the user can choose the method of analysis. In addition, the authors actually used this program to perform ancestral sequence estimation on data from different protein families, and actually produced some of the ancestral proteins for functional analysis. In addition, the authors have also performed functional analysis of proteins based on the ancestral sequence estimation results based on different data sizes (number of sequences in the alignment/phylogenetic tree) for each protein family. The results of these analyses suggest that GRASP's ancestral sequence estimation, including Indel, is relatively robust to differences in protein family types and analysis data sizes. This should be useful for researchers who perform many ancestral sequence reconstructions.</p>
    <p>　However, we have the following questions and comments about this paper.</p>
    <p>1 The authors have performed ancestral sequence reconstruction experiments, including actual ancestral protein production using GRASP, for three protein families (CYP2U/CYP2R/CYP2D, DHAD, and KARI). As the basal data, the extent to which the sequence data for each of the present organisms falls within the range of sequence similarity should be clearly indicated. In addition, the readers should be able to access the actual alignment, phylogenetic tree, and expressed and analyzed protein sequences. This will allow the readers to better judge the validity of the authors' analyses.</p>
    <p>2 In relation to the above section, it is my understanding that only analyses that do not take into account differences in evolutionary rates between loci when estimating ancestral sequences are valid for GRASP. Note that I have also accessed the web page of the authors' web service. I wonder if such an analysis would be able to recover reasonable amino acid sequences and the presence or absence of indels, especially when using data with low sequence conservation and diverse protein subfamilies. I think this also has an impact on the degree to which ancestral sequence recovery can be done with high confidence when using data sets with a high degree of sequence conservation. It seems to me that the limitations of GRASP need to be analyzed/mentioned in this regard.</p>
    <p>3 The authors' analysis of CYP2U/CYP2R/CYP2D discusses the differences in structural stability and substrate specificity of the recovered ancestral proteins due to the presence or absence of three characteristic independent insertions. This in itself is a good analysis to see the effect of the presence or absence of indel by ancestral sequence restoration. However, a large part of the effect of the presence/absence of the insertion sequence on structure and function is likely to come from the difference in 3D structure due to the presence/absence of the insertion sequence structure, since the 3D structure of the CYP2 family is known (e.g. PDBid 2F9Q), and homology modeling, etc. can be used to determine the structure of the CYP2 family. It would be helpful to have a comparison of three-dimensional structures to further discuss the effectiveness of the ancestral sequence reconstruction performed in this program.</p>
    <p>4 The authors restrict their analysis of data with a high rate of assumed Indels to just However, from a protein engineering perspective, it would be desirable to be able to express and prepare soluble/analyzable ancestor proteins from data with a high percentage of Indel, which can also be described as low sequence similarity. This has advantages, such as increasing the likelihood that enzyme proteins with lower substrate specificity can be made. Real data on such analysis would be very good. Reanalysis of existing data (e.g., reanalysis of ancestral sequence reconstructions from other groups using GRASP) is also acceptable.</p>
    <p>Translated with <ext-link xlink:href="http://www.DeepL.com" ext-link-type="uri">www.DeepL.com</ext-link>/Translator (free version)</p>
    <p>Reviewer #3: I asked two expert sub-reviewers, one with an algorithmic bent and the second with a protein and structural bent. Their reports are presented below. Both found the work important and interesting, with remarkably well-made software. However, the former was not able to understand the details of the algorithms, and the latter has several comments, particularly on the length of the indels. Thus, I (we) recommend acceptance pending major revisions, corresponding to the points below. Hope this helps!</p>
    <p>********************** First sub-reviewer **********************</p>
    <p>From an algorithmic standpoint, the main contribution of this manuscript is the proposal of a new graph-based method to deal with insertions and deletions in ancestral sequence reconstruction (ASR). The new method is named BE (bidirectional-edge encoding) and is implemented in the GRASP software. GRASP is compared against:</p>
    <p>- PS (single-site position-specific reconstruction) implemented in PAML, and</p>
    <p>- SIC (simple indel encoding) implemented in FastML.</p>
    <p>GRASP is capable of handling large trees, and produces reconstructions similar to those of FastML, with the added advantage of presenting them with a graph formalism, which is the natural solution to represent uncertainty in the reconstruction.</p>
    <p>I believe that the GRASP software will be a very useful tool for ASR (I played a bit with the tool at <ext-link xlink:href="http://grasp.scmb.uq.edu.au/" ext-link-type="uri">http://grasp.scmb.uq.edu.au/</ext-link> and I'm very positively impressed). However, I have a few comments on the algorithmic side of this work. These are easy to address, although they will require some more writing:</p>
    <p>**** (1) ****</p>
    <p>I have tried really hard to understand the details of the algorithm at page 32, but I cannot say I understand it. This is important, as this algorithm forms the basis of the new methodology presented here. Here are the aspects that are unclear:</p>
    <p>** 1a. About binary matrix E representing the POG, defined at lines 782-790: Is this matrix triangular? That is E(a,b)&gt;0 only for pairs a</p>
    <p>** 1b. About equation (1) at line 835:</p>
    <p>- The equation would benefit from being decomposed into several equations. It is very hard to read as is.</p>
    <p>- When c belongs to J (i.e. c is a leaf, rightmost cases in lines 1 and 3), the added cost is 0, but this sounds wrong to me: this appears to imply that the cost of any edge at a leaf is 0, but this sounds wrong. Only edges in the extant POG E^(j) should receive a cost of 0, while the remaining ones should have a positive cost (1 or infinite?)</p>
    <p>- In fact, sigma(j,delta,a,b) for j belonging to J (a leaf) should be explicitly defined somewhere, as it will constitute the base case of the recursion.</p>
    <p>** 1c. The sentence "the edge with best score [...] is assigned a score of 1" is confusing (line 831). I guess that the first occurrence of "score" refers to the cost sigma, and the second occurrence refers to E, but I'm not sure.</p>
    <p>** 1d. The whole delta = IN, OUT bit sounds very confusing to me. Couldn't the authors just write (a,b) for one direction and (b,a) for the other?</p>
    <p>** 1e. The inference for a node k seems to be only based on the inferences for its descendants. This is very unusual, as most ASR algorithms include a bottom-up and a top-down phase, allowing information to flow in all directions within the input tree. Does this mean that to get the marginal reconstruction at a specific node, the tree must be re-rooted in that node? If that's the case, it must be said.</p>
    <p>**** (2) ****</p>
    <p>The authors do not cite any paper from a whole line of work from the late 2000s about optimization problems for indel history reconstruction, including both maximum parsimony and maximum likelihood formulations. See for example the work in Mathieu Blanchette's group, the papers by Snir and Pachter (2006, 2011), and this PhD thesis for a review: <ext-link xlink:href="https://escholarship.mcgill.ca/concern/theses/xd07gv166" ext-link-type="uri">https://escholarship.mcgill.ca/concern/theses/xd07gv166</ext-link>.</p>
    <p>I do not consider this to be a major problem, because none of the algorithms developed in those works is likely to be applicable here, due to their poor scalability. Moreover, those works usually assume "phylogenetic correctness" of the ancestral reconstructions, that is, a character that has been deleted cannot be re-inserted back -- a requirement that (interestingly) is not imposed here.</p>
    <p>Despite the important differences, I think that acknowledging and discussing some of these works is very important, to set the background.</p>
    <p>**** (3) ****</p>
    <p>The authors appear to claim that GRASP produces *all* most parsimonious solutions (line 221). However they provide no proof, nor do they provide a clear definition of the parsimony cost function that they wish to optimize. (By the way, for Blanchette's definition of intel parsimony, the problem has been shown to be NP-hard by Chindelevitch et al. 2007, so any exact solution would be very surprising.)</p>
    <p>While a formal treatment would probably be beyond the scope of this paper, I think that unproven claims should be avoided. Unless proven otherwise, the algorithms in GRASP are heuristic, and the authors should acknowledge this.</p>
    <p>********************** Second sub-reviewer **********************</p>
    <p>In line 188, they stated the use of MAFFT to realign the sequences generated by INDELible. I have some experience aligning data coming from alternative splicing with big indels because of the changes in the intron-exon architecture. MAFFT is better than classical aligners, as it tends to create blocks, but it starts to generate errors in the alignments in some conditions, especially with high indel variability and homologous regions (exon duplications). In that context, I have found that ProGraphMSA is a lot better, as it tries to create a phylogenetically sensible gap pattern. I wonder whether such an aligner could better suit this study, but MAFFT is a good choice anyway. All this also makes me wonder how their method performs in the presence of homologous regions inside a protein; is it something challenging for the proposed algorithm?</p>
    <p>I have found it strange that they are mainly working with short indels. In line 954, they state that the maximum indel length created by INDELible is 10. Also, in line 633, they said that they had removed sequences that had the longest indel, over 20 amino acids. Therefore, I wonder how the algorithm performs in scenarios with longer indels.</p>
    <p>I wonder why they avoid having indels from variations in the exon-intron architecture. They mention in line 637 that they have removed sequences that have a difference in exon number larger than two. Limiting the long indel can also help avoid significant changes in exon composition. Even that, I still wonder whether the CYP2U/2R/2D indel events could be related to alternative splicing or exon-intron architecture changes.</p>
    <p>Also, they look to have edited their alignments so much that I wonder whether they have accessed biological insertion and deletions. For example, in line 503, they noted to have trimmed highly gapped columns and used Gblock. I guess that both things can change the number and length of indel events.</p>
    <p>In line 423, they talk about the possible structural location of the indels and their flexibility, but, sadly, the work doesn't have a structural analysis of the reconstructed sequences. I was expecting more on that front, but I guess they haven't seen anything interesting. In particular, because they have explicitly selected sequences with structural data available for the DHAD dataset.</p>
    <p>In line 578, why haven't they subsampled the tree of all sequences to create the guide trees for the multiple sequence alignments avoiding having tree changes? In any case, I guess they would see the same trend but with more minor variations.</p>
    <p>Lastly, did you precisely understand how they filtered the MSA in line 719? The phrase wasn't clear to me.</p>
    <p>**********</p>
    <p>
      <bold>Have the authors made all data and (if applicable) computational code underlying the findings in their manuscript fully available?</bold>
    </p>
    <p>The <ext-link xlink:href="https://journals.plos.org/ploscompbiol/s/materials-and-software-sharing" ext-link-type="uri">PLOS Data policy</ext-link> requires authors to make all data and code underlying the findings described in their manuscript fully available without restriction, with rare exception (please refer to the Data Availability Statement in the manuscript PDF file). The data and code should be provided as part of the manuscript or its supporting information, or deposited to a public repository. For example, in addition to summary statistics, the data points behind means, medians and variance measures should be available. If there are restrictions on publicly sharing data or code —e.g. participant privacy or use of data from a third party—those must be specified.</p>
    <p>Reviewer #1: Yes</p>
    <p>Reviewer #2: <bold>No: </bold>As noted in Comments to Authors, the alignments and phylogenetic trees, in addition to resurrected sequences of ancestral proteins seem not to be found in the main text nor supplemental information as the forms which can be accessed by readers.</p>
    <p>Reviewer #3: None</p>
    <p>**********</p>
    <p>PLOS authors have the option to publish the peer review history of their article (<ext-link xlink:href="https://journals.plos.org/ploscompbiol/s/editorial-and-peer-review-process#loc-peer-review-history" ext-link-type="uri">what does this mean?</ext-link>). If published, this will include your full peer review and any attached files.</p>
    <p>If you choose “no”, your identity will remain anonymous but your review may still be made public.</p>
    <p><bold>Do you want your identity to be public for this peer review?</bold> For information about this choice, including consent withdrawal, please see our <ext-link xlink:href="https://www.plos.org/privacy-policy" ext-link-type="uri">Privacy Policy</ext-link>.</p>
    <p>Reviewer #1: No</p>
    <p>Reviewer #2: No</p>
    <p>Reviewer #3: No</p>
    <p>
      <underline>Figure Files:</underline>
    </p>
    <p>While revising your submission, please upload your figure files to the Preflight Analysis and Conversion Engine (PACE) digital diagnostic tool, <underline><ext-link xlink:href="https://pacev2.apexcovantage.com/" ext-link-type="uri">https://pacev2.apexcovantage.com</ext-link></underline>. PACE helps ensure that figures meet PLOS requirements. To use PACE, you must first register as a user. Then, login and navigate to the UPLOAD tab, where you will find detailed instructions on how to use the tool. If you encounter any issues or have any questions when using PACE, please email us at <underline><email>figures@plos.org</email></underline>.</p>
    <p>
      <underline>Data Requirements:</underline>
    </p>
    <p>Please note that, as a condition of publication, PLOS' data policy requires that you make available all data used to draw the conclusions outlined in your manuscript. Data must be deposited in an appropriate repository, included within the body of the manuscript, or uploaded as supporting information. This includes all numerical values that were used to generate graphs, histograms etc.. For an example in PLOS Biology see here: <ext-link xlink:href="http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5" ext-link-type="uri">http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5</ext-link>.</p>
    <p>
      <underline>Reproducibility:</underline>
    </p>
    <p>To enhance the reproducibility of your results, we recommend that you deposit your laboratory protocols in protocols.io, where a protocol can be assigned its own identifier (DOI) such that it can be cited independently in the future. Additionally, PLOS ONE offers an option to publish peer-reviewed clinical study protocols. Read more information on sharing protocols at <ext-link xlink:href="https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols" ext-link-type="uri">https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols</ext-link></p>
  </body>
</sub-article>
<sub-article article-type="author-comment" id="pcbi.1010633.r002">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r002</article-id>
    <title-group>
      <article-title>Author response to Decision Letter 0</article-title>
    </title-group>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj002" related-article-type="editor-report"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>1</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="author-response-date">22 Jun 2022</named-content>
    </p>
    <supplementary-material id="pcbi.1010633.s019" position="float" content-type="local-data">
      <label>Attachment</label>
      <caption>
        <p>Submitted filename: <named-content content-type="submitted-filename">Response.docx</named-content></p>
      </caption>
      <media xlink:href="pcbi.1010633.s019.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </body>
</sub-article>
<sub-article article-type="aggregated-review-documents" id="pcbi.1010633.r003" specific-use="decision-letter">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r003</article-id>
    <title-group>
      <article-title>Decision Letter 1</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Elofsson</surname>
          <given-names>Arne</given-names>
        </name>
        <role>Section Editor</role>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Punta</surname>
          <given-names>Marco</given-names>
        </name>
        <role>Academic Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2022 Elofsson, Punta</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>Elofsson, Punta</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj003" related-article-type="reviewed-article"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>1</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">27 Jul 2022</named-content>
    </p>
    <p>Dear Dr. Boden,</p>
    <p>Thank you very much for submitting your manuscript "Engineering indel and substitution variants of diverse and ancient enzymes using Graphical Representation of Ancestral Sequence Predictions (GRASP)" for consideration at PLOS Computational Biology. As with all papers reviewed by the journal, your manuscript was reviewed by members of the editorial board and by several independent reviewers. The reviewers appreciated the attention to an important topic. Based on the reviews, we are likely to accept this manuscript for publication, providing that you modify the manuscript according to the review recommendations.</p>
    <p>Please prepare and submit your revised manuscript within 30 days. If you anticipate any delay, please let us know the expected resubmission date by replying to this email.</p>
    <p>When you are ready to resubmit, please upload the following:</p>
    <p>[1] A letter containing a detailed list of your responses to all review comments, and a description of the changes you have made in the manuscript. Please note while forming your response, if your article is accepted, you may have the opportunity to make the peer review history publicly available. The record will include editor decision letters (with reviews) and your responses to reviewer comments. If eligible, we will contact you to opt in or out</p>
    <p>[2] Two versions of the revised manuscript: one with either highlights or tracked changes denoting where the text has been changed; the other a clean version (uploaded as the manuscript file).</p>
    <p>Important additional instructions are given below your reviewer comments.</p>
    <p>Thank you again for your submission to our journal. We hope that our editorial process has been constructive so far, and we welcome your feedback at any time. Please don't hesitate to contact us if you have any questions or comments.</p>
    <p>Sincerely,</p>
    <p>Marco Punta</p>
    <p>Associate Editor</p>
    <p>PLOS Computational Biology</p>
    <p>Arne Elofsson</p>
    <p>Deputy Editor</p>
    <p>PLOS Computational Biology</p>
    <p>***********************</p>
    <p>A link appears below if there are any accompanying review attachments. If you believe any reviews to be missing, please contact <email>ploscompbiol@plos.org</email> immediately:</p>
    <p>[LINK]</p>
    <p>Reviewer's Responses to Questions</p>
    <p>
      <bold>Comments to the Authors:</bold>
    </p>
    <p>
      <bold>Please note here if the review is uploaded as an attachment.</bold>
    </p>
    <p>Reviewer #2: The revised version of this paper appears to be well updated from the original manuscript according to the comments of the reviewers, including myself. I have written four comments on the original manuscript. The authors seem to have generally responded appropriately to my comments and revised the manuscript accordingly. On my first comment, I think that authors' response satisfies my comments on the alignments and phylogenetic trees which were not mentioned in the original manuscript. On my fourth comment, I apologize for the grammatical problems in my comment. Despite this, I appreciate that the response by the authors makes it easier to understand how much indel (gap/insertion) exists between sequences in the alignments for inferring ancestral sequences in the paper.</p>
    <p>However, I would like to comment further on their responses, which are listed below.</p>
    <p>On my second comment (In relation to the above section, it is my understanding that only analyses that do not take into account differences in evolutionary rates between loci when estimating ancestral sequences are valid for GRASP. Note that I have also accessed the web page of the authors' web service. I wonder if such an analysis would be able to recover reasonable amino acid sequences and the presence or absence of indels, especially when using data with low sequence conservation and diverse protein subfamilies. I think this also has an impact on the degree to which ancestral sequence recovery can be done with high confidence when using data sets with a high degree of sequence conservation. It seems to me that the limitations of GRASP need to be analyzed/mentioned in this regard.).</p>
    <p>I understand authors' policy on the treatment of heterogeneity of evolutionary rate among sites. The addition of statement on p. 29 seems to make better understandings by readers including me. However, the manuscript states that it is possible to use a phylogenetic tree that assumes heterogeneity in evolutionary rates among sites obtained from the IQ-Tree. Does this mean that the branch lengths assuming heterogeneity of evolutionary rates among sites in the phylogenetic tree given are treated the same as the branch lengths of the phylogenetic tree assuming homogeneity of evolutionary rates among sites for the estimation of ancestral sequences and ancestral indels in GRASP?</p>
    <p>On my third comment (The authors' analysis of CYP2U/CYP2R/CYP2D discusses the differences in structural stability and substrate specificity of the recovered ancestral proteins due to the presence or absence of three characteristic independent insertions. This in itself is a good analysis to see the effect of the presence or absence of indel by ancestral sequence restoration. However, a large part of the effect of the presence/absence of the insertion sequence on structure and function is likely to come from the difference in 3D structure due to the presence/absence of the insertion sequence structure, since the 3D structure of the CYP2 family is known (e.g. PDBid 2F9Q), and homology modeling, etc. can be used to determine the structure of the CYP2 family. It would be helpful to have a comparison of three-dimensional structures to further discuss the effectiveness of the ancestral sequence reconstruction performed in this program.).</p>
    <p>Authors added the comparison of (predicted) 3D structures of ancestral CYP2Us. I am not familiar on the structure of CYP2Us, it is not easy for me to understand the relationship between AA' loop/D-E loop and indels "LLEE" and "LLSPP". Authors are requested to be re-written the paragraph added at p. 12 of revised manuscript to clarify the relationship between AA' loop/D-E loop and indels "LLEE" and "LLSPP".</p>
    <p>Reviewer #3: Again, I used the same two expert sub-reviewers, one with an algorithmic bent and the second with a protein and structural bent. Their reports are presented below. Both acknowledge the authors’ efforts to improve the clarity and address all the referees’ points. However, they still have many comments and concerns. They recommend acceptance with minor (but mandatory) changes, and I agree with this opinion. Hope this helps!</p>
    <p>********************** First sub-reviewer **********************</p>
    <p>The main comment I had about this manuscript was about the clarity of the new algorithm. Both reviewer 1 and the editor also noted that this had to be improved. Because the authors appear to have put some effort into this, I had another good look into this. Here are two (hopefully constructive) remarks:</p>
    <p>A) First, the description of the bi-directional approach still sounds more complicated than needed. If I had to describe it in my own words I would have said something like:</p>
    <p>For any given internal node k of the tree, and for any site i, the goal is to infer two things:</p>
    <p>- the right neighbor of site i in the sequence at k,</p>
    <p>- the left neighbor of site i in the sequence at k.</p>
    <p>These can be viewed as two characters that can be separately inferred via standard methods in phylogenetics (max parsimony and likelihood), on the basis of the right/left neighborhood relationships in the observed (extant) sequences.</p>
    <p>Barring one detail (see next point), this is probably all that a specialist of ancestral reconstruction will need to understand the bi-directional approach, which is the only methodological novelty here.</p>
    <p>B) A point where there remains some ambiguity is the following, and I really believe that this needs to be clarified:</p>
    <p>When site i is not present in an extant sequence (ie. at a leaf of the tree), how do we set the characters encoding its left and right neighbor? There are two options:</p>
    <p>- we treat them as missing data, which both parsimony and likelihood know how to deal with;</p>
    <p>- we treat them as a special character competing with the other possible left/right neighbors. In the revised manuscript the authors say that they have chosen this option. They call this the "no edge" option.</p>
    <p>What worries me is that the behavior of the online tool seems to contradict the claims made in the manuscript. All the tests I made at <ext-link xlink:href="http://grasp.scmb.uq.edu.au/" ext-link-type="uri">http://grasp.scmb.uq.edu.au/</ext-link> are consistent with encoding the characters above as missing data, not as "no edge"!</p>
    <p>In particular the example in Fig. 6 (introduced in the revised manuscript), allows one to discriminate between the two options above. The online tool launched on this example returns a POG for node N1 where the edges (2,3) and (3,4) have bi-directional support. This is consistent with the "missing data" encoding. However it contradicts the diagrams shown in Fig. 6, where the two edges cited above only have uni-directional support, which is instead consistent with the "no edge" encoding.</p>
    <p>(The reason for these observations are technical but easy to understand: site 3 is only observed in one of the 5 input sequences, so its left and right neighbor at node N1 will be assigned the "no edge" option if it's available; however if the neighbors of 3 are treated as missing data, they will be assigned the only observed left and right neighbors, which are 2 and 4 respectively.)</p>
    <p>The source of the contradiction above is not due to the fact that the online tool implements max likelihood, while Fig. 6 is based on parsimony: I made sure to provide a tree with constant and very small branch lengths, where likelihood and parsimony are equivalent. Here are the file contents necessary to reproduce this example:</p>
    <p>- The tree: ((a:0.001,b:0.001):0.001,c:0.001,(d:0.001,e:0.001):0.001);</p>
    <p>- The sequence alignment:</p>
    <p>&gt;a</p>
    <p>CS-PW</p>
    <p>&gt;b</p>
    <p>RS-PW</p>
    <p>&gt;c</p>
    <p>MADPW</p>
    <p>&gt;d</p>
    <p>MA--W</p>
    <p>&gt;e</p>
    <p>MA--W</p>
    <p>Minor comments</p>
    <p>--------------</p>
    <p>- The superscripts of E in equations (3) and (4) should be (c), not (j).</p>
    <p>- In Fig. 6, E^N2(2,5) should be 0, not 1.</p>
    <p>********************** Second sub-reviewer **********************</p>
    <p>Thanks to the authors for their detailed responses. I appreciate the work they have done trying to address any concerns and questions — including those questions that I asked out of simple curiosity. Next, you will find my comments on each of the authors’ answers:</p>
    <p>(1) Thanks for clarifying the decision behind choosing MAFFT. I have found it interesting that you have found no further improvements in the accuracy of the INDELible MSA reconstructions using ProGraphMSA.</p>
    <p>(2) [A] I understand the point made by the authors. Small changes can indeed cause functional changes and have a lesser structural impact. However, it would be better to assess the structural impact of large indels rather than simply assume them to be destabilizing or artifacts. For example, the AA’ loop, a region longer than 20 residues, doesn’t look essential for the overall domain fold. In fact, it is located between the transmembrane region — or included in the membrane — and the PF00067 domain. Note that even single domain proteins can have long embellishment outside the conserved structural core that can come from insertions or deletions events through evolution. In any case, the 20 residue cutoff for CYP2U1 could be acceptable as the fold is relatively rigid. [B] That’s great. I wonder how common those overlaps are in the presented data. It could be great to add the distribution of indel lengths into supplementary materials. That would help the reader understand the indel length range on which you tested the software.</p>
    <p>(3) Thank you so much for performing this analysis; the results are interesting, even if they are not decisive. I favor not including ENST00000508453.1. I also agree with the author's decision after looking at some orthologs; 5 to 6 exons sound fine for them. However, filtering everything by the number of exon changes sounds arbitrary. But, I understand that it is not easy to have quality assessments, such as the ones described for CYP2U1, for non-model species.</p>
    <p>(4) Thanks for clarifying. Could you split that sentence into two to ease the reader's work? It's not clear how the sequences have been processed. In particular, have they been processed by trimAl?</p>
    <p>(5) Thanks for adding the AlphaFold2 structures; it helps to have an idea of the structural location and impact of the indels.</p>
    <p>(6) Thanks for the clarification. I think the procedure is ok; I was curious. Now, it is unclear how the sampling was performed to avoid potential bias from the phylogenetic signal. I guess they would never be independent samples given their homology.</p>
    <p>(7) Thanks for clarifying this; sadly, it is still unclear to me which variables are used to calculate the entropies. Could you please add the equations? I think that could make it more clear.</p>
    <p>**********</p>
    <p>
      <bold>Have the authors made all data and (if applicable) computational code underlying the findings in their manuscript fully available?</bold>
    </p>
    <p>The <ext-link xlink:href="https://journals.plos.org/ploscompbiol/s/materials-and-software-sharing" ext-link-type="uri">PLOS Data policy</ext-link> requires authors to make all data and code underlying the findings described in their manuscript fully available without restriction, with rare exception (please refer to the Data Availability Statement in the manuscript PDF file). The data and code should be provided as part of the manuscript or its supporting information, or deposited to a public repository. For example, in addition to summary statistics, the data points behind means, medians and variance measures should be available. If there are restrictions on publicly sharing data or code —e.g. participant privacy or use of data from a third party—those must be specified.</p>
    <p>Reviewer #2: Yes</p>
    <p>Reviewer #3: Yes</p>
    <p>**********</p>
    <p>PLOS authors have the option to publish the peer review history of their article (<ext-link xlink:href="https://journals.plos.org/ploscompbiol/s/editorial-and-peer-review-process#loc-peer-review-history" ext-link-type="uri">what does this mean?</ext-link>). If published, this will include your full peer review and any attached files.</p>
    <p>If you choose “no”, your identity will remain anonymous but your review may still be made public.</p>
    <p><bold>Do you want your identity to be public for this peer review?</bold> For information about this choice, including consent withdrawal, please see our <ext-link xlink:href="https://www.plos.org/privacy-policy" ext-link-type="uri">Privacy Policy</ext-link>.</p>
    <p>Reviewer #2: No</p>
    <p>Reviewer #3: No</p>
    <p>Figure Files:</p>
    <p>While revising your submission, please upload your figure files to the Preflight Analysis and Conversion Engine (PACE) digital diagnostic tool, <ext-link xlink:href="https://pacev2.apexcovantage.com" ext-link-type="uri">https://pacev2.apexcovantage.com</ext-link>. PACE helps ensure that figures meet PLOS requirements. To use PACE, you must first register as a user. Then, login and navigate to the UPLOAD tab, where you will find detailed instructions on how to use the tool. If you encounter any issues or have any questions when using PACE, please email us at <email>figures@plos.org</email>.</p>
    <p>Data Requirements:</p>
    <p>Please note that, as a condition of publication, PLOS' data policy requires that you make available all data used to draw the conclusions outlined in your manuscript. Data must be deposited in an appropriate repository, included within the body of the manuscript, or uploaded as supporting information. This includes all numerical values that were used to generate graphs, histograms etc.. For an example in PLOS Biology see here: <ext-link xlink:href="http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5" ext-link-type="uri">http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5</ext-link>.</p>
    <p>Reproducibility:</p>
    <p>To enhance the reproducibility of your results, we recommend that you deposit your laboratory protocols in protocols.io, where a protocol can be assigned its own identifier (DOI) such that it can be cited independently in the future. Additionally, PLOS ONE offers an option to publish peer-reviewed clinical study protocols. Read more information on sharing protocols at <ext-link xlink:href="https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols" ext-link-type="uri">https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols</ext-link></p>
    <p>References:</p>
    <p>Review your reference list to ensure that it is complete and correct. If you have cited papers that have been retracted, please include the rationale for doing so in the manuscript text, or remove these references and replace them with relevant current references. Any changes to the reference list should be mentioned in the rebuttal letter that accompanies your revised manuscript.</p>
    <p>
      <italic toggle="yes">If you need to cite a retracted article, indicate the article’s retracted status in the References list and also include a citation and full reference for the retraction notice.</italic>
    </p>
  </body>
</sub-article>
<sub-article article-type="author-comment" id="pcbi.1010633.r004">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r004</article-id>
    <title-group>
      <article-title>Author response to Decision Letter 1</article-title>
    </title-group>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj004" related-article-type="editor-report"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>2</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="author-response-date">12 Aug 2022</named-content>
    </p>
    <supplementary-material id="pcbi.1010633.s020" position="float" content-type="local-data">
      <label>Attachment</label>
      <caption>
        <p>Submitted filename: <named-content content-type="submitted-filename">Response 2nd.pdf</named-content></p>
      </caption>
      <media xlink:href="pcbi.1010633.s020.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </body>
</sub-article>
<sub-article article-type="aggregated-review-documents" id="pcbi.1010633.r005" specific-use="decision-letter">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r005</article-id>
    <title-group>
      <article-title>Decision Letter 2</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Elofsson</surname>
          <given-names>Arne</given-names>
        </name>
        <role>Section Editor</role>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Punta</surname>
          <given-names>Marco</given-names>
        </name>
        <role>Academic Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2022 Elofsson, Punta</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>Elofsson, Punta</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj005" related-article-type="reviewed-article"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>2</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">27 Sep 2022</named-content>
    </p>
    <p>Dear Dr. Boden,</p>
    <p>Thank you very much for submitting your manuscript "Engineering indel and substitution variants of diverse and ancient enzymes using Graphical Representation of Ancestral Sequence Predictions (GRASP)" for consideration at PLOS Computational Biology. As with all papers reviewed by the journal, your manuscript was reviewed by members of the editorial board and by several independent reviewers. The reviewers appreciated the attention to an important topic. Based on the reviews, we are likely to accept this manuscript for publication, providing that you modify the manuscript according to the review recommendations.</p>
    <p>Please note the comment from one reviewer: I would like to comment in the sense that I would like the paper to be easy to read. That is, in some figures, the letters used in the figures are too small and difficult to read. For example, the letters in the graphs c), d), and e) in Figure 3 seem too small to read.</p>
    <p>Please prepare and submit your revised manuscript within 30 days. If you anticipate any delay, please let us know the expected resubmission date by replying to this email.</p>
    <p>When you are ready to resubmit, please upload the following:</p>
    <p>[1] A letter containing a detailed list of your responses to all review comments, and a description of the changes you have made in the manuscript. Please note while forming your response, if your article is accepted, you may have the opportunity to make the peer review history publicly available. The record will include editor decision letters (with reviews) and your responses to reviewer comments. If eligible, we will contact you to opt in or out</p>
    <p>[2] Two versions of the revised manuscript: one with either highlights or tracked changes denoting where the text has been changed; the other a clean version (uploaded as the manuscript file).</p>
    <p>Important additional instructions are given below your reviewer comments.</p>
    <p>Thank you again for your submission to our journal. We hope that our editorial process has been constructive so far, and we welcome your feedback at any time. Please don't hesitate to contact us if you have any questions or comments.</p>
    <p>Sincerely,</p>
    <p>Arne Elofsson</p>
    <p>Section Editor</p>
    <p>PLOS Computational Biology</p>
    <p>Arne Elofsson</p>
    <p>Section Editor</p>
    <p>PLOS Computational Biology</p>
    <p>***********************</p>
    <p>A link appears below if there are any accompanying review attachments. If you believe any reviews to be missing, please contact <email>ploscompbiol@plos.org</email> immediately:</p>
    <p>[LINK]</p>
    <p>Please note the comment from one reviewer: I would like to comment in the sense that I would like the paper to be easy to read. That is, in some figures, the letters used in the figures are too small and difficult to read. For example, the letters in the graphs c), d), and e) in Figure 3 seem too small to read.</p>
    <p>Reviewer's Responses to Questions</p>
    <p>
      <bold>Comments to the Authors:</bold>
    </p>
    <p>
      <bold>Please note here if the review is uploaded as an attachment.</bold>
    </p>
    <p>Reviewer #2: In the revised version of this paper, authors changed parts where I (and other reviewers) commented to be reconsidered. I think that most of them are improved the clearness of this paper. I think this paper is useful for researchers who are doing ancestral sequence resurrection.</p>
    <p>I would like to comment in the sense that I would like the paper to be easy to read. That is, in some figures, the letters used in the figures are too small and difficult to read. For example, the letters in the graphs c), d), and e) in Figure 3 seem too small to read.</p>
    <p>Reviewer #3: Thanks to the authors for addressing all my comments</p>
    <p>**********</p>
    <p>
      <bold>Have the authors made all data and (if applicable) computational code underlying the findings in their manuscript fully available?</bold>
    </p>
    <p>The <ext-link xlink:href="https://journals.plos.org/ploscompbiol/s/materials-and-software-sharing" ext-link-type="uri">PLOS Data policy</ext-link> requires authors to make all data and code underlying the findings described in their manuscript fully available without restriction, with rare exception (please refer to the Data Availability Statement in the manuscript PDF file). The data and code should be provided as part of the manuscript or its supporting information, or deposited to a public repository. For example, in addition to summary statistics, the data points behind means, medians and variance measures should be available. If there are restrictions on publicly sharing data or code —e.g. participant privacy or use of data from a third party—those must be specified.</p>
    <p>Reviewer #2: Yes</p>
    <p>Reviewer #3: Yes</p>
    <p>**********</p>
    <p>PLOS authors have the option to publish the peer review history of their article (<ext-link xlink:href="https://journals.plos.org/ploscompbiol/s/editorial-and-peer-review-process#loc-peer-review-history" ext-link-type="uri">what does this mean?</ext-link>). If published, this will include your full peer review and any attached files.</p>
    <p>If you choose “no”, your identity will remain anonymous but your review may still be made public.</p>
    <p><bold>Do you want your identity to be public for this peer review?</bold> For information about this choice, including consent withdrawal, please see our <ext-link xlink:href="https://www.plos.org/privacy-policy" ext-link-type="uri">Privacy Policy</ext-link>.</p>
    <p>Reviewer #2: No</p>
    <p>Reviewer #3: No</p>
    <p>Figure Files:</p>
    <p>While revising your submission, please upload your figure files to the Preflight Analysis and Conversion Engine (PACE) digital diagnostic tool, <ext-link xlink:href="https://pacev2.apexcovantage.com" ext-link-type="uri">https://pacev2.apexcovantage.com</ext-link>. PACE helps ensure that figures meet PLOS requirements. To use PACE, you must first register as a user. Then, login and navigate to the UPLOAD tab, where you will find detailed instructions on how to use the tool. If you encounter any issues or have any questions when using PACE, please email us at <email>figures@plos.org</email>.</p>
    <p>Data Requirements:</p>
    <p>Please note that, as a condition of publication, PLOS' data policy requires that you make available all data used to draw the conclusions outlined in your manuscript. Data must be deposited in an appropriate repository, included within the body of the manuscript, or uploaded as supporting information. This includes all numerical values that were used to generate graphs, histograms etc.. For an example in PLOS Biology see here: <ext-link xlink:href="http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5" ext-link-type="uri">http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1001908#s5</ext-link>.</p>
    <p>Reproducibility:</p>
    <p>To enhance the reproducibility of your results, we recommend that you deposit your laboratory protocols in protocols.io, where a protocol can be assigned its own identifier (DOI) such that it can be cited independently in the future. Additionally, PLOS ONE offers an option to publish peer-reviewed clinical study protocols. Read more information on sharing protocols at <ext-link xlink:href="https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols" ext-link-type="uri">https://plos.org/protocols?utm_medium=editorial-email&amp;utm_source=authorletters&amp;utm_campaign=protocols</ext-link></p>
    <p>References:</p>
    <p>Review your reference list to ensure that it is complete and correct. If you have cited papers that have been retracted, please include the rationale for doing so in the manuscript text, or remove these references and replace them with relevant current references. Any changes to the reference list should be mentioned in the rebuttal letter that accompanies your revised manuscript.</p>
    <p>
      <italic toggle="yes">If you need to cite a retracted article, indicate the article’s retracted status in the References list and also include a citation and full reference for the retraction notice.</italic>
    </p>
  </body>
</sub-article>
<sub-article article-type="author-comment" id="pcbi.1010633.r006">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r006</article-id>
    <title-group>
      <article-title>Author response to Decision Letter 2</article-title>
    </title-group>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj006" related-article-type="editor-report"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>3</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="author-response-date">2 Oct 2022</named-content>
    </p>
    <supplementary-material id="pcbi.1010633.s021" position="float" content-type="local-data">
      <label>Attachment</label>
      <caption>
        <p>Submitted filename: <named-content content-type="submitted-filename">Response 3rd.pdf</named-content></p>
      </caption>
      <media xlink:href="pcbi.1010633.s021.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </body>
</sub-article>
<sub-article article-type="editor-report" id="pcbi.1010633.r007" specific-use="decision-letter">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r007</article-id>
    <title-group>
      <article-title>Decision Letter 3</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Elofsson</surname>
          <given-names>Arne</given-names>
        </name>
        <role>Section Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2022 Arne Elofsson</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>Arne Elofsson</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj007" related-article-type="reviewed-article"/>
    <custom-meta-group>
      <custom-meta>
        <meta-name>Submission Version</meta-name>
        <meta-value>3</meta-value>
      </custom-meta>
    </custom-meta-group>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">4 Oct 2022</named-content>
    </p>
    <p>Dear Dr. Boden,</p>
    <p>We are pleased to inform you that your manuscript 'Engineering indel and substitution variants of diverse and ancient enzymes using Graphical Representation of Ancestral Sequence Predictions (GRASP)' has been provisionally accepted for publication in PLOS Computational Biology.</p>
    <p>Before your manuscript can be formally accepted you will need to complete some formatting changes, which you will receive in a follow up email. A member of our team will be in touch with a set of requests.</p>
    <p>Please note that your manuscript will not be scheduled for publication until you have made the required changes, so a swift response is appreciated.</p>
    <p>IMPORTANT: The editorial review process is now complete. PLOS will only permit corrections to spelling, formatting or significant scientific errors from this point onwards. Requests for major changes, or any which affect the scientific understanding of your work, will cause delays to the publication date of your manuscript.</p>
    <p>Should you, your institution's press office or the journal office choose to press release your paper, you will automatically be opted out of early publication. We ask that you notify us now if you or your institution is planning to press release the article. All press must be co-ordinated with PLOS.</p>
    <p>Thank you again for supporting Open Access publishing; we are looking forward to publishing your work in PLOS Computational Biology. </p>
    <p>Best regards,</p>
    <p>Arne Elofsson</p>
    <p>Section Editor</p>
    <p>PLOS Computational Biology</p>
    <p>Arne Elofsson</p>
    <p>Section Editor</p>
    <p>PLOS Computational Biology</p>
    <p>***********************************************************</p>
  </body>
</sub-article>
<sub-article article-type="editor-report" id="pcbi.1010633.r008" specific-use="acceptance-letter">
  <front-stub>
    <article-id pub-id-type="doi">10.1371/journal.pcbi.1010633.r008</article-id>
    <title-group>
      <article-title>Acceptance letter</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Elofsson</surname>
          <given-names>Arne</given-names>
        </name>
        <role>Section Editor</role>
      </contrib>
    </contrib-group>
    <permissions>
      <copyright-statement>© 2022 Arne Elofsson</copyright-statement>
      <copyright-year>2022</copyright-year>
      <copyright-holder>Arne Elofsson</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
      </license>
    </permissions>
    <related-article ext-link-type="doi" xlink:href="10.1371/journal.pcbi.1010633" id="rel-obj008" related-article-type="reviewed-article"/>
  </front-stub>
  <body>
    <p>
      <named-content content-type="letter-date">14 Oct 2022</named-content>
    </p>
    <p>PCOMPBIOL-D-22-00025R3 </p>
    <p>Engineering indel and substitution variants of diverse and ancient enzymes using Graphical Representation of Ancestral Sequence Predictions (GRASP)</p>
    <p>Dear Dr Bodén,</p>
    <p>I am pleased to inform you that your manuscript has been formally accepted for publication in PLOS Computational Biology. Your manuscript is now with our production department and you will be notified of the publication date in due course.</p>
    <p>The corresponding author will soon be receiving a typeset proof for review, to ensure errors have not been introduced during production. Please review the PDF proof of your manuscript carefully, as this is the last chance to correct any errors. Please note that major changes, or those which affect the scientific understanding of the work, will likely cause delays to the publication date of your manuscript. </p>
    <p>Soon after your final files are uploaded, unless you have opted out, the early version of your manuscript will be published online. The date of the early version will be your article's publication date. The final article will be published to the same URL, and all versions of the paper will be accessible to readers.</p>
    <p>Thank you again for supporting PLOS Computational Biology and open-access publishing. We are looking forward to publishing your work! </p>
    <p>With kind regards,</p>
    <p>Zsanett Szabo</p>
    <p>PLOS Computational Biology | Carlyle House, Carlyle Road, Cambridge CB4 3DN | United Kingdom <email>ploscompbiol@plos.org</email> | Phone +44 (0) 1223-442824 | <ext-link xlink:href="http://ploscompbiol.org" ext-link-type="uri">ploscompbiol.org</ext-link> | @PLOSCompBiol</p>
  </body>
</sub-article>
