<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10070275</article-id>
    <article-id pub-id-type="pmid">37012226</article-id>
    <article-id pub-id-type="publisher-id">37439</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-37439-3</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Cellcano: supervised cell type identification for single cell ATAC-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-8757-651X</contrib-id>
        <name>
          <surname>Ma</surname>
          <given-names>Wenjing</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9052-6951</contrib-id>
        <name>
          <surname>Lu</surname>
          <given-names>Jiaying</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1269-7354</contrib-id>
        <name>
          <surname>Wu</surname>
          <given-names>Hao</given-names>
        </name>
        <address>
          <email>wuhao@siat.ac.cn</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.189967.8</institution-id><institution-id institution-id-type="ISNI">0000 0001 0941 6502</institution-id><institution>Department of Computer Science, </institution><institution>Emory University, </institution></institution-wrap>400 Dowman Drive, Atlanta, GA 30322 USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.263488.3</institution-id><institution-id institution-id-type="ISNI">0000 0001 0472 9649</institution-id><institution>Faculty of Computer Science and Control Engineering, Shenzhen Institute of Advanced Technology, Chinese Academy of Sciences, 1068 Xueyuan Avenue, </institution><institution>Shenzhen University Town, </institution></institution-wrap>Shenzhen, 518055 P. R. China </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.189967.8</institution-id><institution-id institution-id-type="ISNI">0000 0001 0941 6502</institution-id><institution>Department of Biostatistics and Bioinformatics, Rollins School of Public Health, </institution><institution>Emory University, </institution></institution-wrap>1518 Clifton Road NE, Atlanta, GA 30322 USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>3</day>
      <month>4</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>3</day>
      <month>4</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>1864</elocation-id>
    <history>
      <date date-type="received">
        <day>20</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>3</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Computational cell type identification is a fundamental step in single-cell omics data analysis. Supervised celltyping methods have gained increasing popularity in single-cell RNA-seq data because of the superior performance and the availability of high-quality reference datasets. Recent technological advances in profiling chromatin accessibility at single-cell resolution (scATAC-seq) have brought new insights to the understanding of epigenetic heterogeneity. With continuous accumulation of scATAC-seq datasets, supervised celltyping method specifically designed for scATAC-seq is in urgent need. Here we develop Cellcano, a computational method based on a two-round supervised learning algorithm to identify cell types from scATAC-seq data. The method alleviates the distributional shift between reference and target data and improves the prediction performance. After systematically benchmarking Cellcano on 50 well-designed celltyping tasks from various datasets, we show that Cellcano is accurate, robust, and computationally efficient. Cellcano is well-documented and freely available at <ext-link ext-link-type="uri" xlink:href="https://marvinquiet.github.io/Cellcano/">https://marvinquiet.github.io/Cellcano/</ext-link>.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Accurately annotating cell types is a fundamental step in single-cell omics data analysis. Here, the authors develop a computational method called Cellcano based on a two-round supervised learning algorithm to identify cell types for scATAC-seq data and perform benchmarking to demonstrate its accuracy, robustness and computational efficiency.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational models</kwd>
      <kwd>Machine learning</kwd>
      <kwd>Software</kwd>
      <kwd>Computational science</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000002</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | National Institutes of Health (NIH)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01GM122083</award-id>
        <principal-award-recipient>
          <name>
            <surname>Wu</surname>
            <given-names>Hao</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Strategic Priority Research Program of Chinese Academy of Sciences, Grant No. XDB38050100</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">The developments of single cell sequencing technologies have greatly enhanced the understanding of biological mechanisms in complex tissues. Among all single cell assays, single-cell RNA-sequencing (scRNA-seq) has been the most popular with over 1200 analytical tools developed<sup><xref ref-type="bibr" rid="CR1">1</xref></sup>. In scRNA-seq data analysis, computational cell type identification based on gene expression values of individual cells (referred to as “celltyping” hereafter) is one of the most fundamental questions. Many celltyping methods are currently available<sup><xref ref-type="bibr" rid="CR2">2</xref>–<xref ref-type="bibr" rid="CR9">9</xref></sup> and several benchmark papers have been published<sup><xref ref-type="bibr" rid="CR10">10</xref>–<xref ref-type="bibr" rid="CR12">12</xref></sup>. These methods can be roughly categorized as supervised and unsupervised. According to benchmark studies, supervised celltyping methods have advantages over unsupervised ones in accuracy, robustness and scalability<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR14">14</xref></sup>.</p>
    <p id="Par4">Gene expression can be regulated by several factors. Among them, chromatin accessibility is essential for the interaction between DNA and regulatory elements, and provides important information for understanding the transcriptional regulatory mechanism<sup><xref ref-type="bibr" rid="CR15">15</xref></sup>. Recent years have also witnessed the shift from measuring chromatin accessibility in bulk samples to single-cell level by single-cell sequencing assay for transposase-accessible chromatin (scATAC-seq)<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>. Like in scRNA-seq, celltyping is also an important question in scATAC-seq data analysis. However, scATAC-seq data have certain characteristics that make the celltyping more difficult. First of all, scATAC-seq data are much sparser due to low read counts<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>, which results in weaker signals for distinguishing cell types. Secondly, unlike scRNA-seq, feature space is not well-defined in scATAC-seq data, which poses difficulties in extracting useful information. The raw scATAC-seq data can be summarized to counts on genome-wide fixed-size bins, peaks representing the accessible regions, or genes<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. Thus, the determination of feature space is an additional important step in scATAC-seq celltyping. Although it is possible to do celltyping through experimental procedures such as Fluorescence-activated cell sorting (FACS)<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> or leveraging information from multi-omics sequencing techniques such as SNARE-seq<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, these datasets are expensive and limited. Therefore, method specifically developed for scATAC-seq celltyping is in urgent need.</p>
    <p id="Par5">Most existing computational scATAC-seq celltyping methods are unsupervised and based on prior knowledge<sup><xref ref-type="bibr" rid="CR21">21</xref>–<xref ref-type="bibr" rid="CR24">24</xref></sup>. As of now, many methods have been developed for single-cell omics data integration while very limited methods have been specifically developed for scATAC-seq celltyping. Seurat<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and scJoint<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> use scRNA-seq as reference to transfer cell labels to scATAC-seq. Due to the strong data distributional shift between different measurements, the two methods can significantly underperform. Signac<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, a recently developed end-to-end scATAC-seq data analysis pipeline, provides functions for scATAC-seq data integration and label transfer. EpiAnno was also published very recently to perform supervised celltyping in scATAC-seq using scATAC-seq as reference<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. A major problem of Signac and EpiAnno is that they use read counts from called peaks as input, where the peaks are highly data dependent. Due to technical and biological artifacts, concordance of peaks can be low between reference and target<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>, which would result in a loss of information and undesirable celltyping results. Additionally, EpiAnno is not computationally scalable for large datasets.</p>
    <p id="Par6">In this work, we develop a computational celltyping method for scATAC-seq, named Cellcano. Cellcano implements a two-round supervised learning algorithm. It first trains a multi-layer perceptron (MLP) on the reference dataset and predicts cell types in target data. From the prediction results, Cellcano selects some target cells that are considered well-predicted (referred to as anchors) to form a new training set. Next, Cellcano trains a self-Knowledge Distiller model (KD model)<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> on anchors using the predicted pseudo labels, and then apply the trained KD model to predict cell types for remaining non-anchor cells. Through extensive real data analyses, we demonstrate that Cellcano is significantly more accurate, computationally efficient, and scalable compared to existing methods. Cellcano is well-documented and freely available at <ext-link ext-link-type="uri" xlink:href="https://marvinquiet.github.io/Cellcano/">https://marvinquiet.github.io/Cellcano/</ext-link>.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>The Cellcano framework</title>
      <p id="Par7">Cellcano uses gene-level summaries from the raw scATAC-seq data as inputs. Given the raw data, Cellcano incorporates ArchR<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> pipeline to process the raw data and obtain gene scores for both reference and target datasets (details in Methods section). The choice of the input is carefully investigated, and the results show that using gene scores provides good prediction accuracy and computational efficiency (details in later section). Then Cellcano applies F-test on reference gene scores to select cell-type-specific genes as features for model construction<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. After obtaining the reference and target gene scores for the selected features, Cellcano adopts a two-round supervised celltyping strategy, shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>. In the first round, Cellcano trains an MLP model with reference gene scores and predicts cell types in target data. If the target size is too small, Cellcano stops and returns the prediction results. When the target size is large enough (e.g., over 1000 cells), Cellcano performs another round of model training to improve the prediction results. The second round starts with selecting anchor cells. For that, we first calculate entropy for each cell based on the prediction probabilities from the first-round prediction and then select cells with lower entropies as anchors. The assumption is that the cells with lower prediction entropies are more likely to be accurately predicted. We carefully investigate the anchor cell properties and their impact on the prediction results (details in later section) and demonstrate that the assumption holds well in real data. We then use the anchors with their predicted cell types as new reference data to train another classifier to predict the non-anchor cells. Here, we use a KD model as the classifier since it works better when reference data have imperfect labels. The assumption in the second round is that the classifier trained on anchors (which are from the target data) can better capture the data distribution in the target dataset compared to the classifier trained on the reference dataset, thus improve the prediction performance.<fig id="Fig1"><label>Fig. 1</label><caption><title>Overview of Cellcano framework.</title><p>Cellcano adopts a two-round prediction strategy. In the first round, Cellcano trains a Multi-layer Preceptron (MLP) model on reference gene scores with known cell labels. Then, Cellcano uses the trained MLP to predict cell types on target gene scores. When the target size is sufficiently large, Cellcano starts the second round by selecting anchors. With the predicted probability matrix obtained from the first-round prediction, entropies are calculated for each cell. Cells with relatively low entropies are selected as anchors to train a Knowledge Distillation (KD) model. The trained KD model is used to predict cell types in remaining non-anchors.</p></caption><graphic xlink:href="41467_2023_37439_Fig1_HTML" id="d32e384"/></fig></p>
    </sec>
    <sec id="Sec4">
      <title>Celltyping tasks</title>
      <p id="Par8">We collect and process four human peripheral blood mononuclear cells (PBMCs) datasets and two mouse brain datasets (Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref>; details in Methods section). Among four human PBMCs datasets, one is cell-sorted by FACS and can be considered as gold standard. The cell types in other three datasets are annotated based on computational methods and prior biological knowledge, which are silver standard<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. For the six datasets, we design 50 celltyping tasks (details in Supplementary Note <xref rid="MOESM1" ref-type="media">1</xref>; tasks listed in Supplementary Dataset <xref rid="MOESM4" ref-type="media">1</xref> and <xref rid="MOESM5" ref-type="media">2</xref>), which comprehensively cover different real application scenarios. All results in following subsections are based on these tasks.</p>
    </sec>
    <sec id="Sec5">
      <title>The choice of using gene score as input</title>
      <p id="Par9">As mentioned before, scATAC-seq data can be represented in three different feature spaces: genome-wide fixed-size bins, peaks, and genes. Genome-wide fixed-size bins have a very large feature space, which poses heavy computational burden. The peaks are not pre-defined and require additional steps in calling and unifying peaks. More importantly, since the peaks will be different for each dataset, one cannot reuse a pre-trained prediction model for new target data. In this work, we choose gene scores as input because they are well defined and have a small feature space. Also, it is possible to further connect the model trained on gene scores to scRNA-seq models, and vice versa. There are different ways of summarizing gene scores<sup><xref ref-type="bibr" rid="CR18">18</xref>,<xref ref-type="bibr" rid="CR30">30</xref></sup> and our first question is how to utilize these gene score models. In total, ArchR provides 54 variations of gene score models (details in Supplementary Note <xref rid="MOESM1" ref-type="media">2</xref>), and its recommended one is shown to be the most accurate to infer gene expression in matched scATAC-seq and scRNA-seq data. From real data analysis, we show that using the ArchR recommended gene score model achieves good celltyping performances from Cellcano (details in Supplementary Note <xref rid="MOESM1" ref-type="media">3</xref>).</p>
      <p id="Par10">We next evaluate Cellcano with the recommended gene score or fixed-size 500-bp bin counts as input in both human PBMCs and mouse brain celltyping tasks. The comparison of prediction performances from human PBMCs is shown in Fig. <xref rid="Fig2" ref-type="fig">2a</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a, b</xref>. The two types of inputs produce comparable prediction accuracies in most celltyping tasks, while results in ARI and macroF1 show that using gene scores is significantly better. In mouse brain celltyping tasks, Cellcano with gene scores as input is better than using fixed-size bins in 62 out of 63 prediction results (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">1c, d</xref>), except one in mouse brain celltyping task using ARI as measurement (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1c</xref>). Overall, these results demonstrate that using gene scores as inputs works better than using bin counts. In addition, the computational time for using gene scores as input is much shorter (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). Considering both computational and prediction performances, we decide to use the ArchR recommended gene scores as Cellcano’s default input.<fig id="Fig2"><label>Fig. 2</label><caption><title>Cellcano’s parameter selection.</title><p><bold>a</bold>–<bold>c</bold> Focus on exploring performances between using different input for Cellcano. <bold>a</bold>, <bold>b</bold> Accuracies comparison on Cellcano using genome-wide fixed-size bins and gene scores as input from (<bold>a</bold>) <italic>n</italic> = 29 human PBMCs celltyping tasks and (<bold>b</bold>) <italic>n</italic> = 21 mouse brain celltyping tasks. The red dotted lines are identity lines. <bold>c</bold> Model training time comparison using the two different inputs on all <italic>n</italic> = 50 celltyping tasks. <bold>d</bold>, <bold>e</bold> demonstrate the selection of the appropriate number of anchors. <bold>d</bold>, <bold>e</bold> Accuracy gains/losses using different entropy cutoffs on (<bold>d</bold>) <italic>n</italic> = 29 human PBMCs celltyping tasks and (<bold>e</bold>) <italic>n</italic> = 21 mouse brain celltyping tasks. Inside the boxes, the middle line indicates the median of the data while the bottom and upper lines indicate the 25th percentile and the 75th percentile of the data. Outside the boxes, the whiskers extend to the minimum and maximum values no greater than 1.5 times interquartile range. Those values outside the range are outliers, which are represented as dots with corresponding colors. Each box in (<bold>d</bold>) contains <italic>n</italic> = 29 prediction results and each box in (<bold>e</bold>) contains <italic>n</italic> = 21 prediction results. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_37439_Fig2_HTML" id="d32e523"/></fig></p>
    </sec>
    <sec id="Sec6">
      <title>Properties of Cellcano anchors</title>
      <p id="Par11">Cellcano selects anchor cells from the target dataset based on the prediction entropy from the first round (details in the Methods section) and uses them as reference to predict cell types for non-anchors in the second round. The number of anchors is specified by user as a cutoff for the quantiles of entropies. For example, when using 0.3 entropy quantile cutoff, 30% of the cells in the target dataset will be selected as anchor cells. As an exploration, we first compare the performance between anchors and non-anchors under different quantile cutoffs (0.1 to 0.6 with step size 0.1) in human PBMCs celltyping tasks and mouse brain celltyping tasks. Results (details in Supplementary Note <xref rid="MOESM1" ref-type="media">4</xref>) show that the final prediction performance depends on a balance between anchor numbers and anchor accuracy.</p>
      <p id="Par12">We then summarize the final prediction performances using different entropy quantiles in human PBMCs celltyping tasks (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">2a, b</xref>) and mouse brain celltyping tasks (Fig. <xref rid="Fig2" ref-type="fig">2e</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">2c, d</xref>). Each celltyping task has a prediction baseline which is calculated as the average performance by using different quantile cutoffs. We calculate the gains/losses for using each quantile cutoff against the average performance. Overall, the performances are stable when using 0.2 or above as quantile cutoffs (the median Acc varies within −0.4% ~ +0.9% in human PBMCs celltyping tasks and −0.9% ~ +1.4% in mouse brain celltyping tasks). The worst performance occurs when using 0.1 as the quantile cutoff. This can be explained by the small training size in the second round and the failure of capturing the target data distribution. In conclusion, when using a moderate number of anchor cells, Cellcano can produce comparable prediction results. By default, we use 0.4 as the entropy quantile cutoff in our software implementation. Moreover, since Seurat also has an anchor selection step, we perform comparisons and show that Cellcano anchors are more accurate and can better capture the full scope of target data distribution (details in Supplementary Note <xref rid="MOESM1" ref-type="media">5</xref>).</p>
    </sec>
    <sec id="Sec7">
      <title>Cellcano outperforms existing supervised scATAC-seq celltyping methods</title>
      <p id="Par13">After deciding the input data and the anchor numbers for Cellcano, we compare Cellcano with other supervised scATAC-seq celltyping methods. We benchmark Cellcano against six competing supervised celltyping methods: Seurat<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, scJoint<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>, Signac<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>, EpiAnno<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>, ACTINN<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, and SingleR<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. Even though Seurat and scJoint are not specifically designed for scATAC-seq celltyping using scATAC-seq data as reference, they can take gene scores as input for cell type prediction. For Signac, we follow its recently published scATAC-seq integration vignettes to first process raw scATAC-seq data into peak counts and then perform data integration along with label transfer. For EpiAnno, we use ArchR to call peaks and count reads overlapping the peak regions to generate peak-by-cell matrices as its input. ACTINN is a deep learning based method which is very similar to the first-round prediction of Cellcano. SingleR is a correlation-based supervised scRNA-seq celltyping method. According to a recent survey study, SingleR is the second-best performer behind Seurat in scRNA-seq celltyping<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>. Even though ACTINN and SingleR are designed for scRNA-seq celltyping, they do not make any scRNA-seq specific assumptions on the input data and thus can take the gene scores as input for scATAC-seq celltyping. We include them because we want to explore whether existing scRNA-seq supervised celltyping methods can be directly applied to scATAC-seq with gene scores as input. In addition, we also include another set of comparisons by first removing the batch effect between reference and target datasets and then use an MLP to transfer cell labels (details in the next section). We put all the results together to make direct comparisons on prediction performances. We evaluate the prediction performances from all methods by different metrics, including overall accuracy (Acc), adjusted rand index (ARI), macro F1 score (macroF1), Cohen’s kappa (κ), median F1 score (medianF1), median precision, and median recall.</p>
      <p id="Par14">We first focus on the celltyping methods and compare the performances where we have one fixed gold standard target data (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>). In total, there are seven celltyping tasks using different references. We order the boxplot according to the average performance. The results show that Cellcano achieves the highest average accuracy as 0.852 in the seven celltyping tasks (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>), while scJoint is a close second with average accuracy as 0.837 and the third performer ACTINN has an average accuracy as 0.782. The accuracies from all other methods are significantly lower. For all other metrics (Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>), Cellcano and scJoint in general have the highest performances compared to all other methods, consistent with the results in prediction accuracy. Overall, the third best performer is ACTINN which is a variation of Cellcano first-round prediction. The performance differences between Cellcano and ACTINN indicate the performance improvements by introducing our second-round prediction.<fig id="Fig3"><label>Fig. 3</label><caption><title>Performance comparisons between Cellcano and other competing methods along with illustrations on how Cellcano outperforms.</title><p><bold>a–c</bold> Accuracy comparisons between Cellcano, Seurat, scJoint, Signac, SingleR, ACTINN, and EpiAnno along with other integration with label transfer methods on (<bold>a</bold>) <italic>n</italic> = 7 celltyping tasks using one human PBMCs FACS-sorted dataset as target, (<bold>b</bold>) <italic>n</italic> = 22 more human PBMCs celltyping tasks and (<bold>c</bold>) <italic>n</italic> = 21 mouse brain celltyping tasks. Inside the boxes, the middle line indicates the median of the data while the bottom and upper lines indicate the 25th percentile and the 75th percentile of the data. Outside the boxes, the whiskers extend to the minimum and maximum values no greater than 1.5 times interquartile range. Those values outside the range are outliers, which are represented as dots with corresponding colors. Note that we use red dots to indicate the mean of the data. Each box in (<bold>a</bold>) contains <italic>n</italic> = 7 prediction results, each box in (<bold>b</bold>) contains <italic>n</italic> = 22 prediction results and each box in (<bold>c</bold>) contains <italic>n</italic> = 21 prediction results. The boxplots are ordered to have the leftmost method with the highest average performance. <bold>d</bold>–<bold>f</bold> t-SNE plots from one of the celltyping tasks using FACS-sorted dataset as target that contains <italic>n</italic> = 21,214 cells. The cells are colored with (<bold>d</bold>) ground truth labels; (<bold>e</bold>) Cellcano first-round predicted labels; and (<bold>f</bold>) Cellcano second-round predicted labels. The highlighted areas illustrate Cellcano’s ability to correct wrongly assigned cells predicted from the first round. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_37439_Fig3_HTML" id="d32e666"/></fig></p>
      <p id="Par15">We then evaluate the performances in all other 22 human PBMCs celltyping tasks (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4</xref>). Since the celltyping tasks involve different target datasets, the baseline performance for each celltyping task can vary. We eliminate such baseline effect by computing the performance gains/losses for each method against the average. To be specific, we take the average of the prediction performances from all seven methods for each celltyping task, and then subtract the average from the performances for each method. From these experimental scenarios, Cellcano ranks first in average accuracy gain and average ARI gain where Signac ranks the second. Signac slightly outperforms Cellcano in average macroF1 gain. Overall, ACTINN ranks the third. Similarly, we evaluate the performances in 21 mouse brain celltyping tasks (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">5</xref>) and observe that Cellcano again outperforms all other methods with most accuracy gain as 0.144. In the meantime, Signac acts as the second-best performer with accuracy gain as 0.134 and ACTINN acts as the third-best performer with accuracy gain as 0.120. Note that EpiAnno fails to generate results for two relatively larger (over 32k cells) celltyping tasks due to memory limit. Taking all 50 celltyping tasks together, we perform a paired <italic>t</italic>-test on Accuracy, ARI and macroF1 in three comparisons: (1) Cellcano and ACTINN, (2) Cellcano and scJoint, and (3) Cellcano and Signac. The test statistics show that Cellcano performs significantly better than ACTINN (<italic>p</italic>-value: 4.857e-3), scJoint (<italic>p</italic>-value: 1.645e-3) and Signac (<italic>p</italic>-value: 0.023) in Accuracy. Results hold for all comparisons in ARI. For macroF1, Cellcano slightly outperforms ACTINN while largely outperforms scJoint and Signac. In summary, Cellcano outperforms all other methods considering all scenarios: two systems (human PBMCs and mouse brain), 50 celltyping tasks, and seven metrics.</p>
      <p id="Par16">To further demonstrate how the two-round procedure in Cellcano outperforms, we use one celltyping task (one FACS-sorted human PBMCs dataset as target, a combination of four individuals from Satpathy et al.<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> PBMCs dataset as reference) as an example to visualize the prediction results after each round by tSNE and UMAP. Figure <xref rid="Fig3" ref-type="fig">3d</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">6a</xref> labels the ground truth cell types provided by FACS. After the first-round prediction, some cells in B cell and natural killer (NK) are wrongly predicted as Monocytes (Fig. <xref rid="Fig3" ref-type="fig">3e</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">6b</xref>, red boxes). After the second round, the wrong predictions are corrected (Fig. <xref rid="Fig3" ref-type="fig">3f</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">6c</xref>, red boxes). Another observation is that many CD8 T cells on the boundary between CD4 T cell and CD8 T cell clusters (black dotted line area) are not correctly predicted. After the second round, most of these cells are correctly assigned back to CD8 T cells. We also visualize the predicted correctness, entropy, and predicted probabilities of CD8 T cells before and after second-round prediction (Supplementary Fig. <xref rid="MOESM1" ref-type="media">7a–f</xref>). The increased correctness and confidence in predicting cell types demonstrate the advantage of having our second-round prediction with KD model. Similarly in an example mouse brain celltyping task (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>), some inhibitory neurons are wrongly predicted as Astrocytes and Microglias are wrongly predicted as Oligodendrocytes after the first-round prediction and those are corrected after the second-round prediction (Supplementary Fig. <xref rid="MOESM1" ref-type="media">8</xref>, red boxes). These visualization examples demonstrate the advantage of having our second-round prediction with KD model.</p>
    </sec>
    <sec id="Sec8">
      <title>Cellcano works better than prediction with batch effect removed</title>
      <p id="Par17">A key advantage of the two-round approach in Cellcano is that training a model using anchors in target data alleviates the distributional shift problem between the reference and target data. The distributional shift is often caused by batch effect in high-throughput data. This leads to a question whether our two-round strategy is better than the one where we first remove batch effect and then apply a direct prediction. According to a recent benchmark study<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, LIGER<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> and ComBat<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> are the top performers when integrating scATAC-seq datasets. Although we have proven that using gene scores as input is the best choice for Cellcano, in this benchmarking study, genome-wide bins or peaks are suggested as inputs for the integration tasks. We therefore follow the suggestions and include four top-performing integration combinations into our comparison: LIGER with genome-wide bins as input, LIGER with peaks as input, ComBat with genome-wide bins as input and ComBat with peaks as input as integration methods. We are also interested in knowing how batch-effect removed methods work with gene scores as input. Therefore, we added Harmony<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>, which was demonstrated to have the best performance and shortest running time in previous batch-effect removal benchmark study in scRNA-seq data<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>. In the meantime, we also included Portal<sup><xref ref-type="bibr" rid="CR39">39</xref></sup>, a recently published integration method which has not been benchmarked and can take gene scores as input. After performing the integration between reference and target datasets, we apply MLP as classifier to transfer cell labels according to the integrated output (details in Methods section). We evaluate the prediction performances by Acc, ARI and macroF1.</p>
      <p id="Par18">As mentioned earlier, we put all prediction results from celltyping and integration with label transfer into boxplots (Fig. <xref rid="Fig3" ref-type="fig">3a–c</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">3a, b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">4a, b</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">5a, b</xref>) for a direct comparison. Since boxplots provide marginal distributions which represent the overall performances, we add heatmaps (Supplementary Figs. <xref rid="MOESM1" ref-type="media">9</xref>, <xref rid="MOESM1" ref-type="media">10</xref>) with original prediction performances to show a full scope comparison. We categorize the heatmaps by different types of celltyping tasks and make the leftmost column have the highest average performances. When focusing on all integration with label transfer methods, ComBat with peaks as input and ComBat with genome-wide bins as input rank top, however, they do not outperform the top celltyping performers and thus are inferior to Cellcano. We generate a low-dimensional visualization before (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11a</xref>) and after the batch effect removal (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11b–e</xref>) on one example where one FACS-sorted PBMCs data is taken as target and four individuals from Satpathy et al. are combined as reference. We can observe that even when the batch effect removal methods work well on integrating reference and target datasets or integrating individuals (Supplementary Fig. <xref rid="MOESM1" ref-type="media">11c, d</xref> using LIGER and Portal), the celltyping results are not necessarily better. In conclusion, these comparisons demonstrate that Cellcano can handle data from different individuals and batches in both reference and target data. Cellcano does not need to remove batch effect and steadily outperforms other integration with label transfer methods. This provides the possibility of training predication models using a large compendium of datasets.</p>
    </sec>
    <sec id="Sec9">
      <title>Cellcano is computationally efficient and scalable</title>
      <p id="Par19">We evaluate the computational performance of Cellcano and show all celltyping methods’ runtime for all celltyping tasks (Fig. <xref rid="Fig4" ref-type="fig">4a, b</xref>). For fair comparisons, we combine the training time and prediction time into an overall runtime for Cellcano and EpiAnno. This is because all other methods need both reference and target datasets as input to do prediction. Here, we do not consider the data pre-processing time (such as the time used for generating peak counts or gene scores from the raw data). We sort the celltyping tasks by the total number of cells in reference and target datasets. The results indicate that when the cell number is low, Cellcano, Seurat and scJoint use about the same runtime. However, when the cell number starts increasing, Seurat and scJoint can be three times slower than Cellcano. Signac is 2 ~ 3 slower than Cellcano when predicting cell types for human PBMCs tasks while its running time is comparable to Cellcano in mouse brain celltyping tasks. All other methods are 5 ~ 100 times slower than Cellcano. The reason why ACTINN as one-round prediction is slower than Cellcano is because ACTINN uses all genes for training while Cellcano selects 3000 genes as features. An additional advantage is that Cellcano is a supervised celltyping method, the pretrained models can be re-used in future predictions, which means the runtime can be further reduced with the first-round pretrained model as input.<fig id="Fig4"><label>Fig. 4</label><caption><title>Computational performance comparison.</title><p><bold>a</bold>, <bold>b</bold> Run time comparisons among Cellcano, Seurat, scJoint, Signac, SingleR, ACTINN, and EpiAnno on (<bold>a</bold>) <italic>n</italic> = 29 human PBMCs celltyping tasks and (<bold>b</bold>) <italic>n</italic> = 21 mouse brain celltyping tasks. The <italic>x</italic>-axis indicates each celltyping task and is ordered by the total number of cells in the reference and target datasets. Note that EpiAnno fails to generate results for two mouse brain celltyping tasks where the cell numbers are large. Source data are provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_37439_Fig4_HTML" id="d32e827"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par20">Computational celltyping for single cell omics data is an important problem. Such methods are under-developed for scATAC-seq data. In this work, we develop Cellcano, a two-round supervised scATAC-seq celltyping method. Due to distributional shift, the first-round prediction can be inaccurate, and the anchors can be noisy. The KD model in the second round is thus used to distill the knowledge from a noisily labeled input. We have shown in 50 celltyping tasks with data from two systems (human PBMCs and mouse brain) that Cellcano significantly outperforms other celltyping methods and integration with label transfer methods both in prediction and computational performances. Cellcano is also robust against the anchor selection procedure and batch effects in the data.</p>
    <p id="Par21">Cellcano has several advantages and methodological features. First, Cellcano uses gene scores as input, which has many advantages compared to using bin or peak counts: (1) genes have a much smaller feature space, which significantly improve the computational performance; (2) genes are shared among datasets, which provides potential to be further connected to other modalities, such as gene expression data. We show that using gene scores works as equally well or even better than using bin counts as input. Secondly, Cellcano implements strategies in selecting and using anchors. The MLP in Cellcano can better capture the non-linear relationship between the gene scores and the corresponding cell types. In addition, the KD model is robust to anchors with noisy labels. Moreover, Cellcano does not need to jointly operate on the reference and target datasets, like Seurat, Signac, and scJoint does. This allows Cellcano to be trained on a compendium of reference datasets and provide a pre-trained model.</p>
    <p id="Par22">There are some further developments for Cellcano we plan to work on. First, Cellcano can be adapted to other celltyping scenarios, for example, cross-modality predictions (using scRNA-seq as reference for scATAC-seq celltyping), celltyping in single-cell DNA methylation, etc. Another interesting question is to use multimodal reference data, for example, to jointly use scRNA- and scATAC-seq data as reference to improve celltyping results for either scRNA- and scATAC-seq data. Such an approach can potentially further improve prediction performance.</p>
  </sec>
  <sec id="Sec11">
    <title>Methods</title>
    <sec id="Sec12">
      <title>Overall scheme of data processing and analysis</title>
      <p id="Par23">Conceptually, the design for the celltyping task is rather straightforward (Supplementary Fig. <xref rid="MOESM1" ref-type="media">12</xref>). Below are the details in each step.<list list-type="order"><list-item><p id="Par24">Data collection and genome unification: We collected four datasets from human PBMCs and two datasets from mouse brains and then downloaded the raw scATAC-seq data (10X fragment files or bam files). The original raw data sometimes are aligned to different versions of genomes, we therefore use liftOver to unify the human PBMCs data to hg19 genome and the mouse brains data to mm10 genome. After unification, we use ArchR to process the raw scATAC-seq data. Note that for Signac, we need an additional step to convert bam files into fragment files with sinto (<ext-link ext-link-type="uri" xlink:href="https://timoast.github.io/sinto/installation.html">https://timoast.github.io/sinto/installation.html</ext-link>).</p></list-item><list-item><p id="Par25">Preprocess raw data with ArchR: In ArchR, we set genome hg19 for human PBMCs datasets and mm10 for mouse brain datasets. Then, we load the downloaded fragment files or bam files as input for ArchR to generate the <italic>ArrowFiles</italic> with <italic>createArrowFiles</italic>() function. In the function, two parameters serve with quality control purpose: <italic>minTSS</italic> and <italic>minFrags</italic>. We adjust the thresholds according to original papers to obtain high-quality cells and we use default thresholds from ArchR for those datasets with no explicit quality control information provided.</p></list-item><list-item><p id="Par26">Generate feature matrices: The gene score matrices and genome-wide fixed-size bin counts are generated using the default setting in ArchR. The gene score matrix is generated with ArchR recommended gene score model (details in Supplementary Note <xref rid="MOESM1" ref-type="media">1</xref>). The bin counts are generated with 500-bp bins genome-wide. This results in around 6 million bins in hg19 and 5 million bins in mm10. To accelerate the data loading time, we filter out the bins with non-zero counts in less than 1% cells to reduce the feature space. The peak-by-cell matrices generation needs additional peak calling steps in ArchR. To reuse the <italic>ArrowFiles</italic> generated earlier, we put <italic>ArrowFiles</italic> from all human PBMCs datasets together and call peaks. ArchR first clusters cells and then creates pseudo-bulk replicates to assure the reproducibility of peak calling. Once the peaks are obtained, reads are counted on the peak regions to generate the peak count matrices. The same procedure has been performed in mouse brain datasets. Note that for Signac, we use raw fragment files as input.</p></list-item><list-item><p id="Par27">Cell type curation and construct celltyping tasks: Once having all generated feature-level matrices, we curate the cell types for human PBMCs datasets and mouse brain datasets (details in Supplementary Note <xref rid="MOESM1" ref-type="media">6</xref>). Then, according to our prediction task designs on celltyping (details in Supplementary Note <xref rid="MOESM1" ref-type="media">1</xref>; celltyping tasks listed in Supplementary Dataset <xref rid="MOESM4" ref-type="media">1</xref> and <xref rid="MOESM5" ref-type="media">2</xref>), we select one reference dataset with cell type information and one target dataset without cell type information to perform Cellcano as well as other benchmarked supervised celltyping methods. As for the batch effect removal methods, we first integrate the reference and target datasets without cell type information. Then, when we have the corrected data, we extract the corrected reference data and feed in the cell type information. Finally, we use MLP to predict cell types in the corrected target data.</p></list-item></list></p>
    </sec>
    <sec id="Sec13">
      <title>Input data for Cellcano</title>
      <p id="Par28">Cellcano is a supervised celltyping model, therefore, cell type information of the reference dataset is required. As for the input data format, Cellcano can use either raw scATAC-seq data or processed gene score matrices as inputs. As mentioned in the last section, if the input is raw scATAC-seq data, ArchR is first performed to generate gene scores for the reference and target datasets. If users already have derived gene scores from the reference data, they can also be taken as the input for Cellcano. In such case, it is recommended to have the same gene score calculation procedures for reference and target datasets to assure the first-round prediction performance.</p>
    </sec>
    <sec id="Sec14">
      <title>Cellcano model</title>
      <p id="Par29">Once we have the gene scores from both reference and target datasets, we assume there are <italic>G</italic> genes and <italic>N</italic> cells in the reference, and <italic>M</italic> cells in the target data, we define the gene score matrices in reference and target data as <inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{X}_{{ref}}\in{\mathbb{R}}}^{G\times N}$$\end{document}</tex-math><mml:math id="M2"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi><mml:mo>×</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_37439_Article_IEq1.gif"/></alternatives></inline-formula> and <inline-formula id="IEq2"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{X}_{{tgt}}\in{\mathbb{R}}}^{G\times M}$$\end{document}</tex-math><mml:math id="M4"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>g</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi><mml:mo>×</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_37439_Article_IEq2.gif"/></alternatives></inline-formula>, respectively. In the reference gene scores, we first perform a feature selection step to select representative features. The features are selected by F-test with known cell type labels, represented as <inline-formula id="IEq3"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{C}_{{ref}}\in{\mathbb{R}}}^{N\times 1}$$\end{document}</tex-math><mml:math id="M6"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="41467_2023_37439_Article_IEq3.gif"/></alternatives></inline-formula>. We have previously shown that features selected by F-test in reference data can provide the best results in supervised scRNA-seq celltyping<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. By default, we select top 3000 genes with the largest F-statistics. We obtain the reference and target gene scores for the selected features and perform data normalization. To be specific, we normalize the cell-wise gene scores so that the total gene scores sum to 10,000 for each cell. We then take log-transformation on the normalized gene scores plus 1. After that, we perform gene-wise standardization on the log normalized gene scores so that each gene will have zero-mean and unit-variance. The standardization is a recommended procedure for performing efficient backpropagation in neural networks<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>.</p>
      <p id="Par30">In Cellcano’s first-round prediction, we first train an MLP model with a <italic>ReLU</italic> activation function to capture the non-linear mapping between the <italic>X</italic><sub><italic>ref</italic></sub> and <italic>C</italic><sub><italic>ref</italic></sub>. For a multi-class classification with <italic>K</italic> cell types, the cell type label <italic>C</italic><sub><italic>ref</italic></sub>  is one-hot encoded to a binary matrix with dimension <italic>N × K</italic>. The one-hot encoding labels the corresponding class as 1 and all others as 0 for each cell. The last layer of MLP is connected to a softmax function to convert the outputs from the last layer of the MLP to probabilities. The softmax function is represented by<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma \left({Z}_{i}\right)=\frac{{{\exp}}\left(\frac{{Z}_{{{{{{\rm{i}}}}}}}}{T}\right)}{{\sum }_{k=1}^{K}{{\exp}}\left(\frac{{Z}_{k}}{T}\right)}.$$\end{document}</tex-math><mml:math id="M8"><mml:mi>σ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>exp</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msubsup><mml:mi>exp</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2023_37439_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>Here, Z<sub><italic>i</italic></sub> represents the outputs from the last layer of the MLP, and <italic>T</italic> is a hyperparameter representing the temperature of the softmax function. The larger the <italic>T</italic> is, the smoother the <italic>σ</italic>(<italic>Z</italic><sub>i</sub>) will be. We set <italic>T</italic> = 1 in the first-round MLP model. During training, we use cross-entropy as the loss function to minimize the distributional difference between the one-hot encoded cell type label <italic>p</italic> and the predicted cell type probabilities <italic>σ</italic>(<italic>Z</italic>):<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$H\left(p,\,\sigma (Z)\left)\right.\right)=-\mathop{\sum }\limits_{i=1}^{N}\mathop{\sum }\limits_{k=1}^{K}{p}_{{ik}}\log (\sigma {\left({Z}_{i}\right)}_{k}).$$\end{document}</tex-math><mml:math id="M10"><mml:mi>H</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>σ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>σ</mml:mi><mml:msub><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2023_37439_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par31">After training the MLP model, we apply the trained MLP model to the target data to obtain the probabilities for each cell being in each cell type.</p>
      <p id="Par32">When the target data size is small, Cellcano takes the class with the largest probability as the final predicted cell type for each cell and stops. When the target size is large (over 1000 cells by default), we perform a second-round prediction. We first select anchors from the target, and we aim at selecting accurate anchors, which can also capture the full scope of target distribution to guide the second-round prediction. With the first-round predicted probabilities, denoted as <italic>q</italic><sub><italic>ik</italic></sub> for cell <italic>i</italic> being in cell type <italic>k</italic>, we calculate the entropy <italic>E</italic><sup><italic>M×1</italic></sup> for all M cells as<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${E}_{i}=-\mathop{\sum }\limits_{k=1}^{K}{q}_{{ik}}\log ({q}_{{ik}}).$$\end{document}</tex-math><mml:math id="M12"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2023_37439_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par33">When a cell label is more confidently assigned, its entropy over the predicted probabilities is lower, and the prediction is in general more accurate (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, Supplementary Fig. <xref rid="MOESM1" ref-type="media">7</xref>–<xref rid="MOESM1" ref-type="media">8</xref>). Once we have entropies for all cells, we select 40% cells with the lowest entropies as anchors for each cell type to form the new reference dataset for second-round training. Sometimes the cell type composition in anchors can be very skewed, which could affect the performance when training the second-round model. Therefore, we first calculate the average number of cells per cell type according to the predicted cell types in the anchors, and then oversample the cell types with fewer cells to the average number. This can ensure that there are enough training cells in all cell types in the anchor. Since some anchors will be mistakenly predicted, we apply the KD model in the second-round training to deal with the issue, detailed in next section. The model trained in the second round will be used to predict cell types for non-anchors. Finally, we combine the cell types predicted for the anchors (from the first round) and non-anchors (from the second round) as our final cell type calls.</p>
      <sec id="Sec15">
        <title>The Knowledge Distiller (KD) model</title>
        <p id="Par34">Although the anchors cannot be perfectly predicted from the first round, they are important complementary training data for improving prediction, since these cells are from the exact same target domain where we previously lack supervision. To deal with training data with noisy labels, we implement a self-Knowledge Distiller (KD) model in the second-round training. The KD technique was originally proposed to transfer the knowledge learned from a sophisticated teacher model to a light-weighted student model, by treating the prediction results produced from the teach model as the “soft labels” for training the student model<sup><xref ref-type="bibr" rid="CR41">41</xref></sup>. Inspired by this and several recent works<sup><xref ref-type="bibr" rid="CR29">29</xref>,<xref ref-type="bibr" rid="CR42">42</xref></sup>, we propose to use the teacher-student interaction to alleviate the noisy label problem. Specifically, the teacher model distills knowledge from both clean supervision and noisy supervision by producing “soft labels” as the training targets of the student model. Compared to the “hard labels” that only contain over-confident 1’s and 0’s, “soft labels” are smoothed and thus more noise-tolerated<sup><xref ref-type="bibr" rid="CR43">43</xref></sup>. Also, there are cell types sharing similar profiles during celltyping which fits the fine-grained classification setting in the KD model. In Cellcano, we apply a “self-KD model” where we have the exact same structure for the teacher model and the student model. We set them to be vanilla MLPs of two hidden layers with 64 and 16 nodes, respectively. To let the model be more generalizable, we put the dropout layer right after the input layer. We use <italic>ReLU</italic> as the activation function.</p>
        <p id="Par35">We first train the teacher model with the anchors as input. To make the label “softer”, we set the temperature <italic>T</italic> of the softmax function to be larger. We use cross-entropy loss for the teacher model, then train the student model with the teacher’s “soft labels” as well as the one-hot encoded “hard labels”. The idea is to learn a label smoothing regularization so that the label distribution can be better captured. The KD loss function for the student model is a weighted average of two losses, which is shown in the equation below:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${L}_{{KD}}=\alpha H\left(p,\,{q}_{s}^{{T}_{1}}\right)+\left(1-\alpha \right){KL}\left({q}_{t}^{{T}_{2}},\,{q}_{s}^{{T}_{2}}\right).$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>α</mml:mi><mml:mi>H</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:mfenced><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msubsup><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math><graphic xlink:href="41467_2023_37439_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par36">Here, <italic>T</italic><sub>1</sub> and <italic>T</italic><sub>2</sub> are temperatures in the softmax functions, and <italic>α</italic> is a hyperparameter for balancing the two losses. The first part of the KD loss is a cross-entropy loss where the student prediction <italic>q</italic><sub>s</sub> is guided by “hard labels” (anchor cell types from first-round prediction), and we set the <italic>T</italic><sub>1</sub> as 1. The second part represents the Kullback–Leibler (KL) divergence loss which measures the probability distribution distances between the soft teacher prediction <italic>q</italic><sub><italic>t</italic></sub> and the soft student prediction <italic>q</italic><sub><italic>s</italic></sub>, where <italic>T</italic><sub>2</sub> can be adjusted. We set T<sub>2</sub> = 3 for the second part to soften the label distribution. Overall, we set <italic>α</italic> as 0.1 to value more on the teacher model’s “soft labels”. The KD model is trained for 30 epochs.</p>
      </sec>
    </sec>
    <sec id="Sec16">
      <title>Supervised celltyping methods</title>
      <p id="Par37">We benchmark Cellcano to six competing methods: Seurat, scJoint, Signac, EpiAnno, ACTINN, and SingleR. For all methods except EpiAnno and Signac, we use the scATAC-seq gene score matrix before feature selection in the place of scRNA-seq gene expression matrix as the reference and follow their default procedures for celltyping. In Seurat, we choose reciprocal principal component analysis (RPCA) to calculate the joint embedding of reference and target datasets as it is proved to have better integration performance in a benchmark paper<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>. For Signac, we use raw fragment files as input and follow the vignettes provided by Signac on scATAC-seq data integration. We notice that overlapping genomics regions to obtain peak count matrices for target datasets takes a much longer time than generating gene scores with ArchR. For EpiAnno, we use peak counts matrices as input. To accommodate the memory limitation of EpiAnno, we set the hyper parameter <italic>peak rate</italic> as 0.08 or 0.05 for large input matrices, while keeping the original 0.03 <italic>peak rate</italic> for remaining matrices.</p>
    </sec>
    <sec id="Sec17">
      <title>Integration with label transfer methods</title>
      <p id="Par38">We benchmark Cellcano to six combinations of batch-effect removal methods with different feature-level inputs: LIGER with peaks as input, LIGER with genome-wide bins as input, ComBat with peaks as input, ComBat with genome-wide bins as input, Harmony with gene scores as input and Portal with gene scores as input. We use corresponding feature matrices derived from ArchR as input for each combination and use the default procedures to remove batch effect between the reference and target datasets. ComBat returns corrected counts which has the same dimension as the original data while LIGER, Harmony, and Portal return joint embeddings with size as 20, 50, and 20, respectively. We then split the corrected counts or joint embeddings into reference and target datasets according to the batch information before integration and perform celltyping with MLP. Here, the MLP model has the same structure and settings with the MLP model in Cellcano’s first-round prediction.</p>
    </sec>
    <sec id="Sec18">
      <title>Evaluation Metrics</title>
      <p id="Par39">We choose overall accuracy, ARI and macroF1 for performance evaluation. Accuracy describes the number of correctly assigned cells divided by total number of cells. This can be used as an indicator to show how well most cells are assigned. ARI measures the cluster concordance between the true labels and predicted labels. MacroF1 treats all cell types equally, which puts more emphasis on the accuracies of smaller clusters compared to other metrics. For a fair comparison, we also include median F1 score (medianF1), median precision, median recall, and Cohen’s kappa (κ), which were used in the EpiAnno paper. The medianF1, median prediction and median recall regard predicting each cell type as a binary classification task and calculate the median performance for each cell type. Cohen’s kappa measures the agreement between labels from the ground truth and the predictor. In summary, these metrics measure different perspectives and can be used to fairly reflect prediction performance among different performers.</p>
    </sec>
    <sec id="Sec19">
      <title>Statistics and reproducibility</title>
      <p id="Par40">In this work, we set random seed as 2022 for Python random package along with tensorflow package to ensure the reproducibility of our results. No statistical method was used to predetermine sample size. Cells with low-quality were excluded based on standard scATAC-seq preprocessing procedures. The experiments were not randomized. The Investigators were not blinded to allocation during experiments and outcome assessment.</p>
    </sec>
    <sec id="Sec20">
      <title>Reporting summary</title>
      <p id="Par41">Further information on research design is available in the <xref rid="MOESM6" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec21">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_37439_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_37439_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_37439_MOESM3_ESM.pdf">
            <caption>
              <p>Description of Additional Supplementary Files</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="41467_2023_37439_MOESM4_ESM.xlsx">
            <caption>
              <p>Supplementary Dataset 1</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="41467_2023_37439_MOESM5_ESM.xlsx">
            <caption>
              <p>Supplementary Dataset 2</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM6">
          <media xlink:href="41467_2023_37439_MOESM6_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec22">
        <title>Source data</title>
        <p id="Par45">
          <media position="anchor" xlink:href="41467_2023_37439_MOESM7_ESM.xlsx" id="MOESM7">
            <caption>
              <p>Source data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-37439-3.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work is partially supported by the NIH award R01GM122083 for HW and WM. HW was also partially supported by the Strategic Priority Research Program of Chinese Academy of Sciences, Grant No. XDB38050100.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>H.W. conceived the study. W.M. designed and implemented the model. W.M. developed the Cellcano software and analyzed the results. J.L. provided advice on algorithms and helped on benchmarking and testing the software. W.M. and H.W. wrote the paper with input from J.L.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par42"><italic>Nature Communications</italic> thanks the other anonymous reviewer(s) for their contribution to the peer review of this work. Peer review reports are available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>All datasets are publicly available, and the access numbers or the downloaded websites are provided by the original publications. The Satpathy et al.<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> data used in this study are available in the Gene Expression Omnibus (GEO) dataset under accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE129785">GSE129785</ext-link>”. The Granja et al.<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> data is available in the GEO dataset under accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE139369">GSE139369</ext-link>”. The 10X PBMCs data is available in the 10X genomics datasets. We downloaded the raw data under the Single Cell Multiome ATAC + Gene Expression category named PBMC from a Healthy Donor – Granulocytes Removed Through Cell Sorting (10 K) processed by Cell Ranger ARC 2.0.0 (<ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets/pbmc-from-a-healthy-donor-granulocytes-removed-through-cell-sorting-10-k-1-standard-2-0-0">https://www.10xgenomics.com/resources/datasets/pbmc-from-a-healthy-donor-granulocytes-removed-through-cell-sorting-10-k-1-standard-2-0-0</ext-link>). The FACS PBMCs<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> data is available in the GEO dataset under accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE123578">GSE123578</ext-link>”. The Lareau et al.<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> data is available in the GEO dataset under accession code “<ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE123581">GSE123581</ext-link>”. The Cusanovich et al.<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> data is available in the Mouse Atlas dataset under Downloads tab (<ext-link ext-link-type="uri" xlink:href="https://atlas.gs.washington.edu/mouse-atac/data/">https://atlas.gs.washington.edu/mouse-atac/data/</ext-link>). The liftOver chain files to convert human genome build hg38 to hg19 data are available in the UCSC file server saved as hg38ToHg19.over.chain.gz (<ext-link ext-link-type="uri" xlink:href="https://hgdownload.cse.ucsc.edu/goldenpath/hg38/liftOver/">https://hgdownload.cse.ucsc.edu/goldenpath/hg38/liftOver/</ext-link>) and the chain files to convert mouse genome build mm9 to mm10 data is available in the USCS file server saved as mm9ToMm10.over.chain.gz (<ext-link ext-link-type="uri" xlink:href="https://hgdownload.cse.ucsc.edu/goldenpath/mm9/liftOver/">https://hgdownload.cse.ucsc.edu/goldenpath/mm9/liftOver/</ext-link>). More information on the datasets can be found in Supplementary Table <xref rid="MOESM1" ref-type="media">1</xref> and details on data preprocessing are provided in Supplementary Note <xref rid="MOESM1" ref-type="media">2</xref>. All other relevant data supporting the key findings of this study are available within the article and its Supplementary Information files or from the corresponding author upon reasonable request. The results of celltyping prediction tasks along with supporting visualization information that appear in all figure panels are provided in the Source Data files. <xref rid="Sec22" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>Cellcano code is freely available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/marvinquiet/Cellcano">https://github.com/marvinquiet/Cellcano</ext-link>) and Zenodo (10.5281/zenodo.7686209)<sup><xref ref-type="bibr" rid="CR47">47</xref></sup>. The software package has been released both on PyPI (<ext-link ext-link-type="uri" xlink:href="https://pypi.org/project/Cellcano/">https://pypi.org/project/Cellcano/</ext-link>) and Anaconda (<ext-link ext-link-type="uri" xlink:href="https://anaconda.org/marvinquiet/cellcano-all">https://anaconda.org/marvinquiet/cellcano-all</ext-link>). Users can choose either option to easily install our package. Detailed tutorials on installation and usage are also provided (<ext-link ext-link-type="uri" xlink:href="https://marvinquiet.github.io/Cellcano/">https://marvinquiet.github.io/Cellcano/</ext-link>). Cellcano python package is built upon Python and the recommended version is v3.8. There are several Python package dependencies, including tensorflow (v2.7.1), anndata (v0.7.4), scanpy (v1.8.2), numpy (v1.19.2), h5py (v2.10.0), keras and rpy2. R environment and the R package ArchR (v1.0.1) are also suggested to be installed for generating gene scores.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par43">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zappia</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Over 1000 tools reveal trends in the single-cell RNA-seq analysis landscape</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>301</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02519-4</pub-id>
        <?supplied-pmid 34715899?>
        <pub-id pub-id-type="pmid">34715899</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>scmap: projection of single-cell RNA-seq data across data sets</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>359</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4644</pub-id>
        <?supplied-pmid 29608555?>
        <pub-id pub-id-type="pmid">29608555</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>de Kanter</surname>
            <given-names>JK</given-names>
          </name>
          <name>
            <surname>Lijnzaad</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Candelli</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Margaritis</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Holstege</surname>
            <given-names>FC</given-names>
          </name>
        </person-group>
        <article-title>CHETAH: a selective, hierarchical cell type identification method for single-cell RNA sequencing</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>e95</fpage>
        <lpage>e95</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkz543</pub-id>
        <?supplied-pmid 31226206?>
        <pub-id pub-id-type="pmid">31226206</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aran</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage</article-title>
        <source>Nat. Immunol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>163</fpage>
        <lpage>172</lpage>
        <pub-id pub-id-type="doi">10.1038/s41590-018-0276-y</pub-id>
        <?supplied-pmid 30643263?>
        <pub-id pub-id-type="pmid">30643263</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xie</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SuperCT: a supervised-learning framework for enhanced characterization of single-cell transcriptomic profiles</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>e48</fpage>
        <lpage>e48</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkz116</pub-id>
        <?supplied-pmid 30799483?>
        <pub-id pub-id-type="pmid">30799483</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>AW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic cell-type assignment of single-cell RNA-seq for tumor microenvironment profiling</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1007</fpage>
        <lpage>1015</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0529-1</pub-id>
        <?supplied-pmid 31501550?>
        <pub-id pub-id-type="pmid">31501550</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alquicira-Hernandez</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Sathe</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>HP</given-names>
          </name>
          <name>
            <surname>Nguyen</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Powell</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>E. scPred: accurate supervised method for cell-type classification from single-cell RNA-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>1</fpage>
        <lpage>17</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1862-5</pub-id>
        <pub-id pub-id-type="pmid">30606230</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Pellegrini</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>ACTINN: automated identification of cell types in single cell RNA sequencing</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>533</fpage>
        <lpage>538</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz592</pub-id>
        <?supplied-pmid 31359028?>
        <pub-id pub-id-type="pmid">31359028</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <mixed-citation publication-type="other">Xu, C., Lopez, R., Mehlman, E., Regier, J., Jordan, M. I. &amp; Yosef, N. Probabilistic harmonization and annotation of single-cell transcriptomics data with deep generative models. <italic>Mol. Syst. Biol.</italic><bold>17</bold>, e9620 (2021).</mixed-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Pasquini, G., Arias, J. E. R., Schäfer, P. &amp; Busskamp, V. Automated methods for cell type annotation on scRNA-seq data. <italic>Comput. Struct. Biotechnol. J.</italic><bold>19</bold>, 961–969 (2021).</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abdelaal</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A comparison of automatic cell identification methods for single-cell RNA sequencing data</article-title>
        <source>Genome Biol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>1</fpage>
        <lpage>19</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1795-z</pub-id>
        <pub-id pub-id-type="pmid">30606230</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <mixed-citation publication-type="other">Huang, Q., Liu, Y., Du, Y. &amp; Garmire, L. X. Evaluation of cell type annotation R packages on single-cell RNA-seq data. <italic>Genomics Proteomics Bioinformatics</italic><bold>19</bold>, 267–281 (2020).</mixed-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Su</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Evaluation of some aspects in supervised cell type identification for single-cell RNA-seq: classifier, feature selection, and reference construction</article-title>
        <source>Genome Biol.</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>264</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-021-02480-2</pub-id>
        <?supplied-pmid 34503564?>
        <pub-id pub-id-type="pmid">34503564</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>A comprehensive comparison of supervised and unsupervised methods for cell type identification in single-cell RNA-seq</article-title>
        <source>Brief. Bioinform.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>bbab567</fpage>
        <pub-id pub-id-type="doi">10.1093/bib/bbab567</pub-id>
        <?supplied-pmid 35021202?>
        <pub-id pub-id-type="pmid">35021202</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsompana</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Buck</surname>
            <given-names>MJ</given-names>
          </name>
        </person-group>
        <article-title>Chromatin accessibility: a window into the genome</article-title>
        <source>Epigenetics Chromatin</source>
        <year>2014</year>
        <volume>7</volume>
        <fpage>33</fpage>
        <pub-id pub-id-type="doi">10.1186/1756-8935-7-33</pub-id>
        <?supplied-pmid 25473421?>
        <pub-id pub-id-type="pmid">25473421</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buenrostro</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell chromatin accessibility reveals principles of regulatory variation</article-title>
        <source>Nature</source>
        <year>2015</year>
        <volume>523</volume>
        <fpage>486</fpage>
        <lpage>490</lpage>
        <pub-id pub-id-type="doi">10.1038/nature14590</pub-id>
        <?supplied-pmid 26083756?>
        <pub-id pub-id-type="pmid">26083756</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baek</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Single-cell ATAC sequencing analysis: from data preprocessing to hypothesis generation</article-title>
        <source>Comput. Struct. Biotechnol. J.</source>
        <year>2020</year>
        <volume>18</volume>
        <fpage>1429</fpage>
        <lpage>1439</lpage>
        <pub-id pub-id-type="doi">10.1016/j.csbj.2020.06.012</pub-id>
        <?supplied-pmid 32637041?>
        <pub-id pub-id-type="pmid">32637041</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assessment of computational methods for the analysis of single-cell ATAC-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>241</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1854-5</pub-id>
        <?supplied-pmid 31739806?>
        <pub-id pub-id-type="pmid">31739806</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Davey</surname>
            <given-names>HM</given-names>
          </name>
          <name>
            <surname>Kell</surname>
            <given-names>DB</given-names>
          </name>
        </person-group>
        <article-title>Flow cytometry and cell sorting of heterogeneous microbial populations: the importance of single-cell analyses</article-title>
        <source>Microbiol. Rev.</source>
        <year>1996</year>
        <volume>60</volume>
        <fpage>641</fpage>
        <lpage>696</lpage>
        <pub-id pub-id-type="doi">10.1128/mr.60.4.641-696.1996</pub-id>
        <?supplied-pmid 8987359?>
        <pub-id pub-id-type="pmid">8987359</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lake</surname>
            <given-names>BB</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>High-throughput sequencing of the transcriptome and chromatin accessibility in the same cell</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>1452</fpage>
        <lpage>1457</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0290-0</pub-id>
        <?supplied-pmid 31611697?>
        <pub-id pub-id-type="pmid">31611697</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bravo González-Blas</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>cisTopic: cis-regulatory topic modeling on single-cell ATAC-seq data</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>397</fpage>
        <lpage>400</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0367-1</pub-id>
        <?supplied-pmid 30962623?>
        <pub-id pub-id-type="pmid">30962623</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zamanighomi</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Unsupervised clustering and epigenetic classification of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>2410</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-018-04629-3</pub-id>
        <?supplied-pmid 29925875?>
        <pub-id pub-id-type="pmid">29925875</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baker</surname>
            <given-names>SM</given-names>
          </name>
          <name>
            <surname>Rogerson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Hayes</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Sharrocks</surname>
            <given-names>AD</given-names>
          </name>
          <name>
            <surname>Rattray</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Classifying cells with Scasat, a single-cell ATAC-seq analysis tool</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2019</year>
        <volume>47</volume>
        <fpage>e10</fpage>
        <pub-id pub-id-type="doi">10.1093/nar/gky950</pub-id>
        <?supplied-pmid 30335168?>
        <pub-id pub-id-type="pmid">30335168</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>scJoint integrates atlas-scale single-cell RNA-seq and ATAC-seq data with transfer learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>703</fpage>
        <lpage>710</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01161-6</pub-id>
        <?supplied-pmid 35058621?>
        <pub-id pub-id-type="pmid">35058621</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Srivastava</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Madad</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell chromatin state analysis with Signac</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>1333</fpage>
        <lpage>1341</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01282-5</pub-id>
        <?supplied-pmid 34725479?>
        <pub-id pub-id-type="pmid">34725479</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cell type annotation of single-cell chromatin accessibility data via supervised Bayesian embedding</article-title>
        <source>Nat. Mach. Intell.</source>
        <year>2022</year>
        <volume>4</volume>
        <fpage>116</fpage>
        <lpage>126</lpage>
        <pub-id pub-id-type="doi">10.1038/s42256-021-00432-w</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fu</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Predicting transcription factor binding in single cells through deep learning</article-title>
        <source>Sci. Adv.</source>
        <year>2020</year>
        <volume>6</volume>
        <fpage>eaba9031</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.aba9031</pub-id>
        <?supplied-pmid 33355120?>
        <pub-id pub-id-type="pmid">33355120</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Liu, Y., Shen, S. &amp; Lapata, M. Noisy self-knowledge distillation for text summarization. in <italic>Proceedings of the 2021 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies</italic> 692–703 (Association for Computational Linguistics, 2021). 10.18653/v1/2021.naacl-main.56.</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Granja</surname>
            <given-names>JM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ArchR is a scalable software package for integrative single-cell chromatin accessibility analysis</article-title>
        <source>Nat. Genet</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>403</fpage>
        <lpage>411</lpage>
        <pub-id pub-id-type="doi">10.1038/s41588-021-00790-6</pub-id>
        <?supplied-pmid 33633365?>
        <pub-id pub-id-type="pmid">33633365</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Su, K., Yu, T. &amp; Wu, H. Accurate feature selection improves single-cell RNA-seq cell clustering. <italic>Brief Bioinform.</italic><bold>22</bold>, bbab034 (2021).</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SC3: consensus clustering of single-cell RNA-seq data</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>483</fpage>
        <lpage>486</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4236</pub-id>
        <?supplied-pmid 28346451?>
        <pub-id pub-id-type="pmid">28346451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satpathy</surname>
            <given-names>AT</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel single-cell chromatin landscapes of human immune cell development and intratumoral T cell exhaustion</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>925</fpage>
        <lpage>936</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0206-z</pub-id>
        <?supplied-pmid 31375813?>
        <pub-id pub-id-type="pmid">31375813</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>41</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01336-8</pub-id>
        <?supplied-pmid 34949812?>
        <pub-id pub-id-type="pmid">34949812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Welch</surname>
            <given-names>JD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1873</fpage>
        <lpage>1887. e17</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id>
        <?supplied-pmid 31178122?>
        <pub-id pub-id-type="pmid">31178122</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Büttner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Miao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>A test metric for assessing single-cell RNA-seq batch correction</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>43</fpage>
        <lpage>49</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0254-1</pub-id>
        <?supplied-pmid 30573817?>
        <pub-id pub-id-type="pmid">30573817</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tran</surname>
            <given-names>HTN</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>1</fpage>
        <lpage>32</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Adversarial domain translation networks for integrating large-scale atlas-level single-cell datasets</article-title>
        <source>Nat. Comput Sci.</source>
        <year>2022</year>
        <volume>2</volume>
        <fpage>317</fpage>
        <lpage>330</lpage>
        <pub-id pub-id-type="doi">10.1038/s43588-022-00251-y</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">LeCun, Y. A., Bottou, L., Orr, G. B. &amp; Müller, K.-R. Efficient BackProp. in <italic>Neural Networks: Tricks of the Trade</italic> 2nd edn, (eds Montavon, G., Orr, G. B. &amp; Müller, K.-R.) 9–48 (Springer, 2012). 10.1007/978-3-642-35289-8_3.</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Hinton, G., Vinyals, O. &amp; Dean, J. <italic>Distilling the Knowledge in a Neural Network</italic>. 10.48550/arXiv.1503.02531 (2015).</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <mixed-citation publication-type="other">Yuan, L., Tay, F. E., Li, G., Wang, T. &amp; Feng, J. Revisiting knowledge distillation via label smoothing regularization. In <italic>IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)</italic> 3902–3910 (IEEE, 2020) 10.1109/CVPR42600.2020.00396 2020.</mixed-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <mixed-citation publication-type="other">Müller, R., Kornblith, S. &amp; Hinton, G. <italic>When Does Label Smoothing Help</italic>? 10.48550/arXiv.1906.02629 (2020).</mixed-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Granja</surname>
            <given-names>JM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell multiomic analysis identifies regulatory programs in mixed-phenotype acute leukemia</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>1458</fpage>
        <lpage>1465</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0332-7</pub-id>
        <?supplied-pmid 31792411?>
        <pub-id pub-id-type="pmid">31792411</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lareau</surname>
            <given-names>CA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Droplet-based combinatorial indexing for massive-scale single-cell chromatin accessibility</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>916</fpage>
        <lpage>924</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0147-6</pub-id>
        <?supplied-pmid 31235917?>
        <pub-id pub-id-type="pmid">31235917</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell atlas of in vivo mammalian chromatin accessibility</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>1309</fpage>
        <lpage>1324.e18</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.06.052</pub-id>
        <?supplied-pmid 30078704?>
        <pub-id pub-id-type="pmid">30078704</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <mixed-citation publication-type="other">Ma, W., Lu, J. &amp; Wu, H. Source code repo for ‘Cellcano: supervised cell type identification for single cell ATAC-seq data’. 10.5281/zenodo.7686209 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
