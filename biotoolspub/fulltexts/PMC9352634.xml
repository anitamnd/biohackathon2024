<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Brain Inform</journal-id>
    <journal-id journal-id-type="iso-abbrev">Brain Inform</journal-id>
    <journal-title-group>
      <journal-title>Brain Informatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">2198-4018</issn>
    <issn pub-type="epub">2198-4026</issn>
    <publisher>
      <publisher-name>Springer Berlin Heidelberg</publisher-name>
      <publisher-loc>Berlin/Heidelberg</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9352634</article-id>
    <article-id pub-id-type="publisher-id">166</article-id>
    <article-id pub-id-type="doi">10.1186/s40708-022-00166-4</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SmaRT2P: a software for generating and processing smart line recording trajectories for population two-photon calcium imaging</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Moroni</surname>
          <given-names>Monica</given-names>
        </name>
        <address>
          <email>monica.moroni@outlook.com</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Brondi</surname>
          <given-names>Marco</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fellin</surname>
          <given-names>Tommaso</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Panzeri</surname>
          <given-names>Stefano</given-names>
        </name>
        <address>
          <email>s.panzeri@uke.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.25786.3e</institution-id><institution-id institution-id-type="ISNI">0000 0004 1764 2907</institution-id><institution>Neural Computation Laboratory, Center for Neuroscience and Cognitive Systems, </institution><institution>UniTn, Istituto Italiano Di Tecnologia, </institution></institution-wrap>38068 Rovereto, Italy </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.25786.3e</institution-id><institution-id institution-id-type="ISNI">0000 0004 1764 2907</institution-id><institution>Optical Approaches to Brain Function Laboratory, </institution><institution>Istituto Italiano Di Tecnologia, </institution></institution-wrap>16163 Genoa, Italy </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.5608.b</institution-id><institution-id institution-id-type="ISNI">0000 0004 1757 3470</institution-id><institution>Department of Biomedical Sciences-UNIPD, </institution><institution>Università Degli Studi Di Padova, </institution></institution-wrap>35121 Padua, Italy </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.5608.b</institution-id><institution-id institution-id-type="ISNI">0000 0004 1757 3470</institution-id><institution>Padova Neuroscience Center (PNC), </institution><institution>Università Degli Studi Di Padova, </institution></institution-wrap>35129 Padua, Italy </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.13648.38</institution-id><institution-id institution-id-type="ISNI">0000 0001 2180 3484</institution-id><institution>Department of Excellence for Neural Information Processing, Center for Molecular Neurobiology (ZMNH), </institution><institution>University Medical Center Hamburg-Eppendorf (UKE), </institution></institution-wrap>20251 Hamburg, Germany </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>4</day>
      <month>8</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>4</day>
      <month>8</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <volume>9</volume>
    <issue>1</issue>
    <elocation-id>18</elocation-id>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>5</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>1</day>
        <month>7</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Two-photon fluorescence calcium imaging allows recording the activity of large neural populations with subcellular spatial resolution, but it is typically characterized by low signal-to-noise ratio (SNR) and poor accuracy in detecting single or few action potentials when large number of neurons are imaged. We recently showed that implementing a smart line scanning approach using trajectories that optimally sample the regions of interest increases both the SNR fluorescence signals and the accuracy of single spike detection in population imaging in vivo. However, smart line scanning requires highly specialised software to design recording trajectories, interface with acquisition hardware, and efficiently process acquired data. Furthermore, smart line scanning needs optimized strategies to cope with movement artefacts and neuropil contamination. Here, we develop and validate SmaRT2P, an open-source, user-friendly and easy-to-interface Matlab-based software environment to perform optimized smart line scanning in two-photon calcium imaging experiments. SmaRT2P is designed to interface with popular acquisition software (e.g., ScanImage) and implements novel strategies to detect motion artefacts, estimate neuropil contamination, and minimize their impact on functional signals extracted from neuronal population imaging. SmaRT2P is structured in a modular way to allow flexibility in the processing pipeline, requiring minimal user intervention in parameter setting. The use of SmaRT2P for smart line scanning has the potential to facilitate the functional investigation of large neuronal populations with increased SNR and accuracy in detecting the discharge of single and few action potentials.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s40708-022-00166-4.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Two-photon microscopy</kwd>
      <kwd>Line scanning</kwd>
      <kwd>Calcium imaging</kwd>
      <kwd>Open-source software</kwd>
      <kwd>Neuroinformatics</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id>
            <institution>National Institutes of Health</institution>
          </institution-wrap>
        </funding-source>
        <award-id>NS107464</award-id>
        <award-id>NS107464</award-id>
        <principal-award-recipient>
          <name>
            <surname>Fellin</surname>
            <given-names>Tommaso</given-names>
          </name>
          <name>
            <surname>Panzeri</surname>
            <given-names>Stefano</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100010663</institution-id>
            <institution>H2020 European Research Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>NEURO-PATTERNS</award-id>
        <principal-award-recipient>
          <name>
            <surname>Fellin</surname>
            <given-names>Tommaso</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100010662</institution-id>
            <institution>H2020 Excellent Science</institution>
          </institution-wrap>
        </funding-source>
        <award-id>945539</award-id>
        <principal-award-recipient>
          <name>
            <surname>Panzeri</surname>
            <given-names>Stefano</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Universitätsklinikum Hamburg-Eppendorf (UKE) (5411)</institution>
        </funding-source>
      </award-group>
      <open-access>
        <p>Open Access funding enabled and organized by Projekt DEAL.</p>
      </open-access>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Introduction</title>
    <p id="Par12">Information is encoded in the brain in the form of the coordinated activity of large populations of neurons with remarkably fine spatio-temporal resolution [<xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR5">5</xref>]. In particular, both single cell features, such as the identity of each neuron and the timing of small number of spikes or even of individual spikes [<xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR16">16</xref>], as well as the functional correlations among neurons [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR16">16</xref>–<xref ref-type="bibr" rid="CR20">20</xref>], are relevant for sensory information encoding and perception [<xref ref-type="bibr" rid="CR21">21</xref>, <xref ref-type="bibr" rid="CR22">22</xref>]. Furthermore, the information encoding properties of populations of neurons are fully revealed only when analysing large populations [<xref ref-type="bibr" rid="CR23">23</xref>, <xref ref-type="bibr" rid="CR24">24</xref>]. Thus, to understand how neural networks encode and transmit information it is essential to record from large populations of neurons ideally with single cell and single action potential resolution [<xref ref-type="bibr" rid="CR25">25</xref>].</p>
    <p id="Par13">Since its introduction in neuroscience, two-photon (2P) calcium imaging [<xref ref-type="bibr" rid="CR26">26</xref>, <xref ref-type="bibr" rid="CR27">27</xref>] has become one of the preferred techniques to collect data from populations of neurons, because it allows recording activity from hundreds (up to several thousands) of genetically identified neurons [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR23">23</xref>, <xref ref-type="bibr" rid="CR28">28</xref>, <xref ref-type="bibr" rid="CR29">29</xref>] with subcellular resolution [<xref ref-type="bibr" rid="CR30">30</xref>–<xref ref-type="bibr" rid="CR32">32</xref>]. Furthermore, 2P calcium imaging is suitable for long-term studies, since cells can be tracked across different experimental sessions in longitudinal experiments [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR33">33</xref>]. However, the acquisition rates of many 2P calcium imaging systems using the galvanometric mirror-based raster scanning modality result in a relatively slow temporal resolution, that does not allow fully capture calcium dynamics and fully realize the potential offered by 2P calcium imaging [<xref ref-type="bibr" rid="CR34">34</xref>]. Another important limitation is related to the signal-to-noise ratio (SNR) of the fluorescence signal, which depends on several experimental parameters, such as reporter type and expression level, excitation laser power, local tissue properties, optical and electronic hardware, and acquisition parameters [<xref ref-type="bibr" rid="CR35">35</xref>]. Recently developed genetically encoded calcium indicators (GECI) are characterized by excellent SNR and they achieve high accuracy in single action potential detection [<xref ref-type="bibr" rid="CR36">36</xref>]. However, they do so under optimized experimental conditions that cannot be easily extended to large population imaging in the conventional raster scanning modality [<xref ref-type="bibr" rid="CR37">37</xref>, <xref ref-type="bibr" rid="CR38">38</xref>]. To address this limitation, we [<xref ref-type="bibr" rid="CR38">38</xref>] recently introduced Smart Line Scanning (SLS), an approach to image populations of neurons with improved temporal resolution and high signal quality. SLS combines the line scan imaging approach [<xref ref-type="bibr" rid="CR39">39</xref>, <xref ref-type="bibr" rid="CR40">40</xref>] with a “smart” pixel selection strategy based on the optimization of the SNR of individual regions of interest (ROIs). SLS achieves higher imaging sampling rates, increased SNR, and larger detection accuracy of individual spikes compared with conventional raster scanning approaches when applied to neuronal population imaging.</p>
    <p id="Par14">As for conventional raster scanning, SLS requires a sequence of data processing steps to infer action potentials from the recorded fluorescence signals. For conventional raster scanning a number of tools have been developed to perform the various data processing stages (e.g., motion correction and frame registration [<xref ref-type="bibr" rid="CR41">41</xref>–<xref ref-type="bibr" rid="CR45">45</xref>], ROI segmentation [<xref ref-type="bibr" rid="CR46">46</xref>–<xref ref-type="bibr" rid="CR54">54</xref>], background subtraction [<xref ref-type="bibr" rid="CR50">50</xref>], neuropil decontamination [<xref ref-type="bibr" rid="CR55">55</xref>, <xref ref-type="bibr" rid="CR56">56</xref>], calcium activity deconvolution [<xref ref-type="bibr" rid="CR50">50</xref>, <xref ref-type="bibr" rid="CR57">57</xref>–<xref ref-type="bibr" rid="CR60">60</xref>]) and efficient toolboxes and libraries are available to pre-process 2P calcium imaging data sets [<xref ref-type="bibr" rid="CR52">52</xref>, <xref ref-type="bibr" rid="CR61">61</xref>–<xref ref-type="bibr" rid="CR66">66</xref>]. While some of the pre-processing strategies and tools developed for raster scanning data are applicable also to process SLS data (e.g., for calcium activity deconvolution), motion correction and neuropil subtraction in SLS data set specific challenges, which require the conceptual development and implementation of novel dedicated strategies. While we experimentally validated the effectiveness of SLS in our recent work [<xref ref-type="bibr" rid="CR38">38</xref>], we did not provide a user-friendly optimized algorithm for the generation and analysis of SLS data sets in our previous work. The lack of standardized open-source available processing tools is a limitation preventing the community to benefit from the advantages of SLS.</p>
    <p id="Par15">Here, we introduce SmaRT2P, an open-source standalone and ready-to-use Matlab-based interface for the generation of SLS trajectories and the offline processing of SLS data. The SmaRT2P interface processes conventional raster acquisitions using existing standardised algorithms [<xref ref-type="bibr" rid="CR44">44</xref>, <xref ref-type="bibr" rid="CR50">50</xref>], builds SLS trajectories based on reference images acquired with raster scanning, and introduces novel dedicated methods for processing SLS data. In particular, SLS trajectories are determined using a genetic algorithm to find the optimal path connecting all ROIs and the shortest path within each ROI. Furthermore, a surround region can be added to the ROIs to ensure robustness to artefacts and improve the performance of the processing algorithm. The interface allows the detection of large motion artefacts, the extraction of activity time series for each ROI, the correction of small local motion artefacts, and the reduction of background/neuropil signal from ROI traces. The motion correction algorithms, which we implemented in SmaRT2P, are line-by-line strategies specifically designed for local small motion artefacts detected in SLS data, which represent SLS-specific alternatives to the frame-by-frame motion corrections for raster acquisitions. They include the method (based on a pixels selection criterion aimed at maximizing the signal SNR) already implemented in [<xref ref-type="bibr" rid="CR38">38</xref>] and a novel strategy, based on an efficient state-of-the art motion correction algorithm for raster data [<xref ref-type="bibr" rid="CR44">44</xref>]. With respect to our previous implementation of SLS [<xref ref-type="bibr" rid="CR38">38</xref>], SmaRT2P thus integrates the processing pipeline with the novel motion correction algorithm, introduces flexibility in the application of the processing steps and evaluates the processing quality using two different metrics, providing a user-friendly software for a complete processing pipeline for SLS data. We describe SmaRT2P in detail and we validate it by systematically applying SmaRT2P to a large data set of spontaneous or stimulus driven neural activity collected from head-fixed anesthetized or awake mice, which we make publicly available [<xref ref-type="bibr" rid="CR67">67</xref>] to support further development, validation, and benchmarking of related algorithms.</p>
  </sec>
  <sec id="Sec2">
    <title>Materials and methods</title>
    <sec id="Sec3">
      <title>General overview</title>
      <p id="Par16">SmaRT2P is a Matlab (R2019a) toolbox to design and process SLS acquisitions. It is composed by two main blocks (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a): the processing of conventional raster acquisitions and building of SLS trajectories; and the processing of SLS acquisitions.<fig id="Fig1"><label>Fig. 1</label><caption><p>Schematic of the software.<bold> a</bold> Software is designed to process raster (top) and SLS (bottom) acquisitions. Dashed lighter boxes represent optional processing steps. <bold>b</bold> Pipeline for SLS data processing is flexible and can consist of one or many processing steps</p></caption><graphic xlink:href="40708_2022_166_Fig1_HTML" id="MO1"/></fig></p>
      <p id="Par17">While the processing of raster data mostly relies on existing algorithms, the possibility to design SLS trajectories and to process SLS data represents the novelty of the software. The SLS processing pipeline implementation is highly flexible (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b) to adapt to a wide range of acquisition conditions (e.g., in anesthetized or awake mice, for spontaneous or stimulus driven activity) and data quality. The presence of an intuitive user-friendly graphical interface (GUI, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S1a) makes SmaRT2P available to users with no or basic programming experience.</p>
      <p id="Par18">Detailed information about SmaRT2P, a practical user guide and code is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/moni90/SmART2P">https://github.com/moni90/SmART2P</ext-link>.</p>
    </sec>
    <sec id="Sec4">
      <title>Raster acquisitions</title>
      <sec id="Sec5">
        <title>Data import</title>
        <p id="Par19">SmaRT2P supports importing raw raster acquisitions either from a sequence of.tiff files (each file corresponding to a single frame) or from a single.tiff file (one file containing multiple images). This is a format widely used for 2P-imaging experiments, and widely used open-source software (e.g., ImageJ/FIJI [<xref ref-type="bibr" rid="CR68">68</xref>, <xref ref-type="bibr" rid="CR69">69</xref>]) can convert to.tiff imaging data acquired in other popular formats.</p>
        <p id="Par20">Together with the raster data, the user must provide a series of parameters specifying the spatial and temporal resolution of the acquisition: pixel size (μm per pixel), single frame imaging period (s), single line imaging period (s) and dwell time (μs). Users can insert these parameters manually or load them from metadata stored during the acquisition. The current version of SmaRT2P allows extracting metadata from.xml documents saved by the Prairieview acquisition software (version 5.4, Ultima II scanhead, Bruker Corporation, Milan) or directly from the.tiff files recorded using ScanImage (version 2018b) [<xref ref-type="bibr" rid="CR70">70</xref>].</p>
        <p id="Par21">Users can also import already processed raster acquisitions (previously exported from the SmaRT2P GUI and saved as Matlab files (.mat)). Thanks to the modularity of SmaRT2P, users can easily customize the interface to allow importing different data formats.</p>
      </sec>
      <sec id="Sec6">
        <title>Motion artefacts correction</title>
        <p id="Par22">Efficient algorithms for the correction of motion artefacts are available for raster data [<xref ref-type="bibr" rid="CR41">41</xref>–<xref ref-type="bibr" rid="CR45">45</xref>]. We integrated in SmaRT2P a state-of-the art motion correction algorithm [<xref ref-type="bibr" rid="CR44">44</xref>]. Users can choose between a rigid motion correction, that shifts the entire field of view (FOV) and a non-rigid motion correction, that splits the FOV in multiple patches and shifts each patch separately. The template to which frames are registered is the temporal average of the first acquisition frames. The number of frames used to compute the template as well as other parameters for the motion correction can be manually set from the GUI.</p>
      </sec>
      <sec id="Sec7">
        <title>ROIs segmentation</title>
        <p id="Par23">For the segmentation of ROIs in the FOV, SmaRT2P provides three options: importing existing ROIs, automatically detecting ROIs or manually drawing ROIs. The segmentation obtained with any of these options can be further modified manually by users.</p>
        <p id="Par24"><italic>Import ROIs.</italic> Our software allows importing ROIs in various ways.</p>
        <p id="Par25">ROIs can be imported from segmentations performed in ImageJ/FIJI: ROIs from ImageJ must have been drawn using the ROI Manager tool and saved as.roi or.zip files. They are imported in SmaRT2P using the code provided in [<xref ref-type="bibr" rid="CR71">71</xref>] and are overlapped to the FOV.</p>
        <p id="Par26">ROIs can also be imported from segmentations performed with other software/libraries: ROIs segmented using other software or libraries must be organized in a matrix of size [number of FOV pixels]x[number of ROIs], where each column corresponds to a ROI and has non-negative values in the rows corresponding to the ROI’s pixels, as in [<xref ref-type="bibr" rid="CR50">50</xref>] and saved in.csv or.txt format. Imported ROIs are overlapped to the FOV.</p>
        <p id="Par27">Finally, ROIs can be imported from other FOVs already processed with SmaRT2P. In the case of longitudinal imaging sessions, ROIs imported from previously processed raster acquisitions on a given FOV (in the following indicated as original FOV) can be automatically adjusted to fit the current imaging session on the same area through rigid shifts and rotations. To perform the adjustment, the correlation projection of the current FOV is registered to the correlation projection of the original FOV. The transformation that minimizes the mean square error between the FOVs projections is then applied to the ROIs segmented on the original FOV and the transformed ROIs are overlapped to the current FOV. When importing ROIs, users are asked whether the automated adjustment must be performed. After the automated adjustment, users can visualize the aligned ROIs and choose whether they want to import the aligned ROIs or the original (not aligned) ones. Users can further edit the imported ROIs by adding or removing ROIs as described in the <italic>Manual Segmentation</italic> paragraph.</p>
        <p id="Par28"><italic>Automated segmentation.</italic> We integrated in SmaRT2P the possibility to perform an automated segmentation of the FOV adapting the algorithms and the codes provided in the Matlab implementation of CaImAn [<xref ref-type="bibr" rid="CR61">61</xref>]. To segment the FOV, users are asked to manually set a putative number of ROIs and their size.</p>
        <p id="Par29"><italic>SNR maximization criterion</italic>. After ROIs have been imported or automatically segmented, users can further filter the pixels belonging to each ROI according to an SNR-maximization criterion. This allows reducing the number of segmented pixels and increasing the signal quality. SNR is defined as<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$SNR\left(f;x\right)=\frac{\underset{t}{max}f\left(t;x\right)-mea{n}_{t}\left({f}_{25}\left(t;x\right)\right)}{st{d}_{t}\left({f}_{25}\left(t;x\right)\right)},$$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:mi>R</mml:mi><mml:mfenced close=")" open="("><mml:mi>f</mml:mi><mml:mo>;</mml:mo><mml:mi>x</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="italic">max</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:munder><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mi>t</mml:mi><mml:mo>;</mml:mo><mml:mi>x</mml:mi></mml:mfenced><mml:mo>-</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>f</mml:mi><mml:mn>25</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi>t</mml:mi><mml:mo>;</mml:mo><mml:mi>x</mml:mi></mml:mfenced></mml:mfenced></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:msub><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>f</mml:mi><mml:mn>25</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi>t</mml:mi><mml:mo>;</mml:mo><mml:mi>x</mml:mi></mml:mfenced></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math><graphic xlink:href="40708_2022_166_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par30">where <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$f\left(t;x\right)$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mi>t</mml:mi><mml:mo>;</mml:mo><mml:mi>x</mml:mi></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq1.gif"/></alternatives></inline-formula> denotes the fluorescence extracted at time <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$t$$\end{document}</tex-math><mml:math id="M6"><mml:mi>t</mml:mi></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq2.gif"/></alternatives></inline-formula> and averaged across pixels <inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$x=\left[{x}_{1},{x}_{2},\dots ,{x}_{N}\right]$$\end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mfenced close="]" open="["><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>⋯</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq3.gif"/></alternatives></inline-formula> and <inline-formula id="IEq4"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{25}\left(t;x\right)$$\end{document}</tex-math><mml:math id="M10"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mn>25</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi>t</mml:mi><mml:mo>;</mml:mo><mml:mi>x</mml:mi></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq4.gif"/></alternatives></inline-formula> denotes all the fluorescence values below the 25<sup>th</sup> percentile of the fluorescence distribution extracted from the same pixels. For each ROI, pixels are sorted according to decreasing SNR. The SNR of the ROI fluorescence trace is computed as a function of increasing number of pixels (starting with highest SNR pixels) and only pixels maximizing ROI SNR are included in the final segmentation. This SNR optimization step is performed independently for each cell in the FOV resulting in a complete segmentation mask to be used for the generation of the SLS scan path.</p>
        <p id="Par31"><italic>Manual segmentation.</italic> Alternatively, users can manually segment raster acquisitions in a dedicated window (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1b). Users can visualize the average projection, the max–min projection and the correlation projection of the full acquisition, or alternatively visualize the average projection and the max–min projection of a small number of frames (set manually by users). Alternatively, users can browse through the acquisition, scrolling consecutive frames. Users can draw and visualize ROIs both on individual raster frames and on the projections. Each ROI can be segmented by manually drawing the contour or by selecting a bounding box. If the contour is manually drawn, an ellipse is fitted to the drawn shape. Pixels falling within the ellipse or within the bounding box are sorted for decreasing SNR [Eq. (<xref rid="Equ1" ref-type="">1</xref>)] and the same SNR-maximization criterion described in the <italic>SNR maximization criterion</italic> paragraph is used to assign pixels to the ROI. After the automated pixels assignment, users can manually adjust the pixels selection. After a first segmentation, users can modify the segmentation by adding new ROIs or removing existing ones.</p>
      </sec>
      <sec id="Sec8">
        <title>Calcium activity deconvolution</title>
        <p id="Par32">For the segmented ROIs, the raw fluorescence trace is computed as the average fluorescence across pixels belonging to each ROI. The normalized fluorescence is then computed as<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$dF/{F}_{0}\left(t\right)=\frac{f\left(t\right)-mea{n}_{t}\left({f}_{50}\left(t\right)\right)}{mea{n}_{t}\left({f}_{50}\left(t\right)\right)},$$\end{document}</tex-math><mml:math id="M12" display="block"><mml:mrow><mml:mi>d</mml:mi><mml:mi>F</mml:mi><mml:mo stretchy="false">/</mml:mo><mml:msub><mml:mi>F</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi>t</mml:mi></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mfenced close=")" open="("><mml:mi>t</mml:mi></mml:mfenced><mml:mo>-</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>f</mml:mi><mml:mn>50</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi>t</mml:mi></mml:mfenced></mml:mfenced></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>f</mml:mi><mml:mn>50</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi>t</mml:mi></mml:mfenced></mml:mfenced></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math><graphic xlink:href="40708_2022_166_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par33">where <inline-formula id="IEq5"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${f}_{50}\left(t\right)$$\end{document}</tex-math><mml:math id="M14"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mn>50</mml:mn></mml:msub><mml:mfenced close=")" open="("><mml:mi>t</mml:mi></mml:mfenced></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq5.gif"/></alternatives></inline-formula> denotes all the fluorescence values below the 50<sup>th</sup> percentile (or median) of the fluorescence distribution. For automatically detected ROIs, the deconvolved calcium activity is automatically extracted during the segmentation [<xref ref-type="bibr" rid="CR64">64</xref>]. For ROIs imported or segmented manually, the same algorithm is implemented to extract the deconvolved calcium activity. The normalized fluorescence is fitted with an autoregressive model of first order in case the imaging acquisition rate is lower than 2 Hz, of second-order otherwise.</p>
      </sec>
      <sec id="Sec9">
        <title>Data export</title>
        <p id="Par34">Processed data can be exported and saved as Matlab.mat files. A single data structure is saved with all the processing information. The same structure can be imported in the interface for further processing of the data.</p>
      </sec>
      <sec id="Sec10">
        <title>SLS trajectory computation</title>
        <p id="Par35">Starting from a raster segmentation, the software allows drawing a SLS trajectory that travels through all the segmented ROIs (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1c). The trajectory is computed to intercept each segmented pixel inside a ROI then to move to the next ROI. Among all the possible trajectories connecting segmented pixels and ROIs, SmaRT2P produces a path with minimal length inside each ROI and between ROIs [<xref ref-type="bibr" rid="CR38">38</xref>]. We formulated the problem of finding the path with minimal length crossing all ROIs as an application of the Travelling Salesman Problem (TSP). The TSP is known to be an NP-hard problem whose brute-force solution implies to compute (n − 1)!/2 permutations and becomes computationally unfeasible for a large n, where n denotes the number of ROIs [<xref ref-type="bibr" rid="CR72">72</xref>]. To solve the problem an approximate solution was computed, based on a genetic algorithm with a population of 100 individuals and 1000 generations. To create the next generation from the current one, the following mutations are applied to selected individuals: flipping, swapping and sliding. This allowed to generate SLS trajectories in less than 10 s. The pseudocode of the algorithm used to generate SLS trajectories is reported in Table <xref rid="Tab1" ref-type="table">1</xref>.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Pseudocode for SLS trajectories optimization and generation</p></caption><table frame="hsides" rules="groups"><tbody><tr><td align="left"><bold>Input</bold>: random path through all ROIs (<italic>path</italic><sub><italic>0</italic></sub>), labels indicating which ROI corresponds to each <italic>path</italic><sub><italic>0</italic></sub> pixel (<italic>tags</italic>)</td></tr><tr><td align="left">Step 1. Find unique ROIs</td></tr><tr><td align="left"><p><bold>For</bold> ROI in unique(tags):</p><p>    Find ROI centroid</p></td></tr><tr><td align="left">Step 2. Find optimal path through ROIs centroids (<italic>path</italic><sub><italic>TSP</italic></sub>) applying genetic algorithm to solve TSP</td></tr><tr><td align="left"><p>Randomly initialize a population of 100 individuals (random paths through all ROIs)</p><p>Find minimum path length <italic>min</italic><sub><italic>glob</italic></sub> and the individual than minimize path length (<italic>path</italic><sub><italic>TSP</italic></sub>)</p><p><bold>For</bold> generation in [1:1000]:</p><p>    Compute the path length for each individual</p><p><bold>    If</bold> exist a path shorter <bold>then</bold>
<italic>min</italic><sub><italic>glob</italic></sub>, then update <italic>min</italic><sub><italic>glob</italic></sub> and <italic>path</italic><sub><italic>TSP</italic></sub></p><p>    Randomly split population in groups of 4 individuals</p><p><bold>    For</bold> each group of 4 individuals:</p><p>        Find the individual with shortest path</p><p>        Create 4 mutations (original, flip, swap, slide) of the individual for the next generation</p></td></tr><tr><td align="left">Step 3. Compute <italic>path</italic><sub><italic>SLS</italic></sub></td></tr><tr><td align="left">Initialize empty trajectory <italic>path</italic><sub><italic>SLS</italic></sub></td></tr><tr><td align="left"><p><bold>For</bold> ROI in <italic>path</italic><sub><italic>TSP</italic></sub>:</p><p>    Find path through all ROI’s pixels (<italic>path</italic><sub><italic>ROI</italic></sub>) using a greedy algorithm</p><p>    Append <italic>path</italic><sub><italic>ROI</italic></sub> to <italic>path</italic><sub><italic>TSP</italic></sub></p></td></tr><tr><td align="left"><bold>Return</bold>: <italic>path</italic><sub><italic>TSP</italic></sub></td></tr></tbody></table></table-wrap></p>
        <p id="Par36">For robustness purpose, users can add a surround of an arbitrary number of pixels around each ROIs and a reference box of arbitrary size at the end of the trajectory. ROIs mask and the SLS trajectory are exported automatically after the drawing of the trajectory: ROIs are saved as a.mat file, while trajectories are saved as an.xml file compatible with the Prairieview software (version 5.4), as a Matlab.m file compatible with ScanImage (version 2018b) and as a Matlab.mat file.</p>
      </sec>
    </sec>
    <sec id="Sec11">
      <title>SLS acquisitions</title>
      <sec id="Sec12">
        <title>Data import and ROIs registration</title>
        <p id="Par37">SmaRT2P allows importing SLS acquisitions recorded using Prairieview (version 5.4) or ScanImage (version 2018b).</p>
        <p id="Par38">SLS data acquired with Prairieview are stored as a sequence of.tiff files, each of them containing multiple acquisitions of the SLS trajectory. When importing the acquisition in SmaRT2P, users can select the number of.tiff (from one to the total number of files set for the acquisition) which will be concatenated. SLS acquisitions can also be imported as raster acquisitions. Each SLS line is replaced by a two-dimensional FOV with same size of the original raster acquisition, whose pixels contain either the recorded fluorescence or gaussian noise (with mean and standard deviation estimated from the fluorescence of SLS trajectory pixels), depending on whether the pixel belongs to the SLS trajectory or not. If SLS data are imported as raster, only a maximum of two.tiff files can be concatenated to avoid problems due to large data structures. SLS acquisitions imported as raster can be later processed as raster acquisitions. Together with the.tiff files the.xml file containing metadata and generated during the imaging must be provided.</p>
        <p id="Par39">SLS data acquired with ScanImage are stored in a.txt file, containing metadata and information about the acquisition, and a.dat file, containing the fluorescence values. Both files should be provided to SmaRT2P.</p>
        <p id="Par40">During the import of a SLS acquisition, users can select the reference segmentation, that is the segmentation used to build the trajectory. In case a reference segmentation is selected, each pixel in the SLS trajectory is automatically assigned to one of the following classes according to its distance from the reference segmentation (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b): (i) ROI: trajectory pixels within one pixel distance from the reference ROI (ii) ROI’s outer ring: trajectory pixels whose distance from the reference ROI is between one and two pixels (iii) ROI’s surround: trajectory pixels whose distance from the reference ROI is between two and four pixels (iv) Background: trajectory pixels whose distance from any reference ROI is larger than four pixels.<fig id="Fig2"><label>Fig. 2</label><caption><p>Schematic of the processing algorithms. <bold>a</bold> Schematic of the algorithm for large artefacts detection. The dimensionality of SLS data is reduced using PCA and the PC1 scores vector is fitted using an autoregressive model of second order (AR(2)). If the sliding correlation (computed in a 10 s window) between the PC1 scores vector and its fit drops below a given threshold (set to 0.3), a large artefact is detected (red star). <bold>b</bold> Left: an SLS trajectory (yellow line) with a surround of 4 pixels is overlapped to a projection of the corresponding raster acquisition and its reference segmentation (red ROIs). A reference box (yellow square) is scanned at the end of the SLS trajectory. Right top. Pixels assignment for an example ROI (red box in left panel). Pixels can be assigned to the ROI (red dots), to its outer ring (yellow dots), to its surround (green dots), or to background (black dots). Right bottom. Pixels assignment for an example ROI of a SLS trajectory without ROIs surround. <bold>c</bold> Schematic of the algorithm for background activity subtraction. A 1-rank representation of the fluorescence activity of trajectory pixels labelled as background (black pixels) is computed using PCA. The across-pixels averaged low-rank representation is considered as a proxy of background activity, multiplied by 0.7 and subtracted from the fluorescence of all the pixels. <bold>d</bold> Schematic of the small and local artefacts correction algorithm based on NoRMCorre. Activity recorded from the reference box (optionally smoothed in time by averaging in a sliding window of arbitrary width) is considered as a raster acquisition to estimate planar displacement using the NoRMCorre algorithm [<xref ref-type="bibr" rid="CR44">44</xref>]. The estimated displacements are then applied back to the full trajectory. <bold>e</bold> Schematic of the small and local artefacts correction based on SNR. For each ROI, pixels labelled as belonging to the ROI, its outer ring or its surround are considered. In a sliding window of 10 s the SNR of each pixel is computed, pixels are sorted for decreasing SNR, and only a fixed number of high-SNR pixels is used to extract the fluorescence activity. Pixels are selected line-by-line considering the SNR computed in the subsequent 10 s window</p></caption><graphic xlink:href="40708_2022_166_Fig2_HTML" id="MO2"/></fig></p>
        <p id="Par41">Pixels falling in more than one group are not assigned to any class and are discarded for further processing. The availability of a reference segmentation is not required to import SLS data but is necessary for pixels classification and for most of the following processing steps (background activity subtraction, local artefacts correction, local neuropil subtraction).</p>
      </sec>
      <sec id="Sec13">
        <title>Large artefacts detection</title>
        <p id="Par42">The first step of the SLS pre-processing pipeline consists in the detection of large motion artefacts. These are defined as FOV displacements occurring during the acquisition associated with a shift of the ROIs away from the scanned area/trajectory. Under the assumption that such motion artefacts affect the entire SLS acquisition producing sudden (and not physiological) signal transients in all trajectory pixels, we devised the following strategy to detect a large motion artefact (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a). We performed principal component analyses (PCA) to reduce the dimensionality of the SLS acquisition and fitted the score vector of the first principal component (PC1) with an autoregressive model of second order [<xref ref-type="bibr" rid="CR50">50</xref>, <xref ref-type="bibr" rid="CR59">59</xref>] commonly used to model calcium activity. If the correlation between the PC1 scores vector and its fit, computed in a sliding window of 10 s width, drops below a threshold of 0.3 at a given timepoint, a large artefact is detected and all the data acquired after the threshold crossing are discarded.</p>
      </sec>
      <sec id="Sec14">
        <title>Background activity subtraction</title>
        <p id="Par43">Pixels assigned to the background are used to estimate contamination of ROIs activity (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c). The background subtraction strategy implemented here resembles the background estimate performed in [<xref ref-type="bibr" rid="CR50">50</xref>], where pixels not segmented as ROIs were used to compute a global background activity. We considered the fluorescence activity of pixels labelled as background and we applied PCA to compute a low-rank representation of their activity (we kept only PC1, rank = 1). We then averaged across pixels the background low-rank representation, multiplied it by 0.7 [<xref ref-type="bibr" rid="CR36">36</xref>] and subtracted it from all the SLS pixels activity. Potential negative values stemming from this procedure were set to zero.</p>
      </sec>
      <sec id="Sec15">
        <title>Small and local motion artefacts correction</title>
        <p id="Par44">The algorithm implemented for large artefacts detection is not suited to deal with small (i.e., global events of moderate magnitude not fulfilling conditions in the <italic>Large artefacts detection</italic> paragraph) or local motion artefacts, defined as FOV displacements that do not cause a global misalignment between the imaged tissue and the SLS trajectory, do not result in sudden changes in fluorescence dynamics, but might nevertheless be detrimental for the quality of the extracted signal. We, therefore, implemented two strategies for the line-by-line correction of small and local motion artefacts.</p>
        <p id="Par45">The first strategy requires the user to define a reference box at the end on the SLS trajectory, ideally containing clear anatomical features (Fig. <xref rid="Fig2" ref-type="fig">2</xref>d). The fluorescence activity recorded from the reference box is processed as a canonical raster acquisition and the algorithm NoRMCorre [<xref ref-type="bibr" rid="CR44">44</xref>] is applied to estimate the planar displacement of the small portion of tissue corresponding to the reference box. Users can perform a temporal smoothing (and optional down-sampling) of the reference box activity before the application of NoRMCorre, by averaging across multiple “frames” (the temporal window for smoothing and down-sampling is manually set by users). The estimated displacement is then applied to each ROI patch of the smoothed and optionally down-sampled SLS trajectory (i.e., the patch composed by pixels labelled as belonging to a ROI, including up to its outer ring and its surround).</p>
        <p id="Par46">The second strategy consists in the local reassignment of pixels based on the SNR of the extracted signal (Fig. <xref rid="Fig2" ref-type="fig">2</xref>e). For each ROI, pixels labelled as belonging to the ROI, to its outer ring and to its surround are pooled together. The algorithm computes, in a 10 s sliding window, the SNR of each single pixel, sorts the pixels by descending SNR and relabels as belonging to the ROI only the pixels with highest SNR. The number of pixels assigned to each ROI is set to the number of pixels belonging to that ROI in the reference segmentation. However, the identity of the pixels assigned to a ROI can vary in time as a result of small motion artefacts or displacements.</p>
      </sec>
      <sec id="Sec16">
        <title>Neuropil decontamination</title>
        <p id="Par47">We implemented two strategies for neuropil decontamination. The first method implements the algorithm of [<xref ref-type="bibr" rid="CR36">36</xref>]. Pixels in the surround of each ROI are used to estimate the neuropil activity. The average value of fluorescence intensity in the pixels belonging to the surround region is then multiplied by a contamination ratio of 0.7, estimated in [<xref ref-type="bibr" rid="CR36">36</xref>], and subtracted from the average value of pixels belonging to the ROI. If pixels have been reassigned to correct local artefacts, then all the not-assigned pixels (that are variable in time) are used to compute the local neuropil. The second strategy estimates a global neuropil signal based on ROIs activity. In detail, a fluorescence signal is extracted for each ROI by averaging the fluorescence across all pixels assigned to the ROI and to its surround. Then, PCA is applied to compute a low-rank (rank = 1) representation of the ROIs activity, interpretable as a neuropil global signal. This neuropil global signal is finally subtracted from each ROI’s activity and potential negative values stemming from this procedure are set to zero.</p>
      </sec>
      <sec id="Sec17">
        <title>Deconvolution</title>
        <p id="Par48">The fluorescence activity of each ROI is computed by averaging the processed fluorescence activity (i.e., the fluorescence after background subtraction and/or neuropil decontamination) across all pixels labelled as belonging to the ROI at the end of the processing pipeline. Deconvolution of this signal to estimate spike rates is then performed by fitting an autoregressive model of second order [<xref ref-type="bibr" rid="CR64">64</xref>].</p>
      </sec>
      <sec id="Sec18">
        <title>Processing pipeline: validation metrics</title>
        <p id="Par49">To quantify the results obtained with our software on real neural data, we considered two measures: the SNR of the fluorescence traces and the average pairwise correlations. Since these values vary across ROIs, for each acquisition we computed these values at fixed ROI (or ROI pair) and then we averaged across all ROIs (or ROI pairs). The reported results are the average and standard error of the mean (SEM) across acquisitions.</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec19">
    <title>Results</title>
    <p id="Par50">To demonstrate the features and performance of our software, here we present the results of processing SLS acquisitions of real 2P calcium imaging data using SmaRT2P. The data used for this purpose were recorded in mice expressing GCaMP6s in layer IV of barrel cortex (depth ~ 400 μm), using methods fully described in [<xref ref-type="bibr" rid="CR38">38</xref>]. In brief, we used a 2P microscope equipped with galvanometric mirrors to perform raster and SLS acquisitions in anesthetized or awake head-restrained animals. In both conditions, recordings were performed both during spontaneous and sensory-evoked activity (air puff stimulation of the whisker pad). We made these data publicly available [<xref ref-type="bibr" rid="CR67">67</xref>] to enable further tests and validations of this software and of new developments.</p>
    <p id="Par51">We first used SmaRT2P to manually segment reference raster acquisitions and compute SLS trajectories. Then, we acquired SLS data and characterized how the extracted signals are affected by each step of the SLS processing pipeline and how the SLS trajectory features (see below) impact on the quality of extracted signals. We further quantified how the SNR and pairwise correlations of ROIs depended on the processing steps. We reasoned that an effective scanning and analysis pipeline should increase (or at least maintain) the SNR as well as reduce (or at least maintain) the average level of pairwise correlations (too high values of correlations could reflect an incomplete removal or artificial covariation factors due to contaminations from global fluorescence fluctuations and neuropil activity [<xref ref-type="bibr" rid="CR34">34</xref>, <xref ref-type="bibr" rid="CR46">46</xref>, <xref ref-type="bibr" rid="CR65">65</xref>]).</p>
    <p id="Par52">The availability of a single stand-alone toolbox to process raster and SLS data allowed us to easily switch between the raster and the line scan modalities in the same experimental session. This is especially useful for long experimental sessions, where some displacement of the FOV across different recordings might occur. In this latter case, a possible strategy is to alternate SLS acquisitions with short raster acquisitions, align the initial raster segmentation to the novel raster acquisitions (keeping the same ROIs but correcting for possible displacements), and recompute SLS trajectory over time according to the movements recorded by the alternating raster acquisitions. Since ROIs previously segmented using SmaRT2P are automatically imported and aligned to the raster FOV, this procedure contributes to generating more robust SLS data at small cost.</p>
    <sec id="Sec20">
      <title>Detection of large motion artefacts</title>
      <p id="Par53">The effect of planar motion artefacts can be very different between raster scan and SLS. In raster scan acquisitions, an image retaining all topological features of the FOV is usually available. Thus, planar motion artefacts can be compensated for with a frame-by frame iterative process, using a reference image of the FOV and a rigid or non-rigid approach. These strategies are in general efficient against moderate artefacts for most of the ROIs [<xref ref-type="bibr" rid="CR44">44</xref>, <xref ref-type="bibr" rid="CR62">62</xref>]. In SLS acquisition, planar displacements of the FOV of size comparable to a pixel can cause a mismatch of cellular structures with respect to the set of pixels selected for the scanning trajectory. Consequently, the set of pixels in each ROI scanned by SLS might no longer be optimized based on the collective SNR of the ROIs. In case of large motion artefacts (&gt; 5 µm), this displacement can be large enough to exclude the cells of interest from the SLS trajectory, in particular when no ROIs surround is included [<xref ref-type="bibr" rid="CR38">38</xref>]. Since a complete bidimensional image of the cells of interest is lacking in SLS, we cannot use topological features of the acquisition nor a reference FOV image to estimate the planar displacement. We thus defined large motion artefacts based on functional features, ensuring that the recorded signals otherwise fluctuate smoothly in time and follow dynamics that are characteristic of calcium activity (see “<xref rid="Sec13" ref-type="sec">Large artefacts detection</xref>” section). In our experimental setup, large artefacts were seldom detected in SLS acquisitions in anesthetized animals (num. detected artefacts = 16 out of n = 258 SLS acquisitions from n = 22 mice), while they were more frequent in awake and running head-restrained animals (num. detected artefacts = 7 out of n = 28 SLS acquisitions from n = 4 mice).</p>
      <p id="Par54">We investigated whether the presence and the size of a surround (i.e., the inclusion in the SLS of a region surrounding the ROI identified based on pixel SNR; surround dimension: 1, 2, 3 pixels) improved the robustness of SLS acquisitions to large motion artefacts (Fig. <xref rid="Fig3" ref-type="fig">3</xref>). We restricted the analyses to SLS data from awake animals, where detected large artefacts were less rare and a reference box (see “<xref rid="Sec10" ref-type="sec">SLS trajectory computation</xref>” section) at the end of the SLS trajectory was always available. We considered the reference box pixels as a raster acquisition and we applied the NoRMCorre algorithm [<xref ref-type="bibr" rid="CR44">44</xref>] to this small FOV portion to obtain an estimate of the amount of planar displacement of the FOV. We then estimated the fraction of SLS acquisition discarded <italic>a-posteriori</italic> using a linear mixed model in which the size (in pixels) of the ROI surround (<inline-formula id="IEq6"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p{x}_{surr}$$\end{document}</tex-math><mml:math id="M16"><mml:mrow><mml:mi>p</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi mathvariant="italic">surr</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq6.gif"/></alternatives></inline-formula>) was treated as a fixed effect covariate, and the estimated planar displacement was treated as a random effect:<fig id="Fig3"><label>Fig. 3</label><caption><p>Large artefacts detection.<bold> a</bold>, <bold>b</bold> SLS trajectories (yellow line) with a surround of 4 pixels (<bold>a</bold>) and without surround (<bold>b</bold>) are overlapped to a projection of the corresponding raster acquisition and to their reference segmentation (red ROIs). <bold>c</bold>, <bold>d</bold> Large artefact detection for the acquisition in <bold>a</bold>, <bold>b</bold>. From top to bottom. Raster of the SLS acquisition. Each row represents the fluorescence trace of a pixel in the trajectory. Pixels are ordered according to their position in the trajectory, from the first (top) to the last (bottom). Reduced representation of SLS dynamics using only the scores vector of the first PC (PC 1, grey line) and fit with an AR(2) model (black line). Correlation between the first PC scores vector and its fit. Displacement along the horizontal (black) and vertical (grey) direction estimated applying the NoRMCorre algorithm [<xref ref-type="bibr" rid="CR44">44</xref>] to the reference box. The dashed red line in <bold>d</bold> denotes the detection of a large artefacts</p></caption><graphic xlink:href="40708_2022_166_Fig3_HTML" id="MO3"/></fig><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{discardedSLSlines}{acquiredSLSlines}=\left({\beta }_{0}+{\beta }_{1}*p{x}_{surr}\right)+\left({\beta }_{0,shift}+{\beta }_{1,shift}*p{x}_{surr}|shift\right)+\varepsilon$$\end{document}</tex-math><mml:math id="M18" display="block"><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="italic">discardedSLSlines</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">acquiredSLSlines</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfenced close=")" open="("><mml:msub><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow/><mml:mo>∗</mml:mo><mml:mi>p</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi mathvariant="italic">surr</mml:mi></mml:mrow></mml:msub></mml:mfenced><mml:mo>+</mml:mo><mml:mfenced close=")" open="("><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow/><mml:mo>∗</mml:mo><mml:mi>p</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi mathvariant="italic">surr</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>ε</mml:mi></mml:mrow></mml:math><graphic xlink:href="40708_2022_166_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par55">This model distinguishes the specific contribution of the SLS surround size on the large motion artefact detection (<inline-formula id="IEq7"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\beta }_{0}+{\beta }_{1}*p{x}_{surr}$$\end{document}</tex-math><mml:math id="M20"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow/><mml:mo>∗</mml:mo><mml:mi>p</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi mathvariant="italic">surr</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq7.gif"/></alternatives></inline-formula>) from the contribution due to the effective FOV displacement, estimated using the NoRMCorre algorithm (<inline-formula id="IEq8"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\beta }_{0,shift}+{\beta }_{1,shift}*p{x}_{surr}|shift$$\end{document}</tex-math><mml:math id="M22"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow/><mml:mo>∗</mml:mo><mml:mi>p</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi mathvariant="italic">surr</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq8.gif"/></alternatives></inline-formula>). We expect that larger planar displacements in the acquired FOV will increase the fraction of discarded lines and we aim to understand whether adding a surround has any effect on the amount of discarded data. We found that the part of the model capturing the effect of surround size predicted that larger surrounds led to a significant decrease in the fraction of SLS acquisition to discard (<inline-formula id="IEq9"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\beta }_{1}=-0.08$$\end{document}</tex-math><mml:math id="M24"><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo>-</mml:mo><mml:mn>0.08</mml:mn></mml:mrow></mml:math><inline-graphic xlink:href="40708_2022_166_Article_IEq9.gif"/></alternatives></inline-formula>, <italic>p</italic> value = 0.036, model predictions with 95% confidence intervals and residuals q–q plot in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2). This suggests that SLS trajectories with surrounds are more robust to motion artefacts (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a,c). This was confirmed by the further finding that SmaRT2P detected large motion artefacts mostly for the acquisitions without surround (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b, d; Table <xref rid="Tab2" ref-type="table">2</xref>). The increased robustness to motion artefacts was obtained at the cost of decreasing the single line sampling rate because of the larger number of pixels to scan when the surround is included (Table <xref rid="Tab2" ref-type="table">2</xref>).<table-wrap id="Tab2"><label>Table 2</label><caption><p>Sampling rate and large artefacts detection. Mean ± SEM</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" colspan="5">Anesthetized</th></tr><tr><th align="left"/><th align="left">Surr = 0</th><th align="left">Surr = 1</th><th align="left">Surr = 2</th><th align="left">Surr ≥ 3</th></tr></thead><tbody><tr><td align="left">N SLS</td><td align="left">146</td><td align="left">54</td><td align="left">41</td><td align="left">17</td></tr><tr><td align="left">Sampling rate (Hz)</td><td align="left">42.7 ± 1.6</td><td align="left">29.2 ± 2.3</td><td align="left">23.3 ± 2.3</td><td align="left">18.7 ± 2.6</td></tr><tr><td align="left">N SLS with large artefacts</td><td align="left">8</td><td align="left">5</td><td align="left">3</td><td align="left">0</td></tr><tr><td align="left">Fraction of cropped lines</td><td align="left">0.65 ± 0.27</td><td align="left">0.76 ± 0.14</td><td align="left">0.63 ± 0.27</td><td align="left">N.A</td></tr></tbody></table><table frame="hsides" rules="groups"><thead><tr><th align="left" colspan="5">Awake</th></tr><tr><th align="left"/><th align="left">Surr = 0</th><th align="left">Surr = 1</th><th align="left">Surr = 2</th><th align="left">Surr ≥ 3</th></tr></thead><tbody><tr><td align="left">N SLS</td><td align="left">16</td><td align="left">3</td><td align="left">2</td><td align="left">7</td></tr><tr><td align="left">Sampling rate (Hz)</td><td align="left">29.5 ± 4.1</td><td align="left">28.2 ± 12.1</td><td align="left">16.1 ± 0</td><td align="left">16.6 ± 0.2</td></tr><tr><td align="left">N SLS with large artefacts</td><td align="left">6</td><td align="left">0</td><td align="left">0</td><td align="left">1</td></tr><tr><td align="left">Fraction of cropped lines</td><td align="left">0.68 ± 0.34</td><td align="left">N.A</td><td align="left">N.A</td><td align="left">0.11 ± 0.00</td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec21">
      <title>Background activity subtraction</title>
      <p id="Par56">In 2P imaging experiments, it is common practice to subtract global background activity, i.e., the signal generated by neighbouring unspecified fluorescent structures [<xref ref-type="bibr" rid="CR34">34</xref>, <xref ref-type="bibr" rid="CR50">50</xref>, <xref ref-type="bibr" rid="CR62">62</xref>]. In conventional raster scanning, global background activity can be computed from global fluctuations of the whole FOV or of FOV regions without ROIs (for example, the background components in [<xref ref-type="bibr" rid="CR50">50</xref>]). In SLS acquisitions, a smaller number of pixels not belonging to ROIs are acquired, thus restricting the surface available for background estimation. We developed a strategy to estimate and subtract global background fluctuations using the available pixels and assessed its effectiveness by computing pairwise correlations between ROIs fluorescence traces before and after the subtraction of the global background activity (Fig. <xref rid="Fig4" ref-type="fig">4</xref>). A significant reduction in pairwise correlations after background activity subtraction was observed both in anesthetized and awake animals (Fig. <xref rid="Fig4" ref-type="fig">4</xref>b,c), suggesting that our strategy was effective in removing simultaneous fluctuations in ROIs fluorescence (Table <xref rid="Tab3" ref-type="table">3</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><p>Background activity subtraction. <bold>a</bold> Top. Fluorescence activity of the ROIs segmented in an example SLS acquisition. Each row in the raster corresponds to the activity of a ROI. Bottom. Fluorescence activity of the same ROIs after the subtraction of the background activity. <bold>b</bold> Pairwise correlations between ROIs in <bold>a</bold> before (top) and after (bottom) the subtraction of the background activity. <bold>c</bold>. Average SNR (blue, left) and pairwise correlations (red, right) difference between background-subtracted and raw data for anesthetized (top) and awake animals (bottom). Extended values in Table <xref rid="Tab3" ref-type="table">3</xref></p></caption><graphic xlink:href="40708_2022_166_Fig4_HTML" id="MO4"/></fig><table-wrap id="Tab3"><label>Table 3</label><caption><p>Background subtraction. Difference in pairwise correlations before and after background subtraction</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left" colspan="3">Anesthetized</th><th align="left" colspan="2">Awake</th></tr><tr><th align="left"/><th align="left">Surr = 0</th><th align="left">Surr = 1</th><th align="left">Surr ≥ 2</th><th align="left">Surr = 0</th><th align="left">Surr ≥ 1</th></tr></thead><tbody><tr><td align="left">N SLS</td><td align="left">146</td><td align="left">53</td><td align="left">57</td><td align="left">16</td><td align="left">12</td></tr><tr><td align="left">∆ SNR</td><td align="left"><p>− 1.62 ± 0.21</p><p>(2.3e−13)</p></td><td align="left"><p>− 2.35 ± 0.39</p><p>(1.9e−6)</p></td><td align="left"><p>− 2.47 ± 0.37</p><p>(2.6e−7)</p></td><td align="left"><p>− 5.25 ± 4.26</p><p>(0.0023)</p></td><td align="left"><p>− 3.16 ± 1.56</p><p>(4.9e−4)</p></td></tr><tr><td align="left">∆ pairwise correlations</td><td align="left"><p>− 0.35 ± 0.01</p><p>(1.0e−25)</p></td><td align="left"><p>− 0.42 ± 0.01</p><p>(2.4e−10)</p></td><td align="left"><p>− 0.43 ± 0.01</p><p>(5.1e−11)</p></td><td align="left"><p>− 0.20 ± 0.04</p><p>(0.0019)</p></td><td align="left"><p>− 0.30 ± 0.04</p><p>(0.0005)</p></td></tr></tbody></table><table-wrap-foot><p>Only acquisitions with a reference raster segmentation are considered. Mean ± SEM (and <italic>p</italic> values for Wilcoxon signed rank test)</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec22">
      <title>Small and local motion artefacts correction</title>
      <p id="Par57">As discussed above, rigid and non-rigid motion correction techniques developed for raster scanning data do not generalize to SLS data. We, therefore, developed two line-by-line motion correction strategies for SLS data, which compensate small or local displacements that might take place during the acquisition.</p>
      <p id="Par58">The first strategy, which is novel with respect to the algorithms presented in [<xref ref-type="bibr" rid="CR38">38</xref>], is the SLS line-by-line analog of the rigid frame-by-frame motion correction for raster acquisitions. It can be implemented only when a reference box is available at the end of the SLS trajectory and it uses the reference box as a raster acquisition to estimate the planar displacement. Ideally, the reference box should contain clear anatomical features that remain available for all the duration of the recording, otherwise the motion estimate algorithm would try to match noise to a template and fail. Since the displacement computed in a small FOV portion is then applied back to the full trajectory, this procedure assumes that the FOV is not altered by deformations but rigidly shifts within the imaged plane. We did not explicitly verify this assumption, but we believe it could be satisfied for SLS acquisitions, because they are characterized by high sampling rates, while non-rigid deformations are in general associated with slow acquisition rates [<xref ref-type="bibr" rid="CR41">41</xref>, <xref ref-type="bibr" rid="CR43">43</xref>, <xref ref-type="bibr" rid="CR44">44</xref>]. To make the motion correction algorithm more robust against noise, we also estimated motion using a smoothed version of the data, obtained by averaging activity in a sliding window (width = 1 and 10 s).</p>
      <p id="Par59">The second strategy, already applied in [<xref ref-type="bibr" rid="CR38">38</xref>], has been developed <italic>ad-hoc</italic> for SLS acquisitions. It is implemented locally around each ROI and aims at maximizing signal quality by considering only pixels with high SNR. Such strategy allows getting a different displacement for each ROI, therefore, releasing the assumption of a rigid FOV. This algorithm provides, therefore, a line-by-line pixel reassignment for each ROI, but it integrates information from a larger time window (to compute SNR) to compute single-line corrections. It must be noted that the success of this algorithm might be limited for those ROIs characterized by long silent periods. In fact, during such periods there is no signal available to compute the SNR and the estimated displacements would be based on noise fluctuations.</p>
      <p id="Par60">We applied both strategies after the global background subtraction to all the SLS acquisitions, where a reference box was available and we observed that the SNR-based strategy leads to a small but consistent increase in the SNR of the extracted traces, independently from the surround size and the animal condition (Fig. <xref rid="Fig5" ref-type="fig">5</xref>b; Table <xref rid="Tab4" ref-type="table">4</xref>) and to small or non-significant increase in the pairwise correlations between ROIs (Fig. <xref rid="Fig5" ref-type="fig">5</xref>b; Table <xref rid="Tab4" ref-type="table">4</xref>). In general, the increase in signal quality is larger and more significant for larger surrounds, which suggests that adding surrounds to the segmented ROIs might not only increase robustness with respect to large motion artefacts but also improve the performance of the local motion artefacts correction algorithm. The strategy based on the NoRMCorre algorithm [<xref ref-type="bibr" rid="CR44">44</xref>] had heterogeneous performance, depending on the size of the surround and the temporal smoothing. In terms of SNR, it performed better for faster acquisitions without temporal smoothing and with small or no surround (Table <xref rid="Tab4" ref-type="table">4</xref>). When it was successful in increasing the SNR, the improvement was larger than the one obtained using the SNR-based strategies. However, it was also accompanied by a larger increase in pairwise correlations, which might suggest that some background activity is retained in the ROIs traces (Table <xref rid="Tab4" ref-type="table">4</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><p>Small and local artefacts correction and neuropil decontamination. <bold>a</bold> Fluorescence activity of the same ROIs of Fig. <xref rid="Fig2" ref-type="fig">2</xref>a after the correction of artefacts obtained through the reassignment of those pixels that maximize the SNR (top) or through the correction strategy that uses the displacements estimated using the NoRMCorre algorithm [<xref ref-type="bibr" rid="CR44">44</xref>] on the reference box with a smoothing window of 10 s (bottom). <bold>b</bold> Effects of different artefacts corrections strategies on the SNR and pairwise correlation of fluorescence traces for different surrounds and animal states. Extended values in Table <xref rid="Tab4" ref-type="table">4</xref>. <bold>c</bold> Correlations between the displacement along the <italic>x</italic>-axis (left) or <italic>y</italic>-axis (right) estimated using different strategies in anesthetized (top) and awake (bottom) animals. <bold>d</bold> Effects of neuropil decontamination strategies on the SNR and pairwise correlation of fluorescence traces for different surrounds and animal states. Extended values in Table <xref rid="Tab5" ref-type="table">5</xref></p></caption><graphic xlink:href="40708_2022_166_Fig5_HTML" id="MO5"/></fig><table-wrap id="Tab4"><label>Table 4</label><caption><p>Small artefacts motion correction</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"/><th align="left" colspan="3">Anesthetized</th><th align="left" colspan="2">Awake</th></tr><tr><th align="left"/><th align="left"/><th align="left">Surr = 0</th><th align="left">Surr = 1</th><th align="left">Surr ≥ 2</th><th align="left">Surr = 0</th><th align="left">Surr ≥ 1</th></tr></thead><tbody><tr><td align="left"/><td align="left">N SLS</td><td align="left">101</td><td align="left">33</td><td align="left">28</td><td align="left">16</td><td align="left">12</td></tr><tr><td align="left" rowspan="2">SNR</td><td align="left">∆ SNR</td><td align="left"><p>1.28 ± 0.05</p><p>(3e−18)</p></td><td align="left"><p>2.39 ± 0.19</p><p>(5e−7)</p></td><td align="left"><p>5.72 ± 0.50</p><p>(4e−6)</p></td><td align="left"><p>1.07 ± 0.14</p><p>(0.0004)</p></td><td align="left"><p>4.46 ± 1.35</p><p>(0.0005)</p></td></tr><tr><td align="left">∆ pairwise correlations</td><td align="left"><p>0.016 ± 0.001</p><p>(3e−14)</p></td><td align="left"><p>0.023 ± 0.003</p><p>(4e−6)</p></td><td align="left"><p>0.016 ± 0.005</p><p>(0.0094)</p></td><td align="left"><p>0.003 ± 0.002</p><p>(0.0627)</p></td><td align="left"><p>0.028 ± 0.007</p><p>(0.0005)</p></td></tr><tr><td align="left" rowspan="2">NoRMCorre 0.1 Hz</td><td align="left">∆ SNR</td><td align="left"><p>− 0.55 ± 1.11</p><p>(8e−7)</p></td><td align="left"><p>− 2.11 ± 0.67</p><p>(5e−7)</p></td><td align="left"><p>− 1.68 ± 0.53</p><p>(4e−6)</p></td><td align="left"><p>8.14 ± 12.61</p><p>(0.0494)</p></td><td align="left"><p>− 1.74 ± 3.79</p><p>(0.0640)</p></td></tr><tr><td align="left">∆ pairwise correlations</td><td align="left"><p>0.201 ± 0.024</p><p>(8e−8)</p></td><td align="left"><p>0.065 ± 0.029</p><p>(0.5143)</p></td><td align="left"><p>0.011 ± 0.017</p><p>(0.0256)</p></td><td align="left"><p>0.29 ± 0.07</p><p>(0.0052)</p></td><td align="left"><p>0.12 ± 0.05</p><p>(0.0923)</p></td></tr><tr><td align="left" rowspan="2">NoRMCorre 1 Hz</td><td align="left">∆ SNR</td><td align="left"><p>3.46 ± 1.38</p><p>(0.8244)</p></td><td align="left"><p>− 1.80 ± 1.44</p><p>(0.0064)</p></td><td align="left"><p>− 3.87 ± 1.42</p><p>(7e−5)</p></td><td align="left"><p>13.86 ± 5.54</p><p>(0.0131)</p></td><td align="left"><p>4.41 ± 3.30</p><p>(0.3013)</p></td></tr><tr><td align="left">∆ pairwise correlations</td><td align="left"><p>0.430 ± 0.019</p><p>(3e-−18)</p></td><td align="left"><p>0.233 ± 0.035</p><p>(2e−6)</p></td><td align="left"><p>0.156 ± 0.034</p><p>(4e−4)</p></td><td align="left"><p>0.39 ± 0.06</p><p>(0.0004)</p></td><td align="left">0.42 ± 0.04 (0.0005)</td></tr><tr><td align="left" rowspan="2">NoRMCorre</td><td align="left">∆ SNR</td><td align="left"><p>11.01 ± 0.94</p><p>(2e−15)</p></td><td align="left"><p>4.81 ± 0.94</p><p>(9e−5)</p></td><td align="left"><p>1.83 ± 1.74</p><p>(0.3275)</p></td><td align="left"><p>7.44 ± 4.84</p><p>(0.2553)</p></td><td align="left"><p>12.67 ± 2.31</p><p>(0.0015)</p></td></tr><tr><td align="left">∆ pairwise correlations</td><td align="left"><p>0.521 ± 0.012</p><p>(3e−18)</p></td><td align="left"><p>0.370 ± 0.022</p><p>(5e−7)</p></td><td align="left"><p>0.321 ± 0.022</p><p>(4e−6)</p></td><td align="left"><p>0.46 ± 0.04</p><p>(0.0004)</p></td><td align="left"><p>0.41 ± 0.02</p><p>(0.0005)</p></td></tr></tbody></table><table-wrap-foot><p>Difference in SNR and pairwise correlations before and after motion correction with different methods. Only acquisitions with a reference raster segmentation and a reference box in the SLS trajectory are considered. Mean ± SEM (and <italic>p</italic> values for Wilcoxon signed rank test)</p></table-wrap-foot></table-wrap></p>
      <p id="Par61">To further understand the different performance of the two strategies, we computed the correlation between the (planar) displacements estimated by each algorithm (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c). In the SNR-based strategy, which is characterized by local and non-rigid artefacts correction, we defined a planar displacement for each ROI, as the planar shift of the centre of the ROI spatial footprint. We then computed correlations between each ROI’s SNR-based displacement and the NoRMCorre-based displacement and considered the maximum value of correlation across ROIs as a measure of similarity between the displacements estimated using the two strategies. We found that correlation values where higher between the SNR-based displacement and the NoRMCorre-based displacement with smoothing at 0.1 Hz (correlation values. <italic>x</italic>-axis: 0.42 ± 0.01, <italic>y</italic>-axis: 0.46 ± 0.01, mean ± SEM, n = 162 anesthetized. Correlation values. <italic>x</italic>-axis: 0.25 ± 0.03, <italic>y</italic>-axis: 0.41 ± 0.04, mean ± SEM, n = 28 awake). This might be explained by the fact that the temporal window considered for the SNR computation and the smoothing applied before the NoRMCorre-based correction have the same width. The correlation values obtained when considering smaller or no smoothing windows were smaller.</p>
    </sec>
    <sec id="Sec23">
      <title>Neuropil decontamination</title>
      <p id="Par62">Fluorescence signal from out of focus sources or from subresolved structures (i.e., neuropil) might contaminate the ROIs signals and generate false detections of calcium transients when using SLS or raster scans [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR73">73</xref>]. State-of-the-art techniques for neuropil decontamination in raster acquisitions provide accurate estimates of the neuropil signal by leveraging on the fluorescence extracted from pixels in each ROI surround [<xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR55">55</xref>, <xref ref-type="bibr" rid="CR56">56</xref>]. In SLS acquisitions, ROIs surrounding regions are not necessarily scanned or might contain too few pixels and available strategies thus cannot be applied. We then implemented two strategies for neuropil decontamination in SLS acquisitions: a local strategy, which estimates a neuropil signal for each ROI by averaging across the available neighbouring pixels and a global strategy, which provides a single estimate of the neuropil signal using dimensionality reduction. We applied both neuropil decontamination strategies as final step of multiple processing pipelines (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b) to all SLS acquisitions with a reference box. Pooling results together across different pipelines showed that both neuropil decontamination strategies led to significant decreases in pairwise correlations (Fig. <xref rid="Fig5" ref-type="fig">5</xref>d; Table <xref rid="Tab5" ref-type="table">5</xref>), suggesting they are effective in reducing artificial covariations likely due to neuropil contamination.<table-wrap id="Tab5"><label>Table 5</label><caption><p>Local neuropil subtraction</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left"/><th align="left" colspan="3">Anesthetized</th><th align="left" colspan="2">Awake</th></tr><tr><th align="left"/><th align="left"/><th align="left">Surr = 0</th><th align="left">Surr = 1</th><th align="left">Surr ≥ 2</th><th align="left">Surr = 0</th><th align="left">Surr ≥ 1</th></tr></thead><tbody><tr><td align="left"/><td align="left">N SLS</td><td align="left">1010</td><td align="left">330</td><td align="left">280</td><td align="left">120</td><td align="left">160</td></tr><tr><td align="left" rowspan="2">Local surround</td><td align="left">∆ SNR</td><td align="left"><p>9.15 ± 5.93</p><p>(4e−46)</p></td><td align="left"><p>10.45± 5.49</p><p>(6e−8)</p></td><td align="left"><p>– 3.82 ± 0.47</p><p>(8e−24)</p></td><td align="left"><p>− 4.19 ± 2.95</p><p>(7e−4)</p></td><td align="left"><p>− 1.36 ± 3.82</p><p>(4e−3)</p></td></tr><tr><td align="left">∆ pairwise correlations</td><td align="left"><p>− 0.337 ± 0.006</p><p>(2e−159)</p></td><td align="left"><p>− 0.324 ± 0.011</p><p>(9e−54)</p></td><td align="left"><p>− 0.263 ± 0.010</p><p>(1e−45)</p></td><td align="left"><p>− 0.313 ± 0.017</p><p>(5e−26)</p></td><td align="left"><p>− 0.287 ± 0.018</p><p>(2e−19)</p></td></tr><tr><td align="left" rowspan="2">PCA</td><td align="left">∆ SNR</td><td align="left"><p>6.76 ± 0.35</p><p>(3e−75)</p></td><td align="left"><p>− 4.28 ± 0.33</p><p>(2e−32)</p></td><td align="left"><p>− 5.18 ± 0.43</p><p>(8e−28)</p></td><td align="left"><p>− 10.51 ± 2.30</p><p>(4e−13)</p></td><td align="left"><p>− 9.98 ± 1.09</p><p>(3e−11)</p></td></tr><tr><td align="left">∆ pairwise correlations</td><td align="left"><p>− 0.532 ± 0.008</p><p>(9e−160)</p></td><td align="left"><p>− 0.495 ± 0.012</p><p>(1e−53)</p></td><td align="left"><p>− 0.495 ± 0.013</p><p>(1e−45)</p></td><td align="left"><p>− 0.418 ± 0.022</p><p>(9e−26)</p></td><td align="left"><p>− 0.448 ± 0.022</p><p>(2e−19)</p></td></tr></tbody></table><table-wrap-foot><p>Difference in SNR and pairwise correlations before and after local neuropil subtraction with different methods. Only acquisitions with a reference raster segmentation and a reference box in the SLS trajectory are considered. Mean ± SEM (and <italic>p</italic> values for Wilcoxon signed rank test)</p></table-wrap-foot></table-wrap></p>
    </sec>
    <sec id="Sec24">
      <title>Processing pipeline</title>
      <p id="Par63">Since there is no standard processing for SLS acquisitions, we combined the processing steps described above in different ways and assessed the effect of the full processing pipeline measuring the changes of SNR and pairwise correlations with respect to raw data (Fig. <xref rid="Fig6" ref-type="fig">6</xref>). As expected, processing pipelines comprising only local corrections for signal optimization (denoted by SNR and NoRM in Fig. <xref rid="Fig6" ref-type="fig">6</xref>) were not effective in reducing pairwise correlations. This suggests that background and/or neuropil contamination might still be present, which advises against the choice of such processing pipeline. Most other processing pipelines, in general, resulted in a decrease in pairwise correlations associated with more or less marked decrease in SNR. For our data, we found that the pipeline composed by background subtraction followed by SNR-based local motion artefacts correction and, optionally, local neuropil decontamination was the most effective in reducing correlations with respect to the raw data while preserving signal quality (detailed values for all pipelines are reported in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1).<fig id="Fig6"><label>Fig. 6</label><caption><p>Processing pipelines comparison. Evaluation of the signal quality after different processing pipelines for SLS with different surrounds in anesthetized (n = 101, 33, 28 for surround 0,1, ≥2) and awake animals (n = 16, 12 for surround 0, ≥1). Blue boxplots show the SNR distributions for each pipeline, red boxplots show the pairwise correlations distributions for each pipeline. The continuous blue and the orange lines show, respectively, the SNR and pairwise correlation median value for the processing pipeline composed by background subtraction followed by SNR-based artefacts correction (red box). The dashed light blue and light orange lines correspond to no changes in SNR and pairwise correlations, respectively, with respect to raw data. Extended values in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1</p></caption><graphic xlink:href="40708_2022_166_Fig6_HTML" id="MO6"/></fig></p>
    </sec>
  </sec>
  <sec id="Sec25">
    <title>Discussion</title>
    <p id="Par64">Two-photon calcium imaging is a leading technique for functional readout of neural activity, enabling the recording of the activity of populations of neurons with high spatial information in depth and across multiple experimental sessions. New calcium indicators have been engineered [<xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR74">74</xref>] and a wide array of software and analysis tools have been developed by the computational neuroscience community for the post-processing and advanced analysis of these data [<xref ref-type="bibr" rid="CR35">35</xref>, <xref ref-type="bibr" rid="CR44">44</xref>, <xref ref-type="bibr" rid="CR51">51</xref>, <xref ref-type="bibr" rid="CR53">53</xref>, <xref ref-type="bibr" rid="CR55">55</xref>, <xref ref-type="bibr" rid="CR62">62</xref>, <xref ref-type="bibr" rid="CR64">64</xref>, <xref ref-type="bibr" rid="CR66">66</xref>]. Using these tools and under optimized imaging conditions (i.e., while imaging one or a few cells at high frame rate), the detection of the discharge of one or few action potentials in individual cells has been demonstrated [<xref ref-type="bibr" rid="CR36">36</xref>]. However, achieving similar performance while recording large populations of neurons or at increased acquisition rates requires the improvement of scanning procedures to acquire data from the regions of interest with the highest possible speed and SNR. To this aim, we recently introduced Smart Line Scanning and we demonstrated that it improves the temporal resolution and signal quality of two-photon calcium imaging data [<xref ref-type="bibr" rid="CR38">38</xref>], improving the accuracy of single spike detection when recording neural population activity from awake animals. Here, we complement that effort providing a novel open-source software toolbox, SmaRT2P, which greatly simplifies the implementation of smart line scanning in standard 2P microscopes. Our toolbox is provided with a range of tools for both the design and implementation of the smart line scanning, and for the data processing. The implications of our work are discussed in what follows.</p>
    <sec id="Sec26">
      <title>Software block for raster acquisitions</title>
      <p id="Par65">SmaRT2P is composed by two main blocks. The first block processes raster acquisitions. We added the raster data processing to SmaRT2P not only to have a stand-alone tool, but also because an initial raster scanning imaging section is needed to design the SLS, and because users may want to use either type of scanning depending on the experimental conditions or scientific questions. SmaRT2P was designed to easily allow computing SLS trajectories from raster scanning data and switching from raster acquisitions to line scan acquisitions with minimal requirements.</p>
      <p id="Par66">The raster scanning block of SmaRT2P is largely based on existing algorithms. However, and importantly, SmaRT2P adds the possibility of importing raster acquisitions, which are already segmented. In this way, users can segment raster data using their preferred and independent tool, ensuring full compatibility of SmaRT2P with raster scanning procedures already established in each laboratory. The first SmaRT2P block differs from available toolboxes for the possibility of drawing of SLS trajectories, which cross through all the ROIs identified from raster acquisitions. Before generating the SLS trajectory, the users have the option to add a surround to each ROI and to add a reference box at the end of the trajectory, that is scanned in a raster-like modality. The users can manually set the width of the surround, the size of the reference box, and its position within the FOV.</p>
    </sec>
    <sec id="Sec27">
      <title>Software block for designing and implementing SLS trajectories</title>
      <p id="Par67">Once the ROIs are segmented in the raster scanning software block, SmaRT2P optimizes the SLS trajectories in an automated way. Finding an optimal trajectory is particularly important for recordings of large populations. In this case, scanning the ROIs in a sub-optimal way might result in numerous jumps of the laser within the FOV and reduce the acquisition speed and the advantages provided by the SLS approach. However, the problem of finding the optimal trajectory is computationally hard, is well studied in the literature as the TSP, and its complexity increases steeply with the number of ROIs. We, therefore, used a genetic algorithm to compute an approximate solution instead of the optimal one. To make SLS trajectories more robust to motion artefacts and to background/neuropil contamination, ROI’s surround regions and a reference box can be included in the SLS trajectory. The presence of the surround regions and of the reference box decreases the speed of SLS acquisitions but might be particularly useful for data acquired in awake animals, where the presence of these artefacts might limit the applicability of line-scan approaches.</p>
      <p id="Par68">Importantly, the second block of SmaRT2P provides various tools for the processing and analysis of data acquired with SLS. To our knowledge, SmaRT2P represents the first open-source tool available for this type of analyses. It combines algorithms used in [<xref ref-type="bibr" rid="CR38">38</xref>] (but not shared in an open-source toolbox) with a novel algorithm for the correction of local artefacts in SLS data. More specifically, SmaRT2P allows detecting large motion artefacts in SLS acquisitions, to subtract background and neuropil contamination, and to detect and correct small and local artefacts. The users can choose to apply one or multiple processing steps to SLS data according to their needs.</p>
      <p id="Par69">SmaRT2P is equipped with a graphical interface, which facilitates its use to people without programming experience. The graphical interface includes methods for the generation of SLS trajectories and for a complete processing of SLS data (i.e., motion artefacts detection and correction, background subtraction, and neuropil decontamination). We designed SmaRT2P to be flexible, to adapt to data acquired under different experimental conditions. A first degree of flexibility is provided in the design of the SLS trajectories, where users can set a trade-off between increased temporal resolution and robustness to motion artefacts. Then, in the SLS data processing, SmaRT2P is organized in a modular way and different processing pipelines can be implemented. We did not set a preformatted processing pipeline, because smart line scan acquisitions and smart line scan processing tools are sensitive to trajectory characteristics and to experimental conditions. The processing pipeline should then be tuned according to the features of the acquired data. Furthermore, a modular approach is open to extension, modifications, and insertion of further developments of the processing algorithms.</p>
    </sec>
    <sec id="Sec28">
      <title>Results on benchmarking SmaRT2P on real data</title>
      <p id="Par70">We benchmarked the performance of SmaRT2P on an extensive 2P GCaMP6s data set recorded from layer IV of the barrel cortex in anesthetized and awake mice. This data set was larger than the one used in [<xref ref-type="bibr" rid="CR38">38</xref>]. We selected the SNR of the extracted signals and their average pairwise correlations as indicators of the algorithms’ performance, and we computed changes in these two measures as a function of each processing step and of different processing pipelines (i.e., combinations of multiple processing steps in a given order). Results of this benchmarking indicated that combining SLS and SmaRT2P allows successfully acquiring data with high sampling rate and high signal quality. A careful choice of few parameters in the design of the SLS trajectories (ROIs surround and reference box) improves the performance and effectiveness of the SLS processing techniques and allows reaching a trade-off between fast and robust recordings. A systematic study of the effect of variations in the processing pipeline showed how to optimize the pipeline depending on the data set type and suggested that combining a background or neuropil subtraction algorithm with an artefact correction algorithm should successfully improve the signal quality and remove global fluctuations and artefacts that might mask relevant single cell activity. Importantly, we made the benchmarking 2P data set fully available with this article, to enable open-source development of new raster scan tools and to facilitate an open and fair comparison of performance with future algorithms.</p>
    </sec>
    <sec id="Sec29">
      <title>Hardware requirements</title>
      <p id="Par71">On the hardware side, SLS acquisitions can be performed using the same setup used for conventional raster acquisition. This is possible, because SLS trajectories are mapped on the FOV acquired in raster mode and are tuned to the characteristics of the microscope used for raster acquisitions. When moving from one pixel to the adjacent one, mirrors, therefore, perform the same type of movements required for raster acquisition.</p>
    </sec>
  </sec>
  <sec id="Sec30">
    <title>Conclusions</title>
    <p id="Par72">The growth and flourishing of 2P calcium imaging for studying neural population activity has been paralleled by major computational effort for the development of open-source toolboxes for the analysis of such data. Thus, the development of analytical tools for 2P calcium imaging is a major frontier in current computational neuroscience [<xref ref-type="bibr" rid="CR44">44</xref>, <xref ref-type="bibr" rid="CR45">45</xref>, <xref ref-type="bibr" rid="CR48">48</xref>, <xref ref-type="bibr" rid="CR51">51</xref>, <xref ref-type="bibr" rid="CR53">53</xref>–<xref ref-type="bibr" rid="CR56">56</xref>, <xref ref-type="bibr" rid="CR61">61</xref>, <xref ref-type="bibr" rid="CR62">62</xref>, <xref ref-type="bibr" rid="CR64">64</xref>, <xref ref-type="bibr" rid="CR66">66</xref>, <xref ref-type="bibr" rid="CR75">75</xref>]. However, less attention has been given to the development of open-source toolboxes that improve the scanning and acquisition procedures. Our open-source toolbox, SmaRT2P, contributes to filling this gap and will facilitate further development in the field. Our validations of SmaRT2P on real data suggest that SmaRT2P will improve the resolution and accuracy with which neural population codes can be extracted from 2P imaging experiments.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec31">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="40708_2022_166_MOESM1_ESM.docx">
            <caption>
              <p><bold>Additional file 1: Figure S1</bold>. SmaRT2P graphical user interface. a. Schematic of the main GUI window of SmaRT2P. In this window users can visualize the raster movie, the segmented ROIs, and the extracted activity. b. Schematic of the GUI window for the segmentation of raster data. Users can visualize simultaneously multiple projections of the acquisition (left) and scroll through single frames (right). Users can segment ROIs using a bounding box (red inset, left) or manually drawing the contour (red inset, right) both on the large projection window and on the sliding frames. The smart selection of the pixels includes in the segmentation only those pixels that maximize the extracted SNR (bottom right), but users can adjust the pixels selection manually. c. Example SLS trajectory (yellow line) with a small surround and a reference box attached at the end of the trajectory. Coloured areas show the ROIs used to build the trajectory. <bold>Figure S2</bold>. Linear mixed model. a. Prediction of the fraction of SLS acquisitions to discard as a function of the number of pixels in the ROI’s surround region (gray area represents 95% confidence intervals). The model shows that scanning larger surrounds reduces the number of SLS lines to discard adding robustness to SLS acquisitions. b. QQ plot of the residuals of the data after fitting the linear mixed model to model the fraction of discarded SLS acquisitions. Since normality is a necessary condition to apply linear mixed models, we re-fitted the model after removing one outlier and observed that results were similar to the ones obtained using the full data set (beta1 = −0.11, <italic>p</italic> value=0.048). <bold>Table S1</bold>. Mean ± SEM (and <italic>p</italic> values for Wilcoxon signed rank test) for SNR and pairwise correlations of different processing pipeline reported in Fig. 6.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>2P</term>
        <def>
          <p id="Par2">Two-photon</p>
        </def>
      </def-item>
      <def-item>
        <term>SNR</term>
        <def>
          <p id="Par3">Signal-to-noise ratio</p>
        </def>
      </def-item>
      <def-item>
        <term>GECI</term>
        <def>
          <p id="Par4">Genetically encoded calcium indicator</p>
        </def>
      </def-item>
      <def-item>
        <term>SLS</term>
        <def>
          <p id="Par5">Smart line scan</p>
        </def>
      </def-item>
      <def-item>
        <term>ROI</term>
        <def>
          <p id="Par6">Region of interest</p>
        </def>
      </def-item>
      <def-item>
        <term>GUI</term>
        <def>
          <p id="Par7">Graphical user interface</p>
        </def>
      </def-item>
      <def-item>
        <term>FOV</term>
        <def>
          <p id="Par8">Field of view</p>
        </def>
      </def-item>
      <def-item>
        <term>PCA</term>
        <def>
          <p id="Par9">Principal component analysis</p>
        </def>
      </def-item>
      <def-item>
        <term>PC1</term>
        <def>
          <p id="Par10">First principal component</p>
        </def>
      </def-item>
      <def-item>
        <term>SEM</term>
        <def>
          <p id="Par11">Standard error of the mean</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Manuel Molano-Mazon for his contribution to the first code version and to our previous publication of line scans, Jacopo Bonato for comments on this paper, and Andrea Sattin for feedback on software use.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>SP and TF conceived and supervised the project. MB collected the data sets, MM designed and wrote the software and performed the analysis. MM, SP and TF wrote the paper. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>Open Access funding enabled and organized by Projekt DEAL. This work was supported by the European Research Council (ERC, NEURO-PATTERNS), NIH Brain Initiative (U19 NS107464, R01 NS109961, R01 NS108410) and the European Union’s Horizon 2020 Framework Programme for Research and Innovation under the Specific Grant Agreement No. 945539 (Human Brain Project SGA3).</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The data sets generated and/or analysed during the current study are available in the following repository: Brondi, M., Moroni, M., Panzeri, S., &amp; Fellin, T. (2021). <italic>Recordings of mice layer IV barrel cortex activity using two-photon functional microscopy and Smart Line Scanning</italic> [<xref ref-type="bibr" rid="CR67">67</xref>]. EBRAINS. <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.25493/74DX-JVC">https://doi.org/10.25493/74DX-JVC</ext-link>. Detailed information about SmaRT2P, a practical user guide and the open-source-code of the toolbox can be downloaded at <ext-link ext-link-type="uri" xlink:href="https://github.com/moni90/SmART2P">https://github.com/moni90/SmART2P</ext-link>. The software is released under the MIT license.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar1">
      <title>Ethics approval and consent to participate</title>
      <p id="Par73">This article uses previously published mouse data [<xref ref-type="bibr" rid="CR38">38</xref>, <xref ref-type="bibr" rid="CR67">67</xref>], which are shared in the following repository [<xref ref-type="bibr" rid="CR67">67</xref>]. All those experiments were carried out according to the guidelines of the European Communities Council Directive and approved by the Istituto Italiano di Tecnologia (IIT) Animal Health Regulatory Committee and by the National Council on Animal Care of the Italian Ministry of Health (authorization #34/2015-PR). Data analysed in the present work come from a total of 26 animals (both sexes). Full details on procedures and ethical approvals are reported in [<xref ref-type="bibr" rid="CR38">38</xref>].</p>
    </notes>
    <notes id="FPar2">
      <title>Consent for publication</title>
      <p id="Par74">Not Applicable.</p>
    </notes>
    <notes id="FPar3" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par75">The authors declare that they have no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Carrillo-Reid</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Akrouh</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Yuste</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Controlling visually guided behavior by holographic recalling of cortical ensembles</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>178</volume>
        <issue>2</issue>
        <fpage>447</fpage>
        <lpage>457 e445</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.045</pub-id>
        <pub-id pub-id-type="pmid">31257030</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Carrillo-Reid</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Bando</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Peterka</surname>
            <given-names>DS</given-names>
          </name>
          <name>
            <surname>Yuste</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Imprinting and recalling cortical ensembles</article-title>
        <source>Science</source>
        <year>2016</year>
        <volume>353</volume>
        <issue>6300</issue>
        <fpage>691</fpage>
        <lpage>694</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aaf7560</pub-id>
        <pub-id pub-id-type="pmid">27516599</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Onken</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>JK</given-names>
          </name>
          <name>
            <surname>Karunasekara</surname>
            <given-names>PP</given-names>
          </name>
          <name>
            <surname>Delis</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Gollisch</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Panzeri</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Using matrix and tensor factorizations for the single-trial analysis of population spike trains</article-title>
        <source>PLoS Comput Biol</source>
        <year>2016</year>
        <volume>12</volume>
        <issue>11</issue>
        <fpage>e1005189</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1005189</pub-id>
        <pub-id pub-id-type="pmid">27814363</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spors</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Grinvald</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatio-temporal dynamics of odor representations in the mammalian olfactory bulb</article-title>
        <source>Neuron</source>
        <year>2002</year>
        <volume>34</volume>
        <issue>2</issue>
        <fpage>301</fpage>
        <lpage>315</lpage>
        <pub-id pub-id-type="doi">10.1016/s0896-6273(02)00644-x</pub-id>
        <pub-id pub-id-type="pmid">11970871</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grinvald</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Petersen</surname>
            <given-names>CC</given-names>
          </name>
        </person-group>
        <article-title>Imaging the dynamics of neocortical population activity in behaving and freely moving mammals</article-title>
        <source>Adv Exp Med Biol</source>
        <year>2015</year>
        <volume>859</volume>
        <fpage>273</fpage>
        <lpage>296</lpage>
        <pub-id pub-id-type="doi">10.1007/978-3-319-17641-3_11</pub-id>
        <pub-id pub-id-type="pmid">26238057</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gutig</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Gollisch</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Sompolinsky</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Meister</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Computing complex visual features with retinal spike times</article-title>
        <source>PLoS ONE</source>
        <year>2013</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>e53063</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0053063</pub-id>
        <pub-id pub-id-type="pmid">23301021</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zuo</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Safaai</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Notaro</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Mazzoni</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Panzeri</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Diamond</surname>
            <given-names>ME</given-names>
          </name>
        </person-group>
        <article-title>Complementary contributions of spike timing and spike rate to perceptual decisions in rat S1 and S2 cortex</article-title>
        <source>Curr Biol</source>
        <year>2015</year>
        <volume>25</volume>
        <issue>3</issue>
        <fpage>357</fpage>
        <lpage>363</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cub.2014.11.065</pub-id>
        <pub-id pub-id-type="pmid">25619766</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>DeWeese</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Otazu</surname>
            <given-names>GH</given-names>
          </name>
          <name>
            <surname>Zador</surname>
            <given-names>AM</given-names>
          </name>
        </person-group>
        <article-title>Millisecond-scale differences in neural activity in auditory cortex can drive decisions</article-title>
        <source>Nat Neurosci</source>
        <year>2008</year>
        <volume>11</volume>
        <issue>11</issue>
        <fpage>1262</fpage>
        <lpage>1263</lpage>
        <pub-id pub-id-type="doi">10.1038/nn.2211</pub-id>
        <pub-id pub-id-type="pmid">18849984</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Engineer</surname>
            <given-names>CT</given-names>
          </name>
          <name>
            <surname>Perez</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>YH</given-names>
          </name>
          <name>
            <surname>Carraway</surname>
            <given-names>RS</given-names>
          </name>
          <name>
            <surname>Reed</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Shetake</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Jakkamsetti</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Chang</surname>
            <given-names>KQ</given-names>
          </name>
          <name>
            <surname>Kilgard</surname>
            <given-names>MP</given-names>
          </name>
        </person-group>
        <article-title>Cortical activity patterns predict speech discrimination ability</article-title>
        <source>Nat Neurosci</source>
        <year>2008</year>
        <volume>11</volume>
        <issue>5</issue>
        <fpage>603</fpage>
        <lpage>608</lpage>
        <pub-id pub-id-type="doi">10.1038/nn.2109</pub-id>
        <pub-id pub-id-type="pmid">18425123</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Robinson</surname>
            <given-names>NTM</given-names>
          </name>
          <name>
            <surname>Descamps</surname>
            <given-names>LAL</given-names>
          </name>
          <name>
            <surname>Russell</surname>
            <given-names>LE</given-names>
          </name>
          <name>
            <surname>Buchholz</surname>
            <given-names>MO</given-names>
          </name>
          <name>
            <surname>Bicknell</surname>
            <given-names>BA</given-names>
          </name>
          <name>
            <surname>Antonov</surname>
            <given-names>GK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Targeted activation of hippocampal place cells drives memory-guided spatial behavior</article-title>
        <source>Cell</source>
        <year>2020</year>
        <volume>183</volume>
        <issue>7</issue>
        <fpage>2041</fpage>
        <lpage>2042</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2020.12.010</pub-id>
        <pub-id pub-id-type="pmid">33357402</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peron</surname>
            <given-names>SP</given-names>
          </name>
          <name>
            <surname>Freeman</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Iyer</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Svoboda</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>A cellular resolution map of barrel cortex activity during tactile behavior</article-title>
        <source>Neuron</source>
        <year>2015</year>
        <volume>86</volume>
        <issue>3</issue>
        <fpage>783</fpage>
        <lpage>799</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2015.03.027</pub-id>
        <pub-id pub-id-type="pmid">25913859</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aronov</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Reich</surname>
            <given-names>DS</given-names>
          </name>
          <name>
            <surname>Mechler</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Victor</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>Neural coding of spatial phase in V1 of the macaque monkey</article-title>
        <source>J Neurophysiol</source>
        <year>2003</year>
        <volume>89</volume>
        <issue>6</issue>
        <fpage>3304</fpage>
        <lpage>3327</lpage>
        <pub-id pub-id-type="doi">10.1152/jn.00826.2002</pub-id>
        <pub-id pub-id-type="pmid">12612048</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ince</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Panzeri</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kayser</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Neural codes formed by small and temporally precise populations in auditory cortex</article-title>
        <source>J Neurosci</source>
        <year>2013</year>
        <volume>33</volume>
        <issue>46</issue>
        <fpage>18277</fpage>
        <lpage>18287</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.2631-13.2013</pub-id>
        <pub-id pub-id-type="pmid">24227737</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gollisch</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Meister</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Rapid neural coding in the retina with relative spike latencies</article-title>
        <source>Science</source>
        <year>2008</year>
        <volume>319</volume>
        <issue>5866</issue>
        <fpage>1108</fpage>
        <lpage>1111</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1149639</pub-id>
        <pub-id pub-id-type="pmid">18292344</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Houweling</surname>
            <given-names>AR</given-names>
          </name>
          <name>
            <surname>Brecht</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Behavioural report of single neuron stimulation in somatosensory cortex</article-title>
        <source>Nature</source>
        <year>2008</year>
        <volume>451</volume>
        <issue>7174</issue>
        <fpage>65</fpage>
        <lpage>68</lpage>
        <pub-id pub-id-type="doi">10.1038/nature06447</pub-id>
        <pub-id pub-id-type="pmid">18094684</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gill</surname>
            <given-names>JV</given-names>
          </name>
          <name>
            <surname>Lerman</surname>
            <given-names>GM</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Stetler</surname>
            <given-names>BJ</given-names>
          </name>
          <name>
            <surname>Rinberg</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Shoham</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Precise holographic manipulation of olfactory circuits reveals coding features determining perceptual detection</article-title>
        <source>Neuron</source>
        <year>2020</year>
        <volume>108</volume>
        <issue>2</issue>
        <fpage>382</fpage>
        <lpage>393 e385</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2020.07.034</pub-id>
        <pub-id pub-id-type="pmid">32841590</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Valente</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pica</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Bondanelli</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Moroni</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Runyan</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Morcos</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Harvey</surname>
            <given-names>CD</given-names>
          </name>
          <name>
            <surname>Panzeri</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Correlations enhance the behavioral readout of neural population activity in association cortex</article-title>
        <source>Nat Neurosci</source>
        <year>2021</year>
        <volume>24</volume>
        <issue>7</issue>
        <fpage>975</fpage>
        <lpage>986</lpage>
        <pub-id pub-id-type="doi">10.1038/s41593-021-00845-1</pub-id>
        <pub-id pub-id-type="pmid">33986549</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ni</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Ruff</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Alberts</surname>
            <given-names>JJ</given-names>
          </name>
          <name>
            <surname>Symmonds</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cohen</surname>
            <given-names>MR</given-names>
          </name>
        </person-group>
        <article-title>Learning and attention reveal a general relationship between population activity and behavior</article-title>
        <source>Science</source>
        <year>2018</year>
        <volume>359</volume>
        <issue>6374</issue>
        <fpage>463</fpage>
        <lpage>465</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aao0284</pub-id>
        <pub-id pub-id-type="pmid">29371470</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Panzeri</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Moroni</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Safaai</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Harvey</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>The structures and functions of correlations in neural population codes</article-title>
        <source>Nat Rev Neurosci</source>
        <year>2022</year>
        <pub-id pub-id-type="doi">10.1038/s41583-022-00606-4</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Froudarakis</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Berens</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Ecker</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Cotton</surname>
            <given-names>RJ</given-names>
          </name>
          <name>
            <surname>Sinz</surname>
            <given-names>FH</given-names>
          </name>
          <name>
            <surname>Yatsenko</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Saggau</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Bethge</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Tolias</surname>
            <given-names>AS</given-names>
          </name>
        </person-group>
        <article-title>Population code in mouse V1 facilitates readout of natural scenes through increased sparseness</article-title>
        <source>Nat Neurosci</source>
        <year>2014</year>
        <volume>17</volume>
        <issue>6</issue>
        <fpage>851</fpage>
        <lpage>857</lpage>
        <pub-id pub-id-type="doi">10.1038/nn.3707</pub-id>
        <pub-id pub-id-type="pmid">24747577</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chong</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Moroni</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Shoham</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Panzeri</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rinberg</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Manipulating synthetic optogenetic odors reveals the coding logic of olfactory perception</article-title>
        <source>Science</source>
        <year>2020</year>
        <volume>368</volume>
        <issue>6497</issue>
        <fpage>eaba2357</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aba2357</pub-id>
        <pub-id pub-id-type="pmid">32554567</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chettih</surname>
            <given-names>SN</given-names>
          </name>
          <name>
            <surname>Harvey</surname>
            <given-names>CD</given-names>
          </name>
        </person-group>
        <article-title>Single-neuron perturbations reveal feature-specific competition in V1</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>567</volume>
        <issue>7748</issue>
        <fpage>334</fpage>
        <lpage>340</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-0997-6</pub-id>
        <pub-id pub-id-type="pmid">30842660</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rumyantsev</surname>
            <given-names>OI</given-names>
          </name>
          <name>
            <surname>Lecoq</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Hernandez</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Savall</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chrapkiewicz</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fundamental bounds on the fidelity of sensory cortical coding</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>580</volume>
        <issue>7801</issue>
        <fpage>100</fpage>
        <lpage>105</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-020-2130-2</pub-id>
        <pub-id pub-id-type="pmid">32238928</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kafashan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Jaffe</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>Chettih</surname>
            <given-names>SN</given-names>
          </name>
          <name>
            <surname>Nogueira</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Arandia-Romero</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Harvey</surname>
            <given-names>CD</given-names>
          </name>
          <name>
            <surname>Moreno-Bote</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Drugowitsch</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Scaling of sensory information in large neural populations shows signatures of information-limiting correlations</article-title>
        <source>Nat Commun</source>
        <year>2021</year>
        <volume>12</volume>
        <issue>1</issue>
        <fpage>473</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-20722-y</pub-id>
        <pub-id pub-id-type="pmid">33473113</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qiang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Artoni</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Seo</surname>
            <given-names>KJ</given-names>
          </name>
          <name>
            <surname>Culaclii</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hogan</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Zhao</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transparent arrays of bilayer-nanomesh microelectrodes for simultaneous electrophysiology and two-photon imaging in the brain</article-title>
        <source>Sci Adv</source>
        <year>2018</year>
        <volume>4</volume>
        <issue>9</issue>
        <fpage>eaat0626</fpage>
        <pub-id pub-id-type="doi">10.1126/sciadv.aat0626</pub-id>
        <pub-id pub-id-type="pmid">30191176</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grienberger</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Konnerth</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Imaging calcium in neurons</article-title>
        <source>Neuron</source>
        <year>2012</year>
        <volume>73</volume>
        <issue>5</issue>
        <fpage>862</fpage>
        <lpage>885</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2012.02.011</pub-id>
        <pub-id pub-id-type="pmid">22405199</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Helmchen</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Denk</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Deep tissue two-photon microscopy</article-title>
        <source>Nat Methods</source>
        <year>2005</year>
        <volume>2</volume>
        <issue>12</issue>
        <fpage>932</fpage>
        <lpage>940</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth818</pub-id>
        <pub-id pub-id-type="pmid">16299478</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stringer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Pachitariu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Steinmetz</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Reddy</surname>
            <given-names>CB</given-names>
          </name>
          <name>
            <surname>Carandini</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Harris</surname>
            <given-names>KD</given-names>
          </name>
        </person-group>
        <article-title>Spontaneous behaviors drive multidimensional, brainwide activity</article-title>
        <source>Science</source>
        <year>2019</year>
        <volume>364</volume>
        <issue>6437</issue>
        <fpage>255</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aav7893</pub-id>
        <pub-id pub-id-type="pmid">31000656</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weisenburger</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Tejera</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Demas</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Manley</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Sparks</surname>
            <given-names>FT</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Volumetric Ca(2+) imaging in the mouse brain using hybrid multiplexed sculpted light microscopy</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <issue>4</issue>
        <fpage>1050</fpage>
        <lpage>1066 e1014</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.03.011</pub-id>
        <pub-id pub-id-type="pmid">30982596</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kerr</surname>
            <given-names>JN</given-names>
          </name>
          <name>
            <surname>de Kock</surname>
            <given-names>CP</given-names>
          </name>
          <name>
            <surname>Greenberg</surname>
            <given-names>DS</given-names>
          </name>
          <name>
            <surname>Bruno</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Sakmann</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Helmchen</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Spatial organization of neuronal population responses in layer 2/3 of rat barrel cortex</article-title>
        <source>J Neurosci</source>
        <year>2007</year>
        <volume>27</volume>
        <issue>48</issue>
        <fpage>13316</fpage>
        <lpage>13328</lpage>
        <pub-id pub-id-type="doi">10.1523/JNEUROSCI.2210-07.2007</pub-id>
        <pub-id pub-id-type="pmid">18045926</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>TW</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Daie</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Svoboda</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>A map of anticipatory activity in mouse motor cortex</article-title>
        <source>Neuron</source>
        <year>2017</year>
        <volume>94</volume>
        <issue>4</issue>
        <fpage>866</fpage>
        <lpage>879 e864</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2017.05.005</pub-id>
        <pub-id pub-id-type="pmid">28521137</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kwon</surname>
            <given-names>SE</given-names>
          </name>
          <name>
            <surname>Tsytsarev</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Erzurumlu</surname>
            <given-names>RS</given-names>
          </name>
          <name>
            <surname>O'Connor</surname>
            <given-names>DH</given-names>
          </name>
        </person-group>
        <article-title>Organization of orientation-specific whisker deflection responses in layer 2/3 of mouse somatosensory cortex</article-title>
        <source>Neuroscience</source>
        <year>2018</year>
        <volume>368</volume>
        <fpage>46</fpage>
        <lpage>56</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuroscience.2017.07.067</pub-id>
        <pub-id pub-id-type="pmid">28827090</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Driscoll</surname>
            <given-names>LN</given-names>
          </name>
          <name>
            <surname>Pettit</surname>
            <given-names>NL</given-names>
          </name>
          <name>
            <surname>Minderer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Chettih</surname>
            <given-names>SN</given-names>
          </name>
          <name>
            <surname>Harvey</surname>
            <given-names>CD</given-names>
          </name>
        </person-group>
        <article-title>Dynamic Reorganization of Neuronal Activity Patterns in Parietal Cortex</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>170</volume>
        <issue>5</issue>
        <fpage>986</fpage>
        <lpage>999 e916</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2017.07.021</pub-id>
        <pub-id pub-id-type="pmid">28823559</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Harris</surname>
            <given-names>KD</given-names>
          </name>
          <name>
            <surname>Quiroga</surname>
            <given-names>RQ</given-names>
          </name>
          <name>
            <surname>Freeman</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Smith</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Improving data quality in neuronal population recordings</article-title>
        <source>Nat Neurosci</source>
        <year>2016</year>
        <volume>19</volume>
        <issue>9</issue>
        <fpage>1165</fpage>
        <lpage>1174</lpage>
        <pub-id pub-id-type="doi">10.1038/nn.4365</pub-id>
        <pub-id pub-id-type="pmid">27571195</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schultz</surname>
            <given-names>SR</given-names>
          </name>
          <name>
            <surname>Copeland</surname>
            <given-names>CS</given-names>
          </name>
          <name>
            <surname>Foust</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Quicke</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Schuck</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Advances in two photon scanning and scanless microscopy technologies for functional neural circuit imaging</article-title>
        <source>Proc IEEE Inst Electr Electron Eng</source>
        <year>2017</year>
        <volume>105</volume>
        <issue>1</issue>
        <fpage>139</fpage>
        <lpage>157</lpage>
        <pub-id pub-id-type="doi">10.1109/JPROC.2016.2577380</pub-id>
        <pub-id pub-id-type="pmid">28757657</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>TW</given-names>
          </name>
          <name>
            <surname>Wardill</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Pulver</surname>
            <given-names>SR</given-names>
          </name>
          <name>
            <surname>Renninger</surname>
            <given-names>SL</given-names>
          </name>
          <name>
            <surname>Baohan</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ultrasensitive fluorescent proteins for imaging neuronal activity</article-title>
        <source>Nature</source>
        <year>2013</year>
        <volume>499</volume>
        <issue>7458</issue>
        <fpage>295</fpage>
        <lpage>300</lpage>
        <pub-id pub-id-type="doi">10.1038/nature12354</pub-id>
        <pub-id pub-id-type="pmid">23868258</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Ledochowitsch</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Knoblich</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Lecoq</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Murphy</surname>
            <given-names>GJ</given-names>
          </name>
          <name>
            <surname>Reid</surname>
            <given-names>RC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Relationship between simultaneously recorded spiking activity and fluorescence signal in GCaMP6 transgenic mice</article-title>
        <source>Elife</source>
        <year>2021</year>
        <pub-id pub-id-type="doi">10.7554/eLife.51675</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brondi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Moroni</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vecchia</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Molano-Mazon</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Panzeri</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Fellin</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>High-accuracy detection of neuronal ensemble activity in two-photon functional microscopy using smart line scanning</article-title>
        <source>Cell Rep</source>
        <year>2020</year>
        <volume>30</volume>
        <issue>8</issue>
        <fpage>2567</fpage>
        <lpage>2580 e2566</lpage>
        <pub-id pub-id-type="doi">10.1016/j.celrep.2020.01.105</pub-id>
        <pub-id pub-id-type="pmid">32101736</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Valmianski</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Shih</surname>
            <given-names>AY</given-names>
          </name>
          <name>
            <surname>Driscoll</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Matthews</surname>
            <given-names>DW</given-names>
          </name>
          <name>
            <surname>Freund</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Kleinfeld</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Automatic identification of fluorescently labeled brain cells for rapid functional imaging</article-title>
        <source>J Neurophysiol</source>
        <year>2010</year>
        <volume>104</volume>
        <issue>3</issue>
        <fpage>1803</fpage>
        <lpage>1811</lpage>
        <pub-id pub-id-type="doi">10.1152/jn.00484.2010</pub-id>
        <pub-id pub-id-type="pmid">20610792</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sadovsky</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Kruskal</surname>
            <given-names>PB</given-names>
          </name>
          <name>
            <surname>Kimmel</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Ostmeyer</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Neubauer</surname>
            <given-names>FB</given-names>
          </name>
          <name>
            <surname>MacLean</surname>
            <given-names>JN</given-names>
          </name>
        </person-group>
        <article-title>Heuristically optimal path scanning for high-speed multiphoton circuit imaging</article-title>
        <source>J Neurophysiol</source>
        <year>2011</year>
        <volume>106</volume>
        <issue>3</issue>
        <fpage>1591</fpage>
        <lpage>1598</lpage>
        <pub-id pub-id-type="doi">10.1152/jn.00334.2011</pub-id>
        <pub-id pub-id-type="pmid">21715667</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dombeck</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Khabbaz</surname>
            <given-names>AN</given-names>
          </name>
          <name>
            <surname>Collman</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Adelman</surname>
            <given-names>TL</given-names>
          </name>
          <name>
            <surname>Tank</surname>
            <given-names>DW</given-names>
          </name>
        </person-group>
        <article-title>Imaging large-scale neural activity with cellular resolution in awake, mobile mice</article-title>
        <source>Neuron</source>
        <year>2007</year>
        <volume>56</volume>
        <issue>1</issue>
        <fpage>43</fpage>
        <lpage>57</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2007.08.003</pub-id>
        <pub-id pub-id-type="pmid">17920014</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guizar-Sicairos</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Thurman</surname>
            <given-names>ST</given-names>
          </name>
          <name>
            <surname>Fienup</surname>
            <given-names>JR</given-names>
          </name>
        </person-group>
        <article-title>Efficient subpixel image registration algorithms</article-title>
        <source>Opt Lett</source>
        <year>2008</year>
        <volume>33</volume>
        <issue>2</issue>
        <fpage>156</fpage>
        <lpage>158</lpage>
        <pub-id pub-id-type="doi">10.1364/ol.33.000156</pub-id>
        <pub-id pub-id-type="pmid">18197224</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Greenberg</surname>
            <given-names>DS</given-names>
          </name>
          <name>
            <surname>Kerr</surname>
            <given-names>JN</given-names>
          </name>
        </person-group>
        <article-title>Automated correction of fast motion artifacts for two-photon imaging of awake animals</article-title>
        <source>J Neurosci Methods</source>
        <year>2009</year>
        <volume>176</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>15</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jneumeth.2008.08.020</pub-id>
        <pub-id pub-id-type="pmid">18789968</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pnevmatikakis</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Giovannucci</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>NoRMCorre: An online algorithm for piecewise rigid motion correction of calcium imaging data</article-title>
        <source>J Neurosci Methods</source>
        <year>2017</year>
        <volume>291</volume>
        <fpage>83</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jneumeth.2017.07.031</pub-id>
        <pub-id pub-id-type="pmid">28782629</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dubbs</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Guevara</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Yuste</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>moco: fast motion correction for calcium imaging</article-title>
        <source>Front Neuroinform</source>
        <year>2016</year>
        <volume>10</volume>
        <fpage>6</fpage>
        <pub-id pub-id-type="doi">10.3389/fninf.2016.00006</pub-id>
        <pub-id pub-id-type="pmid">26909035</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mukamel</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Nimmerjahn</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Schnitzer</surname>
            <given-names>MJ</given-names>
          </name>
        </person-group>
        <article-title>Automated analysis of cellular signals from large-scale calcium imaging data</article-title>
        <source>Neuron</source>
        <year>2009</year>
        <volume>63</volume>
        <issue>6</issue>
        <fpage>747</fpage>
        <lpage>760</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2009.08.009</pub-id>
        <pub-id pub-id-type="pmid">19778505</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <mixed-citation publication-type="other">Pachitariu M, Packer A, Pettit N, Dagleish H, Hausser M, Sahani M. (2013). Extracting regions of interest from biological images with convolutional sparse block coding. In: Proceedings of the 26th international conference on neural information processing systems—vol 2 (pp. 1745–1753). Lake Tahoe, Nevada: Curran Associates Inc.</mixed-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kaifosh</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Zaremba</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Danielson</surname>
            <given-names>NB</given-names>
          </name>
          <name>
            <surname>Losonczy</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>SIMA: Python software for analysis of dynamic fluorescence imaging data</article-title>
        <source>Front Neuroinform</source>
        <year>2014</year>
        <volume>8</volume>
        <fpage>80</fpage>
        <pub-id pub-id-type="doi">10.3389/fninf.2014.00080</pub-id>
        <pub-id pub-id-type="pmid">25295002</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maruyama</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Maeda</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Moroda</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Kato</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Inoue</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Miyakawa</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Aonishi</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Detecting cells using non-negative matrix factorization on calcium imaging data</article-title>
        <source>Neural Netw</source>
        <year>2014</year>
        <volume>55</volume>
        <fpage>11</fpage>
        <lpage>19</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neunet.2014.03.007</pub-id>
        <pub-id pub-id-type="pmid">24705544</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pnevmatikakis</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Soudry</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Machado</surname>
            <given-names>TA</given-names>
          </name>
          <name>
            <surname>Merel</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Pfau</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Simultaneous denoising, deconvolution, and demixing of calcium imaging data</article-title>
        <source>Neuron</source>
        <year>2016</year>
        <volume>89</volume>
        <issue>2</issue>
        <fpage>285</fpage>
        <lpage>299</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2015.11.037</pub-id>
        <pub-id pub-id-type="pmid">26774160</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reynolds</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Abrahamsson</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Schuck</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sjostrom</surname>
            <given-names>PJ</given-names>
          </name>
          <name>
            <surname>Schultz</surname>
            <given-names>SR</given-names>
          </name>
          <name>
            <surname>Dragotti</surname>
            <given-names>PL</given-names>
          </name>
        </person-group>
        <article-title>ABLE: an activity-based level set segmentation algorithm for two-photon calcium imaging data</article-title>
        <source>eNeuro</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1523/ENEURO.0012-17.2017</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Soltanian-Zadeh</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Sahingur</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Blau</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Gong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Farsiu</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Fast and robust active neuron segmentation in two-photon calcium imaging using spatiotemporal deep learning</article-title>
        <source>Proc Natl Acad Sci U S A</source>
        <year>2019</year>
        <volume>116</volume>
        <issue>17</issue>
        <fpage>8554</fpage>
        <lpage>8563</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1812995116</pub-id>
        <pub-id pub-id-type="pmid">30975747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Spaen</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Asin-Acha</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Chettih</surname>
            <given-names>SN</given-names>
          </name>
          <name>
            <surname>Minderer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Harvey</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Hochbaum</surname>
            <given-names>DS</given-names>
          </name>
        </person-group>
        <article-title>HNCcorr: a novel combinatorial approach for cell identification in calcium-imaging movies</article-title>
        <source>Neuro</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.1523/ENEURO.0304-18.2019</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bao</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Soltanian-Zadeh</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Farsiu</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Gong</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Segmentation of neurons from fluorescence calcium recordings beyond real-time</article-title>
        <source>Nat Mach Intell</source>
        <year>2021</year>
        <volume>3</volume>
        <issue>7</issue>
        <fpage>590</fpage>
        <lpage>600</lpage>
        <pub-id pub-id-type="doi">10.1038/s42256-021-00342-x</pub-id>
        <pub-id pub-id-type="pmid">34485824</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Keemink</surname>
            <given-names>SW</given-names>
          </name>
          <name>
            <surname>Lowe</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Pakan</surname>
            <given-names>JMP</given-names>
          </name>
          <name>
            <surname>Dylda</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>van Rossum</surname>
            <given-names>MCW</given-names>
          </name>
          <name>
            <surname>Rochefort</surname>
            <given-names>NL</given-names>
          </name>
        </person-group>
        <article-title>FISSA: a neuropil decontamination toolbox for calcium imaging signals</article-title>
        <source>Sci Rep</source>
        <year>2018</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>3493</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-018-21640-2</pub-id>
        <pub-id pub-id-type="pmid">29472547</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bao</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Redington</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Agarwal</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Gong</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Decontaminate traces from fluorescence calcium imaging videos using targeted non-negative matrix factorization</article-title>
        <source>Front Neurosci</source>
        <year>2021</year>
        <volume>15</volume>
        <fpage>797421</fpage>
        <pub-id pub-id-type="doi">10.3389/fnins.2021.797421</pub-id>
        <pub-id pub-id-type="pmid">35126042</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Deneux</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Kaszas</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Szalay</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Katona</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Lakner</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Grinvald</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Rozsa</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Vanzetta</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Accurate spike estimation from noisy calcium signals for ultrafast three-dimensional imaging of large neuronal populations in vivo</article-title>
        <source>Nat Commun</source>
        <year>2016</year>
        <volume>7</volume>
        <fpage>12190</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms12190</pub-id>
        <pub-id pub-id-type="pmid">27432255</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Theis</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Berens</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Froudarakis</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Reimer</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Roman Roson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Baden</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Euler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Tolias</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Bethge</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Benchmarking spike rate inference in population calcium imaging</article-title>
        <source>Neuron</source>
        <year>2016</year>
        <volume>90</volume>
        <issue>3</issue>
        <fpage>471</fpage>
        <lpage>482</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2016.04.014</pub-id>
        <pub-id pub-id-type="pmid">27151639</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Friedrich</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Paninski</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Fast online deconvolution of calcium imaging data</article-title>
        <source>PLoS Comput Biol</source>
        <year>2017</year>
        <volume>13</volume>
        <issue>3</issue>
        <fpage>e1005423</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1005423</pub-id>
        <pub-id pub-id-type="pmid">28291787</pub-id>
      </element-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vogelstein</surname>
            <given-names>JT</given-names>
          </name>
          <name>
            <surname>Packer</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Machado</surname>
            <given-names>TA</given-names>
          </name>
          <name>
            <surname>Sippy</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Babadi</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Yuste</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Paninski</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Fast nonnegative deconvolution for spike train inference from population calcium imaging</article-title>
        <source>J Neurophysiol</source>
        <year>2010</year>
        <volume>104</volume>
        <issue>6</issue>
        <fpage>3691</fpage>
        <lpage>3704</lpage>
        <pub-id pub-id-type="doi">10.1152/jn.01073.2009</pub-id>
        <pub-id pub-id-type="pmid">20554834</pub-id>
      </element-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cantu</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Gongwer</surname>
            <given-names>MW</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>CX</given-names>
          </name>
          <name>
            <surname>Goel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Suresh</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>EZcalcium: open-source toolbox for analysis of calcium imaging data</article-title>
        <source>Front Neural Circuits</source>
        <year>2020</year>
        <volume>14</volume>
        <fpage>25</fpage>
        <pub-id pub-id-type="doi">10.3389/fncir.2020.00025</pub-id>
        <pub-id pub-id-type="pmid">32499682</pub-id>
      </element-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pachitariu</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Stringer</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Dipoppa</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Schröder</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Rossi</surname>
            <given-names>LF</given-names>
          </name>
          <name>
            <surname>Dalgleish</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Carandini</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Harris</surname>
            <given-names>KD</given-names>
          </name>
        </person-group>
        <article-title>Suite2p: beyond 10000 neurons with standard two-photon microscopy</article-title>
        <source>bioRxiv</source>
        <year>2017</year>
        <pub-id pub-id-type="doi">10.1101/061507</pub-id>
      </element-citation>
    </ref>
    <ref id="CR63">
      <label>63.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rueckl</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lenzi</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Moreno-Velasquez</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Parthier</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schmitz</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Ruediger</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Johenning</surname>
            <given-names>FW</given-names>
          </name>
        </person-group>
        <article-title>SamuROI, a python-based software tool for visualization and analysis of dynamic time series imaging at multiple spatial scales</article-title>
        <source>Front Neuroinform</source>
        <year>2017</year>
        <volume>11</volume>
        <fpage>44</fpage>
        <pub-id pub-id-type="doi">10.3389/fninf.2017.00044</pub-id>
        <pub-id pub-id-type="pmid">28706482</pub-id>
      </element-citation>
    </ref>
    <ref id="CR64">
      <label>64.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Giovannucci</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Friedrich</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gunn</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Kalfon</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Brown</surname>
            <given-names>BL</given-names>
          </name>
          <name>
            <surname>Koay</surname>
            <given-names>SA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CaImAn an open source tool for scalable calcium imaging data analysis</article-title>
        <source>Elife</source>
        <year>2019</year>
        <pub-id pub-id-type="doi">10.7554/eLife.38173</pub-id>
      </element-citation>
    </ref>
    <ref id="CR65">
      <label>65.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Romano</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Perez-Schuster</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Jouary</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Boulanger-Weill</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Candeo</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Pietri</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Sumbre</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>An integrated calcium imaging processing toolbox for the analysis of neuronal population dynamics</article-title>
        <source>PLoS Comput Biol</source>
        <year>2017</year>
        <volume>13</volume>
        <issue>6</issue>
        <fpage>e1005526</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1005526</pub-id>
        <pub-id pub-id-type="pmid">28591182</pub-id>
      </element-citation>
    </ref>
    <ref id="CR66">
      <label>66.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sita</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Brondi</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>de Leon</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Roig</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Curreli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Panniello</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vecchia</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Fellin</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>A deep-learning approach for online cell identification and trace extraction in functional two-photon calcium imaging</article-title>
        <source>Nat Commun</source>
        <year>2022</year>
        <volume>13</volume>
        <issue>1</issue>
        <fpage>1529</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-022-29180-0</pub-id>
        <pub-id pub-id-type="pmid">35318335</pub-id>
      </element-citation>
    </ref>
    <ref id="CR67">
      <label>67.</label>
      <mixed-citation publication-type="other">Brondi M, Moroni M, Panzeri S, Fellin T. (2021) Recordings of mice layer IV barrel cortex activity using two-photon functional microscopy and Smart Line Scanning. doi:10.25493/74DX-JVC. <ext-link ext-link-type="uri" xlink:href="https://search.kg.ebrains.eu/instances/Dataset/424f8f13-9d5f-41ac-a225-ba4c8517f19e">https://search.kg.ebrains.eu/instances/Dataset/424f8f13-9d5f-41ac-a225-ba4c8517f19e</ext-link></mixed-citation>
    </ref>
    <ref id="CR68">
      <label>68.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schindelin</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Arganda-Carreras</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Frise</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Kaynig</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Longair</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Pietzsch</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fiji: an open-source platform for biological-image analysis</article-title>
        <source>Nat Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <issue>7</issue>
        <fpage>676</fpage>
        <lpage>682</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2019</pub-id>
        <pub-id pub-id-type="pmid">22743772</pub-id>
      </element-citation>
    </ref>
    <ref id="CR69">
      <label>69.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schneider</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Rasband</surname>
            <given-names>WS</given-names>
          </name>
          <name>
            <surname>Eliceiri</surname>
            <given-names>KW</given-names>
          </name>
        </person-group>
        <article-title>NIH Image to ImageJ: 25 years of image analysis</article-title>
        <source>Nat Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <issue>7</issue>
        <fpage>671</fpage>
        <lpage>675</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2089</pub-id>
        <pub-id pub-id-type="pmid">22930834</pub-id>
      </element-citation>
    </ref>
    <ref id="CR70">
      <label>70.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pologruto</surname>
            <given-names>TA</given-names>
          </name>
          <name>
            <surname>Sabatini</surname>
            <given-names>BL</given-names>
          </name>
          <name>
            <surname>Svoboda</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>ScanImage: flexible software for operating laser scanning microscopes</article-title>
        <source>Biomed Eng Online</source>
        <year>2003</year>
        <volume>2</volume>
        <fpage>13</fpage>
        <pub-id pub-id-type="doi">10.1186/1475-925X-2-13</pub-id>
        <pub-id pub-id-type="pmid">12801419</pub-id>
      </element-citation>
    </ref>
    <ref id="CR71">
      <label>71.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Muir</surname>
            <given-names>DR</given-names>
          </name>
          <name>
            <surname>Kampa</surname>
            <given-names>BM</given-names>
          </name>
        </person-group>
        <article-title>FocusStack and StimServer: a new open source MATLAB toolchain for visual stimulation and analysis of two-photon calcium neuronal imaging data</article-title>
        <source>Front Neuroinform</source>
        <year>2014</year>
        <volume>8</volume>
        <fpage>85</fpage>
        <pub-id pub-id-type="doi">10.3389/fninf.2014.00085</pub-id>
        <pub-id pub-id-type="pmid">25653614</pub-id>
      </element-citation>
    </ref>
    <ref id="CR72">
      <label>72.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Potvin</surname>
            <given-names>J-Y</given-names>
          </name>
        </person-group>
        <article-title>Genetic algorithms for the traveling salesman problem</article-title>
        <source>Ann Oper Res</source>
        <year>1996</year>
        <volume>63</volume>
        <issue>3</issue>
        <fpage>337</fpage>
        <lpage>370</lpage>
        <pub-id pub-id-type="doi">10.1007/BF02125403</pub-id>
      </element-citation>
    </ref>
    <ref id="CR73">
      <label>73.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>JF</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Smirnakis</surname>
            <given-names>SM</given-names>
          </name>
        </person-group>
        <article-title>Visually driven neuropil activity and information encoding in mouse primary visual cortex</article-title>
        <source>Front Neural Circuits</source>
        <year>2017</year>
        <volume>11</volume>
        <fpage>50</fpage>
        <pub-id pub-id-type="doi">10.3389/fncir.2017.00050</pub-id>
        <pub-id pub-id-type="pmid">28785207</pub-id>
      </element-citation>
    </ref>
    <ref id="CR74">
      <label>74.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dana</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Mohar</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Hulse</surname>
            <given-names>BK</given-names>
          </name>
          <name>
            <surname>Kerlin</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Hasseman</surname>
            <given-names>JP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-performance calcium sensors for imaging activity in neuronal populations and microcompartments</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <issue>7</issue>
        <fpage>649</fpage>
        <lpage>657</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0435-6</pub-id>
        <pub-id pub-id-type="pmid">31209382</pub-id>
      </element-citation>
    </ref>
    <ref id="CR75">
      <label>75.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mahmud</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kaiser</surname>
            <given-names>MS</given-names>
          </name>
          <name>
            <surname>Hussain</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Vassanelli</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Applications of deep learning and reinforcement learning to biological data</article-title>
        <source>IEEE Trans Neural Netw Learn Syst</source>
        <year>2018</year>
        <volume>29</volume>
        <issue>6</issue>
        <fpage>2063</fpage>
        <lpage>2079</lpage>
        <pub-id pub-id-type="doi">10.1109/TNNLS.2018.2790388</pub-id>
        <pub-id pub-id-type="pmid">29771663</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
