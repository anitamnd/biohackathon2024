<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Genomics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Genomics</journal-id>
    <journal-title-group>
      <journal-title>BMC Genomics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2164</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7751095</article-id>
    <article-id pub-id-type="publisher-id">6875</article-id>
    <article-id pub-id-type="doi">10.1186/s12864-020-06875-6</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>MegaPath: sensitive and rapid pathogen detection using metagenomic NGS data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes">
        <name>
          <surname>Leung</surname>
          <given-names>Chi-Ming</given-names>
        </name>
        <address>
          <email>cmleung2@cs.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Li</surname>
          <given-names>Dinghua</given-names>
        </name>
        <address>
          <email>dhli@cs.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Xin</surname>
          <given-names>Yan</given-names>
        </name>
        <address>
          <email>yxin@cs.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Law</surname>
          <given-names>Wai-Chun</given-names>
        </name>
        <address>
          <email>chunlaw@l3-bioinfo.com</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhang</surname>
          <given-names>Yifan</given-names>
        </name>
        <address>
          <email>yfzhang@cs.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ting</surname>
          <given-names>Hing-Fung</given-names>
        </name>
        <address>
          <email>hfting@cs.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Luo</surname>
          <given-names>Ruibang</given-names>
        </name>
        <address>
          <email>rbluo@cs.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lam</surname>
          <given-names>Tak-Wah</given-names>
        </name>
        <address>
          <email>twlam@cs.hku.hk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.194645.b</institution-id><institution-id institution-id-type="ISNI">0000000121742757</institution-id><institution>Department of Computer Science, </institution><institution>The University of Hong Kong, </institution></institution-wrap>Pokfulam Road, Hong Kong, Hong Kong </aff>
      <aff id="Aff2"><label>2</label>L3 Bioinformatics Limited, Rm 2114, Hong Kong Plaza, 188 Connaught Road West, Sai Ying Pun, Hong Kong </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>21</day>
      <month>12</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>21</day>
      <month>12</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2020</year>
    </pub-date>
    <volume>21</volume>
    <issue>Suppl 6</issue>
    <issue-sponsor>Publication of this supplement has not been supported by sponsorship. Information about the source of funding for publication charges can be found in the individual articles. The articles have undergone the journal's standard peer review process for supplements. IM was co-author on two papers in the supplement but was not involved with the peer review process of these two papers. No other competing interests were declared.</issue-sponsor>
    <elocation-id>500</elocation-id>
    <history>
      <date date-type="received">
        <day>21</day>
        <month>5</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>6</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2020</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <sec>
        <title>Background</title>
        <p id="Par1">Next-generation sequencing (NGS) enables unbiased detection of pathogens by mapping the sequencing reads of a patient sample to the known reference sequence of bacteria and viruses. However, for a new pathogen without a reference sequence of a close relative, or with a high load of mutations compared to its predecessors, read mapping fails due to a low similarity between the pathogen and reference sequence, which in turn leads to insensitive and inaccurate pathogen detection outcomes.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p id="Par2">We developed MegaPath, which runs fast and provides high sensitivity in detecting new pathogens. In MegaPath, we have implemented and tested a combination of polishing techniques to remove non-informative human reads and spurious alignments. MegaPath applies a global optimization to the read alignments and reassigns the reads incorrectly aligned to multiple species to a unique species. The reassignment not only significantly increased the number of reads aligned to distant pathogens, but also significantly reduced incorrect alignments. MegaPath implements an enhanced maximum-exact-match prefix seeding strategy and a SIMD-accelerated Smith-Waterman algorithm to run fast.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p id="Par3">In our benchmarks, MegaPath demonstrated superior sensitivity by detecting eight times more reads from a low-similarity pathogen than other tools. Meanwhile, MegaPath ran much faster than the other state-of-the-art alignment-based pathogen detection tools (and compariable with the less sensitivity profile-based pathogen detection tools). The running time of MegaPath is about 20 min on a typical 1 Gb dataset.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Pathogen detection</kwd>
      <kwd>Shotgun metagenomic sequencing</kwd>
      <kwd>Next generation sequencing</kwd>
      <kwd>Abundance detection</kwd>
      <kwd>Read alignment</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>Innovative and Technology Fund</institution>
        </funding-source>
        <award-id>ITS/331/17FP</award-id>
        <principal-award-recipient>
          <name>
            <surname>Lam</surname>
            <given-names>Tak-Wah</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>General Research Fund</institution>
        </funding-source>
        <award-id>27204518</award-id>
        <award-id>17208019</award-id>
        <principal-award-recipient>
          <name>
            <surname>Ting</surname>
            <given-names>Hing-Fung</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>Ruibang</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <conference xlink:href="https://iccabs.engr.uconn.edu/">
      <conf-name>8th IEEE International Conference on Computational Advances in Bio and medical Sciences (ICCABS 2018)</conf-name>
      <conf-loc>Las Vegas, NV, USA</conf-loc>
      <conf-date>18-20 October 2018</conf-date>
    </conference>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2020</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par15">Detecting pathogens such as bacteria or viruses that cause infections such as pneumonia and meningitis is an important step in clinical diagnosis. One problem in detecting pathogens is that traditional methods of pathogen detection are time-consuming, as an infectious disease may be caused by a large range of pathogens, which have to be checked one by one. Another problem is that up to 60% of the pathogens in some infectious diseases cannot be detected [<xref ref-type="bibr" rid="CR1">1</xref>]. This can cause a delay in treatment or even mistreatment of patients.</p>
    <p id="Par16">Unbiased next-generation sequencing (NGS) can detect DNA fragments (reads) of all species in a metagenomic sample with a mixture of different species. Those NGS reads can be classified into different taxa by comparing them with a collection of reference sequences, and pathogens can be detected if some reads match them. In clinical diagnoses, it is essential that a classifier can detect a significant number of reads supporting the potential pathogens and report as few false classifications as possible to give a high abundance rank to the pathogen. Otherwise, the pathogen cannot be distinguished from background noise, and it will take doctors a long time to go through a long list of candidates to dig out its existence.</p>
    <p id="Par17">Existing metagenomic classifiers are not effective for detecting low-similarity pathogens, i.e., pathogen with a genome that is not similar to the reference. This is because most classifiers detect pathogens by constructing a characteristic profile (e.g., <italic>k</italic>-mers) for each reference and assigning reads to species by comparing them with the reference profiles [<xref ref-type="bibr" rid="CR2">2</xref>, <xref ref-type="bibr" rid="CR3">3</xref>]. When the characteristic profile does not match the genome of low-similarity pathogens, this approach fails and results in many incorrect or non-specific classifications.</p>
    <p id="Par18">Some tools assign reads to reference sequences by local or semi-global alignment. Using an alignment-based method, more reads can be assigned to the causal pathogen, but at the cost of much longer analysis time (over 4 h for a typical 1 Gb dataset). However, the alignment score of reads from a low-similarity pathogen is conceivably low, and these reads often cannot be assigned to the causal pathogen specifically, so the number of reads supporting the causal pathogen is still too low.</p>
    <p id="Par19">To detect low-similarity pathogens, we developed MegaPath for NGS-based pathogen detection. It has two significant contributions. First, instead of assigning each read to a reference sequence one by one, MegaPath analyzes all aligned reads globally to sort out a subset of reads with confident alignments. Then, MegaPath reassigns the non-specifically aligned reads to the species with confident alignments and discards spurious alignments to avoid potential false classifications. The reassignment increases the number of reads supporting the causal pathogens and reduces the number of false-positive assignments. Second, MegaPath implements a fast alignment-based approach, utilizing an enhanced maximum-exact-match prefix seeding strategy and a SIMD-accelerated Smith-Waterman algorithm.</p>
    <p id="Par20">Let us take a metagenomic NGS sample of cerebrospinal fluid [<xref ref-type="bibr" rid="CR4">4</xref>] as an example. The similarity of the pathogen to reference is 18.9%. Centrifuge [<xref ref-type="bibr" rid="CR2">2</xref>], CLARK [<xref ref-type="bibr" rid="CR5">5</xref>] and Kraken [<xref ref-type="bibr" rid="CR3">3</xref>], based on characteristic profile, detected 31, 1 and 6 reads from the pathogen, respectively. The abundance rank of the pathogen was 710, 1488 and 384, respectively. With that, a medical doctor needs to go through a list of hundreds of species to reach the causal pathogen. Kraken2 [<xref ref-type="bibr" rid="CR3">3</xref>] is the successor of Kraken that applies more sophisticated characteristic profiles. It detected 74 reads from the pathogen and the abundance rank of the pathogen went up to 176. SURPI [<xref ref-type="bibr" rid="CR6">6</xref>] spent four hours on read alignment and detected 76 reads from the pathogen, abundance rank at 264. In contrast, with better alignment tools and global analysis of reads, MegaPath took less than one hour and detected 608 reads for the pathogen, abundance rank at 33. In our experiment, MegaPath performed better than the existing tools, ran faster than the alignment-based tools and has comparable running time with the less sensitivity profile-based tools.</p>
    <p id="Par21">In addition to detecting pathogens with known reference sequences, MegaPath can detect novel pathogens without any similar DNA-level sequences in the reference database. MegaPath uses MegaHit [<xref ref-type="bibr" rid="CR7">7</xref>] to assemble the reads from the novel pathogens to longer DNA fragments. Since protein sequences are better-conserved than DNA sequences [<xref ref-type="bibr" rid="CR8">8</xref>, <xref ref-type="bibr" rid="CR9">9</xref>], these DNA contigs from novel pathogens are then annotated by DNA-protein alignment [<xref ref-type="bibr" rid="CR10">10</xref>] to detect related species, genera or families.</p>
    <sec id="Sec2">
      <title>Implementation</title>
      <p id="Par22">Figure <xref rid="Fig1" ref-type="fig">1</xref> shows the workflow of MegaPath. There are three major steps in MegaPath for detecting pathogens. First, it applies MegaGuide, an ultrafast NGS aligner specifically designed for pathogen detection to align reads to reference sequences of bacteria and viruses. Then it applies spike polishing to filter spurious alignments at highly repeated regions. Lastly, it applies a two-phase taxonomy assignment of reads.
<fig id="Fig1"><label>Fig. 1</label><caption><p>The workflow of MegaPath</p></caption><graphic xlink:href="12864_2020_6875_Fig1_HTML" id="MO1"/></fig></p>
      <sec id="Sec3">
        <title>Aligning reads with MegaGuide</title>
        <p id="Par23">MegaGuide is an ultra-fast aligner that follows a seed-and-extend procedure. In the seeding stage, MegaGuide searches for maximum-mappable seeds in the read using a BWT built from the reference sequences. The search will stop at (or a few bases after) a sequencing error or a genomic mutation. A new search will start at the end of the previous seed. The maximum-mappable seeding strategy reduces a vast number of short seeds that cannot be used to find the true alignments. The overlap between the seeds boosts sensitivity, especially for distant species. In the extension stage, MegaGuide implements an improved Smith-Waterman algorithm with each entry in the dynamic programming tables using 8 bits or less (instead of the normal implementation using 64 bits). Thus, by applying the 256-bit SIMD instructions, values of 32 entries can be calculated in parallel.</p>
        <p id="Par24">The reference database is large (the size of the latest RefSeq is over 30 Gb). It is neither efficient nor necessary to align all reads to all reference sequences. Thus, the following two types of reads, which are not informative for pathogen detection, will be filtered out from the downstream analysis. First, clinical metagenomic samples are usually dominated with human DNA (which could be as high as 95%) that carries no pathogen information. Second, short NGS reads sampled from the repetitive or homologous regions across species, e.g., ribosomal DNA, are not useful for pathogen detection. MegaPath filters out the two types of reads by aligning reads to the human reference genome and a database of homologous regions. Reads confidently aligned to the human reference genome or the homologous regions will be removed. The remaining reads will then be aligned to the pathogen genome database for pathogen detection.</p>
      </sec>
      <sec id="Sec4">
        <title>Spike polishing</title>
        <p id="Par25">Aligning reads to human genome or homologous regions can detect most of the reads that are not informative for pathogen detection. However, not all of them can be detected due to the missing annotation or the incomplete classification of all possible homologous regions. To filter out reads sampled from unknown homologous regions, MegaPath makes use of the read depth information of each genome. Since MegaGuide aligns a read to all its possible genome positions, the read depth of the homologous regions is expected to be much higher than the other regions. MegaPath calculates the mean (<italic>u</italic>) and the standard deviation (<italic>sd</italic>) of the read depth of each genome. Continuous regions with a read depth higher than <italic>u</italic> + α·<italic>sd</italic> are defined as spike regions. All alignments in the spike regions will be removed from the downstream analysis. We have tried the value of α from 1 to 100. When α &lt; 10, there are many regions misidentified as spike regions and are removed. When α &gt; 50, only a few spike regions were detected and many homologous regions remain. The filtering has the best performance for α being from 10 to 50. Thus, we select α = 30 as default.</p>
      </sec>
      <sec id="Sec5">
        <title>The two-stage taxonomy assignment algorithm</title>
        <p id="Par26">It is common that a read is aligned to different genomes with the same (or similar) confidence. These genomes may be from different species, genus, or even families. A straightforward way to assign a read to a taxon is assigning it to the lowest common ancestor (LCA) of all taxa the read aligned to. However, this approach leads to a large number of less specific assignments. MegaPath implements a two-stage assignment algorithm to increase the specificity. In the first stage, MegaPath assigns each read to the species they aligned to. We allow a read to be assigned to multiple species because the sequenced pathogen might have enriched mutations in some regions, and these regions can look very different from the correct reference genome. After assigning all the reads, in the second stage, MegaPath will try to reassign each of the shared reads to a species using the following rules.</p>
        <p id="Par27">First, all reads are assigned to one or more species according to their alignments. A read is tagged by ‘U’ if it is assigned to only one species, or ‘M’ if assigned to more than one species. Then, for each species, the numbers of ‘U’-tagged reads and the number of ‘M’-tagged reads are calculated. For a species <italic>S</italic>, we define UCount(<italic>S</italic>) as the number of ‘U’-tagged reads assigned to <italic>S</italic>, and AllCount(<italic>S</italic>) as the number of both ‘U’-tagged and ‘M’-tagged reads assigned to <italic>S</italic>. For two species <italic>S</italic> and <italic>T</italic>, we define MCount(<italic>S, T</italic>) as the number of reads assigned to both <italic>S</italic> and <italic>T</italic>. We say a species <italic>S</italic> weakly explains another species <italic>T</italic>, if 1) AllCount(<italic>S</italic>) - MCount(<italic>S, T</italic>) ≥ <italic>r</italic> * AllCount(<italic>S</italic>), and 2) UCount(<italic>T</italic>) &lt; <italic>e</italic> * UCount(<italic>S</italic>). The default values of <italic>r</italic> and <italic>e</italic> are both 0.05. Descriptively, the criteria are interpreted as, 1) reads aligned to <italic>S</italic> are likely to be correct alignments (instead of misaligning read sampled from <italic>T</italic>) if quite a number of reads (<italic>r</italic> = 5%) are not similar to <italic>T</italic>; 2) the unique reads that support <italic>T</italic> might be a coincidence (<italic>e</italic> = 5%) due sequencing error or misalignment. We say <italic>S</italic> explains <italic>T</italic> if <italic>S</italic> weakly explains <italic>T</italic> and no species weakly explains <italic>S</italic>.</p>
        <p id="Par28">In the second stage, a read assigned to both <italic>S</italic> and <italic>T</italic> will be reassigned to <italic>S</italic> only if <italic>S</italic> explains <italic>T</italic>. After reassigning all the shared reads, MegaPath will apply the LCA algorithm to determine the taxon of each read.</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec6">
    <title>Results</title>
    <p id="Par29">Real datasets with known causal pathogens detected using traditional methods were used to evaluate the performance of MegaPath, and existing pathogen detection tools including SURPI [<xref ref-type="bibr" rid="CR6">6</xref>], Centrifuge [<xref ref-type="bibr" rid="CR2">2</xref>], CLARK [<xref ref-type="bibr" rid="CR5">5</xref>], Kraken and Kraken2 [<xref ref-type="bibr" rid="CR3">3</xref>]. Centrifuge, CLARK, Kraken, and Kraken2 construct a characteristic profile for each reference sequence and detect the existence of pathogens by comparing the reads to the constructed profiles. Kraken2 rans longer but performs better than its predecessor Kraken because it constructs a more sophisticated profile. These tools ran fast, but their sensitivity is not as good as the alignment-based tools’ for detecting low-similarity pathogens. SURPI detects pathogens by aligning reads to the reference sequences. SUPRI as the slowest tool, is generally more sensitive than the profile-based tools. MegaPath, by implementing a fast alignment strategy and analyzing the read alignments globally, achieves the highest sensitivity using a reasonable amount of running time.</p>
    <p id="Par30">We evaluated the tools using three types of datasets. First, we compared the sensitivity of the tools on real metagenomic datasets with known pathogens. Second, since the abundance rank of the pathogens in the real metagenomic datasets is unknown, we evaluated the tools based on mock metagenomic datasets with known relative abundance. Last, we evaluated the sensitivity and false-positive rate of the tools on detecting pathogens with different similarity to their corresponding reference sequence using a real cultured dataset.</p>
    <sec id="Sec7">
      <title>Performance on real metagenomic datasets</title>
      <p id="Par31">Nine real metagenomic datasets [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>] were used to evaluate the sensitivity of MegaPath, SURPI [<xref ref-type="bibr" rid="CR6">6</xref>], Centrifuge [<xref ref-type="bibr" rid="CR2">2</xref>], CLARK [<xref ref-type="bibr" rid="CR5">5</xref>], Kraken and Kraken2 [<xref ref-type="bibr" rid="CR3">3</xref>] on detecting pathogens in real clinical samples. The datasets include cerebrospinal fluid, nasopharyngeal, and serum sample with the pathogen confirmed by conventional methods. Datasets 1 and 3 are two metagenomic NGS samples of cerebrospinal fluid (CSF) and nasopharyngeal (NP) swabs [<xref ref-type="bibr" rid="CR4">4</xref>]. Datasets 2, 6, and 7 are plasma samples spiked with different concentrations of HIV [<xref ref-type="bibr" rid="CR6">6</xref>]. Datasets 4, 5, 8, and 9 are HCV- or HBV-infected human livers [<xref ref-type="bibr" rid="CR11">11</xref>].</p>
      <p id="Par32">Table <xref rid="Tab1" ref-type="table">1</xref> shows the number of reads and the abundance rank of the pathogen detected by each tool, sorted in increasing order of similarity between the pathogen genome and the reference sequence. Using BLASTn [<xref ref-type="bibr" rid="CR13">13</xref>] as the aligner, the similarity is measured by the number of reads sampled from the pathogen that were aligned to the reference sequence against the number of reads sampled from the pathogen. Since the number of reads from the pathogen is unknown in the real dataset, we used those reads detected by the multiple tools as a rough estimation. Table <xref rid="Tab1" ref-type="table">1</xref> shows that when the pathogen genome is similar to the reference sequence (datasets 6 to 9), all tools performed quite well, except for dataset 7, in which the abundance of the pathogen is very low. For those datasets in which the pathogen genome is varied from the reference sequence (datasets 1 to 5), although most of the tools have detected more or less a few reads from the pathogen, the numbers were too low to tell apart the pathogen from the background noise, especially for those profile-based tools. Use dataset 1 as an example, Centrifuge, CLARK, and Kraken detected 31, 1, and 6 reads, respectively. The abundance rank of the pathogen was 710, 1488, and 384, respectively (a doctor will have to go through a list of over 300 candidate species to dig out the pathogen). Kraken2 outperformed its predecessor and detected 74 reads from the pathogen, with an abundance rank at 176. SURPI spent over four hours on read alignment and detected 76 reads for the pathogen, with an abundance rank at 264. Notably, MegaPath took less than one hour and detected 608 reads for the pathogen, with an abundance rank at 33. MegaPath performed the best among the existing tools but ran much faster than other alignment-based tools. Worth mentioning, the reference sequences of the low similarity Enterovirus D in dataset 1 and 3 were drafted and were just recently accepted to NCBI. We expect the performance of MegaPath as well as other tools will further improve using updated NCBI databases with more complete reference sequences.
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Benchmarking results of the pathogen detection tools on nine real metagenomic datasets</p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="2">Dataset</th><th rowspan="2">Pathogens</th><th rowspan="2">Similarity to reference</th><th>MegaPath</th><th>SURPI</th><th>Centrifuge</th><th>CLARK</th><th>Kraken</th><th>Kraken2</th></tr><tr><th colspan="6">rank (# read)</th></tr></thead><tbody><tr><td>1</td><td>Enterovirus D</td><td>18.9%</td><td><bold>33 (608)</bold></td><td>264 (76)</td><td>710 (31)</td><td>1.5 K (1)</td><td>384 (6)</td><td>176 (74)</td></tr><tr><td>2</td><td>Human immunodeficiency virus</td><td>19.0%</td><td><bold>15 (3.8 K)</bold></td><td>63 (1.0 K)</td><td>78 (1.3 K)</td><td>69 (444)</td><td>109 (216)</td><td>32 (1.4 K)</td></tr><tr><td>3</td><td>Enterovirus D</td><td>27.9%</td><td><bold>622 (202)</bold></td><td>788 (50)</td><td>2.5 K (14)</td><td>2.6 K (8)</td><td>1.3 K (9)</td><td>1.5 K (17)</td></tr><tr><td>4</td><td>Hepatitis C virus</td><td>36.3%</td><td><bold>2 (12 K)</bold></td><td>2 (7.4 K)</td><td>65 (2.9 K)</td><td>15 (2.5 K)</td><td>3 (2.4 K)</td><td>31 (4.2 K)</td></tr><tr><td>5</td><td>Hepatitis C virus</td><td>38.4%</td><td><bold>2 (568)</bold></td><td>6 (374)</td><td>379 (150)</td><td>152 (182)</td><td>12 (130)</td><td>231 (218)</td></tr><tr><td>6</td><td>Human immunodeficiency virus</td><td>43.9%</td><td><bold>3 (54 K)</bold></td><td>5 (21 K)</td><td>6 (16 K)</td><td>4 (13 K)</td><td>6 (4.5 K)</td><td>2 (18 K)</td></tr><tr><td>7</td><td>Human immunodeficiency virus</td><td>46.1%</td><td><bold>187 (41)</bold></td><td>421 (19)</td><td>859 (18)</td><td>430 (18)</td><td>n/a (0)</td><td>496 (19)</td></tr><tr><td>8</td><td>Hepatitis B virus</td><td>69.4%</td><td><bold>2 (43 K)</bold></td><td>2 (33 K)</td><td>18 (19 K)</td><td>4 (20 K)</td><td>3 (19 K)</td><td>7 (20 K)</td></tr><tr><td>9</td><td>Hepatitis B virus</td><td>72.8%</td><td><bold>2 (3.0 K)</bold></td><td>4 (2.4 K)</td><td>191 (1.5 K)</td><td>41 (1.5 K)</td><td>4 (1.1 K)</td><td>94 (1.5 K)</td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec8">
      <title>Performance on mock metagenomic datasets</title>
      <p id="Par33">The abundance rank of the pathogen is unknown in real metagenomic datasets. So in addition, we evaluated the performance of the tools using a mock metagenomic dataset, which was generated by mixing NGS reads from 3 real datasets: 1) 95% reads from a human sample (NA12878), 2) 4.75% (5% × 95%) reads from a metagenomic dataset with ten species with known abundance [<xref ref-type="bibr" rid="CR14">14</xref>], and 3) 0.25% (5% × 5%) reads from a spiked bacteria. Since the reads from the species are known, the abundance rank of the spiked bacteria was determined as rank 4. Bacteria that have different similarities to their reference sequences were tested and the results are shown in Table <xref rid="Tab2" ref-type="table">2</xref>.
<table-wrap id="Tab2"><label>Table 2</label><caption><p>Benchmarking results of the pathogen detection tools on a mock metagenomic dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="2">Dataset</th><th rowspan="2">Spiked bacteria</th><th rowspan="2">Similarity to reference</th><th>MegaPath</th><th>SURPI</th><th>Centrifuge</th><th>CLARK</th><th>Kraken</th><th>Kraken2</th></tr><tr><th colspan="6">rank (# read)</th></tr></thead><tbody><tr><td>1</td><td>Enterococcus hirae</td><td>20.6%</td><td><bold>13</bold> (579)</td><td>96 (123)</td><td>18 <bold>(7.3 K)</bold></td><td>386 (74)</td><td>65 (315)</td><td>83 (207)</td></tr><tr><td>2</td><td>Corynebacterium halotolerans</td><td>29.6%</td><td><bold>14 (526)</bold></td><td>n/a (0)</td><td>241 (331)</td><td>457 (58)</td><td>80 (205)</td><td>77 (220)</td></tr><tr><td>3</td><td>Clostridium botulinum</td><td>38.3%</td><td><bold>8 (1.7 K)</bold></td><td>62 (260)</td><td>65 (1.5 K)</td><td>108 (465)</td><td>65 (304)</td><td>37 (625)</td></tr><tr><td>4</td><td>Corynebacterium falsenii</td><td>42.1%</td><td><bold>9 (1.2 K)</bold></td><td>n/a (0)</td><td>208 (403)</td><td>n/a (0)</td><td>85 (192)</td><td>61 (328)</td></tr><tr><td>5</td><td>Gardnerella vaginalis</td><td>56.2%</td><td><bold>6 (20.2 K)</bold></td><td>23 (7.3 K)</td><td>14 (9.7 K)</td><td>17 (4.9 K)</td><td>13 (4.7 K)</td><td>14 (6.6 K)</td></tr><tr><td>6</td><td><italic>Pasteurella multocida</italic></td><td>60.4%</td><td><bold>6 (19.8 K)</bold></td><td>25 (2.9 K)</td><td>21 (6.2 K)</td><td>23 (2.8 K)</td><td>14 (3.6 K)</td><td>14 (5.6 K)</td></tr><tr><td>7</td><td><italic>Micrococcus luteus</italic></td><td>73.7%</td><td><bold>4 (25.5 K)</bold></td><td>14 (24.7 K)</td><td>10 (17.2 K)</td><td>13 (12.6 K)</td><td>11 (16.6 K)</td><td>11 (16.9 K)</td></tr><tr><td>8</td><td>Gallibacterium anatis</td><td>75.8%</td><td><bold>4 (37.4 K)</bold></td><td>11 (34 K)</td><td>10 (17.8 K)</td><td>12 (18.3 K)</td><td>11 (17.7 K)</td><td>11 (18 K)</td></tr><tr><td>9</td><td>Citrobacter freundii</td><td>77.6%</td><td><bold>4 (38.5 K)</bold></td><td>14 (21.4 K)</td><td>8 (27.2 K)</td><td>13 (10.4 K)</td><td>11 (18.6 K)</td><td>12 (18.6 K)</td></tr><tr><td>10</td><td>Haemophilus parainfluenzae</td><td>85.8%</td><td><bold>4 (38.7 K)</bold></td><td>n/a (0)</td><td>10 (18.0 K)</td><td>12 (20.2 K)</td><td>11 (17.4 K)</td><td>11 (18.8 K)</td></tr><tr><td>11</td><td>Leuconostoc gasicomitatum</td><td>91.6%</td><td><bold>4 (39.0 K)</bold></td><td>10 (38.4 K)</td><td>9 (21.8 K)</td><td>11 (22.6 K)</td><td>11 (21.4 K)</td><td>11 (21.5 K)</td></tr><tr><td>12</td><td>Human campylobacteriosis</td><td>95.6%</td><td><bold>4 (34.6 K)</bold></td><td>13 (28.1 K)</td><td>8 (30.6 K)</td><td>12 (19.0 K)</td><td>11 (19.2 K)</td><td>11 (18.4 K)</td></tr></tbody></table></table-wrap></p>
      <p id="Par34">With high similarity between the bacteria and the reference sequence (datasets 5 to 12), most tools detected the spiked bacteria in the top 30 species. However, the abundance rank detected by other tools was incorrect. MegaPath detected the correct rank (rank 4 for datasets 7 to 12) or a close rank (rank 6 for datasets 5 and 6) for the spiked bacteria. A possible explanation is that other tools discard or randomly assign the reads without a unique alignment, which leads to error in the abundance rank. However, MegaPath analyzes all aligned reads globally and assigns the non-uniquely aligned reads based on reads that are confidently aligned, leading to a more accurate abundance rank. For low-similarity bacteria (datasets 1 to 4), the amount of non-unique alignments increased. Other tools failed or detected the bacteria with low abundance ranks. In contrast, MegaPath detected the spiked bacteria within the top 14 species.</p>
      <p id="Par35">We also evaluated the sensitivity, precision, and F1-score of the tools on the mock metagenomic dataset. The results are shown in Table <xref rid="Tab3" ref-type="table">3</xref>. Since we know the origin of each read – from the human, the mock community or the spiked bacteria, a true positive is defined as a read being assigned correctly to its origin. Among the results, MegaPath achieved the highest sensitivity, precision, and F1 score. SURPI has been left out in Table <xref rid="Tab3" ref-type="table">3</xref>, because it filtered out reads without annotation, making us unable to get the number of false-negative reads.
<table-wrap id="Tab3"><label>Table 3</label><caption><p>Sensitivity, precision, and F1-score of the pathogen detection tools on a mock metagenomic dataset</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Dataset</th><th>Spiked Bacteria</th><th>MegaPath</th><th>Centrifuge</th><th>CLARK</th><th>Kraken</th><th>Kraken2</th></tr><tr><th/><th/><th colspan="5">F1-score (Sensitivity, Precision)</th></tr></thead><tbody><tr><td>1</td><td>Enterococcus hirae</td><td><bold>98.5%</bold> (97.1, 99.9%)</td><td>96.2% (92.8, 99.9%)</td><td>98.0% <bold>(</bold>96.1, 100%)</td><td>97.3% <bold>(</bold>94.8, 99.9%<bold>)</bold></td><td>97.7% <bold>(</bold>95.6, 99.9%<bold>)</bold></td></tr><tr><td>2</td><td>Corynebacterium halotolerans</td><td><bold>98.5%</bold> (97.1, 100%)</td><td>96.3% <bold>(</bold>92.8, 100%<bold>)</bold></td><td>98.0% (96.1, 100%<bold>)</bold></td><td>97.3% <bold>(</bold>94.8, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.6, 100%<bold>)</bold></td></tr><tr><td>3</td><td>Clostridium botulinum</td><td><bold>98.5%</bold> (97.1, 100%)</td><td>96.3% <bold>(</bold>92.8, 99.9%<bold>)</bold></td><td>98.0% <bold>(</bold>96.1, 100%<bold>)</bold></td><td>97.3% <bold>(</bold>94.8, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.6, 99.9%<bold>)</bold></td></tr><tr><td>4</td><td>Corynebacterium falsenii</td><td><bold>98.5%</bold> (97.1, 100%)</td><td>96.3% <bold>(</bold>92.8, 100%<bold>)</bold></td><td>98.0% <bold>(</bold>96.1, 100%<bold>)</bold></td><td>97.3% <bold>(</bold>94.8, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.6, 100%<bold>)</bold></td></tr><tr><td>5</td><td>Gardnerella vaginalis</td><td><bold>98.6%</bold> (97.2, 100%)</td><td>96.3% <bold>(</bold>92.9, 100%<bold>)</bold></td><td>98.0% <bold>(</bold>96.1, 100%,<bold>)</bold></td><td>97.3% <bold>(</bold>94.8, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.7, 100%<bold>)</bold></td></tr><tr><td>6</td><td>Pasteurella multocida</td><td><bold>98.6%</bold> (97.2, 100%)</td><td>96.3% <bold>(</bold>92.9, 100%<bold>)</bold></td><td>98.0% <bold>(</bold>96.1, 100%<bold>)</bold></td><td>97.3% <bold>(</bold>94.8, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.7, 100%<bold>)</bold></td></tr><tr><td>7</td><td>Micrococcus luteus</td><td><bold>98.6%</bold> (97.2, 100%)</td><td>96.4% <bold>(</bold>93.0, 100%<bold>)</bold></td><td>98.1% <bold>(</bold>96.2, 100%<bold>)</bold></td><td>97.4% (94.9, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.8, 100%<bold>)</bold></td></tr><tr><td>8</td><td>Gallibacterium anatis</td><td><bold>98.6%</bold> (97.3, 100%)</td><td>96.4% <bold>(</bold>93.0, 100%<bold>)</bold></td><td>98.1% <bold>(</bold>96.2, 100%<bold>)</bold></td><td>97.4% <bold>(</bold>95.0, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.8, 100%<bold>)</bold></td></tr><tr><td>9</td><td>Citrobacter freundii</td><td><bold>98.5%</bold> (97.2, 99.9%)</td><td>96.4% <bold>(</bold>93.0, 99.9%<bold>)</bold></td><td>98.0% <bold>(</bold>96.2, 99.9%<bold>)</bold></td><td>97.4% <bold>(</bold>95.0, 99.9%<bold>)</bold></td><td>97.8% <bold>(</bold>95.8, 99.9%<bold>)</bold></td></tr><tr><td>10</td><td>Haemophilus parainfluenzae</td><td><bold>98.6%</bold> (97.3, 100%)</td><td>96.4% <bold>(</bold>93.0, 99.9%<bold>)</bold></td><td>98.1% <bold>(</bold>96.3, 100%<bold>)</bold></td><td>97.4% <bold>(</bold>95.0, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.8, 100%<bold>)</bold></td></tr><tr><td>11</td><td>Leuconostoc gasicomitatum</td><td><bold>98.2%</bold> (96.6, 100%)</td><td>96.4% <bold>(</bold>93.0, 99.9%<bold>)</bold></td><td>98.1% <bold>(</bold>96.3, 100%<bold>)</bold></td><td>97.4% <bold>(</bold>95.0, 100%<bold>)</bold></td><td>97.9% <bold>(</bold>95.8, 100%<bold>)</bold></td></tr><tr><td>12</td><td>Human campylobacteriosis</td><td><bold>98.6%</bold> (97.3, 100%)</td><td>96.4% (93.0, 100%<bold>)</bold></td><td>98.1% <bold>(</bold>96.3, 100%<bold>)</bold></td><td>97.4% <bold>(</bold>95.0, 100%<bold>)</bold></td><td>97.8% <bold>(</bold>95.8, 100%<bold>)</bold></td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec9">
      <title>Sensitivity and FDR on mutated species</title>
      <p id="Par36">Since the real assignment to an exact species of an individual read is unknown in the real metagenomic datasets and the mock metagenomic dataset, thus it is unsuitable for evaluating the false discovery rate (FDR) of the tools. To evaluate the FDR of the tools, we have done an experiment on 139 NGS datasets of cultured isolated bacteria [<xref ref-type="bibr" rid="CR2">2</xref>] where 1) all reads in each dataset are supposed to come from a single bacteria, and 2) the similarities are between 20 and 90%. According to the benchmarks in the previous two sections, we only benchmarked the two best performing tools Centrifuge and MegaPath in this section.</p>
      <p id="Par37">Figure <xref rid="Fig2" ref-type="fig">2</xref> has shown the sensitivity (a) and FDR (b) of Centrifuge and MegaPath on each dataset for assigning reads to the known isolated bacteria. At the same similarity, higher sensitivity and lower FDR are expected. As shown, MegaPath consistently outperformed Centrifuge. Both the sensitivity and FDR of the two tools were close at higher similarities. However, at lower similarities, MegaPath achieved higher sensitivities and lower FDRs.
<fig id="Fig2"><label>Fig. 2</label><caption><p><bold>(a)</bold> Sensitivity and <bold>(b)</bold> False Discovery Rate (FDR) of Centrifuge and MegaPath</p></caption><graphic xlink:href="12864_2020_6875_Fig2_HTML" id="MO2"/></fig></p>
    </sec>
    <sec id="Sec10">
      <title>Time consumption on real metagenomic datasets</title>
      <p id="Par38">The time complexities of the profile-based tools and the alignment-based tools are different. Profile-based tools including Centrifuge, CLARK, Kraken, and Kraken2, have a time complexity of <italic>O</italic>(<italic>n + ts</italic>), where <italic>n</italic> is the total number of bases of the input reads, <italic>t</italic> is the number of the input reads, and <italic>s</italic> is the number of species in the input database. Alignment-based tools including MegaPath and SURPI, have a time complexity of <italic>O</italic> (<italic>nd</italic>), where <italic>d</italic> is the maximum allowed edit distance between a read and a reference sequence.</p>
      <p id="Par39">To show the real-time consumption of each tool in practice, we benchmarked all tools using nine real metagenomic datasets. The results are shown in Table <xref rid="Tab4" ref-type="table">4</xref>. All software tools expect for Kraken2 and CLARK were benchmarked using two Intel E5–2637 v2 (8 CPU cores) and 96 GB RAM. Kraken2 and CLARK asked for much memory, thus they were benchmarked on another faster machine with Intel E5–2695 v2 (24 CPU cores, but only 8 were used) and 192GB RAM. While the database indices could be reused once built, we did not include the time for building database indices in Table <xref rid="Tab4" ref-type="table">4</xref>.
<table-wrap id="Tab4"><label>Table 4</label><caption><p>Time consumption of six tools. SURPI was running in the “comprehensive mode”</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Dataset</th><th>Pathogens</th><th>MegaPath</th><th>SURPI</th><th>Centrifuge</th><th>CLARK</th><th>Kraken</th><th>Kraken2</th></tr></thead><tbody><tr><td>1</td><td>Enterovirus D</td><td>48 min</td><td>4 h 34 min</td><td>4 min</td><td>18 min</td><td>3 min</td><td>12 min</td></tr><tr><td>2</td><td>Human immunodeficiency virus</td><td>12 min</td><td>3 h 29 min</td><td>1 min</td><td>8 min</td><td>1 min</td><td>7 min</td></tr><tr><td>3</td><td>Enterovirus D</td><td>4 h 55 min</td><td>14 h 57 min</td><td>9 min</td><td>22 min</td><td>28 min</td><td>13 min</td></tr><tr><td>4</td><td>Hepatitis C virus</td><td>1 h 45 min</td><td>5 h 13 min</td><td>3 min</td><td>10 min</td><td>12 min</td><td>6 min</td></tr><tr><td>5</td><td>Hepatitis C virus</td><td>1 h 18 min</td><td>4 h 6 min</td><td>3 min</td><td>14 min</td><td>10 min</td><td>9 min</td></tr><tr><td>6</td><td>Human immunodeficiency virus</td><td>26 min</td><td>3 h 51 min</td><td>1 min</td><td>7 min</td><td>1 min</td><td>12 min</td></tr><tr><td>7</td><td>Human immunodeficiency virus</td><td>11 min</td><td>3 h 22 min</td><td>1 min</td><td>8 min</td><td>1 min</td><td>15 min</td></tr><tr><td>8</td><td>Hepatitis B virus</td><td>58 min</td><td>5 h 9 min</td><td>7 min</td><td>12 min</td><td>9 min</td><td>28 min</td></tr><tr><td>9</td><td>Hepatitis B virus</td><td>1 h 4 min</td><td>4 h 20 min</td><td>4 min</td><td>13 min</td><td>9 min</td><td>1 h 11 min</td></tr></tbody></table></table-wrap></p>
    </sec>
  </sec>
  <sec id="Sec11">
    <title>Discussion</title>
    <p id="Par40">Next-generation sequencing (NGS) has enabled unbiased detection of pathogens through mapping the sequencing reads of a patient sample to the known reference sequence of bacteria and viruses. However, existing NGS-based pathogenic detection tools fail to detect low-similarity pathogens or usually assign them with a low rank because the tools fail to assign reads to the reference sequences correctly. In this paper, we introduced MegaPath for detecting these low-similarity pathogens. MegaPath analyzes read alignments globally and uses a two-phase assignment of reads. We will discuss the performance of the two-phase assignment design in this section. Besides, for those novel pathogens without a reference sequence, we will discuss how MegaPath can detect them by sequence assembling and how good its performance is.</p>
    <sec id="Sec12">
      <title>Performance of the two-phase assignment of reads</title>
      <p id="Par41">As the mutation rate of bacteria and viruses is high, and the sequence of some pathogens are unknown, many pathogens are without a similar reference sequence in the database. Existing pathogen detection tools often discard a read sampled from low-similarity regions or assign the read to an arbitrary position. As a result, a low-similarity pathogen may not be detected or may be detected at a low abundance rank. To solve the problem, MegaPath applies a two-phase assignment of reads. To evaluate the performance of the two-phase assignment design, we ran MegaPath with and without a two-phase assignment on nine real metagenomic datasets.</p>
      <p id="Par42">The results are shown in Table <xref rid="Tab5" ref-type="table">5</xref>. In datasets 1, 3, and 6, the number of reads assigned to the pathogen increases with the two-phase assignment because several non-uniquely aligned reads from low-similarity regions have been reassigned to the correct pathogen. Two-phase assignment not only increases the number of reads assigned to the correct pathogen, but also reduces false-positive alignments. In datasets 2, 4 and 7, although the number of reads assigned to the correct pathogen did not change, the number of false-positive reads aligned to species with a higher abundance rank is reduced. As a result, the abundance rank of the correct pathogen increases. For pathogens similar to the reference sequence (datasets 8 and 9), the effect of the two-phase assignment is insignificant because most of the reads sampled from the pathogen were aligned correctly.
<table-wrap id="Tab5"><label>Table 5</label><caption><p>Benchmarking results of MegaPath with and without a two-phase assignment on nine real metagenomic datasets</p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="2">Datasets</th><th rowspan="2">Pathogens</th><th rowspan="2">Similarity to reference</th><th>MegaPath (w/ two-phase assignment)</th><th>MegaPath (w/o two-phase assignment)</th></tr><tr><th colspan="2">rank (# read)</th></tr></thead><tbody><tr><td>1</td><td>Enterovirus D</td><td>18.9%</td><td><bold>33 (608)</bold></td><td>50 (594)</td></tr><tr><td>2</td><td>Human immunodeficiency virus</td><td>19.0%</td><td><bold>15</bold> (3.8 K)</td><td>23 (3.8 K)</td></tr><tr><td>3</td><td>Enterovirus D</td><td>27.9%</td><td><bold>622 (202)</bold></td><td>631 (197)</td></tr><tr><td>4</td><td>Hepatitis C virus</td><td>36.3%</td><td><bold>2</bold> (12 K)</td><td>4 (12 K)</td></tr><tr><td>5</td><td>Hepatitis C virus</td><td>38.4%</td><td>2 (568)</td><td>2 (568)</td></tr><tr><td>6</td><td>Human immunodeficiency virus</td><td>43.9%</td><td>3 <bold>(54.2 K)</bold></td><td>3 (54.0 K)</td></tr><tr><td>7</td><td>Human immunodeficiency virus</td><td>46.1%</td><td><bold>187</bold> (41)</td><td>347 (41)</td></tr><tr><td>8</td><td>Hepatitis B virus</td><td>69.4%</td><td>2 (43 K)</td><td>2 (43 K)</td></tr><tr><td>9</td><td>Hepatitis B virus</td><td>72.8%</td><td>2 (3.0 K)</td><td>2 (3.0 K)</td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec13">
      <title>Detecting novel species without a reference</title>
      <p id="Par43">When a pathogen is novel (i.e., without a reference sequence in the database), detecting the pathogen using alignment does not work. MegaPath handles such cases by performing sequence assembly using MegaHit [<xref ref-type="bibr" rid="CR9">9</xref>]. MegaPath assembles the unaligned reads and the reads aligned to viruses, which are known to mutate rapidly, to construct contigs for novel species.</p>
      <p id="Par44">We evaluated the performance of MegaPath in detecting a novel pathogen using a serum sample from a patient infected with a novel BASV Rhabdovirus [<xref ref-type="bibr" rid="CR15">15</xref>]. To simulate a situation in which BASV is a novel virus, the DNA and protein sequences of BASV, which were in the reference sequence database, were removed. As a result, eight contigs were assembled by MegaPath. The longest contig was 3131 bp, with a total length of 11,155 bp, which is close to the average genome size of a virus [<xref ref-type="bibr" rid="CR16">16</xref>]. SURPI also supports sequence assembly for discovering novel species. It assembled 15 contigs, the longest contig was 1726 bp, with a total length of 11,019 bp, both are shorter than MegaPath. All these contigs are correct because they can be aligned to the reference sequence of the BASV Rhabdovirus.</p>
    </sec>
  </sec>
  <sec id="Sec14">
    <title>Conclusions</title>
    <p id="Par45">Next-generation sequencing (NGS) enables unbiased detection of pathogens that cannot be achieved using traditional methods, including culture and PCR. Typical NGS approaches for detecting a pathogen require mapping the sequencing reads of a patient sample to the pathogen’s reference sequences. However, when the target pathogen has no close relative with a known reference sequence, or when the pathogen has a high load of mutations compared to its predecessor, read mapping often fails due to low similarity between the pathogen and the reference sequence. As a result, the detection of such pathogens remains ineffective.</p>
    <p id="Par46">To solve the problem, we developed MegaPath that performs global analysis of aligned reads in order to increase the mapping rate and mapping quality of reads to reference sequences, especially for low-similarity pathogens. This process is computationally intensive, but thanks to MegaPath’s highly optimized alignment engine (MegaGuide), fast and accurate detection of pathogens was made possible. MegaPath can detect low-similarity pathogens in a typical metagenomic dataset in around 20 min.</p>
    <sec id="Sec15">
      <title>Availability and requirements</title>
      <p id="Par47">Project name: Megapath Project</p>
      <p id="Par48">Project home page: <ext-link ext-link-type="uri" xlink:href="https://sourceforge.net/projects/megapath">https://sourceforge.net/projects/megapath</ext-link></p>
      <p id="Par49">Operating system(s): Linux</p>
      <p id="Par50">Programming languages: Perl, BASH, C/C++</p>
      <p id="Par51">Other requirements: docker engine v17.12.0-ce, AVX2 (CPU)</p>
      <p id="Par52">License: GNU GPLv3</p>
      <p id="Par53">Any restrictions to use by non-academics: Nil</p>
    </sec>
  </sec>
</body>
<back>
  <glossary>
    <title>Abbreviations</title>
    <def-list>
      <def-item>
        <term>BASV</term>
        <def>
          <p id="Par4">BAS-congo Virus</p>
        </def>
      </def-item>
      <def-item>
        <term>CSF</term>
        <def>
          <p id="Par5">Cerebrospinal Fluid</p>
        </def>
      </def-item>
      <def-item>
        <term>DNA</term>
        <def>
          <p id="Par6">DeoxyriboNucleic Acid</p>
        </def>
      </def-item>
      <def-item>
        <term>HBV</term>
        <def>
          <p id="Par7">Hepatitis B Virus</p>
        </def>
      </def-item>
      <def-item>
        <term>HCV</term>
        <def>
          <p id="Par8">Hepatitis C Virus</p>
        </def>
      </def-item>
      <def-item>
        <term>HIV</term>
        <def>
          <p id="Par9">Human Immunodeficiency Virus</p>
        </def>
      </def-item>
      <def-item>
        <term>FDR</term>
        <def>
          <p id="Par10">False Discovery Rate</p>
        </def>
      </def-item>
      <def-item>
        <term>LCA</term>
        <def>
          <p id="Par11">Lowest Common Ancestor</p>
        </def>
      </def-item>
      <def-item>
        <term>NGS</term>
        <def>
          <p id="Par12">Next Generation Sequencing</p>
        </def>
      </def-item>
      <def-item>
        <term>NP</term>
        <def>
          <p id="Par13">nasopharyngeal</p>
        </def>
      </def-item>
      <def-item>
        <term>SURPI</term>
        <def>
          <p id="Par14">Sequence-based UltraRapid Pathogen Identification</p>
        </def>
      </def-item>
    </def-list>
  </glossary>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Chi-Ming Leung, Dinghua Li and Yan Xin are joint first authors.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>Not applicable.</p>
    <sec id="FPar1">
      <title>About this supplement</title>
      <p id="Par54">This article has been published as part of BMC Genomics Volume 21 Supplement 6, 2020: Selected articles from the 8th IEEE International Conference on Computational Advances in Bio and medical Sciences (ICCABS 2018): genomics. The full contents of the supplement are available online <ext-link ext-link-type="uri" xlink:href="https://bmcgenomics.biomedcentral.com/articles/supplements/volume-21-supplement-6">https://bmcgenomics.biomedcentral.com/articles/supplements/volume-21-supplement-6</ext-link>.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>TWL, RL, HFT, CML, and DL designed the algorithm and experiments. DL, YX, and WL implemented and tested the software. We confirm that the manuscript has been read and approved by all authors.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>Publication costs have been funded by the University of Hong Kong. TWL was partially supported by Innovative and Technology Fund ITS/331/17FP from the Innovation and Technology Commission, HKSAR. RL was partially supported by the General Research Fund No. 27204518, HKSAR. HFT was partially supported by the General Research Fund No. 17208019, HKSAR. The funding body played no roles in the design of the study and collection, analysis, and interpretation of data and in writing the manuscript.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The datasets generated and/or analysed during the current study are available at <ext-link ext-link-type="uri" xlink:href="https://sourceforge.net/projects/megapath">https://sourceforge.net/projects/megapath</ext-link>.</p>
  </notes>
  <notes id="FPar2">
    <title>Ethics approval and consent to participate</title>
    <p id="Par55">Not applicable.</p>
  </notes>
  <notes id="FPar3">
    <title>Consent for publication</title>
    <p id="Par56">Not applicable.</p>
  </notes>
  <notes id="FPar4" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par57">The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schlaberg</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Validation of metagenomic next-generation sequencing tests for universal pathogen detection</article-title>
        <source>Arch Pathol Lab Med</source>
        <year>2017</year>
        <volume>141</volume>
        <issue>6</issue>
        <fpage>776</fpage>
        <lpage>786</lpage>
        <pub-id pub-id-type="doi">10.5858/arpa.2016-0539-RA</pub-id>
        <pub-id pub-id-type="pmid">28169558</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Centrifuge: rapid and sensitive classification of metagenomic sequences</article-title>
        <source>Gen Res</source>
        <year>2016</year>
        <volume>26</volume>
        <issue>12</issue>
        <fpage>1721</fpage>
        <lpage>1729</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.210641.116</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wood</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Kraken: ultrafast metagenomic sequence classification using exact alignments</article-title>
        <source>Gen Bio</source>
        <year>2014</year>
        <volume>15</volume>
        <issue>3</issue>
        <fpage>R46</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2014-15-3-r46</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Breitwieser</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Pardo</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Re-analysis of metagenomic sequences from acute flaccid myelitis patients reveals alternatives to enterovirus D68 infection</article-title>
        <source>F1000Res</source>
        <year>2015</year>
        <volume>4</volume>
        <fpage>180</fpage>
        <pub-id pub-id-type="doi">10.12688/f1000research.6743.1</pub-id>
        <pub-id pub-id-type="pmid">26309730</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ounit</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Wanamaker</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Close</surname>
            <given-names>TJ</given-names>
          </name>
          <name>
            <surname>Lonardi</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>CLARK: fast and accurate classification of metagenomic and genomic sequences using discriminative k-mers</article-title>
        <source>BMC Genomics</source>
        <year>2015</year>
        <volume>16</volume>
        <fpage>236</fpage>
        <pub-id pub-id-type="doi">10.1186/s12864-015-1419-2</pub-id>
        <pub-id pub-id-type="pmid">25879410</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Naccache</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A cloud-compatible bioinformatics pipeline for ultrarapid pathogen identification from next-generation sequencing of clinical samples</article-title>
        <source>Gen. Res.</source>
        <year>2014</year>
        <volume>24</volume>
        <issue>7</issue>
        <fpage>1180</fpage>
        <lpage>1192</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.171934.113</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>DH</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MEGAHIT: an ultra-fast single-node solution for large and complex metagenomics assembly via succinct de Bruijn graph</article-title>
        <source>Bioinfo.</source>
        <year>2015</year>
        <volume>31</volume>
        <issue>10</issue>
        <fpage>1674</fpage>
        <lpage>1676</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btv033</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Crick</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Origin of the genetic code</article-title>
        <source>Nature</source>
        <year>1967</year>
        <volume>213</volume>
        <issue>5072</issue>
        <fpage>119</fpage>
        <pub-id pub-id-type="doi">10.1038/213119d0</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhu</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Freeland</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>The standard genetic code enhances adaptive evolution of proteins</article-title>
        <source>J Theor Biol</source>
        <year>2006</year>
        <volume>239</volume>
        <issue>1</issue>
        <fpage>63</fpage>
        <lpage>70</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jtbi.2005.07.012</pub-id>
        <pub-id pub-id-type="pmid">16325205</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mai</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AC-DIAMOND v1: accelerating large-scale DNA-protein alignment</article-title>
        <source>Bioinfo.</source>
        <year>2018</year>
        <volume>34</volume>
        <issue>21</issue>
        <fpage>3744</fpage>
        <lpage>3746</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty391</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Daly</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Host subtraction, Filtering and Assembly Validations for Novel Viral Discovery Using Next Generation Sequencing Data</article-title>
        <source>PLOS ONE</source>
        <year>2015</year>
        <volume>10</volume>
        <issue>6</issue>
        <fpage>e012905</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pone.0129059</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Greninger</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A novel outbreak enterovirus D68 strain associated with acute flaccid myelitis cases in the USA (2012-14): a retrospective cohort study</article-title>
        <source>Lancet Infect Dis</source>
        <year>2015</year>
        <volume>15</volume>
        <issue>6</issue>
        <fpage>671</fpage>
        <lpage>682</lpage>
        <pub-id pub-id-type="doi">10.1016/S1473-3099(15)70093-9</pub-id>
        <pub-id pub-id-type="pmid">25837569</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Altschul</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Gish</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Miller</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Myers</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lipman</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Basic local alignment search tool</article-title>
        <source>J Mol Biol</source>
        <year>1990</year>
        <volume>215</volume>
        <fpage>403</fpage>
        <lpage>410</lpage>
        <pub-id pub-id-type="doi">10.1016/S0022-2836(05)80360-2</pub-id>
        <pub-id pub-id-type="pmid">2231712</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lindgreen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Adair</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Gardner</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>An evaluation of the accuracy and speed of metagenome analysis tools</article-title>
        <source>Sci Rep</source>
        <year>2016</year>
        <volume>6</volume>
        <fpage>19233</fpage>
        <pub-id pub-id-type="doi">10.1038/srep19233</pub-id>
        <pub-id pub-id-type="pmid">26778510</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grard</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A novel Rhabdovirus associated with acute hemorrhagic fever in Central Africa</article-title>
        <source>PLoS Pathog</source>
        <year>2012</year>
        <volume>8</volume>
        <issue>9</issue>
        <fpage>e1002924</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.ppat.1002924</pub-id>
        <pub-id pub-id-type="pmid">23028323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Josa</surname>
            <given-names>ACB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Viral genome size distribution does not correlate with the antiquity of the host lineages</article-title>
        <source>Front Ecol Evol</source>
        <year>2015</year>
        <volume>3</volume>
        <fpage>143</fpage>
      </element-citation>
    </ref>
  </ref-list>
</back>
