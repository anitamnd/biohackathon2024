<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7898451</article-id>
    <article-id pub-id-type="publisher-id">2281</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-021-02281-7</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scSorter: assigning cells to known cell types according to marker genes</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Guo</surname>
          <given-names>Hongyu</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4353-5761</contrib-id>
        <name>
          <surname>Li</surname>
          <given-names>Jun</given-names>
        </name>
        <address>
          <email>jun.li@nd.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1"/>
      </contrib>
      <aff id="Aff1"><institution-wrap><institution-id institution-id-type="GRID">grid.131063.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2168 0066</institution-id><institution>Department of Applied and Computational Mathematics and Statistics, University of Notre Dame, </institution></institution-wrap>102 Crowley Hall, Notre Dame, USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>22</day>
      <month>2</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>22</day>
      <month>2</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2021</year>
    </pub-date>
    <volume>22</volume>
    <elocation-id>69</elocation-id>
    <history>
      <date date-type="received">
        <day>10</day>
        <month>9</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>27</day>
        <month>1</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">On single-cell RNA-sequencing data, we consider the problem of assigning cells to known cell types, assuming that the identities of cell-type-specific marker genes are given but their exact expression levels are unavailable, that is, without using a reference dataset. Based on an observation that the expected over-expression of marker genes is often absent in a nonnegligible proportion of cells, we develop a method called scSorter. scSorter allows marker genes to express at a low level and borrows information from the expression of non-marker genes. On both simulated and real data, scSorter shows much higher power compared to existing methods.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at (10.1186/s13059-021-02281-7).</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Cell type assignment</kwd>
      <kwd>Single-cell RNA-seq</kwd>
      <kwd>Marker genes</kwd>
      <kwd>Clustering</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000001</institution-id>
            <institution>National Science Foundation</institution>
          </institution-wrap>
        </funding-source>
        <award-id>1925645</award-id>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2021</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p>Single-cell RNA sequencing (scRNA-seq) quantifies gene expression of a large number of individual cells, which is then used to identify and describe different types of cells. These cell types include not only novel cell types but also known cell types, that is, cell types that have been previously discovered and studied. Assigning cells to known cell types is important as the proportional composition of known cell types helps to understand how heterogeneous tissues function. Assigning cells to known cell types can also facilitate the search of new cell types as the search can focus on “unknown” cells, i.e., cells that cannot be assigned to known cell types. Moreover, as large-scale efforts/projects such as Human Cell Atlas [<xref ref-type="bibr" rid="CR1">1</xref>] proceed, most (non-rare) cell types will become “known,” and thus, the task of assigning cells to known cell types will become even more prevalent.</p>
    <p>Cell-type assignment can be done manually: after clustering cells into cell types using computational clustering algorithms such as Leiden [<xref ref-type="bibr" rid="CR2">2</xref>] or Louvain [<xref ref-type="bibr" rid="CR3">3</xref>] on a nearest neighbor graph (both implemented in Seurat [<xref ref-type="bibr" rid="CR4">4</xref>]) and SC3 [<xref ref-type="bibr" rid="CR5">5</xref>], label the cell clusters to known cell types based on manual examination of differentially expressed genes specific to each cluster [<xref ref-type="bibr" rid="CR6">6</xref>]. The subjectivity of manual examination is a problem, which can be eliminated by fully automated computational approaches.</p>
    <p>Most of current computational approaches utilize a “reference” dataset, i.e., a previously studied dataset where these known cell types are present. They train a classifier using the reference dataset and apply this classifier to the dataset in hand. Many well-designed classifiers that carefully accommodate features and characteristics of single-cell data have been developed and used (e.g., [<xref ref-type="bibr" rid="CR7">7</xref>–<xref ref-type="bibr" rid="CR14">14</xref>]). The success of these approaches, however, depends on the availability of a reference dataset, which, ideally, should be of high quality and resembles the data in hand in the sense of the samples being prepared in a similar manner and the expression being generated using a similar technique, in order to minimize the influential systematic differences between datasets (e.g., batch effect), which is often a concern in scRNA-seq data (e.g., [<xref ref-type="bibr" rid="CR15">15</xref>]).</p>
    <p>Although the availability of a suitable reference dataset can be limited, knowledge about known cell types has been accumulated over the years, which is often in the form like “in cell type A, genes a, b, and c are highly expressed.” Such genes, i.e., genes that are over-expressed in a particular cell type, are often called “marker genes” of the cell type. Typically, the knowledge about marker genes is “qualitative” instead of “quantitative.” That is, they are known to be expressed at higher levels in the corresponding cell types but their exact expression levels are unknown. This is because these marker genes may have been discovered using various techniques, from low-throughput techniques such as qRT-PCR to other (older) high-throughput techniques such as microarrays, and the measurements from different techniques are often not directly comparable. How to use the information from these qualitative marker genes to assign cells to known cell types? Recently three methods have been developed: SCINA [<xref ref-type="bibr" rid="CR16">16</xref>], Garnett [<xref ref-type="bibr" rid="CR17">17</xref>], and CellAssign [<xref ref-type="bibr" rid="CR18">18</xref>]. These methods are sometimes referred to as “semi-supervised” methods, as they only use the identity of marker genes, as opposed to methods that rely on a reference dataset, which are referred to as “supervised” methods.</p>
    <p>SCINA uses a Gaussian mixture model to describe the expression data and introduces a constraint that marker genes should have higher mean expression levels in their corresponding cell types. CellAssign uses a Bayesian probabilistic model that includes a dedicated factor to describe the over-expression of marker genes. Garnett first selects a set of “representative” cells for each known cell type, defined as cells that express highly on all marker genes of the cell type, trains a generalized-linear-model-based classifier using merely these representative cells, and then applies this classifier to other cells to determine their labels.</p>
    <p>In this paper, we propose another “semi-supervised” method for cell-type assignment/calling. That is, our method completes the same task as SCINA, Garnett, and CellAssign: assigning cells into known cell types using the scRNA-seq expression data in hand and a list of marker genes for each known cell type. Again, marker genes for a cell type are genes that are over-expressed (i.e., have higher expression levels) in that cell type, but their exact expression levels are not assumed known, and no reference dataset is used. Inspired by the parcel sorter, which is used by postal services to distribute mails to different paths/targets according to features of the parcel such as the zip code and the package size, we name our method single-cell sorter, or scSorter for short, as it assigns single cells to different predefined cell types according to the over-expression of marker genes.</p>
    <p>By allowing flexibility in marker gene expression, borrowing information from non-marker genes, and using a two-step procedure, scSorter shows much superior power over existing methods on both simulated and real datasets. In all the simulated datasets, scSorter reduces the error rate significantly across all simulation scenarios. In the real datasets, on average, scSorter reduces the error rate of competitors by 58 % or more.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Description of simulated data</title>
      <p>We simulated data under three scenarios. In the first scenario, we simulated ten cell types and the marker genes for each of these ten cell types were given. In this case, there were no unknown cell types in the expression data, and all known cell types appeared in the (scRNA-seq) expression data. This was the simplest scenario; we made things more challenging in the second and third scenarios. In the second scenario, the marker genes for ten cell types were given but some of these ten cell types did not appear in the expression data. In the third scenario, there were ten cell types in the expression data but the marker genes of some of these ten cell types were unknown and thus cells from these cell types should be assigned to “unknown.” It is worth noting that in scenarios 1 and 2, although no cell should be assigned to the unknown cell type as all cell types in the expression data were known, this information was not passed to computational algorithms assigning cell types and thus some cells might still be labeled as unknown. This was to mimic the situation in real data analysis.</p>
      <p>Simulated datasets were generated using Splatter [<xref ref-type="bibr" rid="CR19">19</xref>] with the extensions developed in study [<xref ref-type="bibr" rid="CR18">18</xref>] to deal with the extreme log fold change they observed in real data, and with further corrections to better describe the excessive zeros observed in real data. Each simulated dataset consisted of 5000 cells from 10 cell types. Each cell type contained two to five marker genes. In scenario 2, the expression data from some cell types (one, two, or three) were removed, and in scenario 3, the identities of marker genes from some cell types (one, two, or three) were removed. All simulations were repeated 50 times. More details about how we generated the simulated data are provided in Additional file <xref rid="MOESM1" ref-type="media">1</xref>.</p>
    </sec>
    <sec id="Sec4">
      <title>Description of real datasets</title>
      <p>We used five real datasets, and we referred them by the first author of the corresponding paper or by the content of the data. All the real datasets were normalized by LogNormalize method from Seurat (version 3.1.0) prior to analysis. The marker genes used for all the datasets are listed in Additional file <xref rid="MOESM1" ref-type="media">1</xref>. Highly variable genes were chosen using the “vst” method in the Seurat package.</p>
      <p><italic>Rosenberg data</italic>: This data was created by Rosenberg et al. [<xref ref-type="bibr" rid="CR20">20</xref>] using the SPLiT-seq protocol to analyze cells from the mouse brain and spinal cord. It profiled 27,096 non-neuronal cells from different cell types: Oligo (4,294 cells), OPC (5,793 cells), Immune (621 cells), Vascular (659 cells), VLMC (1,474 cells), Astrocyte (13,481 cells), Ependyma (518 cells), and OEC (256 cells). We used the cell type definition as well as marker genes defined in the original study [<xref ref-type="bibr" rid="CR20">20</xref>].</p>
      <p><italic>TM Pancreas data</italic>: This data was a mouse atlas created by the Tabula Muris Consortium [<xref ref-type="bibr" rid="CR21">21</xref>]. The cells were sorted using fluorescence-activated cell sorting (FACS) and sequenced by Smart-seq2 protocol. 1564 cells with valid cell type annotation from a pancreas tissue were used for our analysis. They included cells from Pancreatic A (390 cells), Pancreatic B (449 cells), Pancreatic D (140 cells), Pancreatic PP (73 cells), Pancreatic Acinar (182 cells), Pancreatic Ductal (161 cells), Pancreatic Stellate (49 cells), Endothelial (66 cells), and Immune (54 cells). Marker genes for these cell types were extracted from the original study [<xref ref-type="bibr" rid="CR21">21</xref>].</p>
      <p><italic>MCA lung data</italic>: Using Microwell-seq protocol, this data was a mouse atlas created by Han et al. [<xref ref-type="bibr" rid="CR22">22</xref>]. Lung data from this atlas was selected and used by Garnett [<xref ref-type="bibr" rid="CR17">17</xref>] to illustrate its performance. 6940 lung cells with cell type annotation came from alveolar (2215 cells), B (728 cells), ciliated (317 cells), endothelial (321 cells), fibroblasts (412 cells), granulocytes (349 cells), macrophage (772 cells), dendritic (887 cells), natural killer (NK, 275 cells), and T (664 cells). Marker genes for these cell types were extracted from the original study [<xref ref-type="bibr" rid="CR22">22</xref>].</p>
      <p><italic>PBMC data</italic>: Using the 10X Chromium platform (Cell Ranger version 1.1.0), this data was created by Zheng et al. [<xref ref-type="bibr" rid="CR23">23</xref>]. It contained 94,655 peripheral blood mononuclear cells (PBMCs) from the following cell types: T (64,341 cells), B (10,085 cells), CD34+ (9232 cells), NK (8385 cells), and monocytes (2612 cells). This dataset was used by Garnett to illustrate its performance [<xref ref-type="bibr" rid="CR17">17</xref>], with the difference that Garnett considered two subtypes of T cells, CD4+ and CD8+, to specifically demonstrate its performance under cell type hierarchy. The marker-gene list we used for the five cell types was extracted from the Garnett paper. (For T cells, the marker genes are <italic>CD3D</italic>, <italic>CD3E</italic>, and <italic>CD3G</italic>.)</p>
      <p><italic>CBMC data</italic>: This data was created by Stoeckius et al. [<xref ref-type="bibr" rid="CR24">24</xref>] using CITE-seq on the 10x platform. It contained a mixture of 8617 human and mouse cells with the mouse cells (about 5% of the total cells) used as negative controls for the protein measurements. Here, we used the 7654 human cord blood mononuclear cells (CBMC) with cell types determined by antibody-derived tags (ADTs) from the following cell types: CD4 T cells (3065 cells), CD8 T cells (293 cells), B (364 cells), CD34+ (226 cells), NK (1205 cells), and monocytes (2501 cells). The marker-gene list for these six cell types were summarized from previous studies [<xref ref-type="bibr" rid="CR17">17</xref>, <xref ref-type="bibr" rid="CR25">25</xref>, <xref ref-type="bibr" rid="CR26">26</xref>].</p>
    </sec>
    <sec id="Sec5">
      <title>The motivation and novelties of scSorter</title>
      <p>scSorter is a very different method from SCINA, Garnett, and CellAssign. It is initiated from an observation about scRNA-seq data: marker genes, even those well-documented ones, may not, and actually typically do not, have higher expression in all the cells in the corresponding cell types. This important observation was first raised and discussed in a recent manuscript [<xref ref-type="bibr" rid="CR13">13</xref>], and it is validated on the real datasets we investigated. Take Rosenberg data as an example. Figure <xref rid="Fig1" ref-type="fig">1</xref>a shows the expression of marker genes in cells from different cell types. Cells are grouped according to the (true) cell types they belong to, and the black boxes indicate the correspondences of cell types and marker genes. For example, for the Oligo cells, the expression of genes <italic>Mbp</italic> to <italic>Bcas1</italic> are surrounded with a black box, indicating that these genes are marker genes for cell type Oligo.
<fig id="Fig1"><label>Fig. 1</label><caption><p>Visualization of Rosenberg data. <bold>a</bold> Expression of cells from different cell types on marker genes. Columns are cells and rows are marker genes. Cells are grouped according to the (true) cell types that they belong to, with the colorful bar on the top of the expression matrix giving the cell type identities, and the marker genes are grouped according to the cell types that they correspond to. The white vertical and horizontal gaps separate cells from different types and marker genes corresponding to different cell types. The black boxes indicate the correspondences of cell types and marker genes. <bold>b</bold> The bars show the percentages of cells that have zero expression in the corresponding cell types, for the marker genes</p></caption><graphic xlink:href="13059_2021_2281_Fig1_HTML" id="MO1"/></fig></p>
      <p>This plot clearly shows that most marker genes do not consistently have high expression levels across all cells in the corresponding cell type. For example, for the seven marker genes for cell type Oligo, the proportions of the Oligo cells that have zero expression of these genes are 13% (<italic>Mbp</italic>), 96% (<italic>Opalin</italic>), 95% (<italic>Hapln2</italic>), 84% (<italic>Tmem</italic>2), 95% (<italic>Bmp4</italic>), 89% (<italic>Gpr17</italic>), and 26% (<italic>Bcas1</italic>). We see that all of them are missed in expression in some proportions of the cells, and most of them have zero expression in over 80% of the cells. This is biologically meaningful, as the Oligo cells form a lineage, and these marker genes are known to express only at certain intermediate stages of oligodendrocyte development [<xref ref-type="bibr" rid="CR20">20</xref>]. For each marker gene, Fig. <xref rid="Fig1" ref-type="fig">1</xref>b shows the percentage of cells where its expression is zero in its corresponding cell type. On average, this percentage is 72%.</p>
      <p>The missing of expression of marker genes is actually quite common in real datasets. It is observed in all the five real datasets we use, and in four out of the five real datasets, over half of the marker genes have zero expression in the majority of cells of the corresponding cell types (i.e., in the cell types where they are marker genes).</p>
      <p>There are quite a few possible causes of this phenomenon. First, some marker genes are expected, biologically, to be expressed at high levels only in a proportion, but not all, of the cells in the corresponding cell type. These genes are expected, biologically, to be expressed consistently at low levels in other cell types, and thus, they are still valid markers. An example is the marker genes for the Oligo cell type, which we just discussed. A second cause can be the high heterogeneity of cell expressions. Cells, even from the same “cell type,” may have large biological variations in their expression levels. A third cause can be the high noise level in scRNA-seq data. That is, even if two cells have exactly the same expression of a gene, the observed expression measurements from a scRNA-seq experiment can still be quite different due to large systematic biases/variations, e.g., the so-called dropout events [<xref ref-type="bibr" rid="CR27">27</xref>]. A fourth cause can be that the a priori knowledge about the identities of some marker genes may be inaccurate or inapplicable to the new dataset.</p>
      <p>To accommodate such phenomenon, scSorter proposes two strategies. First, it combines the expression of marker genes and other genes together for clustering. The idea is cells from the same/different cell type(s) are likely to have similar/different expression profiles, and this similarity/difference is not only on marker genes but also on some other genes, particularly so-called highly variable genes, which are known to be highly informative in clustering and thus used by most clustering algorithms developed for single-cell data (see, e.g., [<xref ref-type="bibr" rid="CR4">4</xref>, <xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR28">28</xref>, <xref ref-type="bibr" rid="CR29">29</xref>]). For simplicity, in this paper, we call highly variable genes that are not marker genes “non-marker genes” or “other genes.” Considering that the number of non-marker genes is typically much larger than the number of marker genes, completely ignoring information from them can be a big waste of data. Thus, scSorter tries to borrow information from non-marker genes: when marker genes have a lot of zero expression, other genes may take over the role and decide the assignment; even when marker genes are expressed, other genes may still contribute and help to verify or adjust the assignment. Among the three existing methods, SCINA and CellAssign only use the expression of marker genes, and Garnett makes use of non-marker genes in the second step, i.e., building a classifier based on the “representative” cells. However, Garnett does not use non-marker genes in the first step, i.e., searching for the representative cells. scSorter uses non-marker genes in a more persistent and explicit way. It proposes an optimization problem where the target function is an explicit combination of marker gene expression and non-marker gene expression. Thus, its solution is always a joint effort of both of them.</p>
      <p>The second strategy that scSorter proposes is to explicitly allow marker genes to express at a low level in some cells from their corresponding cell types. Each marker gene in each cell can “freely choose” to express at a base level (i.e., the expression level of this gene in cells that do not belong to this gene’s corresponding cell type) or an elevated level (i.e., a level that is higher than the base level). This choice is fully automatic, realized by solving a constrained optimization problem.</p>
      <p>By allowing flexibility in marker gene expression and borrowing information from non-marker genes, scSorter tolerates marker genes’ inconsistency in over-expression and uses other genes to assist clustering.</p>
      <p>Another major concern in cell type assignment is the existence of “unknown” genes. That is, some cells may not belong to any of the known cell types and need to be labeled as unknown. However, different from cells in any particular known cell type, these unknown cells typically consist of cells from many unknown cell types, which can be very different from each other, and thus they do not “cluster together.” scSorter circumvents this difficulty by using a novel two-step approach. Suppose there are <italic>K</italic> known cell types with marker gene information. In the first step, scSorter proposes and solves a constrained optimization problem that clusters all cells into <italic>K</italic> clusters. Each cluster given by the first step is expected to contain both cells that are from a known cell type and unknown cells that have expression profiles more similar to this known cell type than the other known cell types. These two categories of cells are then separated in the second step by scrutinizing into their expressions on both marker genes and non-marker genes. A formal statistical test is proposed for the separation. We can call the first step “clustering” and the second step “unknown-cell calling.” A detailed description of the scSorter algorithm is given in the “<xref rid="Sec12" ref-type="sec">Methods</xref>” section.</p>
    </sec>
    <sec id="Sec6">
      <title>Application of scSorter and four other algorithms</title>
      <p>scSorter was applied to all the simulated datasets and real datasets with the same simple setting of a common weight parameter <italic>w</italic><sub>0</sub>=2.0 (introduced in the “<xref rid="Sec12" ref-type="sec">Methods</xref>” section) and all other parameters automatically determined by the algorithm.</p>
      <p>The performance of three other approaches, SCINA, Garnett, and CellAssign (details about how we used these three approaches are available in Additional file <xref rid="MOESM1" ref-type="media">1</xref>), was reported and compared with scSorter.</p>
      <p>All these three existing approaches, as well as scSorter, are based on their own dedicated models/strategies that integrate the over-expression of marker genes into the clustering procedure. One might, however, proposes a more straightforward two-step approach that first uses a regular (without considering marker gene information) clustering algorithm to cluster cells and then assigns the most parsimonious cell type to each cluster based on the average marker-gene expression. We implemented such an approach. In the first step, SC3 [<xref ref-type="bibr" rid="CR5">5</xref>] was used for clustering (the reason why we used SC3 instead of Seurat is discussed in Additional file <xref rid="MOESM1" ref-type="media">1</xref>), and in the second step, the Pearson correlation coefficient was used for measuring parsimony. See Additional file <xref rid="MOESM1" ref-type="media">1</xref> for a detailed description of this method. We call this method “SC3+correlation”. It is worth noting that SC3, which is a completely unsupervised approach for clustering, alone cannot be used to assign cells to known cell types, and this is also why we do not call this straightforward two-step approach “SC3”. The performance of SC3+correlation was also reported and compared with the other four methods.</p>
    </sec>
    <sec id="Sec7">
      <title>Measurement of performance</title>
      <p>The performance of scSorter, as well as SCINA, Garnett, CellAssign, and SC3+correlation, was measured by misclassification rate, defined as the proportion of cells that were not classified into the correct cell types. It equals 1 minus classification accuracy, and a lower value means better performance. Misclassification rate is typically used for (supervised) classification problems, but it was suitable to be used for our (unsupervised) clustering problem as the true cell types of all our simulated and real datasets were known, and we not only wanted to put cells coming from the same cluster into <italic>a</italic> cluster, but also into a <italic>specific</italic> cluster which has the matched marker genes.</p>
    </sec>
    <sec id="Sec8">
      <title>Performance on simulated data</title>
      <p>The misclassification rates of the methods under comparison are shown in Fig. <xref rid="Fig2" ref-type="fig">2</xref>a. The results are consistent across all simulation scenarios/settings: scSorter gave considerably lower misclassification rates than all the other four methods. On average, the misclassification rate of scSorter was 33.1% lower than that of SCINA, 34.1% lower than that of Garnett, 46.5% lower than that of CellAssign, and 41.3% lower than that of SC3+correlation.
<fig id="Fig2"><label>Fig. 2</label><caption><p>The performance of scSorter and four other methods on simulated and real datasets. <bold>a</bold> The performance of the five methods on simulated data of three scenarios. In the first scenario, we simulated ten cell types and the marker genes for each of these ten cell types were given. In this case, there were no “unknown” cell types in the expression data, and all known cell types appeared in the (scRNA-seq) expression data. This was the simplest scenario. In the second scenario, the marker genes for ten cell types were given but some of these ten cell types did not appear in the expression data. In the third scenario, there were ten cell types in the expression data but the marker genes of some of these ten cell types were unknown and thus cells from these cell types should be assigned to “unknown.” <bold>b</bold> The performance of the five methods on five real datasets</p></caption><graphic xlink:href="13059_2021_2281_Fig2_HTML" id="MO2"/></fig></p>
    </sec>
    <sec id="Sec9">
      <title>Performance on real datasets</title>
      <p>The misclassification rates of the five methods on five real datasets are given in Fig. <xref rid="Fig2" ref-type="fig">2</xref>b. scSorter achieved the lowest misclassification rate in almost all the datasets, with the only exception on TM Pancreas data, where CellAssign and SC3+correlation gave lower misclassification rates of 0.0512 and 0.0237, respectively, compared to 0.0550 from scSorter. On average across the five datasets, the misclassification rate of scSorter is 62.7% lower than that of SCINA, 59.3% lower than that of Garnett, 70.4% lower than that of CellAssign, and 58.2% lower than that of SC3+correlation. Moreover, scSorter was the only method that achieved misclassification rate less than 20% in all the five datasets, while all other methods struggled in giving highly accurate results in at least one dataset: SCINA gave wrong assignments in more than 50% of cells in Rosenberg data, Garnett gave wrong assignments in around 40% of cells in Rosenberg data and CBMC data, CellAssign gave wrong assignments in more than 60% of cells in Rosenberg data and PBMC data, and SC3+correlation gave wrong assignments in more than 60% of cells in MCA lung data.</p>
      <p>We take a closer look at the results on Rosenberg dataset. As shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>a and b, averagely marker genes have zero expression in 72% of the cells of their corresponding types. Figure <xref rid="Fig3" ref-type="fig">3</xref> shows the detailed cell-type calling results of scSorter and the other four methods, visualized on the two-dimensional space produced by UMAP [<xref ref-type="bibr" rid="CR30">30</xref>]. Take two cell types, Astrocyte and OPC, as examples. Compared to scSorter, which called the cell types correctly for most cells in both cell types, SCINA, Garnett, and CellAssign failed to make an assignment (i.e., assigned to “Unknown”) for a significant proportion of cells. The higher calling rate of scSorter on these two cell types should be easy to understand from Fig. <xref rid="Fig1" ref-type="fig">1</xref>b, as every marker gene from these cell types have zero expression in more than 60% of cells in the corresponding cell type. In this case, while scSorter might efficiently utilize expression of non-marker genes to help make an assignment, SCINA, Garnett, and CellAssign might just give up. We also found Garnett mistakenly assigned a large proportion of cells lying on the rightmost tip of the OPC cluster into the Oligo cell type, which scSorter did not. This indicates that even when some marker genes are expressed (especially, <italic>Mbp</italic> and <italic>Bcas1</italic> for Oligo, as shown in Fig. <xref rid="Fig1" ref-type="fig">1</xref>), scSorter may be able to efficiently use the expression of non-marker genes to adjust or correct the decision made by marker genes; this could be the case if the evidence from marker genes are weak but the evidence from non-marker genes are of high confidence. A detailed discussion regarding this is available in the “The OPC and Oligo cell types in Rosenberg data” section of Additional file <xref rid="MOESM1" ref-type="media">1</xref>.
<fig id="Fig3"><label>Fig. 3</label><caption><p>UMAP plots of Rosenberg data. The first panel is colored by true cell types. The other five panels are colored by cell types assigned by the corresponding methods</p></caption><graphic xlink:href="13059_2021_2281_Fig3_HTML" id="MO3"/></fig></p>
      <p>TM pancreas dataset is somewhat different. As Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S1A&amp;B shows, only seven out of 25 marker genes have zero expression in more than 10% of the cells in their corresponding cell types. That means that only relying on the expression of marker genes might be enough to give accurate cell type calling. Indeed, SCINA and CellAssign, both of which use only marker gene expression, performed comparably to scSorter (misclassification rates 0.0659 from SCINA and 0.0512 from CellAssign, compared to 0.0550 from scSorter). Garnett somehow performed much worse (misclassification rate 0.1753). Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S2 shows the detailed cell-type calling results visualized by UMAP.</p>
      <p>The expression of marker genes in MCA lung dataset is highly inconsistent. Not only 74% of all marker genes have zero expression in over a half of cells of their corresponding types, as shown in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S3B, but also a non-negligible proportion of marker genes are highly expressed in cells out of the cell types in which they are specified. For example, <italic>Cd74</italic> (to highlight, we colored this gene name red in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S3A) is the marker gene of both dendritic cells and macrophage cells, but it is also highly expressed in most B cells and a majority of alveolar cells. As another example, <italic>H2-ebt</italic>, <italic>H2-aa</italic>, and <italic>H2-ab1</italic> (all highlighted in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S3A) are marker genes of dendritic cells, but they are also highly expressed in a majority of B cells and a significant proportion of macrophage cells. On this data, scSorter gave much superior performance over SCINA and Garnett, reducing their misclassification rates by about two thirds (scSorter 0.0831 vs. SCINA 0.2431 vs. Garnett 0.2574). Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S4 shows the detailed cell-type calling results visualized by UMAP. Looking more closely, we found that while scSorter correctly assigned 97.8% of alveolar cells, SCINA and Garnett assigned only 91.5% and 75.1%, respectively. SCINA also failed to cluster significant proportions of endothelial cells and dendritic cells, and Garnett failed in significant proportions of dendritic cells and B cells. The result on this dataset indicates that scSorter is capable of dealing with challenging datasets where the marker genes have highly variable and non-specific expression. SC3+correlation failed miserably on this dataset by failing to assign over 60% of cells. Actually, among the ten known cell types, it only called three cell types: granulocytes, fibroblasts, and alveolar. This could reflect a problem of such straightforward two-step approaches: the first step, clustering, does not take advantage of the list of known marker genes. Such an “unguided” first step is less likely to identify clusters that reflect the true cell types (i.e., cell clusters that users desire), and if the first step fails, the whole algorithm will fail almost inevitably.</p>
      <p>Marker genes in PBMC data also tend to have zero expression in their corresponding cell types, as shown in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S5A&amp;B. The average proportion is about 67%. This could be the reason that SCINA, a method that merely relies on the expression of marker genes, performed much worse than scSorter and Garnett. Another algorithm, CellAssign, performed even worse than SCINA. The reason could be that this data has highly imbalanced numbers of cells in different cell types, and CellAssign tends to fail on such datasets (see Additional file <xref rid="MOESM1" ref-type="media">1</xref> for detail). The marginally better performance of scSorter compared to Garnett was largely due to its success in assigning a larger proportion (98.0% vs. 94.9%) of T cells to the right cell type instead of labeling them as unknown. Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S6 shows the detailed cell-type calling results visualized by UMAP.</p>
      <p>CBMC data shares cell types with PBMC data. The average proportion of zero expression observed on marker genes in their corresponding cell types, as shown in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S7, is about 55%, lower than that of PBMC data. scSorter performed the best among all methods under comparison. The improved performance of the other methods on this data, compared to PBMC data, could be due to the lower proportion of zeros on marker genes and to the more balanced sizes of different cell types. Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Figure S8 shows the detailed results for cell-type calling visualized by UMAP.</p>
    </sec>
  </sec>
  <sec id="Sec10" sec-type="discussion">
    <title>Discussion</title>
    <p>scSorter is easy to tune up. Practically, only one parameter, the weight(s) for marker genes (<italic>w</italic><sub><italic>ik</italic></sub> in Eq. <xref rid="Equ1" ref-type="">1</xref>) needs to be specified manually. As we have discussed, larger <italic>w</italic><sub><italic>ik</italic></sub> values reflect more confidence in the correctness/applicability of marker genes. This way, users may be easier to decide whether to add marker genes they are not very sure about: just add them with smaller weights. When no information about confidence levels of marker genes is available, simply putting a common weight is suggested. In all the calculations of this paper, we used a common weight 2.0, meaning that the contribution of marker genes in deciding the assignments is roughly two times that of non-marker genes. To study the sensitivity of scSorter to different values of this common weight, we ran scSorter on all simulated data and real datasets with three different weights: 1.0, 2.0, and 5.0. Misclassification rates under different weights are shown in Fig. <xref rid="Fig4" ref-type="fig">4</xref>a and b. We see that the weight parameter has a minor to moderate effect on the performance. While different datasets have different optimum weights, 2.0 is a decent choice on all our simulated data and real datasets. We set 2.0 as the default value for our R package, which is named scSorter and freely available on CRAN.
<fig id="Fig4"><label>Fig. 4</label><caption><p>The performance of scSorter with three choices (1.0, 2.0, 5.0) of marker gene weight. <bold>a</bold> The performance of scSorter on simulated data with three choices of marker gene weight. <bold>b</bold> The performance of scSorter on five real datasets with three choices of marker gene weight</p></caption><graphic xlink:href="13059_2021_2281_Fig4_HTML" id="MO4"/></fig></p>
    <p>scSorter has a “flat” clustering scheme. While it can surely be used for data with cell type hierarchy, it does not particularly take advantage of the hierarchy information. In the “<xref rid="Sec2" ref-type="sec">Results</xref>” section, when we applied it on PBMC data, we combined the two subtypes of T cells, CD4+ and CD8+. If the CD4+ and CD8+ were treated as two cell types, the misclassification rate for scSorter, Garnett, SCINA, CellAssign, and SC3+correlation would instead be 0.1302, 0.0819, 0.3157, 0.6739, and 0.5137, respectively. We see that while scSorter still significantly outperformed SCINA, CellAssign, and SC3+correlation, Garnett outperformed scSorter. The outperformance of Garnett over scSorter, however, was not consistent across all cell types: while scSorter misclassified 13.0% of CD4+ T cells and 11.7% of CD8+ T cells, Garnett misclassified 1.7% of CD4+ T cells and 15.8% CD8+ T cells.</p>
    <p>In our real data analysis, we used the “vst” method in Seurat to choose highly variable genes. We also tried two other methods in Seurat, “mean-variance-plot” and “dispersion”, and found that the misclassification rate (given in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S1) of scSorter barely changed, suggesting that the performance of scSorter is rather stable with different choices of highly variable genes.</p>
  </sec>
  <sec id="Sec11" sec-type="conclusion">
    <title>Conclusions</title>
    <p>We have presented scSorter, an algorithm that assigns cells to known cell types based on the identities of marker genes. scSorter is based on the observation that marker genes, which are expected to express in higher levels in the corresponding cell types, may in practice express at a very low level in many of those cells. scSorter takes full use of such feature and allows cells to express either at an elevated level or a base level, without a direct penalty. Another important characteristic of scSorter is the explicit utilization of expression profiles of both marker genes and non-marker genes. By combining them, scSorter is able to not only call more cells but also make more accurate calls. The superior performance of scSorter has been demonstrated in both simulated and real datasets. Its improvement over existing methods was substantial.</p>
  </sec>
  <sec id="Sec12">
    <title>Methods</title>
    <sec id="Sec13">
      <title>Notations and settings</title>
      <p>Suppose there are <italic>K</italic> known cell types. For each cell type, there are a certain number of marker genes, and we have <italic>g</italic> marker genes in total, that is, <italic>g</italic> genes are markers for at least one cell type. Except for these <italic>g</italic> genes, we also consider <italic>h</italic> non-marker genes. That is, we consider <italic>g</italic>+<italic>h</italic> genes in total.</p>
      <p>Suppose we have <italic>N</italic> cells, and then the expression data we consider can be written as a matrix <bold><italic>X</italic></bold> of dimension (<italic>g</italic>+<italic>h</italic>)×<italic>N</italic>, with element <italic>X</italic><sub><italic>ij</italic></sub> being the expression of gene <italic>i</italic> in cell <italic>j</italic>, <italic>i</italic>=1,…,<italic>g</italic>+<italic>h</italic> and <italic>j</italic>=1,…,<italic>N</italic>. Without loss of generality, we assume the first <italic>g</italic> genes are marker genes, and the remaining <italic>h</italic> genes are highly variable genes. We also assume the gene expression has been properly normalized for the library size and has been properly transformed (e.g., log-transformation) to stabilize the variance.</p>
      <p>Suppose the prior knowledge of marker genes (i.e., which gene is the marker gene for which cell type) is summarized as an indicator matrix <bold><italic>Γ</italic></bold> of dimension <italic>g</italic>×<italic>K</italic>, with <italic>γ</italic><sub><italic>ik</italic></sub>=1 denoting that gene <italic>i</italic> is a marker gene of cell type <italic>k</italic> and <italic>γ</italic><sub><italic>ik</italic></sub>=0 otherwise.</p>
      <p>To record the results of clustering, we let <italic>C</italic><sub><italic>k</italic></sub> be the index set of cells belonging to cell type (cluster) <italic>k</italic>. That is, <italic>j</italic>∈<italic>C</italic><sub><italic>k</italic></sub> means that cell <italic>j</italic> is assigned to cell type <italic>k</italic>. We let the number of cells in <italic>C</italic><sub><italic>k</italic></sub> be <italic>n</italic><sub><italic>k</italic></sub>.</p>
    </sec>
    <sec id="Sec14">
      <title>Step I: Clustering by solving a novel optimization problem</title>
      <p>scSorter proposes the following optimization problem: find <bold><italic>C</italic></bold>={<italic>C</italic><sub><italic>k</italic></sub>}<sub><italic>k</italic>=1,...,<italic>K</italic></sub>,<bold><italic>μ</italic></bold>={<italic>μ</italic><sub><italic>i</italic></sub>}<sub><italic>i</italic>=1,…,<italic>g</italic></sub>∪{<italic>μ</italic><sub><italic>ik</italic></sub>}<sub><italic>i</italic>=<italic>g</italic>+1,...,<italic>g</italic>+<italic>h</italic>,<italic>k</italic>=1,...,<italic>K</italic></sub>, and <bold><italic>δ</italic></bold>={<italic>δ</italic><sub><italic>ik</italic></sub>}<sub><italic>i</italic>=1,...,<italic>g</italic>;<italic>k</italic>=1,...,<italic>K</italic></sub> that 
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} {}\text{minimize} \quad &amp;\sum_{i=1}^{g}\sum_{k=1}^{K}\sum_{j \in C_{k}}w_{ik}\left [(x_{ij}-\mu_{i})^{2}I_{\gamma_{ik}=0}+\min((x_{ij}-\mu_{i}-\delta_{ik})^{2},(x_{ij}-\mu_{i})^{2}) I_{\gamma_{ik}=1}\right]  \\ + &amp;\sum_{i=g+1}^{g+h}\sum_{k=1}^{K}\sum_{j \in C_{k}}(x_{ij}-\mu_{ik})^{2}  \end{array} $$ \end{document}</tex-math><mml:math id="M2"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mtext>minimize</mml:mtext><mml:mspace width="1em"/></mml:mtd><mml:mtd class="align-2"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>min</mml:mo><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"><mml:mo>+</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2281_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>
        <disp-formula id="Equ2">
          <label>2</label>
          <alternatives>
            <tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} {}\text{subject to} \quad &amp;\delta_{ik} \geq 0,\qquad i=1,\ldots,g; k=1,\ldots,K.  \end{array} $$ \end{document}</tex-math>
            <mml:math id="M4">
              <mml:mtable class="align" columnalign="left">
                <mml:mtr>
                  <mml:mtd class="align-1">
                    <mml:mtext>subject to</mml:mtext>
                    <mml:mspace width="1em"/>
                  </mml:mtd>
                  <mml:mtd class="align-2">
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>δ</mml:mi>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mtext mathvariant="italic">ik</mml:mtext>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>≥</mml:mo>
                    <mml:mn>0</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mspace width="2em"/>
                    <mml:mi>i</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mo>…</mml:mo>
                    <mml:mo>,</mml:mo>
                    <mml:mi>g</mml:mi>
                    <mml:mo>;</mml:mo>
                    <mml:mi>k</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mo>…</mml:mo>
                    <mml:mo>,</mml:mo>
                    <mml:mi>K.</mml:mi>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:math>
            <graphic xlink:href="13059_2021_2281_Article_Equ2.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p>On the above, <italic>w</italic><sub><italic>ik</italic></sub> is a pre-specified weight (a positive constant) for marker gene <italic>i</italic> of known cell type <italic>k</italic>, <italic>i</italic>=1,…,<italic>g</italic>. A larger <italic>w</italic><sub><italic>ik</italic></sub> reflects more confidence in the role of gene <italic>i</italic> being a marker gene of cell type <italic>k</italic>. Based on the background biological knowledge, users can set proper <italic>w</italic><sub><italic>ik</italic></sub> values accordingly. When such knowledge is not available, we suggest simply choosing a constant value for all marker genes: <italic>w</italic><sub><italic>ik</italic></sub>=<italic>w</italic><sub>0</sub>·<italic>h</italic>/<italic>g</italic>. Considering that there are in total <italic>g</italic> marker genes and <italic>h</italic> non-marker genes, this choice means that the overall contribution of the marker genes to target function is <italic>w</italic><sub>0</sub> times of the non-marker genes. In this case, <italic>w</italic><sub>0</sub> reflects how much we want to rely on the marker genes in determining the cell types. In all data analysis of this paper, we use this simple choice with <italic>w</italic><sub>0</sub>=2.</p>
      <p>In Eq. <xref rid="Equ1" ref-type="">1</xref>, for a non-marker gene (i.e., <italic>g</italic>+1≤<italic>i</italic>≤<italic>g</italic>+<italic>h</italic>), the cost of assigning cell <italic>j</italic> to cluster <italic>k</italic> is defined as (<italic>x</italic><sub><italic>ij</italic></sub>−<italic>μ</italic><sub><italic>ik</italic></sub>)<sup>2</sup>. It is actually easy to show (see Additional file <xref rid="MOESM1" ref-type="media">1</xref> for details) that the solution for <italic>μ</italic><sub><italic>ik</italic></sub> is the centroid (mean expression level) of cluster <italic>k</italic>. Thus, this cost on each non-marker gene <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sum _{k=1}^{K}\sum _{j \in C_{k}}(x_{ij}-\mu _{ik})^{2}$\end{document}</tex-math><mml:math id="M6"><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq1.gif"/></alternatives></inline-formula> is the sum of distances from each cell to the corresponding centroid, which is exactly the same as the regular K-means algorithm.</p>
      <p>On the other hand, for a marker gene (i.e., <italic>i</italic>≤<italic>g</italic>), the cost is defined in a different way. In Eq. <xref rid="Equ1" ref-type="">1</xref>, <italic>I</italic><sub>condition</sub> is the “indicator function,” which equals 1 when the condition holds and equals 0 otherwise, and min(·,·) means the smaller of the two items in the parentheses. For gene <italic>i</italic> that is a marker gene for cell type <italic>k</italic>, its expression is assumed to be <italic>μ</italic><sub><italic>i</italic></sub> for cells not in cell type <italic>k</italic> (i.e., <italic>γ</italic><sub><italic>ik</italic></sub>=0), and assumed to be either <italic>μ</italic><sub><italic>i</italic></sub>+<italic>δ</italic><sub><italic>ik</italic></sub> or <italic>μ</italic><sub><italic>i</italic></sub>, whichever is closer to <italic>x</italic><sub><italic>ij</italic></sub>, for cells in cell type <italic>k</italic> (<italic>γ</italic><sub><italic>ik</italic></sub>=1). Considering that <italic>μ</italic><sub><italic>i</italic></sub>+<italic>δ</italic><sub><italic>ik</italic></sub>≥<italic>μ</italic><sub><italic>i</italic></sub>, which is guaranteed by the constraint (i.e., Eq. <xref rid="Equ2" ref-type="">2</xref>), we call <italic>μ</italic><sub><italic>i</italic></sub>+<italic>δ</italic><sub><italic>ik</italic></sub> the elevated (expression) level, and <italic>μ</italic><sub><italic>i</italic></sub> the base (expression) level. By letting the expression of a marker gene in its corresponding cell type to freely choose from the elevated and the base levels, we accommodate the observation that marker genes may not be over-expressed in a significant proportion of cells of the corresponding type. Their expression may actually be at the base level, i.e., similar to their expression in other cell types.</p>
    </sec>
    <sec id="Sec15">
      <title>The solution to step I</title>
      <p>Although having many unique features, our target function, Eq. <xref rid="Equ1" ref-type="">1</xref>, looks similar to that of the classic K-means clustering algorithm. And just like K-means, overall our target function is a combinatorial optimization problem, and there is no easy algorithm that guarantees to find the global optimum. Meanwhile, we have found that the idea of solving K-means, alternatively optimizing the cluster assignments and the centriods, works highly efficiently for our optimization problem in finding a local optimum. The alternative optimization in scSorter is as follows. 
<list list-type="order"><list-item><p>Keeping <bold><italic>μ</italic></bold> and <bold><italic>δ</italic></bold> unchanged, update <bold><italic>C</italic></bold>. This can be done by assigning cell <italic>j</italic> to the cluster that gives the smallest cost: 
<disp-formula id="Equa"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \sum_{i=1}^{g}w_{ik}\left [(x_{ij}-\mu_{i})^{2}I_{\gamma_{ik}=0}+\min((x_{ij}-\mu_{i}-\delta_{ik})^{2},(x_{ij}-\mu_{i})^{2}) I_{\gamma_{ik}=1}\right] + \sum_{i=g+1}^{g+h}(x_{ij}-\mu_{ik})^{2}. $$ \end{document}</tex-math><mml:math id="M8"><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>min</mml:mo><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:munderover><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi>.</mml:mi></mml:mrow></mml:math><graphic xlink:href="13059_2021_2281_Article_Equa.gif" position="anchor"/></alternatives></disp-formula></p></list-item><list-item><p>Keeping <bold><italic>C</italic></bold> unchanged, update <bold><italic>μ</italic></bold> and <bold><italic>δ</italic></bold>. Note that our target function is separable on <italic>i</italic> (i.e., genes), and thus solving <bold><italic>μ</italic></bold> and <bold><italic>δ</italic></bold> can be done by solving them for each gene independently.</p><p>For non-marker genes, <italic>μ</italic><sub><italic>ik</italic></sub> has a simple closed-form solution: <inline-formula id="IEq2"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\hat {\mu }_{ik}=\frac {1}{n_{k}}\sum _{j \in C_{k}}x_{ij}$\end{document}</tex-math><mml:math id="M10"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq2.gif"/></alternatives></inline-formula>. For marker genes, <italic>μ</italic><sub><italic>i</italic></sub> and <italic>δ</italic><sub><italic>ik</italic></sub> do not have closed-form solutions, and we solve them by repetitively updating one given the other using the following two formulas 
<disp-formula id="Equb"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \hat{\delta}_{ik} = &amp;\frac{\sum_{j \in C_{k}}(x_{ij}-\hat{\mu}_{i})I_{\gamma_{ik}=1}I_{x_{ij}&gt;\hat{\mu}_{i}+\hat{\delta}_{ik}/2}}{\sum_{j \in C_{k}}I_{\gamma_{ik}=1}I_{x_{ij}&gt;\hat{\mu}_{i}+\hat{\delta}_{ik}/2}}\\ \hat{\mu}_{i} = &amp;\frac{\sum_{k = 1}^{K} \sum_{j \in C_{k}} w_{ik} x_{ij} - \sum_{k = 1}^{K} \sum_{j \in C_{k}} w_{ik} \hat{\delta}_{ik}I_{\gamma_{ik}=1}I_{x_{ij}&gt;\hat{\mu}_{i}+\hat{\delta}_{ik}/2}}{\sum_{k = 1}^{K} \sum_{j \in C_{k}} w_{ik}} \end{array} $$ \end{document}</tex-math><mml:math id="M12"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:mfrac><mml:mrow><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:mfrac><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2281_Article_Equb.gif" position="anchor"/></alternatives></disp-formula></p><p>until convergence.</p></list-item></list></p>
      <p>Detailed derivations of the formulas are given in Additional file <xref rid="MOESM1" ref-type="media">1</xref>. With these formulas, scSorter initializes <bold><italic>C</italic></bold> by randomly assigning cells to cell types, and then it alternatively updates {<bold><italic>μ</italic></bold>,<bold><italic>δ</italic></bold>} and <bold><italic>C</italic></bold> until the cell type assignment <bold><italic>C</italic></bold> does not change, indicating convergence to a (local) optimum.</p>
    </sec>
    <sec id="Sec16">
      <title>Step II: Unknown cell-type calling</title>
      <p>In step I, all cells are forced to be clustered into <italic>K</italic> clusters. In another word, cells that are actually not from any of the known cell types will still be forced to join one of the clusters. In this case, an unknown cell may be clustered into a cluster, say cluster 1, not because it is actually from the known cell type 1, but because comparing to other clusters, it is (may be just slightly) closer to (the centroid of) cluster 1. This cell may actually not be very similar to cell type 1, but as far as it is more similar to cell type 1 compared to other known cell types, assigning it to cluster 1 would still be the best choice in step I. Our task in step II, is to disengage it from cell type 1, which is done by testing whether its similarity to cell type 1 is sufficiently high.</p>
      <p>Given the solution to our optimization problem in step I, for marker gene <italic>i</italic> for the <italic>k</italic>’th known cell type, its expression in cell <italic>j</italic>, which has been clustered into cluster <italic>k</italic> in step I, is at the base level if min((<italic>x</italic><sub><italic>ij</italic></sub>−<italic>μ</italic><sub><italic>i</italic></sub>−<italic>δ</italic><sub><italic>ik</italic></sub>)<sup>2</sup>,(<italic>x</italic><sub><italic>ij</italic></sub>−<italic>μ</italic><sub><italic>i</italic></sub>)<sup>2</sup>)=(<italic>x</italic><sub><italic>ij</italic></sub>−<italic>μ</italic><sub><italic>i</italic></sub>)<sup>2</sup>, or equivalently, <italic>x</italic><sub><italic>ij</italic></sub>≤<italic>μ</italic><sub><italic>i</italic></sub>+<italic>δ</italic><sub><italic>ik</italic></sub>/2, and its expression is at the elevated level otherwise. Suppose <italic>α</italic><sub><italic>kj</italic></sub> proportion of the marker genes for cell type <italic>k</italic> are expressed at the elevated level in cell <italic>j</italic>, i.e., <inline-formula id="IEq3"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\alpha _{kj} = \sum _{i=1}^{g} I_{\gamma _{ik} = 1} I_{x_{ij} &gt; \mu _{i}+\delta _{ik}/2} / \sum _{i=1}^{g} I_{\gamma _{ik} = 1}$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">kj</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq3.gif"/></alternatives></inline-formula>. We use <italic>α</italic><sub><italic>kj</italic></sub> to group cells in cluster <italic>k</italic>, i.e., <italic>C</italic><sub><italic>k</italic></sub>, to two sets: (1) set <italic>D</italic><sub><italic>k</italic></sub>; cells in this set have <italic>α</italic><sub><italic>kj</italic></sub>&gt;<italic>α</italic><sub>0</sub>, where <italic>α</italic><sub>0</sub> is a pre-specified constant. (2) set <italic>U</italic><sub><italic>k</italic></sub>; cells in this set have <italic>α</italic><sub><italic>kj</italic></sub>≤<italic>α</italic><sub>0</sub>. (We use <italic>D</italic> and <italic>U</italic> for these two sets as they are the preceding letters of “decided” and “undecided” respectively, for easy memory.) In another word, <italic>D</italic><sub><italic>k</italic></sub> contains cells that are clustered in cluster <italic>k</italic> and have at least a certain proportion of known marker genes expressed at an elevated level; scSorter will claim these cells to be from cell type <italic>k</italic> without further investigation. On the other hand, cells in <italic>U</italic><sub><italic>k</italic></sub> have a large proportion of marker genes (unexpectedly) expressed at the base level; scSorter will further screen these cells one by one and see whether each of them looks “similar enough” to cells in set <italic>D</italic><sub><italic>k</italic></sub>, those that have already been believed to be truly from cell type <italic>k</italic>. This check relies on the expression of non-marker genes.</p>
      <p>For <italic>j</italic>∈<italic>U</italic><sub><italic>k</italic></sub>, define a z-score <inline-formula id="IEq4"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$z_{ij} = \frac {x_{ij} - \nu _{ik}}{\sigma _{ik}}$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ν</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq4.gif"/></alternatives></inline-formula> for each non-marker genes <italic>i</italic>, <italic>i</italic>=<italic>g</italic>+1,…,<italic>g</italic>+<italic>h</italic>. Here <inline-formula id="IEq5"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\nu _{ik} = \frac {1}{|D_{k}|}\sum _{j \in D_{k}}x_{ij}$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mi>ν</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq5.gif"/></alternatives></inline-formula> and <inline-formula id="IEq6"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sigma _{ik}=\sqrt {\frac {1}{|D_{k}|-1}\sum _{j \in D_{k}}(x_{ij}-\nu _{ik})^{2}}$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>ν</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:msqrt></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq6.gif"/></alternatives></inline-formula>, where |<italic>D</italic><sub><italic>k</italic></sub>| denotes the number of items in set <italic>D</italic><sub><italic>k</italic></sub>. Note that here both <italic>ν</italic><sub><italic>ik</italic></sub> and <italic>σ</italic><sub><italic>ik</italic></sub> are estimated using <italic>D</italic><sub><italic>k</italic></sub>. Further, we define <inline-formula id="IEq7"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$d_{jk} = \sum _{i=g+1}^{g+h}z^{2}_{ij}$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jk</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:munderover><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq7.gif"/></alternatives></inline-formula> and <inline-formula id="IEq8"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\beta _{jk}=F_{\chi ^{2}_{h}}(d_{jk})$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jk</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>χ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jk</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq8.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq9"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$F_{\chi ^{2}_{h}}$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>χ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq9.gif"/></alternatives></inline-formula> is the cumulative distribution function of a <italic>χ</italic><sup>2</sup> distribution with degrees of freedom <italic>h</italic>. Thus, if this cell <italic>j</italic>, which is in <italic>U</italic><sub><italic>k</italic></sub>, has similar expression profile to those cells in <italic>D</italic><sub><italic>k</italic></sub> on non-marker genes, <italic>d</italic><sub><italic>jk</italic></sub> should approximately follow a <italic>χ</italic><sup>2</sup> distribution with degrees of freedom <italic>h</italic>, and so <italic>β</italic><sub><italic>jk</italic></sub> should be uniformly distributed between 0 and 1. Otherwise, <italic>d</italic><sub><italic>jk</italic></sub> should be larger, and <italic>β</italic><sub><italic>jk</italic></sub> should be closer to 1. Accordingly, using a cutoff <italic>θ</italic><sub><italic>k</italic></sub>, scSorter declares cells with <italic>β</italic><sub><italic>jk</italic></sub>≤<italic>θ</italic><sub><italic>k</italic></sub> as in cell type <italic>k</italic> and cells with <italic>β</italic><sub><italic>jk</italic></sub>&gt;<italic>θ</italic><sub><italic>k</italic></sub> as in “unknown cell type.”</p>
      <p>scSorter uses the following algorithm to automatically select <italic>θ</italic><sub><italic>k</italic></sub>. Since cells in cluster <italic>k</italic> identified in step I are divided into set <inline-formula id="IEq10"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$D_{k}^{*} = D_{k} \cup (U_{k} \cap \{j; \beta _{jk} \le \theta _{k}\})$\end{document}</tex-math><mml:math id="M28"><mml:msubsup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∪</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:mo>{</mml:mo><mml:mi>j</mml:mi><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jk</mml:mtext></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq10.gif"/></alternatives></inline-formula>, which contains cells that are declared as in cell type <italic>k</italic>, and set <inline-formula id="IEq11"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$U_{k}^{*} = U_{k} \cap \{j; \beta _{jk} &gt; \theta _{k}\}$\end{document}</tex-math><mml:math id="M30"><mml:msubsup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:mo>{</mml:mo><mml:mi>j</mml:mi><mml:mo>;</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jk</mml:mtext></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq11.gif"/></alternatives></inline-formula>, which contains cells declared as unknown, we search <italic>θ</italic><sub><italic>k</italic></sub> value that minimizes 
<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ S_{k} = \sum_{i=g+1}^{g+h}\left[\sum_{j\in D_{k}^{*}}\left(x_{ij} - \bar{x}_{iD^{*}_{k}}\right)^{2} + \sum_{j\in U_{k}^{*}}\left(x_{ij} - \bar{x}_{iU^{*}_{k}}\right)^{2}\right]   $$ \end{document}</tex-math><mml:math id="M32"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:munderover><mml:mfenced close="]" open="["><mml:mrow><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msubsup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msubsup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msubsup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2281_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>in the range of <inline-formula id="IEq12"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\left [F_{\chi ^{2}_{h}}(h+\sqrt {2h}), 1\right ]$\end{document}</tex-math><mml:math id="M34"><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>χ</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>h</mml:mi><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mi>h</mml:mi></mml:mrow></mml:msqrt><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq12.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq13"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$h+\sqrt {2h}$\end{document}</tex-math><mml:math id="M36"><mml:mi>h</mml:mi><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mi>h</mml:mi></mml:mrow></mml:msqrt></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq13.gif"/></alternatives></inline-formula> is the value that is one standard deviation on the right side of the mean of a <italic>χ</italic><sup>2</sup> distribution with degrees of freedom <italic>h</italic>. In Eq. <xref rid="Equ3" ref-type="">3</xref>, <inline-formula id="IEq14"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {x}_{iD^{*}_{k}}$\end{document}</tex-math><mml:math id="M38"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msubsup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq14.gif"/></alternatives></inline-formula> and <inline-formula id="IEq15"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\bar {x}_{iU^{*}_{k}}$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msubsup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq15.gif"/></alternatives></inline-formula> are the average <italic>x</italic><sub><italic>ij</italic></sub> values in set <inline-formula id="IEq16"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$D^{*}_{k}$\end{document}</tex-math><mml:math id="M42"><mml:msubsup><mml:mrow><mml:mi>D</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq16.gif"/></alternatives></inline-formula> and set <inline-formula id="IEq17"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$U^{*}_{k}$\end{document}</tex-math><mml:math id="M44"><mml:msubsup><mml:mrow><mml:mi>U</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq17.gif"/></alternatives></inline-formula>, respectively.</p>
      <p>After step I (solving the optimization problem defined by Eqs. <xref rid="Equ1" ref-type="">1</xref> and <xref rid="Equ2" ref-type="">2</xref>) and step II (unknown cell-type calling), all cells will be assigned, either to known cell types or as unknown. One problem, though, is that the assignment could be sub-optimum because the solution in step I could be only a local optimum. To mitigate this problem, we use the same strategy as that in K-means: we run the algorithm multiple times (ten times by default) with different initial values of <bold><italic>C</italic></bold> and choose the one that minimizes the final cost function, which we define as the cost function expressed in Eq. <xref rid="Equ1" ref-type="">1</xref> with the second set of terms, <inline-formula id="IEq18"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sum _{i=g+1}^{g+h}\sum _{k=1}^{K}\sum _{j \in C_{k}}(x_{ij}-\mu _{ik})^{2}$\end{document}</tex-math><mml:math id="M46"><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:munderover><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq18.gif"/></alternatives></inline-formula>, replaced by <inline-formula id="IEq19"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\sum _{k=1}^{K} S_{k}$\end{document}</tex-math><mml:math id="M48"><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq19.gif"/></alternatives></inline-formula>, where <italic>S</italic><sub><italic>k</italic></sub> is defined by Eq. <xref rid="Equ3" ref-type="">3</xref>. This strategy appears to work nicely (see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Table S2).</p>
    </sec>
    <sec id="Sec17">
      <title>Alternative approaches</title>
      <p>Before settling down with the optimization problem (Eqs. <xref rid="Equ1" ref-type="">1</xref> and <xref rid="Equ2" ref-type="">2</xref>) in step I, we have tried several other possible ways to formulate our clustering problem into an optimization problem. We have proposed the solution to each of them, written code to implement them, and run them on simulated data. They all have much inferior performance compared to the optimization problem we finally settled down with. Here we briefly describe these alternative forms of the optimization problem and give an explanation why they do not perform as well. The algorithms that solve each of these problems are given in Additional file <xref rid="MOESM1" ref-type="media">1</xref>. We think this content may be of interest to researchers who would like to further improve over scSorter, and it may also help to understand the reason why scSorter works well.</p>
      <p>The first alternative is: find <bold><italic>C</italic></bold>={<italic>C</italic><sub><italic>k</italic></sub>}<sub><italic>k</italic>=1,...,<italic>K</italic></sub> and <bold><italic>μ</italic></bold>={<italic>μ</italic><sub><italic>ik</italic></sub>}<sub><italic>i</italic>=1,...,<italic>g</italic>+<italic>h</italic>,<italic>k</italic>=1,...,<italic>K</italic></sub> that 
<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \text{minimize} \qquad &amp;\sum_{i=1}^{g}\sum_{k=1}^{K}\sum_{j \in C_{k}}w_{ik}(x_{ij}-\mu_{ik})^{2} + \sum_{i=g+1}^{g+h}\sum_{k=1}^{K}\sum_{j \in C_{k}}(x_{ij}-\mu_{ik})^{2}  \end{array} $$ \end{document}</tex-math><mml:math id="M50"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mtext>minimize</mml:mtext><mml:mspace width="2em"/></mml:mtd><mml:mtd class="align-2"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2281_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>
        <disp-formula id="Equ5">
          <label>5</label>
          <alternatives>
            <tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \text{subject to} \qquad &amp;\left(\mu_{ik} - \frac{1}{N}\sum_{j=1}^{N}x_{ij}\right)I_{\gamma_{ik} = 1} \geq 0,\qquad i=1,\ldots,g; k=1,\ldots,K.  \end{array} $$ \end{document}</tex-math>
            <mml:math id="M52">
              <mml:mtable class="align" columnalign="left">
                <mml:mtr>
                  <mml:mtd class="align-1">
                    <mml:mtext>subject to</mml:mtext>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                  <mml:mtd class="align-2">
                    <mml:mfenced close=")" open="(">
                      <mml:mrow>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>μ</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">ik</mml:mtext>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>−</mml:mo>
                        <mml:mfrac>
                          <mml:mrow>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mi>N</mml:mi>
                          </mml:mrow>
                        </mml:mfrac>
                        <mml:munderover accent="false" accentunder="false">
                          <mml:mrow>
                            <mml:mo mathsize="big">∑</mml:mo>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mi>j</mml:mi>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mi>N</mml:mi>
                          </mml:mrow>
                        </mml:munderover>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>x</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">ij</mml:mtext>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                    </mml:mfenced>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>I</mml:mi>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>γ</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">ik</mml:mtext>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>≥</mml:mo>
                    <mml:mn>0</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mspace width="2em"/>
                    <mml:mi>i</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mo>…</mml:mo>
                    <mml:mo>,</mml:mo>
                    <mml:mi>g</mml:mi>
                    <mml:mo>;</mml:mo>
                    <mml:mi>k</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mo>…</mml:mo>
                    <mml:mo>,</mml:mo>
                    <mml:mi>K.</mml:mi>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:math>
            <graphic xlink:href="13059_2021_2281_Article_Equ5.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p>The second alternative is: find <bold><italic>C</italic></bold>={<italic>C</italic><sub><italic>k</italic></sub>}<sub><italic>k</italic>=1,...,<italic>K</italic></sub> and <bold><italic>μ</italic></bold>={<italic>μ</italic><sub><italic>ik</italic></sub>}<sub><italic>i</italic>=1,...,<italic>g</italic>+<italic>h</italic>,<italic>k</italic>=1,...,<italic>K</italic></sub> that 
<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \text{minimize} \qquad &amp;\sum_{i=1}^{g}\sum_{k=1}^{K}\sum_{j \in C_{k}}w_{ik}(x_{ij}-\mu_{ik})^{2} + \sum_{i=g+1}^{g+h}\sum_{k=1}^{K}\sum_{j \in C_{k}}(x_{ij}-\mu_{ik})^{2}  \end{array} $$ \end{document}</tex-math><mml:math id="M54"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mtext>minimize</mml:mtext><mml:mspace width="2em"/></mml:mtd><mml:mtd class="align-2"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2281_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>
        <disp-formula id="Equ7">
          <label>7</label>
          <alternatives>
            <tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \text{subject to} \qquad &amp;\min_{k \in \{k; I_{\gamma_{ik}=1}\}}\mu_{ik} \geq \max_{k \in \{k; I_{\gamma_{ik}=0}\}}\mu_{ik},\qquad i=1,\ldots,g.  \end{array} $$ \end{document}</tex-math>
            <mml:math id="M56">
              <mml:mtable class="align" columnalign="left">
                <mml:mtr>
                  <mml:mtd class="align-1">
                    <mml:mtext>subject to</mml:mtext>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                  <mml:mtd class="align-2">
                    <mml:munder>
                      <mml:mrow>
                        <mml:mo>min</mml:mo>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mo>{</mml:mo>
                        <mml:mi>k</mml:mi>
                        <mml:mo>;</mml:mo>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>I</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:msub>
                              <mml:mrow>
                                <mml:mi>γ</mml:mi>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">ik</mml:mtext>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>=</mml:mo>
                            <mml:mn>1</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>}</mml:mo>
                      </mml:mrow>
                    </mml:munder>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>μ</mml:mi>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mtext mathvariant="italic">ik</mml:mtext>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>≥</mml:mo>
                    <mml:munder>
                      <mml:mrow>
                        <mml:mo>max</mml:mo>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:mo>{</mml:mo>
                        <mml:mi>k</mml:mi>
                        <mml:mo>;</mml:mo>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>I</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:msub>
                              <mml:mrow>
                                <mml:mi>γ</mml:mi>
                              </mml:mrow>
                              <mml:mrow>
                                <mml:mtext mathvariant="italic">ik</mml:mtext>
                              </mml:mrow>
                            </mml:msub>
                            <mml:mo>=</mml:mo>
                            <mml:mn>0</mml:mn>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>}</mml:mo>
                      </mml:mrow>
                    </mml:munder>
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>μ</mml:mi>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mtext mathvariant="italic">ik</mml:mtext>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>,</mml:mo>
                    <mml:mspace width="2em"/>
                    <mml:mi>i</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mo>…</mml:mo>
                    <mml:mo>,</mml:mo>
                    <mml:mi>g.</mml:mi>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:math>
            <graphic xlink:href="13059_2021_2281_Article_Equ7.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p>The third alternative is: find <bold><italic>C</italic></bold>={<italic>C</italic><sub><italic>k</italic></sub>}<sub><italic>k</italic>=1,...,<italic>K</italic></sub>,<bold><italic>μ</italic></bold>={<italic>μ</italic><sub><italic>i</italic></sub>}<sub><italic>i</italic>=1,…,<italic>g</italic></sub>∪{<italic>μ</italic><sub><italic>ik</italic></sub>}<sub><italic>i</italic>=<italic>g</italic>+1,...,<italic>g</italic>+<italic>h</italic>,<italic>k</italic>=1,...,<italic>K</italic></sub>, and <bold><italic>δ</italic></bold>={<italic>δ</italic><sub><italic>ik</italic></sub>}<sub><italic>i</italic>=1,...,<italic>g</italic>;<italic>k</italic>=1,...,<italic>K</italic></sub> that 
<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \text{minimize} \qquad &amp;\sum_{i=1}^{g}\sum_{k=1}^{K}\sum_{j \in C_{k}}w_{ik}\left [(x_{ij}-\mu_{i})^{2}I_{\gamma_{ik}=0}+(x_{ij}-\mu_{i}-\delta_{ik})^{2}I_{\gamma_{ik}=1}\right]  \end{array} $$ \end{document}</tex-math><mml:math id="M58"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mtext>minimize</mml:mtext><mml:mspace width="2em"/></mml:mtd><mml:mtd class="align-2"><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>δ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="13059_2021_2281_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula></p>
      <p>
        <disp-formula id="Equ9">
          <label>9</label>
          <alternatives>
            <tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} + &amp;\sum_{i=g+1}^{g+h}\sum_{k=1}^{K}\sum_{j \in C_{k}}(x_{ij}-\mu_{ik})^{2} \end{array} $$ \end{document}</tex-math>
            <mml:math id="M60">
              <mml:mtable class="align" columnalign="left">
                <mml:mtr>
                  <mml:mtd class="align-1">
                    <mml:mo>+</mml:mo>
                  </mml:mtd>
                  <mml:mtd class="align-2">
                    <mml:munderover accent="false" accentunder="false">
                      <mml:mrow>
                        <mml:mo mathsize="big">∑</mml:mo>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>i</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mi>g</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>g</mml:mi>
                        <mml:mo>+</mml:mo>
                        <mml:mi>h</mml:mi>
                      </mml:mrow>
                    </mml:munderover>
                    <mml:munderover accent="false" accentunder="false">
                      <mml:mrow>
                        <mml:mo mathsize="big">∑</mml:mo>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>k</mml:mi>
                        <mml:mo>=</mml:mo>
                        <mml:mn>1</mml:mn>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>K</mml:mi>
                      </mml:mrow>
                    </mml:munderover>
                    <mml:munder>
                      <mml:mrow>
                        <mml:mo mathsize="big">∑</mml:mo>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mi>j</mml:mi>
                        <mml:mo>∈</mml:mo>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>C</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mi>k</mml:mi>
                          </mml:mrow>
                        </mml:msub>
                      </mml:mrow>
                    </mml:munder>
                    <mml:msup>
                      <mml:mrow>
                        <mml:mo>(</mml:mo>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>x</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">ij</mml:mtext>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>−</mml:mo>
                        <mml:msub>
                          <mml:mrow>
                            <mml:mi>μ</mml:mi>
                          </mml:mrow>
                          <mml:mrow>
                            <mml:mtext mathvariant="italic">ik</mml:mtext>
                          </mml:mrow>
                        </mml:msub>
                        <mml:mo>)</mml:mo>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mn>2</mml:mn>
                      </mml:mrow>
                    </mml:msup>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:math>
            <graphic xlink:href="13059_2021_2281_Article_Equ9.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p>
        <disp-formula id="Equ10">
          <label>10</label>
          <alternatives>
            <tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \text{subject to} \qquad &amp;\delta_{ik} \geq 0,\qquad i=1,\ldots,g; k=1,\ldots,K.  \end{array} $$ \end{document}</tex-math>
            <mml:math id="M62">
              <mml:mtable class="align" columnalign="left">
                <mml:mtr>
                  <mml:mtd class="align-1">
                    <mml:mtext>subject to</mml:mtext>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                  <mml:mtd class="align-2">
                    <mml:msub>
                      <mml:mrow>
                        <mml:mi>δ</mml:mi>
                      </mml:mrow>
                      <mml:mrow>
                        <mml:mtext mathvariant="italic">ik</mml:mtext>
                      </mml:mrow>
                    </mml:msub>
                    <mml:mo>≥</mml:mo>
                    <mml:mn>0</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mspace width="2em"/>
                    <mml:mi>i</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mo>…</mml:mo>
                    <mml:mo>,</mml:mo>
                    <mml:mi>g</mml:mi>
                    <mml:mo>;</mml:mo>
                    <mml:mi>k</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                    <mml:mo>,</mml:mo>
                    <mml:mo>…</mml:mo>
                    <mml:mo>,</mml:mo>
                    <mml:mi>K.</mml:mi>
                    <mml:mspace width="2em"/>
                  </mml:mtd>
                </mml:mtr>
              </mml:mtable>
            </mml:math>
            <graphic xlink:href="13059_2021_2281_Article_Equ10.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p>In the first alternative formation, note that when <italic>γ</italic><sub><italic>ik</italic></sub>=0 (gene <italic>i</italic> is not a marker gene of cell type <italic>k</italic>), the constraints (Eq. <xref rid="Equ5" ref-type="">5</xref>) are automatically satisfied. Thus, the constraints only take effect on marker genes, which have to satisfy <inline-formula id="IEq20"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mu _{ik} \ge \frac {1}{N}\sum _{j=1}^{N}x_{ij}$\end{document}</tex-math><mml:math id="M64"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ik</mml:mtext></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:munderover><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ij</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="13059_2021_2281_Article_IEq20.gif"/></alternatives></inline-formula>, i.e., the representative expression of marker gene should be no less than the overall average.</p>
      <p>In the first two alternative formations, a marker gene (i.e., <italic>i</italic>=1,…,<italic>g</italic>) has a different expression <italic>μ</italic><sub><italic>ik</italic></sub> in every cell type <italic>k</italic>. The constraints of the first formation (Eq. <xref rid="Equ5" ref-type="">5</xref>) are relatively weak: for a marker gene, although there is a constraint that its expression in cells of its corresponding cell type cannot be lower than its mean expression in all cells, there is no constraint on its expression in cells not of its corresponding cell type. As a result, the threshold for putting cells into a certain cell type is not high enough, and a large number of cells from other cell types, in which the marker genes of this cell type are also relatively highly expressed, may be incorrectly assigned to this type. The constraints in the second formation (Eq. <xref rid="Equ7" ref-type="">7</xref>) are much stronger. However, it is hard for every marker gene to satisfy these constraints, as its expression in cells of its corresponding cell type may, although high, not be higher than that in all the other clusters. As a result, the cells truly from a cell type, but in which the marker genes are not highly expressed, may be falsely excluded from this cell type. By using an elevated expression level <italic>μ</italic><sub><italic>i</italic></sub>+<italic>δ</italic><sub><italic>ik</italic></sub> to cells in cell type <italic>k</italic> and a common base expression level <italic>μ</italic><sub><italic>i</italic></sub> to all other cells, the third alternative formation has constraints with strength stronger than the first alternative but weaker than the second. However, it still does not allow each marker gene to freely choose between an elevated level and a base level and thus does not fit the data as properly as scSorter.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec18">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2021_2281_MOESM1_ESM.pdf">
            <caption>
              <p><bold>Additional file 1</bold> Supplementary Materials that include additional methods, results, and plots.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
      <p>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2021_2281_MOESM2_ESM.docx">
            <caption>
              <p><bold>Additional file 2</bold> Review history.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank Zixuan Song for proofreading the manuscript.</p>
    <sec id="d32e4924">
      <title>Review history</title>
      <p>The review history is available as Additional file <xref rid="MOESM2" ref-type="media">2</xref>.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>H.G. and J.L. conceived the study, proposed the methods, and implemented the methods. H.G. analyzed the data. H.G. and J.L. drafted and revised the manuscript. J.L. supervised the study. Both authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work is supported by NIH (R01GM120733 to J.L.), NSF (Award #1925645 to J.L.), American Cancer Society (RSG-17-206-01-TBG to J.L.), and Susan G. Komen Grant (CCR18548293 to J.L.).</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>scSorter is implemented in R and freely available on CRAN (<ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/">https://cran.r-project.org/</ext-link>) as an R package scSorter. [<xref ref-type="bibr" rid="CR31">31</xref>] using GPL-3 license. The analysis code is deposited in zenodo with DOI:10.5281/zenodo.4459645 [<xref ref-type="bibr" rid="CR32">32</xref>] using CC BY 4.0 license. The PBMC data is available from 10x Genomics website (<ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets">https://support.10xgenomics.com/single-cell-gene-expression/datasets</ext-link>) under section <italic>Single Cell 3’ Paper: Zheng et al. 2017</italic>. The TM Pancreas data is available from figshare (<ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/Single-cell_RNA-seq_data_from_Smart-seq2_sequencing_of_FACS_sorted_cells_v2_/5829687">https://figshare.com/articles/Single-cell_RNA-seq_data_from_Smart-seq2_sequencing_of_ FACS_sorted_cells_v2_/5829687</ext-link>). The MCA lung data is available from Gene Expression Omnibus (GEO) under accession number GSE108097. The Rosenberg data is available from GEO under accession number GSE110823.</p>
  </notes>
  <notes id="FPar1">
    <title>Ethics approval and consent to participate</title>
    <p>Not applicable.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p>The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rozenblatt-Rosen</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Stubbington</surname>
            <given-names>MJT</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
        </person-group>
        <article-title>The Human Cell Atlas: from vision to reality</article-title>
        <source>Nat News</source>
        <year>2017</year>
        <volume>550</volume>
        <issue>7677</issue>
        <fpage>451</fpage>
        <pub-id pub-id-type="doi">10.1038/550451a</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Traag</surname>
            <given-names>VA</given-names>
          </name>
          <name>
            <surname>Waltman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Eck</surname>
            <given-names>NJ</given-names>
          </name>
        </person-group>
        <article-title>From louvain to leiden: guaranteeing well-connected communities</article-title>
        <source>Sci Rep</source>
        <year>2019</year>
        <volume>9</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id>
        <pub-id pub-id-type="pmid">30626917</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Blondel</surname>
            <given-names>VD</given-names>
          </name>
          <name>
            <surname>Guillaume</surname>
            <given-names>J-L</given-names>
          </name>
          <name>
            <surname>Lambiotte</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Lefebvre</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Fast unfolding of communities in large networks</article-title>
        <source>J Stat Mech Theory Exp</source>
        <year>2008</year>
        <volume>2008</volume>
        <issue>10</issue>
        <fpage>10008</fpage>
        <pub-id pub-id-type="doi">10.1088/1742-5468/2008/10/P10008</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <issue>5</issue>
        <fpage>411</fpage>
        <lpage>20</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Kirschner</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Schaub</surname>
            <given-names>MT</given-names>
          </name>
          <name>
            <surname>Andrews</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Chandra</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Natarajan</surname>
            <given-names>KN</given-names>
          </name>
          <name>
            <surname>Reik</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Barahona</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Green</surname>
            <given-names>AR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Sc3: consensus clustering of single-cell rna-seq data</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <issue>5</issue>
        <fpage>483</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4236</pub-id>
        <pub-id pub-id-type="pmid">28346451</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Abdelaal</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Michielsen</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Cats</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Hoogduin</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Mei</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Reinders</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Mahfouz</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>A comparison of automatic cell identification methods for single-cell rna sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2019</year>
        <volume>20</volume>
        <issue>1</issue>
        <fpage>194</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1795-z</pub-id>
        <pub-id pub-id-type="pmid">31500660</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pedregosa</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Varoquaux</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Gramfort</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Michel</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Thirion</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Grisel</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>Blondel</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Prettenhofer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Weiss</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Dubourg</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scikit-learn: Machine learning in python</article-title>
        <source>J Mach Learn Res</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2825</fpage>
        <lpage>30</lpage>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat Meth</source>
        <year>2018</year>
        <volume>15</volume>
        <issue>12</issue>
        <fpage>1053</fpage>
        <lpage>8</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Pellegrini</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>ACTINN: automated identification of cell types in single cell RNA sequencing</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <issue>2</issue>
        <fpage>533</fpage>
        <lpage>8</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz577</pub-id>
        <pub-id pub-id-type="pmid">31359028</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Johnson</surname>
            <given-names>TS</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Yu</surname>
            <given-names>CY</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Huang</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Lambda: label ambiguous domain adaptation dataset integration reduces batch effects and improves subtype detection</article-title>
        <source>Bioinforma</source>
        <year>2019</year>
        <volume>35</volume>
        <issue>22</issue>
        <fpage>4696</fpage>
        <lpage>706</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btz295</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tan</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Cahan</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Singlecellnet: a computational tool to classify single cell rna-seq data across platforms and across species</article-title>
        <source>Cell Syst</source>
        <year>2019</year>
        <volume>9</volume>
        <issue>2</issue>
        <fpage>207</fpage>
        <lpage>13</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2019.06.004</pub-id>
        <pub-id pub-id-type="pmid">31377170</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kiselev</surname>
            <given-names>VY</given-names>
          </name>
          <name>
            <surname>Yiu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hemberg</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>scmap: projection of single-cell rna-seq data across data sets</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <issue>5</issue>
        <fpage>359</fpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4644</pub-id>
        <pub-id pub-id-type="pmid">29608555</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13</label>
      <mixed-citation publication-type="other">Grabski IN, Irizarry RA. Probabilistic gene expression signatures identify cell-types from single cell RNA-seq data. bioRxiv. 2020. 10.1101/2020.01.05.895441.</mixed-citation>
    </ref>
    <ref id="CR14">
      <label>14</label>
      <mixed-citation publication-type="other">Chen T, Guestrin C. Xgboost: A scalable tree boosting system. In: Proceedings of the 22nd Acm Sigkdd International Conference on Knowledge Discovery and Data Mining: 2016. p. 785–94. 10.1145/2939672.2939785.</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haghverdi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Lun</surname>
            <given-names>AT</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Batch effects in single-cell rna-sequencing data are corrected by matching mutual nearest neighbors</article-title>
        <source>Nat Biotechnol</source>
        <year>2018</year>
        <volume>36</volume>
        <issue>5</issue>
        <fpage>421</fpage>
        <lpage>7</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4091</pub-id>
        <pub-id pub-id-type="pmid">29608177</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Luo</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Zhong</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Choi</surname>
            <given-names>JH</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Mahrt</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Stawiski</surname>
            <given-names>EW</given-names>
          </name>
          <name>
            <surname>Modrusan</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scina: A semi-supervised subtyping algorithm of single cells and bulk samples</article-title>
        <source>Genes</source>
        <year>2019</year>
        <volume>10</volume>
        <issue>7</issue>
        <fpage>531</fpage>
        <pub-id pub-id-type="doi">10.3390/genes10070531</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pliner</surname>
            <given-names>HA</given-names>
          </name>
          <name>
            <surname>Shendure</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
        </person-group>
        <article-title>Supervised classification enables rapid annotation of cell atlases</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <issue>10</issue>
        <fpage>983</fpage>
        <lpage>6</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0535-3</pub-id>
        <pub-id pub-id-type="pmid">31501545</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>AW</given-names>
          </name>
          <name>
            <surname>O’Flanagan</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Chavez</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Lim</surname>
            <given-names>JL</given-names>
          </name>
          <name>
            <surname>Ceglia</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>McPherson</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Wiens</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Walters</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Chan</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Hewitson</surname>
            <given-names>B</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic cell-type assignment of single-cell rna-seq for tumor microenvironment profiling</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <issue>10</issue>
        <fpage>1007</fpage>
        <lpage>15</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0529-1</pub-id>
        <pub-id pub-id-type="pmid">31501550</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zappia</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Phipson</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Oshlack</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Splatter: simulation of single-cell rna sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2017</year>
        <volume>18</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>15</lpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1305-0</pub-id>
        <pub-id pub-id-type="pmid">28077169</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rosenberg</surname>
            <given-names>AB</given-names>
          </name>
          <name>
            <surname>Roco</surname>
            <given-names>CM</given-names>
          </name>
          <name>
            <surname>Muscat</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Kuchina</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Sample</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Yao</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Graybuck</surname>
            <given-names>LT</given-names>
          </name>
          <name>
            <surname>Peeler</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Mukherjee</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell profiling of the developing mouse brain and spinal cord with split-pool barcoding</article-title>
        <source>Sci</source>
        <year>2018</year>
        <volume>360</volume>
        <issue>6385</issue>
        <fpage>176</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aam8999</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Consortium</surname>
            <given-names>TM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell transcriptomics of 20 mouse organs creates a tabula muris</article-title>
        <source>Nat</source>
        <year>2018</year>
        <volume>562</volume>
        <issue>7727</issue>
        <fpage>367</fpage>
        <pub-id pub-id-type="doi">10.1038/s41586-018-0590-4</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Fei</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Lai</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Saadatpour</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Ye</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping the mouse cell atlas by microwell-seq</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>172</volume>
        <issue>5</issue>
        <fpage>1091</fpage>
        <lpage>107</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.02.001</pub-id>
        <pub-id pub-id-type="pmid">29474909</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GX</given-names>
          </name>
          <name>
            <surname>Terry</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Belgrader</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Ryvkin</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Bent</surname>
            <given-names>ZW</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Ziraldo</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Wheeler</surname>
            <given-names>TD</given-names>
          </name>
          <name>
            <surname>McDermott</surname>
            <given-names>GP</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat Commun</source>
        <year>2017</year>
        <volume>8</volume>
        <issue>1</issue>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/s41467-016-0009-6</pub-id>
        <pub-id pub-id-type="pmid">28232747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stoeckius</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Stephenson</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Houck-Loomis</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Chattopadhyay</surname>
            <given-names>PK</given-names>
          </name>
          <name>
            <surname>Swerdlow</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Simultaneous epitope and transcriptome measurement in single cells</article-title>
        <source>Nat methods</source>
        <year>2017</year>
        <volume>14</volume>
        <issue>9</issue>
        <fpage>865</fpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4380</pub-id>
        <pub-id pub-id-type="pmid">28759029</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xia</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Jin</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Yi</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Matsui</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Yang</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>McDowell</surname>
            <given-names>MA</given-names>
          </name>
          <name>
            <surname>Sarkar</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kalia</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ccr10 regulates balanced maintenance and function of resident regulatory and effector t cells to promote immune homeostasis in the skin</article-title>
        <source>J Allergy Clin Immunol</source>
        <year>2014</year>
        <volume>134</volume>
        <issue>3</issue>
        <fpage>634</fpage>
        <lpage>44</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jaci.2014.03.010</pub-id>
        <pub-id pub-id-type="pmid">24767879</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Takeuchi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Itoh</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Takumi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ishihara</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Arase</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Yokosuka</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Koseki</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Yamasaki</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Takai</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Miyoshi</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Crtam confers late-stage activation of cd8+ t cells to regulate retention within lymph node</article-title>
        <source>J Immunol</source>
        <year>2009</year>
        <volume>183</volume>
        <issue>7</issue>
        <fpage>4220</fpage>
        <lpage>8</lpage>
        <pub-id pub-id-type="doi">10.4049/jimmunol.0901248</pub-id>
        <pub-id pub-id-type="pmid">19752223</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kharchenko</surname>
            <given-names>PV</given-names>
          </name>
          <name>
            <surname>Silberstein</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Scadden</surname>
            <given-names>DT</given-names>
          </name>
        </person-group>
        <article-title>Bayesian approach to single-cell differential expression analysis</article-title>
        <source>Nat Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <issue>7</issue>
        <fpage>740</fpage>
        <lpage>2</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2967</pub-id>
        <pub-id pub-id-type="pmid">24836921</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Trapnell</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Cacchiarelli</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Grimsby</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Pokharel</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Morse</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lennon</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Livak</surname>
            <given-names>KJ</given-names>
          </name>
          <name>
            <surname>Mikkelsen</surname>
            <given-names>TS</given-names>
          </name>
          <name>
            <surname>Rinn</surname>
            <given-names>JL</given-names>
          </name>
        </person-group>
        <article-title>The dynamics and regulators of cell fate decisions are revealed by pseudotemporal ordering of single cells</article-title>
        <source>Nat Biotechnol</source>
        <year>2014</year>
        <volume>32</volume>
        <issue>4</issue>
        <fpage>381</fpage>
        <pub-id pub-id-type="doi">10.1038/nbt.2859</pub-id>
        <pub-id pub-id-type="pmid">24658644</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nusse</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Clevers</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Wnt/ <italic>β</italic>-catenin signaling, disease, and emerging therapeutic modalities</article-title>
        <source>Cell</source>
        <year>2017</year>
        <volume>169</volume>
        <issue>6</issue>
        <fpage>985</fpage>
        <lpage>99</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2017.05.016</pub-id>
        <pub-id pub-id-type="pmid">28575679</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30</label>
      <mixed-citation publication-type="other">McInnes L, Healy J, Melville J. Umap: Uniform manifold approximation and projection for dimension reduction. arXiv preprint arXiv:1802.03426. 2018.</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31</label>
      <mixed-citation publication-type="other">Guo H, Li J. scSorter R pakcage. CRAN. 2020. <ext-link ext-link-type="uri" xlink:href="https://doi.org/cran.r-project.org/">https://doi.org/cran.r-project.org/</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32</label>
      <mixed-citation publication-type="other">Guo H, Li J. scSorter: assigning cells to known cell types according to marker genes. zenodo. 2021. 10.5281/zenodo.4459645.</mixed-citation>
    </ref>
  </ref-list>
</back>
