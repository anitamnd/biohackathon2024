<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Metabolites</journal-id>
    <journal-id journal-id-type="iso-abbrev">Metabolites</journal-id>
    <journal-id journal-id-type="publisher-id">metabolites</journal-id>
    <journal-title-group>
      <journal-title>Metabolites</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2218-1989</issn>
    <publisher>
      <publisher-name>MDPI</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7281100</article-id>
    <article-id pub-id-type="doi">10.3390/metabo10050183</article-id>
    <article-id pub-id-type="publisher-id">metabolites-10-00183</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Pathway-Activity Likelihood Analysis and Metabolite Annotation for Untargeted Metabolomics Using Probabilistic Modeling</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Hosseini</surname>
          <given-names>Ramtin</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hassanpour</surname>
          <given-names>Neda</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Li-Ping</given-names>
        </name>
        <xref ref-type="author-notes" rid="fn1-metabolites-10-00183">†</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0001-9477-2199</contrib-id>
        <name>
          <surname>Hassoun</surname>
          <given-names>Soha</given-names>
        </name>
        <xref rid="c1-metabolites-10-00183" ref-type="corresp">*</xref>
        <xref ref-type="author-notes" rid="fn1-metabolites-10-00183">†</xref>
      </contrib>
    </contrib-group>
    <aff id="af1-metabolites-10-00183">Department of Computer Science, Tufts University, Medford, MA 02155, USA; <email>ramtin.hosseini@tufts.edu</email> (R.H.); <email>Neda.hassanpour@tufts.edu</email> (N.H.); <email>Liping.Liu@tufts.edu</email> (L.-P.L.)</aff>
    <author-notes>
      <corresp id="c1-metabolites-10-00183"><label>*</label>Correspondence: <email>soha@cs.tufts.edu</email></corresp>
      <fn id="fn1-metabolites-10-00183">
        <label>†</label>
        <p>These authors contributed equally to this work.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>03</day>
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <pub-date pub-type="collection">
      <month>5</month>
      <year>2020</year>
    </pub-date>
    <volume>10</volume>
    <issue>5</issue>
    <elocation-id>183</elocation-id>
    <history>
      <date date-type="received">
        <day>07</day>
        <month>3</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>27</day>
        <month>4</month>
        <year>2020</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2020 by the authors.</copyright-statement>
      <copyright-year>2020</copyright-year>
      <license license-type="open-access">
        <license-p>Licensee MDPI, Basel, Switzerland. This article is an open access article distributed under the terms and conditions of the Creative Commons Attribution (CC BY) license (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>).</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Motivation</bold>: Untargeted metabolomics comprehensively characterizes small molecules and elucidates activities of biochemical pathways within a biological sample. Despite computational advances, interpreting collected measurements and determining their biological role remains a challenge. <bold>Results</bold>: To interpret measurements, we present an inference-based approach, termed Probabilistic modeling for Untargeted Metabolomics Analysis (PUMA). Our approach captures metabolomics measurements and the biological network for the biological sample under study in a generative model and uses stochastic sampling to compute posterior probability distributions. PUMA predicts the likelihood of pathways being active, and then derives probabilistic annotations, which assign chemical identities to measurements. Unlike prior pathway analysis tools that analyze differentially active pathways, PUMA defines a pathway as <italic>active</italic> if the likelihood that the path generated the observed measurements is above a particular (user-defined) threshold. Due to the lack of “ground truth” metabolomics datasets, where all measurements are annotated and pathway activities are known, PUMA is validated on synthetic datasets that are designed to mimic cellular processes. PUMA, on average, outperforms pathway enrichment analysis by 8%. PUMA is applied to two case studies. PUMA suggests many biological meaningful pathways as active. Annotation results were in agreement to those obtained using other tools that utilize additional information in the form of spectral signatures. Importantly, PUMA annotates many measurements, suggesting 23 chemical identities for metabolites that were previously only identified as isomers, and a significant number of additional putative annotations over spectral database lookups. For an experimentally validated 50-compound dataset, annotations using PUMA yielded 0.833 precision and 0.676 recall. </p>
    </abstract>
    <kwd-group>
      <kwd>machine learning</kwd>
      <kwd>inference</kwd>
      <kwd>untargeted metabolomics</kwd>
      <kwd>biological network</kwd>
      <kwd>metabolic model</kwd>
    </kwd-group>
  </article-meta>
</front>
<body>
  <sec sec-type="intro" id="sec1-metabolites-10-00183">
    <title>1. Introduction</title>
    <p>Analyzing cellular responses to perturbations such as drug treatments and genetic modifications promises to elucidate cellular metabolism, leading to improved outcomes in personalized medicine and synthetic biology. Metabolomics has emerged as the new ‘omics’, providing a readout of cellular activity that is most predictive of phenotype. Metabolomics, so far, has played a critical role in advancing applications spanning biomarker discovery [<xref rid="B1-metabolites-10-00183" ref-type="bibr">1</xref>], drug discovery and development [<xref rid="B2-metabolites-10-00183" ref-type="bibr">2</xref>], plant biology [<xref rid="B3-metabolites-10-00183" ref-type="bibr">3</xref>], nutrition [<xref rid="B4-metabolites-10-00183" ref-type="bibr">4</xref>], and environmental health [<xref rid="B5-metabolites-10-00183" ref-type="bibr">5</xref>]. Importantly, the advent of <italic>untargeted metabolomics</italic> to measure molecular masses and spectral signatures of thousands of small molecule metabolites for a biological sample allows unprecedented opportunities to characterize the phenotype.</p>
    <p>The success of untargeted metabolomics in providing insight into cellular behavior, however, hinges on solving two problems. <italic>Metabolite annotation</italic> concerns associating measured masses with their chemical identities. This problem is challenging, as a particular mass may be associated with multiple chemical formulas (e.g., there are 21,988 known molecules associated with C<sub>20</sub>H<sub>24</sub>N<sub>2</sub>O<sub>3</sub>). There are several techniques for annotating measurements. Database lookups rely on comparing the measured spectral signature against experimentally-generated fragmentation patterns cataloged in reference spectral databases (e.g., METLIN [<xref rid="B6-metabolites-10-00183" ref-type="bibr">6</xref>], HMDB [<xref rid="B7-metabolites-10-00183" ref-type="bibr">7</xref>], MassBank [<xref rid="B8-metabolites-10-00183" ref-type="bibr">8</xref>], NIST [<xref rid="B9-metabolites-10-00183" ref-type="bibr">9</xref>]). Database coverage, however, is limited as catalogued spectral signatures are obtained experimentally. Alternatively, computational methods that either mimic the ionization and fragmentation process or utilize machine learning techniques (e.g., MetFrag [<xref rid="B10-metabolites-10-00183" ref-type="bibr">10</xref>], Fragment Identificator (FiD) [<xref rid="B11-metabolites-10-00183" ref-type="bibr">11</xref>], CFM-ID [<xref rid="B12-metabolites-10-00183" ref-type="bibr">12</xref>], CSI:FingerID [<xref rid="B13-metabolites-10-00183" ref-type="bibr">13</xref>]) score the measured spectra against the predicted spectra of molecules in a candidate set. The chemical identity associated with the highest scoring signature(s) is then assigned to the measured spectra. Other annotation techniques exploit the biological context of the measurements. For example, iMet [<xref rid="B14-metabolites-10-00183" ref-type="bibr">14</xref>] and BioCAn [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>] exploit data about local neighborhoods within the network graphs to improve annotation, while EMMF uses the biological context to engineer a candidate set based on enzyme promiscuity [<xref rid="B16-metabolites-10-00183" ref-type="bibr">16</xref>].</p>
    <p>The second problem, <italic>pathway enrichment analysis</italic>, concerns interpreting measurements within their biological context to study coordinated changes arising in response to cellular perturbations. Overrepresentation Analysis (ORA) tools (e.g., MESA [<xref rid="B17-metabolites-10-00183" ref-type="bibr">17</xref>], MetaboAnalyst [<xref rid="B18-metabolites-10-00183" ref-type="bibr">18</xref>], MPEA [<xref rid="B19-metabolites-10-00183" ref-type="bibr">19</xref>]) employ statistical testing (e.g., Fisher’s exact test) to determine if a pathway is enriched in measured metabolites to a degree different than expected by chance when compared to other cellular pathways or those in a reference sample [<xref rid="B20-metabolites-10-00183" ref-type="bibr">20</xref>]. Pathway enrichment techniques can be broadly classified in two categories. Topological analysis (TA) computes the observed metabolites’ centrality and connectivity, metrics that reflect the importance of a metabolite in the turnover of molecules through a pathway or network (e.g., MetaboAnalyst [<xref rid="B18-metabolites-10-00183" ref-type="bibr">18</xref>] and IMPaLA [<xref rid="B21-metabolites-10-00183" ref-type="bibr">21</xref>]). Metabolite annotation and pathway enrichment have traditionally been solved as two independent problems, where pathway enrichment assumes that the chemical identity of each measured mass is known a priori. In general, pathway analysis techniques, therefore, do not adequately address issues related to uncertainty in metabolite annotation. One exception is Mummichog, a set of statistical algorithms that predict functional activity directly from measurements considered significant when compared to those in a reference sample [<xref rid="B22-metabolites-10-00183" ref-type="bibr">22</xref>].</p>
    <p>We present a novel inference-based probabilistic approach, Probabilistic modeling for Untargeted Metabolomics Analysis (PUMA), for interpreting metabolomics measurements. One input to PUMA is the set of measurements that are already processed through metabolomics, e.g., MZmine [<xref rid="B23-metabolites-10-00183" ref-type="bibr">23</xref>], XCMS [<xref rid="B24-metabolites-10-00183" ref-type="bibr">24</xref>], CAMERA [<xref rid="B25-metabolites-10-00183" ref-type="bibr">25</xref>]. Another input is a set of pathways, each consisting of enzymatic reactions and their metabolic products, that are specific to the sample under study. Such pathways can be readily assembled from databases such as KEGG or MetaCyc or others. Using these data, PUMA first calculates the likelihood of activity of metabolic pathways within a biological sample. PUMA then utilizes these predictions to derive probabilistic assignment of measurements to candidate chemical identities. PUMA utilizes inference and approximates posteriors using Gibbs sampling, a Markov Chain Monte Carlo (MCMC) sampling technique [<xref rid="B26-metabolites-10-00183" ref-type="bibr">26</xref>]. Although inference is a well-known machine learning technique, there were several challenges in developing PUMA including: (1) identifying a suitable generative model that represents the underlying biological process, (2) expressing complex relationships using probability distributions, (3) speeding the inference procedure with complex mathematical marginalization and vectorization, (4) identifying best model parameters, and (5) validating model against the ground truth. Herein, we describe how PUMA addresses such challenges. PUMA is then applied to two data sets collected for Chinese Hamster Ovary (CHO) cells [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>] and human urinary samples [<xref rid="B27-metabolites-10-00183" ref-type="bibr">27</xref>]. Predicted pathway activities are analyzed for biological significance and compared against activity predictions obtained through statistical pathway enrichment analysis. We compare PUMA annotations against those already established by prior analysis of these datasets. For the CHO cell test case, metabolite annotations obtained using PUMA are compared to those published prior [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>], including annotations using METLIN [<xref rid="B6-metabolites-10-00183" ref-type="bibr">6</xref>], HMDB [<xref rid="B7-metabolites-10-00183" ref-type="bibr">7</xref>], and BioCAn [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>]. For the human urinary samples, PUMA annotations are compared to published annotations [<xref rid="B27-metabolites-10-00183" ref-type="bibr">27</xref>] obtained using spectral databases and experimental validation.</p>
  </sec>
  <sec sec-type="methods" id="sec2-metabolites-10-00183">
    <title>2. Methods</title>
    <sec id="sec2dot1-metabolites-10-00183">
      <title>2.1. Motivating Example</title>
      <p>A small example is provided to illustrate challenges in mapping measurements to metabolites and pathways, and to show inference’s ability to address these issues. <xref ref-type="fig" rid="metabolites-10-00183-f001">Figure 1</xref> presents a snippet of a network that shows two pathways (ovals), Pathway 1 and Pathway 2. Metabolites with known chemical identities associated (circles) are either associated with one pathway (red circle) or more than one pathway (blue circles). Measurements (squares) correspond to masses that can be associated with one particular metabolite (red square) or multiple metabolites (blue squares). Not all metabolites within a sample are measured due to either instrument limitations or because they are simply not present in the sample due to biological or environmental factors. Some metabolites are thus not associated with any measurements (white circles), and maybe associated with one or more pathways.</p>
      <p>There are two types of uncertainties in interpreting measurements from untargeted metabolomics. One type of uncertainty relates to assignment of metabolites to pathways (circles to ovals, <xref ref-type="fig" rid="metabolites-10-00183-f001">Figure 1</xref>). For example, measurement w<sub>3</sub> is assigned to metabolite j<sub>5</sub>. Because j<sub>5</sub> is a metabolite common to both Pathways 1 and 2, there is an uncertainty in assignment of the metabolite to the pathways: j<sub>5</sub> can be the product of activity in either Pathway 1, Pathway 2, or both. The other uncertainty relates to assignment of masses to metabolites, when a mass can map to multiple metabolites (squares to circles, <xref ref-type="fig" rid="metabolites-10-00183-f001">Figure 1</xref>). Measurement w<sub>4</sub> can be attributed to one or two metabolites, j<sub>6</sub> and j<sub>7</sub>, both sharing the same mass. The uncertainty in assigning w<sub>4</sub> to metabolites j<sub>6</sub> and j<sub>7</sub> manifests in further uncertainty. If w<sub>4</sub> is associated with j<sub>6</sub>, then it contributes to the activity of Pathway 1 (and/or other pathways with which j<sub>6</sub> is associated), while, if w<sub>4</sub> is associated with j<sub>7</sub>, then it clearly ought to contribute to the activity of Pathways 2 (and/or other pathways with which j<sub>7</sub> is associated). Not all measurements contribute to these uncertainties. For example, measurement w<sub>5</sub> is unique to metabolite j<sub>13</sub>. In turn, j<sub>13</sub> is unique to Pathway 2. Some measurements (such as w<sub>5</sub>) clearly contribute more significantly than others (such as w<sub>3</sub> and w<sub>4</sub>) in determining pathway activities.</p>
      <p>Computing pathway activities using an enrichment ratio can be misleading, because it does not take into account the uncertainty in attributing measurements to metabolites and pathways. The enrichment ratio for Pathway 1 can be computed as the ratio of four putatively-measured metabolites divided by six total metabolites in the pathway. While this enrichment ratio seems high, there is little confidence that Pathway 1 is active since all measured metabolites form this pathway could be due to active pathways other than Pathway 1. Pathway 2 has an enrichment ratio equal to 3 divided by 8. The significance or importance of this ratio is unclear. Inference will conclude that Pathway 2 is active with high probability, as it includes a measured metabolite that cannot be attributed to the activity of any other pathway. In contrast to enrichment methods, our inference-based technique considers uncertainties in measurement-metabolite and metabolite-pathway relationships when computing the likelihood of pathway activities. A pathway is considered active, if the likelihood that it generated the observed measurements is above a particular threshold. When we analyze our test cases, we will assume a threshold of 0.5. A user of PUMA may decide to use this threshold or select a more suitable threshold above which pathways are deemed active.</p>
    </sec>
    <sec id="sec2dot2-metabolites-10-00183">
      <title>2.2. Generative Model</title>
      <p>To determine pathway activities, an untargeted metabolomics workflow (<xref ref-type="fig" rid="metabolites-10-00183-f002">Figure 2</xref>A) begins with collecting measurements, followed by metabolite annotation using annotation tools (e.g., database look ups or annotation tools) and then applying pathway analysis tools (e.g., ORA or TA) to determine the pathway activities. A pathway is assumed active when biological and environmental factors lead to the production of some or all of its metabolic products. In some cases, metabolite annotation is skipped, and statistical pathway activity is computed directly from measurements. In contrast, our inference-based approach utilizes a generative model (<xref ref-type="fig" rid="metabolites-10-00183-f002">Figure 2</xref>B) that mimics biological processes inherent to the sample under study. Our presumed biological process assumes that when pathways are active, they cause the presence of some its metabolites, which in turn results in observations of masses through untargeted metabolomics.</p>
      <p>PUMA first constructs a graphical model [<xref rid="B28-metabolites-10-00183" ref-type="bibr">28</xref>] that captures the complex relation among pathway activities, metabolites, and measurements in a single integrated model. The model produces values that are observed (measured), as well as hidden variables of interest, which cannot be directly observed but rather inferred from those values that can be observed. In our case, the observations correspond to mass measurements collected through untargeted metabolomics. The hidden variables are pathway activities and the presence of a metabolite in a biological sample.</p>
      <p>Our generative model assumes the following biological process: one or more pathways are active. An active pathway causes the presence of some of its metabolites, which in turn results in observations of masses through untargeted metabolomics data collection. The generative model also assumes that the mass spectrometer is not biased towards particular measurements or classes of molecules. The lack of observations regarding the presence of masses therefore contributes some evidence regarding the corresponding pathway activity. The generative model is parameterized with prior information, or prior probabilities, about the behavior of the biological process. Here, we provide priors on each step in the biological process: for pathway activities, on pathways generating their metabolites, and metabolites mapping to mass measurements. We assume that the biological sample has a metabolic model with <inline-formula><mml:math id="mm1"><mml:mrow><mml:mi>I</mml:mi></mml:mrow></mml:math></inline-formula> pathways, <inline-formula><mml:math id="mm2"><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:math></inline-formula> metabolites, and <inline-formula><mml:math id="mm3"><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula> unique metabolite masses. A metabolite may have membership in one or more pathways. PUMA assumes prior knowledge of adducts and in-source fragmentation and utilizes the adjusted measured masses when mapping the measurements to model metabolites. An (adjusted) measured mass may be associated with one or more masses of the model metabolites. Masses of the model metabolites are mapped to discretized bins, where each bin is centered at a unique mass value and allows for a mass tolerance of ±15 ppm. Each model metabolite is assigned to a single bin that is centered closest to the metabolite’s mass. A binary vector <inline-formula><mml:math id="mm4"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:math></inline-formula> has <inline-formula><mml:math id="mm5"><mml:mrow><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> entries and indicates putative mass observations of metabolites in the model. An entry of 1 for <inline-formula><mml:math id="mm6"><mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> in vector <inline-formula><mml:math id="mm7"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:math></inline-formula> indicates the observation (measurement) of at least one metabolite in the <italic>k</italic><sup>th</sup> bin while a 0 indicates no observation for any metabolite in that bin.</p>
      <p>Let <inline-formula><mml:math id="mm8"><mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>:</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>I</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> denote the status of <inline-formula><mml:math id="mm9"><mml:mrow><mml:mrow><mml:mi>I</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> pathways in the biological sample, so <inline-formula><mml:math id="mm10"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> is a vector of binary random variables, where a value of 1 indicates that the corresponding pathway is active and 0 indicates inactivity. We assume that the <inline-formula><mml:math id="mm11"><mml:mrow><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> random variables are independent, with a <inline-formula><mml:math id="mm12"><mml:mrow><mml:mrow><mml:mi>Bernoulli</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>) prior:<disp-formula id="FD1-metabolites-10-00183"><label>(1)</label><mml:math id="mm13"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p>For simplicity in defining our model, we assume that <inline-formula><mml:math id="mm14"><mml:mrow><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula> is a model parameter and set it to a constant. As an alternative, we can give it a Beta prior.</p>
      <p>Matrix <inline-formula><mml:math id="mm15"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow></mml:math></inline-formula> is defined with <inline-formula><mml:math id="mm16"><mml:mrow><mml:mi>I</mml:mi></mml:mrow></mml:math></inline-formula> rows and <inline-formula><mml:math id="mm17"><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:math></inline-formula> columns. Each entry <inline-formula><mml:math id="mm18"><mml:mrow><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> corresponds to the activeness of metabolite <inline-formula><mml:math id="mm19"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> in pathway <inline-formula><mml:math id="mm20"><mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> where a value of 1 indicates metabolite <inline-formula><mml:math id="mm21"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> is active due to pathway <inline-formula><mml:math id="mm22"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> and a value of 0 indicates that metabolite <inline-formula><mml:math id="mm23"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> is not produced by pathway <inline-formula><mml:math id="mm24"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. If a metabolite <inline-formula><mml:math id="mm25"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> is on a pathway <inline-formula><mml:math id="mm26"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>, then the metabolite is produced according to the following probability:<disp-formula id="FD2-metabolites-10-00183"><label>(2)</label><mml:math id="mm27"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p>Otherwise, <inline-formula><mml:math id="mm28"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> when <inline-formula><mml:math id="mm29"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula> is not on <inline-formula><mml:math id="mm30"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. For simplicity, we assume that all metabolites are equally likely to be generated with probability <inline-formula><mml:math id="mm31"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula> within an active pathway. Vector <inline-formula><mml:math id="mm32"><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula> collapses the matrix <inline-formula><mml:math id="mm33"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow></mml:math></inline-formula> into a binary vector with <inline-formula><mml:math id="mm34"><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:math></inline-formula> elements, indicating the activeness of a metabolite due to whichever pathway:<disp-formula id="FD3-metabolites-10-00183"><label>(3)</label><mml:math id="mm35"><mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:munder></mml:mstyle><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p>Here <inline-formula><mml:math id="mm36"><mml:mrow><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mo>⋅</mml:mo><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> gives 1 when the condition inside is true or 0 otherwise.</p>
      <p>As not all masses can be captured using the mass spectrometer, its observed accuracy is defined using parameter <inline-formula><mml:math id="mm37"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:math></inline-formula>. Let <inline-formula><mml:math id="mm38"><mml:mrow><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> define the group of metabolites that have masses in the <inline-formula><mml:math id="mm39"><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula>-th bin, then:<disp-formula id="FD4-metabolites-10-00183"><label>(4)</label><mml:math id="mm40"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>|</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></disp-formula></p>
      <p>This probability means that every metabolite present in the biological sample has a chance <inline-formula><mml:math id="mm41"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:math></inline-formula> to be detected. In the case when all metabolites in <inline-formula><mml:math id="mm42"><mml:mrow><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> are not observed (<inline-formula><mml:math id="mm43"><mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:munder></mml:mstyle><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>), then mass <inline-formula><mml:math id="mm44"><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> will not be observed. The detection of a metabolite is independent of the detection of others in the sample. No two groups, <inline-formula><mml:math id="mm45"><mml:mrow><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm46"><mml:mrow><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>’</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, intersects because a metabolite has only one mass. The described model is described using the plate representation [<xref rid="B29-metabolites-10-00183" ref-type="bibr">29</xref>] (<xref ref-type="fig" rid="metabolites-10-00183-f003">Figure 3</xref>). The model presents the joint probability distribution of random variables <inline-formula><mml:math id="mm47"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="mm48"><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="mm49"><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm50"><mml:mrow><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> defined as:<disp-formula id="FD5-metabolites-10-00183"><label>(5)</label><mml:math id="mm51"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>;</mml:mo><mml:mi>λ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>|</mml:mo><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>m</mml:mi><mml:mo>;</mml:mo><mml:mi>γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec id="sec2dot3-metabolites-10-00183">
      <title>2.3. Inference</title>
      <p>Using the probabilistic model, we infer pathway activities and metabolite presence from mass measurements. Specifically, we calculate the following probabilities. For each pathway <inline-formula><mml:math id="mm55"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> in the biological sample we calculate <inline-formula><mml:math id="mm56"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, the posterior probability of pathway <inline-formula><mml:math id="mm57"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> being active given evidence in mass measurements. PUMA utilizes Gibbs sampling to perform Bayesian inference [<xref rid="B26-metabolites-10-00183" ref-type="bibr">26</xref>] to approximate the posterior probabilities of pathway activities conditioned on the measurements. We then infer the presence of metabolites by calculating the posterior <inline-formula><mml:math id="mm58"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> for all <inline-formula><mml:math id="mm59"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula>. We use the latter probabilities to rank a candidate set of metabolites for each mass measurement, where a candidate set provides one or more suggestion of chemical identities that have the same mass, within an error margin, as the observed one.</p>
      <sec id="sec2dot3dot1-metabolites-10-00183">
        <title>2.3.1. Inferring Pathway Activities</title>
        <p>Gibbs sampling is employed to perform Bayesian inference to approximate <inline-formula><mml:math id="mm60"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, the posterior probability of pathway activities conditioned on the measurements. Naively sampling random variables <italic>a</italic> and <italic>Z</italic>, is time consuming. To speed the Gibbs sampler, we marginalize hidden variables <inline-formula><mml:math id="mm61"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow></mml:math></inline-formula>. From the Bayesian formula:<disp-formula id="FD6-metabolites-10-00183"><label>(6)</label><mml:math id="mm62"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>w</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>Gibbs sampling is convenient in that there is no need to compute the denominator <inline-formula><mml:math id="mm63"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>w</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> to draw samples from the posterior <inline-formula><mml:math id="mm64"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. We only need to focus the computation of <inline-formula><mml:math id="mm65"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm66"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where the latter was already assumed to have a Bernoulli distribution. Below we show how to compute <inline-formula><mml:math id="mm67"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. We point out that <inline-formula><mml:math id="mm68"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> decomposes as follows:<disp-formula id="FD7-metabolites-10-00183"><label>(7)</label><mml:math id="mm69"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mi>k</mml:mi></mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>This is because metabolites in separate <inline-formula><mml:math id="mm70"><mml:mrow><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> groups are independent given <inline-formula><mml:math id="mm71"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula>, so do masses that are computed within these groups. Then we focus on the calculation of <inline-formula><mml:math id="mm72"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. Let <inline-formula><mml:math id="mm73"><mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> be the probability that at least one pathway in the biological sample generates metabolite <inline-formula><mml:math id="mm74"><mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. That is, <inline-formula><mml:math id="mm75"><mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. The detailed calculation of <inline-formula><mml:math id="mm76"><mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> is provided in <xref ref-type="app" rid="app1-metabolites-10-00183">Supplementary File S1</xref>, the calculation of <inline-formula><mml:math id="mm77"><mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> is:<disp-formula id="FD8-metabolites-10-00183"><label>(8)</label><mml:math id="mm78"><mml:mrow><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></disp-formula>
with <inline-formula><mml:math id="mm79"><mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> being the number of active pathways that <inline-formula><mml:math id="mm80"><mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> is on. Probability <inline-formula><mml:math id="mm81"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> is then computed as follows:<disp-formula id="FD9-metabolites-10-00183"><label>(9)</label><mml:math id="mm82"><mml:mrow><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="sans-serif">Π</mml:mi><mml:mrow><mml:mi mathvariant="normal">j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">k</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi mathvariant="sans-serif">Π</mml:mi><mml:mrow><mml:mi mathvariant="normal">j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">k</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>The expression <inline-formula><mml:math id="mm83"><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, a number between 0 and 1, represents the likelihood that the mass spectrometer did not measure the activity of metabolite <inline-formula><mml:math id="mm84"><mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>. Combining <inline-formula><mml:math id="mm85"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> with the Bernoulli prior <inline-formula><mml:math id="mm86"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> we have the joint probability <italic>p</italic><inline-formula><mml:math id="mm87"><mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, which is sufficient for running the sampler and getting samples from the posterior. If <inline-formula><mml:math id="mm88"><mml:mrow><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula> has a Beta prior, then we will sample <italic>a</italic> and <inline-formula><mml:math id="mm89"><mml:mrow><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula> together from <inline-formula><mml:math id="mm90"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>λ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>λ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>.</p>
      </sec>
      <sec id="sec2dot3dot2-metabolites-10-00183">
        <title>2.3.2. Inferring Metabolite Annotations</title>
        <p>With samples drawn from <inline-formula><mml:math id="mm91"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, we approximate <inline-formula><mml:math id="mm92"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, the posterior probability distribution of metabolite <inline-formula><mml:math id="mm93"><mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> being present in the biological sample. Instead of running the Gibbs sampling procedure again, we use previously collected samples of <inline-formula><mml:math id="mm94"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> from <inline-formula><mml:math id="mm95"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> to estimate the probability <inline-formula><mml:math id="mm96"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. Let <inline-formula><mml:math id="mm97"><mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo> </mml:mo><mml:mo>∈</mml:mo><mml:mi>s</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>p</mml:mi><mml:mi>l</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mo> </mml:mo><mml:mi>o</mml:mi><mml:mi>f</mml:mi><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> be a set of samples from the distribution <inline-formula><mml:math id="mm98"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, then:<disp-formula id="FD11-metabolites-10-00183"><label>(10)</label><mml:math id="mm99"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="sans-serif">Σ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="sans-serif">Σ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≈</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>S</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo> </mml:mo><mml:msub><mml:mi mathvariant="sans-serif">Σ</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>The probability <inline-formula><mml:math id="mm100"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> has efficient computation. Let <inline-formula><mml:math id="mm101"><mml:mrow><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> denote the entry of <inline-formula><mml:math id="mm102"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:math></inline-formula> corresponding to metabolite <inline-formula><mml:math id="mm103"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula>, and let <inline-formula><mml:math id="mm104"><mml:mrow><mml:mrow><mml:mo>\</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> denote other entries in <inline-formula><mml:math id="mm105"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:math></inline-formula>. Then:<disp-formula id="FD12-metabolites-10-00183"><label>(11)</label><mml:math id="mm106"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mo>\</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>Here we use the fact that <inline-formula><mml:math id="mm107"><mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm108"><mml:mrow><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> are independent of other mass observations when <inline-formula><mml:math id="mm109"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> is given. With this relation, we have:<disp-formula id="FD13-metabolites-10-00183"><label>(12)</label><mml:math id="mm110"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>Here, the terms that are constants to <inline-formula><mml:math id="mm111"><mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> are canceled. Finally, we can compute <inline-formula><mml:math id="mm112"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> by marginalizing over all <inline-formula><mml:math id="mm113"><mml:mrow><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for <inline-formula><mml:math id="mm114"><mml:mrow><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm115"><mml:mrow><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>:<disp-formula id="FD14-metabolites-10-00183"><label>(13)</label><mml:math id="mm116"><mml:mrow><mml:mrow><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="sans-serif">Σ</mml:mi><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>\</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>\</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="sans-serif">Σ</mml:mi><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>\</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo> </mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo> </mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>\</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>\</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>We decompose the above formulation into two terms for managing calculations. These two terms, <inline-formula><mml:math id="mm117"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mi>J</mml:mi></mml:msub><mml:msub><mml:mrow/><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm118"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>\</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> are further derived and re-expressed in the <xref ref-type="app" rid="app1-metabolites-10-00183">Supplementary Material</xref>, to yield the following:<disp-formula id="FD15-metabolites-10-00183"><label>(14)</label><mml:math id="mm119"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mstyle mathsize="100%" displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mrow><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>γ</mml:mi><mml:msub><mml:mi>ϕ</mml:mi><mml:msup><mml:mi>j</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula></p>
        <p>We use these equations to calculate the probabilities <inline-formula><mml:math id="mm120"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm121"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. By normalizing the two terms to have a sum of 1, we get the posterior of metabolite annotations. The derived probabilities are used as a scoring metric to rank a candidate set for each mass measurement. Details on the derivation and implementation of metabolite annotation are provided in <xref ref-type="app" rid="app1-metabolites-10-00183">Supplementary File S1</xref>.</p>
      </sec>
    </sec>
    <sec id="sec2dot4-metabolites-10-00183">
      <title>2.4. Implementation and Parameter Initialization</title>
      <p>We implemented PUMA using PyMC3 [<xref rid="B30-metabolites-10-00183" ref-type="bibr">30</xref>], a probabilistic programming framework that allows for automatic Bayesian inference on user-defined models. In the implementation, we assume that <inline-formula><mml:math id="mm122"><mml:mrow><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula> has a <inline-formula><mml:math id="mm123"><mml:mrow><mml:mi>β</mml:mi></mml:mrow></mml:math></inline-formula> prior with parameters <inline-formula><mml:math id="mm124"><mml:mrow><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mi>β</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>. We sample both random variables <inline-formula><mml:math id="mm125"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="mm126"><mml:mrow><mml:mi>λ</mml:mi></mml:mrow></mml:math></inline-formula>. To draw samples from a posterior distribution, PyMC3 utilizes a Markov Chain Monte Carlo (MCMC) sampling technique [<xref rid="B31-metabolites-10-00183" ref-type="bibr">31</xref>]. The generative model was derived from the metabolic model for each of our case studies. The observed accuracy of the mass spec, <inline-formula><mml:math id="mm127"><mml:mrow><mml:mrow><mml:mi>γ</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is assumed to be 0.9. Each entry in <italic>μ</italic> is assumed to be 0.5 if metabolite <italic>j</italic> exists on pathway <inline-formula><mml:math id="mm128"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. <italic>T,</italic> the number of samples to draw from the model, is a variable that can be set in PyMC3. The sampler was run multiple times with T values equal to 500, 1000, and 1500. We assumed 100 burn-in samples. For all reported runs, increasing the number of drawn samples altered the computed probabilities slightly but did not affect the list of active pathways, based on a 0.5 activity threshold. Drawing 1000 samples was used as a default.</p>
    </sec>
  </sec>
  <sec sec-type="results" id="sec3-metabolites-10-00183">
    <title>3. Results</title>
    <sec id="sec3dot1-metabolites-10-00183">
      <title>3.1. Model Validation</title>
      <p>To give confidence in the performance of PUMA, it is desirable to validate the generative models against a “ground truth” dataset, where all measured metabolites are annotated and there is sufficient experimental evidence to allow attributing measured metabolites to specific pathways. Predictions by PUMA can then be compared against this ground truth. Despite several databases that catalogue various metabolomics datasets (e.g., MetaboLights [<xref rid="B32-metabolites-10-00183" ref-type="bibr">32</xref>], Metabolomics Workbench [<xref rid="B33-metabolites-10-00183" ref-type="bibr">33</xref>]), there are currently no untargeted metabolomics sets that are 100% annotated. Further, there are no datasets that allow attributing metabolites to specific pathways through experimental work. We therefore design datasets that serve as “ground truth” datasets when validating pathway analysis tools. The datasets are generated to mimic biological processes where genes within pathways work in concert and result in enzymatic activities that produce metabolites [<xref rid="B34-metabolites-10-00183" ref-type="bibr">34</xref>]. These metabolites are then observed via mass spectrometry. As central metabolism and network topology is conserved across many organisms [<xref rid="B35-metabolites-10-00183" ref-type="bibr">35</xref>], we generated the synthetic datasets for a representative organism, the CHO cell, a popular biological sample that is discussed herein as a case study. Its cellular pathways and their metabolites are used as the basis for generating pathway and metabolite activities.</p>
      <p>To model a variety of plausible cellular activity, several synthetic datasets are generated. The portion of active pathways and the portion of active metabolites are varied for each dataset. A random portion (0.3, 0.5, and 0.7) of pathways are assumed active, and a random portion (0.05, 0.10, 0.15, 0.20, 0.25, 0.50, 0.75) of metabolites within each active pathway are generated. For each portion of active pathways and for each portion of active metabolites, 100 metabolomics datasets reflecting the masses of the active metabolites were generated. The observed accuracy <inline-formula><mml:math id="mm129"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:math></inline-formula> was set to 1.</p>
      <p>We compared the likelihood of pathway activities computed by PUMA against the enrichment ratios for the synthetic datasets. The enrichment ratio for a particular pathway is defined as the ratio of measured masses that map to metabolites within the pathway to its size. We use AUC, the area under the Receiver Operating Characteristic (ROC) curve to report the results. A ROC curve plots TPR (True Positive Rate) vs. FPR (False Positive Rate) at different classification thresholds. The AUC considers the performance of a classifier across all possible classification thresholds. Lowering the threshold for classifying a pathway as active results in classifying more pathways as active, thus increasing both false positives and true positives. The AUC effectively reports on the probability that the method ranks an active pathway that is selected randomly more highly than an inactive pathway that is selected randomly. The ROC curves are plotted for PUMA and for enrichment ratios (<xref ref-type="fig" rid="metabolites-10-00183-f004">Figure 4</xref>). The AUCs are consistently higher for PUMA than for the enrichment ratios, with the exception of the case when pathway activities are low (0.3) and only 0.1 of metabolites within each pathway are produced. An increase in the number of measurements while the pathway activity is fixed provides PUMA with more evidence and in general results in PUMA performance improvements that are more pronounced than for enrichment analysis. The lowest AUC for PUMA occurs with the lowest pathway activity and lowest number of generated metabolites (AUC = 0.69), while the lowest AUC for the enrichment ratio analysis occurs with the highest portion of active pathways, and smallest number of generated metabolites (AUC = 0.50). Importantly, PUMA outperformed the enrichment ratio, on average, by 8%, with average AUCs of 0.81 and 0.73 for PUMA and enrichment ratios, respectively.</p>
      <p>We then applied PUMA to each dataset and averaged PUMA’s precision, recall and accuracy on identifying the presumed active pathways. At a pathway activity of 0.3 (<xref ref-type="app" rid="app1-metabolites-10-00183">Figure S1A</xref>), as we have more observed metabolites, recall increases because PUMA has more evidence in terms of observations to recover the correct pathway activities. Precision, PUMA’s ability to label true positives correctly, is greater than 0.71, regardless of the active fraction of metabolites. Accuracy improves with increased active metabolites due to the corresponding increase in PUMA’s ability to identify true positives. This trend holds for other assumptions about pathway activities (<xref ref-type="app" rid="app1-metabolites-10-00183">Figures S2A and S3A</xref>).</p>
      <p>We investigate how uncertainty in metabolite annotation impacts inference regarding pathway activity. Before running PUMA, each mass measurement is attributed to a presumed active metabolite, thus removing annotation uncertainty. Results (<xref ref-type="app" rid="app1-metabolites-10-00183">Figures S1B, S2B, and S3B</xref>) show a similar trend to those in <xref ref-type="app" rid="app1-metabolites-10-00183">Figures S1A, S2A, and S3A</xref>. A similar trend holds when each measured mas is randomly assigned a metabolite amongst model metabolites with the same mass as a measured mass (<xref ref-type="app" rid="app1-metabolites-10-00183">Figures S1C, S2C, and S3C</xref>). This result emphasizes that computing pathway activities without the explicit step of performing metabolite annotation via spectral databases or annotation tools is a profitable approach. PUMA can, therefore, be used to accelerate the process of pathway activity analysis by direct use of mass measurements and bypassing metabolite annotation using spectral databases.</p>
      <p>We further investigated the robustness of the model to its parameters. While prior runs assumed that the probability of observing a metabolite due to a particular pathway activity was 0.5, we varied the corresponding model parameter <inline-formula><mml:math id="mm130"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:math></inline-formula> to 0.25 and to 0.75 and re-ran PUMA. The results (<xref ref-type="app" rid="app1-metabolites-10-00183">Figure S4</xref>) show that inference is dominated by other aspects of the model and that inference is robust to this model parameter.</p>
    </sec>
    <sec id="sec3dot2-metabolites-10-00183">
      <title>3.2. Case Study: Chinese Hamster Ovary (CHO) Cell</title>
      <p>We apply PUMA to LC-MS (Liquid-Chromatography Mass Spectrometry) metabolomics data for CHO cell cultures belonging to a low growth cell line [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>] (<xref ref-type="app" rid="app1-metabolites-10-00183">Supplementary Table S1</xref>). LC-MS data was collected under three different combinations of liquid chromatography methods and positive or negative ionization modes. The authors processed the data using the CAMERA tool and the dataset was limited to masses corresponding to ions formed through protonation or deprotonation. When combined, the data provides a more comprehensive characterization of the sample in the form of 8711 measurements. The metabolic model for the CHO cell was extracted from KEGG [<xref rid="B36-metabolites-10-00183" ref-type="bibr">36</xref>], based on metabolites and pathways for the cricetulus griseus (Chinese hamster) under organism code <italic>cge</italic>. The model had 86 pathways, 1534 metabolites, and 722 unique mass measurements. The <italic>m</italic>/<italic>z</italic> of the precursor ions in the measurement datasets were adjusted based on the ionization mode by adding or subtracting the mass of one proton. Adjusted measurements ± a 15 ppm are then used to initialize the observation vector <inline-formula><mml:math id="mm131"><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:math></inline-formula> for each dataset, as described in <xref ref-type="sec" rid="sec2dot2-metabolites-10-00183">Section 2.2</xref>. This model and LC-MS dataset were used prior to evaluate BioCAn [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>], a tool that aggregates results from spectra databases, annotation tools and network connectivity. The BioCAn evaluation thus provided putative identities in the form of KEGG identities, and also provided annotations using METLIN and HMDB. We, therefore, compare metabolite annotations with those provided for METLIN, HMDB, and BioCAn.</p>
      <sec id="sec3dot2dot1-metabolites-10-00183">
        <title>3.2.1. Probabilities of Pathway Activities</title>
        <p>Detailed results for each dataset and for the combined data set is provided in <xref ref-type="app" rid="app1-metabolites-10-00183">Supplementary Table S1</xref>. A pathway is considered active if <inline-formula><mml:math id="mm132"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> is equal to or greater than 0.5. As mass observations differ from one set of measurements to another, the predicted activity differs among the datasets. A detailed discussion of the results for the individual datasets is provided in <xref ref-type="app" rid="app1-metabolites-10-00183">Supplementary File S1</xref>. The rest of the CHO cell analysis provided here is based on the combined dataset.</p>
        <p>Many of the 42 pathways identified active by PUMA are biologically relevant. The biological activity of most pathways such as TCA cycle, essential for energy metabolism, Biotin (vitamin B7) metabolism, amino acid synthesis, and many others, is expected. However, the activity of some pathways, including caffeine and drug pathways, is biologically unlikely active in the CHO cell samples. Based on our experiments using the synthetic datasets, we expect some PUMA predictions to be false.</p>
        <p>Pathway activities predicted by PUMA are contrasted against pathway enrichment ratios (<xref ref-type="fig" rid="metabolites-10-00183-f005">Figure 5</xref>). Pathways are labeled as <italic>statistically enriched</italic> based on statistical significance of their ratios using Fisher’s Exact Test (FET). The null hypothesis is that there is no difference between the enrichment ratios of pathways in the sample. A <italic>p</italic>-value equal to or less than 0.05 is considered significant. Eight pathways are designated statistically enriched. These pathways are galactose metabolism, fatty acid degradation, purine metabolism, N-glycan biosynthesis, amino sugar and nucleotide sugar metabolism, glycosaminoglycan degradation, glycerophospholipid metabolism, lipoic acid metabolism. Among them, six pathways were predicted by PUMA to be active with probability equal to 1 while the N-Glycan biosynthesis pathway had a 0.53 likelihood of being active. Fatty acid degradation is predicted to be inactive. There were many pathways that had low enrichment ratios and low PUMA-predicted activity.</p>
        <p>While there was consensus in some cases, there were also differences. PUMA designates some pathways as active despite low enrichment ratios. For example, the enrichment ratios of the TCA cycle, fatty acid biosynthesis, ubiquinone and terpenoid-quinone biosynthesis are 0.15, 0.29, and 0.13, respectively. Meanwhile, PUMA predicted these pathways active with a likelihood of 1. There are three pathways with enrichment ratio equal to 0.5. Of them, one pathway, biotin metabolism, is assigned active by PUMA with probability 1.0. The biotin metabolism pathway has a measured mass that is unique and cannot be generated by other pathways. However, the other two pathways, both glycosphingolipid biosynthesis pathways, are predicted active with probability less than 0.5 (0.47 and 0.48). The reason was as follows: the observed mass measurements in the glycosphingolipid biosynthesis pathways could be mapped to galactose metabolism and glycosaminoglycan degradation pathways that are associated with a unique measurement that cannot be attributed to any other pathway in model (similar to the case of w<sub>5</sub> in our illustrative example <xref ref-type="fig" rid="metabolites-10-00183-f001">Figure 1</xref>). As the result, the glycosphingolipid biosynthesis pathways were assigned probabilities less than 0.5, while the pathways with the unique measurements are predicted active with high probability.</p>
      </sec>
      <sec id="sec3dot2dot2-metabolites-10-00183">
        <title>3.2.2. Probabilities of Metabolite Annotations</title>
        <p>A particular measurement was associated with a model metabolite if its mass matched the measured mass within the bin tolerance. Each measurement therefore may be assigned zero, one or more possible annotation. Probabilities of each metabolite being present in the sample as inferred by PUMA are used to score and rank the putative annotations. Here, the top ranked metabolite(s) for each mass is considered as the <italic>PUMA candidate set.</italic></p>
        <p>We assess the accuracy of PUMA annotations by comparing the level of agreement of PUMA annotations with those using two other techniques, spectral database searches and BioCAn (<xref ref-type="fig" rid="metabolites-10-00183-f006">Figure 6</xref>). Spectral signatures collected for the CHO Cell were looked up in METLIN and HMDB as was previously reported [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>]. Out of 411 mass measurements, 85 were matched using their spectral signatures either in HMDB or METLIN. Each such measurement had one or more chemical identities assigned to the spectral signature. Here, the highest scoring metabolite(s) for each measurement using METLIN and HMDB formed the <italic>spectral database candidate set</italic>.</p>
        <p>For each measurement, the PUMA candidate set was compared against the spectral database candidate set. The comparison leads to four different scenarios: “agreement”, “semi-agreement”, “disagreement”, and “only PUMA”. An “agreement” scenario is where the PUMA candidate set exactly matches the spectral database candidate set. Such agreement occurs in 60 cases. A “semi-agreement” is when the spectral database candidate set is a subset of the PUMA candidate set. That is, unlike the “agreement” scenario, there is not complete consensus regarding the top candidate set, and hence the “semi-agreement” label. There are 15 cases of “semi-agreement”. A “disagreement” scenario is when the spectral database candidate set does not overlap with the PUMA candidate set. There were 10 such cases of “disagreement”. In 7 such cases, the spectral database candidate set is the second likely putative annotation identified by PUMA. These putative annotations, which were not part of the PUMA candidate set, had high PUMA activity scores that were close in value to scores of the metabolite(s) in the PUMA candidate set. In the remaining 3 cases, however, the spectral database candidate is assigned a low score by PUMA. Clearly PUMA and METLIN/HMDB disagree in regard to these three cases. An “only PUMA” scenario is when the spectral database candidate set was empty, but the PUMA candidate set was not. There were 326 such cases. This large number of “only PUMA” cases reflects the low coverage of spectral databases.</p>
        <p>PUMA annotations are compared against those obtained using BioCAn [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>]. BioCAn aggregates results from spectral database searches and in silico fragmentation tools. Further, BioCAn estimates the confidence in annotation not only based on consensus scoring but also based on the presence of metabolites that are connected to the mass measurement through substrate-product relationships. BioCAn identifies 338 out of 411 mass measurements that are annotated by PUMA. The top ranked metabolite(s) for each mass as annotated by BioCAn is considered the “BioCAn candidate set”. We analyze various scenarios as we did when comparing against the spectral database candidate set. Again, there were four scenarios: “agreement”, “semi-agreement”, “disagreement”, and “only PUMA”. The definitions of these scenarios are similar to the ones provided for the METLIN/HMDB comparison, but against the BioCAn candidate set instead of the spectral database candidate set. There are 255 cases of “agreement”, 46 cases of “semi-agreement”, 37 cases of “disagreement”, and 73 “only PUMA” annotations. The disagreements fell into two categories. In 17 out of 37 cases, there was disagreement regarding the top candidate, where PUMA ranked BioCAn’s candidate as second best. There were genuine disagreements in 20 cases where the annotation by BioCAn was assigned a low score by PUMA.</p>
        <p>To validate annotations, BioCAn experimentally validated 50 of their predicted annotations against chemical standards. A subset of 37 compounds were confirmed present based on the standards. Thus, BioCAn’s precision on this 50-compound dataset is 0.740 (37/50). PUMA correctly calculated the likelihood for 33 of the 50 compounds in the sample: 25 were true positives, and 8 were true negatives. PUMA miscalculated the likelihood for 17 annotations: 5 were false positives and 12 were false negatives. PUMA’s precision for this 50-compound dataset is 0.833, thus achieving a significant additional 0.093 improvement in precision over BioCAn. Recall for PUMA for this 50-compound dataset was 0.676.</p>
        <p>In summary, comparing PUMA annotations against those obtained through spectral database and BioCAn shows significant levels of agreement. METLIN, HMDB and BioCAn incorporate spectra signatures during annotation while PUMA relies solely on pathway organization and mass measurements. Importantly, for the CHO cell, PUMA increased annotation by 383% over spectral databases and by 21% over BioCAn.</p>
      </sec>
      <sec id="sec3dot2dot3-metabolites-10-00183">
        <title>3.2.3. Evaluation of PUMA in Overcoming Uncertainty in Annotation</title>
        <p>As a measured mass may be attributed to more than one metabolite, there is uncertainty inherent in mapping measurements to metabolites. Matrix <inline-formula><mml:math id="mm133"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula>, with <italic>J</italic> rows and <italic>K</italic> columns, maps metabolites in the model to their corresponding masses. We investigate if PUMA benefits from reducing the mapping uncertainty by adjusting the <inline-formula><mml:math id="mm134"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula> matrix prior to running PUMA. In the case of the CHO cell, the annotations obtained via spectral lookups in the METLIN and HMDB databases are used to assign identities to some of the measured masses prior to running PUMA. To capture this knowledge, matrix <inline-formula><mml:math id="mm135"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula> is modified to map each mass <italic>k</italic> to precisely a single metabolite <italic>j</italic>, which is identified based on the METLIN and HMDB annotations. Column entries other than <inline-formula><mml:math id="mm136"><mml:mrow><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mo> </mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> are set to zero, indicating that mass <italic>k</italic> uniquely maps to metabolite <inline-formula><mml:math id="mm137"><mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> Using the updated <inline-formula><mml:math id="mm138"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula>, PUMA calculated posteriors for pathway activities. There was a slight change in predicted posteriors (average increase of 0.003) compared to those obtained using the original <inline-formula><mml:math id="mm139"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula> matrix. The change however does not alter posterior probabilities sufficiently to modify the list of active pathways. We repeated the analysis but incorporated the annotation data available from BioCAn instead of that obtained through spectral databases. The change in <inline-formula><mml:math id="mm140"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula> caused a slight change in predicted posteriors (an average of 0.001 per pathway) compared to those obtained using the original <inline-formula><mml:math id="mm141"><mml:mrow><mml:mi>τ</mml:mi></mml:mrow></mml:math></inline-formula> matrix. The one significant change was for pathway Phenylalanine metabolism where pathway activity changed from 0.03 to 1.0. The phenylalanine metabolism pathway is responsible for producing tyrosine. This finding suggests that substantial additional annotations, as provided in the form of added annotations by BioCAn over the use of spectral databases, are required to inform inference in regard to pathway activities. </p>
      </sec>
    </sec>
    <sec id="sec3dot3-metabolites-10-00183">
      <title>3.3. Case Study: Human Urinary Sample</title>
      <p>We apply PUMA to untargeted metabolomics datasets collected for human urinary samples analyzed by Roux et al. [<xref rid="B27-metabolites-10-00183" ref-type="bibr">27</xref>]. Detailed annotations using KEGG identities, if available, are provided for 384 metabolites based on careful analysis of 659 and 825 annotated ions in the positive and negative modes, respectively. As PUMA utilizes post-processed metabolomics data, we utilized the 384 mass measurements, which were already adjusted for ionization, adducts, and in-source fragment ions, as input to PUMA. Byproducts in the urine may be attributed to human metabolic pathways. We, therefore, modeled pathways responsible for these byproducts using the human metabolic model from MetaCyc [<xref rid="B37-metabolites-10-00183" ref-type="bibr">37</xref>]. The model had 275 pathways, 716 metabolites, and 565 unique masses. To evaluate PUMA without prior knowledge of metabolite annotations, each of the 384 mass measurements were mapped to all model metabolites that were within ±15 ppm, as described in <xref ref-type="sec" rid="sec2dot2-metabolites-10-00183">Section 2.2</xref>. Only 123 out of the Roux et al. measured masses matched to metabolites in the model.</p>
      <sec id="sec3dot3dot1-metabolites-10-00183">
        <title>3.3.1. Probabilities of Pathway Activities</title>
        <p>PUMA designated 41 pathways as active in human urinary sample (<xref ref-type="app" rid="app1-metabolites-10-00183">Supplementary Table S1</xref>). We investigate how inference results compare with pathway enrichment ratios (<xref ref-type="fig" rid="metabolites-10-00183-f007">Figure 7</xref>). Of the 41 pathways designated to be active using PUMA, six pathways (tRNA charging, 4-hydroxyproline degradation I, histidine degradation VI, lysine degradation II, purine ribonucleosides degradation to ribose-1-phosphate, nicotine degradation III) are statistically enriched. As in the CHO cell cases, there were cases of agreement and disagreement. There are several pathways were PUMA predicts low activity, while enrichment assumes a high enrichment ratio, including alanine biosynthesis II, glutamate degradation II, aspartate biosynthesis, arginine degradation VI, and alanine degradation III. The probabilities for these pathways are 0.26, 0.22, 0.17, 0.31, and 0.25, respectively, while the corresponding enrichment ratios are 1.0, 0.57, 0.75, 0.6, and 1.0. Many measurements assigned to these pathways, however, are not unique as they can generated due to activity of other pathways.</p>
      </sec>
      <sec id="sec3dot3dot2-metabolites-10-00183">
        <title>3.3.2. Probabilities of Metabolite Annotations</title>
        <p>The PUMA probabilities for each metabolite being present in the sample are used to score and rank metabolites. Only the top ranked metabolite(s) for each mass are considered as the <italic>PUMA candidate set</italic>. We compared our annotation against those provided by Roux et al. [<xref rid="B27-metabolites-10-00183" ref-type="bibr">27</xref>] (<xref ref-type="fig" rid="metabolites-10-00183-f008">Figure 8</xref>). These annotations were either identified by matching at least two of their physicochemical parameters to those in a reference standard or annotated through spectral database lookups (HMDB). Some measurements were annotated as isomers, without identifying the precise chemical molecular identity. Each measurement was assigned the best possible match. We refer to this match as the <italic>Roux candidate</italic>. When comparing the PUMA candidate set to the Roux candidate, there were four scenarios: “agreement”, “clarification”, “disagreement”, and “model incompleteness issues”. An “agreement” scenario is where the PUMA candidate set exactly matches the Roux candidate. Such agreement occurs in 85 cases. A “clarification” scenario is when the PUMA candidate set provided a specific chemical annotation while the Roux candidate annotated the measurement as an isomer. There were 23 cases of “clarification”. A “disagreement” scenario is when the Roux candidate was available in the model but was not predicted as match by PUMA. There was one case of “disagreement”. A “model incompleteness issues” scenario is when the Roux candidate was not in the model, reflecting that PUMA provides the best match within the scope of model metabolites. There were 14 “model incompleteness issue”. More comprehensive metabolic model could address such issues.</p>
      </sec>
    </sec>
    <sec id="sec3dot4-metabolites-10-00183">
      <title>3.4. Model Convergence, Complexity, and Runtimes</title>
      <p>The time and space complexity in sampling the model is <italic>O</italic>(<inline-formula><mml:math id="mm142"><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula> × <inline-formula><mml:math id="mm143"><mml:mrow><mml:mrow><mml:mi>I</mml:mi><mml:mo>×</mml:mo><mml:mi>J</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>). The runtime for drawing 1000 samples for pathway activity prediction and metabolite annotation for the CHO cell dataset were 231 and 0.5 s, respectively. The corresponding runtimes for the Human Urinary case study were 280 and 0.4 s, respectively. The runs were performed on a Dell PowerEdge R815 server with 64 cores (4× AMD Opteron 6380 processors) and 128 GB of RAM, running at 2.5 GHz.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="sec4-metabolites-10-00183">
    <title>4. Discussion and Conclusions</title>
    <p>We presented in this paper PUMA, a probabilistic approach to interpret mass measurements collected through untargeted metabolomics. PUMA first uses inference to determine pathway activities. While prior works focused on computing pathway enrichment in the context of comparing one sample against the other, here, we define a pathway as active based on its likelihood of being responsible for the presence of one or more metabolomics measurements. In determining activity, PUMA reasons about the complex relationships between the measurements as well as known pathway as defined through the underlying biochemical networks. In doing so, levels of uncertainty in mapping measurements to metabolites and pathways are significantly reduced. Moreover, a clearer view of the likelihood of pathway activity levels emerges when compared to simple enrichment analysis. PUMA then utilizes the likelihood of pathway activities to compute the posterior probability distribution of metabolites being present in the sample. The mathematical formulation for computing pathway activities and metabolite annotation probabilities was essential in achieving fast runtimes. For each test case, PUMA’s runtime for calculating pathway activities was under five minutes. The runtime for calculating metabolite annotation was less than a second. A naïve implementation of pathway activity inference would have caused significantly longer runtimes.</p>
    <p>PUMA was validated using synthetic datasets, generated to compensate for the lack of “ground truth” metabolomics datasets where all metabolites and pathway activities are known. As expected, additional measurements consistently improve PUMA recall scores. This study provided two strong results. First, fixing identities of the measurements prior to computing pathway activities provide limited improvement in PUMA performance, thus emphasizing that bypassing metabolite identification prior to computing pathway activity is a valid approach for determining pathway activities. Second, using AUC for the ROC curve as a metric, the pathway activity likelihoods computed using PUMA, on average, outperform the pathway enrichment analysis by an average of 8%.</p>
    <p>PUMA was applied to two case studies, the CHO test case and the human urine test case. In regard to pathway analysis, PUMA identifies pathways that have a high likelihood of being active but have statistically low enrichment ratios, and pathways with low likelihood of being active yet with statistically high enrichment ratios. PUMA, therefore, offers a perspective on pathway activity that is distinctly different from that offered by statistical enrichment.</p>
    <p>In regard to metabolite annotations, PUMA results had high agreement to prior annotations. This high level of agreement occurs despite the fact that PUMA does not utilize additional information in form of spectra signatures, as employed by other techniques. In the case of the CHO cell test case, PUMA increased the percentage of mass annotation by 383% over spectral lookups and by 21% over BioCAn. PUMA analysis of a 50-compound dataset that was experimentally verified by BioCAn, yielded 0.676 recall and 0.833 precision, which provides a significant 0.093 improvement in precision over BioCAn. For the human urine test case, PUMA showed agreement in annotating 85 metabolites that were annotated before using database looks ups. PUMA also suggested new putative identities for measurements that were previously identified only as isomers. Agreements demonstrated for both test cases against prior experimental annotations (those provided by BioCAn [<xref rid="B15-metabolites-10-00183" ref-type="bibr">15</xref>] and by Roux et al. [<xref rid="B27-metabolites-10-00183" ref-type="bibr">27</xref>]) provide strong evidence for PUMA’s annotation capabilities.</p>
    <p>The approach of predicting differential functional activity directly from spectral features without a priori metabolite annotation was previously shown effective using Mummichog [<xref rid="B22-metabolites-10-00183" ref-type="bibr">22</xref>]. PUMA utilizes all measurements to compute the likelihood of pathway activities that gave rise to the measurements. PUMA considers a biological sample under a certain condition, while Mummichog utilizes differentially expressed measurements to determine differently observed pathways/modules. PUMA uses the likelihood of pathway activities to derive metabolite annotations. Analyzing both the synthetic data sets and the CHO cell test case, PUMA confirms that the organization of metabolic networks can resolve the ambiguity in metabolite annotation to a large extent, as previously noted when using Mummichog.</p>
    <p>PUMA is based on inference but differs from other inference-based methods. ProbMetab [<xref rid="B38-metabolites-10-00183" ref-type="bibr">38</xref>] uses a probabilistic method [<xref rid="B39-metabolites-10-00183" ref-type="bibr">39</xref>] to assign empirical formulas to measured spectra given potential formulas. The method proposed by Jeong et al. constructs a generative model to infer the likelihood of a metabolite in the sample and the correctness of matching the measurement to a candidate metabolite within a spectral database based on measured spectra’s similarity to that of the proposed candidate and to other competing spectra in the database [<xref rid="B40-metabolites-10-00183" ref-type="bibr">40</xref>]. The competing spectra, however, may not be relevant to the sample. Del Carratore et al. uses evidence in the form of isotope patterns, adduct relationship and biochemical connections to infer metabolite annotations [<xref rid="B41-metabolites-10-00183" ref-type="bibr">41</xref>]. ZODIAC [<xref rid="B42-metabolites-10-00183" ref-type="bibr">42</xref>] also utilizes inference to re-rank molecular formula candidates suggested by SIRIUS [<xref rid="B43-metabolites-10-00183" ref-type="bibr">43</xref>].</p>
    <p>The presented method herein provides a novel, efficient, inference-based pathway analysis technique. PUMA can be enhanced in multiple ways. PUMA assumes that pathway activities are independent. Under this assumption, observed (present or absent in the sample) metabolites are not independent because they share the same set of hidden random variables. This relationship is evident in the graphical representation of the generative model (<xref ref-type="fig" rid="metabolites-10-00183-f003">Figure 3</xref>). However, PUMA does not consider biochemical dependencies between substrates and products. The generative model proposed herein can be strengthened by considering such relationships. Further, modeling instrument bias and sensitivity to metabolite concentrations can enhance PUMA, as well as other annotation tools. PUMA, like Mummichog, BioCAn, and other enrichment analysis tools depend on genome-scale metabolic models. However, such models are often incomplete, yielding incomplete analyses as evidenced in the scenario of “model incompleteness issues” when applying PUMA to the human urine sample. Integrating metabolomics data with genomics data can potentially yield improved metabolic models [<xref rid="B44-metabolites-10-00183" ref-type="bibr">44</xref>]. PUMA, like many other tools, can be enhanced by investigating instrument bias and sensitivity to metabolite concentrations. Herein, synthetic datasets served an important role in validating PUMA’s performance. The synthetic datasets were generated using the CHO cell as a model organism and assumed several scenarios with a wide range of pathway activity and observations. It is possible to make alternate assumptions regarding the data generation process and further adjust the generation assumptions to account for potential biases in collecting the measurements.</p>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>We are grateful to Alex Tong and Jan-Willem van de Meent who suggested several preliminary ideas on using inference to determine pathway activity. We are also grateful to Nicholas Alden for providing valuable assistance in understanding the CHO cell dataset and sharing results from the BioCAn publication. We thank Vladimir Porokhin for curating the metabolic model for CHO and generating the synthetic dataset.</p>
  </ack>
  <app-group>
    <app id="app1-metabolites-10-00183">
      <title>Supplementary Materials</title>
      <p>The following are available online at <uri xlink:href="https://www.mdpi.com/2218-1989/10/5/183/s1">https://www.mdpi.com/2218-1989/10/5/183/s1</uri>. Supplementary File S1.pdf provides additional derivations in support of inference of pathway activity and metabolite annotations. Supplementary Table S1 provides additional results on the synthetic dataset and on the CHO case study.</p>
      <supplementary-material content-type="local-data" id="metabolites-10-00183-s001">
        <media xlink:href="metabolites-10-00183-s001.zip">
          <caption>
            <p>Click here for additional data file.</p>
          </caption>
        </media>
      </supplementary-material>
    </app>
  </app-group>
  <notes>
    <title>Author Contributions</title>
    <p>S.H. and L.-P.L. conceived the study. N.H. implemented and evaluated the initial idea and R.H. implemented and evaluated the version of the inference presented herein. All authors contributed to the initial draft and final revisions. All authors have read and agreed to the published version of the manuscript.</p>
  </notes>
  <notes>
    <title>Funding</title>
    <p>Research reported in this publication was supported by the National Institute of General Medical Sciences of the National Institutes of Health under award number R01GM132391. The content is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health.</p>
  </notes>
  <notes notes-type="COI-statement">
    <title>Conflicts of Interest</title>
    <p>The authors declare no conflicts of interest. The funders had no role in the design of the study; in the collection, analyses, or interpretation of data; in the writing of the manuscript; or in the decision to publish the results.</p>
  </notes>
  <notes>
    <title>Availability</title>
    <p>The code and datasets are on <uri xlink:href="https://github.com/HassounLab/PUMA">https://github.com/HassounLab/PUMA</uri>.</p>
  </notes>
  <ref-list>
    <title>References</title>
    <ref id="B1-metabolites-10-00183">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xia</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Broadhurst</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Wishart</surname>
            <given-names>D.S.</given-names>
          </name>
        </person-group>
        <article-title>Translational biomarker discovery in clinical metabolomics: An introductory tutorial</article-title>
        <source>Metabolomics</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>280</fpage>
        <lpage>299</lpage>
        <pub-id pub-id-type="doi">10.1007/s11306-012-0482-9</pub-id>
        <?supplied-pmid 23543913?>
        <pub-id pub-id-type="pmid">23543913</pub-id>
      </element-citation>
    </ref>
    <ref id="B2-metabolites-10-00183">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Caldwell</surname>
            <given-names>G.W.</given-names>
          </name>
          <name>
            <surname>Leo</surname>
            <given-names>G.C.</given-names>
          </name>
        </person-group>
        <article-title>Can Untargeted Metabolomics Be Utilized in Drug Discovery/Development?</article-title>
        <source>Curr. Top Med. Chem.</source>
        <year>2017</year>
        <volume>17</volume>
        <fpage>2716</fpage>
        <lpage>2739</lpage>
        <pub-id pub-id-type="doi">10.2174/1568026617666170707130032</pub-id>
        <?supplied-pmid 28685690?>
        <pub-id pub-id-type="pmid">28685690</pub-id>
      </element-citation>
    </ref>
    <ref id="B3-metabolites-10-00183">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pérez-Alonso</surname>
            <given-names>M.-M.</given-names>
          </name>
          <name>
            <surname>Carrasco-Loba</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Medina</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Vicente-Carbajosa</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Pollmann</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>When Transcriptomics and Metabolomics Work Hand in Hand: A Case Study Characterizing Plant CDF Transcription Factors</article-title>
        <source>High Throughput</source>
        <year>2018</year>
        <volume>7</volume>
        <elocation-id>7</elocation-id>
        <pub-id pub-id-type="doi">10.3390/ht7010007</pub-id>
        <?supplied-pmid 29495643?>
        <pub-id pub-id-type="pmid">29495643</pub-id>
      </element-citation>
    </ref>
    <ref id="B4-metabolites-10-00183">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jones</surname>
            <given-names>D.P.</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>Y.H.</given-names>
          </name>
          <name>
            <surname>Ziegler</surname>
            <given-names>T.</given-names>
          </name>
        </person-group>
        <article-title>Nutritional metabolomics: Progress in addressing complexity in diet and health</article-title>
        <source>Annu. Rev. Nutr.</source>
        <year>2012</year>
        <volume>32</volume>
        <fpage>183</fpage>
        <lpage>202</lpage>
        <pub-id pub-id-type="doi">10.1146/annurev-nutr-072610-145159</pub-id>
        <pub-id pub-id-type="pmid">22540256</pub-id>
      </element-citation>
    </ref>
    <ref id="B5-metabolites-10-00183">
      <label>5.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Betts</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Sawyer</surname>
            <given-names>K.</given-names>
          </name>
        </person-group>
        <source>Use of Metabolomics to Advance Research on Environmental Exposures and the Human Exposome</source>
        <publisher-name>National Academy of Sciences</publisher-name>
        <publisher-loc>Washington, DC, USA</publisher-loc>
        <year>2016</year>
      </element-citation>
    </ref>
    <ref id="B6-metabolites-10-00183">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Guijas</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Montenegro-Burke</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Domingo-Almenara</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Palermo</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Warth</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Hermann</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Koellensperger</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Huan</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Uritboonthai</surname>
            <given-names>W.</given-names>
          </name>
          <name>
            <surname>Aisporna</surname>
            <given-names>A.E.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>METLIN: A Technology Platform for Identifying Knowns and Unknowns</article-title>
        <source>Anal. Chem.</source>
        <year>2018</year>
        <volume>90</volume>
        <fpage>3156</fpage>
        <lpage>3164</lpage>
        <pub-id pub-id-type="doi">10.1021/acs.analchem.7b04424</pub-id>
        <pub-id pub-id-type="pmid">29381867</pub-id>
      </element-citation>
    </ref>
    <ref id="B7-metabolites-10-00183">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wishart</surname>
            <given-names>D.S.</given-names>
          </name>
          <name>
            <surname>Jewison</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>A.C.</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Knox</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Djoumbou</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Mandal</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Aziat</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Dong</surname>
            <given-names>E.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>HMDB 3.0—The Human Metabolome Database in 2013</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2012</year>
        <volume>41</volume>
        <fpage>D801</fpage>
        <lpage>D807</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gks1065</pub-id>
        <pub-id pub-id-type="pmid">23161693</pub-id>
      </element-citation>
    </ref>
    <ref id="B8-metabolites-10-00183">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Horai</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Arita</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Kanaya</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Nihei</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Ikeda</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Suwa</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Ojima</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Tanaka</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Tanaka</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Aoshima</surname>
            <given-names>K.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MassBank: A public repository for sharing mass spectral data for life sciences</article-title>
        <source>J. Mass Spectrom.</source>
        <year>2010</year>
        <volume>45</volume>
        <fpage>703</fpage>
        <lpage>714</lpage>
        <pub-id pub-id-type="doi">10.1002/jms.1777</pub-id>
        <pub-id pub-id-type="pmid">20623627</pub-id>
      </element-citation>
    </ref>
    <ref id="B9-metabolites-10-00183">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lam</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Deutsch</surname>
            <given-names>E.W.</given-names>
          </name>
          <name>
            <surname>Eddes</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Eng</surname>
            <given-names>J.K.</given-names>
          </name>
          <name>
            <surname>King</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Stein</surname>
            <given-names>S.E.</given-names>
          </name>
          <name>
            <surname>Aebersold</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Development and validation of a spectral library searching method for peptide identification from MS/MS</article-title>
        <source>Proteomics</source>
        <year>2007</year>
        <volume>7</volume>
        <fpage>655</fpage>
        <lpage>667</lpage>
        <pub-id pub-id-type="doi">10.1002/pmic.200600625</pub-id>
        <pub-id pub-id-type="pmid">17295354</pub-id>
      </element-citation>
    </ref>
    <ref id="B10-metabolites-10-00183">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Schmidt</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Müller-Hannemann</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Neumann</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>In silico fragmentation for computer assisted identification of metabolite mass spectra</article-title>
        <source>BMC Bioinform.</source>
        <year>2010</year>
        <volume>11</volume>
        <elocation-id>148</elocation-id>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-148</pub-id>
      </element-citation>
    </ref>
    <ref id="B11-metabolites-10-00183">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heinonen</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Rantanen</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Mielikäinen</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Kokkonen</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Kiuru</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Ketola</surname>
            <given-names>R.A.</given-names>
          </name>
          <name>
            <surname>Rousu</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>FiD: A software forab initiostructural identification of product ions from tandem mass spectrometric data</article-title>
        <source>Rapid Commun. Mass Spectrom.</source>
        <year>2008</year>
        <volume>22</volume>
        <fpage>3043</fpage>
        <lpage>3052</lpage>
        <pub-id pub-id-type="doi">10.1002/rcm.3701</pub-id>
        <pub-id pub-id-type="pmid">18763276</pub-id>
      </element-citation>
    </ref>
    <ref id="B12-metabolites-10-00183">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Allen</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Pon</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Wilson</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Greiner</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Wishart</surname>
            <given-names>D.S.</given-names>
          </name>
        </person-group>
        <article-title>CFM-ID: A web server for annotation, spectrum prediction and metabolite identification from tandem mass spectra</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2014</year>
        <volume>42</volume>
        <fpage>W94</fpage>
        <lpage>W99</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gku436</pub-id>
        <?supplied-pmid 24895432?>
        <pub-id pub-id-type="pmid">24895432</pub-id>
      </element-citation>
    </ref>
    <ref id="B13-metabolites-10-00183">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dührkop</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Shen</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Meusel</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Rousu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Böcker</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Searching molecular structure databases with tandem mass spectra using CSI: FingerID</article-title>
        <source>Proc. Natl. Acad. Sci. USA</source>
        <year>2015</year>
        <volume>112</volume>
        <fpage>12580</fpage>
        <lpage>12585</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1509788112</pub-id>
        <?supplied-pmid 26392543?>
        <pub-id pub-id-type="pmid">26392543</pub-id>
      </element-citation>
    </ref>
    <ref id="B14-metabolites-10-00183">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aguilar-Mogas</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Sales-Pardo</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Tautenhahn</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Guimerà</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Yanes</surname>
            <given-names>O.</given-names>
          </name>
        </person-group>
        <article-title>iMet: A computational tool for structural annotation of unknown metabolites from tandem mass spectra</article-title>
        <source>arXiv</source>
        <year>2016</year>
        <pub-id pub-id-type="arxiv">1607.04122</pub-id>
      </element-citation>
    </ref>
    <ref id="B15-metabolites-10-00183">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Alden</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Krishnan</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Porokhin</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Raju</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Mcelearney</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Gilbert</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>K.</given-names>
          </name>
        </person-group>
        <article-title>Biologically Consistent Annotation of Metabolomics Data</article-title>
        <source>Anal. Chem.</source>
        <year>2017</year>
        <volume>89</volume>
        <fpage>13097</fpage>
        <lpage>13104</lpage>
        <pub-id pub-id-type="doi">10.1021/acs.analchem.7b02162</pub-id>
        <?supplied-pmid 29156137?>
        <pub-id pub-id-type="pmid">29156137</pub-id>
      </element-citation>
    </ref>
    <ref id="B16-metabolites-10-00183">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hassanpour</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Alden</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Menon</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Jayaraman</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Hassoun</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Biological Filtering and Substrate Promiscuity Prediction for Annotating Untargeted Metabolomics</article-title>
        <source>Metabolites</source>
        <year>2020</year>
        <volume>10</volume>
        <elocation-id>160</elocation-id>
        <pub-id pub-id-type="doi">10.3390/metabo10040160</pub-id>
        <?supplied-pmid 32326153?>
        <pub-id pub-id-type="pmid">32326153</pub-id>
      </element-citation>
    </ref>
    <ref id="B17-metabolites-10-00183">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xia</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Wishart</surname>
            <given-names>D.S.</given-names>
          </name>
        </person-group>
        <article-title>MSEA: A web-based tool to identify biologically meaningful patterns in quantitative metabolomic data</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2010</year>
        <volume>38</volume>
        <fpage>W71</fpage>
        <lpage>W77</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkq329</pub-id>
        <?supplied-pmid 20457745?>
        <pub-id pub-id-type="pmid">20457745</pub-id>
      </element-citation>
    </ref>
    <ref id="B18-metabolites-10-00183">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xia</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Sinelnikov</surname>
            <given-names>I.V.</given-names>
          </name>
          <name>
            <surname>Han</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Wishart</surname>
            <given-names>D.S.</given-names>
          </name>
        </person-group>
        <article-title>Metabo Analyst 3.0—Making metabolomics more meaningful</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2015</year>
        <volume>43</volume>
        <fpage>W251</fpage>
        <lpage>W257</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkv380</pub-id>
        <pub-id pub-id-type="pmid">25897128</pub-id>
      </element-citation>
    </ref>
    <ref id="B19-metabolites-10-00183">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kankainen</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Peddinti</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Holm</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Orešič</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>MPEA—Metabolite pathway enrichment analysis</article-title>
        <source>Bioinform.</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1878</fpage>
        <lpage>1879</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr278</pub-id>
      </element-citation>
    </ref>
    <ref id="B20-metabolites-10-00183">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marco-Ramell</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Palau-Rodriguez</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Alay</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Tulipani</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Urpi</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Sánchez-Pla</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Andres-Lacueva</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Evaluation and comparison of bioinformatic tools for the enrichment analysis of metabolomics data</article-title>
        <source>BMC Bioinform.</source>
        <year>2018</year>
        <volume>19</volume>
        <elocation-id>1</elocation-id>
        <pub-id pub-id-type="doi">10.1186/s12859-017-2006-0</pub-id>
      </element-citation>
    </ref>
    <ref id="B21-metabolites-10-00183">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kamburov</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Cavill</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Ebbels</surname>
            <given-names>T.M.D.</given-names>
          </name>
          <name>
            <surname>Herwig</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Keun</surname>
            <given-names>H.C.</given-names>
          </name>
        </person-group>
        <article-title>Integrated pathway-level analysis of transcriptomics and metabolomics data with IMPaLA</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>2917</fpage>
        <lpage>2918</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr499</pub-id>
        <pub-id pub-id-type="pmid">21893519</pub-id>
      </element-citation>
    </ref>
    <ref id="B22-metabolites-10-00183">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>Y.H.</given-names>
          </name>
          <name>
            <surname>Duraisingham</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Strobel</surname>
            <given-names>F.H.</given-names>
          </name>
          <name>
            <surname>Khan</surname>
            <given-names>N.</given-names>
          </name>
          <name>
            <surname>Soltow</surname>
            <given-names>Q.A.</given-names>
          </name>
          <name>
            <surname>Jones</surname>
            <given-names>D.P.</given-names>
          </name>
          <name>
            <surname>Pulendran</surname>
            <given-names>B.</given-names>
          </name>
        </person-group>
        <article-title>Predicting Network Activity from High Throughput Metabolomics</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2013</year>
        <volume>9</volume>
        <elocation-id>e1003123</elocation-id>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1003123</pub-id>
        <?supplied-pmid 23861661?>
        <pub-id pub-id-type="pmid">23861661</pub-id>
      </element-citation>
    </ref>
    <ref id="B23-metabolites-10-00183">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pluskal</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Castillo</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Villar-Briones</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Orešič</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>MZmine 2: Modular framework for processing, visualizing, and analyzing mass spectrometry-based molecular profile data</article-title>
        <source>BMC Bioinform.</source>
        <year>2010</year>
        <volume>11</volume>
        <elocation-id>395</elocation-id>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-395</pub-id>
        <?supplied-pmid 20650010?>
        <pub-id pub-id-type="pmid">20650010</pub-id>
      </element-citation>
    </ref>
    <ref id="B24-metabolites-10-00183">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Forsberg</surname>
            <given-names>E.M.</given-names>
          </name>
          <name>
            <surname>Huan</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Rinehart</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Benton</surname>
            <given-names>H.P.</given-names>
          </name>
          <name>
            <surname>Warth</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Hilmers</surname>
            <given-names>B.</given-names>
          </name>
          <name>
            <surname>Siuzdak</surname>
            <given-names>G.</given-names>
          </name>
        </person-group>
        <article-title>Data processing, multi-omic pathway mapping, and metabolite activity analysis using XCMS Online</article-title>
        <source>Nat. Protoc.</source>
        <year>2018</year>
        <volume>13</volume>
        <fpage>633</fpage>
        <lpage>651</lpage>
        <pub-id pub-id-type="doi">10.1038/nprot.2017.151</pub-id>
        <?supplied-pmid 29494574?>
        <pub-id pub-id-type="pmid">29494574</pub-id>
      </element-citation>
    </ref>
    <ref id="B25-metabolites-10-00183">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuhl</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Tautenhahn</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Böttcher</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Larson</surname>
            <given-names>T.R.</given-names>
          </name>
          <name>
            <surname>Neumann</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>CAMERA: An Integrated Strategy for Compound Spectra Extraction and Annotation of Liquid Chromatography/Mass Spectrometry Data Sets</article-title>
        <source>Anal. Chem.</source>
        <year>2011</year>
        <volume>84</volume>
        <fpage>283</fpage>
        <lpage>289</lpage>
        <pub-id pub-id-type="doi">10.1021/ac202450g</pub-id>
        <pub-id pub-id-type="pmid">22111785</pub-id>
      </element-citation>
    </ref>
    <ref id="B26-metabolites-10-00183">
      <label>26.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Gelman</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Carlin</surname>
            <given-names>J.B.</given-names>
          </name>
          <name>
            <surname>Stern</surname>
            <given-names>H.S.</given-names>
          </name>
          <name>
            <surname>Rubin</surname>
            <given-names>D.B.</given-names>
          </name>
        </person-group>
        <source>Basics of Markov Chain Simulation, in Bayesian Data Analysis</source>
        <publisher-name>CRC Press</publisher-name>
        <publisher-loc>Boca Raton, FL, USA</publisher-loc>
        <year>2014</year>
      </element-citation>
    </ref>
    <ref id="B27-metabolites-10-00183">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roux</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>Y.</given-names>
          </name>
          <name>
            <surname>Heilier</surname>
            <given-names>J.-F.</given-names>
          </name>
          <name>
            <surname>Olivier</surname>
            <given-names>M.-F.</given-names>
          </name>
          <name>
            <surname>Ezan</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Tabet</surname>
            <given-names>J.-C.</given-names>
          </name>
          <name>
            <surname>Junot</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Annotation of the Human Adult Urinary Metabolome and Metabolite Identification Using Ultra High Performance Liquid Chromatography Coupled to a Linear Quadrupole Ion Trap-Orbitrap Mass Spectrometer</article-title>
        <source>Anal. Chem.</source>
        <year>2012</year>
        <volume>84</volume>
        <fpage>6429</fpage>
        <lpage>6437</lpage>
        <pub-id pub-id-type="doi">10.1021/ac300829f</pub-id>
        <pub-id pub-id-type="pmid">22770225</pub-id>
      </element-citation>
    </ref>
    <ref id="B28-metabolites-10-00183">
      <label>28.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Jordan</surname>
            <given-names>M.I.</given-names>
          </name>
        </person-group>
        <source>Learning in Graphical Models</source>
        <publisher-name>Springer Science &amp; Business Media</publisher-name>
        <publisher-loc>New York, NY, USA</publisher-loc>
        <year>1998</year>
        <volume>Volume 89</volume>
      </element-citation>
    </ref>
    <ref id="B29-metabolites-10-00183">
      <label>29.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Koller</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>N.</given-names>
          </name>
        </person-group>
        <source>Probabilistic Graphical Models: Principles and Techniques</source>
        <publisher-name>MIT Press</publisher-name>
        <publisher-loc>Cambridge, MA, USA</publisher-loc>
        <year>2009</year>
      </element-citation>
    </ref>
    <ref id="B30-metabolites-10-00183">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Salvatier</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Wiecki</surname>
            <given-names>T.V.</given-names>
          </name>
          <name>
            <surname>Fonnesbeck</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Probabilistic programming in Python using PyMC</article-title>
        <source>Peer J. Comput. Sci.</source>
        <year>2016</year>
        <volume>2</volume>
        <fpage>e55</fpage>
        <pub-id pub-id-type="doi">10.7717/peerj-cs.55</pub-id>
      </element-citation>
    </ref>
    <ref id="B31-metabolites-10-00183">
      <label>31.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Yildirim</surname>
            <given-names>I.</given-names>
          </name>
        </person-group>
        <source>Bayesian Inference: Gibbs Sampling</source>
        <publisher-name>Technical Note; University of Rochester</publisher-name>
        <publisher-loc>Rochester, NY, USA</publisher-loc>
        <year>2012</year>
      </element-citation>
    </ref>
    <ref id="B32-metabolites-10-00183">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haug</surname>
            <given-names>O.K.</given-names>
          </name>
          <name>
            <surname>Salek</surname>
            <given-names>R.M.</given-names>
          </name>
          <name>
            <surname>Conesa</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Hastings</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>De Matos</surname>
            <given-names>P.</given-names>
          </name>
          <name>
            <surname>Rijnbeek</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Mahendraker</surname>
            <given-names>T.</given-names>
          </name>
          <name>
            <surname>Williams</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Neumann</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Rocca-Serra</surname>
            <given-names>P.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MetaboLights—An open-access general-purpose repository for metabolomics studies and associated meta-data</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2012</year>
        <volume>41</volume>
        <fpage>D781</fpage>
        <lpage>D786</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gks1004</pub-id>
        <pub-id pub-id-type="pmid">23109552</pub-id>
      </element-citation>
    </ref>
    <ref id="B33-metabolites-10-00183">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sud</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Fahy</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Cotter</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Azam</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Vadivelu</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Burant</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Edison</surname>
            <given-names>A.S.</given-names>
          </name>
          <name>
            <surname>Fiehn</surname>
            <given-names>O.</given-names>
          </name>
          <name>
            <surname>Higashi</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Nair</surname>
            <given-names>K.S.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Metabolomics Workbench: An international repository for metabolomics data and metadata, metabolite standards, protocols, tutorials and training, and analysis tools</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2015</year>
        <volume>44</volume>
        <fpage>D463</fpage>
        <lpage>D470</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkv1042</pub-id>
        <pub-id pub-id-type="pmid">26467476</pub-id>
      </element-citation>
    </ref>
    <ref id="B34-metabolites-10-00183">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cary</surname>
            <given-names>M.P.</given-names>
          </name>
          <name>
            <surname>Bader</surname>
            <given-names>G.</given-names>
          </name>
          <name>
            <surname>Sander</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>Pathway information for systems biology</article-title>
        <source>FEBS Lett.</source>
        <year>2005</year>
        <volume>579</volume>
        <fpage>1815</fpage>
        <lpage>1820</lpage>
        <pub-id pub-id-type="doi">10.1016/j.febslet.2005.02.005</pub-id>
        <pub-id pub-id-type="pmid">15763557</pub-id>
      </element-citation>
    </ref>
    <ref id="B35-metabolites-10-00183">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Peregrin-Alvarez</surname>
            <given-names>J.M.</given-names>
          </name>
          <name>
            <surname>Sanford</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Parkinson</surname>
            <given-names>J.</given-names>
          </name>
        </person-group>
        <article-title>The conservation and evolutionary modularity of metabolism</article-title>
        <source>Genome Biol.</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>R63</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2009-10-6-r63</pub-id>
        <pub-id pub-id-type="pmid">19523219</pub-id>
      </element-citation>
    </ref>
    <ref id="B36-metabolites-10-00183">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kanehisa</surname>
            <given-names>M.</given-names>
          </name>
        </person-group>
        <article-title>KEGG: Kyoto Encyclopedia of Genes and Genomes</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2000</year>
        <volume>28</volume>
        <fpage>27</fpage>
        <lpage>30</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/28.1.27</pub-id>
        <pub-id pub-id-type="pmid">10592173</pub-id>
      </element-citation>
    </ref>
    <ref id="B37-metabolites-10-00183">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Caspi</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Billington</surname>
            <given-names>R.</given-names>
          </name>
          <name>
            <surname>Ferrer</surname>
            <given-names>L.</given-names>
          </name>
          <name>
            <surname>Foerster</surname>
            <given-names>H.</given-names>
          </name>
          <name>
            <surname>Fulcher</surname>
            <given-names>C.A.</given-names>
          </name>
          <name>
            <surname>Keseler</surname>
            <given-names>I.M.</given-names>
          </name>
          <name>
            <surname>Kothari</surname>
            <given-names>A.</given-names>
          </name>
          <name>
            <surname>Krummenacker</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Latendresse</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Mueller</surname>
            <given-names>L.A.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The MetaCyc Database of metabolic pathways and enzymes and the BioCyc collection of Pathway/Genome Databases</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2008</year>
        <volume>3</volume>
        <fpage>D623</fpage>
        <lpage>D631</lpage>
      </element-citation>
    </ref>
    <ref id="B38-metabolites-10-00183">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Da Silva</surname>
            <given-names>R.R.</given-names>
          </name>
          <name>
            <surname>Jourdan</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Salvanha</surname>
            <given-names>D.M.</given-names>
          </name>
          <name>
            <surname>Letisse</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Jamin</surname>
            <given-names>E.L.</given-names>
          </name>
          <name>
            <surname>Guidetti-Gonzalez</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Labate</surname>
            <given-names>C.A.</given-names>
          </name>
          <name>
            <surname>Vêncio</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>ProbMetab: An R package for Bayesian probabilistic annotation of LC-MS-based metabolomics</article-title>
        <source>Bioinformatics</source>
        <year>2014</year>
        <volume>30</volume>
        <fpage>1336</fpage>
        <lpage>1337</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btu019</pub-id>
        <pub-id pub-id-type="pmid">24443383</pub-id>
      </element-citation>
    </ref>
    <ref id="B39-metabolites-10-00183">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rogers</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Scheltema</surname>
            <given-names>R.A.</given-names>
          </name>
          <name>
            <surname>Girolami</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Breitling</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Probabilistic assignment of formulas to mass peaks in metabolomics experiments</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>25</volume>
        <fpage>512</fpage>
        <lpage>518</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btn642</pub-id>
        <pub-id pub-id-type="pmid">19095699</pub-id>
      </element-citation>
    </ref>
    <ref id="B40-metabolites-10-00183">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jeong</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Shi</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>X.</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Shen</surname>
            <given-names>C.</given-names>
          </name>
        </person-group>
        <article-title>An empirical Bayes model using a competition score for metabolite identification in gas chromatography mass spectrometry</article-title>
        <source>BMC Bioinform.</source>
        <year>2011</year>
        <volume>12</volume>
        <elocation-id>392</elocation-id>
        <pub-id pub-id-type="doi">10.1186/1471-2105-12-392</pub-id>
      </element-citation>
    </ref>
    <ref id="B41-metabolites-10-00183">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Del Carratore</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Schmidt</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Vinaixa</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Hollywood</surname>
            <given-names>K.A.</given-names>
          </name>
          <name>
            <surname>Greenland-Bews</surname>
            <given-names>C.</given-names>
          </name>
          <name>
            <surname>Takano</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Rogers</surname>
            <given-names>S.</given-names>
          </name>
          <name>
            <surname>Breitling</surname>
            <given-names>R.</given-names>
          </name>
        </person-group>
        <article-title>Integrated Probabilistic Annotation: A Bayesian-Based Annotation Method for Metabolomic Profiles Integrating Biochemical Connections, Isotope Patterns, and Adduct Relationships</article-title>
        <source>Anal. Chem.</source>
        <year>2019</year>
        <volume>91</volume>
        <fpage>12799</fpage>
        <lpage>12807</lpage>
        <pub-id pub-id-type="doi">10.1021/acs.analchem.9b02354</pub-id>
        <?supplied-pmid 31509381?>
        <pub-id pub-id-type="pmid">31509381</pub-id>
      </element-citation>
    </ref>
    <ref id="B42-metabolites-10-00183">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ludwig</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Nothias</surname>
            <given-names>L.-F.</given-names>
          </name>
          <name>
            <surname>Dührkop</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Koester</surname>
            <given-names>I.</given-names>
          </name>
          <name>
            <surname>Fleischauer</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Hoffmann</surname>
            <given-names>M.A.</given-names>
          </name>
          <name>
            <surname>Petras</surname>
            <given-names>D.</given-names>
          </name>
          <name>
            <surname>Vargas</surname>
            <given-names>F.</given-names>
          </name>
          <name>
            <surname>Morsy</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Aluwihare</surname>
            <given-names>L.I.</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ZODIAC: Database-independent molecular formula annotation using Gibbs sampling reveals unknown small molecules</article-title>
        <source>BioRxiv</source>
        <year>2019</year>
        <fpage>842740</fpage>
        <pub-id pub-id-type="doi">10.1101/842740</pub-id>
      </element-citation>
    </ref>
    <ref id="B43-metabolites-10-00183">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dührkop</surname>
            <given-names>K.</given-names>
          </name>
          <name>
            <surname>Fleischauer</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Ludwig</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Aksenov</surname>
            <given-names>A.A.</given-names>
          </name>
          <name>
            <surname>Melnik</surname>
            <given-names>A.V.</given-names>
          </name>
          <name>
            <surname>Meusel</surname>
            <given-names>M.</given-names>
          </name>
          <name>
            <surname>Dorrestein</surname>
            <given-names>P.C.</given-names>
          </name>
          <name>
            <surname>Rousu</surname>
            <given-names>J.</given-names>
          </name>
          <name>
            <surname>Böcker</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>SIRIUS 4: A rapid tool for turning tandem mass spectra into metabolite structure information</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>299</fpage>
        <lpage>302</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0344-8</pub-id>
        <?supplied-pmid 30886413?>
        <pub-id pub-id-type="pmid">30886413</pub-id>
      </element-citation>
    </ref>
    <ref id="B44-metabolites-10-00183">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Amin</surname>
            <given-names>S.A.</given-names>
          </name>
          <name>
            <surname>Chavez</surname>
            <given-names>E.</given-names>
          </name>
          <name>
            <surname>Porokhin</surname>
            <given-names>V.</given-names>
          </name>
          <name>
            <surname>Nair</surname>
            <given-names>N.U.</given-names>
          </name>
          <name>
            <surname>Hassoun</surname>
            <given-names>S.</given-names>
          </name>
        </person-group>
        <article-title>Towards creating an extended metabolic model (EMM) for E. coli using enzyme promiscuity prediction and metabolomics data</article-title>
        <source>Microb. Cell Factories</source>
        <year>2019</year>
        <volume>18</volume>
        <fpage>109</fpage>
        <pub-id pub-id-type="doi">10.1186/s12934-019-1156-3</pub-id>
        <?supplied-pmid 31196115?>
        <pub-id pub-id-type="pmid">31196115</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="metabolites-10-00183-f001" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Illustrative example of uncertainty when mapping measurements to metabolites and pathways. Pathways (ovals) are associated with metabolites (circles), which in turn are associated with measurements (square). White circles represent non-measured metabolite with membership in one or more pathways. Blue circles represent measured metabolites that have multiple-pathway memberships (multiple-pathway membership is assumed but not shown for j<sub>3</sub> and j<sub>4</sub>). The red circle represents a metabolite that has membership in only one pathway. Measurement w<sub>5</sub> uniquely maps to j<sub>13</sub>, which uniquely maps to Pathway 2, while all other measurements map to multiple metabolites, as shown by solid or dotted lines.</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g001"/>
  </fig>
  <fig id="metabolites-10-00183-f002" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Comparison of a workflow to collect and interpret observations (<bold>A</bold>), and a generative model that captures a biological process (<bold>B</bold>).</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g002"/>
  </fig>
  <fig id="metabolites-10-00183-f003" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <p>Graphical representation of the generative model. To avoid representing all <inline-formula><mml:math id="mm144"><mml:mrow><mml:mi>I</mml:mi></mml:mrow></mml:math></inline-formula> pathways, <inline-formula><mml:math id="mm52"><mml:mrow><mml:mi>J</mml:mi></mml:mrow></mml:math></inline-formula> metabolites, and <inline-formula><mml:math id="mm53"><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula> masses in the graph we use the ‘plate’ notation and draw one representative node per variable and enclosing these variables in a plate (rectangular box). The number of instances of each enclosed variable is indicated by the fixed constant in the lower right corner of the box. Random variables of the model (<bold>a, z, m, w</bold>) are shown in white circles. The variable <bold>m</bold> has a deterministic relationship with <bold>Z</bold>. The shaded circle, labelled <bold>w</bold>, represents an observed random variable. <inline-formula><mml:math id="mm54"><mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mi>γ</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> are parameters to the model.</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g003"/>
  </fig>
  <fig id="metabolites-10-00183-f004" orientation="portrait" position="float">
    <label>Figure 4</label>
    <caption>
      <p>AUC for ROC curves for the synthetic datasets under different assumptions regarding pathway activity and metabolite generation. (<bold>A</bold>,<bold>C</bold>,<bold>E</bold>) PUMA. (<bold>B</bold>,<bold>D,F</bold>) Enrichment ratio.</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g004"/>
  </fig>
  <fig id="metabolites-10-00183-f005" orientation="portrait" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Probability of pathway activities as computed by PUMA vs. enrichment ratios for CHO cell. Each data point is marked as either statistically enriched (red) or non-statistically enriched (blue) based on a Fisher’s Exact Test <italic>p</italic>-values of 0.05.</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g005"/>
  </fig>
  <fig id="metabolites-10-00183-f006" orientation="portrait" position="float">
    <label>Figure 6</label>
    <caption>
      <p>Metabolite annotations attained with PUMA against those identified by: (<bold>A</bold>) searching spectral databases, HMDB and METLIN, and (<bold>B</bold>) BioCAn. The blue slice in each pie represents “agreement”. The orange and gray slices represent “semi-agreement” and “disagreement” respectively. Finally, the yellow slice represents the number of mass measurements that could only be annotated by PUMA.</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g006"/>
  </fig>
  <fig id="metabolites-10-00183-f007" orientation="portrait" position="float">
    <label>Figure 7</label>
    <caption>
      <p>Probability of pathway activities as computed by PUMA vs. enrichment ratios for the human urine sample. Each data point is marked as either statistically enriched (red) or non-statistically enriched (blue) based on a Fisher’s Exact Test <italic>p</italic>-values of 0.05.</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g007"/>
  </fig>
  <fig id="metabolites-10-00183-f008" orientation="portrait" position="float">
    <label>Figure 8</label>
    <caption>
      <p>Metabolite annotations attained with PUMA against those identified by Roux et al. The blue slice represents “agreement”. The orange slice represents “clarification”. The gray slice represents “disagreement” and the yellow slice represents “model incompleteness issue”.</p>
    </caption>
    <graphic xlink:href="metabolites-10-00183-g008"/>
  </fig>
</floats-group>
