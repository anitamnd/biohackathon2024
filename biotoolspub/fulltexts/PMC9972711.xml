<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>BMC Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2105</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9972711</article-id>
    <article-id pub-id-type="pmid">36849917</article-id>
    <article-id pub-id-type="publisher-id">5112</article-id>
    <article-id pub-id-type="doi">10.1186/s12859-022-05112-z</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Reconstructing B cell lineage trees with minimum spanning tree and genotype abundances</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Abdollahi</surname>
          <given-names>Nika</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jeusset</surname>
          <given-names>Lucile</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>de Septenville</surname>
          <given-names>Anne</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Davi</surname>
          <given-names>Frederic</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Bernardes</surname>
          <given-names>Juliana Silva</given-names>
        </name>
        <address>
          <email>juliana.silva_bernardes@sorbonne-universite.fr</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.462844.8</institution-id><institution-id institution-id-type="ISNI">0000 0001 2308 1657</institution-id><institution>UMR 7238, Laboratoire de Biologie Computationnelle et Quantitative, </institution><institution>Sorbonne University, </institution></institution-wrap>Paris, France </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.462844.8</institution-id><institution-id institution-id-type="ISNI">0000 0001 2308 1657</institution-id><institution>AP-HP, Hôpital Pitié-Salpêtrière, Department of Biological Hematology, </institution><institution>Sorbonne University, </institution></institution-wrap>Paris, France </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.121334.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2097 0141</institution-id><institution>IMGT®, The International ImMunoGeneTics Information System, CNRS, Institute of Human Genetics, </institution><institution>Montpellier University, </institution></institution-wrap>Montpellier, France </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>2</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>24</volume>
    <elocation-id>70</elocation-id>
    <history>
      <date date-type="received">
        <day>5</day>
        <month>10</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>13</day>
        <month>12</month>
        <year>2022</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">B cell receptor (BCR) genes exposed to an antigen undergo somatic hypermutations and Darwinian antigen selection, generating a large BCR-antibody diversity. This process, known as B cell affinity maturation, increases antibody affinity, forming a specific B cell lineage that includes the unmutated ancestor and mutated variants. In a B cell lineage, cells with a higher antigen affinity will undergo clonal expansion, while those with a lower affinity will not proliferate and probably be eliminated. Therefore, cellular (genotype) abundance provides a valuable perspective on the ongoing evolutionary process. Phylogenetic tree inference is often used to reconstruct B cell lineage trees and represents the evolutionary dynamic of BCR affinity maturation. However, such methods should process B-cell population data derived from experimental sampling that might contain different cellular abundances. There are a few phylogenetic methods for tracing the evolutionary events occurring in B cell lineages; best-performing solutions are time-demanding and restricted to analysing a reduced number of sequences, while time-efficient methods do not consider cellular abundances. We propose ClonalTree, a low-complexity and accurate approach to construct B-cell lineage trees that incorporates genotype abundances into minimum spanning tree (MST) algorithms. Using both simulated and experimental data, we demonstrate that ClonalTree outperforms MST-based algorithms and achieves a comparable performance to a method that explores tree-generating space exhaustively. Furthermore, ClonalTree has a lower running time, being more convenient for building B-cell lineage trees from high-throughput BCR sequencing data, mainly in biomedical applications, where a lower computational time is appreciable. It is hundreds to thousands of times faster than exhaustive approaches, enabling the analysis of a large set of sequences within minutes or seconds and without loss of accuracy. The source code is freely available at github.com/julibinho/ClonalTree.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s12859-022-05112-z.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>B cell receptor repertoire</kwd>
      <kwd>Lineage Tree</kwd>
      <kwd>phylogenetics</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>2016 Programme Doctoral de Cancérologie</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>SIRIC CURAMUS</institution>
        </funding-source>
        <award-id>S20JRAP016 2020-2021</award-id>
        <award-id>S20JRAP016 2020-2021</award-id>
        <principal-award-recipient>
          <name>
            <surname>Bernardes</surname>
            <given-names>Juliana Silva</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par2">B cells are essential components of the adaptive immune system. They express a cell surface receptor, the B cell receptor (BCR), recognising a vast array of antigens. The main components of the BCR are immunoglobulins (IG), which can be secreted in a soluble form as antibodies. IGs are heterodimers composed of two identical heavy chains (IGH) and two identical light chains (IGL); each chain possesses a variable and a constant region. The variable regions are responsible for antigen-binding specificities, whereas the constant regions are associated with cell-signalling components of the BCR and facilitate interactions with other immune-system molecules. The variable regions are encoded by Variable (V), Diversity (D) in the case of heavy chains, and Joining (J) genes, which are rearranged during lymphopoiesis by a complex genetic mechanism known as V(D)J recombination [<xref ref-type="bibr" rid="CR1">1</xref>]. During this process, the combinatorial diversity is generated by connecting these genes into an exon, further enhanced by random deletions and insertion at their joining sites. These mechanisms allow newly-formed naive B cells to express a vast repertoire of distinct BCRs (<inline-formula id="IEq1"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$&gt;10^{13}$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mo>&gt;</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mn>13</mml:mn></mml:msup></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq1.gif"/></alternatives></inline-formula>) [<xref ref-type="bibr" rid="CR2">2</xref>].</p>
    <p id="Par3">When exposed to an antigen, naive B cells’ genes encoding the IG undergo multiple rounds of mutations, e.g., Somatic HyperMutations (SHM) and Darwinian antigen selection. This stage of the B cell development is known as affinity maturation since it leads to a progressive increase of the IG’s affinity for their cognate antigens and occurs in specialised structures of secondary lymphoid organs, the germinal centres. During affinity maturation, B cells encounter numerous biological processes such as antigen presentation, proliferation, and differentiation. Natural selection selects B-cells with higher IG-antigen affinities, which will proliferate and undergo clonal expansion, while those with lower affinity will be eliminated [<xref ref-type="bibr" rid="CR3">3</xref>]. Affinity maturation produces a functionally heterogeneous population with different B cell lineages, each formed by the naive/unmutated B cell and its variants. Thus, the number of unique variant sequences and their respective abundances (genotypes) provide an important perspective on the ongoing evolutionary process and help elucidate clonal selection.</p>
    <p id="Par4">Understanding BCR repertoire evolution is necessary to answer fundamental biological questions such as clonal selection during antigen challenges, immune senescence, development of efficient vaccines, therapeutic monoclonal antibodies, or further understanding of B cell tumour developments. Recently, an evolutionary approach was used to quantify dissimilarity between BCR repertoires of young and aged individuals after influenza vaccination [<xref ref-type="bibr" rid="CR4">4</xref>]. Antibody evolutionary studies have also been used to guide the clonal reconstruction of BCR repertoires [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>].</p>
    <p id="Par5">Several studies have analysed B cell lineage trees to understand the evolutionary mechanisms involved in several diseases [<xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR8">8</xref>]. In this later contribution, the authors showed that lineage trees are largely shaped by antigen-driven selection occurring during an immune response. Genetic evolution, such as observed during affinity maturation, is often modelled through phylogenetic inference. This well-known methodology describes the evolution of related DNA or protein sequences in various species. Theoretically, phylogenetic inference methods could be used to build B cell lineage trees by replacing species with BCR IGH sequences (with different mutations). However, in a phylogenetic tree, the root is usually unknown, the observed sequences are usually represented only in the leaves, and the inner nodes represent the relationships among sequences. Conversely, in a B cell lineage tree, the root, the BCR IGH sequence of the unmutated B cell giving rise to the lineage, can be deduced by aligning the IG variable region sequences with sequences stored in a reference database [<xref ref-type="bibr" rid="CR9">9</xref>]. This alignment allows identifying the germline V, (D) and J genes in the ancestor cell from which the B-cell lineage derives [<xref ref-type="bibr" rid="CR10">10</xref>]. Another distinct point is that B cells with different BCR mutations can coexist; therefore, the observed BCR IGH sequences can be leaves or internal nodes in the tree [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>]. Due to simultaneous divergence, multi-furcations are also common [<xref ref-type="bibr" rid="CR13">13</xref>]. IG sequences are under intense selective pressure, and the neutral evolution assumption is invalid. Moreover, the context dependence of SHM violates the assumption that sites evolve independently and identically. Under these circumstances, conventional phylogenetic tree algorithms seem unsuitable for reconstructing B cell lineage trees. The performance of such methods varies substantially in terms of the tree topology and the ancestral sequence, as shown previously [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR14">14</xref>].</p>
    <p id="Par6">Some computational tools have been explicitly designed to build B-cell lineage trees. Igtree [<xref ref-type="bibr" rid="CR15">15</xref>] employs the maximum parsimony criterion to find the minimal set of events that could justify the observed sequences. It first constructs a preliminary tree, which only contains observed sequences, then uses a combined score based mainly on sequence mutations to gradually add internal nodes (unobserved sequences). IgPhyML combines the maximum likelihood approach [<xref ref-type="bibr" rid="CR16">16</xref>] with a codon substitution model that uses a Markov process to describe substitutions between codons [<xref ref-type="bibr" rid="CR17">17</xref>]. IgPhyML has modified the codon substitution model to incorporate hot/cold-spot biases observed in BCR IGH sequences [<xref ref-type="bibr" rid="CR18">18</xref>]. GCtree [<xref ref-type="bibr" rid="CR19">19</xref>] employs the maximum parsimony principle and incorporates the cellular abundance of a given genotype in phylogenetic inference. This information is used for ranking parsimonious trees, obtained by dnapars [<xref ref-type="bibr" rid="CR20">20</xref>] with the assumption that more abundant parents are more likely to generate mutant descendants. GCtree uses a likelihood function based on the Galton-Watson Branching process [<xref ref-type="bibr" rid="CR21">21</xref>]. It is an accurate method, but its computational complexity is high, especially for a high number of BCR IGH sequences. GLaMST [<xref ref-type="bibr" rid="CR22">22</xref>] is another method for creating B cell lineage trees. It is based on a minimum spanning tree (MST) algorithm and it iteratively builds the lineage tree from the root to leaves by adding minimal edge costs. GLaMST is more time-efficient than GCtree, but it ignores genotype abundance information.</p>
    <p id="Par7">Here we propose ClonalTree, a method to build B cell lineage trees, combining MST and genotype abundances. ClonalTree is a multi-objective-based approach that first minimises edge costs and then maximises genotype abundances to infer maximum parsimony trees. Using simulated and experimental data, we demonstrate that ClonalTree outperforms GLaMST and achieves a comparable performance to GCtree. ClonalTree has however a lower time complexity and great potential for many applications, particularly in clinical settings where time constraint is essential.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <p id="Par24">In this section, we describe our approach, the data sets used in our experiments, and the metrics used to evaluate the performance of inferred trees.</p>
    <sec id="Sec11">
      <title>Approach</title>
      <p id="Par25">ClonalTree reconstructs B cell lineage trees based on the minimum spanning tree (MST) and cellular (genotypes) abundances. We start with a formal description of the B-cell lineage tree reconstruction problem and minimum spanning tree algorithms. Next, we describe how we model the problem as a multi-objective optimisation by modifying the Prim’s algorithm [<xref ref-type="bibr" rid="CR26">26</xref>] to incorporate genotype abundance information. Ultimately, we discuss how the BCR IGH sequence distance was computed, and show how trees can be improved by creating intermediate nodes that describe non-observed sequences or by performing editing operations.</p>
      <sec id="Sec12">
        <title>Problem statement</title>
        <p id="Par26">Given a set of observed BCR IGH sequences with the same V(D)J rearrangement event and an inferred naive/unmutated BCR IGH sequence, we look for a minimum-sized directed tree structure, the B-cell lineage tree, which might represent the affinity maturation process. Vertices (nodes) represent BCR IGH sequences, and the weight of edges connecting vertices represents the distance between sequences in terms of mutation, insertion, and deletion operations. All observed sequences are reachable from the root (the inferred naive/unmutated BCR IGH sequence).</p>
      </sec>
      <sec id="Sec13">
        <title>Minimum spanning tree</title>
        <p id="Par27">Given a connected undirected graph (V, E), where V is a set of vertices, and E is the weight edges, its minimum spanning tree (MST) is a subset of vertices and edges that form a tree (a connected graph without cycles/loops) so that the sum of the weights of all the edges (the cost) is at minimum. For a given connected undirected graph, several MSTs can exist. All trees have similar costs, but their topologies are different. Most MST construction algorithms are greedy approaches [<xref ref-type="bibr" rid="CR26">26</xref>, <xref ref-type="bibr" rid="CR27">27</xref>], where edges are sorted according to their weights and selected according to some criteria. In each step, greedy algorithms make a locally-optimal choice hoping that this choice will lead to a globally optimal solution.</p>
      </sec>
      <sec id="Sec14">
        <title>Multi-objective optimisation</title>
        <p id="Par28">To find the most parsimonious B-cell lineage tree, we model the problem as a multi-objective optimisation problem. Thus, we have two objective functions: the first one minimises the sum of edge weights, while the second function maximises the genotype abundance. There are many methods to solve a multi-objective problem [<xref ref-type="bibr" rid="CR28">28</xref>]; we used the hierarchical optimisation criteria [<xref ref-type="bibr" rid="CR29">29</xref>], in which two or more objective functions are ranked from the most to the least important, and are optimised in this pre-established order. The first function can be modelled by some minimum spanning tree algorithm, such as Prim’s [<xref ref-type="bibr" rid="CR26">26</xref>] or Kruskal’s [<xref ref-type="bibr" rid="CR27">27</xref>]. Both are greedy approaches and present low time complexity. However, Prim’s algorithm runs faster than Kruskal’s in dense graphs [<xref ref-type="bibr" rid="CR30">30</xref>]. Therefore, we modified Prim’s algorithm to incorporate the second objective function. We start at the root and add all its neighbours with minimum edge weight to a priority queue. We then iteratively extract from the priority queue the node with the lowest edge weight (the first objective function) and highest genotype abundance (the second objective function). If no cycle is formed, the node and the edge are added to the tree. For each added node, all its neighbours with minimum edge weights are included in the priority queue. We keep on adding nodes and edges until we cover all nodes. To decrease the time complexity of the algorithm, we add each node only once to the priority queue.</p>
        <p id="Par29">We highlight the fact that the original Prim’s algorithm has only one objective function, which minimises the sum of edge weights (cost). Here we included a second objective function to maximise genotype abundance. If a set of edges have the same weight, we will choose the one that connects nodes with high abundance. Prim’s algorithm has a time complexity of <inline-formula id="IEq23"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$O(|V|^2)$$\end{document}</tex-math><mml:math id="M4"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq23.gif"/></alternatives></inline-formula> in the worst case but can be improved up to <inline-formula id="IEq24"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$O(|E| + \log |V|)$$\end{document}</tex-math><mml:math id="M6"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mo>+</mml:mo><mml:mo>log</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq24.gif"/></alternatives></inline-formula> when using data structures based on Fibonacci heaps [<xref ref-type="bibr" rid="CR31">31</xref>]. Figure <xref rid="Fig1" ref-type="fig">1</xref> shows a simple example of the tree construction process.<fig id="Fig1"><label>Fig. 1</label><caption><p>ClonalTree construction example. We start with a connected weighted graph (<bold>a</bold>) where nodes represent BCR genotype sequences, edge weights their distances, and node weights their abundances. The graph can be fully connected, or one can disable edges whose weight is lower than a threshold <inline-formula id="IEq25"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M8"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq25.gif"/></alternatives></inline-formula>. Then, we first place the inferred ancestral sequence (the root) (<bold>b</bold>) and iteratively add nodes to the tree with the lowest edge weight and highest genotype abundance (<bold>c, d</bold>); when edges have the same weight (<bold>e</bold>), we choose that connected to the node with the highest abundance (<bold>f</bold>), we repeat until all nodes were added to the tree (<bold>g</bold>), the final tree is shown in (<bold>h</bold>)</p></caption><graphic xlink:href="12859_2022_5112_Fig1_HTML" id="MO1"/></fig></p>
      </sec>
      <sec id="Sec15">
        <title>Measuring genotype abundances</title>
        <p id="Par30">A B cell lineage tree might represent the relationships between the unmutated ancestral BCR IGH sequence and its mutated descendants. Multiple copies of a given variant could indicate its importance in affinity maturation and clonal expansion processes. Thus, we used variant abundances (here called genotype abundance) to guide the B cell lineage tree reconstruction. A genotype can be defined differently and can represent a set of identical or similar sequences (some mutations are allowed). A common way of defining a BCR genotype is to group sequences with the same IGHV and IGHJ genes and identical complementarity determining region 3 (CDR3, the most variable part of the variable region) amino acid sequences. In both cases, the genotype abundance accounts for the number of such elements within a population of BCR IGH sequences.</p>
      </sec>
      <sec id="Sec16">
        <title>Computing BCR IGH sequence distances</title>
        <p id="Par31">The reconstruction of B cell lineage trees requires a distance measurement between clonally-related sequences. This distance is usually used to weigh edges in the graph. Several works have used pairwise edit distances, such as Levenshtein [<xref ref-type="bibr" rid="CR32">32</xref>]. However, its computation usually requires dynamic programming algorithms that become computationally expensive in time and memory when the number of sequences per lineage tree is large. Another weak point of pairwise distances is that they provide a local landscape without considering mutated regions across all the sequences. ClonalTree first performs a multiple sequence alignment to consider evolutionary events such as mutations, insertions, and deletions over all clonally-related sequences. Next, it computes a normalised hamming distance [<xref ref-type="bibr" rid="CR33">33</xref>] between each pair of genotype sequences and then uses it as the weight edge connecting two genotypes. In order to avoid a fully connected graph, we can apply a threshold <inline-formula id="IEq26"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M10"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq26.gif"/></alternatives></inline-formula>, that will disable edges whose weight is lower than <inline-formula id="IEq27"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\delta$$\end{document}</tex-math><mml:math id="M12"><mml:mi>δ</mml:mi></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq27.gif"/></alternatives></inline-formula>.</p>
      </sec>
      <sec id="Sec17">
        <title>Editing the reconstructed lineage tree</title>
        <p id="Par32">A greedy algorithm makes the optimal choice at each step, attempting to find the optimal way to solve the optimisation problem. It never reconsiders its choices, while optimal algorithms always find the best solution. A way to review decisions and improve the ClonalTree algorithm is to edit the obtained lineage tree. Thus, we implemented two strategies: adding unobserved intermediate nodes to the tree and removing/restoring sub-trees.</p>
        <p id="Par33">Unobserved internal nodes might represent unobserved sequences that were not sampled or disappeared during affinity maturation. In those cases, the evolutionary relationships were also lost. One way to recover them is to analyse the reconstructed tree to identify common ancestors not yet represented. This process is similar to building a phylogenetic tree among species, where unobserved internal nodes represent common ancestors of descendants. However, only leaves’ nodes are observed in a classical phylogenetic tree, and all internal nodes are unobserved. In contract, internal nodes can be observed or unobserved in a B cell lineage tree. When we detect a missing common ancestral in the tree, we add an unobserved internal node. It generally happens when we observe a distance between sister nodes that is smaller or equal to the distance for their parent, see nodes {d, e} in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S3-A. To add unobserved internal nodes, we traverse the tree in a pre-order manner, and for each pair of sister nodes, we verify if a common ancestor is missing. If it is the case, we add an unobserved internal node in the tree, connect it to the observed nodes by direct edges Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S3-B, and update edge weights Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S3-C. For this later, let <inline-formula id="IEq28"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{pm}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pm</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq28.gif"/></alternatives></inline-formula> and <inline-formula id="IEq29"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{pn}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pn</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq29.gif"/></alternatives></inline-formula> be the edge weights connecting a pair of sister nodes <italic>m</italic> and <italic>n</italic> to their parent <italic>p</italic>, respectively. Let <inline-formula id="IEq30"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$d_{mn}$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">mn</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq30.gif"/></alternatives></inline-formula> be the distance between the sister nodes and <italic>i</italic> an unobserved internal node added to the tree. The edge weights are updated as follows:<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \begin{aligned} d_{pi} = max (d_{pm} - d_{mn}, d_{pn} - d_{mn}, 1)\\ d_{im} = d_{pm} - d_{pi}\\ d_{in} = d_{pn} - d_{pi}\\ \end{aligned} \end{aligned}$$\end{document}</tex-math><mml:math id="M20" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pi</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pm</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">mn</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pn</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">mn</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow/><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">im</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pm</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pi</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow/><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">in</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pn</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="italic">pi</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="right"><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2022_5112_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>We can detach a sub-tree from an internal node by removing its edge and reattach it to another internal node or leaf. We perform this editing operation to reduce the depth of the lineage tree by keeping the overall cost. Here, the motivation is to try to find the most parsimonious tree. We consider all branching nodes (i.e., nodes with more than one descendant) for this edition operation. Then, we try to detach and reattach each node (under edition condition) to any other node in the lineage tree. If this operation reduces the tree depth, we accept it and examine the resulting lineage tree again for additional edition operations that may further reduce the tree depth. We repeat this process until no editing operation can reduce the depth of the tree (see an illustration in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S4).</p>
      </sec>
    </sec>
    <sec id="Sec18">
      <title>Data sets</title>
      <p id="Par34">We used two types of data sets to measure the ClonalTree performance and compare it with existing algorithms: simulated and experimental. GCtree simulator produced simulated data [<xref ref-type="bibr" rid="CR19">19</xref>], while one of two experimental data sets was created during routine diagnostic procedures of a patient with CLL at the Pitié Salpêtrière hospital (Paris-France), and the second one is a public data set [<xref ref-type="bibr" rid="CR11">11</xref>]. In the former case, informed consent for use of the diagnostic sample for research purposes was obtained.</p>
      <sec id="Sec19">
        <title>Simulated lineage trees</title>
        <p id="Par35">To create simulated lineage trees, we used the B cell lineage simulator provided by GCtree. The simulator produces a B cell lineage by randomly selecting IGHV, IGHD, and IGHJ germline genes from the IMGT database [<xref ref-type="bibr" rid="CR9">9</xref>]. Then, nucleotide(s) can be added to or removed from the junction region: IGHV-IGHD and IGHD-IGHJ. Next, it performs a branching process, and point mutations can be included in the descendants. Somatic hypermutations are simulated by a sequence-dependent process, where mutations are preferentially introduced within specific hot-spot motifs [<xref ref-type="bibr" rid="CR34">34</xref>]. We kept the simulator default parameters and generated 92 artificial lineage trees. The sizes of simulated trees ranged from 6 to 99 nodes, the number of observed sequences between 20 and 200, the degree of root nodes varied from 1 to 42, and depth trees from 2 to 7, see Table <xref rid="Tab1" ref-type="table">1</xref>.</p>
      </sec>
      <sec id="Sec20">
        <title>Experimental data</title>
        <p id="Par36">We used a public data set from a previously reported experiment [<xref ref-type="bibr" rid="CR11">11</xref>], where the authors combined multiphoton microscopy and single-cell mRNA sequencing to obtain IGH sequences extracted from germinal B cells of a lineage sorted from the mouse germinal centre. The data set, labelled as TAS-42, contains 65 IGHV sequences and 42 genotypes. For this data set, a genotype is a group of identical sequences. The ancestor IGHV gene was inferred with Partis [<xref ref-type="bibr" rid="CR35">35</xref>], and the final data set contains 66 sequences: 65 from the original data set plus one representing the reconstructed germline sequence.</p>
        <p id="Par37">The second experimental data set was generated by sampling sequences from the most abundant clone of a BCR repertoire associated with a CLL patient. The data set contains 3406 sequences, annotated with IGHV4-34*01/IGHD3-3*01/IGHJ4*02 genes using IMGT/HighV-QUEST software [<xref ref-type="bibr" rid="CR24">24</xref>]. For this data set, a genotype groups identical BCR IGH sequences; we obtained 20 genotypes with different abundances. Thus, the data set was labelled as CLL-20. To predict the hypothetical unmutated ancestral sequence (the root of this lineage tree), we considered the germline sequences of the corresponding IGHV and IGHJ genes provided by IMGT/HighV-QUEST. For the junction, we took it from the sequence with the lowest number of mutations on the IGHV gene compared to the germline determined by IMGT/HighV-Quest. Eventually, we concatenated germline IGHV, the junction sequence, and the IGHJ sequences to obtain the hypothetical unmutated sequence.</p>
      </sec>
    </sec>
    <sec id="Sec21">
      <title>Tree comparison and evaluation</title>
      <p id="Par38">To evaluate the performance of B cell lineage reconstruction algorithms, we used two types of metrics to compare tree topologies (graph editing distances [<xref ref-type="bibr" rid="CR23">23</xref>]) and ancestral sequence inferences (MRCA [<xref ref-type="bibr" rid="CR13">13</xref>] and COAR [<xref ref-type="bibr" rid="CR19">19</xref>]), explained in more details below.</p>
      <sec id="Sec22">
        <title>Graph editing distance</title>
        <p id="Par39">Let G<inline-formula id="IEq31"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$_1$$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow/><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq31.gif"/></alternatives></inline-formula> and G<inline-formula id="IEq32"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$_2$$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow/><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq32.gif"/></alternatives></inline-formula> be two graphs; the Graph Editing Distance (GED) finds the minimum set of graph transformations able to transform G<inline-formula id="IEq33"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$_1$$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mrow/><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq33.gif"/></alternatives></inline-formula> into G<inline-formula id="IEq34"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$_2$$\end{document}</tex-math><mml:math id="M28"><mml:msub><mml:mrow/><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq34.gif"/></alternatives></inline-formula> through edit operations on G<inline-formula id="IEq35"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$_1$$\end{document}</tex-math><mml:math id="M30"><mml:msub><mml:mrow/><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq35.gif"/></alternatives></inline-formula>. A graph transformation is any operation that modifies the graph: insertion, deletion, and substitutions of vertices or edges. GED is similar to string edit distances such as Levenshtein distance [<xref ref-type="bibr" rid="CR32">32</xref>] when we replace strings by connected directed acyclic graphs of maximum degree one. We used two versions of GED, one applied to the whole tree (GED tree-based) and another to each branch separately (GED path-based). The latter version is more stringent than the first one since any difference in the path from each leaf to the root is considered a transformation.</p>
        <p id="Par40">The problem of computing graph edit distance is NP-complete [<xref ref-type="bibr" rid="CR36">36</xref>], and there is no optimal solution in a reasonable time. This problem is difficult to approximate, and most approximation algorithms have cubic computational time [<xref ref-type="bibr" rid="CR37">37</xref>, <xref ref-type="bibr" rid="CR38">38</xref>]. Here we could use an optimal algorithm implementation since the number of nodes of evaluated trees was small. Nevertheless, we favoured a grid cluster to compute GED for trees with more than 50 nodes.</p>
      </sec>
      <sec id="Sec23">
        <title>Ancestral reconstruction distances</title>
        <p id="Par41">We also compared trees by measuring their ancestral sequence reconstruction agreement. For that, we used two measures previously defined: The Most Recent Common Ancestor (MRCA) [<xref ref-type="bibr" rid="CR13">13</xref>], and The Correctness Of Ancestral Reconstruction (COAR) [<xref ref-type="bibr" rid="CR19">19</xref>]. The MRCA metric focuses on the most recent common ancestral, while COAR considers the entire evolutionary pathway. Both measures emphasise the importance of a correct ancestral reconstruction and do not penalise minor differences in the tree topologies whether the ancestral reconstruction is accurate.</p>
        <p id="Par42">The classical MRCA distance is calculated by iterating through all pairs of leaves. It compares the most recent ancestral sequence of each pair of leaves presenting into two trees simultaneously - for instance, the ground truth <inline-formula id="IEq36"><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(T_1)$$\end{document}</tex-math><mml:math id="M32"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq36.gif"/></alternatives></inline-formula> and the inferred tree <inline-formula id="IEq37"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(T_2)$$\end{document}</tex-math><mml:math id="M34"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq37.gif"/></alternatives></inline-formula>. Since internal nodes in the B cell lineage trees can also represent observed genotypes, we modified MRCA to consider all node pairs instead of leaves only. For a given pair of observed nodes <italic>i</italic> and <italic>j</italic>, where <inline-formula id="IEq38"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(i,j) \in T_1$$\end{document}</tex-math><mml:math id="M36"><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq38.gif"/></alternatives></inline-formula> and <inline-formula id="IEq39"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(i,j) \in T_2$$\end{document}</tex-math><mml:math id="M38"><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq39.gif"/></alternatives></inline-formula>, the MRCA(<italic>i</italic>, <italic>j</italic>) is the normalised hamming distance between the most recent ancestral sequences in <inline-formula id="IEq40"><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T_1$$\end{document}</tex-math><mml:math id="M40"><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq40.gif"/></alternatives></inline-formula> and <inline-formula id="IEq41"><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T_2$$\end{document}</tex-math><mml:math id="M42"><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq41.gif"/></alternatives></inline-formula> trees, given by:<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \text {MRCA}(i, j) = \frac{\text {Hamming}(S_i, S_j)}{ \text {max} (|S_i|, |S_j|)} \end{aligned}$$\end{document}</tex-math><mml:math id="M44" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtext>MRCA</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>Hamming</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mtext>max</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2022_5112_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq42"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_i$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq42.gif"/></alternatives></inline-formula> and <inline-formula id="IEq43"><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_j$$\end{document}</tex-math><mml:math id="M48"><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq43.gif"/></alternatives></inline-formula> are the nucleotide sequences associated to nodes <italic>i</italic> and <italic>j</italic>, and Hamming<inline-formula id="IEq44"><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$(S_i, S_j)$$\end{document}</tex-math><mml:math id="M50"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq44.gif"/></alternatives></inline-formula> computes the hamming distance between <inline-formula id="IEq45"><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_i$$\end{document}</tex-math><mml:math id="M52"><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq45.gif"/></alternatives></inline-formula> and <inline-formula id="IEq46"><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$S_j$$\end{document}</tex-math><mml:math id="M54"><mml:msub><mml:mi>S</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq46.gif"/></alternatives></inline-formula>. Then, the MRCA metric is obtained by:<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} \text {MRCA}(T_1, T_2) = \frac{\sum _{i,j} \text {MRCA}(i, j)}{C_2^n} \end{aligned}$$\end{document}</tex-math><mml:math id="M56" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtext>MRCA</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mtext>MRCA</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:msubsup><mml:mi>C</mml:mi><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:msubsup></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2022_5112_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>where <italic>n</italic> is the number of observable nodes in <inline-formula id="IEq47"><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T_1$$\end{document}</tex-math><mml:math id="M58"><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq47.gif"/></alternatives></inline-formula>, or <inline-formula id="IEq48"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T_2$$\end{document}</tex-math><mml:math id="M60"><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq48.gif"/></alternatives></inline-formula>, and <inline-formula id="IEq49"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$C_2^n$$\end{document}</tex-math><mml:math id="M62"><mml:msubsup><mml:mi>C</mml:mi><mml:mn>2</mml:mn><mml:mi>n</mml:mi></mml:msubsup></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq49.gif"/></alternatives></inline-formula> gives the total number of node pairs; see an example in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S5.</p>
        <p id="Par43">COAR [<xref ref-type="bibr" rid="CR13">13</xref>] is another measure to evaluate the reconstruction of ancestral sequences. It compares evolutionary paths in the trees from the root (the unmmutated sequence) to any leaf. To compute it, we consider each leaf <inline-formula id="IEq50"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$i \in T_1$$\end{document}</tex-math><mml:math id="M64"><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq50.gif"/></alternatives></inline-formula>, find the path <inline-formula id="IEq51"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_i$$\end{document}</tex-math><mml:math id="M66"><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq51.gif"/></alternatives></inline-formula> from <italic>i</italic> until the root, and compare it to all paths <inline-formula id="IEq52"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$p_j \in T_2$$\end{document}</tex-math><mml:math id="M68"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq52.gif"/></alternatives></inline-formula> that contain <italic>i</italic>. To compare paths and obtain COAR(i), we used the Needleman–Wunsch alignment algorithm [<xref ref-type="bibr" rid="CR39">39</xref>] with a scoring matrix based on negative hamming distance and gap penalties. The COAR metric is the average of the COAR(i) of all leaves in <inline-formula id="IEq53"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T_1$$\end{document}</tex-math><mml:math id="M70"><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq53.gif"/></alternatives></inline-formula>:<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\begin{aligned} {\text {COAR}}(T_1, T_2) = \frac{\sum _{i \in T_1} {\text {COAR}}(i)}{N_L} \end{aligned}$$\end{document}</tex-math><mml:math id="M72" display="block"><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtext>COAR</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mtext>COAR</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math><graphic xlink:href="12859_2022_5112_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq54"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$N_L$$\end{document}</tex-math><mml:math id="M74"><mml:msub><mml:mi>N</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq54.gif"/></alternatives></inline-formula> is the number of leaves in <inline-formula id="IEq55"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$T_1$$\end{document}</tex-math><mml:math id="M76"><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq55.gif"/></alternatives></inline-formula>, and COAR(<italic>i</italic>) is computed by the Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Algorithm 1. See also, an example in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S6.</p>
        <p id="Par44">The numeric values of MRCA and COAR range in the interval [0, 1], where 0 represents a perfect ancestral sequence reconstruction, and 1 is the worst case. To see more details of these distance calculations, please refer to [<xref ref-type="bibr" rid="CR13">13</xref>] and [<xref ref-type="bibr" rid="CR19">19</xref>].</p>
      </sec>
      <sec id="Sec24">
        <title>Computational tools used for comparisons</title>
        <p id="Par45">There are only a few B cell lineage reconstruction softwares; some are not available for download [<xref ref-type="bibr" rid="CR15">15</xref>], others are specific for Windows operating system [<xref ref-type="bibr" rid="CR40">40</xref>], and others are very time consuming. Among the available methods, we selected two state-of-art tools to compare with ClonalTree: GCtree [<xref ref-type="bibr" rid="CR19">19</xref>] and GLaMST [<xref ref-type="bibr" rid="CR22">22</xref>]. GCtree is an exhaustive solution; it uses dnapars [<xref ref-type="bibr" rid="CR20">20</xref>] to find a parsimony forest and then ranks parsimonious trees according to genotype abundance information. On the other hand, GLaMST [<xref ref-type="bibr" rid="CR22">22</xref>] is a time-efficient algorithm that uses MST but does not consider genotype quantities. The authors have shown a higher performance of these tools in the respective publications, with GCTree outperforming IgPhyML [<xref ref-type="bibr" rid="CR13">13</xref>], and GLaMST surpassing IgTree. Thus, we decided to keep only GCTree and GLaMST for evaluation and comparison.</p>
      </sec>
    </sec>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <p id="Par8">To reconstruct B-cell lineage trees, ClonalTree starts placing the root (the inferred ancestral sequence) and iteratively adds nodes presenting minimal edge cost and maximum genotype abundance; therefore, it optimises two multi-objective functions rather than a single one based only on edge costs as implemented in other approaches. We first validated our method with several artificial lineage trees that simulate the affinity maturation process. Then, we used two data sets containing experimental B cell lineages for biological validations.</p>
    <sec id="Sec3">
      <title>Reconstructing B cell lineage trees from simulated data</title>
      <p id="Par9">To evaluate ClonalTree performance and compare it to GCtree and GLaMST, two state-of-art tools (see “<xref rid="Sec24" ref-type="sec">Computational tools used for comparisons</xref>” section), we generated simulated data sets using 92 different settings, varying the root gene sequence and the relative probabilities of mutation, insertion, and deletion (see “<xref rid="Sec19" ref-type="sec">Simulated lineage trees</xref>” section, and Table <xref rid="Tab1" ref-type="table">1</xref>). The simulated lineage trees served as ground truth that we would like to recover using B cell lineage tree algorithms. Thus, the performance measures how close reconstructed trees are to simulated ground truths. To quantify this resemblance, we computed different types of distances based on graph editing distances (GED) that measure the dissimilarity between two graphs/trees [<xref ref-type="bibr" rid="CR23">23</xref>], and two previously defined distances related to the correctness of common ancestral inferences [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR19">19</xref>]. We computed two types of GED distances, based on the entire tree (GED tree-based) and separated paths (GED path-based), see “<xref rid="Sec22" ref-type="sec">Graph editing distance</xref>” section, and used MRCA [<xref ref-type="bibr" rid="CR13">13</xref>] and COAR [<xref ref-type="bibr" rid="CR19">19</xref>], to measure the correctness of ancestral reconstruction, see “<xref rid="Sec23" ref-type="sec">Ancestral reconstruction distances</xref>” section.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Statistics of simulated lineage trees</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left"/><th align="left">Min</th><th align="left">Mean</th><th align="left">Max</th><th align="left">Std</th></tr></thead><tbody><tr><td align="left">Tree depth</td><td char="." align="char">2</td><td char="." align="char">4</td><td char="." align="char">7</td><td char="." align="char">1</td></tr><tr><td align="left">Degree of Root</td><td char="." align="char">1</td><td char="." align="char">11</td><td char="." align="char">42</td><td char="." align="char">9</td></tr><tr><td align="left">Number of nodes</td><td char="." align="char">6</td><td char="." align="char">34</td><td char="." align="char">99</td><td char="." align="char">21</td></tr><tr><td align="left">Number of leaves</td><td char="." align="char">5</td><td char="." align="char">25</td><td char="." align="char">82</td><td char="." align="char">16</td></tr><tr><td align="left">Number of observed sequences</td><td char="." align="char">30</td><td char="." align="char">81</td><td char="." align="char">200</td><td char="." align="char">48</td></tr></tbody></table></table-wrap></p>
      <sec id="Sec4">
        <title>ClonalTree parameter settings</title>
        <p id="Par10">We first varied ClonalTree parameters to determine the best configuration. ClonalTree has three Boolean parameters, ‘a’ considers genotype abundances, ‘r’ adds unobserved internal nodes when necessary, and ‘t’ tries to reduce the tree depth by performing attach/detach operations, see “<xref rid="Sec11" ref-type="sec">Approach</xref>” section. Table <xref rid="Tab2" ref-type="table">2</xref> shows all possible variations for these parameters, where an ‘x’ indicates that the parameter was turned on, and an empty box indicates that it was turned off. To measure the performance of each configuration, we computed the GED path-based distance between inferred and ground truth trees. GED path-based compares tree paths, from leaves to the root, being more sensitive to topology changes and resulting in higher distance values than the GED tree-based ones. Thus, it is more appropriate to perform configuration comparisons. We measured the performance by the overall median, the median without outliers, and the number of correct paths (GED path-based equal to zero). ClonalTree produced the best results when all three parameters were turned on. We observed that when ‘a’ was turned on, ‘t’ played an important role; when it was turned off, the number of correct paths decreased. It is also interesting to note that when only the parameter ‘a’ was turned on, ClonalTree produced fewer outliers and the maximum GED path-based distance was 20; however, this configuration produced higher median values. Note that the original Prim’s algorithm corresponds to the last row in Table <xref rid="Tab2" ref-type="table">2</xref> and the last box-plot in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S1, when all parameters were turned off. This configuration achieved fewer outliers but produced higher medians and inferred fewer correct paths. Thus, we kept all parameters turned on for the rest of the computational experiments.<table-wrap id="Tab2"><label>Table 2</label><caption><p>Parameter setting evaluation</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" colspan="3">Parameters</th><th align="left" colspan="3">Performance metrics</th></tr><tr><th align="left">a</th><th align="left">r</th><th align="left">t</th><th align="left">Median</th><th align="left">Median*</th><th align="left">Correct paths</th></tr></thead><tbody><tr><td align="left">×</td><td align="left">×</td><td align="left">×</td><td align="left">3</td><td align="left">2</td><td align="left">41</td></tr><tr><td align="left">×</td><td align="left">×</td><td align="left"/><td align="left">4</td><td align="left">4</td><td align="left">39</td></tr><tr><td align="left">×</td><td align="left"/><td align="left">×</td><td align="left">4</td><td align="left">4</td><td align="left">35</td></tr><tr><td align="left">×</td><td align="left"/><td align="left"/><td align="left">4</td><td align="left">4</td><td align="left">34</td></tr><tr><td align="left"/><td align="left">×</td><td align="left">×</td><td align="left">4</td><td align="left">4</td><td align="left">41</td></tr><tr><td align="left"/><td align="left"/><td align="left">×</td><td align="left">4</td><td align="left">4</td><td align="left">41</td></tr><tr><td align="left"/><td align="left">×</td><td align="left"/><td align="left">4</td><td align="left">4</td><td align="left">35</td></tr><tr><td align="left"/><td align="left"/><td align="left"/><td align="left">4</td><td align="left">4</td><td align="left">35</td></tr></tbody></table><table-wrap-foot><p>‘×’ indicates that the parameter was turned on, while an empty box indicates that it was turned off</p><p>Median* is the median without considering the outliers. ‘Correct paths’ reports the number of correct reconstructed paths (from leaf to root) in the tree, that is, when the GED path-based distance was zero</p></table-wrap-foot></table-wrap></p>
      </sec>
      <sec id="Sec5">
        <title>Comparison with state-of-art methods</title>
        <p id="Par11">We compared ClonalTree to two state-of-art tools, GCtree [<xref ref-type="bibr" rid="CR19">19</xref>], based on an exhaustive approach that uses genotype abundance information to find the most parsimonious tree, and GLaMST [<xref ref-type="bibr" rid="CR22">22</xref>], which uses a MST-based method that does not explore genotype quantities, see “<xref rid="Sec24" ref-type="sec">Computational tools used for comparisons</xref>” section. Figure <xref rid="Fig2" ref-type="fig">2</xref> shows boxplots of GED distances for each compared method on the 92 simulated lineages trees. GCtree and ClonalTree had comparable performances, but ClonalTree outperformed GLaMST. Reconstructed B cell lineage trees of GCtree and ClonalTree displayed similar topologies, while trees produced by GLaMST were different. For GED tree-based distances (Fig. <xref rid="Fig2" ref-type="fig">2</xref>A), median values were 0, 2, and 12 and the highest distances 37, 38, and 120 for GCtree, ClonalTree and GLaMST, respectively. GLaMST presented the highest median value and the highest distance. ClonalTree produced 39 correct trees (GED tree-based distance equal to zero), while GLaMST produced only two.</p>
        <p id="Par12">Figure <xref rid="Fig2" ref-type="fig">2</xref>B, which displays GED path-based distances, confirms that GCtree and ClonalTree reconstructed B cell lineage trees with similar paths. Median values were 0, 3, and 18, with the highest distances 56, 58, and 180 for GCtree, ClonalTree, and GLaMST, respectively. As observed for GED tree-based, GLaMST presented the highest median value and distance. ClonalTree produced 41 correct paths (GED path-based distance equal to zero), while GLaMST produced only one path. In order to better evaluate the performance, we split the trees into three categories according to their number of sequences: small (between 30 and 50), medium (between 60 and 80), and large (having more than 90 sequences), see Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig S2. We observed a slight difference between GCtree and ClonalTree, mainly in the small and large groups, with worse results obtained in the medium group. On the other hand, we observed that GLaMST had difficulties in all groups; GED distances increased as the number of sequences grew.</p>
        <p id="Par13">The GED metric depends on the tree topologies, mainly the GED-based path that penalises each path difference. Therefore, it is also essential to estimate the accuracy of ancestral reconstructions without penalising minor differences in the tree topologies. For that, we used two metrics: the MRCA and the COAR, see “<xref rid="Sec23" ref-type="sec">Ancestral reconstruction distances</xref>” section. MRCA distance focuses on the most recent common ancestor and does not consider the entire evolutionary lineage. On the other hand, COAR measures the correctness of ancestral reconstruction from the root to any leaf. We first compared ClonalTree and GLaMST to ground truth trees, and then both tools with GCtree. The latter comparison is important since it gives us a basis for evaluating these methods on experimental data sets, where the true lineage evolution is unknown. Figure <xref rid="Fig3" ref-type="fig">3</xref> shows MRCA distance distributions for ClonalTree and GLaMST when compared to ground truth trees (A) or GCtree (B). For both plots, we observed better performance for ClonalTree, which could reconstruct recent ancestral relationships more accurately. Figure <xref rid="Fig4" ref-type="fig">4</xref> shows COAR distance distributions when comparing ClonalTree and GLaMST with ground truth trees (A) or with GCtree ones (B). Similarly, we observed that the trees produced by our approach are closer to both ground truth and GCtree trees.<fig id="Fig2"><label>Fig. 2</label><caption><p>Performance comparison between GCtree, ClonalTree, and GLaMST using GED distances. Box-plots in <bold>a</bold> present GED tree-based distances, while <bold>b</bold> display GED path-based ones</p></caption><graphic xlink:href="12859_2022_5112_Fig2_HTML" id="MO2"/></fig><fig id="Fig3"><label>Fig. 3</label><caption><p>Most Recent Common Ancestor (MRCA) distance distributions. <bold>a</bold> compares ClonalTree, and GLaMST with ground truth trees, and <bold>b</bold> with trees generated by GCtree</p></caption><graphic xlink:href="12859_2022_5112_Fig3_HTML" id="MO3"/></fig><fig id="Fig4"><label>Fig. 4</label><caption><p>Correctness Of Ancestral Reconstruction (COAR) distance distributions. <bold>a</bold> compares ClonalTree, and GLaMST with ground truth trees, while <bold>b</bold> with trees generated by GCtree</p></caption><graphic xlink:href="12859_2022_5112_Fig4_HTML" id="MO4"/></fig></p>
      </sec>
    </sec>
    <sec id="Sec6">
      <title>Biological validation using BCR sequencing data</title>
      <p id="Par14">We performed a biological validation on two experimental data sets: TAS-42 and CLL-20 (see “<xref rid="Sec18" ref-type="sec">Data sets</xref>” section). Since ground truth trees are unavailable for these samples, we compared the inferred trees of ClonalTree and GLaMST with the trees inferred by GCtree. We considered trees generated with GCtree as references for the experimental validation since such a tool achieved the best performance on simulated data sets.</p>
      <p id="Par15">The TAS-42 is a public data set generated by lineage tracing and single-cell germinal centre BCR sequencing [<xref ref-type="bibr" rid="CR11">11</xref>]. TAS-42 contains 66 sequences, used as input for GCtree, GLaMST, and ClonalTree. The 2<inline-formula id="IEq2"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$^{nd}$$\end{document}</tex-math><mml:math id="M78"><mml:msup><mml:mrow/><mml:mrow><mml:mi mathvariant="italic">nd</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq2.gif"/></alternatives></inline-formula> and 3<inline-formula id="IEq3"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$^{rd}$$\end{document}</tex-math><mml:math id="M80"><mml:msup><mml:mrow/><mml:mrow><mml:mi mathvariant="italic">rd</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq3.gif"/></alternatives></inline-formula> columns of Table <xref rid="Tab3" ref-type="table">3</xref> show tree distances for ClonalTree and GLaMST when compared to GCtree, respectively. The GED tree-based distance was smaller for ClonalTree, producing a tree with ten differences from GCtree. GLaMST produced a more disparate tree than ClonalTree; Its GED tree-based distance was 47. GED path-based distances also showed that ClonalTree produced more similar evolutionary paths to GCtree than GLaMST. Only 22 evolutionary paths differ from GCtree against 230 for GLaMST. Most GLaMST paths contained various unobserved nodes, producing many mismatches compared to GCtree. We temporarily removed them to evaluate the tool’s performance. In the absence of unobserved nodes, ClonalTree presented just one mismatched path, while GLaMST produced seven. We also evaluated the agreement of ancestral sequence reconstructions. MRCA values were low for ClonalTree and GLaMST; both tools detected recent ancestral accurately for most node pairs. We did not observe a significant difference between MRCA values presented in Table <xref rid="Tab3" ref-type="table">3</xref>. However, COAR distance values indicated that ClonalTree had better reconstructed entire evolutionary paths; we observed significantly lower COAR values for ClonalTree than GLaMST. Since ClonalTree achieved a lower GED path-based distance, it was expected to present lower COAR distances. COAR also considers sequence dissimilarities as GED path-based distance rather than only differences in the paths. Both measures confirmed that ClonalTree produces trees that are closer to the GCtree ones.</p>
      <p id="Par16">The CLL-20 data set was obtained from the blood samples of a patient with CLL (Chronic lymphocytic leukaemia). We only analysed the most abundant clone, which contains 3406 sequences and 20 different genotypes. For these sequences, IMGT/HighV-QUEST [<xref ref-type="bibr" rid="CR24">24</xref>] inferred ancestor IGHV, IGHD, and IGHJ genes using germline sequences from the IMGT [<xref ref-type="bibr" rid="CR9">9</xref>] database. The 4th and 5th columns of Table <xref rid="Tab3" ref-type="table">3</xref> show tree distances for ClonalTree and GLaMST, respectively. ClonalTree GED tree-based distance was the smallest among experimental data sets, showing that ClonalTree generated a tree with a very similar topology to the one generated with GCtree. Likewise, GED path-based distance was smaller for ClonalTree. GLaMST presented an extremely high GED path-based distance; it added many unobserved nodes, causing several mismatches when comparing tree paths. We also evaluated tree path agreement without considering unobserved nodes. ClonalTree presented only two different paths against 13 of GLaMST. As observed in the data set TAS-42, we noted a slight difference between ClonalTree and GLaMST MRCA values, indicating that both tools reconstructed the most recent ancestral properly. However, a notable difference was again observed in COAR, with the ClonalTree distance being smaller than the GLaMST one. This result is coherent with a better GED path-based distance since COAR accounts for the entire path from a leaf to the root.</p>
      <p id="Par17">These experimental results show that the trees generated by ClonalTree were closer to those obtained by GCtree; when compared to GLaMST, all distance metrics were smaller for ClonalTree, especially GED path-based and COAR distances. In summary, ClonalTree reconstructed whole evolutionary lineages more accurately than GLaMST.<table-wrap id="Tab3"><label>Table 3</label><caption><p>Performance evaluation of ClonalTree, and GLaMST on experimental BCR repertoire data sets.*GED path-based when removing unobserved nodes</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" rowspan="2">Metric</th><th align="left" colspan="2">TAS-42</th><th align="left" colspan="2">CLL-20</th></tr><tr><th align="left">ClonalTree</th><th align="left">GLaMST</th><th align="left">ClonalTree</th><th align="left">GLaMST</th></tr></thead><tbody><tr><td align="left">GED tree-based</td><td align="left">10</td><td align="left">47</td><td align="left">3</td><td align="left">36</td></tr><tr><td align="left">GED path-based</td><td align="left">22</td><td align="left">230</td><td align="left">18</td><td align="left">1616</td></tr><tr><td align="left">GED path-based <inline-formula id="IEq4"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$^*$$\end{document}</tex-math><mml:math id="M82"><mml:msup><mml:mrow/><mml:mo>∗</mml:mo></mml:msup></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq4.gif"/></alternatives></inline-formula></td><td align="left">1</td><td align="left">7</td><td align="left">2</td><td align="left">13</td></tr><tr><td align="left">MRCA * <inline-formula id="IEq5"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$10^{-4}$$\end{document}</tex-math><mml:math id="M84"><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq5.gif"/></alternatives></inline-formula></td><td align="left">5.16</td><td align="left">5.7</td><td align="left">6.4</td><td align="left">7.5</td></tr><tr><td align="left">COAR</td><td align="left">0.02</td><td align="left">0.54</td><td align="left">0.11</td><td align="left">0.78</td></tr></tbody></table></table-wrap></p>
    </sec>
    <sec id="Sec7">
      <title>Time complexity and running time</title>
      <p id="Par18">The time complexity of a phylogenetic reconstruction algorithm is a function that represents the computing time required to analyse an instance of the problem. Typically, it depends on the number of treated sequences <italic>n</italic> and possibly other parameters. The computational cost of algorithms that exhaustively explore the tree-generating space, producing eventually optimal solutions, increases considerably with input size. On the other hand, time-efficient approaches solve problems faster but can sacrifice accuracy, precision, or completeness. GCtree is an exhaustive approach that explores the entire tree-generating space to find the most parsimonious tree. It uses dnapars with <italic>O</italic>(<inline-formula id="IEq6"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n^3$$\end{document}</tex-math><mml:math id="M86"><mml:msup><mml:mi>n</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq6.gif"/></alternatives></inline-formula>) complexity to produce a forest of equally parsimonious trees. Then GCtree ranks the equally parsimonious trees through the abundance of genotypes. Although ranking parsimony trees requires just a polynomial increase in the dnapars runtime, finding the parsimony forest is computationally demanding and restricted to analysing small-sized problems. MST-based algorithms are time-efficient; they are faster than GCtree because they construct a single tree instead of a forest. Their time complexity is determined by the MST algorithm’s complexity and the pairwise distance calculation. GLaMST and ClonalTree use Prim’s algorithm to grow the tree from the root node and interactively add edges and nodes (possibly unobserved). The time complexity of Prim’s algorithm is <inline-formula id="IEq7"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$O(|E| + \log |V|)$$\end{document}</tex-math><mml:math id="M88"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mo>+</mml:mo><mml:mo>log</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq7.gif"/></alternatives></inline-formula>, where <inline-formula id="IEq8"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$|V|=n$$\end{document}</tex-math><mml:math id="M90"><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq8.gif"/></alternatives></inline-formula> and <italic>E</italic> is the number of edges or connections among nodes. However, GLaMST computes pairwise edit distances using a dynamic programming algorithm with time complexity around <italic>O</italic>(<inline-formula id="IEq9"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n^2$$\end{document}</tex-math><mml:math id="M92"><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq9.gif"/></alternatives></inline-formula>). Contrarily to GCtree and GLaMST, ClonalTree uses hamming distance since sequences are previously aligned with Clustal Omega [<xref ref-type="bibr" rid="CR25">25</xref>]. Both alternatives decrease the ClonalTree time complexity substantially. Hamming distance is computed in <italic>O</italic>(<italic>n</italic>), while multiple sequence alignment is in <inline-formula id="IEq10"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$O(n*(\log (n))^2)$$\end{document}</tex-math><mml:math id="M94"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mrow/><mml:mo>∗</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>log</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq10.gif"/></alternatives></inline-formula>.</p>
      <p id="Par19">In order to provide an estimation of running times of different tools, we choose three data sets with different properties: number of sequences and genotypes. Table <xref rid="Tab4" ref-type="table">4</xref> shows the execution times of each compared tool. Data set <inline-formula id="IEq11"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_1$$\end{document}</tex-math><mml:math id="M96"><mml:msub><mml:mi>D</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq11.gif"/></alternatives></inline-formula> corresponds to a simple simulation, containing 30 sequences and six genotypes. <inline-formula id="IEq12"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_1$$\end{document}</tex-math><mml:math id="M98"><mml:msub><mml:mi>D</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq12.gif"/></alternatives></inline-formula> is the simplest case, and all tools took less than 1 second. <inline-formula id="IEq13"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_2$$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq13.gif"/></alternatives></inline-formula> is a data set provided by GLaMST, containing 684 observed sequences and 541 different genotypes. GCtree took 118 hours, GLaMST spent 55 minutes, and ClonalTree took less than 15 minutes to reconstruct a lineage tree for this data set. <inline-formula id="IEq14"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_3$$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mi>D</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq14.gif"/></alternatives></inline-formula> is the CLL-20 data set, containing 3406 sequences but just 20 genotypes. ClonalTree achieved the lowest execution time (less than 1 second), while GLaMST took 1.5 seconds. GCtree needed 118 hours to produce a tree for the <inline-formula id="IEq15"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_3$$\end{document}</tex-math><mml:math id="M104"><mml:msub><mml:mi>D</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq15.gif"/></alternatives></inline-formula> data set. Although <inline-formula id="IEq16"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_3$$\end{document}</tex-math><mml:math id="M106"><mml:msub><mml:mi>D</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq16.gif"/></alternatives></inline-formula> had more sequences than <inline-formula id="IEq17"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_2$$\end{document}</tex-math><mml:math id="M108"><mml:msub><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq17.gif"/></alternatives></inline-formula>, it contained fewer genotypes, which explains why execution times were lower for <inline-formula id="IEq18"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_3$$\end{document}</tex-math><mml:math id="M110"><mml:msub><mml:mi>D</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq18.gif"/></alternatives></inline-formula>, compared to <inline-formula id="IEq19"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_2$$\end{document}</tex-math><mml:math id="M112"><mml:msub><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq19.gif"/></alternatives></inline-formula>.<table-wrap id="Tab4"><label>Table 4</label><caption><p>ClonalTree, GLaMST and GCtree running times on three data sets</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">Data set</th><th align="left">Number of sequences</th><th align="left">Number of genotypes</th><th align="left">Tool</th><th align="left">Running time</th></tr></thead><tbody><tr><td align="left" rowspan="3"><inline-formula id="IEq20"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_1$$\end{document}</tex-math><mml:math id="M114"><mml:msub><mml:mi>D</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq20.gif"/></alternatives></inline-formula></td><td char="." align="char" rowspan="3">30</td><td char="." align="char" rowspan="3">6</td><td align="left">ClonalTree</td><td align="left">0.006 (s)</td></tr><tr><td align="left">GLaMST</td><td align="left">0.035 (s)</td></tr><tr><td align="left">GCtree</td><td align="left">0.6 (s)</td></tr><tr><td align="left" rowspan="3"><inline-formula id="IEq21"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_2$$\end{document}</tex-math><mml:math id="M116"><mml:msub><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq21.gif"/></alternatives></inline-formula></td><td char="." align="char" rowspan="3">685</td><td char="." align="char" rowspan="3">541</td><td align="left">ClonalTree</td><td align="left">15 (m)</td></tr><tr><td align="left">GLaMST</td><td align="left">55 (m)</td></tr><tr><td align="left">GCtree</td><td align="left">100 (h)</td></tr><tr><td align="left" rowspan="3"><inline-formula id="IEq22"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$D_3$$\end{document}</tex-math><mml:math id="M118"><mml:msub><mml:mi>D</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math><inline-graphic xlink:href="12859_2022_5112_Article_IEq22.gif"/></alternatives></inline-formula></td><td char="." align="char" rowspan="3">3406</td><td char="." align="char" rowspan="3">20</td><td align="left">ClonalTree</td><td align="left">0.032 (s)</td></tr><tr><td align="left">GLaMST</td><td align="left">1.5 (s)</td></tr><tr><td align="left">GCtree</td><td align="left">118 (h)</td></tr></tbody></table><table-wrap-foot><p>Times were measured in (s)econds, (m)inutes, and (h)ours. Note that we used a pre-compiled version of GLaMST since we did not have Matlab software to recompile the source code</p></table-wrap-foot></table-wrap></p>
    </sec>
  </sec>
  <sec id="Sec8">
    <title>Discussion</title>
    <p id="Par20">We have explored 92 simulated B cell lineage trees, ranging in trees’ depths, degrees of roots, number of nodes and leaves, and number of observed sequences, among other tree properties. Our simulations showed that ClonalTree reconstructed accurate trees, preserving the correctness of ancestral reconstruction, compared to ground truth trees. Our approach outperformed GLaMST, a method based only on the minimum spanning tree; ClonalTree systematically produced more maximum parsimonious trees than GLaMST. Compared to GCtree, an exhaustive sequence-based phylogenetic method, ClonalTree presented a comparable performance in most cases, and we observed few differences in the obtained trees. We also evaluated ClonalTree on experimental BCR sequencing data. As observed on simulated data sets, ClonalTree outperformed GLaMST, producing trees closer to GCtree. Our approach obtained similar tree topologies for both experimental data sets, with minor errors in ancestral reconstructions.</p>
    <p id="Par21">ClonalTree is time efficient, showing the lowest time complexity among the compared tools. Its computational efficiency is directly linked to the algorithms choices and programming language. ClonalTree employs multiple sequence alignments, which are faster to compute and preserve important evolutionary properties that would otherwise be lost when using pairwise sequence comparison. Moreover, it is coded in python and uses freely available libraries/software, without any operating system requirement, and is available for scientific community usage. On the other hand, GLaMST is coded in Matlab, a proprietary programming language, and only an executable for Windows is available for users that do not possess a Matlab licence, limiting its usage by the scientific community. Due to its ability to process a high number of sequences within a reasonable amount of time, it is particularly adapted to large datasets obtained by high-throughput repertoire sequencing. ClonalTree may have a great potential for studying the dynamics of immune responses in various disease conditions, such as chronic infectious diseases, autoimmune diseases and lymphoid malignancies. It can compare trees generated in these situations to those generated in normal immune response dynamics. Moreover, it can help understand B-cell clonal lineage evolution by comparing trees of a specific B-cell lineage at different time points, for example, before and after vaccination or treatment.</p>
    <p id="Par22">However, ClonalTree has some limitations; for instance, it does not consider hot spot mutated positions to define a distance between sequences; in the current version, all positions have the same weight. Moreover, it considers only nucleotide sequences as input and does not provide tree visualisations. Future work will address these limitations to provide a more flexible and user-friendly tool.</p>
  </sec>
  <sec id="Sec9">
    <title>Conclusion</title>
    <p id="Par23">We addressed the computational problem of reconstructing lineage trees from high-throughput BCR sequencing data. It is challenging since this data often contains a subset of BCR IGH sequences, partially representing the dynamic process of BCR affinity maturation. Therefore, efficient algorithms must reconstruct the entire evolutionary events from partially observed sequences. Here we propos ClonalTree, a fast method that combines minimum spanning trees with genotype abundance information to reconstruct accurate evolutionary trees. ClonalTree outperformed MST-based methods on simulated and experimental data, and presented similar performances, mainly on experimental data, compared to exhaustive and time-consuming methods such as GCtree. However, ClonalTree is computationally more efficient, presenting a lower time complexity. It was hundreds to thousands of times faster than GCtree, allowing the analysis of large data sets within minutes or seconds and with minor loss of accuracy. ClonalTree’s high and fast performance allows the users to consider all the available genotypes when reconstructing lineage trees. It can help researchers understand B cell receptor affinity maturation, mainly when data from a dense quantitative sampling of diversifying loci are available. Integrating ClonalTree into existing BCR sequencing analysis frameworks could speed up lineage tree reconstructions without compromising the quality of evolutionary trees.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec25">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="12859_2022_5112_MOESM1_ESM.pdf">
            <caption>
              <p><bold>Additional file 1: Fig. S1.</bold> ClonalTree configuration performance; <bold>Fig. S2.</bold> Performance comparison among GCtree, ClonalTree, and GLaMST using GED distances on three categories of trees; <bold>Fig. S3.</bold> Editing the reconstructed B cell lineage tree by adding unobserved internal nodes; <bold>Fig. S4.</bold> Editing the reconstructed BCR lineage tree to reduce the depth of the tree while keeping its overall cost; <bold>Fig. S5.</bold> An example of MRCA calculation; <bold>Fig. S6.</bold> An example of COAR calculation for a given leaf.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="12859_2022_5112_MOESM2_ESM.pdf">
            <caption>
              <p><bold>Additional file 2.</bold> COAR algorithm.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher's Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>The authors are grateful to Thibaud Verny for his insightful comments and fruitful discussion. We also acknowledge the anonymous reviewers that contributed to improving the manuscript and the method.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>JSB and FD designed the project. NA and JSB developed the tool. NA and ADS collected data, and produced simulated benchmarks. JSB, LJ and ADS tested and evaluated the method. JSB wrote the manuscript. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This work has been supported by “2016 Programme Doctoral de Cancérologie” from Sorbonne University, and SIRIC CURAMUS (Cancer United Research Associating Medicine, University and Society, INCA-DGOS-Inserm_12560) and by an ERA-NET TRANSCAN-2/French National Cancer Institute grant (NOVEL consortium).</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>The data supporting this work’s findings can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/GCtree/tree/master/example">https://github.com/matsengrp/GCtree/tree/master/example</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://github.com/julibinho/ClonalTree/tree/main/Data">https://github.com/julibinho/ClonalTree/tree/main/Data</ext-link>. The source code and install instructions are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/julibinho/ClonalTree/">https://github.com/julibinho/ClonalTree/</ext-link>.</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar2">
      <title>Ethics approval and consent to participate</title>
      <p id="Par46">Informed consent for use of the patients samples for research purposes was obtained.</p>
    </notes>
    <notes id="FPar3">
      <title>Consent for publication</title>
      <p id="Par47">Not applicable.</p>
    </notes>
    <notes id="FPar1" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par48">The authors declare that they have no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bassing</surname>
            <given-names>CH</given-names>
          </name>
          <name>
            <surname>Swat</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Alt</surname>
            <given-names>FW</given-names>
          </name>
        </person-group>
        <article-title>The mechanism and regulation of chromosomal v (d) j recombination</article-title>
        <source>Cell</source>
        <year>2002</year>
        <volume>109</volume>
        <issue>2</issue>
        <fpage>45</fpage>
        <lpage>55</lpage>
        <pub-id pub-id-type="doi">10.1016/S0092-8674(02)00675-X</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tonegawa</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Somatic generation of antibody diversity</article-title>
        <source>Nature</source>
        <year>1983</year>
        <volume>302</volume>
        <issue>5909</issue>
        <fpage>575</fpage>
        <lpage>581</lpage>
        <pub-id pub-id-type="doi">10.1038/302575a0</pub-id>
        <?supplied-pmid 6300689?>
        <pub-id pub-id-type="pmid">6300689</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Victora</surname>
            <given-names>GD</given-names>
          </name>
          <name>
            <surname>Nussenzweig</surname>
            <given-names>MC</given-names>
          </name>
        </person-group>
        <article-title>Germinal centers</article-title>
        <source>Annu Rev Immunol</source>
        <year>2012</year>
        <volume>30</volume>
        <fpage>429</fpage>
        <lpage>457</lpage>
        <pub-id pub-id-type="doi">10.1146/annurev-immunol-020711-075032</pub-id>
        <?supplied-pmid 22224772?>
        <pub-id pub-id-type="pmid">22224772</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>de Bourcy</surname>
            <given-names>CF</given-names>
          </name>
          <name>
            <surname>Angel</surname>
            <given-names>CJL</given-names>
          </name>
          <name>
            <surname>Vollmers</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Dekker</surname>
            <given-names>CL</given-names>
          </name>
          <name>
            <surname>Davis</surname>
            <given-names>MM</given-names>
          </name>
          <name>
            <surname>Quake</surname>
            <given-names>SR</given-names>
          </name>
        </person-group>
        <article-title>Phylogenetic analysis of the human antibody repertoire reveals quantitative signatures of immune senescence and aging</article-title>
        <source>Proc Natl Acad Sci</source>
        <year>2017</year>
        <volume>114</volume>
        <issue>5</issue>
        <fpage>1105</fpage>
        <lpage>1110</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1617959114</pub-id>
        <?supplied-pmid 28096374?>
        <pub-id pub-id-type="pmid">28096374</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <mixed-citation publication-type="other">Safonova Y, Pevzner PA. Igevolution: clonal analysis of antibody repertoires. bioRxiv, 2019;725424</mixed-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>DW</given-names>
          </name>
          <name>
            <surname>Khavrutskii</surname>
            <given-names>IV</given-names>
          </name>
          <name>
            <surname>Wallqvist</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Bavari</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Cooper</surname>
            <given-names>CL</given-names>
          </name>
          <name>
            <surname>Chaudhury</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Brilia: integrated tool for high-throughput annotation and lineage tree assembly of b-cell repertoires</article-title>
        <source>Front Immunol</source>
        <year>2017</year>
        <volume>7</volume>
        <fpage>681</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2016.00681</pub-id>
        <?supplied-pmid 28144239?>
        <pub-id pub-id-type="pmid">28144239</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Greaves</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Maley</surname>
            <given-names>CC</given-names>
          </name>
        </person-group>
        <article-title>Clonal evolution in cancer</article-title>
        <source>Nature</source>
        <year>2012</year>
        <volume>481</volume>
        <issue>7381</issue>
        <fpage>306</fpage>
        <lpage>313</lpage>
        <pub-id pub-id-type="doi">10.1038/nature10762</pub-id>
        <?supplied-pmid 22258609?>
        <pub-id pub-id-type="pmid">22258609</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoehn</surname>
            <given-names>KB</given-names>
          </name>
          <name>
            <surname>Fowler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Lunter</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Pybus</surname>
            <given-names>OG</given-names>
          </name>
        </person-group>
        <article-title>The diversity and molecular evolution of b-cell receptors during infection</article-title>
        <source>Mol Biol Evol</source>
        <year>2016</year>
        <volume>33</volume>
        <issue>5</issue>
        <fpage>1147</fpage>
        <lpage>1157</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msw015</pub-id>
        <?supplied-pmid 26802217?>
        <pub-id pub-id-type="pmid">26802217</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Giudicelli</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Chaume</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Lefranc</surname>
            <given-names>M-P</given-names>
          </name>
        </person-group>
        <article-title>IMGT/GENE-DB: a comprehensive database for human and mouse immunoglobulin and T cell receptor genes</article-title>
        <source>Nucleic Acids Res</source>
        <year>2004</year>
        <volume>33</volume>
        <issue>Database issue</issue>
        <fpage>256</fpage>
        <lpage>261</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gki010</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Alamyar E, Duroux P, Lefranc M-P, Giudicelli V. Imgt® tools for the nucleotide analysis of immunoglobulin (ig) and t cell receptor (tr) v-(d)-j repertoires, polymorphisms, and ig mutations: Imgt/v-quest and imgt/highv-quest for ngs. In: Immunogenetics. Springer, p. 569–604 (2012)</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tas</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Mesin</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Pasqual</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Targ</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Jacobsen</surname>
            <given-names>JT</given-names>
          </name>
          <name>
            <surname>Mano</surname>
            <given-names>YM</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>CS</given-names>
          </name>
          <name>
            <surname>Weill</surname>
            <given-names>J-C</given-names>
          </name>
          <name>
            <surname>Reynaud</surname>
            <given-names>C-A</given-names>
          </name>
          <name>
            <surname>Browne</surname>
            <given-names>EP</given-names>
          </name>
        </person-group>
        <article-title>Visualizing antibody affinity maturation in germinal centers</article-title>
        <source>Science</source>
        <year>2016</year>
        <volume>351</volume>
        <issue>6277</issue>
        <fpage>1048</fpage>
        <lpage>1054</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aad3439</pub-id>
        <?supplied-pmid 26912368?>
        <pub-id pub-id-type="pmid">26912368</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuraoka</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Schmidt</surname>
            <given-names>AG</given-names>
          </name>
          <name>
            <surname>Nojima</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Feng</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Watanabe</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Kitamura</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Harrison</surname>
            <given-names>SC</given-names>
          </name>
          <name>
            <surname>Kepler</surname>
            <given-names>TB</given-names>
          </name>
          <name>
            <surname>Kelsoe</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Complex antigens drive permissive clonal selection in germinal centers</article-title>
        <source>Immunity</source>
        <year>2016</year>
        <volume>44</volume>
        <issue>3</issue>
        <fpage>542</fpage>
        <lpage>552</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2016.02.010</pub-id>
        <?supplied-pmid 26948373?>
        <pub-id pub-id-type="pmid">26948373</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Davidsen</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Matsen</surname>
            <given-names>FA</given-names>
            <suffix>IV</suffix>
          </name>
        </person-group>
        <article-title>Benchmarking tree and ancestral sequence inference for b cell receptor sequences</article-title>
        <source>Front Immunol</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>2451</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2018.02451</pub-id>
        <?supplied-pmid 30429847?>
        <pub-id pub-id-type="pmid">30429847</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yermanos</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Greiff</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Krautler</surname>
            <given-names>NJ</given-names>
          </name>
          <name>
            <surname>Menzel</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Dounas</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Miho</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Oxenius</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Stadler</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Reddy</surname>
            <given-names>ST</given-names>
          </name>
        </person-group>
        <article-title>Comparison of methods for phylogenetic b-cell lineage inference using time-resolved antibody repertoire simulations (absim)</article-title>
        <source>Bioinformatics</source>
        <year>2017</year>
        <volume>33</volume>
        <issue>24</issue>
        <fpage>3938</fpage>
        <lpage>3946</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btx533</pub-id>
        <?supplied-pmid 28968873?>
        <pub-id pub-id-type="pmid">28968873</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Barak</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Zuckerman</surname>
            <given-names>NS</given-names>
          </name>
          <name>
            <surname>Edelman</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Unger</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Mehr</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Igtree: creating immunoglobulin variable region gene lineage trees</article-title>
        <source>J Immunol Methods</source>
        <year>2008</year>
        <volume>338</volume>
        <issue>1–2</issue>
        <fpage>67</fpage>
        <lpage>74</lpage>
        <pub-id pub-id-type="doi">10.1016/j.jim.2008.06.006</pub-id>
        <?supplied-pmid 18706908?>
        <pub-id pub-id-type="pmid">18706908</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Felsenstein</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Evolutionary trees from dna sequences: a maximum likelihood approach</article-title>
        <source>J Mol Evol</source>
        <year>1981</year>
        <volume>17</volume>
        <issue>6</issue>
        <fpage>368</fpage>
        <lpage>376</lpage>
        <pub-id pub-id-type="doi">10.1007/BF01734359</pub-id>
        <?supplied-pmid 7288891?>
        <pub-id pub-id-type="pmid">7288891</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liò</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Goldman</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Models of molecular evolution and phylogeny</article-title>
        <source>Genome Res</source>
        <year>1998</year>
        <volume>8</volume>
        <issue>12</issue>
        <fpage>1233</fpage>
        <lpage>1244</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.8.12.1233</pub-id>
        <?supplied-pmid 9872979?>
        <pub-id pub-id-type="pmid">9872979</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hoehn</surname>
            <given-names>KB</given-names>
          </name>
          <name>
            <surname>Lunter</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Pybus</surname>
            <given-names>OG</given-names>
          </name>
        </person-group>
        <article-title>A phylogenetic codon substitution model for antibody lineages</article-title>
        <source>Genetics</source>
        <year>2017</year>
        <volume>206</volume>
        <issue>1</issue>
        <fpage>417</fpage>
        <lpage>427</lpage>
        <pub-id pub-id-type="doi">10.1534/genetics.116.196303</pub-id>
        <?supplied-pmid 28315836?>
        <pub-id pub-id-type="pmid">28315836</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>DeWitt</surname>
            <given-names>WS</given-names>
            <suffix>III</suffix>
          </name>
          <name>
            <surname>Mesin</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Victora</surname>
            <given-names>GD</given-names>
          </name>
          <name>
            <surname>Minin</surname>
            <given-names>VN</given-names>
          </name>
          <name>
            <surname>Matsen</surname>
            <given-names>FA</given-names>
            <suffix>IV</suffix>
          </name>
        </person-group>
        <article-title>Using genotype abundance to improve phylogenetic inference</article-title>
        <source>Mol Biol Evol</source>
        <year>2018</year>
        <volume>35</volume>
        <issue>5</issue>
        <fpage>1253</fpage>
        <lpage>1265</lpage>
        <pub-id pub-id-type="doi">10.1093/molbev/msy020</pub-id>
        <?supplied-pmid 29474671?>
        <pub-id pub-id-type="pmid">29474671</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Felsenstein J. PHYLIP (phylogeny Inference Package), Version 3.5 C. Joseph Felsenstein (1993)</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <mixed-citation publication-type="other">Harris TE. The theory of branching process (1964)</mixed-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yang</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Tipton</surname>
            <given-names>CM</given-names>
          </name>
          <name>
            <surname>Woodruff</surname>
            <given-names>MC</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>FE-H</given-names>
          </name>
          <name>
            <surname>Sanz</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Qiu</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Glamst: Grow lineages along minimum spanning tree for b cell receptor sequencing data</article-title>
        <source>BMC Genomics</source>
        <year>2020</year>
        <volume>21</volume>
        <issue>9</issue>
        <fpage>1</fpage>
        <lpage>11</lpage>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sanfeliu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Sanfeliu</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Fu</surname>
            <given-names>KS</given-names>
          </name>
        </person-group>
        <article-title>A distance measure between attributed relational graphs for pattern recognition</article-title>
        <source>IEEE Trans Syst Man Cybern</source>
        <year>1983</year>
        <volume>SMC–13</volume>
        <issue>3</issue>
        <fpage>353</fpage>
        <lpage>362</lpage>
        <pub-id pub-id-type="doi">10.1109/TSMC.1983.6313167</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Lefranc M-P, Duroux P, Li S, Giudicelli V, Alamyar E. IMGT/highv-quest: the IMGT web portal for immunoglobulin (ig) or antibody and t cell receptor (tr) analysis from ngs high throughput and deep sequencing. Immunome Res 2012;<bold>08</bold>(01).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <mixed-citation publication-type="other">Sievers F, Higgins DG. Clustal omega, accurate alignment of very large numbers of sequences. In: Multiple Sequence Alignment Methods. Springer, p. 105–116 (2014)</mixed-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Prim</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Shortest connection networks and some generalizations</article-title>
        <source>Bell Syst Tech J</source>
        <year>1957</year>
        <volume>36</volume>
        <issue>6</issue>
        <fpage>1389</fpage>
        <lpage>1401</lpage>
        <pub-id pub-id-type="doi">10.1002/j.1538-7305.1957.tb01515.x</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kruskal</surname>
            <given-names>JB</given-names>
          </name>
        </person-group>
        <article-title>On the shortest spanning subtree of a graph and the traveling salesman problem</article-title>
        <source>Proc Am Math Soc</source>
        <year>1956</year>
        <volume>7</volume>
        <issue>1</issue>
        <fpage>48</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="doi">10.1090/S0002-9939-1956-0078686-7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Marler</surname>
            <given-names>RT</given-names>
          </name>
          <name>
            <surname>Arora</surname>
            <given-names>JS</given-names>
          </name>
        </person-group>
        <article-title>Survey of multi-objective optimization methods for engineering</article-title>
        <source>Struct Multidiscipl Optim</source>
        <year>2004</year>
        <volume>26</volume>
        <issue>6</issue>
        <fpage>369</fpage>
        <lpage>395</lpage>
        <pub-id pub-id-type="doi">10.1007/s00158-003-0368-6</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Waltz</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>An engineering approach: hierarchical optimization criteria</article-title>
        <source>IEEE Trans Autom Control</source>
        <year>1967</year>
        <volume>12</volume>
        <issue>2</issue>
        <fpage>179</fpage>
        <lpage>180</lpage>
        <pub-id pub-id-type="doi">10.1109/TAC.1967.1098537</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Huang F, Gao P, Wang Y. Comparison of prim and Kruskal on shanghai and Shenzhen 300 index hierarchical structure tree. In: 2009 International Conference on Web Information Systems and Mining (2009). p. 237–241.</mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Fredman ML. Fibonacci Heaps and Their Uses in Improved Network Optimization Algorithms. Technical Report 3.</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Levenshtein</surname>
            <given-names>VI</given-names>
          </name>
        </person-group>
        <article-title>Binary codes capable of correcting deletions, insertions, and reversals</article-title>
        <source>Sov Phys Doklady</source>
        <year>1966</year>
        <volume>10</volume>
        <fpage>707</fpage>
        <lpage>710</lpage>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hamming</surname>
            <given-names>RW</given-names>
          </name>
        </person-group>
        <article-title>Error detecting and error correcting codes</article-title>
        <source>Bell Syst Tech J</source>
        <year>1950</year>
        <volume>29</volume>
        <issue>2</issue>
        <fpage>147</fpage>
        <lpage>160</lpage>
        <pub-id pub-id-type="doi">10.1002/j.1538-7305.1950.tb00463.x</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yaari</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Vander Heiden</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Uduman</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gadala-Maria</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gupta</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Stern</surname>
            <given-names>JN</given-names>
          </name>
          <name>
            <surname>O’Connor</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Hafler</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Laserson</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Vigneault</surname>
            <given-names>F</given-names>
          </name>
        </person-group>
        <article-title>Models of somatic hypermutation targeting and substitution based on synonymous mutations from high-throughput immunoglobulin sequencing data</article-title>
        <source>Front Immunol</source>
        <year>2013</year>
        <volume>4</volume>
        <fpage>358</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2013.00358</pub-id>
        <?supplied-pmid 24298272?>
        <pub-id pub-id-type="pmid">24298272</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ralph</surname>
            <given-names>DK</given-names>
          </name>
          <name>
            <surname>Matsen</surname>
            <given-names>FA</given-names>
            <suffix>IV</suffix>
          </name>
        </person-group>
        <article-title>Likelihood-based inference of b cell clonal families</article-title>
        <source>PLoS Comput Biol</source>
        <year>2016</year>
        <volume>12</volume>
        <issue>10</issue>
        <fpage>1005086</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1005086</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <mixed-citation publication-type="other">Garey MR, Johnson DS. Computers and intractability: a guide to the theory of NP-completeness. Mathematical Sciences Series. W.H. Freeman (1979)</mixed-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Neuhaus</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Bunke</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <source>Bridging the gap between graph edit distance and kernel machines. Series in machine perception and artificial intelligence</source>
        <year>2007</year>
        <publisher-loc>Singapore</publisher-loc>
        <publisher-name>World Scientific</publisher-name>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Riesen K. Structural pattern recognition with graph edit distance: approximation algorithms and applications. Advances in Computer Vision and Pattern Recognition. Springer (2016)</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Needleman</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>Wunsch</surname>
            <given-names>CD</given-names>
          </name>
        </person-group>
        <article-title>A general method applicable to the search for similarities in the amino acid sequence of two proteins</article-title>
        <source>J Mol Biol</source>
        <year>1970</year>
        <volume>48</volume>
        <issue>3</issue>
        <fpage>443</fpage>
        <lpage>453</lpage>
        <pub-id pub-id-type="doi">10.1016/0022-2836(70)90057-4</pub-id>
        <?supplied-pmid 5420325?>
        <pub-id pub-id-type="pmid">5420325</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">Kepler TB. Reconstructing a b-cell clonal lineage. i. statistical inference of unobserved ancestors. F1000Research 2013;2.</mixed-citation>
    </ref>
  </ref-list>
</back>
