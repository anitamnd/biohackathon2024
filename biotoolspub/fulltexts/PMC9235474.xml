<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9235474</article-id>
    <article-id pub-id-type="pmid">35758781</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac227</article-id>
    <article-id pub-id-type="publisher-id">btac227</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>ISCB/Ismb 2022</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Regulatory and Functional Genomics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>psupertime: supervised pseudotime analysis for time-series single-cell RNA-seq data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Macnair</surname>
          <given-names>Will</given-names>
        </name>
        <aff>
          <institution>Institute of Molecular Systems Biology, Department of Biology, ETH Zurich, Zurich 8093, Switzerland</institution>
        </aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gupta</surname>
          <given-names>Revant</given-names>
        </name>
        <aff>
          <institution>Inner Medicine I, Faculty of Medicine, University of Tübingen, University Hospital Tübingen, 72074, Germany</institution>
        </aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Claassen</surname>
          <given-names>Manfred</given-names>
        </name>
        <aff>
          <institution>Inner Medicine I, Faculty of Medicine, University of Tübingen, University Hospital Tübingen, 72074, Germany</institution>
        </aff>
        <aff><institution>Department of Computer Science, University of Tübingen</institution>, Tübingen 72074, <country country="DE">Germany</country></aff>
        <xref rid="btac227-cor1" ref-type="corresp"/>
        <!--manfred.claassen@med.uni-tuebingen.de-->
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac227-cor1">To whom correspondence should be addressed. E-mail: <email>manfred.claassen@med.uni-tuebingen.de</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>7</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-06-27">
      <day>27</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>6</month>
      <year>2022</year>
    </pub-date>
    <volume>38</volume>
    <issue>Suppl 1</issue>
    <issue-title>ISCB ISMB 2022 Proceedings</issue-title>
    <fpage>i290</fpage>
    <lpage>i298</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac227.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Improvements in single-cell RNA-seq technologies mean that studies measuring multiple experimental conditions, such as time series, have become more common. At present, few computational methods exist to infer time series-specific transcriptome changes, and such studies have therefore typically used unsupervised pseudotime methods. While these methods identify cell subpopulations and the transitions between them, they are not appropriate for identifying the genes that vary coherently along the time series. In addition, the orderings they estimate are based only on the major sources of variation in the data, which may not correspond to the processes related to the time labels.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>We introduce psupertime, a supervised pseudotime approach based on a regression model, which explicitly uses time-series labels as input. It identifies genes that vary coherently along a time series, in addition to pseudotime values for individual cells, and a classifier that can be used to estimate labels for new data with unknown or differing labels. We show that psupertime outperforms benchmark classifiers in terms of identifying time-varying genes and provides better individual cell orderings than popular unsupervised pseudotime techniques. psupertime is applicable to any single-cell RNA-seq dataset with sequential labels (e.g. principally time series but also drug dosage and disease progression), derived from either experimental design and provides a fast, interpretable tool for targeted identification of genes varying along with specific biological processes.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>R package available at github.com/wmacnair/psupertime and code for results reproduction at github.com/wmacnair/psupplementary.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Single-cell RNA-sequencing studies have been used to define the transcriptional changes in biological time series, including embryonic development (<xref rid="btac227-B18" ref-type="bibr">Petropoulos <italic toggle="yes">et al.</italic>, 2016</xref>), response to stimulus (<xref rid="btac227-B28" ref-type="bibr">Treutlein <italic toggle="yes">et al.</italic>, 2016</xref>), differentiation (<xref rid="btac227-B3" ref-type="bibr">Bendall <italic toggle="yes">et al.</italic>, 2014</xref>) and ageing (<xref rid="btac227-B8" ref-type="bibr">Enge <italic toggle="yes">et al.</italic>, 2017</xref>). Such studies are based on single-cell RNA-seq measurements over a sequence of experimental labels of the successive timepoints. These data are typically analysed using unsupervised pseudotime techniques to extract the corresponding temporal sequence of transcriptomic states. These approaches use similarities between cells to computationally order them along trajectories, allowing researchers to identify high-level cell subpopulations and the transitions between them. However, unsupervised methods are not designed to identify genes associated with a process unfolding over time. In addition, they assume that the major driver of variation in the data is most indicative of the time series-induced cell orderings. This means that where the changes along the time series are subtle, or where there are strong additional sources of variation, the orderings they identify may not be those associated with the time series (<xref rid="btac227-B22" ref-type="bibr">Saelens <italic toggle="yes">et al.</italic>, 2019</xref>). Only recently, approaches have been published to derive or refine pseudotime with time-series information (<xref rid="btac227-B25" ref-type="bibr">Shao <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac227-B27" ref-type="bibr">Tran and Bader, 2020</xref>). To further address this methodological gap, we introduce a supervised pseudotime technique, psupertime, which explicitly uses time-series labels as input (<xref rid="btac227-F1" ref-type="fig">Fig. 1A</xref>). psupertime is based on penalized ordinal regression (<xref rid="btac227-F1" ref-type="fig">Fig. 1B</xref>), a statistical technique used where data have categorical labels that follow a sequence. psupertime produces three outputs. Firstly, it learns a small, interpretable set of genes that vary coherently over the time series. Secondly, a linear combination of these genes assigns a pseudotime value to each cell, which approximately recapitulates the ordering specified by the sequence of labels. Thirdly, it can be used to classify new data according to the process labelled in the data used for training. These outputs allow for targeted characterization of processes for any single-cell RNA-seq data where sequential labels are available (such as time, disease progression or unidimensional spatial measurements), despite substantial variation not associated with the process of interest. Full details of the method are given in Section 2.</p>
    <fig position="float" id="btac227-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>(<bold>A</bold>) Inputs to psupertime are single-cell RNA-seq data, where the cells have sequential labels associated with them. psupertime then identifies a sparse set of ordering coefficients for the genes. Multiplying the gene expression values by this vector of coefficients gives pseudotime values for each cell, which place the labels approximately in sequence. (<bold>B</bold>) Cartoon of statistical model used by psupertime, including thresholds between labels. Where there is a sequence of <italic toggle="yes">K</italic> condition labels, psupertime learns <italic toggle="yes">K−</italic>1 simultaneous (i.e. sharing coefficients) logistic regressions, each seeking to separate labels <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> (out) from <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mi>k</mml:mi><mml:mo>…</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula> (in). (<bold>C</bold>) Dimensionality reduction of 411 human acinar cell data with ages ranging from 1 to 54 (<xref rid="btac227-B8" ref-type="bibr">Enge <italic toggle="yes">et al.</italic>, 2017</xref>). Representations in two dimensions via non-linear dimensionality reduction technique UMAP. Colours indicate donor age. (<bold>D</bold>) Distributions of donor ages for acinar cells over the pseudotime learned psupertime. Vertical lines indicate thresholds learned by psupertime distinguishing between earlier and later sets of labels; colour corresponds to the next later label. (<bold>E</bold>) Expression values of selected genes (five with largest absolute coefficients; see <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref> for 20 largest). The <italic toggle="yes">x</italic>-axis is psupertime value learned for each cell; <italic toggle="yes">y</italic>-axis is z-scored <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> gene expression values. Gene labels also show the Kendall’s <italic toggle="yes">τ</italic> correlation between sequential labels (treated as a sequence of integers <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>) and gene expression</p>
      </caption>
      <graphic xlink:href="btac227f1" position="float"/>
    </fig>
    <p>We demonstrate psupertime on a dataset comprising 411 acinar cells from the pancreas, from eight human donors with ages from 1 to 54 years (<xref rid="btac227-B8" ref-type="bibr">Enge <italic toggle="yes">et al.</italic>, 2017</xref>). Acinar cells perform the exocrine function of the pancreas, producing enzymes for the digestive system. This dataset was selected because each set of cells was obtained from different donors, resulting in significant variation in the dataset unrelated to donor age (<xref rid="btac227-F1" ref-type="fig">Fig. 1C</xref>). Despite this variation, psupertime finds a cell-level ordering which respects the age progression, while separating the labels from each other (<xref rid="btac227-F1" ref-type="fig">Fig. 1D</xref>). We show that the performance of psupertime is robust, including perturbations in labels (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S1</xref>).</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Overview of psupertime methodology</title>
      <p>psupertime requires two inputs: (i) a matrix of log read counts from single-cell RNA-seq, where columns correspond to genes and rows correspond to cells; and (ii) a set of labels for the cells, with a defined sequence for the labels (e.g. a set of cells could have labels <italic toggle="yes">day1</italic>, <italic toggle="yes">day3</italic>, <italic toggle="yes">day1</italic>, <italic toggle="yes">day2</italic>, <italic toggle="yes">day3</italic>). (Note that not all cells need to be labelled: psupertime can also be run on a labelled subset.) psupertime then identifies a set of ordering coefficients, <italic toggle="yes">β<sub>i</sub></italic>, one for each gene (<xref rid="btac227-F1" ref-type="fig">Fig. 1A</xref>). Multiplication by this vector of coefficients converts the matrix of log gene expression values into pseudotime values for each individual cell. The set of pseudotime values recapitulates the known label sequence (so the cells with labels <italic toggle="yes">day1</italic> will on average have lower pseudotime values than those labelled <italic toggle="yes">day2</italic> and so on). The vector of coefficients is <italic toggle="yes">sparse</italic>, in the sense that many of the values are zero; these therefore have no influence on the ordering of the cells. Genes with non-zero coefficients are therefore identified by psupertime as relevant to the process which generated the sequential labels.</p>
      <p>Suppose the sequence of condition labels we have is <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>. Intuitively, psupertime learns a weighted average of gene expression values that separates the cells with label 1 from the cells with labels <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>, at the same time as separating 1, 2 from <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>, and 1, 2, 3 from <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mn>4</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula> and so on (<xref rid="btac227-F1" ref-type="fig">Fig. 1B</xref>). This can be thought of as solving <italic toggle="yes">K—</italic>1 simultaneous logistic regression problems and is termed <italic toggle="yes">ordinal logistic regression</italic> (<xref rid="btac227-B15" ref-type="bibr">McCullagh, 1980</xref>).</p>
      <p>As described so far, psupertime can be thought of as minimizing a cost, where the cost is the error in the resulting ordering. To make the results more interpretable, we would like psupertime to use a small set of genes for prediction. To do this, we add a cost for each coefficient <italic toggle="yes">β<sub>i</sub></italic> used, so that psupertime is minimizing <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">error</mml:mi><mml:mo>+</mml:mo><mml:mo>λ</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>; approaches like this are termed <italic toggle="yes">regularization</italic>, and in this case <italic toggle="yes">L1 regularization</italic>. The parameter <italic toggle="yes">λ</italic> controls the balance between minimizing error, and minimizing the ‘coefficient cost’. The method for implementing this approach is based on the R package glmnetcr, which we have extended with an additional statistical model.</p>
      <p>The results of this procedure are: (i) a small and therefore interpretable set of genes with non-zero coefficients; (ii) a pseudotime value for each individual cell, obtained by multiplying the log gene expression values by the vector of coefficients; and (iii) a set of values along the pseudotime axis indicating the thresholds between successive sequential labels (these can then be used for classification of new samples). Where the data do not have condition labels, psupertime can be combined with unsupervised clustering to identify relevant processes (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S3</xref>).</p>
    </sec>
    <sec>
      <title>2.2 Pre-processing of data</title>
      <p>To restrict the analysis to relevant genes and denoise the data, psupertime first applies pre-processing to the log transcripts per million values. Specifically, psupertime first restricts to highly variable genes, as defined in the scran package in R, i.e. genes that show above the expected variance relative to genes with similar mean expression (<xref rid="btac227-B14" ref-type="bibr">Lun <italic toggle="yes">et al.</italic>, 2016</xref>). Genes that are only expressed in a small number of cells (the default is 1%) are excluded. psupertime implement data denoising and dropout correction by calculating correlations between the log expression values across all selected genes for each pair of cells, using the correlations to identify the 10 nearest neighbours for each cell and replacing the value for a given cell by the mean value over these neighbours. Finally, the resulting log-count values for each gene are scaled to have mean zero and standard deviation one.</p>
    </sec>
    <sec>
      <title>2.3 Penalized ordinal logistic regression</title>
      <p>psupertime applies cross-validated regularized ordinal logistic regression to the processed data, using the labels as the sequence. Ordinal logistic regression is an extension of binary logistic regression to an outcome variable with more than two labels, where the labels have a known or hypothesized sequence. The likelihood for ordinal logistic regression is defined by multiple simultaneous logistic regressions, where each one models the probability of a given observation having an earlier or later label, with the definition of ‘early’/‘late’ differing across the simultaneous regressions (<xref rid="btac227-F1" ref-type="fig">Fig. 1B</xref>). The same linear combination of input variables is used across all individual logistic regressions. This specific model of ordinal logistic regression, in which the simultaneous logistic regressions each seek to separate labels <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> from labels <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mi>k+</mml:mi><mml:mo> </mml:mo><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>, is termed <italic toggle="yes">proportional odds</italic>. (A commonly used alternative is the <italic toggle="yes">continuation ratio</italic> model, where the regressions seek to separate labels <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> from label <italic toggle="yes">k </italic>+<italic toggle="yes"> </italic>1 alone. This is also implemented as an option in psupertime.)</p>
      <p>In the case where the number of input variables is high relative to number of observations and may include many uninformative variables, as is common in single-cell RNA-seq, it can be helpful to introduce sparsity (i.e. to increase the number of zero coefficients). psupertime uses <italic toggle="yes">L1 regularization</italic> to do this. Our approach is based on that in the R package glmnetcr (<xref rid="btac227-B2" ref-type="bibr">Archer and Williams, 2012</xref>), which reformulates the data and associated likelihood functions into one single regression model, to take advantage of the fast performance of the glmnet package (<xref rid="btac227-B9" ref-type="bibr">Friedman <italic toggle="yes">et al.</italic>, 2010</xref>). The model originally implemented in glmnetcr is the continuation ratio likelihood; we have extended this approach to implement the proportional odds likelihood, as this model is more appropriate for assessing an entire biological process. Under the proportional odds assumption, the two categories are: categories <italic toggle="yes">j</italic> and higher, and categories lower than <italic toggle="yes">j</italic>; the regression therefore estimates <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>&gt;</mml:mo><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Under the continuation ratio assumption, the two categories are: <italic toggle="yes">j</italic>, and categories lower than <italic toggle="yes">j</italic>; here, the regression estimates <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mi mathvariant="italic">log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Intuitively, the proportional odds framework models an observation’s global progression along the ordinal values, while the continuation ratio framework models the probability of proceeding to the next ordinal value. For most of the examples that we have seen, such as studying development or ageing, the proportional odds framework is appropriate. However, the continuation ratio framework may be appropriate in some cases, for example in disease progression, or evolutionary processes. Given input data <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>y</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">N</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> condition labels (which for simplicity we assume are integers), this results in the following cumulative distribution function for ordinal logistic regression:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mi>j</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>ϕ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mtext>exp</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>Here, <italic toggle="yes">X<sub>i</sub></italic> and <italic toggle="yes">y<sub>i</sub></italic> are the vector and integer corresponding to the <italic toggle="yes">i</italic>th observation and label respectively, <italic toggle="yes">j</italic> indicates one of the possible condition labels, <italic toggle="yes">β</italic> is the vector of coefficients and <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> are the thresholds between labels. <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mo>ϕ</mml:mo></mml:math></inline-formula> is the logit link function, which transforms the linear combination of predictors into a probability. Note that the probability given here is cumulative and that to calculate the probability of an individual label, we have to calculate the difference between successive labels. This results in the following <italic toggle="yes">unpenalized</italic> likelihood:
<disp-formula id="E2"><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>β</mml:mo><mml:mo>,</mml:mo><mml:mo>θ</mml:mo><mml:mo>|</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mo stretchy="false">(</mml:mo><mml:mo>ϕ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo>ϕ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>θ</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">y<sub>i</sub></italic> is the label of observation <italic toggle="yes">i</italic>. Including the L1 penalty, for a given value of <italic toggle="yes">λ</italic>, we obtain the optimal values of <italic toggle="yes">β</italic> and <italic toggle="yes">θ</italic> by maximizing the following penalized objective function:
<disp-formula id="E3"><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:munder><mml:mrow><mml:mtext>argmax</mml:mtext></mml:mrow><mml:mrow><mml:mo>β</mml:mo><mml:mo>,</mml:mo><mml:mo>θ</mml:mo></mml:mrow></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>β</mml:mo><mml:mo>,</mml:mo><mml:mo>θ</mml:mo><mml:mo>|</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo>λ</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>p</mml:mi></mml:munderover><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>psupertime uses cross-validation (with 5 folds as default) to identify the optimal level of L1 regularization: the optimal <italic toggle="yes">λ</italic> is the value with the highest mean score over all held-out folds (either accuracy or cross-entropy may be selected as the score; the default is cross-entropy). To increase sparsity, we use the highest value of <italic toggle="yes">λ</italic> with mean training score within one standard error of the optimal <italic toggle="yes">λ</italic>, rather than take the optimal <italic toggle="yes">λ</italic> itself [following <xref rid="btac227-B9" ref-type="bibr">Friedman <italic toggle="yes">et al.</italic> (2010)</xref>]. The model is then retrained using all training data, with this value of <italic toggle="yes">λ</italic>, to obtain the best-fitting model.</p>
      <p>Where psupertime is used to classify completely new data (e.g. from a different experiment), to make the predictions more robust, the cross-validation should take data structure into account (e.g. selecting entire samples to be left out, rather than cells selected at random).</p>
    </sec>
    <sec>
      <title>2.4 Psupertime outputs</title>
      <p>The psupertime procedure results in a set of coefficients for all input genes (many of which will be zero) that can be used to project each cell onto a pseudotime axis, and a set of cut-offs indicating the thresholds between successive sequential labels (<xref rid="btac227-F1" ref-type="fig">Fig. 1D</xref>). These can be analysed in various useful ways.</p>
      <p>The small, interpretable set of genes reported to have non-zero coefficients permits both validation that the procedure has been successful (by observation of genes known to be relevant to the process) and discovery of new relevant genes. The magnitude of a coefficient is a measure of the contribution of this gene to the cell ordering. More precisely, for a gene <italic toggle="yes">i</italic> with coefficient <italic toggle="yes">β<sub>i</sub></italic>, each unit increase in log transcript abundance multiplies the odds ratio between earlier and later labels by <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>β</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. Where <italic toggle="yes">β<sub>i</sub></italic> is small, a Taylor expansion indicates this is approximately equal to a linear increase by a factor of <italic toggle="yes">β<sub>i</sub></italic>.</p>
      <p>The thresholds indicate the points along the psupertime axis at which the probability of label membership is equal for labels before the cut-off, and after the cut-off. The distances between thresholds, namely the size of transcriptional difference between successive labels, are not assumed to be constant and are learned by psupertime. Distances between thresholds therefore indicate dissimilarity between adjacent labels, and thresholds which are close together suggest labels which are transcriptionally difficult to distinguish.</p>
      <p>The learned geneset can also be used as input to dimensionality reduction algorithms such as t-SNE or UMAP; this is discussed in more detail in <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S4</xref>.</p>
      <p>Rather than learning a pseudotime for one fixed set of input points, psupertime learns a function from transcript abundances to the pseudotime. It can therefore be trained on one set of labels and applied to new data with unknown or different labels: any data with overlapping gene measurements can be assessed with regard to the learned process. Furthermore, psupertime can be learned on two different datasets, with different labels, and then each applied to the other dataset: the sequential labels from one dataset allow coefficients relevant to that sequence to be learned, which can then be used to predict these labels for the second dataset. See <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S23</xref> for more discussion.</p>
    </sec>
    <sec>
      <title>2.5 Simulations of single-cell RNA-seq data</title>
      <p>psupertime is principally useful because it can identify genes which vary over the course of time-series labels. To test this capability, we simulated single-cell RNA-seq data to include three types of gene profiles, defined in terms of their mean expression: mean varying as a time series; sample-specific variation in the mean; and constant mean expression. All genes have biological and technical noise around this mean. This mimics the likely experimental setup, in which the expression at each timepoint is composed of both processes related to the time series, and unrelated variability particular to that sample, e.g. where the samples are derived from different mice.</p>
      <p>Our simulation procedure was as follows: (i) calculate relevant statistics from a selected reference dataset, composed of multiple labels, (ii) randomly sample latent time values for each cell, around a common mean for the cell’s label, (iii) randomly assign one of the three gene profile types to each gene and randomly sample some parameters for each gene and (iv) sample counts for each cell and gene based on the combination of cell- and gene-level parameters. We discuss each of these steps in turn.</p>
      <p>As a reference dataset, we used 575 mouse embryonic beta cells (<xref rid="btac227-B19" ref-type="bibr">Qiu <italic toggle="yes">et al.</italic>, 2017a</xref>), restricted to 2666 highly variable genes by the procedure described in Lun <italic toggle="yes">et al.</italic>, where the cells were labelled with seven distinct time labels. The statistics used were library size for each cell (i.e. the total number of reads observed) and the mean <italic toggle="yes">μ<sub>g</sub></italic> and dispersion <italic toggle="yes">ρ<sub>g</sub></italic> for each gene <italic toggle="yes">g</italic> (calculated using edgeR; <xref rid="btac227-B21" ref-type="bibr">Robinson <italic toggle="yes">et al.</italic>, 2010</xref>), assuming a negative binomial distribution. In each simulation, the library sizes of cells were randomly permuted, and the number of cells allocated to each label was randomly permuted.</p>
      <p>To sample the latent time values for label <italic toggle="yes">i</italic>, <italic toggle="yes">l<sub>i</sub></italic>, we assumed an exponential distribution of time until the next timepoint. The first time point label has mean value 0, then the time to each subsequent timepoint is drawn from an exponential distribution with rate 0.5 (i.e. mean time difference of 2): <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mo> </mml:mo><mml:mtext>Exp</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mn>0.5</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. To allow for cell-to-cell variability, we then add Gaussian noise to the values for each cell <italic toggle="yes">c</italic>, with mean 0 and standard deviation 1: <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. This results in a latent time value for each cell. We then scale these values to have minimum 0 and maximum 1.</p>
      <p>The three possible types of gene expression profile that we defined were: time series; label-specific; and non-specific. Each gene follows one of these profiles. Each gene has dispersion and base mean expression defined by the reference dataset. The gene expression profiles were simulated as follows:
</p>
      <list list-type="bullet">
        <list-item>
          <p>Time-series genes have expression which changes with respect to the latent time values for each cell, where the log fold change relative to the mean follows a logistic curve. This curve is defined by three values: <italic toggle="yes">t</italic><sub>0</sub>, the curve’s midpoint; <italic toggle="yes">k</italic>, half the derivative of the curve at that midpoint; and <italic toggle="yes">L</italic>, the asymptotic maximum value of the curve. The log mean expression of this gene in a cell with latent time value <italic toggle="yes">t<sub>c</sub></italic> is therefore <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mtext>log</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>g</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>L</mml:mi><mml:mo>*</mml:mo><mml:mtext>logistic</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>*</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. For each gene, we sampled <italic toggle="yes">t</italic><sub>0</sub> from a uniform distribution over <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>; <italic toggle="yes">k</italic> from a log10-normal distribution with mean 1 and standard deviation 1; and <italic toggle="yes">L</italic> from a gamma distribution with shape 4 and rate 2.</p>
        </list-item>
        <list-item>
          <p>Label-specific gene profiles are defined by two parameters: the sample in which they show differential expression, and the log fold change in that sample relative to the mean. For each gene, we uniformly at random select a label, and sample the log fold change from a gamma distribution with shape 4 and rate 2.</p>
        </list-item>
        <list-item>
          <p>Genes with non-specific expression are defined by the dispersion and base mean identified from the reference dataset, and have no difference in distribution across labels.</p>
        </list-item>
      </list>
      <p>Each simulation has a defined set of proportions for each type of gene profile, <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>ts</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>label</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>non</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Each gene is randomly assigned one of the types according to these probabilities.</p>
      <p>We now have all the parameters required to sample counts for each combination of cell and gene. The gene-level parameters define, via the combination of base mean expression and possibly also a log fold change relative to the base mean, the mean expression for a given gene, plus its dispersion. The cell-level parameters define the library size for each cell, which is used to scale the base mean. For each cell and gene combination, we sample from the defined negative binomial distribution.</p>
    </sec>
    <sec>
      <title>2.6 Simulations of single-cell RNA-seq data with cell types</title>
      <p>To simulate time-series data comprising multiple cell types, we used fluorescence-activated cell-sorted stem cells at different stages of differentiation (<xref rid="btac227-B10" ref-type="bibr">Koh <italic toggle="yes">et al.</italic>, 2016</xref>), which had previously been used for benchmarking (<xref rid="btac227-B7" ref-type="bibr">Duò <italic toggle="yes">et al.</italic>, 2018</xref>). We assumed that genes had the following four profile types: global time-series, cell-type time series, batch effect and non-specific genes. Global time-series genes have the same timing and effect size on gene expression for all cell types; cell-type time-series genes vary over time in all cell types, but the timing and strength of effect are variable between cell types. Specifically, we sampled the parameters defining the response to time series in exactly the same way as for our previous simulations (see Section 2.5); however, for globally varying genes, these parameters were constant across cell types, while for cell-type varying genes, these parameters were sampled independently for each cell type. After simulating count data, we applied psupertime to each cell type individually, and to all cell types grouped together.</p>
    </sec>
    <sec>
      <title>2.7 Benchmarking of time-series gene identification against classifiers</title>
      <p>psupertime is a classifier that identifies a small subset of relevant features. We therefore compared it to alternative classification methods, which also produce variable importance measures.</p>
      <p>Multinomial regression is a simple baseline approach to classification (<xref rid="btac227-B30" ref-type="bibr">Venables and Ripley, 2002</xref>). For each label, a linear logistic regression is performed to distinguish label from non-label, resulting in <italic toggle="yes">k</italic> coefficients for each gene. To identify relevant features, for each gene, we calculate the sum of squares of the <italic toggle="yes">k</italic> coefficients; where a gene is relevant for classifying many labels, or strongly relevant for one label, it will have a large combined weight.</p>
      <p>Random forest is a widely used classification algorithm that is known to have good performance in many circumstances (<xref rid="btac227-B6" ref-type="bibr">Caruana <italic toggle="yes">et al.</italic>, 2008</xref>). One of the outputs produced by the algorithm is ‘importance’, which is the (relative) mean increase in error when a given variable is permuted. This can be used to identify which genes are most critical to classification performance.</p>
      <p>To assess performance, we simulated single-cell RNA-seq data (as described in Section 2.5), assuming that mean gene expression followed one of three possible profiles: time-series, label-specific or a constant mean across labels. We varied the proportions of these types of gene, so that the proportion of genes following time-series profiles, <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>ts</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, was 0.1, 0.3, 0.5, 0.7 or 0.9. The proportion of genes following label-specific profiles, <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>label</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, was between 0.1 and <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>ts</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The proportion of non-specific genes, <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>non</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, accounted for the remainder of genes.</p>
      <p>For each triplet of distinct <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>ts</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>label</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mtext>non</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> values, we did 20 simulations starting from 20 different random seeds. For a given simulation, applying psupertime and the benchmark methods resulted in an ‘importance’ value for each gene. We used this variable to predict time-series-specific genes, and calculated precision-recall curves for each classifier on the basis of how successfully these values identified the true time-series genes.</p>
      <p>We note that due to different combinations of randomly selected parameters, some time-series genes in the simulations will be easier to detect and some more difficult. For example, a gene with low absolute log fold change value <italic toggle="yes">L</italic>, and high dispersion <italic toggle="yes">ρ</italic>, will have a poor signal-to-noise ratio for the detection of time-series trends. This puts biologically realistic limits on the best performance possible for any algorithm, as for some genes any time-series trends will be obscured by transcriptional variability. For this reason, and also because psupertime is intended to identify a small set of genes, we have restricted our analysis to values of recall between 0% and 10%.</p>
    </sec>
    <sec>
      <title>2.8 Benchmarking of cell orderings against pseudotime methods</title>
      <p>Both psupertime and unsupervised pseudotime techniques produce a cell ordering, which may or may not correlate with the label ordering. We compared psupertime against unsupervised pseudotime methods, on five datasets with time-series labels (<xref rid="btac227-T1" ref-type="table">Table 1</xref>). We first performed common pre-processing and identification of relevant genes for each dataset, to identify either highly variable genes, or genes showing high correlation with the label sequence. See <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S2</xref> for further discussion.</p>
      <table-wrap position="float" id="btac227-T1">
        <label>Table 1.</label>
        <caption>
          <p>Details of datasets used in benchmarking of pseudotime cell orderings</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Dataset name</th>
              <th rowspan="1" colspan="1">Source</th>
              <th rowspan="1" colspan="1">Accession</th>
              <th rowspan="1" colspan="1">Labels used</th>
              <th rowspan="1" colspan="1">No. of labels</th>
              <th rowspan="1" colspan="1">No. of cells</th>
              <th rowspan="1" colspan="1">No. of highly varying genes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Acinar cells</td>
              <td rowspan="1" colspan="1">
                <xref rid="btac227-B8" ref-type="bibr">Enge <italic toggle="yes">et al.</italic> (2017)</xref>
              </td>
              <td rowspan="1" colspan="1">GSE81547</td>
              <td rowspan="1" colspan="1">Donor age</td>
              <td rowspan="1" colspan="1">8</td>
              <td rowspan="1" colspan="1">411</td>
              <td rowspan="1" colspan="1">827</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Human germline, F</td>
              <td rowspan="1" colspan="1">
                <xref rid="btac227-B13" ref-type="bibr">Li <italic toggle="yes">et al.</italic> (2017)</xref>
              </td>
              <td rowspan="1" colspan="1">GSE86146</td>
              <td rowspan="1" colspan="1">Age (weeks)</td>
              <td rowspan="1" colspan="1">12</td>
              <td rowspan="1" colspan="1">992</td>
              <td rowspan="1" colspan="1">1081</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Embryonic beta cells</td>
              <td rowspan="1" colspan="1"><xref rid="btac227-B19" ref-type="bibr">Qiu <italic toggle="yes">et al.</italic> (2017a</xref>)</td>
              <td rowspan="1" colspan="1">GSE87375</td>
              <td rowspan="1" colspan="1">Developmental stage</td>
              <td rowspan="1" colspan="1">7</td>
              <td rowspan="1" colspan="1">575</td>
              <td rowspan="1" colspan="1">2666</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Human ESCs</td>
              <td rowspan="1" colspan="1">
                <xref rid="btac227-B18" ref-type="bibr">Petropoulos <italic toggle="yes">et al.</italic> (2016)</xref>
              </td>
              <td rowspan="1" colspan="1">E-MTAB-3929</td>
              <td rowspan="1" colspan="1">Embryonic day</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">1529</td>
              <td rowspan="1" colspan="1">2876</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">MEF to neurons</td>
              <td rowspan="1" colspan="1">
                <xref rid="btac227-B28" ref-type="bibr">Treutlein <italic toggle="yes">et al.</italic> (2016)</xref>
              </td>
              <td rowspan="1" colspan="1">GSE67310</td>
              <td rowspan="1" colspan="1">Days since induction</td>
              <td rowspan="1" colspan="1">5</td>
              <td rowspan="1" colspan="1">315</td>
              <td rowspan="1" colspan="1">1698</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Colon cells</td>
              <td rowspan="1" colspan="1">Herring <italic toggle="yes">et al</italic>. (2017)</td>
              <td rowspan="1" colspan="1">GSE102698</td>
              <td rowspan="1" colspan="1">User-selected clusters</td>
              <td rowspan="1" colspan="1">4, 5</td>
              <td rowspan="1" colspan="1">1894</td>
              <td rowspan="1" colspan="1">1515</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">iPSCs</td>
              <td rowspan="1" colspan="1">
                <xref rid="btac227-B23" ref-type="bibr">Schiebinger <italic toggle="yes">et al.</italic> (2019)</xref>
              </td>
              <td rowspan="1" colspan="1">GSE106340</td>
              <td rowspan="1" colspan="1">Days during reprogramming</td>
              <td rowspan="1" colspan="1">11</td>
              <td rowspan="1" colspan="1">3600</td>
              <td rowspan="1" colspan="1">731</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <p>To identify highly variable genes, we followed the procedure described by Lun <italic toggle="yes">et al.</italic>, using an false discovery rate (FDR) cut-off of 10% and biological variability cut-off of 0.5 [see <xref rid="btac227-B14" ref-type="bibr">Lun <italic toggle="yes">et al.</italic> (2016)</xref> for details of these parameters]. To identify genes showing high correlation with the labels, we calculated the Spearman’s correlation coefficient between sequential labels converted into integers, and log gene expression value. Genes with absolute correlation &gt;0.2 were selected.</p>
      <p>For principle component analysis (PCA), we calculated the first principal component of the log counts and used this as the pseudotime. Calculation of Monocle2 uses the following default settings: genes with mean expression <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula> or expressed in &lt;10 cells filtered out; negbinomial expression family used; dimensionality reduction method <italic toggle="yes">DDRTree</italic>; root state selected as the state with the highest number of cells from the first label; function orderCells used to extract the ordering.</p>
      <p>Calculation of slingshot uses the following default settings: first 10 PCA components used as dimensionality reduction; clustering via Gaussian mixture model clustering using the R package mclust, number of clusters selected by Bayesian information criterion; root and leaf clusters selected as the clusters with highest number of cells from the earliest and latest labels, respectively; lineage selected for pseudotime is path from root to leaf cluster. <italic toggle="yes">Note:</italic> For cells very distant from the selected path, slingshot does not give a pseudotime value. For these cells, we assigned the mean pseudotime value over those that slingshot did calculate. Calculation of psupertime used default settings, as described in Section 2.</p>
      <p>We tested the extent to which each pseudotime method could correctly order the cells by calculating measures of correlation between the learned pseudotime, and the sequential labels. Kendall’s <italic toggle="yes">τ</italic> considers pairs of points and calculates the proportion of pairs in which the rank ordering within the pair is the same across both possible rankings.</p>
      <p>To identify genes with high correlation with the sequential condition labels (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>), we treated the sequential labels as the set of integers <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>, calculated the Spearman correlation coefficient with the gene expression. Genes were selected that showed absolute correlation of &gt;0.2 with the sequential labels (few genes showed high correlation with the sequential labels; this low cut-off was used to ensure that a sufficient number of genes was selected).</p>
    </sec>
    <sec>
      <title>2.9 Identification of relevant biological processes</title>
      <p>To identify biological processes associated with the condition labels, psupertime first clusters all genes selected for training (e.g. the default highly variable genes), using the R package fastcluster, using five clusters by default. These are ordered by correlation of the mean expression values with the learned pseudotime, i.e. approximately into genes that are up- or down-regulated along the course of the labelled process. psupertime then uses topGO to identify biological processes enriched in each cluster, relative to the remaining clusters; enriched GO terms are calculated using algorithm = ‘weight’ and statistic = ‘fisher’ (<xref rid="btac227-B1" ref-type="bibr">Alexa and Rahnenführer, 2009</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>psupertime produces as output a set of ordering coefficients, one for each gene, most of which are zero (i.e. the coefficient vector is ‘sparse’). A non-zero ordering coefficient indicates that a gene was relevant to the label sequence. This balances the requirement for predictive accuracy against that for a small and therefore interpretable set of genes. For example, applied to the acinar cells, psupertime used 82 of the 827 highly variable genes to attain a test accuracy of 83% over the eight possible labels (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). Many of the genes identified via their absolute coefficient values are already known to be relevant to the ageing of pancreatic cells (see expression profiles shown in <xref rid="btac227-F1" ref-type="fig">Fig. 1E</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs. S2 and S3</xref>). For example, clusterin (<italic toggle="yes">CLU</italic>) plays an essential role in pancreas regeneration and is expressed in chronic pancreatitis (<xref rid="btac227-B12" ref-type="bibr">Lee <italic toggle="yes">et al.</italic>, 2011</xref>; <xref rid="btac227-B31" ref-type="bibr">Xie <italic toggle="yes">et al.</italic>, 2002</xref>); <italic toggle="yes">α</italic>-amylase (<italic toggle="yes">AMY2B</italic>) is a characteristic gene for mature acinar cells, encoding a digestive enzyme (<xref rid="btac227-B17" ref-type="bibr">Omichi and Hase, 1993</xref>). In addition, psupertime suggests candidates for further study: <italic toggle="yes">ITM2A</italic> has the highest absolute gene coefficient and is highly differentially regulated in a model of chronic pancreatitis, but has not been investigated in acinar cells (<xref rid="btac227-B29" ref-type="bibr">Ulmasov <italic toggle="yes">et al.</italic>, 2013</xref>). The genes identified by psupertime were not discussed in the source manuscript, and, importantly, would not be found by naively calculating correlations between the sequential labels and gene expression (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S2</xref>).</p>
    <p>GO term enrichment analysis provides further support for the validity of the cell ordering identified by psupertime. We clustered the expression profiles of the highly variable genes and identified GO terms characteristic of each cluster (see Section 2). This procedure identified genes related to digestion as being up-regulated in early ages (‘proteolysis’ and ‘digestion’ enriched in cluster 1), and terms related to ageing later in the process (‘negative regulation of cell proliferation’ and ‘positive regulation of apoptotic process’ enriched in cluster 5; see <xref rid="sup1" ref-type="supplementary-material">Supplementary Figs. S4 and S5</xref>). This analysis confirms that the cell ordering learned by psupertime is plausible.</p>
    <p>To compare psupertime to other classifiers, we simulated single-cell RNA-seq data to contain genes that vary over time, and also genes with other profiles (see Section 2.5). We compared psupertime’s performance against two benchmark classification methods, which also identify relevant features: multinomial regression, as a simple baseline approach to classification (<xref rid="btac227-B30" ref-type="bibr">Venables and Ripley, 2002</xref>) and a popular classification algorithm that performs well under many circumstances (<xref rid="btac227-B6" ref-type="bibr">Caruana <italic toggle="yes">et al.</italic>, 2008</xref>). Both classifiers give measures of importance for each variable (see Section 2); we used these to determine how well the classifiers identified time-series genes. We found that the coefficients identified by psupertime identify time-series genes more precisely than the benchmark classifiers (<xref rid="btac227-F2" ref-type="fig">Fig. 2D</xref>, <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>). In addition, psupertime is able to recapitulate the true latent time values of the cells (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S7</xref>). The other classifiers assume no structure across the labels and identify any gene which is helpful for distinguishing one label from another; this results in them also identifying genes with sample-specific rather than time-varying variation. The model for psupertime assumes and therefore identifies genes that vary coherently over the timepoint labels.</p>
    <fig position="float" id="btac227-F2">
      <label>Fig. 2.</label>
      <caption>
        <p>Performance of psupertime against benchmark methods. See Section 2.8 for details of data processing and use of benchmark methods. All results for (<bold>A–C</bold>) based on 411 aging human acinar cell data with ages ranging from 1 to 54 (<xref rid="btac227-B8" ref-type="bibr">Enge <italic toggle="yes">et al.</italic>, 2017</xref>), using 827 highly variable genes. Colours indicate donor age. (A) Projection of acinar cells into first two principal components (% of variance explained shown). Curves learned by slingshot shown (note that here we show the projection of these curves into the first two principal components). (B) Projection of acinar cells into dimensionality reduction calculated by Monocle 2, annotated with pseudotime learned by Monocle 2 (<xref rid="btac227-B20" ref-type="bibr">Qiu <italic toggle="yes">et al.</italic>, 2017b</xref>). (C) Results of benchmark pseudotime methods applied to acinar data. For each method, the <italic toggle="yes">x</italic>-axis is a one-dimensional representation for each cell (see Section 2.8), scaled to <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> and given the direction with the highest positive correlation with the label sequence. The <italic toggle="yes">y</italic>-axis is density of the distributions for each label used as input, as calculated by the function geom_density in the R package ggplot2. (<bold>D</bold>) Performance of psupertime and benchmark classifiers in identifying simulated time-series genes. Precision-recall curves based on identification of time-series genes via variable importance measures for each method (see Section 2.7). Line and area show mean and ±2 standard error, respectively, over 20 simulations. Recall is limited to range 0–10%. Panels correspond to simulations with different proportions of time-series (TS) genes; all panels include 10% batch effect genes which are sample-specific. (<bold>E</bold>) Absolute Kendall’s <italic toggle="yes">τ</italic> correlation coefficient between label sequences (treated as sets of integers <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>) and calculated pseudotimes. Error bars show 95% confidence interval over 1000 bootstraps, calculated with boot package in R. For Tempora, this calculation was performed using scipy package in python. Datasets are specified in <xref rid="btac227-T1" ref-type="table">Table 1</xref></p>
      </caption>
      <graphic xlink:href="btac227f2" position="float"/>
    </fig>
    <p>Unsupervised projection techniques are commonly applied to analyse time-series single-cell RNA-seq data. We therefore compared the cell-level orderings identified by psupertime with those from three alternative, unsupervised pseudotime techniques: projection onto the first PCA component, as a simple, interpretable baseline; Monocle 2 (<xref rid="btac227-B20" ref-type="bibr">Qiu <italic toggle="yes">et al.</italic>, 2017b</xref>), which is widely used, shown to perform well in a benchmark study (<xref rid="btac227-B22" ref-type="bibr">Saelens <italic toggle="yes">et al.</italic>, 2019</xref>) and permits the selection of a starting point; and slingshot (<xref rid="btac227-B26" ref-type="bibr">Street <italic toggle="yes">et al.</italic>, 2018</xref>), which was also shown to perform well (<xref rid="btac227-B22" ref-type="bibr">Saelens <italic toggle="yes">et al.</italic>, 2019</xref>) and allows both the start and end point of a trajectory to be selected (it is therefore semi-supervised). Applied to the acinar cells, low-dimensional embeddings of the data (including PCA) indicate that while donor-specific factors account for much of the variation, very little transcriptional variation is related to age (<xref rid="btac227-F2" ref-type="fig">Fig. 2A and B</xref>; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>). Acinar cell orderings identified by the benchmark methods are not consistent with the known label sequence (<xref rid="btac227-F2" ref-type="fig">Fig. 2C and E</xref>). In contrast, the one-dimensional projection learned by psupertime (<xref rid="btac227-F2" ref-type="fig">Fig. 2C</xref>) successfully orders the cells by donor age (Kendall’s <italic toggle="yes">τ</italic> correlation coefficient 0.86, which quantifies the concordance between two orderings), while providing a sparse interpretable gene signature related to age.</p>
    <p>In addition to the acinar cells, we compared psupertime to the three alternative methods on four further datasets, as specified in <xref rid="btac227-T1" ref-type="table">Table 1</xref>. The correlation of the orderings from the benchmark methods with the labels varies considerably depending on the dataset (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref>), and in particular, depending on the extent of variation unrelated to the labels (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>): both Monocle 2 and PCA show Kendall’s <italic toggle="yes">τ</italic> values of 0.12 or below for the human germline dataset (<xref rid="btac227-B13" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>), in comparison to values of at least 0.71 for the human embryonic stem cells (ESCs) dataset (<xref rid="btac227-B18" ref-type="bibr">Petropoulos <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S10</xref>). In all datasets considered, the cell ordering given by psupertime has a higher correlation with the known label sequence than the other pseudotime methods (<xref rid="btac227-F2" ref-type="fig">Fig. 2E</xref>). The pseudotime methods used for comparison do not use the timepoint label as input, so it is not surprising that psupertime is better able to recapitulate the label orderings. However, considering that unsupervised methods are frequently used to analyse time series and other ordered data, this comparison is relevant for users. Where genes and processes associated with time labels are the primary interest, our analysis shows that unsupervised techniques alone are not appropriate (see also <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S6</xref>).</p>
    <p>Many datasets comprise samples composed of multiple distinct cell types. In a time-series experiment, this could in principle make it more difficult for psupertime to identify relevant genes: time-related signal for one cell type could be diluted when cell types are analysed together. To test this, we generated synthetic time-series data from multiple cell types, modelling genes that varied over time both globally, and individually within cell types (see Section 2.6). We found that psupertime is best able to identify globally varying genes when applied to all cell types together, and best able to identify cell-type-specific genes via application to each cell type individually (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S5</xref>). In addition, we applied psupertime to a biological dataset comprising multiple distinct trajectories leading to different cell fates, specifically reprogramming mouse embryonic fibroblast cells (MEFs) to induced pluripotent stem cells (iPSCs; <xref rid="btac227-B23" ref-type="bibr">Schiebinger <italic toggle="yes">et al.</italic>, 2019</xref>). We identified two clear branches (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S20</xref>): one branch corresponding to reprogramming from MEFs to iPSCs, and one to reprogramming from MEFs to stromal cells. We then applied psupertime three times: to the entire dataset; to the iPSC branch; and to the stromal branch. In each case, we trained psupertime using the experimental days as labels. psupertime identified relevant genes for the global process (e.g. <italic toggle="yes">Dppa5a</italic>; <xref rid="btac227-B11" ref-type="bibr">Lee <italic toggle="yes">et al.</italic>, 2014</xref>), for reprogramming to iPSCs (e.g. <italic toggle="yes">Cd24a</italic>; <xref rid="btac227-B24" ref-type="bibr">Shakiba <italic toggle="yes">et al.</italic>, 2015</xref>) and for reprogramming to non-pluripotent cells (e.g. <italic toggle="yes">Xist</italic>; <xref rid="btac227-B16" ref-type="bibr">Minkovsky <italic toggle="yes">et al.</italic>, 2012</xref>; <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S21</xref>). Taken together, these results show that sensible use of psupertime can identify both globally varying and cell-type-specific time-varying genes. (Details of both analyses are given in <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S5</xref>.)</p>
    <p>Typical workflows for single-cell RNA-seq data first restrict to highly variable genes. If the data are instead first restricted to genes that correlate strongly with the sequential labels, the relative performance of the benchmark methods might improve. Despite the selection of genes that correlate with the labels, psupertime consistently outperforms unsupervised methods in terms of identifying individual cell orderings (<xref rid="sup1" ref-type="supplementary-material">Supplementary Results S2</xref>). This illustrates that the genes identified by psupertime as most relevant to the process are not necessarily those with highest correlation; for example, genes with expression profiles like <italic toggle="yes">AMY2B</italic> in <xref rid="btac227-F1" ref-type="fig">Figure 1E</xref> show a non-linear, step-like expression profile, which results in a correlation of 0.11 with the condition labels. Despite low correlation, such genes were nonetheless found to be useful for cell ordering and suggest that psupertime discovers meaningful non-linear structure in the data.</p>
    <p>The time taken for psupertime to run varies over the five test datasets from 4 s for a dataset with <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mo>≈</mml:mo></mml:math></inline-formula>300 cells, to 32 s for one with <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mo>≈</mml:mo></mml:math></inline-formula>1500 cells (<xref rid="btac227-T2" ref-type="table">Table 2</xref>). We empirically observe a linear runtime dependency for the dataset size in terms of number of cells (∼5 min/10k cells). While maintaining classification accuracies of between 43% and 98%, psupertime uses a small set of genes: for example, for a classification accuracy of 76% on 10% of the acinar cells held out for testing, psupertime uses 10% of the input genes (<xref rid="btac227-T2" ref-type="table">Table 2</xref>). psupertime is based on a form of penalized linear regression. We show that the ordinal logistic model, rather than a linear model based on regarding the sequential labels as integers, is both the natural and the best-performing model for this problem (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S2</xref>).</p>
    <table-wrap position="float" id="btac227-T2">
      <label>Table 2</label>
      <caption>
        <p>psupertime performance and timings on comparison datasets</p>
      </caption>
      <table frame="hsides" rules="groups">
        <colgroup span="1">
          <col valign="top" align="left" span="1"/>
          <col valign="top" align="center" span="1"/>
          <col valign="top" align="center" span="1"/>
          <col valign="top" align="center" span="1"/>
        </colgroup>
        <thead>
          <tr>
            <th rowspan="1" colspan="1">Dataset name</th>
            <th rowspan="1" colspan="1">Accuracy (%)</th>
            <th rowspan="1" colspan="1">Time taken (s)</th>
            <th rowspan="1" colspan="1">Sparsity (%)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="1" colspan="1">Acinar cells</td>
            <td rowspan="1" colspan="1">75.7 ± 1.1</td>
            <td rowspan="1" colspan="1">5.5 ± 0.41</td>
            <td rowspan="1" colspan="1">90.6 ± 1.8</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Human germline, F</td>
            <td rowspan="1" colspan="1">43.4 ± 1.5</td>
            <td rowspan="1" colspan="1">25 ± 0.73</td>
            <td rowspan="1" colspan="1">80.4 ± 4.9</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Embryonic beta cells</td>
            <td rowspan="1" colspan="1">78.5 ± 0.9</td>
            <td rowspan="1" colspan="1">19 ± 0.67</td>
            <td rowspan="1" colspan="1">96.4 ± 0.4</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Human ESCs</td>
            <td rowspan="1" colspan="1">97.6 ± 0.2</td>
            <td rowspan="1" colspan="1">35 ± 0.80</td>
            <td rowspan="1" colspan="1">90.0 ± 1.1</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">MEF to neurons</td>
            <td rowspan="1" colspan="1">89.6 ± 1.7</td>
            <td rowspan="1" colspan="1">4.7 ± 0.062</td>
            <td rowspan="1" colspan="1">96.6 ± 0.4</td>
          </tr>
        </tbody>
      </table>
      <table-wrap-foot>
        <fn id="tblfn1">
          <p><italic toggle="yes">Note</italic>: Mean and standard deviation of psupertime accuracy, timing and sparsity calculated over 10 random seeds.</p>
        </fn>
      </table-wrap-foot>
    </table-wrap>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>The number of studies using single-cell RNA-seq is increasing exponentially (<xref rid="btac227-B22" ref-type="bibr">Saelens <italic toggle="yes">et al.</italic>, 2019</xref>), and many of these include time-series labels. psupertime is explicitly designed to take advantage of such a setting, complementing unsupervised pseudotime techniques. The presence of time-series labels allows a simple, regression-based model to identify relevant cell orderings; here, the more sophisticated pseudotime approaches required for unlabelled data identify the principal variation in the data, rather than that associated with the labels. The potential asynchrony of dynamic processes is expected to affect classification performance. Specifically, we expect the misclassification rate to increase with stronger asynchrony. While poor classification performance can have other causes than asynchrony, we recommend to consider asynchrony as a possible cause for poor psupertime classification performance and to resort to other dedicated tools/experiments to investigate possible asynchrony. psupertime uses L1 regularization to obtain a small set of reported genes. However, this may result in exclusion of other relevant genes: where there are multiple highly correlated genes that are predictive of the sequential labels, L1 regularization will tend to result in only one of these genes being reported, and produce zero coefficients for other correlated genes. This issue can be addressed by calculating the psupertime ordering, and reviewing all genes that have high correlations with the genes identified by psupertime. Alternatively, a simple extension to psupertime would allow training with a combination of L1 and L2 penalties (the elastic net), resulting in a compromise between sparsity and prediction performance. psupertime could possibly benefit from alternative normalization techniques, such as regularized negative binomial regression resulting in Pearson residuals (<xref rid="btac227-B5" ref-type="bibr">Butler <italic toggle="yes">et al.</italic>, 2018</xref>), as well as combination with RNA velocity-based pseudotime (<xref rid="btac227-B4" ref-type="bibr">Bergen <italic toggle="yes">et al.</italic>, 2020</xref>). psupertime is applicable to any experimental design with sequential labels, most obviously time series but also to biological questions regarding drug dose–response, and disease progression. psupertime could further be used in situations without experimental labels by combining with unsupervised techniques (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S3</xref>) or to align new data to orderings learned from alternative processes or separate lineage branches (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S5 and Figs. S19–S22</xref>). More broadly, we have used it to improve dimensionality reduction (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S4</xref>) and are developing extensions including to additional single-cell technologies such as mass cytometry (see <xref rid="sup1" ref-type="supplementary-material">Supplementary Results S6</xref>). This demonstrates the potential of ordinal regression models for further methodological developments. psupertime has wide applicability and will enable quick and effective identification of the genes and profiles relevant to state sequences of biological processes in single-cell RNA-sequencing data. We have developed an R package available for download at github.com/wmacnair/psupertime.</p>
    <p><italic toggle="yes">Financial Support</italic>: none declared.</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac227_Supplementary_Data</label>
      <media xlink:href="btac227_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac227-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Alexa</surname><given-names>A.</given-names></string-name>, <string-name><surname>Rahnenführer</surname><given-names>J.</given-names></string-name></person-group> (<year>2009</year>) <article-title>Gene set enrichment analysis with topGO</article-title>. <source>Bioconductor Improv.</source>  <volume>27, 1–26</volume>.</mixed-citation>
    </ref>
    <ref id="btac227-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Archer</surname><given-names>K.J.</given-names></string-name>, <string-name><surname>Williams</surname><given-names>A.A.A.</given-names></string-name></person-group> (<year>2012</year>) <article-title>L1 penalized continuation ratio models for ordinal response prediction using high-dimensional datasets</article-title>. <source>Stat. Med.</source>  <volume>31</volume>, <fpage>1464</fpage>–<lpage>1474</lpage>.<pub-id pub-id-type="pmid">22359384</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bendall</surname><given-names>S.C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Single-cell trajectory detection uncovers progression and regulatory coordination in human B cell development</article-title>. <source>Cell</source>  <volume>157</volume>, <fpage>714</fpage>–<lpage>725</lpage>.<pub-id pub-id-type="pmid">24766814</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bergen</surname><given-names>V.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>Generalizing RNA velocity to transient cell states through dynamical modeling</article-title>. <source>Nat. Biotechnol</source>. <volume>38</volume>, <fpage>1408</fpage>–<lpage>1414</lpage>.<pub-id pub-id-type="pmid">32747759</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Butler</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>. <source>Nat. Biotechnol.</source>  <volume>36</volume>, <fpage>411</fpage>–<lpage>420</lpage>.<pub-id pub-id-type="pmid">29608179</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B6">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Caruana</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2008</year>). An empirical evaluation of supervised learning in high dimensions. In: <italic toggle="yes">Proceedings of the 25th International Conference on Machine Learning</italic>. ICML ’08, ACM, New York, NY, pp. <fpage>96</fpage>–<lpage>103</lpage>.</mixed-citation>
    </ref>
    <ref id="btac227-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Duò</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>A systematic performance evaluation of clustering methods for single-cell RNA-seq data</article-title>. <source>F1000Res</source>  <volume>7</volume>, <fpage>1141</fpage>.<pub-id pub-id-type="pmid">30271584</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Enge</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Single-cell analysis of human pancreas reveals transcriptional signatures of aging and somatic mutation patterns</article-title>. <source>Cell</source>  <volume>171</volume>, <fpage>321</fpage>–<lpage>330.e14</lpage>.<pub-id pub-id-type="pmid">28965763</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Friedman</surname><given-names>J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) <article-title>Regularization paths for generalized linear models via coordinate descent</article-title>. <source>J. Stat. Softw.</source>  <volume>33</volume>, <fpage>1</fpage>–<lpage>22</lpage>.<pub-id pub-id-type="pmid">20808728</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B343574">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Herring</surname>,<given-names>C.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Unsupervised trajectory analysis of single-cell RNA-seq and imaging data reveals alternative tuft cell origins in the gut</article-title>. <source><italic toggle="yes">Cell Syst. </italic></source>, <volume>6</volume>, <fpage>37</fpage>–<lpage>51.e9</lpage>. https://doi.org/<pub-id pub-id-type="doi">10.1016/j.cels.2017.10.012</pub-id>.<pub-id pub-id-type="pmid">29153838</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Koh</surname><given-names>P.W.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>An atlas of transcriptional, chromatin accessibility, and surface marker changes in human mesoderm development</article-title>. <source>Sci. Data</source>  <volume>3</volume>, <fpage>160109</fpage>.<pub-id pub-id-type="pmid">27996962</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>D.-S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>An epigenomic roadmap to induced pluripotency reveals DNA methylation as a reprogramming modulator</article-title>. <source>Nat. Commun.</source>  <volume>5</volume>, <fpage>5619</fpage>.<pub-id pub-id-type="pmid">25493341</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lee</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2011</year>) <article-title>Essential role of clusterin in pancreas regeneration</article-title>. <source>Dev. Dyn.</source>  <volume>240</volume>, <fpage>605</fpage>–<lpage>615</lpage>.<pub-id pub-id-type="pmid">21290478</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Single-cell RNA-Seq analysis maps development of human germline cells and gonadal niche interactions</article-title>. <source>Cell Stem Cell</source>  <volume>20</volume>, <fpage>858</fpage>–<lpage>873.e4</lpage>.<pub-id pub-id-type="pmid">28457750</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lun</surname><given-names>A.T.L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>A step-by-step workflow for low-level analysis of single-cell RNA-seq data with bioconductor</article-title>. <source>F1000Res</source>  <volume>5</volume>, <fpage>2122</fpage>.<pub-id pub-id-type="pmid">27909575</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McCullagh</surname><given-names>P.</given-names></string-name></person-group> (<year>1980</year>) <article-title>Regression models for ordinal data</article-title>. <source>J. R. Stat. Soc. Series B Stat. Methodol</source>. <volume>42</volume>, <fpage>109</fpage>–<lpage>142</lpage>.</mixed-citation>
    </ref>
    <ref id="btac227-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Minkovsky</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2012</year>) <article-title>Concise review: pluripotency and the transcriptional inactivation of the female mammalian X chromosome</article-title>. <source>Stem Cells</source>  <volume>30</volume>, <fpage>48</fpage>–<lpage>54</lpage>.<pub-id pub-id-type="pmid">21997775</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Omichi</surname><given-names>K.</given-names></string-name>, <string-name><surname>Hase</surname><given-names>S.</given-names></string-name></person-group> (<year>1993</year>) <article-title>Identification of the characteristic amino-acid sequence for human <italic toggle="yes">α</italic>-amylase encoded by the AMY2B gene</article-title>. <source>Biochim. Biophys. Acta</source>  <volume>1203</volume>, <fpage>224</fpage>–<lpage>229</lpage>.<pub-id pub-id-type="pmid">8268204</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Petropoulos</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>Single-cell RNA-Seq reveals lineage and X chromosome dynamics in human preimplantation embryos</article-title>. <source>Cell</source>  <volume>165</volume>, <fpage>1012</fpage>–<lpage>1026</lpage>.<pub-id pub-id-type="pmid">27062923</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Qiu</surname><given-names>W.-L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017a</year>) <article-title>Deciphering pancreatic islet β cell and α cell maturation pathways and characteristic features at the single-cell level</article-title>. <source>Cell Metab.</source>  <volume>25</volume>, <fpage>1194</fpage>–<lpage>1205.e4</lpage>.<pub-id pub-id-type="pmid">28467935</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Qiu</surname><given-names>X.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017b</year>) <article-title>Reversed graph embedding resolves complex single-cell trajectories</article-title>. <source>Nat. Methods</source>  <volume>14</volume>, <fpage>979</fpage>–<lpage>982</lpage>.<pub-id pub-id-type="pmid">28825705</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Robinson</surname><given-names>M.D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) <article-title>Edger: a bioconductor package for differential expression analysis of digital gene expression data</article-title>. <source>Bioinformatics</source>  <volume>26</volume>, <fpage>139</fpage>–<lpage>140</lpage>.<pub-id pub-id-type="pmid">19910308</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Saelens</surname><given-names>W.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>A comparison of single-cell trajectory inference methods</article-title>. <source>Nat. Biotechnol.</source>  <volume>37</volume>, <fpage>547</fpage>–<lpage>554</lpage>.<pub-id pub-id-type="pmid">30936559</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schiebinger</surname><given-names>G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>Optimal-transport analysis of single-cell gene expression identifies developmental trajectories in reprogramming</article-title>. <source>Cell</source>  <volume>176</volume>, <fpage>928</fpage>–<lpage>943.e22</lpage>.<pub-id pub-id-type="pmid">30712874</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shakiba</surname><given-names>N.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>CD24 tracks divergent pluripotent states in mouse and human cells</article-title>. <source>Nat. Commun.</source>  <volume>6</volume>, <fpage>7329</fpage>.<pub-id pub-id-type="pmid">26076835</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shao</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2021</year>) <article-title>Identify differential genes and cell subclusters from time-series scRNA-seq data using scTITANS</article-title>. <source>Comput. Struct. Biotechnol. J.</source>  <volume>19</volume>, <fpage>4132</fpage>–<lpage>4141</lpage>.<pub-id pub-id-type="pmid">34527187</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Street</surname><given-names>K.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Slingshot: cell lineage and pseudotime inference for single-cell transcriptomics</article-title>. <source>BMC Genomics</source>  <volume>19</volume>, <fpage>477</fpage>.<pub-id pub-id-type="pmid">29914354</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tran</surname><given-names>T.N.</given-names></string-name>, <string-name><surname>Bader</surname><given-names>G.D.</given-names></string-name></person-group> (<year>2020</year>) <article-title>Tempora: cell trajectory inference using time-series single-cell RNA sequencing data</article-title>. <source>PLoS Comput. Biol.</source>  <volume>16</volume>, <fpage>e1008205</fpage>.<pub-id pub-id-type="pmid">32903255</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Treutlein</surname><given-names>B.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>Dissecting direct reprogramming from fibroblast to neuron using single-cell RNA-seq</article-title>. <source>Nature</source>  <volume>534</volume>, <fpage>391</fpage>–<lpage>395</lpage>.<pub-id pub-id-type="pmid">27281220</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ulmasov</surname><given-names>B.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2013</year>) <article-title>Differences in the degree of cerulein-induced chronic pancreatitis in C57BL/6 mouse substrains lead to new insights in identification of potential risk factors in the development of chronic pancreatitis</article-title>. <source>Am. J. Pathol.</source>  <volume>183</volume>, <fpage>692</fpage>–<lpage>708</lpage>.<pub-id pub-id-type="pmid">23845568</pub-id></mixed-citation>
    </ref>
    <ref id="btac227-B30">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Venables</surname><given-names>W.N.</given-names></string-name>, <string-name><surname>Ripley</surname><given-names>B.D.</given-names></string-name></person-group> (<year>2002</year>). <source>Modern Applied Statistics with S</source>, <volume>4</volume>th edn. <publisher-name>Springer</publisher-name>, <publisher-loc>New York, NY</publisher-loc>. ISBN 0-387-95457-0.</mixed-citation>
    </ref>
    <ref id="btac227-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xie</surname><given-names>M.-J.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2002</year>) <article-title>Expression of clusterin in human pancreatic cancer</article-title>. <source>Pancreas</source>  <volume>25</volume>, <fpage>234</fpage>–<lpage>238</lpage>.<pub-id pub-id-type="pmid">12370533</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
