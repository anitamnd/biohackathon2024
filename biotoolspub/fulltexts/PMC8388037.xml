<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8388037</article-id>
    <article-id pub-id-type="pmid">33576396</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btab093</article-id>
    <article-id pub-id-type="publisher-id">btab093</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Phylogenetics</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>FASTRAL: improving scalability of phylogenomic analysis</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Dibaeinia</surname>
          <given-names>Payam</given-names>
        </name>
        <aff><institution>Department of Computer Science, University of Illinois</institution>, Urbana, IL 61801, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tabe-Bordbar</surname>
          <given-names>Shayan</given-names>
        </name>
        <aff><institution>Department of Computer Science, University of Illinois</institution>, Urbana, IL 61801, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-7717-3514</contrib-id>
        <name>
          <surname>Warnow</surname>
          <given-names>Tandy</given-names>
        </name>
        <xref rid="btab093-cor1" ref-type="corresp"/>
        <aff><institution>Department of Computer Science, University of Illinois</institution>, Urbana, IL 61801, <country country="US">USA</country></aff>
        <!--warnow@illinois.edu-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Schwartz</surname>
          <given-names>Russell</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btab093-cor1">To whom correspondence should be addressed. <email>warnow@illinois.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>8</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2021-02-08">
      <day>08</day>
      <month>2</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>08</day>
      <month>2</month>
      <year>2021</year>
    </pub-date>
    <volume>37</volume>
    <issue>16</issue>
    <fpage>2317</fpage>
    <lpage>2324</lpage>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>10</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>02</day>
        <month>2</month>
        <year>2021</year>
      </date>
      <date date-type="editorial-decision">
        <day>03</day>
        <month>2</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>04</day>
        <month>2</month>
        <year>2021</year>
      </date>
      <date date-type="corrected-typeset">
        <day>24</day>
        <month>4</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btab093.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>ASTRAL is the current leading method for species tree estimation from phylogenomic datasets (i.e. hundreds to thousands of genes) that addresses gene tree discord resulting from incomplete lineage sorting (ILS). ASTRAL is statistically consistent under the multi-locus coalescent model (MSC), runs in polynomial time, and is able to run on large datasets. Key to ASTRAL’s algorithm is the use of dynamic programming to find an optimal solution to the MQSST (maximum quartet support supertree) within a constraint space that it computes from the input. Yet, ASTRAL can fail to complete within reasonable timeframes on large datasets with many genes and species, because in these cases the constraint space it computes is too large.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Here, we introduce FASTRAL, a phylogenomic estimation method. FASTRAL is based on ASTRAL, but uses a different technique for constructing the constraint space. The technique we use to define the constraint space maintains statistical consistency and is polynomial time; thus we prove that FASTRAL is a polynomial time algorithm that is statistically consistent under the MSC. Our performance study on both biological and simulated datasets demonstrates that FASTRAL matches or improves on ASTRAL with respect to species tree topology accuracy (and under high ILS conditions it is statistically significantly more accurate), while being dramatically faster—especially on datasets with large numbers of genes and high ILS—due to using a significantly smaller constraint space.</p>
      </sec>
      <sec id="s3">
        <title>Availabilityand implementation</title>
        <p>FASTRAL is available in open-source form at <ext-link xlink:href="https://github.com/PayamDiba/FASTRAL" ext-link-type="uri">https://github.com/PayamDiba/FASTRAL</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Grainger Foundation</institution>
            <institution-id institution-id-type="DOI">10.13039/100008074</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="8"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Species tree reconstruction underlies downstream biological studies on mechanism and history of evolution for genes and species. However, biological processes such as incomplete lineage sorting and gene duplication and loss create discordance between gene trees (i.e. evolutionary trees on genomic regions) and the species tree, and make the inference of the species tree challenging (<xref rid="btab093-B8" ref-type="bibr">Kubatko and Degnan, 2007</xref>). Incomplete lineage sorting (ILS) (<xref rid="btab093-B12" ref-type="bibr">Maddison, 1997</xref>), which can be modeled by the multi-species coalescent model (MSC) (<xref rid="btab093-B6" ref-type="bibr">Kingman, 1982</xref>), is believed to be one of the main processes that result in genome-wide discordance.</p>
    <p>A simple but commonly used approach to species tree estimation from sequence alignments of multiple genomic regions is to infer the species tree from concatenated alignments using, for example, methods for maximum likelihood [e.g. RAxML (<xref rid="btab093-B29" ref-type="bibr">Stamatakis, 2014</xref>)]. However, this popular method has been proven to be statistically inconsistent (and even positively misleading) under the MSC, so that they may converge to the wrong tree with probability converging to 1 as the number of genes increases (<xref rid="btab093-B25" ref-type="bibr">Roch and Steel, 2015</xref>). Furthermore, concatenation analyses can have poor accuracy in the presence of high ILS levels (<xref rid="btab093-B8" ref-type="bibr">Kubatko and Degnan, 2007</xref>; <xref rid="btab093-B15" ref-type="bibr">Mirarab <italic toggle="yes">et al.</italic>, 2014b</xref>; <xref rid="btab093-B17" ref-type="bibr">Molloy and Warnow, 2018</xref>). Alternative approaches that are guaranteed to be statistically consistent have been developed. Perhaps the most accurate methods are those, such as StarBeast (<xref rid="btab093-B20" ref-type="bibr">Ogilvie <italic toggle="yes">et al.</italic>, 2017</xref>), that co-estimate gene trees and species trees from multi-locus inputs (consisting of multiple sequence alignments for each gene). However, these are generally computationally too intensive to use on large datasets, with difficulty analyzing datasets with 100 or more species, and can even have difficulty with large numbers of genes (<xref rid="btab093-B33" ref-type="bibr">Zimmermann <italic toggle="yes">et al.</italic>, 2014</xref>). SVDquartets (<xref rid="btab093-B3" ref-type="bibr">Chifman and Kubatko, 2014</xref>; <xref rid="btab093-B31" ref-type="bibr">Vachaspati and Warnow, 2018</xref>) is another statistically consistent method for species tree estimation, and operates by computing quartet trees from the input and then combining the quartet trees using a quartet amalgamation method; SVDquartets is popular, but not very scalable to large datasets because of its <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mi>Ω</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> running time.</p>
    <p>Species tree estimation on datasets addressing heterogeneity due to ILS is usually addressed using methods that take a set of trees inferred from various genomic regions (conventionally referred to as gene trees) as input and estimate a species tree by summarizing the input gene trees. Furthermore, several of these methods, referred to as ‘summary methods’, are statistically consistent and very accurate in practice. Summary methods are potentially scalable to large datasets and can have high accuracy that is competitive or better than the major competing methods, while being faster. To date, several statistically consistent summary methods have been developed including ASTRAL (<xref rid="btab093-B14" ref-type="bibr">Mirarab <italic toggle="yes">et al.</italic>, 2014a</xref>; <xref rid="btab093-B13" ref-type="bibr">Mirarab and Warnow, 2015</xref>; <xref rid="btab093-B32" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic>, 2018</xref>), ASTRID (<xref rid="btab093-B30" ref-type="bibr">Vachaspati and Warnow, 2015</xref>), MP-EST (<xref rid="btab093-B11" ref-type="bibr">Liu <italic toggle="yes">et al.</italic>, 2010</xref>) and NJst (<xref rid="btab093-B10" ref-type="bibr">Liu and Yu, 2011</xref>).</p>
    <p>Among these methods, ASTRAL is the most widely used. ASTRAL has several theoretical advantages over the other methods. For example, ASTRAL but not ASTRID, is statistically consistent under the MSC model when species are missing from gene trees under an <italic toggle="yes">i.i.d.</italic> model of missing data (<xref rid="btab093-B23" ref-type="bibr">Rhodes <italic toggle="yes">et al.</italic>, 2020</xref>).</p>
    <p>ASTRAL also has excellent sample complexity (<xref rid="btab093-B28" ref-type="bibr">Shekhar <italic toggle="yes">et al.</italic>, 2018</xref>), and matches or improves on the other species tree estimation methods that address ILS on large datasets. Furthermore, ASTRAL runs in polynomial time. However, on some datasets, ASTRAL can be computationally intensive, exceeding the allowed time in some computing environments (e.g. 24 hours) (<xref rid="btab093-B18" ref-type="bibr">Molloy and Warnow, 2019</xref>). Moreover, although biological datasets of interest in phylogenomic analysis may only have tens or a few hundred species (e.g. the Avian Phylogenomics dataset had only 48 species), they can easily have many thousands of genes. As a result, species tree estimation of datasets with even smallish to ‘moderate’ numbers of species can be very computationally challenging when the number of genes is large.</p>
    <p>In this study, we focus on ASTRAL and seek to improve its running time, focusing on addressing the challenge when the number of genes is large (i.e. the common problem in phylogenomics). Although ASTRAL runs in polynomial time, its running time is dominated by the size of a set <italic toggle="yes">X</italic> of ‘allowed bipartitions’ that it computes from the input (and the running time is almost quadratic in <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>). We show that a change to how ASTRAL computes its set <italic toggle="yes">X</italic> can be made that substantially reduces its running time without losing statistical consistency. We explore different ways for defining the set <italic toggle="yes">X</italic> that rely on subsampling from the input gene trees, and devise an approach that enables high accuracy and low running time, and still ensures statistical consistency. Our experimental study validates this approach on both biological and simulated datasets, including on datasets with gene trees having multiple individuals and missing data. Our approach, which we refer to as ‘FASTRAL’, matches or improves on ASTRAL with respect to topological accuracy and is much faster, especially on datasets with high gene tree heterogeneity and large numbers of genes. In particular, FASTRAL completes in about two minutes on the Avian Phylogenomics project dataset (<xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic>, 2014</xref>) of 48 species and 14 446 genes, while ASTRAL requires approximately 32 h. Thus, FASTRAL is a very fast alternative to ASTRAL.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p><italic toggle="yes">ASTRAL:</italic> Given an unrooted tree <italic toggle="yes">T</italic> on leafset <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula> with <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>S</mml:mi><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula>, we define <italic toggle="yes">C</italic>(<italic toggle="yes">T</italic>) to be the set of bipartitions on the leafset of <italic toggle="yes">T</italic> defined by the edges of <italic toggle="yes">T</italic>; thus <italic toggle="yes">C</italic>(<italic toggle="yes">T</italic>) will contain <italic toggle="yes">n</italic> trivial bipartitions (that split one leaf off from the other leaves) corresponding to the leaves of <italic toggle="yes">T</italic> and additional non-trivial bipartitions corresponding to the internal edges of <italic toggle="yes">T</italic>. If <italic toggle="yes">T</italic> is binary, then <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>. Given a set <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> of gene trees (with leaves taken from <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula>), the <bold>quartet support</bold> of a tree <italic toggle="yes">T</italic> on leafset <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula> is <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:munder><mml:mo>|</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∩</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">Q</italic>(<italic toggle="yes">t</italic>) denotes the set of quartet trees induced by four-leaf trees in <italic toggle="yes">t</italic>. The input to ASTRAL is a set <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> of <italic toggle="yes">k</italic> gene trees, each leaf-labelled by species drawn from set <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula> of <italic toggle="yes">n</italic> species. ASTRAL then uses the input to compute a set <italic toggle="yes">X</italic> of allowed bipartitions, and uses a polynomial time dynamic programming (DP) algorithm on the pair <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to find a species tree <italic toggle="yes">T</italic> on <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mi mathvariant="script">S</mml:mi></mml:math></inline-formula> that maximizes the total quartet support (with respect to the input gene trees) subject to <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>⊆</mml:mo><mml:mi>X</mml:mi></mml:mrow></mml:math></inline-formula>. This is the Constrained Maximum Quartet Support Species Tree <bold>(Constrained-MQSST)</bold> problem. ASTRAL’s DP algorithm operates by implicitly calculating the MQSST criterion score without needing to explicitly examine all <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mo>Θ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>4</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> quartets. Furthermore, ASTRAL can also take a pair <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> as input and then apply its DP algorithm to that pair, thus allowing the user the flexibility of computing the constraint set using other techniques.</p>
    <p>The most recent version of ASTRAL, referred to as ASTRAL-III, runs in <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>1.726</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> where <italic toggle="yes">D</italic> denotes the number of distinct ‘tripartitions’ in the input gene trees <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> (where a tripartition is defined for each node in each gene tree, and is produced by deleting the node and its incident edges from the gene tree, thus splitting the leafset into three parts). The default way that <italic toggle="yes">X</italic> is defined in ASTRAL is guaranteed to include all the bipartitions in <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula>, and the first design for ASTRAL (i.e. ASTRAL-I) used only these bipartitions. Hence, in the simplest case, <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> is <italic toggle="yes">O</italic>(<italic toggle="yes">nk</italic>). However, as ASTRAL continued to be refined, it expanded the set <italic toggle="yes">X</italic> to add additional biparititions, but requiring that it not violate the <inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> condition. This guarantees that the final running time of ASTRAL-III is <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1.726</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Furthermore, ASTRAL-III is guaranteed statistically consistent, since <italic toggle="yes">X</italic> always contains the bipartitions from the input gene trees (Theorem 2 from <xref rid="btab093-B14" ref-type="bibr">Mirarab <italic toggle="yes">et al.</italic> (2014a</xref>)).</p>
    <p><italic toggle="yes">FASTRAL:</italic> By design, the size of <italic toggle="yes">X</italic> dominates the running time of ASTRAL, and can make ASTRAL computationally intensive. The key observation that led to the design of FASTRAL is that we can ensure statistical consistency by having <italic toggle="yes">X</italic> be the bipartitions found in a set of estimated species trees, rather than the gene trees, provided that the set of estimated species trees are computed using statistically consistent methods. Therefore, from a purely theoretical perspective, we can replace the default way that ASTRAL computes <italic toggle="yes">X</italic> by a set of species trees we can compute using fast and statistically consistent methods. Here we describe how FASTRAL operates, which depend on how it sub-samples from the input set <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> of gene trees (Step 1) and the choice of a method <italic toggle="yes">M</italic> for computing species trees on each sub-sample (Step 2):
</p>
    <list list-type="order">
      <list-item>
        <p>Step 1: Construct a collection of sub-samples of the gene trees in <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula>.</p>
      </list-item>
      <list-item>
        <p>Step 2: For each sub-sample, run <italic toggle="yes">M</italic> to obtain a tree on <italic toggle="yes">S</italic>.</p>
      </list-item>
      <list-item>
        <p>Step 3: Let <italic toggle="yes">X</italic> be all bipartitions appearing in any tree obtained in Step 2.</p>
      </list-item>
      <list-item>
        <p>Step 4: Run ASTRAL on the pair <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      </list-item>
    </list>
    <p>As we now show, we can define sub-sampling strategies and choices for <italic toggle="yes">M</italic> that ensure statistical consistency and polynomial time, and that also provide very good empirical accuracy.</p>
    <p>FASTRAL builds set <italic toggle="yes">X</italic> from bipartitions of species trees or supertrees inferred from the input genes by any auxiliary method of choice <italic toggle="yes">M</italic>. To increase the diversity among species trees and yet utilizing the full resolution of the input gene trees, FASTRAL divides the input gene trees into <italic toggle="yes">m </italic>&gt;<italic toggle="yes"> </italic>1 overlapping sets, so that the <italic toggle="yes">i</italic>th sample contains <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> gene trees (<xref rid="btab093-F1" ref-type="fig">Fig. 1</xref>). There are numerous ways to draw the <italic toggle="yes">m</italic> sub-samples fed to the auxiliary method. Here, we explore two simple sampling strategies where sub-samples are drawn uniformly at random without replacement. In one approach (i.e. same-size sampling), we limit the sub-samples to a specific size (i.e. 25% of input gene trees), while in the other approach (i.e. variable-size sampling), we allow the sub-samples to be of variable sizes. Then a species tree is inferred for each sample using the auxiliary method <italic toggle="yes">M</italic>. FASTRAL aggregates all unique bipartitions among the <italic toggle="yes">m</italic> species trees and uses it as the set <italic toggle="yes">X</italic> of allowed bipartitions. If polytomies (i.e. nodes of degree greater than three) are present in any of the trees constructed by method <italic toggle="yes">M</italic>, FASTRAL resolves them using a UPGMA tree built from <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula>, which is similar to ASTRAL-III’s approach for resolving polytomies. However, in contrast to ASTRAL-II (<xref rid="btab093-B13" ref-type="bibr">Mirarab and Warnow, 2015</xref>) and ASTRAL-III (<xref rid="btab093-B32" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic>, 2018</xref>), FASTRAL does not further expand this set <italic toggle="yes">X</italic>. It is worth mentioning that trees generated by method <italic toggle="yes">M</italic> are only used to construct the set <italic toggle="yes">X</italic>, and do not impact ASTRAL’s analysis otherwise (e.g. they are not used to define the quartet support criterion or the tripartition weighting performed in ASTRAL).</p>
    <fig position="float" id="btab093-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>The FASTRAL pipeline. FASTRAL creates <italic toggle="yes">m</italic> sub-samples from the input set <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> of gene trees, constructs an ASTRID tree on each sub-sample, and uses the bipartitions from the <italic toggle="yes">m</italic> ASTRID trees for the constraint set <italic toggle="yes">X</italic>. ASTRAL is then run on input <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="script">G</mml:mi><mml:mo>,</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></p>
      </caption>
      <graphic xlink:href="btab093f1" position="float"/>
    </fig>
    <p>Here, we used ASTRID (<xref rid="btab093-B30" ref-type="bibr">Vachaspati and Warnow, 2015</xref>), which is statistically consistent under the MSC and one of the few methods that can run on very large datasets (thousands of genes and species). ASTRID uses a distance-based approach where the first step computes an ‘average internode distance matrix’ (i.e. matrix of pairwise distances averaged across the gene trees, using the number of internal nodes on the path as the distance), and the second step computes a tree from the distance matrix. As shown by Allman <italic toggle="yes">et al.</italic> (<xref rid="btab093-B1" ref-type="bibr">Allman <italic toggle="yes">et al.</italic>, 2018</xref>), the average internode distance matrix converges to an additive matrix for the true species tree with probability converging to 1, and so ASTRID [when used with methods such as FastME (<xref rid="btab093-B9" ref-type="bibr">Lefort <italic toggle="yes">et al.</italic>, 2015</xref>) or Neighbor Joining (<xref rid="btab093-B26" ref-type="bibr">Saitou and Nei, 1987</xref>)] is statistically consistent under the MSC.</p>
    <p>Prior studies comparing ASTRID and ASTRAL shows that both have better accuracy on datasets with large numbers of species than other statistically consistent methods, and the relative performance between them is mixed: in some cases they are tied, sometimes ASTRAL is more accurate and sometimes ASTRID is more accurate (<xref rid="btab093-B30" ref-type="bibr">Vachaspati and Warnow, 2015</xref>).</p>
    <sec>
      <title>2.1 Statistical consistency</title>
      <statement id="mthst1">
        <label>Theorem 1.</label>
        <p>Assume that the random sampling step of FASTRAL generates <italic toggle="yes">m</italic> sub-samples, such that there is <italic toggle="yes">at least one subsampleS<sub>j</sub></italic> whose size also increases to infinity with the number of genes (i.e.<inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo>|</mml:mo><mml:mi>G</mml:mi><mml:mo>|</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> where <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>:</mml:mo><mml:mi>R</mml:mi><mml:mo>→</mml:mo><mml:msup><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mo>+</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is a real valued increasing function satisfying <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mi>n</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>∞</mml:mo></mml:mrow></mml:math></inline-formula>). Assume also that <italic toggle="yes">M</italic> is a summary method (i.e.<italic toggle="yes">M</italic> takes as input a set of unrooted gene tree topologies and estimates a species tree) that is statistically consistent under the MSC. Then, FASTRAL is statistically consistent under the MSC model when used with <italic toggle="yes">M</italic> and this sampling strategy.</p>
        <p>Proof. Under the conditions of the theorem, as the number <italic toggle="yes">k</italic> of genes in <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> increases to infinity, the number of genes in sub-sample <italic toggle="yes">S<sub>j</sub></italic> also increases to infinity, and so the tree obtained using <italic toggle="yes">M</italic> on <italic toggle="yes">S<sub>j</sub></italic> will converge to the true species tree with probability converging to 1. Furthermore, since tree topologies are discrete objects, for every <inline-formula id="IE34"><mml:math id="IM34" display="inline" overflow="scroll"><mml:mrow><mml:mo>ϵ</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> there is a number <inline-formula id="IE35"><mml:math id="IM35" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> of genes so that the probability that <italic toggle="yes">M</italic> returns the true species tree topology for sub-sample <italic toggle="yes">S<sub>j</sub></italic> given <inline-formula id="IE36"><mml:math id="IM36" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mo>ϵ</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> genes is at least <inline-formula id="IE37"><mml:math id="IM37" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>ϵ</mml:mo></mml:mrow></mml:math></inline-formula>. Therefore, as the number <italic toggle="yes">k</italic> of genes in <inline-formula id="IE38"><mml:math id="IM38" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> increases, with probability converging to 1, the set <italic toggle="yes">X</italic> constructed by FASTRAL will include all the bipartitions that are present in the true species tree. Hence, for a sufficient number of genes, the true species tree will be a feasible solution to the Constrained-MQSST optimization problem solved by ASTRAL. Note that the proof for Theorem 2 from <xref rid="btab093-B14" ref-type="bibr">Mirarab <italic toggle="yes">et al.</italic> (2014a</xref>) that establishes ASTRAL to be statistically consistent under the MSC using its default technique for computing <italic toggle="yes">X</italic> (which sets <italic toggle="yes">X</italic> to the bipartitions from the input gene trees) only depends on <italic toggle="yes">X</italic> containing, in the limit, all the bipartitions from the species set; hence, the same argument ensures that FASTRAL is statistically consistent under the MSC. □</p>
      </statement>
    </sec>
    <sec>
      <title>2.2 Asymptotic running time</title>
      <p>On each sub-sample <italic toggle="yes">S<sub>i</sub></italic> of <inline-formula id="IE39"><mml:math id="IM39" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> containing <inline-formula id="IE40"><mml:math id="IM40" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> gene trees on <italic toggle="yes">n</italic> taxa, ASTRID runs in <inline-formula id="IE41"><mml:math id="IM41" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. After aggregating the bipartitions of ASTRID’s species tree into set <italic toggle="yes">X</italic>, ASTRAL takes <inline-formula id="IE42"><mml:math id="IM42" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>1.726</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to run where <italic toggle="yes">D</italic> is the number of distinct tripartitions in the input set <inline-formula id="IE43"><mml:math id="IM43" display="inline" overflow="scroll"><mml:mi mathvariant="script">G</mml:mi></mml:math></inline-formula> of gene trees and <inline-formula id="IE44"><mml:math id="IM44" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> when generating <italic toggle="yes">m</italic> sub-samples. Therefore, the total asymptotic running time of FASTRAL will be <inline-formula id="IE45"><mml:math id="IM45" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>m</mml:mi><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>D</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1.726</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.<statement id="mthst2"><label>Theorem 2.</label><p><italic toggle="yes">When used with ASTRID for computing species trees on the sub-samples, FASTRAL runs in</italic> <inline-formula id="IE46"><mml:math id="IM46" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>m</mml:mi><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>D</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1.726</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula><italic toggle="yes">, where n is the number of species, k is the number of genes, D is the number of distinct tripartitions in the input gene trees, and m is the number of sub-samples it analyzes. When k &gt; n (which is typical for phylogenomic datasets), the running time simplifies to</italic> <inline-formula id="IE47"><mml:math id="IM47" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>k</mml:mi><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>D</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1.726</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p></statement></p>
      <p><italic toggle="yes">Comments.</italic> Note that when using a sampling strategy in which <italic toggle="yes">m</italic> is much smaller than <italic toggle="yes">k</italic> (even when <inline-formula id="IE48"><mml:math id="IM48" display="inline" overflow="scroll"><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo>/</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:math></inline-formula> for some constant <italic toggle="yes">c </italic>&gt;<italic toggle="yes"> </italic>1, such as we explore in this study), FASTRAL’s asymptotic running time is much faster than the asymptotic running time for ASTRAL, which is <inline-formula id="IE49"><mml:math id="IM49" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>1.726</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and this good running time would still hold if ASTRID was replaced by another method that ran in <inline-formula id="IE50"><mml:math id="IM50" display="inline" overflow="scroll"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> time. With respect to statistical consistency, FASTRAL depends on its algorithmic parameters: how it selects <italic toggle="yes">M</italic> (i.e. the method for computing trees on subsets of the genes) and its sub-sampling strategy, and the conditions under which FASTRAL is guaranteed statistically consistent under the MSC are very modest (i.e.<italic toggle="yes">M</italic> is a statistically consistent summary method and the sub-sampling strategy includes at least one sub-sample whose size increases to infinity as the number of genes increases to infinity). However, empirical performance (i.e. accuracy on data) can be impacted by the choices for <italic toggle="yes">M</italic> and sub-sampling strategy, and in ways that are more complex. For example, picking only one sub-sample will mean that FASTRAL is identical to <italic toggle="yes">M</italic> on the sub-sample, which is clearly not a good strategy. More generally, what is wanted is a large enough number <italic toggle="yes">m</italic> of sub-samples that the set <italic toggle="yes">X</italic> that is created does not constrain the search space too much, but when <italic toggle="yes">m</italic> is very large then the running time will increase. Therefore, while the theorem regarding statistical consistency holds for many random sampling strategies and choices of <italic toggle="yes">M</italic>, for accuracy and running time considerations, each must be chosen with care.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Experimental study</title>
    <p><italic toggle="yes">Overview.</italic> In our design and evaluation of FASTRAL, we chose ASTRID as the method <italic toggle="yes">M</italic> to compute trees on the sub-sampled collections of genes. Therefore, the remaining algorithmic parameter to determine is the sub-sampling strategy, and its impact on species tree error. we computed species tree error using the FN error rate, which is the fraction of the number of bipartitions that appear in the true species tree but not in the estimated species tree [this is identical to the Robinson-Foulds (<xref rid="btab093-B24" ref-type="bibr">Robinson and Foulds, 1981</xref>) error rate since the species trees are binary]. We performed three experiments. In Experiment 1, we compared two sampling strategies to evaluate the impact on species tree accuracy, and selected one for further analysis. In Experiment 2, we compared FASTRAL to ASTRAL on simulated datasets where each gene tree has a single leaf for each species. In Experiment 3, we compared FASTRAL to ASTRAL on simulated datasets where the genes have multiple individuals per species, and some genes may be incomplete (i.e. may be missing species). In Experiment 4, we compared FASTRAL to ASTRAL on the Avian Phylogenomics project dataset with 48 birds and 14 446 genes (<xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic>, 2014</xref>).</p>
    <p><italic toggle="yes">Datasets.</italic> We used biological and simulated datasets from prior studies (<xref rid="btab093-T1" ref-type="table">Table 1</xref>). We selected three model conditions from the ASTRAL-II (<xref rid="btab093-B13" ref-type="bibr">Mirarab and Warnow, 2015</xref>) simulated datasets; the estimated gene trees for these model conditions were obtained from <ext-link xlink:href="https://sites.google.com/eng.ucsd.edu/datasets/astral/astral-ii" ext-link-type="uri">https://sites.google.com/eng.ucsd.edu/datasets/astral/astral-ii</ext-link>. Using the nomenclature for these models from ASTRID, MC1, MC6 and MC11 have 1000 genes and either 200 (for MC1 and MC6) or 1000 (for MC11) species, and there are 50 replicates per model condition. MC6 has low ILS [i.e. AD = 9%, where AD denotes the average discordance, measured using normalized Robinson-Foulds (<xref rid="btab093-B24" ref-type="bibr">Robinson and Foulds, 1981</xref>) distances between true gene trees and true species trees], MC11 has moderate ILS (AD = 35%), and MC1 has high ILS (AD = 69%). Also, we used the D2 model condition of simulated datasets from the ASTRAL-multi (<xref rid="btab093-B21" ref-type="bibr">Rabiee <italic toggle="yes">et al.</italic>, 2019</xref>) study (the estimated gene trees were obtained from <ext-link xlink:href="https://maryamrabiee.github.io/ASTRAL-multi/" ext-link-type="uri">https://maryamrabiee.github.io/ASTRAL-multi/</ext-link>). The D2 model condition (50 replicates) has 1000 genes and 200 species with five individuals per species, and high ILS (AD = 48–53%). The avian biological dataset (with 48 species and 14 446 estimated gene trees) was obtained from <ext-link xlink:href="https://gitlab.com/esayyari/ASTRALIII/-/blob/master/ml.tar.gz" ext-link-type="uri">https://gitlab.com/esayyari/ASTRALIII/-/blob/master/ml.tar.gz</ext-link>. The analysis reported in <xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic> (2014)</xref> on this avian dataset suggests that it has very high ILS, as all of the estimated gene trees were different from the species tree computed on the datast using ExaML (<xref rid="btab093-B7" ref-type="bibr">Kozlov <italic toggle="yes">et al.</italic>, 2015</xref>). We used the gene trees for these model conditions, which were estimated using RAxML (<xref rid="btab093-B29" ref-type="bibr">Stamatakis, 2014</xref>). Since the gene trees are estimated, they all have some gene tree estimation error.</p>
    <table-wrap position="float" id="btab093-T1">
      <label>Table 1.</label>
      <caption>
        <p>Characteristics of the datasets used in this study</p>
      </caption>
      <table frame="hsides" rules="groups">
        <colgroup span="1">
          <col valign="top" align="left" span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="char" char="." span="1"/>
          <col valign="top" align="center" span="1"/>
          <col valign="top" align="left" span="1"/>
        </colgroup>
        <thead>
          <tr>
            <th rowspan="1" colspan="1">Dataset</th>
            <th rowspan="1" colspan="1">No. taxa</th>
            <th rowspan="1" colspan="1">No. genes</th>
            <th rowspan="1" colspan="1">ILS (AD %)</th>
            <th rowspan="1" colspan="1">Other</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td rowspan="1" colspan="1">MC1 (<xref rid="btab093-B13" ref-type="bibr">Mirarab and Warnow, 2015</xref>)</td>
            <td rowspan="1" colspan="1">200</td>
            <td rowspan="1" colspan="1">1000</td>
            <td rowspan="1" colspan="1">69</td>
            <td rowspan="1" colspan="1">No. gens.: 500 K, spec. rate: 1e-6</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">MC6 (<xref rid="btab093-B13" ref-type="bibr">Mirarab and Warnow, 2015</xref>)</td>
            <td rowspan="1" colspan="1">200</td>
            <td rowspan="1" colspan="1">1000</td>
            <td rowspan="1" colspan="1">9</td>
            <td rowspan="1" colspan="1">No. gens: 10 M; spec. rate: 1e–7</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">MC11 (<xref rid="btab093-B13" ref-type="bibr">Mirarab and Warnow, 2015</xref>)</td>
            <td rowspan="1" colspan="1">1000</td>
            <td rowspan="1" colspan="1">1000</td>
            <td rowspan="1" colspan="1">35</td>
            <td rowspan="1" colspan="1">No. gens: 2 M; spec. rate: 1e-6</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">D2 (<xref rid="btab093-B21" ref-type="bibr">Rabiee <italic toggle="yes">et al.</italic>, 2019</xref>)</td>
            <td rowspan="1" colspan="1">200</td>
            <td rowspan="1" colspan="1">1000</td>
            <td rowspan="1" colspan="1">48-53</td>
            <td rowspan="1" colspan="1">No. gens: 0.5 M; spec. rate 1e-6</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1">Avian (<xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic>, 2014</xref>)</td>
            <td rowspan="1" colspan="1">48</td>
            <td rowspan="1" colspan="1">14446</td>
            <td rowspan="1" colspan="1">N/A</td>
            <td rowspan="1" colspan="1">Unknown true gene and species trees</td>
          </tr>
        </tbody>
      </table>
      <table-wrap-foot>
        <fn id="tblfn1">
          <p><italic toggle="yes">Note</italic>: The MC1, MC6, MC11 and D2 model conditions are simulated, and their statistics are taken from the cited papers; each has 50 replicates. The avian dataset is biological. For the simulated datasets, the number of generations controls the ILS level (fewer generations results in smaller species tree height and higher ILS) and the speciation rate controls whether the speciation is towards the root (1e7) or towards the leaves (1e6). The ILS level is reported using the Average Discordance (AD) between true gene trees and true species trees, computed using the normalized Robinson-Foulds distance to produce a value between 0 and 1. Thus, MC1 is very high ILS, D2 is high ILS, MC11 is moderate ILS and MC6 is low ILS.</p>
        </fn>
      </table-wrap-foot>
    </table-wrap>
    <p><italic toggle="yes">Methods. ASTRAL:</italic> Version 5.7.3 was used with default parameters for all the arguments (<xref rid="btab093-B32" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic>, 2018</xref>).</p>
    <p><italic toggle="yes">ASTRID:</italic> The linux version of ASTRID-1.4 (<ext-link xlink:href="https://github.com/pranjalv123/ASTRID-1" ext-link-type="uri">https://github.com/pranjalv123/ASTRID-1</ext-link>) was used with the ‘auto’ mode for distance matrix calculations. Since the internode distance matrix does not have any missing entries, the ‘auto’ mode uses FastME (<xref rid="btab093-B9" ref-type="bibr">Lefort <italic toggle="yes">et al.</italic>, 2015</xref>) with Nearest Neighbor Interchanges (NNI) as the distance method for tree estimation.</p>
    <p><italic toggle="yes">FASTRAL:</italic> Version 1.0.0 was used (<ext-link xlink:href="https://github.com/PayamDiba/FASTRAL" ext-link-type="uri">https://github.com/PayamDiba/FASTRAL</ext-link>). For intermediate estimation of species trees, we used ASTRID-1.4 (with the same setting as described above) for the MC1, MC6, MC11 model condition datasets and the avian biological dataset, and ASTRID-2 (<ext-link xlink:href="https://github.com/pranjalv123/ASTRID" ext-link-type="uri">https://github.com/pranjalv123/ASTRID</ext-link>) for the D2 datasets (since ASTRID-1.4 does not support the multi-individual mode). ASTRID-2 was used with the ‘auto’ mode for distance matrix calculations. The intermediate species trees found by ASTRID were fed to ASTRAL (flag ‘-f’) for constructing set <italic toggle="yes">X</italic>, and expansion of set <italic toggle="yes">X</italic> with heuristics was disabled (flag ‘-p’ set to 0). Moreover, we modified ASTRAL Version 5.7.3 in order to restrict set <italic toggle="yes">X</italic> to only the union of the bipartitions of the intermediate species trees (i.e. to prevent the inclusion of input gene trees’ bipartitions in set <italic toggle="yes">X</italic>). This modified version of ASTRAL 5.7.3 is distributed with FASTRAL package. In this study we ran FASTRAL with two different general settings: (i) <bold>variable-size sampling</bold>: we generate 51 samples, one of which contains all of the gene trees, 10 samples containing 50% of the gene trees, 20 samples containing 25% of the gene trees and 20 samples containing 10% of the gene trees, and (ii) <bold>same-size sampling</bold>: We generate 51 samples each of which contains 25% of the gene trees. In each case, gene trees are sampled uniformly at random without replacement.</p>
    <p><italic toggle="yes">False negative error rate</italic>: We computed the number of false negative (FN) branches (i.e. edges in the reference species tree not appearing in the estimated trees) using a script obtained from <ext-link xlink:href="https://github.com/redavids/phylogenetics-tools/tree/master/comparetrees" ext-link-type="uri">https://github.com/redavids/phylogenetics-tools/tree/master/comparetrees</ext-link>. We obtain the FN rate by dividing this by <italic toggle="yes">n—</italic>3, the number of internal branches in a binary tree on <italic toggle="yes">n</italic> leaves.</p>
  </sec>
  <sec>
    <title>4 Results</title>
    <sec>
      <title>4.1 Results from experiment 1</title>
      <p>We evaluated the impact of sampling strategy (same-size and variable-size sampling, see Methods) on FASTRAL on two model conditions (MC6 and MC11). FASTRAL achieves comparable accuracy under both sampling strategies, but there is a small advantage to using the variable-size sampling (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1</xref>). Therefore, we selected the variable-size sampling strategy (FASTRAL_51S_varT) for future analyses. We conjecture that the improvement of variable-size sampling over same-size sampling is due in part to the inclusion of the sample that contains all the gene trees, but future work is needed to fully explore the impact of sampling strategy.</p>
    </sec>
    <sec>
      <title>4.2 Results from experiment 2</title>
      <p><italic toggle="yes">Tree error</italic>. As seen in <xref rid="btab093-F2" ref-type="fig">Figure 2</xref>, for all three model conditions, increasing the number of genes results in decreases in error for all methods, with the biggest decrease occurring between 100 and 500 genes, and then a smaller decrease between 500 and 1000 genes. Results under the model conditions are somewhat different, and so are discussed separately.</p>
      <fig position="float" id="btab093-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Experiment 2: Comparison between ASTRAL, ASTRID and FASTRAL, with varying numbers of gene trees. Species tree error is shown in (<bold>A</bold>), (<bold>B</bold>) and (<bold>C</bold>) for low (MC6), moderate (MC11) and high (MC1) ILS model conditions, respectively; running time is shown in (<bold>D</bold>), (<bold>E</bold>) and (<bold>F</bold>) for the same model conditions. Note that the y-axis ranges for the running time differ between the three subfigures. Error bars indicate the standard error from mean</p>
        </caption>
        <graphic xlink:href="btab093f2" position="float"/>
      </fig>
      <p>For the MC6 model condition, which has 200 species and low ILS (AD = 9%), ASTRAL and FASTRAL are essentially tied for accuracy at all numbers of genes, but ASTRID has higher error. For the MC11 model condition, which has 1000 species and moderate ILS (AD = 35%), ASTRAL and FASTRAL have the best accuracy at 100 genes, and then essentially tie with ASTRID for 500 and 1000 genes. For the MC1 model condition, with 200 species and high ILS (AD = 69%), ASTRID has variable accuracy, but FASTRAL is strictly better than ASTRAL at 500 and 1000 genes and ties with ASTRAL at 100 genes. These trends indicate that the number of genes and ILS level affects both the absolute and relative accuracy of species tree estimation methods, and that FASTRAL has an advantage for accuracy under the high ILS condition.</p>
      <p>We evaluate the statistical significance (<italic toggle="yes">P</italic>-value &lt; 0.05) of the difference in species tree error between ASTRAL and FASTRAL (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>). Under the MC6 and MC11 conditions, ASTRAL and FASTRAL do not have statistically significant differences in species tree accuracy for any model condition and number of genes (<italic toggle="yes">P</italic>-value &gt; 0.05). Under the MC1 condition, FASTRAL has a statistically significant advantage over ASTRAL for the 1000-gene case, and is almost statistically significantly better on the 500-gene case. Thus, under high ILS, FASTRAL can be significantly more accurate than ASTRAL, and under lower ILS conditions the differences in accuracy between the two methods are not significant.</p>
      <p><italic toggle="yes">Running time.</italic> The running times on these model conditions show very large differences between methods, but ILS level, number of genes, and number of species impact the time usage (<xref rid="btab093-F2" ref-type="fig">Fig. 2</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S2</xref>). Under all model conditions and numbers of genes, ASTRID is the fastest method, finishing in just seconds, and its running time is not noticeably impacted by the number of genes. A comparison between ASTRAL and FASTRAL shows different trends. On the low ILS model condition (MC6) with 200 species, ASTRAL is faster than FASTRAL given 100 genes, somewhat slower given 500 genes, and again slower given 1000 genes (approx. 371 s compared to approx. 182 s). Thus, FASTRAL is faster than ASTRAL given 500 or 1000 genes, but the ratio is not substantial (2.04), and both methods are very fast under this low ILS condition.</p>
      <p>However, under moderate or high ILS, the running times increase and the difference in running time between the methods also increases, so that FASTRAL is faster than ASTRAL for all numbers of genes. Both methods have their highest running times on the MC11 condition with 1000 genes, indicating that the number of species (1000) for this condition has a substantial impact on running time. On the moderate ILS 1000-species MC11 condition with 1000 genes, ASTRAL uses 20125 s on average and FASTRAL uses 2191 s (i.e. ASTRAL is 9.19 times slower than FASTRAL). On the high ILS 200-species MC1 condition with 1000 genes, ASTRAL uses 4293 s and FASTRAL uses 153 s, a ratio of 28.06 in running time. Thus, both methods running times are impacted by the ILS level, number of taxa and number of genes, and FASTRAL’s running time advantage over ASTRAL ranges from modest (e.g. a ratio of 2.04 on the MC6 low ILS condition with 200 species) to very large (a ratio of 28.06 on the high ILS MC1 condition).</p>
      <p>To understand the different impact of ILS level on the ASTRAL and FASTRAL running times, recall that increases in ILS lead to increases in topological heterogeneity across the gene trees, and this automatically increases the size of <inline-formula id="IE51"><mml:math id="IM51" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> as ASTRAL computes it. However, FASTRAL computes its set <italic toggle="yes">X</italic> from the ASTRID trees computed on sub-sampled sets of gene trees, which ameliorates the impact of increasing numbers of genes on the size of <italic toggle="yes">X</italic> (and even results in decreases in the size of <italic toggle="yes">X</italic> as we will discuss next).</p>
      <p>Overall, we see that FASTRAL has a substantial running time advantage over ASTRAL, but especially when there is moderate to high ILS or when there is a large number of genes or species.</p>
      <p><italic toggle="yes">MQSST scores and properties of the constraint set X.</italic> To understand these trends, we examine the size of the set <italic toggle="yes">X</italic> computed by FASTRAL and the density of the true species tree bipartitions in <italic toggle="yes">X</italic> (i.e. the ratio between <inline-formula id="IE52"><mml:math id="IM52" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE53"><mml:math id="IM53" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">TP</italic> denotes the true positives in <italic toggle="yes">X</italic>, or the species tree bipartitions in <italic toggle="yes">X</italic>). <xref rid="btab093-F3" ref-type="fig">Figure 3</xref> shows results for this analysis on the MC11 datasets, and shows that our approach significantly improves search space efficiency on MC11 datasets (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref> suggests similar improvements on MC1 and MC6). As expected, the constraint set <italic toggle="yes">X</italic> increases in size for ASTRAL as the number of genes increases. Interestingly, the constraint set <italic toggle="yes">X</italic> produced by FASTRAL decreases in size as the number of genes increases, which can be explained by the ASTRID trees on the subsets becoming topologically more similar to each other. The decrease in the size of <inline-formula id="IE54"><mml:math id="IM54" display="inline" overflow="scroll"><mml:mrow><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo>|</mml:mo></mml:mrow></mml:math></inline-formula> improves the running time, since ASTRAL’s running time depends almost quadratically on the size of its search space; hence, the gap in running time between ASTRAL and FASTRAL increases with the number of genes (<xref rid="btab093-F2" ref-type="fig">Fig. 2E</xref>). Furthermore, the high density of the true species tree bipartitions shows that we achieve this running time improvement without sacrificing species tree accuracy (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S2</xref> suggests similar trends and improvements on MC1 and MC6). We also examined the Maximum Quartet Support Supertree (MQSST) scores produced by ASTRAL and FASTRAL, as the two methods differ only in how they constrain the search space. FASTRAL and ASTRAL are nearly identical on the three model conditions (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S3</xref>), showing that the change in the constraint space used by FASTRAL is not detrimental.</p>
      <fig position="float" id="btab093-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>Understanding the impact of FASTRAL’s strategy on the constrained search. A: Comparing size of set <italic toggle="yes">X</italic> between ASTRAL and FASTRAL on MC11 datasets with 1000 genes (note that the y-axis is logarithmically scaled). B: The density of the true species tree bipartitions in the set <italic toggle="yes">X</italic> (i.e. space efficiency) for ASTRAL and FASTRAL on MC11 dataset with 1000 genes and 1000 species. Error bars represent standard error</p>
        </caption>
        <graphic xlink:href="btab093f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.3 Results from experiment 3</title>
      <p>Next, we compare FASTRAL to ASTRAL on a challenging simulated dataset containing five individuals per species, and where there can be species missing from gene trees under an <italic toggle="yes">i.i.d.</italic> missing data model (25% of species are missing in 25% of genes). As seen in <xref rid="btab093-F4" ref-type="fig">Figure 4</xref>, FASTRAL and ASTRAL have nearly the same accuracy under all the tested conditions (and the differences are not statistically significant, with a <italic toggle="yes">P</italic>-value of 0.07 and 0.26 for 0% and 25% missing data respectively), and FASTRAL is much faster than ASTRAL. Thus, the relative performance of FASTRAL and ASTRAL for multi-individual datasets is similar here to that observed for the other experiments, even in the presence of <italic toggle="yes">i.i.d.</italic> missing data.</p>
      <fig position="float" id="btab093-F4">
        <label>Fig. 4.</label>
        <caption>
          <p>Experiment 3: Comparing FASTRAL with ASTRAL on a multi-individual dataset in both presence and absence of missing data. A: Comparison between tree error rates (averaged over 50 replicates) ASTRAL and FASTRAL for the ASTRAL-multi D2 dataset (200 species, 1000 genes). B: Comparison between running time of ASTRAL and FASTRAL for the ASTRAL-multi D2 dataset with 200 species and 1000 genes. Error bars represent standard error</p>
        </caption>
        <graphic xlink:href="btab093f4" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>4.4 Results on the avian biological dataset</title>
      <p>As illustrated by the results on simulated datasets, FASTRAL’s main advantage as compared to ASTRAL is the decreased run-time on datasets with large number of genes. In order to examine the extent of this speed-up on genome-wide biological datasets, we ran both ASTRAL and FASTRAL on the avian biological dataset (<xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic>, 2014</xref>) and compared the resulting trees and the corresponding run-time and optimization scores. <xref rid="btab093-T2" ref-type="table">Table 2</xref> shows the running time and MQSST optimization score for both methods (higher scores show higher consistency of the inferred species tree with the quartets of the input gene trees). FASTRAL runs ∼800 times faster that ASTRAL-III, indicating a great improvement in running time. It is worth mentioning that 71% of FASTRAL’s run time (∼ 104 s) was consumed for building set <italic toggle="yes">X</italic> (i.e. running ASTRID on sub-samples) and only 29% of its run time (∼ 42 s) was used for running ASTRAL. This shows the huge improvement in ASTRAL’s running time when operates under an optimal constraint search space (42 s versus 32 h). Furthermore, their inferred species trees (<xref rid="btab093-F5" ref-type="fig">Fig. 5</xref>) differ in only three bipartitions. Comparing the resulted trees, we observe that as opposed to ASTRAL, FASTRAL places Red-crested turaco and Houbara bustard close to Common cuckoo. This assignment seems to be in agreement with previously published trees in <xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic> (2014)</xref> computed using ExaML (<xref rid="btab093-B7" ref-type="bibr">Kozlov <italic toggle="yes">et al.</italic>, 2015</xref>) or MP-EST combined with statistical binning (<xref rid="btab093-B16" ref-type="bibr">Mirarab <italic toggle="yes">et al.</italic>, 2014c</xref>). Interestingly, the trees inferred by both ASTRAL and FASTRAL differ in particular branches from the trees inferred from non-coding data [e.g. the intron MP-EST tree in <xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic> (2014)</xref> and the nucleotide trees in <xref rid="btab093-B4" ref-type="bibr">Houde <italic toggle="yes">et al.</italic> (2019)</xref> and <xref rid="btab093-B22" ref-type="bibr">Reddy <italic toggle="yes">et al.</italic> (2017)</xref>]. Such datatype-dependent discordances have been previously reported in the literature (<xref rid="btab093-B2" ref-type="bibr">Braun and Kimball, 2021</xref>). See <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S4</xref> for the ASTRID tree inferred from these data.</p>
      <fig position="float" id="btab093-F5">
        <label>Fig. 5.</label>
        <caption>
          <p>Experiment 4: Inferred trees on the avian biological dataset with 48 species and 14,446 genes from <xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic> (2014)</xref>, using (left) ASTRAL and (right) FASTRAL. Taxa shown in orange and bipartitions shown in red mark the difference between the two trees. Branch support values (local posterior probabilities) are shown as obtained by ASTRAL. The RF distance between ASTRAL and FASTRAL trees is 3</p>
        </caption>
        <graphic xlink:href="btab093f5" position="float"/>
      </fig>
      <table-wrap position="float" id="btab093-T2">
        <label>Table 2.</label>
        <caption>
          <p>Running time (in hours) and optimization score (proportion of quartet trees satisfied) achieved by FASTRAL and ASTRAL on the avian biological dataset from <xref rid="btab093-B5" ref-type="bibr">Jarvis <italic toggle="yes">et al.</italic> (2014)</xref> with 48 species and 14,446 genes</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Method</th>
              <th rowspan="1" colspan="1">Time (h)</th>
              <th rowspan="1" colspan="1">Optimization score</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">ASTRAL</td>
              <td rowspan="1" colspan="1">∼32</td>
              <td rowspan="1" colspan="1">0.50038</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">FASTRAL</td>
              <td rowspan="1" colspan="1">∼0.04</td>
              <td rowspan="1" colspan="1">0.50024</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec>
    <title>5 Summary and conclusions</title>
    <p>Accurate species tree estimation in the presence of incomplete lineage sorting (ILS), as modeled by the multi-species coalescent (MSC), is computationally and statistically challenging. ASTRAL is the leading species tree estimation that is statistically consistent under the MSC model and that can analyze large datasets; however, when given large numbers of genes, ASTRAL can be computationally challenging. Specifically, ASTRAL operates by solving an NP-hard optimization problem (MQSST) within a constrained search space, based on a set <italic toggle="yes">X</italic> of ‘allowed bipartitions’ that it computes from the input. When the input set of gene trees is large or there is substantial heterogeneity between gene trees, ASTRAL’s set <italic toggle="yes">X</italic> can become very large, making the running time in some cases excessively large.</p>
    <p>Here, we have presented FASTRAL, which uses a generalizable and flexible technique for constructing the set <italic toggle="yes">X</italic> of allowed bipartitions (compared to how ASTRAL constructs this set) and in so doing improves on ASTRAL. By design, FASTRAL is much faster than ASTRAL because the set of allowed bipartitions is much smaller than ASTRAL’s. However, importantly, FASTRAL maintains statistical consistency, is polynnomial time, and is as accurate (and in some cases more accurate) than ASTRAL. The improvement of FASTRAL over ASTRAL in terms of accuracy is most noteworthy when there is high ILS and a large number of genes, but FASTRAL is almost always much faster than ASTRAL. Thus, this simple approach provides a new and very fast technique to estimate species trees from multi-locus datasets that matches the accuracy of the current leading method, ASTRAL and uses a fraction of the time.</p>
    <p>Future work should explore variants of this approach where other fast methods (besides ASTRID) are used to construct trees on the sub-sampled genes, and other sub-sampling strategies should also be explored. Future work should also evaluate performance (running time and accuracy) on additional simulated and biological datasets to evaluate how FASTRAL performs under a variety of circumstances, and include comparisons to other methods for species tree estimation, including methods such as RevPoMo (<xref rid="btab093-B27" ref-type="bibr">Schrempf <italic toggle="yes">et al.</italic>, 2016</xref>) not established to be statistically consistent under the multi-species coalescent model at this time. Finally, constrained optimization is a basic technique in many phylogenomic analyses [e.g. SVDquest (<xref rid="btab093-B31" ref-type="bibr">Vachaspati and Warnow, 2018</xref>) and FastMulRFS (<xref rid="btab093-B19" ref-type="bibr">Molloy and Warnow, 2020</xref>)], and so this approach could be used in other contexts as well.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btab093_Supplementary_Datay</label>
      <media xlink:href="btab093_supplementary_datay.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>This work was the result of a final course project by PD and STB for the graduate course, CS 581: Algorithmic Genomic Biology, from Spring 2020 at the University of Illinois.</p>
    <sec sec-type="data-availability">
      <title>Data Availability</title>
      <p>All datasets evaluated in this study are from prior publications and are available from <ext-link xlink:href="https://sites.google.com/eng.ucsd.edu/datasets/astral/astral-ii" ext-link-type="uri">https://sites.google.com/eng.ucsd.edu/datasets/astral/astral-ii</ext-link>. <ext-link xlink:href="https://maryamrabiee" ext-link-type="uri">https://maryamrabiee</ext-link>. <ext-link xlink:href="http://github.io/ASTRAL-multi/" ext-link-type="uri">//github.io/ASTRAL-multi/</ext-link>, and <ext-link xlink:href="https://gitlab.com/esayyari/ASTRALIII/-/blob/master/ml.tar.gz" ext-link-type="uri">https:// //gitlab.com/esayyari/ASTRALIII/-/blob/master/ml.tar.gz</ext-link>.</p>
      <sec>
        <title>Funding</title>
        <p>This work was supported by the Grainger Foundation through a Grainger Engineering Breakthroughs Initiative chair to T.W.</p>
        <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
      </sec>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btab093-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Allman</surname><given-names>E.S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Species tree inference from gene splits by unrooted STAR methods</article-title>. <source>IEEE/ACM Trans. Comput. Biol. Bioinf</source>., <volume>15</volume>, <fpage>337</fpage>–<lpage>342</lpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Braun</surname><given-names>E.L.</given-names></string-name>, <string-name><surname>Kimball</surname><given-names>R.T.</given-names></string-name></person-group> (<year>2021</year>) <article-title>Data types and the phylogeny of Neoaves</article-title>. <source>Birds</source>, <volume>2</volume>, <fpage>1</fpage>–<lpage>22</lpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chifman</surname><given-names>J.</given-names></string-name>, <string-name><surname>Kubatko</surname><given-names>L.</given-names></string-name></person-group> (<year>2014</year>) <article-title>Quartet inference from SNP data under the coalescent model</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>3317</fpage>–<lpage>3324</lpage>.<pub-id pub-id-type="pmid">25104814</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Houde</surname><given-names>P.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>Phylogenetic signal of indels and the Neoavian radiation</article-title>. <source>Diversity</source>, <volume>11</volume>, <fpage>108</fpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jarvis</surname><given-names>E.D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Whole-genome analyses resolve early branches in the tree of life of modern birds</article-title>. <source>Science</source>, <volume>346</volume>, <fpage>1320</fpage>–<lpage>1331</lpage>.<pub-id pub-id-type="pmid">25504713</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kingman</surname><given-names>J.F.C.</given-names></string-name></person-group> (<year>1982</year>) <article-title>The coalescent</article-title>. <source>Stochastic Processes Appl</source>., <volume>13</volume>, <fpage>235</fpage>–<lpage>248</lpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kozlov</surname><given-names>A.M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>ExaML version 3: a tool for phylogenomic analyses on supercomputers</article-title>. <source>Bioinformatics</source>, <volume>31</volume>, <fpage>2577</fpage>–<lpage>2579</lpage>.<pub-id pub-id-type="pmid">25819675</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kubatko</surname><given-names>L.</given-names></string-name>, <string-name><surname>Degnan</surname><given-names>J.</given-names></string-name></person-group> (<year>2007</year>) <article-title>Inconsistency of phylogenetic estimates from concatenated data under coalescence</article-title>. <source>Syst. Biol</source>., <volume>56</volume>, <fpage>17</fpage>–<lpage>24</lpage>.<pub-id pub-id-type="pmid">17366134</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lefort</surname><given-names>V.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>FastME 2.0: a comprehensive, accurate, and fast distance-based phylogeny inference program</article-title>. <source>Mol. Biol. Evol</source>., <volume>32</volume>, <fpage>2798</fpage>–<lpage>2800</lpage>.<pub-id pub-id-type="pmid">26130081</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>L.</given-names></string-name>, <string-name><surname>Yu</surname><given-names>L.</given-names></string-name></person-group> (<year>2011</year>) <article-title>Estimating species trees from unrooted gene trees</article-title>. <source>Syst. Biol</source>., <volume>60</volume>, <fpage>661</fpage>–<lpage>667</lpage>.<pub-id pub-id-type="pmid">21447481</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liu</surname><given-names>L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2010</year>) <article-title>A maximum pseudo-likelihood approach for estimating species trees under the coalescent model</article-title>. <source>BMC Evol. Biol</source>., <volume>10</volume>, <fpage>302</fpage>.<pub-id pub-id-type="pmid">20937096</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maddison</surname><given-names>W.P.</given-names></string-name></person-group> (<year>1997</year>) <article-title>Gene trees in species trees</article-title>. <source>Syst. Biol</source>., <volume>46</volume>, <fpage>523</fpage>–<lpage>536</lpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mirarab</surname><given-names>S.</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> (<year>2015</year>) <article-title>ASTRAL-II: coalescent-based species tree estimation with many hundreds of taxa and thousands of genes</article-title>. <source>Bioinformatics</source>, <volume>31</volume>, <fpage>i44</fpage>–<lpage>i52</lpage>.<pub-id pub-id-type="pmid">26072508</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mirarab</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014a</year>) <article-title>ASTRAL: genome-scale coalescent-based species tree estimation</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>i541</fpage>–<lpage>i548</lpage>.<pub-id pub-id-type="pmid">25161245</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mirarab</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014b</year>) <article-title>Evaluating summary methods for multi-locus species tree estimation in the presence of incomplete lineage sorting</article-title>. <source>Syst. Biol</source>., <volume>65</volume>, <fpage>366</fpage>–<lpage>380</lpage>.<pub-id pub-id-type="pmid">25164915</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mirarab</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014c</year>) <article-title>Statistical binning enables an accurate coalescent-based estimation of the avian tree</article-title>. <source>Science</source>, <volume>346</volume>, <fpage>1250463</fpage>–<lpage>1250463</lpage>.<pub-id pub-id-type="pmid">25504728</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Molloy</surname><given-names>E.K.</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> (<year>2018</year>) <article-title>To include or not to include: the impact of gene filtering on species tree estimation methods</article-title>. <source>Syst. Biol</source>., <volume>67</volume>, <fpage>285</fpage>–<lpage>303</lpage>.<pub-id pub-id-type="pmid">29029338</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Molloy</surname><given-names>E.K.</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> (<year>2019</year>) <article-title>Statistically consistent divide-and-conquer pipelines for phylogeny estimation using NJMerge</article-title>. <source>Algorithms Mol. Biol</source>., <volume>14</volume>, <fpage>14</fpage>.<pub-id pub-id-type="pmid">31360216</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Molloy</surname><given-names>E.K.</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> (<year>2020</year>) <article-title>FastMulRFS: fast and accurate species tree estimation under generic gene duplication and loss models</article-title>. <source>Bioinformatics</source>, <volume>36</volume>, <fpage>i57</fpage>–<lpage>i65</lpage>.<pub-id pub-id-type="pmid">32657396</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ogilvie</surname><given-names>H.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>StarBEAST2 brings faster species tree inference and accurate estimates of substitution rates</article-title>. <source>Mol. Biol. Evol</source>., <volume>34</volume>, <fpage>2101</fpage>–<lpage>2114</lpage>.<pub-id pub-id-type="pmid">28431121</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rabiee</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>Multi-allele species reconstruction using ASTRAL</article-title>. <source>Mol. Phylogenet. Evol</source>., <volume>130</volume>, <fpage>286</fpage>–<lpage>296</lpage>.<pub-id pub-id-type="pmid">30393186</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Reddy</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Why do phylogenomic data sets yield conflicting trees? Data type influences the avian tree of life more than taxon sampling</article-title>. <source>Syst. Biol</source>., <volume>66</volume>, <fpage>857</fpage>–<lpage>879</lpage>.<pub-id pub-id-type="pmid">28369655</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rhodes</surname><given-names>J.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2020</year>) <article-title>NJst and ASTRID are not statistically consistent under a random model of missing data</article-title>. <source>arXiv Preprint arXiv:2001.07844</source>.</mixed-citation>
    </ref>
    <ref id="btab093-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Robinson</surname><given-names>D.</given-names></string-name>, <string-name><surname>Foulds</surname><given-names>L.</given-names></string-name></person-group> (<year>1981</year>) <article-title>Comparison of phylogenetic trees</article-title>. <source>Math. Biosci</source>., <volume>53</volume>, <fpage>131</fpage>–<lpage>147</lpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Roch</surname><given-names>S.</given-names></string-name>, <string-name><surname>Steel</surname><given-names>M.</given-names></string-name></person-group> (<year>2015</year>) <article-title>Likelihood-based tree reconstruction on a concatenation of aligned sequence data sets can be statistically inconsistent</article-title>. <source>Theor. Popul. Biol</source>., <volume>100</volume>, <fpage>56</fpage>–<lpage>62</lpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Saitou</surname><given-names>N.</given-names></string-name>, <string-name><surname>Nei</surname><given-names>M.</given-names></string-name></person-group> (<year>1987</year>) <article-title>The neighbor-joining method: a new method for reconstructing phylogenetic trees</article-title>. <source>Mol. Biol. Evol</source>., <volume>4</volume>, <fpage>406</fpage>–<lpage>425</lpage>.<pub-id pub-id-type="pmid">3447015</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Schrempf</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>Reversible polymorphism-aware phylogenetic models and their application to tree inference</article-title>. <source>J. Theor. Biol</source>., <volume>407</volume>, <fpage>362</fpage>–<lpage>370</lpage>.<pub-id pub-id-type="pmid">27480613</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shekhar</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Species tree estimation using astral: how many genes are enough?</article-title><source>IEEE/ACM Trans. Comput. Biol. Bioinf</source>., <volume>15</volume>, <fpage>1738</fpage>–<lpage>1747</lpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stamatakis</surname><given-names>A.</given-names></string-name></person-group> (<year>2014</year>) <article-title>RAxML version 8: a tool for phylogenetic analysis and post-analysis of large phylogenies</article-title>. <source>Bioinformatics</source>, <volume>30</volume>, <fpage>1312</fpage>–<lpage>1313</lpage>.<pub-id pub-id-type="pmid">24451623</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vachaspati</surname><given-names>P.</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> (<year>2015</year>) <article-title>ASTRID: accurate Species TRees from Internode Distances</article-title>. <source>BMC Genomics</source>, <volume>16</volume>, <fpage>S3</fpage>.</mixed-citation>
    </ref>
    <ref id="btab093-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Vachaspati</surname><given-names>P.</given-names></string-name>, <string-name><surname>Warnow</surname><given-names>T.</given-names></string-name></person-group> (<year>2018</year>) <article-title>SVDquest: improving SVDquartets species tree estimation using exact optimization within a constrained search space</article-title>. <source>Mol. Phylogenet. Evol</source>., <volume>124</volume>, <fpage>122</fpage>–<lpage>136</lpage>.<pub-id pub-id-type="pmid">29530498</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>ASTRAL-III: polynomial time species tree reconstruction from partially resolved gene trees</article-title>. <source>BMC Bioinformatics</source>, <volume>19</volume>, <fpage>153</fpage>.<pub-id pub-id-type="pmid">29745866</pub-id></mixed-citation>
    </ref>
    <ref id="btab093-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zimmermann</surname><given-names>T.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>BBCA: improving the scalability of BEAST using random binning</article-title>. <source>BMC Genomics</source>, <volume>15</volume>, <fpage>S11</fpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
