<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">8734213</article-id>
    <article-id pub-id-type="publisher-id">2593</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-021-02593-8</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>scDALI: modeling allelic heterogeneity in single cells reveals context-specific genetic regulation</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Heinen</surname>
          <given-names>Tobias</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Secchia</surname>
          <given-names>Stefano</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Reddington</surname>
          <given-names>James P.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhao</surname>
          <given-names>Bingqing</given-names>
        </name>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Furlong</surname>
          <given-names>Eileen E. M.</given-names>
        </name>
        <address>
          <email>furlong@embl.de</email>
        </address>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8818-7193</contrib-id>
        <name>
          <surname>Stegle</surname>
          <given-names>Oliver</given-names>
        </name>
        <address>
          <email>oliver.stegle@embl.de</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.7497.d</institution-id><institution-id institution-id-type="ISNI">0000 0004 0492 0584</institution-id><institution>Division of Computational Genomics and Systems Genetics, </institution><institution>German Cancer Research Center (DKFZ), </institution></institution-wrap>Heidelberg, Germany </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.4709.a</institution-id><institution-id institution-id-type="ISNI">0000 0004 0495 846X</institution-id><institution>Genome Biology Unit, </institution><institution>European Molecular Biology Laboratory, </institution></institution-wrap>Heidelberg, Germany </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.7700.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2190 4373</institution-id><institution>Faculty of Mathematics and Computer Science, </institution><institution>Heidelberg University, </institution></institution-wrap>Heidelberg, Germany </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.7700.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2190 4373</institution-id><institution>Faculty of Biosciences, </institution><institution>Collaboration for Joint PhD Degree between EMBL and Heidelberg University, </institution></institution-wrap>Heidelberg, Germany </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>6</day>
      <month>1</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>6</day>
      <month>1</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2022</year>
    </pub-date>
    <volume>23</volume>
    <elocation-id>8</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>7</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>27</day>
        <month>12</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">While it is established that the functional impact of genetic variation can vary across cell types and states, capturing this diversity remains challenging. Current studies using bulk sequencing either ignore this heterogeneity or use sorted cell populations, reducing discovery and explanatory power. Here, we develop scDALI, a versatile computational framework that integrates information on cellular states with allelic quantifications of single-cell sequencing data to characterize cell-state-specific genetic effects. We apply scDALI to scATAC-seq profiles from developing F1 <italic>Drosophila</italic> embryos and scRNA-seq from differentiating human iPSCs, uncovering heterogeneous genetic effects in specific lineages, developmental stages, or cell types.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s13059-021-02593-8.</p>
      </sec>
    </abstract>
    <kwd-group xml:lang="en">
      <title>Keywords</title>
      <kwd>Single-cell, Regulatory genomics, Statistical methods</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>European Molecular Biology Laboratory (EMBL) (4843)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2022</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Background</title>
    <p id="Par2">The functional impact of genetic variants on molecular traits such as gene expression can be influenced by the cell type or cell state. Particularly non-coding variants in enhancer elements can impact a gene’s expression in one tissue and not in others. Population-scale genetics studies, using bulk sequencing across individuals, have identified many such tissue-specific [<xref ref-type="bibr" rid="CR1">1</xref>–<xref ref-type="bibr" rid="CR3">3</xref>] and developmental stage-specific [<xref ref-type="bibr" rid="CR4">4</xref>] effects, which often involve rare genetic variants. However, even carefully dissected tissues are composed of heterogeneous cell types, thus motivating the application of single-cell sequencing to reveal cell-state dependencies of genetic effects. Recent single-cell RNA-seq studies in in vitro models revealed changing genetic dependencies across different cellular transitions [<xref ref-type="bibr" rid="CR5">5</xref>–<xref ref-type="bibr" rid="CR7">7</xref>].</p>
    <p id="Par3">However, most existing analysis strategies for single-cell genetic studies have been based on computational methods originally developed for bulk-sequencing data [<xref ref-type="bibr" rid="CR5">5</xref>, <xref ref-type="bibr" rid="CR6">6</xref>, <xref ref-type="bibr" rid="CR8">8</xref>], requiring the discretization of cellular states and thus potentially failing to detect more fine-grained differences in regulation. Computational strategies that allow for the unbiased identification of cell-state-specific effects are only beginning to emerge [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR10">10</xref>] and currently rely on profiling a large number of genetically diverse individuals, which is particularly limiting for in vivo analyses and non-human model systems. The latter could be addressed by measuring allele-specific signals, i.e., quantifying molecular traits separately for each haplotype [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR11">11</xref>–<xref ref-type="bibr" rid="CR14">14</xref>], which in principle allows for identifying genetic effects even in a single individual. The combination of allele-specific quantifications coupled with the use of single-cell technologies could be a powerful strategy to dissect the functional impact of genetic variants both within and across multiple cell types contained in a complex tissue. Prior studies have quantified allele-specific properties at a single-cell level to characterize transcriptional bursting and stochasticity in gene expression [<xref ref-type="bibr" rid="CR15">15</xref>, <xref ref-type="bibr" rid="CR16">16</xref>]. However, the analysis of allele-specific patterns to unravel allelic regulation at the single-cell level are only beginning to emerge [<xref ref-type="bibr" rid="CR8">8</xref>, <xref ref-type="bibr" rid="CR17">17</xref>], and principled computational methods for this task are not established.</p>
    <p id="Par4">To address the aforementioned challenges, we developed a versatile computational model and analysis framework, scDALI (single-cell differential allelic imbalance). scDALI leverages allele-specific quantifications in single cells to identify and comprehensively test for different types of allelic effects, including homogeneous effects that are shared across all cell states or heterogeneous effects that are specific to some cell states. Intuitively, our model is similar in spirit to differential expression testing but aimed at identifying loci that exhibit heterogeneous allelic imbalance rather than variation in total expression. Critically, the model does not require the definition of cell states or clusters a priori and can cope with both discrete cellular states or continuous transitions. Additionally, scDALI enables the estimation of allelic imbalance from sparse sequencing data in individual cells, thereby facilitating the visualization and downstream interpretation of allelic regulation. scDALI is applicable to single-cell datasets obtained from different modalities and sequencing technologies.</p>
    <p id="Par5">We applied scDALI to study allele-specific variation in single-cell chromatin accessibility data (sciATAC-seq) in developing F1 embryos of <italic>Drosophila melanogaster</italic>, where we identified hundreds of regulatory regions with allelic imbalances in specific cell types or developmental stages. Among these effects, we identify putative enhancer regions with opposing allelic imbalance in different cell lineages, which are missed by bulk assay profiling. We then leveraged scDALI to fine-map the cell-type specificity of known expression quantitative trait loci (eQTL) in a population cohort of human induced pluripotent stem cells (iPSC), by assessing allelic regulation of single-cell transcriptomes. scDALI offered increased detection power compared to previous methods and uncovered how subtle differences in cell states can substantially affect allelic regulation. scDALI is therefore applicable to diverse species and data types, and leverages single-cell technologies to avoid cell sorting, thereby providing the means to discover and quantify the functional impact of cell state-specific genetic effects in a systematic and unbiased manner.</p>
  </sec>
  <sec id="Sec2">
    <title>Results and discussion</title>
    <p id="Par6">scDALI enables the analysis of context-specific allelic regulation from single-cell sequencing data, either generated from outbred individuals or F1 crosses of inbred wild-isolates. Key to our approach is the integration of two independent signals that can be obtained from the same single-cell sequencing experiment: total counts and allele-specific quantifications. These signals can be derived from single-cell RNA-sequencing, single-cell ATAC-sequencing, and a range of other epigenetic assays. scDALI first uses total counts, quantified at individual features, to define a manifold of cell types and cell states, similar to established workflows for the inference of state clusters [<xref ref-type="bibr" rid="CR18">18</xref>] or pseudo-temporal orderings [<xref ref-type="bibr" rid="CR19">19</xref>]. Second, from the same dataset, allele-specific counts from matched cells are extracted, which allow for quantifying allelic imbalances and therefore genetic effects (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>).
<fig id="Fig1"><label>Fig. 1</label><caption><p>scDALI overview and model validation using simulated data. <bold>a</bold> Illustration of the causes and quantification of allelic imbalance. Heterozygous variants within quantified genomic features (T and G variant) are used to assign reads to either haplotype. A <italic>cis</italic>-regulatory genetic variant (A and G variant, yellow) impacts the efficacy of a <italic>trans</italic>-acting factor on the maternal allele, which results in allelic imbalance. If the <italic>trans</italic>-acting factor is cell-state specific, this effect will be heterogeneous across cell states, otherwise homogeneous. <bold>b</bold> Integration of total and allelic counts per cell. scDALI models allelic imbalance in single cells as the sum of a fixed expected rate (<italic>r</italic><sub><italic>base</italic></sub>, e.g., 0.5 for autosomes), optional covariates, a global homogeneous component (<italic>μ</italic><sub><italic>hom</italic></sub>), and a heterogeneous cell state-specific component (<italic>f</italic><sub><italic>het</italic></sub>), which is characterized by a cell state kernel matrix. Three alternative score tests allow for assessing the evidence for global allelic imbalance (scDALI-Hom), heterogeneity across cell states (scDALI-Het), or to jointly test for either form of allelic imbalance (scDALI-Joint). <bold>c</bold>, <bold>d</bold> Assessment of power of alternative tests for allelic imbalance using simulated data. Allelic counts were simulated using alternative cell state kernels derived from real data (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S2, Methods). <bold>c</bold> Varying the simulated fraction of explained variance (FEV) of heterogeneous vs. homogeneous allelic imbalance. Whereas scDALI-Het and scDALI-Hom detect signals with simulated persistent or heterogeneous effects respectively, scDALI-Joint identifies either type of allelic imbalance. <bold>d</bold> Varying between simulating from a discrete and continuous cell state model. Shown are results from scDALI-Het and a baseline based on ANOVA to test for differences between discrete cell clusters (24 clusters; Methods)</p></caption><graphic xlink:href="13059_2021_2593_Fig1_HTML" id="MO1"/></fig></p>
    <p id="Par7">scDALI is a probabilistic model that can dissect dependencies between both of these signals, while aggregating evidence across cells to mitigate the sparsity of single-cell data. Briefly, our method can be cast as a generalized linear mixed model (GLMM) with a Beta-Binomial likelihood that accounts for count noise and residual overdispersion due to unmodeled variability in the data (Methods). This formulation extends the classical Beta-Binomial framework, which has previously been used for allele-specific analyses of bulk sequencing data [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR20">20</xref>]. The model is also conceptually related to random effect models that have been proposed to study genotype-environment interactions in population-scale studies [<xref ref-type="bibr" rid="CR10">10</xref>, <xref ref-type="bibr" rid="CR21">21</xref>]. scDALI captures both homogeneous deviation from a specified base allelic rate (e.g., 0.5 for autosomes in diploid organisms), as well as heterogeneity in allelic rates across cells using a kernel matrix that explains cell states, which is estimated from total counts [<xref ref-type="bibr" rid="CR22">22</xref>, <xref ref-type="bibr" rid="CR23">23</xref>]. Our framework can capture a variety of cell state effects, including discrete cell clusters as well as continuous developmental trajectories. It is also possible to incorporate additional known covariates, such as batch or sample structure as fixed effects. Within the scDALI framework, we formulate computationally efficient score tests [<xref ref-type="bibr" rid="CR24">24</xref>, <xref ref-type="bibr" rid="CR25">25</xref>] that allow us to identify sites that exhibit different types of allelic imbalance. In particular, scDALI implements tests specific to global <italic>homogeneous</italic> (pervasive) imbalance (scDALI-Hom), <italic>heterogeneous</italic> genetic effects that vary across cell types and cell states (scDALI-Het) or either of these effects (scDALI-Joint) (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>). scDALI also allows for estimating the fraction of the total allele-specific variance that can be explained by cell state effects, and the model can be used to estimate and visualize allelic imbalances across cell states (Methods). Our framework is designed for the analysis of single-cell sequencing data from a small number of genetically distinct individuals, and hence the focus is not the discovery of novel quantitative trait loci but rather to leverage allelic imbalance to characterize the cell-state specificity of genetic factors.</p>
    <sec id="Sec3">
      <title>Model validation using simulated data</title>
      <p id="Par8">Initially, we validated our approach using simulated data, which was designed to mimic real count data as expected from a very heterogeneous sample (single-cell data from whole embryos), by adapting key parameters from empirical sciATAC-seq profiles from whole <italic>Drosophila melanogaster</italic> embryos (continuous and discretized cell states, overdispersion parameters; Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1a, 2, Methods). First, we assessed the calibration of all three scDALI tests by simulating from the corresponding null models, confirming uniformly distributed <italic>P</italic>-values (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1b, c). Notably, a variant of scDALI-Het using a Binomial rather than Beta-Binomial observation model was not calibrated at overdispersion levels estimated from real data (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1c). We also considered two alternative tests for modeling empirical allelic rates (maternal counts divided by total counts): a one-way ANOVA, testing for differences between discrete clusters and a multiple-degrees-of-freedom likelihood ratio test based on an ordinary least squares regression model (OLS, Methods). While the ANOVA model was calibrated, the OLS model led to inflated <italic>P</italic>-values when testing high-dimensional cell states relative to the sample size (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1 d). Next, we simulated allelic counts from the scDALI model, varying the proportion of homogeneous versus heterogeneous allelic imbalance (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S2, 3a). As expected, scDALI-Joint identified effects of both classes, generalizing the individual tests scDALI-Het and scDALI-Hom. We then went on to simulate allelic counts either assuming continuous states, discrete cell state clusters derived from these states, or weighted combinations thereof (Fig. <xref rid="Fig1" ref-type="fig">1d</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S2, 3b, Methods). We compared scDALI to an ANOVA test based on the discretized cell state representation, finding that scDALI-Het offered substantial advantages in the presence of additional continuous variation, whereas ANOVA is most suitable to detect purely discrete effects. We also considered a range of additional settings, varying the levels of overdispersion and kernel variance (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S3), finding that scDALI was robust to a range of different parameters. scDALI is implemented as computationally efficient open-source software, scaling to the analysis of large datasets with up to tens of thousands of cells (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S4).</p>
    </sec>
    <sec id="Sec4">
      <title>scDALI identifies heterogeneous allelic imbalance in scATAC-seq from developing <italic>Drosophila</italic> embryos</title>
      <p id="Par9">Having validated the model, we applied scDALI to open chromatin regions during embryonic development in F1 hybrid embryos of <italic>Drosophila melanogaster.</italic> We profiled single-cell chromatin accessibility by sciATAC-seq in F1 embryos obtained by mating the same mother to four genetically distinct fathers [<xref ref-type="bibr" rid="CR20">20</xref>]. To ensure that we captured regulatory variation associated with major developmental events, we collected embryos from four F1 crosses at three key stages of embryonic development (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>, 2–4 h, 6–8 h, and 10–12 h after egg laying), which correspond to stages when the majority of cells are multipotent, or are undergoing lineage commitment, and or tissue differentiation, respectively. Sequencing the resulting 12 sciATAC-seq libraries generated a dataset of 35,485 single cells (between 8000 and 10,000 cells per cross) that passed stringent quality metrics (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S5; Methods). Overall, our dataset features all the hallmarks of high-quality sciATAC-seq, including the appropriate nucleosomal banding pattern (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S5a), and a high concordance to previously identified peaks from a time-matched sciATAC-seq dataset in a reference strain [<xref ref-type="bibr" rid="CR26">26</xref>] (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S6).
<fig id="Fig2"><label>Fig. 2</label><caption><p>Application of scDALI to sciATAC-seq of <italic>Drosophila</italic> F1 embryos. <bold>a</bold> Experimental design. Chromatin accessibility was profiled in four F1 crosses at three distinct developmental stages (2–4, 6–8, and 10–12 h after egg laying), resulting in 12 sciATAC-seq libraries. <bold>b</bold> UMAP visualization of the full integrated dataset (34,053 cells from 12 sciATAC-libraries, excluding cell clusters with ambiguous annotations) based on the latent space of the Variational Autoencoder (VAE) (Methods). Top: Cells colors by the continuous temporal ordering as estimated from the VAE model. Bottom: Colored by the major lineage annotation. <bold>c</bold> Number of sites across crosses and time points with allelic imbalance identified by scDALI-Joint, scDALI-Hom, and scDALI-Het. Top: Number of discoveries as a function of the FDR threshold (Benjamini Hochberg adjusted). Bottom: Overlap between the sites identified by all three scDALI tests (FDR &lt; 0.1). <bold>d</bold> Scatter plot of negative log <italic>P</italic>-values between scDALI-Joint and scDALI-Hom (top) and scDALI-Het versus scDALI-Hom (bottom) respectively. Color denotes the estimated fraction of allele-specific variance explained by cell-state-specific effects; non-significant peaks marked in grey (adjusted scDALI-Joint <italic>P</italic> &gt; 0.1). Inset plots zoom in on peaks with pronounced cell state-specific imbalances. The red circle highlights the peak chr3R:20310056-20311056, a region showing prominent cell state-specific effects with no discernable global imbalance (c.f. Fig. <xref rid="Fig3" ref-type="fig">3a–c</xref>)</p></caption><graphic xlink:href="13059_2021_2593_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par10">To infer a common cell state representation for all time points and crosses, we adapted a variational autoencoder (VAE) [<xref ref-type="bibr" rid="CR27">27</xref>] that was previously developed for scRNA-seq data [<xref ref-type="bibr" rid="CR28">28</xref>] to scATAC-seq. Briefly, a VAE is a neural network with a probabilistic bottleneck layer that learns the distribution of the data by compressing high-dimensional observations into a lower dimensional latent space. Our implementation (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7a) incorporates a size-factor adjusted Bernoulli likelihood model tailored to the binary nature of scATAC-seq data. Furthermore, the model not only integrates measurements across datasets and batches but also allows to explicitly model information about different sampling times for developmental datasets (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7d, e). This extension enables our model to infer continuous temporal ordering of cells by coupling the VAE objective function with a regression problem to predict sampling time from the latent cell state representation (Methods). We trained the model using the top 25,000 most accessible peaks across all crosses and time points. The VAE yielded a well-aligned latent space for all F1 crosses (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7c) that captured progressive changes across developmental time (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7d, e). We used the VAE latent space to define the cell state covariance for scDALI (see below). For annotating cell types, cells were clustered based on this lower-dimensional representation using the Leiden algorithm [<xref ref-type="bibr" rid="CR29">29</xref>, <xref ref-type="bibr" rid="CR30">30</xref>] (28 clusters, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7b), followed by an assignment of tissue identities based on the enrichment for enhancers with validated in vivo spatio-temporal activity in specific tissues during embryogenesis and genes with known tissue-specific expression [<xref ref-type="bibr" rid="CR26">26</xref>] (Methods). Four smaller clusters with ambiguous annotations that likely correspond to barcode collisions were excluded from further analysis. This annotation process resolved seven cell populations that are representative of major embryonic lineages, including muscle, nervous system, and ectoderm (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>).</p>
      <p id="Par11">Next, we quantified chromatin accessibility on an allele-specific level. We applied WASP [<xref ref-type="bibr" rid="CR13">13</xref>] to avoid allelic mapping artifacts, filtering between 7 and 8% of mapped reads (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8a, Methods). Allele-specific chromatin accessibility was quantified within 1 kb regions centered on ATAC peaks, requiring that each read overlapped at least one heterozygous variant. This resulted in a haplotype assignment for 20% of the reads (based on 5–6 variants per region on average, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8b, c). After discarding peaks with low allelic coverage (mean count of reads that could be assigned to either allele &lt; 0.1), we obtained between 8040 and 12,861 open-chromatin peaks per cross for further analysis resulting in a combined set of 39,530 peaks to be tested (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S9d, e).</p>
      <p id="Par12">We applied scDALI to test for homogeneous or heterogeneous allelic imbalance at each of the 39,530 peaks, jointly considering cells across all developmental stages for each cross (Fig. <xref rid="Fig2" ref-type="fig">2c, d</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S9; using the VAE latent space coordinates to define the cell state kernel; Methods). scDALI-Joint identified 7823 (~ 20%) ATAC peaks with evidence for allelic imbalance (FDR &lt; 0.1, Benjamini-Hochberg adjusted). Notably, the majority of these peaks were also identified by scDALI-Hom (83%), indicating that homogeneous imbalance is prevalent. However, scDALI-Het identified 415 sites with evidence for cell state-specific allelic imbalance, 200 of which were missed by scDALI-Hom. This indicates that strong heterogeneity can preclude the identification of allelic imbalance by bulk sequencing or analysis strategies that assume exclusive homogenous effects. For instance, a peak (region chr3R:20310056-20311056) in cross F1-DGRP-307 was identified with high significance by scDALI-Joint (<italic>P</italic> = 1.93 × 10<sup>−8</sup>) and scDALI-Het (<italic>P</italic> = 5.45 × 10<sup>−8</sup>), but was globally consistent with a model that assumes no allelic imbalance (scDALI-Hom <italic>P</italic> = 0.81, Fig. <xref rid="Fig2" ref-type="fig">2d</xref>). We also assessed whether heterogeneous allelic imbalance at peaks identified by scDALI-Het could be explained by variation in total accessibility of the corresponding peak, finding no evidence for such a relationship for the vast majority of peaks (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S10 c, d). To evaluate to what extent scDALI is affected by the specific choice of cell-state representations, we also considered two alternative methods to define a cell state kernel, latent semantic indexing [<xref ref-type="bibr" rid="CR26">26</xref>] (LSI), and cisTopic [<xref ref-type="bibr" rid="CR31">31</xref>] (Methods). This comparison indicated that peaks with significant heterogenous imbalance were robustly identified across all three cell-state representations (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S10 a, b).</p>
    </sec>
    <sec id="Sec5">
      <title>Properties of regions with heterogeneous allelic imbalance</title>
      <p id="Par13">We applied scDALI to estimate allele-specific accessibility in individual cells for 415 peaks with significant heterogeneous allelic imbalance. We considered two alternative strategies for annotating cell-state-specific effects. First, we aggregated estimated allelic rates for each of the 7 annotated lineages and compared the rate distribution and mean allelic rates to identify lineages with pronounced differential allelic imbalance. Second, we estimated transcription factor (TF) activity scores for each cell based on the total accessibility of a curated set of 65 transcription factor motives [<xref ref-type="bibr" rid="CR4">4</xref>] (using chromVAR [<xref ref-type="bibr" rid="CR32">32</xref>]) and ranked TFs based on the correlation between their activity and estimated allelic rates (Methods). Notably, the latter approach avoids the definition of discrete cell clusters and thus can be used to identify specific regulatory programs associated with allelic imbalance.</p>
      <p id="Par14">We find several cases in which allelic imbalance affects known lineage-specific regulatory elements. For example, region chr3R:22877489-22878489 (scDALI-Het <italic>P</italic> = 2.7 × 10<sup>−5</sup>) has been previously identified as a neuronal-specific DNase Hypersensitive Site (DHS) [<xref ref-type="bibr" rid="CR33">33</xref>] and has been demonstrated to function as a nervous system enhancer in vivo (CAD4 database [<xref ref-type="bibr" rid="CR26">26</xref>]). Accordingly, this region is identified as predominantly accessible in the nervous system (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). In addition, while cells from other lineages show no appreciable allelic imbalance, accessibility in the nervous system is strongly biased for the paternal allele (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11b). Ordering cells by their estimated allelic rate and computing the difference between the top and bottom 10% quantiles (Qdiff10), we define a measure of the effect size of heterogeneous allele-specific imbalances, which captures the variation in allelic rates between the most extreme populations (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11a). For this specific example, we obtain a Qdiff10 of 0.24 despite the overall mean allelic rate being close to 0.5 (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11b). In accordance with the allelic imbalance identified by scDALI at this locus, the assessment of TFs associated with heterogeneity in allelic effects identified known nervous system regulators, such as Tramtrack (<italic>ttk</italic>) and Hairy (<italic>h</italic>) (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11e).
<fig id="Fig3"><label>Fig. 3</label><caption><p>Examples and analysis of ATAC peaks with heterogeneous allelic imbalance. <bold>a</bold> UMAP visualization displaying cells colored by their predicted allelic rate (maternal accessibility relative to total accessibility) for region chr3R:22877489-22878489 in cross F1-DGRP-639. Black dots indicate cells with observed allelic rates (non-zero allelic total counts) that were used to fit the scDALI model. <bold>b</bold> Genome browser tracks for region chr3R:22877489-22878489 illustrating allele-specific aggregate accessibility for the nervous system and other populations. <bold>c</bold> Left: Correlation between estimated allelic rates and chromVAR transcription factor (TF) activity scores in individual cells. Shown are the ten strongest associations, with plus and minus signs indicating the direction of correlation. Right: Curated lineage annotation for each TF. <bold>e</bold>–<bold>g</bold> Example region chr2R:13675707-13676707 in cross F1-DGRP-639, revealing opposing effects in the nervous system and muscle lineage. <bold>h</bold>–<bold>j</bold> Example region chr3R:20310056-20311056 in F1-DGRP-307, revealing lineage-specific differences in allelic rates for the muscle, primordium, and midgut, as well as intra-lineage variation within the muscle population. <bold>k</bold> Violin plots of effect size estimates for heterogeneously (Qdiff10, i.e., 10% quantile difference as in <bold>d</bold>) and homogeneously imbalanced (absolute deviation from 0.5) peaks, considering distal and promoter-proximal regions separately. Distal peaks are associated with both larger absolute allelic imbalance and stronger heterogeneity (<italic>P</italic> = 5.6 × 10<sup>−5</sup>, <italic>P</italic> = 2.17 × 10<sup>−26</sup>, one-sided Mann-Whitney <italic>U</italic> test). <bold>l</bold> Total number of peaks tested and peaks with allelic imbalance identified using alternative tests (FDR &lt; 0.1), stratified by the peak distance to the transcription start site (TSS) of the closest gene. Heterogeneously imbalanced peaks are markedly more common at distal regions. <bold>m</bold>, <bold>n</bold> By-lineage analysis of allelic imbalance using scDALI-Het for peaks with significant heterogeneous imbalances. <bold>m</bold> Distribution of the number of differentially imbalanced lineages per peak. <bold>n</bold> Distribution of the number of peaks with increasing numbers of differentially imbalanced lineages. The majority of peaks show imbalance in a single lineage</p></caption><graphic xlink:href="13059_2021_2593_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par15">Interestingly, we found a number of regulatory regions that show opposing allelic imbalances in different lineages. For example, region chr2R:13675707-13676707 has only a small maternal bias (estimated overall mean rate 0.61) when considering the global allelic rate but is identified as a site with pronounced allelic heterogeneity by scDALI (scDALI-Het <italic>P</italic> = 1.5 × 10<sup>−8</sup>, Fig. <xref rid="Fig3" ref-type="fig">3e</xref>). This region has previously been identified as a neuronal and muscle-specific DHS [<xref ref-type="bibr" rid="CR33">33</xref>] and accordingly shows increased accessibility in the nervous system and muscle in our data. However, accessibility is biased for the maternal allele in the muscle and the paternal allele in the nervous system (Qdiff10 = 0.29, Fig. <xref rid="Fig3" ref-type="fig">3f</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11c). This pattern of opposing allelic imbalance is also reflected in the correlation with the activity of TFs active in these tissues. For example, known muscle regulators, such as Twist (<italic>twi</italic>) and Tinman (<italic>tin</italic>) are correlated with the maternal allelic rate, while factors active in the nervous system, for example, Tramtrack (<italic>ttk</italic>), Disconnected <italic>(disco</italic>), and Kruppel (<italic>Kr</italic>), are correlated with the paternal rate (Fig. <xref rid="Fig3" ref-type="fig">3g</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11f).</p>
      <p id="Par16">Another example is chr3R:20310056-20311056 (scDALI-Het <italic>P</italic> = 5.45 × 10<sup>−8</sup>), a region spanning an intron of the gene <italic>CG42668</italic>. The total accessibility of this region largely coincides with the known tissue-specific gene expression of <italic>CG42668</italic> in the cells of the midgut and visceral muscle. Our allele-specific analysis revealed differential allele-specific effects in both tissues, suggesting distinct regulatory programs orchestrating the tissue-specific activity of <italic>CG42668</italic> (Fig. <xref rid="Fig3" ref-type="fig">3h, i</xref>). Furthermore, muscle cells showed additional intra-lineage variation, resulting in a bi-modal distribution of allelic rates (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11d). Despite the presence of strong inter- and intra-lineage variation (quantile difference 0.39), this effect is obscured in a bulk-level analysis (scDALI-Hom <italic>P</italic> = 0.81). The activity score of GATAe, a known midgut TF, is highly correlated (Pearson <italic>r</italic> &gt; 0.5) with the maternal rate, while Zelda (<italic>vfl</italic>), which has a role in zygotic genome activation and early developmental patterning in the embryo primordium, with the paternal rate, consistent with the allelic bias observed in these cell populations (Fig. <xref rid="Fig3" ref-type="fig">3j</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11g). The temporal intra-lineage variation within the muscle population is also reflected in the correlation with the activity of known early and late muscle TFs. Twist (<italic>twi</italic>) and Tinman (<italic>tin</italic>) are active in the early muscle primordium (mesoderm) where they direct the specification of the muscle lineages, and concordantly their activity scores are correlated with the paternal allelic rate observed in the early muscle cells. TF Lameduck (<italic>lmd</italic>) is instead correlated with the maternal rate, as it is required during later stages of muscle formation for the proper specification of the somatic and visceral muscle (Fig. <xref rid="Fig3" ref-type="fig">3j</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11g).</p>
      <p id="Par17">More globally, allele-specific effects are stronger at distal regulatory elements (potential enhancers) compared to promoter-proximal regions, both for peaks with heterogeneous (one-sided Mann-Whitney <italic>U</italic> test, <italic>P</italic> = 5.6 × 10<sup>−5</sup>) as well as homogeneous (one-sided Mann-Whitney <italic>U</italic> test, <italic>P</italic> = 2.17 × 10<sup>−26</sup>) imbalance (Fig. <xref rid="Fig3" ref-type="fig">3k</xref>). Furthermore, imbalances are significantly more common at distal versus proximal regions (Fig. <xref rid="Fig3" ref-type="fig">3l</xref>), similar to what has been observed in bulk ATAC-seq data at time-matched developmental stages [<xref ref-type="bibr" rid="CR20">20</xref>]. These differences between distal and proximal sites are less pronounced when considering discoveries from scDALI-Hom (two-sided Binomial test <italic>P</italic> = 0.02), with about 61% of significant regions being found at proximal regions compared to 62% of all tested peaks. Interestingly, however, we find this effect to be markedly more prominent for heterogeneously imbalanced regions (two-sided Binomial test <italic>P</italic> = 2.15 × 10<sup>−10</sup>), with only 47% of peaks discovered by scDALI-Het being located near gene promoters.</p>
      <p id="Par18">To further characterize heterogeneous imbalances, we used scDALI to assess differential lineage effects, testing for differences in mean allelic rates between each lineage and all remaining cells (Methods). Briefly, this test can be formulated under the scDALI-Het framework, replacing the continuous cell state kernel with a block-diagonal matrix to indicate lineage membership. Unsurprisingly, the frequency of significant imbalances by lineage (FDR &lt; 0.1) largely resembled the overall read count distribution, which influences the detection power for allelic imbalance (Fig. <xref rid="Fig3" ref-type="fig">3m</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S12a). For the majority of peaks, allele-specific variation was attributable to one or two differentially imbalanced lineages (72%); however, 11% of peaks showed differences between three of four lineages (Fig. <xref rid="Fig3" ref-type="fig">3n</xref>). Interestingly, for 17% of scDALI-Het discoveries, allele-specific effects do not differentiate any single lineage, indicating the presence of significant intra-lineage variation, for example due to variation in developmental time.</p>
    </sec>
    <sec id="Sec6">
      <title>Identification of sites with heterogeneous allelic imbalance linked to developmental time</title>
      <p id="Par19">Developmental time is a major driver of variation in our dataset and therefore a promising predictor of allele-specific changes within lineages. We applied scDALI to test for time-specific allelic imbalances within muscle, the lineage with the largest number of cells, using the pseudo-temporal ordering estimated by the VAE model as a cell state representation (Fig. <xref rid="Fig4" ref-type="fig">4d</xref>). Leveraging the scDALI framework, we design a kernel capturing both linear and nonlinear (polynomial) temporal dependencies (Methods). Out of 363 peaks with significant heterogeneous allelic imbalance that are accessible in muscle (mean total allelic count within lineage &lt; 0.1), scDALI identified 69 (19%) peaks with significant time-specific effects (FDR &lt; 0.1; Fig. <xref rid="Fig4" ref-type="fig">4a, b</xref>). Notably, 27% of these peaks with time-specific allelic imbalance did not show any lineage-specific effects (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). As an example, region chr2R:13675707-13676707 discussed above (Fig. <xref rid="Fig3" ref-type="fig">3f</xref>) does indeed exhibit strong time-specific imbalances (Fig. <xref rid="Fig4" ref-type="fig">4e</xref>, Fig. <xref rid="Fig4" ref-type="fig">4f</xref>), consistent with the observed intra-lineage variation specifically in muscle cells.
<fig id="Fig4"><label>Fig. 4</label><caption><p>scDALI-Het identifies time-specific intra-lineage variation. <bold>a</bold> Scatter plot of negative log <italic>P</italic>-values for scDALI-Het versus a scDALI test for time-specific variation in the muscle population. Red circle highlights region chr2R:13675707-13676707. <bold>b</bold> Of 363 peaks identified by scDALI-Het that are accessible in the muscle, 19% showed significant temporal effects (FDR &lt; 0.1). <bold>c</bold> The majority of peaks with a time-specific effect in the muscle did not show significant differential allelic imbalance between lineages. <bold>d</bold> Temporal order for the muscle lineage estimated by the variational autoencoder model. <bold>e</bold>, <bold>f</bold> Estimated allelic rates across time for region chr2R:13675707-13676707. Black dots denote cells with observed allele-specific counts in this region</p></caption><graphic xlink:href="13059_2021_2593_Fig4_HTML" id="MO4"/></fig></p>
    </sec>
    <sec id="Sec7">
      <title>Application of scDALI to identify cell-type-specific effects of eQTL</title>
      <p id="Par20">To demonstrate that scDALI is also applicable to single-cell RNA-seq, we considered a recently published multi-donor single-cell RNA-seq dataset of human induced pluripotent stem cells (iPSCs) differentiating towards definitive endoderm [<xref ref-type="bibr" rid="CR5">5</xref>]. Samples were profiled using a full-length sequencing protocol (Smart-seq2, [<xref ref-type="bibr" rid="CR34">34</xref>]), allowing for the quantification of gene expression in haplotype-resolved manner and thus providing the basis for an analysis using scDALI. Briefly, this study spans 34,254 cells (after basic filtering, Methods) from 125 donors at four time points during cell differentiation. We considered 3966 eQTL (SNP-gene pairs) that were identified in the primary analysis and applied scDALI-Het to assess the evidence for heterogeneous allelic gene expression. Briefly, for each of these eQTL, we aggregated allele-specific counts across all cells from donors with a heterozygous query eQTL variant relative to this variant (using haplotype phasing, c.f. Methods and [<xref ref-type="bibr" rid="CR5">5</xref>]). We then used the first 20 principal components from total expression counts to construct a cell state kernel for the scDALI analysis (Methods).</p>
      <p id="Par21">While allelic rates are generally less susceptible to confounding variables such as batch effects, donor-specific read mapping biases as well as differences in the representation of cell types and cell states can lead to spurious signals of heterogeneous allelic variation. Indeed, we confirmed the need to account for the donor identities (donorID) in this analysis to retain calibrated test statistics (10 PCs, Fig. <xref rid="Fig5" ref-type="fig">5a, b</xref>; assessed using permuted cell coordinates; Methods).
<fig id="Fig5"><label>Fig. 5</label><caption><p>scDALI-Het applied to scRNA-seq of differentiating iPSCs reveals cell-state specificity of eQTL. <bold>a</bold>, <bold>b</bold> Q-Q plot of scDALI-Het <italic>P</italic>-values when permuting the cell-state coordinates of cells from the same donor. A model that does not account for the donor identity yields inflated <italic>p</italic>-values (<bold>a</bold>), whereas scDALI-Het with donor identities as fixed effects yields calibrated results (<bold>b</bold>). <bold>c</bold> Number of discoveries for varying numbers of principal components (PCs) used to define the cell state kernel. If donor identity is not accounted for, using a larger number of PCs for the cell-state definition leads to an increasing number of discoveries. <bold>d</bold> Scatter plot of negative log P-values, comparing a model using only the leading PC versus scDALI-Het with 10 PCs. Orange dots are discoveries that are exclusively identified by the general cell-state test (10 PCs). Indicated are the number of significant discoveries in each quadrant (10% FDR). <bold>e</bold> UMAP visualization of collection- and pseudotime. <bold>f</bold> Estimated allelic rates for the eGene-QTL pair (CPNE1, chr20:34344225 T/A). <bold>g</bold> Expression of UTF1, a previously identified marker for neuronal differentiation success</p></caption><graphic xlink:href="13059_2021_2593_Fig5_HTML" id="MO5"/></fig></p>
      <p id="Par22">We assessed the number of eQTL with heterogeneous imbalance discovered by scDALI-Het when varying the number of principal components used to construct the cell-state kernel, finding that more complex kernels yielded a larger number of discoveries, which however saturated for five or more components (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>). For example, a model using the first PC to define a cell state kernel (which primarily captures differentiation, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S13) identified 611 eQTL with heterogeneous allelic imbalance compared to 812 eQTL when using 10 components (Fig. <xref rid="Fig5" ref-type="fig">5d</xref>, FDR &lt; 0.1). This indicates that although variation in gene expression in this data is predominantly explained by the differentiation state (Fig. <xref rid="Fig5" ref-type="fig">5e</xref>), the remaining sources of variation drive a substantial fraction of distinct genetic regulation. One example of such an effect is an eQTL with heterogeneous ASE for CPNE1 (<italic>P</italic> = 3 × 10<sup>−9</sup>, scDALI-Het). CPNE1 has been shown to play a role in neuronal progenitor cell differentiation [<xref ref-type="bibr" rid="CR35">35</xref>]. Intriguingly, the pattern of allelic imbalance is confined to a distinct subpopulation of iPS cells, which is marked by expression of UTF1. Notably, this UTF1-positive iPS subpopulation has recently been associated with differentiation efficiency towards a midbrain neural fate [<xref ref-type="bibr" rid="CR6">6</xref>] (Fig. <xref rid="Fig5" ref-type="fig">5g</xref>).</p>
    </sec>
  </sec>
  <sec id="Sec8">
    <title>Conclusion</title>
    <p id="Par23">The majority of disease associated variants impact non-coding regions, disrupting the function of regulatory elements such as enhancers and promoters. As enhancers regulate when and where genes are expressed, genetic variation within enhancers naturally has cell type-specific effects. However, capturing and understanding these genetic effects is an enormous challenge. Resolving these effects to specific cell types using classical quantitative trait loci (QTL) mapping would require FACS sorting different cell types from a heterogeneous tissue across a large panel of individuals, a huge task that is often impossible as specific markers for cell isolation are not available for many cell types and transitions.</p>
    <p id="Par24">To address this, we developed scDALI, a computational framework to characterize the cell-type specificity of genetic effects from single-cell sequencing data in an unbiased fashion. Our model provides a principled strategy for exploiting two independent signals that can be obtained from the same sequencing experiment, whether that is gene expression or epigenetic data: (1) total counts, which we use to derive cell types and states, and (2) allele-specific quantifications of genetic effects within genomic features such as genes or ATAC peaks of accessibility. Combining these two measurements allowed us to test for both pervasive, homogeneous imbalance and cell-state-specific heterogeneous effects, without the need to define cell types or cell states a priori.</p>
    <p id="Par25">We applied scDALI to newly generated scATAC-seq profiles from an F1 cross design, assaying dynamic and discrete changes in allele-specific chromatin accessibility of developing <italic>Drosophila melanogaster</italic> embryos, a naturally very heterogeneous sample. Our model discovers thousands of imbalanced regions, hundreds of which show distinct cell state-specific effects. About half of the regulatory regions with allelic imbalance in specific cell types are not detectable in a pseudo-bulk analysis, as opposing effects cancel out across the cell state space. Although the total number of discoveries with heterogeneous effects is relatively modest, we expect this to increase dramatically as the number of profiled cells increases. Even with the numbers profiled here, our analysis identified genetic effects at a number of characterized tissue-specific developmental enhancers. scDALI estimates allele-specific effects in individual cells, which allows dissecting this heterogeneity at different resolutions. We have shown how this map can be used to identify the underlying regulatory programs by associating differential allelic imbalance with pathway or transcription factor activity scores. Alternatively, it is possible to aggregate allelic rates at the level of known (discrete) clusters, thereby assessing the distribution of estimated allelic activity both between and within lineages or cell types. We find that developmental time is an important contributor to intra-lineage variation of allelic imbalance, pinpointing developmental stage-specific enhancers. Furthermore, our analysis revealed that allele-specific effects are significantly stronger and more common at distal elements (putative enhancers) compared to promoter-proximal regions. Notably, these differences are markedly more pronounced among peaks with heterogeneous (tissue-specific) imbalances compared to homogeneous effects, confirming and extending previous results on bulk-sequencing data [<xref ref-type="bibr" rid="CR20">20</xref>]. We then applied scDALI to a published scRNA-seq dataset from 125 human iPS cell lines and demonstrated how our model can be used to discover context-specific genetic effects of known eQTL and characterize the associated cellular subpopulations.</p>
    <p id="Par26">While our approach uncovers many novel putative enhancers, it also has its limitations. The focus of this work lies on the characterization of cell-state-specific effects for known quantitative trait loci and the mapping of genetic effects from few available individuals or even a single sample. In particular, we do not test for interactions between cell states and the presence of genetic variants, which prevents our model from discovering potential causal loci associated with cell-state-specific allelic imbalance. While in principle, it is possible to combine allelic analyses with genotype data to identify causal variants [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR11">11</xref>–<xref ref-type="bibr" rid="CR13">13</xref>], this requires larger numbers of unique genotypes. Furthermore, even for population-scale studies using single-cell sequencing, the primary interest is the characterization of known loci and not discovery of novel effects. These considerations are motivated by differences in power to detect eQTL in bulk versus single-cell data [<xref ref-type="bibr" rid="CR36">36</xref>] and the sample sizes that can currently be profiled using single-cell readouts. The required multi-individual single-cell sequencing studies are only beginning to emerge and scDALI could be extended to leverage such variation.</p>
    <p id="Par27">Understanding to what degree allele-specific effects replicate at different molecular layers remains another important direction of future research. In this study, we have demonstrated that scDALI can be flexibly applied to both single-cell RNA-seq and ATAC-seq data. However, new multi-omics methods can obtain both DNA accessibility and RNA measurements from the same single cell [<xref ref-type="bibr" rid="CR37">37</xref>]. The integration of these different dimensions of allelic imbalance across both modalities will be an important area for future work that may help to relate the functional impact of genetic variation in enhancers to their target gene’s expression.</p>
  </sec>
  <sec id="Sec9">
    <title>Methods</title>
    <sec id="Sec10">
      <title>scDALI model</title>
      <p id="Par28">scDALI extends the frequently used Beta-Binomial observation model for allele-specific read counts in bulk-sequencing data [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR20">20</xref>], by accounting for cell-state-specific effects. For a given genomic region of interest and cells <italic>i</italic> = 1, …, <italic>n</italic> let <italic>a</italic><sub><italic>i</italic></sub> be the number of reads mapping to the the maternal haplotype and <italic>d</italic><sub><italic>i</italic></sub> be the total number of reads. Furthermore, let <italic>K</italic> denote a <italic>n</italic> × <italic>n</italic> cell-state kernel matrix, capturing cell-to-cell covariances across the cell state space. Throughout our analyses, we use <italic>K</italic> = <italic>EE</italic><sup><italic>T</italic></sup> where <italic>E</italic> is a low-dimensional representation based on total read counts. For example, <italic>E</italic> can be obtained by reducing the dimensionality of the total counts matrix using principal component analysis (PCA) or a variational autoencoder model (see below) or by constructing a (one-hot-encoded) cell clustering. scDALI captures cell-state-specific allelic variation on a logit scale using a latent <italic>n</italic>-dimensional Gaussian variable:
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ u\sim N\left(1\cdotp \alpha + X\beta, {\sigma}^2K\right) $$\end{document}</tex-math><mml:math id="M2" display="block"><mml:mi>u</mml:mi><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:mrow><mml:mn>1</mml:mn><mml:mo>·</mml:mo><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="italic">Xβ</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>K</mml:mi></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par29">Here, the scalar <italic>α</italic> denotes global or <italic>homogeneous</italic> allelic imbalance, affecting all cells equally and independent of the cell state, while <italic>σ</italic><sup>2</sup> modulates the strength of cell-state-specific or <italic>heterogeneous</italic> effects. To couple <italic>u</italic> to the mean of a Beta-Binomial observation model for allelic read counts, scDALI then uses a logit link function <italic>g</italic>(<italic>x</italic>) =  <italic>log</italic> (<italic>x</italic>/(1 − <italic>x</italic>)):
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\mu}_i={g}^{-1}\left({u}_i\right) $$\end{document}</tex-math><mml:math id="M4" display="block"><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi>g</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {a}_i\mid {\mu}_i,{d}_i\sim BetaBinom\left({\theta}^{-1}{\mu}_i,{\theta}^{-1}\left(1-{\mu}_i\right)\right) $$\end{document}</tex-math><mml:math id="M6" display="block"><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mtext mathvariant="italic">BetaBinom</mml:mtext><mml:mfenced close=")" open="(" separators=","><mml:mrow><mml:msup><mml:mi>θ</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msup><mml:mi>θ</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par30">The parameter <italic>θ</italic> captures residual, extra-binomial variance (overdispersion) due to unmodeled technical and biological sources of variation. Note that by using a linear kernel function <italic>K</italic> = <italic>EE</italic><sup><italic>T</italic></sup>, we effectively cast our model as a generalized linear mixed model [<xref ref-type="bibr" rid="CR38">38</xref>] (GLMM). However, the model can in principle be extended to the non-linear case using common kernel functions from the Gaussian process literature [<xref ref-type="bibr" rid="CR39">39</xref>] or using non-linear transformations of individual cell-state dimensions.</p>
      <p id="Par31">To systematically assess homogeneous or heterogeneous allelic imbalance, scDALI implements three score tests:
<list list-type="bullet"><list-item><p id="Par32">scDALI-Het <italic>H</italic><sub>0</sub><sup><italic>Het</italic></sup> : <italic>σ</italic><sup>2</sup> = 0 <italic>vs</italic>. <italic>H</italic><sub>1</sub><sup><italic>Het</italic></sup> : <italic>σ</italic><sup>2</sup> &gt; 0 (heterogeneous imbalance)</p></list-item><list-item><p id="Par33">scDALI-Hom <italic>H</italic><sub>0</sub><sup><italic>Hom</italic></sup> : <italic>α</italic> = 0 <italic>vs</italic>. <italic>H</italic><sub>1</sub><sup><italic>Hom</italic></sup> : <italic>α</italic> ≠ 0 (homogeneous imbalance)</p></list-item><list-item><p id="Par34">scDALI-Joint <italic>H</italic><sub>0</sub><sup><italic>Joint</italic></sup> : <italic>α</italic> = 0, <italic>σ</italic><sup>2</sup> = 0 <italic>vs</italic>. <italic>H</italic><sub>1</sub><sup><italic>Joint</italic></sup> : <italic>α</italic> ≠ 0 <italic>or σ</italic><sup>2</sup> &gt; 0 (general imbalance)</p></list-item></list></p>
      <p id="Par35">By leveraging a score-based framework, scDALI avoids fitting the full GLMM model under the alternative hypotheses when evaluating the test statistics, which is computationally expensive for large data sets. The associated null models can be fitted efficiently using the Fisher scoring/Newton-Raphson. For a full derivation of the scDALI score tests, see Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Supplementary Methods.</p>
    </sec>
    <sec id="Sec11">
      <title>Allelic rate interpolation and downstream analysis</title>
      <p id="Par36">Once a set of genomic regions with significant heterogeneous allelic imbalance has been identified, scDALI can be used to estimate the landscape of allelic imbalance across the cell state space for the purpose of visualization and downstream analysis. For computational reasons, we approximate the scDALI model described above, replacing the Beta-Binomial observation model (3) with a Gaussian likelihood model for empirical rates <italic>r</italic><sub><italic>i</italic></sub> = <italic>a</italic><sub><italic>i</italic></sub>/<italic>d</italic><sub><italic>i</italic></sub>. Both model parameters (equation (1)) and posterior approximations for allelic rates can be fitted efficiently using sparse variational inference [<xref ref-type="bibr" rid="CR40">40</xref>, <xref ref-type="bibr" rid="CR41">41</xref>].</p>
      <p id="Par37">While the estimate for <italic>α</italic> provides a measure of pervasive, homogeneous allelic imbalance, we can use the posterior mean of the latent variable <italic>u</italic> as an estimate for cell-specific allelic rates. In particular, we define a measure of effect size or statistical dispersion for heterogeneous effects, <italic>Qdiff10</italic>, as the difference between the 90% and 10% quantiles of the estimated posterior mean for <italic>u</italic>.</p>
    </sec>
    <sec id="Sec12">
      <title>Guidelines for the cell state definition</title>
      <p id="Par38">An appropriate cell-state definition depends on the data as well as the research question. If differences in allelic rates between discrete cell types are of primary interest, using a one-hot encoding of the cell type clusters will maximize detection power for these effects. However, such a representation will ignore continuous, e.g., intra-cell type variation and results will depend on whether or not the cell clustering represents a biologically meaningful discretization. In some cases, a continuous representation is a natural choice, e.g., when studying differentiation or developmental time courses. As a general-purpose approach, we propose to use a lower-dimensional embedding of the total counts matrix for the detection of both continuous and discrete effects. Similar to the standard analysis of single-cell sequencing data, the choice of a particular dimensionality reduction method should be informed by a variety of factors (dataset size, need for interpretability, specific characteristics of the data modality, etc.).</p>
    </sec>
    <sec id="Sec13">
      <title>Guidelines for the control of confounding effects</title>
      <p id="Par39">In many cases, both alleles are thought to be affected similarly by technical confounders and batch effects, and consequently, these effects will cancel out when quantifying allelic rates. However, all factors that may affect <italic>rates</italic> rather than allelic counts need to be accounted for, e.g., possible individual-specific reference mapping biases in a population-scale analysis (see section Analysis of allelic imbalance in population-scale iPSC data). Nevertheless, we advise to adjust for common technical confounders (batch effects, size factors) when constructing the cell-state representation, which is typically based on total read counts.</p>
    </sec>
    <sec id="Sec14">
      <title>Cell state variational autoencoder</title>
      <p id="Par40">To infer a lower-dimensional embedding from chromatin accessibility profiles of temporally resolved scATAC-seq data, we implement a variational autoencoder model [<xref ref-type="bibr" rid="CR27">27</xref>] (VAE). Variations of VAE models have been widely applied to model single-cell transcriptome measurements [<xref ref-type="bibr" rid="CR28">28</xref>, <xref ref-type="bibr" rid="CR42">42</xref>, <xref ref-type="bibr" rid="CR43">43</xref>] and more recently been extended to model chromatin accessibility data [<xref ref-type="bibr" rid="CR44">44</xref>]. Our model is most closely related to scVI [<xref ref-type="bibr" rid="CR28">28</xref>], a VAE capable of integrating scRNA-seq data across different individuals or batches while accounting for library-size variation. However, our model differs from scVI in two notable aspects. First, we use a likelihood model tailored to the near-binary nature of single-cell ATAC-seq data. Second, we integrate sampling times for developmental datasets to estimate a continuous pseudo-temporal ordering from few available time points. The model can be decomposed into three sub-modules (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1a): the <italic>decoder network</italic>, representing the generative process for observed accessibility profiles, the <italic>temporal classifier</italic>, and the <italic>encoder network</italic> for inferring the posterior distribution over latent variables.</p>
      <p id="Par41">Let <italic>x</italic><sub><italic>i</italic></sub> ∈ {0, 1}<sup><italic>m</italic></sup> be the binarized accessibility vector for <italic>m</italic> peaks in cell <italic>i</italic> and <italic>c</italic><sub><italic>i</italic></sub> be the batch / individual identity. The probabilistic generative model underlying the decoder module is as follows:
<disp-formula id="Equa"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {z}_i\sim N\left(0,I\right) $$\end{document}</tex-math><mml:math id="M8" display="block"><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mfenced close=")" open="(" separators=","><mml:mn>0</mml:mn><mml:mi>I</mml:mi></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Equa.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equb"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {l}_i\mid {c}_i\sim LogNormal\left({\mu}_l\left({c}_i\right),{\sigma_l}^2\left({c}_i\right)\right) $$\end{document}</tex-math><mml:math id="M10" display="block"><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mtext mathvariant="italic">LogNormal</mml:mtext><mml:mfenced close=")" open="(" separators=","><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:mrow><mml:mrow><mml:msup><mml:msub><mml:mi>σ</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mn>2</mml:mn></mml:msup><mml:mfenced close=")" open="("><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Equb.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equc"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {\rho}_i={f}_{\rho}\left({z}_i,{c}_i\right) $$\end{document}</tex-math><mml:math id="M12" display="block"><mml:msub><mml:mi>ρ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>ρ</mml:mi></mml:msub><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Equc.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equd"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {x}_{ij}\mid {\rho}_{ij},{l}_i\sim Bernoulli\left(1-{\left(1-{\rho}_{ij}\right)}^{l_i}\right) $$\end{document}</tex-math><mml:math id="M14" display="block"><mml:msub><mml:mi>x</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mspace width="0.25em"/><mml:mo>∣</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mi>ρ</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mtext mathvariant="italic">Bernoulli</mml:mtext><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msup></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Equd.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par42">Here, <italic>z</italic> are the latent, low-dimensional cell state representations, and <italic>l</italic><sub><italic>i</italic></sub> is a cell-specific size-factor variable capturing variation in sequencing depth [<xref ref-type="bibr" rid="CR28">28</xref>]. The prior parameters <italic>μ</italic><sub><italic>i</italic></sub>(<italic>c</italic><sub><italic>i</italic></sub>) and <italic>σ</italic><sub><italic>l</italic></sub><sup>2</sup>(<italic>c</italic><sub><italic>i</italic></sub>) are chosen to be maximum-likelihood estimates based on the total number of reads per cell in each cross. Cell states along with observed batch ids are mapped to <italic>m</italic>-dimensional peak activities <italic>ρ</italic><sub><italic>i</italic></sub> ∈ [0, 1]<sup><italic>m</italic></sup>, ∑<sub><italic>j</italic></sub><italic>ρ</italic><sub><italic>ij</italic></sub>, representing the relative “openness” of each peak in cell <italic>i</italic>. The mapping is realized by a neural network <italic>f</italic><sub><italic>ρ</italic></sub> with trainable parameters. By providing both <italic>f</italic><sub><italic>ρ</italic></sub> and the encoder network (see section below) with <italic>c</italic><sub><italic>i</italic></sub>, the model is encouraged to disentangle batch-specific effects and cell state representations [<xref ref-type="bibr" rid="CR28">28</xref>, <xref ref-type="bibr" rid="CR45">45</xref>] (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1c). The full distribution over observed accessibility profiles is obtained by applying the scaling factor to the peak activities. If <italic>l</italic><sub><italic>i</italic></sub> were the true (discrete) number of reads per cell, <inline-formula id="IEq1"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ 1-{\left(1-{\rho}_{ij}\right)}^{l_i} $$\end{document}</tex-math><mml:math id="M16" display="inline"><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mi mathvariant="italic">ij</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msup></mml:math><inline-graphic xlink:href="13059_2021_2593_Article_IEq1.gif"/></alternatives></inline-formula> would correspond to the probability of observing at least one read in peak <italic>j</italic>. However, to simplify the inference process, we place a continuous log-normal prior on <italic>l</italic><sub><italic>i</italic></sub>.</p>
      <p id="Par43">For the <italic>Drosophila melanogaster</italic> data considered in this paper, coarse temporal information in the form of embryo collection windows is available (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1d). We integrate these time stamps with the observed ATAC-seq data to inform the latent-space inference, correct time measurement errors, and learn a continuous ordering of cells from few available labels. Assume the time label <italic>y</italic><sub><italic>i</italic></sub> for cell <italic>i</italic> takes on one of <italic>t</italic> ordered values. If <italic>t</italic> is small, it is difficult to accurately estimate the temporal scale at which cell state changes take place. Instead, we model the relative order of cells as a function of the cell state <italic>z</italic><sub><italic>i</italic></sub>, using an ordinal likelihood model. Formally, we assume <italic>y</italic><sub><italic>i</italic></sub> ∈ {1, 2, …, <italic>t</italic>} and define [<xref ref-type="bibr" rid="CR46">46</xref>]
<disp-formula id="Eque"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ p\left({y}_i\ |\ {z}_i\right)=\varPhi \left({w}_{y_i}-{f}_y\left({z}_i\right)\right)-\varPhi \left({w}_{y_i-1}-{f}_y\left({z}_i\right)\right) $$\end{document}</tex-math><mml:math id="M18" display="block"><mml:mi>p</mml:mi><mml:mfenced close=")" open="(" separators="|"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width="0.25em"/></mml:mrow><mml:mrow><mml:mspace width="0.25em"/><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>Φ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>−</mml:mo><mml:mi>Φ</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mfenced close=")" open="("><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfenced></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="13059_2021_2593_Article_Eque.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par44">where <italic>Φ</italic> denotes the cumulative distribution function of the standard normal distribution, <italic>w</italic><sub>0</sub> =  − ∞, <italic>w</italic><sub><italic>t</italic></sub> = ∞ and <italic>w</italic><sub>1</sub>, …, <italic>w</italic><sub><italic>T</italic> − 1</sub> are trainable parameters such that <italic>w</italic><sub><italic>i</italic></sub> &lt; <italic>w</italic><sub><italic>i</italic> + 1</sub>. The function <italic>f</italic><sub><italic>y</italic></sub> maps cell states to pseudo-temporal values along the real axis and is chosen to be a simple linear model. Intuitively, <italic>p</italic>(<italic>y</italic><sub><italic>i</italic></sub> | <italic>z</italic><sub><italic>i</italic></sub>) corresponds to the probability of sampling a value from the interval <inline-formula id="IEq2"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \left({w}_{y_i-1},{w}_{y_i}\right) $$\end{document}</tex-math><mml:math id="M20" display="inline"><mml:mfenced close=")" open="(" separators=","><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msub></mml:mfenced></mml:math><inline-graphic xlink:href="13059_2021_2593_Article_IEq2.gif"/></alternatives></inline-formula> under a normal distribution with mean <italic>f</italic><sub><italic>y</italic></sub>(<italic>z</italic><sub><italic>i</italic></sub>) and unit variance. By allowing for Gaussian noise around the latent time <italic>f</italic><sub><italic>y</italic></sub>(<italic>z</italic><sub><italic>i</italic></sub>), we can account for measurement errors in the labeling process. Note that the <italic>w</italic><sub><italic>i</italic></sub> form a contiguous segmentation of the real line which enforces ordinal constraints. Guided by both observed time stamps and cell state proximities, the model infers a high-resolution pseudo-temporal trajectory <italic>f</italic><sub><italic>y</italic></sub>, allowing us to order cells according to their developmental progression.</p>
      <p id="Par45">We optimize all parameters jointly using amortized variational inference [<xref ref-type="bibr" rid="CR27">27</xref>], incentivizing the model to learn a cell state representation that is informed by and supports the observed time labels (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1e). For a full description of the mathematical details of the variational approximation and practical implementation details, we refer the reader to the Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Supplementary Methods.</p>
    </sec>
    <sec id="Sec15">
      <title>Generation and sequencing of <italic>Drosophila melanogaster</italic> F1 embryos</title>
      <p id="Par46">We generated <italic>Drosophila melanogaster</italic> F1 hybrids by crossing females from a common maternal virginizer line with males from four different inbred lines from the <italic>Drosophila melanogaster</italic> genetic reference panel [<xref ref-type="bibr" rid="CR20">20</xref>, <xref ref-type="bibr" rid="CR47">47</xref>] (DGRP). Embryos were collected in 2 h windows (2–4 h, 6–8 h, and 10–12 h after egg laying) as previously described [<xref ref-type="bibr" rid="CR20">20</xref>].</p>
      <p id="Par47">Hyperactive Tn5 transposase was purified by the EMBL Protein Expression and Purification facility as previously described [<xref ref-type="bibr" rid="CR48">48</xref>] and stored at − 20 °C in storage buffer (25 mM Tris pH 7.5, 800 mM NaCl, 0.1 mM EDTA, 1 mM DTT, 50% glycerol) until use. Uniquely indexed oligonucleotides from Cusanovich et al. [<xref ref-type="bibr" rid="CR26">26</xref>] were annealed to common pMENTs oligos 95 °C 5 min, cooling to 65 °C (0.1 °C/s), 65 °C 5 min, cooling to 4 °C (0.1 °C/s)) to generate indexed transposons that were then loaded onto purified Tn5 by incubation at 23 °C with constant shaking at 350 rpm for 30 min. The loaded Tn5 transposomes were diluted 1:10 (final 0.02 mg/ml) in nuclease-free water and used immediately for tagmentation.</p>
      <p id="Par48">Embryo dissociation and nuclear isolation were performed as described previously [<xref ref-type="bibr" rid="CR26">26</xref>]. Nuclei were flash frozen in liquid nitrogen and stored at − 80 °C until use. Generation of sci-ATAC-seq libraries was performed largely as previously described [<xref ref-type="bibr" rid="CR26">26</xref>], with minor modifications. The tagmentation reaction was performed by adding 2 μL of each of the 96 custom and uniquely indexed Tn5 transposomes and by incubating at 55 °C for 1 h. After reverse-crosslinking, 5 μL of forward and reverse indexed primers (from Cusanovich et al. [<xref ref-type="bibr" rid="CR26">26</xref>]), 7.5 μL KAPA HiFi DNA Polymerase ReadyMix (Roche) and 0.25 μL Bst3.0 (NEB) were added to each well. Tagmented DNA was then PCR amplified with the following cycling conditions: 72 °C 5 min, 98 °C 30 s; 98 °C 10 s, 63 °C 30 s, 19–22 cycles; 72 °C 1 min, hold at 10 °C. The optimal number of cycles for each library was determined beforehand by monitoring amplification on a qPCR machine for a set of test wells. Libraries were sequenced on an Illumina NextSeq 500 sequencer High Capacity 150 PE kit as previously described [<xref ref-type="bibr" rid="CR26">26</xref>].</p>
    </sec>
    <sec id="Sec16">
      <title>Processing of raw sci-ATAC sequencing data</title>
      <p id="Par49">Raw sequencing data was processed based on the pipeline (<ext-link ext-link-type="uri" xlink:href="https://github.com/shendurelab/fly-atac/">https://github.com/shendurelab/fly-atac/</ext-link>) developed by Cusanovich et al. [<xref ref-type="bibr" rid="CR26">26</xref>]. BCL files were converted to fastq files using bcl2fastq v.2.16 (Illumina). To correct for sequencing or PCR amplification errors, read barcodes were matched against all possible barcodes. In case of an approximate match (Levenshtein distance &lt; 3 and distance to next best match &gt; 2), the corresponding barcodes were fixed to their presumptive match; all other barcodes were classified as ambiguous or unknown. Barcode correction was followed by adapter trimming [<xref ref-type="bibr" rid="CR49">49</xref>] and read alignment to the dm6 reference genome using bowtie [<xref ref-type="bibr" rid="CR50">50</xref>] (with options -X 2000 -3 1). After the removal of PCR duplicates, we classified barcodes corresponding to genuine cells from the background by fitting a two-component Gaussian mixture model to the log-transformed read counts per barcode. A cutoff for cell barcodes was determined by requiring that the posterior probability of belonging to the higher read-depth mixing component was greater than 0.95 (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S6b, c).</p>
      <p id="Par50">Chromatin accessibility was quantified in a set of 53,133 peaks of accessibility previously identified from a time-matched sci-ATAC-seq dataset [<xref ref-type="bibr" rid="CR26">26</xref>] and lifted to the dm6 reference genome (https://github.com/FlyBase/bulkfile-scripts). We compared the Pearson correlation between pseudo-bulk aggregates for each collection window both within our dataset as well as between our data and the published reference (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7). Next, we restricted our analysis to autosomes in order to remove sex-specific biases [<xref ref-type="bibr" rid="CR26">26</xref>]. For each cross and collection window, we determined the 10% and 99% quantiles of the cell-count distribution and only kept cells whose counts were within those limits, resulting in 35,485 cells in total. Finally, we selected the 25,000 top most accessible peaks for further analysis. We trained the cell state variational autoencoder on the whole dataset for 30 epochs. Additionally, we generated alternative representations for data from cross F1-DGRP-712 using LSI [<xref ref-type="bibr" rid="CR26">26</xref>] (leading components 2 to 20; the first component was excluded due to correlation with total counts per cell) and cisTopic [<xref ref-type="bibr" rid="CR31">31</xref>] (50 topics). These embeddings were only used to assess the robustness of the scDALI workflow to different cell state representations (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S10).</p>
      <p id="Par51">We used the Scanpy implementation of the Leiden algorithm [<xref ref-type="bibr" rid="CR29">29</xref>, <xref ref-type="bibr" rid="CR30">30</xref>] with a resolution of 1.2 and identified 28 cell clusters in the joint VAE latent space. For each cluster, we computed differentially accessible peaks using logistic regression by predicting cluster labels from the relative peak activity profiles obtained from the VAE model [<xref ref-type="bibr" rid="CR30">30</xref>, <xref ref-type="bibr" rid="CR51">51</xref>]. We then performed an enrichment analysis for known tissue specific enhancer elements (CAD4 database [<xref ref-type="bibr" rid="CR26">26</xref>] and genes (tissue-specific expression of the nearest gene based on in situ hybridization data from the Berkeley <italic>Drosophila</italic> Genome Project (<ext-link ext-link-type="uri" xlink:href="http://insitu.fruitfly.org/cgi-bin/ex/insitu.pl">http://insitu.fruitfly.org/cgi-bin/ex/insitu.pl</ext-link>) and FlyBase gene expression annotations (<ext-link ext-link-type="uri" xlink:href="http://flybase.org/">http://flybase.org/</ext-link>) using a Fisher’s exact test. Based on these enrichments, each cluster was assigned to one of seven major lineages (Fig. <xref rid="Fig2" ref-type="fig">2b</xref>). Four clusters with a total of 1432 cells could not be annotated unambiguously and were removed from further analysis (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>), resulting in a final set of 35,485 cells (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1d).</p>
    </sec>
    <sec id="Sec17">
      <title>Processing of allele-specific sci-ATAC counts</title>
      <p id="Par52">We used existing genotyping information [<xref ref-type="bibr" rid="CR20">20</xref>] for the parental strains to create cross-specific VCF files, filtering for genetic variants that were heterozygous in the F1 generation. To eliminate reference mapping biases, we applied the WASP pipeline [<xref ref-type="bibr" rid="CR13">13</xref>] (<ext-link ext-link-type="uri" xlink:href="https://github.com/bmvdgeijn/WASP/tree/master/mapping">https://github.com/bmvdgeijn/WASP/tree/master/mapping</ext-link>) and created filtered BAM files, removing between 7 and 8% of mapped reads (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8a) from the original alignment. For each of the 35,485 cells, we then quantified allele-specific accessibility by adapting the original WASP code for count generation to single-cell sequencing (<ext-link ext-link-type="uri" xlink:href="https://github.com/tohein/scai_utils">https://github.com/tohein/scai_utils</ext-link>). As features, we chose 1 kb windows centered on each of the 53,133 peaks to mitigate the inherent sparsity of the data. Reads aligned within these windows were assigned to either allele, requiring that each read overlapped at least one heterozygous single-nucleotide variant. If a read overlapped multiple variants, one was chosen at random to determine the allele of origin. As it can be challenging to accurately estimate the allelic base rate for sex chromosomes (that is, the overall proportion of female embryos), we excluded these from our analysis. Finally, windows in each cross were filtered by requiring that the mean allelic total count (that is, the sum of reads that could be assigned to either allele) across cells was no smaller than 0.1 (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8d). This resulted in between 8040 and 12,861 peaks per cross and a combined set of 39,530 peaks to be tested for allelic imbalance (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8e).</p>
    </sec>
    <sec id="Sec18">
      <title>scDALI analysis of <italic>Drosophila melanogaster</italic> sci-ATAC data</title>
      <p id="Par53">We applied scDALI to all of the 39,530 peaks to test for heterogeneous (scDALI-Het), homogeneous (scDALI-Hom) and either kind of allelic imbalance (scDALI-Joint). Both scDALI-Het and scDALI-Joint used the 8-dimensional VAE latent space embedding as a cell state representation and a linear kernel function. <italic>P</italic>-values from each test were Benjamini-Hochberg adjusted to control the false discovery rate [<xref ref-type="bibr" rid="CR52">52</xref>] (FDR). For each of the 415 sites with evidence for cell state-specific allelic imbalance (scDALI-Het <italic>P</italic> &lt; 0.1 FDR), we estimated allelic rates using scDALI. Depending on the number of covered cells for each peak, all models were trained with a maximum of 1000 inducing points.</p>
      <p id="Par54">To compute transcription factor activity scores, deviations in accessibility were calculated with chromVAR v1.10.0 [<xref ref-type="bibr" rid="CR32">32</xref>] for a set of 65 curated <italic>Drosophila</italic> motifs from [<xref ref-type="bibr" rid="CR4">4</xref>]. The <italic>Z</italic>-score corrected deviations were used to calculate the Pearson correlation with the estimated allelic rates.</p>
      <p id="Par55">To identify variable lineages for each of the 415 peaks with heterogeneous imbalance, we used scDALI-Het with lineage-specific cell state kernels. Specifically, for each lineage we used a block diagonal kernel matrix, where entry <italic>i</italic>, <italic>j</italic> was set to 1 if both cells <italic>i</italic> and <italic>j</italic> were associated with that lineage and 0 otherwise. This allowed us to test for differences in the mean allelic rate for a particular lineage compared to the mean of all other cells. The combined <italic>P</italic>-values for all lineages were adjusted for multiple testing using the Benjamini-Hochberg correction [<xref ref-type="bibr" rid="CR52">52</xref>].</p>
      <p id="Par56">Lastly, we employed scDALI-Het to test for changes in allelic imbalance across development in the muscle lineage using the temporal ordering inferred by the VAE model. To capture non-linear effects, we applied a polynomial basis transform. Specifically, we constructed a matrix <italic>E</italic><sub><italic>Time</italic></sub> with entries (<italic>E</italic><sub><italic>Time</italic></sub>)<sub><italic>ij</italic></sub> = <italic>t</italic><sub><italic>i</italic></sub><sup><italic>j</italic> − 1</sup>, <italic>j</italic> ∈ {1, 2, 3}, where <italic>t</italic><sub><italic>i</italic></sub> ∈ [0, 1] denotes the estimated time for cell <italic>i</italic> in the muscle lineage. We then applied scDALI assuming a linear cell-state kernel <italic>K</italic> = <italic>E</italic><sub><italic>Time</italic></sub><italic>E</italic><sub><italic>Time</italic></sub><sup><italic>T</italic></sup>. <italic>P</italic>-values were adjusted using the Benjamini-Hochberg correction [<xref ref-type="bibr" rid="CR52">52</xref>].</p>
    </sec>
    <sec id="Sec19">
      <title>Evaluation of scDALI on simulated data</title>
      <p id="Par57">We simulated allele-specific counts from the scDALI model (Eq. (1–3)) using observed allelic total counts and inferred cell state representations (VAE embedding and Leiden clusters derived from the VAE embedding) from real sci-ATAC-seq data of developing <italic>Drosophila melanogaster</italic> embryos (cross F1-DGRP-712). All simulations kernels were linear, that is <italic>K</italic><sub><italic>VAE</italic></sub> = <italic>E</italic><sub><italic>VAE</italic></sub><italic>E</italic><sub><italic>VAE</italic></sub><sup><italic>T</italic></sup> and <italic>K</italic><sub><italic>Cluster</italic></sub> = <italic>E</italic><sub><italic>Cluster</italic></sub><italic>E</italic><sub><italic>Cluster</italic></sub><sup><italic>T</italic></sup> where <italic>E</italic><sub><italic>VAE</italic></sub> and <italic>E</italic><sub><italic>Cluster</italic></sub> denote the 8-dimensional VAE embedding and one-hot encoding of 24 Leiden clusters, respectively.</p>
      <p id="Par58">We assessed the degree of extra-binomial variation present in the data, by fitting a basic Beta-Binomial model to the observed allele-specific counts (10,220 cells and 12,861 peaks) using no additional cell state information (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1a). Based on the histogram of estimated values, we ran all simulations at two different levels of overdispersion <italic>θ</italic> ∈ {2, 5}.</p>
      <p id="Par59">We first assessed the calibration of scDALI when testing for heterogeneous effects (scDALI-Het). As scDALI is intended to leverage multi-dimensional cell-state representations, we analyzed the effect of testing an increasing number of cell-state dimensions for different numbers of cells. We considered two baseline candidates: a one-way ANOVA test, comparing allelic rates between cell clusters as well as a linear model incorporating cell-state covariates as fixed effects (likelihood-ratio test, OLS-LRT). Both alternatives were fitted to empirical allelic rates. All three tests used the observed Leiden clustering as a cell-state representation. We simulated data from a model assuming no heterogeneous imbalance, varying the number of clusters (cell-state dimensions) while keeping the number of simulated cells constant. We considered four different sample sizes: 250, 500, 1000, and 5000 cells per peak with non-zero allelic measurements. All experiments were performed for 1000 peaks. We computed the average inflation factor <italic>log</italic><sub>10</sub>(<italic>median P</italic>)/<italic>log</italic><sub>10</sub>(0.5) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1d) across 25 different random initializations, finding the OLS-LRT to produce inflated <italic>p</italic>-values for a large number of cell-state dimensions relative to the sample size. This is consistent with results on multiple-degrees-of-freedom tests reported previously [<xref ref-type="bibr" rid="CR21">21</xref>]. We therefore excluded the OLS-LRT from further simulation experiments.</p>
      <p id="Par60">We verified the uniform distribution of <italic>p</italic>-values for all three scDALI models and the one-way ANOVA when simulating data from their respective null models (1000 peaks and 5000 cells randomly sampled from the full data), considering different levels of pervasive (cell state independent) effects (<italic>α</italic> ∼ <italic>N</italic>(0, <italic>ν</italic><sup>2</sup>), where <italic>ν</italic><sup>2</sup> ∈ {0, 0.01, 0.05, 0.1}; Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1b, c). Here, all models used the 8-dimensional VAE embedding as a cell-state representation. Additionally, we show that a modified version of scDALI-Het using a Binomial (rather than Beta-Binomial) likelihood model will lead to false positive results at relevant levels of overdispersion.</p>
      <p id="Par61">We compared power to detect homogeneous vs. heterogeneous effects for scDALI-Het, scDALI-Hom and scDALI-Joint (Fig. <xref rid="Fig1" ref-type="fig">1c</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S3a). Let <italic>ρ</italic> ∈ {0, 0.2, 0.4, 0.6, 0.8, 1} denote the relative extent of heterogeneous imbalance and <italic>ν</italic><sup>2</sup> ∈ { 0.01, 0.05, 0.1} the total variance explained by allele-specific effects (both heterogeneous and homogeneous). We simulated data from the scDALI model (Eq. (1–3)), where <italic>α</italic> ∼ <italic>N</italic>(0, <italic>ρ</italic> · <italic>ν</italic><sup>2</sup>) and <italic>σ</italic><sup>2</sup> = (1 − <italic>ρ</italic>) · <italic>ν</italic><sup>2</sup>, using observed total counts and cell-state representations for 5000 cells and 1000 ATAC peaks randomly chosen from the observed data. All three models as well as the simulation procedure were run using the 8-dimensional VAE embedding as a cell-state representation. Statistical power was calculated as the fraction of simulated regions discovered at an <italic>α</italic>-level of 0.05 and averaged across 25 random seeds.</p>
      <p id="Par62">Lastly, we assessed power to detect discrete vs. continuous heterogeneous effects, using a weighted combination of the VAE and Leiden cluster kernels
<disp-formula id="Equf"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ K=\eta {K}_{Cluster}+\left(1-\eta \right){K}_{VAE} $$\end{document}</tex-math><mml:math id="M22" display="block"><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mi>η</mml:mi><mml:msub><mml:mi>K</mml:mi><mml:mtext mathvariant="italic">Cluster</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:mfenced close=")" open="("><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>η</mml:mi></mml:mrow></mml:mfenced><mml:msub><mml:mi>K</mml:mi><mml:mi mathvariant="italic">VAE</mml:mi></mml:msub></mml:math><graphic xlink:href="13059_2021_2593_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par63">In this scenario we assumed no additional homogeneous effects (<italic>α</italic> = 0) and considered a range of weights <italic>η</italic> and kernel scaling parameters. (<italic>η</italic> ∈ {0, 0.2, 0.4, 0.6, 0.8, 1} and <italic>σ</italic><sup>2</sup> ∈ {0.1, 0.05, 0.1}, Fig. <xref rid="Fig1" ref-type="fig">1d</xref>, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S3b). Compared were scDALI-Het using the VAE representation vs. a one-way ANOVA model based on the discrete Leiden clusters. As above, we simulated data for 5000 cells and 1000 peaks and averaged power estimates across 25 random initializations.</p>
    </sec>
    <sec id="Sec20">
      <title>Analysis of allelic imbalance in population-scale iPSC data</title>
      <p id="Par64">Total gene expression counts for all genes and allele-specific quantifications for 4470 previously identified SNP-gene pairs (4422 eQTL lead variants) were obtained as described in the primary publication [<xref ref-type="bibr" rid="CR5">5</xref>]. Briefly, reads were initially mapped to reference and alternative alleles for each heterozygous SNP in every cell and subsequently assigned relative to the genotype of each chromosome using known phasing information. Allele-specific read counts were aggregated at the gene level, by summing up the counts for each SNPs contained in exonic regions. Finally, for each eQTL (gene-SNP pair), gene-level allele-specific counts were interpreted relative to the eQTL variant to obtain a consistent definition of ASE across cells from different donors that were heterozygous for that variant. SNP-gene pairs were filtered by requiring at least 50 cells with nonzero allele-specific counts, leading to 3966 pairs to be tested using scDALI. We performed principal component analysis (PCA) of total gene expression counts from 34,254 cells and used the leading <italic>k</italic> principal components (PCs) and a linear kernel function to define cell state kernels. We chose <italic>k</italic> = 1 to focus on time-specific allelic imbalance (see also Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1) while <italic>k</italic> = 10 was used to model more general cell-state effects.</p>
      <p id="Par65">To assess the effect of donor-specific effects on heterogeneous allele-specific expression, we permuted the leading 10 PC coordinates among cells from the same donor. We then compared two implementations of scDALI-Het that either did or did not account for the donor background using a one-hot-encoded representation of the donor identities for each cell as an additional covariate matrix. Additionally, we compared the difference in the number of discoveries for each model when using cell-state kernels based on 1, 2, 3, 4, 5, 10, 15, and 20 (unpermuted) PCs.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec21">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2021_2593_MOESM1_ESM.pdf">
            <caption>
              <p>
                <bold>Additional file 1: Supplementary Information and Figures.</bold>
              </p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2021_2593_MOESM2_ESM.pdf">
            <caption>
              <p>
                <bold>Additional file 2: Supplementary Methods.</bold>
              </p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="13059_2021_2593_MOESM3_ESM.xlsx">
            <caption>
              <p>
                <bold>Additional file 3: Supplementary Table S1.</bold>
              </p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM4">
          <media xlink:href="13059_2021_2593_MOESM4_ESM.docx">
            <caption>
              <p><bold>Additional file 4.</bold> Review history.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Tobias Heinen and Stefano Secchia contributed equally.</p>
    </fn>
  </fn-group>
  <ack>
    <title>Acknowledgements</title>
    <p>The authors thank members of the Furlong and Stegle labs for helpful comments and discussions. This work was technically supported by the EMBL Flow Cytometry, Genomics and Protein Expression and Purification Core Facilities.</p>
    <sec id="FPar1">
      <title>Review history</title>
      <p id="Par66">The review history is available as Additional file <xref rid="MOESM4" ref-type="media">4</xref>.</p>
    </sec>
    <sec id="FPar2">
      <title>Peer review information</title>
      <p id="Par67">Barbara Cheifet was the primary editor of this article and managed its editorial process and peer review in collaboration with the rest of the editorial team.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>T.H. developed and implemented scDALI. T.H. and S.S. analyzed data and generated figures. S.S. adapted the sciATAC-seq protocol with advice from J.R., and S.S. and J.R. generated the sciATAC-seq data. B.Z. collected the F1 embryos. T.H., S.S., E.F., and O.S. interpreted the results and wrote the manuscript with input from all authors. E.F. and O.S. conceptualized, supervised, and funded the project. The authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>T.H. received support from the German Cancer Research Center International PhD Program. This work was financially supported by core funding from EMBL (to E.E.F. and O.S), the German Cancer Research Center (O.S.), and the European Research Council (ERC) grant agreement ID: 787611 (DeCRyPT) to E.E.F and grant agreement ID: 810296 (DECODE) to O.S. Open Access funding enabled and organized by Projekt DEAL.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>All raw sequencing data from the <italic>Drosophila</italic> F1 study have been submitted to the EMBL-EBI ArrayExpress database (<ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/arrayexpress/">https://www.ebi.ac.uk/arrayexpress/</ext-link>) and are available under accession number E-MTAB-10240 [<xref ref-type="bibr" rid="CR53">53</xref>]. Processed data, including the sciATAC peaks per genotype and stage, can all be downloaded from <ext-link ext-link-type="uri" xlink:href="http://furlonglab.embl.de/data">http://furlonglab.embl.de/data</ext-link>. The processed iPSC scRNA-seq data is available on zenodo (<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/3625024#.YcM1GS8w0eb">https://zenodo.org/record/3625024#.YcM1GS8w0eb</ext-link>) and all HipSci genotyping data can be accessed under <ext-link ext-link-type="uri" xlink:href="http://www.hipsci.org">http://www.hipsci.org</ext-link>. A Python implementation of the scDALI framework including the VAE model for cell state inference is available under the BSD-3 license from <ext-link ext-link-type="uri" xlink:href="https://github.com/PMBio/scdali">https://github.com/PMBio/scdali</ext-link> [<xref ref-type="bibr" rid="CR54">54</xref>]. Code to reproduce the specific analyses is available from <ext-link ext-link-type="uri" xlink:href="https://github.com/PMBio/scdali_analyses">https://github.com/PMBio/scdali_analyses</ext-link> and was deposited on zenodo (<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/5710797">https://zenodo.org/record/5710797</ext-link>) [<xref ref-type="bibr" rid="CR55">55</xref>].</p>
  </notes>
  <notes>
    <title>Declarations</title>
    <notes id="FPar3">
      <title>Ethics approval and consent to participate</title>
      <p id="Par68">Not applicable.</p>
    </notes>
    <notes id="FPar4">
      <title>Consent for publication</title>
      <p id="Par69">Not applicable.</p>
    </notes>
    <notes id="FPar5" notes-type="COI-statement">
      <title>Competing interests</title>
      <p id="Par70">The authors declare no competing interests.</p>
    </notes>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Li</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Tsang</surname>
            <given-names>EK</given-names>
          </name>
          <name>
            <surname>Davis</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Damani</surname>
            <given-names>FN</given-names>
          </name>
          <name>
            <surname>Chiang</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The impact of rare variation on gene expression across tissues</article-title>
        <source>Nature.</source>
        <year>2017</year>
        <volume>550</volume>
        <fpage>239</fpage>
        <lpage>243</lpage>
        <?supplied-pmid 29022581?>
        <pub-id pub-id-type="pmid">29022581</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <mixed-citation publication-type="other">Ferraro NM, Strober BJ, Einson J, Abell NS, Aguet F, Barbeira AN, et al. Transcriptomic signatures across human tissues identify functional rare genetic variation. Science. 2020;369:eaaz5900.</mixed-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <collab>GTEx Consortium</collab>
        </person-group>
        <article-title>The GTEx Consortium atlas of genetic regulatory effects across human tissues</article-title>
        <source>Science</source>
        <year>2020</year>
        <volume>369</volume>
        <fpage>1318</fpage>
        <lpage>1330</lpage>
        <pub-id pub-id-type="pmid">32913098</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cannavò</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Koelling</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Harnett</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Garfield</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Casale</surname>
            <given-names>FP</given-names>
          </name>
          <name>
            <surname>Ciglar</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Genetic variants regulating expression levels and isoform diversity during embryogenesis</article-title>
        <source>Nature.</source>
        <year>2017</year>
        <volume>541</volume>
        <fpage>402</fpage>
        <lpage>406</lpage>
        <?supplied-pmid 28024300?>
        <pub-id pub-id-type="pmid">28024300</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cuomo</surname>
            <given-names>ASE</given-names>
          </name>
          <name>
            <surname>Seaton</surname>
            <given-names>DD</given-names>
          </name>
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Martinez</surname>
            <given-names>I</given-names>
          </name>
          <name>
            <surname>Bonder</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Garcia-Bernardo</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA-sequencing of differentiating iPS cells reveals dynamic genetic effects on gene expression</article-title>
        <source>Nat Commun</source>
        <year>2020</year>
        <volume>11</volume>
        <fpage>810</fpage>
        <?supplied-pmid 32041960?>
        <pub-id pub-id-type="pmid">32041960</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jerber</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Seaton</surname>
            <given-names>DD</given-names>
          </name>
          <name>
            <surname>Cuomo</surname>
            <given-names>ASE</given-names>
          </name>
          <name>
            <surname>Kumasaka</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Haldane</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Steer</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Population-scale single-cell RNA-seq profiling across dopaminergic neuron differentiation</article-title>
        <source>Nat Genet</source>
        <year>2021</year>
        <volume>53</volume>
        <fpage>304</fpage>
        <lpage>312</lpage>
        <?supplied-pmid 33664506?>
        <pub-id pub-id-type="pmid">33664506</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Kumasaka N, Rostom R, Huang N, Polanski K, Meyer K. Mapping interindividual dynamics of innate immune response at single-cell resolution. bioRxiv [Internet]. bioRxiv. 2021. Available from: 10.1101/2021.09.01.457774</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <mixed-citation publication-type="other">Benaglio P, Newsome J, Han JY, Chiou J, Aylward A, Corban S, et al. Mapping genetic effects on cell type-specific chromatin accessibility and annotating complex trait variants using single nucleus ATAC-seq [Internet]. bioRxiv. 2020. Available from: 10.1101/2020.12.03.387894</mixed-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kumasaka</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Knights</surname>
            <given-names>AJ</given-names>
          </name>
          <name>
            <surname>Gaffney</surname>
            <given-names>DJ</given-names>
          </name>
        </person-group>
        <article-title>Fine-mapping cellular QTLs with RASQUAL and ATAC-seq</article-title>
        <source>Nat Genet</source>
        <year>2016</year>
        <volume>48</volume>
        <fpage>206</fpage>
        <lpage>213</lpage>
        <?supplied-pmid 26656845?>
        <pub-id pub-id-type="pmid">26656845</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Cuomo ASE, Heinen T, Vagiaki D, Horta D, Marioni JC, Stegle O. CellRegMap: a statistical framework for mapping context-specific regulatory variants using scRNA-seq [Internet]. bioRxiv. 2021. Available from: 10.1101/2021.09.01.458524</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Knowles</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Davis</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Edgington</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Raj</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Favé</surname>
            <given-names>M-J</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Allele-specific expression reveals interactions between genetic variation and environment</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>699</fpage>
        <lpage>702</lpage>
        <?supplied-pmid 28530654?>
        <pub-id pub-id-type="pmid">28530654</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>A statistical framework for eQTL mapping using RNA-seq data</article-title>
        <source>Biometrics Wiley</source>
        <year>2012</year>
        <volume>68</volume>
        <fpage>1</fpage>
        <lpage>11</lpage>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van de Geijn</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>McVicker</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Gilad</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Pritchard</surname>
            <given-names>JK</given-names>
          </name>
        </person-group>
        <article-title>WASP: allele-specific software for robust molecular quantitative trait locus discovery</article-title>
        <source>Nat Methods</source>
        <year>2015</year>
        <volume>12</volume>
        <fpage>1061</fpage>
        <lpage>1063</lpage>
        <?supplied-pmid 26366987?>
        <pub-id pub-id-type="pmid">26366987</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mohammadi</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Castel</surname>
            <given-names>SE</given-names>
          </name>
          <name>
            <surname>Brown</surname>
            <given-names>AA</given-names>
          </name>
          <name>
            <surname>Lappalainen</surname>
            <given-names>T</given-names>
          </name>
        </person-group>
        <article-title>Quantifying the regulatory effect size of cis-acting genetic variation using allelic fold change</article-title>
        <source>Genome Res</source>
        <year>2017</year>
        <volume>27</volume>
        <fpage>1872</fpage>
        <lpage>1884</lpage>
        <?supplied-pmid 29021289?>
        <pub-id pub-id-type="pmid">29021289</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Allele-specific single-cell RNA sequencing reveals different architectures of intrinsic and extrinsic gene expression noises</article-title>
        <source>Nucleic Acids Res</source>
        <year>2020</year>
        <volume>48</volume>
        <fpage>533</fpage>
        <lpage>547</lpage>
        <?supplied-pmid 31799601?>
        <pub-id pub-id-type="pmid">31799601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>NR</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>SCALE: modeling allele-specific gene expression by single-cell RNA sequencing</article-title>
        <source>Genome Biol</source>
        <year>2017</year>
        <volume>18</volume>
        <fpage>74</fpage>
        <?supplied-pmid 28446220?>
        <pub-id pub-id-type="pmid">28446220</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Fan J, Wang X, Xiao R, Li M. Detecting cell-type-specific allelic expression imbalance by integrative analysis of bulk and single-cell RNA sequencing data. PLoS Genet. 2021;17:e1009080.</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Lareau</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Andreani</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Vinyard</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Garcia</surname>
            <given-names>SP</given-names>
          </name>
          <name>
            <surname>Clement</surname>
            <given-names>K</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Assessment of computational methods for the analysis of single-cell ATAC-seq data</article-title>
        <source>Genome Biol</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>241</fpage>
        <?supplied-pmid 31739806?>
        <pub-id pub-id-type="pmid">31739806</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saelens</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cannoodt</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Todorov</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>A comparison of single-cell trajectory inference methods</article-title>
        <source>Nat Biotechnol</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>547</fpage>
        <lpage>554</lpage>
        <?supplied-pmid 30936559?>
        <pub-id pub-id-type="pmid">30936559</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Floc’hlay S, Wong E, Zhao B, Viales RR, Thomas-Chollier M, Thieffry D, et al. Cis-acting variation is common across regulatory layers but is often buffered during embryonic development. Genome Res. 2021;31:211-224.</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moore</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Casale</surname>
            <given-names>FP</given-names>
          </name>
          <name>
            <surname>Jan Bonder</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Horta</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>BIOS Consortium, Franke L, et al. A linear mixed-model approach to study multivariate gene-environment interactions</article-title>
        <source>Nat Genet</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>180</fpage>
        <lpage>186</lpage>
        <?supplied-pmid 30478441?>
        <pub-id pub-id-type="pmid">30478441</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Svensson</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>SpatialDE: identification of spatially variable genes</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>343</fpage>
        <lpage>346</lpage>
        <?supplied-pmid 29553579?>
        <pub-id pub-id-type="pmid">29553579</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Buettner</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Natarajan</surname>
            <given-names>KN</given-names>
          </name>
          <name>
            <surname>Casale</surname>
            <given-names>FP</given-names>
          </name>
          <name>
            <surname>Proserpio</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Scialdone</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Computational analysis of cell-to-cell heterogeneity in single-cell RNA-sequencing data reveals hidden subpopulations of cells</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>155</fpage>
        <lpage>160</lpage>
        <?supplied-pmid 25599176?>
        <pub-id pub-id-type="pmid">25599176</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Variance component testing in generalised linear models with random effects</article-title>
        <source>Biometrika</source>
        <year>1997</year>
        <volume>84</volume>
        <fpage>309</fpage>
        <lpage>326</lpage>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Hypothesis testing in semiparametric additive mixed models</article-title>
        <source>Biostatistics.</source>
        <year>2003</year>
        <volume>4</volume>
        <fpage>57</fpage>
        <lpage>74</lpage>
        <?supplied-pmid 12925330?>
        <pub-id pub-id-type="pmid">12925330</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cusanovich</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Reddington</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Garfield</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Daza</surname>
            <given-names>RM</given-names>
          </name>
          <name>
            <surname>Aghamirzaie</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Marco-Ferreres</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The cis-regulatory dynamics of embryonic development at single-cell resolution</article-title>
        <source>Nature.</source>
        <year>2018</year>
        <volume>555</volume>
        <fpage>538</fpage>
        <lpage>542</lpage>
        <?supplied-pmid 29539636?>
        <pub-id pub-id-type="pmid">29539636</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Kingma DP, Welling M. Auto-encoding variational Bayes [Internet]. arXiv [stat.ML]. 2013. Available from: <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1312.6114v10">http://arxiv.org/abs/1312.6114v10</ext-link></mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <?supplied-pmid 6289068?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Traag</surname>
            <given-names>VA</given-names>
          </name>
          <name>
            <surname>Waltman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Eck</surname>
            <given-names>NJ</given-names>
          </name>
        </person-group>
        <article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title>
        <source>Sci Rep</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>5233</fpage>
        <?supplied-pmid 30914743?>
        <pub-id pub-id-type="pmid">30914743</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <?supplied-pmid 29409532?>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>González-Blas</surname>
            <given-names>CB</given-names>
          </name>
          <name>
            <surname>Minnoye</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Papasokrati</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Aibar</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hulselmans</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Christiaens</surname>
            <given-names>V</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>cisTopic: cis-regulatory topic modeling on single-cell ATAC-seq data</article-title>
        <source>Nat Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>397</fpage>
        <lpage>400</lpage>
        <pub-id pub-id-type="pmid">30962623</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schep</surname>
            <given-names>AN</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Buenrostro</surname>
            <given-names>JD</given-names>
          </name>
          <name>
            <surname>Greenleaf</surname>
            <given-names>WJ</given-names>
          </name>
        </person-group>
        <article-title>chromVAR: inferring transcription-factor-associated accessibility from single-cell epigenomic data</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>975</fpage>
        <lpage>978</lpage>
        <?supplied-pmid 28825706?>
        <pub-id pub-id-type="pmid">28825706</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Reddington</surname>
            <given-names>JP</given-names>
          </name>
          <name>
            <surname>Garfield</surname>
            <given-names>DA</given-names>
          </name>
          <name>
            <surname>Sigalova</surname>
            <given-names>OM</given-names>
          </name>
          <name>
            <surname>Karabacak Calviello</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Marco-Ferreres</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Girardot</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Lineage-resolved enhancer and promoter usage during a time course of embryogenesis</article-title>
        <source>Dev Cell</source>
        <year>2020</year>
        <volume>55</volume>
        <fpage>648</fpage>
        <lpage>64.e9</lpage>
        <?supplied-pmid 33171098?>
        <pub-id pub-id-type="pmid">33171098</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Picelli</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Faridani</surname>
            <given-names>OR</given-names>
          </name>
          <name>
            <surname>Björklund</surname>
            <given-names>AK</given-names>
          </name>
          <name>
            <surname>Winberg</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Sagasser</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Sandberg</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Full-length RNA-seq from single cells using Smart-seq2</article-title>
        <source>Nat Protoc</source>
        <year>2014</year>
        <volume>9</volume>
        <fpage>171</fpage>
        <lpage>181</lpage>
        <?supplied-pmid 24385147?>
        <pub-id pub-id-type="pmid">24385147</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Park</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Yoo</surname>
            <given-names>JC</given-names>
          </name>
          <name>
            <surname>Ryu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hong</surname>
            <given-names>S-G</given-names>
          </name>
          <name>
            <surname>Hwang</surname>
            <given-names>EM</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>J-Y</given-names>
          </name>
        </person-group>
        <article-title>Copine1 enhances neuronal differentiation of the hippocampal progenitor HiB5 cells</article-title>
        <source>Mol Cells</source>
        <year>2012</year>
        <volume>34</volume>
        <fpage>549</fpage>
        <lpage>554</lpage>
        <?supplied-pmid 23263657?>
        <pub-id pub-id-type="pmid">23263657</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cuomo</surname>
            <given-names>ASE</given-names>
          </name>
          <name>
            <surname>Alvari</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Azodi</surname>
            <given-names>CB</given-names>
          </name>
          <name>
            <surname>single-cell eQTLGen consortium, McCarthy DJ, Bonder MJ.</surname>
          </name>
        </person-group>
        <article-title>Optimizing expression quantitative trait locus mapping workflows for single-cell studies</article-title>
        <source>Genome Biol</source>
        <year>2021</year>
        <volume>22</volume>
        <fpage>188</fpage>
        <?supplied-pmid 34167583?>
        <pub-id pub-id-type="pmid">34167583</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ma</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>LaFave</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Earl</surname>
            <given-names>AS</given-names>
          </name>
          <name>
            <surname>Chiang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Chromatin potential identified by shared single-cell profiling of RNA and chromatin</article-title>
        <source>Cell.</source>
        <year>2020</year>
        <volume>183</volume>
        <fpage>1103</fpage>
        <lpage>16.e20</lpage>
        <?supplied-pmid 33098772?>
        <pub-id pub-id-type="pmid">33098772</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">McCulloch CE, Searle SR. Generalized, linear, and mixed models. New Jersey: Wiley; 2004.</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Rasmussen</surname>
            <given-names>CE</given-names>
          </name>
        </person-group>
        <person-group person-group-type="editor">
          <name>
            <surname>Bousquet</surname>
            <given-names>O</given-names>
          </name>
          <name>
            <surname>von Luxburg</surname>
            <given-names>U</given-names>
          </name>
          <name>
            <surname>Rätsch</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Gaussian Processes in Machine Learning</article-title>
        <source>Advanced lectures on machine learning: ML Summer Schools 2003, Canberra, Australia, February 2 - 14, 2003, Tübingen, Germany, August 4 - 16, 2003, Revised Lectures</source>
        <year>2004</year>
        <publisher-loc>Berlin, Heidelberg</publisher-loc>
        <publisher-name>Springer Berlin Heidelberg</publisher-name>
        <fpage>63</fpage>
        <lpage>71</lpage>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>AGG</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Van Der Wilk</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Nickson</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Fujii</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Boukouvalas</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>León-Villagrá</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>GPflow: A Gaussian Process Library using TensorFlow</article-title>
        <source>J Mach Learn Res</source>
        <year>2017</year>
        <volume>18</volume>
        <fpage>1</fpage>
        <lpage>6</lpage>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <mixed-citation publication-type="other">Titsias M. Variational Learning of Inducing Variables in Sparse Gaussian Processes. In: van Dyk D, Welling M, editors. Proceedings of the Twelth International Conference on Artificial Intelligence and Statistics. Hilton Clearwater Beach Resort, Clearwater Beach, Florida USA: PMLR; 2009. p. 567–74.</mixed-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Grønbech</surname>
            <given-names>CH</given-names>
          </name>
          <name>
            <surname>Vording</surname>
            <given-names>MF</given-names>
          </name>
          <name>
            <surname>Timshel</surname>
            <given-names>PN</given-names>
          </name>
          <name>
            <surname>Sønderby</surname>
            <given-names>CK</given-names>
          </name>
          <name>
            <surname>Pers</surname>
            <given-names>TH</given-names>
          </name>
          <name>
            <surname>Winther</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>scVAE: variational auto-encoders for single-cell gene expression data</article-title>
        <source>Bioinformatics.</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>4415</fpage>
        <lpage>4422</lpage>
        <?supplied-pmid 32415966?>
        <pub-id pub-id-type="pmid">32415966</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Gu</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>VASC: Dimension reduction and visualization of single-cell RNA-seq data by deep variational autoencoder</article-title>
        <source>Genomics Proteomics Bioinformatics</source>
        <year>2018</year>
        <volume>16</volume>
        <fpage>320</fpage>
        <lpage>331</lpage>
        <?supplied-pmid 30576740?>
        <pub-id pub-id-type="pmid">30576740</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xiong</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Tian</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Shao</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Tang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>SCALE method for single-cell ATAC-seq analysis via latent feature extraction</article-title>
        <source>Nat Commun</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>4576</fpage>
        <?supplied-pmid 31594952?>
        <pub-id pub-id-type="pmid">31594952</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Mehlman</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Probabilistic harmonization and annotation of single-cell transcriptomics data with deep generative models</article-title>
        <source>Mol Syst Biol EMBO</source>
        <year>2021</year>
        <volume>17</volume>
        <fpage>e9620</fpage>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <mixed-citation publication-type="other">Chu W, Ghahramani Z. Gaussian processes for ordinal regression. J Mach Learn Res. 2005;6:1019-1041.</mixed-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Mackay</surname>
            <given-names>TFC</given-names>
          </name>
          <name>
            <surname>Richards</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Stone</surname>
            <given-names>EA</given-names>
          </name>
          <name>
            <surname>Barbadilla</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Ayroles</surname>
            <given-names>JF</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The Drosophila melanogaster Genetic Reference Panel</article-title>
        <source>Nature.</source>
        <year>2012</year>
        <volume>482</volume>
        <fpage>173</fpage>
        <lpage>178</lpage>
        <?supplied-pmid 22318601?>
        <pub-id pub-id-type="pmid">22318601</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rossi</surname>
            <given-names>MJ</given-names>
          </name>
          <name>
            <surname>Lai</surname>
            <given-names>WKM</given-names>
          </name>
          <name>
            <surname>Pugh</surname>
            <given-names>BF</given-names>
          </name>
        </person-group>
        <article-title>Simplified ChIP-exo assays</article-title>
        <source>Nat Commun</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>2842</fpage>
        <?supplied-pmid 30030442?>
        <pub-id pub-id-type="pmid">30030442</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bolger</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Lohse</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Usadel</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Trimmomatic: a flexible trimmer for Illumina sequence data</article-title>
        <source>Bioinformatics.</source>
        <year>2014</year>
        <volume>30</volume>
        <fpage>2114</fpage>
        <lpage>2120</lpage>
        <?supplied-pmid 24695404?>
        <pub-id pub-id-type="pmid">24695404</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Langmead</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Salzberg</surname>
            <given-names>SL</given-names>
          </name>
        </person-group>
        <article-title>Fast gapped-read alignment with Bowtie 2</article-title>
        <source>Nat Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>357</fpage>
        <lpage>359</lpage>
        <?supplied-pmid 22388286?>
        <pub-id pub-id-type="pmid">22388286</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <mixed-citation publication-type="other">Ntranos V, Yi L, Melsted P, Pachter L. A discriminative learning approach to differential expression analysis for single-cell RNA-seq. Nat Methods. 2019;16:163-6.</mixed-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Benjamini</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Hochberg</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Controlling the false discovery rate: a practical and powerful approach to multiple testing</article-title>
        <source>J R Stat Soc</source>
        <year>1995</year>
        <volume>57</volume>
        <fpage>289</fpage>
        <lpage>300</lpage>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <mixed-citation publication-type="other">Heinen T, Secchia S, et al. scDALI: modelling allelic heterogeneity in single cells reveals context-specific genetic regulation. Datasets Array Express <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-10240/">https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-10240/</ext-link> (2021).</mixed-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">Heinen T, Secchia S, et al. scDALI: modelling allelic heterogeneity in single cells reveals context-specific genetic regulation. Github. <ext-link ext-link-type="uri" xlink:href="https://github.com/PMBio/scdali">https://github.com/PMBio/scdali</ext-link> (2021).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <mixed-citation publication-type="other">Heinen T, Secchia S, et al. scDALI: modelling allelic heterogeneity in single cells reveals context-specific genetic regulation. Zenodo. <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/5710797">https://zenodo.org/record/5710797</ext-link> (2021).</mixed-citation>
    </ref>
  </ref-list>
</back>
