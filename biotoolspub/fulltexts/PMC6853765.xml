<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6853765</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btz479</article-id>
    <article-id pub-id-type="publisher-id">btz479</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BAMixChecker: an automated checkup tool for matched sample pairs in NGS cohort</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Chun</surname>
          <given-names>Hein</given-names>
        </name>
        <xref ref-type="aff" rid="btz479-aff1"/>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-5356-0827</contrib-id>
        <name>
          <surname>Kim</surname>
          <given-names>Sangwoo</given-names>
        </name>
        <xref ref-type="corresp" rid="btz479-cor1"/>
        <!--<email>swkim@yuhs.ac</email>-->
        <xref ref-type="aff" rid="btz479-aff1"/>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Birol</surname>
          <given-names>Inanc</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="btz479-aff1"><institution>Department of Biomedical Systems Informatics, Brain Korea 21 PLUS Project for Medical Science, Yonsei University College of Medicine</institution>, Seoul 03722, South Korea</aff>
    <author-notes>
      <corresp id="btz479-cor1">To whom correspondence should be addressed. E-mail: <email>swkim@yuhs.ac</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>11</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-06-14">
      <day>14</day>
      <month>6</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>14</day>
      <month>6</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>35</volume>
    <issue>22</issue>
    <fpage>4806</fpage>
    <lpage>4808</lpage>
    <history>
      <date date-type="received">
        <day>29</day>
        <month>1</month>
        <year>2019</year>
      </date>
      <date date-type="rev-recd">
        <day>28</day>
        <month>5</month>
        <year>2019</year>
      </date>
      <date date-type="accepted">
        <day>05</day>
        <month>6</month>
        <year>2019</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btz479.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>Mislabeling in the process of next generation sequencing is a frequent problem that can cause an entire genomic analysis to fail, and a regular cohort-level checkup is needed to ensure that it has not occurred. We developed a new, automated tool (BAMixChecker) that accurately detects sample mismatches from a given BAM file cohort with minimal user intervention. BAMixChecker uses a flexible, data-specific set of single-nucleotide polymorphisms and detects orphan (unpaired) and swapped (mispaired) samples based on genotype-concordance score and entropy-based file name analysis. BAMixChecker shows ∼100% accuracy in real WES, RNA-Seq and targeted sequencing data cohorts, even for small panels (&lt;50 genes). BAMixChecker provides an HTML-style report that graphically outlines the sample matching status in tables and heatmaps, with which users can quickly inspect any mismatch events.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>BAMixChecker is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/heinc1010/BAMixChecker">https://github.com/heinc1010/BAMixChecker</ext-link></p>
      </sec>
      <sec id="s3">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Korea Health Technology R&amp;D Project</named-content>
        </funding-source>
        <award-id>HI14C1324</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Korea Health Industry Development Institute</named-content>
          <named-content content-type="funder-identifier">10.13039/501100003710</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">KHIDI</named-content>
          <named-content content-type="funder-identifier">10.13039/501100003710</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Ministry of Health &amp; Welfare, Republic of Korea</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Bio &amp; Medical Technology Development Program</named-content>
        </funding-source>
        <award-id>NRF-2016M3A9B6903439</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">National Research Foundation of Korea</named-content>
          <named-content content-type="funder-identifier">10.13039/501100003725</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">NRF</named-content>
          <named-content content-type="funder-identifier">10.13039/100007431</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Ministry of Science and ICT</named-content>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Increasing use of Next Generation Sequencing (NGS) in clinical practice requires a large number of samples to be processed in a limited time. While improvements in algorithms have provided more accurate means of detecting genomic variants, human errors in sample handling remain a constant concern. Sample mismatch, in particular, is a frequent occurrence detrimental to sequencing analyses (<xref rid="btz479-B5" ref-type="bibr">Westra <italic>et al.</italic>, 2011</xref>).</p>
    <p>In the last few years, several tools have been developed to detect mismatching of samples in NGS datasets. Conpair (<xref rid="btz479-B1" ref-type="bibr">Bergmann <italic>et al.</italic>, 2016</xref>) detects a mismatched pair of BAM files based on 7387 known polymorphic loci. BAM-matcher (<xref rid="btz479-B4" ref-type="bibr">Wang <italic>et al.</italic>, 2016</xref>) uses a similar approach, but allows for faster testing as it only uses 1500 exotic single nucleotide polymorphism (SNP) sites. The recently developed NGSCheckMate (<xref rid="btz479-B2" ref-type="bibr">Lee <italic>et al.</italic>, 2017</xref>) accepts FASTQ, BAM or VCF files as input and provides a list or a tree graph of genotype correlations among the samples. In general, the reported accuracies of these tools are all over 95%.</p>
    <p>Despite the good accuracy of these tools, we have found areas for improvement in two major features that would allow for more active use in cohort-level checkup. First, the number and the composition of SNP sites for individual matches need to be optimized. These SNP sites should be applicable to various targeted sequencing panels in order to cope with large-scale clinical genomic tests. Second, the tool should be fast and automated to minimize intervention from users, even with a large number of samples.</p>
    <p>Accordingly, we developed BAMixChecker, which facilitates fast and accurate assessment of mismatches in sample-pair assignment from combinations of WGS/WES/RNA-Seq and targeted sequencing panels in NGS cohort. BAMixChecker uses 853 highly informative human polymorphic sites that are optimized for WGS/WES and RNA-Seq data. For targeted sequencing data, BAMixChecker instantly constructs an optimal SNP list specific to the targeted genomic regions; the use of smaller SNP set enabled a reduced running time while maintaining accuracy, even in a small panel. Although the tool was mainly developed for the analysis of human data BAMixChecker provides specific functions for the identification of sets of highly informative polymorphic positions which allow the application of the tool also to non-human species. BAMixChecker categorizes orphan and swapped samples using rules based on genetic distances and file names edit distances. The pipeline is fully automated, allowing users to quickly check abnormal events without the need for further intervention to interpret the result.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>BAMixChecker only takes pairs of BAM/CRAM files as inputs with optional genomic region information (BED file) for targeted sequencing and reports mismatched samples and their types (<xref ref-type="fig" rid="btz479-F1">Fig. 1A</xref>). The overall workflow consists of the four major steps described below. Detailed procedures are described in <xref ref-type="supplementary-material" rid="sup1">Supplementary Data</xref>.
</p>
    <fig id="btz479-F1" orientation="portrait" position="float">
      <label>Fig. 1.</label>
      <caption>
        <p><bold>(A)</bold> Overall workflow of BAMixChecker. <bold>(B)</bold> Score distribution of BAMixChecker in five datasets. Each dot reflects a comparison result between two samples. Red dots indicate unmatched pairs; blue dots are matched pairs. <bold>(C)</bold> Accuracies of the four tools in five cohorts. NGSCheckMate contains two different modes (BAM and FASTQ input). WES/RNA-Seq represents a WES-RNA-Seq pair. <bold>(D)</bold> Accuracy of the four tools in downsampled cohorts. <bold>(E)</bold> Running times of the four tools. The running times of BAMixChecker and NGSCheckMate were measured in two different modes (p1: single-thread, p4: multi-thread with four processors).*: default</p>
      </caption>
      <graphic xlink:href="btz479f1"/>
    </fig>
    <p>1. <italic>SNP site selection</italic>: To select only highly informative SNP loci and to reduce ambiguous calls, we considered two criteria: (i) mappability and (ii) population allele-frequency. From gnomAD v2.0.2 (<xref rid="btz479-B6" ref-type="bibr">Lek <italic>et al.</italic>, 2016</xref>), we collected 57 582 candidate exonic SNPs that passed filters, including variant quality, mapping quality and genomic mappability depending on position like not in a low complex region, segment duplicated region and sample repeat region. Out of the 57 582 candidates, 853 SNPs with a global minor allele frequency (gMAF) between 0.45 and 0.55, and also population-specific MAF between 0.35 and 0.65 for eight populations (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>) were selected to build a fixed list for WGS/WES and RNA-seq data. For targeted sequencing, BAMixChecker automatically adjusts MAF condition of SNPs from higher global MAF and MAF in each population by downing the values, ranging 0.45–0.1, until at least 200 SNPs overlap given targeted genomic region (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>).</p>
    <p>2. <italic>Genotype-based pairing</italic>: For selected SNP sites, BAMixChecker calls genotypes of samples using GATK HaplotypeCaller with further filtering (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>). Genotype concordance scores are then calculated between all pairs in the cohort. Sample pairs with a concordance score of &gt;0.7 are considered matched. The use of the fixed cut-off value is supported by a large margin in the observed concordance scores between matched and unmatched samples from large-scale databases (<xref ref-type="fig" rid="btz479-F1">Fig. 1B</xref>). Although a perfect concordance (1.0) is expected between matched samples in general, we assumed that many confounding factors including contamination, copy number variation, allele-specific expression and poor sample quality allowed the lenient cut-off. Unpaired samples in this step are considered <italic>orphans</italic>.</p>
    <p>3. <italic>Name-based paring</italic>: Assuming that file names are rule-based within a cohort, sample relationships can be inferred from the names, just as a human would do. BAMixChecker emulates this using <italic>entropy-based file matching</italic> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S1</xref>). Briefly, the uncertainty of values in the same position of a delimited file name is measured. Positions with high uncertainty tend to represent sample- or individual-specific information (e.g. sample id), while low uncertainty reflects global information (e.g. cohort id). File-name similarity is calculated by adding or subtracting positional entropy for each matched or mismatched value: file names of matched samples only differ in low entropy positions (e.g. T versus N) and gain a high score in high entropy positions (e.g. sample id), thereby being considered as the best match in the cohort. We have confirmed that this approach perfectly identifies true matches for 463 sample pairs in four different cohorts (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>). The file-name based matching algorithm searches matched paired sample with the best similarity score. Otherwise, a user can directly offer matched samples information with a list if the matched samples are not a pair (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>).</p>
    <p><bold>4.</bold> <italic>Decision and report</italic>: After genotype-based and file-name-based pairing, BAMixChecker categorizes all samples into three classes: <italic>matched</italic> (match for genotype and file-name pairing), <italic>swapped</italic> (genotype match that is not file-name matched, or vice versa) and <italic>orphan</italic> (no genotype match found). BAMixChecker outputs the final judgment in an HTML file, with an additional Heatmap that describes the overall sample concordance (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2</xref>).</p>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>We evaluated the accuracy of BAMixChecker in comparison to previously reported tools (NGSCheckMate, BAM-matcher and Conpair) in five real NGS cohorts with tumor-normal pairs: (1) TCGA WES pair cohort (<italic>n </italic>=<italic> </italic>202), (2) TCGA RNA-Seq pair cohort (<italic>n </italic>=<italic> </italic>130), (3) TCGA WES/RNA-Seq pair cohort (<italic>n </italic>=<italic> </italic>168), (4) Korean Cancer Study Group (KCSG) panel sequencing pair cohort (<italic>n </italic>=<italic> </italic>192) (<xref rid="btz479-B3" ref-type="bibr">Lim <italic>et al.</italic>, 2019</xref>) and (5) Korean Lung Cancer Consortium (KLCC) panel sequencing pair cohort (<italic>n </italic>=<italic> </italic>402) (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref>).</p>
    <p>For TCGA WES and RNA-Seq, all tools exhibited good accuracy, except for a few miscalls by BAM-matcher and Conpair (<xref ref-type="fig" rid="btz479-F1">Fig. 1C</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Table S3</xref>). However, there was a noticeable drop in accuracy for the targeted sequencing cohorts (KCSG and KLCC in <xref ref-type="fig" rid="btz479-F1">Fig. 1C</xref>) with Conpair. For all cohorts, only BAMixChecker showed perfect accuracy.</p>
    <p>For evaluation of smaller panels, TCGA WES data were downsampled to gene lists of four popular commercial panels: Ion AmpliSeq Comprehensive Cancer Panel (Ion-CCP, 409 genes), Foundation One (FONE, 315 genes), xGen Pan-Cancer Panel (xGen-PCP, 127 genes) and Comprehensive Common Cancer Panel (CCCP, 46 genes). We found BAMixChecker showed almost perfect accuracy in all panels (&gt;99.8%), while the other tools showed lower accuracy in smaller panels (<xref ref-type="fig" rid="btz479-F1">Fig. 1D</xref>). BAMixChecker showed robust performance even with a family dataset (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3</xref>).</p>
    <p>For additional validation, we generated artificial mismatches by intentionally changing file names (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>). For each NGS cohort, 10% of files were randomly selected and simulated to be swapped (by switching file names) or orphan (by assigning a file name to a wrong sample), which were repeated 100 times with different randomization. Testing by BAMixChecker confirmed that all mismatches were perfectly reported (100% accuracy), regardless of the mismatch type or used NGS cohort (<xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S4</xref>).</p>
    <p>Finally, running times were assessed for all tools (<xref ref-type="fig" rid="btz479-F1">Fig. 1E</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Methods</xref>). BAMixChecker and NGSCheckMate can be run in a multiprocessing mode and were tested with two different CPU numbers (single and 4-CPUs). BAMixChecker exhibited comparable or faster speed than BAM-matcher and Conpair, and was remarkably faster (∼18×) than NGSCheckMate. Considering the reduced need for intervention from users, we expect that the practical hands-on time would be much shorter with BAMixChecker.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>btz479_Supplementary_Data</label>
      <media xlink:href="btz479_supplementary_data.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank the KCSG TRIUMPH for providing sequencing data.</p>
    <sec>
      <title>Funding</title>
      <p>This research was supported by the grant of the Korea Health Technology R&amp;D Project [HI14C1324] through the Korea Health Industry Development Institute (KHIDI), funded by the Ministry of Health &amp; Welfare, Republic of Korea, and the Bio &amp; Medical Technology Development Program [NRF-2016M3A9B6903439] through the National Research Foundation of Korea (NRF), funded by the Ministry of Science and ICT.</p>
      <p><italic>Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btz479-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bergmann</surname><given-names>E.A.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Conpair: concordance and contamination estimator for matched tumor-normal pairs</article-title>. <source>Bioinformatics</source>, <volume>32</volume>, <fpage>3196</fpage>–<lpage>3198</lpage>.<pub-id pub-id-type="pmid">27354699</pub-id></mixed-citation>
    </ref>
    <ref id="btz479-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lee</surname><given-names>S.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>NGSCheckMate: software for validating sample identity in next-generation sequencing studies within and across data types</article-title>. <source>Nucleic Acids Res</source>., <volume>45</volume>, <fpage>e103</fpage>.<pub-id pub-id-type="pmid">28369524</pub-id></mixed-citation>
    </ref>
    <ref id="btz479-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lek</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Analysis of protein-coding genetic variation in 60 706 humans</article-title>. <source>Nature</source>, <volume>536</volume>, <fpage>285</fpage>–<lpage>91</lpage>.<pub-id pub-id-type="pmid">27535533</pub-id></mixed-citation>
    </ref>
    <ref id="btz479-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lim</surname><given-names>S.M.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>Investigating the feasibility of targeted next-generation sequencing to guide the treatment of head and neck squamous cell carcinoma</article-title>. <source>Cancer Res Treat</source>, <volume>51</volume>, <fpage>300</fpage>–<lpage>312</lpage>.<pub-id pub-id-type="pmid">29747488</pub-id></mixed-citation>
    </ref>
    <ref id="btz479-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>P.P.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>BAM-matcher: a tool for rapid NGS sample matching</article-title>. <source>Bioinformatics</source>, <volume>32</volume>, <fpage>2699</fpage>–<lpage>2701</lpage>.<pub-id pub-id-type="pmid">27153667</pub-id></mixed-citation>
    </ref>
    <ref id="btz479-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Westra</surname><given-names>H.J.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>MixupMapper: correcting sample mix-ups in genome-wide datasets increases power to detect small genetic effects</article-title>. <source>Bioinformatics</source>, <volume>27</volume>, <fpage>2104</fpage>–<lpage>2111</lpage>.<pub-id pub-id-type="pmid">21653519</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
