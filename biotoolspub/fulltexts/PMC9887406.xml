<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinform Adv</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinform Adv</journal-id>
    <journal-id journal-id-type="publisher-id">bioadv</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics Advances</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2635-0041</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9887406</article-id>
    <article-id pub-id-type="pmid">36726731</article-id>
    <article-id pub-id-type="doi">10.1093/bioadv/vbac101</article-id>
    <article-id pub-id-type="publisher-id">vbac101</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>cvlr: finding heterogeneously methylated genomic regions using ONT reads</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Raineri</surname>
          <given-names>Emanuele</given-names>
        </name>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Software" vocab-term-identifier="http://credit.niso.org/contributor-roles/software/" degree-contribution="lead">Software</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – original draft" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-original-draft/" degree-contribution="lead">Writing – original draft</role>
        <role vocab="credit" vocab-identifier="http://credit.niso.org" vocab-term="Writing – review &amp; editing" vocab-term-identifier="http://credit.niso.org/contributor-roles/writing-review-editing/" degree-contribution="lead">Writing – review &amp; editing</role>
        <aff><institution>CNAG-CRG, Centre for Genomic Regulation (CRG), Barcelona Institute of Science and Technology (BIST)</institution>, Barcelona 08028, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0003-4842-0840</contrib-id>
        <name>
          <surname>Alberola i Pla</surname>
          <given-names>Mariona</given-names>
        </name>
        <aff><institution>CNAG-CRG, Centre for Genomic Regulation (CRG), Barcelona Institute of Science and Technology (BIST)</institution>, Barcelona 08028, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dabad</surname>
          <given-names>Marc</given-names>
        </name>
        <aff><institution>CNAG-CRG, Centre for Genomic Regulation (CRG), Barcelona Institute of Science and Technology (BIST)</institution>, Barcelona 08028, <country country="ES">Spain</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Heath</surname>
          <given-names>Simon</given-names>
        </name>
        <aff><institution>CNAG-CRG, Centre for Genomic Regulation (CRG), Barcelona Institute of Science and Technology (BIST)</institution>, Barcelona 08028, <country country="ES">Spain</country></aff>
        <xref rid="vbac101-cor1" ref-type="corresp"/>
        <!--simon.heath@gmail.com-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Lengauer</surname>
          <given-names>Thomas</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="vbac101-cor1">To whom correspondence should be addressed. Email: <email>simon.heath@gmail.com</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-01-23">
      <day>23</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>23</day>
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <volume>3</volume>
    <issue>1</issue>
    <elocation-id>vbac101</elocation-id>
    <history>
      <date date-type="received">
        <day>01</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>07</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>17</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>03</day>
        <month>1</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>30</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="vbac101.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>Nanopore reads encode information on the methylation status of cytosines in <monospace>CpG</monospace> dinucleotides. The length of the reads makes it comparatively easy to look at patterns consisting of multiple loci; here, we exploit this property to search for regions where one can define subpopulations of molecules based on methylation patterns. As an example, we run our clustering algorithm on known imprinted genes; we also scan chromosome 15 looking for windows corresponding to heterogeneous methylation. Our software can also compute the covariance of methylation across these regions while keeping into account the mixture of different types of reads.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p><ext-link xlink:href="http://rId6" ext-link-type="uri">https://github.com/EmanueleRaineri/cvlr</ext-link>.</p>
      </sec>
      <sec id="s3">
        <title>Contact</title>
        <p>
          <email>simon.heath@cnag.crg.eu</email>
        </p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics Advances</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Spanish Plan Nacional</institution>
          </institution-wrap>
        </funding-source>
        <award-id>PGC2018-099640-B-I00</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Spanish Ministry of Science and Innovation to the EMBL</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Centro de Excelencia Severo Ochoa</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Spanish Ministry of Science and Innovation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100004837</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Instituto de Salud Carlos III</institution>
            <institution-id institution-id-type="DOI">10.13039/501100004587</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Departament de Salut and Departament d’Universitats i Recerca</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>European Regional Development Fund</institution>
            <institution-id institution-id-type="DOI">10.13039/501100008530</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Spanish Ministry of Science and Innovation</institution>
            <institution-id institution-id-type="DOI">10.13039/501100004837</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="4"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>In this article, we exploit the fact that one can measure both DNA sequence and cytosine methylation status in one go via Nanopore sequencing (<xref rid="vbac101-B18" ref-type="bibr">Simpson <italic toggle="yes">et al.</italic>, 2017</xref>) to scan the genome looking for regions where methylation changes between DNA molecules. The idea of quantifying the variability in binary epigenetic patterns in single reads was initially discussed in <xref rid="vbac101-B11" ref-type="bibr">Landan <italic toggle="yes">et al.</italic> (2012)</xref>. A probabilistic model to study allele-specific methylation has been proposed by <xref rid="vbac101-B7" ref-type="bibr">Fang <italic toggle="yes">et al.</italic> (2012)</xref> on short reads measured with whole genome bisulfite sequencing; <xref rid="vbac101-B3" ref-type="bibr">Barrett <italic toggle="yes">et al.</italic> (2017)</xref> discuss the analysis of RRBS libraries and <xref rid="vbac101-B1" ref-type="bibr">Abante <italic toggle="yes">et al.</italic> (2020)</xref> present a statistical method for finding haplotype-specific methylation through long reads based on an Ising-like model but as far as we know there is no method for the analysis of methylation heterogeneity on long reads which does not rely on phasing, which is also used in <xref rid="vbac101-B2" ref-type="bibr">Akbari <italic toggle="yes">et al.</italic> (2021)</xref> from where we take some benchmarking data. What we propose here is a software which can be run from the command line on the output of (among others) Nanopore sequencing experiments to cluster reads based on methylation patterns appearing on them. Since it does not rely on a previous phasing step, our method can capture allele-specific differences but also other forms of heterogeneity, e.g. due to cell subpopulations. We show some results obtained by looking at chromosome 15 (chr15), which we chose because it contains a number of well-studied imprinted regions <xref rid="vbac101-B16" ref-type="bibr">Reik and Walter (2001)</xref>. Our test dataset is the sample <monospace>NA12878</monospace> (Lymphoblastoid cell line) sequenced by the Nanopore consortium (<xref rid="vbac101-B9" ref-type="bibr">Jain <italic toggle="yes">et al.</italic>, 2018</xref>).</p>
  </sec>
  <sec>
    <title>2 Results and methods</title>
    <sec>
      <title>2.1 Known imprinted genes</title>
      <p>To give an example on how to look at allele-specific methylation, we first considered some genes known to have imprinted expression in many tissues (<xref rid="vbac101-T1" ref-type="table">Table 1</xref>). An example of analysis on GNAS is in <xref rid="vbac101-F1" ref-type="fig">Figure 1</xref>. <xref rid="sup1" ref-type="supplementary-material">Supplementary material</xref> contains more examples. For each gene, we clustered in <italic toggle="yes">k </italic>=<italic toggle="yes"> </italic>2 groups the reads mapping on the corresponding genomic stretch and also tagged each read with its haplotype as computed by <monospace>WhatsHap</monospace> (<xref rid="vbac101-B12" ref-type="bibr">Martin <italic toggle="yes">et al.</italic>, 2016</xref>). Haplotypes for each read are computed by phasing the entire chromosome containing the considered locus. We then check that each cluster is enriched in a specific haplotype. In some cases, we do not look at the entire gene region, rather we select stretches where the methylation seems to be at intermediate levels or positions surrounding known regulatory sites, or already described as imprinting control regions in <xref rid="vbac101-B10" ref-type="bibr">Joshi <italic toggle="yes">et al.</italic> (2016)</xref> and <xref rid="vbac101-B5" ref-type="bibr">Court <italic toggle="yes">et al.</italic> (2014)</xref> as reported in <xref rid="vbac101-B2" ref-type="bibr">Akbari <italic toggle="yes">et al.</italic> (2021)</xref>; the exact loci are under the ‘chr:start-end’ heading and known imprinted regions have a ‘dmr’ in their name.</p>
      <fig position="float" id="vbac101-F1">
        <label>Fig. 1.</label>
        <caption>
          <p>(<bold>a</bold>) Mean values of methylation in the two clusters over the GNAS region. Single dots represent methylation levels (colored by cluster), the continuous lines are obtained by smoothing with Bezier curves. (<bold>b</bold>) The two corresponding subpopulations of reads in the subregion 58854000–58856000 (blue = methylated, orange = not methylated, gray = not known). (<bold>c</bold>) Covariance matrix of the methylation in the GNAS gene (see explanation in Section 2.3). (<bold>d</bold>) Scan of chr15 in windows of 5<italic toggle="yes"> </italic>kb. For each window, we computed the clustering (<italic toggle="yes">k </italic>=<italic toggle="yes"> </italic>2) of the reads and the median absolute difference in methylation across clusters, and plotted it along the chromosome. In the main text, we define as peaks the values above the horizontal line at <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:mo>≈</mml:mo><mml:mn>0.53</mml:mn></mml:mrow></mml:math></inline-formula></p>
        </caption>
        <graphic xlink:href="vbac101f1" position="float"/>
      </fig>
      <table-wrap position="float" id="vbac101-T1">
        <label>Table 1.</label>
        <caption>
          <p>Known imprinted genes we looked at</p>
        </caption>
        <table frame="hsides" rules="groups">
          <colgroup span="1">
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="left" span="1"/>
            <col valign="top" align="char" char="." span="1"/>
            <col valign="top" align="center" span="1"/>
            <col valign="top" align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <th rowspan="1" colspan="1">GENE</th>
              <th rowspan="1" colspan="1">chr:start–end</th>
              <th rowspan="1" colspan="1">
                <inline-formula id="IE2">
                  <mml:math id="IM2" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>Δ</mml:mo>
                      <mml:mi>m</mml:mi>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </th>
              <th rowspan="1" colspan="1"><italic toggle="yes">P</italic>val (<inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula>)</th>
              <th rowspan="1" colspan="1"><italic toggle="yes">P</italic>val (phasing)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">GNAS</td>
              <td rowspan="1" colspan="1">chr20:58830000–58870000</td>
              <td rowspan="1" colspan="1">0.667</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE4">
                  <mml:math id="IM4" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">8.2e−30</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">H19dmr</td>
              <td rowspan="1" colspan="1">chr11:1997582–2003510</td>
              <td rowspan="1" colspan="1">0.609</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE5">
                  <mml:math id="IM5" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">0.0079</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">H19</td>
              <td rowspan="1" colspan="1">chr11:1995163–2001470</td>
              <td rowspan="1" colspan="1">0.474</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE6">
                  <mml:math id="IM6" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">1</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">PEG10</td>
              <td rowspan="1" colspan="1">chr7:94656325–94669695</td>
              <td rowspan="1" colspan="1">0.457</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE7">
                  <mml:math id="IM7" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">3.2e−08</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">MEG3</td>
              <td rowspan="1" colspan="1">chr14:100820000–100840000</td>
              <td rowspan="1" colspan="1">0.231</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE8">
                  <mml:math id="IM8" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">3.8e−07</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">SNRPN</td>
              <td rowspan="1" colspan="1">chr15:24950000–24958000</td>
              <td rowspan="1" colspan="1">0.637</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE9">
                  <mml:math id="IM9" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">1.4e−10</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">IGF2</td>
              <td rowspan="1" colspan="1">chr11:2132761–2133882</td>
              <td rowspan="1" colspan="1">0.200</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE10">
                  <mml:math id="IM10" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">0.0031</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">PLAGL1</td>
              <td rowspan="1" colspan="1">chr6:144000000–144020000</td>
              <td rowspan="1" colspan="1">0.574</td>
              <td rowspan="1" colspan="1">
                <inline-formula id="IE11">
                  <mml:math id="IM11" display="inline" overflow="scroll">
                    <mml:mrow>
                      <mml:mo>&lt;</mml:mo>
                      <mml:msup>
                        <mml:mrow>
                          <mml:mrow>
                            <mml:mn>10</mml:mn>
                          </mml:mrow>
                        </mml:mrow>
                        <mml:mrow>
                          <mml:mo>−</mml:mo>
                          <mml:mn>3</mml:mn>
                        </mml:mrow>
                      </mml:msup>
                    </mml:mrow>
                  </mml:math>
                </inline-formula>
              </td>
              <td rowspan="1" colspan="1">2.7e−07</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <fn id="tblfn1">
            <p><italic toggle="yes">Note</italic>: For each region, we repeat the clustering with different seeds for the random initialization and we pick the output with the best likelihood. The third column reports the median of the absolute difference in methylation between clusters; we compute its empirical <italic toggle="yes">P</italic>-value (fourth column) using its distribution on a set of 1000 random cluster assignments. We also check that each cluster is enriched in a specific haplotype via a Fisher’s test (<italic toggle="yes">P</italic>-value in the fifth column).</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>2.2 Scan of chr15</title>
      <p>We then scanned chr15 in windows of 5 kb and clustered (with <italic toggle="yes">k </italic>=<italic toggle="yes"> </italic>2) the reads mapping on each window; the median absolute difference in methylation between the clusters at each locus is in <xref rid="vbac101-F1" ref-type="fig">Figure 1d</xref>. The 95% percentile of the distribution of median absolute difference in methylation between cluster is 0.53 which we use a threshold for further analysis below. To compare the results of the clustering with the output of <monospace>WhatsHap</monospace>, we haplotagged all the reads mapping onto chr15 and computed the median absolute methylation difference between haplotypes in windows of 5 kb. There were 17 windows where cvlr could not give results and <monospace>WhatsHap</monospace> could, and 905 windows where <monospace>WhatsHap</monospace> did not give any result and <monospace>cvlr</monospace> did. The threshold of 0.53 gives 909 peaks when using cvlr and <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mo>≈</mml:mo><mml:mn>40</mml:mn></mml:mrow></mml:math></inline-formula> windows when using <monospace>WhatsHap</monospace> (see the <xref rid="sup1" ref-type="supplementary-material">Supplementary material</xref> for further details). When running Whatshap to haplotag reads over chr15, we find that 100 920 reads are assigned to haplotype H1, 97 470 to haplotype H2 and for 130 963 reads (around 40% of the total), it is not possible to determine the haplotype they belong to probably due to the sparsity of heterozygous SNPs. Using the same set of 5k windows, we checked the correspondence between phasing and methylation; to this end, we computed the <italic toggle="yes">P</italic>-value of a Fisher’s test on all windows so that positions where a certain haplotype is enriched in a certain cluster correspond to a low <italic toggle="yes">P</italic>-value. <xref rid="sup1" ref-type="supplementary-material">Supplementary Figure S2</xref> shows the negative logarithm of the Fisher <italic toggle="yes">P</italic>-value at each genomic window; we also highlight the positions of imprinted control regions described in <xref rid="vbac101-B10" ref-type="bibr">Joshi <italic toggle="yes">et al.</italic> (2016)</xref> and <xref rid="vbac101-B5" ref-type="bibr">Court <italic toggle="yes">et al.</italic> (2014)</xref> which all (but one) fall into peaks, We compared the coordinates of 909 peaks with the coordinates of NA12878 enhancers, and we obtain 55 intersections; this corresponds (by randomization) to a <italic toggle="yes">P</italic>-value of &lt;1%. We intersect those peaks with genes to find 472 overlapping genes which is not significant at the 5% level.</p>
    </sec>
    <sec>
      <title>2.3 Methods</title>
      <p>The software we used to produce <xref rid="vbac101-F1" ref-type="fig">Figure 1</xref> is called <monospace>cvlr,</monospace> and it consists of three executables, <monospace>cvlr-cluster</monospace> which runs the clustering algorithm, <monospace>cvlr-meth-of-bam</monospace> which helps in extracting methylation information from <monospace>BAM</monospace> files and <monospace>cvlr-stats</monospace> which processes the clusters to compute descriptive statistics. It is not necessary to use <monospace>cvlr-meth-of-bam</monospace> to produce the input for <monospace>cvlr-</monospace><monospace>cluster</monospace>, users can equally adapt the output of e.g. <monospace>Nanopolish</monospace> Simpson. Internally, the algorithm sees the data as a binary matrix (with missing data) <italic toggle="yes">X</italic>, with <italic toggle="yes">n</italic> rows representing reads and <italic toggle="yes">d</italic> columns corresponding to genomic positions. Each position <italic toggle="yes">X<sub>ij</sub></italic> can be 0 (unmethylated) 1 (methylated) or −1 (unknown). Reads are clustered (into <italic toggle="yes">k</italic> clusters) via a mixture of multivariate Bernoulli distributions. To this purpose, we use an Expectation–Maximization (EM) algorithm (<xref rid="vbac101-B6" ref-type="bibr">Dempster <italic toggle="yes">et al.</italic>, 1977</xref>) allowing for incomplete observations; the output of the algorithm is:
</p>
      <list list-type="bullet">
        <list-item>
          <p>a vector <italic toggle="yes">π<sub>l</sub></italic> which contains the weight of each component of the mixture for <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mrow><mml:mi>l</mml:mi><mml:mo>∈</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula>. One has <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>.</p>
        </list-item>
        <list-item>
          <p>a <italic toggle="yes">k</italic> × <italic toggle="yes">d</italic> matrix <italic toggle="yes">μ</italic> containing the average methylation for each cluster at each position. We indicate the <italic toggle="yes">l</italic>th row of <italic toggle="yes">μ</italic> with <italic toggle="yes">μ<sub>l</sub></italic> and one has <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> is a vector of dimension <italic toggle="yes">d</italic>.</p>
        </list-item>
        <list-item>
          <p>the <italic toggle="yes">d</italic> × <italic toggle="yes">d</italic> covariance matrix of the methylation computed as
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mo>Σ</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>l</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>}</mml:mo><mml:mo>−</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">]</mml:mo><mml:mi>E</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula></p>
        </list-item>
      </list>
      <p>where <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>Σ</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mtext>diag</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>l</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> see <xref rid="vbac101-B4" ref-type="bibr">Bishop and Nasrabadi (2006)</xref>.</p>
      <p>The E step computes the posterior probability that a given read belongs to a certain cluster; the M step updates the <italic toggle="yes">μ</italic> matrix, replacing missing data with a weighted sum of the corresponding positions in the old <italic toggle="yes">μ</italic>. <monospace>cvlr-stats</monospace> computes, among other things, the median absolute difference in methylation and the posterior probability of difference in methylation between all pairs of clusters across all the positions (in pairs) using the method described in <xref rid="vbac101-B15" ref-type="bibr">Raineri <italic toggle="yes">et al.</italic> (2014)</xref>. The command line allows to specify the number of clusters, a seed for the random initialization of the algorithm and the maximum number of iterations of the EM algorithm.</p>
      <p>To verify that the software works as expected, we simulate 100 reads covering 1000 positions; methylation values are generated first by assuming that the reads form two clusters corresponding to an uniformly low and uniformly high methylation levels. We then check that the simulated clusters are recovered correctly by cvlr-cluster, even in the presence of missing values. We repeat the same procedure with clusters formed by reads which are methylated or not methylated at alternating (non-overlapping) positions. The error rate is <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mrow><mml:mo>≈</mml:mo><mml:mn>2</mml:mn><mml:mo>%</mml:mo></mml:mrow></mml:math></inline-formula> in all these tests.</p>
      <p>We downloaded all the test data we used from wgs and processed them with our internal pipeline which is based on <monospace>Megalodon</monospace> meg. Enhancers were taken from <xref rid="vbac101-B8" ref-type="bibr">Gao and Qian (2020)</xref>. In summary, we showed how to use <monospace>cvlr</monospace> to measure methylation heterogeneity along the human genome; although we used imprinted regions (and hence allele-specific methylation) as a benchmark, <monospace>cvlr</monospace> can be run to detect subpopulation of reads regardless of whether they are due to an allelic effect and does not need a preliminary phasing step. As mentioned above, this is important in practice because when phasing many reads cannot be assigned to an haplotype simply because they contain no informative SNPs; on the other hand, methylation measurements are dense along the genome and each read bears a methylation pattern.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>vbac101_Supplementary_Data</label>
      <media xlink:href="vbac101_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgement</title>
    <p>We want to thank the anonymous reviewers for their help in improving the article.</p>
    <sec>
      <title>Author contributions</title>
      <p>Emanuele Raineri (Software, Writing—original draft, Writing—review &amp; editing [Lead]) Marc Dabad and Mariona Alberola i Pla ran experiments and performed data analysis. Simon Heath contributed to the original design of the manuscript and suggested using imprinted regions as benchmark for the clustering.</p>
    </sec>
    <sec>
      <title>Funding</title>
      <p>This work was supported by a Spanish Plan Nacional grant [project: PGC2018-099640-B-I00]. Furthermore, we acknowledge support of the Spanish Ministry of Science and Innovation to the EMBL partnership, of the Centro de Excelencia Severo Ochoa and of the CERCA Programme/Generalitat de Catalunya. We also acknowledge support of the Spanish Ministry of Science and Innovation through the Instituto de Salud Carlos III of the Generalitat de Catalunya through Departament de Salut and Departament d’Universitats i Recerca. We also acknowledge the Co-financing with funds from the European Regional Development Fund by the Spanish Ministry of Science and Innovation corresponding to the Programa Operativo FEDER Plurirregional de España (POPE) 2014–2020 and by the Departament d’Universitats i Recerca of the Generalitat de Catalunya corresponding to the Programa Operatiu FEDER de Catalunya 2014–2020.</p>
      <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>Data derived from a source in the public domain which is referenced in the paper.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="vbac101-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Abante</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Detection of haplotype-dependent allele-specific DNA methylation in WGBS data</article-title>. <source>Nat. Commun</source>., <volume>11</volume>, <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">31911652</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Akbari</surname><given-names>V.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Megabase-scale methylation phasing using nanopore long reads and nanomethphase</article-title>. <source>Genome Biol</source>., <volume>22</volume>, <fpage>1</fpage>–<lpage>21</lpage>.<pub-id pub-id-type="pmid">33397451</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Barrett</surname><given-names>J.E.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Quantification of tumour evolution and heterogeneity via Bayesian epiallele detection</article-title>. <source>BMC Bioinformatics</source>, <volume>18</volume>, <fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">28049414</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B4">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Bishop</surname><given-names>C.M.</given-names></string-name>, <string-name><surname>Nasrabadi</surname><given-names>N.M.</given-names></string-name></person-group> (<year>2006</year>) <source>Pattern Recognition and Machine Learning</source>, Vol. <volume>4</volume>. New York: <publisher-name>Springer</publisher-name>.</mixed-citation>
    </ref>
    <ref id="vbac101-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Court</surname><given-names>F.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Genome-wide parent-of-origin DNA methylation analysis reveals the intricacies of human imprinting and suggests a germline methylation-independent mechanism of establishment</article-title>. <source>Genome Res</source>., <volume>24</volume>, <fpage>554</fpage>–<lpage>569</lpage>.<pub-id pub-id-type="pmid">24402520</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dempster</surname><given-names>A.P.</given-names></string-name></person-group><etal>et al</etal> (<year>1977</year>) <article-title>Maximum likelihood from incomplete data via the EM algorithm</article-title>. <source>J. R. Stat. Soc. B</source>, <volume>39</volume>, <fpage>1</fpage>–<lpage>22</lpage>.</mixed-citation>
    </ref>
    <ref id="vbac101-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fang</surname><given-names>F.</given-names></string-name></person-group><etal>et al</etal> (<year>2012</year>) <article-title>Genomic landscape of human allele-specific DNA methylation</article-title>. <source>Proc. Natl. Acad. Sci. USA</source>, <volume>109</volume>, <fpage>7332</fpage>–<lpage>7337</lpage>.<pub-id pub-id-type="pmid">22523239</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gao</surname><given-names>T.</given-names></string-name>, <string-name><surname>Qian</surname><given-names>J.</given-names></string-name></person-group> (<year>2020</year>) <article-title>EnhancerAtlas 2.0: an updated resource with enhancer annotation in 586 tissue/cell types across nine species</article-title>. <source>Nucleic Acids Res</source>., <volume>48</volume>, <fpage>D58</fpage>–<lpage>D64</lpage>.<pub-id pub-id-type="pmid">31740966</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jain</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Nanopore sequencing and assembly of a human genome with ultra-long reads</article-title>. <source>Nat. Biotechnol</source>., <volume>36</volume>, <fpage>338</fpage>–<lpage>345</lpage>.<pub-id pub-id-type="pmid">29431738</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Joshi</surname><given-names>R.S.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>DNA methylation profiling of uniparental disomy subjects provides a map of parental epigenetic bias in the human genome</article-title>. <source>Am. J. Hum. Genet</source>., <volume>99</volume>, <fpage>555</fpage>–<lpage>566</lpage>.<pub-id pub-id-type="pmid">27569549</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Landan</surname><given-names>G.</given-names></string-name></person-group><etal>et al</etal> (<year>2012</year>) <article-title>Epigenetic polymorphism and the stochastic formation of differentially methylated regions in normal and cancerous tissues</article-title>. <source>Nat. Genet</source>., <volume>44</volume>, <fpage>1207</fpage>–<lpage>1214</lpage>.<pub-id pub-id-type="pmid">23064413</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B12">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Martin</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) WhatsHap: fast and accurate read-based phasing. BioRxiv, p. <fpage>085050</fpage>.</mixed-citation>
    </ref>
    <ref id="vbac101-B13">
      <mixed-citation publication-type="other"><collab>Megalodon</collab>. <ext-link xlink:href="https://github.com/nanoporetech/megalodon" ext-link-type="uri">https://github.com/nanoporetech/megalodon</ext-link>.</mixed-citation>
    </ref>
    <ref id="vbac101-B14">
      <mixed-citation publication-type="other"><collab>Nanopore WGS Consortium</collab>. <ext-link xlink:href="https://github.com/nanopore-wgs-consortium/" ext-link-type="uri">https://github.com/nanopore-wgs-consortium/</ext-link> (January 2023, date last accessed).</mixed-citation>
    </ref>
    <ref id="vbac101-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Raineri</surname><given-names>E.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>A note on exact differences between beta distributions in genomic (methylation) studies</article-title>. <source>PLoS One</source>, <volume>9</volume>, <fpage>e97349</fpage>.<pub-id pub-id-type="pmid">24824426</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Reik</surname><given-names>W.</given-names></string-name>, <string-name><surname>Walter</surname><given-names>J.</given-names></string-name></person-group> (<year>2001</year>) <article-title>Genomic imprinting: parental influence on the genome</article-title>. <source>Nat. Rev. Genet</source>., <volume>2</volume>, <fpage>21</fpage>–<lpage>32</lpage>.<pub-id pub-id-type="pmid">11253064</pub-id></mixed-citation>
    </ref>
    <ref id="vbac101-B17">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Simpson</surname><given-names>J.T.</given-names></string-name></person-group><italic toggle="yes">Signal-Level Algorithms for Minion Data</italic>. <ext-link xlink:href="https://github.com/jts/nanopolish" ext-link-type="uri">https://github.com/jts/nanopolish</ext-link> (January 2023, date last accessed).</mixed-citation>
    </ref>
    <ref id="vbac101-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Simpson</surname><given-names>J.T.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Detecting DNA cytosine methylation using nanopore sequencing</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>407</fpage>–<lpage>410</lpage>.<pub-id pub-id-type="pmid">28218898</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
